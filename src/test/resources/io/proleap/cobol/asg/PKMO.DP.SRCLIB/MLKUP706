       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.             MLKUP706.                                        
       AUTHOR.                 COGNIZANT.                                       
       INSTALLATION.           KOHLS.                                           
       DATE-WRITTEN.           10-23-09.                                        
       DATE-COMPILED.          TODAYS DATE.                                     
      *                                                                         
      ******************************************************************        
      *  PRORATE EIC & GROSS MARGIN AMT TO MNLYSUM,WKLYSUM & DBV TABLES*        
      ******************************************************************        
      * THIS PROGRAM READ THE PRORATION PERCENTAGE FROM THE INPUT FILE *        
      * AND CREATE THE REPORT AND UPDATES THE RECORDS IN THE           *        
      * CORRESPONDING MNLYSUM,WKLYSUM & BV TABLE RECORDS               *        
      *                                                                *        
      *                                                                *        
      * WR/PROJ DATE       PROGRAMMER   DESCRIPTION OF CHANGES         *        
      * ------- ---------- ------------ -------------------------------*        
      * WR6664  10-21-2009 COGNIZANT    NEW PROGRAM                    *        
      * W37965  11-11-2010 J SELWITSCHKA                               *        
      *                                 ADDED LOCATION NUMBER FOR      *        
      *                                 WEEKLY SUM UPDATE              *        
      ******************************************************************        
      *                                                                         
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER.        IBM-3090.                                        
       OBJECT-COMPUTER.        IBM-3090.                                        
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
      *                                                                         
           SELECT PCTBR-FILE                 ASSIGN TO INP01.                   
           SELECT DR810-EIC-GM-FILE          ASSIGN TO INP02.                   
           SELECT PRORATION-REPORT-FILE      ASSIGN TO OUT01.                   
           SELECT PRORATION-BVTBLE-FILE      ASSIGN TO OUT02.                   
                                                                                
      *                                                                         
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *                                                                         
       FD  PCTBR-FILE                                                           
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 35 CHARACTERS                                        
           DATA RECORD IS PRORATION-PCT-REC.                                    
       01  PRORATION-PCT-REC          PIC X(35).                                
      *                                                                         
       FD  DR810-EIC-GM-FILE                                                    
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 190 CHARACTERS                                       
           DATA RECORD IS DR810-EIC-GM-REC.                                     
       01  DR810-EIC-GM-REC           PIC X(190).                               
      *                                                                         
       FD  PRORATION-REPORT-FILE                                                
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 133 CHARACTERS                                       
           DATA RECORD IS PRORATION-REPORT-REC.                                 
       01  PRORATION-REPORT-REC       PIC X(133).                               
      *                                                                         
       FD  PRORATION-BVTBLE-FILE                                                
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 400 CHARACTERS                                       
           DATA RECORD IS PRORATION-BVTBL-REC.                                  
       01  PRORATION-BVTBL-REC        PIC X(400).                               
      *                                                                         
       WORKING-STORAGE SECTION.                                                 
      *                                                                         
      ******************************************************************        
      *    VARIABLES ARE DECLARED HERE                                          
      ******************************************************************        
      *                                                                         
       01  PV-PROGRAM-VARIBLES.                                                 
      *                                                                         
           05  PV-CURRENT-TIMESTAMP           PIC  X(26) VALUE SPACES.          
           05  PV-COMMIT-TIMESTAMP            PIC  X(26) VALUE SPACES.          
           05  PV-PARAGRAPH-NAME              PIC  X(30) VALUE SPACES.          
           05  PV-OPER-ATTEMPTED              PIC  X(35) VALUE SPACES.          
           05  PV-COUNT-VAR                   PIC  9(08) VALUE ZEROES.          
           05  PV-DEPT-NBR-UNPACK             PIC  9(04) VALUE ZEROES.          
           05  PV-DEPT-NBR-ADJ                PIC   ZZ9  VALUE ZEROES.          
           05  PV-PCTBR-DEPT-NBR-X            PIC  X(03) VALUE SPACES.          
           05  PV-PCTBR-DPT-NUM               PIC  9(03) VALUE ZEROES.          
           05  PV-LINE-COUNTER                PIC S9(15) COMP-3                 
                                                         VALUE ZEROES.          
           05  PV-PAGE-COUNTER                PIC S9(05) COMP-3                 
                                                         VALUE ZEROES.          
           05  PA-COUNT-PCTBR-RECS            PIC  9(05) VALUE ZEROES.          
           05  PA-COUNT-DR810-EIC-RECS        PIC  9(05) VALUE ZEROES.          
           05  PA-NUMERIC-810-DEPT-NUM        PIC  S9(04)V COMP-3               
                                                         VALUE ZEROES.          
      *                                                                         
           05  PV-PGM-WORK-VARIABLES.                                           
               10  PA-COUNT-MNLY-UPDT-RECS    PIC  9(05) VALUE ZEROES.          
               10  PA-COUNT-WKLY-UPDT-RECS    PIC  9(05) VALUE ZEROES.          
               10  PA-COUNT-BV-UPDT-RECS      PIC  9(05) VALUE ZEROES.          
               10  PA-COUNT-BV-ISRT-RECS      PIC  9(05) VALUE ZEROES.          
               10  PA-COUNT-BVTBL-RECS        PIC  9(05) VALUE ZEROES.          
               10  PA-COUNT-PRORATE-RPT-RECS  PIC  9(05) VALUE ZEROES.          
               10  PA-COMMIT-COUNT            PIC  9(09) VALUE ZEROES.          
               10  HOLD-PCTBR-SUB-CL-NBR      PIC S9(04) COMP-3                 
                                                         VALUE ZEROES.          
               10  HOLD-PCTBR-MAJ-CL-NBR      PIC S9(04) COMP-3                 
                                                         VALUE ZEROES.          
               10  HOLD-PCTBR-ML-LWST-ID      PIC S9(09) COMP                   
                                                         VALUE ZEROES.          
               10  HOLD-PCTBR-DEPT-NBR        PIC S9(04) COMP-3                 
                                                         VALUE ZEROES.          
      *                                                                         
           05  BVTBL-CUMULATIVE-VARS.                                           
               10  BVCUM-PREV-END-INV-RTL-AMT PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-PREV-END-INV-COST-AMT                                  
                                              PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-CURR-RCPT-RTL-AMT    PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-CURR-PADJ-RTL-AMT    PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-CURR-MKUP-RTL-AMT    PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-CURR-MKDN-RTL-AMT    PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-CURR-XFER-IN-RTL-AMT PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-CURR-XFER-OUT-RTL-AMT                                  
                                              PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-CURR-SLS-RTL-AMT     PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-CURR-INV-ADJ-RTL-AMT PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-CURR-SHNK-RTL-AMT    PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-CURR-END-INV-RTL-AMT PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-CURR-END-INV-COST-AMT                                  
                                              PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-CURR-SLS-COST-AMT    PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-CURR-GRO-MRGN-AMT    PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-CURR-RCPT-NET-COST-AMT                                 
                                              PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-CURR-PADJ-NET-COST-AMT                                 
                                              PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-SEAS-RCPT-RTL-AMT    PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-SEAS-RCPT-NET-COST-AMT                                 
                                              PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-SEAS-PADJ-RTL-AMT    PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-SEAS-PADJ-NET-COST-AMT                                 
                                              PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-SEAS-MKUP-RTL-AMT    PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-SEAS-XFER-IN-RTL-AMT PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-SEAS-XFER-OUT-RTL-AMT                                  
                                              PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-BEG-SEAS-INV-RTL-AMT PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-BEG-SEAS-INV-COST-AMT                                  
                                              PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-SHNK-RTL-AMT         PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-SHNK-SLS-RTL-AMT     PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-INV-COST-ADJ1        PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-INV-COST-ADJ2        PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-END-INV-COST-AMT1    PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-END-INV-COST-AMT2    PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-ADJ-GRO-MRGN-AMT     PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-SEAS-INV-COST-ADJ1   PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  BVCUM-SEAS-INV-COST-ADJ2   PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
      *                                                                         
           05  PV-CUMULATIVE-VARIABLES.                                         
               10  CUM-PRORATE-EIC-AMT        PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  CUM-PRORATE-EIC-AMT-WKLY                                     
                                              PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  CUM-PRORATE-EIC-AMT-BV                                       
                                              PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  CUM-PRORATE-GM-AMT         PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  CUM-PRORATE-GM-AMT-WKLY                                      
                                              PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  CUM-PRORATE-GM-AMT-BV                                        
                                              PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  CUM-PADJ-FOR-DPT           PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
      *                                                                         
           05  PV-ARITHMETIC-VARIABLES.                                         
               10  PV-PADJ-NET-COST-AMT-TOT                                     
                                              PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  PV-DEPT-PADJ-NET-COST-AMT-TOT                                
                                              PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  PV-PRORATE-EIC-PCT         PIC  9(03)V9(07) COMP-3           
                                                         VALUE ZEROES.          
               10  PV-EIC-UPDT-AMT            PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  PV-EIC-UPDT-AMT-EDIT       PIC  -9(11).9(2)                  
                                                         VALUE ZEROES.          
               10  PV-PRORATE-GM-PCT          PIC  9(03)V9(07) COMP-3           
                                                         VALUE ZEROES.          
               10  PV-GM-UPDT-AMT             PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
               10  PV-GM-UPDT-AMT-EDIT        PIC  -9(11).9(2)                  
                                                         VALUE ZEROES.          
                10 PV-END-INV-COST2-AMT       PIC  S9(11)V9(2) COMP-3           
                                                         VALUE ZEROES.          
      *                                                                         
           05  PV-REPORT-FIELDS.                                                
      *                                                                         
               10  PV-SPACE-LN              PIC X(133)   VALUE SPACES.          
      *                                                                         
               10  REPORT-TITLE-LINE.                                           
                   15  FILLER                PIC X(44)   VALUE SPACES.          
                   15  RTL-DESCRIPTION       PIC X(40)   VALUE SPACES.          
      *                                                                         
               10  PV-RPT-LINE1.                                                
                   15  FILLER               PIC X(06)    VALUE 'DEPT= '.        
                   15  PV-DPT-NO            PIC ZZ9(01)  VALUE ZEROES.          
                   15  FILLER               PIC X(05)    VALUE SPACES.          
                   15  FILLER               PIC X(14)    VALUE                  
                                              'EIC VARIANCE= '.                 
                   15  PV-EIC-VAR           PIC -9(11).9(2)                     
                                                         VALUE ZEROES.          
                   15  FILLER               PIC X(02)    VALUE SPACES.          
                   15  FILLER               PIC X(15)    VALUE                  
                                              'GM VARIANCE=   '.                
                   15  PV-GM-VAR            PIC -9(11).9(2)                     
                                                         VALUE ZEROES.          
                   15  FILLER               PIC X(02)    VALUE SPACES.          
                   15  FILLER               PIC X(17)    VALUE                  
                                            'DEPT TOTAL-PADJ= '.                
                   15  PV-PADJ-TOT          PIC -9(11).9(2)                     
                                                         VALUE SPACES.          
                   15  FILLER               PIC X(34)    VALUE SPACES.          
      *                                                                         
               10  PV-RPT-LINE2.                                                
                   15  FILLER               PIC X(28)    VALUE                  
                       'PARTN DPT   DKEY   MAJ   SUB'.                          
                   15  FILLER               PIC X(39)    VALUE                  
                       '   LOC        PADJ          UPDATED EIC'.               
                   15  FILLER               PIC X(39)    VALUE                  
                       '      UPDATED GM       TABLE INDICATORS'.               
                   15  FILLER               PIC X(27)    VALUE SPACES.          
      *                                                                         
               10  PV-RPT-LINE3.                                                
                   15  PV-DTL-PARTN-NBR     PIC 9(04)    VALUE ZEROES.          
                   15  FILLER               PIC X(02)    VALUE SPACES.          
                   15  PV-DTL-DPT-NO        PIC 9(04)    VALUE ZEROES.          
                   15  FILLER               PIC X(02)    VALUE SPACES.          
                   15  PV-DTL-DKEY          PIC 9(05)    VALUE ZEROES.          
                   15  FILLER               PIC X(02)    VALUE SPACES.          
                   15  PV-DTL-MAJ-CL-NBR    PIC 9(04)    VALUE ZEROES.          
                   15  FILLER               PIC X(02)    VALUE SPACES.          
                   15  PV-DTL-SUB-CL-NBR    PIC 9(04)    VALUE ZEROES.          
                   15  FILLER               PIC X(02)    VALUE SPACES.          
                   15  PV-DTL-LOC-NBR       PIC 9(04)    VALUE ZEROES.          
                   15  FILLER               PIC X(02)    VALUE SPACES.          
                   15  PV-ADJ-AMT           PIC -9(11).9(2)                     
                                                         VALUE ZEROES.          
                   15  FILLER               PIC X(02)    VALUE SPACES.          
                   15  PV-UPDATED-EIC       PIC -9(11).9(2)                     
                                                         VALUE ZEROES.          
                   15  FILLER               PIC X(02)    VALUE SPACES.          
                   15  PV-UPDATED-GM        PIC -9(11).9(2)                     
                                                         VALUE ZEROES.          
                   15  FILLER               PIC X(07)    VALUE SPACES.          
                   15  PV-TABLE-IND         PIC X(04)    VALUE SPACES.          
                   15  FILLER               PIC X(40)    VALUE SPACES.          
      *                                                                         
               10  PV-RPT-LINE4-DPT-TOTALS.                                     
                   15  FILLER               PIC X(12)    VALUE SPACES.          
                   15  FILLER               PIC X(23)    VALUE                  
                       'MONEY AMOUNT TOTALS   :'.                               
                   15  FILLER               PIC X(02)    VALUE SPACES.          
                   15  PV-DPT-PADJ-TOTALS   PIC -9(11).9(2)                     
                                                         VALUE ZEROES.          
                   15  FILLER               PIC X(02)    VALUE SPACES.          
                   15  PV-DPT-EIC-TOTALS    PIC -9(11).9(2)                     
                                                         VALUE ZEROES.          
                   15  FILLER               PIC X(02)    VALUE SPACES.          
                   15  PV-DPT-GM-TOTALS     PIC -9(11).9(2)                     
                                                         VALUE ZEROES.          
      *                                                                         
           05 PV-PVTB-HOLD-KEY-FIELDS.                                          
               10  PV-PVTB-FSCL-END-DTE     PIC X(10)    VALUE SPACES.          
               10  PV-PVTB-DEPT-NBR         PIC S9(4)    VALUE ZEROES           
                                                         COMP-3.                
               10  PV-PVTB-MAJ-CL-NBR       PIC S9(4)    VALUE ZEROES           
                                                         COMP-3.                
               10  PV-PVTB-SUB-CL-NBR       PIC S9(4)    VALUE ZEROES           
                                                         COMP-3.                
               10  PV-PVTB-LOC-NBR          PIC S9(4)    VALUE ZEROES           
                                                         COMP.                  
               10  PV-PVTB-ML-LWST-ID       PIC S9(9)    VALUE ZEROES           
                                                         COMP.                  
               10  PV-PARTN-NBR-WKLY        PIC S9(4)    VALUE ZEROES           
                                                         COMP.                  
               10  PV-PARTN-NBR-MNLY-BV     PIC S9(4)    VALUE ZEROES           
                                                         COMP.                  
               10  PV-CHECK-DKEY            PIC  S9(9)   VALUE ZEROES           
                                                         COMP.                  
      *                                                                         
      ******************************************************************        
      *    CONSTANTS ARE DECLARED HERE                                          
      ******************************************************************        
      *                                                                         
       01  PC-PROGRAM-CONSTANTS.                                                
           05  PC-PROGRAM-NAME             PIC  X(08)  VALUE 'MLKUP706'.        
           05  PC-JOB-NAME                 PIC  X(08)  VALUE 'MLK706  '.        
      *                                                                         
      ******************************************************************        
      *    PROGRAM SWITCHES ARE DECLARED HERE                                   
      ******************************************************************        
      *                                                                         
       01  PS-PROGRAM-SWITCHES.                                                 
           05  PS-PCTBR-FILE-EOF-SW          PIC X(01)   VALUE 'N'.             
               88  PS-PCTBR-FILE-EOF-NO                  VALUE 'N'.             
               88  PS-PCTBR-FILE-EOF-YES                 VALUE 'Y'.             
           05  PS-DR810-EIC-FILE-EOF-SW    PIC X(01)   VALUE 'N'.               
               88  PS-DR810-EIC-FILE-EOF-NO            VALUE 'N'.               
               88  PS-DR810-EIC-FILE-EOF-YES           VALUE 'Y'.               
           05  PS-WKLY-UPDT-INDICATOR      PIC X(01)   VALUE 'N'.               
               88  PS-WKLY-SUM-UPDATED-N               VALUE 'N'.               
               88  PS-WKLY-SUM-UPDATED-Y               VALUE 'Y'.               
           05  PS-BV-UPDT-INDICATOR        PIC X(01)   VALUE 'N'.               
               88  PS-BV-UPDATED-N                     VALUE 'N'.               
               88  PS-BV-UPDATED-Y                     VALUE 'Y'.               
           05  PS-EMPTY-INPUT-FILES        PIC X(01)   VALUE 'N'.               
               88  PS-EMPTY-INPUT-FILES-NO             VALUE 'N'.               
               88  PS-EMPTY-INPUT-FILES-YES            VALUE 'Y'.               
           05  PS-FIRST-COMMIT-SW          PIC X(01)   VALUE 'N'.               
               88  PS-FIRST-COMMIT-NO                  VALUE 'N'.               
               88  PS-FIRST-COMMIT-YES                 VALUE 'Y'.               
           05  PS-END-OF-PROCESSING        PIC X(01)   VALUE 'N'.               
               88  PS-END-OF-PROCESSING-NO             VALUE 'N'.               
               88  PS-END-OF-PROCESSING-YES            VALUE 'Y'.               
      *                                                                         
      ******************************************************************        
      *  DETAILED MERCH LEDGER UPDATE TRANSACTION                      *        
      ******************************************************************        
      *                                                                         
           COPY MLRD810 REPLACING ML810 BY DR810.                               
           COPY MLRD070 REPLACING ML070 BY BVTBL.                               
           COPY MLRD073 REPLACING DL070 BY PCTBR.                               
      *                                                                         
      *****************************************************************         
      * COPYBOOK - KOHL'S STANDARD 133 BYTE REPORT TITLE COPYBOOK               
      *****************************************************************         
           COPY DPWS133O.                                                       
                                                                                
      *****************************************************************         
      * COPYBOOK - KOHL'S STANDARD 30 BYTE REPORT TITLE COPYBOOK                
      *****************************************************************         
           COPY MLRD073.                                                        
                                                                                
      ******************************************************************        
      *    ABEND CODE DECLARATION                                      *        
      ******************************************************************        
       01  ABEND-CODE                      PIC S9(04)    VALUE +0               
                                                         COMP SYNC.             
      ******************************************************************        
      *    DCLGEN FOR MLT_DEPT_BRND_VND                                *        
      ******************************************************************        
      *                                                                         
           EXEC SQL                                                             
               INCLUDE MLT00010                                                 
           END-EXEC.                                                            
      *                                                                         
      ******************************************************************        
      *    DCLGEN FOR MLT_WKLY_SUM                                     *        
      ******************************************************************        
      *                                                                         
           EXEC SQL                                                             
               INCLUDE MLT00005                                                 
           END-EXEC.                                                            
      *                                                                         
      ******************************************************************        
      *    DCLGEN FOR MLT_MNLY_SUM                                     *        
      ******************************************************************        
      *                                                                         
           EXEC SQL                                                             
               INCLUDE MLT00004                                                 
           END-EXEC.                                                            
      *                                                                         
      ******************************************************************        
      *    DCLGEN FOR MLT_PARTN_CNTL                                   *        
      ******************************************************************        
      *                                                                         
           EXEC SQL                                                             
               INCLUDE MLT00003                                                 
           END-EXEC.                                                            
      *                                                                         
      ******************************************************************        
      *    DCLGEN FOR MLT_PARTN_BAL                                    *        
      ******************************************************************        
      *                                                                         
           EXEC SQL                                                             
               INCLUDE MLT00002                                                 
           END-EXEC.                                                            
      *                                                                         
      ******************************************************************        
      *    USED FOR SQL COMMUNICATION AREA.                            *        
      ******************************************************************        
      *                                                                         
           EXEC SQL                                                             
               INCLUDE SQLCA                                                    
           END-EXEC.                                                            
      *                                                                         
      ******************************************************************        
      *  DB2 ERROR MESSAGES FORMAT AREA.                               *        
      ******************************************************************        
      *                                                                         
           COPY DPWS004.                                                        
      *                                                                         
      ******************************************************************        
      * CHECKPOINT RESTART CONTROL AND INFORMATION TABLES              *        
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE TCKRSTCN                                                 
           END-EXEC.                                                            
      *                                                                         
           EXEC SQL                                                             
               INCLUDE TCKRSTIN                                                 
           END-EXEC.                                                            
      *                                                                         
      ******************************************************************        
      * CHECKPOINT RESTART VARIABLES                                   *        
      ******************************************************************        
       01  CR-CHECKPOINT-RESTART-AREA.                                          
           05  CR-AREA-LEN                      PIC S9(04)                      
                                                        VALUE +133 COMP.        
           05  CR-CHECKPOINT-RESTART-VAR.                                       
               10  CR-PROGRAM-VARIABLES.                                        
                   15  CR-COUNT-MNLY-UPDT-RECS  PIC  9(05) VALUE ZEROES.        
                   15  FILLER                   PIC  X(01) VALUE SPACES.        
                   15  CR-COUNT-WKLY-UPDT-RECS  PIC  9(05) VALUE ZEROES.        
                   15  FILLER                   PIC  X(01) VALUE SPACES.        
                   15  CR-COUNT-BV-UPDT-RECS    PIC  9(05) VALUE ZEROES.        
                   15  FILLER                   PIC  X(01) VALUE SPACES.        
                   15  CR-COUNT-BV-ISRT-RECS    PIC  9(05) VALUE ZEROES.        
                   15  FILLER                   PIC  X(01) VALUE SPACES.        
                   15  CR-COUNT-PRORATE-RPT-RECS                                
                                                PIC  9(05) VALUE ZEROES.        
                   15  FILLER                   PIC  X(01) VALUE SPACES.        
                   15  CR-COMMIT-COUNT          PIC  9(09) VALUE ZEROES.        
                   15  FILLER                   PIC  X(01) VALUE SPACES.        
                   15  CR-HOLD-PCTBR-SUB-CL-NBR PIC S9(04) COMP-3               
                                                           VALUE ZEROES.        
                   15  FILLER                   PIC  X(01) VALUE SPACES.        
                   15  CR-HOLD-PCTBR-MAJ-CL-NBR PIC S9(04) COMP-3               
                                                           VALUE ZEROES.        
                   15  FILLER                   PIC  X(01) VALUE SPACES.        
                   15  CR-HOLD-PCTBR-ML-LWST-ID PIC S9(09) COMP                 
                                                           VALUE ZEROES.        
                   15  FILLER                   PIC  X(01) VALUE SPACES.        
                   15  CR-HOLD-PCTBR-DEPT-NBR   PIC S9(04) COMP-3               
                                                           VALUE ZEROES.        
      *                                                                         
               10  FILLER                       PIC X(01)  VALUE SPACES.        
               10  CR-HOLD-PCTBR-LOC-NBR        PIC S9(4)  VALUE ZEROES         
                                                           COMP.                
               10  FILLER                       PIC X(01)  VALUE SPACES.        
               10  CR-DEPT-NBR-X                PIC X(03)  VALUE SPACES.        
               10  FILLER                       PIC X(01)  VALUE SPACES.        
               10  CR-HOLD-FSCL-END-DTE         PIC X(10)  VALUE SPACES.        
               10  FILLER                       PIC X(01)  VALUE SPACES.        
               10  CR-PARTN-NBR-WKLY            PIC S9(4)  VALUE ZEROES         
                                                           COMP.                
               10  FILLER                       PIC X(01)  VALUE SPACES.        
               10  CR-PARTN-NBR-MNLY-BV         PIC S9(4)  VALUE ZEROES         
                                                           COMP.                
               10  FILLER                       PIC X(01)  VALUE SPACES.        
               10  CR-CUMULATIVE-VARIABLES.                                     
                   15  CR-CUM-PRORATE-EIC-AMT   PIC  S9(11)V9(2) COMP-3         
                                                           VALUE ZEROES.        
                   15  CR-CUM-PRORATE-EIC-AMT-WKLY                              
                                                PIC  S9(11)V9(2) COMP-3         
                                                           VALUE ZEROES.        
                   15  CR-CUM-PRORATE-EIC-AMT-BV                                
                                                PIC  S9(11)V9(2) COMP-3         
                                                           VALUE ZEROES.        
                   15  CR-CUM-PRORATE-GM-AMT    PIC  S9(11)V9(2) COMP-3         
                                                           VALUE ZEROES.        
                   15  CR-CUM-PRORATE-GM-AMT-WKLY                               
                                                PIC  S9(11)V9(2) COMP-3         
                                                           VALUE ZEROES.        
                   15  CR-CUM-PRORATE-GM-AMT-BV                                 
                                                PIC  S9(11)V9(2) COMP-3         
                                                           VALUE ZEROES.        
                   15  CR-CUM-PADJ-FOR-DPT      PIC  S9(11)V9(2) COMP-3         
                                                         VALUE ZEROES.          
           EJECT.                                                               
      *                                                                         
      ******************************************************************        
       PROCEDURE DIVISION.                                                      
      ******************************************************************        
      *                                                                         
       0000-MAINLINE.                                                           
      *                                                                         
           PERFORM 1000-INITIALIZE.                                             
      *                                                                         
           PERFORM 2000-MAIN-PROCESS                                            
             UNTIL PS-DR810-EIC-FILE-EOF-YES                                    
                OR PS-PCTBR-FILE-EOF-YES                                        
      *                                                                         
           SET PS-END-OF-PROCESSING-YES     TO TRUE                             
           PERFORM 8000-END-OF-JOB.                                             
      *                                                                         
           STOP RUN.                                                            
      *                                                                         
      ******************************************************************        
      *  OPEN FILES AND DO FIRST READ,INITIALIZE COUNTERS                       
      ******************************************************************        
      *                                                                         
       1000-INITIALIZE.                                                         
      *                                                                         
           MOVE '1000-INITIALIZE'           TO PV-PARAGRAPH-NAME                
           OPEN INPUT  PCTBR-FILE                                               
                       DR810-EIC-GM-FILE                                        
           OPEN OUTPUT PRORATION-REPORT-FILE                                    
                       PRORATION-BVTBLE-FILE                                    
      *                                                                         
           SET PS-PCTBR-FILE-EOF-NO         TO TRUE                             
           SET PS-DR810-EIC-FILE-EOF-NO     TO TRUE                             
           SET PS-WKLY-SUM-UPDATED-N        TO TRUE                             
           SET PS-BV-UPDATED-N              TO TRUE                             
           SET PS-EMPTY-INPUT-FILES-NO      TO TRUE                             
           SET PS-FIRST-COMMIT-NO           TO TRUE                             
           SET PS-END-OF-PROCESSING-NO      TO TRUE                             
      *                                                                         
           INITIALIZE PV-PROGRAM-VARIBLES                                       
                      CR-CHECKPOINT-RESTART-VAR                                 
                      BVTBL-CUMULATIVE-VARS                                     
      *                                                                         
           PERFORM 7000-INIT-CHECKPOINT-SELECT                                  
      *                                                                         
           MOVE FUNCTION CURRENT-DATE (3:2)  TO DP133O-RUN-YEAR.                
           MOVE FUNCTION CURRENT-DATE (5:2)  TO DP133O-RUN-MONTH.               
           MOVE FUNCTION CURRENT-DATE (7:2)  TO DP133O-RUN-DAY.                 
           MOVE FUNCTION CURRENT-DATE (9:2)  TO DP133O-RUN-HOUR.                
           MOVE FUNCTION CURRENT-DATE (11:2) TO DP133O-RUN-MINUTE.              
           MOVE PC-PROGRAM-NAME              TO DP133O-PROGRAM-NAME.            
                                                                                
           MOVE '*******MLKUP706 PRORATION REPORT*******'                       
                                             TO RTL-DESCRIPTION                 
           MOVE 1                        TO DP133O-REPORT-NUMBER                
           IF TCKRSTCNTL-CKPT-STAT-CODE = '9'                                   
               PERFORM 7100-SELECT-RESTART-INFO                                 
               MOVE TCKRSTINF-WORK-STRG-DESC-TEXT                               
                                            TO CR-CHECKPOINT-RESTART-VAR        
               MOVE CR-HOLD-PCTBR-DEPT-NBR  TO PV-DEPT-NBR-UNPACK               
               MOVE PV-DEPT-NBR-UNPACK      TO PV-PCTBR-DPT-NUM                 
               MOVE PV-PCTBR-DPT-NUM        TO PV-PCTBR-DEPT-NBR-X              
               MOVE 'MLKUP706 PRORATION REPORT AFTER RESTART'                   
                                             TO RTL-DESCRIPTION                 
               MOVE 2                        TO DP133O-REPORT-NUMBER            
               DISPLAY 'RESTART-FROM DEPT COMMIT:'                              
                         CR-HOLD-PCTBR-DEPT-NBR                                 
               PERFORM 7700-POPULATE-PGM-FIELDS                                 
               PERFORM 8500-REPOS-TO-LAST-PROCESS                               
           ELSE                                                                 
               SET PS-FIRST-COMMIT-YES      TO TRUE                             
                                                                                
               DISPLAY 'COMMITS WILL BE TAKEN EVERY ',                          
                                 TCKRSTCNTL-CKPT-FRQNCY-QTY, ' SECONDS.'        
               PERFORM 7200-GET-COMMIT-TIMESTAMP                                
               PERFORM 1100-READ-DR810-EIC-FILE                                 
      *                                                                         
               PERFORM 1200-READ-PCTBR-FILE                                     
      *                                                                         
               IF PS-DR810-EIC-FILE-EOF-YES                                     
                   DISPLAY 'EMPTY DR810 EIC FILE                  '             
               END-IF                                                           
               IF PS-PCTBR-FILE-EOF-YES                                         
                   DISPLAY 'EMPTY PRORATION PERCENTAGE FILE        '            
               END-IF                                                           
               IF PS-DR810-EIC-FILE-EOF-YES OR                                  
                  PS-PCTBR-FILE-EOF-YES                                         
                   SET PS-EMPTY-INPUT-FILES-YES                                 
                                            TO TRUE                             
                   DISPLAY '******* NO PRORATION PERFORMED **********'          
               END-IF                                                           
           END-IF.                                                              
      *                                                                         
           MOVE PCTBR-SUB-CL-NBR            TO    HOLD-PCTBR-SUB-CL-NBR         
           MOVE PCTBR-MAJ-CL-NBR            TO    HOLD-PCTBR-MAJ-CL-NBR         
           MOVE PCTBR-ML-LWST-ID            TO    HOLD-PCTBR-ML-LWST-ID         
           MOVE PCTBR-DEPT-NBR              TO    HOLD-PCTBR-DEPT-NBR           
           .                                                                    
      *                                                                         
      ******************************************************************        
      * MAIN LOGIC                                                              
      ******************************************************************        
      *                                                                         
       2000-MAIN-PROCESS.                                                       
      *                                                                         
      *    IF BOTH FILES ARE SORTED                                             
      *                                                                         
           EVALUATE TRUE                                                        
               WHEN PV-PCTBR-DEPT-NBR-X < DR810-DEPT-NBR                        
      *                                                                         
                    PERFORM 1200-READ-PCTBR-FILE                                
                    MOVE PCTBR-SUB-CL-NBR   TO    HOLD-PCTBR-SUB-CL-NBR         
                    MOVE PCTBR-MAJ-CL-NBR   TO    HOLD-PCTBR-MAJ-CL-NBR         
                    MOVE PCTBR-ML-LWST-ID   TO    HOLD-PCTBR-ML-LWST-ID         
                    MOVE PCTBR-DEPT-NBR     TO    HOLD-PCTBR-DEPT-NBR           
      *                                                                         
               WHEN DR810-DEPT-NBR = PV-PCTBR-DEPT-NBR-X                        
      *                                                                         
                    IF  (DR810-VAR-END-INV-COST-AMT = ZERO AND                  
                         DR810-VAR-GRO-MRGN-AMT = ZERO)                         
                        PERFORM 1100-READ-DR810-EIC-FILE                        
                    ELSE                                                        
      *                                                                         
                        PERFORM 3800-FETCH-PARTN-NO-FOR-UPD                     
                        MOVE PV-PARTN-NBR-MNLY-BV    TO PV-DTL-PARTN-NBR        
                        PERFORM 6000-WRITE-DPT-HDR-LINES                        
      *                                                                         
                        PERFORM 2100-PRORATE-EIC-GM                             
                          UNTIL DR810-DEPT-NBR < PV-PCTBR-DEPT-NBR-X OR         
                                PS-PCTBR-FILE-EOF-YES                           
      *                                                                         
                        INITIALIZE PV-CUMULATIVE-VARIABLES                      
                                  PV-EIC-UPDT-AMT                               
                                  PV-GM-UPDT-AMT                                
                    END-IF                                                      
      *                                                                         
               WHEN DR810-DEPT-NBR < PV-PCTBR-DEPT-NBR-X                        
                    PERFORM 1100-READ-DR810-EIC-FILE                            
           END-EVALUATE                                                         
           .                                                                    
      *                                                                         
      ******************************************************************        
      *  CALCULATE PRORATION PERCENTAGES & AMTS FOR MATCHING DEPTS     *        
      ******************************************************************        
      *                                                                         
       2100-PRORATE-EIC-GM.                                                     
      *                                                                         
           MOVE PV-GM-UPDT-AMT              TO PV-GM-UPDT-AMT-EDIT              
           SET PS-WKLY-SUM-UPDATED-N        TO TRUE                             
           SET PS-BV-UPDATED-N              TO TRUE                             
      *                                                                         
           PERFORM 2200-POPULATE-BVTBL-LINES                                    
      *                                                                         
           PERFORM 2800-POPULATE-REPORT-LINES                                   
                                                                                
           MOVE PCTBR-PRORATE-PCT           TO PV-PRORATE-EIC-PCT               
                                                                                
           MOVE PCTBR-PRORATE-PCT           TO PV-PRORATE-GM-PCT                
                                                                                
           PERFORM 1200-READ-PCTBR-FILE                                         
      *                                                                         
           IF PS-PCTBR-FILE-EOF-YES                                             
              MOVE HIGH-VALUES              TO PV-PCTBR-DEPT-NBR-X              
           END-IF                                                               
      *                                                                         
           IF DR810-DEPT-NBR < PV-PCTBR-DEPT-NBR-X                              
               PERFORM 2700-CALC-LAST-REC-PREV-DPT                              
           ELSE                                                                 
               PERFORM 2500-COMPUTE-PCT-AMTS-AND-UPDT                           
           END-IF                                                               
      *                                                                         
           PERFORM 2600-WKLY-BV-CHECK-AND-UPDT                                  
      *                                                                         
           MOVE PCTBR-SUB-CL-NBR            TO    HOLD-PCTBR-SUB-CL-NBR         
           MOVE PCTBR-MAJ-CL-NBR            TO    HOLD-PCTBR-MAJ-CL-NBR         
           MOVE PCTBR-ML-LWST-ID            TO    HOLD-PCTBR-ML-LWST-ID         
           MOVE PCTBR-DEPT-NBR              TO    HOLD-PCTBR-DEPT-NBR           
      *                                                                         
           ADD PV-PADJ-NET-COST-AMT-TOT     TO CUM-PADJ-FOR-DPT                 
      *                                                                         
           PERFORM 5800-WRITE-UPDATE-DETAILS                                    
      *                                                                         
           IF DR810-DEPT-NBR < PV-PCTBR-DEPT-NBR-X                              
               PERFORM 6500-WRITE-DPT-TOTALS                                    
           END-IF                                                               
      *                                                                         
           PERFORM 7300-COMMIT-PROCESSING                                       
      *                                                                         
           .                                                                    
      *                                                                         
      ******************************************************************        
      *  POPULATE THE OUT02 LINES WITH THE PCTBR LINES                 *        
      ******************************************************************        
      *                                                                         
       2200-POPULATE-BVTBL-LINES.                                               
      *                                                                         
           MOVE ZEROES                      TO                                  
                BVTBL-TYPE                                                      
           MOVE ZEROES                      TO                                  
                BVTBL-PARTN-NBR                                                 
           MOVE SPACES                      TO                                  
                BVTBL-FSCL-PERIOD                                               
           MOVE PCTBR-FSCL-END-DTE          TO                                  
                BVTBL-FSCL-END-DTE                                              
           MOVE PCTBR-DEPT-NBR              TO                                  
                BVTBL-DEPT-NBR                                                  
           MOVE PCTBR-MAJ-CL-NBR            TO                                  
                BVTBL-MAJ-CL-NBR                                                
           MOVE PCTBR-SUB-CL-NBR            TO                                  
                BVTBL-SUB-CL-NBR                                                
           MOVE PCTBR-LOC-NBR               TO                                  
                BVTBL-LOC-NBR                                                   
           MOVE ZEROES                      TO                                  
                BVTBL-ENT-ID                                                    
           MOVE ZEROES                      TO                                  
                BVTBL-PARTN-GROUP                                               
           MOVE ZEROES                      TO                                  
                BVTBL-LBL-SEQ-NBR                                               
           MOVE PCTBR-ML-LWST-ID            TO                                  
                BVTBL-ML-LWST-ID                                                
           MOVE ZEROES                      TO                                  
                BVCUM-PREV-END-INV-RTL-AMT                                      
                BVCUM-PREV-END-INV-COST-AMT                                     
                BVCUM-CURR-RCPT-RTL-AMT                                         
                BVCUM-CURR-PADJ-RTL-AMT                                         
                BVCUM-CURR-PADJ-RTL-AMT                                         
                BVCUM-CURR-MKUP-RTL-AMT                                         
                BVCUM-CURR-MKDN-RTL-AMT                                         
                BVCUM-CURR-XFER-IN-RTL-AMT                                      
                BVCUM-CURR-XFER-OUT-RTL-AMT                                     
                BVCUM-CURR-SLS-RTL-AMT                                          
                BVCUM-CURR-INV-ADJ-RTL-AMT                                      
                BVCUM-CURR-SHNK-RTL-AMT                                         
                BVCUM-CURR-END-INV-RTL-AMT                                      
                BVCUM-CURR-END-INV-COST-AMT                                     
                BVCUM-CURR-SLS-COST-AMT                                         
                BVCUM-CURR-GRO-MRGN-AMT                                         
                BVCUM-CURR-RCPT-NET-COST-AMT                                    
                BVCUM-CURR-PADJ-NET-COST-AMT                                    
                BVCUM-SEAS-RCPT-RTL-AMT                                         
                BVCUM-SEAS-RCPT-NET-COST-AMT                                    
                BVCUM-SEAS-PADJ-RTL-AMT                                         
                BVCUM-SEAS-PADJ-NET-COST-AMT                                    
                BVCUM-SEAS-MKUP-RTL-AMT                                         
                BVCUM-SEAS-XFER-IN-RTL-AMT                                      
                BVCUM-SEAS-XFER-OUT-RTL-AMT                                     
                BVCUM-BEG-SEAS-INV-RTL-AMT                                      
                BVCUM-BEG-SEAS-INV-COST-AMT                                     
                BVCUM-SHNK-RTL-AMT                                              
                BVCUM-SHNK-SLS-RTL-AMT                                          
                BVCUM-INV-COST-ADJ1                                             
                BVCUM-INV-COST-ADJ2                                             
                BVCUM-END-INV-COST-AMT1                                         
                BVCUM-END-INV-COST-AMT2                                         
                BVCUM-ADJ-GRO-MRGN-AMT                                          
                BVCUM-SEAS-INV-COST-ADJ1                                        
                BVCUM-SEAS-INV-COST-ADJ2                                        
           MOVE BVCUM-PREV-END-INV-RTL-AMT  TO                                  
                BVTBL-PREV-END-INV-RTL-AMT                                      
           MOVE BVCUM-PREV-END-INV-COST-AMT TO                                  
                BVTBL-PREV-END-INV-COST-AMT                                     
           MOVE BVCUM-CURR-RCPT-RTL-AMT     TO                                  
                BVTBL-CURR-RCPT-RTL-AMT                                         
           MOVE BVCUM-CURR-PADJ-RTL-AMT     TO                                  
                BVTBL-CURR-PADJ-RTL-AMT                                         
           MOVE BVCUM-CURR-MKUP-RTL-AMT     TO                                  
                BVTBL-CURR-MKUP-RTL-AMT                                         
           MOVE BVCUM-CURR-MKDN-RTL-AMT     TO                                  
                BVTBL-CURR-MKDN-RTL-AMT                                         
           MOVE BVCUM-CURR-XFER-IN-RTL-AMT  TO                                  
                BVTBL-CURR-XFER-IN-RTL-AMT                                      
           MOVE BVCUM-CURR-XFER-OUT-RTL-AMT TO                                  
                BVTBL-CURR-XFER-OUT-RTL-AMT                                     
           MOVE BVCUM-CURR-SLS-RTL-AMT      TO                                  
                BVTBL-CURR-SLS-RTL-AMT                                          
           MOVE BVCUM-CURR-INV-ADJ-RTL-AMT  TO                                  
                BVTBL-CURR-INV-ADJ-RTL-AMT                                      
           MOVE BVCUM-CURR-SHNK-RTL-AMT     TO                                  
                BVTBL-CURR-SHNK-RTL-AMT                                         
           MOVE BVCUM-CURR-END-INV-RTL-AMT  TO                                  
                BVTBL-CURR-END-INV-RTL-AMT                                      
           MOVE ZEROES                      TO                                  
                BVTBL-CURR-CUM-MKUP-PCT                                         
           MOVE BVCUM-CURR-END-INV-COST-AMT TO                                  
                BVTBL-CURR-END-INV-COST-AMT                                     
           MOVE BVCUM-CURR-SLS-COST-AMT     TO                                  
                BVTBL-CURR-SLS-COST-AMT                                         
           MOVE BVCUM-CURR-GRO-MRGN-AMT     TO                                  
                BVTBL-CURR-GRO-MRGN-AMT                                         
           MOVE BVCUM-CURR-RCPT-NET-COST-AMT TO                                 
                BVTBL-CURR-RCPT-NET-COST-AMT                                    
           MOVE BVCUM-CURR-PADJ-NET-COST-AMT TO                                 
                BVTBL-CURR-PADJ-NET-COST-AMT                                    
           MOVE BVCUM-SEAS-RCPT-RTL-AMT     TO                                  
                BVTBL-SEAS-RCPT-RTL-AMT                                         
           MOVE BVCUM-SEAS-RCPT-NET-COST-AMT TO                                 
                BVTBL-SEAS-RCPT-NET-COST-AMT                                    
           MOVE BVCUM-SEAS-PADJ-RTL-AMT     TO                                  
                BVTBL-SEAS-PADJ-RTL-AMT                                         
           MOVE BVCUM-SEAS-PADJ-NET-COST-AMT TO                                 
                BVTBL-SEAS-PADJ-NET-COST-AMT                                    
           MOVE BVCUM-SEAS-MKUP-RTL-AMT     TO                                  
                BVTBL-SEAS-MKUP-RTL-AMT                                         
           MOVE BVCUM-SEAS-XFER-IN-RTL-AMT  TO                                  
                BVTBL-SEAS-XFER-IN-RTL-AMT                                      
           MOVE BVCUM-SEAS-XFER-OUT-RTL-AMT TO                                  
                BVTBL-SEAS-XFER-OUT-RTL-AMT                                     
           MOVE BVCUM-BEG-SEAS-INV-RTL-AMT  TO                                  
                BVTBL-BEG-SEAS-INV-RTL-AMT                                      
           MOVE BVCUM-BEG-SEAS-INV-COST-AMT TO                                  
                BVTBL-BEG-SEAS-INV-COST-AMT                                     
           MOVE BVCUM-SHNK-RTL-AMT          TO                                  
                BVTBL-SHNK-RTL-AMT                                              
           MOVE BVCUM-SHNK-SLS-RTL-AMT      TO                                  
                BVTBL-SHNK-SLS-RTL-AMT                                          
           MOVE BVCUM-INV-COST-ADJ1         TO                                  
                BVTBL-INV-COST-ADJ1                                             
           MOVE BVCUM-INV-COST-ADJ2         TO                                  
                BVTBL-INV-COST-ADJ2                                             
           MOVE BVCUM-END-INV-COST-AMT1     TO                                  
                BVTBL-END-INV-COST-AMT1                                         
           MOVE BVCUM-END-INV-COST-AMT2     TO                                  
                BVTBL-END-INV-COST-AMT2                                         
           MOVE ZEROES                      TO                                  
                BVTBL-OUTLYER-CANDI-IND                                         
           MOVE ZEROES                      TO                                  
                BVTBL-TGT-CUM-MKUP-PCT                                          
           MOVE BVCUM-ADJ-GRO-MRGN-AMT      TO                                  
                BVTBL-ADJ-GRO-MRGN-AMT                                          
           MOVE BVCUM-SEAS-INV-COST-ADJ1    TO                                  
                BVTBL-SEAS-INV-COST-ADJ1                                        
           MOVE BVCUM-SEAS-INV-COST-ADJ2    TO                                  
                BVTBL-SEAS-INV-COST-ADJ2                                        
           MOVE SPACES                      TO                                  
                BVTBL-SMOOTH-ID-AREA                                            
           .                                                                    
      *                                                                         
      ******************************************************************        
      *  COMPUTE AND UPDATE TO MNLY TABLES                             *        
      ******************************************************************        
      *                                                                         
       2500-COMPUTE-PCT-AMTS-AND-UPDT.                                          
      *                                                                         
           COMPUTE PV-EIC-UPDT-AMT =                                            
                    PV-PRORATE-EIC-PCT *                                        
                   DR810-VAR-END-INV-COST-AMT                                   
      *                                                                         
           ADD PV-EIC-UPDT-AMT              TO CUM-PRORATE-EIC-AMT              
           MOVE PV-EIC-UPDT-AMT             TO PV-UPDATED-EIC                   
      *                                                                         
                                                                                
           COMPUTE PV-GM-UPDT-AMT =                                             
                    PV-PRORATE-GM-PCT * DR810-VAR-GRO-MRGN-AMT                  
           ADD PV-GM-UPDT-AMT               TO CUM-PRORATE-GM-AMT               
           MOVE PV-GM-UPDT-AMT              TO PV-UPDATED-GM                    
                                                                                
      *                                                                         
           PERFORM 3000-SELECT-MNLY-SUM-TAB                                     
      *                                                                         
           .                                                                    
      *                                                                         
      ******************************************************************        
      *  COMPUTE AND UPDATE TO MNLY TABLES                             *        
      ******************************************************************        
      *                                                                         
       2600-WKLY-BV-CHECK-AND-UPDT.                                             
      *                                                                         
      *                                                                         
      * CALCULATE EIC PRORATION AMT FOR LAST RECORD TO UPDATE TO BV             
      * TABLE IF THERE IS CHANGE IN DKEY OR DEPT                                
      *                                                                         
           IF PCTBR-ML-LWST-ID NOT = HOLD-PCTBR-ML-LWST-ID OR                   
              PCTBR-DEPT-NBR NOT = HOLD-PCTBR-DEPT-NBR OR                       
              PS-PCTBR-FILE-EOF-YES                                             
      *                                                                         
      *  CALCULATE WKLY EIC PRORATION AMOUNT                                    
      *                                                                         
               COMPUTE PV-EIC-UPDT-AMT =                                        
                   CUM-PRORATE-EIC-AMT - CUM-PRORATE-EIC-AMT-WKLY               
               ADD PV-EIC-UPDT-AMT          TO CUM-PRORATE-EIC-AMT-WKLY         
      *                                                                         
               MOVE PV-EIC-UPDT-AMT         TO PV-EIC-UPDT-AMT-EDIT             
      *                                                                         
      *  CALCULATE WKLY GM PRORATION AMOUNT                                     
      *                                                                         
               COMPUTE PV-GM-UPDT-AMT =                                         
                 CUM-PRORATE-GM-AMT - CUM-PRORATE-GM-AMT-WKLY                   
               ADD PV-GM-UPDT-AMT           TO                                  
                     CUM-PRORATE-GM-AMT-WKLY                                    
      *                                                                         
               PERFORM 4000-SELECT-WKLY-SUM-TAB                                 
               MOVE PV-GM-UPDT-AMT          TO PV-GM-UPDT-AMT-EDIT              
      *                                                                         
      *  CALCULATE BV EIC PRORATION AMOUNT                                      
      *                                                                         
               COMPUTE PV-EIC-UPDT-AMT =                                        
                 CUM-PRORATE-EIC-AMT - CUM-PRORATE-EIC-AMT-BV                   
               ADD PV-EIC-UPDT-AMT          TO  CUM-PRORATE-EIC-AMT-BV          
                                                                                
               MOVE PV-EIC-UPDT-AMT         TO PV-EIC-UPDT-AMT-EDIT             
      *                                                                         
      *  CALCULATE BV GM PRORATION AMOUNT                                       
      *                                                                         
               COMPUTE PV-GM-UPDT-AMT =                                         
                  CUM-PRORATE-GM-AMT - CUM-PRORATE-GM-AMT-BV                    
               ADD PV-GM-UPDT-AMT           TO CUM-PRORATE-GM-AMT-BV            
      *                                                                         
               PERFORM 4500-SELECT-BV-TAB                                       
               MOVE PV-GM-UPDT-AMT          TO PV-GM-UPDT-AMT-EDIT              
      *                                                                         
           ELSE                                                                 
               IF (PCTBR-MAJ-CL-NBR NOT = HOLD-PCTBR-MAJ-CL-NBR OR              
                   PCTBR-SUB-CL-NBR NOT = HOLD-PCTBR-SUB-CL-NBR)                
      *                                                                         
      *  CALCULATE WKLY EIC PRORATION AMOUNT                                    
      *                                                                         
                   COMPUTE PV-EIC-UPDT-AMT =                                    
                      CUM-PRORATE-EIC-AMT - CUM-PRORATE-EIC-AMT-WKLY            
                   ADD PV-EIC-UPDT-AMT      TO                                  
                               CUM-PRORATE-EIC-AMT-WKLY                         
      *                                                                         
                   MOVE PV-EIC-UPDT-AMT      TO PV-EIC-UPDT-AMT-EDIT            
      *                                                                         
      *  CALCULATE WKLY GM PRORATION AMOUNT                                     
      *                                                                         
                   COMPUTE PV-GM-UPDT-AMT =                                     
                      CUM-PRORATE-GM-AMT - CUM-PRORATE-GM-AMT-WKLY              
                   ADD PV-GM-UPDT-AMT       TO                                  
                      CUM-PRORATE-GM-AMT-WKLY                                   
      *                                                                         
                   PERFORM 4000-SELECT-WKLY-SUM-TAB                             
                   MOVE PV-GM-UPDT-AMT      TO PV-GM-UPDT-AMT-EDIT              
      *                                                                         
               END-IF                                                           
           END-IF                                                               
           .                                                                    
      *                                                                         
      ******************************************************************        
      *  COMPUTE AND UPDATE TO MNLY TABLES FOR THE LAST RECORD         *        
      ******************************************************************        
      *                                                                         
       2700-CALC-LAST-REC-PREV-DPT.                                             
      *                                                                         
           COMPUTE PV-EIC-UPDT-AMT =                                            
               DR810-VAR-END-INV-COST-AMT - CUM-PRORATE-EIC-AMT                 
      *                                                                         
           ADD PV-EIC-UPDT-AMT              TO CUM-PRORATE-EIC-AMT              
           MOVE PV-EIC-UPDT-AMT             TO PV-UPDATED-EIC                   
      *                                                                         
           COMPUTE PV-GM-UPDT-AMT =                                             
               DR810-VAR-GRO-MRGN-AMT - CUM-PRORATE-GM-AMT                      
      *                                                                         
           ADD PV-GM-UPDT-AMT               TO CUM-PRORATE-GM-AMT               
           MOVE PV-GM-UPDT-AMT              TO PV-UPDATED-GM                    
      *                                                                         
           PERFORM 3000-SELECT-MNLY-SUM-TAB                                     
           .                                                                    
      *                                                                         
      ******************************************************************        
      *  COMPUTE AND UPDATE TO MNLY TABLES FOR THE LAST RECORD         *        
      ******************************************************************        
      *                                                                         
       2800-POPULATE-REPORT-LINES.                                              
      *                                                                         
      * POPULATE LINE3                                                          
      *                                                                         
           MOVE PV-PCTBR-DEPT-NBR-X         TO   PV-DTL-DPT-NO                  
                                                 PV-PVTB-DEPT-NBR               
           MOVE PCTBR-ML-LWST-ID            TO   PV-DTL-DKEY                    
                                                 PV-PVTB-ML-LWST-ID             
           MOVE PCTBR-MAJ-CL-NBR            TO   PV-DTL-MAJ-CL-NBR              
                                                 PV-PVTB-MAJ-CL-NBR             
           MOVE PCTBR-SUB-CL-NBR            TO   PV-DTL-SUB-CL-NBR              
                                                 PV-PVTB-SUB-CL-NBR             
           MOVE PCTBR-LOC-NBR               TO   PV-DTL-LOC-NBR                 
                                                 PV-PVTB-LOC-NBR                
           MOVE PV-PADJ-NET-COST-AMT-TOT    TO   PV-ADJ-AMT                     
           MOVE PV-EIC-UPDT-AMT             TO   PV-UPDATED-EIC                 
           MOVE PV-GM-UPDT-AMT              TO   PV-UPDATED-GM                  
      *                                                                         
           MOVE PCTBR-FSCL-END-DTE          TO   PV-PVTB-FSCL-END-DTE           
           .                                                                    
      *                                                                         
      ******************************************************************        
      *   UPDATES PRORATED EIC & GROSS MARGIN AMT IN MNLY_SUM_TABLE    *        
      ******************************************************************        
                                                                                
       3000-SELECT-MNLY-SUM-TAB.                                                
           EXEC SQL                                                             
               SELECT END_INV_COST2_AMT                                         
                    INTO :PV-END-INV-COST2-AMT                                  
               FROM MLT_MNLY_SUM                                                
               WHERE PARTN_NBR   = :PV-PARTN-NBR-MNLY-BV                        
                    AND DEPT_NBR    = :PV-PVTB-DEPT-NBR                         
                    AND MAJ_CL_NBR  = :PV-PVTB-MAJ-CL-NBR                       
                    AND SUB_CL_NBR  = :PV-PVTB-SUB-CL-NBR                       
                    AND LOC_NBR     = :PV-PVTB-LOC-NBR                          
                    AND ML_LO_MDSE_LVL_ID = :PV-PVTB-ML-LWST-ID                 
                    AND FSCL_MN_END_DTE = :DR810-FSCL-MN-END-DTE                
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = 0                                                 
                    PERFORM 3200-UPDT-EIC-GM-MNLY-SUM-TAB                       
               WHEN SQLCODE = +100                                              
                    PERFORM 3500-INSR-EIC-GM-MNLY-SUM-TAB                       
               WHEN OTHER                                                       
                    DISPLAY '*----------------------------------------*'        
                    DISPLAY '* ABEND OCCURED ON KEY : '                         
                    DISPLAY '*----------------------------------------*'        
                    DISPLAY '* PARTN_NBR        =' PV-PARTN-NBR-MNLY-BV         
                    DISPLAY '* DEPT_NBR         =' PV-PVTB-DEPT-NBR             
                    DISPLAY '* MAJ_CL_NBR         =' PV-PVTB-MAJ-CL-NBR         
                    DISPLAY '* SUB_CL_NBR       =' PV-PVTB-SUB-CL-NBR           
                    DISPLAY '* LOC_NBR          =' PV-PVTB-LOC-NBR              
                    DISPLAY '* ML_LO_MDSE_LVL_ID =' PV-PVTB-ML-LWST-ID          
                    DISPLAY '* FSCL_MN_END_DTE  =' DR810-FSCL-MN-END-DTE        
                    DISPLAY '*----------------------------------------*'        
                                                                                
                    MOVE '3000-SELECT-MNLY-SUM-TAB'                             
                                            TO PV-PARAGRAPH-NAME                
                    MOVE 'ERROR IN SELECT OF MLT_MNLY_SUM TABLE'                
                                            TO PV-OPER-ATTEMPTED                
                    PERFORM 9000-SQL-ABEND                                      
           END-EVALUATE                                                         
           .                                                                    
                                                                                
       3200-UPDT-EIC-GM-MNLY-SUM-TAB.                                           
                                                                                
            EXEC SQL                                                            
               UPDATE MLT_MNLY_SUM                                              
                  SET END_INV_COST2_AMT = :PV-EIC-UPDT-AMT,                     
                      ADJ_GRO_MRGN_AMT = :PV-GM-UPDT-AMT,                       
                      SHNK_RTL_AMT = 0                                          
                WHERE PARTN_NBR   = :PV-PARTN-NBR-MNLY-BV                       
                  AND DEPT_NBR    = :PV-PVTB-DEPT-NBR                           
                  AND MAJ_CL_NBR  = :PV-PVTB-MAJ-CL-NBR                         
                  AND SUB_CL_NBR  = :PV-PVTB-SUB-CL-NBR                         
                  AND LOC_NBR     = :PV-PVTB-LOC-NBR                            
                  AND ML_LO_MDSE_LVL_ID = :PV-PVTB-ML-LWST-ID                   
                  AND FSCL_MN_END_DTE = :DR810-FSCL-MN-END-DTE                  
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = 0                                                 
                    ADD  1                  TO PA-COUNT-MNLY-UPDT-RECS          
               WHEN SQLCODE NOT EQUAL ZERO                                      
                    DISPLAY '*----------------------------------------*'        
                    DISPLAY '* ABEND OCCURED ON KEY : '                         
                    DISPLAY '*----------------------------------------*'        
                    DISPLAY '* PARTN_NBR        =' PV-PARTN-NBR-MNLY-BV         
                    DISPLAY '* DEPT_NBR         =' PV-PVTB-DEPT-NBR             
                    DISPLAY '* MAJ_CL_NBR       =' PV-PVTB-MAJ-CL-NBR           
                    DISPLAY '* SUB_CL_NBR       =' PV-PVTB-SUB-CL-NBR           
                    DISPLAY '* LOC_NBR          =' PV-PVTB-LOC-NBR              
                    DISPLAY '* ML_LO_MDSE_LVL_ID=' PV-PVTB-ML-LWST-ID           
                    DISPLAY '* FSCL_MN_END_DTE  =' DR810-FSCL-MN-END-DTE        
                    DISPLAY '*----------------------------------------*'        
      *                                                                         
                    MOVE '3200-UPDT-EIC-GM-MNLY-SUM-TAB'                        
                                            TO PV-PARAGRAPH-NAME                
                    MOVE 'ERROR IN UPDT OF EIC & GM- MNLYSUM '                  
                                            TO PV-OPER-ATTEMPTED                
                    PERFORM 9000-SQL-ABEND                                      
           END-EVALUATE                                                         
           .                                                                    
                                                                                
       3500-INSR-EIC-GM-MNLY-SUM-TAB.                                           
           INITIALIZE DCLMLT00004.                                              
           MOVE PV-PARTN-NBR-MNLY-BV    TO MLT00004-PARTN-NBR.                  
           MOVE PV-PVTB-DEPT-NBR        TO MLT00004-DEPT-NBR.                   
           MOVE PV-PVTB-MAJ-CL-NBR      TO MLT00004-MAJ-CL-NBR.                 
           MOVE PV-PVTB-SUB-CL-NBR      TO MLT00004-SUB-CL-NBR.                 
           MOVE PV-PVTB-LOC-NBR         TO MLT00004-LOC-NBR.                    
           MOVE PV-PVTB-ML-LWST-ID      TO MLT00004-ML-LO-MDSE-LVL-ID.          
           MOVE DR810-FSCL-MN-END-DTE   TO MLT00004-FSCL-MN-END-DTE.            
           MOVE PV-EIC-UPDT-AMT         TO MLT00004-END-INV-COST2-AMT.          
           MOVE PV-GM-UPDT-AMT          TO MLT00004-ADJ-GRO-MRGN-AMT            
                                                                                
           EXEC SQL                                                             
               INSERT INTO MLT_MNLY_SUM                                         
                    (PARTN_NBR                                                  
                     ,DEPT_NBR                                                  
                     ,MAJ_CL_NBR                                                
                     ,SUB_CL_NBR                                                
                     ,LOC_NBR                                                   
                     ,ML_LO_MDSE_LVL_ID                                         
                     ,FSCL_MN_END_DTE                                           
                     ,SLS_REG_RTL_AMT                                           
                     ,SLS_PROMO_RTL_AMT                                         
                     ,SLS_PROCLR_RTL_AMT                                        
                     ,SLS_CLR_RTL_AMT                                           
                     ,SLS_OTH_RTL_AMT                                           
                     ,MKDN_PLU_RTL_AMT                                          
                     ,MKDN_PROMO_RTL_AMT                                        
                     ,MKDN_RGST_RTL_AMT                                         
                     ,MKDN_GLDST_RTL_AMT                                        
                     ,MKDN_UMTCH_RTL_AMT                                        
                     ,MKDN_BYR_RTL_AMT                                          
                     ,MKDN_STR_RTL_AMT                                          
                     ,MKDN_PRPT_RTL_AMT                                         
                     ,MKDN_OTH_RTL_AMT                                          
                     ,MKDN_RTL_AMT                                              
                     ,MKUP_RTL_AMT                                              
                     ,XFER_IN_RTL_AMT                                           
                     ,XFER_OUT_RTL_AMT                                          
                     ,RCPT_RTL_AMT                                              
                     ,RCPT_NET_COST_AMT                                         
                     ,RCPT_GRO_COST_AMT                                         
                     ,PADJ_RTL_AMT                                              
                     ,PADJ_FRGT_COST_AMT                                        
                     ,PADJ_DISC_COST_AMT                                        
                     ,PADJ_RTV_COST_AMT                                         
                     ,PADJ_RTV_RTL_AMT                                          
                     ,PADJ_DA_COST_AMT                                          
                     ,PADJ_DA_RTL_AMT                                           
                     ,PADJ_NET_COST_AMT                                         
                     ,PADJ_OTH_COST_AMT                                         
                     ,PADJ_OTH_RTL_AMT                                          
                     ,DR_ALW_RTL_AMT                                            
                     ,RTV_RTL_AMT                                               
                     ,MKUP_INIT_AMT                                             
                     ,MKUP_NET_AMT                                              
                     ,INV_ADJ_RTL_AMT                                           
                     ,ONORD_RTL_AMT                                             
                     ,ONORD_COST_AMT                                            
                     ,SHNK_RTL_AMT                                              
                     ,END_INV_RTL_AMT                                           
                     ,END_INV_COST_AMT                                          
                     ,KNW_THFT_RTL_AMT                                          
                     ,INV_COST_ADJ1_AMT                                         
                     ,INV_COST_ADJ2_AMT                                         
                     ,END_INV_COST1_AMT                                         
                     ,END_INV_COST2_AMT                                         
                     ,ADJ_GRO_MRGN_AMT)                                         
               VALUES (                                                         
                      :MLT00004-PARTN-NBR                                       
                     ,:MLT00004-DEPT-NBR                                        
                     ,:MLT00004-MAJ-CL-NBR                                      
                     ,:MLT00004-SUB-CL-NBR                                      
                     ,:MLT00004-LOC-NBR                                         
                     ,:MLT00004-ML-LO-MDSE-LVL-ID                               
                     ,:MLT00004-FSCL-MN-END-DTE                                 
                     ,:MLT00004-SLS-REG-RTL-AMT                                 
                     ,:MLT00004-SLS-PROMO-RTL-AMT                               
                     ,:MLT00004-SLS-PROCLR-RTL-AMT                              
                     ,:MLT00004-SLS-CLR-RTL-AMT                                 
                     ,:MLT00004-SLS-OTH-RTL-AMT                                 
                     ,:MLT00004-MKDN-PLU-RTL-AMT                                
                     ,:MLT00004-MKDN-PROMO-RTL-AMT                              
                     ,:MLT00004-MKDN-RGST-RTL-AMT                               
                     ,:MLT00004-MKDN-GLDST-RTL-AMT                              
                     ,:MLT00004-MKDN-UMTCH-RTL-AMT                              
                     ,:MLT00004-MKDN-BYR-RTL-AMT                                
                     ,:MLT00004-MKDN-STR-RTL-AMT                                
                     ,:MLT00004-MKDN-PRPT-RTL-AMT                               
                     ,:MLT00004-MKDN-OTH-RTL-AMT                                
                     ,:MLT00004-MKDN-RTL-AMT                                    
                     ,:MLT00004-MKUP-RTL-AMT                                    
                     ,:MLT00004-XFER-IN-RTL-AMT                                 
                     ,:MLT00004-XFER-OUT-RTL-AMT                                
                     ,:MLT00004-RCPT-RTL-AMT                                    
                     ,:MLT00004-RCPT-NET-COST-AMT                               
                     ,:MLT00004-RCPT-GRO-COST-AMT                               
                     ,:MLT00004-PADJ-RTL-AMT                                    
                     ,:MLT00004-PADJ-FRGT-COST-AMT                              
                     ,:MLT00004-PADJ-DISC-COST-AMT                              
                     ,:MLT00004-PADJ-RTV-COST-AMT                               
                     ,:MLT00004-PADJ-RTV-RTL-AMT                                
                     ,:MLT00004-PADJ-DA-COST-AMT                                
                     ,:MLT00004-PADJ-DA-RTL-AMT                                 
                     ,:MLT00004-PADJ-NET-COST-AMT                               
                     ,:MLT00004-PADJ-OTH-COST-AMT                               
                     ,:MLT00004-PADJ-OTH-RTL-AMT                                
                     ,:MLT00004-DR-ALW-RTL-AMT                                  
                     ,:MLT00004-RTV-RTL-AMT                                     
                     ,:MLT00004-MKUP-INIT-AMT                                   
                     ,:MLT00004-MKUP-NET-AMT                                    
                     ,:MLT00004-INV-ADJ-RTL-AMT                                 
                     ,:MLT00004-ONORD-RTL-AMT                                   
                     ,:MLT00004-ONORD-COST-AMT                                  
                     ,:MLT00004-SHNK-RTL-AMT                                    
                     ,:MLT00004-END-INV-RTL-AMT                                 
                     ,:MLT00004-END-INV-COST-AMT                                
                     ,:MLT00004-KNW-THFT-RTL-AMT                                
                     ,:MLT00004-INV-COST-ADJ1-AMT                               
                     ,:MLT00004-INV-COST-ADJ2-AMT                               
                     ,:MLT00004-END-INV-COST1-AMT                               
                     ,:MLT00004-END-INV-COST2-AMT                               
                     ,:MLT00004-ADJ-GRO-MRGN-AMT )                              
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = 0                                                 
                    ADD  1                  TO PA-COUNT-MNLY-UPDT-RECS          
               WHEN SQLCODE = -803                                              
                    ADD  1                  TO PA-COUNT-MNLY-UPDT-RECS          
               WHEN SQLCODE NOT EQUAL ZERO                                      
                    DISPLAY '*----------------------------------------*'        
                    DISPLAY '* ABEND OCCURED ON KEY : '                         
                    DISPLAY '*----------------------------------------*'        
                    DISPLAY '* PARTN_NBR        =' PV-PARTN-NBR-MNLY-BV         
                    DISPLAY '* DEPT_NBR         =' PV-PVTB-DEPT-NBR             
                    DISPLAY '* MAJ_CL_NBR       =' PV-PVTB-MAJ-CL-NBR           
                    DISPLAY '* SUB_CL_NBR       =' PV-PVTB-SUB-CL-NBR           
                    DISPLAY '* LOC_NBR          =' PV-PVTB-LOC-NBR              
                    DISPLAY '* ML_LO_MDSE_LVL_ID=' PV-PVTB-ML-LWST-ID           
                    DISPLAY '* FSCL_MN_END_DTE  =' DR810-FSCL-MN-END-DTE        
                    DISPLAY '*----------------------------------------*'        
      *                                                                         
                    MOVE '3500-INSR-EIC-GM-MNLY-SUM-TAB'                        
                                            TO PV-PARAGRAPH-NAME                
                    MOVE 'ERROR IN INSERT OF MNLYSUM TABLE'                     
                                            TO PV-OPER-ATTEMPTED                
                    PERFORM 9000-SQL-ABEND                                      
           END-EVALUATE                                                         
           .                                                                    
      *                                                                         
      ******************************************************************        
      *   FIND PARTITION NO: FOR THE CURRENT DEPT FOR MNLY-BV AND WKLY *        
      ******************************************************************        
      *                                                                         
       3800-FETCH-PARTN-NO-FOR-UPD.                                             
      *                                                                         
           MOVE DR810-DEPT-NBR                                                  
             TO PA-NUMERIC-810-DEPT-NUM.                                        
      *                                                                         
           EXEC SQL                                                             
               SELECT DISTINCT PARTN_NBR                                        
                    INTO :PV-PARTN-NBR-MNLY-BV                                  
               FROM MLT_PARTN_CNTL A,                                           
                    MLT_PARTN_BAL B                                             
               WHERE A.TBL_TM_LVL_CDE = 'M'                                     
                 AND A.FSCL_DTE = :DR810-FSCL-MN-END-DTE                        
                 AND B.DEPT_NBR = :PA-NUMERIC-810-DEPT-NUM                      
                 AND :DR810-FSCL-MN-END-DTE >= B.EFF_BEG_DTE                    
                 AND :DR810-FSCL-MN-END-DTE <= B.EFF_END_DTE                    
                 AND A.TBL_TM_LVL_CDE = B.TBL_TM_LVL_CDE                        
                 AND A.DEPT_GP_CDE = B.DEPT_GP_CDE                              
           END-EXEC.                                                            
      *                                                                         
           EVALUATE TRUE                                                        
               WHEN SQLCODE = 0                                                 
                    CONTINUE                                                    
               WHEN SQLCODE NOT EQUAL ZERO                                      
                    DISPLAY '*----------------------------------------*'        
                    DISPLAY '* ABEND OCCURED ON BELOW SELECT FIELDS   *'        
                    DISPLAY '*----------------------------------------*'        
                    DISPLAY '* 810 DEPT NBR     =' DR810-FSCL-MN-END-DTE        
                    DISPLAY '* DEPT_NBR         ='                              
                                          PA-NUMERIC-810-DEPT-NUM               
                    DISPLAY '*----------------------------------------*'        
      *                                                                         
                    MOVE '3800-FETCH-PARTN-NO-FOR-UPD       '                   
                                            TO PV-PARAGRAPH-NAME                
                    MOVE 'ERROR IN PART NO FETCH FOR MNLY-BV UPDATE'            
                                            TO PV-OPER-ATTEMPTED                
                    PERFORM 9000-SQL-ABEND                                      
           END-EVALUATE                                                         
      *                                                                         
           EXEC SQL                                                             
               SELECT DISTINCT PARTN_NBR                                        
                 INTO :PV-PARTN-NBR-WKLY                                        
               FROM MLT_PARTN_CNTL A,                                           
                    MLT_PARTN_BAL B                                             
               WHERE A.TBL_TM_LVL_CDE = 'W'                                     
                 AND A.FSCL_DTE = :DR810-FSCL-MN-END-DTE                        
                 AND B.DEPT_NBR = :PA-NUMERIC-810-DEPT-NUM                      
                 AND :DR810-FSCL-MN-END-DTE >= B.EFF_BEG_DTE                    
                 AND :DR810-FSCL-MN-END-DTE <= B.EFF_END_DTE                    
                 AND A.TBL_TM_LVL_CDE = B.TBL_TM_LVL_CDE                        
                 AND A.DEPT_GP_CDE = B.DEPT_GP_CDE                              
           END-EXEC.                                                            
      *                                                                         
           EVALUATE TRUE                                                        
               WHEN SQLCODE = 0                                                 
                    CONTINUE                                                    
               WHEN SQLCODE NOT EQUAL ZERO                                      
                    DISPLAY '*----------------------------------------*'        
                    DISPLAY '* ABEND OCCURED ON BELOW SELECT FIELDS   *'        
                    DISPLAY '*----------------------------------------*'        
                    DISPLAY '* 810 DEPT NBR     =' DR810-FSCL-MN-END-DTE        
                    DISPLAY '* DEPT_NBR         ='                              
                                          PA-NUMERIC-810-DEPT-NUM               
                    DISPLAY '*----------------------------------------*'        
                    MOVE '3800-FETCH-PARTN-NO-FOR-UPD       '                   
                                            TO PV-PARAGRAPH-NAME                
                    MOVE 'ERROR IN PART NO FETCH FOR WKLY UPDATE'               
                                            TO PV-OPER-ATTEMPTED                
                    PERFORM 9000-SQL-ABEND                                      
           END-EVALUATE                                                         
      *                                                                         
           .                                                                    
      *                                                                         
      ******************************************************************        
      *   UPDATES PRORATED EIC & GROSS MARGIN AMT IN WKLY_SUM_TABLE    *        
      ******************************************************************        
      *                                                                         
       4000-SELECT-WKLY-SUM-TAB.                                                
                                                                                
           EXEC SQL                                                             
               SELECT END_INV_COST2_AMT                                         
                    INTO :PV-END-INV-COST2-AMT                                  
               FROM MLT_WKLY_SUM                                                
               WHERE PARTN_NBR = :PV-PARTN-NBR-WKLY                             
                 AND DEPT_NBR = :PV-PVTB-DEPT-NBR                               
                 AND MAJ_CL_NBR = :PV-PVTB-MAJ-CL-NBR                           
                 AND SUB_CL_NBR = :PV-PVTB-SUB-CL-NBR                           
W37965           AND LOC_NBR     = :PV-PVTB-LOC-NBR                             
                 AND ML_LO_MDSE_LVL_ID = :PV-PVTB-ML-LWST-ID                    
                 AND FSCL_WK_END_DTE = :DR810-FSCL-MN-END-DTE                   
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = 0                                                 
                    PERFORM 4200-UPDT-EIC-GM-WKLY-SUM-TAB                       
               WHEN SQLCODE = +100                                              
                    PERFORM 4500-INSR-EIC-GM-WKLY-SUM-TAB                       
               WHEN OTHER                                                       
                    DISPLAY '*----------------------------------------*'        
                    DISPLAY '* ABEND OCCURED ON KEY : '                         
                    DISPLAY '*----------------------------------------*'        
                    DISPLAY '* PARTN_NBR        =' PV-PARTN-NBR-WKLY            
                    DISPLAY '* DEPT_NBR         =' PV-PVTB-DEPT-NBR             
                    DISPLAY '* MAJ_CL_NBR         =' PV-PVTB-MAJ-CL-NBR         
                    DISPLAY '* SUB_CL_NBR       =' PV-PVTB-SUB-CL-NBR           
                    DISPLAY '* ML_LO_MDSE_LVL_ID =' PV-PVTB-ML-LWST-ID          
                    DISPLAY '* FSCL_MN_END_DTE  =' DR810-FSCL-MN-END-DTE        
                    DISPLAY '*----------------------------------------*'        
                                                                                
                   MOVE '4000-SELECT-WKLY-SUM-TAB'                              
                                            TO PV-PARAGRAPH-NAME                
                   MOVE 'ERROR IN SELECT OF MLT_WKLY_SUM TABLE'                 
                                            TO PV-OPER-ATTEMPTED                
                   PERFORM 9000-SQL-ABEND                                       
           END-EVALUATE                                                         
           .                                                                    
                                                                                
       4200-UPDT-EIC-GM-WKLY-SUM-TAB.                                           
      *                                                                         
           EXEC SQL                                                             
               UPDATE MLT_WKLY_SUM                                              
                 SET END_INV_COST2_AMT = :PV-EIC-UPDT-AMT,                      
                     ADJ_GRO_MRGN_AMT = :PV-GM-UPDT-AMT,                        
                     SHNK_RTL_AMT = 0                                           
                  WHERE PARTN_NBR = :PV-PARTN-NBR-WKLY                          
                    AND DEPT_NBR = :PV-PVTB-DEPT-NBR                            
                    AND MAJ_CL_NBR = :PV-PVTB-MAJ-CL-NBR                        
                    AND SUB_CL_NBR = :PV-PVTB-SUB-CL-NBR                        
W37965              AND LOC_NBR     = :PV-PVTB-LOC-NBR                          
                    AND ML_LO_MDSE_LVL_ID = :PV-PVTB-ML-LWST-ID                 
                    AND FSCL_WK_END_DTE = :DR810-FSCL-MN-END-DTE                
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = 0                                                 
                    ADD  1                  TO PA-COUNT-WKLY-UPDT-RECS          
                    SET PS-WKLY-SUM-UPDATED-Y TO TRUE                           
               WHEN SQLCODE NOT EQUAL ZERO                                      
                    DISPLAY '*----------------------------------------*'        
                    DISPLAY '* ABEND OCCURED ON KEY : '                         
                    DISPLAY '*----------------------------------------*'        
                    DISPLAY '* PARTN_NBR        =' PV-PARTN-NBR-WKLY            
                    DISPLAY '* DEPT_NBR         =' PV-PVTB-DEPT-NBR             
                    DISPLAY '* MAJ_CL_NBR       =' PV-PVTB-MAJ-CL-NBR           
                    DISPLAY '* SUB_CL_NBR       =' PV-PVTB-SUB-CL-NBR           
                    DISPLAY '* ML_LO_MDSE_LVL_ID=' PV-PVTB-ML-LWST-ID           
                    DISPLAY '* FSCL_MN_END_DTE  =' DR810-FSCL-MN-END-DTE        
                    DISPLAY '*----------------------------------------*'        
      *                                                                         
                    MOVE '4200-UPDT-EIC-GM-WKLY-SUM-TAB'                        
                                            TO PV-PARAGRAPH-NAME                
                    MOVE 'ERROR IN UPDT OF EIC,GM IN WKLYSUM '                  
                                            TO PV-OPER-ATTEMPTED                
                    PERFORM 9000-SQL-ABEND                                      
           END-EVALUATE                                                         
           .                                                                    
       4500-INSR-EIC-GM-WKLY-SUM-TAB.                                           
                                                                                
           INITIALIZE DCLMLT00005.                                              
           MOVE PV-PARTN-NBR-WKLY           TO MLT00005-PARTN-NBR.              
           MOVE PV-PVTB-DEPT-NBR            TO MLT00005-DEPT-NBR.               
           MOVE PV-PVTB-MAJ-CL-NBR          TO MLT00005-MAJ-CL-NBR.             
           MOVE PV-PVTB-SUB-CL-NBR          TO MLT00005-SUB-CL-NBR.             
           MOVE PV-PVTB-LOC-NBR             TO MLT00005-LOC-NBR.                
           MOVE PV-PVTB-ML-LWST-ID          TO                                  
                MLT00005-ML-LO-MDSE-LVL-ID.                                     
           MOVE DR810-FSCL-MN-END-DTE       TO MLT00005-FSCL-WK-END-DTE.        
           MOVE PV-EIC-UPDT-AMT             TO                                  
                MLT00005-END-INV-COST2-AMT.                                     
           MOVE PV-GM-UPDT-AMT              TO                                  
                MLT00005-ADJ-GRO-MRGN-AMT.                                      
                                                                                
           EXEC SQL                                                             
               INSERT INTO MLT_WKLY_SUM                                         
                    (PARTN_NBR                                                  
                     ,DEPT_NBR                                                  
                     ,MAJ_CL_NBR                                                
                     ,SUB_CL_NBR                                                
                     ,LOC_NBR                                                   
                     ,ML_LO_MDSE_LVL_ID                                         
                     ,FSCL_WK_END_DTE                                           
                     ,SLS_REG_RTL_AMT                                           
                     ,SLS_PROMO_RTL_AMT                                         
                     ,SLS_PROCLR_RTL_AMT                                        
                     ,SLS_CLR_RTL_AMT                                           
                     ,SLS_OTH_RTL_AMT                                           
                     ,MKDN_PLU_RTL_AMT                                          
                     ,MKDN_PROMO_RTL_AMT                                        
                     ,MKDN_RGST_RTL_AMT                                         
                     ,MKDN_GLDST_RTL_AMT                                        
                     ,MKDN_UMTCH_RTL_AMT                                        
                     ,MKDN_BYR_RTL_AMT                                          
                     ,MKDN_STR_RTL_AMT                                          
                     ,MKDN_PRPT_RTL_AMT                                         
                     ,MKDN_OTH_RTL_AMT                                          
                     ,MKDN_RTL_AMT                                              
                     ,MKUP_RTL_AMT                                              
                     ,XFER_IN_RTL_AMT                                           
                     ,XFER_OUT_RTL_AMT                                          
                     ,RCPT_RTL_AMT                                              
                     ,RCPT_NET_COST_AMT                                         
                     ,RCPT_GRO_COST_AMT                                         
                     ,PADJ_RTL_AMT                                              
                     ,PADJ_FRGT_COST_AMT                                        
                     ,PADJ_DISC_COST_AMT                                        
                     ,PADJ_RTV_COST_AMT                                         
                     ,PADJ_RTV_RTL_AMT                                          
                     ,PADJ_DA_COST_AMT                                          
                     ,PADJ_DA_RTL_AMT                                           
                     ,PADJ_NET_COST_AMT                                         
                     ,PADJ_OTH_COST_AMT                                         
                     ,PADJ_OTH_RTL_AMT                                          
                     ,DR_ALW_RTL_AMT                                            
                     ,RTV_RTL_AMT                                               
                     ,MKUP_INIT_AMT                                             
                     ,MKUP_NET_AMT                                              
                     ,INV_ADJ_RTL_AMT                                           
                     ,ONORD_RTL_AMT                                             
                     ,ONORD_COST_AMT                                            
                     ,SHNK_RTL_AMT                                              
                     ,END_INV_RTL_AMT                                           
                     ,END_INV_COST_AMT                                          
                     ,INV_COST_ADJ1_AMT                                         
                     ,INV_COST_ADJ2_AMT                                         
                     ,END_INV_COST1_AMT                                         
                     ,END_INV_COST2_AMT                                         
                     ,ADJ_GRO_MRGN_AMT)                                         
               VALUES (                                                         
                      :MLT00005-PARTN-NBR                                       
                     ,:MLT00005-DEPT-NBR                                        
                     ,:MLT00005-MAJ-CL-NBR                                      
                     ,:MLT00005-SUB-CL-NBR                                      
                     ,:MLT00005-LOC-NBR                                         
                     ,:MLT00005-ML-LO-MDSE-LVL-ID                               
                     ,:MLT00005-FSCL-WK-END-DTE                                 
                     ,:MLT00005-SLS-REG-RTL-AMT                                 
                     ,:MLT00005-SLS-PROMO-RTL-AMT                               
                     ,:MLT00005-SLS-PROCLR-RTL-AMT                              
                     ,:MLT00005-SLS-CLR-RTL-AMT                                 
                     ,:MLT00005-SLS-OTH-RTL-AMT                                 
                     ,:MLT00005-MKDN-PLU-RTL-AMT                                
                     ,:MLT00005-MKDN-PROMO-RTL-AMT                              
                     ,:MLT00005-MKDN-RGST-RTL-AMT                               
                     ,:MLT00005-MKDN-GLDST-RTL-AMT                              
                     ,:MLT00005-MKDN-UMTCH-RTL-AMT                              
                     ,:MLT00005-MKDN-BYR-RTL-AMT                                
                     ,:MLT00005-MKDN-STR-RTL-AMT                                
                     ,:MLT00005-MKDN-PRPT-RTL-AMT                               
                     ,:MLT00005-MKDN-OTH-RTL-AMT                                
                     ,:MLT00005-MKDN-RTL-AMT                                    
                     ,:MLT00005-MKUP-RTL-AMT                                    
                     ,:MLT00005-XFER-IN-RTL-AMT                                 
                     ,:MLT00005-XFER-OUT-RTL-AMT                                
                     ,:MLT00005-RCPT-RTL-AMT                                    
                     ,:MLT00005-RCPT-NET-COST-AMT                               
                     ,:MLT00005-RCPT-GRO-COST-AMT                               
                     ,:MLT00005-PADJ-RTL-AMT                                    
                     ,:MLT00005-PADJ-FRGT-COST-AMT                              
                     ,:MLT00005-PADJ-DISC-COST-AMT                              
                     ,:MLT00005-PADJ-RTV-COST-AMT                               
                     ,:MLT00005-PADJ-RTV-RTL-AMT                                
                     ,:MLT00005-PADJ-DA-COST-AMT                                
                     ,:MLT00005-PADJ-DA-RTL-AMT                                 
                     ,:MLT00005-PADJ-NET-COST-AMT                               
                     ,:MLT00005-PADJ-OTH-COST-AMT                               
                     ,:MLT00005-PADJ-OTH-RTL-AMT                                
                     ,:MLT00005-DR-ALW-RTL-AMT                                  
                     ,:MLT00005-RTV-RTL-AMT                                     
                     ,:MLT00005-MKUP-INIT-AMT                                   
                     ,:MLT00005-MKUP-NET-AMT                                    
                     ,:MLT00005-INV-ADJ-RTL-AMT                                 
                     ,:MLT00005-ONORD-RTL-AMT                                   
                     ,:MLT00005-ONORD-COST-AMT                                  
                     ,:MLT00005-SHNK-RTL-AMT                                    
                     ,:MLT00005-END-INV-RTL-AMT                                 
                     ,:MLT00005-END-INV-COST-AMT                                
                     ,:MLT00005-INV-COST-ADJ1-AMT                               
                     ,:MLT00005-INV-COST-ADJ2-AMT                               
                     ,:MLT00005-END-INV-COST1-AMT                               
                     ,:MLT00005-END-INV-COST2-AMT                               
                     ,:MLT00005-ADJ-GRO-MRGN-AMT )                              
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = 0                                                 
                    ADD  1                  TO PA-COUNT-WKLY-UPDT-RECS          
                    SET PS-WKLY-SUM-UPDATED-Y TO TRUE                           
               WHEN SQLCODE NOT EQUAL ZERO                                      
                    DISPLAY '*----------------------------------------*'        
                    DISPLAY '* ABEND OCCURED ON KEY : '                         
                    DISPLAY '*----------------------------------------*'        
                    DISPLAY '* PARTN_NBR        =' PV-PARTN-NBR-WKLY            
                    DISPLAY '* DEPT_NBR         =' PV-PVTB-DEPT-NBR             
                    DISPLAY '* MAJ_CL_NBR       =' PV-PVTB-MAJ-CL-NBR           
                    DISPLAY '* SUB_CL_NBR       =' PV-PVTB-SUB-CL-NBR           
                    DISPLAY '* ML_LO_MDSE_LVL_ID=' PV-PVTB-ML-LWST-ID           
                    DISPLAY '* FSCL_MN_END_DTE  =' DR810-FSCL-MN-END-DTE        
                    DISPLAY '*----------------------------------------*'        
      *                                                                         
                    MOVE '4500-INSR-EIC-GM-WKLY-SUM-TAB'                        
                                            TO PV-PARAGRAPH-NAME                
                    MOVE 'ERROR IN INSERT WKLYSUM TABLE'                        
                                            TO PV-OPER-ATTEMPTED                
                    PERFORM 9000-SQL-ABEND                                      
           END-EVALUATE                                                         
           .                                                                    
                                                                                
      *                                                                         
      ******************************************************************        
      *   SELECT ON BV TABLE TO SEE IF REC IS PRESENT                  *        
      ******************************************************************        
      *                                                                         
       4500-SELECT-BV-TAB.                                                      
                                                                                
           EXEC SQL                                                             
               SELECT ML_LO_MDSE_LVL_ID                                         
                 INTO :PV-CHECK-DKEY                                            
                 FROM MLT_DEPT_BRND_VND                                         
                WHERE PARTN_NBR = :PV-PARTN-NBR-MNLY-BV                         
                  AND DEPT_NBR = :PV-PVTB-DEPT-NBR                              
                  AND ML_LO_MDSE_LVL_ID = :PV-PVTB-ML-LWST-ID                   
                  AND FSCL_MN_END_DTE = :DR810-FSCL-MN-END-DTE                  
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = 0                                                 
                    PERFORM 5000-UPDT-EIC-GM-IN-BV-TAB                          
               WHEN SQLCODE = +100                                              
                    PERFORM 4600-INSR-EIC-GM-IN-BV-TAB                          
               WHEN OTHER                                                       
                    DISPLAY '*----------------------------------------*'        
                    DISPLAY '* ABEND OCCURED ON KEY : '                         
                    DISPLAY '*----------------------------------------*'        
                    DISPLAY '* PARTN_NBR        =' PV-PARTN-NBR-WKLY            
                    DISPLAY '* DEPT_NBR         =' PV-PVTB-DEPT-NBR             
                    DISPLAY '* ML_LO_MDSE_LVL_ID=' PV-PVTB-ML-LWST-ID           
                    DISPLAY '* FSCL_MN_END_DTE  =' DR810-FSCL-MN-END-DTE        
                    DISPLAY '*----------------------------------------*'        
      *                                                                         
                    MOVE '4500-SELECT-BV-TAB'                                   
                                            TO PV-PARAGRAPH-NAME                
                    MOVE 'ERROR IN SELECT OF BV TABLE'                          
                                            TO PV-OPER-ATTEMPTED                
                    PERFORM 9000-SQL-ABEND                                      
           END-EVALUATE                                                         
           .                                                                    
      *                                                                         
      ******************************************************************        
      *   INSERTS PRORATED EIC & GROSS MARGIN AMT IN BV_TABLE          *        
      ******************************************************************        
      *                                                                         
       4600-INSR-EIC-GM-IN-BV-TAB.                                              
                                                                                
           INITIALIZE DCLMLT00010.                                              
           MOVE PV-PARTN-NBR-MNLY-BV    TO MLT00010-PARTN-NBR.                  
           MOVE PV-PVTB-DEPT-NBR        TO MLT00010-DEPT-NBR.                   
           MOVE PV-PVTB-ML-LWST-ID      TO MLT00010-ML-LO-MDSE-LVL-ID.          
           MOVE DR810-FSCL-MN-END-DTE   TO MLT00010-FSCL-MN-END-DTE.            
           MOVE PV-EIC-UPDT-AMT         TO MLT00010-END-INV-COST2-AMT.          
           MOVE PV-GM-UPDT-AMT          TO MLT00010-GRO-MRGN-AMT.               
                                                                                
           EXEC SQL                                                             
               INSERT INTO MLT_DEPT_BRND_VND                                    
                    (  PARTN_NBR                                                
                     , DEPT_NBR                                                 
                     , ML_LO_MDSE_LVL_ID                                        
                     , FSCL_MN_END_DTE                                          
                     , SHNK_RTL_AMT                                             
                     , END_INV_RTL_AMT                                          
                     , END_INV_COST_AMT                                         
                     , GRO_MRGN_AMT                                             
                     , INV_COST_ADJ1_AMT                                        
                     , INV_COST_ADJ2_AMT                                        
                     , END_INV_COST1_AMT                                        
                     , END_INV_COST2_AMT )                                      
               VALUES (:MLT00010-PARTN-NBR                                      
                      ,:MLT00010-DEPT-NBR                                       
                      ,:MLT00010-ML-LO-MDSE-LVL-ID                              
                      ,:MLT00010-FSCL-MN-END-DTE                                
                      ,:MLT00010-SHNK-RTL-AMT                                   
                      ,:MLT00010-END-INV-RTL-AMT                                
                      ,:MLT00010-END-INV-COST-AMT                               
                      ,:MLT00010-GRO-MRGN-AMT                                   
                      ,:MLT00010-INV-COST-ADJ1-AMT                              
                      ,:MLT00010-INV-COST-ADJ2-AMT                              
                      ,:MLT00010-END-INV-COST1-AMT                              
                      ,:MLT00010-END-INV-COST2-AMT )                            
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = 0                                                 
                    ADD 1                   TO PA-COUNT-BV-ISRT-RECS            
                    SET PS-BV-UPDATED-Y     TO TRUE                             
                    PERFORM 6800-WRITE-BVTBL-LINES                              
               WHEN SQLCODE NOT EQUAL ZERO                                      
                    DISPLAY '*----------------------------------------*'        
                    DISPLAY '* ABEND OCCURED ON KEY : '                         
                    DISPLAY '*----------------------------------------*'        
                    DISPLAY '* PARTN_NBR        =' PV-PARTN-NBR-MNLY-BV         
                    DISPLAY '* DEPT_NBR         =' PV-PVTB-DEPT-NBR             
                    DISPLAY '* ML_LO_MDSE_LVL_ID=' PV-PVTB-ML-LWST-ID           
                    DISPLAY '* FSCL_MN_END_DTE  =' DR810-FSCL-MN-END-DTE        
                    DISPLAY '*----------------------------------------*'        
      *                                                                         
                    MOVE '4600-INSR-EIC-GM-IN-BV-TAB'                           
                                            TO PV-PARAGRAPH-NAME                
                    MOVE 'ERROR IN INSERT OF BV TABLE'                          
                                            TO PV-OPER-ATTEMPTED                
                    PERFORM 9000-SQL-ABEND                                      
           END-EVALUATE                                                         
           .                                                                    
      *                                                                         
      ******************************************************************        
      *   UPDATES PRORATED EIC & GROSS MARGIN AMT IN BV_TABLE          *        
      ******************************************************************        
      *                                                                         
       5000-UPDT-EIC-GM-IN-BV-TAB.                                              
                                                                                
           EXEC SQL                                                             
               UPDATE MLT_DEPT_BRND_VND                                         
                  SET END_INV_COST2_AMT = :PV-EIC-UPDT-AMT,                     
                      GRO_MRGN_AMT= :PV-GM-UPDT-AMT,                            
                      SHNK_RTL_AMT= 0                                           
                WHERE PARTN_NBR = :PV-PARTN-NBR-MNLY-BV                         
                  AND DEPT_NBR = :PV-PVTB-DEPT-NBR                              
                  AND ML_LO_MDSE_LVL_ID = :PV-PVTB-ML-LWST-ID                   
                  AND FSCL_MN_END_DTE = :DR810-FSCL-MN-END-DTE                  
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = 0                                                 
                    ADD 1                   TO PA-COUNT-BV-UPDT-RECS            
                    SET PS-BV-UPDATED-Y     TO TRUE                             
                    PERFORM 6800-WRITE-BVTBL-LINES                              
              WHEN SQLCODE NOT EQUAL ZERO                                       
                    DISPLAY '*----------------------------------------*'        
                    DISPLAY '* ABEND OCCURED ON KEY : '                         
                    DISPLAY '*----------------------------------------*'        
                    DISPLAY '* PARTN_NBR        =' PV-PARTN-NBR-WKLY            
                    DISPLAY '* DEPT_NBR         =' PV-PVTB-DEPT-NBR             
                    DISPLAY '* ML_LO_MDSE_LVL_ID=' PV-PVTB-ML-LWST-ID           
                    DISPLAY '* FSCL_MN_END_DTE  =' DR810-FSCL-MN-END-DTE        
                    DISPLAY '*----------------------------------------*'        
      *                                                                         
                    MOVE '5000-UPDT-EIC-GM-IN-BV-TAB'                           
                                            TO PV-PARAGRAPH-NAME                
                    MOVE 'ERROR IN UPDATE OF GM   IN BV TABLE'                  
                                            TO PV-OPER-ATTEMPTED                
                    PERFORM 9000-SQL-ABEND                                      
           END-EVALUATE                                                         
           .                                                                    
      *                                                                         
      ******************************************************************        
      *   WRITE UPDATE DEATILS TO THE REPORT                           *        
      ******************************************************************        
      *                                                                         
       5800-WRITE-UPDATE-DETAILS.                                               
      *                                                                         
            EVALUATE TRUE                                                       
               WHEN PS-WKLY-SUM-UPDATED-Y AND                                   
                    PS-BV-UPDATED-Y                                             
                    MOVE 'MWBV'             TO PV-TABLE-IND                     
               WHEN PS-WKLY-SUM-UPDATED-Y                                       
                    MOVE 'MW  '             TO PV-TABLE-IND                     
               WHEN PS-WKLY-SUM-UPDATED-N AND                                   
                    PS-BV-UPDATED-N                                             
                    MOVE 'M   '             TO PV-TABLE-IND                     
            END-EVALUATE                                                        
      *                                                                         
            WRITE PRORATION-REPORT-REC    FROM PV-RPT-LINE3                     
           ADD 1                            TO PV-LINE-COUNTER                  
            .                                                                   
                                                                                
      *                                                                         
      ******************************************************************        
      *   WRITE DEPARTMENT HEADER LINES TO REPORT                      *        
      ******************************************************************        
      *                                                                         
       6000-WRITE-DPT-HDR-LINES.                                                
      *                                                                         
           PERFORM 6600-PRINT-HEADINGS                                          
           MOVE PCTBR-DEPT-NBR              TO PV-DPT-NO                        
           MOVE DR810-VAR-END-INV-COST-AMT  TO PV-EIC-VAR                       
           MOVE DR810-VAR-GRO-MRGN-AMT      TO PV-GM-VAR                        
           MOVE PV-DEPT-PADJ-NET-COST-AMT-TOT                                   
                                            TO PV-PADJ-TOT                      
           WRITE PRORATION-REPORT-REC     FROM PV-RPT-LINE1                     
           WRITE PRORATION-REPORT-REC     FROM PV-RPT-LINE2                     
           WRITE PRORATION-REPORT-REC     FROM PV-SPACE-LN                      
           ADD 3                            TO PV-LINE-COUNTER                  
           .                                                                    
      *                                                                         
      ******************************************************************        
      *   WRITE DEPARTMENT HEADER LINES TO REPORT                      *        
      ******************************************************************        
      *                                                                         
       6500-WRITE-DPT-TOTALS.                                                   
      *                                                                         
           MOVE CUM-PRORATE-EIC-AMT         TO PV-DPT-EIC-TOTALS                
           MOVE CUM-PRORATE-GM-AMT          TO PV-DPT-GM-TOTALS                 
           MOVE CUM-PADJ-FOR-DPT            TO PV-DPT-PADJ-TOTALS               
           WRITE PRORATION-REPORT-REC     FROM PV-SPACE-LN                      
           WRITE PRORATION-REPORT-REC     FROM PV-RPT-LINE4-DPT-TOTALS          
           WRITE PRORATION-REPORT-REC     FROM PV-SPACE-LN                      
           ADD 3                            TO PV-LINE-COUNTER                  
           .                                                                    
      *                                                                         
      ******************************************************************        
      * 6600-PRINT-HEADINGS.                                                    
      *****************************************************************         
       6600-PRINT-HEADINGS.                                                     
                                                                                
           ADD 1                            TO PV-PAGE-COUNTER.                 
           MOVE PV-PAGE-COUNTER             TO DP133O-PAGE-NUMBER.              
                                                                                
           WRITE PRORATION-REPORT-REC     FROM                                  
                  DP133O-STANDRD-HEADER-133-COLS                                
                                         AFTER ADVANCING PAGE.                  
           WRITE PRORATION-REPORT-REC     FROM REPORT-TITLE-LINE.               
           WRITE PRORATION-REPORT-REC     FROM PV-SPACE-LN.                     
                                                                                
           MOVE 3                           TO PV-LINE-COUNTER.                 
                                                                                
      ******************************************************************        
      *   WRITE CUMMULATIVE AMOUNT FIEDS, EIC AND GM AMOUNT FIELDS     *        
      *   UPDATED.INSERTED TO OUTPUT FILE OUT02                        *        
      ******************************************************************        
      *                                                                         
       6800-WRITE-BVTBL-LINES.                                                  
      *                                                                         
           MOVE PV-EIC-UPDT-AMT             TO BVTBL-END-INV-COST-AMT2          
           MOVE PV-GM-UPDT-AMT              TO BVTBL-ADJ-GRO-MRGN-AMT           
                                                                                
           WRITE PRORATION-BVTBL-REC      FROM                                  
                 BVTBL-COMMON-RECALC-EXTRACT                                    
           ADD 1                            TO PA-COUNT-BVTBL-RECS              
           INITIALIZE BVTBL-COMMON-RECALC-EXTRACT                               
           INITIALIZE BVTBL-CUMULATIVE-VARS                                     
           .                                                                    
      *                                                                         
      ******************************************************************        
      *  THIS PARAGRAPH READS DR810 EIC-GM INPUT FILE                  *        
      ******************************************************************        
      *                                                                         
       1100-READ-DR810-EIC-FILE.                                                
      *                                                                         
           READ DR810-EIC-GM-FILE INTO DR810-MNDPT-WO-PB-GIVEBACK               
              AT END                                                            
                 SET PS-DR810-EIC-FILE-EOF-YES                                  
                                            TO TRUE                             
              NOT AT END                                                        
                 ADD 1                      TO PA-COUNT-DR810-EIC-RECS          
           END-READ.                                                            
      *                                                                         
      ******************************************************************        
      *  THIS PARAGRAPH READS PRIVATE BRAND FILE THAT WILL BE PRORATED *        
      ******************************************************************        
      *                                                                         
       1200-READ-PCTBR-FILE.                                                    
      *                                                                         
           READ PCTBR-FILE INTO PCTBR-PRORATION-PCT                             
              AT END                                                            
                 SET PS-PCTBR-FILE-EOF-YES  TO TRUE                             
              NOT AT END                                                        
                 MOVE PCTBR-DEPT-NBR        TO PV-DEPT-NBR-UNPACK               
                 MOVE PV-DEPT-NBR-UNPACK    TO PV-PCTBR-DPT-NUM                 
                 MOVE PV-PCTBR-DPT-NUM      TO PV-PCTBR-DEPT-NBR-X              
                 ADD 1                      TO PA-COUNT-PCTBR-RECS              
           END-READ.                                                            
      *                                                                         
      ******************************************************************        
      * CHECK STATUS CODE TO SEE IF THIS IS A RESTART CONDITION                 
      ******************************************************************        
       7000-INIT-CHECKPOINT-SELECT.                                             
      *                                                                         
           EXEC SQL                                                             
             SELECT  CKPT_STAT_CODE,                                            
                     CKPT_FRQNCY_QTY                                            
               INTO  :TCKRSTCNTL-CKPT-STAT-CODE,                                
                     :TCKRSTCNTL-CKPT-FRQNCY-QTY                                
               FROM  TCKRSTCNTL                                                 
              WHERE  JOB_NAME  = :PC-JOB-NAME                                   
                AND  PLAN_NAME = :PC-PROGRAM-NAME                               
           END-EXEC.                                                            
      *                                                                         
           IF SQLCODE = 0                                                       
               CONTINUE                                                         
           ELSE                                                                 
               MOVE '7000-INIT-CHECKPOINT-SELECT' TO PV-PARAGRAPH-NAME          
               MOVE 'ERROR IN SELECT-TCKRSTCNTL         '                       
                                            TO PV-OPER-ATTEMPTED                
               PERFORM 9000-SQL-ABEND                                           
           END-IF.                                                              
      *                                                                         
      ******************************************************************        
      * OBTAIN INFORMATION REGARDING WHERE TO RESTART TABLE PROCESSING          
      ******************************************************************        
       7100-SELECT-RESTART-INFO.                                                
      *                                                                         
           EXEC SQL                                                             
             SELECT  WORK_STRG_DESC                                             
               INTO  :TCKRSTINF-WORK-STRG-DESC                                  
               FROM  TCKRSTINF                                                  
              WHERE  JOB_NAME  = :PC-JOB-NAME                                   
                AND  PLAN_NAME = :PC-PROGRAM-NAME                               
           END-EXEC.                                                            
      *                                                                         
           IF SQLCODE = 0                                                       
               CONTINUE                                                         
           ELSE                                                                 
               MOVE '7100-SELECT-RESTART-INFO' TO PV-PARAGRAPH-NAME             
               MOVE 'ERROR IN SELECT-TCKRSTINF          '                       
                                            TO PV-OPER-ATTEMPTED                
               PERFORM 9000-SQL-ABEND                                           
           END-IF.                                                              
      *                                                                         
      ******************************************************************        
      *   GET THE TIMESTAMP FROM THE CHECKPOINT TABLE FOR NEXT COMMIT           
      ******************************************************************        
       7200-GET-COMMIT-TIMESTAMP.                                               
      *                                                                         
           EXEC SQL                                                             
             SELECT (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)               
               INTO :PV-COMMIT-TIMESTAMP                                        
               FROM TCKRSTCNTL                                                  
              WHERE JOB_NAME  = :PC-JOB-NAME                                    
                AND PLAN_NAME = :PC-PROGRAM-NAME                                
           END-EXEC.                                                            
      *                                                                         
           EVALUATE TRUE                                                        
               WHEN SQLCODE = 0                                                 
                   CONTINUE                                                     
               WHEN SQLCODE NOT EQUAL ZERO                                      
                   MOVE '7200-GET-COMMIT-TIMESTAMP' TO PV-PARAGRAPH-NAME        
                   MOVE 'ERROR IN SELECT - TCKRSTCNTL       '                   
                                                    TO PV-OPER-ATTEMPTED        
                   PERFORM 9000-SQL-ABEND                                       
           END-EVALUATE.                                                        
      *                                                                         
      ******************************************************************        
      * COMPARE COMMIT TIMESTAMP TO CURRENT TO DETERMINE IF COMMIT REQD*        
      ******************************************************************        
       7300-COMMIT-PROCESSING.                                                  
      *                                                                         
           MOVE '7300-COMMIT-PROCESSING'    TO PV-PARAGRAPH-NAME.               
      *                                                                         
           PERFORM 7400-SET-CURRENT-TIMESTAMP.                                  
      *                                                                         
           IF (PV-CURRENT-TIMESTAMP > PV-COMMIT-TIMESTAMP) OR                   
               PS-END-OF-PROCESSING-YES                                         
      *  PREPARE COMMIT RECORD FOR UPDATE                                       
               ADD 1                        TO PA-COMMIT-COUNT                  
               PERFORM 7800-POPULATE-CHK-POINT-FIELDS                           
                                                                                
      * MOVE COMMIT INFO TO WORKING STORAGE ROW                                 
               MOVE CR-CHECKPOINT-RESTART-AREA                                  
                                            TO TCKRSTINF-WORK-STRG-DESC         
               IF PS-FIRST-COMMIT-YES                                           
                   MOVE '9'                 TO TCKRSTCNTL-CKPT-STAT-CODE        
                   PERFORM 7600-UPDATE-CHECKPOINT-STATUS                        
                   SET PS-FIRST-COMMIT-NO   TO TRUE                             
               END-IF                                                           
      *                                                                         
               PERFORM 7500-COMMIT-CHANGES                                      
      *                                                                         
               PERFORM 7200-GET-COMMIT-TIMESTAMP                                
      *                                                                         
           END-IF.                                                              
      *                                                                         
      ******************************************************************        
      * CURRENT TIMESTAMP SET TO BE COMPARED TO COMMIT TIMESTAMP       *        
      ******************************************************************        
       7400-SET-CURRENT-TIMESTAMP.                                              
      *                                                                         
           EXEC SQL                                                             
                SET :PV-CURRENT-TIMESTAMP = CURRENT TIMESTAMP                   
           END-EXEC.                                                            
      *                                                                         
           IF SQLCODE = 0                                                       
               CONTINUE                                                         
           ELSE                                                                 
               MOVE 'UNABLE TO OBTAIN TIMESTAMP         '                       
                                                 TO PV-OPER-ATTEMPTED           
               MOVE '7400-SET-CURRENT-TIMESTAMP' TO PV-PARAGRAPH-NAME           
               PERFORM 9000-SQL-ABEND                                           
           END-IF.                                                              
      *                                                                         
      ******************************************************************        
      * UPDATE CHECKPOINT INFORMATION TABLE. TAKE A COMMIT.                     
      ******************************************************************        
       7500-COMMIT-CHANGES.                                                     
      *                                                                         
           EXEC SQL                                                             
             UPDATE TCKRSTINF                                                   
                SET WORK_STRG_DESC = :TCKRSTINF-WORK-STRG-DESC                  
              WHERE JOB_NAME       = :PC-JOB-NAME                               
                AND PLAN_NAME      = :PC-PROGRAM-NAME                           
           END-EXEC.                                                            
      *                                                                         
           IF SQLCODE = 0                                                       
               CONTINUE                                                         
           ELSE                                                                 
               MOVE 'UPDATE WORK_STRG - TCKRSTINF       '                       
                                            TO PV-OPER-ATTEMPTED                
               MOVE  '7500-COMMIT-CHANGES ' TO PV-PARAGRAPH-NAME                
               PERFORM 9000-SQL-ABEND                                           
           END-IF.                                                              
      *                                                                         
           EXEC SQL                                                             
               COMMIT                                                           
           END-EXEC.                                                            
      *                                                                         
           IF SQLCODE = 0                                                       
              CONTINUE                                                          
           ELSE                                                                 
               MOVE 'PGM ABEND DURING A COMMIT          '                       
                                            TO PV-OPER-ATTEMPTED                
               MOVE  '7500-COMMIT-CHANGES ' TO PV-PARAGRAPH-NAME                
               PERFORM 9000-SQL-ABEND                                           
           END-IF.                                                              
      *                                                                         
      ******************************************************************        
      * UPDATE CHECKPOINT STATUS                                                
      ******************************************************************        
       7600-UPDATE-CHECKPOINT-STATUS.                                           
      *                                                                         
           EXEC SQL                                                             
             UPDATE  TCKRSTCNTL                                                 
                SET  CKPT_STAT_CODE = :TCKRSTCNTL-CKPT-STAT-CODE                
              WHERE  JOB_NAME  = :PC-JOB-NAME                                   
                AND  PLAN_NAME = :PC-PROGRAM-NAME                               
           END-EXEC.                                                            
      *                                                                         
           IF SQLCODE = 0                                                       
               CONTINUE                                                         
           ELSE                                                                 
               MOVE '7600-UPDATE-CHECKPOINT-STATUS' TO PV-PARAGRAPH-NAME        
               MOVE 'UPDATE OF TCKRSTCNTL FAILED        '                       
                                            TO PV-OPER-ATTEMPTED                
               PERFORM 9000-SQL-ABEND                                           
           END-IF.                                                              
      *                                                                         
      ******************************************************************        
      * POPULATE THE CHECKPOINT FIELDS BACK TO THE PROGRAM FIELDS      *        
      ******************************************************************        
       7700-POPULATE-PGM-FIELDS.                                                
      *                                                                         
           MOVE CR-DEPT-NBR-X               TO DR810-DEPT-NBR                   
           MOVE CR-HOLD-PCTBR-LOC-NBR       TO PCTBR-LOC-NBR                    
           MOVE CR-HOLD-FSCL-END-DTE        TO PCTBR-FSCL-END-DTE               
           MOVE CR-COUNT-MNLY-UPDT-RECS     TO PA-COUNT-MNLY-UPDT-RECS          
           MOVE CR-COUNT-WKLY-UPDT-RECS     TO PA-COUNT-WKLY-UPDT-RECS          
           MOVE CR-COUNT-BV-UPDT-RECS       TO PA-COUNT-BV-UPDT-RECS            
           MOVE CR-COUNT-BV-ISRT-RECS       TO PA-COUNT-BV-ISRT-RECS            
           MOVE CR-COUNT-PRORATE-RPT-RECS   TO                                  
                                             PA-COUNT-PRORATE-RPT-RECS          
           MOVE CR-COMMIT-COUNT             TO PA-COMMIT-COUNT                  
           MOVE CR-HOLD-PCTBR-SUB-CL-NBR    TO                                  
                                               HOLD-PCTBR-SUB-CL-NBR            
           MOVE CR-HOLD-PCTBR-MAJ-CL-NBR    TO                                  
                                             HOLD-PCTBR-MAJ-CL-NBR              
           MOVE CR-HOLD-PCTBR-ML-LWST-ID    TO                                  
                                             HOLD-PCTBR-ML-LWST-ID              
           MOVE CR-PARTN-NBR-WKLY           TO PV-PARTN-NBR-WKLY                
           MOVE CR-PARTN-NBR-MNLY-BV        TO PV-PARTN-NBR-MNLY-BV             
           MOVE CR-HOLD-PCTBR-DEPT-NBR      TO HOLD-PCTBR-DEPT-NBR              
           MOVE CR-CUMULATIVE-VARIABLES     TO PV-CUMULATIVE-VARIABLES          
           .                                                                    
      *                                                                         
      ******************************************************************        
      * POPULATE THE CHECKPOINT FIELDS BACK TO THE PROGRAM FIELDS      *        
      ******************************************************************        
       7800-POPULATE-CHK-POINT-FIELDS.                                          
      *                                                                         
           MOVE DR810-DEPT-NBR              TO CR-DEPT-NBR-X                    
           MOVE PCTBR-LOC-NBR               TO CR-HOLD-PCTBR-LOC-NBR            
           MOVE PCTBR-FSCL-END-DTE          TO CR-HOLD-FSCL-END-DTE             
           MOVE PA-COUNT-MNLY-UPDT-RECS     TO CR-COUNT-MNLY-UPDT-RECS          
           MOVE PA-COUNT-WKLY-UPDT-RECS     TO CR-COUNT-WKLY-UPDT-RECS          
           MOVE PA-COUNT-BV-UPDT-RECS       TO CR-COUNT-BV-UPDT-RECS            
           MOVE PA-COUNT-BV-ISRT-RECS       TO CR-COUNT-BV-ISRT-RECS            
           MOVE PA-COUNT-PRORATE-RPT-RECS   TO                                  
                                         CR-COUNT-PRORATE-RPT-RECS              
           MOVE PA-COMMIT-COUNT             TO CR-COMMIT-COUNT                  
           MOVE HOLD-PCTBR-SUB-CL-NBR       TO                                  
                                         CR-HOLD-PCTBR-SUB-CL-NBR               
           MOVE HOLD-PCTBR-MAJ-CL-NBR       TO                                  
                                         CR-HOLD-PCTBR-MAJ-CL-NBR               
           MOVE HOLD-PCTBR-ML-LWST-ID       TO                                  
                                         CR-HOLD-PCTBR-ML-LWST-ID               
           MOVE PV-PARTN-NBR-WKLY           TO CR-PARTN-NBR-WKLY                
           MOVE PV-PARTN-NBR-MNLY-BV        TO CR-PARTN-NBR-MNLY-BV             
           MOVE HOLD-PCTBR-DEPT-NBR         TO CR-HOLD-PCTBR-DEPT-NBR           
           MOVE PV-CUMULATIVE-VARIABLES     TO CR-CUMULATIVE-VARIABLES          
           .                                                                    
      *                                                                         
      ******************************************************************        
      *    PERFORM CLOSING OF CURSOR AND FINAL COMMIT BEFORE END OF JOB         
      *    CLOSE ALL FILES.                                                     
      ******************************************************************        
      *                                                                         
       8000-END-OF-JOB.                                                         
      *                                                                         
      * COMMIT FINAL CHANGES IF ANY                                             
      *                                                                         
           IF PS-EMPTY-INPUT-FILES-YES                                          
               CONTINUE                                                         
           ELSE                                                                 
               PERFORM 7300-COMMIT-PROCESSING                                   
           END-IF                                                               
      *                                                                         
           CLOSE PCTBR-FILE                                                     
                 DR810-EIC-GM-FILE                                              
                 PRORATION-REPORT-FILE                                          
                 PRORATION-BVTBLE-FILE                                          
                 .                                                              
      *                                                                         
           MOVE '0' TO TCKRSTCNTL-CKPT-STAT-CODE.                               
           PERFORM 7600-UPDATE-CHECKPOINT-STATUS.                               
      *                                                                         
           DISPLAY '******************* END OF JOB STATISTICS ********'.        
           DISPLAY 'NUMBER OF RECORDS READ FROM 810 FILE:'                      
                   PA-COUNT-DR810-EIC-RECS.                                     
                                                                                
           DISPLAY 'NUMBER OF RECORDS READ FROM PRORATION PCT FILE :'           
                   PA-COUNT-PCTBR-RECS.                                         
           DISPLAY 'NUMBER OF RECORDS WRITTEN IN OUT02 FILE :'                  
                   PA-COUNT-BVTBL-RECS.                                         
           DISPLAY 'NUMBER OF RECORDS UPDATE/INSERT IN MNLYSUM TABLE:'          
                   PA-COUNT-MNLY-UPDT-RECS.                                     
           DISPLAY 'NUMBER OF RECORDS UPDATE/INSERT IN WKLYSUM TABLE:'          
                   PA-COUNT-WKLY-UPDT-RECS.                                     
           DISPLAY 'NUMBER OF RECORDS UPDATED IN BV TABLE:'                     
                   PA-COUNT-BV-UPDT-RECS.                                       
           DISPLAY 'NUMBER OF RECORDS INSERTED IN BV TABLE:'                    
                   PA-COUNT-BV-ISRT-RECS.                                       
           DISPLAY 'NUMBER OF COMMITS DONE    : '                               
                   PA-COMMIT-COUNT.                                             
           DISPLAY '**************************************************'.        
      *                                                                         
      ******************************************************************        
      *   REPOSITION THE CURSOR TO THE LAST RECORD READ IN THE 3 FILES *        
      ******************************************************************        
      *                                                                         
        8500-REPOS-TO-LAST-PROCESS.                                             
      *                                                                         
           PERFORM 1100-READ-DR810-EIC-FILE                                     
             UNTIL DR810-DEPT-NBR   = CR-DEPT-NBR-X                             
      *                                                                         
           PERFORM 1200-READ-PCTBR-FILE                                         
             UNTIL PCTBR-DEPT-NBR   = CR-HOLD-PCTBR-DEPT-NBR AND                
                   PCTBR-ML-LWST-ID = CR-HOLD-PCTBR-ML-LWST-ID AND              
                   PCTBR-MAJ-CL-NBR = CR-HOLD-PCTBR-MAJ-CL-NBR AND              
                   PCTBR-SUB-CL-NBR = CR-HOLD-PCTBR-SUB-CL-NBR AND              
                   PCTBR-LOC-NBR    = CR-HOLD-PCTBR-LOC-NBR AND                 
                   PCTBR-FSCL-END-DTE = CR-HOLD-FSCL-END-DTE.                   
      *                                                                         
      ******************************************************************        
      *   ABEND PARAGRAPH                                                       
      ******************************************************************        
      *                                                                         
       9000-ABEND.                                                              
      *                                                                         
           DISPLAY '**  ABEND     **'.                                          
           DISPLAY '**  PROGRAM   **  =  MLKUP706'.                             
                                                                                
           DISPLAY '**  PARAGRAPH **  = '  PV-PARAGRAPH-NAME.                   
      *                                                                         
           MOVE +4013                       TO ABEND-CODE.                      
           PERFORM 9999-ABEND.                                                  
      *                                                                         
      ******************************************************************        
      *    SQL ERROR - ABEND                                           *        
      ******************************************************************        
      *                                                                         
       9000-SQL-ABEND.                                                          
      *                                                                         
           MOVE +4013                       TO ABEND-CODE.                      
           DISPLAY '**  ABEND     **'.                                          
           DISPLAY '**  PROGRAM   **  =  MLKUP706'.                             
           DISPLAY '**  OPERATION **  =                '                        
                    PV-OPER-ATTEMPTED                                           
           DISPLAY '**  PARAGRAPH **  = '  PV-PARAGRAPH-NAME                    
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE                 
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.                
           COPY DPPD004.                                                        
           PERFORM 9999-ABEND                                                   
           .                                                                    
      *                                                                         
      ******************************************************************        
      *    ABEND CALL                                                  *        
      ******************************************************************        
      *                                                                         
       9999-ABEND.                                                              
           CALL 'ILBOABN0'              USING ABEND-CODE                        
           .                                                                    
      *                                                                         
      ******************************************************************        
      *                 END OF PROGRAM MLKUP706                                 
                                                                                
      ******************************************************************        
                                                                                
