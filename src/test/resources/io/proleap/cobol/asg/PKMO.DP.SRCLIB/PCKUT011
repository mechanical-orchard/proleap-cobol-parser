000100******************************************************************00010003
000200 IDENTIFICATION DIVISION.                                         00020003
000300******************************************************************00030003
000400                                                                  00040003
000500 PROGRAM-ID.             PCKUT011.                                00050003
000600 AUTHOR.                 LYNN MCADAMS.                            00060003
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070003
000800 DATE-WRITTEN            11-12-99.                                00080003
000900 DATE-COMPILED.                                                   00090003
001000                                                                  00100003
001100*----------------------------------------------------------------*00110003
001200* THIS PROGRAM EXTRACTS THE RECORDS THAT WILL GO INTO THE        *00120003
001300* TRAILER TOTALS ON THE 'PROCESS AREA CURRENT ON-HAND REPORT'.   *00130027
001400*----------------------------------------------------------------*00140003
001500                                                                  00150003
001600******************************************************************00160003
001700 ENVIRONMENT DIVISION.                                            00170003
001800******************************************************************00180003
001900                                                                  00190003
002000 CONFIGURATION SECTION.                                           00200003
002100                                                                  00210003
002200 SOURCE-COMPUTER.        IBM-3090.                                00220003
002300 OBJECT-COMPUTER.        IBM-3090.                                00230003
002400                                                                  00240003
002500 INPUT-OUTPUT SECTION.                                            00250003
002600                                                                  00260003
002700 FILE-CONTROL.                                                    00270003
002800                                                                  00280003
002900      SELECT EXTRACT-TRLR-FILE-IN   ASSIGN TO INP01.              00290033
003000      SELECT EXTRACT-TRLR-FILE-OUT  ASSIGN TO OUT01.              00300004
003100                                                                  00310003
003200******************************************************************00320003
003300 DATA DIVISION.                                                   00330003
003400******************************************************************00340003
003500                                                                  00350003
003510*** PRB0064829 START                                              00351099
003600 FILE SECTION.                                                    00360003
003700 FD  EXTRACT-TRLR-FILE-IN                                         00370004
003800     LABEL RECORDS ARE STANDARD                                   00380003
003900     BLOCK CONTAINS 0 RECORDS                                     00390003
004000     RECORDING MODE IS F                                          00400003
004100*    RECORD CONTAINS 150 CHARACTERS                               00410099
004110     RECORD CONTAINS 200 CHARACTERS                               00411099
004200     DATA RECORD IS TRLR-EXTRACT-IN-RECORD.                       00420004
004300                                                                  00430003
004401*01  TRLR-EXTRACT-IN-RECORD          PIC X(150).                  00440199
004410 01  TRLR-EXTRACT-IN-RECORD          PIC X(200).                  00441099
004500                                                                  00450003
004600 FD  EXTRACT-TRLR-FILE-OUT                                        00460004
004700     LABEL RECORDS ARE STANDARD                                   00470003
004800     BLOCK CONTAINS 0 RECORDS                                     00480003
004900     RECORDING MODE IS F                                          00490003
005000*    RECORD CONTAINS 150 CHARACTERS                               00500099
005010     RECORD CONTAINS 200 CHARACTERS                               00501099
005100     DATA RECORD IS TRLR-OUT-EXTRACT-RECORD.                      00510004
005200                                                                  00520003
005300*01  TRLR-EXTRACT-OUT-RECORD         PIC X(150).                  00530099
005310 01  TRLR-EXTRACT-OUT-RECORD         PIC X(200).                  00531099
005320*** PRB0064829 END                                                00532099
005400*------------------------------------------------------*          00540003
005500 WORKING-STORAGE SECTION.                                         00550003
005600*------------------------------------------------------*          00560003
005700 01 PC-PROGRAM-CONSTANTS.                                         00570003
005800    05  PC-PROGRAM-NAME              PIC X(08) VALUE 'PCKUT011'.  00580006
005900                                                                  00590006
006000 01 PC-PROGRAM-VARIABLES.                                         00600003
006011    05 PV-NULL-IND                   PIC S9(04)    VALUE ZERO     00601183
006012                                                   COMP SYNC.     00601283
006100    05 PV-ABEND-CODE                 PIC 9(04)     VALUE ZERO.    00610082
006200    05 PV-ABEND-PARA-NAME            PIC X(30)     VALUE SPACE.   00620003
006300    05 PV-DB2-OPERATION-MSG-1        PIC X(40)     VALUE SPACE.   00630003
006310    05 PV-DB2-OPERATION-MSG-2        PIC X(40)     VALUE SPACE.   00631093
006400    05 PV-DB2-TABLE-NAME             PIC X(12)     VALUE SPACE.   00640003
006500    05 PV-SQLCODE                    PIC Z(08)9-.                 00650088
006501                                                                  00650192
006510    05 PV-DISPLAY-PO                 PIC 9(09)     VALUE ZEROES.  00651092
006520    05 PV-DISPLAY-RECV               PIC 9(09)     VALUE ZEROES.  00652092
006600                                                                  00660017
006700 01 DK-DB-KEYS.                                                   00670025
006800    05 DK-CURRENT-OPER               PIC S9(04)    COMP.          00680054
006900    05 DK-PROCESS-AREA               PIC X(06)     VALUE SPACES.  00690025
007000    05 DK-PO-NBR                     PIC S9(09)    COMP.          00700054
007100    05 DK-REC-SEQ-NBR                PIC S9(09)    COMP.          00710054
007200                                                                  00720053
007300 01 PS-PROGRAM-SWITCHES.                                          00730003
007700    05 PS-END-OF-FILE-SW             PIC X(01)     VALUE SPACE.   00770024
007800       88 PS-EOF                     VALUE 'Y'.                   00780024
007900       88 PS-NOT-EOF                 VALUE 'N'.                   00790024
008600                                                                  00860025
008700 01 WS-HOLD-AREA.                                                 00870080
008800    05 WS-HOLD-CURRENT-OPER          PIC S9(04)    COMP           00880080
008900                                                   VALUE ZEROS.   00890080
009000    05 WS-HOLD-PROCESS-AREA          PIC X(06)     VALUE SPACES.  00900080
009100                                                                  00910080
009200 01 WS-HOLD-HEADER-RECORD.                                        00920059
009300    05  FILLER                       PIC X(114)    VALUE SPACE.   00930075
009400    05  WS-TRAILER-CDE               PIC X(01)     VALUE SPACE.   00940075
009500    05  WS-SORT                      PIC X(25)     VALUE SPACE.   00950060
009600    05  FILLER                       PIC X(10)     VALUE SPACE.   00960077
009700                                                                  00970059
009800                                                                  00980075
009900 01 WS-CALC-FIELDS.                                               00990084
010000    05  WS-RECORDS-READ-QTY          PIC S9(07)    COMP-3         01000088
010100                                                   VALUE ZEROS.   01010003
010200    05  WS-RECORDS-WRITE-QTY         PIC S9(07)    COMP-3         01020088
010400                                                   VALUE ZEROS.   01040086
010410*** PRB0064829 START                                              01041099
010500 01 WS-SORT-FIELDS.                                               01050060
010600    05  SORT-FIELD-FORMAT1.                                       01060017
010700        10  PO-NUMBER-1                 PIC  9(08) VALUE ZEROS.   01070088
010800*       10  RECEIVER-SEQUENCE-NUMBER-1  PIC  9(03) VALUE ZEROS.   01080099
010810        10  RECEIVER-SEQUENCE-NUMBER-1  PIC  9(04) VALUE ZEROS.   01081099
010900        10  FILLER-1                    PIC  X(14) VALUE SPACE.   01090018
011000                                                                  01100085
011100    05  SORT-FIELD-FORMAT2.                                       01110017
011200        10  SCAC-2                      PIC  X(04) VALUE SPACE.   01120018
011300        10  TRAILER-NUMBER-2            PIC  X(10) VALUE SPACE.   01130018
011400        10  PO-NUMBER-2                 PIC  9(08) VALUE ZEROS.   01140018
011500*       10  RECEIVER-SEQUENCE-NUMBER-2  PIC  9(03) VALUE ZEROS.   01150099
011510        10  RECEIVER-SEQUENCE-NUMBER-2  PIC  9(04) VALUE ZEROS.   01151099
011520*** PRB0064829 END                                                01152099
011600                                                                  01160006
011700*** INPUT FILE RECORD LAYOUT ****                                 01170006
011800     COPY PCRD002.                                                01180091
011900                                                                  01190004
012000*** DB2 MESSAGE AREAS ****                                        01200003
012100     COPY DPWS004.                                                01210091
012200*                                                                 01220003
012300     EXEC SQL                                                     01230003
012400          INCLUDE SQLCA                                           01240003
012500     END-EXEC.                                                    01250003
012600                                                                  01260003
012700     EXEC SQL                                                     01270004
012800          INCLUDE TFLAREA                                         01280004
012900     END-EXEC.                                                    01290004
013000                                                                  01300004
013100     EXEC SQL                                                     01310004
013200          INCLUDE TSHPTPO                                         01320004
013300     END-EXEC.                                                    01330004
013400                                                                  01340004
013500     EXEC SQL                                                     01350004
013600          INCLUDE TSHIPMT                                         01360004
013700     END-EXEC.                                                    01370004
013800                                                                  01380004
013900     EXEC SQL                                                     01390004
014000          INCLUDE TVHTRIP                                         01400004
014100     END-EXEC.                                                    01410004
014200*                                                                 01420035
014300********************************************************          01430003
014400 PROCEDURE DIVISION.                                              01440003
014500********************************************************          01450003
014600 0000-MAIN.                                                       01460003
014700     PERFORM 1000-INITIALIZATION.                                 01470087
014800                                                                  01480003
014900     PERFORM 2000-PROCESS-INPUT-FILE UNTIL PS-EOF.                01490087
015100                                                                  01510003
015400     CLOSE EXTRACT-TRLR-FILE-IN                                   01540004
015500           EXTRACT-TRLR-FILE-OUT.                                 01550004
015600                                                                  01560003
015700     DISPLAY 'NUMBER OF RECORDS READ IS:     '                    01570003
015800         WS-RECORDS-READ-QTY.                                     01580003
015900     DISPLAY 'NUMBER OF RECORDS WRITTEN IS:  '                    01590003
016000         WS-RECORDS-WRITE-QTY.                                    01600003
016100                                                                  01610051
016800     STOP RUN.                                                    01680087
016900                                                                  01690003
017000 1000-INITIALIZATION.                                             01700003
017100      OPEN INPUT  EXTRACT-TRLR-FILE-IN                            01710004
017200           OUTPUT EXTRACT-TRLR-FILE-OUT.                          01720004
017300                                                                  01730003
017310      PERFORM 8000-READ-INPUT-FILE.                               01731087
018400                                                                  01840003
018600                                                                  01860003
018700 2000-PROCESS-INPUT-FILE.                                         01870003
018710                                                                  01871080
018720      IF PC002-RECORD-TYPE-IND = 'A'                              01872080
018730         PERFORM 3000-WRITE-HEADER-RECORD                         01873087
018740      ELSE                                                        01874080
018750         PERFORM 2110-UPDATE-INPUT-FILE                           01875087
018760      END-IF.                                                     01876080
018770                                                                  01877080
018780      PERFORM 8000-READ-INPUT-FILE.                               01878087
018790                                                                  01879080
019800                                                                  01980026
020800 2110-UPDATE-INPUT-FILE.                                          02080026
020810                                                                  02081080
020900      IF  PC002-CURRENT-OPER NOT = WS-HOLD-CURRENT-OPER           02090080
021000      OR  PC002-PROCESS-AREA NOT = WS-HOLD-PROCESS-AREA           02100080
021100          PERFORM 2120-GET-TFLAREA-ROW                            02110087
021101          MOVE PC002-CURRENT-OPER TO WS-HOLD-CURRENT-OPER         02110180
021102          MOVE PC002-PROCESS-AREA TO WS-HOLD-PROCESS-AREA         02110280
021110      ELSE                                                        02111080
021120          IF FLAREA-RPTTOT-BY-TRLR-IND = 'N'                      02112080
021130          OR FLAREA-RPTTOT-BY-TRLR-IND = ' '                      02113080
021140             SET PC002-NO-TRAILER-TOTAL TO TRUE                   02114080
021150             MOVE PC002-PO-NBR TO PO-NUMBER-1                     02115080
021160             MOVE PC002-REC-SEQ-NBR TO RECEIVER-SEQUENCE-NUMBER-1 02116080
021170             MOVE SORT-FIELD-FORMAT1 TO PC002-SORT-FIELD          02117080
021180             PERFORM 3000-WRITE-HEADER-RECORD                     02118087
021190          ELSE                                                    02119080
021191             SET PC002-TRAILER-TOTAL-NEEDED TO TRUE               02119180
021192             IF  PC002-PO-NBR = DK-PO-NBR                         02119280
021193             AND PC002-REC-SEQ-NBR = DK-REC-SEQ-NBR               02119380
021194                 MOVE SORT-FIELD-FORMAT2 TO PC002-SORT-FIELD      02119480
021195                 PERFORM 3000-WRITE-HEADER-RECORD                 02119587
021196             ELSE                                                 02119680
021197                 MOVE PC002-PO-NBR TO PO-NUMBER-2                 02119780
021198                 MOVE PC002-REC-SEQ-NBR TO                        02119880
021199                      RECEIVER-SEQUENCE-NUMBER-2                  02119980
021200                 PERFORM 2140-GET-SCAC-TRAILER                    02120087
021201                 MOVE SORT-FIELD-FORMAT2 TO PC002-SORT-FIELD      02120180
021202                 PERFORM 3000-WRITE-HEADER-RECORD                 02120287
021203             END-IF                                               02120380
021204          END-IF                                                  02120480
021210      END-IF.                                                     02121080
021400                                                                  02140003
021410                                                                  02141087
021500 2120-GET-TFLAREA-ROW.                                            02150026
021600      MOVE PC002-CURRENT-OPER          TO DK-CURRENT-OPER         02160054
021700      MOVE PC002-PROCESS-AREA          TO DK-PROCESS-AREA         02170054
021800                                                                  02180044
021900     EXEC SQL                                                     02190035
022000                SELECT                                            02200035
022100                      OPER_UNT_ID                                 02210035
022200                     ,FCLTY_AREA_ID                               02220035
022300                     ,RPTTOT_BY_TRLR_IND                          02230035
022400                 INTO  :FLAREA-OPER-UNT-ID                        02240037
022500                      ,:FLAREA-FCLTY-AREA-ID                      02250037
022600                      ,:FLAREA-RPTTOT-BY-TRLR-IND                 02260044
022700                FROM TFLAREA                                      02270035
022800                WHERE  FCLTY_LOC_TYP_CDE = 'PA'                   02280035
022900                   AND OPER_UNT_ID       = :DK-CURRENT-OPER       02290056
023000                   AND FCLTY_AREA_ID     = :DK-PROCESS-AREA       02300056
023010                WITH UR                                           02301099
023100     END-EXEC.                                                    02310035
023200                                                                  02320006
023300     EVALUATE TRUE                                                02330035
023400          WHEN SQLCODE = ZERO                                     02340035
023500              PERFORM 2130-CHECK-RPTTOT                           02350087
023600          WHEN SQLCODE = +100                                     02360035
023610              MOVE 'N' TO FLAREA-RPTTOT-BY-TRLR-IND               02361080
023620              PERFORM 2130-CHECK-RPTTOT                           02362087
023800          WHEN OTHER                                              02380035
023900              MOVE '2120-GET-TFLAREA-ROW'                         02390035
024000                                       TO PV-ABEND-PARA-NAME      02400035
024100              MOVE 'SELECT TFLAREA ROW'                           02410035
024200                                       TO PV-DB2-OPERATION-MSG-1  02420035
024300              MOVE 'TFLAREA'           TO PV-DB2-TABLE-NAME       02430035
024400              PERFORM 9998-SQL-ABEND                              02440087
024500      END-EVALUATE.                                               02450035
024600                                                                  02460006
024800                                                                  02480004
024900 2130-CHECK-RPTTOT.                                               02490026
025000                                                                  02500005
025100      IF FLAREA-RPTTOT-BY-TRLR-IND = 'N'                          02510009
025110      OR FLAREA-RPTTOT-BY-TRLR-IND = ' '                          02511080
025200         SET PC002-NO-TRAILER-TOTAL TO TRUE                       02520080
025300         MOVE PC002-PO-NBR TO PO-NUMBER-1                         02530079
025400         MOVE PC002-REC-SEQ-NBR TO RECEIVER-SEQUENCE-NUMBER-1     02540079
025500         MOVE SORT-FIELD-FORMAT1 TO PC002-SORT-FIELD              02550080
025600         PERFORM 3000-WRITE-HEADER-RECORD                         02560087
025700      ELSE                                                        02570016
025800         SET PC002-TRAILER-TOTAL-NEEDED TO TRUE                   02580080
025900         MOVE PC002-PO-NBR TO PO-NUMBER-2                         02590079
026000         MOVE PC002-REC-SEQ-NBR TO RECEIVER-SEQUENCE-NUMBER-2     02600079
026100         PERFORM 2140-GET-SCAC-TRAILER                            02610087
026200         MOVE SORT-FIELD-FORMAT2 TO PC002-SORT-FIELD              02620080
026300         PERFORM 3000-WRITE-HEADER-RECORD                         02630087
026400      END-IF.                                                     02640069
026600                                                                  02660005
026610                                                                  02661087
026700 2140-GET-SCAC-TRAILER.                                           02670026
026800      MOVE PC002-PO-NBR                TO DK-PO-NBR.              02680080
027000      MOVE PC002-REC-SEQ-NBR           TO DK-REC-SEQ-NBR.         02700080
027200                                                                  02720077
027300      EXEC SQL                                                    02730053
027400                SELECT                                            02740053
027500                      C.OWNER_SCAC_ID                             02750053
027600                     ,C.VEH_NBR                                   02760053
027700                 INTO  :VHTRIP-OWNER-SCAC-ID                      02770043
027800                      ,:VHTRIP-VEH-NBR     :PV-NULL-IND           02780081
027900                FROM TSHPTPO A                                    02790044
028000                   , TSHIPMT B                                    02800044
028100                   , TVHTRIP C                                    02810044
028200                WHERE   A.PO_NBR         = :DK-PO-NBR             02820056
028300                   AND  A.REC_SEQ_NBR    = :DK-REC-SEQ-NBR        02830056
028400                   AND  A.SHIPT_ID       = B.SHIPT_ID             02840044
028500                   AND  B.TRIP_ID        = C.TRIP_ID              02850044
028600                   AND  A.PRIM_SHIPT_IND = 'Y'                    02860044
028610                   AND  C.VEH_NBR  IS NOT NULL                    02861095
028620                WITH UR                                           02862099
028700       END-EXEC.                                                  02870044
028800                                                                  02880044
028900       EVALUATE TRUE                                              02890044
029000            WHEN SQLCODE = ZERO                                   02900044
029010            WHEN SQLCODE = -811                                   02901096
029100                MOVE VHTRIP-OWNER-SCAC-ID  TO SCAC-2              02910067
029110                IF  PV-NULL-IND < +0                              02911089
029120                    MOVE 'NO TRAILER' TO TRAILER-NUMBER-2         02912089
029130                ELSE                                              02913089
029200                    MOVE VHTRIP-VEH-NBR TO TRAILER-NUMBER-2       02920089
029210                END-IF                                            02921090
029300            WHEN SQLCODE = +100                                   02930044
029400                MOVE '????'       TO SCAC-2                       02940044
029500                MOVE 'NO TRAILER' TO TRAILER-NUMBER-2             02950044
029600            WHEN OTHER                                            02960044
029610                MOVE  DK-PO-NBR        TO  PV-DISPLAY-PO          02961092
029620                MOVE  DK-REC-SEQ-NBR   TO  PV-DISPLAY-RECV        02962092
029700                MOVE '2140-GET-SCAC-TRAILER '                     02970044
029800                                  TO PV-ABEND-PARA-NAME           02980044
029900                MOVE 'SELECT SCAC ID'                             02990044
030000                                         TO PV-DB2-OPERATION-MSG-103000044
030010                STRING ' PO-RECV - '        DELIMITED BY SIZE     03001092
030020                       PV-DISPLAY-PO '-'    DELIMITED BY SIZE     03002092
030030                       PV-DISPLAY-RECV      DELIMITED BY SIZE     03003092
030040                                       INTO PV-DB2-OPERATION-MSG-203004092
030100                MOVE 'TSHPTPO'           TO PV-DB2-TABLE-NAME     03010044
030200                MOVE 'TSHIPMT'           TO PV-DB2-TABLE-NAME     03020044
030300                MOVE 'TVHTRIP'           TO PV-DB2-TABLE-NAME     03030044
030400                PERFORM 9998-SQL-ABEND                            03040087
030500        END-EVALUATE.                                             03050064
030600                                                                  03060064
030800                                                                  03080006
030900 3000-WRITE-HEADER-RECORD.                                        03090003
031200                                                                  03120003
031201*  THE FOLLOWING LOGIC WAS PUT INTO THE PROGRAM TO HELP THE       03120199
031202*  SAN BERNARDINO DC SORT THE FTLB SECTION OF THE STATUS          03120299
031203*  REPORT IN PO/RECEIVER SEQUENCE SO THEY COULD BETTER MANAGE     03120399
031204*  ALL OF THE FLOWBACK ORDERS.                                    03120499
031205*                                                                 03120599
031206*  MIGHT BE NEEDED AGAIN IN THE FUTURE.                           03120699
031207*                                                                 03120799
031210      IF  PC002-PROCESS-AREA = 'FLTB'                             03121099
031220      AND PC002-CURRENT-OPER = 855                                03122099
031230          MOVE '01/01/0001' TO                                    03123099
031240               PC002-REC-DATE.                                    03124099
031241      IF  PC002-PROCESS-AREA = 'FLTC'                             03124199
031242      AND PC002-CURRENT-OPER = 865                                03124299
031243          MOVE '01/01/0001' TO                                    03124399
031244               PC002-REC-DATE.                                    03124499
031245*     IF  PC002-PROCESS-AREA = 'FLTB'                             03124599
031246*     AND PC002-CURRENT-OPER = 860                                03124699
031247*         MOVE '01/01/0001' TO                                    03124799
031248*              PC002-REC-DATE.                                    03124899
031249      IF  PC002-PROCESS-AREA = 'FLTB'                             03124999
031250      AND PC002-CURRENT-OPER = 840                                03125099
031251          MOVE '01/01/0001' TO                                    03125199
031252               PC002-REC-DATE.                                    03125299
031253      IF  PC002-PROCESS-AREA = 'FLTC'                             03125399
031254      AND PC002-CURRENT-OPER = 840                                03125499
031255          MOVE '01/01/0001' TO                                    03125599
031256               PC002-REC-DATE.                                    03125699
031257*                                                                 03125799
031258*  THE ABOVE MIGHT BE NEEDED AGAIN IN THE FUTURE.                 03125899
031259*                                                                 03125999
031260                                                                  03126097
031300      WRITE TRLR-EXTRACT-OUT-RECORD     FROM                      03130004
031400                                    PC002-RECEIVER-EXT-RECORD.    03140006
031500      ADD  +1                    TO WS-RECORDS-WRITE-QTY.         03150003
031700                                                                  03170003
031701                                                                  03170187
031710 8000-READ-INPUT-FILE.                                            03171080
031720      INITIALIZE PC002-RECEIVER-EXT-RECORD.                       03172080
031730      READ EXTRACT-TRLR-FILE-IN  INTO                             03173080
031740                                  PC002-RECEIVER-EXT-RECORD       03174080
031750         AT END                                                   03175080
031760            SET PS-EOF TO TRUE                                    03176080
031770         NOT AT END                                               03177080
031780           ADD  +1                    TO WS-RECORDS-READ-QTY      03178080
031791      END-READ.                                                   03179180
031793                                                                  03179380
031794                                                                  03179487
031800 9998-SQL-ABEND.                                                  03180003
031900     MOVE SQLCODE     TO PV-SQLCODE.                              03190003
032000     DISPLAY '** ABEND           ** = SQLABEND'.                  03200003
032100     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          03210003
032200     DISPLAY '** PARAGRAPH       ** = ' PV-ABEND-PARA-NAME.       03220003
032300     DISPLAY '** TABLE AFFECTED  ** = ' PV-DB2-TABLE-NAME.        03230003
032400     DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.   03240003
032410     DISPLAY '**                 ** = ' PV-DB2-OPERATION-MSG-2.   03241093
032500     DISPLAY '** SQLCODE         ** = ' PV-SQLCODE.               03250003
032600     COPY DPPD004.                                                03260003
032700     MOVE +4013                  TO PV-ABEND-CODE.                03270003
032800     CALL 'ILBOABN0'   USING PV-ABEND-CODE.                       03280003
