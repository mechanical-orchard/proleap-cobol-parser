000100*-----------------------*                                         00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300*-----------------------*                                         00030001
000400 PROGRAM-ID.    CNKCS245.                                         00040001
000500 AUTHOR.        DENISE HAHN                                       00050001
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060001
000700 DATE-WRITTEN.  AUGUST, 2012                                      00070001
000800 DATE-COMPILED.                                                   00080001
000900*---------------------------------------------------------------* 00090001
001000*    Y245 - DC-INTEGRATION PARM DEFN(WST_ATTR_DEFN)ADD OR UPDATE  00100001
001100*    THIS PROGRAM WILL PROCESS THE CODE ADD, UPDATE.              00110001
001400*---------------------------------------------------------------* 00140001
263455* CHANGED 11/03/2021    BY JIM HUNTER      WR: CHG0263455         00141059
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00142059
263455* MAKING THE CALL DYNAMIC VS STATIC.                              00143059
263455*----------------------------------------------------------------*00144059
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961         00145060
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00146060
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00147060
CICS  *-----------------------------------------------------------------00148060
001500 ENVIRONMENT DIVISION.                                            00150001
001600 DATA DIVISION.                                                   00160001
001700                                                                  00170001
001800 WORKING-STORAGE SECTION.                                         00180001
001900                                                                  00190001
002000 01  DK-DB2-KEYS.                                                 00200001
002100     05  DK-PARM-CODE             PIC   X(10)       VALUE SPACES. 00210001
002110     05  DK-DEFN-SEQ              PIC  S9(4) COMP.                00211023
002200                                                                  00220001
002300 01  PC-PROGRAM-CONSTANTS.                                        00230001
002400     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'CNKCS245'.  00240001
002500     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'CNK245  '.  00250001
002600     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'CNKM245 '.  00260001
002700     05  PC-APPL-MAP              PIC S9(04)  VALUE  +1           00270001
002800                                              COMP.               00280001
002900     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00290001
003000                                              COMP.               00300001
003100     05  PC-INTER-APPL-CODES.                                     00310001
003300         10  PC-INTER-APPL-CRIT-SPEC-ADD  PIC  X(01)  VALUE '1'.  00330001
003400         10  PC-INTER-APPL-CODE-ADD       PIC  X(01)  VALUE '3'.  00340058
003410         10  PC-INTER-APPL-DEFN-LIST-ADD  PIC  X(01)  VALUE '4'.  00341058
003500         10  PC-INTER-APPL-DEFN-LIST-UPD  PIC  X(01)  VALUE '5'.  00350026
003600     05  PC-D                     PIC  X(01)  VALUE  'D'.         00360001
003700     05  PC-I                     PIC  X(01)  VALUE  'I'.         00370001
003800     05  PC-L                     PIC  X(01)  VALUE  'L'.         00380001
003900     05  PC-N                     PIC  X(01)  VALUE  'N'.         00390001
004000     05  PC-UPDATE-DEFN           PIC  X(02)  VALUE  'UD'.        00400053
004100     05  PC-SPACE                 PIC  X(03)  VALUE  '   '.       00410001
004200     05  PC-01                    PIC  X(02)  VALUE  '01'.        00420001
004300     05  PC-DC                    PIC  X(02)  VALUE  'DC'.        00430001
004400     05  PC-DS                    PIC  X(02)  VALUE  'DS'.        00440001
004500     05  PC-SH                    PIC  X(02)  VALUE  'SH'.        00450001
004600     05  PC-DEFAULT-TIMESTAMP     PIC  X(26)                      00460001
004700                          VALUE  '9999-09-09-09.09.09.999999'.    00470001
004800                                                                  00480001
004900*----------------------------------------------------------------*00490001
005000*  SYSTEM MESSAGES                                                00500001
005100*----------------------------------------------------------------*00510001
005200*   00005 - INVALID VALUE                                         00520001
005300*   00007 - REQUIRED ENTRY                                        00530001
005400*   00008 - MUST BE NUMERIC                                       00540001
005500*   00034 - ADD SUCCESSFUL                                        00550001
005600*   00045 - INVALID FUNCTION                                      00560001
005700*   00059 - UPDATE(S) SUCCESSFUL                                  00570001
005800*   00069 - TOP OF LIST                                           00580001
005900*   00070 - BOTTOM OF LIST                                        00590001
006000*   00115 - DELETE SUCCESSFUL                                     00600001
006100*   00354 - DELETE PENDING - PRESS PF2 TO CONFIRM                 00610001
006200*   00527 - TYPE CODE DOES NOT EXIST                              00620001
006300*   02571 - UNABLE TO UPD - CURRENT OPER UNT AND OPER UNIT ID ENTE00630001
006400*   02574 - UPDATE FUNCTION INVALID - DOOR IS CURRENTLY NOT DEFINE00640001
006500*   02575 - STORE ASSIGNMNT FUNCTION ONLY VALID FOR DOOR TYPES SHI00650001
006600*   02576 - UPDATING DOOR DEFINITION - PRESS F2 TO CONFIRM        00660001
006700*   02577 - CANNOT CHANGE DOOR TYPE - DOOR ASSIGNED TO A NON-STORE00670001
006800*   02578 - CANNOT CHANGE DOOR TYPE - DOOR ASSIGNED TO A NON-DC LO00680001
006900*   02579 - CANNOT CHANGE DOOR TYPE-DOOR CURRENTLY ASSIGNED TO A D00690001
007000*   02612 - YOU DO NOT HAVE AUTHORITY TO UPDATE                   00700001
007010*   02620 - DOORS SHARING SAME CONVEYOR DIVERT CANNOT HAVE SAME ST00701001
007020*   02936 - SHARED DIVERT & LANE ASSIGNMENT ONLY VALID FOR SHIPPIN00702001
007030*   03264 - LABEL SEQUENCE MUST BE UNIQUE - DOOR &VAR IS THIS SEQU00703001
007040*   03266 - DOOR LABEL SEQUENCE IS ONLY VALID FOR SHIPPING DOORS  00704001
007050*   03267 - SHIPPING DOOR LABEL SEQUENCE MUST BE GREATER THAN 0   00705001
007060*   03707 - ADD FUNCTION INVALID - FUNCTION CODE ALREADY DEFINED  00706001
007070*   03708 - UPDATE FUNCTION INVALID - FUNCTION CODE IS NOT DEFINED00707001
007080*   03709 - ADD FUNCTION INVALID - PARM CODE ALREADY DEFINED      00708001
007090*   03710 - UPDATE FUNCTION INVALID - PARM CODE IS NOT DEFINED    00709001
007100*   03721 - ADD PARM INVALID - CODE IS NOT DEFINED                00710001
007200*   03722 - UPDATE PARM INVALID - CODE IS NOT DEFINED             00720001
007300*   03724 - YOU DO NOT HAVE AUTHORITY TO ADD                      00730001
007400*   05046 - LAND ASSGNMT AND DIVERT LOCATION ID REQUIRED FOR SH   00740001
007500*   99901 - INVALID COMMAND WAS ENTERED                           00750001
007600*----------------------------------------------------------------*00760001
007700     05  PC-TSYMSG-NUMBERS.                                       00770001
007800         10  PC-TSYMSG-00005      PIC  9(05)  VALUE  00005.       00780001
007900         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       00790001
008000         10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       00800001
008100         10  PC-TSYMSG-00034      PIC  9(05)  VALUE  00034.       00810001
008200         10  PC-TSYMSG-00045      PIC  9(05)  VALUE  00045.       00820001
008300         10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       00830001
008400         10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.       00840001
008500         10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.       00850001
008600         10  PC-TSYMSG-00115      PIC  9(05)  VALUE  00115.       00860001
008700         10  PC-TSYMSG-00354      PIC  9(05)  VALUE  00354.       00870001
008800         10  PC-TSYMSG-00527      PIC  9(05)  VALUE  00527.       00880001
008900         10  PC-TSYMSG-02571      PIC  9(05)  VALUE  02571.       00890001
009000         10  PC-TSYMSG-02574      PIC  9(05)  VALUE  02574.       00900001
009100         10  PC-TSYMSG-02575      PIC  9(05)  VALUE  02575.       00910001
009200         10  PC-TSYMSG-02576      PIC  9(05)  VALUE  02576.       00920001
009300         10  PC-TSYMSG-02577      PIC  9(05)  VALUE  02577.       00930001
009400         10  PC-TSYMSG-02578      PIC  9(05)  VALUE  02578.       00940001
009500         10  PC-TSYMSG-02579      PIC  9(05)  VALUE  02579.       00950001
009600         10  PC-TSYMSG-02612      PIC  9(05)  VALUE  02612.       00960001
009700         10  PC-TSYMSG-02620      PIC  9(05)  VALUE  02620.       00970001
009800         10  PC-TSYMSG-02936      PIC  9(05)  VALUE  02936.       00980001
009900         10  PC-TSYMSG-02937      PIC  9(05)  VALUE  02937.       00990001
010000         10  PC-TSYMSG-03046      PIC  9(05)  VALUE  03046.       01000001
010100         10  PC-TSYMSG-03264      PIC  9(05)  VALUE  03264.       01010001
010200         10  PC-TSYMSG-03266      PIC  9(05)  VALUE  03266.       01020001
010300         10  PC-TSYMSG-03267      PIC  9(05)  VALUE  03267.       01030001
010400         10  PC-TSYMSG-03707      PIC  9(05)  VALUE  03707.       01040001
010500         10  PC-TSYMSG-03708      PIC  9(05)  VALUE  03708.       01050001
010600         10  PC-TSYMSG-03709      PIC  9(05)  VALUE  03709.       01060001
010610         10  PC-TSYMSG-03710      PIC  9(05)  VALUE  03710.       01061001
010620         10  PC-TSYMSG-03721      PIC  9(05)  VALUE  03721.       01062001
010630         10  PC-TSYMSG-03722      PIC  9(05)  VALUE  03722.       01063001
010640         10  PC-TSYMSG-03724      PIC  9(05)  VALUE  03724.       01064001
010650         10  PC-TSYMSG-99901      PIC  9(05)  VALUE  99901.       01065001
010660*                                                                 01066001
010670 01  PS-PROGRAM-SWITCHES.                                         01067001
010680     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         01068001
010690         88  PS-ERROR                         VALUE  'Y'.         01069001
010700         88  PS-NO-ERROR                      VALUE  'N'.         01070001
010800     05  PS-COMMAREA-SW           PIC  X(01)  VALUE  'N'.         01080001
010900         88  PS-COMMAREA-VALID                VALUE  'Y'.         01090001
011000         88  PS-COMMAREA-NOT-VALID            VALUE  'N'.         01100001
011100     05  PS-LIST-END-SW           PIC  X(01)  VALUE  'N'.         01110001
011200         88  PS-LIST-END                      VALUE  'Y'.         01120001
011300         88  PS-NO-LIST-END                   VALUE  'N'.         01130001
011400     05  PS-STORE-SW              PIC  X(01)  VALUE  'N'.         01140001
011500         88  PS-STORES-EXIST                  VALUE  'Y'.         01150001
011600         88  PS-NO-STORES-EXIST               VALUE  'N'.         01160001
011700     05  PS-DIVERT-SW             PIC  X(01)  VALUE  'N'.         01170001
011800         88  PS-DUP-DIVERT-EXIST              VALUE  'Y'.         01180001
011900         88  PS-NO-DUP-DIVERT-EXIST           VALUE  'N'.         01190001
012000     05  PS-DUPLICATE-STORE-SW    PIC  X(01)  VALUE  'N'.         01200001
012100         88  PS-DUP-STORE-ASGNMT              VALUE  'Y'.         01210001
012200         88  PS-NO-DUP-STORE-ASGNMT           VALUE  'N'.         01220001
012300     05  PS-LBL-SEQ-OPER-EXISTS-SW PIC X(01)  VALUE  'N'.         01230001
012400         88  PS-LBL-SEQ-OPER-EXISTS-YES       VALUE  'Y'.         01240001
012500         88  PS-LBL-SEQ-OPER-EXISTS-NO        VALUE  'N'.         01250001
012600     05  PS-TYPE-CHANGED-SW        PIC X(01)  VALUE  'N'.         01260001
012700         88  PS-TYPE-CHANGED-YES              VALUE  'Y'.         01270001
012800         88  PS-TYPE-CHANGED-NO               VALUE  'N'.         01280001
012900     05  PS-FUNCTION-ALLOWED-SW    PIC X(01)  VALUE  'N'.         01290001
013000         88  PS-FUNCTION-ALLOWED              VALUE  'Y'.         01300001
013100         88  PS-FUNCTION-NOT-ALLOWED         VALUE  'N'.          01310001
013200                                                                  01320001
013300 01  PV-PROGRAM-VARIABLES.                                        01330001
013400     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            01340001
013500                                              COMP SYNC.          01350001
013600     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            01360001
013700                                              COMP SYNC.          01370001
013800     05  PV-INPUT-SPACE-CNT       PIC S9(04)  VALUE +0            01380001
013900                                              COMP SYNC.          01390001
014000     05  PV-READ-COUNT            PIC S9(09)  VALUE +0            01400001
014100                                              COMP-3.             01410001
014200     05  PV-READ-STORES-COUNT     PIC S9(09)  VALUE +0            01420001
014300                                              COMP-3.             01430001
014400     05  PC-MAX-ITEMS             PIC S9(09)  VALUE +3            01440001
014500                                              COMP-3.             01450001
014600     05  PV-LANE-ASSGN-NUM        PIC  9(09)  VALUE ZEROES.       01460001
014700     05  PV-LABEL-SEQ             PIC S9(04) COMP.                01470001
014800     05  PV-LABEL-SEQ-COUNT       PIC S9(09)  VALUE +0            01480001
014900                                              COMP-3.             01490001
014910     05  PV-MAX-DEFN-SEQ-NBR      PIC  S9(4) COMP.                01491029
014920     05  PV-NEXT-DEFN-SEQ-NBR     PIC  S9(4) COMP.                01492029
014921                                                                  01492152
014922     05  PV-DEFN-DATA-TYPE        PIC   X(03) VALUE SPACES.       01492252
014930         88 PV-VALID-DATA-TYPE    VALUE 'STR' 'DTE' 'NUM'.        01493052
014970                                                                  01497052
014980                                                                  01498052
015000******************************************************************01500001
015100*PV-INP VARIABLES HOLD COMMAREA VALUES                            01510001
015200*       ONLY PV-INP VARIABLES READ FROM AND WRITE TO ASC-'S       01520001
015300******************************************************************01530001
015400     05  PV-INP-FUNCTION              PIC  X(01).                 01540001
015500     05  PV-INP-PARM-CODE             PIC  X(10).                 01550007
015600     05  PV-INP-PARM-DESC             PIC  X(50).                 01560007
015700     05  PV-INP-PARM-TYPE             PIC  X(10).                 01570007
015701*                                                                 01570107
015710     05  PV-INP-NEXT-DEFN-SEQ         PIC  9(04).                 01571007
015720     05  PV-INP-DEFN-DESCR            PIC  X(50).                 01572007
015730     05  PV-INP-DEFN-REQD             PIC  X(01).                 01573007
015740     05  PV-INP-DEFN-DATA-TYPE        PIC  X(03).                 01574007
015750     05  PV-INP-DEFN-DATA-LENG        PIC  9(04).                 01575007
015760     05  PV-INP-PARM-DEC-POS          PIC  9(04).                 01576007
015800                                                                  01580001
015900*----------------------------------------------------------------*01590001
016000**  SECURITY SUBROUTINE PARAMETERS                                01600001
016010*----------------------------------------------------------------*01601001
016020     COPY DPWS008.                                                01602001
016030                                                                  01603001
016040                                                                  01604001
016050*---------------------------------------------------------------* 01605001
016060* SELECTON QUEUE LAYOUT                                         * 01606001
016070*---------------------------------------------------------------* 01607001
016080     COPY CNWS026.                                                01608001
016090                                                                  01609001
016100*----------------------------------------------------------------*01610001
016200*    MAP LAYOUT                                                  *01620001
016300*----------------------------------------------------------------*01630001
016400     COPY CNKM245.                                                01640001
016500                                                                  01650001
016600*----------------------------------------------------------------*01660001
016700*    ATTRIBUTE SETTINGS COPYBOOK.                                *01670001
016800*----------------------------------------------------------------*01680001
016900     COPY DPWS015.                                                01690001
017000                                                                  01700001
017100*----------------------------------------------------------------*01710001
017200*    FUNCTION KEYS COPYBOOK                                      *01720001
017300*----------------------------------------------------------------*01730001
017400     COPY DPWS016.                                                01740001
017500                                                                  01750001
017600**--------------------------------------------------------------**01760001
017700** THE CVLLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01770001
017800** SUB-ROUTINE (DPKUT100).                                      **01780001
017900**--------------------------------------------------------------**01790001
018000     COPY DPWS010I.                                               01800001
018100                                                                  01810001
018200**--------------------------------------------------------------**01820001
018300** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS ARCHITECTURE*01830001
018400** APPLICATION PROGRAMMING INTERFACE MODULE.                    **01840060
018500**--------------------------------------------------------------**01850001
018600     COPY DPWS030.                                                01860001
CICS       COPY DPWS930.                                                01861060
018700                                                                  01870001
018800**--------------------------------------------------------------**01880001
018900*    STANDARD COMMAREA.                                           01890001
019000**--------------------------------------------------------------**01900001
019100     COPY DPWS020.                                                01910001
019200     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01920001
019300                                                                  01930001
019400*---------------------------------------------------------------* 01940001
019500* INTER-APPLICATION COMMAREA.                                     01950001
019600*   CNWS022 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 01960001
019700*             SPEC SCREEN.                                        01970001
019800*   CNWS025 - IS THE INPUT LAYOUT THAT WILL BE PASSED FROM        01980001
019900*             THE LIST SCREEN                                     01990001
020000*---------------------------------------------------------------* 02000001
020100                                                                  02010001
020200         10  INTER-APPL-COMM-AREA PIC X(200).                     02020001
020300     COPY CNWS022.                                                02030001
020400     COPY CNWS025.                                                02040001
020500***************************************************************** 02050001
020600*    SPECIFIC COMMMAREA FOR CNKCS245.                             02060001
020700***************************************************************** 02070001
020800         10  ASC-SPECIFIC-COMMAREA.                               02080001
020900             15  ASC-INT-APPL-FORMAT-IND   PIC  X(01).            02090001
021000             15  ASC-ACTION-SW          PIC X(03).                02100001
021100                 88  ASC-ADD            VALUE 'ADD'.              02110001
021200                 88  ASC-DELETE         VALUE 'DEL'.              02120001
021300                 88  ASC-UPDATE         VALUE 'UPD'.              02130001
021400             15  ASC-FUNCTION              PIC  X(02).            02140001
021500                 88  ASC-FUNCTION-NONE             VALUE ' '.     02150001
021600                 88  ASC-ADD-DEFN                  VALUE 'AD'.    02160007
021700                 88  ASC-UPD-DEFN                  VALUE 'UD'.    02170007
021710                                                                  02171007
021800             15  ASC-OPER-UNT-ID              PIC S9(04) COMP.    02180007
021900             15  ASC-OPER-UNT-NAME            PIC  X(25).         02190007
021910*                                                                 02191007
022000             15  ASC-PARM-NAME                PIC  X(10).         02200001
022100             15  ASC-PARM-DESC                PIC  X(50).         02210001
022200             15  ASC-PARM-FUNC                PIC  X(10).         02220001
022300*                                                                 02230001
022310             15  ASC-DEFN-SEQ                 PIC  9(04).         02231023
022320             15  ASC-DEFN-DESCR               PIC  X(50).         02232023
022330             15  ASC-DEFN-REQD                PIC  X(01).         02233023
022340             15  ASC-DEFN-DATA-TYPE           PIC  X(03).         02234023
022350             15  ASC-DEFN-DATA-LENG-X.                            02235041
022351                 20  ASC-DEFN-DATA-LENG       PIC  9(04).         02235140
022360             15  ASC-PARM-DEC-POS-X.                              02236041
022361                 20  ASC-PARM-DEC-POS         PIC  9(04).         02236140
022370*                                                                 02237007
022400             15  ASC-USE-SELECTION-QUEUE-IND                      02240001
022500                                           PIC  X(01).            02250001
022600                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 02260001
022700             15  ASC-SEL-QUEUE-NAME        PIC  X(08).            02270001
022800             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05)  COMP-3.    02280001
022900             15  ASC-NUMBER-OF-SELECTED-ITEMS                     02290001
023000                                           PIC S9(09)  COMP-3.    02300001
023100             15  ASC-ITEM-SUB                 PIC S9(04)  COMP    02310001
023200                                                          SYNC.   02320001
023300             15  ASC-SEL-SUB               PIC S9(04)  COMP.      02330001
023400             15  ASC-SEL-ITEM              PIC S9(04)  COMP.      02340001
023500             15  ASC-TEMP-QUEUE-UPDATE-SW  PIC  X(01).            02350001
023600                 88  ASC-UPDATE-TSQ                   VALUE 'Y'.  02360001
023700                 88  ASC-NO-TSQ-UPDATE                VALUE ' '.  02370001
023800                                                                  02380001
023900             15  ASC-WST00009-INSERTED-SW PIC  X(01).             02390001
024000                 88  ASC-WST00009-INSERTED            VALUE  'Y'. 02400001
024100                 88  ASC-WST00009-NOT-INSERTED        VALUE  'N'. 02410001
024200             15  ASC-WST00009-UPDATED-SW  PIC  X(01).             02420001
024300                 88  ASC-WST00009-UPDATED             VALUE  'Y'. 02430001
024400                 88  ASC-WST00009-NOT-UPDATED         VALUE  'N'. 02440001
024500             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         02450001
024600                 88  ASC-ITEMS-LEFT-ON-DB             VALUE 'Y'.  02460001
024700                 88  ASC-NO-ITEMS-LEFT-ON-DB          VALUE 'N'.  02470001
024800             15  ASC-F2-CONFIRM-SW            PIC  X(01).         02480001
024900                 88  ASC-F2-CONFIRM-YES               VALUE 'Y'.  02490001
025000                 88  ASC-F2-CONFIRM-NO                VALUE 'N'.  02500001
025100                                                                  02510001
025200*----------------------------------------------------------------*02520001
025300*    ABEND PROCESSING COPYBOOK.                                  *02530001
025400*----------------------------------------------------------------*02540001
025500     COPY DPWS013.                                                02550001
025600                                                                  02560001
025700*----------------------------------------------------------------*02570001
025800*    DB2 TABLE FOR PARM CODE - WST00009                           02580001
025900*----------------------------------------------------------------*02590001
026000     EXEC SQL                                                     02600001
026100          INCLUDE WST00009                                        02610001
026200     END-EXEC.                                                    02620001
026300                                                                  02630001
026400                                                                  02640001
026500*----------------------------------------------------------------*02650001
026600*    DB2 AREA FOR COMMUNICATIONS                                  02660001
026700*----------------------------------------------------------------*02670001
026800     EXEC SQL                                                     02680001
026900          INCLUDE SQLCA                                           02690001
027000     END-EXEC.                                                    02700001
027100                                                                  02710001
027200*----------------------------------------------------------------*02720001
027300 LINKAGE SECTION.                                                 02730001
027400                                                                  02740001
027500 01  DFHCOMMAREA.                                                 02750001
027600     05  FILLER                         OCCURS  1 TO 4072 TIMES   02760001
027700                                        DEPENDING ON EIBCALEN.    02770001
027800         10  FILLER                     PIC X.                    02780001
027900                                                                  02790001
028000 PROCEDURE DIVISION.                                              02800001
028100***************************************************************** 02810001
028200** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 02820001
028300** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 02830001
028400** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 02840001
028500**                                                             ** 02850001
028600** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 02860001
028700** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 02870001
028800***************************************************************** 02880001
028900 0000-MAIN-MODULE.                                                02890001
029000     INITIALIZE DP030-CICS-API-FIELDS.                            02900001
029100     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02910001
029200     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02920001
029300     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02930001
029400     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02940001
029500     MOVE LENGTH OF CNK245I        TO DP030-MAP-LENGTH (1).       02950001
029600     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02960001
029700     PERFORM 0001-CALL-CICS-ARCH-API.                             02970001
029800                                                                  02980001
029900     PERFORM 1000-CONTROL-PROCESSING                              02990001
030000                                                                  03000001
030100     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03010001
030200     PERFORM 0001-CALL-CICS-ARCH-API.                             03020001
030300                                                                  03030001
030400 0001-CALL-CICS-ARCH-API.                                         03040001
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03050060
030600                                    DFHCOMMAREA                   03060060
030700                                    DP030-CICS-API-FIELDS         03070060
030800                                    DP020-STANDARD-COMMAREA       03080060
030900                                    CNK245I.                      03090060
031000                                                                  03100001
031100     IF  DP030-RC-CALL-SUCCESSFUL                                 03110001
031200         CONTINUE                                                 03120001
031300     ELSE                                                         03130001
031400         SET DP013-NO-ROLLBACK                                    03140001
031500             DP013-XCTL-DISPLAY-RESTART                           03150001
031600             DP013-CICS-ABEND      TO TRUE                        03160001
031700         MOVE 'BEFORE 0000-MAIN-MODULE'                           03170001
031800                                   TO DP013-PARAGRAPH             03180001
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03181060
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03182060
032100         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      03210001
032200         PERFORM DP013-0000-PROCESS-ABEND                         03220001
032300     END-IF.                                                      03230001
032400*                                                                 03240001
032500*----------------------------------------------------------------*03250001
032600*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03260001
032700*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *03270001
032800*----------------------------------------------------------------*03280001
032900 1000-CONTROL-PROCESSING.                                         03290001
033000                                                                  03300001
033100     EVALUATE TRUE                                                03310001
033200         WHEN DP020-NEXT-ACT-INITIAL                              03320001
033300              INITIALIZE ASC-SPECIFIC-COMMAREA                    03330001
033400              PERFORM 1100-PROCESS-INTER-APPL-COMM                03340001
033500                                                                  03350001
033600              IF  PS-COMMAREA-NOT-VALID                           03360001
033700                  SET DP020-NEXT-ACT-APPL-ERROR TO TRUE           03370001
033800              ELSE                                                03380001
033900                  PERFORM 4000-BUILD-INITIAL-PANEL                03390001
034000                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            03400001
034100                  PERFORM 3200-RESET-ATTRIBUTES                   03410001
034200              END-IF                                              03420001
034300                                                                  03430001
034400         WHEN DP020-NEXT-ACT-READ-MAP                             03440001
034500             PERFORM 2000-PROCESS-PANEL                           03450001
034600*F3-END                                                           03460001
034700         WHEN DP020-NEXT-ACT-RETURN                               03470001
034800             PERFORM 4000-BUILD-INITIAL-PANEL                     03480001
034900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03490001
035000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03500001
035100             MOVE -1                   TO ADEFDSCL                03510015
035200                                                                  03520001
035300         WHEN OTHER                                               03530001
035400             SET DP013-LOGIC-ABEND TO TRUE                        03540001
035500             SET DP013-NO-ROLLBACK TO TRUE                        03550001
035600             MOVE '1000-CONTROL-PROCESSING'                       03560001
035700                                   TO DP013-PARAGRAPH             03570001
035800             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    03580001
035900                                   TO DP013-MESSAGE-TEXT(1)       03590001
036000             MOVE DP020-NEXT-APPL-ACTIVITY                        03600001
036100                                   TO DP013-MESSAGE-TEXT(2)       03610001
036200             PERFORM DP013-0000-PROCESS-ABEND                     03620001
036300     END-EVALUATE.                                                03630001
036400*                                                                 03640001
036500******************************************************************03650001
036600** DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE   **03660001
036700** INTER-APPLICATION FORMAT CODE.                               **03670001
036800******************************************************************03680001
036900 1100-PROCESS-INTER-APPL-COMM.                                    03690001
037000     INITIALIZE ASC-SPECIFIC-COMMAREA.                            03700001
037100     MOVE DP020-INT-APPL-FORMAT-IND                               03710001
037200                                   TO ASC-INT-APPL-FORMAT-IND.    03720001
037300                                                                  03730001
037400     SET PS-COMMAREA-VALID                                        03740001
037500         ASC-F2-CONFIRM-NO         TO TRUE.                       03750001
037600                                                                  03760001
037700*WHEN COMING FROM CRIT SPEC        (CNKCS243 - F17=ADD DEFN=1)    03770026
038010*WHEN COMING FROM CODE ADD         (CNKCS244 - F17=ADD DEFN=3)    03801058
038020*WHEN COMING FROM DEFN LIST        (CNKCS247 - F13=ADD DEFN=4)    03802058
038100     EVALUATE ASC-INT-APPL-FORMAT-IND                             03810001
038300         WHEN PC-INTER-APPL-CRIT-SPEC-ADD                         03830007
038310         WHEN PC-INTER-APPL-CODE-ADD                              03831058
038400         WHEN PC-INTER-APPL-DEFN-LIST-ADD                         03840020
038500             MOVE CN022-FUNCTION          TO ASC-FUNCTION         03850001
038510             MOVE CN022-OPER-UNT-ID       TO ASC-OPER-UNT-ID      03851007
038520             MOVE CN022-OPER-UNT-NAME     TO ASC-OPER-UNT-NAME    03852007
038600             MOVE CN022-PARM-NAME         TO ASC-PARM-NAME        03860001
038700             MOVE CN022-PARM-DESC         TO ASC-PARM-DESC        03870001
038800             MOVE CN022-PARM-FUNC         TO ASC-PARM-FUNC        03880001
039200             PERFORM 4500-MOVE-COMMAREA-TO-TEMP                   03920001
039300                                                                  03930001
039340                                                                  03934020
039400*WHEN COMING FROM DEFN LIST        (CNKCS247 - F15=UPD DEFN=5)    03940028
039500         WHEN PC-INTER-APPL-DEFN-LIST-UPD                         03950026
039600           IF CN025-NUMBER-OF-SELECTED-ITEMS > 0                  03960001
039700             SET ASC-USE-SELECTION-QUEUE TO TRUE                  03970001
039800             MOVE CN025-NUMBER-OF-SELECTED-ITEMS                  03980001
039900                                  TO ASC-NUMBER-OF-SELECTED-ITEMS 03990036
040000             MOVE CN025-NUMBER-OF-TS-ITEMS                        04000001
040100                                  TO ASC-NUMBER-OF-TS-ITEMS       04010036
040200             MOVE CN025-SEL-QUEUE-NAME                            04020001
040300                                  TO ASC-SEL-QUEUE-NAME           04030036
040310                                                                  04031007
040400             MOVE CN025-FUNCTION         TO ASC-FUNCTION          04040001
040410             MOVE CN025-FUNC-NAME        TO ASC-PARM-NAME         04041007
040420             MOVE CN025-FUNC-DESC        TO ASC-PARM-DESC         04042007
040430             MOVE CN025-APPL-FUNC        TO ASC-PARM-FUNC         04043007
040440                                                                  04044007
040500             MOVE 'UPD' TO  ASC-ACTION-SW                         04050001
040600             PERFORM 1120-PREPARE-LIST-ENTRY                      04060001
040700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04070001
040800             PERFORM 4500-MOVE-COMMAREA-TO-TEMP                   04080001
040900         END-IF                                                   04090001
041000     END-EVALUATE.                                                04100001
041100                                                                  04110001
041200*----------------------------------------------------------------*04120001
041300* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *04130001
041400* STORAGE QUEUE PASSED FROM THE LIST.                            *04140001
041500*----------------------------------------------------------------*04150001
041600 1120-PREPARE-LIST-ENTRY.                                         04160001
041700     MOVE CN026-MAX-ITEMS          TO ASC-SEL-SUB.                04170001
041800     MOVE ZERO                     TO ASC-SEL-ITEM.               04180001
041900     PERFORM 1130-GET-NEXT-RECORD.                                04190001
042000                                                                  04200001
042100*---------------------------------------------------------------- 04210001
042200*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*04220001
042300*---------------------------------------------------------------- 04230001
042400 1130-GET-NEXT-RECORD.                                            04240001
042410                                                                  04241035
042500     ADD +1                        TO ASC-SEL-SUB.                04250001
042600                                                                  04260001
042900     IF  ASC-SEL-SUB > CN026-MAX-ITEMS                            04290001
043000         ADD +1                    TO ASC-SEL-ITEM                04300001
043100         MOVE +1                   TO ASC-SEL-SUB                 04310001
043200     END-IF.                                                      04320001
043300                                                                  04330001
043400     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                04340001
043500         PERFORM 9100-READ-SEL-QUEUE                              04350001
043600         IF  CN026-ITEM (ASC-SEL-SUB) > ZERO                      04360001
043710             MOVE CN026-PARM-NAME(ASC-SEL-SUB) TO ASC-PARM-NAME   04371025
043800             MOVE CN026-PARM-DESC(ASC-SEL-SUB) TO ASC-PARM-DESC   04380025
043900             MOVE CN026-DEFN-SEQ (ASC-SEL-SUB) TO ASC-DEFN-SEQ    04390025
043910             MOVE CN026-ATTR-DESC(ASC-SEL-SUB) TO ASC-DEFN-DESCR  04391025
043920             MOVE CN026-REQD     (ASC-SEL-SUB) TO ASC-DEFN-REQD   04392025
043930             MOVE CN026-DATA-TYPE(ASC-SEL-SUB) TO                 04393025
043931                                              ASC-DEFN-DATA-TYPE  04393125
043940             MOVE CNO26-MAX-LENGTH(ASC-SEL-SUB) TO                04394025
043941                                              ASC-DEFN-DATA-LENG  04394125
043950             MOVE CNO26-DECIMAL-POSITION(ASC-SEL-SUB) TO          04395025
043951                                              ASC-PARM-DEC-POS    04395125
044000             SET CN026-INQ (ASC-SEL-SUB) TO TRUE                  04400001
044100             PERFORM 9200-REWRITE-SEL-QUEUE                       04410001
044200         ELSE                                                     04420001
044300             SUBTRACT +1 FROM ASC-SEL-SUB                         04430001
044400             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            04440001
044500             SET DP020-MSG-INFORMATIONAL                          04450001
044600                 PS-LIST-END       TO TRUE                        04460001
044700         END-IF                                                   04470001
044800     ELSE                                                         04480001
044900         SUBTRACT +1 FROM ASC-SEL-ITEM                            04490001
045000         MOVE CN026-MAX-ITEMS      TO ASC-SEL-SUB                 04500001
045100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            04510001
045200         SET DP020-MSG-INFORMATIONAL                              04520001
045300                 PS-LIST-END       TO TRUE                        04530001
045400     END-IF.                                                      04540001
045500                                                                  04550001
045600******************************************************************04560001
045700*  GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING         04570001
045800*  PROCESSED.                                                     04580001
045900******************************************************************04590001
046000 1140-GET-PREV-RECORD.                                            04600001
046100     SUBTRACT +1 FROM ASC-SEL-SUB.                                04610001
046200                                                                  04620001
046300     IF  ASC-SEL-SUB < +1                                         04630001
046400         SUBTRACT +1 FROM ASC-SEL-ITEM                            04640001
046500         MOVE CN026-MAX-ITEMS      TO ASC-SEL-SUB                 04650001
046600     END-IF.                                                      04660001
046700                                                                  04670001
046800     IF  ASC-SEL-ITEM > ZERO                                      04680001
046900         PERFORM 9100-READ-SEL-QUEUE                              04690001
047000         IF  CN026-ITEM (ASC-SEL-SUB) > ZERO                      04700001
047310             MOVE CN026-PARM-NAME(ASC-SEL-SUB) TO ASC-PARM-NAME   04731025
047320             MOVE CN026-PARM-DESC(ASC-SEL-SUB) TO ASC-PARM-DESC   04732025
047330             MOVE CN026-DEFN-SEQ (ASC-SEL-SUB) TO ASC-DEFN-SEQ    04733025
047391             MOVE CN026-ATTR-DESC(ASC-SEL-SUB) TO ASC-DEFN-DESCR  04739125
047392             MOVE CN026-REQD     (ASC-SEL-SUB) TO ASC-DEFN-REQD   04739225
047393             MOVE CN026-DATA-TYPE(ASC-SEL-SUB) TO                 04739325
047394                                              ASC-DEFN-DATA-TYPE  04739425
047395             MOVE CNO26-MAX-LENGTH(ASC-SEL-SUB) TO                04739525
047396                                              ASC-DEFN-DATA-LENG  04739625
047397             MOVE CNO26-DECIMAL-POSITION(ASC-SEL-SUB) TO          04739725
047398                                              ASC-PARM-DEC-POS    04739825
047400         END-IF                                                   04740001
047500                                                                  04750001
047600         SET CN026-INQ (ASC-SEL-SUB) TO TRUE                      04760001
047700         PERFORM 9200-REWRITE-SEL-QUEUE                           04770001
047800     ELSE                                                         04780001
047900         MOVE +1                   TO ASC-SEL-ITEM                04790001
048000                                      ASC-SEL-SUB                 04800001
048100         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            04810001
048200         SET DP020-MSG-INFORMATIONAL                              04820001
048300             PS-LIST-END             TO TRUE                      04830001
048400     END-IF.                                                      04840001
048500                                                                  04850001
048600*----------------------------------------------------------------*04860001
048700* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04870001
048800* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04880001
048900* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04890001
049000* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04900001
049100* FUNCTION KEYS CAN GET THIS FAR.                                *04910001
049200*----------------------------------------------------------------*04920001
049300 2000-PROCESS-PANEL.                                              04930001
049400                                                                  04940001
049500     EVALUATE TRUE                                                04950001
049600                                                                  04960001
049700         WHEN DP020-SRC-AID = DP016-CLEAR                         04970001
049800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04980001
049900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04990001
050000                                                                  05000001
050100*F5 REFRESH -                                                     05010001
050200         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     05020001
050300              SET  ASC-F2-CONFIRM-NO     TO  TRUE                 05030001
050400              PERFORM 4000-BUILD-INITIAL-PANEL                    05040001
050500              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                05050001
050600              PERFORM 3200-RESET-ATTRIBUTES                       05060001
050700                                                                  05070001
050800*F20-NEXT SEL                                                     05080001
050900         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             05090001
051000             MOVE DP020-INT-APPL-FORMAT-IND                       05100001
051100                                      TO ASC-INT-APPL-FORMAT-IND  05110001
051200             IF ASC-INT-APPL-FORMAT-IND = '5'                     05120056
051300               IF  ASC-USE-SELECTION-QUEUE                        05130001
051400                   PERFORM 1130-GET-NEXT-RECORD                   05140001
051500                   PERFORM 3000-EDIT-DATA-IN-COMMAREA             05150001
051600                   IF PS-LIST-END                                 05160001
051700                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       05170001
051800                       SET PS-NO-LIST-END TO TRUE                 05180001
051900                   ELSE                                           05190001
052000                       PERFORM 4000-BUILD-INITIAL-PANEL           05200001
052100                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       05210001
052200                       PERFORM 3200-RESET-ATTRIBUTES              05220001
052300                   END-IF                                         05230001
052400               ELSE                                               05240001
052500*                --- BOTTOM OF LIST ---                           05250001
052600                   MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER       05260001
052700                   SET DP020-MSG-INFORMATIONAL TO TRUE            05270001
052800               END-IF                                             05280001
052900           ELSE                                                   05290001
053000               MOVE PC-TSYMSG-00045 TO DP020-MSG-NUMBER           05300001
053100               SET DP020-MSG-FATAL TO TRUE                        05310001
053200           END-IF                                                 05320001
053300                                                                  05330001
053400*F19-PREV SEL                                                     05340001
053500         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             05350001
053600             MOVE DP020-INT-APPL-FORMAT-IND                       05360001
053700                                      TO ASC-INT-APPL-FORMAT-IND  05370001
053800             IF ASC-INT-APPL-FORMAT-IND = '5'                     05380056
053900                IF  ASC-USE-SELECTION-QUEUE                       05390001
054000                   PERFORM 1140-GET-PREV-RECORD                   05400001
054100                   PERFORM 3000-EDIT-DATA-IN-COMMAREA             05410001
054200                   IF PS-LIST-END                                 05420001
054300                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       05430001
054400                       SET PS-NO-LIST-END TO TRUE                 05440001
054500                   ELSE                                           05450001
054600                       PERFORM 4000-BUILD-INITIAL-PANEL           05460001
054700                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       05470001
054800                       PERFORM 3200-RESET-ATTRIBUTES              05480001
054900                   END-IF                                         05490001
055000               ELSE                                               05500001
055100                   MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER       05510001
055200                   SET DP020-MSG-INFORMATIONAL TO TRUE            05520001
055300               END-IF                                             05530001
055400           ELSE                                                   05540001
055500               MOVE PC-TSYMSG-00045 TO DP020-MSG-NUMBER           05550001
055600               SET DP020-MSG-FATAL TO TRUE                        05560001
055700           END-IF                                                 05570001
055800                                                                  05580001
055900         WHEN OTHER                                               05590001
056000             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05600001
056100             PERFORM 3200-RESET-ATTRIBUTES                        05610001
056200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05620001
056210                                                                  05621057
056300             IF  PS-NO-ERROR                                      05630057
056400                 PERFORM 4500-MOVE-COMMAREA-TO-TEMP               05640001
056500                 PERFORM 2100-CHECK-FUNCTION-KEY                  05650001
056600                 IF PS-NO-ERROR                                   05660001
056700                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         05670001
056800                     SET DP030-CONTINUE-GO TO TRUE                05680001
056900                 ELSE                                             05690001
057000                     SET DP030-OVERRIDE-GO TO TRUE                05700001
057100                 END-IF                                           05710001
057200             ELSE                                                 05720001
057300                 SET DP030-OVERRIDE-GO TO TRUE                    05730001
057400             END-IF                                               05740001
057500     END-EVALUATE.                                                05750001
057600                                                                  05760001
057700*----------------------------------------------------------------*05770001
057800* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *05780001
057900* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *05790001
058000* FROM THE CICS ARCHITECTURE API.                                *05800001
058100*----------------------------------------------------------------*05810001
058200 2100-CHECK-FUNCTION-KEY.                                         05820001
058300     EVALUATE TRUE                                                05830001
058400         WHEN DP020-SRC-AID = DP016-ENTER                         05840001
058500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05850001
058600                                                                  05860001
058700*-F02 = CONFIRM UPDATE                                            05870001
058800         WHEN DP020-FK-CONFIRM  (DP020-SRC-AID)  AND              05880001
058900              ASC-F2-CONFIRM-YES                                  05890001
059000                 IF  ASC-ACTION-SW = 'UPD'                        05900001
059100                     PERFORM 9100-READ-SEL-QUEUE                  05910001
059200                     SET CN026-UPD (ASC-SEL-SUB) TO TRUE          05920001
059300                     MOVE ASC-PARM-NAME                           05930001
059400                                  TO CN026-PARM-NAME (ASC-SEL-SUB)05940001
059500                     MOVE ASC-PARM-DESC                           05950001
059600                                  TO CN026-PARM-DESC (ASC-SEL-SUB)05960001
059810                     MOVE ASC-DEFN-SEQ                            05981027
059811                                  TO CN026-DEFN-SEQ (ASC-SEL-SUB) 05981127
059820                     MOVE ASC-DEFN-DESCR                          05982027
059821                                  TO CN026-ATTR-DESC(ASC-SEL-SUB) 05982127
059830                     MOVE ASC-DEFN-REQD                           05983027
059831                                  TO CN026-REQD     (ASC-SEL-SUB) 05983127
059850                     MOVE ASC-DEFN-DATA-TYPE                      05985027
059851                                  TO CN026-DATA-TYPE(ASC-SEL-SUB) 05985127
059870                     MOVE ASC-DEFN-DATA-LENG                      05987027
059871                                  TO CNO26-MAX-LENGTH(ASC-SEL-SUB)05987127
059890                     MOVE ASC-PARM-DEC-POS                        05989027
059891                            TO CNO26-DECIMAL-POSITION(ASC-SEL-SUB)05989127
059900                     PERFORM 9200-REWRITE-SEL-QUEUE               05990001
060000                 END-IF                                           06000001
060100                                                                  06010001
060200                 IF  PS-NO-ERROR                                  06020001
060300                     PERFORM 5100-PROCESS-UPDATE                  06030001
060400                     IF  PS-NO-ERROR                              06040001
060500                         PERFORM 2110-PREPARE-INTER-APPL-COMM     06050001
060600                     END-IF                                       06060001
060700                 END-IF                                           06070001
060800                                                                  06080001
060900*-F13 = ADD DEFN                                                  06090009
061000         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              06100001
061100              SET ASC-ADD-DEFN  TO TRUE                           06110008
064800            SET  PS-FUNCTION-NOT-ALLOWED  TO  TRUE                06480001
064900            MOVE 'CNACODE '              TO DP008-FUNCTION-NAME   06490001
065000            PERFORM 2105-RACF-ACCESS                              06500001
065100            IF  PS-FUNCTION-ALLOWED                               06510001
065200                CONTINUE                                          06520001
065300            ELSE                                                  06530001
065400                SET PS-ERROR                                      06540001
065500                    DP020-MSG-FATAL         TO TRUE               06550001
065510                MOVE PC-TSYMSG-03724        TO DP020-MSG-NUMBER   06551001
065520                MOVE DP015-UNP-ALP-BRT-OFF  TO ADEFDSCA           06552015
065530                MOVE DP015-RED              TO APRMNMEC           06553015
065540                MOVE DP015-REVERSE          TO APRMNMEH           06554015
065550                MOVE -1                     TO ADEFDSCL           06555015
065560                SET DP030-SET-CURSOR-APPL-1 TO TRUE               06556001
065561            END-IF                                                06556101
065562                                                                  06556201
065563           IF  PS-NO-ERROR                                        06556301
065564               PERFORM 5000-PROCESS-ADD                           06556401
065565               IF  PS-NO-ERROR                                    06556501
065566                   PERFORM 2110-PREPARE-INTER-APPL-COMM           06556601
065570                   MOVE DP015-PRO-NOR-OFF        TO ADEFDSCA      06557005
065572                                                    ADATTYPA      06557202
065573                                                    ADATLENA      06557350
065574                                                    ADECPOSA      06557402
065575                   MOVE DP015-PRO-NOR-MDT        TO AREDFLDA      06557542
065576                   MOVE DP015-BLUE               TO APRMNMEC      06557602
065580                                                    APRMDSCC      06558001
065590                                                    ADEFSEQC      06559002
065591                                                    ADEFDSCC      06559102
065592                                                    AREDFLDC      06559202
065593                                                    ADATTYPC      06559302
065594                                                    ADATLENC      06559402
065595                                                    ADECPOSC      06559502
065800                  MOVE DP015-HL-OFF             TO  ADEFSEQH      06580005
065810                                                    ADEFDSCH      06581002
065820                                                    AREDFLDH      06582002
065830                                                    ADATTYPH      06583002
065840                                                    ADATLENH      06584002
065850                                                    ADECPOSH      06585002
065900               END-IF                                             06590001
066000           END-IF                                                 06600001
066100                                                                  06610001
066200*-F15 = UPDATE DEFN CODE                                          06620009
066300         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              06630001
066400              SET ASC-UPD-DEFN      TO TRUE                       06640008
066500              SET ASC-F2-CONFIRM-NO TO TRUE                       06650001
066600                                                                  06660001
070300            SET  PS-FUNCTION-NOT-ALLOWED  TO  TRUE                07030001
070400            MOVE 'CNUCODE '              TO DP008-FUNCTION-NAME   07040001
070500            PERFORM 2105-RACF-ACCESS                              07050001
070600            IF  PS-FUNCTION-ALLOWED                               07060001
070700                CONTINUE                                          07070001
070800            ELSE                                                  07080001
070900                SET PS-ERROR                                      07090001
071000                    DP020-MSG-FATAL         TO TRUE               07100001
071010                MOVE PC-TSYMSG-02612        TO DP020-MSG-NUMBER   07101001
071020                MOVE DP015-UNP-ALP-BRT-OFF  TO ADEFDSCA           07102005
071030                MOVE DP015-RED              TO ADEFDSCC           07103005
071040                MOVE DP015-REVERSE          TO ADEFDSCH           07104005
071050                MOVE -1                     TO ADEFDSCL           07105005
071060                SET DP030-SET-CURSOR-APPL-1 TO TRUE               07106001
071070            END-IF                                                07107001
071080                                                                  07108001
071090                                                                  07109001
071100             IF  PS-NO-ERROR                                      07110001
071200                 SET ASC-F2-CONFIRM-YES      TO TRUE              07120001
071300                 SET PS-ERROR                TO TRUE              07130001
071400                 SET DP020-MSG-FATAL         TO TRUE              07140001
071500                 MOVE PC-TSYMSG-02576        TO DP020-MSG-NUMBER  07150001
071600***              MOVE DP015-PRO-NOR-OFF      TO ADEFDSCA          07160054
071700***              MOVE DP015-BLUE             TO ADEFDSCC          07170054
071800                 MOVE -1                     TO ADEFDSCL          07180017
071900                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              07190001
072000            END-IF                                                07200001
072100                                                                  07210001
075200         WHEN DP020-FK-CONFIRM  (DP020-SRC-AID) AND               07520001
075300              ASC-F2-CONFIRM-NO                                   07530001
075400                  MOVE PC-TSYMSG-00045 TO DP020-MSG-NUMBER        07540001
075500                  SET DP020-MSG-FATAL TO TRUE                     07550001
075600                                                                  07560001
075700         WHEN OTHER                                               07570001
075800              SET DP013-NO-ROLLBACK                               07580001
075900                  DP013-XCTL-DISPLAY-RESTART                      07590001
076000                  DP013-CICS-ABEND      TO TRUE                   07600001
076100              MOVE '2000-PROCESS-PANEL' TO DP013-PARAGRAPH        07610001
076200              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'     07620001
076300                                    TO DP013-MESSAGE-TEXT (1)     07630001
076400              PERFORM DP013-0000-PROCESS-ABEND                    07640001
076500                                                                  07650001
076600     END-EVALUATE.                                                07660001
076700                                                                  07670001
076800                                                                  07680001
076900*----------------------------------------------------------------*07690001
077000* CHECK TO SEE IF USER HAS RACF AUTHORIZATION FOR FUNCTION       *07700001
077100*----------------------------------------------------------------*07710001
077200 2105-RACF-ACCESS.                                                07720001
077300                                                                  07730001
077400      SET DP008-RSRC-TYPE-FUNC           TO TRUE                  07740001
077500      SET DP008-ACCESS-TYPE-USE          TO TRUE                  07750001
077600                                                                  07760001
077700      EXEC CICS                                                   07770001
077800         LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                 07780001
077810              COMMAREA (DP008-SECURITY-COMMAREA)                  07781001
077820              LENGTH (DP008-SECURITY-COMMAREA-LENGTH)             07782001
077830      END-EXEC                                                    07783001
077840                                                                  07784001
077850      IF DP008-CALL-SUCCESSFUL                                    07785001
077860         IF DP008-ACCESS-ALLOWED                                  07786001
077870             SET PS-FUNCTION-ALLOWED TO TRUE                      07787001
077880         ELSE                                                     07788001
077890             SET PS-FUNCTION-NOT-ALLOWED TO TRUE                  07789001
077900         END-IF                                                   07790001
077901     ELSE                                                         07790101
077902         MOVE '2105-RACF-ACCESS'                                  07790201
077903                               TO DP013-PARAGRAPH                 07790301
077904          MOVE 'UNABLE TO ACCESS CICS'                            07790401
077905                               TO DP013-MESSAGE-TEXT (1)          07790501
077906          MOVE SQLCA                 TO DP013-SQLCA               07790601
077907          SET DP013-DB2-ABEND                                     07790701
077908              DP013-XCTL-DISPLAY-RESTART                          07790801
077909                               TO TRUE                            07790901
077910          PERFORM DP013-0000-PROCESS-ABEND                        07791001
077911      END-IF.                                                     07791101
077912                                                                  07791201
077913                                                                  07791301
077914******************************************************************07791401
077915** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **07791501
077916** INTER-APPLICATION COMMAREA.                                  **07791601
077917******************************************************************07791701
077918 2110-PREPARE-INTER-APPL-COMM.                                    07791801
077919                                                                  07791901
077920     INITIALIZE CN022-INTER-APPL-COMMAREA.                        07792001
077930                                                                  07793001
077940     MOVE ASC-FUNCTION             TO CN022-FUNCTION.             07794001
077950     MOVE ASC-PARM-NAME            TO CN022-PARM-NAME.            07795001
077960     MOVE ASC-PARM-DESC            TO CN022-PARM-DESC.            07796001
077980                                                                  07798001
077990*----------------------------------------------------------------*07799001
078000* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS   *07800001
078100* IN THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN   *07810001
078200* THE APPLICATION-SPECIFIC COMMAERA, NOT ON THE SCREEN.          *07820001
078300* THIS PARAGRAPH DOES NOT USE TEMPORARY VARIABLES.               *07830001
078400*----------------------------------------------------------------*07840001
078500 2200-MOVE-SCREEN-TO-COMMAREA.                                    07850001
078600                                                                  07860039
078700*PARM CODE                                                        07870001
078800     IF  APRMNMEL > ZERO                                          07880001
078900         MOVE APRMNMEI             TO ASC-PARM-NAME               07890001
079000         MOVE ASC-PARM-NAME        TO PV-INP-PARM-CODE            07900001
079100     ELSE                                                         07910001
079200         IF  APRMNMEF = DP015-ERASE-EOF                           07920001
079300             MOVE SPACES           TO ASC-PARM-NAME               07930001
079400         END-IF                                                   07940001
079500     END-IF.                                                      07950001
079600                                                                  07960001
079700*PARM DESCRIPTION                                                 07970001
079800     IF  APRMDSCL > ZERO                                          07980001
079900         MOVE APRMDSCI             TO ASC-PARM-DESC               07990001
080000     ELSE                                                         08000001
080100         IF  APRMDSCF = DP015-ERASE-EOF                           08010001
080200             MOVE SPACES           TO ASC-PARM-DESC               08020001
080300         END-IF                                                   08030001
080400     END-IF.                                                      08040001
080500                                                                  08050001
080501*ATTRIBUTE DEFINITION SEQ                                         08050139
080502     IF  ADEFSEQL > ZERO                                          08050239
080503         MOVE ADEFSEQI             TO ASC-DEFN-SEQ                08050339
080504         MOVE ASC-DEFN-SEQ         TO PV-INP-NEXT-DEFN-SEQ        08050439
080505     ELSE                                                         08050539
080506         IF  ADEFSEQF = DP015-ERASE-EOF                           08050639
080507             MOVE ZEROES           TO ASC-DEFN-SEQ                08050741
080508         END-IF                                                   08050839
080509     END-IF.                                                      08050939
080510                                                                  08051039
080511*ATTRIBUTE DEFINITION DESCRIPTION                                 08051139
080512     IF  ADEFDSCL > ZERO                                          08051239
080513         MOVE ADEFDSCI             TO ASC-DEFN-DESCR              08051339
080514         MOVE ASC-DEFN-DESCR       TO PV-INP-DEFN-DESCR           08051439
080515     ELSE                                                         08051539
080516         IF  ADEFDSCF = DP015-ERASE-EOF                           08051639
080517             MOVE SPACES           TO ASC-DEFN-DESCR              08051739
080518         END-IF                                                   08051839
080519     END-IF.                                                      08051939
080520                                                                  08052039
080521*ATTRIBUTE REQUIRED INDICATOR                                     08052139
080522     IF  AREDFLDL > ZERO                                          08052239
080523         MOVE AREDFLDI             TO ASC-DEFN-REQD               08052339
080524         MOVE ASC-DEFN-REQD        TO PV-INP-DEFN-REQD            08052439
080525     ELSE                                                         08052539
080526         IF  AREDFLDF = DP015-ERASE-EOF                           08052639
080527             MOVE 'R'              TO ASC-DEFN-REQD               08052741
080528         ELSE                                                     08052843
080529             MOVE 'R'              TO ASC-DEFN-REQD               08052943
080530         END-IF                                                   08053043
080531     END-IF.                                                      08053139
080532                                                                  08053239
080533*ATTRIBUTE DATA TYPE                                              08053339
080534     IF  ADATTYPL > ZERO                                          08053439
080535         MOVE ADATTYPI             TO ASC-DEFN-DATA-TYPE          08053539
080536         MOVE ASC-DEFN-DATA-TYPE   TO PV-INP-DEFN-DATA-TYPE       08053639
080537     ELSE                                                         08053739
080538         IF  ADATTYPF = DP015-ERASE-EOF                           08053839
080539             MOVE SPACES           TO ASC-DEFN-DATA-TYPE          08053939
080540         END-IF                                                   08054039
080541     END-IF.                                                      08054139
080542                                                                  08054239
080543*ATTRIBUTE DATA LENGTH                                            08054339
080544     IF  ADATLENL > ZERO                                          08054439
080545         MOVE ADATLENI             TO ASC-DEFN-DATA-LENG          08054539
080546         MOVE ASC-DEFN-DATA-LENG   TO PV-INP-DEFN-DATA-LENG       08054639
080547     ELSE                                                         08054739
080548         IF  ADATLENF = DP015-ERASE-EOF                           08054839
080549             MOVE ZEROES           TO ASC-DEFN-DATA-LENG          08054941
080550         END-IF                                                   08055039
080551     END-IF.                                                      08055139
080552                                                                  08055239
080553*ATTRIBUTE DECIMAL POSITIONS                                      08055339
080554     IF  ADECPOSL > ZERO                                          08055439
080555         MOVE ADECPOSI             TO ASC-PARM-DEC-POS            08055539
080556         MOVE ASC-PARM-DEC-POS     TO PV-INP-PARM-DEC-POS         08055639
080557     ELSE                                                         08055739
080558         IF  ADECPOSF = DP015-ERASE-EOF                           08055839
080559             MOVE ZEROES           TO ASC-PARM-DEC-POS            08055941
080560         END-IF                                                   08056039
080561     END-IF.                                                      08056139
080562                                                                  08056239
080570                                                                  08057039
081600*----------------------------------------------------------------*08160001
081700* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *08170001
081800* IS FOUND, THE CURSOR IS POSITIONED AT THAT FIELD AND AN        *08180001
081900* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *08190001
082000*----------------------------------------------------------------*08200001
082100 3000-EDIT-DATA-IN-COMMAREA.                                      08210001
082200                                                                  08220001
082300     IF  ASC-PARM-NAME  >  SPACES                                 08230001
082400         PERFORM 3040-CHECK-4-ROW-ON-WST00009                     08240001
082500     ELSE                                                         08250001
082600         SET PS-ERROR                                             08260001
082700             DP020-MSG-FATAL         TO TRUE                      08270001
082800         MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER          08280001
083000         MOVE DP015-RED              TO APRMNMEC                  08300001
083100         MOVE DP015-REVERSE          TO APRMNMEH                  08310001
083300         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      08330001
083400     END-IF.                                                      08340001
083500                                                                  08350001
083600     IF  PS-NO-ERROR                                              08360001
083700         IF  ASC-PARM-DESC  >  SPACES                             08370001
083800             CONTINUE                                             08380001
083900         ELSE                                                     08390001
084000             SET PS-ERROR                                         08400001
084100                 DP020-MSG-FATAL         TO TRUE                  08410001
084200             MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      08420001
084400             MOVE DP015-RED              TO APRMDSCC              08440001
084500             MOVE DP015-REVERSE          TO APRMDSCH              08450001
084600             MOVE -1                     TO ADEFDSCL              08460017
084800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08480001
084900     END-IF.                                                      08490001
085000                                                                  08500001
085010     IF  PS-NO-ERROR                                              08501028
085100         EVALUATE ASC-INT-APPL-FORMAT-IND                         08510032
085200             WHEN PC-INTER-APPL-CRIT-SPEC-ADD                     08520031
085210             WHEN PC-INTER-APPL-CODE-ADD                          08521058
085300             WHEN PC-INTER-APPL-DEFN-LIST-ADD                     08530031
085310                  PERFORM 3045-GET-NEXT-SEQ-NBR                   08531028
085320                  MOVE PV-NEXT-DEFN-SEQ-NBR  TO  ASC-DEFN-SEQ     08532033
086420         END-EVALUATE                                             08642028
086422     END-IF.                                                      08642228
086430                                                                  08643028
086440                                                                  08644047
086450     EVALUATE TRUE                                                08645047
086451         WHEN DP020-FK-CONFIRM  (DP020-SRC-AID)                   08645147
086452         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              08645247
086453         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              08645347
086495         IF  ASC-DEFN-SEQ = ZEROES                                08649547
086496             SET PS-ERROR                                         08649647
086497                 DP020-MSG-FATAL         TO TRUE                  08649747
086498             MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      08649847
086499             MOVE DP015-RED              TO ADEFSEQC              08649947
086500             MOVE DP015-REVERSE          TO ADEFSEQH              08650047
086501             MOVE -1                     TO ADEFDSCL              08650147
086502             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08650247
086503         END-IF                                                   08650347
086504                                                                  08650447
086505         IF  ASC-DEFN-DESCR    = SPACES                           08650547
086506             SET PS-ERROR                                         08650647
086507                 DP020-MSG-FATAL         TO TRUE                  08650747
086508             MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      08650847
086509             MOVE DP015-UNP-ALP-BRT-OFF  TO ADEFDSCA              08650947
086510             MOVE DP015-RED              TO ADEFDSCC              08651047
086511             MOVE DP015-REVERSE          TO ADEFDSCH              08651147
086512             MOVE -1                     TO ADEFDSCL              08651247
086513             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08651347
086514         END-IF                                                   08651447
086515                                                                  08651547
086516         IF  ASC-DEFN-REQD     = SPACES                           08651647
086517             SET PS-ERROR                                         08651747
086518                 DP020-MSG-FATAL         TO TRUE                  08651847
086519             MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      08651947
086520             MOVE DP015-RED              TO AREDFLDC              08652047
086521             MOVE DP015-REVERSE          TO AREDFLDH              08652147
086522             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08652247
086523         END-IF                                                   08652347
086524                                                                  08652447
086525         IF  ASC-DEFN-DATA-TYPE = SPACES                          08652547
086526             SET PS-ERROR                                         08652647
086527                 DP020-MSG-FATAL         TO TRUE                  08652747
086528             MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      08652847
086529             MOVE DP015-UNP-ALP-BRT-OFF  TO ADATTYPA              08652947
086530             MOVE DP015-RED              TO ADATTYPC              08653047
086531             MOVE DP015-REVERSE          TO ADATTYPH              08653147
086532             MOVE -1                     TO ADATTYPL              08653247
086533             MOVE +1                     TO ADATTYPL              08653347
086534             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08653447
086535         ELSE                                                     08653552
086536             MOVE  ASC-DEFN-DATA-TYPE    TO PV-DEFN-DATA-TYPE     08653652
086537             IF  PV-VALID-DATA-TYPE                               08653752
086538                 CONTINUE                                         08653852
086539             ELSE                                                 08653952
086540                 SET PS-ERROR                                     08654052
086541                     DP020-MSG-FATAL   TO TRUE                    08654152
086542                 MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER        08654252
086543                 MOVE DP015-UNP-ALP-BRT-OFF                       08654352
086544                                       TO ADATTYPA                08654452
086545                 MOVE DP015-RED        TO ADATTYPC                08654552
086546                 MOVE DP015-REVERSE    TO ADATTYPH                08654652
086547                 MOVE -1               TO ADATTYPL                08654752
086548                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              08654852
086549             END-IF                                               08654952
086550         END-IF                                                   08655047
086551                                                                  08655147
086552         IF  ASC-DEFN-DATA-LENG    = ZEROES  OR                   08655247
086553             ASC-DEFN-DATA-LENG-X  = SPACES                       08655347
086554             SET PS-ERROR                                         08655447
086555                 DP020-MSG-FATAL         TO TRUE                  08655547
086556             MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      08655647
086557             MOVE DP015-UNP-NUM-BRT-OFF  TO ADATLENA              08655750
086558             MOVE DP015-RED              TO ADATLENC              08655847
086559             MOVE DP015-REVERSE          TO ADATLENH              08655947
086560             MOVE -1                     TO ADATLENL              08656047
086561             MOVE +1                     TO ADATLENL              08656147
086562             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08656247
086563         ELSE                                                     08656347
086564             MOVE ASC-DEFN-DATA-LENG-X TO DP010I-UNEDITED-FIELD   08656447
086565             MOVE LENGTH OF ASC-DEFN-DATA-LENG                    08656547
086566                                     TO DP010I-MAXIMUM-DIGITS     08656647
086567             MOVE ZERO              TO DP010I-MAXIMUM-DECIMALS    08656748
086568             SET DP010I-NEGATIVE-NOT-ALLOWED                      08656847
086569                                     TO TRUE                      08656947
263455             CALL DP010I-NUMERIC-EDIT-ROUTINE                     08657159
263455                  USING DP010I-NUMERIC-EDIT-AREA                  08657259
086571             IF  DP010I-ERROR-DETECTED                            08657347
086572                 SET PS-ERROR                                     08657447
086573                     DP020-MSG-FATAL TO  TRUE                     08657547
086574                 MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER  08657647
086575                 MOVE DP015-UNP-NUM-BRT-OFF  TO ADATLENA          08657750
086576                 MOVE DP015-RED              TO ADATLENC          08657847
086577                 MOVE DP015-REVERSE          TO ADATLENH          08657947
086578                 MOVE -1                     TO ADATLENL          08658047
086579                 MOVE +1                     TO ADATLENL          08658147
086580                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              08658247
086581             END-IF                                               08658347
086582         END-IF                                                   08658447
086583                                                                  08658547
086584         IF  ASC-DEFN-DATA-TYPE = 'NUM'                           08658647
086585             IF  ASC-PARM-DEC-POS-X   = SPACES                    08658747
086586                 SET PS-ERROR                                     08658847
086587                     DP020-MSG-FATAL         TO TRUE              08658947
086588                 MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER  08659047
086589                 MOVE DP015-UNP-ALP-BRT-OFF  TO ADECPOSA          08659147
086590                 MOVE DP015-RED              TO ADECPOSC          08659247
086591                 MOVE DP015-REVERSE          TO ADECPOSH          08659347
086592                 MOVE -1                     TO ADECPOSL          08659447
086593                 MOVE +1                     TO ADECPOSL          08659547
086594                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              08659647
086595             ELSE                                                 08659747
086596                 MOVE ASC-PARM-DEC-POS-X TO DP010I-UNEDITED-FIELD 08659847
086597                 MOVE LENGTH OF ASC-PARM-DEC-POS                  08659947
086598                                         TO DP010I-MAXIMUM-DIGITS 08660047
086599                 MOVE ZERO             TO DP010I-MAXIMUM-DECIMALS 08660148
086600                 SET DP010I-NEGATIVE-NOT-ALLOWED                  08660247
086601                                         TO TRUE                  08660347
263455                 CALL DP010I-NUMERIC-EDIT-ROUTINE                 08660559
263455                      USING DP010I-NUMERIC-EDIT-AREA              08660659
086603                 IF  DP010I-ERROR-DETECTED                        08660747
086604                     SET PS-ERROR                                 08660847
086605                         DP020-MSG-FATAL TO  TRUE                 08660947
086606                     MOVE PC-TSYMSG-00008    TO DP020-MSG-NUMBER  08661048
086607                     MOVE DP015-UNP-ALP-BRT-OFF  TO ADECPOSA      08661147
086608                     MOVE DP015-RED              TO ADECPOSC      08661247
086609                     MOVE DP015-REVERSE          TO ADECPOSH      08661347
086610                     MOVE -1                     TO ADECPOSL      08661447
086611                     MOVE +1                     TO ADECPOSL      08661547
086612                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          08661647
086613                 END-IF                                           08661747
086614             END-IF                                               08661847
086615         END-IF                                                   08661947
086616     END-EVALUATE.                                                08662047
086617                                                                  08662147
086618                                                                  08662247
086620******************************************************************08663001
086700** A ROW MUST EXIST ON WST00009.                                  08670001
086800******************************************************************08680001
086900 3040-CHECK-4-ROW-ON-WST00009.                                    08690001
087000      MOVE ASC-PARM-NAME     TO DK-PARM-CODE.                     08700001
087010      MOVE ASC-DEFN-SEQ      TO DK-DEFN-SEQ.                      08701023
087100                                                                  08710001
087200        EXEC SQL                                                  08720001
087300          SELECT                                                  08730001
087400                  INTGRTN_TYP_CDE                                 08740001
087500                 ,ATTR_DEFN_SEQ_NBR                               08750001
087600                 ,ATTR_DEFN_DESC                                  08760001
087610                 ,REQR_IND                                        08761001
087620                 ,DATYP_CDE                                       08762001
087630                 ,MAX_LEN_QTY                                     08763001
087640                 ,MAX_PCSN_QTY                                    08764001
087700            INTO                                                  08770001
087800                 :WST00009-INTGRTN-TYP-CDE                        08780001
087900                ,:WST00009-ATTR-DEFN-SEQ-NBR                      08790001
088000                ,:WST00009-ATTR-DEFN-DESC                         08800001
088010                ,:WST00009-REQR-IND                               08801001
088020                ,:WST00009-DATYP-CDE                              08802001
088030                ,:WST00009-MAX-LEN-QTY                            08803001
088040                ,:WST00009-MAX-PCSN-QTY                           08804001
088100            FROM  WST_ATTR_DEFN                                   08810001
088200           WHERE  INTGRTN_TYP_CDE   = :DK-PARM-CODE               08820023
088210             AND  ATTR_DEFN_SEQ_NBR = :DK-DEFN-SEQ                08821024
088300        END-EXEC                                                  08830001
088400                                                                  08840001
088500        EVALUATE TRUE                                             08850001
088600            WHEN SQLCODE = +0                                     08860001
088700                 IF  ASC-ADD-DEFN                                 08870008
088710                     PERFORM 3045-GET-NEXT-SEQ-NBR                08871044
088730                     MOVE PV-NEXT-DEFN-SEQ-NBR                    08873044
088731                                  TO  PV-INP-NEXT-DEFN-SEQ        08873145
088732                                      ASC-DEFN-SEQ                08873244
088733                     MOVE SPACES  TO  PV-INP-DEFN-DESCR           08873344
088734                                      PV-INP-DEFN-DATA-TYPE       08873446
088735                                      ASC-DEFN-DESCR              08873546
088736                                      ASC-DEFN-DATA-TYPE          08873646
088740                     MOVE 'R'     TO  PV-INP-DEFN-REQD            08874044
088750                                      ASC-DEFN-REQD               08875044
088760                     MOVE ZEROES  TO  PV-INP-DEFN-DATA-LENG       08876044
088770                                      PV-INP-PARM-DEC-POS         08877044
088771                                      ASC-DEFN-DATA-LENG          08877144
088772                                      ASC-PARM-DEC-POS            08877244
089600                 END-IF                                           08960001
089700                                                                  08970001
089800            WHEN SQLCODE = +100                                   08980001
089900                                                                  08990001
090000                 IF  ASC-ADD-DEFN  OR                             09000008
090100                     ASC-FUNCTION-NONE                            09010001
090200                     CONTINUE                                     09020001
090300                 ELSE                                             09030001
090400                     SET PS-ERROR                                 09040001
090500                         DP020-MSG-FATAL         TO TRUE          09050001
091100                     MOVE PC-TSYMSG-03708                         09110010
091200                                             TO DP020-MSG-NUMBER  09120001
091500                     MOVE DP015-RED              TO APRMNMEC      09150001
091600                     MOVE DP015-REVERSE          TO APRMNMEH      09160001
091700                     MOVE -1                     TO ADEFDSCL      09170013
091800                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          09180001
091900                 END-IF                                           09190001
092000                                                                  09200001
092100            WHEN SQLWARN0 NOT = SPACES                            09210001
092110            WHEN SQLCODE < +0                                     09211001
092120            WHEN SQLCODE > +0                                     09212001
092130                MOVE '3040-CHECK-4-ROW-ON-WST00009'               09213001
092140                                          TO DP013-PARAGRAPH      09214001
092150                MOVE 'PROBLEM WITH RETRIEVING ROW'                09215001
092160                                    TO DP013-MESSAGE-TEXT (1)     09216001
092170                MOVE SQLCA      TO DP013-SQLCA                    09217001
092180                MOVE 'WST00009' TO DP013-DB2-TABLE-NAME (1)       09218001
092190                SET DP013-DB2-ABEND                               09219001
092200                    DP013-XCTL-DISPLAY-RESTART TO TRUE            09220001
092300                PERFORM DP013-0000-PROCESS-ABEND                  09230001
092400        END-EVALUATE.                                             09240001
092500                                                                  09250001
092510                                                                  09251028
092511*----------------------------------------------------------------*09251128
092512* GET THE NEXT DEFN SEQUENCE NUMBER                              *09251228
092514*----------------------------------------------------------------*09251428
092520 3045-GET-NEXT-SEQ-NBR.                                           09252028
092521                                                                  09252128
092522      MOVE ASC-PARM-NAME     TO DK-PARM-CODE.                     09252228
092523***   MOVE ASC-DEFN-SEQ      TO DK-DEFN-SEQ.                      09252328
092524                                                                  09252428
092525        EXEC SQL                                                  09252528
092526          SELECT                                                  09252628
092527                 MAX(ATTR_DEFN_SEQ_NBR)                           09252728
092534            INTO                                                  09253428
092536                 :PV-MAX-DEFN-SEQ-NBR                             09253630
092542            FROM  WST_ATTR_DEFN                                   09254228
092543           WHERE  INTGRTN_TYP_CDE   = :DK-PARM-CODE               09254328
092545        END-EXEC                                                  09254528
092546                                                                  09254628
092547        EVALUATE TRUE                                             09254728
092548            WHEN SQLCODE = +0                                     09254828
092549                 ADD  1 TO PV-MAX-DEFN-SEQ-NBR                    09254929
092550                      GIVING PV-NEXT-DEFN-SEQ-NBR                 09255029
092557                                                                  09255728
092558            WHEN SQLCODE = +100                                   09255828
092559            WHEN SQLCODE = -305                                   09255938
092560                 MOVE 1  TO  PV-NEXT-DEFN-SEQ-NBR                 09256038
092573                                                                  09257328
092574            WHEN SQLWARN0 NOT = SPACES                            09257428
092575            WHEN SQLCODE < +0                                     09257528
092576            WHEN SQLCODE > +0                                     09257628
092577                MOVE '3045-GET-NEXT-SEQ-NBR'                      09257728
092578                                          TO DP013-PARAGRAPH      09257828
092579                MOVE 'GET NEXT WST_ATTR_DEFN SEQ'                 09257928
092580                                    TO DP013-MESSAGE-TEXT (1)     09258028
092581                MOVE SQLCA      TO DP013-SQLCA                    09258128
092582                MOVE 'WST00009' TO DP013-DB2-TABLE-NAME (1)       09258228
092583                SET DP013-DB2-ABEND                               09258328
092584                    DP013-XCTL-DISPLAY-RESTART TO TRUE            09258428
092585                PERFORM DP013-0000-PROCESS-ABEND                  09258528
092586        END-EVALUATE.                                             09258628
092587                                                                  09258728
092590                                                                  09259028
092600*----------------------------------------------------------------*09260001
092700* MOVE THE DEFAULT ATTRIBUTE VALUES TO THE ENTERABLE FIELDS ON   *09270001
092800* MAP.                                                           *09280001
092900*----------------------------------------------------------------*09290001
093000 3200-RESET-ATTRIBUTES.                                           09300001
093100     IF PS-NO-ERROR                                               09310001
093200         IF ASC-FUNCTION = PC-UPDATE-DEFN                         09320053
093400             MOVE DP015-BLUE               TO APRMNMEC            09340001
093500             MOVE DP015-HL-OFF             TO APRMNMEH            09350001
093600             SET DP030-SET-CURSOR-APPL-1   TO TRUE                09360001
093700             MOVE -1                       TO ADEFDSCL            09370017
093800         ELSE                                                     09380001
094110             MOVE DP015-UNP-ALP-NOR-OFF    TO ADEFDSCA            09411006
094130                                              ADATTYPA            09413002
094140             MOVE DP015-UNP-NUM-NOR-OFF    TO ADATLENA            09414050
094150                                              ADECPOSA            09415002
094410             MOVE DP015-GREEN              TO ADEFDSCC            09441006
094430                                              ADATTYPC            09443002
094440                                              ADATLENC            09444002
094450                                              ADECPOSC            09445002
094710             MOVE DP015-UNDERLINE          TO ADEFDSCH            09471006
094730                                              ADATTYPH            09473002
094740                                              ADATLENH            09474002
094750                                              ADECPOSH            09475002
094800             SET DP030-SET-CURSOR-APPL-1   TO TRUE                09480001
094900             MOVE -1                       TO ADEFDSCL            09490013
095000         END-IF                                                   09500001
095220         MOVE DP015-UNP-ALP-NOR-OFF    TO ADEFDSCA                09522018
095240                                          ADATTYPA                09524003
095241         MOVE DP015-UNP-NUM-NOR-OFF    TO ADATLENA                09524151
095250                                          ADECPOSA                09525003
095420         MOVE DP015-GREEN              TO ADEFDSCC                09542006
095430                                          ADATTYPC                09543003
095440                                          ADATLENC                09544003
095450                                          ADECPOSC                09545003
095611         MOVE DP015-UNDERLINE          TO ADEFDSCH                09561106
095630                                          ADATTYPH                09563003
095640                                          ADATLENH                09564003
095650                                          ADECPOSH                09565003
095700     END-IF.                                                      09570001
095800                                                                  09580001
095900*----------------------------------------------------------------*09590001
096000*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *09600001
096100*    ENTRY.                                                      *09610001
096200*----------------------------------------------------------------*09620001
096300 4000-BUILD-INITIAL-PANEL.                                        09630001
096400     IF  ASC-UPD-DEFN                                             09640019
096500         MOVE DP015-PRO-NOR-OFF       TO APRMNMEA                 09650001
096600                                         APRMDSCA                 09660001
096700                                         ADEFSEQA                 09670002
096710                                         ADEFDSCA                 09671002
096730                                         ADATTYPA                 09673002
096740                                         ADATLENA                 09674002
096750                                         ADECPOSA                 09675002
096760         MOVE DP015-PRO-NOR-MDT       TO AREDFLDA                 09676042
096800         MOVE DP015-BLUE              TO APRMNMEC                 09680001
096900                                         APRMDSCC                 09690001
097000                                         ADEFSEQC                 09700002
097010                                         ADEFDSCC                 09701002
097020                                         AREDFLDC                 09702002
097030                                         ADATTYPC                 09703002
097040                                         ADATLENC                 09704002
097050                                         ADECPOSC                 09705002
097100         MOVE DP015-HL-OFF            TO APRMNMEH                 09710001
097200                                         APRMDSCH                 09720001
097300                                         ADEFSEQH                 09730002
097310                                         ADEFDSCH                 09731002
097320                                         AREDFLDH                 09732002
097330                                         ADATTYPH                 09733002
097340                                         ADATLENH                 09734002
097350                                         ADECPOSH                 09735002
097400         MOVE -1                      TO ADEFDSCL                 09740017
097500         SET DP030-SET-CURSOR-APPL-1  TO TRUE                     09750001
097600     ELSE                                                         09760001
097700         IF ASC-PARM-NAME  = SPACES                               09770001
097800             SET DP030-SET-CURSOR-APPL-1  TO TRUE                 09780001
097900             MOVE -1                      TO ADEFDSCL             09790013
098000         ELSE                                                     09800001
098100             IF ASC-PARM-DESC  = SPACES                           09810001
098200                 SET DP030-SET-CURSOR-APPL-1  TO TRUE             09820001
098300                 MOVE -1                      TO ADEFDSCL         09830017
098400             ELSE                                                 09840001
098500                 SET DP030-SET-CURSOR-APPL-1  TO TRUE             09850001
098600                 MOVE -1                      TO ADEFDSCL         09860017
098700             END-IF                                               09870001
098800         END-IF                                                   09880001
098900     END-IF.                                                      09890001
098910                                                                  09891019
098920     IF  ASC-ADD-DEFN                                             09892019
098930         PERFORM 6200-GET-NEXT-SEQ                                09893019
098940     END-IF.                                                      09894019
099000                                                                  09900001
099100                                                                  09910001
099200*----------------------------------------------------------------*09920001
099300*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *09930001
099400*----------------------------------------------------------------*09940001
099500 4400-MOVE-COMMAREA-TO-SCREEN.                                    09950001
099600     MOVE ASC-PARM-NAME            TO APRMNMEO.                   09960001
099700     MOVE ASC-PARM-DESC            TO APRMDSCO.                   09970001
099900                                                                  09990001
099901     MOVE ASC-DEFN-SEQ             TO ADEFSEQO.                   09990125
099902     MOVE ASC-DEFN-DESCR           TO ADEFDSCO.                   09990207
099903     MOVE 'R'                      TO AREDFLDO.                   09990307
099904     MOVE ASC-DEFN-DATA-TYPE       TO ADATTYPO.                   09990407
099905     MOVE ASC-DEFN-DATA-LENG       TO ADATLENO.                   09990507
099906     MOVE ASC-PARM-DEC-POS         TO ADECPOSO.                   09990607
099910                                                                  09991007
100000*------------------------------------------------------------     10000001
100100*  MOVE COMMAREA TO TEMP AREA                                     10010001
100200*------------------------------------------------------------     10020001
100300 4500-MOVE-COMMAREA-TO-TEMP.                                      10030001
100400     MOVE ASC-PARM-NAME           TO PV-INP-PARM-CODE.            10040001
100500     MOVE ASC-PARM-DESC           TO PV-INP-PARM-DESC.            10050001
100510                                                                  10051007
100600     MOVE ASC-DEFN-SEQ             TO ADEFSEQO.                   10060025
100610     MOVE ASC-DEFN-DESCR           TO ADEFDSCO.                   10061007
100620     MOVE 'R'                      TO AREDFLDO.                   10062007
100630     MOVE ASC-DEFN-DATA-TYPE       TO ADATTYPO.                   10063007
100640     MOVE ASC-DEFN-DATA-LENG       TO ADATLENO.                   10064007
100650     MOVE ASC-PARM-DEC-POS         TO ADECPOSO.                   10065007
100700                                                                  10070001
100800*----------------------------------------------------------------*10080001
100900* PROCESS TABLE INSERTS                                          *10090001
101000*----------------------------------------------------------------*10100001
101100 5000-PROCESS-ADD.                                                10110001
101200     MOVE SPACES         TO  PV-INP-PARM-CODE.                    10120001
101300     MOVE ASC-PARM-NAME  TO  PV-INP-PARM-CODE.                    10130001
101301                                                                  10130107
101310     MOVE ASC-PARM-NAME       TO  WST00009-INTGRTN-TYP-CDE.       10131007
101350     MOVE ASC-DEFN-SEQ        TO  WST00009-ATTR-DEFN-SEQ-NBR.     10135025
101360     MOVE ASC-DEFN-DESCR      TO  WST00009-ATTR-DEFN-DESC.        10136007
101370     MOVE ASC-DEFN-REQD       TO  WST00009-REQR-IND.              10137007
101380     MOVE ASC-DEFN-DATA-TYPE  TO  WST00009-DATYP-CDE.             10138007
101390     MOVE ASC-DEFN-DATA-LENG  TO  WST00009-MAX-LEN-QTY.           10139007
101391     MOVE ASC-PARM-DEC-POS    TO  WST00009-MAX-PCSN-QTY.          10139107
101400                                                                  10140001
101500     PERFORM 6100-INSERT-WST00009                                 10150001
101600                                                                  10160001
101700     IF PS-NO-ERROR                                               10170001
101800         IF ASC-WST00009-INSERTED                                 10180001
101900             MOVE PC-TSYMSG-00034  TO DP020-MSG-NUMBER            10190001
102000             SET DP020-MSG-INFORMATIONAL TO TRUE                  10200001
102100         END-IF                                                   10210001
102200     END-IF.                                                      10220001
102300                                                                  10230001
102400*----------------------------------------------------------------*10240001
102500* PROCESS TABLE UPDATES                                          *10250001
102600*----------------------------------------------------------------*10260001
102700 5100-PROCESS-UPDATE.                                             10270001
102800     PERFORM 7100-UPDATE-WST00009                                 10280001
102900                                                                  10290001
103000     IF ASC-WST00009-UPDATED                                      10300001
103100        SET ASC-F2-CONFIRM-NO       TO TRUE                       10310001
103200        MOVE PC-TSYMSG-00059 TO DP020-MSG-NUMBER                  10320001
103300        SET DP020-MSG-INFORMATIONAL TO TRUE                       10330001
103400        MOVE DP015-PRO-NOR-OFF       TO APRMNMEA                  10340001
103500                                        APRMDSCA                  10350001
103600                                        ADEFSEQA                  10360002
103610                                        ADEFDSCA                  10361002
103630                                        ADATTYPA                  10363002
103640                                        ADATLENA                  10364002
103650                                        ADECPOSA                  10365002
103660        MOVE DP015-PRO-NOR-MDT       TO AREDFLDA                  10366042
103700        MOVE DP015-BLUE              TO APRMNMEC                  10370001
103800                                        APRMDSCC                  10380001
103900                                        ADEFSEQC                  10390002
103910                                        ADEFDSCC                  10391002
103920                                        AREDFLDC                  10392002
103930                                        ADATTYPC                  10393002
103940                                        ADATLENC                  10394002
103950                                        ADECPOSC                  10395002
104000        MOVE DP015-HL-OFF            TO APRMNMEH                  10400001
104100                                        APRMDSCH                  10410001
104200                                        ADEFSEQH                  10420002
104210                                        ADEFDSCH                  10421002
104220                                        AREDFLDH                  10422002
104230                                        ADATTYPH                  10423002
104240                                        ADATLENH                  10424002
104250                                        ADECPOSH                  10425002
104300        MOVE -1                      TO ADEFDSCL                  10430013
104400        SET DP030-SET-CURSOR-APPL-1  TO TRUE                      10440001
104500     END-IF.                                                      10450001
104600                                                                  10460001
104700*----------------------------------------------------------------*10470001
104800* INSERT A ROW INTO THE CONTROL DC DOOR TABLE                    *10480001
104900*----------------------------------------------------------------*10490001
105000 6100-INSERT-WST00009.                                            10500001
105100         EXEC SQL                                                 10510001
105200                 INSERT INTO WST_ATTR_DEFN                        10520001
105300                 (                                                10530001
105400                  INTGRTN_TYP_CDE                                 10540001
105500                 ,ATTR_DEFN_SEQ_NBR                               10550001
105600                 ,ATTR_DEFN_DESC                                  10560001
105610                 ,REQR_IND                                        10561001
105620                 ,DATYP_CDE                                       10562001
105630                 ,MAX_LEN_QTY                                     10563001
105640                 ,MAX_PCSN_QTY                                    10564001
105700                 )                                                10570001
105800                 VALUES                                           10580001
105900                 (                                                10590001
106000                  :WST00009-INTGRTN-TYP-CDE                       10600001
106100                 ,:WST00009-ATTR-DEFN-SEQ-NBR                     10610001
106200                 ,:WST00009-ATTR-DEFN-DESC                        10620001
106210                 ,:WST00009-REQR-IND                              10621001
106220                 ,:WST00009-DATYP-CDE                             10622001
106230                 ,:WST00009-MAX-LEN-QTY                           10623001
106240                 ,:WST00009-MAX-PCSN-QTY                          10624001
106300                 )                                                10630001
106400         END-EXEC.                                                10640001
106500                                                                  10650001
106600         EVALUATE TRUE                                            10660001
106700             WHEN SQLCODE = +0                                    10670001
106800                 SET ASC-WST00009-INSERTED TO TRUE                10680001
106900                 MOVE PV-INP-PARM-CODE    TO ASC-PARM-NAME        10690001
107100                 MOVE PV-INP-PARM-TYPE    TO ASC-PARM-FUNC        10710001
107200             WHEN SQLCODE = -803                                  10720001
107300                 MOVE PV-INP-PARM-CODE        TO APRMNMEO         10730001
107400                 MOVE PC-TSYMSG-03709         TO DP020-MSG-NUMBER 10740001
107500                 SET DP020-MSG-FATAL                              10750001
107600                     PS-ERROR                 TO TRUE             10760001
107700                 MOVE DP015-RED               TO APRMNMEC         10770001
107800                 MOVE DP015-REVERSE           TO APRMNMEH         10780001
107900                 MOVE -1                      TO ADEFDSCL         10790013
108000                 SET DP030-SET-CURSOR-APPL-1  TO TRUE             10800001
108100             WHEN SQLWARN0 NOT = SPACES                           10810001
108200             WHEN SQLCODE < +0                                    10820001
108300             WHEN SQLCODE > +0                                    10830001
108400                 MOVE '6100-INSERT-WST00009' TO DP013-PARAGRAPH   10840001
108500                 MOVE 'ERROR INSERTING ROW TO WST00009'           10850001
108600                                   TO DP013-MESSAGE-TEXT (1)      10860001
108700                 MOVE SQLCA        TO DP013-SQLCA                 10870001
108800                 MOVE 'WST00009'   TO DP013-DB2-TABLE-NAME (1)    10880001
108900                 SET DP013-DB2-ABEND                              10890001
109000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           10900001
109100                 PERFORM DP013-0000-PROCESS-ABEND                 10910001
109200         END-EVALUATE.                                            10920001
109300                                                                  10930001
109301                                                                  10930119
109302*----------------------------------------------------------------*10930219
109303* GET THE NEXT DEFINITION SEQUENCE NUMBER                        *10930319
109304*----------------------------------------------------------------*10930419
109310 6200-GET-NEXT-SEQ.                                               10931019
109311                                                                  10931119
109312     MOVE  ASC-PARM-NAME  TO  WST00009-INTGRTN-TYP-CDE.           10931219
109313                                                                  10931319
109314         EXEC SQL                                                 10931419
109315                 SELECT  MAX(ATTR_DEFN_SEQ_NBR)                   10931519
109316                   INTO :WST00009-ATTR-DEFN-SEQ-NBR               10931619
109317                   FROM  WST_ATTR_DEFN                            10931719
109326                  WHERE  INTGRTN_TYP_CDE =                        10932619
109333                        :WST00009-INTGRTN-TYP-CDE                 10933319
109334         END-EXEC.                                                10933419
109335                                                                  10933519
109336         EVALUATE TRUE                                            10933619
109337             WHEN SQLCODE = +0                                    10933719
109338                 ADD    1                                         10933819
109339                  TO    WST00009-ATTR-DEFN-SEQ-NBR                10933919
109340                 GIVING ASC-DEFN-SEQ                              10934025
109341                                                                  10934119
109342             WHEN SQLCODE = +100                                  10934219
109343             WHEN SQLCODE = -305                                  10934319
109344                 MOVE  1  TO  ASC-DEFN-SEQ                        10934425
109345                                                                  10934519
109353             WHEN SQLWARN0 NOT = SPACES                           10935319
109354             WHEN SQLCODE < +0                                    10935419
109355             WHEN SQLCODE > +0                                    10935519
109356                 MOVE '6200-GET-NEXT-SEQ   ' TO DP013-PARAGRAPH   10935619
109357                 MOVE 'GET NEXT DEFN SEQ NMBR WST00009'           10935719
109358                                   TO DP013-MESSAGE-TEXT (1)      10935819
109359                 MOVE SQLCA        TO DP013-SQLCA                 10935919
109360                 MOVE 'WST00009'   TO DP013-DB2-TABLE-NAME (1)    10936019
109361                 SET DP013-DB2-ABEND                              10936119
109362                     DP013-XCTL-DISPLAY-RESTART TO TRUE           10936219
109363                 PERFORM DP013-0000-PROCESS-ABEND                 10936319
109364         END-EVALUATE.                                            10936419
109365                                                                  10936519
109370                                                                  10937019
109400******************************************************************10940001
109500** UPDATE A ROW ON THE PARM CODE TABLE - WST00009                 10950001
109600******************************************************************10960001
109700 7100-UPDATE-WST00009.                                            10970001
109710                                                                  10971007
109800     MOVE ASC-PARM-NAME       TO  WST00009-INTGRTN-TYP-CDE.       10980007
109900     MOVE ASC-DEFN-SEQ        TO  WST00009-ATTR-DEFN-SEQ-NBR.     10990025
110000     MOVE ASC-DEFN-DESCR      TO  WST00009-ATTR-DEFN-DESC.        11000007
110010     MOVE ASC-DEFN-REQD       TO  WST00009-REQR-IND.              11001007
110020     MOVE ASC-DEFN-DATA-TYPE  TO  WST00009-DATYP-CDE.             11002007
110030     MOVE ASC-DEFN-DATA-LENG  TO  WST00009-MAX-LEN-QTY.           11003007
110040     MOVE ASC-PARM-DEC-POS    TO  WST00009-MAX-PCSN-QTY.          11004007
110100                                                                  11010001
110200     PERFORM                                                      11020001
110300         WITH TEST AFTER                                          11030001
110400         VARYING PV-RETRY-COUNTER                                 11040001
110500         FROM 1 BY 1                                              11050001
110600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11060001
110700         OR     (SQLCODE = ZERO)                                  11070001
110800         OR     (SQLCODE = +100))                                 11080001
110900                                                                  11090001
111000         EXEC SQL                                                 11100001
111100             UPDATE WST_ATTR_DEFN                                 11110001
111200               SET                                                11120001
111410                  ATTR_DEFN_DESC     = :WST00009-ATTR-DEFN-DESC   11141055
111420                 ,REQR_IND           = :WST00009-REQR-IND         11142001
111430                 ,DATYP_CDE          = :WST00009-DATYP-CDE        11143001
111440                 ,MAX_LEN_QTY        = :WST00009-MAX-LEN-QTY      11144001
111450                 ,MAX_PCSN_QTY       = :WST00009-MAX-PCSN-QTY     11145001
111500             WHERE                                                11150001
111600                   INTGRTN_TYP_CDE   = :WST00009-INTGRTN-TYP-CDE  11160054
111610               AND ATTR_DEFN_SEQ_NBR = :WST00009-ATTR-DEFN-SEQ-NBR11161054
111700         END-EXEC                                                 11170001
111800                                                                  11180001
111900         EVALUATE TRUE                                            11190001
112000             WHEN SQLCODE = +0                                    11200001
112100                 SET ASC-WST00009-UPDATED TO TRUE                 11210001
112200             WHEN SQLWARN0 NOT = SPACES                           11220001
112300             WHEN SQLCODE < +0                                    11230001
112400             WHEN SQLCODE > +0                                    11240001
112500                 MOVE '7100-UPDATE-WST00009' TO DP013-PARAGRAPH   11250001
112600                 MOVE 'ERROR UPDATING WST_ATTR_DEFN'              11260054
112700                                   TO DP013-MESSAGE-TEXT (1)      11270001
112800                 MOVE SQLCA        TO DP013-SQLCA                 11280001
112900                 MOVE 'WST00009'   TO DP013-DB2-TABLE-NAME (1)    11290001
113000                 SET DP013-DB2-ABEND                              11300001
113100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           11310001
113200                 PERFORM DP013-0000-PROCESS-ABEND                 11320001
113300         END-EVALUATE                                             11330001
113400     END-PERFORM.                                                 11340001
113500                                                                  11350001
113600     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         11360001
113700         MOVE '7100-UPDATE-WST00009' TO DP013-PARAGRAPH           11370001
113800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     11380001
113900                                       TO DP013-MESSAGE-TEXT (1)  11390001
114000         MOVE SQLCA          TO DP013-SQLCA                       11400001
114100         MOVE 'WST00009'     TO DP013-DB2-TABLE-NAME (1)          11410001
114200         SET DP013-DB2-ABEND                                      11420001
114300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   11430001
114400         PERFORM DP013-0000-PROCESS-ABEND                         11440001
114500     END-IF.                                                      11450001
114600     MOVE +0 TO PV-RETRY-COUNTER.                                 11460001
114700                                                                  11470001
114800*----------------------------------------------------------------*11480001
114900* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *11490001
115000*----------------------------------------------------------------*11500001
115100 9100-READ-SEL-QUEUE.                                             11510001
115200     EXEC CICS                                                    11520001
115300         READQ TS                                                 11530001
115400             QUEUE (ASC-SEL-QUEUE-NAME)                           11540001
115500             INTO  (CN026-SELECT-RECORD)                          11550001
115600             ITEM  (ASC-SEL-ITEM)                                 11560001
115700             RESP  (PV-CICS-RESPONSE)                             11570001
115800     END-EXEC.                                                    11580001
115900                                                                  11590001
116000     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                       11600001
116100         CONTINUE                                                 11610001
116200     ELSE                                                         11620001
116300         SET DP013-LOGIC-ABEND                                    11630001
116400             DP013-NO-ROLLBACK     TO TRUE                        11640001
116500         MOVE '9100-READ-SEL-QUEUE' TO DP013-PARAGRAPH            11650001
116600         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   11660001
116700                                   TO DP013-MESSAGE-TEXT (1)      11670001
116800         PERFORM DP013-0000-PROCESS-ABEND                         11680001
116900     END-IF.                                                      11690001
117000                                                                  11700001
117100*----------------------------------------------------------------*11710001
117200* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *11720001
117300*----------------------------------------------------------------*11730001
117400 9200-REWRITE-SEL-QUEUE.                                          11740001
117500     EXEC CICS                                                    11750001
117600          WRITEQ TS                                               11760001
117700              QUEUE  (ASC-SEL-QUEUE-NAME)                         11770001
117800              FROM   (CN026-SELECT-RECORD)                        11780001
117900              ITEM   (ASC-SEL-ITEM)                               11790001
118000              RESP   (PV-CICS-RESPONSE)                           11800001
118100              REWRITE                                             11810001
118200     END-EXEC.                                                    11820001
118300                                                                  11830001
118400     IF  PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                   11840001
118500         SET DP013-CICS-ABEND                                     11850001
118600             DP013-NO-ROLLBACK     TO TRUE                        11860001
118700         MOVE '9200-REWRITE-SEL-QUEUE'  TO DP013-PARAGRAPH        11870001
118800         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   11880001
118900                                   TO DP013-MESSAGE-TEXT (1)      11890001
119000         PERFORM DP013-0000-PROCESS-ABEND                         11900001
119100     END-IF.                                                      11910001
119200                                                                  11920001
119300     COPY DPPD013.                                                11930001
119400*----------------------------------------------------------------*11940001
119500*    ABEND PROCESSOR MODULE                                      *11950001
119600*----------------------------------------------------------------*11960001
