000200******************************************************************00010001
000300 IDENTIFICATION DIVISION.                                         00020001
000400******************************************************************00030001
000600 PROGRAM-ID.    SUKUP006.                                         00040008
000700 AUTHOR.        DEANNA BRANTNER.                                  00050001
000800 INSTALLATION.  KOHLS.                                            00060001
000900 DATE-WRITTEN   OCTOBER, 2000.                                    00070001
001000 DATE-COMPILED.                                                   00080001
001200******************************************************************00090001
001300*  THIS PROGRAM DELETES ROWS FROM THE VRDA TABLE                  00100003
001400*  TLBVRDA USING INPUT CREATED FROM PROGRAM SUKUT043.             00110001
001500******************************************************************00120001
001600                                                                  00130001
001700******************************************************************00140001
001800 ENVIRONMENT DIVISION.                                            00150001
002100 CONFIGURATION SECTION.                                           00160001
002300 SOURCE-COMPUTER.        IBM-3090.                                00170001
002400 OBJECT-COMPUTER.        IBM-3090.                                00180001
002410******************************************************************00190001
002600 INPUT-OUTPUT SECTION.                                            00200001
002800 FILE-CONTROL.                                                    00210001
003000                                                                  00220001
003100     SELECT VRDA-FILE                                             00230003
003200         ASSIGN TO INP01.                                         00240001
003300******************************************************************00250001
003400 DATA DIVISION.                                                   00260001
003700 FILE SECTION.                                                    00270001
003710******************************************************************00280001
003900                                                                  00290001
004000 FD  VRDA-FILE                                                    00300003
004100     RECORDING MODE IS F                                          00310001
004200     LABEL RECORDS ARE STANDARD                                   00320001
004300     BLOCK CONTAINS 0 RECORDS.                                    00330001
004400                                                                  00340001
004500 01  VRDA-RECORD         PIC  X(169).                             00350003
004600                                                                  00360001
004800******************************************************************00370001
004900 WORKING-STORAGE SECTION.                                         00380001
005000******************************************************************00390001
005100*                                                                 00400001
006200************************************                              00410001
006300*  DB2 FORMATTED MESSAGE AREA                                     00420001
006400************************************                              00430001
006500     COPY DPWS004.                                                00440009
006600                                                                  00450001
006900************************************                              00460001
007000*  COMMUNICATIONS AREA FOR DB2                                    00470001
007100************************************                              00480001
007200     EXEC SQL                                                     00490001
007300          INCLUDE SQLCA                                           00500001
007400     END-EXEC.                                                    00510001
007500                                                                  00520001
007600******************************************************************00530001
007700*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE VRDA TABLE         00540003
007900******************************************************************00550001
008000     EXEC SQL                                                     00560001
008100          INCLUDE TLBVRDA                                         00570001
008200     END-EXEC.                                                    00580001
008210*                                                                 00590001
009100 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00600001
009200                                                   COMP SYNC.     00610001
009300                                                                  00620001
009400 01  PS-PROGRAM-SWITCHES.                                         00630001
009500     05  PS-END-OF-FILE-SW           PIC  X(01)    VALUE 'N'.     00640001
009600         88  PS-END-OF-FILE                        VALUE 'Y'.     00650001
009700         88  PS-NOT-END-OF-FILE                    VALUE 'N'.     00660001
009900                                                                  00670001
010000 01  PC-PROGRAM-CONSTANTS.                                        00680001
010100     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     00690001
010200                                                   COMP SYNC.     00700001
010300     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00710001
010400         'SUKUP006'.                                              00720008
010500     05  PC-COMMIT-HOLD              PIC 9(3)      VALUE 020.     00730001
010600                                                                  00740001
010700 01  PV-PROGRAM-VARIABLES.                                        00750001
010800     05  PV-ITEM-NBR                 PIC  9(15)    VALUE ZERO.    00760001
010900     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  00770001
011000     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  00780001
011100     05  PV-OPEN-COUNTER             PIC S9(04)    VALUE ZERO     00790001
011200                                                   COMP SYNC.     00800001
011300     05  PV-CLOSE-COUNTER            PIC S9(04)    VALUE ZERO     00810001
011400                                                   COMP SYNC.     00820001
011500     05  PV-FETCH-COUNTER            PIC S9(04)    VALUE ZERO     00830001
011600                                                   COMP SYNC.     00840001
011700     05  PV-DELETE-COUNT             PIC S9(09)    VALUE ZERO     00850001
011800                                                   COMP SYNC.     00860001
011900     05  PV-NOT-FOUND-COUNT          PIC S9(09)    VALUE ZERO     00870001
012000                                                   COMP SYNC.     00880001
012100     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             00890001
012200     05  PV-COMMIT-COUNT             PIC S9(09)    VALUE +0       00900001
012300                                                   COMP SYNC.     00910001
012400     05  PV-COMMIT-COUNTER           PIC 9(03)     VALUE ZERO.    00920001
012500                                                                  00930001
012600     05  PV-DB2-COUNT                PIC S9(09)    VALUE ZERO     00940001
012700                                                   COMP-3.        00950001
013500                                                                  00960001
013600******************************************************************00970001
013700 PROCEDURE DIVISION.                                              00980001
013705     DISPLAY '**** START OF SUKUP006 ****'.                       00990008
013800******************************************************************01000001
013900                                                                  01010001
014100******************************************************************01020001
014110 0000-PROGRAM-MAINLINE.                                           01030001
014400******************************************************************01040001
014600     PERFORM 1000-INITIALIZE THRU 1000-EXIT.                      01050001
014700     IF PS-NOT-END-OF-FILE                                        01060001
014800         PERFORM 2000-PROCESS-VRDA-RECS THRU 2000-EXIT            01070003
014900            UNTIL PS-END-OF-FILE                                  01080001
015000     END-IF.                                                      01090001
015100     PERFORM 9000-EOJ-ROUTINE THRU 9000-EXIT.                     01100001
015200                                                                  01110001
015300     STOP RUN.                                                    01120001
015400                                                                  01130001
015600******************************************************************01140001
015610 1000-INITIALIZE.                                                 01150001
016000******************************************************************01160001
016200     OPEN INPUT  VRDA-FILE.                                       01170003
016300     PERFORM 3000-READ-VRDA-FILE THRU 3000-EXIT.                  01180003
016400                                                                  01190001
016500 1000-EXIT.  EXIT.                                                01200001
016800******************************************************************01210001
016810 2000-PROCESS-VRDA-RECS.                                          01220003
016820******************************************************************01230001
017400     PERFORM 4000-DELETE-VRDA-RECS THRU 4000-EXIT.                01240003
017500     ADD +1 TO PV-COMMIT-COUNTER.                                 01250001
017600                                                                  01260001
017700     IF PV-COMMIT-COUNTER > PC-COMMIT-HOLD                        01270001
017800         EXEC SQL                                                 01280001
017900            COMMIT                                                01290001
018000         END-EXEC                                                 01300001
018100                                                                  01310001
018200         IF SQLCODE NOT = +0                                      01320001
018300             DISPLAY '### COMMIT FAILED ! ###'                    01330001
018400             PERFORM 9999-SQL-ABEND THRU 9999-EXIT                01340002
018500         END-IF                                                   01350001
018600                                                                  01360001
018700         ADD +1  TO PV-COMMIT-COUNT                               01370001
018800         MOVE +0 TO PV-COMMIT-COUNTER                             01380001
018900     END-IF.                                                      01390001
019000                                                                  01400001
019100     PERFORM 3000-READ-VRDA-FILE THRU 3000-EXIT.                  01410003
019200                                                                  01420001
019201 2000-EXIT.  EXIT.                                                01430001
019210******************************************************************01440001
019300 3000-READ-VRDA-FILE.                                             01450003
019400******************************************************************01460001
019500      READ VRDA-FILE INTO DCLTLBVRDA                              01470003
019700          AT END SET PS-END-OF-FILE TO TRUE.                      01480001
019800                                                                  01490001
019810 3000-EXIT.  EXIT.                                                01500001
019900******************************************************************01510001
020000 4000-DELETE-VRDA-RECS.                                           01520003
020100******************************************************************01530001
020500     EXEC SQL                                                     01540001
020600         DELETE                                                   01550007
020700             FROM  TLBVRDA                                        01560001
020800             WHERE BRCDE_NBR = :LBVRDA-BRCDE-NBR                  01570002
020900     END-EXEC.                                                    01580001
021000                                                                  01590001
021100     EVALUATE TRUE                                                01600001
021200         WHEN SQLCODE = 0                                         01610001
021300             ADD +1           TO PV-DELETE-COUNT                  01620007
021400         WHEN SQLCODE = +100                                      01630001
021500             ADD +1           TO PV-NOT-FOUND-COUNT               01640001
021600         WHEN SQLCODE < 0                                         01650001
021700         WHEN SQLCODE > 0                                         01660001
021800         WHEN SQLWARN0 = 'W'                                      01670001
021900             MOVE '4000-DELETE-VRDA-RECS'                         01680003
022000                         TO PV-PARAGRAPH-NAME                     01690001
022100             MOVE 'DELETE OF TLBVRDA'                             01700001
022200                         TO PV-DB2-OPERATION-ATTEMPTED            01710001
022300             PERFORM 9999-SQL-ABEND THRU 9999-EXIT                01720001
022400     END-EVALUATE.                                                01730001
022600                                                                  01740001
022601 4000-EXIT.  EXIT.                                                01750001
022610******************************************************************01760001
022700 9000-EOJ-ROUTINE.                                                01770001
022800******************************************************************01780001
023100     CLOSE VRDA-FILE.                                             01790003
023200                                                                  01800001
023300     MOVE PV-DELETE-COUNT  TO PV-DISPLAY-COUNT.                   01810001
023400     DISPLAY 'TOTAL VRDA RECORDS DELETED  ' PV-DISPLAY-COUNT.     01820003
023500     MOVE PV-NOT-FOUND-COUNT TO PV-DISPLAY-COUNT.                 01830001
023600     DISPLAY 'TOTAL VRDA RECORDS NOT FOUND' PV-DISPLAY-COUNT.     01840003
023700     MOVE PV-COMMIT-COUNT  TO PV-DISPLAY-COUNT.                   01850001
023800     DISPLAY 'TOTAL COMMITS TAKEN          ' PV-DISPLAY-COUNT.    01860001
023900                                                                  01870001
023910 9000-EXIT.  EXIT.                                                01880001
024000******************************************************************01890001
024100 9999-SQL-ABEND.                                                  01900001
024200******************************************************************01910001
024600     DISPLAY '9999-SQL-ABEND'.                                    01920001
024700     DISPLAY '** ABEND     **'.                                   01930001
024800     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        01940001
024900     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              01950001
025000     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     01960001
025100                                                                  01970001
025200******************************************************************01980001
025300* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    01990001
025400* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         02000001
025500* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     02010001
025600* FORMAT.                                                         02020001
025700******************************************************************02030001
025800     COPY DPPD004.                                                02040001
025900                                                                  02050001
026000     MOVE +4013                  TO ABEND-CODE.                   02060001
026100     CALL 'ILBOABN0' USING ABEND-CODE.                            02070001
026200 9999-EXIT.  EXIT.                                                02080001
