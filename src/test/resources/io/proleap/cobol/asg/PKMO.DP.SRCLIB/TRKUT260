000100******************************************************************        
000200 IDENTIFICATION DIVISION.                                                 
000300******************************************************************        
000400                                                                          
000500 PROGRAM-ID.    TRKUT260.                                                 
000600 AUTHOR.        MARGARET MORRISON.                                        
000700 INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
000800 DATE-WRITTEN   JUNE, 2004.                                               
000900 DATE-COMPILED.                                                           
001000                                                                          
001100******************************************************************        
001101* THIS PROGRAM CREATES AN OUTPUT FILE THAT IS USED AS INPUT TO            
001102* THE DEFAULT RULE CREATION PROGRAM, TRKUP265.  THE PROGRAM WILL          
001103* DETERMINE THE CONTAINERS THAT SHOULD BE ADDED, UPDATED, AND             
001104* DELETED BASED ON DATA ENTRY OF PO LEVEL DC SPLITS.                      
001105******************************************************************        
001500*                                                               *         
002200******************************************************************        
002300 ENVIRONMENT DIVISION.                                                    
002400******************************************************************        
002500                                                                          
002600 CONFIGURATION SECTION.                                                   
002700                                                                          
002800 SOURCE-COMPUTER.        IBM-3090.                                        
002900 OBJECT-COMPUTER.        IBM-3090.                                        
003000                                                                          
003100 INPUT-OUTPUT SECTION.                                                    
003200                                                                          
003300 FILE-CONTROL.                                                            
003400                                                                          
003500     SELECT TR265-CONTNR-RULES-FILE                                       
003600         ASSIGN TO OUT01.                                                 
003700                                                                          
003800******************************************************************        
003900 DATA DIVISION.                                                           
004000******************************************************************        
004100                                                                          
004200 FILE SECTION.                                                            
004300                                                                          
004391 FD  TR265-CONTNR-RULES-FILE                                              
004392     RECORDING MODE IS F                                                  
004393     LABEL RECORDS ARE STANDARD                                           
004394     BLOCK CONTAINS 0 RECORDS.                                            
004395                                                                          
004396 01  TR265-CONTNR-RULES-RECORD       PIC X(500).                          
004397                                                                          
007200******************************************************************        
007300 WORKING-STORAGE SECTION.                                                 
007400******************************************************************        
007500*                                                                         
007600*                                                                         
007700******************************************************************        
007800*  DB2 FORMATTED MESSAGE AREA                                             
007900******************************************************************        
008000     COPY DPWS004.                                                        
008100*                                                                         
010100******************************************************************        
010200*  COMMUNICATIONS AREA FOR DB2                                            
010300******************************************************************        
010400     EXEC SQL                                                             
010500          INCLUDE SQLCA                                                   
010600     END-EXEC.                                                            
010800*                                                                         
011629******************************************************************        
011630*  DB2 TABLE DECLARATION - TRIP TABLE (TVHTRIP)                           
011631******************************************************************        
011632     EXEC SQL                                                             
011633          INCLUDE TVHTRIP                                                 
011634     END-EXEC.                                                            
011635*                                                                         
011800******************************************************************        
011900*  DB2 TABLE DECLARATION - SHIPMENT TO PURCHASE ORDER ASSOCIATION         
011910*      TABLE (TSHPTPO)                                                    
012000******************************************************************        
012100     EXEC SQL                                                             
012200          INCLUDE TSHPTPO                                                 
012300     END-EXEC.                                                            
012600*                                                                         
012700******************************************************************        
012800*  DB2 TABLE DECLARATION - SHIPMENT TABLE  (TSHIPMT)                      
012900******************************************************************        
013000     EXEC SQL                                                             
013100          INCLUDE TSHIPMT                                                 
013200     END-EXEC.                                                            
013500*                                                                         
013510******************************************************************        
013520*  DB2 TABLE DECLARATION - SHIPMENT STATUS TABLE LAYOUT                   
013521*                               (TSHIPST)                                 
013530******************************************************************        
013540     EXEC SQL                                                             
013550          INCLUDE TSHIPST                                                 
013560     END-EXEC.                                                            
013590*                                                                         
013591******************************************************************        
013592*  DB2 TABLE DECLARATION - SHIPMENT STATUS TYPE TABLE LAYOUT              
013593*                               (TSHSTYP)                                 
013594******************************************************************        
013595     EXEC SQL                                                             
013596          INCLUDE TSHSTYP                                                 
013597     END-EXEC.                                                            
013600*                                                                         
013610******************************************************************        
013700*  DB2 TABLE DECLARATION - PURCHASE ORDER PLANNED SHIPMENT                
013710*      TABLE  (TPLNSHP)                                                   
013800******************************************************************        
013900     EXEC SQL                                                             
014000          INCLUDE TPLNSHP                                                 
014100     END-EXEC.                                                            
014400*                                                                         
016300******************************************************************        
016400*  DB2 TABLE DECLARATION - TRAFFIC TRIP STATUS TABLE (TTRIPST)            
016500******************************************************************        
016600     EXEC SQL                                                             
016700          INCLUDE TTRIPST                                                 
216800     END-EXEC.                                                            
216802*                                                                         
216803******************************************************************        
216804*  DB2 TABLE DECLARATION - TRAFFIC TRIP STATUS TYPE TBL (TTRSTYP)         
216805******************************************************************        
216806     EXEC SQL                                                             
216807          INCLUDE TTRSTYP                                                 
216808     END-EXEC.                                                            
216810*                                                                         
216852******************************************************************        
216853*  DB2 TABLE DECLARATION - TRAFFIC VEHICLE TABLE (TVEHICL)                
216854******************************************************************        
216855     EXEC SQL                                                             
216856          INCLUDE TVEHICL                                                 
216857     END-EXEC.                                                            
216858******************************************************************        
216859*  DB2 TABLE DECLARATION - SHPMNT/PO ASSOCIATN AUDT TBL (TAUSHPO)         
216860******************************************************************        
216861     EXEC SQL                                                             
216862          INCLUDE TAUSHPO                                                 
216863     END-EXEC.                                                            
216864******************************************************************        
216865*  DB2 TABLE DECLARATION - TRIP AUDIT TABLE       (TAUTRIP)               
216866******************************************************************        
216867     EXEC SQL                                                             
216868          INCLUDE TAUTRIP                                                 
216869     END-EXEC.                                                            
216870******************************************************************        
216880*  DB2 TABLE DECLARATION - SHIPMENT AUDIT TABLE   (TAUSHIP)               
216890******************************************************************        
216900     EXEC SQL                                                             
216910          INCLUDE TAUSHIP                                                 
216920     END-EXEC.                                                            
216925******************************************************************        
216926*  DB2 TABLE DECLARATION - TRANSPORTATION PO TRACKING - IMPORT            
216927*  CONTROL TABLE.                                                         
216928******************************************************************        
216929     EXEC SQL                                                             
216930         INCLUDE TIMCNTL                                                  
216931     END-EXEC.                                                            
216975******************************************************************        
216976*    RECORD LAYOUT FOR CONTAINER RULES DATA                               
216978******************************************************************        
216979     COPY TRRD265.                                                        
216980                                                                          
216981 EJECT                                                                    
216982                                                                          
216983 01  ABEND-CODE                      PIC S9(04)    VALUE +0               
216984                                                   COMP SYNC.             
216985*                                                                         
216986 01  PA-PROGRAM-ACCUMULATORS.                                             
216987     05  PA-TOTALS.                                                       
216988         10 PA-TOTAL-CURR-SPLIT-QTY   PIC  S9(13)  VALUE +0               
216989                                                     COMP-3.              
216990         10 PA-TOTAL-OUTPUT-REC-COUNT PIC  S9(13)  VALUE +0               
216991                                                     COMP-3.              
370300     05  PA-ERROR-COUNT               PIC  S9(13)    VALUE +0             
370400                                                     COMP-3.              
370401                                                                          
370402 01  PS-PROGRAM-SWITCHES.                                                 
370403     05  PS-EOC-SHIPT-CURSOR-SW        PIC  X(01)    VALUE 'N'.           
370404         88  PS-EOC-SHIPT-CURSOR                     VALUE 'Y'.           
370405         88  PS-EOC-SHIPT-CURSOR-NO                  VALUE 'N'.           
370406     05  PS-EOC-SHIPT-DEL-CURSOR-SW    PIC  X(01)    VALUE 'N'.           
370407         88  PS-EOC-SHIPT-DEL-CURSOR                 VALUE 'Y'.           
370408         88  PS-EOC-SHIPT-DEL-CURSOR-NO              VALUE 'N'.           
370409     05  PS-EOC-SHIPT-CHG-CURSOR-SW    PIC  X(01)    VALUE 'N'.           
370410         88  PS-EOC-SHIPT-CHG-CURSOR                 VALUE 'Y'.           
370411         88  PS-EOC-SHIPT-CHG-CURSOR-NO              VALUE 'N'.           
370412     05  PS-EOC-TRIP-DEL-CURSOR-SW     PIC  X(01)    VALUE 'N'.           
370413         88  PS-EOC-TRIP-DEL-CURSOR                  VALUE 'Y'.           
370414         88  PS-EOC-TRIP-DEL-CURSOR-NO               VALUE 'N'.           
370415     05  PS-EOC-TRIP-CURSOR-SW         PIC  X(01)    VALUE 'N'.           
370416         88  PS-EOC-TRIP-CURSOR                      VALUE 'Y'.           
370417         88  PS-EOC-TRIP-CURSOR-NO                   VALUE 'N'.           
370418     05  PS-EOC-TRIP-AUDIT-CURSOR-SW   PIC  X(01)    VALUE 'N'.           
370419         88  PS-EOC-TRIP-AUDIT-CURSOR                VALUE 'Y'.           
370420         88  PS-EOC-TRIP-AUDIT-CURSOR-NO             VALUE 'N'.           
370421     05  PS-EOC-PO-CURSOR-SW           PIC  X(01)    VALUE 'N'.           
370422         88  PS-EOC-PO-CURSOR                        VALUE 'Y'.           
370423         88  PS-EOC-PO-CURSOR-NO                     VALUE 'N'.           
370424     05  PS-EOC-PO-DEL-CURSOR-SW       PIC  X(01)    VALUE 'N'.           
370425         88  PS-EOC-PO-DEL-CURSOR                    VALUE 'Y'.           
370430         88  PS-EOC-PO-DEL-CURSOR-NO                 VALUE 'N'.           
370494     05  PS-TSHPTPO-UPDATED-SW         PIC  X(01)    VALUE 'N'.           
370495         88  PS-TSHPTPO-UPDATED                      VALUE 'Y'.           
370496         88  PS-TSHPTPO-UPDATED-NO                   VALUE 'N'.           
370560     05  PS-SHIPT-FOUND-SW             PIC  X(01)    VALUE 'N'.           
370561         88  PS-SHIPT-FOUND                          VALUE 'Y'.           
370562         88  PS-SHIPT-FOUND-NO                       VALUE 'N'.           
370563     05  PS-SHIPT-DEL-FOUND-SW         PIC  X(01)    VALUE 'N'.           
370564         88  PS-SHIPT-DEL-FOUND                      VALUE 'Y'.           
370565         88  PS-SHIPT-DEL-FOUND-NO                   VALUE 'N'.           
370566     05  PS-TRIP-DEL-FOUND-SW          PIC  X(01)    VALUE 'N'.           
370567         88  PS-TRIP-DEL-FOUND                       VALUE 'Y'.           
370568         88  PS-TRIP-DEL-FOUND-NO                    VALUE 'N'.           
370569     05  PS-SHIPT-CHG-FOUND-SW         PIC  X(01)    VALUE 'N'.           
370570         88  PS-SHIPT-CHG-FOUND                      VALUE 'Y'.           
370571         88  PS-SHIPT-CHG-FOUND-NO                   VALUE 'N'.           
370572     05  PS-TRIP-FOUND-SW              PIC  X(01)    VALUE 'N'.           
370573         88  PS-TRIP-FOUND                           VALUE 'Y'.           
370574         88  PS-TRIP-FOUND-NO                        VALUE 'N'.           
370578     05  PS-PO-FOUND-SW                PIC  X(01)    VALUE 'N'.           
370579         88  PS-PO-FOUND                             VALUE 'Y'.           
370580         88  PS-PO-FOUND-NO                          VALUE 'N'.           
370581     05  PS-PO-DEL-FOUND-SW            PIC  X(01)    VALUE 'N'.           
370582         88  PS-PO-DEL-FOUND                         VALUE 'Y'.           
370583         88  PS-PO-DEL-FOUND-NO                      VALUE 'N'.           
370584     05  PS-AUTRIP-ROW-FOUND-SW        PIC  X(01)    VALUE 'N'.           
370585         88  PS-AUTRIP-ROW-FOUND                     VALUE 'Y'.           
370586         88  PS-AUTRIP-ROW-FOUND-NO                  VALUE 'N'.           
370587     05  PS-TRIP-CHANGES-FOUND-SW      PIC  X(01)    VALUE 'N'.           
370588         88  PS-TRIP-CHANGES-FOUND                   VALUE 'Y'.           
370589         88  PS-TRIP-CHANGES-FOUND-NO                VALUE 'N'.           
370590     05  PS-AUSHIP-ROW-FOUND-SW        PIC  X(01)    VALUE 'N'.           
370591         88  PS-AUSHIP-ROW-FOUND                     VALUE 'Y'.           
370592         88  PS-AUSHIP-ROW-FOUND-NO                  VALUE 'N'.           
370593                                                                          
370594 01  PC-PROGRAM-CONSTANTS.                                                
370595     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE                  
370596         'TRKUT260'.                                                      
370597     05  PC-CURRENT-JOB-NAME         PIC  X(06)    VALUE 'TRKXXX'.        
370598     05  PC-CON                      PIC X(03)     VALUE 'CON'.           
370599     05  PC-A                        PIC X(01)     VALUE 'A'.             
370600     05  PC-B                        PIC X(01)     VALUE 'B'.             
370601     05  PC-C                        PIC X(01)     VALUE 'C'.             
370602     05  PC-D                        PIC X(01)     VALUE 'D'.             
370603     05  PC-I                        PIC X(01)     VALUE 'I'.             
370604     05  PC-M                        PIC X(01)     VALUE 'M'.             
370605     05  PC-N                        PIC X(01)     VALUE 'N'.             
370606     05  PC-O                        PIC X(01)     VALUE 'O'.             
370607     05  PC-S                        PIC X(01)     VALUE 'S'.             
370608     05  PC-U                        PIC X(01)     VALUE 'U'.             
370609     05  PC-Y                        PIC X(01)     VALUE 'Y'.             
370610     05  PC-NA                       PIC X(02)     VALUE 'NA'.            
370611     05  PC-POA                      PIC X(03)     VALUE 'POA'.           
370612     05  PC-POC                      PIC X(03)     VALUE 'POC'.           
370613     05  PC-POD                      PIC X(03)     VALUE 'POD'.           
370614     05  PC-SHA                      PIC X(03)     VALUE 'SHA'.           
370615     05  PC-SHC                      PIC X(03)     VALUE 'SHC'.           
370616     05  PC-SHD                      PIC X(03)     VALUE 'SHD'.           
370617     05  PC-TRC                      PIC X(03)     VALUE 'TRC'.           
370618     05  PC-TRD                      PIC X(03)     VALUE 'TRD'.           
370619     05  PC-NULL-DTE                PIC X(10) VALUE '9999-09-09'.         
370620     05  PC-LOW-VALUE                PIC X(01)     VALUE                  
370621                                                   LOW-VALUE.             
370622                                                                          
370623 01  PV-PROGRAM-VARIABLES.                                                
370626     05  PV-CURRENT-TMST             PIC X(26)     VALUE SPACE.           
370627     05  PV-START-TMST               PIC X(26)     VALUE SPACE.           
370628     05  PV-LAST-RUN-TMST            PIC X(26)     VALUE SPACE.           
370629     05  PV-LAST-RUN-TMST-DTE        PIC X(10).                           
370630     05  PV-LAST-RUN-TMST-TM         PIC X(08).                           
370640     05  PV-LAST-RUN-TMST-TM-2       PIC X(08).                           
371155     05  PV-DB2-COUNT                PIC S9(04)    VALUE +0               
371156                                                   COMP SYNC.             
371157     05  PV-NULL-ETA                 PIC S9(4)   COMP VALUE +0.           
371182                                                                          
371183     05  PV-NULL-VEH-NBR             PIC S9(4)   COMP VALUE +0.           
371184                                                                          
371185 01  PV-TR265-CONTNR-RULES-FIELDS.                                        
371186     05  PV-CONTNR-ID                PIC X(12)     VALUE SPACE.           
371187     05  PV-CONTNR-ID-CUR            PIC X(12)     VALUE SPACE.           
371188     05  PV-CONTNR-ID-PREV           PIC X(12)     VALUE SPACE.           
371189     05  PV-CONTNR-TRN-TYP           PIC X(01)     VALUE SPACE.           
371190     05  PV-CONTNR-PO-UPD-IND        PIC X(01)     VALUE SPACE.           
371191     05  PV-CONTNR-TRN-SRCE          PIC X(03)     VALUE SPACE.           
371192     05  PV-SHIPT-ID                 PIC S9(09)    VALUE +0               
371193                                                   COMP.                  
371198     05  PV-VEH-NM-CUR               PIC X(25)     VALUE SPACE.           
371199     05  PV-VEH-NM-PREV              PIC X(25)     VALUE SPACE.           
371200     05  PV-ETA-TMST-CUR             PIC X(26)     VALUE SPACE.           
371201     05  PV-ETA-TMST-PREV            PIC X(26)     VALUE SPACE.           
371202     05  PV-FOB-CDE-CUR              PIC X(04)     VALUE SPACE.           
371203     05  PV-FOB-CDE-PREV             PIC X(04)     VALUE SPACE.           
371204     05  PV-POE-CDE-CUR              PIC X(04)     VALUE SPACE.           
371205     05  PV-POE-CDE-PREV             PIC X(04)     VALUE SPACE.           
371206                                                                          
371207*                                                                         
371208*                                                                         
371209*  CURSOR DECLARATION TO OBTAIN TRIP CHANGES                              
371210*                                                                         
371211*                                                                         
371212     EXEC SQL                                                             
371213          DECLARE TRIP_CUR CURSOR WITH HOLD FOR                           
371214           SELECT DISTINCT                                                
371215                  M.SHIPT_ID                                              
371216                , M.PRO_NBR                                               
371217                , M.TRIP_ID                                               
371218                , T.EST_AR_TMST                                           
371219                , T.VEH_NBR                                               
371220                , T.OWNER_SCAC_ID                                         
371221                , V.VEH_TYP_CDE                                           
371222                , O.FOB_CDE                                               
371223                , O.POE_CDE                                               
371224                , MIN(N.PO_NBR) AS PONBR                                  
371225             FROM                                                         
371226                  TVHTRIP   T                                             
371227                , TVEHICL   V                                             
371228                , TTRSTYP   Y                                             
371229                , TTRIPST   S                                             
371230                , TSHIPMT   M                                             
371231                , TSHPTPO   N                                             
371232                , TPLNSHP   O                                             
371233             WHERE ((T.LAST_UPD_DTE > :PV-LAST-RUN-TMST-DTE)              
371234               OR  (T.LAST_UPD_DTE = :PV-LAST-RUN-TMST-DTE                
371235               AND  T.LAST_UPD_TME > :PV-LAST-RUN-TMST-TM))               
371236               AND  V.VEH_TYP_CDE      IN ('VS', 'AV')                    
371237               AND  T.VEH_NBR          = V.VEH_NBR                        
371238               AND  Y.TRIP_STATUS_CDE  = S.TRIP_STATUS_CDE                
371239               AND  T.TRIP_ID          = S.TRIP_ID                        
371240               AND  T.TRIP_ID          = M.TRIP_ID                        
371241               AND  M.SHIPT_ID         = N.SHIPT_ID                       
371242               AND  N.PO_NBR           = O.PO_NBR                         
371243               AND  O.VER_STATUS_CDE   = 'A'                              
371244               AND  T.OWNER_SCAC_ID    = V.OWNER_SCAC_ID                  
371245               AND  Y.PRTY_CDE         =                                  
371246                    (SELECT MAX(PRTY_CDE)                                 
371247                       FROM TTRIPST  ST                                   
371248                          , TTRSTYP  TY                                   
371249                     WHERE ST.TRIP_ID = T.TRIP_ID                         
371250                       AND ST.TRIP_STATUS_CDE =                           
371251                           TY.TRIP_STATUS_CDE)                            
371252               AND  Y.PRTY_CDE         < '95'                             
371253             GROUP BY M.SHIPT_ID, M.PRO_NBR, M.TRIP_ID,                   
371254                      T.EST_AR_TMST, T.VEH_NBR, T.OWNER_SCAC_ID,          
371255                      V.VEH_TYP_CDE, O.FOB_CDE, O.POE_CDE                 
371256             ORDER BY T.EST_AR_TMST ,V.VEH_TYP_CDE                        
371264     END-EXEC.                                                            
371270                                                                          
371271*                                                                         
371272*                                                                         
371273*  CURSOR DECLARATION TO OBTAIN TRIP CHANGES - AUDIT                      
371274*                                                                         
371275*                                                                         
371276     EXEC SQL                                                             
371277          DECLARE TRIP_AUDIT_CUR CURSOR WITH HOLD FOR                     
371278           SELECT DISTINCT                                                
371279                 EST_AR_TMST                                              
371280               , VEH_NBR                                                  
371281               , OWNER_SCAC_ID                                            
371282               , LAST_UPD_DTE                                             
371283               , LAST_UPD_TME                                             
371289           FROM TAUTRIP                                                   
371290          WHERE TRIP_ID  = :SHIPMT-TRIP-ID                                
371294*           AND ((LAST_UPD_DTE > :PV-LAST-RUN-TMST-DTE)                   
371295*            OR (LAST_UPD_DTE = :PV-LAST-RUN-TMST-DTE                     
371296*           AND LAST_UPD_TME > :PV-LAST-RUN-TMST-TM))                     
371298             ORDER BY LAST_UPD_DTE, LAST_UPD_TME DESC                     
371301     END-EXEC.                                                            
371302                                                                          
371303*                                                                         
371304*                                                                         
371305*  CURSOR DECLARATION TO OBTAIN TRIP/SHIPMENT (CONTAINER) DELETES         
371310*                                                                         
371320*                                                                         
371330     EXEC SQL                                                             
371340          DECLARE TRIP_DEL_CUR CURSOR FOR                                 
371341           SELECT                                                         
371342                  SH.PRO_NBR                                              
371343                , SH.SHIPT_ID                                             
371344                , SH.TRIP_ID                                              
371345                , T.EST_AR_TMST                                           
371346                , T.VEH_NBR                                               
371347                , T.OWNER_SCAC_ID                                         
371348                , V.VEH_TYP_CDE                                           
371349                , O.FOB_CDE                                               
371350                , O.POE_CDE                                               
371351                , MIN(N.PO_NBR) AS PONBR                                  
371352                , MAX(TS.STATUS_DTE) AS STATDTE                           
371353                , MAX(TS.STATUS_TME) AS STATTME                           
371354             FROM                                                         
371355                  TAUTRIP   T                                             
371356                , TAUSHIP   SH                                            
371358                , TSHIPST   S                                             
371359                , TTRIPST   TS                                            
371360                , TVEHICL   V                                             
371361                , TSHPTPO   N                                             
371362                , TPLNSHP   O                                             
371363             WHERE ((TS.STATUS_DTE > :PV-LAST-RUN-TMST-DTE)               
371364               OR  (TS.STATUS_DTE = :PV-LAST-RUN-TMST-DTE                 
371365               AND  TS.STATUS_TME > :PV-LAST-RUN-TMST-TM))                
371366               AND  TS.TRIP_STATUS_CDE = 'DE'                             
371367               AND ((S.STATUS_DTE > :PV-LAST-RUN-TMST-DTE)                
371368               AND  (S.STATUS_DTE = :PV-LAST-RUN-TMST-DTE                 
371369               AND  S.STATUS_TME > :PV-LAST-RUN-TMST-TM))                 
371370               AND  S.SHIPT_STATUS_CDE = 'ET'                             
371371               AND  V.VEH_TYP_CDE      IN ('VS', 'AV')                    
371372               AND  T.TRIP_ID  = TS.TRIP_ID                               
371373               AND  T.TRIP_ID  = SH.TRIP_ID                               
371374               AND  SH.SHIPT_ID = S.SHIPT_ID                              
371375               AND  T.VEH_NBR          = V.VEH_NBR                        
371376               AND  SH.SHIPT_ID        = N.SHIPT_ID                       
371377               AND  N.PO_NBR           = O.PO_NBR                         
371378               AND  O.VER_STATUS_CDE   = 'A'                              
371379               AND  T.OWNER_SCAC_ID    = V.OWNER_SCAC_ID                  
371380             GROUP BY SH.PRO_NBR, SH.SHIPT_ID, SH.TRIP_ID,                
371381                      T.EST_AR_TMST, T.VEH_NBR, T.OWNER_SCAC_ID,          
371382                      V.VEH_TYP_CDE, O.FOB_CDE, O.POE_CDE                 
371383             ORDER BY T.EST_AR_TMST ,V.VEH_TYP_CDE                        
371384     END-EXEC.                                                            
371385                                                                          
371386*                                                                         
371387*                                                                         
371388*  CURSOR DECLARATION TO OBTAIN SHIPMENT (CONTAINER) ADDS/CHANGES         
371389*                                                                         
371390*                                                                         
371391     EXEC SQL                                                             
371392          DECLARE SHIPT_CUR CURSOR FOR                                    
371393           SELECT                                                         
371394                  SH.PRO_NBR                                              
371395                , SH.SHIPT_ID                                             
371396                , SH.TRIP_ID                                              
371397                , T.EST_AR_TMST                                           
371398                , T.VEH_NBR                                               
371399                , T.OWNER_SCAC_ID                                         
371400                , V.VEH_TYP_CDE                                           
371401                , O.FOB_CDE                                               
371402                , O.POE_CDE                                               
371403                , MIN(N.PO_NBR) AS PONBR                                  
371404             FROM                                                         
371405                  TVHTRIP   T                                             
371406                , TSHIPMT   SH                                            
371407                , TSHSTYP   Y                                             
371410                , TSHIPST   S                                             
371412                , TVEHICL   V                                             
371416                , TSHPTPO   N                                             
371417                , TPLNSHP   O                                             
371419             WHERE ((SH.LAST_UPD_DTE > :PV-LAST-RUN-TMST-DTE)             
371420               OR  (SH.LAST_UPD_DTE = :PV-LAST-RUN-TMST-DTE               
371421               AND SH.LAST_UPD_TME > :PV-LAST-RUN-TMST-TM))               
371422               AND  V.VEH_TYP_CDE      IN ('VS', 'AV')                    
371423               AND  T.TRIP_ID  = SH.TRIP_ID                               
371424               AND  SH.SHIPT_ID = S.SHIPT_ID                              
371425               AND  Y.SHIPT_STATUS_CDE = S.SHIPT_STATUS_CDE               
371429               AND  T.VEH_NBR          = V.VEH_NBR                        
371431**             AND  Y.SHIPT_STATUS_CDE = S.SHIPT_STATUS_CDE               
371433               AND  SH.SHIPT_ID        = N.SHIPT_ID                       
371434               AND  N.PO_NBR           = O.PO_NBR                         
371435               AND  O.VER_STATUS_CDE   = 'A'                              
371438               AND  T.OWNER_SCAC_ID    = V.OWNER_SCAC_ID                  
371440               AND  Y.PRTY_CDE =                                          
371441                    (SELECT MAX(TY.PRTY_CDE)                              
371442                       FROM TSHIPST  ST                                   
371443                          , TSHSTYP  TY                                   
371444                     WHERE ST.SHIPT_ID = S.SHIPT_ID                       
371445                       AND ST.SHIPT_STATUS_CDE =                          
371446                           TY.SHIPT_STATUS_CDE)                           
371447               AND  Y.PRTY_CDE < '95'                                     
371448             GROUP BY SH.PRO_NBR, SH.SHIPT_ID, SH.TRIP_ID,                
371449                      T.EST_AR_TMST, T.VEH_NBR, T.OWNER_SCAC_ID,          
371450                      V.VEH_TYP_CDE, O.FOB_CDE, O.POE_CDE                 
371451             ORDER BY  T.EST_AR_TMST ,V.VEH_TYP_CDE                       
371462     END-EXEC.                                                            
371463                                                                          
371464*                                                                         
371465*                                                                         
371466*  CURSOR DECLARATION TO OBTAIN SHIPMENT (CONTAINER) CHANGES              
371467*                                                                         
371468*                                                                         
371469     EXEC SQL                                                             
371470          DECLARE SHIPT_CHG_CUR CURSOR FOR                                
371516           SELECT                                                         
371517                 PRO_NBR                                                  
371518               , LAST_UPD_DTE                                             
371519               , LAST_UPD_TME                                             
371522           FROM TAUSHIP                                                   
371523          WHERE SHIPT_ID = :SHIPMT-SHIPT-ID                               
371524*           AND ((LAST_UPD_DTE > :PV-LAST-RUN-TMST-DTE)                   
371525*           OR (LAST_UPD_DTE = :PV-LAST-RUN-TMST-DTE                      
371526*           AND LAST_UPD_TME > :PV-LAST-RUN-TMST-TM))                     
371527          ORDER BY LAST_UPD_DTE, LAST_UPD_TME DESC                        
371528     END-EXEC.                                                            
371529                                                                          
371530*                                                                         
371531*                                                                         
371532*  CURSOR DECLARATION TO OBTAIN SHIPMENT (CONTAINER) DELETES              
371533*                                                                         
371534*                                                                         
371535     EXEC SQL                                                             
371536          DECLARE SHIPT_DEL_CUR CURSOR FOR                                
371537           SELECT                                                         
371538                  SH.PRO_NBR                                              
371539                , SH.SHIPT_ID                                             
371540                , SH.TRIP_ID                                              
371541                , T.EST_AR_TMST                                           
371542                , T.VEH_NBR                                               
371543                , T.OWNER_SCAC_ID                                         
371544                , V.VEH_TYP_CDE                                           
371545                , O.FOB_CDE                                               
371546                , O.POE_CDE                                               
371547                , MIN(N.PO_NBR) AS PONBR                                  
371548                , MAX(S.STATUS_DTE) AS STATDTE                            
371549                , MAX(S.STATUS_TME) AS STATTME                            
371550             FROM                                                         
371551                  TVHTRIP   T                                             
371552                , TAUSHIP   SH                                            
371553*               , TSHSTYP   Y                                             
371554                , TSHIPST   S                                             
371555                , TVEHICL   V                                             
371556                , TSHPTPO   N                                             
371557                , TPLNSHP   O                                             
371558             WHERE ((S.STATUS_DTE > :PV-LAST-RUN-TMST-DTE)                
371559               OR   (S.STATUS_DTE = :PV-LAST-RUN-TMST-DTE                 
371560               AND  S.STATUS_TME > :PV-LAST-RUN-TMST-TM))                 
371561               AND  S.SHIPT_STATUS_CDE = 'DE'                             
371562               AND  V.VEH_TYP_CDE      IN ('VS', 'AV')                    
371563               AND  T.TRIP_ID  = SH.TRIP_ID                               
371564               AND  SH.SHIPT_ID = S.SHIPT_ID                              
371565*              AND  Y.SHIPT_STATUS_CDE = S.SHIPT_STATUS_CDE               
371566               AND  T.VEH_NBR          = V.VEH_NBR                        
371567               AND  SH.SHIPT_ID        = N.SHIPT_ID                       
371568               AND  N.PO_NBR           = O.PO_NBR                         
371569               AND  O.VER_STATUS_CDE   = 'A'                              
371570               AND  T.OWNER_SCAC_ID    = V.OWNER_SCAC_ID                  
371571*              AND  Y.PRTY_CDE = '99'                                     
371572             GROUP BY SH.PRO_NBR, SH.SHIPT_ID, SH.TRIP_ID,                
371573                      T.EST_AR_TMST, T.VEH_NBR, T.OWNER_SCAC_ID,          
371574                      V.VEH_TYP_CDE, O.FOB_CDE, O.POE_CDE                 
371575             ORDER BY T.EST_AR_TMST ,V.VEH_TYP_CDE                        
371576     END-EXEC.                                                            
371577                                                                          
371578*                                                                         
371579*                                                                         
371580*  CURSOR DECLARATION TO OBTAIN PURCHASE ORDER ADDS                       
371581*                                                                         
371582*                                                                         
371583     EXEC SQL                                                             
371584          DECLARE PO_CUR CURSOR FOR                                       
371585           SELECT                                                         
371586                  SH.PRO_NBR                                              
371587                , SH.SHIPT_ID                                             
371588                , SH.TRIP_ID                                              
371589                , T.EST_AR_TMST                                           
371590                , T.VEH_NBR                                               
371591                , T.OWNER_SCAC_ID                                         
371592                , V.VEH_TYP_CDE                                           
371593                , O.FOB_CDE                                               
371594                , O.POE_CDE                                               
371595                , MAX(A.LAST_UPD_DTE) AS UPDDTE                           
371596                , MAX(A.LAST_UPD_TIME) AS UPDTIME                         
371597                , A.TRN_CDE                                               
371598                , MIN(N.PO_NBR) AS PONBR                                  
371599             FROM                                                         
371600                  TVHTRIP   T                                             
371601                , TSHIPMT   SH                                            
371602                , TVEHICL   V                                             
371603                , TSHPTPO   N                                             
371604                , TAUSHPO   A                                             
371605                , TPLNSHP   O                                             
371606             WHERE ((N.LAST_UPD_DTE > :PV-LAST-RUN-TMST-DTE)              
371607               OR   (N.LAST_UPD_DTE = :PV-LAST-RUN-TMST-DTE               
371608               AND N.LAST_UPD_TIME > :PV-LAST-RUN-TMST-TM))               
371609               AND  V.VEH_TYP_CDE      IN ('VS', 'AV')                    
371610               AND  T.TRIP_ID          = SH.TRIP_ID                       
371611               AND  T.VEH_NBR          = V.VEH_NBR                        
371612               AND  SH.SHIPT_ID        = N.SHIPT_ID                       
371613               AND  N.PO_NBR           = O.PO_NBR                         
371614               AND  N.SHIPT_ID         = A.SHIPT_ID                       
371615               AND  N.PO_NBR           = A.PO_NBR                         
371616               AND  A.TRN_CDE          = 'A'                              
371617               AND  N.LAST_UPD_DTE     = A.LAST_UPD_DTE                   
371618               AND  N.LAST_UPD_TIME    = A.LAST_UPD_TIME                  
371619               AND  O.VER_STATUS_CDE   = 'A'                              
371620               AND  T.OWNER_SCAC_ID    = V.OWNER_SCAC_ID                  
371621             GROUP BY SH.PRO_NBR, SH.SHIPT_ID, SH.TRIP_ID,                
371622                      T.EST_AR_TMST, T.VEH_NBR,                           
371623                      T.OWNER_SCAC_ID, V.VEH_TYP_CDE,                     
371624                      O.FOB_CDE, O.POE_CDE, A.TRN_CDE                     
371625             ORDER BY SH.SHIPT_ID                                         
371630     END-EXEC.                                                            
371700*                                                                         
371800*                                                                         
371900*  CURSOR DECLARATION TO OBTAIN PURCHASE ORDER DELETES                    
372000*                                                                         
372100*                                                                         
372200     EXEC SQL                                                             
372300          DECLARE PO_DEL_CUR CURSOR FOR                                   
372400           SELECT                                                         
372500                  SH.PRO_NBR                                              
372600                , SH.SHIPT_ID                                             
372700                , SH.TRIP_ID                                              
372800                , T.EST_AR_TMST                                           
372900                , T.VEH_NBR                                               
373000                , T.OWNER_SCAC_ID                                         
373200                , V.VEH_TYP_CDE                                           
373300                , O.FOB_CDE                                               
373400                , O.POE_CDE                                               
373500                , MAX(A.LAST_UPD_DTE) AS UPDDTE                           
373600                , MAX(A.LAST_UPD_TIME) AS UPDTIME                         
373700                , A.TRN_CDE                                               
373710                , MIN(A.PO_NBR)                                           
373800             FROM                                                         
373900                  TVHTRIP   T                                             
374000                , TSHIPMT   SH                                            
374100                , TVEHICL   V                                             
374300                , TAUSHPO   A                                             
374400                , TPLNSHP   O                                             
374600             WHERE ((A.LAST_UPD_DTE > :PV-LAST-RUN-TMST-DTE)              
374610               OR  (A.LAST_UPD_DTE = :PV-LAST-RUN-TMST-DTE                
374700               AND A.LAST_UPD_TIME > :PV-LAST-RUN-TMST-TM))               
374900               AND  V.VEH_TYP_CDE      IN ('VS', 'AV')                    
375100               AND  T.VEH_NBR          = V.VEH_NBR                        
375300               AND  T.TRIP_ID          = SH.TRIP_ID                       
375400               AND  SH.SHIPT_ID        = A.SHIPT_ID                       
375500               AND  A.PO_NBR           = O.PO_NBR                         
375800               AND  A.TRN_CDE          = 'D'                              
375900               AND  O.VER_STATUS_CDE   = 'A'                              
376200               AND  T.OWNER_SCAC_ID    = V.OWNER_SCAC_ID                  
376302             GROUP BY SH.PRO_NBR, SH.SHIPT_ID, SH.TRIP_ID,                
376303                      T.EST_AR_TMST, T.VEH_NBR,                           
376304                      T.OWNER_SCAC_ID, V.VEH_TYP_CDE,                     
376305                      O.FOB_CDE, O.POE_CDE, A.TRN_CDE                     
376320             ORDER BY SH.SHIPT_ID                                         
376500     END-EXEC.                                                            
376600*                                                                         
638265******************************************************************        
638266 LINKAGE SECTION.                                                         
638267******************************************************************        
638268                                                                          
638269******************************************************************        
638270 PROCEDURE DIVISION.                                                      
638271******************************************************************        
638272                                                                          
638276******************************************************************        
638277 0000-PROGRAM-MAINLINE.                                                   
638278                                                                          
638279     PERFORM 1000-INITIALIZE.                                             
638280                                                                          
638281     PERFORM 2000-CREATE-CONTNR-RULES-FILE.                               
638282                                                                          
638283     PERFORM 9000-EOJ-ROUTINE.                                            
638284     STOP RUN.                                                            
638285                                                                          
638286******************************************************************        
638287*  FIRST OCCURENCE OF DB2 CURSOR, PRINTS INITIAL PAGE HEADING TO          
638288*  REPORT FILES.                                                          
638289******************************************************************        
638290 1000-INITIALIZE.                                                         
638291                                                                          
638300     OPEN OUTPUT TR265-CONTNR-RULES-FILE.                                 
638302                                                                          
638310     INITIALIZE TR265-CONTNR-RULES-REC.                                   
638320     INITIALIZE PV-TR265-CONTNR-RULES-FIELDS.                             
638327                                                                          
638338     PERFORM 1100-RETRIEVE-LAST-RUN-TMST.                                 
638340     DISPLAY '**************************************'.                    
638341     DISPLAY 'PV-LAST-RUN-TMST='  PV-LAST-RUN-TMST.                       
638343     DISPLAY '**************************************'.                    
638344     MOVE PV-LAST-RUN-TMST (1:10) TO PV-LAST-RUN-TMST-DTE.                
638345     MOVE PV-LAST-RUN-TMST (12:8) TO PV-LAST-RUN-TMST-TM.                 
638346                                                                          
638348     PERFORM 3950-RETRIEVE-CURRENT-TMST.                                  
638349     MOVE PV-CURRENT-TMST TO PV-START-TMST.                               
638350                                                                          
638354******************************************************************        
638355* THIS PARAGRAPH WILL RETRIEVE THE LAST RUN TMST OF THE PROGRAM           
638358******************************************************************        
638359 1100-RETRIEVE-LAST-RUN-TMST.                                             
638360                                                                          
638361     EXEC SQL                                                             
638362         SELECT LAST_EXTR_PRC_TMST                                        
638363           INTO :PV-LAST-RUN-TMST                                         
638364           FROM TIMCNTL                                                   
638367     END-EXEC.                                                            
638368                                                                          
638369     EVALUATE TRUE                                                        
638370         WHEN SQLWARN0 NOT EQUAL SPACE                                    
638371         WHEN SQLCODE NOT EQUAL ZERO                                      
638372             DISPLAY '** ABEND **'                                        
638373             DISPLAY '** PROGRAM = TRKUT260 **'                           
638374             DISPLAY '** PARAGRAPH = 1100-RETRIEVE LAST-RUN-TMST'         
638375             DISPLAY '** UNSUCCESSFUL SELECT OF LAST RUN TMST*'           
638376             PERFORM 9100-SQL-ABEND                                       
638377     END-EVALUATE.                                                        
638378                                                                          
638379 EJECT                                                                    
638426******************************************************************        
638427* THIS PARAGRAPH WILL CREATE THE CONTAINER RULES RECORDS                  
638428******************************************************************        
638429 2000-CREATE-CONTNR-RULES-FILE.                                           
638430                                                                          
638431     PERFORM 3000-OPEN-SHIPT-CURSOR.                                      
638433     SET PS-SHIPT-FOUND-NO TO TRUE.                                       
638434     SET PS-SHIPT-CHG-FOUND-NO TO TRUE.                                   
638435     PERFORM 2010-PROCESS-SHIPT-CURSOR UNTIL                              
638436        PS-EOC-SHIPT-CURSOR.                                              
638437     DISPLAY '****DONE WITH 2010-PROCESS-SHIPT-CURSOR'.                   
638439                                                                          
638445     PERFORM 3020-OPEN-SHIPT-DEL-CURSOR.                                  
638447     SET PS-SHIPT-DEL-FOUND-NO TO TRUE.                                   
638448     PERFORM 2020-PROCESS-SHIPT-DEL-CURSOR UNTIL                          
638449        PS-EOC-SHIPT-DEL-CURSOR.                                          
638450     DISPLAY '****DONE WITH 2020-PROCESS-SHIPT-DEL-CURSOR'.               
638458                                                                          
638460     PERFORM 3110-OPEN-TRIP-DEL-CURSOR.                                   
638461     SET PS-TRIP-DEL-FOUND-NO TO TRUE.                                    
638462     PERFORM 2025-PROCESS-TRIP-DEL-CURSOR UNTIL                           
638463        PS-EOC-TRIP-DEL-CURSOR.                                           
638464     DISPLAY '****DONE WITH 2025-PROCESS-TRIP-DEL-CURSOR'.                
638465                                                                          
638466     PERFORM 3040-OPEN-TRIP-CURSOR.                                       
638467     SET PS-TRIP-FOUND-NO TO TRUE.                                        
638468     PERFORM 2030-PROCESS-TRIP-CURSOR UNTIL                               
638469        PS-EOC-TRIP-CURSOR.                                               
638470     DISPLAY '****DONE WITH 2030-PROCESS-TRIP-CURSOR'.                    
638471                                                                          
638472     PERFORM 3060-OPEN-PO-CURSOR.                                         
638473     SET PS-PO-FOUND-NO TO TRUE.                                          
638474     PERFORM 2040-PROCESS-PO-CURSOR UNTIL                                 
638475        PS-EOC-PO-CURSOR.                                                 
638476     DISPLAY '****DONE WITH 2040-PROCESS-PO-CURSOR'.                      
638477                                                                          
638478     PERFORM 3090-OPEN-PO-DEL-CURSOR.                                     
638479     SET PS-PO-DEL-FOUND-NO TO TRUE.                                      
638480     PERFORM 2050-PROCESS-PO-DEL-CURSOR UNTIL                             
638490        PS-EOC-PO-DEL-CURSOR.                                             
638491     DISPLAY '****DONE WITH 2050-PROCESS-PO-CURSOR'.                      
638500                                                                          
638618******************************************************************        
638619*  PROCESS ALL NEW AND UPDATED CONTAINERS SINCE LAST RUN.                 
638620******************************************************************        
638621 2010-PROCESS-SHIPT-CURSOR.                                               
638622                                                                          
638631     PERFORM 3010-FETCH-SHIPT-CURSOR.                                     
638634                                                                          
638635     IF PS-EOC-SHIPT-CURSOR                                               
638636         PERFORM 3005-CLOSE-SHIPT-CURSOR                                  
638637         DISPLAY '*****CLOSING-SHIPT-CURSOR'                              
638638     ELSE                                                                 
638639         MOVE ZEROS TO PV-DB2-COUNT                                       
638640         PERFORM 3085-CHECK-FOR-ADD                                       
638641         IF PV-DB2-COUNT = +1                                             
638642             MOVE PC-A                 TO PV-CONTNR-TRN-TYP               
638643             MOVE PC-SHA               TO PV-CONTNR-TRN-SRCE              
638644             MOVE SHIPMT-SHIPT-ID      TO PV-SHIPT-ID                     
638645             MOVE SHIPMT-PRO-NBR       TO PV-CONTNR-ID                    
638646             MOVE VHTRIP-EST-AR-TMST   TO PV-ETA-TMST-CUR                 
638647             MOVE VHTRIP-VEH-NBR       TO PV-VEH-NM-CUR                   
638648             MOVE PLNSHP-FOB-CDE       TO PV-FOB-CDE-CUR                  
638658             PERFORM 3500-BUILD-CONTNR-RULES-FILE                         
638659     DISPLAY '*****WRITE-CONTNR-RULE-RECORD FROM 2010 1 AUD'              
638660         ELSE                                                             
638661             IF PV-DB2-COUNT > +1                                         
638662                 SET PS-SHIPT-CHG-FOUND-NO TO TRUE                        
638663                 SET PS-AUSHIP-ROW-FOUND-NO TO TRUE                       
638665                 SET PS-EOC-SHIPT-CHG-CURSOR-NO TO TRUE                   
638666                 PERFORM 3161-OPEN-SHIPT-CHG-CURSOR                       
638667                 PERFORM 3163-FETCH-SHIPT-CHG-CURSOR                      
638668                 IF PS-EOC-SHIPT-CHG-CURSOR                               
638669                     DISPLAY '2010-3163--NO AUDIT RECORD ERROR'           
638670                     PERFORM 3162-CLOSE-SHIPT-CHG-CURSOR                  
638671                     SET PS-SHIPT-CHG-FOUND-NO TO TRUE                    
638672                 ELSE                                                     
638674                     PERFORM 3160-PROCESS-SHIPT-CHG-CURSOR                
638696                 END-IF                                                   
638697             END-IF                                                       
638698         END-IF                                                           
638699     END-IF.                                                              
638709                                                                          
638710******************************************************************        
638711*  PROCESS DELETED SHIPMENTS SINCE LAST RUN.                              
638712******************************************************************        
638713 2020-PROCESS-SHIPT-DEL-CURSOR.                                           
638714                                                                          
638715     PERFORM 3030-FETCH-SHIPT-DEL-CURSOR.                                 
638716                                                                          
638717     IF PS-EOC-SHIPT-DEL-CURSOR                                           
638718         PERFORM 3025-CLOSE-SHIPT-DEL-CURSOR                              
638719     ELSE                                                                 
638720         IF PS-SHIPT-DEL-FOUND                                            
638721             MOVE PC-D TO PV-CONTNR-TRN-TYP                               
638722             MOVE PC-SHD TO PV-CONTNR-TRN-SRCE                            
638723             MOVE AUSHIP-PRO-NBR       TO PV-CONTNR-ID                    
638724             MOVE AUSHIP-SHIPT-ID      TO PV-SHIPT-ID                     
638725             MOVE VHTRIP-EST-AR-TMST   TO PV-ETA-TMST-CUR                 
638726             MOVE VHTRIP-VEH-NBR       TO PV-VEH-NM-CUR                   
638727             MOVE PLNSHP-FOB-CDE       TO PV-FOB-CDE-CUR                  
638729             PERFORM 3500-BUILD-CONTNR-RULES-FILE                         
638730         DISPLAY '*****WRITE-CONTNR-RULE-RECORD FROM 2020'                
638731         END-IF                                                           
638732     END-IF.                                                              
638733                                                                          
638734******************************************************************        
638735*  PROCESS DELETED TRIP/SHIPMENTS SINCE LAST RUN.                         
638736******************************************************************        
638737 2025-PROCESS-TRIP-DEL-CURSOR.                                            
638738                                                                          
638739     PERFORM 3120-FETCH-TRIP-DEL-CURSOR.                                  
638740                                                                          
638741     IF PS-EOC-TRIP-DEL-CURSOR                                            
638742         PERFORM 3115-CLOSE-TRIP-DEL-CURSOR                               
638743     ELSE                                                                 
638744         IF PS-TRIP-DEL-FOUND                                             
638745             MOVE PC-D TO PV-CONTNR-TRN-TYP                               
638746             MOVE PC-TRD TO PV-CONTNR-TRN-SRCE                            
638747             MOVE AUSHIP-PRO-NBR       TO PV-CONTNR-ID                    
638748             MOVE AUSHIP-SHIPT-ID      TO PV-SHIPT-ID                     
638749             MOVE AUTRIP-EST-AR-TMST   TO PV-ETA-TMST-CUR                 
638750             MOVE AUTRIP-VEH-NBR       TO PV-VEH-NM-CUR                   
638751             MOVE PLNSHP-FOB-CDE       TO PV-FOB-CDE-CUR                  
638753             PERFORM 3500-BUILD-CONTNR-RULES-FILE                         
638754         DISPLAY '*****WRITE-CONTNR-RULE-RECORD FROM 2025'                
638755         END-IF                                                           
638756     END-IF.                                                              
638757                                                                          
638758******************************************************************        
638759*  PROCESS TRIP CHANGES SINCE LAST RUN.                                   
638760******************************************************************        
638761 2030-PROCESS-TRIP-CURSOR.                                                
638762                                                                          
638763     DISPLAY '2030-PROCESS-TRIP-CURSOR'.                                  
638764                                                                          
638770     PERFORM 3050-FETCH-TRIP-CURSOR.                                      
638900                                                                          
639000     IF PS-EOC-TRIP-CURSOR                                                
639100         PERFORM 3045-CLOSE-TRIP-CURSOR                                   
639110         SET PS-TRIP-FOUND-NO TO TRUE                                     
639200     ELSE                                                                 
639202         SET PS-TRIP-CHANGES-FOUND-NO TO TRUE                             
639203         SET PS-AUTRIP-ROW-FOUND-NO TO TRUE                               
639204         SET PS-EOC-TRIP-AUDIT-CURSOR-NO TO TRUE                          
639205         PERFORM 2065-OPEN-TRIP-AUDIT-CURSOR                              
639206         PERFORM 2075-FETCH-TRIP-AUDIT-CURSOR                             
639207         IF PS-EOC-TRIP-AUDIT-CURSOR                                      
639209             DISPLAY '2030-2075--NO AUDIT RECORD ERROR'                   
639211             PERFORM 2070-CLOSE-TRIP-AUDIT-CURSOR                         
639212             SET PS-TRIP-CHANGES-FOUND-NO TO TRUE                         
639214         ELSE                                                             
639215             PERFORM 2060-PROCESS-TRIP-AUDIT-CURSOR                       
639216     END-IF.                                                              
639217                                                                          
640010******************************************************************        
640100*  PROCESS PO ADDS SINCE LAST RUN                                         
640200******************************************************************        
640300 2040-PROCESS-PO-CURSOR.                                                  
640310                                                                          
640320     DISPLAY '2040-PROCESS-PO-CURSOR'.                                    
640321                                                                          
640322     PERFORM 3070-FETCH-PO-CURSOR.                                        
640361                                                                          
640362     IF PS-EOC-PO-CURSOR                                                  
640363         PERFORM 3065-CLOSE-PO-CURSOR                                     
640364     ELSE                                                                 
640391         MOVE PC-C                 TO PV-CONTNR-TRN-TYP                   
640392         MOVE PC-Y                 TO PV-CONTNR-PO-UPD-IND                
640393         MOVE PC-POA               TO PV-CONTNR-TRN-SRCE                  
640394         MOVE SHIPMT-PRO-NBR       TO PV-CONTNR-ID                        
640395         MOVE SHIPMT-SHIPT-ID      TO PV-SHIPT-ID                         
640397         MOVE VHTRIP-EST-AR-TMST   TO PV-ETA-TMST-CUR                     
640398         MOVE VHTRIP-VEH-NBR       TO PV-VEH-NM-CUR                       
640399         MOVE PLNSHP-FOB-CDE       TO PV-FOB-CDE-CUR                      
640414         PERFORM 3500-BUILD-CONTNR-RULES-FILE                             
640415         DISPLAY '*****WRITE-CONTNR-RULE-RECORD FROM 2040'                
640416     END-IF.                                                              
640417                                                                          
640418******************************************************************        
640419*  PROCESS PO DELETES SINCE LAST RUN                                      
640420******************************************************************        
640421 2050-PROCESS-PO-DEL-CURSOR.                                              
640422                                                                          
640423     DISPLAY '2050-PROCESS-PO-DEL-CURSOR'.                                
640424                                                                          
640425     PERFORM 3100-FETCH-PO-DEL-CURSOR.                                    
640426                                                                          
640427     IF PS-EOC-PO-DEL-CURSOR                                              
640428         PERFORM 3095-CLOSE-PO-DEL-CURSOR                                 
640429     ELSE                                                                 
640430         MOVE ZEROS TO PV-DB2-COUNT                                       
640431         PERFORM 3075-CHECK-CONTNR-PO-COUNT                               
640432         IF PV-DB2-COUNT = +0                                             
640433             MOVE PC-D                 TO PV-CONTNR-TRN-TYP               
640434             MOVE PC-Y                 TO PV-CONTNR-PO-UPD-IND            
640435             MOVE PC-POD               TO PV-CONTNR-TRN-SRCE              
640436             MOVE SHIPMT-SHIPT-ID      TO PV-SHIPT-ID                     
640437             MOVE SHIPMT-PRO-NBR       TO PV-CONTNR-ID                    
640438             MOVE VHTRIP-EST-AR-TMST   TO PV-ETA-TMST-CUR                 
640439             MOVE VHTRIP-VEH-NBR       TO PV-VEH-NM-CUR                   
640440             MOVE PLNSHP-FOB-CDE       TO PV-FOB-CDE-CUR                  
640442             PERFORM 3500-BUILD-CONTNR-RULES-FILE                         
640443             DISPLAY '*****WRITE-CONTNR-RULE-RECORD PO DEL A'             
640444         ELSE                                                             
640445             IF PV-DB2-COUNT > +0                                         
640446                 MOVE PC-C               TO PV-CONTNR-TRN-TYP             
640447                 MOVE PC-Y               TO PV-CONTNR-PO-UPD-IND          
640448                 MOVE PC-POC             TO PV-CONTNR-TRN-SRCE            
640449                 MOVE SHIPMT-SHIPT-ID    TO PV-SHIPT-ID                   
640450                 MOVE SHIPMT-PRO-NBR     TO PV-CONTNR-ID                  
640451                 MOVE VHTRIP-EST-AR-TMST TO PV-ETA-TMST-CUR               
640452                 MOVE VHTRIP-VEH-NBR     TO PV-VEH-NM-CUR                 
640453                 MOVE PLNSHP-FOB-CDE     TO PV-FOB-CDE-CUR                
640455                 PERFORM 3500-BUILD-CONTNR-RULES-FILE                     
640456                 DISPLAY '*****WRITE-CONTNR-RULE-RECORD PO DEL B'         
640457             END-IF                                                       
640458         END-IF                                                           
640459     END-IF.                                                              
640460                                                                          
640461******************************************************************        
640462*  PROCESS TRIP AUDIT CHANGES SINCE LAST RUN.                             
640463******************************************************************        
640464 2060-PROCESS-TRIP-AUDIT-CURSOR.                                          
640465                                                                          
640466     DISPLAY '2060-PROCESS-TRIP-AUDIT-CURSOR'.                            
640467                                                                          
640468     PERFORM 2075-FETCH-TRIP-AUDIT-CURSOR.                                
640469                                                                          
640470     IF PS-EOC-TRIP-AUDIT-CURSOR                                          
640472         PERFORM 2070-CLOSE-TRIP-AUDIT-CURSOR                             
640473         SET PS-TRIP-CHANGES-FOUND-NO TO TRUE                             
640475     ELSE                                                                 
640478         SET PS-TRIP-CHANGES-FOUND-NO TO TRUE                             
640484         PERFORM 3155-COMPARE-TAUTRIP-CHANGES                             
640486         IF PS-TRIP-CHANGES-FOUND                                         
640488             MOVE PC-C TO PV-CONTNR-TRN-TYP                               
640489             MOVE PC-TRC TO PV-CONTNR-TRN-SRCE                            
640490             MOVE SHIPMT-PRO-NBR       TO PV-CONTNR-ID                    
640491             MOVE SHIPMT-SHIPT-ID      TO PV-SHIPT-ID                     
640494             MOVE VHTRIP-EST-AR-TMST   TO PV-ETA-TMST-CUR                 
640495             MOVE AUTRIP-EST-AR-TMST   TO PV-ETA-TMST-PREV                
640496             MOVE VHTRIP-VEH-NBR       TO PV-VEH-NM-CUR                   
640497             MOVE AUTRIP-VEH-NBR       TO PV-VEH-NM-PREV                  
640498             MOVE PLNSHP-FOB-CDE       TO PV-FOB-CDE-CUR                  
640499                                          PV-FOB-CDE-PREV                 
640500             PERFORM 3500-BUILD-CONTNR-RULES-FILE                         
640502             PERFORM 2070-CLOSE-TRIP-AUDIT-CURSOR                         
640503             SET PS-TRIP-CHANGES-FOUND-NO TO TRUE                         
640504             DISPLAY '*****WRITE-CONTNR-RULE-RECORD FROM 2060'            
640506         ELSE                                                             
640507             PERFORM 2070-CLOSE-TRIP-AUDIT-CURSOR                         
640508             SET PS-TRIP-CHANGES-FOUND-NO TO TRUE                         
640509         END-IF                                                           
640510     END-IF.                                                              
640520                                                                          
640550******************************************************************        
640551* OPEN THE TRIP AUDIT CURSOR                                     *        
640552******************************************************************        
640553 2065-OPEN-TRIP-AUDIT-CURSOR.                                             
640554                                                                          
640555     DISPLAY '2065-OPEN-TRIP-AUDIT-CURSOR'.                               
640556                                                                          
640557     EXEC SQL                                                             
640558          OPEN TRIP_AUDIT_CUR                                             
640559     END-EXEC.                                                            
640560                                                                          
640561     EVALUATE TRUE                                                        
640562         WHEN SQLWARN0 NOT EQUAL SPACE                                    
640563         WHEN SQLCODE NOT EQUAL ZERO                                      
640564             DISPLAY '** ABEND **'                                        
640565             DISPLAY '** PROGRAM = TRKUT260 **'                           
640566             DISPLAY '** PARAGRAPH = 2065-OPEN-TRIP-AUDIT-CURSOR'         
640567             PERFORM 9100-SQL-ABEND                                       
640568     END-EVALUATE.                                                        
640569                                                                          
640570******************************************************************        
640571* CLOSE THE TRIP AUDIT CURSOR                                    *        
640572******************************************************************        
640573 2070-CLOSE-TRIP-AUDIT-CURSOR.                                            
640574                                                                          
640575     DISPLAY '2070-CLOSE-TRIP-AUDIT-CURSOR'.                              
640576                                                                          
640577     EXEC SQL                                                             
640578         CLOSE TRIP_AUDIT_CUR                                             
640579     END-EXEC.                                                            
640580                                                                          
640581     EVALUATE TRUE                                                        
640582         WHEN SQLWARN0 NOT EQUAL SPACE                                    
640583         WHEN SQLCODE NOT EQUAL ZERO                                      
640584             DISPLAY '** ABEND **'                                        
640585             DISPLAY '** PROGRAM = TRKUT260 **'                           
640586             DISPLAY '** PARAGRAPH = 2070-CLOSE-TRIP-AUDIT-CURSOR'        
640587             PERFORM 9100-SQL-ABEND                                       
640588     END-EVALUATE.                                                        
640589                                                                          
640590******************************************************************        
640591* FETCH THE TRIP AUDIT CURSOR                                    *        
640592******************************************************************        
640593 2075-FETCH-TRIP-AUDIT-CURSOR.                                            
640594                                                                          
640595     DISPLAY '2075-FETCH-TRIP-AUDIT-CURSOR'.                              
640596                                                                          
640597     INITIALIZE PV-NULL-ETA                                               
640598                PV-NULL-VEH-NBR.                                          
640599                                                                          
640600     EXEC SQL                                                             
640601          FETCH TRIP_AUDIT_CUR                                            
640602          INTO                                                            
640603                :AUTRIP-EST-AR-TMST:PV-NULL-ETA                           
640604              , :AUTRIP-VEH-NBR:PV-NULL-VEH-NBR                           
640605              , :AUTRIP-OWNER-SCAC-ID                                     
640606              , :AUTRIP-LAST-UPD-DTE                                      
640607              , :AUTRIP-LAST-UPD-TME                                      
640608     END-EXEC.                                                            
640609                                                                          
640610                                                                          
640611     EVALUATE TRUE                                                        
640612         WHEN SQLCODE = ZERO                                              
640613              IF PV-NULL-ETA = 0                                          
640614                CONTINUE                                                  
640615              ELSE                                                        
640616                MOVE SPACES TO AUTRIP-EST-AR-TMST                         
640617              END-IF                                                      
640618              IF PV-NULL-VEH-NBR = 0                                      
640619                CONTINUE                                                  
640620              ELSE                                                        
640621                MOVE SPACES TO AUTRIP-VEH-NBR                             
640622              END-IF                                                      
640623                                                                          
640624         WHEN SQLCODE = +100                                              
640625              SET PS-EOC-TRIP-AUDIT-CURSOR TO TRUE                        
640626                                                                          
640627         WHEN SQLWARN0 NOT EQUAL SPACE                                    
640628         WHEN SQLCODE NOT EQUAL ZERO                                      
640629             DISPLAY '** ABEND **'                                        
640630             DISPLAY '** PROGRAM = TRKUT260 **'                           
640631             DISPLAY '** PARAGRAPH = 2075-FETCH-TRIP-AUDIT-CURSOR'        
640632             PERFORM 9100-SQL-ABEND                                       
640633     END-EVALUATE.                                                        
640634                                                                          
640635 EJECT                                                                    
640636******************************************************************        
640637* OPEN THE SHIPMENT (CONTAINER) CURSOR                           *        
640638******************************************************************        
640639 3000-OPEN-SHIPT-CURSOR.                                                  
640640                                                                          
640641     EXEC SQL                                                             
640642          OPEN SHIPT_CUR                                                  
640643     END-EXEC.                                                            
640644                                                                          
640645     EVALUATE TRUE                                                        
640646         WHEN SQLWARN0 NOT EQUAL SPACE                                    
640647         WHEN SQLCODE NOT EQUAL ZERO                                      
640648             DISPLAY '** ABEND **'                                        
640649             DISPLAY '** PROGRAM = TRKUT260 **'                           
640650             DISPLAY '** PARAGRAPH = 3000-OPEN-SHIPT-CURSOR*'             
640651             PERFORM 9100-SQL-ABEND                                       
640652     END-EVALUATE.                                                        
640653                                                                          
640654******************************************************************        
640655* CLOSE THE SHIPMENT (CONTAINER) CURSOR                          *        
640656******************************************************************        
640657 3005-CLOSE-SHIPT-CURSOR.                                                 
640658                                                                          
640659     EXEC SQL                                                             
640660         CLOSE SHIPT_CUR                                                  
640661     END-EXEC.                                                            
640662                                                                          
640663     EVALUATE TRUE                                                        
640664         WHEN SQLWARN0 NOT EQUAL SPACE                                    
640665         WHEN SQLCODE NOT EQUAL ZERO                                      
640666             DISPLAY '** ABEND **'                                        
640667             DISPLAY '** PROGRAM = TRKUT260 **'                           
640668             DISPLAY '** PARAGRAPH = 3005-CLOSE-SHIPT-CURSOR*'            
640669             PERFORM 9100-SQL-ABEND                                       
640670     END-EVALUATE.                                                        
640671                                                                          
640672******************************************************************        
640673* FETCH THE SHIPMENT (CONTAINER) CURSOR                          *        
640674******************************************************************        
640675 3010-FETCH-SHIPT-CURSOR.                                                 
640680                                                                          
640700     DISPLAY '3010-FETCH-SHIPT-CURSOR'.                                   
640701                                                                          
640702     EXEC SQL                                                             
640703          FETCH SHIPT_CUR                                                 
640704          INTO                                                            
640705                  :SHIPMT-PRO-NBR                                         
640706                , :SHIPMT-SHIPT-ID                                        
640707                , :SHIPMT-TRIP-ID                                         
640708                , :VHTRIP-EST-AR-TMST                                     
640709                , :VHTRIP-VEH-NBR                                         
640710                , :VHTRIP-OWNER-SCAC-ID                                   
640711                , :VEHICL-VEH-TYP-CDE                                     
640712                , :PLNSHP-FOB-CDE                                         
640713                , :PLNSHP-POE-CDE                                         
640714                , :SHPTPO-PO-NBR                                          
640715     END-EXEC.                                                            
640716                                                                          
640717     EVALUATE TRUE                                                        
640718         WHEN SQLCODE = ZERO                                              
640719              SET PS-SHIPT-FOUND TO TRUE                                  
640720              DISPLAY '******SHIPT-FOUND'                                 
640721          DISPLAY 'PS-SHIPT-FOUND-SW ' PS-SHIPT-FOUND-SW                  
640722          DISPLAY 'EOC-SHIPT-SW ' PS-EOC-SHIPT-CURSOR-SW                  
640723          DISPLAY 'SHIPMT-PRO-NBR ' SHIPMT-PRO-NBR                        
640724                                                                          
640725         WHEN SQLCODE = +100                                              
640726              SET PS-SHIPT-FOUND-NO TO TRUE                               
640727              SET PS-EOC-SHIPT-CURSOR TO TRUE                             
640728              DISPLAY '******END OF SHIPT ADD CURSOR'                     
640729         DISPLAY 'PS-SHIPT-FOUND-SW ' PS-SHIPT-FOUND-SW                   
640730         DISPLAY 'EOC-SHIPT-SW ' PS-EOC-SHIPT-CURSOR-SW                   
640731                                                                          
640732         WHEN SQLWARN0 NOT EQUAL SPACE                                    
640733         WHEN SQLCODE NOT EQUAL ZERO                                      
640734             DISPLAY '** ABEND **'                                        
640735             DISPLAY '** PROGRAM = TRKUT260 **'                           
640736           DISPLAY '** PARAGRAPH = 3010-FETCH-SHIPT-CURSOR**'             
640737             PERFORM 9100-SQL-ABEND                                       
640738     END-EVALUATE.                                                        
640739                                                                          
640740     DISPLAY 'FETCH 3010 SHIPMENT CURSOR SQLCODE ' SQLCODE.               
640741                                                                          
640742 EJECT                                                                    
640743******************************************************************        
640744* OPEN THE SHIPMENT DELETE CURSOR                                *        
640745******************************************************************        
640746 3020-OPEN-SHIPT-DEL-CURSOR.                                              
640747                                                                          
640748     EXEC SQL                                                             
640749          OPEN SHIPT_DEL_CUR                                              
640750     END-EXEC.                                                            
640751                                                                          
640752     EVALUATE TRUE                                                        
640753         WHEN SQLWARN0 NOT EQUAL SPACE                                    
640754         WHEN SQLCODE NOT EQUAL ZERO                                      
640755             DISPLAY '** ABEND **'                                        
640756             DISPLAY '** PROGRAM = TRKUT260 **'                           
640757             DISPLAY '** PARAGRAPH = 3020-OPEN-SHIPT-DEL-CURSOR**'        
640758             PERFORM 9100-SQL-ABEND                                       
640759     END-EVALUATE.                                                        
640760                                                                          
640761******************************************************************        
640762* CLOSE THE SHIPMENT DELETE CURSOR                               *        
640763******************************************************************        
640764 3025-CLOSE-SHIPT-DEL-CURSOR.                                             
640765                                                                          
640766     EXEC SQL                                                             
640767         CLOSE SHIPT_DEL_CUR                                              
640768     END-EXEC.                                                            
640769                                                                          
640770     EVALUATE TRUE                                                        
640771         WHEN SQLWARN0 NOT EQUAL SPACE                                    
640772         WHEN SQLCODE NOT EQUAL ZERO                                      
640773             DISPLAY '** ABEND **'                                        
640774             DISPLAY '** PROGRAM = TRKUT260 **'                           
640775             DISPLAY '** PARAGRAPH = 3025-CLOSE-SHIPT-DEL-CURSOR*'        
640776             PERFORM 9100-SQL-ABEND                                       
640777     END-EVALUATE.                                                        
640778                                                                          
640779******************************************************************        
640780* FETCH THE SHIPMENT DELETE CURSOR                               *        
640781******************************************************************        
640782 3030-FETCH-SHIPT-DEL-CURSOR.                                             
640783                                                                          
640784     EXEC SQL                                                             
640785          FETCH SHIPT_DEL_CUR                                             
640786          INTO                                                            
640787                  :AUSHIP-PRO-NBR                                         
640788                , :AUSHIP-SHIPT-ID                                        
640789                , :AUSHIP-TRIP-ID                                         
640790                , :VHTRIP-EST-AR-TMST                                     
640791                , :VHTRIP-VEH-NBR                                         
640792                , :VHTRIP-OWNER-SCAC-ID                                   
640793                , :VEHICL-VEH-TYP-CDE                                     
640794                , :PLNSHP-FOB-CDE                                         
640795                , :PLNSHP-POE-CDE                                         
640796                , :SHPTPO-PO-NBR                                          
640797                , :SHIPST-STATUS-DTE                                      
640798                , :SHIPST-STATUS-TME                                      
640799     END-EXEC.                                                            
640800                                                                          
640801     EVALUATE TRUE                                                        
640802         WHEN SQLCODE = ZERO                                              
640803              SET PS-SHIPT-DEL-FOUND TO TRUE                              
640804                                                                          
640805         WHEN SQLCODE = +100                                              
640806              SET PS-EOC-SHIPT-DEL-CURSOR TO TRUE                         
640807              SET PS-SHIPT-DEL-FOUND-NO TO TRUE                           
640808                                                                          
640809         WHEN SQLWARN0 NOT EQUAL SPACE                                    
640810         WHEN SQLCODE NOT EQUAL ZERO                                      
640811             DISPLAY '** ABEND **'                                        
640812             DISPLAY '** PROGRAM = TRKUT260 **'                           
640813             DISPLAY '** PARAGRAPH = 3030-FETCH-SHIPT-DEL-CURSOR*'        
640814             PERFORM 9100-SQL-ABEND                                       
640815     END-EVALUATE.                                                        
640816                                                                          
640817 EJECT                                                                    
640818******************************************************************        
640819* OPEN THE TRIP CURSOR                                           *        
640820******************************************************************        
640821 3040-OPEN-TRIP-CURSOR.                                                   
640822                                                                          
640823     DISPLAY '3040-OPEN-TRIP-CURSOR'.                                     
640824                                                                          
640825     EXEC SQL                                                             
640826          OPEN TRIP_CUR                                                   
640827     END-EXEC.                                                            
640828                                                                          
640829     EVALUATE TRUE                                                        
640830         WHEN SQLWARN0 NOT EQUAL SPACE                                    
640831         WHEN SQLCODE NOT EQUAL ZERO                                      
640832             DISPLAY '** ABEND **'                                        
640833             DISPLAY '** PROGRAM = TRKUT260 **'                           
640834             DISPLAY '** PARAGRAPH = 3040-OPEN-TRIP-CURSOR**'             
640835             PERFORM 9100-SQL-ABEND                                       
640836     END-EVALUATE.                                                        
640837                                                                          
640838******************************************************************        
640839* CLOSE THE TRIP CURSOR                                          *        
640840******************************************************************        
640841 3045-CLOSE-TRIP-CURSOR.                                                  
640842                                                                          
640843     DISPLAY '3045-CLOSE-TRIP-CURSOR'.                                    
640844                                                                          
640845     EXEC SQL                                                             
640846         CLOSE TRIP_CUR                                                   
640847     END-EXEC.                                                            
640848                                                                          
640849     EVALUATE TRUE                                                        
640850         WHEN SQLWARN0 NOT EQUAL SPACE                                    
640851         WHEN SQLCODE NOT EQUAL ZERO                                      
640852             DISPLAY '** ABEND **'                                        
640853             DISPLAY '** PROGRAM = TRKUT260 **'                           
640854             DISPLAY '** PARAGRAPH = 3045-CLOSE-TRIP-CURSOR*'             
640855             PERFORM 9100-SQL-ABEND                                       
640856     END-EVALUATE.                                                        
640857                                                                          
640858******************************************************************        
640859* FETCH THE TRIP CURSOR                                          *        
640860******************************************************************        
640861 3050-FETCH-TRIP-CURSOR.                                                  
640862                                                                          
640863     DISPLAY '3050-FETCH-TRIP-CURSOR'.                                    
640864                                                                          
640865     EXEC SQL                                                             
640866          FETCH TRIP_CUR                                                  
640867          INTO                                                            
640868                  :SHIPMT-SHIPT-ID                                        
640869                , :SHIPMT-PRO-NBR                                         
640870                , :SHIPMT-TRIP-ID                                         
640871                , :VHTRIP-EST-AR-TMST                                     
640872                , :VHTRIP-VEH-NBR                                         
640873                , :VHTRIP-OWNER-SCAC-ID                                   
640874                , :VEHICL-VEH-TYP-CDE                                     
640875                , :PLNSHP-FOB-CDE                                         
640876                , :PLNSHP-POE-CDE                                         
640877                , :SHPTPO-PO-NBR                                          
640878     END-EXEC.                                                            
640879                                                                          
640880     DISPLAY 'SHIPMT-SHIPT-ID ' SHIPMT-SHIPT-ID.                          
640881     DISPLAY 'SHIPMT-PRO-NBR ' SHIPMT-PRO-NBR .                           
640882                                                                          
640883     EVALUATE TRUE                                                        
640884         WHEN SQLCODE = ZERO                                              
640885              SET PS-TRIP-FOUND TO TRUE                                   
640886                                                                          
640887         WHEN SQLCODE = +100                                              
640888              SET PS-EOC-TRIP-CURSOR TO TRUE                              
640889              SET PS-TRIP-FOUND-NO TO TRUE                                
640890                                                                          
640891         WHEN SQLWARN0 NOT EQUAL SPACE                                    
640892         WHEN SQLCODE NOT EQUAL ZERO                                      
640893             DISPLAY '** ABEND **'                                        
640894             DISPLAY '** PROGRAM = TRKUT260 **'                           
640895             DISPLAY '** PARAGRAPH = 3050-FETCH-TRIP-CURSOR*'             
640896             PERFORM 9100-SQL-ABEND                                       
640897     END-EVALUATE.                                                        
640898                                                                          
640899 EJECT                                                                    
640900******************************************************************        
640901* OPEN THE PO CURSOR                                             *        
640902******************************************************************        
640903 3060-OPEN-PO-CURSOR.                                                     
640904                                                                          
640905     EXEC SQL                                                             
640906          OPEN PO_CUR                                                     
640907     END-EXEC.                                                            
640908                                                                          
640909     EVALUATE TRUE                                                        
640910         WHEN SQLWARN0 NOT EQUAL SPACE                                    
640911         WHEN SQLCODE NOT EQUAL ZERO                                      
640912             DISPLAY '** ABEND **'                                        
640913             DISPLAY '** PROGRAM = TRKUT260 **'                           
640914             DISPLAY '** PARAGRAPH = 3060-OPEN-PO-CURSOR**'               
640915             PERFORM 9100-SQL-ABEND                                       
640916     END-EVALUATE.                                                        
640917                                                                          
640918******************************************************************        
640919* CLOSE THE PO CURSOR                                            *        
640920******************************************************************        
640921 3065-CLOSE-PO-CURSOR.                                                    
640922                                                                          
640923     EXEC SQL                                                             
640924         CLOSE PO_CUR                                                     
640925     END-EXEC.                                                            
640926                                                                          
640927     EVALUATE TRUE                                                        
640928         WHEN SQLWARN0 NOT EQUAL SPACE                                    
640929         WHEN SQLCODE NOT EQUAL ZERO                                      
640930             DISPLAY '** ABEND **'                                        
640931             DISPLAY '** PROGRAM = TRKUT260 **'                           
640932             DISPLAY '** PARAGRAPH = 3065-CLOSE-PO-CURSOR*'               
640933             PERFORM 9100-SQL-ABEND                                       
640934     END-EVALUATE.                                                        
640935                                                                          
640936******************************************************************        
640937* FETCH THE PO CURSOR                                            *        
640938******************************************************************        
640939 3070-FETCH-PO-CURSOR.                                                    
640940                                                                          
640941     DISPLAY '3070-FETCH-PO-CURSOR'.                                      
640942                                                                          
640943     EXEC SQL                                                             
640944          FETCH PO_CUR                                                    
640945          INTO                                                            
640946                :SHIPMT-PRO-NBR                                           
640947              , :SHIPMT-SHIPT-ID                                          
640948              , :SHIPMT-TRIP-ID                                           
640949              , :VHTRIP-EST-AR-TMST                                       
640950              , :VHTRIP-VEH-NBR                                           
640951              , :VHTRIP-OWNER-SCAC-ID                                     
640952              , :VEHICL-VEH-TYP-CDE                                       
640953              , :PLNSHP-FOB-CDE                                           
640954              , :PLNSHP-POE-CDE                                           
640955              , :AUSHPO-LAST-UPD-DTE                                      
640956              , :AUSHPO-LAST-UPD-TIME                                     
640957              , :AUSHPO-TRN-CDE                                           
640958              , :SHPTPO-PO-NBR                                            
640959     END-EXEC.                                                            
640960                                                                          
640961     EVALUATE TRUE                                                        
640962         WHEN SQLCODE = ZERO                                              
640963              SET PS-PO-FOUND TO TRUE                                     
640964              DISPLAY 'SHIPMT-PRO-NBR ' SHIPMT-PRO-NBR                    
640965              DISPLAY 'SHPTPO-PO-NBR ' SHPTPO-PO-NBR                      
640966                                                                          
640967         WHEN SQLCODE = +100                                              
640968              SET PS-EOC-PO-CURSOR TO TRUE                                
640969              SET PS-PO-FOUND-NO TO TRUE                                  
640970                                                                          
640971         WHEN SQLWARN0 NOT EQUAL SPACE                                    
640972         WHEN SQLCODE NOT EQUAL ZERO                                      
640973             DISPLAY '** ABEND **'                                        
640974             DISPLAY '** PROGRAM = TRKUT260 **'                           
640975             DISPLAY '** PARAGRAPH = 3070-FETCH-PO-CURSOR*'               
640976             PERFORM 9100-SQL-ABEND                                       
640977     END-EVALUATE.                                                        
640978                                                                          
640979 EJECT                                                                    
640980******************************************************************        
640981* CHECK TO SEE IF PO IS THE ONLY ONE ON THIS CONTAINER           *        
640982******************************************************************        
640983 3075-CHECK-CONTNR-PO-COUNT.                                              
640984                                                                          
640985     DISPLAY '3075-CHECK-CONTNR-PO-COUNT'.                                
640986                                                                          
640987     EXEC SQL                                                             
640988          SELECT COUNT(*)                                                 
640989           INTO :PV-DB2-COUNT                                             
640990           FROM TSHPTPO  A                                                
640991              , TSHIPMT  B                                                
640992          WHERE A.SHIPT_ID = B.SHIPT_ID                                   
640993            AND B.PRO_NBR  =  :SHIPMT-PRO-NBR                             
640994            AND A.PO_NBR   ^= :SHPTPO-PO-NBR                              
640995*           AND A.SHIPT_ID ^= :SHIPMT-SHIPT-ID                            
640996     END-EXEC.                                                            
640997                                                                          
640998     EVALUATE TRUE                                                        
640999         WHEN SQLCODE = ZERO                                              
641000         WHEN SQLCODE = -811                                              
641001             CONTINUE                                                     
641002                                                                          
641003         WHEN SQLCODE = +100                                              
641004             CONTINUE                                                     
641005                                                                          
641006         WHEN SQLWARN0 NOT EQUAL SPACE                                    
641007         WHEN SQLCODE NOT EQUAL ZERO                                      
641008             DISPLAY '** ABEND **'                                        
641009             DISPLAY '** PROGRAM = TRKUT260 **'                           
641010             DISPLAY '** PARAGRAPH = 3075-CHECK-CONTNR-PO-COUNT**'        
641011             PERFORM 9100-SQL-ABEND                                       
641012     END-EVALUATE.                                                        
641013                                                                          
641014     DISPLAY 'PV-DB2-COUNT ' PV-DB2-COUNT.                                
641015                                                                          
641016******************************************************************        
641017* CHECK TAUSHIP TABLE TO SEE IF THIS IS AN ADD TRANSACTION       *        
641018******************************************************************        
641019 3085-CHECK-FOR-ADD.                                                      
641020                                                                          
641021     DISPLAY '3085-CHECK-FOR-ADD'.                                        
641022                                                                          
641023     EXEC SQL                                                             
641024          SELECT COUNT(*)                                                 
641025           INTO :PV-DB2-COUNT                                             
641026           FROM TAUSHIP                                                   
641027          WHERE SHIPT_ID  = :SHIPMT-SHIPT-ID                              
641028            AND TRIP_ID   = :SHIPMT-TRIP-ID                               
641029     END-EXEC.                                                            
641030                                                                          
641031     EVALUATE TRUE                                                        
641032                                                                          
641033         WHEN SQLCODE = ZERO                                              
641034         WHEN SQLCODE = -811                                              
641035             CONTINUE                                                     
641036                                                                          
641037         WHEN SQLCODE = +100                                              
641038             CONTINUE                                                     
641039                                                                          
641040         WHEN SQLWARN0 NOT EQUAL SPACE                                    
641041         WHEN SQLCODE NOT EQUAL ZERO                                      
641042             DISPLAY '** ABEND **'                                        
641043             DISPLAY '** PROGRAM = TRKUT260 **'                           
641044             DISPLAY '** PARAGRAPH = 3085-CHECK-FOR-ADD***'               
641045             PERFORM 9100-SQL-ABEND                                       
641046     END-EVALUATE.                                                        
641050                                                                          
641060         DISPLAY 'SQLCODE FROM 3085 ' SQLCODE.                            
641061         DISPLAY 'PV-DB2-COUNT ' PV-DB2-COUNT.                            
641062******************************************************************        
641063* OPEN THE PO DELETE CURSOR                                      *        
641064******************************************************************        
641065 3090-OPEN-PO-DEL-CURSOR.                                                 
641066                                                                          
641067     EXEC SQL                                                             
641068          OPEN PO_DEL_CUR                                                 
641069     END-EXEC.                                                            
641070                                                                          
641071     EVALUATE TRUE                                                        
641072         WHEN SQLWARN0 NOT EQUAL SPACE                                    
641073         WHEN SQLCODE NOT EQUAL ZERO                                      
641074             DISPLAY '** ABEND **'                                        
641075             DISPLAY '** PROGRAM = TRKUT260 **'                           
641076             DISPLAY '** PARAGRAPH = 3090-OPEN-PO-DEL-CURSOR**'           
641077             PERFORM 9100-SQL-ABEND                                       
641078     END-EVALUATE.                                                        
641079                                                                          
641080******************************************************************        
641081* CLOSE THE PO DELETE CURSOR                                     *        
641082******************************************************************        
641083 3095-CLOSE-PO-DEL-CURSOR.                                                
641084                                                                          
641085     EXEC SQL                                                             
641086         CLOSE PO_DEL_CUR                                                 
641087     END-EXEC.                                                            
641088                                                                          
641089     EVALUATE TRUE                                                        
641090         WHEN SQLWARN0 NOT EQUAL SPACE                                    
641091         WHEN SQLCODE NOT EQUAL ZERO                                      
641092             DISPLAY '** ABEND **'                                        
641093             DISPLAY '** PROGRAM = TRKUT260 **'                           
641094             DISPLAY '** PARAGRAPH = 3095-CLOSE-PO-DEL-CURSOR*'           
641095             PERFORM 9100-SQL-ABEND                                       
641096     END-EVALUATE.                                                        
641097                                                                          
641098******************************************************************        
641099* FETCH THE PO DELETE CURSOR                                     *        
641100******************************************************************        
641101 3100-FETCH-PO-DEL-CURSOR.                                                
641102                                                                          
641103     EXEC SQL                                                             
641104          FETCH PO_DEL_CUR                                                
641105          INTO                                                            
641106                :SHIPMT-PRO-NBR                                           
641107              , :SHIPMT-SHIPT-ID                                          
641108              , :SHIPMT-TRIP-ID                                           
641109              , :VHTRIP-EST-AR-TMST                                       
641110              , :VHTRIP-VEH-NBR                                           
641111              , :VHTRIP-OWNER-SCAC-ID                                     
641112              , :VEHICL-VEH-TYP-CDE                                       
641113              , :PLNSHP-FOB-CDE                                           
641114              , :PLNSHP-POE-CDE                                           
641115              , :AUSHPO-LAST-UPD-DTE                                      
641116              , :AUSHPO-LAST-UPD-TIME                                     
641117              , :AUSHPO-TRN-CDE                                           
641118              , :SHPTPO-PO-NBR                                            
641119     END-EXEC.                                                            
641120                                                                          
641121     EVALUATE TRUE                                                        
641122         WHEN SQLCODE = ZERO                                              
641123              SET PS-PO-DEL-FOUND TO TRUE                                 
641124                                                                          
641125         WHEN SQLCODE = +100                                              
641126              SET PS-EOC-PO-DEL-CURSOR TO TRUE                            
641127              SET PS-PO-DEL-FOUND-NO TO TRUE                              
641128                                                                          
641129         WHEN SQLWARN0 NOT EQUAL SPACE                                    
641130         WHEN SQLCODE NOT EQUAL ZERO                                      
641131             DISPLAY '** ABEND **'                                        
641132             DISPLAY '** PROGRAM = TRKUT260 **'                           
641133             DISPLAY '** PARAGRAPH = 3100-FETCH-PO-DEL-CURSOR*'           
641134             PERFORM 9100-SQL-ABEND                                       
641135     END-EVALUATE.                                                        
641136                                                                          
641137 EJECT                                                                    
641138******************************************************************        
641139* OPEN THE TRIP/SHIPMENT DELETE CURSOR                           *        
641140******************************************************************        
641141 3110-OPEN-TRIP-DEL-CURSOR.                                               
641142                                                                          
641143     EXEC SQL                                                             
641144          OPEN TRIP_DEL_CUR                                               
641145     END-EXEC.                                                            
641146                                                                          
641147     EVALUATE TRUE                                                        
641148         WHEN SQLWARN0 NOT EQUAL SPACE                                    
641149         WHEN SQLCODE NOT EQUAL ZERO                                      
641150             DISPLAY '** ABEND **'                                        
641151             DISPLAY '** PROGRAM = TRKUT260 **'                           
641152             DISPLAY '** PARAGRAPH = 3110-OPEN-TRIP-DEL-CURSOR**'         
641153             PERFORM 9100-SQL-ABEND                                       
641154     END-EVALUATE.                                                        
641155                                                                          
641156******************************************************************        
641157* CLOSE THE TRIP/SHIPMENT DELETE CURSOR                          *        
641158******************************************************************        
641159 3115-CLOSE-TRIP-DEL-CURSOR.                                              
641160                                                                          
641161     EXEC SQL                                                             
641162         CLOSE TRIP_DEL_CUR                                               
641163     END-EXEC.                                                            
641164                                                                          
641165     EVALUATE TRUE                                                        
641166         WHEN SQLWARN0 NOT EQUAL SPACE                                    
641167         WHEN SQLCODE NOT EQUAL ZERO                                      
641168             DISPLAY '** ABEND **'                                        
641169             DISPLAY '** PROGRAM = TRKUT260 **'                           
641170             DISPLAY '** PARAGRAPH = 3115-CLOSE-TRIP-DEL-CURSOR*'         
641171             PERFORM 9100-SQL-ABEND                                       
641172     END-EVALUATE.                                                        
641173                                                                          
641174******************************************************************        
641175* FETCH THE TRIP/SHIPMENT DELETE CURSOR                          *        
641176******************************************************************        
641177 3120-FETCH-TRIP-DEL-CURSOR.                                              
641178                                                                          
641179     EXEC SQL                                                             
641180          FETCH TRIP_DEL_CUR                                              
641181          INTO                                                            
641182                  :AUSHIP-PRO-NBR                                         
641183                , :AUSHIP-SHIPT-ID                                        
641184                , :AUSHIP-TRIP-ID                                         
641185                , :AUTRIP-EST-AR-TMST                                     
641186                , :AUTRIP-VEH-NBR                                         
641187                , :AUTRIP-OWNER-SCAC-ID                                   
641188                , :VEHICL-VEH-TYP-CDE                                     
641189                , :PLNSHP-FOB-CDE                                         
641190                , :PLNSHP-POE-CDE                                         
641191                , :SHPTPO-PO-NBR                                          
641192                , :TRIPST-STATUS-DTE                                      
641193                , :TRIPST-STATUS-TME                                      
641194     END-EXEC.                                                            
641195                                                                          
641196     EVALUATE TRUE                                                        
641197         WHEN SQLCODE = ZERO                                              
641198              SET PS-TRIP-DEL-FOUND TO TRUE                               
641199                                                                          
641200         WHEN SQLCODE = +100                                              
641201              SET PS-EOC-TRIP-DEL-CURSOR TO TRUE                          
641202              SET PS-TRIP-DEL-FOUND-NO TO TRUE                            
641203                                                                          
641204         WHEN SQLWARN0 NOT EQUAL SPACE                                    
641205         WHEN SQLCODE NOT EQUAL ZERO                                      
641206             DISPLAY '** ABEND **'                                        
641207             DISPLAY '** PROGRAM = TRKUT260 **'                           
641208             DISPLAY '** PARAGRAPH = 3120-FETCH-TRIP-DEL-CURSOR*'         
641209             PERFORM 9100-SQL-ABEND                                       
641210     END-EVALUATE.                                                        
641211                                                                          
641212 EJECT                                                                    
641213******************************************************************        
641214* SELECT TAUTRIP FIELDS FOR CHANGES COMPARISON                   *        
641215******************************************************************        
641216 3150-SELECT-TAUTRIP-CHANGES.                                             
641217                                                                          
641218     DISPLAY '3150-SELECT-TAUTRIP-CHANGES'.                               
641219                                                                          
641220     EXEC SQL                                                             
641221          SELECT EST_AR_TMST                                              
641222               , VEH_NBR                                                  
641223               , OWNER_SCAC_ID                                            
641224               , MAX(LAST_UPD_DTE) AS UPDDTE                              
641225               , MAX(LAST_UPD_TME) AS UPDTME                              
641226           INTO :AUTRIP-EST-AR-TMST                                       
641227              , :AUTRIP-VEH-NBR                                           
641228              , :AUTRIP-OWNER-SCAC-ID                                     
641229              , :AUTRIP-LAST-UPD-DTE                                      
641230              , :AUTRIP-LAST-UPD-TME                                      
641231           FROM TAUTRIP                                                   
641232          WHERE TRIP_ID  = :SHIPMT-TRIP-ID                                
641233            AND ((LAST_UPD_DTE > :PV-LAST-RUN-TMST-DTE)                   
641234             OR (LAST_UPD_DTE = :PV-LAST-RUN-TMST-DTE                     
641235            AND LAST_UPD_TME > :PV-LAST-RUN-TMST-TM))                     
641236          GROUP BY EST_AR_TMST, VEH_NBR, OWNER_SCAC_ID                    
641237     END-EXEC.                                                            
641238                                                                          
641239     DISPLAY 'SHIPMT-TRIP-ID ' SHIPMT-TRIP-ID .                           
641240                                                                          
641241     EVALUATE TRUE                                                        
641242         WHEN SQLCODE = ZERO                                              
641243         WHEN SQLCODE = -811                                              
641244             SET PS-AUTRIP-ROW-FOUND TO TRUE                              
641245                                                                          
641246         WHEN SQLCODE = +100                                              
641247             SET PS-AUTRIP-ROW-FOUND-NO TO TRUE                           
641248                                                                          
641249         WHEN SQLWARN0 NOT EQUAL SPACE                                    
641250         WHEN SQLCODE NOT EQUAL ZERO                                      
641251             DISPLAY '** ABEND **'                                        
641252             DISPLAY '** PROGRAM = TRKUT260 **'                           
641253             DISPLAY '** PARAGRAPH = 3150-SELECT-TAUTRIP-CHANGES*'        
641254             PERFORM 9100-SQL-ABEND                                       
641255     END-EVALUATE.                                                        
641256                                                                          
641257     DISPLAY 'PS-AUTRIP-ROW-FOUND-SW ' PS-AUTRIP-ROW-FOUND-SW.            
641258                                                                          
641259******************************************************************        
641260* COMPARE TAUTRIP FIELDS AGAINST TVHTRIP FIELDS                  *        
641261******************************************************************        
641262 3155-COMPARE-TAUTRIP-CHANGES.                                            
641263                                                                          
641264     DISPLAY '3155-COMPARE-TAUTRIP-CHANGES'.                              
641265                                                                          
641266     IF (VHTRIP-EST-AR-TMST NOT EQUAL AUTRIP-EST-AR-TMST) OR              
641267        (VHTRIP-VEH-NBR NOT EQUAL AUTRIP-VEH-NBR)         OR              
641268        (VHTRIP-OWNER-SCAC-ID NOT EQUAL AUTRIP-OWNER-SCAC-ID)             
641269         SET PS-TRIP-CHANGES-FOUND TO TRUE                                
641270     END-IF.                                                              
641280                                                                          
641290     DISPLAY 'PS-TRIP-CHANGES-FOUND SW' PS-TRIP-CHANGES-FOUND-SW.         
641300     DISPLAY 'VHTRIP-EST-AR-TMST ' VHTRIP-EST-AR-TMST.                    
641400     DISPLAY 'AUTRIP-EST-AR-TMST ' AUTRIP-EST-AR-TMST.                    
641500     DISPLAY 'VHTRIP-VEH-NBR ' VHTRIP-VEH-NBR.                            
641600     DISPLAY 'AUTRIP-VEH-NBR ' AUTRIP-VEH-NBR.                            
641700     DISPLAY 'VHTRIP-OWNER-SCAC-ID ' VHTRIP-OWNER-SCAC-ID.                
641701     DISPLAY 'AUTRIP-OWNER-SCAC-ID ' AUTRIP-OWNER-SCAC-ID.                
641702                                                                          
641703******************************************************************        
641704*  PROCESS SHIPMENT (CONTAINER) CHANGES SINCE LAST RUN                    
641705******************************************************************        
641706 3160-PROCESS-SHIPT-CHG-CURSOR.                                           
641707                                                                          
641708     DISPLAY '3160-PROCESS-SHIPT-CHG-CURSOR'.                             
641709                                                                          
641710     PERFORM 3163-FETCH-SHIPT-CHG-CURSOR.                                 
641711                                                                          
641712     IF PS-EOC-SHIPT-CHG-CURSOR                                           
641713         PERFORM 3162-CLOSE-SHIPT-CHG-CURSOR                              
641714         SET PS-SHIPT-CHG-FOUND-NO TO TRUE                                
641716     ELSE                                                                 
641717         SET PS-SHIPT-CHG-FOUND-NO TO TRUE                                
641719         PERFORM 3165-COMPARE-TAUSHIP-CHANGES                             
641720         IF PS-SHIPT-CHG-FOUND                                            
641722             MOVE PC-D TO PV-CONTNR-TRN-TYP                               
641723             MOVE PC-SHC TO PV-CONTNR-TRN-SRCE                            
641724             MOVE SHIPMT-SHIPT-ID     TO PV-SHIPT-ID                      
641725             MOVE VHTRIP-EST-AR-TMST  TO PV-ETA-TMST-CUR                  
641726             MOVE VHTRIP-VEH-NBR      TO PV-VEH-NM-CUR                    
641727             MOVE PLNSHP-FOB-CDE      TO PV-FOB-CDE-CUR                   
641729             MOVE AUSHIP-PRO-NBR      TO PV-CONTNR-ID                     
641730             PERFORM 3500-BUILD-CONTNR-RULES-FILE                         
641731         DISPLAY '*****WRITE-CONTNR-RULE-RECORD FROM 2010 2 DEL'          
641732             MOVE PC-A TO PV-CONTNR-TRN-TYP                               
641733             MOVE PC-SHC TO PV-CONTNR-TRN-SRCE                            
641734             MOVE SHIPMT-SHIPT-ID     TO PV-SHIPT-ID                      
641735             MOVE VHTRIP-EST-AR-TMST  TO PV-ETA-TMST-CUR                  
641736             MOVE VHTRIP-VEH-NBR      TO PV-VEH-NM-CUR                    
641737             MOVE PLNSHP-FOB-CDE      TO PV-FOB-CDE-CUR                   
641739             MOVE SHIPMT-PRO-NBR      TO PV-CONTNR-ID                     
641740         DISPLAY '*****WRITE-CONTNR-RULE-RECORD FROM 2010 2 ADD'          
641741             PERFORM 3500-BUILD-CONTNR-RULES-FILE                         
641742             PERFORM 3162-CLOSE-SHIPT-CHG-CURSOR                          
641743             SET PS-SHIPT-CHG-FOUND-NO TO TRUE                            
641744         ELSE                                                             
641745             PERFORM 3162-CLOSE-SHIPT-CHG-CURSOR                          
641746             SET PS-SHIPT-CHG-FOUND-NO TO TRUE                            
641747         END-IF                                                           
641748     END-IF.                                                              
641749                                                                          
641750******************************************************************        
641751* OPEN THE SHIPMENT (CONTAINER) CHANGE CURSOR                    *        
641752******************************************************************        
641753 3161-OPEN-SHIPT-CHG-CURSOR.                                              
641754                                                                          
641755     DISPLAY '3161-OPEN-SHIPT-CHG-CURSOR'.                                
641756                                                                          
641757     EXEC SQL                                                             
641758          OPEN SHIPT_CHG_CUR                                              
641759     END-EXEC.                                                            
641760                                                                          
641761     EVALUATE TRUE                                                        
641762         WHEN SQLWARN0 NOT EQUAL SPACE                                    
641763         WHEN SQLCODE NOT EQUAL ZERO                                      
641764             DISPLAY '** ABEND **'                                        
641765             DISPLAY '** PROGRAM = TRKUT260 **'                           
641766             DISPLAY '** PARAGRAPH = 3161-OPEN-SHIPT-CHG-CURSOR*'         
641767             PERFORM 9100-SQL-ABEND                                       
641768     END-EVALUATE.                                                        
641769                                                                          
641770******************************************************************        
641771* CLOSE THE SHIPMENT (CONTAINER) CHANGE CURSOR                   *        
641772******************************************************************        
641773 3162-CLOSE-SHIPT-CHG-CURSOR.                                             
641774                                                                          
641775     EXEC SQL                                                             
641776         CLOSE SHIPT_CHG_CUR                                              
641777     END-EXEC.                                                            
641778                                                                          
641779     EVALUATE TRUE                                                        
641780         WHEN SQLWARN0 NOT EQUAL SPACE                                    
641781         WHEN SQLCODE NOT EQUAL ZERO                                      
641782             DISPLAY '** ABEND **'                                        
641783             DISPLAY '** PROGRAM = TRKUT260 **'                           
641784             DISPLAY '** PARAGRAPH = 3162-CLOSE-SHIPT-CHG-CURSOR*'        
641785             PERFORM 9100-SQL-ABEND                                       
641786     END-EVALUATE.                                                        
641787                                                                          
641788******************************************************************        
641789* FETCH THE SHIPMENT (CONTAINER) CHANGE CURSOR                   *        
641790******************************************************************        
641791 3163-FETCH-SHIPT-CHG-CURSOR.                                             
641792                                                                          
641793     EXEC SQL                                                             
641794          FETCH SHIPT_CHG_CUR                                             
641795          INTO                                                            
641796                :AUSHIP-PRO-NBR                                           
641797              , :AUSHIP-LAST-UPD-DTE                                      
641798              , :AUSHIP-LAST-UPD-TME                                      
641799     END-EXEC.                                                            
641800                                                                          
641801     EVALUATE TRUE                                                        
641802         WHEN SQLCODE = ZERO                                              
641803              SET PS-AUSHIP-ROW-FOUND TO TRUE                             
641804                                                                          
641805         WHEN SQLCODE = +100                                              
641806              SET PS-AUSHIP-ROW-FOUND-NO TO TRUE                          
641807              SET PS-EOC-SHIPT-CHG-CURSOR TO TRUE                         
641808                                                                          
641809         WHEN SQLWARN0 NOT EQUAL SPACE                                    
641810         WHEN SQLCODE NOT EQUAL ZERO                                      
641811             DISPLAY '** ABEND **'                                        
641812             DISPLAY '** PROGRAM = TRKUT260 **'                           
641813           DISPLAY '** PARAGRAPH = 3163-FETCH-SHIPT-CHG-CURSOR**'         
641814             PERFORM 9100-SQL-ABEND                                       
641815     END-EVALUATE.                                                        
641816                                                                          
641817 EJECT                                                                    
641818******************************************************************        
641819* COMPARE TAUSHIP FIELDS AGAINST TSHIPMT FIELDS                  *        
641820******************************************************************        
641821 3165-COMPARE-TAUSHIP-CHANGES.                                            
641822                                                                          
641823     IF (SHIPMT-PRO-NBR NOT EQUAL AUSHIP-PRO-NBR)                         
641824         SET PS-SHIPT-CHG-FOUND TO TRUE                                   
641825     END-IF.                                                              
641826                                                                          
641827******************************************************************        
641828* BUILD CONTAINER RULES FILE FOR DECONSOLIDATOR CONTROL          *        
641829* PROCESSING.                                                    *        
641830******************************************************************        
641831 3500-BUILD-CONTNR-RULES-FILE.                                            
641832                                                                          
641833     INITIALIZE TR265-CONTNR-RULES-REC.                                   
641834                                                                          
641835     PERFORM 3950-RETRIEVE-CURRENT-TMST.                                  
641836     MOVE PV-CURRENT-TMST TO TR265-CONTNR-CURRENT-TMST.                   
641837                                                                          
641838     MOVE PV-CONTNR-TRN-TYP       TO TR265-CONTNR-TRN-TYP.                
641839                                                                          
641840     MOVE PC-CON                  TO TR265-CONTNR-REC-SRC.                
641841     MOVE PV-SHIPT-ID             TO TR265-CONTNR-SHIPT-ID.               
641842     MOVE PV-CONTNR-ID            TO TR265-CONTNR-ID.                     
641843     MOVE PV-ETA-TMST-CUR         TO                                      
641844                                  TR265-CONTNR-POE-DELY-TMST-CUR.         
641845     MOVE PV-VEH-NM-CUR           TO TR265-CONTNR-VEH-NM-CUR.             
641846     MOVE PV-FOB-CDE-CUR          TO TR265-CONTNR-FOB-CDE-CUR.            
641848     MOVE PV-CONTNR-PO-UPD-IND    TO TR265-CONTNR-PO-UPD-IND.             
641849     MOVE PV-CONTNR-TRN-SRCE      TO TR265-CONTNR-TRN-SRCE.               
641850                                                                          
641851     PERFORM 3510-CONVERT-POE-CDE.                                        
641852     MOVE PV-POE-CDE-CUR          TO TR265-CONTNR-POE-CDE-CUR.            
641853                                                                          
641854     DISPLAY 'PV-CONTNR-TRN-TYP ' PV-CONTNR-TRN-TYP.                      
641855                                                                          
641856     IF PV-CONTNR-TRN-TYP = PC-C                                          
641857         MOVE PV-ETA-TMST-PREV    TO                                      
641858                                  TR265-CONTNR-POE-DELY-TMST-PRV          
641859         MOVE PV-VEH-NM-PREV      TO TR265-CONTNR-VEH-NM-PREV             
641861         MOVE PV-FOB-CDE-PREV     TO TR265-CONTNR-FOB-CDE-PREV            
641862         MOVE PV-POE-CDE-PREV     TO TR265-CONTNR-POE-CDE-PREV            
641863     END-IF.                                                              
641864                                                                          
641865     WRITE TR265-CONTNR-RULES-RECORD FROM                                 
641866           TR265-CONTNR-RULES-REC.                                        
641867                                                                          
641868     INITIALIZE PV-TR265-CONTNR-RULES-FIELDS.                             
641869                                                                          
641870******************************************************************        
641871* CONVERT THE SCAC CODE INTO THE POE CODE                        *        
641872******************************************************************        
641873 3510-CONVERT-POE-CDE.                                                    
641874                                                                          
641875     MOVE SPACES TO PV-POE-CDE-CUR.                                       
641876                                                                          
641877     IF PLNSHP-POE-CDE = SPACES                                           
641878         EVALUATE TRUE                                                    
641879             WHEN VHTRIP-OWNER-SCAC-ID = 'OCEE'                           
641880                 MOVE 'NY' TO PV-POE-CDE-CUR                              
641881             WHEN VHTRIP-OWNER-SCAC-ID = 'OCEW'                           
641882                 MOVE 'LA' TO PV-POE-CDE-CUR                              
641883             WHEN VHTRIP-OWNER-SCAC-ID = 'OCEN'                           
641884                 MOVE 'CH' TO PV-POE-CDE-CUR                              
641885             WHEN VHTRIP-OWNER-SCAC-ID = 'OCES'                           
641886                 MOVE 'MI' TO PV-POE-CDE-CUR                              
641887             WHEN VHTRIP-OWNER-SCAC-ID = 'OCNW'                           
641888                 MOVE 'SE' TO PV-POE-CDE-CUR                              
641881             WHEN VHTRIP-OWNER-SCAC-ID = 'OCEG'                           
641882                 MOVE 'SA' TO PV-POE-CDE-CUR                              
641889         END-EVALUATE                                                     
641890     ELSE                                                                 
641891         MOVE PLNSHP-POE-CDE TO PV-POE-CDE-CUR                            
641892     END-IF.                                                              
641893                                                                          
641894******************************************************************        
641895* SET THE CURRENT TIMESTAMP FOR DECONSOLIDATOR RULES PROCESSING  *        
641896******************************************************************        
641897 3950-RETRIEVE-CURRENT-TMST.                                              
641898                                                                          
641899          EXEC SQL                                                        
641900              SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                    
641901          END-EXEC                                                        
641902                                                                          
641903         EVALUATE TRUE                                                    
641904             WHEN SQLCODE = ZERO                                          
641905                 CONTINUE                                                 
641906                                                                          
641907             WHEN SQLWARN0 NOT EQUAL SPACE                                
641908             WHEN SQLCODE NOT EQUAL ZERO                                  
641909              DISPLAY '**************************************'            
641910              DISPLAY '** ABEND                            **'            
641911              DISPLAY '** PROGRAM = TRKUT260               **'            
641912              DISPLAY '** PARAGRAPH = 3950-RETRIEVE-CURRENT-TMST'         
641913              DISPLAY '** SET CURRENT TIMESTAMP            **'            
641914              DISPLAY '** CURRENT TMST = ' PV-CURRENT-TMST                
641915              DISPLAY '**************************************'            
641916              PERFORM 9100-SQL-ABEND                                      
641917         END-EVALUATE.                                                    
641918                                                                          
641919                                                                          
641920 4000-UPDATE-TIMCNTL.                                                     
641921                                                                          
641922         EXEC SQL                                                         
641923             UPDATE TIMCNTL                                               
641924                SET LAST_EXTR_PRC_TMST = :PV-START-TMST                   
641925              WHERE LAST_EXTR_PRC_TMST = :PV-LAST-RUN-TMST                
641926         END-EXEC                                                         
641927                                                                          
641928     EVALUATE TRUE                                                        
641929             WHEN SQLCODE = ZERO                                          
641930             WHEN SQLCODE = -904                                          
641931             WHEN SQLCODE = -913                                          
641932                  CONTINUE                                                
641933                                                                          
641934         WHEN SQLWARN0 NOT EQUAL SPACE                                    
641935         WHEN SQLCODE NOT EQUAL ZERO                                      
641936             DISPLAY '** ABEND **'                                        
641937             DISPLAY '** PROGRAM = TRKUT260 **'                           
641938             DISPLAY '** PARAGRAPH = 4000-UPDATE-TIMCNTL**'               
641939             PERFORM 9100-SQL-ABEND                                       
641940     END-EVALUATE.                                                        
641950                                                                          
646445******************************************************************        
646446* END OF JOB ROUTINE                                                      
646447******************************************************************        
646448 9000-EOJ-ROUTINE.                                                        
646480                                                                          
646481     CLOSE TR265-CONTNR-RULES-FILE.                                       
646482                                                                          
646485     PERFORM 4000-UPDATE-TIMCNTL.                                         
646486                                                                          
646489******************************************************************        
646490* 9100-SQL-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE              
646491* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                         
646492******************************************************************        
646493 9100-SQL-ABEND.                                                          
646494******************************************************************        
646495* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-            
646496* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE                 
646497* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE             
646498* FORMAT.                                                                 
646499******************************************************************        
646501     COPY DPPD004.                                                        
646502                                                                          
646503     MOVE +4013 TO ABEND-CODE.                                            
646504     CALL 'ILBOABN0' USING ABEND-CODE.                                    
646505                                                                          
