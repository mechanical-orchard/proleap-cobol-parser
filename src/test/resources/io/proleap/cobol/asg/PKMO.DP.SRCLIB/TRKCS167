000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    TRKCS167.                                         00040000
000500 AUTHOR.        ANN RAISLER.                                      00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  10/98.                                            00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    Y167 - DECONSOLIDAION/LINEHAUL LIST                        * 00110000
001200*                                                               * 00120000
001300*    THIS PROGRAM GENERATES A LIST OF ALL THE CONTAINERS AND    * 00130000
001400*    TRAILERS OF A REQUESTED PO.                                * 00140000
001500*    IT USES A LEFT OUTER JOIN CURSOR SO THAT SOME DATA WILL    * 00150000
001600*    ALWAYS COME BACK AND THE REST WILL NOT DISPLAY UNLESS THE  * 00160000
001700*    ROW IS THERE. THE LOGIC FOR SELECTING A ROW IS STILL IN    * 00170000
001800*    THIS PROGRAM ALTHOUGH THE MAP WILL NOT ALLOW SELECTION.    * 00180000
001900*    THIS IS FOR FUTURE USE. SOME OF THE LOGIC HAD TO BE        * 00190000
002000*    COMMENTED OUT, HOWEVER, IN ORDER TO WORK.                  * 00200000
002100*---------------------------------------------------------------* 00210000
002200*                                                                 00220000
002300*       * NOTE * TRRD018 IS THE COPY BOOK USED TO LOAD TIMCNTK IN 00230000
002400*                BATCH PROGRAM TRKUP255.                          00240000
002500*       __________________________________________________________00250000
002600*       CONTAINER DELIVERY FIELDS:                                00260000
002700*       __________________________________________________________00270000
002800*       |                    | TRRD018 |   TRKCS167       | SCREEN00280000
002900*       | TIMCNTK COLUMN NAME| REC-TYPE| VARIABLE NAME    | TITLE 00290000
003000*       |____________________|_________|__________________|_______00300000
003100*       |                    |         |                  |   DO  00310000
003200*       | DO_TO_DCONSLR_TMST |  DOP    |PV-DO-ISSUED-DATE | ISSUED00320000
003210*       |  (FROM TIMCSCN)    |         |                  |       00321000
003300*       |                    |         |                  |       00330000
003400*       |                    |         |                  |       00340000
003500*       | DO_RCVD_TMST       |  DPU    |PV-DO-RCVD-DATE   |   DO  00350000
003600*       |                    |         |                  |  RCVD 00360000
003700*       |                    |         |                  |       00370000
003800*       | BKR_FRGT_RLSE_TMST |  FRL    |PV-CONT-RLSD-DATE |  CONT 00380000
003900*       |                    |         |                  |  RLSED00390000
004000*       |                    |         |                  |       00400000
004100*       | CONTNR_PU_TMST     |  DLV    |PV-CONT-PCKUP-DATE|  CONT 00410000
004200*       |                    |         |                  |  PCKUP00420000
004201*       | DCONSLR_RET_TMST   |         |PV-CONT-RTN-DATE  |  CONT 00420100
004202*       |                    |         |                  |  RTN  00420200
004300*       |____________________|_________|__________________|_______00430000
004400*                                                                 00440000
004410***************************************************************** 00441022
004420* DATE  05/16/2011                                                00442022
004430*  CHANGE MADE: THE NEW SYSTEM OF RECORD FOR OUTER PACK QTY WILL  00443022
004440*  BE RMS AND PUBLISHED TO TPURITM.  CHANGED OUTR-PCK-CSR         00444022
004450*  TO SELECT  OUTR_PK_QTY FROM TPURITM AND REMOVED JOIN TO TUPC   00445022
004460*  AND TSKXREF.                                                   00446022
004470*  MADE BY: GERMAN BANDA                                          00447022
004480***************************************************************** 00448022
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697         00449124
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00449224
263697* MAKING THE CALL DYNAMIC VS STATIC.                              00449324
263697*---------------------------------------------------------------* 00449424
CICS  * CHANGED  1/12/2023    BY JIM HUNTER      WR: CHG0278495         00449525
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00449625
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00449725
CICS  *-----------------------------------------------------------------00449825
004500                                                                  00450000
004600                                                                  00460000
004700 ENVIRONMENT DIVISION.                                            00470000
004800                                                                  00480000
004900 DATA DIVISION.                                                   00490000
005000                                                                  00500000
005100 WORKING-STORAGE SECTION.                                         00510000
005200                                                                  00520000
005300 01  DK-DB2-KEYS.                                                 00530000
005400     15  DK-PO-NBR                      PIC S9(09)  COMP.         00540000
005500     15  DK-VSL-NAME                    PIC  X(20).               00550000
005600     15  DK-VOY-NO                      PIC  X(10).               00560000
005700                                                                  00570000
005800 01  PC-PROGRAM-CONSTANTS.                                        00580000
005900     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00590000
006000                                                    'TR167A  '.   00600000
006100     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00610000
006200                                                    'TRKM167 '.   00620000
006300     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00630000
006400                                                    'TRKCS167'.   00640000
006500     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00650000
006600     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00660000
006700     05  PC-PO-LINEHAUL-FORMAT          PIC  X(01)  VALUE '3'.    00670000
006800     05  PC-N                           PIC  X(01)  VALUE 'N'.    00680000
006900     05  PC-0001                        PIC  X(04)  VALUE '0001'. 00690000
007000     05  PC-MULTI                       PIC  X(05)  VALUE 'MULTI'.00700000
007100     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +08     00710000
007200                                                    COMP SYNC.    00720000
007300     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00730000
007400                                                    COMP SYNC.    00740000
007500     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00750000
007600                                                    +1000000      00760000
007700                                                    COMP-3.       00770000
007800     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00780000
007900                                                    COMP SYNC.    00790000
008000     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00800000
008100                                                    COMP-3.       00810000
008200     05  PC-INIT-DATE                   PIC  X(10)  VALUE         00820000
008300                                                    '0001-01-01'. 00830000
008400     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00840000
008500                                                                  00850000
008600     05  PC-9999                        PIC  X(04)  VALUE '9999'. 00860000
008700     05  PC-DEFAULT-TMST                PIC  X(26)  VALUE         00870000
008800                                    '0001-01-01-00.00.00.000000'. 00880000
008900     05  PC-DECON-HEAD                  PIC  X(53)  VALUE         00890000
009000         '  DO    DO   CONT  CONT  CONT SPLT TO    LNHL        '. 00900000
009100     05  PC-DECON-HEAD2                 PIC  X(53)  VALUE         00910000
009200         'ISSUED RCVD  RLSED PCKUP DEVAN DCONSL DC SCAC TRAILER'. 00920000
009300     05  PC-LINEHAUL-HEAD               PIC  X(53)  VALUE         00930000
009400         ' DECN  CONT      LNHL                                '. 00940000
009500     05  PC-LINEHAUL-HEAD2              PIC  X(53)  VALUE         00950000
009501         ' SCAC  RTN   DC  SCAC TRAILER    POE    ENTRY        '. 00950100
009502                                                                  00950200
009503     05  PC-TSYMSG-NUMBERS.                                       00950300
009504         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00950400
009505         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00950500
009506         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  00950600
009507         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00950700
009508         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00950800
009509         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00950900
009510         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00951000
009600         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00960000
009700         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00970000
009800         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00980000
009900         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00990000
010000         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01000000
010100         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01010000
010200         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01020000
010300                                                                  01030000
010400 01  PS-PROGRAM-SWITCHES.                                         01040000
010500     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01050000
010600         88  PS-NO-ERROR                            VALUE 'Y'.    01060000
010700         88  PS-ERROR                               VALUE 'N'.    01070000
010800     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01080000
010900         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01090000
011000         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01100000
011100     05  PS-DECONSOL-LINEHAUL-SW        PIC  X(01)  VALUE 'N'.    01110000
011200         88  PS-DECONSOL-LINEHAUL-YES               VALUE 'Y'.    01120000
011300         88  PS-DECONSOL-LINEHAUL-NO                VALUE 'N'.    01130000
011400                                                                  01140000
011500 01  PV-PROGRAM-VARIABLES.                                        01150000
011600     05  PV-DEPT-NBR                    PIC  X(04).               01160021
011700     05  PV-DEPT-NBR-N REDEFINES                                  01170021
011701         PV-DEPT-NBR                    PIC S9(04).               01170121
011702     05  PV-SUB                         PIC S9(04)  VALUE +0      01170200
011703                                                    COMP SYNC.    01170300
011800     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01180000
011900                                                    COMP SYNC.    01190000
012000     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01200000
012100                                                    COMP-3.       01210000
012200     05  PV-PO-COUNT                    PIC S9(09)  VALUE +0      01220000
012300                                                    COMP-3.       01230000
012400     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01240000
012500                                                    COMP-3.       01250000
012600     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01260000
012700                                                    COMP-3.       01270000
012800     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01280000
012900                                                    COMP-3.       01290000
013000     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01300000
013100                                                    COMP-3.       01310000
013200     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01320000
013300                                                    COMP-3.       01330000
013400     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01340000
013500                                                    COMP-3.       01350000
013600     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01360000
013700                                                    COMP SYNC.    01370000
013800     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01380000
013900                                                    COMP SYNC.    01390000
014000     05  PV-ITEM                        PIC S9(04)  VALUE +0      01400000
014100                                                    COMP SYNC.    01410000
014200     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01420000
014300                                                    COMP SYNC.    01430000
014400     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01440000
014500                                                    COMP SYNC.    01450000
014600     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01460000
014700                                                    COMP SYNC.    01470000
014800     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01480000
014900                                                    COMP SYNC.    01490000
015000     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01500000
015100                                                    COMP SYNC.    01510000
015200     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01520000
015300                                                    COMP SYNC.    01530000
015400     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01540000
015500                                                    COMP SYNC.    01550000
015600     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01560000
015700                                                    COMP SYNC.    01570000
015800     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01580000
015900                                                    COMP SYNC.    01590000
016000     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01600000
016100                                                    COMP SYNC.    01610000
016200     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01620000
016300                                                    COMP SYNC.    01630000
016400     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01640000
016500                                                    COMP SYNC.    01650000
016600     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01660000
016700                                                    COMP SYNC.    01670000
016800     05  PV-CONTNR-NBR                  PIC  X(12)  VALUE SPACE.  01680000
016900     05  PV-CONTNR-SEQ-NBR              PIC S9(04)  COMP.         01690000
017000     05  PV-SHIPT-ID                    PIC S9(09)  COMP.         01700000
017100     05  PV-PO-NBR                      PIC S9(09)  COMP.         01710000
017200     05  PV-OPER-UNT-ID                 PIC S9(04)  COMP.         01720000
017300     05  PV-SCAC                        PIC X(04)   VALUE SPACES. 01730000
017310     05  PV-DECN-SCAC                   PIC X(04)   VALUE SPACES. 01731021
017400     05  PV-TRIP-ID-N                   PIC S9(09)   COMP.        01740000
017500     05  PV-VEH-NBR                     PIC X(10)   VALUE SPACES. 01750000
017600     05  PV-FDR-FOB-CDE                 PIC X(05)   VALUE SPACES. 01760000
017700     05  PV-MOM-FOB-CDE                 PIC X(05)   VALUE SPACES. 01770000
017800     05  PV-MOM-TRIP-TYP-CDE            PIC X       VALUE SPACE.  01780000
017900     05  PV-FDR-TRIP-TYP-CDE            PIC X       VALUE SPACE.  01790000
018000     05  PV-MOM-DEST-POE-CDE            PIC X(04)   VALUE SPACES. 01800000
018100     05  PV-ACTL-POE-DELY-TMST          PIC X(26)   VALUE SPACES. 01810000
018200     05  PV-MOM-POE-DELY-TMST           PIC X(26)   VALUE SPACES. 01820000
018300     05  PV-DO-TO-DCONSLR-TMST          PIC X(26)   VALUE SPACES. 01830000
018400     05  PV-DO-RCVD-TMST                PIC X(26)   VALUE SPACES. 01840000
018500     05  PV-BKR-FRGT-RLSE-TMST          PIC X(26)   VALUE SPACES. 01850000
018600     05  PV-CONTNR-PU-TMST              PIC X(26)   VALUE SPACES. 01860000
018610     05  PV-DCONSLR-RTN-TMST            PIC X(26)   VALUE SPACES. 01861000
018620     05  PV-DVN-TMST                    PIC X(26)   VALUE SPACES. 01862021
018630     05  PV-DO-RCVD-CDE                 PIC X(01)   VALUE SPACES. 01863021
018640     05  PV-BKR-FRGT-RLSE-CDE           PIC X(01)   VALUE SPACES. 01864021
018650     05  PV-CONTNR-PU-CDE               PIC X(01)   VALUE SPACES. 01865021
018660     05  PV-DVN-CDE                     PIC X(01)   VALUE SPACES. 01866021
018661     05  PV-CSTM-ENTR-ID                PIC X(12)   VALUE SPACES. 01866121
018670     05  PV-DCONSLR-RET-CDE             PIC X(01)   VALUE SPACES. 01867021
018700     05  PV-DCONSLR-ACTL-DTE            PIC X(10)   VALUE SPACES. 01870000
018800     05  PV-DCONSLR-DISPLAY-DTE         PIC X(08)   VALUE SPACES. 01880000
018900     05  PV-DCONSLR-SLASH               PIC X       VALUE '/'.    01890000
019000     05  PV-ITEM-CART-CNT               PIC S9(04)  VALUE +0      01900000
019100                                                    COMP.         01910000
019200     05  PV-DEVAN-DATE                  PIC X(5).                 01920000
019300     05  FILLER REDEFINES PV-DEVAN-DATE.                          01930000
019400         10  PV-DEVAN-MONTH             PIC XX.                   01940000
019500         10  PV-DEVAN-SLASH             PIC X.                    01950000
019600         10  PV-DEVAN-DAY               PIC XX.                   01960000
019700                                                                  01970000
019701     05  PV-SPLDC-DATE                  PIC X(5).                 01970121
019702     05  FILLER REDEFINES PV-SPLDC-DATE.                          01970200
019703         10  PV-SPLDC-MONTH             PIC XX.                   01970300
019704         10  PV-SPLDC-SLASH             PIC X.                    01970400
019705         10  PV-SPLDC-DAY               PIC XX.                   01970500
019706                                                                  01970600
019800     05  PV-DO-RCVD-DATE                PIC X(5).                 01980000
019900     05  FILLER REDEFINES PV-DO-RCVD-DATE.                        01990000
020000         10  PV-DO-RCVD-MONTH           PIC XX.                   02000000
020100         10  PV-DO-RCVD-SLASH           PIC X.                    02010000
020200         10  PV-DO-RCVD-DAY             PIC XX.                   02020000
020300                                                                  02030000
020400     05  PV-DO-ISSUED-DATE              PIC X(5).                 02040000
020500     05  FILLER REDEFINES PV-DO-ISSUED-DATE.                      02050000
020600         10  PV-DO-ISSUED-MONTH         PIC XX.                   02060000
020700         10  PV-DO-ISSUED-SLASH         PIC X.                    02070000
020800         10  PV-DO-ISSUED-DAY           PIC XX.                   02080000
020900                                                                  02090000
021000     05  PV-CONT-RLSD-DATE              PIC X(5).                 02100000
021100     05  FILLER REDEFINES PV-CONT-RLSD-DATE.                      02110000
021200         10  PV-CONT-RLSD-MONTH         PIC XX.                   02120000
021300         10  PV-CONT-RLSD-SLASH         PIC X.                    02130000
021400         10  PV-CONT-RLSD-DAY           PIC XX.                   02140000
021500                                                                  02150000
021600     05  PV-CONT-PCKUP-DATE             PIC X(5).                 02160000
021700     05  FILLER REDEFINES PV-CONT-PCKUP-DATE.                     02170000
021800         10  PV-CONT-PCKUP-MONTH        PIC XX.                   02180000
021900         10  PV-CONT-PCKUP-SLASH        PIC X.                    02190000
022000         10  PV-CONT-PCKUP-DAY          PIC XX.                   02200000
022100                                                                  02210000
022101     05  PV-CONT-RTN-DATE               PIC X(5).                 02210100
022102     05  FILLER REDEFINES PV-CONT-RTN-DATE.                       02210200
022103         10  PV-CONT-RTN-MONTH          PIC XX.                   02210300
022104         10  PV-CONT-RTN-SLASH          PIC X.                    02210400
022105         10  PV-CONT-RTN-DAY            PIC XX.                   02210500
022106                                                                  02210600
022200     05  PV-PO-CART-CNT                 PIC S9(05)  VALUE +0      02220023
022300                                                    COMP.         02230000
022400     05  PV-AD-DTE-IND                  PIC S9(04)  VALUE +0      02240000
022500                                                    COMP.         02250000
022600     05  PV-SHPMT-TYPE.                                           02260000
022700         10 PV-SHPMT-FROM-CDE           PIC  X(03).               02270000
022800         10 FILLER                      PIC  X(01)  VALUE '/'.    02280000
022900         10 PV-SHPMT-TO-CDE             PIC  X(03).               02290000
023000                                                                  02300000
023100     05  PV-DATE-BREAK.                                           02310000
023200         10 FILLER                      PIC  X(02).               02320000
023300         10 PV-DB-YY                    PIC  X(02).               02330000
023400         10 FILLER                      PIC  X(01).               02340000
023500         10 PV-DB-MM                    PIC  X(02).               02350000
023600         10 FILLER                      PIC  X(01).               02360000
023700         10 PV-DB-DD                    PIC  X(02).               02370000
023800                                                                  02380000
023900     05 PV-DATE-DISPLAY.                                          02390000
024000         10 PV-DD-MM                    PIC  X(02).               02400000
024100         10 FILLER                      PIC  X(01)  VALUE '/'.    02410000
024200         10 PV-DD-DD                    PIC  X(02).               02420000
024300         10 FILLER                      PIC  X(01)  VALUE '/'.    02430000
024400         10 PV-DD-YY                    PIC  X(02).               02440000
024401         10 PV-ORD-SPL-SNT-DT           PIC X(10).                02440121
024402         10 PV-SHPT-SPL-SNT-DT          PIC X(10).                02440221
024403         10 PV-SHPT-SPL-AUD-DT          PIC X(10).                02440321
024404     05  PV-NULLS.                                                02440421
024405         10 PV-IMCNRL-ACTL-DT-NULL        PIC S9(04) COMP.        02440521
024406         10 PV-ORD-SPL-SNT-DT-NULL        PIC S9(04) COMP.        02440621
024407         10 PV-SHPT-SPL-SNT-DT-NULL       PIC S9(04) COMP.        02440721
024408         10 PV-SHPT-SPL-AUD-DT-NULL       PIC S9(04) COMP.        02440821
024600*----------------------------------------------------------------*02460000
024700*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.    *02470000
024800*   THIS MUST BE THE EXACT SAME FORMAT AS THE BLOCK IN THE       *02480000
024900*   APPLICATION-SPECIFIC COMMAREA.                               *02490000
025000*----------------------------------------------------------------*02500000
025100 01  LQW-LIST-QUEUE-WORK-AREA.                                    02510000
025200     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02520000
025300     05  LQW-ITEM-ENTRIES               OCCURS 08   TIMES         02530000
025400                                        INDEXED BY  LQW-IDX.      02540000
025500         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02550000
025600         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02560000
025700         10  LQW-SELECTED-SW            PIC  X(01).               02570000
025800             88  LQW-SELECT                         VALUE 'S'.    02580000
025900             88  LQW-DESELECT                       VALUE ' '.    02590000
026000         10  LQW-ACTION                 PIC  X(03).               02600000
026100         10  LQW-CONTNR-NBR             PIC  X(12).               02610000
026200         10  LQW-TRAILER                PIC  X(10).               02620000
026300*        10  LQW-FOB                    PIC  X(03).               02630000
026400         10  LQW-POE                    PIC  X(03).               02640000
026500         10  LQW-ETA                    PIC  X(05).               02650000
026600         10  LQW-DO-ISSUED              PIC  X(05).               02660000
026700         10  LQW-DO-RCVD                PIC  X(05).               02670000
026800         10  LQW-CONT-RLSD              PIC  X(05).               02680000
026900         10  LQW-CONT-PCKUP             PIC  X(05).               02690000
027000         10  LQW-DEVAN                  PIC  X(05).               02700000
027010         10  LQW-SPLDC                  PIC  X(05).               02701021
027100         10  LQW-DC                     PIC  9(03).               02710000
027200         10  LQW-SCAC                   PIC  X(04).               02720000
027300         10  LQW-TRIP-ID           PIC S9(09) COMP.               02730000
027301         10  LQW-CONT-RTN               PIC  X(05).               02730100
027302         10  LQW-CSTM-ENTRY             PIC  X(12).               02730200
027303         10  LQW-CONTNR-SEQ-NBR    PIC S9(04) COMP.               02730300
027304         10  LQW-DECN-SCAC              PIC  X(04).               02730421
027400                                                                  02740000
027500 EJECT                                                            02750000
027600*---------------------------------------------------------------* 02760000
027700*  RECORD LAYOUT FOR THE PO SELECTION TEMP STORAGE QUEUE.       * 02770000
027800*---------------------------------------------------------------* 02780000
027900                                                                  02790000
028000     COPY TRWS108.                                                02800000
028010     COPY TRWS101.                                                02801000
028100                                                                  02810000
028200 EJECT                                                            02820000
028300*---------------------------------------------------------------* 02830000
028400*    MAP LAYOUT                                                 * 02840000
028500*---------------------------------------------------------------* 02850000
028600                                                                  02860000
028700     COPY TRKM167.                                                02870000
028800                                                                  02880000
028900 01  MR-OCCURS-LAYOUT                   REDEFINES  TR167AO.       02890000
029000     05  FILLER                         PIC X(393).               02900000
029100                                                                  02910000
029200     05  MR-SCROLL-AREA                 OCCURS 08 TIMES.          02920000
029300         10  MR-SELECTL                 PIC S9(04) COMP.          02930000
029400         10  MR-SELECTA                 PIC  X(01).               02940000
029500         10  MR-SELECTC                 PIC  X(01).               02950000
029600         10  MR-SELECTH                 PIC  X(01).               02960000
029700         10  MR-SELECTI                 PIC  X(01).               02970000
029800                                                                  02980000
029900         10  MR-ACTIONL                 PIC S9(04) COMP.          02990000
030000         10  MR-ACTIONA                 PIC  X(01).               03000000
030100         10  MR-ACTIONC                 PIC  X(01).               03010000
030200         10  MR-ACTIONH                 PIC  X(01).               03020000
030300         10  MR-ACTION                  PIC  X(03).               03030000
030400                                                                  03040000
030500         10  MR-CONTNR-NBRL             PIC S9(04) COMP.          03050000
030600         10  MR-CONTNR-NBRA             PIC  X(01).               03060000
030700         10  MR-CONTNR-NBRC             PIC  X(01).               03070000
030800         10  MR-CONTNR-NBRH             PIC  X(01).               03080000
030900         10  MR-CONTNR-NBR              PIC  X(12).               03090000
031000                                                                  03100000
031100         10  MR-ETAL                    PIC S9(04) COMP.          03110000
031200         10  MR-ETAA                    PIC  X(01).               03120000
031300         10  MR-ETAC                    PIC  X(01).               03130000
031400         10  MR-ETAH                    PIC  X(01).               03140000
031500         10  MR-ETA                     PIC  X(05).               03150000
031600                                                                  03160000
031700         10  FILLER                     PIC  X(05).               03170000
031800         10  MR-LINE-AREA               PIC  X(53).               03180000
031900                                                                  03190000
032000                                                                  03200000
032100 01  MR-DECON-LINE.                                               03210000
032200     05  MR-DECON-DO-ISSUED             PIC X(05).                03220000
032300     05  FILLER                         PIC X(01)   VALUE SPACE.  03230000
032400     05  MR-DECON-DO-RCVD               PIC X(05).                03240000
032500     05  FILLER                         PIC X(01)   VALUE SPACE.  03250000
032600     05  MR-DECON-CONT-RLSD             PIC X(05).                03260000
032700     05  FILLER                         PIC X(01)   VALUE SPACE.  03270000
032800     05  MR-DECON-CONT-PCKUP            PIC X(05).                03280000
032900     05  FILLER                         PIC X(01)   VALUE SPACE.  03290000
033000     05  MR-DECON-CONT-DEVAN            PIC X(05).                03300000
033100     05  FILLER                         PIC X(01)   VALUE SPACE.  03310000
033101     05  MR-DECON-SPLT-TO-DCONSL        PIC X(05).                03310121
033102     05  FILLER                         PIC X(01)   VALUE SPACE.  03310200
033400     05  MR-DECON-DC                    PIC X(03).                03340000
033500     05  FILLER                         PIC X(01)   VALUE SPACE.  03350000
033600     05  MR-DECON-LNHL-SCAC             PIC X(04).                03360000
033700     05  FILLER                         PIC X(01)   VALUE SPACE.  03370000
033800     05  MR-DECON-TRAILER               PIC X(08).                03380000
033900                                                                  03390000
034000 01  MR-LINEHAUL-LINE.                                            03400000
034100     05  MR-LINEHAUL-DECN-SCAC          PIC X(04).                03410000
034200     05  FILLER                         PIC X(02)   VALUE SPACE.  03420000
034201     05  MR-LINEHAUL-CONT-RTN           PIC X(05).                03420121
034202     05  FILLER                         PIC X(01)   VALUE SPACE.  03420200
034300     05  MR-LINEHAUL-DC                 PIC X(03).                03430000
034400     05  FILLER                         PIC X(01)   VALUE SPACE.  03440000
034500     05  MR-LINEHAUL-LNHL-SCAC          PIC X(04).                03450000
034600     05  FILLER                         PIC X(01)   VALUE SPACE.  03460000
034700     05  MR-LINEHAUL-TRAILER            PIC X(10).                03470000
034800     05  FILLER                         PIC X(01)   VALUE SPACE.  03480000
034900     05  MR-LINEHAUL-POE                PIC X(03).                03490000
035000     05  FILLER                         PIC X(01)   VALUE SPACE.  03500000
035100     05  MR-LINEHAUL-CSTM-ENTRY         PIC X(12).                03510000
035200     05  FILLER                         PIC X(05)   VALUE SPACE.  03520000
035300                                                                  03530000
038000 EJECT                                                            03800000
038100*---------------------------------------------------------------* 03810000
038200*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03820000
038300*---------------------------------------------------------------* 03830000
038400                                                                  03840000
038500     COPY DPWS015.                                                03850000
038600                                                                  03860000
038700 EJECT                                                            03870000
038800*---------------------------------------------------------------* 03880000
038900*    FUNCTION KEYS COPYBOOK.                                    * 03890000
039000*---------------------------------------------------------------* 03900000
039100                                                                  03910000
039200     COPY DPWS016.                                                03920000
039300                                                                  03930000
039400 EJECT                                                            03940000
039500*---------------------------------------------------------------* 03950000
039600*    NUMERIC EDIT LAYOUT.                                       * 03960000
039700*---------------------------------------------------------------* 03970000
039800                                                                  03980000
039900     COPY DPWS010I.                                               03990000
040000                                                                  04000000
040100 EJECT                                                            04010000
040200*---------------------------------------------------------------* 04020000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 04030025
040400*---------------------------------------------------------------* 04040000
040500                                                                  04050000
040600     COPY DPWS030.                                                04060000
CICS       COPY DPWS930.                                                04070025
040800 EJECT                                                            04080000
040900*---------------------------------------------------------------* 04090000
041000*    STANDARD COMMAREA.                                         * 04100000
041100*---------------------------------------------------------------* 04110000
041200                                                                  04120000
041300     COPY DPWS020.                                                04130000
041400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04140000
041500                                                                  04150000
041600*---------------------------------------------------------------* 04160000
041700* INTER-APPLICATION COMMAREA.                                   * 04170000
041800*   TRWS105 - ARE THE INPUT LAYOUTS FOR THIS PROGRAM            * 04180000
041900*   TRWS109   FROM PO CRIT SPEC, SUMMARY OR SAILING LIST PGMS,  * 04190000
042000*   TRWS113   OR CONTAINER SUMMARY PGM.                         * 04200000
042010*   TRWS114                                                     * 04201000
042100*   TRWS102 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 04210000
042200*             THIS PROGRAM TO CONTAINER SUMMARY AND MANIFEST    * 04220000
042300*             PROGRAMS                                          * 04230000
042400*---------------------------------------------------------------* 04240000
042500                                                                  04250000
042600         10  INTER-APPL-COMM-AREA       PIC X(200).               04260000
042700     COPY TRWS102.                                                04270000
042800     COPY TRWS105.                                                04280000
042900     COPY TRWS109.                                                04290000
043000     COPY TRWS113.                                                04300000
043010     COPY TRWS114.                                                04301000
043100                                                                  04310000
043200*---------------------------------------------------------------* 04320000
043300*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 04330000
043400*---------------------------------------------------------------* 04340000
043500         10  ASC-SPECIFIC-COMMAREA.                               04350000
043600             15  ASC-LIST-KEYS.                                   04360000
043700                 20  ASC-KEY-PO-NBR                  PIC S9(09)   04370000
043800                                                          COMP.   04380000
043900                 20  ASC-KEY-VSL-NAME                PIC  X(20).  04390000
044000                 20  ASC-KEY-VOY-NO                  PIC  X(10).  04400000
044100                 20  ASC-OUTR-PACK-X                 PIC  X(05).  04410000
044200                 20  ASC-OUTR-PACK                   PIC  9(5).   04420000
044300                 20  ASC-OUTR-PACK-N REDEFINES ASC-OUTR-PACK      04430000
044400                                                     PIC ZZZZZ.   04440000
044500             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                04450000
044600                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  04460000
044700                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   04470000
044800                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   04480000
044900                                                                  04490000
045000                 20  ASC-ITEM-ARRAY.                              04500000
045100                     25  ASC-ITEM-ENTRIES OCCURS 08 TIMES.        04510000
045200                         30  ASC-LIST-ITEM-NUMBER                 04520000
045300                                                     PIC S9(09)   04530000
045400                                                     COMP-3.      04540000
045500                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  04550000
045600                             88  ASC-VALID-SELECT    VALUE ' '    04560000
045700                                                           'S'    04570000
045800                                                           'B'    04580000
045900                                                           'E'.   04590000
046000                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   04600000
046100                             88  ASC-TEMP-SELECT     VALUE 'S'.   04610000
046200                             88  ASC-TEMP-BEGIN      VALUE 'B'.   04620000
046300                             88  ASC-TEMP-END        VALUE 'E'.   04630000
046400                         30  ASC-SELECTED-SW         PIC  X(01).  04640000
046500                             88  ASC-NO-SELECT       VALUE ' '.   04650000
046600                             88  ASC-SELECT          VALUE 'S'.   04660000
046700                             88  ASC-BEGIN           VALUE 'B'.   04670000
046800                             88  ASC-END             VALUE 'E'.   04680000
046900                         30  ASC-ACTION              PIC  X(03).  04690000
047000                         30  ASC-CONTNR-NBR          PIC  X(12).  04700000
047100                         30  ASC-TRAILER             PIC  X(10).  04710000
047200*                        30  ASC-FOB                 PIC  X(03).  04720000
047300                         30  ASC-POE                 PIC  X(03).  04730000
047400                         30  ASC-ETA                 PIC  X(05).  04740000
047500                         30  ASC-ISUD                PIC  X(05).  04750000
047600                         30  ASC-RCVD                PIC  X(05).  04760000
047700                         30  ASC-RLSD                PIC  X(05).  04770000
047800                         30  ASC-PCKUP               PIC  X(05).  04780000
047900                         30  ASC-DEVAN               PIC  X(05).  04790000
048000                         30  ASC-SPLDC               PIC  X(05).  04800000
048010                         30  ASC-DC                  PIC  9(03).  04801021
048100                         30  ASC-SCAC                PIC  X(04).  04810000
048200                         30  ASC-TRIP-ID        PIC S9(09) COMP.  04820000
048300                         30  ASC-RTN                 PIC  X(05).  04830000
048400                         30  ASC-CSTM-ENTRY          PIC  X(12).  04840000
048401                         30  ASC-CONTNR-SEQ-NBR PIC S9(04) COMP.  04840100
048402                         30  ASC-DECN-SCAC           PIC  X(04).  04840221
048403                                                                  04840300
048404             15  ASC-BLK-SUB                         PIC S9(04)   04840400
048500                                                          COMP    04850000
048600                                                          SYNC.   04860000
048700             15  ASC-ITEM-SUB                        PIC S9(04)   04870000
048800                                                          COMP    04880000
048900                                                          SYNC.   04890000
049000             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   04900000
049100                                                          COMP-3. 04910000
049200             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   04920000
049300                                                          COMP-3. 04930000
049400             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   04940000
049500                                                          COMP-3. 04950000
049600             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   04960000
049700                                                          COMP-3. 04970000
049800             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   04980000
049900                                                          COMP-3. 04990000
050000             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   05000000
050100                                                          COMP    05010000
050200                                                          SYNC.   05020000
050300             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   05030000
050400                                                          COMP-3. 05040000
050500             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   05050000
050600                                                          COMP-3. 05060000
050700             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  05070000
050800                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   05080000
050900                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   05090000
051000             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  05100000
051100                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   05110000
051200                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   05120000
051300                 88  ASC-UPDATE-TSQ-1                VALUE 'Y'.   05130000
051301                 88  ASC-NO-TSQ-UPDATE-1             VALUE ' '.   05130100
051302             15  ASC-LIST-QUEUE-NAME.                             05130200
051400                 20  ASC-LIST-TERM-ID                PIC  X(04).  05140000
051500                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   05150000
051600                                                          COMP-3. 05160000
051700                 20  ASC-LIST-SEQ                    PIC  9(01).  05170000
051800             15  ASC-SEL-QUEUE-NAME.                              05180000
051900                 20  ASC-SEL-TERM-ID                 PIC  X(04).  05190000
052000                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   05200000
052100                                                          COMP-3. 05210000
052200                 20  ASC-SEL-SEQ                     PIC  9(01).  05220000
052300             15  ASC-CURSOR-SW                       PIC  X(01).  05230000
052400                 88  ASC-CONTNR-CURSOR               VALUE 'C'.   05240000
052500                 88  ASC-VSL-CONTNR-CURSOR           VALUE 'V'.   05250000
052600             15  ASC-START-ITEM-REQUEST.                          05260000
052700                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  05270000
052800             15  ASC-DISPLAY-SW                      PIC X(01).   05280000
052900                 88  ASC-DISPLAY-DECON               VALUE 'D'.   05290000
052901                 88  ASC-DISPLAY-LINEHAUL            VALUE 'L'.   05290100
052902             15  ASC-EARLIEST-SPLIT-DTE              PIC X(10).   05290221
052903                                                                  05290300
052904 EJECT                                                            05290400
053000*---------------------------------------------------------------* 05300000
053100*    ABEND PROCESSING COPYBOOK.                                 * 05310000
053200*---------------------------------------------------------------* 05320000
053300                                                                  05330000
053400     COPY DPWS013.                                                05340000
053500                                                                  05350000
053600 EJECT                                                            05360000
053700*---------------------------------------------------------------* 05370000
053800*    DB2 AREA FOR TSHIPMT                                       * 05380000
053900*---------------------------------------------------------------* 05390000
054000     EXEC SQL                                                     05400000
054100          INCLUDE TSHIPMT                                         05410000
054200     END-EXEC.                                                    05420000
054300*---------------------------------------------------------------* 05430000
054400*    DB2 AREA FOR TSHIPST                                       * 05440000
054500*---------------------------------------------------------------* 05450000
054600     EXEC SQL                                                     05460000
054700          INCLUDE TSHIPST                                         05470000
054800     END-EXEC.                                                    05480000
054900*---------------------------------------------------------------* 05490000
055000*    DB2 AREA FOR TSHPTPO                                       * 05500000
055100*---------------------------------------------------------------* 05510000
055200     EXEC SQL                                                     05520000
055300          INCLUDE TSHPTPO                                         05530000
055400     END-EXEC.                                                    05540000
055500*---------------------------------------------------------------* 05550000
055600*    DB2 AREA FOR TPKSLIP                                       * 05560000
055700*---------------------------------------------------------------* 05570000
055800     EXEC SQL                                                     05580000
055900          INCLUDE TPKSLIP                                         05590000
056000     END-EXEC.                                                    05600000
056100*---------------------------------------------------------------* 05610000
056200*    DB2 AREA FOR TVEHICL                                       * 05620000
056300*---------------------------------------------------------------* 05630000
056400     EXEC SQL                                                     05640000
056500          INCLUDE TVEHICL                                         05650000
056600     END-EXEC.                                                    05660000
056700*---------------------------------------------------------------* 05670000
056800*    DB2 AREA FOR TVHTRIP                                       * 05680000
056900*---------------------------------------------------------------* 05690000
057000     EXEC SQL                                                     05700000
057100          INCLUDE TVHTRIP                                         05710000
057200     END-EXEC.                                                    05720000
057300*---------------------------------------------------------------* 05730000
057400*    DB2 AREA FOR TIMCNPO                                       * 05740000
057500*---------------------------------------------------------------* 05750000
057600     EXEC SQL                                                     05760000
057700          INCLUDE TIMCNPO                                         05770000
057800     END-EXEC.                                                    05780000
057801*---------------------------------------------------------------* 05780121
057802*    DB2 AREA FOR TIMCNRL                                       * 05780200
057803*---------------------------------------------------------------* 05780300
057804     EXEC SQL                                                     05780400
057805          INCLUDE TIMCNRL                                         05780500
057806     END-EXEC.                                                    05780600
057807*---------------------------------------------------------------* 05780700
057808*    DB2 AREA FOR TAUCNRL                                       * 05780800
057809*---------------------------------------------------------------* 05780900
057810     EXEC SQL                                                     05781000
057811          INCLUDE TAUCNRL                                         05781100
057812     END-EXEC.                                                    05781200
057900*---------------------------------------------------------------* 05790000
058000*    DB2 AREA FOR TIMCNTK                                       * 05800000
058100*---------------------------------------------------------------* 05810000
058200     EXEC SQL                                                     05820000
058300          INCLUDE TIMCNTK                                         05830000
058400     END-EXEC.                                                    05840000
058401*---------------------------------------------------------------* 05840100
058402*    DB2 AREA FOR TIMCSCN                                       * 05840200
058403*---------------------------------------------------------------* 05840300
058404     EXEC SQL                                                     05840400
058405          INCLUDE TIMCSCN                                         05840500
058406     END-EXEC.                                                    05840600
058407*---------------------------------------------------------------* 05840700
058408*    DB2 AREA FOR TIMCSPO                                       * 05840800
058409*---------------------------------------------------------------* 05840900
058410     EXEC SQL                                                     05841000
058411          INCLUDE TIMCSPO                                         05841100
058412     END-EXEC.                                                    05841200
058500*---------------------------------------------------------------* 05850000
058600*    DB2 AREA FOR TPURCHS                                       * 05860000
058700*---------------------------------------------------------------* 05870000
058800     EXEC SQL                                                     05880000
058900          INCLUDE TPURCHS                                         05890000
059000     END-EXEC.                                                    05900000
059100*---------------------------------------------------------------* 05910000
059200*    DB2 AREA FOR TPURITM                                       * 05920000
059300*---------------------------------------------------------------* 05930000
059400     EXEC SQL                                                     05940000
059500          INCLUDE TPURITM                                         05950000
059600     END-EXEC.                                                    05960000
059700*---------------------------------------------------------------* 05970000
059800*    DB2 AREA FOR TPLNSHP                                       * 05980000
059900*---------------------------------------------------------------* 05990000
060000     EXEC SQL                                                     06000000
060100          INCLUDE TPLNSHP                                         06010000
060200     END-EXEC.                                                    06020000
060300*---------------------------------------------------------------* 06030000
060400*    DB2 AREA FOR TENTNME                                       * 06040000
060500*---------------------------------------------------------------* 06050000
060600     EXEC SQL                                                     06060000
060700          INCLUDE TENTNME                                         06070000
060800     END-EXEC.                                                    06080000
060900*---------------------------------------------------------------* 06090000
061000*    DB2 AREA FOR TIMPORL                                       * 06100000
061100*---------------------------------------------------------------* 06110000
061200     EXEC SQL                                                     06120000
061300          INCLUDE TIMPORL                                         06130000
061400     END-EXEC.                                                    06140000
061500*----------------------------------------------------------------*06150021
061600*    DB2 AREA FOR THE TSKXREF TABLE                              *06160021
061700*----------------------------------------------------------------*06170021
061800     EXEC SQL                                                     06180021
061900          INCLUDE TSKXREF                                         06190021
062000     END-EXEC.                                                    06200021
062100*----------------------------------------------------------------*06210021
062200*    DB2 AREA FOR THE TUPC TABLE                                 *06220021
062300*----------------------------------------------------------------*06230021
062400     EXEC SQL                                                     06240021
062500          INCLUDE TUPC                                            06250021
062501     END-EXEC.                                                    06250121
062502*---------------------------------------------------------------* 06250200
062503*    DB2 AREA FOR TIMFOB                                        * 06250300
062504*---------------------------------------------------------------* 06250400
062505     EXEC SQL                                                     06250500
062506          INCLUDE TIMFOB                                          06250600
062600     END-EXEC.                                                    06260000
062700*---------------------------------------------------------------* 06270000
062800*    DB2 AREA FOR TIMPOE                                        * 06280000
062900*---------------------------------------------------------------* 06290000
063000     EXEC SQL                                                     06300000
063100          INCLUDE TIMPOE                                          06310000
063200     END-EXEC.                                                    06320000
063300*---------------------------------------------------------------* 06330021
063400*    DB2 AREA FOR XLT_SKU                                       * 06340021
063500*---------------------------------------------------------------* 06350021
063600     EXEC SQL                                                     06360021
063700          INCLUDE XLT00003                                        06370021
063800     END-EXEC.                                                    06380021
063900*---------------------------------------------------------------* 06390021
064000*    DB2 AREA FOR XLT_VND_STYL                                  * 06400021
064100*---------------------------------------------------------------* 06410021
064200     EXEC SQL                                                     06420021
064300          INCLUDE XLT00004                                        06430021
064301     END-EXEC.                                                    06430121
064302*---------------------------------------------------------------* 06430200
064303*    DB2 AREA FOR COMMUNICATIONS                                * 06430300
064304*---------------------------------------------------------------* 06430400
064305     EXEC SQL                                                     06430500
064306          INCLUDE SQLCA                                           06430600
064307     END-EXEC.                                                    06430700
064308*---------------------------------------------------------------* 06430800
064309*    CURSOR FOR DECONSOLIDATION LIST FOR A REQUESTED PO         * 06430900
064310*    FIRST THIS 'DBA APPROVED' CURSOR CREATES A TEMPORARY       * 06431000
064311*    TABLE OF ALL THE CONTAINERS FOR A PARTICULAR PO.           * 06431100
064312*    IT THEN 'LEFT JOINS' THAT TABLE WITH THE RESULTS OF THE    * 06431200
064400*    WHERE CLAUSE FOR THE REST OF THE TABLES. COALESCE WILL     * 06440000
064500*    PLACE DEFAULT VALUES WHERE NONE FOUND.   THE RESULTS OF    * 06450000
064600*    THIS QUERY IS THAT IT WILL BOTH BE ABLE TO LIST ANY        * 06460000
064700*    CONTAINER FOR WHICH THERE WAS NO INFORMATION ON ONE OF THE * 06470000
064800*    TABLES AND WILL ALSO HANDLE MULTIPLE TRAILERS. (IF YOU     * 06480000
064900*    BREAK THIS CURSOR APART INTO TWO CURSORS AND FETCH ALL OF  * 06490000
065000*    CONTAINERS FIRST YOU WILL THEN NEED TO DEAL WITH THE       * 06500000
065100*    PROBLEM OF GETTING MULTIPLE TRAILER ROWS FOR A CONTAINER   * 06510000
065200*    AND TRYING TO DISPLAY THEM USING THE CURRENT LIST PROCESS  * 06520000
065300*    UTILIZED BY THE CICS ARCHITECTURE.                         * 06530000
065400***************************************************************** 06540000
065500                                                                  06550000
065600     EXEC SQL                                                     06560000
065700          DECLARE CNTNR-CSR CURSOR                                06570000
065800         FOR SELECT DISTINCT G.CONTNR_ID                          06580000
065810              ,G.CONTNR_SEQ_NBR                                   06581000
065900              ,G.FDR_FOB_CDE                                      06590000
066000              ,G.MOM_FOB_CDE                                      06600000
066100              ,G.MOM_TRIP_TYP_CDE                                 06610000
066200              ,G.FDR_TRIP_TYP_CDE                                 06620000
066300              ,G.MOM_DEST_POE_CDE                                 06630000
066400              ,G.ACTL_POE_DELY_TMST                               06640000
066500              ,G.MOM_POE_DELY_TMST                                06650000
066700              ,G.DO_RCVD_TMST                                     06670000
066800              ,G.BKR_FRGT_RLSE_TMST                               06680000
066900              ,G.CONTNR_PU_TMST                                   06690000
067000              , COALESCE(CNTR_TBL.TRIP_ID,0)                      06700000
067100              , COALESCE(CNTR_TBL.SHIPT_ID,0)                     06710000
067200              , COALESCE(CNTR_TBL.PO_NBR,0)                       06720000
067300              , COALESCE(CNTR_TBL.OPER_UNT_ID,0)                  06730000
067400              , COALESCE(CNTR_TBL.VEH_NBR,' ')                    06740000
067500              , COALESCE(CNTR_TBL.OWNER_SCAC_ID,' ')              06750000
067600              , COALESCE(G.DO_TO_DCONSLR_TMST,                    06760000
067601                         TIMESTAMP('0001-01-01-00.00.00.000000')) 06760100
067602              ,G.DCONSLR_RET_TMST                                 06760200
067603              , COALESCE(G.DCONSLR_SCAC_ID,' ')                   06760321
067604              ,G.DVN_TMST                                         06760421
067605              ,G.DO_RCVD_CDE                                      06760521
067606              ,G.BKR_FRGT_RLSE_CDE                                06760621
067607              ,G.CONTNR_PU_CDE                                    06760721
067608              ,G.DVN_CDE                                          06760821
067609              ,G.DCONSLR_RET_CDE                                  06760921
067610              ,G.CSTM_ENTR_ID                                     06761021
067611            FROM (SELECT L.CONTNR_ID                              06761100
067612                        ,L.CONTNR_SEQ_NBR                         06761200
067700                        ,L.PO_NBR                                 06770000
067800                        ,H.FDR_FOB_CDE                            06780000
067900                        ,H.MOM_FOB_CDE                            06790000
068000                        ,H.MOM_TRIP_TYP_CDE                       06800000
068100                        ,H.FDR_TRIP_TYP_CDE                       06810000
068200                        ,H.MOM_DEST_POE_CDE                       06820000
068300                        ,H.ACTL_POE_DELY_TMST                     06830000
068400                        ,H.MOM_POE_DELY_TMST                      06840000
068600                        ,H.DO_RCVD_TMST                           06860000
068700                        ,H.BKR_FRGT_RLSE_TMST                     06870000
068800                        ,H.CONTNR_PU_TMST                         06880000
068801                        ,K.DO_TO_DCONSLR_TMST                     06880100
068802                        ,H.DCONSLR_RET_TMST                       06880200
068803                        ,H.DCONSLR_SCAC_ID                        06880321
068804                        ,H.DVN_TMST                               06880421
068805                        ,L.DO_RCVD_CDE                            06880521
068806                        ,L.BKR_FRGT_RLSE_CDE                      06880621
068807                        ,L.CONTNR_PU_CDE                          06880721
068808                        ,L.DVN_CDE                                06880821
068809                        ,L.DCONSLR_RET_CDE                        06880921
068810                        ,L.CSTM_ENTR_ID                           06881021
068811                  FROM   TIMCNPO L                                06881100
068812                 INNER JOIN                                       06881200
068813                         TIMCNTK H                                06881300
068814                      ON L.CONTNR_SEQ_NBR = H.CONTNR_SEQ_NBR      06881400
068815                     AND L.CONTNR_ID = H.CONTNR_ID                06881500
068816                 LEFT OUTER JOIN                                  06881600
068817                         TIMCSCN K                                06881700
068818                       ON L.CONTNR_ID = K.CONTNR_ID               06881800
068820                      AND L.CSTM_ENTR_ID = K.CSTM_ENTR_ID         06882000
069100                   WHERE PO_NBR = :DK-PO-NBR) AS G                06910000
069300                 LEFT OUTER JOIN                                  06930000
069400                 (SELECT A.TRIP_ID                                06940000
069500                        ,A.SHIPT_ID                               06950000
069600                        ,C.OPER_UNT_ID                            06960000
069700                        ,E.VEH_NBR                                06970000
069800                        ,C.CONTNR_ID                              06980000
069900                        ,B.PO_NBR                                 06990000
070000                        ,E.OWNER_SCAC_ID                          07000000
070100                    FROM TSHIPMT  A                               07010000
070200                        ,TSHPTPO  B                               07020000
070300                        ,TPKSLIP  C                               07030000
070400                        ,TPURCHS  D                               07040000
070500                        ,TVHTRIP  E                               07050000
070600                        ,TVEHICL  F                               07060000
070700                  WHERE  B.PO_NBR = :DK-PO-NBR                    07070000
070800                    AND  B.PO_NBR = C.PO_NBR                      07080000
070900                    AND  B.REC_SEQ_NBR   = C.REC_SEQ_NBR          07090000
071000                    AND  B.REC_SEQ_NBR  ^= 0                      07100000
071100                    AND  C.PO_NBR        = D.PO_NBR               07110000
071200                    AND  A.BOL_NBR       = C.BOL_NBR              07120000
071300                    AND  A.SHIPT_ID      = B.SHIPT_ID             07130000
071400                    AND  A.TRIP_ID       = E.TRIP_ID              07140000
071500                    AND  E.OWNER_SCAC_ID = F.OWNER_SCAC_ID        07150000
071600                    AND  E.VEH_NBR       = F.VEH_NBR              07160000
071700                    AND  F.VEH_TYP_CDE   = 'TR'                   07170000
071800                    AND  C.VER_STAT_CDE  = 'A'                    07180000
071900                    AND  D.VER_STATUS_CDE  = 'A') AS CNTR_TBL     07190000
072000                 ON G.PO_NBR = CNTR_TBL.PO_NBR                    07200000
072100                AND G.CONTNR_ID = CNTR_TBL.CONTNR_ID              07210000
072200     END-EXEC.                                                    07220000
072300                                                                  07230000
072400 EJECT                                                            07240000
072500                                                                  07250000
072600*----------------------------------------------------------------*07260000
072700*    CURSOR DECLARATION FOR SELECTING OUTER PACK QUANTITY        *07270000
072800*----------------------------------------------------------------*07280000
072900                                                                  07290000
072901     EXEC SQL                                                     07290121
072902          DECLARE  OUTR-PCK-CSR CURSOR                            07290221
072903             FOR   SELECT                                         07290321
072904                   A.UNT_QTY                                      07290421
072905                ,  A.OUTR_PK_QTY                                  07290522
072906             FROM  TPURITM  A                                     07290621
072909             WHERE A.PO_NBR         = :DK-PO-NBR                  07290921
072922             AND   A.VER_STATUS_CDE = 'A'                         07292221
072923             FOR   FETCH ONLY                                     07292321
072924     END-EXEC.                                                    07292421
074200                                                                  07420000
074300 EJECT                                                            07430000
074400*---------------------------------------------------------------* 07440000
074401*    CURSOR DECLARATION FOR SELECTING POE CODE.                 * 07440100
074402*---------------------------------------------------------------* 07440200
074403                                                                  07440300
074404     EXEC SQL                                                     07440400
074405          DECLARE  POE-CSR CURSOR                                 07440500
074406              FOR  SELECT DISTINCT                                07440600
074407                   POE_CDE                                        07440700
074408             FROM  TIMPOE                                         07440800
074409            WHERE  POE_STD_EDI_CDE = :PV-MOM-DEST-POE-CDE         07440900
074410              AND  STAT_CDE        = 'A'                          07441000
074420         ORDER BY  POE_CDE                                        07442000
074430     END-EXEC.                                                    07443000
074431                                                                  07443100
074432 EJECT                                                            07443200
074433*----------------------------------------------------------------*07443300
074500 LINKAGE SECTION.                                                 07450000
074600                                                                  07460000
074700 01  DFHCOMMAREA.                                                 07470000
074800     05  FILLER                         OCCURS  1 TO 4072 TIMES   07480000
074900                                        DEPENDING ON EIBCALEN.    07490000
075000         10  FILLER                     PIC X.                    07500000
075100                                                                  07510000
075200 EJECT                                                            07520000
075300*----------------------------------------------------------------*07530000
075400 PROCEDURE DIVISION.                                              07540000
075500*----------------------------------------------------------------*07550000
075600*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.  *07560000
075700*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM   *07570000
075800*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.  *07580000
075900*----------------------------------------------------------------*07590000
076000 0000-MAIN-MODULE.                                                07600000
076100                                                                  07610000
076200     INITIALIZE DP030-CICS-API-FIELDS.                            07620000
076300     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       07630000
076400     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          07640000
076500     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         07650000
076600     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       07660000
076700     MOVE LENGTH OF TR167AI        TO DP030-MAP-LENGTH (1).       07670000
076800     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     07680000
076900     PERFORM 0001-CALL-CICS-ARCH-API.                             07690000
077000                                                                  07700000
077100     PERFORM 1000-CONTROL-PROCESSING.                             07710000
077200                                                                  07720000
077300     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     07730000
077400     PERFORM 0001-CALL-CICS-ARCH-API.                             07740000
077500                                                                  07750000
077600*----------------------------------------------------------------*07760000
077700*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *07770000
077800*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *07780000
077900*----------------------------------------------------------------*07790000
078000 0001-CALL-CICS-ARCH-API.                                         07800000
078100                                                                  07810000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      07820025
078300                                    DFHCOMMAREA                   07830025
078400                                    DP030-CICS-API-FIELDS         07840025
078500                                    DP020-STANDARD-COMMAREA       07850025
078600                                    TR167AI.                      07860025
078700                                                                  07870000
078800     IF  DP030-RC-CALL-SUCCESSFUL                                 07880000
078900         CONTINUE                                                 07890000
079000     ELSE                                                         07900000
079100         SET DP013-NO-ROLLBACK                                    07910000
079200             DP013-XCTL-DISPLAY-RESTART                           07920000
079300             DP013-CICS-ABEND      TO TRUE                        07930000
079400         MOVE '0001-CALL-CICS-ARCH-API'                           07940000
079500                                   TO DP013-PARAGRAPH             07950000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O07960025
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      07970025
079800         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      07980000
079900         PERFORM DP013-0000-PROCESS-ABEND                         07990000
080000     END-IF.                                                      08000000
080100                                                                  08010000
080200 EJECT                                                            08020000
080300*----------------------------------------------------------------*08030000
080400* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *08040000
080500* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *08050000
080600*                                                                *08060000
080700* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *08070000
080800*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *08080000
080900*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *08090000
081000*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *08100000
081100*----------------------------------------------------------------*08110000
081200 1000-CONTROL-PROCESSING.                                         08120000
081300                                                                  08130000
085002     MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR.                          08500200
085003     EVALUATE TRUE                                                08500321
085004         WHEN DP020-NEXT-ACT-INITIAL                              08500400
085005             INITIALIZE ASC-SPECIFIC-COMMAREA                     08500500
085006             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            08500600
085007                                      ASC-SEL-TERM-ID             08500700
085008             MOVE DP020-SRC-TASK-NUMBER                           08500800
085009                                   TO ASC-LIST-TASK-NUMBER        08500900
085010                                      ASC-SEL-TASK-NUMBER         08501000
085011             MOVE PC-LIST-QUEUE-SEQ                               08501100
085012                                   TO ASC-LIST-SEQ                08501200
085013             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 08501300
085014             PERFORM 1100-PROCESS-INTER-APPL-COMM                 08501400
085015*-------$TEMPLATE NOTE$------------------------------------------*08501500
085016* IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION, *08501600
085017* SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO   *08501700
085018* TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED. *08501800
085019*----------------------------------------------------------------*08501900
085020             IF  PS-COMMAREA-NOT-VALID                            08502000
085021                 SET DP020-NEXT-ACT-APPL-ERROR                    08502100
085022                                   TO TRUE                        08502200
085023             ELSE                                                 08502300
085024                 PERFORM 4000-BUILD-INITIAL-PANEL                 08502400
085025             END-IF                                               08502500
085026                                                                  08502600
085027         WHEN DP020-NEXT-ACT-READ-MAP                             08502700
085028             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        08502800
085029                                   TO PV-TOP-ITEM                 08502900
085030             PERFORM 2000-PROCESS-PANEL                           08503000
085031                                                                  08503100
085032         WHEN DP020-NEXT-ACT-RETURN                               08503200
085033             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        08503300
085034                                   TO PV-TOP-ITEM                 08503400
085035             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    08503500
085036             IF ASC-UPDATE-TSQ-1                                  08503600
085037                 PERFORM 7000-REFRESH-PANEL-FROM-TEMP             08503700
085038             ELSE                                                 08503800
085039                 PERFORM 6000-REFRESH-PANEL-FROM-TEMP             08503900
085040             END-IF                                               08504000
085041             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   08504100
085042             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08504200
085043             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08504300
085100                                                                  08510000
085200         WHEN OTHER                                               08520000
085300             SET DP013-LOGIC-ABEND TO TRUE                        08530000
085400             SET DP013-NO-ROLLBACK TO TRUE                        08540000
085500             MOVE '1000-CONTROL-PROCESSING'                       08550000
085600                                   TO DP013-PARAGRAPH             08560000
085700             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    08570000
085800                                   TO DP013-MESSAGE-TEXT(1)       08580000
085900             PERFORM DP013-0000-PROCESS-ABEND                     08590000
086000     END-EVALUATE.                                                08600000
086100                                                                  08610000
086200 EJECT                                                            08620000
086300*----------------------------------------------------------------*08630000
086400* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *08640000
086500* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *08650000
086600*----------------------------------------------------------------*08660000
086700 1100-PROCESS-INTER-APPL-COMM.                                    08670000
086800                                                                  08680000
086900     SET PS-COMMAREA-VALID         TO TRUE.                       08690000
087000     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     08700000
087100     IF  DP020-NAV-KEY-DATA > SPACE                               08710000
087200         MOVE DP020-NAV-KEY-DATA                                  08720000
087300                                TO ASC-KEY-PO-NBR                 08730000
087400                                   DK-PO-NBR                      08740000
087500     ELSE                                                         08750000
087600         IF DP020-INT-APPL-FORMAT-IND = PC-PO-LINEHAUL-FORMAT     08760000
087610             SET ASC-DISPLAY-LINEHAUL TO TRUE                     08761000
087700             MOVE TR113-PO-NBR  TO ASC-KEY-PO-NBR                 08770000
087800                                   DK-PO-NBR                      08780000
087900         ELSE                                                     08790000
087910             SET ASC-DISPLAY-DECON TO TRUE                        08791000
088000             MOVE TR105-PO-NBR  TO ASC-KEY-PO-NBR                 08800000
088100                                   DK-PO-NBR                      08810000
088200         END-IF                                                   08820000
088300     END-IF.                                                      08830000
088400                                                                  08840000
088500 EJECT                                                            08850000
088600*----------------------------------------------------------------*08860000
088700* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITING OF THE DATA    *08870000
088800* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *08880000
088900* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *08890000
089000* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *08900000
089100* FUNCTION KEYS CAN GET THIS FAR.                                *08910000
089200*----------------------------------------------------------------*08920000
089300 2000-PROCESS-PANEL.                                              08930000
089400                                                                  08940000
089500     EVALUATE TRUE                                                08950000
089600         WHEN DP020-SRC-AID = DP016-CLEAR                         08960000
089700             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    08970000
089710             SET ASC-DISPLAY-DECON TO TRUE                        08971000
089800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08980000
089900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08990000
090000                                                                  09000000
090100         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    09010000
090200             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   09020000
090210             SET ASC-DISPLAY-DECON TO TRUE                        09021000
090300             PERFORM 2050-DELETE-LIST-QUEUE                       09030000
090400             PERFORM 4000-BUILD-INITIAL-PANEL                     09040000
090500                                                                  09050000
090600         WHEN OTHER                                               09060000
090700             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 09070000
090800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   09080000
090900             IF  PS-NO-ERROR                                      09090000
091000                 SET DP030-CONTINUE-GO                            09100000
091100                                 TO TRUE                          09110000
091200                 PERFORM 2100-CHECK-FUNCTION-KEY                  09120000
091300             ELSE                                                 09130000
091400                 SET DP030-OVERRIDE-GO                            09140000
091500                                 TO TRUE                          09150000
091600             END-IF                                               09160000
091700     END-EVALUATE.                                                09170000
091800                                                                  09180000
091900 EJECT                                                            09190000
092000*----------------------------------------------------------------*09200000
092100*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *09210000
092200*----------------------------------------------------------------*09220000
092300 2050-DELETE-LIST-QUEUE.                                          09230000
092400                                                                  09240000
092500     EXEC CICS                                                    09250000
092600         DELETEQ TS                                               09260000
092700             QUEUE (ASC-LIST-QUEUE-NAME)                          09270000
092800             RESP  (PV-CICS-RESP)                                 09280000
092900     END-EXEC.                                                    09290000
093000                                                                  09300000
093100     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       09310000
093200        (PV-CICS-RESP = DFHRESP(QIDERR))                          09320000
093300         CONTINUE                                                 09330000
093400     ELSE                                                         09340000
093500         SET DP013-CICS-ABEND      TO TRUE                        09350000
093600         SET DP013-NO-ROLLBACK     TO TRUE                        09360000
093700                                                                  09370000
093800         MOVE '2050-DELETE-LIST-QUEUE'                            09380000
093900                                   TO DP013-PARAGRAPH             09390000
094000         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    09400000
094100                                   TO DP013-MESSAGE-TEXT (1)      09410000
094200         PERFORM DP013-0000-PROCESS-ABEND                         09420000
094300     END-IF.                                                      09430000
094400                                                                  09440000
094500     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  09450000
094600                                                                  09460000
094700 EJECT                                                            09470000
094800*----------------------------------------------------------------*09480000
094900* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*09490000
095000* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *09500000
095100* CICS ARCHITECTURE API.                                         *09510000
095200*----------------------------------------------------------------*09520000
095300 2100-CHECK-FUNCTION-KEY.                                         09530000
095400                                                                  09540000
095500     EVALUATE TRUE                                                09550000
095600                                                                  09560000
095700         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              09570000
095800         WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)              09580000
095900           IF ASC-NUMBER-OF-SELECTED-ITEMS = 1                    09590000
096000             INITIALIZE  TR102-INTER-APPL-COMMAREA                09600000
096100             MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    09610000
096200                             TO TR102-NUMBER-OF-SELECTED-ITEMS    09620000
096300             MOVE ASC-KEY-PO-NBR                                  09630000
096400                             TO TR102-PO-NBR                      09640000
096500             MOVE PV-CONTNR-NBR                                   09650000
096600                             TO TR102-CONTNR-NO                   09660000
096700             MOVE PV-CONTNR-SEQ-NBR                               09670000
096800                             TO TR102-CONTNR-SEQ-NO               09680000
096900             MOVE ASC-CSTM-ENTRY (ASC-BLK-SUB ASC-ITEM-SUB)       09690000
097000                             TO TR102-CSTM-ENTRY-ID               09700000
097100             PERFORM 5600-PREPARE-SEL-QUEUE                       09710000
097101           ELSE                                                   09710100
097102              IF ASC-NUMBER-OF-SELECTED-ITEMS > 1                 09710200
097103                SET DP030-OVERRIDE-GO TO TRUE                     09710300
097104                MOVE PC-TSYMSG-00047  TO DP020-MSG-NUMBER         09710400
097105                SET DP020-MSG-WARNING TO TRUE                     09710500
097106              ELSE                                                09710600
097107                IF ASC-NUMBER-OF-SELECTED-ITEMS = 0               09710700
097108                  SET DP030-OVERRIDE-GO TO TRUE                   09710800
097109                  MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER       09710900
097110                  SET DP020-MSG-WARNING TO TRUE                   09711000
097200                END-IF                                            09720000
097300              END-IF                                              09730000
097400           END-IF                                                 09740000
097401         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              09740100
097402            IF ASC-NUMBER-OF-SELECTED-ITEMS = 1                   09740200
097403              INITIALIZE         TR109-INTER-APPL-COMMAREA        09740300
097404              PERFORM 5000-PREPARE-SEL-QUEUE                      09740400
097405            ELSE                                                  09740500
097406              IF ASC-NUMBER-OF-SELECTED-ITEMS > 1                 09740600
097407                SET DP030-OVERRIDE-GO TO TRUE                     09740700
097408                MOVE PC-TSYMSG-00047  TO DP020-MSG-NUMBER         09740800
097409                SET DP020-MSG-WARNING TO TRUE                     09740900
097410              ELSE                                                09741000
097411                IF ASC-NUMBER-OF-SELECTED-ITEMS = 0               09741100
097412                  SET DP030-OVERRIDE-GO TO TRUE                   09741200
097413                  MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER       09741300
097414                  SET DP020-MSG-WARNING TO TRUE                   09741400
097415                END-IF                                            09741500
097416              END-IF                                              09741600
097417            END-IF                                                09741700
097418                                                                  09741800
097419         WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)              09741900
097420             INITIALIZE  TR105-INTER-APPL-COMMAREA                09742000
097430             MOVE ASC-KEY-PO-NBR TO TR105-PO-NBR                  09743000
097440                                                                  09744000
097450         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               09745000
097460             SET ASC-DISPLAY-DECON  TO TRUE                       09746000
097470             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         09747000
097480             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09748000
097490                                                                  09749000
097500         WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)               09750000
097600             SET ASC-DISPLAY-LINEHAUL TO TRUE                     09760000
097700             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         09770000
097800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09780000
097801                                                                  09780100
097802         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  09780200
097803             MOVE +1               TO PV-TOP-ITEM                 09780300
097804             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   09780400
097900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09790000
098000             PERFORM 3200-RESET-ATTRIBUTES                        09800000
098100                                                                  09810000
098200         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   09820000
098300             PERFORM 2110-BROWSE-BACKWARD                         09830000
098400             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   09840000
098500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09850000
098600             PERFORM 3200-RESET-ATTRIBUTES                        09860000
098700                                                                  09870000
098800         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   09880000
098900             PERFORM 2120-BROWSE-FORWARD                          09890000
099000             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   09900000
099100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09910000
099200                                                                  09920000
099300         WHEN DP020-SRC-AID = DP016-ENTER                         09930000
099400             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   09940000
099500             IF  PS-ERROR                                         09950000
099600                 CONTINUE                                         09960000
099700             ELSE                                                 09970000
099800                 MOVE ASC-KEY-PO-NBR                              09980000
099900                                   TO DK-PO-NBR                   09990000
100000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             10000000
100100                 PERFORM 3200-RESET-ATTRIBUTES                    10010000
100200             END-IF                                               10020000
100300                                                                  10030000
100400         WHEN OTHER                                               10040000
100500             SET DP013-NO-ROLLBACK                                10050000
100600                 DP013-XCTL-DISPLAY-RESTART                       10060000
100700                 DP013-CICS-ABEND  TO TRUE                        10070000
100800             MOVE '2100-CHECK-FUNCTION-KEY'                       10080000
100900                                   TO DP013-PARAGRAPH             10090000
101000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      10100000
101100                                   TO DP013-MESSAGE-TEXT (1)      10110000
101200             PERFORM DP013-0000-PROCESS-ABEND                     10120000
101300     END-EVALUATE.                                                10130000
101400                                                                  10140000
101500 EJECT                                                            10150000
101600*----------------------------------------------------------------*10160000
101700*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *10170000
101800*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *10180000
101900*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *10190000
102000*    MESSAGE.                                                    *10200000
102100*----------------------------------------------------------------*10210000
102200 2110-BROWSE-BACKWARD.                                            10220000
102300                                                                  10230000
102400     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    10240000
102500         GIVING PV-TOP-ITEM.                                      10250000
102600                                                                  10260000
102700     IF  ((PV-TOP-ITEM < +1)                                      10270000
102800       OR (PV-TOP-ITEM = +1))                                     10280000
102900         MOVE +1                   TO PV-TOP-ITEM                 10290000
103000*------- TOP OF LIST -----                                        10300000
103100         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            10310000
103200         SET DP020-MSG-INFORMATIONAL TO TRUE                      10320000
103300     END-IF.                                                      10330000
103400                                                                  10340000
103500 EJECT                                                            10350000
103600*----------------------------------------------------------------*10360000
103700*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *10370000
103800*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *10380000
103900*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *10390000
104000*----------------------------------------------------------------*10400000
104100 2120-BROWSE-FORWARD.                                             10410000
104200                                                                  10420000
104300     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              10430000
104400         GIVING PV-TOP-ITEM.                                      10440000
104500     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   10450000
104600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            10460000
104700                                   TO PV-TOP-ITEM                 10470000
104800*------- BOTTOM OF LIST -----------                               10480000
104900         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            10490000
105000         SET DP020-MSG-INFORMATIONAL                              10500000
105100                                   TO TRUE                        10510000
105200     ELSE                                                         10520000
105300         COMPUTE PV-BOTTOM-ITEM =                                 10530000
105400             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 10540000
105500         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            10550000
105600*----------- BOTTOM OF LIST ---------                             10560000
105700             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            10570000
105800             SET DP020-MSG-INFORMATIONAL                          10580000
105900                                   TO TRUE                        10590000
106000         END-IF                                                   10600000
106100     END-IF.                                                      10610000
106200                                                                  10620000
106300 EJECT                                                            10630000
106400*----------------------------------------------------------------*10640000
106500*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *10650000
106600*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *10660000
106700*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *10670000
106800*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *10680000
106900*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *10690000
107000*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *10700000
107100*----------------------------------------------------------------*10710000
107200 2130-CHECK-FOR-JUMP-BROWSE.                                      10720000
107300                                                                  10730000
107400     SET PS-NO-ERROR               TO TRUE.                       10740000
107500     IF  (ASC-START-ITEM-REQUEST = SPACE)                         10750000
107600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            10760000
107700                                   TO PV-TOP-ITEM                 10770000
107800     ELSE                                                         10780000
107900         MOVE ASC-START-ITEM-REQUEST                              10790000
108000                                   TO DP010I-UNEDITED-FIELD       10800000
108100         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       10810000
108200         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     10820000
108300         SET DP010I-NEGATIVE-NOT-ALLOWED                          10830000
108400                                   TO TRUE                        10840000
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                         10851024
263697              USING DP010I-NUMERIC-EDIT-AREA                      10852024
108600                                                                  10860000
108700         IF  NOT DP010I-ERROR-DETECTED                            10870000
108800             MOVE DP010I-NUMERIC-FIELD                            10880000
108900                                   TO  ASC-START-ITEM-REQUEST-N   10890000
109000             IF  ASC-START-ITEM-REQUEST-N > ZERO                  10900000
109100                 IF  ASC-START-ITEM-REQUEST-N >                   10910000
109200                                          ASC-NUMBER-OF-ITEMS-READ10920000
109300                     MOVE SPACE TO ASC-START-ITEM-REQUEST         10930000
109400                     COMPUTE PV-TOP-ITEM =                        10940000
109500                             ASC-NUMBER-OF-ITEMS-READ             10950000
109600                             - PC-ITEMS-PER-PANEL + 1             10960000
109700                     IF  PV-TOP-ITEM < +1                         10970000
109800                         MOVE +1   TO PV-TOP-ITEM                 10980000
109900                         MOVE PC-TSYMSG-00070                     10990000
110000                                   TO DP020-MSG-NUMBER            11000000
110100                         SET DP020-MSG-INFORMATIONAL              11010000
110200                                   TO TRUE                        11020000
110300                     END-IF                                       11030000
110400                 ELSE                                             11040000
110500                     MOVE ASC-START-ITEM-REQUEST-N                11050000
110600                                   TO PV-TOP-ITEM                 11060000
110700                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      11070000
110800                     COMPUTE PV-BOTTOM-ITEM =                     11080000
110900                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     11090000
111000                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ11100000
111100*----------------------- BOTTOM OF LIST --------------            11110000
111200                         MOVE PC-TSYMSG-00070                     11120000
111300                                   TO DP020-MSG-NUMBER            11130000
111400                         SET DP020-MSG-INFORMATIONAL              11140000
111500                                   TO TRUE                        11150000
111600                     END-IF                                       11160000
111700                 END-IF                                           11170000
111800             ELSE                                                 11180000
111900*--------------- VALUE OUT OF RANGE ------------------            11190000
112000                 MOVE PC-TSYMSG-00101                             11200000
112100                                   TO DP020-MSG-NUMBER            11210000
112200                 MOVE -1           TO ASTRTITL                    11220000
112300                 SET DP030-SET-CURSOR-APPL-1                      11230000
112400                                   TO TRUE                        11240000
112500                 MOVE DP015-REVERSE                               11250000
112600                                   TO ASTRTITH                    11260000
112700                 MOVE DP015-RED    TO ASTRTITC                    11270000
112800                 MOVE DP015-UNP-NUM-BRT-MDT                       11280000
112900                                   TO ASTRTITA                    11290000
113000                 SET DP020-MSG-FATAL                              11300000
113100                                   TO TRUE                        11310000
113200                 SET PS-ERROR      TO TRUE                        11320000
113300             END-IF                                               11330000
113400                                                                  11340000
113500         ELSE                                                     11350000
113600             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            11360000
113700             MOVE -1               TO ASTRTITL                    11370000
113800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  11380000
113900             MOVE DP015-REVERSE    TO ASTRTITH                    11390000
114000             MOVE DP015-RED        TO ASTRTITC                    11400000
114100             MOVE DP015-UNP-NUM-BRT-MDT                           11410000
114200                                   TO ASTRTITA                    11420000
114300             SET DP020-MSG-FATAL   TO TRUE                        11430000
114400             SET PS-ERROR          TO TRUE                        11440000
114500         END-IF                                                   11450000
114600     END-IF.                                                      11460000
114700                                                                  11470000
114800 EJECT                                                            11480000
114900*----------------------------------------------------------------*11490000
115000*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *11500000
115100*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *11510000
115200*----------------------------------------------------------------*11520000
115300 2140-DESELECT-ALL-ITEMS.                                         11530000
115400                                                                  11540000
115500     MOVE +1                       TO ASC-BLK-SUB.                11550000
115600                                                                  11560000
115700     PERFORM 2141-CLEAR-SELECTED-INDS                             11570000
115800         VARYING ASC-ITEM-SUB                                     11580000
115900         FROM 1 BY 1                                              11590000
116000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11600000
116100                                                                  11610000
116200     ADD +1                        TO ASC-BLK-SUB.                11620000
116300                                                                  11630000
116400     PERFORM 2141-CLEAR-SELECTED-INDS                             11640000
116500         VARYING ASC-ITEM-SUB                                     11650000
116600         FROM 1 BY 1                                              11660000
116700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11670000
116800                                                                  11680000
116900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11690000
117000                                   TO PV-LIST-ITEM-NUMBER.        11700000
117100                                                                  11710000
117200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11720000
117300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11730000
117400                                                                  11740000
117500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11750000
117600        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      11760000
117700         MOVE +1                   TO ASC-BLK-SUB                 11770000
117800                                                                  11780000
117900         PERFORM 5100-WRITE-TEMP-STORAGE                          11790000
118000                                                                  11800000
118100         MOVE +1                   TO PV-BLOCK-NUMBER             11810000
118200                                                                  11820000
118300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11830000
118400             PV-FIRST-BLOCK-IN-ARRAY - 1                          11840000
118500                                                                  11850000
118600         PERFORM                                                  11860000
118700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11870000
118800                                                                  11880000
118900             PERFORM 4410-READ-TEMP-STORAGE                       11890000
119000                                                                  11900000
119100             PERFORM 2141-CLEAR-SELECTED-INDS                     11910000
119200                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 11920000
119300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11930000
119400                                                                  11940000
119500             PERFORM 5100-WRITE-TEMP-STORAGE                      11950000
119600                                                                  11960000
119700             ADD +1                TO PV-BLOCK-NUMBER             11970000
119800                                                                  11980000
119900         END-PERFORM                                              11990000
120000                                                                  12000000
120100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12010000
120200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12020000
120300                                                                  12030000
120400         PERFORM                                                  12040000
120500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12050000
120600                   ASC-HIGHEST-BLOCK-WRITTEN                      12060000
120700                                                                  12070000
120800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12080000
120900                                   TO PV-BLOCK-NUMBER             12090000
121000                                                                  12100000
121100             PERFORM 4410-READ-TEMP-STORAGE                       12110000
121200                                                                  12120000
121300             PERFORM 2141-CLEAR-SELECTED-INDS                     12130000
121400                 VARYING ASC-ITEM-SUB                             12140000
121500                 FROM 1 BY 1                                      12150000
121600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12160000
121700                                                                  12170000
121800             PERFORM 5100-WRITE-TEMP-STORAGE                      12180000
121900                                                                  12190000
122000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12200000
122100                                                                  12210000
122200         END-PERFORM                                              12220000
122300                                                                  12230000
122400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12240000
122500                                   TO PV-BLOCK-NUMBER             12250000
122600                                                                  12260000
122700         PERFORM 4410-READ-TEMP-STORAGE                           12270000
122800     END-IF.                                                      12280000
122900                                                                  12290000
123000     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS12300000
123100                                      ASC-START-OF-SELECTED-RANGE 12310000
123200                                      ASC-END-OF-SELECTED-RANGE.  12320000
123300                                                                  12330000
123400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12340000
123500                                                                  12350000
123600 EJECT                                                            12360000
123700*----------------------------------------------------------------*12370000
123800*    MARK EACH ITEM AS BEING NOT SELECTED.                       *12380000
123900*----------------------------------------------------------------*12390000
124000 2141-CLEAR-SELECTED-INDS.                                        12400000
124100                                                                  12410000
124200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           12420000
124300             NOT EQUAL ZERO                                       12430000
124400         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          12440000
124500             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          12450000
124600                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    12460000
124700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12470000
124800                                   TO TRUE                        12480000
124900         END-IF                                                   12490000
125000     END-IF.                                                      12500000
125100                                                                  12510000
125200 EJECT                                                            12520000
125300*----------------------------------------------------------------*12530000
125400*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *12540000
125500*  FOR ALL ITEMS.                                                *12550000
125600*----------------------------------------------------------------*12560000
125700 2150-SELECT-ALL-ITEMS.                                           12570000
125800                                                                  12580000
125900     MOVE +1                       TO ASC-BLK-SUB.                12590000
126000                                                                  12600000
126100     PERFORM 2151-SET-SELECTED-INDS                               12610000
126200         VARYING ASC-ITEM-SUB                                     12620000
126300         FROM 1 BY 1                                              12630000
126400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12640000
126500                                                                  12650000
126600     ADD +1                        TO ASC-BLK-SUB.                12660000
126700                                                                  12670000
126800     PERFORM 2151-SET-SELECTED-INDS                               12680000
126900         VARYING ASC-ITEM-SUB                                     12690000
127000         FROM 1 BY 1                                              12700000
127100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12710000
127200                                                                  12720000
127300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               12730000
127400                                   TO PV-LIST-ITEM-NUMBER.        12740000
127500                                                                  12750000
127600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            12760000
127700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    12770000
127800                                                                  12780000
127900     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     12790000
128000        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    12800000
128100         MOVE +1                   TO ASC-BLK-SUB                 12810000
128200                                                                  12820000
128300         PERFORM 5100-WRITE-TEMP-STORAGE                          12830000
128400                                                                  12840000
128500         MOVE +1                   TO PV-BLOCK-NUMBER             12850000
128600                                                                  12860000
128700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12870000
128800             PV-FIRST-BLOCK-IN-ARRAY - 1                          12880000
128900                                                                  12890000
129000         PERFORM                                                  12900000
129100             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       12910000
129200                                                                  12920000
129300             PERFORM 4410-READ-TEMP-STORAGE                       12930000
129400                                                                  12940000
129500             PERFORM 2151-SET-SELECTED-INDS                       12950000
129600                 VARYING ASC-ITEM-SUB                             12960000
129700                 FROM 1 BY 1                                      12970000
129800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12980000
129900                                                                  12990000
130000             PERFORM 5100-WRITE-TEMP-STORAGE                      13000000
130100                                                                  13010000
130200             ADD +1                TO PV-BLOCK-NUMBER             13020000
130300                                                                  13030000
130400         END-PERFORM                                              13040000
130500                                                                  13050000
130600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13060000
130700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13070000
130800                                                                  13080000
130900         PERFORM                                                  13090000
131000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13100000
131100                   ASC-HIGHEST-BLOCK-WRITTEN                      13110000
131200                                                                  13120000
131300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          13130000
131400                                   TO PV-BLOCK-NUMBER             13140000
131500                                                                  13150000
131600             PERFORM 4410-READ-TEMP-STORAGE                       13160000
131700                                                                  13170000
131800             PERFORM 2151-SET-SELECTED-INDS                       13180000
131900                 VARYING ASC-ITEM-SUB                             13190000
132000                 FROM 1 BY 1                                      13200000
132100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13210000
132200                                                                  13220000
132300             PERFORM 5100-WRITE-TEMP-STORAGE                      13230000
132400                                                                  13240000
132500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      13250000
132600                                                                  13260000
132700         END-PERFORM                                              13270000
132800                                                                  13280000
132900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             13290000
133000                                   TO PV-BLOCK-NUMBER             13300000
133100                                                                  13310000
133200         PERFORM 4410-READ-TEMP-STORAGE                           13320000
133300     END-IF.                                                      13330000
133400                                                                  13340000
133500     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             13350000
133600                       ASC-NUMBER-OF-SELECTED-ITEMS.              13360000
133700                                                                  13370000
133800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        13380000
133900                                                                  13390000
134000 EJECT                                                            13400000
134100*----------------------------------------------------------------*13410000
134200*    MARK EACH ITEM AS BEING SELECTED.                           *13420000
134300*----------------------------------------------------------------*13430000
134400 2151-SET-SELECTED-INDS.                                          13440000
134500                                                                  13450000
134600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           13460000
134700             NOT EQUAL ZERO                                       13470000
134800         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             13480000
134900             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             13490000
135000                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        13500000
135100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  13510000
135200                               TO  TRUE                           13520000
135300         END-IF                                                   13530000
135400     END-IF.                                                      13540000
135500                                                                  13550000
135600 EJECT                                                            13560000
135700*----------------------------------------------------------------*13570000
135800*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *13580000
135900*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *13590000
136000*----------------------------------------------------------------*13600000
136100 2200-MOVE-SCREEN-TO-COMMAREA.                                    13610000
136200                                                                  13620000
136300     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             13630000
136400     MOVE +1                       TO PV-SUB.                     13640000
136500                                                                  13650000
136600     PERFORM 3100-SET-SUBSCRIPTS.                                 13660000
136700     IF  ASTRTITL > ZERO                                          13670000
136800         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          13680000
136900     ELSE                                                         13690000
137000         IF  ASTRTITF = DP015-ERASE-EOF                           13700000
137100             INITIALIZE ASC-START-ITEM-REQUEST                    13710000
137200         END-IF                                                   13720000
137300     END-IF.                                                      13730000
137400     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          13740000
137500         VARYING PV-SUB                                           13750000
137600         FROM 1 BY 1                                              13760000
137700         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      13770000
137800                                                                  13780000
137900 EJECT                                                            13790000
138000*----------------------------------------------------------------*13800000
138100*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *13810000
138200*----------------------------------------------------------------*13820000
138300 2210-MOVE-LINES-TO-COMMAREA.                                     13830000
138400                                                                  13840000
138500     IF  MR-SELECTL (PV-SUB) > ZERO                               13850000
138600         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             13860000
138700         MOVE MR-SELECTI (PV-SUB)                                 13870000
138800                                   TO ASC-TEMP-SELECTED-SW        13880000
138900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      13890000
139000     ELSE                                                         13900000
139100         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                13910000
139200                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     13920000
139300                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        13930000
139400                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      13940000
139500         END-IF                                                   13950000
139600     END-IF.                                                      13960000
139700     ADD +1                        TO ASC-ITEM-SUB.               13970000
139800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        13980000
139900         ADD  +1                   TO ASC-BLK-SUB                 13990000
140000         MOVE +1                   TO ASC-ITEM-SUB                14000000
140100     END-IF.                                                      14010000
140200                                                                  14020000
140300 EJECT                                                            14030000
140400*----------------------------------------------------------------*14040000
140500*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *14050000
140600*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *14060000
140700*----------------------------------------------------------------*14070000
140800 3000-EDIT-DATA-IN-COMMAREA.                                      14080000
140900                                                                  14090000
141000     SET PS-NO-ERROR               TO TRUE.                       14100000
141100     PERFORM 3200-RESET-ATTRIBUTES.                               14110000
141200     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     14120000
141300*----------------------------------------------------------------*14130000
141400* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.             *14140000
141500* EDITTING IS DONE FROM THE BOTTOM UP.                           *14150000
141600*----------------------------------------------------------------*14160000
141700     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       14170000
141800         ASC-ITEMS-DISPLAYED - 1.                                 14180000
141900     PERFORM 3100-SET-SUBSCRIPTS.                                 14190000
142000     PERFORM 3300-EDIT-SELECTIONS                                 14200000
142100         VARYING PV-SUB                                           14210000
142200         FROM PV-SUB BY -1                                        14220000
142300         UNTIL PV-SUB < +1.                                       14230000
142400                                                                  14240000
142500     IF  PS-NO-ERROR                                              14250000
142600         PERFORM 3400-CHECK-RANGE-SEQUENCE                        14260000
142700     END-IF.                                                      14270000
142800                                                                  14280000
142900     IF  ((PS-NO-ERROR)                                           14290000
143000       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   14300000
143100       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    14310000
143200             PERFORM 3500-MARK-RANGE-AS-SELECTED                  14320000
143300     END-IF.                                                      14330000
143400                                                                  14340000
143500 EJECT                                                            14350000
143600*----------------------------------------------------------------*14360000
143700*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *14370000
143800*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY. THIS WILL *14380000
143900*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *14390000
144000*                                                                *14400000
144100*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *14410000
144200*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *14420000
144300*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *14430000
144400*    US IN THE 2ND BLOCK OF THE ARRAY.                           *14440000
144500*----------------------------------------------------------------*14450000
144600 3100-SET-SUBSCRIPTS.                                             14460000
144700                                                                  14470000
144800     COMPUTE ASC-ITEM-SUB =                                       14480000
144900         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        14490000
145000                                                                  14500000
145100     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         14510000
145200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            14520000
145300                                                                  14530000
145400         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               14540000
145500     ELSE                                                         14550000
145600         MOVE +1                     TO ASC-BLK-SUB               14560000
145700     END-IF.                                                      14570000
145800                                                                  14580000
145900 EJECT                                                            14590000
146000*----------------------------------------------------------------*14600000
146100*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *14610000
146200*----------------------------------------------------------------*14620000
146300 3200-RESET-ATTRIBUTES.                                           14630000
146400                                                                  14640000
146500     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   14650000
146600     MOVE DP015-GREEN              TO ASTRTITC.                   14660000
146700     MOVE DP015-UNDERLINE          TO ASTRTITH.                   14670000
146800                                                                  14680000
146900     PERFORM                                                      14690000
147000         VARYING PV-SUB                                           14700000
147100         FROM 1 BY 1                                              14710000
147200         UNTIL PV-SUB > (PC-ITEMS-PER-PANEL  OR                   14720000
147300                         ASC-ITEMS-DISPLAYED)                     14730000
147400         MOVE DP015-UNP-ALP-NOR-OFF                               14740000
147500                                   TO MR-SELECTA (PV-SUB)         14750000
147600         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         14760000
147700         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         14770000
147800     END-PERFORM.                                                 14780000
147900                                                                  14790000
148000 EJECT                                                            14800000
148100*----------------------------------------------------------------*14810000
148200*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *14820000
148300*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *14830000
148400*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *14840000
148500*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *14850000
148600*----------------------------------------------------------------*14860000
148700 3300-EDIT-SELECTIONS.                                            14870000
148800                                                                  14880000
148900     EVALUATE TRUE                                                14890000
149000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14900000
149100             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         14910000
149200                 CONTINUE                                         14920000
149300         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         14930000
149400             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        14940000
149500                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   14950000
149600                 MOVE ASC-TEMP-SELECTED-SW                        14960000
149700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14970000
149800                                TO ASC-SELECTED-SW                14980000
149900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14990000
150000             END-IF                                               15000000
150100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     15010000
150200                                = SPACE                           15020000
150300             EVALUATE TRUE                                        15030000
150400                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       15040000
150500                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS15050000
150600                     MOVE SPACE TO ASC-SELECTED-SW                15060000
150700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15070000
150800                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        15080000
150900                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    15090000
151000                     MOVE SPACE TO ASC-SELECTED-SW                15100000
151100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15110000
151200                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          15120000
151300                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      15130000
151400                     MOVE SPACE TO ASC-SELECTED-SW                15140000
151500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15150000
151600             END-EVALUATE                                         15160000
151700         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           15170000
151800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15180000
151900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    15190000
152000             END-IF                                               15200000
152100             PERFORM 3310-EDIT-RANGE                              15210000
152200         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             15220000
152300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15230000
152400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    15240000
152500             END-IF                                               15250000
152600             PERFORM 3310-EDIT-RANGE                              15260000
152700         WHEN OTHER                                               15270000
152800             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           15280000
152900             SET DP020-MSG-FATAL    TO TRUE                       15290000
153000             MOVE -1                TO MR-SELECTL (PV-SUB)        15300000
153100             SET DP030-SET-CURSOR-APPL-1                          15310000
153200                                    TO TRUE                       15320000
153300             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        15330000
153400             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        15340000
153500             SET PS-ERROR TO TRUE                                 15350000
153600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15360000
153700                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     15370000
153800                 MOVE SPACE         TO ASC-SELECTED-SW            15380000
153900                                        (ASC-BLK-SUB ASC-ITEM-SUB)15390000
154000             END-IF                                               15400000
154100     END-EVALUATE.                                                15410000
154200                                                                  15420000
154300     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 15430000
154400     SUBTRACT +1 FROM ASC-ITEM-SUB.                               15440000
154500     IF  ASC-ITEM-SUB < 1                                         15450000
154600         SUBTRACT +1 FROM ASC-BLK-SUB                             15460000
154700         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                15470000
154800     END-IF.                                                      15480000
154900                                                                  15490000
155000 EJECT                                                            15500000
155100*----------------------------------------------------------------*15510000
155200*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *15520000
155300*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *15530000
155400*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *15540000
155500*  THE ENDING.                                                   *15550000
155600*----------------------------------------------------------------*15560000
155700 3310-EDIT-RANGE.                                                 15570000
155800                                                                  15580000
155900     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                15590000
156000         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   15600000
156100             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)15610000
156200                                   TO ASC-SELECTED-SW             15620000
156300                                        (ASC-BLK-SUB ASC-ITEM-SUB)15630000
156400             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 15640000
156500         ELSE                                                     15650000
156600             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     15660000
156700                 CONTINUE                                         15670000
156800             ELSE                                                 15680000
156900*--------------- ONLY ONE BEGINNING-OF-RANGE-ALLOWED ---          15690000
157000                 MOVE PC-TSYMSG-00054                             15700000
157100                                   TO DP020-MSG-NUMBER            15710000
157200                 SET DP020-MSG-FATAL                              15720000
157300                                   TO TRUE                        15730000
157400                 MOVE -1           TO MR-SELECTL (PV-SUB)         15740000
157500                 SET DP030-SET-CURSOR-APPL-1                      15750000
157600                                   TO TRUE                        15760000
157700                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         15770000
157800                 MOVE DP015-UNDERLINE                             15780000
157900                                   TO MR-SELECTH (PV-SUB)         15790000
158000                 SET PS-ERROR      TO TRUE                        15800000
158100             END-IF                                               15810000
158200         END-IF                                                   15820000
158300     ELSE                                                         15830000
158400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     15840000
158500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 15850000
158600                                   TO ASC-SELECTED-SW             15860000
158700                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15870000
158800             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   15880000
158900         ELSE                                                     15890000
159000             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       15900000
159100                 CONTINUE                                         15910000
159200             ELSE                                                 15920000
159300*--------------- ONLY ONE END-OF-RANGE ALLOWED -------            15930000
159400                 MOVE PC-TSYMSG-00055                             15940000
159500                                   TO DP020-MSG-NUMBER            15950000
159600                 SET DP020-MSG-FATAL                              15960000
159700                                   TO TRUE                        15970000
159800                 MOVE -1           TO MR-SELECTL (PV-SUB)         15980000
159900                 SET DP030-SET-CURSOR-APPL-1                      15990000
160000                                   TO TRUE                        16000000
160100                 SET PS-ERROR      TO TRUE                        16010000
160200             END-IF                                               16020000
160300         END-IF                                                   16030000
160400     END-IF.                                                      16040000
160500                                                                  16050000
160600 EJECT                                                            16060000
160700*----------------------------------------------------------------*16070000
160800*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *16080000
160900*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *16090000
161000*----------------------------------------------------------------*16100000
161100 3400-CHECK-RANGE-SEQUENCE.                                       16110000
161200                                                                  16120000
161300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       16130000
161400       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      16140000
161500       AND  ASC-START-OF-SELECTED-RANGE >                         16150000
161600                                         ASC-END-OF-SELECTED-RANGE16160000
161700*------- END-OF-RANGE BEFORE BEGINNING-OF-RANGE --                16170000
161800         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 16180000
161900         SET DP020-MSG-FATAL TO TRUE                              16190000
162000         SET PS-ERROR TO TRUE                                     16200000
162100         PERFORM 3410-POSITION-AT-ERROR                           16210000
162200     END-IF.                                                      16220000
162300                                                                  16230000
162400 EJECT                                                            16240000
162500*----------------------------------------------------------------*16250000
162600*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *16260000
162700*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *16270000
162800*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *16280000
162900*----------------------------------------------------------------*16290000
163000 3410-POSITION-AT-ERROR.                                          16300000
163100                                                                  16310000
163200     SET DP030-SET-CURSOR-APPL-1                                  16320000
163300                                   TO TRUE.                       16330000
163400     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 16340000
163500                    - PV-TOP-ITEM + 1.                            16350000
163600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16360000
163700         CONTINUE                                                 16370000
163800     ELSE                                                         16380000
163900         MOVE -1                   TO MR-SELECTL (PV-SUB)         16390000
164000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16400000
164100         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16410000
164200     END-IF.                                                      16420000
164300                                                                  16430000
164400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   16440000
164500                    - PV-TOP-ITEM + 1.                            16450000
164600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16460000
164700         CONTINUE                                                 16470000
164800     ELSE                                                         16480000
164900         MOVE -1                   TO MR-SELECTL (PV-SUB)         16490000
165000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16500000
165100         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16510000
165200     END-IF.                                                      16520000
165300                                                                  16530000
165400 EJECT                                                            16540000
165500*----------------------------------------------------------------*16550000
165600*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *16560000
165700*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *16570000
165800*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *16580000
165900*----------------------------------------------------------------*16590000
166000 3500-MARK-RANGE-AS-SELECTED.                                     16600000
166100                                                                  16610000
166200     MOVE +1                       TO  ASC-BLK-SUB.               16620000
166300     PERFORM 3510-MARK-SELECTED-INDS                              16630000
166400         VARYING ASC-ITEM-SUB                                     16640000
166500         FROM 1 BY 1                                              16650000
166600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16660000
166700                                                                  16670000
166800     ADD +1                        TO ASC-BLK-SUB.                16680000
166900     PERFORM 3510-MARK-SELECTED-INDS                              16690000
167000         VARYING ASC-ITEM-SUB                                     16700000
167100         FROM 1 BY 1                                              16710000
167200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16720000
167300                                                                  16730000
167400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               16740000
167500                                   TO  PV-LIST-ITEM-NUMBER.       16750000
167600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            16760000
167700         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         16770000
167800               PC-ITEMS-PER-PANEL).                               16780000
167900                                                                  16790000
168000     MOVE ASC-START-OF-SELECTED-RANGE                             16800000
168100                                   TO PV-START-OF-SELECTED-RANGE. 16810000
168200     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            16820000
168300         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  16830000
168400               PC-ITEMS-PER-PANEL).                               16840000
168500                                                                  16850000
168600     MOVE ASC-END-OF-SELECTED-RANGE                               16860000
168700                                   TO  PV-END-OF-SELECTED-RANGE.  16870000
168800     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             16880000
168900         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    16890000
169000               PC-ITEMS-PER-PANEL).                               16900000
169100     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             16910000
169200         PV-FIRST-BLOCK-IN-ARRAY + 1.                             16920000
169300                                                                  16930000
169400     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    16940000
169500        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        16950000
169600         MOVE +1                   TO ASC-BLK-SUB                 16960000
169700         PERFORM 5100-WRITE-TEMP-STORAGE                          16970000
169800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         16980000
169900             PV-FIRST-BLOCK-IN-ARRAY - 1                          16990000
170000                                                                  17000000
170100         PERFORM                                                  17010000
170200             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      17020000
170300                   PV-PREV-BLOCK-IN-ARRAY                         17030000
170400             MOVE PV-FIRST-BLOCK-IN-RANGE                         17040000
170500                                   TO PV-BLOCK-NUMBER             17050000
170600             PERFORM 4410-READ-TEMP-STORAGE                       17060000
170700             PERFORM 3510-MARK-SELECTED-INDS                      17070000
170800                 VARYING ASC-ITEM-SUB                             17080000
170900                 FROM 1 BY 1                                      17090000
171000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17100000
171100             PERFORM 5100-WRITE-TEMP-STORAGE                      17110000
171200             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     17120000
171300         END-PERFORM                                              17130000
171400                                                                  17140000
171500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         17150000
171600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     17160000
171700         PERFORM                                                  17170000
171800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       17180000
171900                   PV-LAST-BLOCK-IN-RANGE                         17190000
172000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          17200000
172100                                   TO PV-BLOCK-NUMBER             17210000
172200             PERFORM 4410-READ-TEMP-STORAGE                       17220000
172300             PERFORM 3510-MARK-SELECTED-INDS                      17230000
172400                 VARYING ASC-ITEM-SUB                             17240000
172500                 FROM 1 BY 1                                      17250000
172600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17260000
172700             PERFORM 5100-WRITE-TEMP-STORAGE                      17270000
172800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      17280000
172900         END-PERFORM                                              17290000
173000                                                                  17300000
173100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             17310000
173200                                   TO PV-BLOCK-NUMBER             17320000
173300         PERFORM 4410-READ-TEMP-STORAGE                           17330000
173400     END-IF.                                                      17340000
173500                                                                  17350000
173600     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 17360000
173700                                      ASC-END-OF-SELECTED-RANGE.  17370000
173800                                                                  17380000
173900 EJECT                                                            17390000
174000*----------------------------------------------------------------*17400000
174100* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *17410000
174200*----------------------------------------------------------------*17420000
174300 3510-MARK-SELECTED-INDS.                                         17430000
174400                                                                  17440000
174500     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         17450000
174600                                ASC-ITEM-SUB) >                   17460000
174700         ASC-START-OF-SELECTED-RANGE)                             17470000
174800     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         17480000
174900                                ASC-ITEM-SUB) =                   17490000
175000         ASC-START-OF-SELECTED-RANGE)                             17500000
175100                                                                  17510000
175200         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     17520000
175300                                    ASC-ITEM-SUB) <               17530000
175400             ASC-END-OF-SELECTED-RANGE)                           17540000
175500         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     17550000
175600                                    ASC-ITEM-SUB) =               17560000
175700             ASC-END-OF-SELECTED-RANGE)                           17570000
175800                                                                  17580000
175900             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          17590000
176000                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   17600000
176100                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   17610000
176200                               TO TRUE                            17620000
176300                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              17630000
176400                               TO TRUE                            17640000
176500                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    17650000
176600             END-IF                                               17660000
176700         END-IF                                                   17670000
176800     END-IF.                                                      17680000
176900                                                                  17690000
177000 EJECT                                                            17700000
177100*----------------------------------------------------------------*17710000
177200*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *17720000
177300*    INITIALIZE ALL COUNTERS AND FLAGS.                          *17730000
177400*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *17740000
177500*    DISPLAY THE PANEL TO USER.                                  *17750000
177600*----------------------------------------------------------------*17760000
177700 4000-BUILD-INITIAL-PANEL.                                        17770000
177800                                                                  17780000
177900     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             17790000
178000                                ASC-BLOCK-ENTRIES (2).            17800000
178100     MOVE +1                 TO ASC-BLK-SUB.                      17810000
178200     SET DP030-SET-CURSOR-TRAILER TO TRUE.                        17820000
178300     SET ASC-ITEMS-LEFT-ON-DB                                     17830000
178400                             TO TRUE.                             17840000
178500                                                                  17850000
178600     MOVE +0                 TO ASC-ITEM-SUB                      17860000
178700                                ASC-NUMBER-OF-ITEMS-READ          17870000
178800                                ASC-NUMBER-OF-SELECTED-ITEMS      17880000
178900                                ASC-HIGHEST-BLOCK-WRITTEN         17890000
179000                                ASC-START-OF-SELECTED-RANGE       17900000
179100                                ASC-END-OF-SELECTED-RANGE         17910000
179200                                ASC-ITEM-AT-TOP-OF-PANEL.         17920000
179300     PERFORM 4010-OPEN-CURSOR.                                    17930000
179400                                                                  17940000
179500     PERFORM 4300-READ-ITEMS-FROM-DB.                             17950000
179600                                                                  17960000
179700     PERFORM 4020-CLOSE-CURSOR.                                   17970000
179800                                                                  17980000
179900     MOVE +1                   TO  PV-TOP-ITEM.                   17990000
180000     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO OR                       18000000
180100         PS-DECONSOL-LINEHAUL-NO                                  18010000
180200         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    18020000
180300         SET DP020-MSG-FATAL   TO  TRUE                           18030000
180400*------- PURCHASE ORDER DOES NOT EXIST -----                      18040000
180500         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               18050000
180600     ELSE                                                         18060000
180700         MOVE -1               TO MR-SELECTL (1)                  18070000
180800         SET DP030-SET-CURSOR-APPL-1                              18080000
180900                               TO TRUE                            18090000
181000         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     18100000
181100     END-IF.                                                      18110000
181200                                                                  18120000
181300 EJECT                                                            18130000
181400*----------------------------------------------------------------*18140000
181500*   OPEN THE CONTAINER CURSOR                                    *18150000
181600*----------------------------------------------------------------*18160000
181700 4010-OPEN-CURSOR.                                                18170000
181800                                                                  18180000
181900     PERFORM                                                      18190000
182000         WITH TEST AFTER                                          18200000
182100         VARYING PV-RETRY-COUNTER                                 18210000
182200         FROM 1 BY 1                                              18220000
182300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               18230000
182400             OR (SQLCODE = ZERO))                                 18240000
182500                                                                  18250000
182600         MOVE 'CURSOR:  CNTNR-CSR'                                18260000
182700                        TO DP013-MESSAGE-TEXT (2)                 18270000
182800         EXEC SQL                                                 18280000
182900                  OPEN CNTNR-CSR                                  18290000
183000         END-EXEC                                                 18300000
183100                                                                  18310000
183200                                                                  18320000
183300         EVALUATE TRUE                                            18330000
183400             WHEN SQLCODE = ZERO                                  18340000
183500             WHEN SQLCODE = -904                                  18350000
183600             WHEN SQLCODE = -913                                  18360000
183700                 CONTINUE                                         18370000
183800             WHEN SQLWARN0 NOT = SPACES                           18380000
183900             WHEN SQLCODE < ZERO                                  18390000
184000             WHEN SQLCODE > ZERO                                  18400000
184100                 MOVE '4010-OPEN-CURSOR'                          18410000
184200                                   TO DP013-PARAGRAPH             18420000
184300                 MOVE 'OPEN CONTAINER CURSOR - '                  18430000
184400                                   TO DP013-MESSAGE-TEXT (1)      18440000
184500                 MOVE SQLCA        TO DP013-SQLCA                 18450000
184600                 MOVE 'TIMCNPO '   TO DP013-DB2-TABLE-NAME (1)    18460000
184700                 SET DP013-DB2-ABEND                              18470000
184800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           18480000
184900                 PERFORM DP013-0000-PROCESS-ABEND                 18490000
185000         END-EVALUATE                                             18500000
185100     END-PERFORM.                                                 18510000
185200                                                                  18520000
185300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        18530000
185400         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             18540000
185500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   18550000
185600                                   TO DP013-MESSAGE-TEXT (1)      18560000
185700         MOVE SQLCA                TO DP013-SQLCA                 18570000
185800         MOVE 'TIMCNPO '           TO DP013-DB2-TABLE-NAME (1)    18580000
185900         SET DP013-DB2-ABEND                                      18590000
186000             DP013-XCTL-DISPLAY-RESTART                           18600000
186100                                   TO TRUE                        18610000
186200         PERFORM DP013-0000-PROCESS-ABEND                         18620000
186300     END-IF.                                                      18630000
186400                                                                  18640000
186500 EJECT                                                            18650000
186600*----------------------------------------------------------------*18660000
186700*   CLOSE THE CONTAINER CURSOR                                   *18670000
186800*----------------------------------------------------------------*18680000
186900 4020-CLOSE-CURSOR.                                               18690000
187000                                                                  18700000
187100     EXEC SQL                                                     18710000
187200          CLOSE CNTNR-CSR                                         18720000
187300     END-EXEC                                                     18730000
187400                                                                  18740000
187500                                                                  18750000
187600     EVALUATE TRUE                                                18760000
187700         WHEN SQLCODE = ZERO                                      18770000
187800             CONTINUE                                             18780000
187900         WHEN SQLWARN0 NOT = SPACES                               18790000
188000         WHEN SQLCODE < ZERO                                      18800000
188100         WHEN SQLCODE > ZERO                                      18810000
188200             MOVE '4020-CLOSE-CURSOR'                             18820000
188300                               TO DP013-PARAGRAPH                 18830000
188400             MOVE 'CLOSE CONTNR CURSOR '                          18840000
188500                               TO DP013-MESSAGE-TEXT (1)          18850000
188600             MOVE SQLCA        TO DP013-SQLCA                     18860000
188700             MOVE 'TIMCNPO '   TO DP013-DB2-TABLE-NAME (1)        18870000
188800             SET DP013-DB2-ABEND                                  18880000
188900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               18890000
189000             PERFORM DP013-0000-PROCESS-ABEND                     18900000
189100     END-EVALUATE.                                                18910000
189200                                                                  18920000
189300 EJECT                                                            18930000
189400*----------------------------------------------------------------*18940000
189500*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *18950000
189600*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *18960000
189700*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *18970000
189800*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *18980000
189900*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *18990000
190000*                                                                *19000000
190100*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *19010000
190200*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *19020000
190300*    UPON INITIALIZATION.                                        *19030000
190400*----------------------------------------------------------------*19040000
190500 4300-READ-ITEMS-FROM-DB.                                         19050000
190600                                                                  19060000
190700     SET PS-DECONSOL-LINEHAUL-NO TO TRUE.                         19070000
190800                                                                  19080000
190900     PERFORM                                                      19090000
191000         VARYING PV-READ-COUNT                                    19100000
191100         FROM 1 BY 1                                              19110000
191200         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    19120000
191300            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         19130000
191400                                                                  19140000
191500         PERFORM 4310-FETCH                                       19150000
191600                                                                  19160000
191700         IF  ASC-ITEMS-LEFT-ON-DB                                 19170000
191800             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                19180000
191900                 ADD +1            TO ASC-ITEM-SUB                19190000
192000             ELSE                                                 19200000
192100                 ADD +1            TO ASC-BLK-SUB                 19210000
192200                 MOVE +1           TO ASC-ITEM-SUB                19220000
192300                                                                  19230000
192400                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         19240000
192500                     MOVE +1       TO ASC-BLK-SUB                 19250000
192600                     SET ASC-BLOCK-MODIFIED (1)                   19260000
192700                                   TO TRUE                        19270000
192800                     PERFORM 5100-WRITE-TEMP-STORAGE              19280000
192900                     MOVE ASC-BLOCK-ENTRIES                       19290000
193000                               (PC-MAX-BLOCKS-IN-ARRAY)           19300000
193100                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 19310000
193200                     ADD +1        TO ASC-BLK-SUB                 19320000
193300                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   19330000
193400                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      19340000
193500                                   TO  TRUE                       19350000
193600                 END-IF                                           19360000
193700             END-IF                                               19370000
193800             ADD +1                TO  ASC-NUMBER-OF-ITEMS-READ   19380000
193900             MOVE ASC-NUMBER-OF-ITEMS-READ                        19390000
194000                                   TO  ASC-LIST-ITEM-NUMBER       19400000
194100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19410000
194200             MOVE PV-VEH-NBR       TO  ASC-TRAILER                19420000
194300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19430000
194400             MOVE PV-OPER-UNT-ID   TO  ASC-DC                     19440000
194500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19450000
194600             MOVE PV-SCAC          TO  ASC-SCAC                   19460000
194700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19470000
194800             MOVE PV-TRIP-ID-N     TO  ASC-TRIP-ID                19480000
194900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19490000
195000             MOVE PV-CONTNR-SEQ-NBR TO ASC-CONTNR-SEQ-NBR         19500000
195100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19510000
195101             MOVE PV-DECN-SCAC     TO  ASC-DECN-SCAC              19510121
195102                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19510200
195300                                                                  19530000
195400*            PERFORM  4390-SELECT-DEVAN-DATE                      19540021
195410             PERFORM  4391-SELECT-SPLT-TO-DCONSL-DTE              19541021
195500             PERFORM  4395-MOVE-CONT-DATES-TO-COMM                19550000
195600             MOVE PV-CONTNR-NBR    TO  ASC-CONTNR-NBR             19560000
195700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19570000
195800             IF PV-MOM-POE-DELY-TMST(1:4) NOT = PC-0001           19580000
195900                STRING  PV-MOM-POE-DELY-TMST(6:2) '/'             19590000
196000                        PV-MOM-POE-DELY-TMST(9:2)                 19600000
196100                DELIMITED BY SIZE  INTO ASC-ETA                   19610000
196200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   19620000
196300             ELSE                                                 19630000
196400                MOVE SPACES TO ASC-ETA                            19640000
196500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   19650000
196600             END-IF                                               19660000
196610             PERFORM 4397-SELECT-CUSTOMS-ENTRY                    19661000
196700*            PERFORM  4340-FOB-CDE-CHECK                          19670000
196800             PERFORM  4350-POE-CDE-CHECK                          19680000
196900       END-IF                                                     19690000
197000     END-PERFORM.                                                 19700000
197100                                                                  19710000
197200     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          19720000
197300         MOVE +1               TO ASC-BLK-SUB                     19730000
197400         PERFORM 5100-WRITE-TEMP-STORAGE                          19740000
197500         ADD +1                TO ASC-BLK-SUB                     19750000
197600         PERFORM 5100-WRITE-TEMP-STORAGE                          19760000
197700                                                                  19770000
197800         MOVE 1                TO ASC-BLK-SUB                     19780000
197900                                  PV-BLOCK-NUMBER                 19790000
198000         PERFORM 4410-READ-TEMP-STORAGE                           19800000
198100         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             19810000
198200             MOVE 2            TO ASC-BLK-SUB                     19820000
198300                                  PV-BLOCK-NUMBER                 19830000
198400             PERFORM 4410-READ-TEMP-STORAGE                       19840000
198500         END-IF                                                   19850000
198600     END-IF.                                                      19860000
198700                                                                  19870000
198800 EJECT                                                            19880000
198900*----------------------------------------------------------------*19890000
199000*    FETCH THE CONTAINER CURSOR                                  *19900000
199100*----------------------------------------------------------------*19910000
199200 4310-FETCH.                                                      19920000
199300                                                                  19930000
199400        EXEC SQL                                                  19940000
199500        FETCH CNTNR-CSR                                           19950000
199600        INTO   :PV-CONTNR-NBR                                     19960000
199610             , :PV-CONTNR-SEQ-NBR                                 19961000
199700             , :PV-FDR-FOB-CDE                                    19970000
199800             , :PV-MOM-FOB-CDE                                    19980000
199900             , :PV-MOM-TRIP-TYP-CDE                               19990000
200000             , :PV-FDR-TRIP-TYP-CDE                               20000000
200100             , :PV-MOM-DEST-POE-CDE                               20010000
200200             , :PV-ACTL-POE-DELY-TMST                             20020000
200300             , :PV-MOM-POE-DELY-TMST                              20030000
200500             , :PV-DO-RCVD-TMST                                   20050000
200600             , :PV-BKR-FRGT-RLSE-TMST                             20060000
200700             , :PV-CONTNR-PU-TMST                                 20070000
200800             , :PV-TRIP-ID-N                                      20080000
200900             , :PV-SHIPT-ID                                       20090000
201000             , :PV-PO-NBR                                         20100000
201100             , :PV-OPER-UNT-ID                                    20110000
201200             , :PV-VEH-NBR                                        20120000
201300             , :PV-SCAC                                           20130000
201301             , :PV-DO-TO-DCONSLR-TMST                             20130100
201302             , :PV-DCONSLR-RTN-TMST                               20130200
201303             , :PV-DECN-SCAC                                      20130321
201304             , :PV-DVN-TMST                                       20130421
201305             , :PV-DO-RCVD-CDE                                    20130521
201306             , :PV-BKR-FRGT-RLSE-CDE                              20130621
201307             , :PV-CONTNR-PU-CDE                                  20130721
201308             , :PV-DVN-CDE                                        20130821
201309             , :PV-DCONSLR-RET-CDE                                20130921
201310             , :PV-CSTM-ENTR-ID                                   20131021
201400        END-EXEC                                                  20140000
201500                                                                  20150000
201600                                                                  20160000
201700     EVALUATE TRUE                                                20170000
201800         WHEN SQLCODE = ZERO                                      20180000
201810              SET PS-DECONSOL-LINEHAUL-YES TO TRUE                20181000
201900         WHEN SQLCODE = +100                                      20190000
202000         WHEN SQLCODE = -305                                      20200000
202100              CONTINUE                                            20210000
202200         WHEN SQLWARN0 NOT = SPACE                                20220000
202300         WHEN SQLCODE NOT = ZERO                                  20230000
202400              MOVE '4310-FETCH-CURSOR'                            20240000
202500                               TO DP013-PARAGRAPH                 20250000
202600              MOVE 'FETCH CONTNR CURSOR'                          20260000
202700                               TO DP013-MESSAGE-TEXT (1)          20270000
202800              MOVE SQLCA       TO DP013-SQLCA                     20280000
202900              SET DP013-DB2-ABEND                                 20290000
203000                               TO TRUE                            20300000
203100              PERFORM DP013-0000-PROCESS-ABEND                    20310000
203200             MOVE SQLCA        TO DP013-SQLCA                     20320000
203300             MOVE 'TIMCNPO '   TO DP013-DB2-TABLE-NAME (1)        20330000
203400             SET DP013-DB2-ABEND                                  20340000
203500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               20350000
203600             PERFORM DP013-0000-PROCESS-ABEND                     20360000
203700     END-EVALUATE.                                                20370000
203800                                                                  20380000
203900     IF  SQLCODE EQUAL +100                                       20390000
204000         SET ASC-NO-ITEMS-LEFT-ON-DB                              20400000
204100                                   TO TRUE                        20410000
204200     END-IF.                                                      20420000
204300                                                                  20430000
204400 EJECT                                                            20440000
204500*----------------------------------------------------------------*20450000
204600*    FORMAT THE DB2 DATE TO MM/DD/YY.                            *20460000
204700*----------------------------------------------------------------*20470000
204800 4320-FORMAT-DATE.                                                20480000
204900                                                                  20490000
205000     MOVE PV-DB-MM          TO  PV-DD-MM.                         20500000
205100     MOVE PV-DB-DD          TO  PV-DD-DD.                         20510000
205200     MOVE PV-DB-YY          TO  PV-DD-YY.                         20520000
205300                                                                  20530000
205400 EJECT                                                            20540000
205500*----------------------------------------------------------------*20550000
205600*   CHECK FOR TRIP-TYPE-CODE AND MOVE FOB CODE                   *20560000
205700*----------------------------------------------------------------*20570000
205800*4340-FOB-CDE-CHECK.                                              20580000
205900*                                                                 20590000
206000*    EVALUATE TRUE                                                20600000
206100*         WHEN  ((PV-FDR-TRIP-TYP-CDE  = 'A') OR                  20610000
206200*               (PV-MOM-TRIP-TYP-CDE  = 'A'))                     20620000
206300*               IF PV-FDR-FOB-CDE = SPACES                        20630000
206400*                  MOVE PV-MOM-FOB-CDE TO ASC-FOB                 20640000
206500*                                      (ASC-BLK-SUB ASC-ITEM-SUB) 20650000
206600*               ELSE                                              20660000
206700*                  MOVE PV-FDR-FOB-CDE TO ASC-FOB                 20670000
206800*                                      (ASC-BLK-SUB ASC-ITEM-SUB) 20680000
206900*               END-IF                                            20690000
207000*                                                                 20700000
207100*         WHEN  ((PV-FDR-TRIP-TYP-CDE  = 'O' OR 'M') OR           20710000
207200*               (PV-MOM-TRIP-TYP-CDE  = 'O' OR 'M'))              20720000
207300*               IF PV-FDR-FOB-CDE = SPACES                        20730000
207400*                  PERFORM 4360-SELECT-MOM-FOB-CDE                20740000
207500*               ELSE                                              20750000
207600*                  PERFORM 4370-SELECT-FDR-FOB-CDE                20760000
207700*               END-IF                                            20770000
207800*               MOVE IMFOB-FOB-CDE      TO ASC-FOB                20780000
207900*                                      (ASC-BLK-SUB ASC-ITEM-SUB) 20790000
208000*                                                                 20800000
208100*         WHEN  OTHER                                             20810000
208200*               MOVE SPACES             TO ASC-FOB                20820000
208300*                                      (ASC-BLK-SUB ASC-ITEM-SUB) 20830000
208400*    END-EVALUATE.                                                20840000
208500*EJECT                                                            20850000
208600*----------------------------------------------------------------*20860000
208700*   CHECK FOR TRIP-TYPE-CODE AND MOVE POE CODE                   *20870000
208800*----------------------------------------------------------------*20880000
208900 4350-POE-CDE-CHECK.                                              20890000
209000                                                                  20900000
209100     EVALUATE TRUE                                                20910000
209700          WHEN  PV-MOM-TRIP-TYP-CDE  = 'O' OR 'M' OR 'A'          20970000
209800                PERFORM 4380-OPEN-POE-CURSOR                      20980000
209900                PERFORM 4384-FETCH-POE-CURSOR                     20990000
210000                PERFORM 4382-CLOSE-POE-CURSOR                     21000000
210100                MOVE IMPOE-POE-CDE      TO ASC-POE                21010000
210200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21020000
210201                                                                  21020100
210202          WHEN  OTHER                                             21020200
210300                MOVE SPACES             TO ASC-POE                21030000
210400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21040000
210500     END-EVALUATE.                                                21050000
210600                                                                  21060000
210700 EJECT                                                            21070000
210800*----------------------------------------------------------------*21080000
210900*      SELECT MOM FOB CODE FROM TIMFOB                           *21090000
211000*----------------------------------------------------------------*21100000
211100 4360-SELECT-MOM-FOB-CDE.                                         21110000
211200                                                                  21120000
211300     EXEC SQL                                                     21130000
211400         SELECT DISTINCT                                          21140000
211500                A.FOB_CDE                                         21150000
211600         INTO  :IMFOB-FOB-CDE                                     21160000
211700         FROM   TIMFOB A                                          21170000
211800         WHERE  A.FOB_STD_EDI_CDE = :PV-MOM-FOB-CDE               21180000
211900           AND  A.STAT_CDE        = 'A'                           21190000
212000     END-EXEC.                                                    21200000
212100                                                                  21210000
212200     EVALUATE TRUE                                                21220000
212300         WHEN SQLCODE = ZERO                                      21230000
212400              CONTINUE                                            21240000
212500         WHEN SQLCODE = +100                                      21250000
212600         WHEN SQLCODE = -811                                      21260000
212700              MOVE SPACES      TO IMFOB-FOB-CDE                   21270000
212800         WHEN SQLWARN0 NOT = SPACE                                21280000
212900         WHEN SQLCODE NOT = ZERO                                  21290000
213000              MOVE '4360-SELECT-MOM-FOB-CDE'                      21300000
213100                               TO DP013-PARAGRAPH                 21310000
213200              MOVE 'SQL ERROR SELECTING MOM FOB CODE'             21320000
213300                               TO DP013-MESSAGE-TEXT (1)          21330000
213400              MOVE SQLCA       TO DP013-SQLCA                     21340000
213500              SET DP013-DB2-ABEND                                 21350000
213600                               TO TRUE                            21360000
213700              PERFORM DP013-0000-PROCESS-ABEND                    21370000
213800     END-EVALUATE.                                                21380000
213900                                                                  21390000
214000 EJECT                                                            21400000
214100*----------------------------------------------------------------*21410000
214200*      SELECT FDR FOB CODE FROM TIMFOB                           *21420000
214300*----------------------------------------------------------------*21430000
214400 4370-SELECT-FDR-FOB-CDE.                                         21440000
214500                                                                  21450000
214600     EXEC SQL                                                     21460000
214700         SELECT DISTINCT                                          21470000
214800                A.FOB_CDE                                         21480000
214900         INTO  :IMFOB-FOB-CDE                                     21490000
215000         FROM   TIMFOB A                                          21500000
215100         WHERE  A.FOB_STD_EDI_CDE = :PV-FDR-FOB-CDE               21510000
215200           AND  A.STAT_CDE        = 'A'                           21520000
215300     END-EXEC.                                                    21530000
215400                                                                  21540000
215500     EVALUATE TRUE                                                21550000
215600         WHEN SQLCODE = ZERO                                      21560000
215700              CONTINUE                                            21570000
215800         WHEN SQLCODE = +100                                      21580000
215900         WHEN SQLCODE = -811                                      21590000
216000              MOVE SPACES      TO IMFOB-FOB-CDE                   21600000
216100         WHEN SQLWARN0 NOT = SPACE                                21610000
216200         WHEN SQLCODE NOT = ZERO                                  21620000
216300              MOVE '4370-SELECT-FDR-FOB-CDE'                      21630000
216400                               TO DP013-PARAGRAPH                 21640000
216500              MOVE 'SQL ERROR SELECTING FDR FOB CODE'             21650000
216600                               TO DP013-MESSAGE-TEXT (1)          21660000
216700              MOVE SQLCA       TO DP013-SQLCA                     21670000
216800              SET DP013-DB2-ABEND                                 21680000
216900                               TO TRUE                            21690000
217000              PERFORM DP013-0000-PROCESS-ABEND                    21700000
217100     END-EVALUATE.                                                21710000
217200                                                                  21720000
217300 EJECT                                                            21730000
217400*----------------------------------------------------------------*21740000
217500*   OPEN THE POE CODE CURSOR                                     *21750000
217600*----------------------------------------------------------------*21760000
217700 4380-OPEN-POE-CURSOR.                                            21770000
217800                                                                  21780000
217900     PERFORM                                                      21790000
218000         WITH TEST AFTER                                          21800000
218100         VARYING PV-RETRY-COUNTER                                 21810000
218200         FROM 1 BY 1                                              21820000
218300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21830000
218400                   OR (SQLCODE = ZERO))                           21840000
218500                                                                  21850000
218600         MOVE 'CURSOR:  POE-CSR'     TO DP013-MESSAGE-TEXT (2)    21860000
218700                                                                  21870000
218800         EXEC SQL                                                 21880000
218900              OPEN POE-CSR                                        21890000
219000         END-EXEC                                                 21900000
219100                                                                  21910000
219200         EVALUATE TRUE                                            21920000
219300             WHEN SQLCODE = ZERO                                  21930000
219400             WHEN SQLCODE = -904                                  21940000
219500             WHEN SQLCODE = -913                                  21950000
219600                 CONTINUE                                         21960000
219700             WHEN SQLWARN0 NOT = SPACES                           21970000
219800             WHEN SQLCODE < ZERO                                  21980000
219900             WHEN SQLCODE > ZERO                                  21990000
220000                 MOVE '4380-OPEN-POE-CURSOR'                      22000000
220100                                   TO DP013-PARAGRAPH             22010000
220200                 MOVE 'OPEN POE CURSOR - '                        22020000
220300                                   TO DP013-MESSAGE-TEXT (1)      22030000
220400                 MOVE SQLCA        TO DP013-SQLCA                 22040000
220500                 MOVE 'TIMPOE  '   TO DP013-DB2-TABLE-NAME (1)    22050000
220600                 SET DP013-DB2-ABEND                              22060000
220700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           22070000
220800                 PERFORM DP013-0000-PROCESS-ABEND                 22080000
220900         END-EVALUATE                                             22090000
221000     END-PERFORM.                                                 22100000
221100                                                                  22110000
221200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        22120000
221300         MOVE '4382-OPEN-POE-CURSOR' TO DP013-PARAGRAPH           22130000
221400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   22140000
221500                                   TO DP013-MESSAGE-TEXT (1)      22150000
221600         MOVE SQLCA                TO DP013-SQLCA                 22160000
221700         MOVE 'TIMPOE  '           TO DP013-DB2-TABLE-NAME (1)    22170000
221800         SET DP013-DB2-ABEND                                      22180000
221900             DP013-XCTL-DISPLAY-RESTART                           22190000
222000                                   TO TRUE                        22200000
222100         PERFORM DP013-0000-PROCESS-ABEND                         22210000
222200     END-IF.                                                      22220000
222300                                                                  22230000
222400 EJECT                                                            22240000
222500*----------------------------------------------------------------*22250000
222600*   CLOSE THE POE CODE CURSOR                                    *22260000
222700*----------------------------------------------------------------*22270000
222800 4382-CLOSE-POE-CURSOR.                                           22280000
222900                                                                  22290000
223000     EXEC SQL                                                     22300000
223100          CLOSE POE-CSR                                           22310000
223200     END-EXEC.                                                    22320000
223300                                                                  22330000
223400     EVALUATE TRUE                                                22340000
223500         WHEN SQLCODE = ZERO                                      22350000
223600             CONTINUE                                             22360000
223700         WHEN SQLWARN0 NOT = SPACES                               22370000
223800         WHEN SQLCODE < ZERO                                      22380000
223900         WHEN SQLCODE > ZERO                                      22390000
224000             MOVE '4382-CLOSE-POE-CURSOR'                         22400000
224100                               TO DP013-PARAGRAPH                 22410000
224200             MOVE 'CLOSE POE CURSOR '                             22420000
224300                               TO DP013-MESSAGE-TEXT (1)          22430000
224400             MOVE SQLCA        TO DP013-SQLCA                     22440000
224500             MOVE 'TIMPOE  '   TO DP013-DB2-TABLE-NAME (1)        22450000
224600             SET DP013-DB2-ABEND                                  22460000
224700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               22470000
224800             PERFORM DP013-0000-PROCESS-ABEND                     22480000
224900     END-EVALUATE.                                                22490000
225000                                                                  22500000
225001 EJECT                                                            22500100
225002*----------------------------------------------------------------*22500200
225003*    FETCH THE POE CODE CURSOR                                   *22500300
225004*----------------------------------------------------------------*22500400
225005 4384-FETCH-POE-CURSOR.                                           22500500
225006                                                                  22500600
225007     EXEC SQL                                                     22500700
225008          FETCH POE-CSR                                           22500800
225009          INTO  :IMPOE-POE-CDE                                    22500900
225010     END-EXEC.                                                    22501000
225011                                                                  22501100
225012     EVALUATE TRUE                                                22501200
225013         WHEN SQLCODE = ZERO                                      22501300
225014         WHEN SQLCODE = -811                                      22501400
225015              CONTINUE                                            22501500
225016         WHEN SQLCODE = +100                                      22501600
225017              MOVE SPACES TO IMPOE-POE-CDE                        22501700
225018         WHEN SQLWARN0 NOT = SPACE                                22501800
225019         WHEN SQLCODE NOT = ZERO                                  22501900
225020              MOVE '4384-FETCH-POE-CURSOR'                        22502000
225021                               TO DP013-PARAGRAPH                 22502100
225022              MOVE 'FETCH POE CURSOR'                             22502200
225023                               TO DP013-MESSAGE-TEXT (1)          22502300
225024              MOVE SQLCA       TO DP013-SQLCA                     22502400
225025              SET DP013-DB2-ABEND                                 22502500
225026                               TO TRUE                            22502600
225027              PERFORM DP013-0000-PROCESS-ABEND                    22502700
225028     END-EVALUATE.                                                22502800
225029                                                                  22502900
225030 EJECT                                                            22503000
225031*----------------------------------------------------------------*22503100
225032*      SELECT DEVAN DATE FROM TSHIPST                            *22503200
225033*----------------------------------------------------------------*22503300
225034 4390-SELECT-DEVAN-DATE.                                          22503400
225035                                                                  22503500
225036     EXEC SQL                                                     22503600
225037         SELECT DISTINCT                                          22503700
225038                A.SHIPT_STATUS_CDE                                22503800
225039               ,A.STATUS_DTE                                      22503900
225040         INTO   :SHIPST-SHIPT-STATUS-CDE                          22504000
225041               ,:SHIPST-STATUS-DTE                                22504100
225042         FROM   TSHIPST A                                         22504200
225043               ,TSHPTPO B                                         22504300
225044               ,TVHTRIP C                                         22504400
225045               ,TSHIPMT D                                         22504500
225046         WHERE  B.PO_NBR        = :DK-PO-NBR                      22504600
225047           AND  B.SHIPT_ID      = :PV-SHIPT-ID                    22504700
225048           AND  B.SHIPT_ID      = A.SHIPT_ID                      22504800
225049           AND  D.SHIPT_ID      = A.SHIPT_ID                      22504900
225050           AND  D.TRIP_ID       = C.TRIP_ID                       22505000
225051           AND  C.TRIP_ID       = :PV-TRIP-ID-N                   22505100
225052           AND  A.SHIPT_STATUS_CDE = 'AM'                         22505200
225053     END-EXEC.                                                    22505300
225054                                                                  22505400
225055     EVALUATE TRUE                                                22505500
225056         WHEN SQLCODE = ZERO                                      22505600
225057              MOVE SHIPST-STATUS-DTE(9:2)  TO PV-DEVAN-DAY        22505700
225058              MOVE SHIPST-STATUS-DTE(6:2)  TO PV-DEVAN-MONTH      22505800
225059              MOVE '/'                     TO PV-DEVAN-SLASH      22505900
225060              MOVE PV-DEVAN-DATE           TO ASC-DEVAN           22506000
225061                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22506100
225062         WHEN SQLCODE = +100                                      22506200
225063              MOVE SPACES TO ASC-DEVAN                            22506300
225064                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22506400
225065         WHEN SQLWARN0 NOT = SPACE                                22506500
225066         WHEN SQLCODE NOT = ZERO                                  22506600
225067              MOVE '4390-SELECT-DEVAN-DATE'                       22506700
225068                               TO DP013-PARAGRAPH                 22506800
225069              MOVE 'SQL ERROR SELECTING DEVAN DATE'               22506900
225070                               TO DP013-MESSAGE-TEXT (1)          22507000
225071              MOVE SQLCA       TO DP013-SQLCA                     22507100
225072              MOVE 'TSHIPST '   TO DP013-DB2-TABLE-NAME (1)       22507200
225073              SET DP013-DB2-ABEND                                 22507300
225074                               TO TRUE                            22507400
225075              PERFORM DP013-0000-PROCESS-ABEND                    22507500
225100     END-EVALUATE.                                                22510000
225200                                                                  22520000
225300 EJECT                                                            22530000
225301*----------------------------------------------------------------*22530121
225302*      SELECT SPLT TO DCONSL DATE FROM TIMCNRL                   *22530200
225303*----------------------------------------------------------------*22530300
225304 4391-SELECT-SPLT-TO-DCONSL-DTE.                                  22530400
225305                                                                  22530500
225306         INITIALIZE IMCNRL-DCONSLR-ACTL-DTE.                      22530621
225307         EXEC SQL                                                 22530721
225308             SELECT DCONSLR_ACTL_DTE                              22530821
225309             INTO  :IMCNRL-DCONSLR-ACTL-DTE                       22530921
225310                   :PV-IMCNRL-ACTL-DT-NULL                        22531021
225320             FROM   TIMCNRL                                       22532021
281800             WHERE  PO_NBR           = :DK-PO-NBR                 28180000
281900             AND    CONTNR_ID        = :PV-CONTNR-NBR             28190021
281901             AND    CONTNR_SEQ_NBR   = :PV-CONTNR-SEQ-NBR         28190121
281902             AND    (DCONSLR_RLSE_CDE = 'R'  OR                   28190200
282000                     DCONSLR_RLSE_CDE = 'Y')                      28200000
282001             AND    DATE(DCONSLR_ACTL_DTE)   <>                   28200121
282002                                '9999-09-09'                      28200221
282003         END-EXEC                                                 28200321
282004                                                                  28200421
282005     EVALUATE TRUE                                                28200500
282006         WHEN SQLCODE = ZERO                                      28200600
282007            IF  PV-IMCNRL-ACTL-DT-NULL = 0                        28200721
282008              MOVE IMCNRL-DCONSLR-ACTL-DTE(9:2)                   28200800
282009                                           TO PV-SPLDC-DAY        28200900
282010              MOVE IMCNRL-DCONSLR-ACTL-DTE(6:2)                   28201000
282011                                           TO PV-SPLDC-MONTH      28201100
282012              MOVE '/'                     TO PV-SPLDC-SLASH      28201200
282013              MOVE PV-SPLDC-DATE           TO ASC-SPLDC           28201300
282014                                       (ASC-BLK-SUB ASC-ITEM-SUB) 28201400
282015              PERFORM 4393-GET-TAUCNRL-DATE                       28201521
282016           ELSE                                                   28201621
282017              MOVE '9998-09-08' TO IMCNRL-DCONSLR-ACTL-DTE        28201721
282018           END-IF                                                 28201821
282019         WHEN SQLCODE = +100                                      28201900
282020              MOVE '9998-09-08' TO IMCNRL-DCONSLR-ACTL-DTE        28202021
282021              PERFORM 4393-GET-TAUCNRL-DATE                       28202121
282022***           MOVE SPACES TO ASC-SPLDC                            28202200
282023***                                    (ASC-BLK-SUB ASC-ITEM-SUB) 28202300
282024         WHEN SQLCODE = -811                                      28202400
282025              PERFORM 4392-GET-EARLIEST-DATE                      28202500
282026         WHEN SQLWARN0 NOT = SPACE                                28202600
282027         WHEN SQLCODE NOT = ZERO                                  28202700
282028              MOVE '4391-SELECT-SPLT-TO-DCONSL-DTE'               28202800
282029                               TO DP013-PARAGRAPH                 28202900
282030              MOVE 'SQL ERROR SELECTING SPLDC DATE'               28203000
282031                               TO DP013-MESSAGE-TEXT (1)          28203100
282032              MOVE SQLCA       TO DP013-SQLCA                     28203200
282033              MOVE 'TIMCNRL '   TO DP013-DB2-TABLE-NAME (1)       28203300
282034              SET DP013-DB2-ABEND                                 28203400
282035                               TO TRUE                            28203500
282036              PERFORM DP013-0000-PROCESS-ABEND                    28203600
282037     END-EVALUATE.                                                28203700
282038                                                                  28203800
282039     PERFORM 4393-GET-TAUCNRL-DATE.                               28203921
282040 EJECT                                                            28204000
282041*----------------------------------------------------------------*28204100
282042*      SELECT EARLIEST DATE FROM TIMCNRL AND/OR TAUCNRL          *28204200
282043*----------------------------------------------------------------*28204300
282044 4392-GET-EARLIEST-DATE.                                          28204400
282045                                                                  28204500
282046         INITIALIZE IMCNRL-DCONSLR-ACTL-DTE                       28204621
282047                    PV-SHPT-SPL-SNT-DT-NULL.                      28204721
282048         EXEC SQL                                                 28204821
282049             SELECT MIN(DATE(DCONSLR_ACTL_DTE))                   28204921
282050             INTO  :IMCNRL-DCONSLR-ACTL-DTE                       28205021
282051                   :PV-SHPT-SPL-SNT-DT-NULL                       28205121
282052             FROM   TIMCNRL                                       28205221
282053             WHERE  PO_NBR           = :DK-PO-NBR                 28205300
282054             AND    CONTNR_ID        = :PV-CONTNR-NBR             28205421
282055             AND    CONTNR_SEQ_NBR   = :PV-CONTNR-SEQ-NBR         28205521
282056             AND    (DCONSLR_RLSE_CDE = 'R'  OR                   28205600
282057                     DCONSLR_RLSE_CDE = 'Y')                      28205700
282058             AND    DATE(DCONSLR_ACTL_DTE)   <>                   28205821
282059                                '9999-09-09'                      28205921
282060         END-EXEC.                                                28206021
282061                                                                  28206121
282062     EVALUATE TRUE                                                28206200
282063         WHEN SQLCODE = ZERO                                      28206300
282064            IF PV-SHPT-SPL-SNT-DT-NULL = 0                        28206421
282065              MOVE IMCNRL-DCONSLR-ACTL-DTE(9:2)                   28206500
282066                                           TO PV-SPLDC-DAY        28206600
282067              MOVE IMCNRL-DCONSLR-ACTL-DTE(6:2)                   28206700
282068                                           TO PV-SPLDC-MONTH      28206800
282069              MOVE '/'                     TO PV-SPLDC-SLASH      28206900
282070              MOVE PV-SPLDC-DATE           TO ASC-SPLDC           28207000
282080                                       (ASC-BLK-SUB ASC-ITEM-SUB) 28208000
282081            ELSE                                                  28208121
282082              MOVE SPACES TO ASC-SPLDC                            28208200
282083                                       (ASC-BLK-SUB ASC-ITEM-SUB) 28208300
282084            END-IF                                                28208421
282085         WHEN SQLCODE = +100                                      28208500
282086              MOVE SPACES TO ASC-SPLDC                            28208600
282087                                       (ASC-BLK-SUB ASC-ITEM-SUB) 28208700
282088         WHEN SQLWARN0 NOT = SPACE                                28208800
282089         WHEN SQLCODE NOT = ZERO                                  28208900
282090              MOVE '4392-GET-EARLIEST-DATE'                       28209000
282091                               TO DP013-PARAGRAPH                 28209100
282092              MOVE 'SQL ERROR SELECTING SPLDC DATE'               28209200
282093                               TO DP013-MESSAGE-TEXT (1)          28209300
282094              MOVE SQLCA       TO DP013-SQLCA                     28209400
282095              MOVE 'TIMCNRL '   TO DP013-DB2-TABLE-NAME (1)       28209500
282096              SET DP013-DB2-ABEND                                 28209600
282097                               TO TRUE                            28209700
282098              PERFORM DP013-0000-PROCESS-ABEND                    28209800
282099     END-EVALUATE.                                                28209900
282100                                                                  28210000
282101**** PERFORM 4393-GET-TAUCNRL-DATE.                               28210121
282102*----------------------------------------------------------------*28210200
282103*      SELECT EARLIEST DATE FROM TAUCNRL                         *28210300
282104*----------------------------------------------------------------*28210400
282105 4393-GET-TAUCNRL-DATE.                                           28210500
282106         INITIALIZE AUCNRL-DCONSLR-ACTL-DTE                       28210621
282107                    PV-SHPT-SPL-AUD-DT-NULL.                      28210721
282108         EXEC SQL                                                 28210821
282109             SELECT MIN(DATE(DCONSLR_ACTL_DTE))                   28210921
282110             INTO  :AUCNRL-DCONSLR-ACTL-DTE                       28211021
282111                   :PV-SHPT-SPL-AUD-DT-NULL                       28211121
282112             FROM   TAUCNRL                                       28211221
282113             WHERE  PO_NBR           = :DK-PO-NBR                 28211300
282114             AND    CONTNR_ID        = :PV-CONTNR-NBR             28211421
282115             AND    CONTNR_SEQ_NBR   = :PV-CONTNR-SEQ-NBR         28211521
282116             AND    (DCONSLR_RLSE_CDE = 'R'  OR                   28211600
282117                     DCONSLR_RLSE_CDE = 'Y')                      28211700
282118             AND    DATE(DCONSLR_ACTL_DTE)   <>                   28211821
282119                                '9999-09-09'                      28211921
282120         END-EXEC.                                                28212021
282121                                                                  28212121
282122     EVALUATE TRUE                                                28212200
282123         WHEN SQLCODE = ZERO                                      28212300
282124            IF PV-SHPT-SPL-AUD-DT-NULL = 0                        28212421
282125              IF AUCNRL-DCONSLR-ACTL-DTE < IMCNRL-DCONSLR-ACTL-DTE28212521
282126                  MOVE AUCNRL-DCONSLR-ACTL-DTE(9:2)               28212600
282127                                               TO PV-SPLDC-DAY    28212700
282128                  MOVE AUCNRL-DCONSLR-ACTL-DTE(6:2)               28212800
282129                                               TO PV-SPLDC-MONTH  28212900
282130                  MOVE '/'                 TO PV-SPLDC-SLASH      28213000
282131                  MOVE PV-SPLDC-DATE       TO ASC-SPLDC           28213100
282132                                       (ASC-BLK-SUB ASC-ITEM-SUB) 28213200
282133               END-IF                                             28213321
282134            END-IF                                                28213421
282135         WHEN SQLCODE = +100                                      28213500
282136            CONTINUE                                              28213621
282137         WHEN SQLWARN0 NOT = SPACE                                28213700
282138         WHEN SQLCODE NOT = ZERO                                  28213800
282139              MOVE '4392-GET-EARLIEST-DATE'                       28213900
282140                               TO DP013-PARAGRAPH                 28214000
282141              MOVE 'SQL ERROR SELECTING SPLDC DATE'               28214100
282142                               TO DP013-MESSAGE-TEXT (1)          28214200
282143              MOVE SQLCA       TO DP013-SQLCA                     28214300
282144              MOVE 'TAUCNRL '   TO DP013-DB2-TABLE-NAME (1)       28214400
282145              SET DP013-DB2-ABEND                                 28214500
282146                               TO TRUE                            28214600
282147              PERFORM DP013-0000-PROCESS-ABEND                    28214700
282148     END-EVALUATE.                                                28214800
282149                                                                  28214900
282150                                                                  28215000
282151 EJECT                                                            28215100
282152*----------------------------------------------------------------*28215200
282153* CHECK FOR DEFAULT VALUES AND MOVE SPACES TO LEAVE FIELD        *28215300
282154* BLANK ON SCREEN OR MOVE MONTH AND DAY MM/DD TO ASC-COMMAREA    *28215400
282155* TO MOVE OUT TO SCREEN.                                         *28215500
282156*----------------------------------------------------------------*28215600
282157 4395-MOVE-CONT-DATES-TO-COMM.                                    28215700
282158                                                                  28215800
282159     IF PV-DO-RCVD-TMST (1:4)       = PC-0001                     28215921
282160         MOVE SPACES               TO ASC-RCVD                    28216021
282161                             (ASC-BLK-SUB ASC-ITEM-SUB)           28216121
282162     ELSE                                                         28216221
282163         IF ((PV-DO-RCVD-TMST (1:4) > PC-0001)                    28216321
282164             AND (PV-DO-RCVD-CDE = 'Y'))                          28216421
282165                 MOVE PV-DO-RCVD-TMST (6:2)                       28216521
282166                                   TO PV-DO-RCVD-MONTH            28216621
282167                 MOVE '/'          TO PV-DO-RCVD-SLASH            28216721
282168                 MOVE PV-DO-RCVD-TMST (9:2)                       28216821
282169                                   TO PV-DO-RCVD-DAY              28216921
282170                 MOVE PV-DO-RCVD-DATE                             28217021
282171                                   TO ASC-RCVD                    28217121
282172                               (ASC-BLK-SUB ASC-ITEM-SUB)         28217221
282173           ELSE                                                   28217321
282174               IF ((PV-DO-RCVD-TMST (1:4) > PC-0001)              28217421
282175                 AND (PV-DO-RCVD-CDE NOT = 'Y'))                  28217521
282176                     MOVE SPACES   TO ASC-RCVD                    28217621
282177                               (ASC-BLK-SUB ASC-ITEM-SUB)         28217721
282178               END-IF                                             28217821
282179           END-IF                                                 28217921
282180     END-IF.                                                      28218021
282181                                                                  28218121
282182     IF PV-BKR-FRGT-RLSE-TMST (1:4) = PC-0001                     28218221
282183         MOVE SPACES               TO ASC-RLSD                    28218321
282184                               (ASC-BLK-SUB ASC-ITEM-SUB)         28218421
282185     ELSE                                                         28218521
282186         IF ((PV-BKR-FRGT-RLSE-TMST (1:4) > PC-0001)              28218621
282187             AND (PV-BKR-FRGT-RLSE-CDE = 'Y'))                    28218721
282188                 MOVE PV-BKR-FRGT-RLSE-TMST (6:2)                 28218821
282189                                   TO PV-CONT-RLSD-MONTH          28218921
282190                 MOVE '/'          TO PV-CONT-RLSD-SLASH          28219021
282191                 MOVE PV-BKR-FRGT-RLSE-TMST (9:2)                 28219121
282192                                   TO PV-CONT-RLSD-DAY            28219221
282193                 MOVE PV-CONT-RLSD-DATE                           28219321
282194                                   TO ASC-RLSD                    28219421
282195                               (ASC-BLK-SUB ASC-ITEM-SUB)         28219521
282196         ELSE                                                     28219621
282197             IF ((PV-BKR-FRGT-RLSE-TMST (1:4) > PC-0001)          28219721
282198                 AND (PV-BKR-FRGT-RLSE-CDE NOT = 'Y'))            28219821
282199                     MOVE SPACES TO ASC-RLSD                      28219921
282200                             (ASC-BLK-SUB ASC-ITEM-SUB)           28220021
282201             END-IF                                               28220121
282202         END-IF                                                   28220221
282203     END-IF.                                                      28220321
282204                                                                  28220421
282205     IF PV-CONTNR-PU-TMST (1:4) = PC-0001                         28220521
282206         MOVE SPACES               TO ASC-PCKUP                   28220621
282207                                 (ASC-BLK-SUB ASC-ITEM-SUB)       28220721
282208     ELSE                                                         28220821
282209         IF ((PV-CONTNR-PU-TMST (1:4) > PC-0001)                  28220921
282210             AND (PV-CONTNR-PU-CDE = 'Y'))                        28221021
282211                 MOVE PV-CONTNR-PU-TMST (6:2)                     28221121
282212                                   TO PV-CONT-PCKUP-MONTH         28221221
282213                 MOVE '/'          TO PV-CONT-PCKUP-SLASH         28221321
282214                 MOVE PV-CONTNR-PU-TMST (9:2)                     28221421
282215                                   TO PV-CONT-PCKUP-DAY           28221521
282216                 MOVE PV-CONT-PCKUP-DATE                          28221621
282217                                   TO ASC-PCKUP                   28221721
282218                               (ASC-BLK-SUB ASC-ITEM-SUB)         28221821
282219         ELSE                                                     28221921
282220             IF ((PV-CONTNR-PU-TMST (1:4) > PC-0001)              28222021
282221                 AND (PV-CONTNR-PU-CDE NOT = 'Y'))                28222121
282222                     MOVE SPACES   TO ASC-PCKUP                   28222221
282223                               (ASC-BLK-SUB ASC-ITEM-SUB)         28222321
282224             END-IF                                               28222421
282225         END-IF                                                   28222521
282226     END-IF.                                                      28222621
282227                                                                  28222721
282228     IF PV-DVN-TMST (1:4) = PC-0001                               28222821
282229         MOVE SPACES               TO ASC-DEVAN                   28222921
282230                                 (ASC-BLK-SUB ASC-ITEM-SUB)       28223021
282231     ELSE                                                         28223121
282232         IF ((PV-DVN-TMST (1:4) > PC-0001)                        28223221
282233             AND (PV-DVN-CDE = 'Y'))                              28223321
282234                 MOVE PV-DVN-TMST (6:2)                           28223421
282235                                   TO PV-DEVAN-MONTH              28223521
282236                 MOVE '/'          TO PV-DEVAN-SLASH              28223621
282237                 MOVE PV-DVN-TMST (9:2)                           28223721
282238                                   TO PV-DEVAN-DAY                28223821
282239                 MOVE PV-DEVAN-DATE                               28223921
282240                                   TO ASC-DEVAN                   28224021
282241                               (ASC-BLK-SUB ASC-ITEM-SUB)         28224121
282242         ELSE                                                     28224221
282243             IF ((PV-DVN-TMST (1:4) > PC-0001)                    28224321
282244                 AND (PV-DVN-CDE NOT = 'Y'))                      28224421
282245                     MOVE SPACES   TO ASC-DEVAN                   28224521
282246                               (ASC-BLK-SUB ASC-ITEM-SUB)         28224621
282247             END-IF                                               28224721
282248         END-IF                                                   28224821
282249     END-IF.                                                      28224921
282250                                                                  28225021
282251     IF PV-DCONSLR-RTN-TMST(1:4) = PC-0001                        28225121
282252         MOVE SPACES               TO ASC-RTN                     28225221
282253                              (ASC-BLK-SUB ASC-ITEM-SUB)          28225321
282254     ELSE                                                         28225421
282255         IF ((PV-DCONSLR-RTN-TMST (1:4) > PC-0001)                28225521
282256             AND (PV-DCONSLR-RET-CDE = 'Y'))                      28225621
282257                 MOVE PV-DCONSLR-RTN-TMST(6:2)                    28225721
282258                                   TO PV-CONT-RTN-MONTH           28225821
282259                 MOVE '/'          TO PV-CONT-RTN-SLASH           28225921
282260                 MOVE PV-DCONSLR-RTN-TMST(9:2)                    28226021
282261                                   TO PV-CONT-RTN-DAY             28226121
282262                 MOVE PV-CONT-RTN-DATE                            28226221
282263                                   TO ASC-RTN                     28226321
282264                               (ASC-BLK-SUB ASC-ITEM-SUB)         28226421
282265         ELSE                                                     28226521
282266             IF ((PV-DCONSLR-RTN-TMST (1:4) > PC-0001)            28226621
282267                 AND (PV-DCONSLR-RET-CDE NOT = 'Y'))              28226721
282268                     MOVE SPACES   TO ASC-RTN                     28226821
282269                               (ASC-BLK-SUB ASC-ITEM-SUB)         28226921
282270             END-IF                                               28227021
282271         END-IF                                                   28227121
282272     END-IF.                                                      28227221
282273 EJECT                                                            28227300
282274*----------------------------------------------------------------*28227400
282275*      SELECT CUSTOMS ENTRY ID FROM TIMCSCN.                     *28227500
282276*----------------------------------------------------------------*28227600
282277 4397-SELECT-CUSTOMS-ENTRY.                                       28227700
282278                                                                  28227800
282279     EXEC SQL                                                     28227900
282280         SELECT DISTINCT                                          28228000
282281                A.CSTM_ENTR_ID                                    28228100
282282         INTO   :IMCSCN-CSTM-ENTR-ID                              28228200
282283         FROM   TIMCSCN A                                         28228300
282284               ,TIMCSPO B                                         28228400
282285         WHERE  A.CONTNR_ID     = :PV-CONTNR-NBR                  28228500
282286           AND  B.PO_NBR        = :DK-PO-NBR                      28228600
282287           AND  A.CSTM_ENTR_ID  = B.CSTM_ENTR_ID                  28228700
282288           AND  A.CSTM_ENTR_ID  = :PV-CSTM-ENTR-ID                28228821
282289     END-EXEC.                                                    28228900
282290                                                                  28229000
282291     EVALUATE TRUE                                                28229100
282292         WHEN SQLCODE = ZERO                                      28229200
282293              MOVE IMCSCN-CSTM-ENTR-ID TO ASC-CSTM-ENTRY          28229300
282294                                       (ASC-BLK-SUB ASC-ITEM-SUB) 28229400
282295              IF PV-DO-TO-DCONSLR-TMST (1:4) = PC-0001            28229521
282296                  MOVE SPACES          TO ASC-ISUD                28229621
282297                                       (ASC-BLK-SUB ASC-ITEM-SUB) 28229721
282298              ELSE                                                28229821
282299                  MOVE PV-DO-TO-DCONSLR-TMST (6:2)                28229921
282300                                       TO PV-DO-ISSUED-MONTH      28230021
282400                  MOVE '/'             TO PV-DO-ISSUED-SLASH      28240021
282500                  MOVE PV-DO-TO-DCONSLR-TMST (9:2)                28250021
282600                                       TO PV-DO-ISSUED-DAY        28260021
282700                  MOVE PV-DO-ISSUED-DATE                          28270021
282800                                       TO ASC-ISUD                28280021
282900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 28290021
283000              END-IF                                              28300021
283001                                                                  28300121
283002         WHEN SQLCODE = +100                                      28300200
283003              MOVE SPACES TO ASC-CSTM-ENTRY                       28300300
283004                                       (ASC-BLK-SUB ASC-ITEM-SUB) 28300400
283005              MOVE SPACES TO ASC-ISUD                             28300521
283006                                       (ASC-BLK-SUB ASC-ITEM-SUB) 28300621
283007                                                                  28300721
283008         WHEN SQLWARN0 NOT = SPACE                                28300800
283009         WHEN SQLCODE NOT = ZERO                                  28300900
283010              MOVE '4397-SELECT-CUSTOMS-ENTRY'                    28301000
283011                               TO DP013-PARAGRAPH                 28301100
283012              MOVE 'SQL ERROR SELECTING CUSTOMS ENTRY ID'         28301200
283013                               TO DP013-MESSAGE-TEXT (1)          28301300
283014              MOVE SQLCA       TO DP013-SQLCA                     28301400
283015              MOVE 'TIMCSCN '   TO DP013-DB2-TABLE-NAME (1)       28301500
283016              SET DP013-DB2-ABEND                                 28301600
283017                               TO TRUE                            28301700
283018              PERFORM DP013-0000-PROCESS-ABEND                    28301800
283019     END-EVALUATE.                                                28301900
283020                                                                  28302000
283021 EJECT                                                            28302100
283022*----------------------------------------------------------------*28302200
283023* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *28302300
283024*----------------------------------------------------------------*28302400
283025 4400-MOVE-COMMAREA-TO-SCREEN.                                    28302500
283026                                                                  28302600
283027     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             28302700
283028         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          28302800
283029         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          28302900
283030             MOVE +1    TO ASC-BLK-SUB                            28303000
283031             PERFORM 5100-WRITE-TEMP-STORAGE                      28303100
283032             ADD +1     TO ASC-BLK-SUB                            28303200
283033             PERFORM 5100-WRITE-TEMP-STORAGE                      28303300
283034             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             28303400
283035                 GIVING PV-BLOCK-NUMBER                           28303500
283036                 REMAINDER PV-REMAINDER                           28303600
283037             IF  PV-REMAINDER > ZERO                              28303700
283038                 ADD +1 TO PV-BLOCK-NUMBER                        28303800
283039             END-IF                                               28303900
283040             MOVE +1    TO ASC-BLK-SUB                            28304000
283041             PERFORM 4410-READ-TEMP-STORAGE                       28304100
283042             ADD +1     TO ASC-BLK-SUB                            28304200
283043                           PV-BLOCK-NUMBER                        28304300
283044             PERFORM 4410-READ-TEMP-STORAGE                       28304400
283045     END-IF.                                                      28304500
283046     MOVE +1            TO ASC-BLK-SUB.                           28304600
283047     COMPUTE ASC-ITEM-SUB =                                       28304700
283048         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              28304800
283049         + PC-ITEMS-PER-PANEL).                                   28304900
283050                                                                  28305000
283051     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        28305100
283052         ADD +1         TO ASC-BLK-SUB                            28305200
283053         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            28305300
283054     END-IF.                                                      28305400
283055                                                                  28305500
283056     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           28305600
283057         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                28305700
283058     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        28305800
283059     PERFORM 4420-FORMAT-LIST-LINES                               28305900
283060         VARYING PV-SUB                                           28306000
283061         FROM PC-ITEMS-PER-PANEL BY -1                            28306100
283062         UNTIL PV-SUB < +1.                                       28306200
283063                                                                  28306300
283064     COMPUTE ASC-ITEMS-DISPLAYED =                                28306400
283065         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          28306500
283066     PERFORM 4401-SELECT-PO-DETAILS.                              28306600
283067     PERFORM 4408-SELECT-SPLIT-DTE.                               28306700
283068     PERFORM 4402-SELECT-AD-DTE.                                  28306800
283069     PERFORM 4403-SELECT-VND-STYL.                                28306900
283070     MOVE SPACES TO ASC-OUTR-PACK-X.                              28307000
283071     MOVE 0 TO ASC-OUTR-PACK.                                     28307100
283072     PERFORM 4404-OPEN-OUTR-PCK-CSR.                              28307200
283073     PERFORM 4405-FETCH-OUTR-PCK.                                 28307300
283074     PERFORM 4406-CLOSE-OUTR-PCK-CSR.                             28307400
283075     PERFORM 4407-MOVE-PO-DTLS-TO-SCR.                            28307500
283076                                                                  28307600
283077     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    28307700
283078                                      ASTRTITO.                   28307800
283079     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    28307900
283080     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    28308000
283081     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            28308100
283082                                   TO ASELITO.                    28308200
283083                                                                  28308300
283084     IF ASC-DISPLAY-LINEHAUL                                      28308400
283085         MOVE PC-LINEHAUL-HEAD  TO AHEADO                         28308500
283086         MOVE PC-LINEHAUL-HEAD2 TO AHEAD2O                        28308600
283087     ELSE                                                         28308700
283088         MOVE PC-DECON-HEAD     TO AHEADO                         28308800
283089         MOVE PC-DECON-HEAD2    TO AHEAD2O                        28308900
283090     END-IF.                                                      28309000
283091                                                                  28309100
283092     IF  DP020-MSG-NUMBER-X = SPACE                               28309200
283093         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  28309300
283094*----------- MORE ITEMS TO DISPLAY --------                       28309400
283095             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            28309500
283096             SET DP020-MSG-INFORMATIONAL TO TRUE                  28309600
283097         END-IF                                                   28309700
283098     END-IF.                                                      28309800
283099                                                                  28309900
283100 EJECT                                                            28310000
283101*----------------------------------------------------------------*28310100
283102*    SELECT PO DETAILS.                                          *28310200
283103*----------------------------------------------------------------*28310300
283104 4401-SELECT-PO-DETAILS.                                          28310400
283105                                                                  28310500
283106     PERFORM                                                      28310600
283107         WITH TEST AFTER                                          28310700
283108         VARYING PV-RETRY-COUNTER                                 28310800
283109         FROM 1 BY 1                                              28310900
283110         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               28311000
283111            OR  (SQLCODE = ZERO)                                  28311100
283112            OR  (SQLCODE = +100))                                 28311200
283113                                                                  28311300
283114         EXEC SQL                                                 28311400
283115              SELECT A.DEPT_NBR,                                  28311500
283116                     A.OTB_PER_NBR,                               28311600
283117                     A.TOT_UNT_QTY,                               28311700
283118                     A.PROD_CNTRY_CDE,                            28311800
283119                     B.ENT_NAME_DESC,                             28311900
283120                     C.CAN_IFNOT_SHIP_DTE,                        28312000
283121                     C.EXT_CAN_DTE,                               28312100
283122                     C.STRT_FCTRY_DTE,                            28312200
283123                     C.LAST_FCTRY_DTE,                            28312300
283124                     C.DONT_SHIP_BEF_DTE,                         28312400
283125                     C.FOB_CDE,                                   28312500
283126                     C.POE_CDE                                    28312600
283127              INTO  :PURCHS-DEPT-NBR,                             28312700
283128                    :PURCHS-OTB-PER-NBR,                          28312800
283129                    :PURCHS-TOT-UNT-QTY,                          28312900
283130                    :PURCHS-PROD-CNTRY-CDE,                       28313000
283131                    :ENTNME-ENT-NAME-DESC,                        28313100
283132                    :PLNSHP-CAN-IFNOT-SHIP-DTE,                   28313200
283133                    :PLNSHP-EXT-CAN-DTE,                          28313300
283134                    :PLNSHP-STRT-FCTRY-DTE,                       28313400
283135                    :PLNSHP-LAST-FCTRY-DTE,                       28313500
283136                    :PLNSHP-DONT-SHIP-BEF-DTE,                    28313600
283137                    :PLNSHP-FOB-CDE,                              28313700
283138                    :PLNSHP-POE-CDE                               28313800
283139              FROM   TPURCHS A,                                   28313900
283140                     TENTNME B,                                   28314000
283141                     TPLNSHP C                                    28314100
283142              WHERE  A.PO_NBR         = :DK-PO-NBR                28314200
283143                AND  A.VER_STATUS_CDE = 'A'                       28314300
283144                AND  B.ENT_ID         =  A.ENT_ID                 28314400
283145                AND  B.TYPE_CDE       = '01'                      28314500
283146                AND  C.PO_NBR         =  A.PO_NBR                 28314600
283147                AND  C.VER_STATUS_CDE =  A.VER_STATUS_CDE         28314700
283148         END-EXEC                                                 28314800
283149                                                                  28314900
283150         EVALUATE TRUE                                            28315000
283151             WHEN SQLCODE = ZERO                                  28315100
283152             WHEN SQLCODE = +100                                  28315200
283153             WHEN SQLCODE = -904                                  28315300
283154             WHEN SQLCODE = -913                                  28315400
283155                 CONTINUE                                         28315500
283156             WHEN SQLWARN0 NOT = SPACES                           28315600
283157             WHEN SQLCODE < ZERO                                  28315700
283158             WHEN SQLCODE > ZERO                                  28315800
283159                 MOVE '4401-SELECT-PO-DETAILS'                    28315900
283160                                   TO DP013-PARAGRAPH             28316000
283161                 MOVE 'SQL ERROR SELECTING PO DETAILS'            28316100
283162                                   TO DP013-MESSAGE-TEXT (1)      28316200
283163                 MOVE SQLCA        TO DP013-SQLCA                 28316300
283164                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)    28316400
283165                 SET DP013-DB2-ABEND                              28316500
283166                     DP013-XCTL-DISPLAY-RESTART TO TRUE           28316600
283167                 PERFORM DP013-0000-PROCESS-ABEND                 28316700
283168         END-EVALUATE                                             28316800
283169     END-PERFORM.                                                 28316900
283170                                                                  28317000
283171     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        28317100
283172         MOVE '4401-SELECT-PO-DETAILS'    TO DP013-PARAGRAPH      28317200
283173         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  28317300
283174                                   TO DP013-MESSAGE-TEXT (1)      28317400
283175         MOVE SQLCA                TO DP013-SQLCA                 28317500
283176         MOVE 'TPURCHS '           TO DP013-DB2-TABLE-NAME (1)    28317600
283177         SET DP013-DB2-ABEND                                      28317700
283178             DP013-XCTL-DISPLAY-RESTART                           28317800
283179                                   TO TRUE                        28317900
283180         PERFORM DP013-0000-PROCESS-ABEND                         28318000
283181     END-IF.                                                      28318100
283182                                                                  28318200
283183 EJECT                                                            28318300
283184*----------------------------------------------------------------*28318400
283185*     SELECT AD-DTE FROM TPURITM                                 *28318500
283186*----------------------------------------------------------------*28318600
283187 4402-SELECT-AD-DTE.                                              28318700
283188                                                                  28318800
283189     PERFORM                                                      28318900
283190         WITH TEST AFTER                                          28319000
283191         VARYING PV-RETRY-COUNTER                                 28319100
283192         FROM 1 BY 1                                              28319200
283193         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               28319300
283194         OR     (SQLCODE = ZERO)                                  28319400
283195         OR     (SQLCODE = +100))                                 28319500
283196                                                                  28319600
283197         EXEC SQL                                                 28319700
283198              SELECT                                              28319800
283199                     MIN(AD_EVNT_DTE)                             28319900
283200              INTO  :PURITM-AD-EVNT-DTE :PV-AD-DTE-IND            28320000
283201              FROM   TPURITM                                      28320100
283202              WHERE  PO_NBR         = :DK-PO-NBR                  28320200
283203              AND    VER_STATUS_CDE = 'A'                         28320300
283204              AND    AD_EVNT_DTE   ^= '0001-01-01'                28320400
283205         END-EXEC                                                 28320500
283206                                                                  28320600
283207         EVALUATE TRUE                                            28320700
283208             WHEN SQLCODE = ZERO                                  28320800
283209             WHEN SQLCODE = +100                                  28320900
283210             WHEN SQLCODE = -904                                  28321000
283211             WHEN SQLCODE = -913                                  28321100
283212                  CONTINUE                                        28321200
283213             WHEN SQLWARN0 NOT = SPACE                            28321300
283214             WHEN SQLCODE NOT = ZERO                              28321400
283215                  MOVE '4402-SELECT-AD-DTE'                       28321500
283216                                   TO DP013-PARAGRAPH             28321600
283217                  MOVE 'SQL ERROR SELECTING AD DATE'              28321700
283218                                   TO DP013-MESSAGE-TEXT (1)      28321800
283219                  MOVE SQLCA       TO DP013-SQLCA                 28321900
283220                  MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (1)    28322000
283221                  SET DP013-DB2-ABEND                             28322100
283222                      DP013-XCTL-DISPLAY-RESTART TO TRUE          28322200
283223                  PERFORM DP013-0000-PROCESS-ABEND                28322300
283224         END-EVALUATE                                             28322400
283225     END-PERFORM.                                                 28322500
283226                                                                  28322600
283227     IF SQLCODE EQUAL + 0                                         28322700
283228        MOVE PURITM-AD-EVNT-DTE    TO PV-DATE-BREAK               28322800
283229        PERFORM 4320-FORMAT-DATE                                  28322900
283230        MOVE PV-DATE-DISPLAY       TO AADDTO                      28323000
283231     ELSE                                                         28323100
283232        MOVE SPACES                TO AADDTO                      28323200
283233     END-IF.                                                      28323300
283234                                                                  28323400
283235     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        28323500
283236         MOVE '4402-SELECT-AD-DTE' TO DP013-PARAGRAPH             28323600
283237         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT AD-DA28323700
283238-             'TE'                 TO DP013-MESSAGE-TEXT (1)      28323800
283239         MOVE SQLCA                TO DP013-SQLCA                 28323900
283240         MOVE 'TPURITM '           TO DP013-DB2-TABLE-NAME (1)    28324000
283241         SET DP013-DB2-ABEND                                      28324100
283242             DP013-XCTL-DISPLAY-RESTART                           28324200
283243                                   TO TRUE                        28324300
283244         PERFORM DP013-0000-PROCESS-ABEND                         28324400
283245     END-IF.                                                      28324500
283246                                                                  28324600
283247 EJECT                                                            28324700
283248*----------------------------------------------------------------*28324821
283249*     SELECT VENDOR STYLE NAME FROM XLT_VND_STYL TABLE           *28324921
283250*----------------------------------------------------------------*28325021
283260 4403-SELECT-VND-STYL.                                            28326021
283270                                                                  28327021
283280     PERFORM                                                      28328021
283290         WITH TEST AFTER                                          28329021
283300         VARYING PV-RETRY-COUNTER                                 28330021
283400         FROM 1 BY 1                                              28340021
283500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               28350021
283600            OR  (SQLCODE = ZERO)                                  28360021
283700            OR  (SQLCODE = +100)                                  28370021
283800            OR  (SQLCODE = -811))                                 28380021
283900                                                                  28390021
284000         EXEC SQL                                                 28400021
284100              SELECT   DISTINCT                                   28410021
284200                       VS_NBR                                     28420021
284300                INTO   :XLT00004-VS-NBR                           28430021
284400                FROM   TPURITM A                                  28440021
284500                   ,   XLT_SKU B                                  28450021
284600                   ,   XLT_VND_STYL C                             28460021
284700               WHERE   A.PO_NBR       = :DK-PO-NBR                28470021
284800                 AND   A.VER_STATUS_CDE = 'A'                     28480021
284900                 AND   A.ITM_NBR = B.ITM_NBR                      28490021
285000                 AND   B.STYL_ID = C.STYL_ID                      28500021
285100         END-EXEC                                                 28510021
285200                                                                  28520021
285300         EVALUATE TRUE                                            28530021
285400             WHEN SQLCODE = ZERO                                  28540021
285500             WHEN SQLCODE = +100                                  28550021
285600             WHEN SQLCODE = -811                                  28560021
285700             WHEN SQLCODE = -904                                  28570021
285800             WHEN SQLCODE = -913                                  28580021
285900                 CONTINUE                                         28590021
286000             WHEN SQLWARN0 NOT = SPACES                           28600021
286100             WHEN SQLCODE < ZERO                                  28610021
286200             WHEN SQLCODE > ZERO                                  28620021
286300                 MOVE '4403-SELECT-VND-STYL'                      28630021
286400                                     TO DP013-PARAGRAPH           28640021
286500                 MOVE 'SQL ERROR SELECTING VENDOR STYLE'          28650021
286600                                     TO DP013-MESSAGE-TEXT (1)    28660021
286700                 MOVE SQLCA          TO DP013-SQLCA               28670021
286800                 MOVE 'XLT_VND_STYL' TO DP013-DB2-TABLE-NAME (1)  28680021
286900                 SET DP013-DB2-ABEND                              28690021
287000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           28700021
287100                 PERFORM DP013-0000-PROCESS-ABEND                 28710021
287200         END-EVALUATE                                             28720021
287300     END-PERFORM.                                                 28730021
287400*                                                                 28740021
287500     IF  SQLCODE EQUAL +0                                         28750021
287600         MOVE XLT00004-VS-NBR       TO AVNDSTYO                   28760021
287700     ELSE                                                         28770021
287800         IF  SQLCODE EQUAL -811                                   28780021
287900             MOVE '*MULTIPLES*'     TO AVNDSTYO                   28790021
288000         END-IF                                                   28800021
288100     END-IF.                                                      28810021
288200*                                                                 28820021
288300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        28830021
288400         MOVE '4403-SELECT-VND-STYL'    TO DP013-PARAGRAPH        28840021
288500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT VENDO28850021
288600-             'R STYLE'            TO DP013-MESSAGE-TEXT (1)      28860021
288700         MOVE SQLCA                TO DP013-SQLCA                 28870021
288800         MOVE 'XLT_VND_STYL'       TO DP013-DB2-TABLE-NAME (1)    28880021
288900         SET DP013-DB2-ABEND                                      28890021
289000             DP013-XCTL-DISPLAY-RESTART                           28900021
289100                                   TO TRUE                        28910021
289200         PERFORM DP013-0000-PROCESS-ABEND                         28920021
289300     END-IF.                                                      28930021
289400                                                                  28940021
289401 EJECT                                                            28940121
289402*----------------------------------------------------------------*28940200
289403*     OPEN THE OUTER PACK CURSOR                                 *28940300
289404*----------------------------------------------------------------*28940400
289405 4404-OPEN-OUTR-PCK-CSR.                                          28940500
289406                                                                  28940600
289407     PERFORM                                                      28940700
289408         WITH TEST AFTER                                          28940800
289409         VARYING PV-RETRY-COUNTER                                 28940900
289410         FROM 1 BY 1                                              28941000
289411         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               28941100
289412            OR  (SQLCODE = ZERO))                                 28941200
289413                                                                  28941300
289414         MOVE 'CURSOR:  OUTR-PCK-CSR' TO DP013-MESSAGE-TEXT (2)   28941400
289415                                                                  28941500
289416         EXEC SQL                                                 28941600
289417              OPEN OUTR-PCK-CSR                                   28941700
289418         END-EXEC                                                 28941800
289419                                                                  28941900
289420         EVALUATE TRUE                                            28942000
289421             WHEN SQLCODE = ZERO                                  28942100
289422             WHEN SQLCODE = -904                                  28942200
289423             WHEN SQLCODE = -913                                  28942300
289424                 CONTINUE                                         28942400
289425             WHEN SQLWARN0 NOT = SPACES                           28942500
289426             WHEN SQLCODE < ZERO                                  28942600
289427             WHEN SQLCODE > ZERO                                  28942700
289428                 MOVE '4404-OPEN-OUTR-PCK-CSR'                    28942800
289429                                   TO DP013-PARAGRAPH             28942900
289430                 MOVE 'OPEN OUTER-PACK CURSOR - '                 28943000
289431                                   TO DP013-MESSAGE-TEXT (1)      28943100
289432                 MOVE SQLCA        TO DP013-SQLCA                 28943200
289433                 MOVE 'TUPC   '   TO DP013-DB2-TABLE-NAME (1)     28943300
289434                 SET DP013-DB2-ABEND                              28943400
289435                     DP013-XCTL-DISPLAY-RESTART TO TRUE           28943500
289436                 PERFORM DP013-0000-PROCESS-ABEND                 28943600
289437         END-EVALUATE                                             28943700
289438     END-PERFORM.                                                 28943800
289439                                                                  28943900
289440     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        28944000
289441         MOVE '4404-OPEN-OUTR-PCK-CSR'   TO DP013-PARAGRAPH       28944100
289442         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   28944200
289443                                   TO DP013-MESSAGE-TEXT (1)      28944300
289444         MOVE SQLCA                TO DP013-SQLCA                 28944400
289445         MOVE 'TUPC    '           TO DP013-DB2-TABLE-NAME (1)    28944500
289446         SET DP013-DB2-ABEND                                      28944600
289447             DP013-XCTL-DISPLAY-RESTART                           28944700
289448                                   TO TRUE                        28944800
289449         PERFORM DP013-0000-PROCESS-ABEND                         28944900
289450     END-IF.                                                      28945000
289451                                                                  28945100
289452 EJECT                                                            28945200
289453*----------------------------------------------------------------*28945300
289454*     FETCH THE OUTER PACK QUANTITY                              *28945400
289455*----------------------------------------------------------------*28945500
289456 4405-FETCH-OUTR-PCK.                                             28945600
289457                                                                  28945700
289458     PERFORM                                                      28945800
289459         WITH TEST AFTER                                          28945900
289460         VARYING PV-RETRY-COUNTER                                 28946000
289461         FROM 1 BY 1                                              28946100
289462         UNTIL (SQLCODE = +100)                                   28946200
289463                                                                  28946300
289464         EXEC SQL                                                 28946421
289465              FETCH OUTR-PCK-CSR                                  28946521
289466              INTO  :PURITM-UNT-QTY                               28946621
289467                 ,  :PURITM-OUTR-PK-QTY                           28946722
289468         END-EXEC                                                 28946821
289469                                                                  28946900
289470         EVALUATE TRUE                                            28947000
289471             WHEN SQLCODE = ZERO                                  28947100
289472             WHEN SQLCODE = +100                                  28947200
289473                  CONTINUE                                        28947300
289474             WHEN SQLWARN0 NOT = SPACE                            28947400
289475             WHEN SQLCODE NOT = ZERO                              28947500
289476                  MOVE '4405-FETCH-OUTR-PCK'                      28947600
289477                                   TO DP013-PARAGRAPH             28947700
289478                  MOVE 'FETCH OUTER-PACK CURSOR'                  28947800
289479                                   TO DP013-MESSAGE-TEXT (1)      28947900
289480                  MOVE SQLCA       TO DP013-SQLCA                 28948000
289481                  SET DP013-DB2-ABEND                             28948100
289482                                   TO TRUE                        28948200
289483                  PERFORM DP013-0000-PROCESS-ABEND                28948300
289484         END-EVALUATE                                             28948400
289485                                                                  28948500
289486         IF  SQLCODE EQUAL +0                                     28948600
289487             IF PURITM-OUTR-PK-QTY NOT = ASC-OUTR-PACK            28948722
289488                IF ASC-OUTR-PACK = 0                              28948800
289489                   MOVE PURITM-OUTR-PK-QTY TO ASC-OUTR-PACK       28948922
289490                ELSE                                              28949000
289491                   MOVE PC-MULTI TO ASC-OUTR-PACK-X               28949100
289492                END-IF                                            28949200
289493             END-IF                                               28949300
289494             IF PURITM-OUTR-PK-QTY = 0                            28949422
289495                DIVIDE 1 INTO PURITM-UNT-QTY                      28949500
289496                GIVING PV-ITEM-CART-CNT ROUNDED                   28949600
289497             ELSE                                                 28949700
289498                DIVIDE PURITM-OUTR-PK-QTY INTO PURITM-UNT-QTY     28949822
289499                GIVING PV-ITEM-CART-CNT ROUNDED                   28949900
289500             END-IF                                               28950000
289501             ADD PV-ITEM-CART-CNT TO PV-PO-CART-CNT               28950100
289502         END-IF                                                   28950200
289503     END-PERFORM.                                                 28950300
289504                                                                  28950400
289505 EJECT                                                            28950500
289506*----------------------------------------------------------------*28950600
289507*     CLOSE THE OUTER PACK CURSOR                                *28950700
289508*----------------------------------------------------------------*28950800
289509 4406-CLOSE-OUTR-PCK-CSR.                                         28950900
289510                                                                  28951000
289511     EXEC SQL                                                     28951100
289512          CLOSE OUTR-PCK-CSR                                      28951200
289513     END-EXEC.                                                    28951300
289514                                                                  28951400
289515     EVALUATE TRUE                                                28951500
289516         WHEN SQLCODE = ZERO                                      28951600
289517             CONTINUE                                             28951700
289518         WHEN SQLWARN0 NOT = SPACES                               28951800
289519         WHEN SQLCODE < ZERO                                      28951900
289520         WHEN SQLCODE > ZERO                                      28952000
289521             MOVE '4406-CLOSE-OUTR-PCK-CSR'                       28952100
289522                               TO DP013-PARAGRAPH                 28952200
289523             MOVE 'CLOSE OUTER-PACK CURSOR '                      28952300
289524                               TO DP013-MESSAGE-TEXT (1)          28952400
289525             MOVE SQLCA        TO DP013-SQLCA                     28952500
289526             MOVE 'TUPC    '   TO DP013-DB2-TABLE-NAME (1)        28952600
289527             SET DP013-DB2-ABEND                                  28952700
289528                 DP013-XCTL-DISPLAY-RESTART TO TRUE               28952800
289529             PERFORM DP013-0000-PROCESS-ABEND                     28952900
289530     END-EVALUATE.                                                28953000
289531                                                                  28953100
289532 EJECT                                                            28953200
289533*----------------------------------------------------------------*28953300
289534*    MOVE PO DETAILS TO SCREEN.                                  *28953400
289535*----------------------------------------------------------------*28953500
289536 4407-MOVE-PO-DTLS-TO-SCR.                                        28953600
289537                                                                  28953700
289538     MOVE ASC-KEY-PO-NBR            TO APONBRO.                   28953800
289539     MOVE PURCHS-DEPT-NBR           TO PV-DEPT-NBR-N.             28953921
289540     MOVE PV-DEPT-NBR-N             TO ADEPTO.                    28954021
289541     MOVE PURCHS-OTB-PER-NBR        TO AOTBO.                     28954100
289542     MOVE PURCHS-TOT-UNT-QTY        TO AUNTSO.                    28954200
289543     MOVE PURCHS-PROD-CNTRY-CDE     TO ACNTRYO.                   28954300
289544     MOVE ENTNME-ENT-NAME-DESC      TO AVNDNMEO.                  28954400
289545     MOVE PLNSHP-FOB-CDE            TO AFOBO.                     28954500
289546     MOVE PLNSHP-POE-CDE            TO APOEO.                     28954600
289547     MOVE PV-PO-CART-CNT            TO ACTNSO.                    28954700
289548                                                                  28954800
289549     IF PLNSHP-CAN-IFNOT-SHIP-DTE   =  PC-INIT-DATE               28954900
289550        MOVE SPACES                 TO ACANDTO                    28955000
289551     ELSE                                                         28955100
289552        MOVE PLNSHP-CAN-IFNOT-SHIP-DTE                            28955200
289553                                    TO PV-DATE-BREAK              28955300
289554        PERFORM 4320-FORMAT-DATE                                  28955400
289555        MOVE PV-DATE-DISPLAY        TO ACANDTO                    28955500
289556     END-IF.                                                      28955600
289557                                                                  28955700
289558     IF PLNSHP-EXT-CAN-DTE          =  PC-INIT-DATE               28955800
289559        MOVE SPACES                 TO AXCANDTO                   28955900
289560     ELSE                                                         28956000
289561        MOVE PLNSHP-EXT-CAN-DTE     TO PV-DATE-BREAK              28956100
289562        PERFORM 4320-FORMAT-DATE                                  28956200
289563        MOVE PV-DATE-DISPLAY        TO AXCANDTO                   28956300
289564     END-IF.                                                      28956400
289565                                                                  28956500
289566     IF PLNSHP-STRT-FCTRY-DTE       =  PC-INIT-DATE               28956600
289567        MOVE SPACES                 TO ASTXFDTO                   28956700
289568     ELSE                                                         28956800
289569        MOVE PLNSHP-STRT-FCTRY-DTE  TO PV-DATE-BREAK              28956900
289570        PERFORM 4320-FORMAT-DATE                                  28957000
289571        MOVE PV-DATE-DISPLAY        TO ASTXFDTO                   28957100
289572     END-IF.                                                      28957200
289573                                                                  28957300
289574     IF PLNSHP-LAST-FCTRY-DTE       =  PC-INIT-DATE               28957400
289575        MOVE SPACES                 TO ALTXFDTO                   28957500
289576     ELSE                                                         28957600
289577        MOVE PLNSHP-LAST-FCTRY-DTE  TO PV-DATE-BREAK              28957700
289578        PERFORM 4320-FORMAT-DATE                                  28957800
289579        MOVE PV-DATE-DISPLAY        TO ALTXFDTO                   28957900
289580     END-IF.                                                      28958000
289581                                                                  28958100
289582     IF PLNSHP-DONT-SHIP-BEF-DTE    =  PC-INIT-DATE               28958200
289583        MOVE SPACES                 TO ADSHBEFO                   28958300
289584     ELSE                                                         28958400
289585        MOVE PLNSHP-DONT-SHIP-BEF-DTE                             28958500
289586                                    TO PV-DATE-BREAK              28958600
289587        PERFORM 4320-FORMAT-DATE                                  28958700
289588        MOVE PV-DATE-DISPLAY        TO ADSHBEFO                   28958800
289589     END-IF.                                                      28958900
289590                                                                  28959000
289591*    IF ASC-OUTR-PACK-X = SPACES                                  28959100
289592*       MOVE ASC-OUTR-PACK-N        TO ACASEO                     28959200
289593*    ELSE                                                         28959300
289594*       MOVE ASC-OUTR-PACK-X        TO ACASEO                     28959400
289595*    END-IF.                                                      28959500
289596*                                                                 28959600
289597 EJECT                                                            28959700
289598*----------------------------------------------------------------*28959800
289599*    SELECT SPLIT DATE (DCONSLR-ACTL-DTE) FROM TIMPORL BY PO-NBR *28959900
289600*----------------------------------------------------------------*28960000
289700 4408-SELECT-SPLIT-DTE.                                           28970000
289800     MOVE '9999-09-09' TO PV-ORD-SPL-SNT-DT.                      28980021
289900     MOVE '9999-09-09' TO PV-SHPT-SPL-SNT-DT.                     28990021
289901     MOVE '9999-09-09' TO PV-SHPT-SPL-AUD-DT.                     28990121
289902     INITIALIZE PV-ORD-SPL-SNT-DT-NULL                            28990221
289903                PV-SHPT-SPL-SNT-DT-NULL                           28990321
289904                PV-SHPT-SPL-AUD-DT-NULL.                          28990421
289905                                                                  28990521
289906     PERFORM 4408A-GET-DC-SPLT-ORDR-SNT-DTE.                      28990600
289907     PERFORM 4408B-GET-DC-SPLT-SHPT-SNT-DTE.                      28990700
289908     PERFORM 4408C-CHECK-TAUCNRL-DATES.                           28990800
289909     IF  PV-ORD-SPL-SNT-DT >= '9998-09-09'                        28990921
289910     AND PV-SHPT-SPL-SNT-DT >= '9998-09-09'                       28991021
289920     AND PV-SHPT-SPL-AUD-DT >= '9998-09-09'                       28992021
289930         MOVE SPACES TO PV-DATE-DISPLAY                           28993021
289940                        ASC-EARLIEST-SPLIT-DTE                    28994021
289950     ELSE                                                         28995021
289960         IF  PV-ORD-SPL-SNT-DT <= PV-SHPT-SPL-SNT-DT              28996021
289961             IF PV-ORD-SPL-SNT-DT <= PV-SHPT-SPL-AUD-DT           28996121
289962                 MOVE PV-ORD-SPL-SNT-DT TO PV-DATE-BREAK          28996200
289963                                       ASC-EARLIEST-SPLIT-DTE     28996321
289964             ELSE                                                 28996421
289965                 MOVE PV-SHPT-SPL-AUD-DT TO PV-DATE-BREAK         28996521
289966                                       ASC-EARLIEST-SPLIT-DTE     28996621
289967             END-IF                                               28996721
289968         ELSE                                                     28996821
289969             IF PV-SHPT-SPL-SNT-DT <= PV-SHPT-SPL-AUD-DT          28996921
289970                 MOVE PV-SHPT-SPL-SNT-DT TO PV-DATE-BREAK         28997000
289980                                           ASC-EARLIEST-SPLIT-DTE 28998021
289981             ELSE                                                 28998121
289982                 MOVE PV-SHPT-SPL-AUD-DT TO PV-DATE-BREAK         28998200
289983                                           ASC-EARLIEST-SPLIT-DTE 28998321
289984             END-IF                                               28998421
289985         END-IF                                                   28998521
289986         PERFORM 4320-FORMAT-DATE                                 28998600
289987     END-IF.                                                      28998721
289988     MOVE PV-DATE-DISPLAY TO ASPLITO.                             28998821
289989                                                                  28998921
289990*----------------------------------------------------------------*28999000
289991*    SELECT SPLIT DATE (DCONSLR-ACTL-DTE) FROM TIMPORL BY PO-NBR *28999100
289992*----------------------------------------------------------------*28999200
289993 4408A-GET-DC-SPLT-ORDR-SNT-DTE.                                  28999300
289994                                                                  28999400
289995     PERFORM                                                      28999500
289996         WITH TEST AFTER                                          28999600
289997         VARYING PV-RETRY-COUNTER                                 28999700
289998         FROM 1 BY 1                                              28999800
289999         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               28999900
290000            OR  (SQLCODE = ZERO)                                  29000000
290001            OR  (SQLCODE = +100)                                  29000100
290002            OR  (SQLCODE = -811))                                 29000200
290003                                                                  29000300
290004         EXEC SQL                                                 29000400
290005             SELECT MIN(DATE(DCONSLR_ACTL_DTE))                   29000521
290006             INTO   :PV-ORD-SPL-SNT-DT                            29000621
290007                    :PV-ORD-SPL-SNT-DT-NULL                       29000721
290008             FROM   TIMPORL                                       29000800
290009             WHERE  PO_NBR           = :DK-PO-NBR                 29000900
290010             AND    VER_STATUS_CDE   = 'A'                        29001000
290011             AND    (DCONSLR_RLSE_CDE = 'R'  OR                   29001100
290012                     DCONSLR_RLSE_CDE = 'Y')                      29001200
290013             AND    DATE(DCONSLR_ACTL_DTE)   <>                   29001321
290014                                '9999-09-09'                      29001421
290015         END-EXEC                                                 29001500
290016     END-PERFORM.                                                 29001600
290017                                                                  29001700
290018     EVALUATE TRUE                                                29001800
290019         WHEN SQLCODE = ZERO                                      29001900
290020           IF  PV-ORD-SPL-SNT-DT-NULL = -1                        29002021
290030               MOVE '9998-09-09' TO PV-ORD-SPL-SNT-DT             29003021
290031           END-IF                                                 29003121
290032         WHEN SQLCODE = +100                                      29003200
290033         WHEN SQLCODE = -811                                      29003300
290034              CONTINUE                                            29003400
290035         WHEN SQLWARN0 NOT = SPACE                                29003500
290036         WHEN SQLCODE NOT = ZERO                                  29003600
290037              MOVE '4408A-GET-DC-SPLT-ORDR-SNT-DTE'               29003700
290038                               TO DP013-PARAGRAPH                 29003800
290039              MOVE 'SQL ERROR SELECTING SPLIT DATE'               29003900
290040                               TO DP013-MESSAGE-TEXT (1)          29004000
290041              MOVE SQLCA       TO DP013-SQLCA                     29004100
290042              SET DP013-DB2-ABEND                                 29004200
290043                               TO TRUE                            29004300
290044              PERFORM DP013-0000-PROCESS-ABEND                    29004400
290045     END-EVALUATE.                                                29004500
290046                                                                  29004600
290047     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        29004700
290048         MOVE '4408A-GET-DC-SPLT-ORDR-SNT-DTE' TO DP013-PARAGRAPH 29004800
290049         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT      29004900
290050-             ' SPLIT DATE'                                       29005000
290051                                   TO DP013-MESSAGE-TEXT (1)      29005100
290052         MOVE SQLCA                TO DP013-SQLCA                 29005200
290053         MOVE 'TIMPORL '           TO DP013-DB2-TABLE-NAME (1)    29005300
290054         SET DP013-DB2-ABEND                                      29005400
290055             DP013-XCTL-DISPLAY-RESTART                           29005500
290056                                   TO TRUE                        29005600
290057         PERFORM DP013-0000-PROCESS-ABEND                         29005700
290058     END-IF.                                                      29005800
290059                                                                  29005900
290060 EJECT                                                            29006000
290061*----------------------------------------------------------------*29006121
290062*  DETERMINE DC SPLITS SHPT SENT DATE                            *29006221
290063*----------------------------------------------------------------*29006321
290064 4408B-GET-DC-SPLT-SHPT-SNT-DTE.                                  29006421
290065                                                                  29006521
290066     PERFORM                                                      29006621
290067         WITH TEST AFTER                                          29006721
290068         VARYING PV-RETRY-COUNTER                                 29006821
290069         FROM 1 BY 1                                              29006921
290070         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               29007021
290071             OR (SQLCODE = -811)                                  29007121
290072             OR (SQLCODE = +100)                                  29007221
290073             OR (SQLCODE = ZERO))                                 29007321
290074                                                                  29007421
290075         EXEC SQL                                                 29007521
290076             SELECT MIN(DATE(DCONSLR_ACTL_DTE))                   29007621
290077             INTO  :PV-SHPT-SPL-SNT-DT                            29007721
290078                   :PV-SHPT-SPL-SNT-DT-NULL                       29007821
290079             FROM   TIMCNRL A                                     29007921
290080             WHERE  PO_NBR           = :DK-PO-NBR                 29008000
290081             AND    (DCONSLR_RLSE_CDE = 'R'  OR                   29008100
290082                     DCONSLR_RLSE_CDE = 'Y')                      29008200
290083             AND    DATE(DCONSLR_ACTL_DTE)   <>                   29008321
290084                                '9999-09-09'                      29008421
290085         END-EXEC                                                 29008521
290086                                                                  29008621
290087     EVALUATE TRUE                                                29008721
290088         WHEN SQLCODE = ZERO                                      29008821
290089           IF  PV-SHPT-SPL-SNT-DT-NULL = -1                       29008921
290090               MOVE '9998-09-09' TO PV-SHPT-SPL-SNT-DT            29009021
290091           END-IF                                                 29009121
290092         WHEN SQLWARN0 NOT = SPACES                               29009221
290093         WHEN SQLCODE < ZERO                                      29009321
290094         WHEN SQLCODE > ZERO                                      29009421
290095             MOVE '4408B-GET-DC-SPLT-SHPT-SNT-DTE'                29009521
290096                               TO DP013-PARAGRAPH                 29009621
290097             MOVE 'SELECT DATA'                                   29009721
290098                               TO DP013-MESSAGE-TEXT (1)          29009821
290099             MOVE SQLCA        TO DP013-SQLCA                     29009921
290100             MOVE 'TIMCNRL'      TO DP013-DB2-TABLE-NAME (1)      29010021
290101             SET DP013-DB2-ABEND                                  29010121
290102                 DP013-XCTL-DISPLAY-RESTART TO TRUE               29010221
290103             PERFORM DP013-0000-PROCESS-ABEND                     29010321
290104     END-EVALUATE                                                 29010421
290105     END-PERFORM.                                                 29010521
290106                                                                  29010621
290107     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        29010721
290108         MOVE '4408B-GET-DC-SPLT-SHPT-SNT-DTE'                    29010821
290109                               TO DP013-PARAGRAPH                 29010921
290110         MOVE 'SELECT DATA'                                       29011021
290111                           TO DP013-MESSAGE-TEXT (1)              29011121
290112         MOVE SQLCA        TO DP013-SQLCA                         29011221
290113         MOVE 'TIMCNRL'    TO DP013-DB2-TABLE-NAME (1)            29011321
290114         SET DP013-DB2-ABEND                                      29011421
290115             DP013-XCTL-DISPLAY-RESTART                           29011521
290116                                   TO TRUE                        29011621
290117         PERFORM DP013-0000-PROCESS-ABEND                         29011721
290118     END-IF.                                                      29011821
290119 EJECT                                                            29011921
290120*----------------------------------------------------------------*29012021
290121*  DETERMINE DC SPLITS SHPT SENT DATE FROM AUDIT TABLE           *29012121
290122*----------------------------------------------------------------*29012221
290123 4408C-CHECK-TAUCNRL-DATES.                                       29012321
290124                                                                  29012421
290125     PERFORM                                                      29012521
290126         WITH TEST AFTER                                          29012621
290127         VARYING PV-RETRY-COUNTER                                 29012721
290128         FROM 1 BY 1                                              29012821
290129         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               29012921
290130             OR (SQLCODE = -811)                                  29013021
290131             OR (SQLCODE = +100)                                  29013121
290132             OR (SQLCODE = ZERO))                                 29013221
290133                                                                  29013321
290134         EXEC SQL                                                 29013421
290135             SELECT MIN(DATE(DCONSLR_ACTL_DTE))                   29013521
290136             INTO  :PV-SHPT-SPL-AUD-DT                            29013621
290137                   :PV-SHPT-SPL-AUD-DT-NULL                       29013721
290138             FROM   TAUCNRL A                                     29013821
290139             WHERE  PO_NBR           = :DK-PO-NBR                 29013900
290140             AND    (DCONSLR_RLSE_CDE = 'R'  OR                   29014000
290141                     DCONSLR_RLSE_CDE = 'Y')                      29014100
290142             AND    DATE(DCONSLR_ACTL_DTE)   <>                   29014221
290143                                '9999-09-09'                      29014321
290144         END-EXEC                                                 29014421
290145                                                                  29014521
290146     EVALUATE TRUE                                                29014621
290147         WHEN SQLCODE = ZERO                                      29014721
290148           IF  PV-SHPT-SPL-AUD-DT-NULL = -1                       29014821
290149               MOVE '9998-09-09' TO PV-SHPT-SPL-AUD-DT            29014921
290150           END-IF                                                 29015021
290151         WHEN SQLWARN0 NOT = SPACES                               29015121
290152         WHEN SQLCODE < ZERO                                      29015221
290153         WHEN SQLCODE > ZERO                                      29015321
290154             MOVE '4408C-CHECK-TAUCNRL-DATES'                     29015421
290155                               TO DP013-PARAGRAPH                 29015521
290156             MOVE 'SELECT DATA'                                   29015621
290157                               TO DP013-MESSAGE-TEXT (1)          29015721
290158             MOVE SQLCA        TO DP013-SQLCA                     29015821
290159             MOVE 'TAUCNRL'      TO DP013-DB2-TABLE-NAME (1)      29015921
290160             SET DP013-DB2-ABEND                                  29016021
290161                 DP013-XCTL-DISPLAY-RESTART TO TRUE               29016121
290162             PERFORM DP013-0000-PROCESS-ABEND                     29016221
290163     END-EVALUATE                                                 29016321
290164     END-PERFORM.                                                 29016421
290165                                                                  29016521
290166     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        29016621
290167         MOVE '4408C-CHECK-TAUCNRL-DATES'                         29016721
290168                               TO DP013-PARAGRAPH                 29016821
290169         MOVE 'SELECT DATA'                                       29016921
290170                           TO DP013-MESSAGE-TEXT (1)              29017021
290171         MOVE SQLCA        TO DP013-SQLCA                         29017121
290172         MOVE 'TAUCNRL'    TO DP013-DB2-TABLE-NAME (1)            29017221
290173         SET DP013-DB2-ABEND                                      29017321
290174             DP013-XCTL-DISPLAY-RESTART                           29017421
290175                                   TO TRUE                        29017521
290176         PERFORM DP013-0000-PROCESS-ABEND                         29017621
290177     END-IF.                                                      29017721
290178 EJECT                                                            29017821
290179*----------------------------------------------------------------*29017900
290180*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *29018000
290181*----------------------------------------------------------------*29018100
290182 4410-READ-TEMP-STORAGE.                                          29018200
290183                                                                  29018300
290184     EXEC CICS                                                    29018400
290185         READQ TS                                                 29018500
290186             QUEUE (ASC-LIST-QUEUE-NAME)                          29018600
290187             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               29018700
290188             ITEM  (PV-BLOCK-NUMBER)                              29018800
290189             RESP  (PV-CICS-RESP)                                 29018900
290190     END-EXEC.                                                    29019000
290191                                                                  29019100
290192     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       29019200
290193       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     29019300
290194         CONTINUE                                                 29019400
290195     ELSE                                                         29019500
290196         SET DP013-CICS-ABEND     TO TRUE                         29019600
290197         SET DP013-NO-ROLLBACK    TO TRUE                         29019700
290198         MOVE '4410-READ-TEMP-STORAGE'                            29019800
290199                                  TO DP013-PARAGRAPH              29019900
290200         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      29020000
290201                                  TO DP013-MESSAGE-TEXT(1)        29020100
290202         PERFORM DP013-0000-PROCESS-ABEND                         29020200
290203     END-IF.                                                      29020300
290204                                                                  29020400
290205     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             29020500
290206                                                                  29020600
290207     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         29020700
290208         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               29020800
290209     END-IF.                                                      29020900
290210                                                                  29021000
290211 EJECT                                                            29021100
290212*----------------------------------------------------------------*29021200
290213*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *29021300
290214*----------------------------------------------------------------*29021400
290215 4420-FORMAT-LIST-LINES.                                          29021500
290216                                                                  29021600
290217     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      29021700
290218         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                29021800
290219*        MOVE DP015-UNP-ALP-NOR-OFF                               29021900
290220*                                TO MR-SELECTA (PV-SUB)           29022000
290221*        MOVE DP015-GREEN        TO MR-SELECTC (PV-SUB)           29022100
290222*        MOVE DP015-UNDERLINE    TO MR-SELECTH (PV-SUB)           29022200
290223*        MOVE SPACES             TO MR-SELECTI    (PV-SUB)        29022300
290224*                                   MR-ACTION     (PV-SUB)        29022400
290225*                                   MR-CONTNR-NBR (PV-SUB)        29022500
290226*                                   MR-ETA        (PV-SUB)        29022600
290300*                                   MR-LINE-AREA  (PV-SUB)        29030000
290400         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA    (PV-SUB)        29040021
290500         MOVE DP015-HL-OFF       TO MR-SELECTH    (PV-SUB)        29050021
290501         MOVE SPACES             TO MR-SELECTI    (PV-SUB)        29050121
290502                                    MR-ACTION     (PV-SUB)        29050200
290503                                    MR-CONTNR-NBR (PV-SUB)        29050300
290504                                    MR-ETA        (PV-SUB)        29050400
290505                                    MR-LINE-AREA  (PV-SUB)        29050500
291300     ELSE                                                         29130000
291400         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      29140000
291500                                                   > SPACE        29150000
291600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 29160000
291700                                 TO MR-SELECTI (PV-SUB)           29170000
291800         ELSE                                                     29180000
291900             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      29190000
292000                                 TO MR-SELECTI (PV-SUB)           29200000
292100         END-IF                                                   29210000
292200                                                                  29220000
292300         IF  DP030-SET-CURSOR-TRAILER                             29230000
292400             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)29240000
292500                 > SPACE)                                         29250000
292600               OR (PV-SUB = 1))                                   29260000
292700                SET DP030-SET-CURSOR-APPL-1 TO TRUE               29270000
292800                MOVE -1          TO MR-SELECTL (PV-SUB)           29280000
292900             END-IF                                               29290000
293000         END-IF                                                   29300000
293100                                                                  29310000
293200         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           29320000
293300             MOVE ASC-ACTION   (ASC-BLK-SUB ASC-ITEM-SUB)         29330000
293400                               TO MR-ACTION (PV-SUB)              29340000
293500             MOVE ASC-CONTNR-NBR (ASC-BLK-SUB ASC-ITEM-SUB)       29350000
293600                               TO MR-CONTNR-NBR (PV-SUB)          29360000
296300             MOVE ASC-ETA      (ASC-BLK-SUB ASC-ITEM-SUB)         29630000
296400                               TO MR-ETA    (PV-SUB)              29640000
296500         END-IF                                                   29650000
296600                                                                  29660000
296700         IF ASC-DISPLAY-DECON                                     29670000
296800             MOVE ASC-ISUD     (ASC-BLK-SUB ASC-ITEM-SUB)         29680000
296900                               TO MR-DECON-DO-ISSUED              29690000
297000             MOVE ASC-RCVD     (ASC-BLK-SUB ASC-ITEM-SUB)         29700000
297100                               TO MR-DECON-DO-RCVD                29710000
297200             MOVE ASC-RLSD     (ASC-BLK-SUB ASC-ITEM-SUB)         29720000
297300                               TO MR-DECON-CONT-RLSD              29730000
297400             MOVE ASC-PCKUP    (ASC-BLK-SUB ASC-ITEM-SUB)         29740000
297500                               TO MR-DECON-CONT-PCKUP             29750000
297600             MOVE ASC-DEVAN    (ASC-BLK-SUB ASC-ITEM-SUB)         29760000
297700                               TO MR-DECON-CONT-DEVAN             29770000
297701             MOVE ASC-SPLDC    (ASC-BLK-SUB ASC-ITEM-SUB)         29770121
297702                               TO MR-DECON-SPLT-TO-DCONSL         29770200
298000             IF ASC-DC (ASC-BLK-SUB ASC-ITEM-SUB) = 0             29800000
298100                 MOVE SPACES   TO MR-DECON-DC                     29810000
298200             ELSE                                                 29820000
298300                 MOVE ASC-DC (ASC-BLK-SUB ASC-ITEM-SUB)           29830000
298400                               TO MR-DECON-DC                     29840000
298500             END-IF                                               29850000
298600             MOVE ASC-SCAC     (ASC-BLK-SUB ASC-ITEM-SUB)         29860000
298700                               TO MR-DECON-LNHL-SCAC              29870000
298800             MOVE ASC-TRAILER  (ASC-BLK-SUB ASC-ITEM-SUB)         29880000
298900                               TO MR-DECON-TRAILER                29890000
299000             MOVE MR-DECON-LINE  TO MR-LINE-AREA (PV-SUB)         29900000
299100         ELSE                                                     29910000
299200             MOVE ASC-DECN-SCAC (ASC-BLK-SUB ASC-ITEM-SUB)        29920021
299300                                TO MR-LINEHAUL-DECN-SCAC          29930021
299400             MOVE ASC-RTN      (ASC-BLK-SUB ASC-ITEM-SUB)         29940021
299500                               TO MR-LINEHAUL-CONT-RTN            29950021
299600             IF ASC-DC (ASC-BLK-SUB ASC-ITEM-SUB) = 0             29960021
299601                 MOVE SPACES   TO MR-LINEHAUL-DC                  29960121
299602             ELSE                                                 29960200
299700                 MOVE ASC-DC (ASC-BLK-SUB ASC-ITEM-SUB)           29970000
299800                               TO MR-LINEHAUL-DC                  29980000
299900             END-IF                                               29990000
300000             MOVE ASC-SCAC     (ASC-BLK-SUB ASC-ITEM-SUB)         30000000
300100                               TO MR-LINEHAUL-LNHL-SCAC           30010000
300200             MOVE ASC-TRAILER  (ASC-BLK-SUB ASC-ITEM-SUB)         30020000
300201                               TO MR-LINEHAUL-TRAILER             30020100
300202             MOVE ASC-POE      (ASC-BLK-SUB ASC-ITEM-SUB)         30020200
300203                               TO MR-LINEHAUL-POE                 30020300
300204             MOVE ASC-CSTM-ENTRY (ASC-BLK-SUB ASC-ITEM-SUB)       30020400
300205                               TO MR-LINEHAUL-CSTM-ENTRY          30020500
300206             MOVE MR-LINEHAUL-LINE  TO MR-LINE-AREA(PV-SUB)       30020600
300207         END-IF                                                   30020700
300208     END-IF.                                                      30020800
300209                                                                  30020900
300210     SUBTRACT +1 FROM ASC-ITEM-SUB                                30021000
300211     IF  ASC-ITEM-SUB < + 1                                       30021100
300212         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  30021200
300213         MOVE +1                 TO ASC-BLK-SUB                   30021300
300214     END-IF.                                                      30021400
300215                                                                  30021500
300216 EJECT                                                            30021600
300217*----------------------------------------------------------------*30021700
300218*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *30021800
300219*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *30021900
300220*  ISSUE A WARNING.                                              *30022000
300221*----------------------------------------------------------------*30022100
300222 4430-CHECK-FOR-BEGIN-AND-END.                                    30022200
300223     IF ASC-END-OF-SELECTED-RANGE NOT NUMERIC                     30022300
300224         MOVE +0 TO ASC-END-OF-SELECTED-RANGE                     30022400
300225     END-IF                                                       30022500
300226                                                                  30022600
300227     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       30022700
300228         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     30022800
300229*----------- NO END-OF-RANGE SPECFIED ---                         30022900
300230             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            30023000
300231             SET DP020-MSG-WARNING TO TRUE                        30023100
300232             PERFORM 4431-POSITION-AT-WARNING                     30023200
300233         END-IF                                                   30023300
300234     ELSE                                                         30023400
300235         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     30023500
300236*----------- NO BEGINNING-OF-RANGE SPECFIED ---                   30023600
300237             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            30023700
300238             SET DP020-MSG-WARNING TO TRUE                        30023800
300239             PERFORM 4431-POSITION-AT-WARNING                     30023900
300240         END-IF                                                   30024000
300241     END-IF.                                                      30024100
300242                                                                  30024200
300243 EJECT                                                            30024300
300244*----------------------------------------------------------------*30024400
300245*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *30024500
300246*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *30024600
300247*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *30024700
300248*  POSITION THE CURSOR THERE.                                    *30024800
300300*----------------------------------------------------------------*30030000
300400 4431-POSITION-AT-WARNING.                                        30040000
300500                                                                  30050000
300600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 30060000
300700                    - PV-TOP-ITEM + 1.                            30070000
300800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      30080000
300900         CONTINUE                                                 30090000
301000     ELSE                                                         30100000
301100         SET DP030-SET-CURSOR-APPL-1                              30110000
301200                                   TO TRUE                        30120000
301300         MOVE -1                   TO MR-SELECTL (PV-SUB)         30130000
301400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         30140000
301500         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         30150000
301600     END-IF.                                                      30160000
301700                                                                  30170000
301800     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   30180000
301900                    - PV-TOP-ITEM + 1.                            30190000
302000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      30200000
302100         CONTINUE                                                 30210000
302200     ELSE                                                         30220000
302300         SET DP030-SET-CURSOR-APPL-1                              30230000
302400                                   TO TRUE                        30240000
302500         MOVE -1                   TO MR-SELECTL (PV-SUB)         30250000
302600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         30260000
302700         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         30270000
302800     END-IF.                                                      30280000
302900                                                                  30290000
303000 EJECT                                                            30300000
303100*----------------------------------------------------------------*30310000
303200* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *30320000
303300* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *30330000
303400* FOR THE SELECTED ITEMS QUEUE.                                  *30340000
303500*                                                                *30350000
303600* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *30360000
303700* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *30370000
303800* THE ARRAY IS FULL.                                             *30380000
303900*----------------------------------------------------------------*30390000
304000 5000-PREPARE-SEL-QUEUE.                                          30400000
304100                                                                  30410000
304200     MOVE +1                   TO  ASC-BLK-SUB.                   30420000
304300     PERFORM 5100-WRITE-TEMP-STORAGE.                             30430000
304400     ADD +1                    TO  ASC-BLK-SUB.                   30440000
304500     PERFORM 5100-WRITE-TEMP-STORAGE.                             30450000
304600     MOVE ASC-SEL-QUEUE-NAME   TO  TR109-SEL-QUEUE-NAME.          30460000
304700     PERFORM 6010-DELETE-SEL-QUEUE.                               30470000
304800                                                                  30480000
304900     SET ASC-UPDATE-TSQ        TO  TRUE.                          30490000
305000                                                                  30500000
305100     SET TR108-IDX             TO  1.                             30510000
305200     MOVE ZERO                 TO TR109-NUMBER-OF-TS-ITEMS.       30520000
305300     INITIALIZE TR108-SELECTED-ITEM-ARRAY.                        30530000
305400                                                                  30540000
305500     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           30550000
305600             VARYING PV-ITEM                                      30560000
305700             FROM 1 BY 1                                          30570000
305800             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     30580000
305900                                                                  30590000
306000     IF  TR108-IDX > 1                                            30600000
306100         PERFORM 5205-WRITE-SEL-QUEUE                             30610000
306200         ADD +1                    TO TR109-NUMBER-OF-TS-ITEMS    30620000
306300     END-IF.                                                      30630000
306400                                                                  30640000
306500 EJECT                                                            30650000
306600*----------------------------------------------------------------*30660000
306700*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *30670000
306800*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *30680000
306900*----------------------------------------------------------------*30690000
307000 5100-WRITE-TEMP-STORAGE.                                         30700000
307100                                                                  30710000
307200     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     30720000
307300                                   TO PV-LIST-ITEM-NUMBER.        30730000
307400     COMPUTE PV-BLOCK-NUMBER =                                    30740000
307500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    30750000
307600                                                                  30760000
307700     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             30770000
307800     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             30780000
307900         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      30790000
308000             PERFORM 5105-REWRITE-ASC-LISTQ                       30800000
308100         END-IF                                                   30810000
308200     ELSE                                                         30820000
308300         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       30830000
308400         ASC-HIGHEST-BLOCK-WRITTEN + 1                            30840000
308500         PERFORM 5110-WRITE-ASC-LISTQ                             30850000
308600         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   30860000
308700     END-IF.                                                      30870000
308800                                                                  30880000
308900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             30890000
309000                                                                  30900000
309100 EJECT                                                            30910000
309200*----------------------------------------------------------------*30920000
309300*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *30930000
309400*  SPECIFIC COMMAREA.                                            *30940000
309500*----------------------------------------------------------------*30950000
309600 5105-REWRITE-ASC-LISTQ.                                          30960000
309700                                                                  30970000
309800     EXEC CICS                                                    30980000
309900         WRITEQ TS                                                30990000
310000             QUEUE (ASC-LIST-QUEUE-NAME)                          31000000
310100             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               31010000
310200             ITEM  (PV-BLOCK-NUMBER)                              31020000
310300             REWRITE                                              31030000
310400             RESP  (PV-CICS-RESP)                                 31040000
310500     END-EXEC.                                                    31050000
310600                                                                  31060000
310700     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           31070000
310800         CONTINUE                                                 31080000
310900     ELSE                                                         31090000
311000         SET DP013-CICS-ABEND            TO TRUE                  31100000
311100         SET DP013-NO-ROLLBACK           TO TRUE                  31110000
311200         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       31120000
311300         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     31130000
311400                                         TO DP013-MESSAGE-TEXT(1) 31140000
311500         PERFORM DP013-0000-PROCESS-ABEND                         31150000
311600     END-IF.                                                      31160000
311700                                                                  31170000
311800 EJECT                                                            31180000
311900*----------------------------------------------------------------*31190000
312000*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *31200000
312100*  SPECIFIC COMMAREA.                                            *31210000
312200*----------------------------------------------------------------*31220000
312300 5110-WRITE-ASC-LISTQ.                                            31230000
312400                                                                  31240000
312500     EXEC CICS                                                    31250000
312600         WRITEQ TS                                                31260000
312700             QUEUE (ASC-LIST-QUEUE-NAME)                          31270000
312800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               31280000
312900             ITEM  (PV-BLOCK-NUMBER)                              31290000
313000             RESP  (PV-CICS-RESP)                                 31300000
313100     END-EXEC.                                                    31310000
313200                                                                  31320000
313300     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      31330000
313400         SET DP013-CICS-ABEND      TO TRUE                        31340000
313500         SET DP013-NO-ROLLBACK     TO TRUE                        31350000
313600         MOVE '5110-WRITE-ASC-LISTQ'                              31360000
313700                                   TO DP013-PARAGRAPH             31370000
313800         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           31380000
313900                                   TO DP013-MESSAGE-TEXT(1)       31390000
314000         PERFORM DP013-0000-PROCESS-ABEND                         31400000
314100     END-IF.                                                      31410000
314200                                                                  31420000
314300 EJECT                                                            31430000
314400*----------------------------------------------------------------*31440000
314500* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *31450000
314600* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *31460000
314700*----------------------------------------------------------------*31470000
314800 5200-FILL-SEL-QUEUE-RECORD.                                      31480000
314900                                                                  31490000
315000     PERFORM 6112-READ-LIST-QUEUE.                                31500000
315100                                                                  31510000
315200     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       31520000
315300         PERFORM                                                  31530000
315400         VARYING LQW-IDX                                          31540000
315500         FROM 1 BY 1                                              31550000
315600         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            31560000
315700           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          31570000
315800                                                                  31580000
315900             IF  LQW-SELECT (LQW-IDX)                             31590000
316000                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              31600000
316100                                     TO TR108-ITEM (TR108-IDX)    31610000
316110                 MOVE ASC-KEY-PO-NBR                              31611021
316120                                     TO TR108-PO-NBR (TR108-IDX)  31612021
316300                 MOVE LQW-TRIP-ID (LQW-IDX)                       31630000
316400                                     TO TR108-TRIP-ID             31640000
316500                                        (TR108-IDX)               31650000
316600                                        TR109-TRIP-ID             31660000
316700                 MOVE 'I'           TO TR108-ACTION-SW (TR108-IDX)31670000
316800                 SET TR108-IDX UP BY 1                            31680000
316900                 IF  TR108-IDX > TR108-MAX-ITEMS                  31690000
317000                     PERFORM 5205-WRITE-SEL-QUEUE                 31700000
317100                     ADD +1        TO TR109-NUMBER-OF-TS-ITEMS    31710000
317200                     INITIALIZE TR108-SELECTED-ITEM-ARRAY         31720000
317300                     SET TR108-IDX TO  1                          31730000
317400                 END-IF                                           31740000
317500             END-IF                                               31750000
317600         END-PERFORM                                              31760000
317700     END-IF.                                                      31770000
317800                                                                  31780000
317900 EJECT                                                            31790000
318000*----------------------------------------------------------------*31800000
318100*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *31810000
318200*----------------------------------------------------------------*31820000
318300 5205-WRITE-SEL-QUEUE.                                            31830000
318400                                                                  31840000
318500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            31850000
318600                                   TO TR108-SELECTED-ITEMS.       31860000
318700                                                                  31870000
318800     EXEC CICS                                                    31880000
318900          WRITEQ TS                                               31890000
319000             QUEUE (ASC-SEL-QUEUE-NAME)                           31900000
319100             FROM  (TR108-PO-SEL-REC)                             31910000
319200             ITEM  (PV-SEL-QUEUE-ITEM)                            31920000
319300             RESP  (PV-CICS-RESP)                                 31930000
319400     END-EXEC.                                                    31940000
319500                                                                  31950000
319600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          31960000
319700         CONTINUE                                                 31970000
319800     ELSE                                                         31980000
319900         SET DP013-CICS-ABEND      TO TRUE                        31990000
320000         SET DP013-NO-ROLLBACK     TO TRUE                        32000000
320100         MOVE '5205-WRITE-SEL-QUEUE'                              32010000
320200                                   TO DP013-PARAGRAPH             32020000
320300         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          32030000
320400                                   TO DP013-MESSAGE-TEXT(1)       32040000
320500         PERFORM DP013-0000-PROCESS-ABEND                         32050000
320600     END-IF.                                                      32060000
320700                                                                  32070000
320800 EJECT                                                            32080000
320801*----------------------------------------------------------------*32080100
320802* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *32080200
320803* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *32080300
320804* FOR THE SELECTED ITEMS QUEUE.                                  *32080400
320805*                                                                *32080500
320806* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *32080600
320807* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *32080700
320808* THE ARRAY IS FULL.                                             *32080800
320809*----------------------------------------------------------------*32080900
320810 5600-PREPARE-SEL-QUEUE.                                          32081000
320811                                                                  32081100
320812     MOVE +1                   TO  ASC-BLK-SUB.                   32081200
320813     PERFORM 5100-WRITE-TEMP-STORAGE.                             32081300
320814     ADD +1                    TO  ASC-BLK-SUB.                   32081400
320815     PERFORM 5100-WRITE-TEMP-STORAGE.                             32081500
320816     MOVE ASC-SEL-QUEUE-NAME   TO  TR102-SEL-QUEUE-NAME.          32081600
320817     PERFORM 6010-DELETE-SEL-QUEUE.                               32081700
320818                                                                  32081800
320819     SET ASC-UPDATE-TSQ-1      TO  TRUE.                          32081900
320820                                                                  32082000
320821     SET TR101-IDX             TO  1.                             32082100
320822     MOVE ZERO                 TO TR102-NUMBER-OF-TS-ITEMS.       32082200
320823     INITIALIZE TR101-SELECTED-ITEM-ARRAY.                        32082300
320824                                                                  32082400
320825     PERFORM 5700-FILL-SEL-QUEUE-RECORD                           32082500
320826             VARYING PV-ITEM                                      32082600
320827             FROM 1 BY 1                                          32082700
320828             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     32082800
320829                                                                  32082900
320830     IF  TR101-IDX > 1                                            32083000
320831         PERFORM 5705-WRITE-SEL-QUEUE                             32083100
320832         ADD +1                    TO TR102-NUMBER-OF-TS-ITEMS    32083200
320833     END-IF.                                                      32083300
320834                                                                  32083400
320835 EJECT                                                            32083500
320836*----------------------------------------------------------------*32083600
320837* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *32083700
320838* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *32083800
320839*----------------------------------------------------------------*32083900
320840 5700-FILL-SEL-QUEUE-RECORD.                                      32084000
320841                                                                  32084100
320842     PERFORM 6112-READ-LIST-QUEUE.                                32084200
320843                                                                  32084300
320844     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       32084400
320845         PERFORM                                                  32084500
320846         VARYING LQW-IDX                                          32084600
320847         FROM 1 BY 1                                              32084700
320848         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            32084800
320849           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          32084900
320850                                                                  32085000
320851             IF  LQW-SELECT (LQW-IDX)                             32085100
320852                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              32085200
320853                                     TO TR101-ITEM (TR101-IDX)    32085300
320854                 MOVE LQW-CONTNR-NBR (LQW-IDX)                    32085400
320855                                     TO TR102-CONTNR-NO           32085500
320856                                        TR101-CONTNR-NO           32085600
320857                                        (TR101-IDX)               32085700
320858                 MOVE LQW-CONTNR-SEQ-NBR (LQW-IDX)                32085800
320859                                     TO TR102-CONTNR-SEQ-NO       32085900
320860                                        TR101-CONTNR-SEQ-NO       32086000
320870                                        (TR101-IDX)               32087000
320880                 MOVE LQW-CSTM-ENTRY (LQW-IDX)                    32088000
320890                                     TO TR102-CSTM-ENTRY-ID       32089000
320900                                        TR101-CSTM-ENTRY-ID       32090000
320901                                        (TR101-IDX)               32090100
320902                 MOVE 'I'           TO TR101-ACTION-SW (TR101-IDX)32090200
320903                 SET TR101-IDX UP BY 1                            32090300
320904                 IF  TR101-IDX > TR101-MAX-ITEMS                  32090400
320905                     PERFORM 5705-WRITE-SEL-QUEUE                 32090500
320906                     ADD +1        TO TR102-NUMBER-OF-TS-ITEMS    32090600
320907                     INITIALIZE TR101-SELECTED-ITEM-ARRAY         32090700
320908                     SET TR101-IDX TO  1                          32090800
320909                 END-IF                                           32090900
320910             END-IF                                               32091000
320911         END-PERFORM                                              32091100
320912     END-IF.                                                      32091200
320913                                                                  32091300
320914 EJECT                                                            32091400
320915*----------------------------------------------------------------*32091500
320916*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *32091600
320917*----------------------------------------------------------------*32091700
320918 5705-WRITE-SEL-QUEUE.                                            32091800
320919                                                                  32091900
320920     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            32092000
320921                                   TO TR101-SELECTED-ITEMS.       32092100
320922                                                                  32092200
320923     EXEC CICS                                                    32092300
320924          WRITEQ TS                                               32092400
320925             QUEUE (ASC-SEL-QUEUE-NAME)                           32092500
320926             FROM  (TR101-VOYAGE-SEL-REC)                         32092600
320927             ITEM  (PV-SEL-QUEUE-ITEM)                            32092700
320928             RESP  (PV-CICS-RESP)                                 32092800
320929     END-EXEC.                                                    32092900
320930                                                                  32093000
320931     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          32093100
320932         CONTINUE                                                 32093200
320933     ELSE                                                         32093300
320934         SET DP013-CICS-ABEND      TO TRUE                        32093400
320935         SET DP013-NO-ROLLBACK     TO TRUE                        32093500
320936         MOVE '7205-WRITE-SEL-QUEUE'                              32093600
320937                                   TO DP013-PARAGRAPH             32093700
320938         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          32093800
320939                                   TO DP013-MESSAGE-TEXT(1)       32093900
320940         PERFORM DP013-0000-PROCESS-ABEND                         32094000
320941     END-IF.                                                      32094100
320942                                                                  32094200
320943 EJECT                                                            32094300
320944*----------------------------------------------------------------*32094400
321000*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *32100000
321100*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *32110000
321200*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *32120000
321300*  THE USER.                                                     *32130000
321400*----------------------------------------------------------------*32140000
321500 6000-REFRESH-PANEL-FROM-TEMP.                                    32150000
321600                                                                  32160000
321700     IF  ASC-UPDATE-TSQ                                           32170000
321800         SET ASC-NO-TSQ-UPDATE TO TRUE                            32180000
321900         MOVE ZERO                 TO PV-SAVE-ITEM                32190000
322000                                      PV-SEL-QUEUE-ITEM           32200000
322100         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        32210000
322200                                   TO PV-HOLD-SELECTED-ITEMS      32220000
322300         MOVE +1                   TO PV-ITEMS-PROCESSED          32230000
322400         PERFORM 6100-UPDATE-TSQ                                  32240000
322500             UNTIL PV-ITEMS-PROCESSED >                           32250000
322600                                     PV-HOLD-SELECTED-ITEMS       32260000
322700         PERFORM 6010-DELETE-SEL-QUEUE                            32270000
322800         INITIALIZE ASC-BLOCK-ENTRIES (1)                         32280000
322900                    ASC-BLOCK-ENTRIES (2)                         32290000
323000     END-IF.                                                      32300000
323100                                                                  32310000
323200 EJECT                                                            32320000
323300*----------------------------------------------------------------*32330000
323400*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *32340000
323500*----------------------------------------------------------------*32350000
323600 6010-DELETE-SEL-QUEUE.                                           32360000
323700                                                                  32370000
323800     EXEC CICS                                                    32380000
323900         DELETEQ TS                                               32390000
324000             QUEUE (ASC-SEL-QUEUE-NAME)                           32400000
324100             RESP  (PV-CICS-RESP)                                 32410000
324200     END-EXEC.                                                    32420000
324300                                                                  32430000
324400     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      32440000
324500        (PV-CICS-RESP = DFHRESP(QIDERR)))                         32450000
324600         CONTINUE                                                 32460000
324700     ELSE                                                         32470000
324800         SET DP013-CICS-ABEND TO TRUE                             32480000
324900         SET DP013-NO-ROLLBACK TO TRUE                            32490000
325000         MOVE '6010-DELETE-SEL-QUEUE'                             32500000
325100                        TO DP013-PARAGRAPH                        32510000
325200         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         32520000
325300                        TO DP013-MESSAGE-TEXT (1)                 32530000
325400         PERFORM DP013-0000-PROCESS-ABEND                         32540000
325500     END-IF.                                                      32550000
325600                                                                  32560000
325700 EJECT                                                            32570000
325800*----------------------------------------------------------------*32580000
325900*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *32590000
326000*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *32600000
326100*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *32610000
326200*    THE TEMP QUEUE.                                             *32620000
326300*----------------------------------------------------------------*32630000
326400 6100-UPDATE-TSQ.                                                 32640000
326500                                                                  32650000
326600     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             32660000
326700     PERFORM 6105-READ-SEL-QUEUE.                                 32670000
326800     PERFORM                                                      32680000
326900         VARYING TR108-IDX                                        32690000
327000         FROM 1 BY 1                                              32700000
327100         UNTIL ((PV-ITEMS-PROCESSED >                             32710000
327200                              PV-HOLD-SELECTED-ITEMS)             32720000
327300         OR (TR108-IDX GREATER THAN TR108-MAX-ITEMS))             32730000
327400         IF  TR108-ACTION-SW (TR108-IDX) > SPACE                  32740000
327500             PERFORM 6110-PROCESS-ITEMS                           32750000
327600         END-IF                                                   32760000
327700         ADD +1                TO PV-ITEMS-PROCESSED              32770000
327800     END-PERFORM.                                                 32780000
327900     PERFORM 6111-WRITE-LIST-QUEUE.                               32790000
328000                                                                  32800000
328100 EJECT                                                            32810000
328200*----------------------------------------------------------------*32820000
328300*    READ THE LIST QUEUE RECORD.                                 *32830000
328400*----------------------------------------------------------------*32840000
328500 6105-READ-SEL-QUEUE.                                             32850000
328600                                                                  32860000
328700     EXEC CICS                                                    32870000
328800          READQ TS                                                32880000
328900             QUEUE (ASC-SEL-QUEUE-NAME)                           32890000
329000             INTO  (TR108-PO-SEL-REC)                             32900000
329100             ITEM  (PV-SEL-QUEUE-ITEM)                            32910000
329200             RESP  (PV-CICS-RESP)                                 32920000
329300     END-EXEC.                                                    32930000
329400                                                                  32940000
329500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          32950000
329600         CONTINUE                                                 32960000
329700     ELSE                                                         32970000
329800         SET DP013-CICS-ABEND      TO  TRUE                       32980000
329900         SET DP013-NO-ROLLBACK     TO  TRUE                       32990000
330000         MOVE '6105-READ-SEL-QUEUE'                               33000000
330100                                   TO  DP013-PARAGRAPH            33010000
330200         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           33020000
330300                                   TO  DP013-MESSAGE-TEXT(1)      33030000
330400         PERFORM DP013-0000-PROCESS-ABEND                         33040000
330500     END-IF.                                                      33050000
330600                                                                  33060000
330700 EJECT                                                            33070000
330800*----------------------------------------------------------------*33080000
330900*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*33090000
331000*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*33100000
331100*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *33110000
331200*----------------------------------------------------------------*33120000
331300 6110-PROCESS-ITEMS.                                              33130000
331400                                                                  33140000
331500     COMPUTE PV-ITEM = 1 + ((TR108-ITEM (TR108-IDX) - 1)          33150000
331600                     / PC-ITEMS-PER-PANEL).                       33160000
331700                                                                  33170000
331800     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           33180000
331900         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          33190000
332000             PERFORM 6111-WRITE-LIST-QUEUE                        33200000
332100         END-IF                                                   33210000
332200         MOVE PV-ITEM          TO PV-SAVE-ITEM                    33220000
332300                                                                  33230000
332400         PERFORM 6112-READ-LIST-QUEUE                             33240000
332500         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               33250000
332600             CONTINUE                                             33260000
332700         END-IF                                                   33270000
332800     END-IF.                                                      33280000
332900                                                                  33290000
333000     COMPUTE PV-SUB = (TR108-ITEM (TR108-IDX)                     33300000
333100                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              33310000
333200     SET LQW-DESELECT (PV-SUB) TO    TRUE.                        33320000
333300     MOVE LQW-SELECTED-SW (PV-SUB)                                33330000
333400                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  33340000
333500                                                                  33350000
333600     IF TR108-INQ (TR108-IDX)                                     33360000
333700        MOVE PC-INQ            TO LQW-ACTION (PV-SUB)             33370000
333800     END-IF.                                                      33380000
333900                                                                  33390000
334000     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                33400000
334100                                                                  33410000
334200 EJECT                                                            33420000
334300*----------------------------------------------------------------*33430000
334400*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *33440000
334500*----------------------------------------------------------------*33450000
334600 6111-WRITE-LIST-QUEUE.                                           33460000
334700                                                                  33470000
334800     EXEC CICS                                                    33480000
334900         WRITEQ TS                                                33490000
335000             QUEUE (ASC-LIST-QUEUE-NAME)                          33500000
335100             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     33510000
335200             ITEM  (PV-SAVE-ITEM)                                 33520000
335300             REWRITE                                              33530000
335400             RESP  (PV-CICS-RESP)                                 33540000
335500     END-EXEC.                                                    33550000
335600                                                                  33560000
335700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          33570000
335800         CONTINUE                                                 33580000
335900     ELSE                                                         33590000
336000         SET DP013-CICS-ABEND  TO  TRUE                           33600000
336100         SET DP013-NO-ROLLBACK TO  TRUE                           33610000
336200         MOVE '6111-WRITE-LIST-QUEUE'                             33620000
336300                               TO  DP013-PARAGRAPH                33630000
336400         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  33640000
336500                               TO  DP013-MESSAGE-TEXT(1)          33650000
336600         PERFORM DP013-0000-PROCESS-ABEND                         33660000
336700     END-IF.                                                      33670000
336800                                                                  33680000
336900 EJECT                                                            33690000
337000*----------------------------------------------------------------*33700000
337100*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*33710000
337200*----------------------------------------------------------------*33720000
337300 6112-READ-LIST-QUEUE.                                            33730000
337400                                                                  33740000
337500     EXEC CICS                                                    33750000
337600         READQ TS                                                 33760000
337700             QUEUE (ASC-LIST-QUEUE-NAME)                          33770000
337800             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     33780000
337900             ITEM  (PV-ITEM)                                      33790000
338000             RESP  (PV-CICS-RESP)                                 33800000
338100     END-EXEC.                                                    33810000
338200                                                                  33820000
338300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          33830000
338400         CONTINUE                                                 33840000
338500     ELSE                                                         33850000
338600         SET DP013-CICS-ABEND        TO TRUE                      33860000
338700         SET DP013-NO-ROLLBACK       TO TRUE                      33870000
338800         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           33880000
338900         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    33890000
339000                                     TO DP013-MESSAGE-TEXT(1)     33900000
339100         PERFORM DP013-0000-PROCESS-ABEND                         33910000
339200     END-IF.                                                      33920000
339300                                                                  33930000
339400 EJECT                                                            33940000
339401*----------------------------------------------------------------*33940100
339402*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *33940200
339403*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *33940300
339404*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *33940400
339405*  THE USER.                                                     *33940500
339406*----------------------------------------------------------------*33940600
339407 7000-REFRESH-PANEL-FROM-TEMP.                                    33940700
339408                                                                  33940800
339409     IF  ASC-UPDATE-TSQ-1                                         33940900
339410         SET ASC-NO-TSQ-UPDATE-1 TO TRUE                          33941000
339411         MOVE ZERO                 TO PV-SAVE-ITEM                33941100
339412                                      PV-SEL-QUEUE-ITEM           33941200
339413         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        33941300
339414                                   TO PV-HOLD-SELECTED-ITEMS      33941400
339415         MOVE +1                   TO PV-ITEMS-PROCESSED          33941500
339416         PERFORM 7100-UPDATE-TSQ                                  33941600
339417             UNTIL PV-ITEMS-PROCESSED >                           33941700
339418                                     PV-HOLD-SELECTED-ITEMS       33941800
339419         PERFORM 6010-DELETE-SEL-QUEUE                            33941900
339420         INITIALIZE ASC-BLOCK-ENTRIES (1)                         33942000
339421                    ASC-BLOCK-ENTRIES (2)                         33942100
339422     END-IF.                                                      33942200
339423 EJECT                                                            33942300
339424*----------------------------------------------------------------*33942400
339425*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *33942500
339426*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *33942600
339427*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *33942700
339428*    THE TEMP QUEUE.                                             *33942800
339429*----------------------------------------------------------------*33942900
339430 7100-UPDATE-TSQ.                                                 33943000
339431                                                                  33943100
339432     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             33943200
339433     PERFORM 7105-READ-SEL-QUEUE.                                 33943300
339434     PERFORM                                                      33943400
339435         VARYING TR101-IDX                                        33943500
339436         FROM 1 BY 1                                              33943600
339437         UNTIL ((PV-ITEMS-PROCESSED >                             33943700
339438                              PV-HOLD-SELECTED-ITEMS)             33943800
339439         OR (TR101-IDX GREATER THAN TR101-MAX-ITEMS))             33943900
339440         IF  TR101-ACTION-SW (TR101-IDX) > SPACE                  33944000
339441             PERFORM 7110-PROCESS-ITEMS                           33944100
339442         END-IF                                                   33944200
339443         ADD +1                TO PV-ITEMS-PROCESSED              33944300
339444     END-PERFORM.                                                 33944400
339445     PERFORM 6111-WRITE-LIST-QUEUE.                               33944500
339446                                                                  33944600
339447 EJECT                                                            33944700
339448*----------------------------------------------------------------*33944800
339449*    READ THE LIST QUEUE RECORD.                                 *33944900
339450*----------------------------------------------------------------*33945000
339451 7105-READ-SEL-QUEUE.                                             33945100
339452                                                                  33945200
339453     EXEC CICS                                                    33945300
339454          READQ TS                                                33945400
339455             QUEUE (ASC-SEL-QUEUE-NAME)                           33945500
339456             INTO  (TR101-VOYAGE-SEL-REC)                         33945600
339457             ITEM  (PV-SEL-QUEUE-ITEM)                            33945700
339458             RESP  (PV-CICS-RESP)                                 33945800
339459     END-EXEC.                                                    33945900
339460                                                                  33946000
339461     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          33946100
339462         CONTINUE                                                 33946200
339463     ELSE                                                         33946300
339464         SET DP013-CICS-ABEND      TO  TRUE                       33946400
339465         SET DP013-NO-ROLLBACK     TO  TRUE                       33946500
339466         MOVE '7105-READ-SEL-QUEUE'                               33946600
339467                                   TO  DP013-PARAGRAPH            33946700
339468         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           33946800
339469                                   TO  DP013-MESSAGE-TEXT(1)      33946900
339470         PERFORM DP013-0000-PROCESS-ABEND                         33947000
339471     END-IF.                                                      33947100
339472                                                                  33947200
339473 EJECT                                                            33947300
339474*----------------------------------------------------------------*33947400
339475*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*33947500
339476*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*33947600
339477*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *33947700
339478*----------------------------------------------------------------*33947800
339479 7110-PROCESS-ITEMS.                                              33947900
339480                                                                  33948000
339481     COMPUTE PV-ITEM = 1 + ((TR101-ITEM (TR101-IDX) - 1)          33948100
339482                     / PC-ITEMS-PER-PANEL).                       33948200
339483                                                                  33948300
339484     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           33948400
339485         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          33948500
339486             PERFORM 6111-WRITE-LIST-QUEUE                        33948600
339487         END-IF                                                   33948700
339488         MOVE PV-ITEM          TO PV-SAVE-ITEM                    33948800
339489                                                                  33948900
339490         PERFORM 6112-READ-LIST-QUEUE                             33949000
339491         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               33949100
339492             CONTINUE                                             33949200
339493         END-IF                                                   33949300
339494     END-IF.                                                      33949400
339495                                                                  33949500
339496     COMPUTE PV-SUB = (TR101-ITEM (TR101-IDX)                     33949600
339497                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              33949700
339498     SET LQW-DESELECT (PV-SUB) TO    TRUE.                        33949800
339499     MOVE LQW-SELECTED-SW (PV-SUB)                                33949900
339500                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  33950000
339501                                                                  33950100
339502     IF TR101-INQ (TR101-IDX)                                     33950200
339503        MOVE PC-INQ            TO LQW-ACTION (PV-SUB)             33950300
339504     END-IF.                                                      33950400
339505                                                                  33950500
339506     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                33950600
339507                                                                  33950700
339508 EJECT                                                            33950800
339509*----------------------------------------------------------------*33950900
339600*    ABEND PROCESSOR MODULE                                      *33960000
339700*----------------------------------------------------------------*33970000
339800                                                                  33980000
339900     COPY DPPD013.                                                33990000
