000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.             TMKRP015.                                00020080
000300 AUTHOR.                 VIRGENE LENNEMAN.                        00030081
000400 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00040081
000500 DATE-WRITTEN            02/10/98.                                00050081
000600 DATE-COMPILED.                                                   00060081
000700                                                                  00070081
000800 ENVIRONMENT DIVISION.                                            00080081
000900 INPUT-OUTPUT SECTION.                                            00090081
001000                                                                  00100081
001100 FILE-CONTROL.                                                    00110081
001200                                                                  00120081
001300     SELECT TROUBLE-EXTRACT-FILE      ASSIGN TO INP01.            00130081
001400     SELECT TROUBLE-REPORT            ASSIGN TO RPT01.            00140081
001410     SELECT TROUBLE-REPORT-SUMMARY    ASSIGN TO RPT02.            00141081
001420                                                                  00142081
001430                                                                  00143081
001440 DATA DIVISION.                                                   00144081
001450                                                                  00145081
001460 FILE SECTION.                                                    00146081
001470 FD  TROUBLE-EXTRACT-FILE                                         00147081
001480     RECORDING MODE IS F                                          00148081
001490     LABEL RECORDS ARE STANDARD                                   00149081
001500     BLOCK CONTAINS 0 RECORDS.                                    00150081
001600                                                                  00160081
001700 01  TROUBLE-EXTRACT-RECORD         PIC X(400).                   00170081
001800                                                                  00180081
001900 FD  TROUBLE-REPORT                                               00190081
002000     RECORDING MODE IS F                                          00200081
002100     LABEL RECORDS ARE STANDARD                                   00210081
002200     BLOCK CONTAINS 0 RECORDS.                                    00220081
002300                                                                  00230081
002400 01  TROUBLE-RECORD                 PIC X(132).                   00240081
002500                                                                  00250081
002600 FD  TROUBLE-REPORT-SUMMARY                                       00260081
002700     RECORDING MODE IS F                                          00270081
002800     LABEL RECORDS ARE STANDARD                                   00280081
002900     BLOCK CONTAINS 0 RECORDS.                                    00290081
003000                                                                  00300081
003100 01  TROUBLE-RECORD-SUMMARY         PIC X(132).                   00310081
003200                                                                  00320081
003300 WORKING-STORAGE SECTION.                                         00330081
003400 01  PS-SWITCHES.                                                 00340081
003500     05  PS-EOF-SW                   PIC  X(01)    VALUE 'N'.     00350081
003600         88  PS-EOF                                VALUE 'Y'.     00360081
003700         88  PS-NOT-EOF                            VALUE 'N'.     00370081
003800     05  PS-WHICH-AL-SW              PIC  X(01)    VALUE '1'.     00380081
003900         88  PS-1ST-AL-REC                         VALUE '1'.     00390081
004000         88  PS-2ND-AL-REC                         VALUE '2'.     00400081
004100         88  PS-BOTH-AL-RECS                       VALUE 'B'.     00410081
004200     05  PS-WHICH-BF-SW              PIC  X(01)    VALUE '1'.     00420081
004300         88  PS-1ST-BF-REC                         VALUE '1'.     00430081
004400         88  PS-2ND-BF-REC                         VALUE '2'.     00440081
004500         88  PS-BOTH-BF-RECS                       VALUE 'B'.     00450081
004610     05  PS-WHICH-TIME-SW            PIC  X(01)    VALUE 'Y'.     00461069
004620         88  PS-1ST-TIME                           VALUE 'Y'.     00462069
004630         88  PS-NOT-1ST-TIME                       VALUE 'N'.     00463069
004640     05  PS-WHICH-PAGE-SW            PIC  X(01)    VALUE 'Y'.     00464068
004650         88  PS-1ST-PAGE                           VALUE 'Y'.     00465068
004660         88  PS-NOT-1ST-PAGE                       VALUE 'N'.     00466068
004700                                                                  00470000
004800 01  PC-PROGRAM-CONSTANTS.                                        00480000
004900     05  PC-CURRENT-PGM-NAME         PIC  X(08)    VALUE          00490006
005000                                    'TMKRP015'.                   00500018
005100     05  PC-LINE-LIMIT               PIC S9(04)    VALUE +60      00510051
005200                                                   COMP SYNC.     00520000
005210     05  PC-DEPT-LIMIT               PIC S9(04)    VALUE +52      00521064
005220                                                   COMP SYNC.     00522051
005230     05  PC-TRBL-LIMIT               PIC S9(04)    VALUE +54      00523062
005240                                                   COMP SYNC.     00524051
005300     05  PC-SPECIAL-RUN-NOTE         PIC X(27)     VALUE          00530000
005400                                    '** SPECIAL REQUESTED RUN **'.00540000
005500     05  PC-ONE                      PIC 9(01)     VALUE  1.      00550000
005501     05  PC-TWO                      PIC 9(01)     VALUE  2.      00550173
005510     05  PC-99999                    PIC 9(05)     VALUE  99999.  00551065
005600******  13 BYTE FIELDS USED IN HL2-REPORT-PERIOD FIELD            00560000
005700     05  PC-CAL-YR13            PIC X(13)  VALUE 'CALENDAR YEAR'. 00570000
005800     05  PC-FIS-YR13            PIC X(13)  VALUE '  FISCAL YEAR'. 00580000
005900     05  PC-SPRING-SEAS13       PIC X(13)  VALUE 'SPRING SEASON'. 00590000
006000     05  PC-FALL-SEAS13         PIC X(13)  VALUE '  FALL SEASON'. 00600000
006100     05  PC-MONTH13             PIC X(13)  VALUE '        MONTH'. 00610000
006200     05  PC-TROUBLE             PIC X(07)  VALUE 'TROUBLE'.       00620037
006210     05  PC-NOTIFY              PIC X(07)  VALUE 'NOTIFY '.       00621037
006300                                                                  00630000
006400 01  PV-PROGRAM-VARIABLES.                                        00640000
006500     05  PV-SPECIAL-RUN-DATES.                                    00650000
006600         10  FILLER                  PIC X(02)     VALUE '* '.    00660000
006700         10  PV-SPECIAL-START-DT     PIC X(10)     VALUE SPACES.  00670000
006800         10  FILLER                  PIC X(03)     VALUE ' - '.   00680000
006900         10  PV-SPECIAL-END-DT       PIC X(10)     VALUE SPACES.  00690000
007000         10  FILLER                  PIC X(02)     VALUE ' *'.    00700000
007100     05  PV-TRBL-LINE-COUNT          PIC S9(04)    VALUE +80      00710000
007200                                                   COMP SYNC.     00720000
007300     05  PV-TRBL-PAGE-COUNT          PIC S9(04)    VALUE 0        00730000
007400                                                   COMP SYNC.     00740000
007500     05  PV-TRBL-LINE-CNT-SUM        PIC S9(04)    VALUE +80      00750067
007600                                                   COMP SYNC.     00760067
007700     05  PV-TRBL-PAGE-CNT-SUM        PIC S9(04)    VALUE 0        00770067
007800                                                   COMP SYNC.     00780067
007900     05  PV-START-DATE               PIC  X(10)    VALUE SPACE.   00790000
008000     05  PV-END-DATE                 PIC  X(10)    VALUE SPACE.   00800000
008100     05  PV-START-EXTRACT.                                        00810000
008200         10 PV-START-YYYY.                                        00820000
008300            15 PV-START-CC           PIC 9(02)     VALUE 0.       00830000
008400            15 PV-START-YY           PIC 9(02)     VALUE 0.       00840000
008500         10 FILLER                   PIC X(01)     VALUE SPACE.   00850000
008600         10 PV-START-MM              PIC 9(02)     VALUE 0.       00860000
008700         10 FILLER                   PIC X(01)     VALUE SPACE.   00870000
008800         10 PV-START-DD              PIC 9(02)     VALUE 0.       00880000
008900         10 FILLER                   PIC X(01)     VALUE SPACE.   00890000
009000     05  PV-END-EXTRACT.                                          00900000
009100         10 PV-END-YYYY.                                          00910000
009200            15 PV-END-CC             PIC 9(02)     VALUE 0.       00920000
009300            15 PV-END-YY             PIC 9(02)     VALUE 0.       00930000
009400         10 FILLER                   PIC X(01)     VALUE SPACE.   00940000
009500         10 PV-END-MM                PIC 9(02)     VALUE 0.       00950000
009600         10 FILLER                   PIC X(01)     VALUE SPACE.   00960000
009700         10 PV-END-DD                PIC 9(02)     VALUE 0.       00970000
009800         10 FILLER                   PIC X(01)     VALUE SPACE.   00980000
010400     05  PV-ABEND-CODE              PIC  9(04)   VALUE ZEROS.     01040006
010500     05  PV-ABEND-PARA-NAME         PIC  X(30)   VALUE SPACES.    01050006
010600     05  PV-PARAGRAPH-NAME          PIC  X(30)   VALUE SPACES.    01060006
010700     05  PV-DB2-OPERATION-MSG-1     PIC  X(40)   VALUE SPACES.    01070006
010800     05  PV-DB2-TABLE-NAME          PIC  X(12)   VALUE SPACES.    01080006
010900     05  PV-SQLCODE                 PIC  Z(08)9-.                 01090006
011000     05  PV-HOLD-TOTAL              PIC  9(07)     VALUE ZEROS.   01100033
011100     05  PV-HOLD-TROUBLE            PIC  9(07)     VALUE ZEROS.   01110033
011200     05  PV-HOLD-PERCENT            PIC  9(03)V99  VALUE ZEROS.   01120044
011300     05  PV-HOLD-ACTUAL-TOT-QTY     PIC  9(07)     VALUE ZEROS.   01130033
011310     05  PV-HOLD-NOTIFY-TOT-QTY     PIC  9(07)     VALUE ZEROS.   01131033
011400     05  PV-TOTAL-ASSIGN-TOT-QTY    PIC  9(07)     VALUE ZEROS.   01140033
011500     05  PV-NBR-VENDORS             PIC  9(05)     VALUE ZEROS.   01150017
011510     05  PV-VENDOR-LIMIT            PIC  9(05)     VALUE ZEROS.   01151020
011520     05  PV-QUOTIENT                PIC S9(04)     VALUE ZEROS.   01152076
011530     05  PV-REMAINDER               PIC S9(04)     VALUE ZEROS.   01153076
011600                                                                  01160000
011700 01  CT-CPU-TIME.                                                 01170000
011800     03  CT-HOUR                     PIC  9(02)    VALUE ZERO.    01180000
011900     03  CT-MINUTE                   PIC  9(02)    VALUE ZERO.    01190000
012000     03  FILLER                      PIC  9(04)    VALUE ZERO.    01200000
012100                                                                  01210000
012200 01  CD-CPU-DATE.                                                 01220000
012300     03  CD-YEAR                     PIC  9(02)    VALUE ZERO.    01230000
012400     03  CD-MONTH                    PIC  9(02)    VALUE ZERO.    01240000
012500     03  CD-DAY                      PIC  9(02)    VALUE ZERO.    01250000
012600                                                                  01260000
012700                                                                  01270000
012800********************* MAIN HEADINGS ***************************** 01280002
012900                                                                  01290004
013000     COPY DPWS132O.                                               01300004
013100                                                                  01310004
013200 01  HL1-HEADING-LINE-1.                                          01320000
013300     05  FILLER                      PIC  X(02)    VALUE SPACES.  01330000
013400     05  HL1-SPECIAL-RUN-NOTE        PIC  X(27)    VALUE SPACES.  01340002
013500     05  FILLER                      PIC  X(25)    VALUE SPACES.  01350001
013600     05  FILLER                      PIC  X(04)    VALUE 'TOP '.  01360001
013700     05  HL1-NBR-TRBL-VEND           PIC  ZZZZ9.                  01370002
013800     05  FILLER                      PIC  X(16)    VALUE          01380010
013900                              ' TROUBLE VENDORS'.                 01390002
014000     05  FILLER                      PIC  X(53)    VALUE SPACES.  01400002
014100                                                                  01410002
014101***** THIS LINE FOR SUMMARY REPORT TMKRP015-2                     01410166
014110 01  HL1S-HEADING-LINE-1-SUM.                                     01411066
014120     05  FILLER                      PIC  X(02)    VALUE SPACES.  01412066
014130     05  HL1S-SPECIAL-RUN-NOTE-SUM   PIC  X(27)    VALUE SPACES.  01413066
014140     05  FILLER                      PIC  X(25)    VALUE SPACES.  01414066
014150     05  FILLER                      PIC  X(04)    VALUE 'TOP '.  01415066
014160     05  HL1S-NBR-TRBL-VEND-SUM      PIC  ZZZZ9.                  01416066
014170     05  FILLER                      PIC  X(24)    VALUE          01417066
014180                              ' TROUBLE VENDORS SUMMARY'.         01418066
014190     05  FILLER                      PIC  X(45)    VALUE SPACES.  01419066
014191                                                                  01419166
014200 01  HL2-HEADING-LINE-2.                                          01420000
014300     05  FILLER                      PIC  X(02)    VALUE SPACES.  01430000
014400     05  HL2-SPECIAL-RUN-DATES       PIC  X(27)    VALUE SPACES.  01440000
014500     05  FILLER                      PIC  X(18)    VALUE SPACES.  01450000
014600     05  HL2-REPORT-PERIOD           PIC  X(13)    VALUE SPACES.  01460000
014700     05  FILLER                      PIC  X(01)    VALUE SPACES.  01470000
014800     05  FILLER                      PIC  X(06)    VALUE          01480000
014900                                      'ENDING'.                   01490000
015000     05  FILLER                      PIC  X(01)    VALUE SPACES.  01500000
015100     05  HL2-END-DATE                PIC  X(10)    VALUE SPACES.  01510000
015200     05  FILLER                      PIC  X(56)    VALUE SPACES.  01520002
015300                                                                  01530000
015400******************* COLUMN HEADINGS ***************************** 01540002
015500                                                                  01550004
015600 01  HL3-HEADING-LINE-3.                                          01560000
015700     05  FILLER                      PIC  X(51)  VALUE SPACES.    01570035
015800     05  FILLER                      PIC  X(05)  VALUE 'TOTAL'.   01580002
015900     05  FILLER                      PIC  X(03)  VALUE SPACE.     01590035
016000     05  FILLER                      PIC  X(04)  VALUE '% PO'.    01600035
016100     05  FILLER                      PIC  X(05)  VALUE SPACES.    01610037
016200     05  FILLER                      PIC  X(05)  VALUE 'TOTAL'.   01620035
016300     05  FILLER                      PIC  X(04)  VALUE SPACES.    01630035
016400     05  FILLER                      PIC  X(05)  VALUE 'TOTAL'.   01640002
016500     05  FILLER                      PIC  X(05)  VALUE SPACES.    01650035
016510     05  FILLER                      PIC  X(01)  VALUE '%'.       01651035
016520     05  FILLER                      PIC  X(05)  VALUE SPACES.    01652035
016600     05  FILLER                      PIC  X(06)  VALUE 'ACTUAL'.  01660002
016700     05  FILLER                      PIC  X(04)  VALUE SPACES.    01670035
016800     05  FILLER                      PIC  X(01)  VALUE '%'.       01680035
016900     05  FILLER                      PIC  X(05)  VALUE SPACES.    01690035
017000     05  FILLER                      PIC  X(06)  VALUE 'NOTIFY'.  01700002
017100     05  FILLER                      PIC  X(04)  VALUE SPACES.    01710035
017110     05  FILLER                      PIC  X(01)  VALUE '%'.       01711035
017120     05  FILLER                      PIC  X(06)  VALUE SPACES.    01712035
017130     05  FILLER                      PIC  X(05)  VALUE 'TOTAL'.   01713035
017140     05  FILLER                      PIC  X(01)  VALUE SPACES.    01714035
017200                                                                  01720000
017300 01  HL4-HEADING-LINE-4.                                          01730000
017400     05  FILLER                      PIC  X(33)  VALUE SPACES.    01740035
017500     05  FILLER                      PIC  X(03)  VALUE 'VDR'.     01750035
017600     05  FILLER                      PIC  X(05)  VALUE SPACE.     01760035
017700     05  FILLER                      PIC  X(05)  VALUE 'TOTAL'.   01770035
017900     05  FILLER                      PIC  X(06)  VALUE SPACES.    01790035
018000     05  FILLER                      PIC  X(04)  VALUE '# PO'.    01800037
018200     05  FILLER                      PIC  X(04)  VALUE SPACES.    01820035
018300     05  FILLER                      PIC  X(02)  VALUE 'IN'.      01830035
018500     05  FILLER                      PIC  X(06)  VALUE SPACES.    01850035
018600     05  FILLER                      PIC  X(05)  VALUE '#  OF'.   01860035
018700     05  FILLER                      PIC  X(03)  VALUE SPACES.    01870035
018800     05  FILLER                      PIC  X(07)  VALUE '# RCVRS'. 01880035
018900     05  FILLER                      PIC  X(02)  VALUE SPACES.    01890035
019000     05  FILLER                      PIC  X(05)  VALUE 'RCVRS'.   01900035
019100     05  FILLER                      PIC  X(04)  VALUE SPACES.    01910003
019200     05  FILLER                      PIC  X(04)  VALUE 'TRBL'.    01920035
019300     05  FILLER                      PIC  X(04)  VALUE SPACES.    01930003
019400     05  FILLER                      PIC  X(04)  VALUE 'ACTL'.    01940035
019500     05  FILLER                      PIC  X(04)  VALUE SPACES.    01950035
019510     05  FILLER                      PIC  X(04)  VALUE 'TRBL'.    01951035
019520     05  FILLER                      PIC  X(04)  VALUE SPACES.    01952035
019530     05  FILLER                      PIC  X(04)  VALUE 'NTFY'.    01953035
019540     05  FILLER                      PIC  X(04)  VALUE SPACES.    01954035
019550     05  FILLER                      PIC  X(04)  VALUE 'TRBL'.    01955035
019560     05  FILLER                      PIC  X(02)  VALUE SPACES.    01956035
019600                                                                  01960000
019700 01  HL5-HEADING-LINE-5.                                          01970003
019800     05  FILLER                      PIC  X(06)  VALUE SPACES.    01980037
019900     05  FILLER                      PIC  X(16)  VALUE            01990003
020000                                            'VENDOR NAME/DEPT'.   02000003
020100     05  FILLER                      PIC  X(11)  VALUE SPACE.     02010035
020200     05  FILLER                      PIC  X(04)  VALUE 'RANK'.    02020003
020300     05  FILLER                      PIC  X(03)  VALUE SPACES.    02030035
020400     05  FILLER                      PIC  X(07)  VALUE '# OF PO'. 02040035
020600     05  FILLER                      PIC  X(03)  VALUE SPACES.    02060003
020700     05  FILLER                      PIC  X(07)  VALUE 'IN TRBL'. 02070035
020900     05  FILLER                      PIC  X(02)  VALUE SPACES.    02090035
021000     05  FILLER                      PIC  X(04)  VALUE 'TRBL'.    02100035
021200     05  FILLER                      PIC  X(05)  VALUE SPACES.    02120035
021300     05  FILLER                      PIC  X(05)  VALUE 'RCVRS'.   02130035
021400     05  FILLER                      PIC  X(03)  VALUE SPACES.    02140003
021500     05  FILLER                      PIC  X(07)  VALUE 'IN TRBL'. 02150035
021600     05  FILLER                      PIC  X(01)  VALUE SPACES.    02160035
021700     05  FILLER                      PIC  X(06)  VALUE 'IN TRB'.  02170035
021800     05  FILLER                      PIC  X(03)  VALUE SPACES.    02180003
021900     05  FILLER                      PIC  X(07)  VALUE 'CREATED'. 02190035
022000     05  FILLER                      PIC  X(02)  VALUE SPACES.    02200035
022100     05  FILLER                      PIC  X(04)  VALUE 'TRBL'.    02210035
022200     05  FILLER                      PIC  X(03)  VALUE SPACES.    02220035
022210     05  FILLER                      PIC  X(07)  VALUE 'CREATED'. 02221035
022220     05  FILLER                      PIC  X(02)  VALUE SPACES.    02222035
022230     05  FILLER                      PIC  X(04)  VALUE 'TRBL'.    02223035
022240     05  FILLER                      PIC  X(03)  VALUE SPACES.    02224035
022250     05  FILLER                      PIC  X(07)  VALUE 'CREATED'. 02225035
022300                                                                  02230003
022400 01  HL6-HEADING-LINE-6.                                          02240004
022500     05  FILLER                      PIC  X(36)  VALUE SPACES.    02250035
022600     05  FILLER                      PIC  X(11)  VALUE            02260035
022700                                            'TROUBLE RSN'.        02270004
022701     05  FILLER                      PIC  X(03)  VALUE SPACES.    02270137
022710     05  FILLER                      PIC  X(12)  VALUE            02271035
022720                                            'TROUBLE TYPE'.       02272035
022800     05  FILLER                      PIC  X(03)  VALUE SPACE.     02280004
022900     05  FILLER                      PIC  X(19)  VALUE            02290010
023000                                           'TROUBLE DESCRIPTION'. 02300004
023100     05  FILLER                      PIC  X(05)  VALUE SPACES.    02310004
023200     05  FILLER                      PIC  X(15)  VALUE            02320035
023300                                            'TROUBLE CREATED'.    02330035
023310     05  FILLER                      PIC  X(28)  VALUE SPACES.    02331035
023400                                                                  02340004
023500*******************  DETAIL LINES   ***************************** 02350004
023600***** THIS LINE TO PRINT VENDOR NAME ON SUBSEQUENT PAGES FOR      02360066
023610***** SAME VENDOR                                                 02361066
023700 01  VN1-VENDOR-NAME-LINE-1.                                      02370071
023800     05  FILLER                      PIC  X(01)     VALUE SPACES. 02380035
023900     05  VN1-NBR-VENDORS             PIC  ZZZ9      VALUE ZEROS.  02390066
023901     05  FILLER                      PIC  X(01)     VALUE SPACES. 02390135
023910     05  VN1-VENDOR-NAME             PIC  X(26)     VALUE SPACES. 02391066
024000     05  FILLER                      PIC  X(100)    VALUE SPACES. 02400066
024010                                                                  02401066
024020 01  DL1-DETAIL-LINE-1.                                           02402066
024030     05  FILLER                      PIC  X(01)     VALUE SPACES. 02403066
024040     05  DL1-NBR-VENDORS             PIC  ZZZ9      VALUE ZEROS.  02404066
024050     05  FILLER                      PIC  X(01)     VALUE SPACES. 02405066
024060     05  DL1-VENDOR-NAME             PIC  X(26)     VALUE SPACES. 02406066
024070     05  FILLER                      PIC  X(01)     VALUE SPACES. 02407066
024100     05  DL1-VENDOR-RANK             PIC  ZZZ9      VALUE ZEROS.  02410035
024200     05  FILLER                      PIC  X(01)     VALUE SPACE.  02420035
024300     05  DL1-TOTAL-NBR-PO-VEND       PIC  Z,ZZZ,ZZ9 VALUE ZEROS.  02430035
024400     05  FILLER                      PIC  X(01)     VALUE SPACE.  02440037
024401     05  DL1-TOTAL-NBR-PO-TRB-VEND   PIC  Z,ZZZ,ZZ9 VALUE ZEROS.  02440135
024402     05  FILLER                      PIC  X(01)     VALUE SPACE.  02440235
024403     05  DL1-PCT-PO-INTRBL-VEND      PIC  ZZ9.9     VALUE ZEROS.  02440335
024404     05  FILLER                      PIC  X(01)     VALUE SPACE.  02440435
024540     05  DL1-TOTAL-NBR-RCVRS-VEND    PIC  Z,ZZZ,ZZ9 VALUE ZEROS.  02454035
024541     05  FILLER                      PIC  X(01)     VALUE SPACE.  02454135
024550     05  DL1-TOT-NBR-RCVRS-TRBL-VEND PIC  Z,ZZZ,ZZ9 VALUE ZEROS.  02455035
024600     05  FILLER                      PIC  X(02)     VALUE SPACE.  02460035
024700     05  DL1-PCT-RCVRS-INTRBL-VEND   PIC  ZZ9.9     VALUE ZEROS.  02470035
024900     05  FILLER                      PIC  X(01)     VALUE SPACE.  02490035
025200     05  DL1-ACTUAL-CREATED-QTY-VEND PIC  Z,ZZZ,ZZ9 VALUE ZEROS.  02520035
025300     05  FILLER                      PIC  X(01)     VALUE SPACE.  02530035
025400     05  DL1-PCT-ACTUAL-TRBL-VEND    PIC  ZZ9.9     VALUE ZEROS.  02540035
025600     05  FILLER                      PIC  X(01)     VALUE SPACE.  02560035
025700     05  DL1-NOTIFY-CREATED-QTY-VEND PIC  Z,ZZZ,ZZ9 VALUE ZEROS.  02570035
025800     05  FILLER                      PIC  X(01)     VALUE SPACE.  02580035
025900     05  DL1-PCT-NOTIFY-TRBL-VEND    PIC  ZZ9.9     VALUE ZEROS.  02590037
025910     05  FILLER                      PIC  X(01)     VALUE SPACE.  02591035
026000     05  DL1-TOTAL-CREATED-QTY-VEND  PIC  Z,ZZZ,ZZ9 VALUE ZEROS.  02600035
026200                                                                  02620000
026300 01  DL2-DETAIL-LINE-2.                                           02630004
026400     05  FILLER                      PIC  X(08)     VALUE SPACES. 02640035
026500     05  DL2-DEPT-NBR                PIC  X(03)     VALUE SPACES. 02650035
026600     05  FILLER                      PIC  X(01)     VALUE '-'.    02660035
026700     05  DL2-DEPT-DESC               PIC  X(25)     VALUE SPACES. 02670035
026800     05  FILLER                      PIC  X(01)     VALUE SPACE.  02680035
026810     05  DL2-TOTAL-NBR-PO-DEPT       PIC  Z,ZZZ,ZZ9 VALUE ZEROS.  02681035
026820     05  FILLER                      PIC  X(01)     VALUE SPACE.  02682035
026830     05  DL2-TOTAL-NBR-PO-TRB-DEPT   PIC  Z,ZZZ,ZZ9 VALUE ZEROS.  02683035
026840     05  FILLER                      PIC  X(01)     VALUE SPACE.  02684035
026850     05  DL2-PCT-PO-INTRBL-DEPT      PIC  ZZ9.9     VALUE ZEROS.  02685035
026860     05  FILLER                      PIC  X(01)     VALUE SPACE.  02686035
026900     05  DL2-TOTAL-NBR-RCVRS-DEPT    PIC  Z,ZZZ,ZZ9 VALUE ZEROS.  02690035
027000     05  FILLER                      PIC  X(01)     VALUE SPACE.  02700035
027100     05  DL2-TOT-NBR-RCVRS-TRBL-DEPT PIC  Z,ZZZ,ZZ9 VALUE ZEROS.  02710035
027200     05  FILLER                      PIC  X(02)     VALUE SPACE.  02720035
027300     05  DL2-PCT-RCVRS-INTRBL-DEPT   PIC  ZZ9.9     VALUE ZEROS.  02730035
027500     05  FILLER                      PIC  X(01)     VALUE SPACE.  02750035
027800     05  DL2-ACTUAL-CREATED-QTY-DEPT PIC  Z,ZZZ,ZZ9 VALUE ZEROS.  02780035
027900     05  FILLER                      PIC  X(01)     VALUE SPACE.  02790035
028000     05  DL2-PCT-ACTUAL-TRBL-DEPT    PIC  ZZ9.9     VALUE ZEROS.  02800035
028200     05  FILLER                      PIC  X(01)     VALUE SPACE.  02820035
028300     05  DL2-NOTIFY-CREATED-QTY-DEPT PIC  Z,ZZZ,ZZ9 VALUE ZEROS.  02830035
028400     05  FILLER                      PIC  X(01)     VALUE SPACE.  02840035
028500     05  DL2-PCT-NOTIFY-TRBL-DEPT    PIC  ZZ9.9     VALUE ZEROS.  02850035
028700     05  FILLER                      PIC  X(01)     VALUE SPACE.  02870035
028710     05  DL2-TOTAL-CREATED-QTY-DEPT  PIC  Z,ZZZ,ZZ9 VALUE ZEROS.  02871035
028800                                                                  02880004
028900 01  DL3-DETAIL-LINE-3.                                           02890004
029000     05  FILLER                      PIC  X(39)     VALUE SPACES. 02900035
029100     05  DL3-TROUBLE-NBR             PIC  Z(3)9     VALUE ZEROS.  02910035
029200     05  FILLER                      PIC  X(10)     VALUE SPACES. 02920035
029210     05  DL3-TROUBLE-TYPE            PIC  X(07)     VALUE SPACES. 02921036
029220     05  FILLER                      PIC  X(05)     VALUE SPACES. 02922035
029300     05  DL3-TROUBLE-DESC            PIC  X(20)     VALUE SPACES. 02930035
029400     05  FILLER                      PIC  X(06)     VALUE SPACE.  02940035
029500     05  DL3-CREATED-QTY             PIC  Z,ZZZ,ZZ9 VALUE ZEROS.  02950035
029600     05  FILLER                      PIC  X(32)     VALUE SPACE.  02960035
029700                                                                  02970004
029800 01  EL-EMPTY-LINE.                                               02980070
029810     05  FILLER                      PIC  X(32)     VALUE SPACES. 02981070
029820     05  FILLER                      PIC  X(32)     VALUE         02982070
029830              '**********   THIS PAGE HAS BEEN '.                 02983071
029840     05  FILLER                      PIC  X(36)     VALUE         02984070
029850              'INTENTIONALLY LEFT BLANK  **********'.             02985070
029860     05  FILLER                      PIC  X(32)     VALUE SPACES. 02986070
029900                                                                  02990000
029910 01  BL-BLANK-LINE                   PIC  X(132)    VALUE SPACES. 02991070
029920                                                                  02992070
030000 01  ER-END-REPORT-LINE.                                          03000000
030100     05  FILLER                      PIC X(56)  VALUE SPACE.      03010000
030200     05  FILLER                      PIC X(19)  VALUE             03020000
030300                                     '** END OF REPORT **'.       03030000
030400     05  FILLER                      PIC X(57) VALUE SPACE.       03040000
030500                                                                  03050000
030600     COPY TMRD001.                                                03060000
030700                                                                  03070000
030800 01  CC-CONTROL-CARD-PARAMETERS.                                  03080015
030900     05  CC-NBR-VNDS-TO-PROCESS      PIC 9(05) VALUE ZEROS.       03090015
031000                                                                  03100015
031100                                                                  03110015
031200****** DB2 MESSAGE AREA                                           03120006
031300     COPY DPWS004.                                                03130006
031400                                                                  03140006
031500     EXEC SQL                                                     03150006
031600         INCLUDE SQLCA                                            03160006
031700     END-EXEC.                                                    03170006
031800                                                                  03180006
031900     EXEC SQL                                                     03190006
032000         INCLUDE TEXTENT                                          03200006
032100     END-EXEC.                                                    03210006
032200                                                                  03220006
032300                                                                  03230006
032400***************************************************************** 03240000
032500 PROCEDURE DIVISION.                                              03250000
032600***************************************************************** 03260000
032700                                                                  03270000
032800 0000-MAINLINE.                                                   03280000
032900***************************************************************** 03290000
033000*  THIS PARAGRAPH DRIVES THE PROGRAM.                           * 03300000
033100***************************************************************** 03310000
033200     PERFORM 0100-INITIALIZE.                                     03320000
033300                                                                  03330000
033400     PERFORM 0200-MAIN-PROCESS                                    03340000
033500           UNTIL  PS-EOF.                                         03350000
033600                                                                  03360000
033700     PERFORM 9999-EOJ.                                            03370000
033800     STOP RUN.                                                    03380000
033900                                                                  03390000
034000                                                                  03400000
034100 0100-INITIALIZE.                                                 03410000
034200      OPEN INPUT  TROUBLE-EXTRACT-FILE                            03420000
034300           OUTPUT TROUBLE-REPORT                                  03430069
034310                  TROUBLE-REPORT-SUMMARY.                         03431069
034400                                                                  03440000
034500      ACCEPT CC-CONTROL-CARD-PARAMETERS FROM SYSIN.               03450015
034600      MOVE CC-NBR-VNDS-TO-PROCESS  TO HL1-NBR-TRBL-VEND           03460072
034601                                      HL1S-NBR-TRBL-VEND-SUM.     03460171
034610********* IF CC-NBR-VNDS-TO-PROCESS  = 99999 ALL VENDORS WILL     03461065
034620********* BE PROCESSED, OTHERWISE THE SPECIFIED NUMBER WILL       03462065
034630********* BE PROCESSED. THE DEFAULT IS 50 VENDORS.                03463065
034700      IF CC-NBR-VNDS-TO-PROCESS = PC-99999                        03470065
034710          MOVE CC-NBR-VNDS-TO-PROCESS TO PV-VENDOR-LIMIT          03471065
034720      ELSE                                                        03472065
034730          COMPUTE PV-VENDOR-LIMIT = CC-NBR-VNDS-TO-PROCESS - 1    03473065
034750      END-IF.                                                     03475065
034760                                                                  03476022
034800      DISPLAY '* * * * * * * * * * * * * * * * * * * * * * * '    03480015
034900      DISPLAY 'CONTROL CARD PARMS FOR THIS RUN OF TMKRP015 : '    03490015
035000               CC-CONTROL-CARD-PARAMETERS                         03500015
035100      DISPLAY '* * * * * * * * * * * * * * * * * * * * * * * '    03510015
035200                                                                  03520015
035300**** READING THE HEADER RECORD.                                   03530000
035400      PERFORM 8000-READ-INPUT.                                    03540000
035500                                                                  03550000
035600      MOVE TM001-RUN-BEGIN-DATE  TO PV-START-EXTRACT.             03560000
035700      MOVE TM001-RUN-END-DATE    TO PV-END-EXTRACT.               03570000
035800      STRING                                                      03580000
035900            PV-END-MM                                             03590000
036000              '/'                                                 03600000
036100            PV-END-DD                                             03610000
036200              '/'                                                 03620000
036300            PV-END-YYYY                                           03630000
036400            DELIMITED BY SIZE                                     03640000
036500                INTO PV-END-DATE                                  03650000
036600      END-STRING.                                                 03660000
036700                                                                  03670000
036800      STRING                                                      03680000
036900            PV-START-MM                                           03690000
037000              '/'                                                 03700000
037100            PV-START-DD                                           03710000
037200              '/'                                                 03720000
037300            PV-START-YYYY                                         03730000
037400            DELIMITED BY SIZE                                     03740000
037500                INTO PV-START-DATE                                03750000
037600      END-STRING.                                                 03760000
037700                                                                  03770000
037800                                                                  03780000
037900      MOVE PV-END-DATE        TO HL2-END-DATE.                    03790006
038000                                                                  03800000
038100     ACCEPT CT-CPU-TIME          FROM TIME.                       03810000
038200     MOVE   CT-HOUR              TO DP132O-RUN-HOUR.              03820000
038300     MOVE   CT-MINUTE            TO DP132O-RUN-MINUTE.            03830000
038400                                                                  03840000
038500     ACCEPT CD-CPU-DATE          FROM DATE.                       03850000
038600     MOVE CD-YEAR                TO DP132O-RUN-YEAR.              03860000
038700     MOVE CD-MONTH               TO DP132O-RUN-MONTH.             03870000
038800     MOVE CD-DAY                 TO DP132O-RUN-DAY.               03880000
038900                                                                  03890000
039000     MOVE PC-CURRENT-PGM-NAME    TO DP132O-PROGRAM-NAME.          03900006
039100                                                                  03910000
039200     EVALUATE TRUE                                                03920000
039300         WHEN TM001-RUN-MONTHLY                                   03930000
039400             MOVE PC-MONTH13  TO HL2-REPORT-PERIOD                03940000
039500                                                                  03950000
039600         WHEN TM001-RUN-FISCAL-YR                                 03960000
039700             MOVE PC-FIS-YR13 TO HL2-REPORT-PERIOD                03970000
039800                                                                  03980000
039900         WHEN TM001-RUN-CALENDAR-YR                               03990000
040000             MOVE PC-CAL-YR13 TO HL2-REPORT-PERIOD                04000000
040100                                                                  04010000
040200         WHEN TM001-RUN-SEASONAL                                  04020000
040300             IF TM001-SPRING-SEASON                               04030000
040400                 MOVE PC-SPRING-SEAS13 TO HL2-REPORT-PERIOD       04040000
040500             ELSE                                                 04050000
040600                 MOVE PC-FALL-SEAS13   TO HL2-REPORT-PERIOD       04060000
040700             END-IF                                               04070000
040800     END-EVALUATE.                                                04080000
040900                                                                  04090000
041000     IF TM001-RUN-SPECIAL                                         04100000
041100         MOVE PC-SPECIAL-RUN-NOTE  TO HL1-SPECIAL-RUN-NOTE        04110006
041110                                      HL1S-SPECIAL-RUN-NOTE-SUM   04111071
041200         MOVE PV-START-DATE        TO PV-SPECIAL-START-DT         04120006
041300         MOVE PV-END-DATE          TO PV-SPECIAL-END-DT           04130006
041400         MOVE PV-SPECIAL-RUN-DATES TO HL2-SPECIAL-RUN-DATES       04140000
041500     ELSE                                                         04150000
041600         MOVE SPACE                TO HL1-SPECIAL-RUN-NOTE        04160006
041610                                      HL1S-SPECIAL-RUN-NOTE-SUM   04161071
041700         MOVE SPACE                TO HL2-SPECIAL-RUN-DATES       04170006
041800     END-IF.                                                      04180000
041900                                                                  04190000
041910******** PRINT INITIAL PAGE HEADINGS                              04191068
041920     PERFORM 1000-PRINT-HEADINGS.                                 04192067
041921     PERFORM 1100-PRINT-SUMMARY-HEADING.                          04192167
041930                                                                  04193028
042000 0200-MAIN-PROCESS.                                               04200000
042100     PERFORM 8000-READ-INPUT.                                     04210000
042200                                                                  04220000
042300     IF PS-NOT-EOF                                                04230000
042400         EVALUATE TRUE                                            04240000
042500             WHEN TM001-RECORD-TYPE-VNDDTLSUM                     04250006
042600                 PERFORM 0300-PROCESS-AL-REC                      04260006
042700             WHEN TM001-RECORD-TYPE-VNDDPTSUM                     04270006
042800                 PERFORM 0400-PROCESS-BF-REC                      04280006
042900             WHEN TM001-RECORD-TYPE-VNDDPTRSN                     04290006
043000                 PERFORM 0500-PROCESS-CF-REC                      04300006
043100         END-EVALUATE                                             04310000
043200     END-IF.                                                      04320000
043300                                                                  04330000
043400 0300-PROCESS-AL-REC.                                             04340006
043410**** ONLY PROCESS NUMBER OF VENDORS SPECIFIED ON CONTROL CARD     04341017
043420     IF PV-NBR-VENDORS > PV-VENDOR-LIMIT                          04342020
043430         SET PS-EOF  TO TRUE                                      04343017
043450     ELSE                                                         04345017
043600         IF TM001-REPORT-TROUBLE                                  04360030
043602             MOVE TM001-VTL-ENT-NAME-DESC TO DL1-VENDOR-NAME      04360230
043603                                             VN1-VENDOR-NAME      04360367
043604             PERFORM 7000-SELECT-VENDOR-RANK                      04360467
043605             MOVE TM001-VTL-PO-RECVD-QTY                          04360567
043606                                  TO DL1-TOTAL-NBR-PO-VEND        04360667
043607                                     PV-HOLD-TOTAL                04360767
043608             MOVE TM001-VTL-PO-IN-TRBL-QTY                        04360867
043609                                  TO DL1-TOTAL-NBR-PO-TRB-VEND    04360967
043610                                     PV-HOLD-TROUBLE              04361067
043611             PERFORM 0700-CALC-PERCENT                            04361167
043612             MOVE PV-HOLD-PERCENT TO DL1-PCT-PO-INTRBL-VEND       04361267
043613             MOVE TM001-VTL-RCVRS-VRFYD-QTY                       04361367
043614                                  TO DL1-TOTAL-NBR-RCVRS-VEND     04361467
043615                                     PV-HOLD-TOTAL                04361567
043616             MOVE TM001-VTL-VRFYD-TRBL-QTY                        04361667
043617                                  TO DL1-TOT-NBR-RCVRS-TRBL-VEND  04361767
043618                                     PV-HOLD-TROUBLE              04361867
043619             PERFORM 0700-CALC-PERCENT                            04361967
043620             MOVE PV-HOLD-PERCENT TO DL1-PCT-RCVRS-INTRBL-VEND    04362067
043621**** SAVE ASSIGN-TOT-QTY FROM 1ST AL REC.  IT WILL BE ADDED TO    04362167
043622**** ASSIGN-TOT-QTY OF THE 2ND AL REC.                            04362267
043623             MOVE TM001-VTL-ASSIGN-TOT-QTY                        04362367
043624                                  TO PV-HOLD-ACTUAL-TOT-QTY       04362467
043625                                     DL1-ACTUAL-CREATED-QTY-VEND  04362567
043626         ELSE                                                     04362667
043627             MOVE TM001-VTL-ASSIGN-TOT-QTY                        04362767
043630                                TO DL1-NOTIFY-CREATED-QTY-VEND    04363030
043640                                   PV-HOLD-NOTIFY-TOT-QTY         04364030
045800         END-IF                                                   04580017
045900                                                                  04590008
046710         IF PS-1ST-AL-REC                                         04671030
046721             SET PS-2ND-AL-REC    TO TRUE                         04672130
046730         ELSE                                                     04673030
046731             SET PS-BOTH-AL-RECS  TO TRUE                         04673133
046732         END-IF                                                   04673230
046740                                                                  04674030
046800         IF PS-BOTH-AL-RECS                                       04680017
046810             COMPUTE PV-TOTAL-ASSIGN-TOT-QTY =                    04681041
046820                PV-HOLD-ACTUAL-TOT-QTY + PV-HOLD-NOTIFY-TOT-QTY   04682041
046830             MOVE PV-TOTAL-ASSIGN-TOT-QTY                         04683041
046840                                 TO DL1-TOTAL-CREATED-QTY-VEND    04684041
046900****** CALCULATE ACTUAL AND NOTIFY PERCENTS                       04690009
047000             MOVE PV-HOLD-ACTUAL-TOT-QTY TO PV-HOLD-TROUBLE       04700044
047100             MOVE PV-TOTAL-ASSIGN-TOT-QTY                         04710044
047110                                  TO PV-HOLD-TOTAL                04711044
047200             PERFORM 0700-CALC-PERCENT                            04720044
047300             MOVE PV-HOLD-PERCENT TO DL1-PCT-ACTUAL-TRBL-VEND     04730044
047400             MOVE PV-HOLD-NOTIFY-TOT-QTY                          04740044
047410                                  TO PV-HOLD-TROUBLE              04741044
047500             MOVE PV-TOTAL-ASSIGN-TOT-QTY                         04750044
047510                                  TO PV-HOLD-TOTAL                04751044
047600             PERFORM 0700-CALC-PERCENT                            04760044
047700             MOVE PV-HOLD-PERCENT TO DL1-PCT-NOTIFY-TRBL-VEND     04770044
047810                                                                  04781030
047900             IF PV-TRBL-LINE-COUNT > PC-LINE-LIMIT                04790017
048000                 PERFORM 1000-PRINT-HEADINGS                      04800017
048100             END-IF                                               04810017
048110                                                                  04811027
048111             IF PV-TRBL-PAGE-CNT-SUM > PC-LINE-LIMIT              04811180
048112                 PERFORM 1100-PRINT-SUMMARY-HEADING               04811280
048113             END-IF                                               04811380
048114                                                                  04811480
048115             IF PS-1ST-TIME                                       04811571
048116                 SET PS-NOT-1ST-TIME TO TRUE                      04811671
048117             ELSE                                                 04811727
048118***** FORCE A BLANK PAGE BEFORE NEXT VENDOR SO THAT EACH          04811870
048119***** VENDOR WITH MULTIPLE PAGES IS IN ITS OWN 'PACKET' OR IF     04811970
048120***** ONLY ONE PAGE IS ON A PAGE BY ITSELF                        04812070
048121                 INITIALIZE PV-QUOTIENT                           04812176
048122                            PV-REMAINDER                          04812276
048123                 DIVIDE PV-TRBL-PAGE-COUNT BY PC-TWO              04812376
048124                      GIVING  PV-QUOTIENT                         04812476
048125                   REMAINDER  PV-REMAINDER                        04812576
048126                 IF PV-REMAINDER = ZERO                           04812676
048127                     PERFORM 1000-PRINT-HEADINGS                  04812776
048128                 ELSE                                             04812876
048129                     PERFORM 1000-PRINT-HEADINGS                  04812976
048130                     WRITE TROUBLE-RECORD FROM EL-EMPTY-LINE      04813076
048131                           AFTER ADVANCING 25 LINES               04813176
048132                     ADD 25   TO PV-TRBL-LINE-COUNT               04813276
048133                     PERFORM 1000-PRINT-HEADINGS                  04813376
048134                 END-IF                                           04813476
048135                                                                  04813576
048153             END-IF                                               04815376
048154                                                                  04815476
048155             ADD 1   TO PV-NBR-VENDORS                            04815576
048156             MOVE  PV-NBR-VENDORS TO DL1-NBR-VENDORS              04815676
048160                                     VN1-NBR-VENDORS              04816067
048200             WRITE TROUBLE-RECORD FROM DL1-DETAIL-LINE-1          04820017
048300                   AFTER ADVANCING 2 LINES                        04830017
048400             ADD 2   TO PV-TRBL-LINE-COUNT                        04840030
048500             WRITE TROUBLE-RECORD-SUMMARY FROM DL1-DETAIL-LINE-1  04850067
048510                   AFTER ADVANCING 2 LINES                        04851067
048511             WRITE TROUBLE-RECORD-SUMMARY FROM BL-BLANK-LINE      04851178
048512                   AFTER ADVANCING 2 LINES                        04851278
048520             ADD 4   TO PV-TRBL-LINE-CNT-SUM                      04852078
048600             SET PS-1ST-AL-REC    TO TRUE                         04860017
048700         END-IF                                                   04870017
048710     END-IF.                                                      04871017
048800                                                                  04880000
048850                                                                  04885030
048900 0400-PROCESS-BF-REC.                                             04890009
048910     IF TM001-REPORT-TROUBLE                                      04891030
049100         MOVE TM001-VDTL-DEPT-NBR TO DL2-DEPT-NBR                 04910009
049200         MOVE TM001-VDTL-DEPT-DESCRIPTION TO DL2-DEPT-DESC        04920009
049210         MOVE TM001-VDTL-PO-RECVD-QTY                             04921051
049220                              TO DL2-TOTAL-NBR-PO-DEPT            04922051
049230                                 PV-HOLD-TOTAL                    04923051
049240         MOVE TM001-VDTL-PO-IN-TRBL-QTY                           04924051
049250                              TO DL2-TOTAL-NBR-PO-TRB-DEPT        04925053
049260                                 PV-HOLD-TROUBLE                  04926051
049270         PERFORM 0700-CALC-PERCENT                                04927051
049280         MOVE PV-HOLD-PERCENT TO DL2-PCT-PO-INTRBL-DEPT           04928051
049300         MOVE TM001-VDTL-RCVRS-VRFYD-QTY                          04930026
049500                                 TO DL2-TOTAL-NBR-RCVRS-DEPT      04950009
049600                                    PV-HOLD-TOTAL                 04960032
049700         MOVE TM001-VDTL-VRFYD-TRBL-QTY                           04970026
049900                                 TO DL2-TOT-NBR-RCVRS-TRBL-DEPT   04990010
050000                                    PV-HOLD-TROUBLE               05000034
050100         PERFORM 0700-CALC-PERCENT                                05010009
050200         MOVE PV-HOLD-PERCENT    TO DL2-PCT-RCVRS-INTRBL-DEPT     05020009
050300**** SAVE ASSIGN-TOT-QTY FROM 1ST BF REC.  IT WILL BE ADDED TO    05030011
050400**** ASSIGN-TOT-QTY OF THE 2ND BF REC.                            05040011
050500         MOVE TM001-VDTL-ASSIGN-TOT-QTY TO PV-HOLD-ACTUAL-TOT-QTY 05050031
050610                                      DL2-ACTUAL-CREATED-QTY-DEPT 05061031
050700     ELSE                                                         05070009
050710         MOVE TM001-VDTL-ASSIGN-TOT-QTY TO PV-HOLD-NOTIFY-TOT-QTY 05071031
050720                                      DL2-NOTIFY-CREATED-QTY-DEPT 05072031
051300     END-IF                                                       05130009
051400                                                                  05140009
052110     IF PS-1ST-BF-REC                                             05211030
052120         SET PS-2ND-BF-REC       TO TRUE                          05212030
052130     ELSE                                                         05213030
052140         SET PS-BOTH-BF-RECS     TO TRUE                          05214030
052150     END-IF                                                       05215030
052200                                                                  05220010
052300     IF PS-BOTH-BF-RECS                                           05230010
052310         COMPUTE PV-TOTAL-ASSIGN-TOT-QTY =                        05231042
052320             PV-HOLD-ACTUAL-TOT-QTY  +  PV-HOLD-NOTIFY-TOT-QTY    05232042
052330         MOVE PV-TOTAL-ASSIGN-TOT-QTY                             05233042
052340                                 TO DL2-TOTAL-CREATED-QTY-DEPT    05234042
052400****** CALCULATE ACTUAL AND NOTIFY PERCENTS                       05240010
052500         MOVE PV-HOLD-ACTUAL-TOT-QTY TO PV-HOLD-TROUBLE           05250045
052600         MOVE PV-TOTAL-ASSIGN-TOT-QTY TO PV-HOLD-TOTAL            05260045
052700         PERFORM 0700-CALC-PERCENT                                05270045
052800         MOVE PV-HOLD-PERCENT      TO DL2-PCT-ACTUAL-TRBL-DEPT    05280045
052900         MOVE PV-HOLD-NOTIFY-TOT-QTY TO PV-HOLD-TROUBLE           05290045
053000         MOVE PV-TOTAL-ASSIGN-TOT-QTY TO PV-HOLD-TOTAL            05300045
053100         PERFORM 0700-CALC-PERCENT                                05310045
053200         MOVE PV-HOLD-PERCENT      TO DL2-PCT-NOTIFY-TRBL-DEPT    05320045
053300                                                                  05330010
053400         IF PV-TRBL-LINE-COUNT > PC-DEPT-LIMIT                    05340054
053500             PERFORM 1000-PRINT-HEADINGS                          05350010
053510             PERFORM 1300-PRINT-VENDOR-NAME                       05351069
053600         END-IF                                                   05360010
053700         WRITE TROUBLE-RECORD FROM DL2-DETAIL-LINE-2              05370010
053800               AFTER ADVANCING 2 LINES                            05380010
053900         ADD 2   TO PV-TRBL-LINE-COUNT                            05390010
053910         IF PV-TRBL-LINE-CNT-SUM > PC-DEPT-LIMIT                  05391067
053920             PERFORM 1100-PRINT-SUMMARY-HEADING                   05392067
053930         END-IF                                                   05393067
053940         WRITE TROUBLE-RECORD-SUMMARY FROM DL2-DETAIL-LINE-2      05394067
053950               AFTER ADVANCING 1 LINES                            05395078
053960         ADD 1   TO PV-TRBL-LINE-CNT-SUM                          05396078
054000         SET PS-1ST-BF-REC    TO TRUE                             05400010
054001         IF PV-TRBL-LINE-COUNT > PC-DEPT-LIMIT                    05400161
054002             PERFORM 1000-PRINT-HEADINGS                          05400218
054003             PERFORM 1300-PRINT-VENDOR-NAME                       05400369
054004             PERFORM 1200-PRINT-TRBL-HEADING                      05400418
054005         ELSE                                                     05400519
054006             IF PV-TRBL-LINE-COUNT > PC-TRBL-LIMIT                05400652
054007                 PERFORM 1000-PRINT-HEADINGS                      05400752
054008                 PERFORM 1300-PRINT-VENDOR-NAME                   05400869
054009                 PERFORM 1200-PRINT-TRBL-HEADING                  05400952
054010             ELSE                                                 05401052
054011                 PERFORM 1200-PRINT-TRBL-HEADING                  05401152
054012             END-IF                                               05401252
054020         END-IF                                                   05402052
054100     END-IF.                                                      05410010
054200                                                                  05420010
054300                                                                  05430000
054400 0500-PROCESS-CF-REC.                                             05440010
054500     MOVE TM001-VDTTL-TRBL-RSN-CDE   TO DL3-TROUBLE-NBR.          05450009
054600     MOVE TM001-VDTTL-TRBL-RSN-CDE-DESC TO DL3-TROUBLE-DESC.      05460010
054700     MOVE TM001-VDTTL-ASSIGN-TOT-QTY TO DL3-CREATED-QTY.          05470010
054800                                                                  05480009
054810     IF TM001-REPORT-TROUBLE                                      05481037
054820         MOVE PC-TROUBLE TO DL3-TROUBLE-TYPE                      05482037
054830     ELSE                                                         05483037
054831         MOVE PC-NOTIFY  TO DL3-TROUBLE-TYPE                      05483137
054840     END-IF.                                                      05484038
054850                                                                  05485037
054900     IF PV-TRBL-LINE-COUNT > PC-TRBL-LIMIT                        05490052
055000         PERFORM 1000-PRINT-HEADINGS                              05500009
055100         PERFORM 1300-PRINT-VENDOR-NAME                           05510069
055300         PERFORM 1200-PRINT-TRBL-HEADING                          05530009
055400     END-IF.                                                      05540009
055500                                                                  05550009
055600     WRITE TROUBLE-RECORD FROM DL3-DETAIL-LINE-3                  05560009
055700          AFTER ADVANCING 1 LINES.                                05570009
055800     ADD 1  TO PV-TRBL-LINE-COUNT.                                05580009
055900                                                                  05590009
056000                                                                  05600000
056100 0700-CALC-PERCENT.                                               05610008
056110     MOVE ZEROS TO PV-HOLD-PERCENT.                               05611026
056200     IF PV-HOLD-TOTAL  > 0                                        05620040
056300         COMPUTE PV-HOLD-PERCENT =                                05630008
056400            (PV-HOLD-TROUBLE * 100 / PV-HOLD-TOTAL)               05640046
056800     END-IF.                                                      05680008
056900                                                                  05690008
057000                                                                  05700008
057100 1000-PRINT-HEADINGS.                                             05710000
057200     MOVE 0                  TO PV-TRBL-LINE-COUNT.               05720006
057300     ADD  1                  TO PV-TRBL-PAGE-COUNT.               05730006
057400     MOVE PV-TRBL-PAGE-COUNT TO DP132O-PAGE-NUMBER.               05740006
057500     MOVE PC-ONE             TO DP132O-REPORT-NUMBER.             05750006
057600                                                                  05760000
057700     WRITE TROUBLE-RECORD                                         05770006
057800          FROM DP132O-STANDRD-HEADER-132-COLS                     05780006
057900              AFTER ADVANCING PAGE.                               05790006
058000     WRITE TROUBLE-RECORD FROM HL1-HEADING-LINE-1                 05800006
058100              AFTER ADVANCING 2 LINES.                            05810006
058200     WRITE TROUBLE-RECORD FROM HL2-HEADING-LINE-2                 05820006
058300              AFTER ADVANCING 1 LINES.                            05830006
058400     WRITE TROUBLE-RECORD FROM HL3-HEADING-LINE-3                 05840006
058500              AFTER ADVANCING 2 LINES.                            05850006
058600     WRITE TROUBLE-RECORD FROM HL4-HEADING-LINE-4                 05860006
058700              AFTER ADVANCING 1 LINES.                            05870006
058800     WRITE TROUBLE-RECORD FROM HL5-HEADING-LINE-5                 05880006
058900              AFTER ADVANCING 1 LINES.                            05890006
059000     ADD 8      TO PV-TRBL-LINE-COUNT.                            05900006
059100                                                                  05910000
059110 1100-PRINT-SUMMARY-HEADING.                                      05911067
059120     MOVE 0                    TO PV-TRBL-LINE-CNT-SUM.           05912067
059130     ADD  1                    TO PV-TRBL-PAGE-CNT-SUM.           05913067
059140     MOVE PV-TRBL-PAGE-CNT-SUM TO DP132O-PAGE-NUMBER.             05914067
059150     MOVE PC-TWO               TO DP132O-REPORT-NUMBER.           05915073
059160                                                                  05916067
059170     WRITE TROUBLE-RECORD-SUMMARY                                 05917067
059180          FROM DP132O-STANDRD-HEADER-132-COLS                     05918067
059190              AFTER ADVANCING PAGE.                               05919067
059191     WRITE TROUBLE-RECORD-SUMMARY FROM HL1S-HEADING-LINE-1-SUM    05919173
059192              AFTER ADVANCING 2 LINES.                            05919267
059193     WRITE TROUBLE-RECORD-SUMMARY FROM HL2-HEADING-LINE-2         05919367
059194              AFTER ADVANCING 1 LINES.                            05919467
059195     WRITE TROUBLE-RECORD-SUMMARY FROM HL3-HEADING-LINE-3         05919567
059196              AFTER ADVANCING 2 LINES.                            05919667
059197     WRITE TROUBLE-RECORD-SUMMARY FROM HL4-HEADING-LINE-4         05919767
059198              AFTER ADVANCING 1 LINES.                            05919867
059199     WRITE TROUBLE-RECORD-SUMMARY FROM HL5-HEADING-LINE-5         05919967
059200              AFTER ADVANCING 1 LINES.                            05920067
059201     ADD 8      TO PV-TRBL-LINE-CNT-SUM.                          05920167
059202                                                                  05920267
059210 1200-PRINT-TRBL-HEADING.                                         05921067
059300     WRITE TROUBLE-RECORD FROM HL6-HEADING-LINE-6                 05930006
059400              AFTER ADVANCING 2 LINES                             05940006
059500     ADD 2      TO PV-TRBL-LINE-COUNT.                            05950006
059600                                                                  05960000
059601***************************************************************** 05960169
059602* PRINT VENDOR NAME ON ALL PAGES FOR THAT VENDOR                * 05960269
059603***************************************************************** 05960369
059610 1300-PRINT-VENDOR-NAME.                                          05961069
059620     WRITE TROUBLE-RECORD FROM VN1-VENDOR-NAME-LINE-1             05962069
059630              AFTER ADVANCING 1 LINES                             05963069
059640     ADD 1      TO PV-TRBL-LINE-COUNT.                            05964069
059650                                                                  05965069
059700***************************************************************** 05970006
059800* SELECT THE VENDOR RANK FROM  TEXTENT TABLE                    * 05980011
059900***************************************************************** 05990006
060000 7000-SELECT-VENDOR-RANK.                                         06000006
060100                                                                  06010006
060200     EXEC SQL                                                     06020006
060300         SELECT CFY_SLSRNK_NBR                                    06030081
060310              , PFY_SLSRNK_NBR                                    06031081
060400           INTO :EXTENT-CFY-SLSRNK-NBR                            06040081
060410              , :EXTENT-PFY-SLSRNK-NBR                            06041081
060500           FROM TEXTENT                                           06050007
060600         WHERE ENT_ID         = :TM001-VTL-ENT-ID                 06060007
060700     END-EXEC.                                                    06070006
060800                                                                  06080006
060900     EVALUATE TRUE                                                06090006
061000        WHEN SQLCODE = ZERO                                       06100006
061100            IF EXTENT-CFY-SLSRNK-NBR = 0                          06110081
061110                MOVE EXTENT-PFY-SLSRNK-NBR TO DL1-VENDOR-RANK     06111081
061120            ELSE                                                  06112048
061130                MOVE EXTENT-CFY-SLSRNK-NBR TO DL1-VENDOR-RANK     06113081
061140            END-IF                                                06114048
061200        WHEN SQLCODE = +100                                       06120007
061300            MOVE ZEROS                 TO DL1-VENDOR-RANK         06130011
061400        WHEN OTHER                                                06140007
061500             MOVE '7000-SELECT-VENDOR-RANK' TO                    06150007
061600                  PV-ABEND-PARA-NAME                              06160007
061700             MOVE 'SELECT VENDOR RANK' TO PV-DB2-OPERATION-MSG-1  06170007
061800             MOVE 'TEXTENT'           TO PV-DB2-TABLE-NAME        06180007
061900             PERFORM 9999-SQL-ABEND   THRU 9999-EXIT              06190007
062000     END-EVALUATE.                                                06200006
062100                                                                  06210006
062200 8000-READ-INPUT.                                                 06220000
062300      READ TROUBLE-EXTRACT-FILE INTO TM001-TROUBLE-EXT-RECORD     06230000
062400          AT END SET PS-EOF  TO TRUE.                             06240000
062500                                                                  06250000
063100                                                                  06310017
063200 9999-EOJ.                                                        06320017
063400     WRITE TROUBLE-RECORD                                         06340017
063500           FROM ER-END-REPORT-LINE                                06350017
063600                AFTER ADVANCING 2 LINES.                          06360017
063700                                                                  06370017
063710     WRITE TROUBLE-RECORD-SUMMARY                                 06371069
063720           FROM ER-END-REPORT-LINE                                06372069
063730                AFTER ADVANCING 2 LINES.                          06373069
063740                                                                  06374069
063800     CLOSE  TROUBLE-EXTRACT-FILE                                  06380017
063900            TROUBLE-REPORT                                        06390069
063910            TROUBLE-REPORT-SUMMARY.                               06391069
064000                                                                  06400017
064100 9999-SQL-ABEND.                                                  06410017
064200     MOVE SQLCODE     TO PV-SQLCODE.                              06420017
064300     DISPLAY '** ABEND           ** = SQLABEND'.                  06430017
064400     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PGM-NAME.      06440017
064500     DISPLAY '** PARAGRAPH       ** = ' PV-ABEND-PARA-NAME.       06450017
064600     DISPLAY '** TABLE AFFECTED  ** = ' PV-DB2-TABLE-NAME.        06460017
064700     DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.   06470017
064800     DISPLAY '** SQLCODE         ** = ' PV-SQLCODE.               06480017
064900     COPY DPPD004.                                                06490082
065000                                                                  06500017
065100     MOVE +4013                  TO PV-ABEND-CODE.                06510017
065200     CALL 'ILBOABN0'   USING PV-ABEND-CODE.                       06520017
065300 9999-EXIT.                                                       06530010
065400     EXIT.                                                        06540010
065500******************** END OF TMKRP015 **************************** 06550006
