000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.    PCKUT107.                                         00050000
000600 AUTHOR.        DENISE HAHN.                                      00060000
000700 INSTALLATION.  KOHLS.                                            00070000
000800 DATE-WRITTEN   JULY 2012.                                        00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  THIS PROGRAM WILL CHECK TO SEE IF THE MANIFEST NUMBER HAS BEEN 00120000
001210*  USED BY ANOTHER APPLICATION                                    00121000
001300******************************************************************00130000
001400                                                                  00140000
001500******************************************************************00150000
001600 ENVIRONMENT DIVISION.                                            00160000
001700******************************************************************00170000
001800                                                                  00180000
001900 CONFIGURATION SECTION.                                           00190000
002000                                                                  00200000
002100 SOURCE-COMPUTER.        IBM-3090.                                00210000
002200 OBJECT-COMPUTER.        IBM-3090.                                00220000
002300                                                                  00230000
002400 INPUT-OUTPUT SECTION.                                            00240000
002500                                                                  00250000
002600 FILE-CONTROL.                                                    00260000
002700                                                                  00270000
002900     SELECT SML-REQ-DATA-EXTRACT                                  00290000
003000         ASSIGN TO INP01.                                         00300000
003001                                                                  00300101
003010     SELECT ERROR-OUT-FILE                                        00301001
003020         ASSIGN TO OUT01.                                         00302001
003030                                                                  00303001
003100******************************************************************00310000
003200 DATA DIVISION.                                                   00320000
003300******************************************************************00330000
003400                                                                  00340000
003500 FILE SECTION.                                                    00350000
003600                                                                  00360000
003700                                                                  00370000
003800 FD  SML-REQ-DATA-EXTRACT                                         00380000
003900     RECORDING MODE IS F                                          00390000
004000     LABEL RECORDS ARE STANDARD                                   00400000
004100     BLOCK CONTAINS 0 RECORDS.                                    00410000
004200                                                                  00420000
004300 01  SML-REQ-DATA-RECORD            PIC X(100).                   00430000
004720                                                                  00472000
004730 FD  ERROR-OUT-FILE                                               00473001
004731     RECORDING MODE IS F                                          00473101
004732     BLOCK CONTAINS 0 RECORDS                                     00473201
004733     LABEL RECORDS ARE STANDARD.                                  00473301
004734                                                                  00473401
004735 01  ERROR-OUT-RECORD             PIC X(80).                      00473501
004736                                                                  00473601
004737                                                                  00473701
004740******************************************************************00474000
004750 WORKING-STORAGE SECTION.                                         00475000
004760******************************************************************00476000
004770                                                                  00477000
004780                                                                  00478000
004790******************************************************************00479000
004800*  DB2 FORMATTED MESSAGE AREA                                     00480000
004900******************************************************************00490000
005000     COPY DPWS004.                                                00500000
005100                                                                  00510000
005200                                                                  00520000
005210******************************************************************00521006
005220*                                                                 00522006
005230******************************************************************00523006
005240     COPY PCWS264.                                                00524008
005250                                                                  00525006
005260                                                                  00526006
005300                                                                  00530000
005400******************************************************************00540000
005500*  COMMUNICATIONS AREA FOR DB2                                    00550000
005600******************************************************************00560000
005700     EXEC SQL                                                     00570000
005800          INCLUDE SQLCA                                           00580000
005900     END-EXEC.                                                    00590000
006000                                                                  00600000
006100******************************************************************00610000
006200*  OUTBOUND CARTON - SUT_OTBND_CART                               00620000
006400******************************************************************00640000
006500     EXEC SQL                                                     00650000
006600          INCLUDE SUT00024                                        00660000
006700     END-EXEC.                                                    00670000
006800******************************************************************00680000
006900*                                                                 00690000
007000 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00700000
007100                                                   COMP SYNC.     00710000
007200                                                                  00720000
007300 01  PS-PROGRAM-SWITCHES.                                         00730000
007400     05  PS-END-OF-FILE-SW           PIC  X(01)    VALUE 'N'.     00740000
007500         88  PS-END-OF-FILE                        VALUE 'Y'.     00750000
007600         88  PS-NOT-END-OF-FILE                    VALUE 'N'.     00760000
007700                                                                  00770000
007800                                                                  00780000
007900 01  PC-PROGRAM-CONSTANTS.                                        00790000
008000     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     00800000
008100                                                   COMP SYNC.     00810000
008200     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00820000
008300         'PCKUT107'.                                              00830000
008400     05  PC-COMMIT-HOLD              PIC 9(3)      VALUE 100.     00840000
008500                                                                  00850000
008600                                                                  00860000
008700 01  DK-DB2-KEYS.                                                 00870000
008800     05  DK-WRKR-USR-ID              PIC   X(8).                  00880002
008900     05  DK-TRIP-ID                  PIC  S9(9) COMP.             00890002
009000     05  DK-PO-NBR                   PIC  S9(9) COMP.             00900002
009100     05  DK-RQST-TMST                PIC   X(26).                 00910002
009200     05  DK-ALL-PO-IND               PIC   X(1).                  00920002
009201                                                                  00920102
009202     05  DK-SML-00                   PIC  S9(18)V COMP-3.         00920202
009203     05  DK-SML-01                   PIC  S9(18)V COMP-3.         00920302
009204     05  DK-SML-02                   PIC  S9(18)V COMP-3.         00920402
009205     05  DK-SML-03                   PIC  S9(18)V COMP-3.         00920502
009206     05  DK-SML-04                   PIC  S9(18)V COMP-3.         00920602
009207     05  DK-SML-05                   PIC  S9(18)V COMP-3.         00920702
009208     05  DK-SML-06                   PIC  S9(18)V COMP-3.         00920802
009209     05  DK-SML-07                   PIC  S9(18)V COMP-3.         00920902
009210     05  DK-SML-08                   PIC  S9(18)V COMP-3.         00921002
009220     05  DK-SML-09                   PIC  S9(18)V COMP-3.         00922002
009300                                                                  00930000
009400 01  PV-PROGRAM-VARIABLES.                                        00940000
009500     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  00950000
009600     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  00960000
009700     05  PV-OPEN-COUNTER             PIC S9(04)    VALUE ZERO     00970000
009800                                                   COMP SYNC.     00980000
009900     05  PV-CLOSE-COUNTER            PIC S9(04)    VALUE ZERO     00990000
010000                                                   COMP SYNC.     01000000
010100     05  PV-FETCH-COUNTER            PIC S9(04)    VALUE ZERO     01010000
010200                                                   COMP SYNC.     01020000
010210     05  PV-INPUT-COUNT              PIC S9(09)    VALUE ZERO     01021014
010220                                                   COMP SYNC.     01022007
010300     05  PV-SELECT-COUNT             PIC S9(09)    VALUE ZERO     01030000
010400                                                   COMP SYNC.     01040000
010410     05  PV-ERROR-COUNT              PIC S9(09)    VALUE ZERO     01041000
010420                                                   COMP SYNC.     01042000
010900     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             01090000
011100     05  PV-DB2-COUNT                PIC S9(09)    VALUE ZERO     01110000
011200                                                   COMP-3.        01120000
011300                                                                  01130000
011310     05  PV-SML-00                   PIC 9(18)     VALUE ZEROES.  01131000
011311     05  PV-SML-00-R REDEFINES PV-SML-00.                         01131100
011312         10  PV-SML00-41             PIC 99.                      01131204
011320         10  PV-SML00-DIVERT         PIC  9.                      01132004
011330         10  PV-SML00-STORE          PIC 9999.                    01133004
011340         10  PV-SML00-DC             PIC 999.                     01134004
011341         10  PV-SML00-MFST           PIC 9(08).                   01134104
011343     05  PV-SML-01                   PIC 9(18)     VALUE ZEROES.  01134304
011344     05  PV-SML-01-R REDEFINES PV-SML-01.                         01134400
011345         10  PV-SML01-41             PIC 99.                      01134504
011346         10  PV-SML01-DIVERT         PIC  9.                      01134604
011347         10  PV-SML01-STORE          PIC 9999.                    01134704
011348         10  PV-SML01-DC             PIC 999.                     01134804
011349         10  PV-SML01-MFST           PIC 9(08).                   01134904
011351     05  PV-SML-02                   PIC 9(18)     VALUE ZEROES.  01135104
011352     05  PV-SML-02-R REDEFINES PV-SML-02.                         01135200
011353         10  PV-SML02-41             PIC 99.                      01135304
011354         10  PV-SML02-DIVERT         PIC  9.                      01135404
011355         10  PV-SML02-STORE          PIC 9999.                    01135504
011356         10  PV-SML02-DC             PIC 999.                     01135604
011357         10  PV-SML02-MFST           PIC 9(08).                   01135704
011359     05  PV-SML-03                   PIC 9(18)     VALUE ZEROES.  01135904
011360     05  PV-SML-03-R REDEFINES PV-SML-03.                         01136000
011361         10  PV-SML03-41             PIC 99.                      01136104
011362         10  PV-SML03-DIVERT         PIC  9.                      01136204
011363         10  PV-SML03-STORE          PIC 9999.                    01136304
011364         10  PV-SML03-DC             PIC 999.                     01136404
011365         10  PV-SML03-MFST           PIC 9(08).                   01136504
011367     05  PV-SML-04                   PIC 9(18)     VALUE ZEROES.  01136704
011368     05  PV-SML-04-R REDEFINES PV-SML-04.                         01136800
011369         10  PV-SML04-41             PIC 99.                      01136904
011370         10  PV-SML04-DIVERT         PIC  9.                      01137004
011371         10  PV-SML04-STORE          PIC 9999.                    01137104
011372         10  PV-SML04-DC             PIC 999.                     01137204
011373         10  PV-SML04-MFST           PIC 9(08).                   01137304
011375     05  PV-SML-05                   PIC 9(18)     VALUE ZEROES.  01137504
011376     05  PV-SML-05-R REDEFINES PV-SML-05.                         01137600
011377         10  PV-SML05-41             PIC 99.                      01137704
011378         10  PV-SML05-DIVERT         PIC  9.                      01137804
011379         10  PV-SML05-STORE          PIC 9999.                    01137904
011380         10  PV-SML05-DC             PIC 999.                     01138004
011381         10  PV-SML05-MFST           PIC 9(08).                   01138104
011383     05  PV-SML-06                   PIC 9(18)     VALUE ZEROES.  01138304
011384     05  PV-SML-06-R REDEFINES PV-SML-06.                         01138400
011385         10  PV-SML06-41             PIC 99.                      01138504
011386         10  PV-SML06-DIVERT         PIC  9.                      01138604
011387         10  PV-SML06-STORE          PIC 9999.                    01138704
011388         10  PV-SML06-DC             PIC 999.                     01138804
011389         10  PV-SML06-MFST           PIC 9(08).                   01138904
011390     05  PV-SML-07                   PIC 9(18)     VALUE ZEROES.  01139004
011391     05  PV-SML-07-R REDEFINES PV-SML-07.                         01139100
011392         10  PV-SML07-41             PIC 99.                      01139204
011393         10  PV-SML07-DIVERT         PIC  9.                      01139304
011394         10  PV-SML07-STORE          PIC 9999.                    01139404
011395         10  PV-SML07-DC             PIC 999.                     01139504
011396         10  PV-SML07-MFST           PIC 9(08).                   01139604
011397     05  PV-SML-08                   PIC 9(18)     VALUE ZEROES.  01139704
011398     05  PV-SML-08-R REDEFINES PV-SML-08.                         01139800
011399         10  PV-SML08-41             PIC 99.                      01139904
011400         10  PV-SML08-DIVERT         PIC  9.                      01140004
011401         10  PV-SML08-STORE          PIC 9999.                    01140104
011402         10  PV-SML08-DC             PIC 999.                     01140204
011403         10  PV-SML08-MFST           PIC 9(08).                   01140304
011404     05  PV-SML-09                   PIC 9(18)     VALUE ZEROES.  01140404
011405     05  PV-SML-09-R REDEFINES PV-SML-09.                         01140500
011406         10  PV-SML09-41             PIC 99.                      01140604
011407         10  PV-SML09-DIVERT         PIC  9.                      01140704
011408         10  PV-SML09-STORE          PIC 9999.                    01140804
011409         10  PV-SML09-DC             PIC 999.                     01140904
011410         10  PV-SML09-MFST           PIC 9(08).                   01141004
011411                                                                  01141100
011412 01  HEADING-OUT.                                                 01141201
011415     05  FILLER                   PIC  X(10)  VALUE SPACES.       01141522
011416     05  FILLER                   PIC  X(03)  VALUE 'TYP'.        01141618
011417     05  FILLER                   PIC  X(01)  VALUE SPACES.       01141718
011418     05  FILLER                   PIC  X(08)  VALUE ' USERID '.   01141818
011419     05  FILLER                   PIC  X(01)  VALUE SPACES.       01141918
011420     05  FILLER                   PIC  X(04)  VALUE ' STR'.       01142018
011421     05  FILLER                   PIC  X(01)  VALUE SPACES.       01142118
011422     05  FILLER                   PIC  X(03)  VALUE 'PRT'.        01142218
011423     05  FILLER                   PIC  X(01)  VALUE SPACES.       01142318
011424     05  FILLER                   PIC  X(04)  VALUE ' QTY'.       01142418
011425     05  FILLER                   PIC  X(01)  VALUE SPACES.       01142518
011426     05  FILLER                   PIC  X(08)  VALUE 'MFST '.      01142622
011427     05  FILLER                   PIC  X(01)  VALUE SPACES.       01142718
011428     05  FILLER                   PIC  X(02)  VALUE 'DC'.         01142822
011429     05  FILLER                   PIC  X(04)  VALUE SPACES.       01142923
011430     05  FILLER                   PIC  X(26)  VALUE 'TIMESTAMP'.  01143018
011431                                                                  01143118
011432 01  RECORD-OUT.                                                  01143218
011433     05  FILLER                   PIC  X(01)  VALUE SPACES.       01143318
011434     05  FILLER                   PIC  X(05)  VALUE 'DUP: '.      01143418
011435     05  REC-LBL-REQ-TYPE         PIC  X(03)  VALUE SPACE.        01143518
011436     05  FILLER                   PIC  X(01)  VALUE SPACES.       01143618
011437     05  REC-USER-ID              PIC  X(08).                     01143718
011438     05  FILLER                   PIC  X(01)  VALUE SPACES.       01143818
011439     05  REC-STR-NBR              PIC  9(04).                     01143918
011440     05  FILLER                   PIC  X(01)  VALUE SPACES.       01144018
011441     05  REC-PRTR-ID              PIC  X(03).                     01144118
011442     05  FILLER                   PIC  X(01)  VALUE SPACES.       01144218
011443     05  REC-NO-OF-LBLS           PIC  9(04).                     01144318
011444     05  FILLER                   PIC  X(01)  VALUE SPACES.       01144418
011445     05  REC-START-MFST-NBR       PIC  9(08).                     01144518
011446     05  FILLER                   PIC  X(01)  VALUE SPACES.       01144618
011447     05  REC-OPER                 PIC  9(04).                     01144718
011448     05  FILLER                   PIC  X(01)  VALUE SPACES.       01144818
011449     05  REC-PRC-TMST             PIC  X(26).                     01144918
011450                                                                  01145018
011510******************************************************************01151000
011600 PROCEDURE DIVISION.                                              01160000
011700******************************************************************01170000
011800                                                                  01180000
011900 0000-PROGRAM-MAINLINE.                                           01190000
012000******************************************************************01200000
012100* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     01210000
012200*      PROGRAM.                                                   01220000
012300******************************************************************01230000
012400                                                                  01240000
012410     DISPLAY '***************************************'.           01241010
012420     DISPLAY '*                                     *'.           01242010
012430     DISPLAY '*                                     *'.           01243010
012500     PERFORM 1000-INITIALIZE.                                     01250000
012600     IF PS-NOT-END-OF-FILE                                        01260000
012700         PERFORM 2000-PROCESS-SML-REQ                             01270000
012800            UNTIL PS-END-OF-FILE                                  01280000
012900     END-IF.                                                      01290000
013000     PERFORM 9000-EOJ-ROUTINE.                                    01300000
013100                                                                  01310000
013110*    IF ANY ERRORS WERE FOUND, THEN SET THE RETURN-CODE, SO       01311001
013120*    THAT THE EMAIL WILL GET SENT OUT IN THE NEXT STEP            01312001
013130                                                                  01313001
013140     IF PV-ERROR-COUNT  > 0                                       01314001
013150         MOVE 4095 TO RETURN-CODE                                 01315001
013160     END-IF.                                                      01316001
013170                                                                  01317001
013190     DISPLAY '*                                     *'.           01319010
013192     DISPLAY '*                                     *'.           01319210
013193     DISPLAY '***************************************'.           01319310
013200     STOP RUN.                                                    01320000
013300                                                                  01330000
013400 1000-INITIALIZE.                                                 01340000
013500******************************************************************01350000
013600*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    01360000
013700*    -- OPEN INPUT FILE                                           01370000
013800*    -- READ FILE                                                 01380000
013900******************************************************************01390000
014000                                                                  01400000
014100     OPEN INPUT  SML-REQ-DATA-EXTRACT                             01410001
014110          OUTPUT ERROR-OUT-FILE.                                  01411001
014111                                                                  01411118
014120     DISPLAY HEADING-OUT                                          01412018
014130     WRITE ERROR-OUT-RECORD FROM HEADING-OUT.                     01413018
014140                                                                  01414018
014200     PERFORM 7000-READ-SML-REQ.                                   01420000
014300                                                                  01430000
014500                                                                  01450000
014600******************************************************************01460000
014700 2000-PROCESS-SML-REQ.                                            01470006
014800                                                                  01480000
014811     MOVE  41                TO  PV-SML00-41                      01481100
014812                                 PV-SML01-41                      01481206
014813                                 PV-SML02-41                      01481306
014814                                 PV-SML03-41                      01481406
014815                                 PV-SML04-41                      01481506
014816                                 PV-SML05-41                      01481606
014817                                 PV-SML06-41                      01481706
014818                                 PV-SML07-41                      01481806
014819                                 PV-SML08-41                      01481906
014820                                 PV-SML09-41.                     01482006
014821                                                                  01482100
014822     MOVE  0                 TO  PV-SML00-DIVERT.                 01482200
014823     MOVE  1                 TO  PV-SML01-DIVERT.                 01482300
014824     MOVE  2                 TO  PV-SML02-DIVERT.                 01482400
014825     MOVE  3                 TO  PV-SML03-DIVERT.                 01482500
014826     MOVE  4                 TO  PV-SML04-DIVERT.                 01482600
014827     MOVE  5                 TO  PV-SML05-DIVERT.                 01482700
014828     MOVE  6                 TO  PV-SML06-DIVERT.                 01482800
014829     MOVE  7                 TO  PV-SML07-DIVERT.                 01482900
014830     MOVE  8                 TO  PV-SML08-DIVERT.                 01483000
014831     MOVE  9                 TO  PV-SML09-DIVERT.                 01483100
014832                                                                  01483200
014833     MOVE  PC264-STR-NBR     TO  PV-SML00-STORE                   01483308
014834                                 PV-SML01-STORE                   01483400
014835                                 PV-SML02-STORE                   01483500
014836                                 PV-SML03-STORE                   01483600
014837                                 PV-SML04-STORE                   01483700
014838                                 PV-SML05-STORE                   01483800
014839                                 PV-SML06-STORE                   01483900
014840                                 PV-SML07-STORE                   01484000
014841                                 PV-SML08-STORE                   01484100
014842                                 PV-SML09-STORE.                  01484200
014843                                                                  01484300
014844     MOVE  PC264-OPER        TO  PV-SML00-DC                      01484408
014845                                 PV-SML01-DC                      01484500
014846                                 PV-SML02-DC                      01484600
014847                                 PV-SML03-DC                      01484700
014848                                 PV-SML04-DC                      01484800
014849                                 PV-SML05-DC                      01484900
014850                                 PV-SML06-DC                      01485000
014851                                 PV-SML07-DC                      01485100
014852                                 PV-SML08-DC                      01485200
014853                                 PV-SML09-DC.                     01485300
014854                                                                  01485400
014855     MOVE  PC264-START-MFST-NBR   TO  PV-SML00-MFST               01485508
014856                                      PV-SML01-MFST               01485600
014857                                      PV-SML02-MFST               01485700
014858                                      PV-SML03-MFST               01485800
014859                                      PV-SML04-MFST               01485900
014860                                      PV-SML05-MFST               01486000
014861                                      PV-SML06-MFST               01486100
014862                                      PV-SML07-MFST               01486200
014863                                      PV-SML08-MFST               01486300
014864                                      PV-SML09-MFST.              01486400
014870                                                                  01487000
014900     PERFORM 3000-CHECK-FOR-DUPLICATE                             01490000
015000                                                                  01500000
015100     IF   PV-SELECT-COUNT  >  0                                   01510001
015400          MOVE PC264-LBL-REQ-TYPE      TO  REC-LBL-REQ-TYPE       01540017
015600          MOVE PC264-USER-ID           TO  REC-USER-ID            01560017
015620          MOVE PC264-STR-NBR           TO  REC-STR-NBR            01562017
015640          MOVE PC264-PRTR-ID           TO  REC-PRTR-ID            01564017
015660          MOVE PC264-NO-OF-LBLS        TO  REC-NO-OF-LBLS         01566017
015662          MOVE PC264-START-MFST-NBR    TO  REC-START-MFST-NBR     01566217
015664          MOVE PC264-OPER              TO  REC-OPER               01566417
015666          MOVE PC264-PRC-TMST          TO  REC-PRC-TMST           01566617
015670                                                                  01567001
015690          DISPLAY RECORD-OUT                                      01569001
015691          WRITE ERROR-OUT-RECORD FROM RECORD-OUT                  01569101
016600     END-IF.                                                      01660000
016800                                                                  01680000
016900     PERFORM 7000-READ-SML-REQ.                                   01690001
017000                                                                  01700000
017700******************************************************************01770000
017800*  CHECK TO SEE IF ANY DUPLICATES EXIST                           01780000
017900******************************************************************01790000
018010 3000-CHECK-FOR-DUPLICATE.                                        01801000
018700                                                                  01870000
018800     MOVE  ZEROES  TO   PV-SELECT-COUNT.                          01880001
018801                                                                  01880102
018802     MOVE  PV-SML-00      TO  DK-SML-00.                          01880202
018803     MOVE  PV-SML-01      TO  DK-SML-01.                          01880302
018804     MOVE  PV-SML-02      TO  DK-SML-02.                          01880402
018805     MOVE  PV-SML-03      TO  DK-SML-03.                          01880502
018806     MOVE  PV-SML-04      TO  DK-SML-04.                          01880602
018807     MOVE  PV-SML-05      TO  DK-SML-05.                          01880702
018808     MOVE  PV-SML-06      TO  DK-SML-06.                          01880802
018809     MOVE  PV-SML-07      TO  DK-SML-07.                          01880902
018810     MOVE  PV-SML-08      TO  DK-SML-08.                          01881002
018811     MOVE  PV-SML-09      TO  DK-SML-09.                          01881102
018812                                                                  01881201
018820     EXEC SQL                                                     01882001
018900         SELECT  SHIPT_UNT_ID                                     01890012
018901               , CART_SRC_CDE                                     01890116
018910           INTO :SUT00024-SHIPT-UNT-ID                            01891012
018920               ,:SUT00024-CART-SRC-CDE                            01892016
019000           FROM  SUT_OTBND_CART                                   01900000
019100          WHERE (SHIPT_UNT_ID  =  :DK-SML-00   OR                 01910002
019110                 SHIPT_UNT_ID  =  :DK-SML-01   OR                 01911002
019120                 SHIPT_UNT_ID  =  :DK-SML-02   OR                 01912002
019130                 SHIPT_UNT_ID  =  :DK-SML-03   OR                 01913002
019140                 SHIPT_UNT_ID  =  :DK-SML-04   OR                 01914002
019150                 SHIPT_UNT_ID  =  :DK-SML-05   OR                 01915002
019160                 SHIPT_UNT_ID  =  :DK-SML-06   OR                 01916002
019170                 SHIPT_UNT_ID  =  :DK-SML-07   OR                 01917002
019180                 SHIPT_UNT_ID  =  :DK-SML-08   OR                 01918002
019190                 SHIPT_UNT_ID  =  :DK-SML-09)                     01919002
019200            AND  NOT CART_SRC_CDE IN ('P2L','JWL','MST')          01920024
019700     END-EXEC.                                                    01970000
019800                                                                  01980000
019900     EVALUATE TRUE                                                01990000
020000         WHEN SQLCODE = 0                                         02000000
020001         WHEN SQLCODE = -811                                      02000116
020010              MOVE 1                TO  PV-SELECT-COUNT           02001012
020100              ADD  PV-SELECT-COUNT  TO  PV-ERROR-COUNT            02010000
020101              DISPLAY ' DUPLICATE SML:  '                         02010112
020102                      SUT00024-SHIPT-UNT-ID ' '                   02010216
020103                      SUT00024-CART-SRC-CDE                       02010316
020110                                                                  02011000
020300         WHEN SQLCODE = +100                                      02030000
020310              MOVE 0                TO  PV-SELECT-COUNT           02031012
020400              CONTINUE                                            02040000
020500         WHEN SQLCODE < 0                                         02050000
020600         WHEN SQLCODE > 0                                         02060000
020700         WHEN SQLWARN0 = 'W'                                      02070000
020800             MOVE '3000-CHECK-FOR-DUPLICATE'                      02080000
020900                         TO PV-PARAGRAPH-NAME                     02090000
021000             MOVE 'CHECK FOR DUPLICATE SMLS'                      02100000
021100                         TO PV-DB2-OPERATION-ATTEMPTED            02110000
021200             PERFORM 9100-SQL-ABEND                               02120000
021300     END-EVALUATE.                                                02130000
021400                                                                  02140000
021401                                                                  02140101
021410******************************************************************02141001
021420 7000-READ-SML-REQ.                                               02142001
021430      READ SML-REQ-DATA-EXTRACT                                   02143001
021440           INTO PC264-UPLOAD-ERROR-RECORD                         02144009
021450           AT END SET PS-END-OF-FILE TO TRUE.                     02145001
021460                                                                  02146001
021470      ADD  1  TO  PV-INPUT-COUNT.                                 02147001
021500                                                                  02150000
021510******************************************************************02151001
021520*  CLOSE OUTPUT FILE.  CLOSE THE CURSOR.                          02152001
021530******************************************************************02153001
021600 9000-EOJ-ROUTINE.                                                02160000
021610                                                                  02161001
021620     DISPLAY '* PCKUT107'.                                        02162001
021630     DISPLAY '*'.                                                 02163001
021700     MOVE  PV-INPUT-COUNT       TO PV-DISPLAY-COUNT.              02170001
021800     DISPLAY '* TOTL SML CHECKS: ' PV-DISPLAY-COUNT.              02180001
021900     DISPLAY '*'.                                                 02190001
021910     MOVE  PV-ERROR-COUNT       TO PV-DISPLAY-COUNT.              02191001
021920     DISPLAY '* TOTL DUP SML:    ' PV-DISPLAY-COUNT.              02192001
021930     DISPLAY '*'.                                                 02193001
021940                                                                  02194001
022000     CLOSE SML-REQ-DATA-EXTRACT                                   02200001
022010           ERROR-OUT-FILE.                                        02201001
022100                                                                  02210000
022800 9100-SQL-ABEND.                                                  02280000
022900******************************************************************02290000
023000*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    02300000
023100*  ERROR OR WARNING CODE OCCURS.                                  02310000
023200******************************************************************02320000
023300     DISPLAY '9100-SQL-ABEND'.                                    02330000
023400     DISPLAY '** ABEND     **'.                                   02340000
023500     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        02350000
023600     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              02360000
023700     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     02370000
023800                                                                  02380000
023900******************************************************************02390000
024000* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    02400000
024100* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         02410000
024200* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     02420000
024300* FORMAT.                                                         02430000
024400******************************************************************02440000
024500     COPY DPPD004.                                                02450000
024600                                                                  02460000
024700     MOVE +4013                  TO ABEND-CODE.                   02470000
024800     CALL 'ILBOABN0' USING ABEND-CODE.                            02480000
