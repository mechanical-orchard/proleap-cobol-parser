       IDENTIFICATION DIVISION.                                         00020000
       PROGRAM-ID.    INKCS051.                                         00040000
       AUTHOR.        S. JACKSON                                        00050000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
       DATE-WRITTEN.  07-17-2000.                                       00070000
       DATE-COMPILED.                                                   00080000
                                                                        00090000
      *----------------------------------------------------------------*00100000
      *    I051 - PHYSICAL INVENTORY 'MASS ADD' ADJUSTMENTS.           *00110000
      *                                                                *00120000
      *    THIS PROGRAM IS INVOKED FROM INKCS010. IT IS USED TO ADD    *00130000
      *    ADJUSTMENT ROWS TO THE TADJADD TABLE FOR RECORDS THAT DO    *00140000
      *    CURRENTLY EXIST ON TSUMINV/TADJADD.                         *00150000
      *----------------------------------------------------------------*00160000
W23511*    RONNA BUTZ 4/25/02  - WR23511 - MASS DELETE                  00160000
W23511*    POPULATE THE REASON FIELD WITH DATA FROM CALLING PROGRAM     00160000
W23511*    INKCS010.                                                    00160000
      *----------------------------------------------------------------*00160000
W21732*    IGSI      11/27/02  - WR21732 - NI SKU                       00160000
W21732*    ACCEPT AND DISPLAY NON-INTELLIGENT SKU INSTEAD OF DEPT, CLASS00160000
W21732*    AND SEQ NBR.                                                 00160000
W21732*----------------------------------------------------------------*00160000
C21732*    CHANGE BY S JACKSON  3/17/03                                *        
C21732*    USE DPKUT041 - NEW SKU COMPLIANT UPC LOOKUP MODULE          *        
25248 *                                                                *        
25248 * 25248    10-06-2003  UPC CAPABILITIES & STORE NUMBER EXPANSION *        
25248 *                      -ROD JANSSEN                              *        
W26600* W26600   04-20-2004  STORE NUMBER EXPANSION FOR INV. LEDGER    *        
W26600*                      TEMPORARILY ADD LOC-NBR TO INSERT STMT    *        
W26600*                      -V. LEE YANG                              *        
C26600* C26600   07-20-2004  REMOVED X(03) STORE_NBR FROM DB2 TABLES   *        
C26600*                      AND REPLACE WITH S9(04) LOC_NBR FIELD.    *        
C26600*                      UPDATE ALL DB2 CALLS, ASC- AND PV- FIELDS *        
C26600*                      -SCOTT JACKSON                            *        
W29908* W29908   01-20-2006  -811 SQLCODE ON CALL TO TUPC. ADD ADDL             
      * PM00842120           PARAMETER (EFF_END_DTE) TO DB2 CALL                
W28545* W28545   04-18-2006  ADD INWS400 AND INPD400 FOR NEW PRICING            
W28545*                      LOOK-UP  - B.GRAHAM, STRATAGEM                     
J28545* 28545    06-16-2006  TINVPAR/TINCNTL ARE USED TO GET                    
J28545*                      THE PROPER INV-ID AND STORE                        
J28545*                      -JAN BLAZICH                                       
W28545* F28545   09-12-2006 -B. GRAHAM - STRATAGEM                    *         
W28545*      CHG PASS DATE FROM IN400-PV-EFF-BEG-DTE-IN TO            *         
W28545*                         IN400-PV-EFF-DTE-IN                   *         
W28582* W28582   07-31-2007  AFTER LOOKING UP RETAIL WITH UPC, IF DUMMY         
W28582*                      UPC GET DATA FROM ATTRIBUTES.                      
W28582*                     -J. SELWITSCHKA                                     
      * W33304   05-01-2008  HOLDING INVENTORY LEDGER OPEN ACROSS               
      *                      PERIODS INVENTORY SHORTAGE REPORTING               
      *                      -JILL LIN                                          
      *----------------------------------------------------------------*        
263126* CHANGED 10/26/2021    BY JIM HUNTER      WR: CHG0263126                 
263126* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263126* MAKING THE CALL DYNAMIC VS STATIC.                                      
263126*----------------------------------------------------------------*        
1122RM* CHANGED 11/03/2022    BY BOB MCASEY      WR: CHG0277188                 
1122RM* ADDED THE DPKCS930 COPYBOOK. CHANGED THE PARAMETERS FOR CALLING         
1122RM* THE CICS ARCHITECTURE API.                                              
      *----------------------------------------------------------------*        
      * CHANGED 02/14/2023    BY JEAN KURK       WR: CHG0281359                 
      * REMOVE COPYBOOK FOR UPC CHECK DIGIT ROUTINE                             
      *----------------------------------------------------------------*        
                                                                        00170000
       ENVIRONMENT DIVISION.                                            00190000
       DATA DIVISION.                                                   00210000
                                                                        00230000
       WORKING-STORAGE SECTION.                                         00240000
       01  PC-PROGRAM-CONSTANTS.                                        00250000
           05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'INKCS051'.  00260000
           05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'IN051A  '.  00270000
           05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'INKM051 '.  00280000
           05  PC-TOTAL                 PIC  X(05)  VALUE 'TOTAL'.              
           05  PC-MAX-ADD-LINES         PIC  9(02)  VALUE  13.                  
           05  PC-2                     PIC  9(01)  VALUE 2.                    
W21732     05  PC-8                     PIC  9(01)  VALUE 8.                    
           05  PC-7                     PIC  9(01)  VALUE 7.                    
           05  PC-6                     PIC  9(01)  VALUE 6.                    
           05  PC-9                     PIC  9(01)  VALUE 9.                    
           05  PC-11                    PIC  9(02)  VALUE 11.                   
25248      05  PC-15                    PIC  9(02)  VALUE 15.                   
           05  PC-98                    PIC  9(02)  VALUE 98.                   
           05  PC-SCL                   PIC  X(03)  VALUE 'SCL'.                
           05  PC-NINES-DATE            PIC  X(10)  VALUE '9999-09-09'.         
W33304     05  PC-STR-BKNG-IN-PROGRESS  PIC X(02)   VALUE 'IP'.                 
           05  PC-20-CENTS              PIC S9(01)V99 VALUE .20                 
                                                    COMP-3.                     
           05  PC-MAX-QUANTITY          PIC S9(07)    VALUE +99999              
                                                    COMP-3.                     
           05  PC-MIN-QUANTITY          PIC S9(07)    VALUE -99999              
                                                    COMP-3.                     
           05  PC-MAX-PRICE             PIC S9(05)V99 VALUE +99999.99           
                                                    COMP-3.                     
           05  PC-MAX-EXTENDED-PRICE    PIC S9(09)V99                           
                                                    VALUE +999999999.99         
                                                    COMP-3.                     
           05  PC-MIN-EXTENDED-PRICE    PIC S9(09)V99                           
                                                    VALUE -999999999.99         
                                                    COMP-3.                     
           05  PC-ONE-BILLION           PIC S9(11)  COMP-3                      
                                                    VALUE +1000000000.          
           05  PC-PRIME1                PIC S9(05)  COMP-3                      
                                                    VALUE +38543.               
           05  PC-PRIME2                PIC S9(05)  COMP-3                      
                                                    VALUE +58889.               
           05  PC-MAXIMUM-RETRY-COUNT  PIC S9(4)    VALUE +3                    
                                       COMP SYNC.                               
           05  PC-PRIMER-RECORD        PIC  X(11)   VALUE 'PRIMER READ'.        
                                                                               0
           05  PC-TSYMSG-NUMBERS.                                               
      *  INVALID VALUE                                                         0
               10  PC-TSYMSG-00005      PIC  9(05)  VALUE  00005.               
      *  REQUIRED ENTRY                                                        0
               10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.               
      *  MUST BE NUMERIC                                                00320000
               10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       00330000
      *  CAN NOT BE ZERO                                                00320000
               10  PC-TSYMSG-00010      PIC  9(05)  VALUE  00010.       00330000
      *  DATA NOT CHANGED; NO UPDATE PERFORMED                          00320000
               10  PC-TSYMSG-00046      PIC  9(05)  VALUE  00046.       00330000
      *  UPDATES SUCCESSFUL                                             00320000
               10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       00330000
      *  SKU DOES NOT EXIST                                             00320000
               10  PC-TSYMSG-00073      PIC  9(05)  VALUE  00073.       00340000
      *  RENUMBERED SKU COULD NOT BE FOUND                              00320000
               10  PC-TSYMSG-00125      PIC  9(05)  VALUE  00125.       00310000
      *  SKU/STORE CANNOT ALREADY EXIST FOR THIS ACTION                 00320000
               10  PC-TSYMSG-00376      PIC  9(05)  VALUE  00376.       00310000
      *  SKU IS RENUMBERED - SKU RENUMBERED TO &VAR                     00320000
               10  PC-TSYMSG-00453      PIC  9(05)  VALUE  00453.       00310000
      *  WAIT 15 SECONDS;RETRY FUNCTION AGAIN; IF UNSUCCESSFUL CALL HELP00320000
               10  PC-TSYMSG-00551      PIC  9(05)  VALUE  00551.       00310000
      *  EXTENDED AMOUNT EXCEEDS MAXIMUM ALLOWED; ADJUST QUANTITY OR PRI00320000
      *        10  PC-TSYMSG-00686      PIC  9(05)  VALUE  00686.       00340000
               10  PC-TSYMSG-02536      PIC  9(05)  VALUE  00686.       00340000
      *  QUANTITY GREATER THAN MAXIMUM ALLOWED; MUST BE LESS THAN 99,99900320000
               10  PC-TSYMSG-00687      PIC  9(05)  VALUE  00687.       00340000
      *  PRICE MUST BE GREATER THAN $.20 (TWENTY CENTS)                 00320000
               10  PC-TSYMSG-00688      PIC  9(05)  VALUE  00688.       00340000
      *  NO UPDATES WERE MADE                                           00320000
               10  PC-TSYMSG-01433      PIC  9(05)  VALUE  01433.       00340000
      *  UNIT BOOKING FOR STORE IN PROGRESS ... PLEASE TRY UPDATES LATER00320000
               10  PC-TSYMSG-02150      PIC  9(05)  VALUE  02150.       00340000
      *  ADD FAILED - SELECTION HAS ALREADY BEEN ADDED                  00320000
               10  PC-TSYMSG-02537      PIC  9(05)  VALUE  02303.       00340000
                                                                        00300000
       01  PS-PROGRAM-SUBSCRIPT.                                                
           05  PS-SUB                   PIC S9(04)  VALUE +0  COMP SYNC.        
DELETE     05  PS-SUB2                  PIC S9(04)  VALUE +0  COMP SYNC.        
                                                                                
       01  PS-PROGRAM-SWITCHES.                                                 
           05  PS-FROM-PROGRAM          PIC  X(08)  VALUE SPACES.               
               88  PS-FROM-CRIT-SPEC                VALUE 'INKCS010'.           
               88  PS-FROM-MASS-ADD                 VALUE 'INKCS051'.           
           05  PS-ERROR-SW                 PIC X  VALUE 'Y'.                    
               88  PS-NO-ERROR                    VALUE 'Y'.                    
               88  PS-ERROR                       VALUE 'N'.                    
           05  PS-INVALID-SKU-SW           PIC X  VALUE 'N'.                    
               88  PS-VALID-SKU                   VALUE 'Y'.                    
               88  PS-INVALID-SKU                 VALUE 'N'.                    
25248      05  PS-INVALID-UPC-SW           PIC X  VALUE 'N'.                    
25248          88  PS-VALID-UPC                   VALUE 'Y'.                    
25248          88  PS-INVALID-UPC                 VALUE 'N'.                    
           05  PS-DATA-ENTERED-SW          PIC X  VALUE 'N'.                    
               88  PS-DATA-ENTERED                VALUE 'Y'.                    
               88  PS-NO-DATA-ENTERED             VALUE 'N'.                    
           05  PS-QTY-ERROR-SW             PIC X  VALUE 'N'.                    
               88  PS-QTY-ERROR                   VALUE 'Y'.                    
               88  PS-NO-QTY-ERROR                VALUE 'N'.                    
           05  PS-INSERT-SW             PIC X(01)   VALUE  'N'.                 
               88  PS-INSERT-DONE                   VALUE  'Y'.                 
               88  PS-INSERT-NOT-DONE               VALUE  'N'.                 
           05  PS-ROW-EXISTS-SW         PIC X(01)   VALUE  'N'.                 
               88  PS-ROW-FOUND                     VALUE  'Y'.                 
               88  PS-ROW-NOT-FOUND                 VALUE  'N'.                 
                                                                                
25248  01  WS-EDIT-UPC-SKU-TABLE.                                               
25248      05  WS-EDIT-ELEMENTS    OCCURS 15 TIMES.                             
25248          10  WS-EDIT-BYTE    PIC X(01).                                   
25248                                                                           
       01  PV-PROGRAM-VARIABLES.                                                
25248      05  PV-BYTE-SUB              PIC S9(05) COMP VALUE ZEROS.            
25248      05  PV-BYTE-COUNT            PIC S9(15) COMP VALUE ZEROS.            
25248      05  PV-BYTE-ACCUM            PIC S9(15) COMP VALUE ZEROS.            
25248      05  PV-EDIT-UPC-SKU          PIC X(15).                              
25248      05  PV-EDIT-UPC-SKU-NUM REDEFINES                                    
25248          PV-EDIT-UPC-SKU          PIC 9(15).                              
           05  PV-DISPLAY-RESP          PIC 9(08)  VALUE ZERO.                  
           05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0                    
                                                    COMP SYNC.                  
           05  PV-RETRY-COUNT           PIC S9(04)  VALUE +0                    
                                                    COMP SYNC.                  
           05  PV-RBA                   PIC S9(09)  COMP VALUE ZERO.            
W28545                                                                          
W28545     05  PV-STAT-CDE              PIC  9(02).                             
W28545                                                                          
                                                                                
           05  PV-HOLD-SKU.                                                     
W21732         10  PV-SKU-NBR          PIC X(08) VALUE SPACES.                  
25248          10  PV-SKU-NBR-NUM REDEFINES                                     
25248              PV-SKU-NBR          PIC 9(08).                               
25248                                                                           
           05  PV-HOLD-PRICE            PIC S9(06)V99  COMP-3  VALUE 0.         
                                                                                
           05  PV-CALC-PRICEX.                                                  
               10  PV-CALC-PRICE            PIC  9(06).99.                      
      **       10  PV-CALC-PRICE-RED REDEFINES                                  
      **           PV-CALC-PRICE            PIC  9(06)V99.                      
                                                                                
           05  PV-WORK-UPC-X2.                                                  
               10  FILLER               PIC X(4)    VALUE '0400'.               
W21732         10  PV-UPC-SKU2          PIC X(8).                               
               10  PV-UPC-CHK-DIG2      PIC 9       VALUE ZERO.                 
           05  PV-WORK-UPC2  REDEFINES  PV-WORK-UPC-X2                          
                                        PIC 9(13).                              
           05  PV-MAJ-CL-NBR.                                                   
               10  PV-MAJ-CL-NBR1          PIC X.                               
               10  PV-MAJ-CL-NBR2          PIC X.                               
           05  PV-SUB-CL-NBR.                                                   
               10  PV-SUB-CL-NBR1          PIC X      VALUE '0'.                
               10  PV-SUB-CL-NBR2-3        PIC X(02).                           
                                                                                
           05  PV-RENUMBERED-SKU.                                               
W21732         10  PV-RSKU-NBR          PIC X(08).                              
                                                                                
W26600*    05  PV-STORE-NBR-X           PIC X(03) VALUE ZEROES.                 
W26600*    05  PV-STORE-NBR-9 REDEFINES PV-STORE-NBR-X                          
W26600*                                 PIC 9(03).                              
W26600     05  PV-STORE-NBR-X           PIC X(04) VALUE ZEROES.                 
W26600     05  PV-STORE-NBR-9 REDEFINES PV-STORE-NBR-X                          
W26600                                  PIC 9(04).                              
           05  PV-AREA-NBR              PIC 9(07) VALUE ZEROES.                 
           05  PV-STORE-NAME            PIC X(25) VALUE SPACES.                 
                                                                                
           05  PV-TOT-EXT-PRICE            PIC S9(15)V99 COMP-3.                
                                                                                
25248      05  PV-EDIT-15               PIC ZZZZZZZ99999999.                    
25248      05  FILLER  REDEFINES  PV-EDIT-15.                                   
25248          10  PV-EDIT-15-X         PIC X(15).                              
                                                                                
           05  PV-RANDOM-NUMBER                PIC S9(11)   COMP-3              
                                                            VALUE +0.           
           05  PV-SEED                         PIC S9(11)   COMP-3              
                                                            VALUE +0.           
           05  PV-WORK-FIELD                   PIC S9(17)   COMP-3              
                                                            VALUE +0.           
           05  PV-WORK-FIELD2                  PIC S9(17)   COMP-3              
                                                            VALUE +0.           
           05  PV-TODAYS-TIME                  PIC 9(08)    VALUE ZERO.         
           05  FILLER  REDEFINES  PV-TODAYS-TIME.                               
               10  PV-HH                       PIC 9(02).                       
               10  PV-MIN                      PIC 9(02).                       
               10  PV-SEC                      PIC 9(02).                       
               10  PV-HUND-SEC                 PIC 9(02).                       
           05  PV-INITIAL-SEED                 PIC 9(08)    VALUE ZERO.         
           05  FILLER REDEFINES PV-INITIAL-SEED.                                
               10  PV-SEED-BYTE-1-2            PIC 9(02).                       
               10  PV-SEED-BYTE-3-4            PIC 9(02).                       
               10  PV-SEED-BYTE-5-6            PIC 9(02).                       
               10  PV-SEED-BYTE-7-8            PIC 9(02).                       
                                                                                
           05  PV-SCREEN-TOTALS.                                                
               10  PV-STOTAL-QTY          PIC S9(09)    VALUE +0            INKC
                                                              COMP-3.       INKC
               10  PV-STOTAL-EXTD-RTL     PIC S9(12)V99 VALUE +0            INKC
                                                              COMP-3.       INKC
25248      05  PV-UPC                     PIC 9(15).                        INKC
25248      05  PV-UPC-SKU REDEFINES                                             
25248          PV-UPC.                                                          
25248          10  PV-SKU-P1              PIC 9(07).                            
25248          10  PV-SKU                 PIC 9(08).                        INKC
25248                                                                       INKC
      /*****************************************************************        
      * MASS ADJUSTMENT ADD CICS MAP                                            
      ******************************************************************        
           COPY INKM051.                                                        
                                                                                
       01  MR-OCCURS-LAYOUT                   REDEFINES  IN051AO.               
W26600     05  FILLER                         PIC X(62).                        
           05  MR-SCROLL-AREA                 OCCURS 13 TIMES.                  
W21732         10  MR-SKUL                    PIC S9(04) COMP.                  
W21732         10  MR-SKUF                    PIC  X(01).                       
W21732         10  MR-SKUA REDEFINES                                            
W21732             MR-SKUF                    PIC  X(01).                       
W21732         10  MR-SKUC                    PIC  X(01).                       
W21732         10  MR-SKUH                    PIC  X(01).                       
25248          10  MR-SKU                     PIC  X(15).                       
      *                                                                         
               10  MR-QTYL                    PIC S9(04) COMP.                  
               10  MR-QTYF                    PIC  X(01).                       
               10  MR-QTYA REDEFINES                                            
                   MR-QTYF                    PIC  X(01).                       
               10  MR-QTYC                    PIC  X(01).                       
               10  MR-QTYH                    PIC  X(01).                       
               10  MR-QTYX.                                                     
                   15  MR-QTYO                PIC  ZZZZZZZ.                     
                                                                                
               10  MR-PRICEL                  PIC S9(04) COMP.                  
               10  MR-PRICEF                  PIC  X(01).                       
               10  MR-PRICEA REDEFINES                                          
                   MR-PRICEF                  PIC  X(01).                       
               10  MR-PRICEC                  PIC  X(01).                       
               10  MR-PRICEH                  PIC  X(01).                       
               10  MR-PRICEX.                                                   
                   15 MR-PRICEO               PIC  ZZZZ9.99.                    
                                                                                
               10  MR-EXT-PRICEL              PIC S9(04) COMP.                  
               10  MR-EXT-PRICEF              PIC  X(01).                       
               10  MR-EXT-PRICEA REDEFINES                                      
                   MR-EXT-PRICEF              PIC  X(01).                       
               10  MR-EXT-PRICEC              PIC  X(01).                       
               10  MR-EXT-PRICEH              PIC  X(01).                       
               10  MR-EXT-PRICEX.                                               
                   15  MR-EXT-PRICEO          PIC  Z(10).99.                    
                                                                                
               10  MR-REASONL                 PIC S9(04) COMP.                  
               10  MR-REASONF                 PIC  X(01).                       
               10  MR-REASONA REDEFINES                                         
                   MR-REASONF                 PIC  X(01).                       
               10  MR-REASONC                 PIC  X(01).                       
               10  MR-REASONH                 PIC  X(01).                       
               10  MR-REASONO                 PIC  X(20).                       
      *                                                                         
           05  MR-TOTAL-LINE.                                                   
               10  MR-TOT-LINEL               PIC S9(04) COMP.                  
               10  MR-TOT-LINEF               PIC  X(01).                       
               10  MR-TOT-LINEC               PIC  X(01).                       
               10  MR-TOT-LINEH               PIC  X(01).                       
               10  MR-TOT-LINEO               PIC  X(05).                       
                                                                                
               10  MR-TOT-QTYL                PIC S9(04) COMP.                  
               10  MR-TOT-QTYF                PIC  X(01).                       
               10  MR-TOT-QTYC                PIC  X(01).                       
               10  MR-TOT-QTYH                PIC  X(01).                       
               10  MR-TOT-QTYO                PIC  ZZZ,ZZZ,ZZ9.                 
                                                                                
               10  MR-TOT-EXTD-PRICEL         PIC S9(04) COMP.                  
               10  MR-TOT-EXTD-PRICEF         PIC  X(01).                       
               10  MR-TOT-EXTD-PRICEC         PIC  X(01).                       
               10  MR-TOT-EXTD-PRICEH         PIC  X(01).                       
               10  MR-TOT-EXTD-PRICEO         PIC  ZZZ,ZZZ,ZZZ,ZZZ.99.          
                                                                                
      *----------------------------------------------------------------*        
      *    ATTRIBUTE SETTINGS COPYBOOK.                                *        
      *----------------------------------------------------------------*        
           COPY DPWS015.                                                        
                                                                                
      *----------------------------------------------------------------*        
      *    FUNCTION KEYS COPYBOOK                                      *        
      *----------------------------------------------------------------*        
           COPY DPWS016.                                                        
                                                                                
      *----------------------------------------------------------------*        
      *    VSM  ADJUSTMENT RECORD LAYOUT.                              *        
      *----------------------------------------------------------------*        
           COPY INWS015.                                                        
      /                                                                         
      **--------------------------------------------------------------**        
      ** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **        
      ** SUB-ROUTINE (DPKUT100).                                      **        
      **--------------------------------------------------------------**        
           COPY DPWS010I.                                                       
      /                                                                         
      **--------------------------------------------------------------**        
      ** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS ARCHITECTURE*        
      ** APPLICATION PROGRAMMING INTERFACE MODULE -- DPKCS030.        **        
      **--------------------------------------------------------------**        
           COPY DPWS030.                                                        
1122RM     COPY DPWS930.                                                        
      /                                                                         
      **--------------------------------------------------------------**        
      *    STANDARD COMMAREA.                                                   
      **--------------------------------------------------------------**        
                                                                                
           COPY DPWS020.                                                        
           05  INKCS051-APPL REDEFINES DP020-VARIABLE-COMMAREA.                 
                                                                                
      *****************************************************************         
      *    INTER-APPLICATION COMMAREA.                                          
      *****************************************************************         
                                                                                
               10  INTER-APPL-COMM-AREA PIC X(200).                             
           COPY INWS001.                                                        
      *****************************************************************         
      *    SPECIFIC COMMMAREA FOR INKCS051.                                     
      *****************************************************************         
               10  ASC-SPECIFIC-COMMAREA.                                       
W26600*            15  ASC-STORE-NBR             PIC  X(03).                    
W26600             15  ASC-LOC-NBR               PIC  X(04).                    
W26600             15  ASC-LOC-NBR-9   REDEFINES                                
W26600                 ASC-LOC-NBR               PIC  9(04).                    
                   15  ASC-AREA-NBR              PIC  9(07).                    
                   15  ASC-STORE-NAME            PIC  X(25).                    
                                                                                
                   15  ASC-ADD-NUM               PIC S9(04)    COMP.            
                   15  ASC-SUB                   PIC S9(04)    COMP.            
                                                                                
                   15  ASC-DATA-ARRAY.                                          
                       20 ASC-KEY-MAP-DATA      OCCURS 13 TIMES.                
                          25  ASC-SKU.                                          
25248                         30  ASC-SKU-P1        PIC  X(07).                 
25248                         30  ASC-SKU-NBR       PIC  X(08).                 
25248                     25  ASC-UPC.                                          
25248                         30  ASC-UPC-NBR       PIC  X(15).                 
                          25  ASC-QTYX              PIC  X(07).                 
                          25  ASC-QTY   REDEFINES                               
                              ASC-QTYX              PIC  9(07).                 
                          25  ASC-PRICE-X.                                      
                              30  ASC-PRICEX        PIC  X(08).                 
                              30  ASC-PRICE REDEFINES                           
                                  ASC-PRICEX        PIC  9(06)V99.              
                          25  ASC-EXTD-PRICEX.                                  
                              30  ASC-EXTD-PRICE    PIC  9(10)V99.              
                          25  ASC-REASON            PIC  X(20).                 
                          25  ASC-DKEY-NBR          PIC S9(08)  COMP.           
                          25  ASC-STATUS-CODE       PIC S9(03)  COMP-3.         
                              88  ASC-CLEARANCE              VALUE 30.          
                          25  ASC-SKU-ENTERED-SW        PIC X.                  
                              88 ASC-SKU-ENTERED             VALUE 'Y'.         
                              88 ASC-SKU-NOT-ENTERED         VALUE 'N'.         
25248                     25  ASC-UPC-ENTERED-SW        PIC X.                  
25248                         88 ASC-UPC-ENTERED             VALUE 'Y'.         
25248                         88 ASC-UPC-NOT-ENTERED         VALUE 'N'.         
                          25  ASC-QTY-ENTERED-SW      PIC X.                    
                              88 ASC-QTY-ENTERED             VALUE 'Y'.         
                              88 ASC-QTY-NOT-ENTERED         VALUE 'N'.         
                          25  ASC-QTY-ERROR-SW          PIC X.                  
                              88 ASC-VALID-QTY               VALUE 'V'.         
                              88 ASC-QTY-ERROR               VALUE 'Y'.         
                          25  ASC-PRICE-ENTERED-SW    PIC X.                    
                              88 ASC-PRICE-ENTERED           VALUE 'Y'.         
                              88 ASC-PRICE-NOT-ENTERED       VALUE 'N'.         
                          25  ASC-PRICE-ERROR-SW        PIC X.                  
                              88 ASC-VALID-PRICE             VALUE 'V'.         
                              88 ASC-PRICE-ERROR             VALUE 'Y'.         
                          25  ASC-ALLOW-ADJUSTMENTS-SW  PIC X.                  
                              88  ASC-ADJUSTMENTS-ALLOWED    VALUE 'Y'.         
                              88  ASC-NO-ADJUSTMENTS-ALLOWED VALUE 'N'.         
                          25  ASC-GOOD-SKU-SW           PIC X.                  
                              88  ASC-GOOD-SKU               VALUE  'Y'.        
                              88  ASC-BAD-SKU                VALUE  'N'.        
                          25  ASC-SKU-INSERT-SW         PIC X.                  
                              88 ASC-SKU-INSERT-OK           VALUE 'Y'.         
                              88 ASC-SKU-INSERT-FAILED       VALUE 'N'.         
25248                     25  ASC-GOOD-UPC-SW           PIC X.                  
  |                           88  ASC-GOOD-UPC               VALUE  'Y'.        
  |                           88  ASC-BAD-UPC                VALUE  'N'.        
  |                       25  ASC-UPC-INSERT-SW         PIC X.                  
  |                           88 ASC-UPC-INSERT-OK           VALUE 'Y'.         
25248                         88 ASC-UPC-INSERT-FAILED       VALUE 'N'.         
TOTAL              15  ASC-TOTAL-LINE.                                          
                       20  ASC-TOT-LINE          PIC  X(05).                    
                       20  ASC-TOT-QTY           PIC  9(09).                    
                       20  ASC-TOT-EXTD-PRICE    PIC  9(12)V99.                 
                   15  ASC-HOLD-INTER-APPL       PIC  X(200).                   
25248 *        10  FILLER                        PIC  X(1376).                  
C26600         10  FILLER                        PIC  X(1375).                  
                                                                                
      /----------------------------------------------------------------*        
      *    ABEND PROCESSING COPYBOOK.                                  *        
      *----------------------------------------------------------------*        
           COPY DPWS013.                                                        
                                                                                
      /    DB2 AREA FOR TINVPAR (PI INVENTORY PARM)                             
           EXEC SQL                                                             
                INCLUDE TINVPAR                                                 
           END-EXEC.                                                            
                                                                                
      *    DB2 AREA FOR TINCNTL (PI INVENTORY CONTROL)                          
           EXEC SQL                                                             
                INCLUDE TINCNTL                                                 
           END-EXEC.                                                            
                                                                                
      *    DB2 AREA FOR TSUMINV (PI SUMMARY INVENTORY)                          
           EXEC SQL                                                             
                INCLUDE TSUMINV                                                 
           END-EXEC.                                                            
                                                                                
W28545*    DB2 AND WORKING STORAGE AREAA FOR COMMON PRICING LOOK-UP             
W28545                                                                          
W28545     COPY INWS400.                                                        
W28545                                                                          
25248                                                                           
      *    DB2 AREA FOR TADJADD (PI ADJUSTMENT ADD)                             
           EXEC SQL                                                             
                INCLUDE TADJADD                                                 
           END-EXEC.                                                            
                                                                                
      *    DB2 AREA FOR TADJDTL (PI ADJUSTMENT DETAIL)                          
25248 *    EXEC SQL                                                             
25248 *         INCLUDE TADJDTL                                                 
25248 *    END-EXEC.                                                            
25248 *                                                                         
                                                                                
      *    DB2 AREA FOR COMMUNICATIONS                                          
           EXEC SQL                                                             
                INCLUDE SQLCA                                                   
           END-EXEC.                                                            
                                                                                
       EJECT                                                                    
       LINKAGE SECTION.                                                         
                                                                                
       01  DFHCOMMAREA.                                                         
           05  FILLER                         OCCURS  1 TO 4072 TIMES           
                                              DEPENDING ON EIBCALEN.            
               10  FILLER                     PIC X.                            
                                                                                
                                                                                
       PROCEDURE DIVISION.                                                      
      **-------------------------------------------------------------**         
      ** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. **         
      ** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  **         
      ** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            **         
      **                                                             **         
      ** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  **         
      ** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       **         
      **-------------------------------------------------------------**         
       0000-MAIN-MODULE.                                                        
                                                                                
           INITIALIZE DP030-CICS-API-FIELDS.                                    
           MOVE +1                       TO DP030-NUMBER-OF-MAPS.               
           MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.                  
           MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).                 
                                                                                
           SET DP030-RECEIVE-APPL-MAP    TO TRUE.                               
           MOVE LENGTH OF IN051AI        TO DP030-MAP-LENGTH (1).               
           MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).             
           PERFORM 0001-CALL-CICS-ARCH-API.                                     
                                                                                
           PERFORM 1000-CONTROL-PROCESSING                                      
                                                                                
           MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).             
           PERFORM 0001-CALL-CICS-ARCH-API.                                     
                                                                                
       0001-CALL-CICS-ARCH-API.                                                 
                                                                                
1122RM*    CALL 'DPKCS030' USING DFHEIBLK                                       
1122RM     CALL DP930-CICS-ARCH-API                                             
1122RM                     USING DFHEIBLK                                       
                                 DFHCOMMAREA                                    
                                 DP030-CICS-API-FIELDS                          
                                 DP020-STANDARD-COMMAREA                        
                                 IN051AI.                                       
                                                                                
           IF  DP030-RC-CALL-SUCCESSFUL                                         
               CONTINUE                                                         
           ELSE                                                                 
               SET DP013-NO-ROLLBACK                                            
                   DP013-XCTL-DISPLAY-RESTART                                   
                   DP013-CICS-ABEND      TO TRUE                                
               MOVE 'BEFORE 0000-MAIN-MODULE'                                   
                                         TO DP013-PARAGRAPH                     
1122RM*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX        
1122RM*             'T LINE'             TO DP013-MESSAGE-TEXT (2)              
1122RM         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
1122RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
               MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)              
               PERFORM DP013-0000-PROCESS-ABEND                                 
           END-IF.                                                              
      /                                                                         
      *----------------------------------------------------------------*        
      *    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *        
      *    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *        
      *----------------------------------------------------------------*        
                                                                                
       1000-CONTROL-PROCESSING.                                                 
                                                                                
           EVALUATE TRUE                                                        
               WHEN DP020-NEXT-ACT-INITIAL                                      
                    MOVE 'INKCS010' TO  PS-FROM-PROGRAM                         
                    PERFORM 4000-BUILD-INITIAL-PANEL                            
                                                                                
               WHEN DP020-NEXT-ACT-READ-MAP                                     
                    PERFORM 2000-PROCESS-PANEL                                  
      *                                                                         
               WHEN DP020-NEXT-ACT-RETURN                                       
                    MOVE ASC-HOLD-INTER-APPL                                    
                                         TO  INTER-APPL-COMM-AREA               
                    PERFORM 3000-EDIT-DATA-IN-COMMAREA                          
                    PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                        
      *                                                                         
               WHEN OTHER                                                       
                    SET DP013-LOGIC-ABEND TO TRUE                               
                    SET DP013-NO-ROLLBACK TO TRUE                               
                    MOVE '1000-CONTROL-PROCESSING'                              
                                         TO  DP013-PARAGRAPH                    
                    MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'          
                                         TO  DP013-MESSAGE-TEXT(1)              
                    MOVE DP020-NEXT-APPL-ACTIVITY                               
                                         TO  DP013-MESSAGE-TEXT(2)              
                    PERFORM DP013-0000-PROCESS-ABEND                            
           END-EVALUATE.                                                        
                                                                                
      *----------------------------------------------------------------*        
      * DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *        
      * ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *        
      * USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *        
      * OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *        
      * FUNCTION KEYS CAN GET THIS FAR.                                *        
      *----------------------------------------------------------------*        
       2000-PROCESS-PANEL.                                                      
      *                                                                         
           EVALUATE TRUE                                                        
                                                                                
               WHEN DP020-SRC-AID = DP016-CLEAR                                 
                    PERFORM 3000-EDIT-DATA-IN-COMMAREA                          
                    PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                        
      *                                                                         
               WHEN DP020-FK-REFRESH(DP020-SRC-AID)                             
                    MOVE 'INKCS051' TO  PS-FROM-PROGRAM                         
W26600*             MOVE  ASC-STORE-NBR   TO   IN001-STORE-NBR                  
C26600              MOVE  ASC-LOC-NBR-9   TO   IN001-STORE-NBR                  
                    MOVE  ASC-AREA-NBR    TO   IN001-AREA-NBR                   
                    MOVE  ASC-STORE-NAME  TO   IN001-STORE-NAME                 
                    PERFORM 4000-BUILD-INITIAL-PANEL                            
      *                                                                         
               WHEN OTHER                                                       
                    PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                        
                    PERFORM 3000-EDIT-DATA-IN-COMMAREA                          
                    IF  PS-NO-ERROR                                             
                        SET DP030-CONTINUE-GO                                   
                                         TO TRUE                                
                        PERFORM 2100-CHECK-FUNCTION-KEY                         
                    ELSE                                                        
                        SET DP030-OVERRIDE-GO                                   
                                         TO TRUE                                
                        PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    
                    END-IF                                                      
           END-EVALUATE.                                                        
                                                                                
      *----------------------------------------------------------------*        
      * ONLY VALID PF-KEY FROM THIS SCREEN IS PF13 (ADD)               *        
      *----------------------------------------------------------------*        
       2100-CHECK-FUNCTION-KEY.                                                 
      *                                                                         
           EVALUATE TRUE                                                        
               WHEN DP020-SRC-AID = DP016-ENTER                                 
                    PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                        
                                                                                
               WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                      
      *            --  INSERTS WILL NOT BE ALLOWED WHEN A STORE IS IN           
      *            --  THE UNIT BOOKING PROCESS (BKG_STAT = 'I')                
                   PERFORM 3500-CHECK-BOOKING-STATUS                            
                   IF PC-STR-BKNG-IN-PROGRESS = INVPAR-UNT-BKG-STAT-CDE         
                       SET DP020-MSG-INFORMATIONAL                              
                       DP020-NEXT-ACT-APPL-ERROR  TO  TRUE                      
                       MOVE PC-TSYMSG-02150       TO  DP020-MSG-NUMBER          
                   ELSE                                                         
                       PERFORM 5000-BEGIN-INSERT-PROCESS                        
                                                                                
                       IF  PS-NO-ERROR                                          
===>                   AND PS-INSERT-DONE                                       
      *                --- INSERTS SUCCESSFUL ---                               
                           MOVE PC-TSYMSG-00059                                 
                                         TO DP020-MSG-NUMBER                    
                           SET DP020-MSG-INFORMATIONAL                          
                                         TO TRUE                                
                           INITIALIZE ASC-DATA-ARRAY                            
      *                                                                         
                           PERFORM 4000-BUILD-INITIAL-PANEL                     
                           PERFORM 3900-RESET-ATTRIBUTES                        
                       ELSE                                                     
                           SET PS-ERROR            TO  TRUE                     
                           SET DP020-MSG-FATAL     TO  TRUE                     
                       END-IF                                                   
                   END-IF                                                       
                                                                                
               WHEN OTHER                                                       
                    SET DP013-NO-ROLLBACK                                       
                        DP013-XCTL-DISPLAY-RESTART                              
                        DP013-CICS-ABEND  TO TRUE                               
                    MOVE '2100-CHECK-FUNCTION-KEY'                              
                                         TO DP013-PARAGRAPH                     
                    MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'             
                                         TO DP013-MESSAGE-TEXT (1)              
                    PERFORM DP013-0000-PROCESS-ABEND                            
           END-EVALUATE.                                                        
                                                                                
       2200-MOVE-SCREEN-TO-COMMAREA.                                            
      *                                                                         
           MOVE +0 TO ASC-SUB                                                   
      *                                                                         
           PERFORM VARYING PS-SUB                                               
               FROM 1 BY 1                                                      
                   UNTIL PS-SUB > PC-MAX-ADD-LINES                              
      *                                                                         
           ADD +1 TO ASC-SUB                                                    
           INITIALIZE ASC-QTY-ENTERED-SW (ASC-SUB)                              
                      ASC-PRICE-ENTERED-SW (ASC-SUB)                            
      *                                                                         
W21732     IF  MR-SKUL (PS-SUB) > ZERO                                          
25248          MOVE 1               TO PV-BYTE-SUB                              
25248          MOVE ZEROS           TO PV-BYTE-COUNT                            
25248          MOVE MR-SKU (PS-SUB) TO WS-EDIT-UPC-SKU-TABLE                    
25248          PERFORM 3600-EDIT-UPC-SKU                                        
25248            VARYING PV-BYTE-SUB FROM 1 BY 1                                
25248              UNTIL PV-BYTE-SUB IS GREATER THAN 15                         
25248          MOVE MR-SKU (PS-SUB) TO ASC-SKU (ASC-SUB)                        
25248          IF PV-BYTE-COUNT IS GREATER THAN 8                               
25248              MOVE MR-SKU (PS-SUB) TO ASC-UPC (ASC-SUB)                    
25248              MOVE ALL '0'         TO ASC-SKU (ASC-SUB)                    
25248              SET ASC-UPC-ENTERED (ASC-SUB) TO TRUE                        
25248              SET ASC-SKU-NOT-ENTERED (ASC-SUB) TO TRUE                    
25248          ELSE                                                             
25248              MOVE ALL '0'         TO ASC-UPC (ASC-SUB)                    
25248              SET ASC-SKU-ENTERED (ASC-SUB) TO TRUE                        
25248              SET ASC-UPC-NOT-ENTERED (ASC-SUB) TO TRUE                    
W21732         END-IF                                                           
W21732     ELSE                                                                 
W21732         IF  MR-SKUF (PS-SUB) = DP015-ERASE-EOF                           
W21732             MOVE SPACE           TO ASC-SKU (ASC-SUB)                    
25248              MOVE SPACE           TO ASC-UPC (ASC-SUB)                    
W21732             SET ASC-SKU-NOT-ENTERED (ASC-SUB) TO TRUE                    
25248              SET ASC-UPC-NOT-ENTERED (ASC-SUB) TO TRUE                    
W21732         END-IF                                                           
W21732     END-IF                                                               
      *                                                                         
           IF  MR-QTYL (PS-SUB) > ZERO                                          
               MOVE MR-QTYX (PS-SUB)         TO ASC-QTYX (ASC-SUB)              
               SET  ASC-QTY-ENTERED (ASC-SUB) TO TRUE                           
           ELSE                                                                 
               IF  MR-QTYF (PS-SUB) = DP015-ERASE-EOF                           
                   MOVE ZEROES                   TO ASC-QTY  (ASC-SUB)          
               END-IF                                                           
           END-IF                                                               
      *                                                                         
           IF  MR-PRICEL (PS-SUB) > ZERO                                        
               MOVE MR-PRICEX (PS-SUB)        TO ASC-PRICE-X (ASC-SUB)          
               SET ASC-PRICE-ENTERED (ASC-SUB) TO TRUE                          
               IF  ASC-PRICE-X (ASC-SUB) EQUAL SPACES                           
                   MOVE ZERO                      TO ASC-PRICE (ASC-SUB)        
               END-IF                                                           
           ELSE                                                                 
               IF  MR-PRICEF (PS-SUB) = DP015-ERASE-EOF                         
                   MOVE ZEROES                  TO ASC-PRICE-X (ASC-SUB)        
               END-IF                                                           
           END-IF                                                               
      *                                                                         
           IF  MR-EXT-PRICEL (PS-SUB) > ZERO                                    
               MOVE MR-EXT-PRICEX (PS-SUB)                                      
                               TO ASC-EXTD-PRICE (ASC-SUB)                      
           ELSE                                                                 
               IF  MR-EXT-PRICEF (PS-SUB) = DP015-ERASE-EOF                     
                   MOVE ZEROES TO ASC-EXTD-PRICE (ASC-SUB)                      
               END-IF                                                           
           END-IF                                                               
      *                                                                         
           IF  MR-REASONL (PS-SUB) > ZERO                                       
               MOVE MR-REASONO (PS-SUB)                                         
                               TO ASC-REASON (ASC-SUB)                          
           ELSE                                                                 
               IF  MR-REASONF (PS-SUB) = DP015-ERASE-EOF                        
                   MOVE SPACE  TO ASC-REASON (ASC-SUB)                          
               END-IF                                                           
           END-IF                                                               
      *                                                                         
           END-PERFORM.                                                         
                                                                                
      *----------------------------------------------------------------*        
      * PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *        
      * IS FOUND, THE CURSOR IS POSITIONED AT THAT FIELD AND AN        *        
      * APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *        
      *----------------------------------------------------------------*        
      * VALIDATION IS DONE FOR ENTIRE FIELD TYPE FOR MESSAGING PURPOSES         
      * ORDER OF VALIDATION: QTY , PRICE , EXT PRICE , SKU , REASON             
      *----------------------------------------------------------------*        
      *                                                                         
       3000-EDIT-DATA-IN-COMMAREA.                                              
      *                                                                         
           PERFORM 3220-ELIMINATE-EMPTY-LINES.                          INKCS023
           PERFORM 3900-RESET-ATTRIBUTES.                                       
                                                                                
      *    VALIDATE QTY                                                         
           PERFORM                                                              
             VARYING ASC-SUB                                                    
               FROM PC-MAX-ADD-LINES BY -1                                      
                   UNTIL ASC-SUB < 1                                            
      *                                                                         
               IF  (ASC-QTY-ENTERED (ASC-SUB)                                   
                 OR ASC-QTY-ERROR (ASC-SUB))                                    
      *             AND NOT ASC-VALID-QTY (ASC-SUB))                            
                   PERFORM 3200-VALIDATE-QTY                                    
               END-IF                                                           
           END-PERFORM.                                                         
      *                                                                         
           IF PS-NO-ERROR                                                       
      *        VALIDATE PRICE                                                   
               PERFORM                                                          
                 VARYING ASC-SUB                                                
                   FROM PC-MAX-ADD-LINES BY -1                                  
                       UNTIL ASC-SUB < 1                                        
      *                                                                         
                   IF (ASC-PRICE-ENTERED (ASC-SUB)                              
                    OR ASC-PRICE-ERROR (ASC-SUB))                               
      *            AND NOT ASC-VALID-PRICE (ASC-SUB))                           
                       PERFORM 3300-VALIDATE-PRICE                              
                   END-IF                                                       
               END-PERFORM                                                      
           END-IF.                                                              
      *                                                                         
           IF PS-NO-ERROR                                                       
      *        CALC EXTD RETAIL                                                 
               PERFORM                                                          
                 VARYING ASC-SUB                                                
                   FROM PC-MAX-ADD-LINES BY -1                                  
                       UNTIL ASC-SUB < 1                                        
      *                                                                         
                   IF (ASC-VALID-QTY (ASC-SUB)                                  
                   AND ASC-VALID-PRICE (ASC-SUB))                               
                       PERFORM 3400-CALC-EXTENDED-RETAIL                        
                   END-IF                                                       
               END-PERFORM                                                      
           END-IF.                                                              
      *                                                                         
           IF PS-NO-ERROR                                                       
25248 * VALIDATE UPC/SKU *************                                          
               PERFORM                                                          
                 VARYING ASC-SUB                                                
                   FROM PC-MAX-ADD-LINES BY -1                                  
                       UNTIL ASC-SUB < 1                                        
25248 * SKU ************************                                            
25248 * SKU BASED EDITS....                                                     
                   IF  ASC-SKU-ENTERED (ASC-SUB)                                
                       PERFORM 3100-VALIDATE-SKU                                
25248 * SKU - EDIT QUANTITY...                                                  
                       IF PS-NO-ERROR                                           
                         IF (ASC-QTY-ENTERED (ASC-SUB) OR                       
                             ASC-VALID-QTY (ASC-SUB) )                          
                           CONTINUE                                             
                         ELSE                                                   
                           PERFORM 3200-VALIDATE-QTY                            
                         END-IF                                                 
25248 * SKU - EDIT PRICE...                                                     
                         IF NOT ASC-QTY-ERROR (ASC-SUB)                         
                           IF (ASC-PRICE-ENTERED (ASC-SUB) OR                   
                               ASC-VALID-PRICE (ASC-SUB) )                      
                             CONTINUE                                           
                           ELSE                                                 
                             PERFORM 3300-VALIDATE-PRICE                        
                           END-IF                                               
                         END-IF                                                 
                       END-IF                                                   
                   ELSE                                                         
25248 * UPC ************************                                            
25248 * UPC BASED EDITS....                                                     
  |                IF ASC-UPC-ENTERED (ASC-SUB)                                 
  |                  PERFORM 6000-VALIDATE-UPC                                  
  |   * UPC - EDIT QUANTITY...                                                  
  |                  IF PS-NO-ERROR                                             
  |                    IF (ASC-QTY-ENTERED (ASC-SUB) OR                         
  |                        ASC-VALID-QTY (ASC-SUB) )                            
  |                      CONTINUE                                               
  |                    ELSE                                                     
  |                      PERFORM 3200-VALIDATE-QTY                              
  |                    END-IF                                                   
  |   * UPC - EDIT PRICE...                                                     
  |                    IF NOT ASC-QTY-ERROR (ASC-SUB)                           
  |                      IF (ASC-PRICE-ENTERED (ASC-SUB) OR                     
  |                          ASC-VALID-PRICE (ASC-SUB) )                        
  |                        CONTINUE                                             
  |                      ELSE                                                   
  |                        PERFORM 3300-VALIDATE-PRICE                          
  |                      END-IF                                                 
  |                    END-IF                                                   
  |                  END-IF                                                     
  |   *       **********************                                            
25248              ELSE                                                         
                       IF (ASC-VALID-QTY (ASC-SUB)                              
                       AND ASC-VALID-PRICE (ASC-SUB))                           
                           SET PS-ERROR                                         
                               DP020-MSG-FATAL   TO  TRUE                       
                           MOVE DP015-RED                                       
W21732                                TO MR-SKUC (ASC-SUB)                      
                           MOVE DP015-REVERSE                                   
W21732                                TO MR-SKUH (ASC-SUB)                      
                           MOVE DP015-UNP-ALP-BRT-OFF                           
W21732                                TO MR-SKUA (ASC-SUB)                      
W21732                     MOVE -1    TO MR-SKUL (ASC-SUB)                      
                           MOVE PC-TSYMSG-00007                                 
                                      TO DP020-MSG-NUMBER                       
25248                      SET DP030-SET-CURSOR-APPL-1 TO TRUE                  
                       END-IF                                                   
                     END-IF                                                     
                   END-IF                                                       
               END-PERFORM                                                      
           END-IF.                                                              
                                                                                
           IF PS-NO-ERROR                                                       
      * CHECK REASON                                                            
               PERFORM                                                          
                 VARYING ASC-SUB                                                
                   FROM PC-MAX-ADD-LINES BY -1                                  
                       UNTIL ASC-SUB < 1                                        
                                                                                
25248              IF ((ASC-GOOD-SKU (ASC-SUB) OR                               
25248                   ASC-GOOD-UPC (ASC-SUB))                                 
                   AND ASC-REASON (ASC-SUB) EQUAL SPACES)                       
                       SET PS-ERROR                                             
                           DP020-MSG-FATAL   TO  TRUE                           
                       MOVE DP015-RED                                           
                                  TO MR-REASONC (ASC-SUB)                       
                       MOVE DP015-REVERSE                                       
                                  TO MR-REASONH (ASC-SUB)                       
                       MOVE DP015-UNP-ALP-BRT-OFF                               
                                  TO MR-REASONA (ASC-SUB)                       
                       MOVE -1    TO MR-REASONL (ASC-SUB)                       
                       MOVE PC-TSYMSG-00007                                     
                                  TO DP020-MSG-NUMBER                           
25248                  SET DP030-SET-CURSOR-APPL-1 TO TRUE                      
                   END-IF                                                       
               END-PERFORM                                                      
           END-IF.                                                              
      *                                                                         
25248 /----------------------------------------------------------------*        
25248 *3100-VALIDATE-SKU.                                                       
25248 *----------------------------------------------------------------*        
       3100-VALIDATE-SKU.                                                       
                                                                                
25248      PERFORM 3120-FORMAT-NUMERIC-SKU.                                     
25248                                                                           
           IF NOT ASC-BAD-SKU (ASC-SUB)                                         
               PERFORM 3110-VALIDATE-ADJ-ALLOWED                                
               IF ASC-ADJUSTMENTS-ALLOWED (ASC-SUB)                             
                   PERFORM 3130-PROCESS-SKU                                     
W28545             IF IN400-PV-NOT-FOUND                                        
                       PERFORM 3199-SET-SKU-ERROR                               
                   ELSE                                                         
                       PERFORM 3180-CONTINUE-SKU-CHECK                          
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
      /----------------------------------------------------------------*        
      *    THE MASS ADD FUNCTION ALLOWS ENTRIES OF 8 DIGIT SKU TO      *        
      *    AN EXISTING STORE/AREA COMBINATION. HOWEVER, THE SKU CAN    *        
      *    NOT CURRENTLY EXIST ON TSUMINV OR TADJADD.                  *        
      *----------------------------------------------------------------*        
       3110-VALIDATE-ADJ-ALLOWED.                                               
25248 *** TSUMINV - ALLOW UPC/SKU ADJUSTMENT WHEN NO EXIST?????                 
25248                                                                           
           MOVE ASC-AREA-NBR              TO SUMINV-AREA-NBR.                   
W21732*    MOVE ASC-STORE-NBR             TO SUMINV-STORE-NBR.                  
C26600     MOVE ASC-LOC-NBR-9             TO SUMINV-LOC-NBR.                    
                                                                                
25248      MOVE ASC-SKU       (ASC-SUB)   TO PV-EDIT-UPC-SKU.                   
25248      MOVE PV-EDIT-UPC-SKU-NUM       TO PV-UPC.                            
W21732     MOVE PV-SKU                    TO SUMINV-SKU-NBR                     
W21732                                       PV-SKU-NBR.                        
25248                                                                           
RWJ   *    MOVE ASC-UPC       (ASC-SUB)   TO PV-EDIT-UPC-SKU.                   
RWJ   *    MOVE PV-EDIT-UPC-SKU-NUM       TO PV-UPC.                            
RWJ   *    MOVE PV-UPC                    TO SUMINV-UPC-NBR.                    
RWJ   *                                                                         
W21732     MOVE ASC-PRICE     (ASC-SUB)   TO SUMINV-INV-UNIT-PR-AMT.            
                                                                                
           EXEC SQL                                                             
W21732         SELECT SKU_NBR                                                   
W21732         INTO :SUMINV-SKU-NBR                                             
               FROM TSUMINV                                                     
W21732*        WHERE STORE_NBR         =  :SUMINV-STORE-NBR                     
C26600         WHERE LOC_NBR           =  :SUMINV-LOC-NBR                       
                 AND AREA_NBR          =  :SUMINV-AREA-NBR                      
W21732           AND SKU_NBR           =  :SUMINV-SKU-NBR                       
RWJ   *          AND UPC_NBR           =  :SUMINV-UPC-NBR                       
W21732           AND INV_UNIT_PR_AMT   =  :SUMINV-INV-UNIT-PR-AMT               
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
               WHEN SQLCODE = -811                                              
                    SET PS-ERROR                                                
                        DP020-MSG-FATAL                                         
                        ASC-NO-ADJUSTMENTS-ALLOWED (ASC-SUB) TO TRUE            
               WHEN SQLCODE = +100                                              
                    SET ASC-ADJUSTMENTS-ALLOWED (ASC-SUB) TO TRUE               
               WHEN SQLCODE = -904                                              
               WHEN SQLCODE = -913                                              
                    PERFORM 9900-SOFT-ABORT                                     
               WHEN SQLWARN0 NOT = SPACES                                       
               WHEN SQLCODE NOT EQUAL ZERO                                      
                   MOVE '3110-VALIDATE-ADJ (1)'                                 
                                     TO DP013-PARAGRAPH                         
                   MOVE 'SELECT SKU'                                            
                                     TO DP013-MESSAGE-TEXT (1)                  
                   MOVE SQLCA        TO DP013-SQLCA                             
                   MOVE 'TSUMINV'    TO DP013-DB2-TABLE-NAME (1)                
                   SET DP013-DB2-ABEND                                          
                       DP013-XCTL-DISPLAY-RESTART                               
                                    TO TRUE                                     
                   PERFORM DP013-0000-PROCESS-ABEND                             
           END-EVALUATE.                                                        
                                                                                
25248 *** TADJADD - ALLOW UPC/SKU ADJUSTMENT WHEN NO EXIST?????                 
25248                                                                           
           IF ASC-NO-ADJUSTMENTS-ALLOWED (ASC-SUB)                              
               CONTINUE                                                         
           ELSE                                                                 
               MOVE ASC-AREA-NBR              TO ADJADD-AREA-NBR                
W21732*        MOVE ASC-STORE-NBR             TO ADJADD-STORE-NBR               
C26600         MOVE ASC-LOC-NBR-9             TO ADJADD-LOC-NBR                 
25248                                                                           
25248          MOVE ASC-SKU       (ASC-SUB)   TO PV-EDIT-UPC-SKU                
25248          MOVE PV-EDIT-UPC-SKU-NUM       TO PV-UPC                         
W21732         MOVE PV-SKU                    TO ADJADD-SKU-NBR                 
25248                                                                           
RWJ   *        MOVE ASC-UPC       (ASC-SUB)   TO PV-EDIT-UPC-SKU                
RWJ   *        MOVE PV-EDIT-UPC-SKU-NUM       TO PV-UPC                         
RWJ   *        MOVE PV-UPC                    TO ADJADD-UPC-NBR                 
RWJ   *                                                                         
W21732         MOVE ASC-PRICE     (ASC-SUB)   TO ADJADD-ADJ-UNIT-PR-AMT         
                                                                                
               EXEC SQL                                                         
W21732             SELECT SKU_NBR                                               
W21732             INTO :ADJADD-SKU-NBR                                         
                   FROM TADJADD                                                 
W21732*            WHERE STORE_NBR      = :ADJADD-STORE-NBR                     
C26600             WHERE LOC_NBR        = :ADJADD-LOC-NBR                       
                    AND AREA_NBR        = :ADJADD-AREA-NBR                      
W21732              AND SKU_NBR         = :ADJADD-SKU-NBR                       
RWJ   *             AND UPC_NBR         = :ADJADD-UPC-NBR                       
W21732              AND ADJ_UNIT_PR_AMT = :ADJADD-ADJ-UNIT-PR-AMT               
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = ZERO                                          
W28582             WHEN SQLCODE = -811                                          
                        SET PS-ERROR                                            
                            DP020-MSG-FATAL                                     
                            ASC-NO-ADJUSTMENTS-ALLOWED (ASC-SUB) TO TRUE        
                   WHEN SQLCODE = +100                                          
                        SET ASC-ADJUSTMENTS-ALLOWED (ASC-SUB)   TO TRUE         
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -913                                          
                        PERFORM 9900-SOFT-ABORT                                 
                   WHEN SQLWARN0 NOT = SPACES                                   
                   WHEN SQLCODE NOT EQUAL ZERO                                  
                        MOVE '3110-VALIDATE-ADJ (2)' TO DP013-PARAGRAPH         
                        MOVE 'SELECT SKU'   TO DP013-MESSAGE-TEXT (1)           
                        MOVE SQLCA          TO DP013-SQLCA                      
                        MOVE 'TADJADD'      TO DP013-DB2-TABLE-NAME (1)         
                        SET DP013-DB2-ABEND                                     
                            DP013-XCTL-DISPLAY-RESTART                          
                                         TO TRUE                                
                        PERFORM DP013-0000-PROCESS-ABEND                        
               END-EVALUATE                                                     
           END-IF.                                                              
                                                                                
           IF ASC-NO-ADJUSTMENTS-ALLOWED (ASC-SUB)                              
               MOVE PC-TSYMSG-00376            TO  DP020-MSG-NUMBER             
W21732         MOVE DP015-UNP-ALP-BRT-OFF      TO  MR-SKUA (ASC-SUB)            
W21732         MOVE DP015-RED                  TO  MR-SKUC (ASC-SUB)            
W21732         MOVE DP015-REVERSE              TO  MR-SKUH (ASC-SUB)            
W21732         MOVE -1                         TO  MR-SKUL (ASC-SUB)            
25248          SET DP030-SET-CURSOR-APPL-1     TO TRUE                          
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------------*        
      *    ENSURE SKU IS NUMERIC                                       *        
      *----------------------------------------------------------------*        
       3120-FORMAT-NUMERIC-SKU.                                                 
                                                                                
           SET ASC-GOOD-SKU (ASC-SUB)    TO  TRUE.                              
                                                                                
25248      MOVE ASC-SKU     (ASC-SUB)    TO  DP010I-UNEDITED-FIELD.             
25248      MOVE PC-15                    TO  DP010I-MAXIMUM-DIGITS.             
           MOVE ZERO                     TO  DP010I-MAXIMUM-DECIMALS.           
           SET DP010I-NEGATIVE-NOT-ALLOWED                                      
                                         TO  TRUE.                              
263126     CALL DP010I-NUMERIC-EDIT-ROUTINE                                     
263126          USING DP010I-NUMERIC-EDIT-AREA.                                 
                                                                                
           IF  DP010I-ERROR-DETECTED                                            
               PERFORM 3199-SET-SKU-ERROR                                       
           ELSE                                                                 
25248          MOVE DP010I-NUM-FIELD-15-DIG-2-DEC TO PV-EDIT-15                 
25248          MOVE PV-EDIT-15-X         TO  ASC-SKU (ASC-SUB)                  
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------------*        
      *    NOW CHECK IF THE SKU EXISTS.                                *        
      *----------------------------------------------------------------*        
       3130-PROCESS-SKU.                                                        
                                                                                
25248      MOVE PV-SKU-NBR-NUM     TO PV-UPC.                                   
W28545                                                                          
W28545     INITIALIZE IN400-PV-INPUT-AREA.                                      
W28545                                                                          
F28545     MOVE IN001-DB2-ACTL-INV-DTE  TO IN400-PV-EFF-DTE-IN.                 
W28545     MOVE 'SKU'                   TO IN400-PV-LOOKUP-TYPE-IN.             
W28545     MOVE PV-SKU                  TO IN400-PV-SKU-IN-NUM                  
W28545     MOVE ASC-LOC-NBR-9           TO IN400-PV-LOC-IN-NUM.                 
W28545                                                                          
W28545     PERFORM IN400-LOOKUP-RETAIL.                                         
W28545                                                                          
W28545     IF IN400-PV-FOUND                                                    
W28545         MOVE IN400-PRC-STATUS-OUT TO PV-STAT-CDE                         
W28545     ELSE                                                                 
W28545         IF IN400-PV-NOT-FOUND                                            
W28545             MOVE ZEROS           TO PV-STAT-CDE                          
W28545     ELSE                                                                 
W28545             MOVE '3130-PROCESS-SKU'                                      
W28545                                   TO DP013-PARAGRAPH                     
W28545             MOVE 'CALL INPD400 - SELECT SKU '                            
W28545                                   TO DP013-MESSAGE-TEXT (1)              
W28545             MOVE IN400-PV-RETURN-RSN                                     
W28545                                   TO DP013-MESSAGE-TEXT (2)              
W28545             MOVE IN400-PV-PARAGRAPH                                      
W28545                                   TO DP013-MESSAGE-TEXT (3)              
W28545             MOVE IN400-PV-PRC-SQLCDE                                     
W28545                                   TO DP013-SQLCA                         
W28545             MOVE '???????'    TO DP013-DB2-TABLE-NAME (1)                
W28545             SET DP013-DB2-ABEND                                          
W28545                     DP013-XCTL-DISPLAY-RESTART                           
W28545                                   TO TRUE                                
W28545             PERFORM DP013-0000-PROCESS-ABEND                             
W28545     END-IF.                                                              
W28545                                                                          
W28545     MOVE PV-STAT-CDE              TO  ASC-STATUS-CODE (ASC-SUB).         
                                                                                
      *----------------------------------------------------------------*        
      *    SEE IF THE SKU IS RENUMBERED.                               *        
      *----------------------------------------------------------------*        
       3180-CONTINUE-SKU-CHECK.                                                 
                                                                                
W28545     IF  IN400-PV-FOUND  AND                                              
W28545         IN400-PV-SKU-IN-NUM NOT EQUAL IN400-PRC-SKU-OUT AND              
W28545         IN400-PRC-SKU-OUT NOT = ZEROS                                    
                   SET DP020-MSG-INFORMATIONAL                                  
                                          TO  TRUE                              
                   MOVE PC-TSYMSG-00453                                         
                                          TO  DP020-MSG-NUMBER                  
W28545             MOVE IN400-PRC-SKU-OUT TO  PV-SKU                            
W21732             MOVE PV-SKU            TO  PV-RSKU-NBR                       
25248              MOVE PV-UPC            TO  PV-EDIT-15                        
25248              MOVE PV-EDIT-15-X      TO  ASC-SKU (ASC-SUB)                 
W28545             MOVE PV-RENUMBERED-SKU                                       
W28545                                    TO  DP020-MSG-TEXT                    
           END-IF.                                                              
                                                                                
      /----------------------------------------------------------------*        
      *    COMMON ROUTINE TO SET SKU ERROR FLAGS.                      *        
      *----------------------------------------------------------------*        
       3199-SET-SKU-ERROR.                                                      
                                                                                
           SET PS-ERROR                                                         
               ASC-BAD-SKU (ASC-SUB)                                            
               DP020-MSG-FATAL           TO  TRUE.                              
           MOVE PC-TSYMSG-00073          TO  DP020-MSG-NUMBER.                  
W21732     MOVE DP015-UNP-NUM-BRT-OFF    TO  MR-SKUA (ASC-SUB)                  
W21732     MOVE DP015-RED                TO  MR-SKUC (ASC-SUB)                  
W21732     MOVE DP015-REVERSE            TO  MR-SKUH (ASC-SUB)                  
W21732     MOVE -1                       TO  MR-SKUL (ASC-SUB).                 
25248      SET DP030-SET-CURSOR-APPL-1   TO TRUE.                               
                                                                                
      *----------------------------------------------------------------*        
      *    ENSURE THE QUANTITY IS NUMERIC                              *        
      *----------------------------------------------------------------*        
                                                                                
       3200-VALIDATE-QTY.                                                       
                                                                                
           SET  ASC-VALID-QTY (ASC-SUB) TO TRUE.                                
                                                                                
           IF ASC-QTYX (ASC-SUB) = SPACE                                        
               SET PS-ERROR                                                     
                   ASC-QTY-ERROR (ASC-SUB)                                      
                   DP020-MSG-FATAL         TO TRUE                              
      *        ---- REQUIRED FIELD ----                                         
               MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER                  
               MOVE DP015-UNP-NUM-BRT-OFF  TO MR-QTYA (ASC-SUB)                 
               MOVE DP015-RED              TO MR-QTYC (ASC-SUB)                 
               MOVE DP015-REVERSE          TO MR-QTYH (ASC-SUB)                 
               MOVE -1                     TO MR-QTYL (ASC-SUB)                 
               SET DP030-SET-CURSOR-APPL-1 TO TRUE                              
           ELSE                                                                 
               MOVE ASC-QTYX (ASC-SUB)     TO  DP010I-UNEDITED-FIELD            
               MOVE PC-7                   TO  DP010I-MAXIMUM-DIGITS            
               MOVE ZERO                   TO  DP010I-MAXIMUM-DECIMALS          
               SET DP010I-NEGATIVE-NOT-ALLOWED  TO  TRUE                        
263126         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263126              USING DP010I-NUMERIC-EDIT-AREA                              
    ***                                                                         
               IF  DP010I-ERROR-DETECTED                                        
                   SET PS-ERROR                                                 
                       ASC-QTY-ERROR (ASC-SUB)                                  
                       DP020-MSG-FATAL       TO  TRUE                           
                   MOVE PC-TSYMSG-00005      TO  DP020-MSG-NUMBER               
                   MOVE DP015-UNP-ALP-BRT-OFF                                   
                                             TO  MR-QTYA (ASC-SUB)              
                   MOVE DP015-RED            TO  MR-QTYC (ASC-SUB)              
                   MOVE DP015-REVERSE        TO  MR-QTYH (ASC-SUB)              
                   MOVE -1                   TO  MR-QTYL (ASC-SUB)              
25248              SET DP030-SET-CURSOR-APPL-1 TO TRUE                          
               ELSE                                                             
                   MOVE DP010I-NUMERIC-FIELD   TO ASC-QTY (ASC-SUB)             
      *                                                                         
      *VALIDATE NUMERIC DATA ENTERED (NON-ZERO W/IN SIZE CONSTRAINTS)           
                   IF (ASC-QTY (ASC-SUB) EQUAL ZERO )                           
                       SET PS-ERROR                                             
                           ASC-QTY-ERROR (ASC-SUB)                              
                           DP020-MSG-FATAL   TO  TRUE                           
                       MOVE PC-TSYMSG-00010  TO  DP020-MSG-NUMBER               
                       MOVE DP015-UNP-ALP-BRT-OFF                               
                                             TO  MR-QTYA (ASC-SUB)              
                       MOVE DP015-RED        TO  MR-QTYC (ASC-SUB)              
                       MOVE DP015-REVERSE    TO  MR-QTYH (ASC-SUB)              
                       MOVE -1               TO  MR-QTYL (ASC-SUB)              
25248                  SET DP030-SET-CURSOR-APPL-1 TO TRUE                      
                   ELSE                                                         
      *                                                                         
                       IF (ASC-QTY (ASC-SUB) GREATER PC-MAX-QUANTITY            
                       OR  ASC-QTY (ASC-SUB) LESS    PC-MIN-QUANTITY)           
                           SET PS-ERROR                                         
                               ASC-QTY-ERROR (ASC-SUB)                          
                               DP020-MSG-FATAL   TO  TRUE                       
                           MOVE PC-TSYMSG-00687  TO  DP020-MSG-NUMBER           
                           MOVE DP015-UNP-ALP-BRT-OFF                           
                                                 TO  MR-QTYA (ASC-SUB)          
                           MOVE DP015-RED        TO  MR-QTYC (ASC-SUB)          
                           MOVE DP015-REVERSE    TO  MR-QTYH (ASC-SUB)          
                           MOVE -1               TO  MR-QTYL (ASC-SUB)          
25248                      SET DP030-SET-CURSOR-APPL-1 TO TRUE                  
                       ELSE                                                     
                          MOVE DP010I-NUMERIC-FIELD TO ASC-QTY (ASC-SUB)        
                       END-IF                                                   
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
      /                                                                         
DELETE*----------------------------------------------------------------*INKCS023
      * IF THE SKU IS EMPTY,                                           *INKCS023
      * REMOVE THE ENTIRE LINE AND MOVE THE SUBSEQUENT LINES UP TO     *INKCS023
      * CLOSE THE GAP.                                                 *INKCS023
      *----------------------------------------------------------------*INKCS023
                                                                        INKCS023
       3220-ELIMINATE-EMPTY-LINES.                                      INKCS023
                                                                        INKCS023
           MOVE +1 TO PS-SUB2.                                          INKCS023
           PERFORM VARYING PS-SUB FROM 1 BY 1                           INKCS023
                     UNTIL PS-SUB > PC-MAX-ADD-LINES                    INKCS023
               IF ASC-SKU-ENTERED (PS-SUB)                              INKCS023
                   MOVE ASC-KEY-MAP-DATA (PS-SUB)                       INKCS023
                     TO ASC-KEY-MAP-DATA (PS-SUB2)                      INKCS023
                                                                        INKCS023
                   IF ASC-SKU-NOT-ENTERED (PS-SUB2)                     INKCS023
W21732                 MOVE SPACE TO ASC-SKU       (PS-SUB2)            INKCS023
                   END-IF                                               INKCS023
                                                                        INKCS023
                   ADD +1 TO PS-SUB2                                    INKCS023
                   SET PS-DATA-ENTERED TO TRUE                          INKCS023
25248          END-IF                                                           
  |            IF ASC-UPC-ENTERED (PS-SUB)                              INKCS023
  |                MOVE ASC-KEY-MAP-DATA (PS-SUB)                       INKCS023
  |                                    TO ASC-KEY-MAP-DATA (PS-SUB2)    INKCS023
  |                IF ASC-UPC-NOT-ENTERED (PS-SUB2)                     INKCS023
  |                    MOVE SPACE      TO ASC-UPC (PS-SUB2)             INKCS023
  |                END-IF                                               INKCS023
  |                ADD +1              TO PS-SUB2                       INKCS023
25248              SET PS-DATA-ENTERED TO TRUE                          INKCS023
               END-IF                                                   INKCS023
           END-PERFORM.                                                 INKCS023
                                                                        INKCS023
           PERFORM VARYING PS-SUB2 FROM PS-SUB2 BY 1                    INKCS023
                     UNTIL PS-SUB2 > PC-MAX-ADD-LINES                   INKCS023
               INITIALIZE ASC-KEY-MAP-DATA (PS-SUB2)                    INKCS023
           END-PERFORM.                                                 INKCS023
DELETE                                                                  INKCS023
      /                                                                         
      *----------------------------------------------------------------*        
      *    ENSURE THE PRICE IS VALID.                                  *        
      *----------------------------------------------------------------*        
                                                                                
       3300-VALIDATE-PRICE.                                                     
      *                                                                         
           SET  ASC-VALID-PRICE (ASC-SUB) TO TRUE.                              
           MOVE PC-7                        TO  DP010I-MAXIMUM-DIGITS.          
           MOVE PC-2                        TO  DP010I-MAXIMUM-DECIMALS.        
           MOVE ASC-PRICE-X (ASC-SUB)       TO  DP010I-UNEDITED-FIELD.          
           SET DP010I-NEGATIVE-NOT-ALLOWED  TO  TRUE.                           
263126     CALL DP010I-NUMERIC-EDIT-ROUTINE                                     
263126          USING DP010I-NUMERIC-EDIT-AREA.                                 
                                                                                
           IF  DP010I-ERROR-DETECTED                                            
               SET PS-ERROR                                                     
                   ASC-PRICE-ERROR (ASC-SUB)                                    
                   DP020-MSG-FATAL          TO  TRUE                            
               MOVE PC-TSYMSG-00005         TO  DP020-MSG-NUMBER                
               MOVE DP015-UNP-ALP-BRT-OFF   TO  MR-PRICEA (ASC-SUB)             
               MOVE DP015-RED               TO  MR-PRICEC (ASC-SUB)             
               MOVE DP015-REVERSE           TO  MR-PRICEH (ASC-SUB)             
               MOVE -1                      TO  MR-PRICEL (ASC-SUB)             
25248          SET DP030-SET-CURSOR-APPL-1 TO TRUE                              
           ELSE                                                                 
               IF  DP010I-NUMERIC-FIELD LESS THAN PC-20-CENTS                   
                   SET PS-ERROR                                                 
                       ASC-PRICE-ERROR (ASC-SUB)                                
                       DP020-MSG-FATAL      TO  TRUE                            
                   MOVE PC-TSYMSG-00688     TO  DP020-MSG-NUMBER                
                   MOVE DP015-UNP-ALP-BRT-OFF                                   
                                            TO MR-PRICEA (ASC-SUB)              
                   MOVE DP015-RED           TO MR-PRICEC (ASC-SUB)              
                   MOVE DP015-REVERSE       TO MR-PRICEH (ASC-SUB)              
                   MOVE -1                  TO MR-PRICEL (ASC-SUB)              
25248              SET DP030-SET-CURSOR-APPL-1 TO TRUE                          
               ELSE                                                             
                   IF  DP010I-NUMERIC-FIELD > PC-MAX-PRICE                      
                       SET PS-ERROR                                             
                           ASC-PRICE-ERROR (ASC-SUB)                            
                           DP020-MSG-FATAL  TO TRUE                             
                       MOVE PC-TSYMSG-02536 TO  DP020-MSG-NUMBER                
                       MOVE DP015-UNP-ALP-BRT-OFF                               
                                            TO MR-PRICEA (ASC-SUB)              
                       MOVE DP015-RED       TO MR-PRICEC (ASC-SUB)              
                       MOVE DP015-REVERSE   TO MR-PRICEH (ASC-SUB)              
                       MOVE -1              TO MR-PRICEL (ASC-SUB)              
25248                  SET DP030-SET-CURSOR-APPL-1 TO TRUE                      
                   ELSE                                                         
                       IF  DP010I-NUMERIC-FIELD EQUAL ZERO                      
                           SET PS-ERROR                                         
                               DP020-MSG-FATAL  TO TRUE                         
                           MOVE PC-TSYMSG-00010 TO  DP020-MSG-NUMBER            
                           MOVE DP015-UNP-ALP-BRT-OFF                           
                                                TO MR-PRICEA (ASC-SUB)          
                           MOVE DP015-RED       TO MR-PRICEC (ASC-SUB)          
                           MOVE DP015-REVERSE   TO MR-PRICEH (ASC-SUB)          
                           MOVE -1              TO MR-PRICEL (ASC-SUB)          
25248                      SET DP030-SET-CURSOR-APPL-1 TO TRUE                  
                       ELSE                                                     
                           MOVE DP010I-NUMERIC-FIELD                            
                                                TO  ASC-PRICE (ASC-SUB)         
25248                      SET DP030-SET-CURSOR-APPL-1 TO TRUE                  
                       END-IF                                                   
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
      *                                                                         
      *----------------------------------------------------------------*        
      *    SEE IF WE EXCEEDED THE MAXIMUM ADJUSTMENT ALLOWED.          *        
      *----------------------------------------------------------------*        
                                                                                
       3400-CALC-EXTENDED-RETAIL.                                               
     **                                                                         
    **     MOVE ASC-PRICE-X (ASC-SUB)  TO PV-CALC-PRICEX                        
           COMPUTE PV-TOT-EXT-PRICE       =  ASC-PRICE (ASC-SUB)                
                                          *  ASC-QTY   (ASC-SUB)                
                                                                                
           MOVE  PV-TOT-EXT-PRICE  TO ASC-EXTD-PRICE (ASC-SUB).                 
                                                                                
      * CALCULATE SCREEN TOTALS                                                 
           ADD ASC-QTY        (ASC-SUB) TO  PV-STOTAL-QTY.                      
           ADD ASC-EXTD-PRICE (ASC-SUB) TO  PV-STOTAL-EXTD-RTL.                 
                                                                                
           MOVE PV-STOTAL-QTY           TO  ASC-TOT-QTY.                        
           MOVE PV-STOTAL-EXTD-RTL      TO  ASC-TOT-EXTD-PRICE.                 
                                                                                
      /                                                                         
      *----------------------------------------------------------------*        
      *    READ THE TINVPAR AND CHECK IF THE BOOKING PROCESS FOR THE   *        
      *    STORE IS CURRENTLY TAKING PLACE                             *        
      *----------------------------------------------------------------*        
                                                                                
       3500-CHECK-BOOKING-STATUS.                                               
                                                                                
C26600         MOVE ASC-LOC-NBR-9  TO INVPAR-LOC-NBR                            
J28545         MOVE IN001-INV-ID   TO INVPAR-INV-ID.                            
                                                                                
               EXEC SQL                                                         
J28545            SELECT  A.ACTL_UNIT_BK_DTE                                    
J28545                   ,A.UNT_BKG_STAT_CDE                                    
                  INTO   :INVPAR-ACTL-UNIT-BK-DTE                               
                        ,:INVPAR-UNT-BKG-STAT-CDE                               
                    FROM   TINVPAR  A                                           
                          ,TINCNTL  B                                           
W26600*             WHERE  STORE_NBR = :ASC-STORE-NBR                           
J28545              WHERE A.LOC_NBR = :INVPAR-LOC-NBR                           
J28545                AND A.INV_ID = :INVPAR-INV-ID                             
J28545                AND A.INV_ID = B.INV_ID                                   
W33304                AND A.ACTL_FIN_BK_DTE = :PC-NINES-DATE                    
W33304                AND A.LOC_INV_STAT_CDE = 'IN'                             
               END-EXEC.                                                        
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = ZERO                                          
                        CONTINUE                                                
                   WHEN SQLCODE = +100                                          
W33304                  MOVE 'IN'          TO INVPAR-UNT-BKG-STAT-CDE           
                        MOVE PC-NINES-DATE TO INVPAR-ACTL-UNIT-BK-DTE           
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -913                                          
                        PERFORM 9900-SOFT-ABORT                                 
                   WHEN SQLWARN0 NOT = SPACES                                   
                   WHEN SQLCODE NOT EQUAL ZERO                                  
                       MOVE '3500-CHECK-BOOKING-STATUS'                         
                                         TO DP013-PARAGRAPH                     
                       MOVE 'SELECT TINVPAR'                                    
                                         TO DP013-MESSAGE-TEXT (1)              
                       MOVE SQLCA        TO DP013-SQLCA                         
                       MOVE 'TINVPAR'    TO DP013-DB2-TABLE-NAME (1)            
                       SET DP013-DB2-ABEND                                      
                           DP013-XCTL-DISPLAY-RESTART                           
                                         TO TRUE                                
                       PERFORM DP013-0000-PROCESS-ABEND                         
               END-EVALUATE.                                                    
                                                                                
25248 *----------------------------------------------------------------*        
25248 * 3600-EDIT THE UPC OR SKU.                                               
25248 *    THE ROUTINE COUNTS THE NUMBER OF BYTES THE USER ENTERED. THE         
25248 * RESULT IS USED TO DETERMINE IF THE USER HAD ENTERED A SKU OR AN         
25248 * UPC.     (DEFINITIIONS - SKU 8 BYTES, UPC 9 TO 15 BYTES)                
25248 *----------------------------------------------------------------*        
25248  3600-EDIT-UPC-SKU.                                                       
25248                                                                           
25248      IF WS-EDIT-BYTE (PV-BYTE-SUB) IS EQUAL TO SPACE                      
25248          NEXT SENTENCE                                                    
25248      ELSE                                                                 
25248      IF (WS-EDIT-BYTE (PV-BYTE-SUB) IS EQUAL TO ZERO AND                  
25248          PV-BYTE-COUNT IS EQUAL TO ZEROS)                                 
25248          NEXT SENTENCE                                                    
25248      ELSE                                                                 
25248          ADD 1           TO PV-BYTE-COUNT                                 
25248      END-IF.                                                              
25248                                                                           
      *----------------------------------------------------------------*        
      *    RESET THE DATA ENTERABLE FIELDS ATTRIBUTE, HIGHLIGHT, AND   *        
      *    COLOR BYTES.                                                *        
      *----------------------------------------------------------------*        
       3900-RESET-ATTRIBUTES.                                                   
      *                                                                         
           PERFORM VARYING PS-SUB                                               
               FROM 1 BY 1                                                      
                   UNTIL PS-SUB > PC-MAX-ADD-LINES                              
                                                                                
W21732         MOVE DP015-UNP-NUM-NOR-OFF TO MR-SKUA    (PS-SUB)                
                                             MR-QTYA    (PS-SUB)                
                                             MR-PRICEA  (PS-SUB)                
W21732         MOVE DP015-GREEN           TO MR-SKUC    (PS-SUB)                
                                             MR-QTYC    (PS-SUB)                
                                             MR-PRICEC  (PS-SUB)                
                                             MR-REASONC (PS-SUB)                
W21732         MOVE DP015-UNDERLINE       TO MR-SKUH    (PS-SUB)                
                                             MR-QTYH    (PS-SUB)                
                                             MR-PRICEH  (PS-SUB)                
                                             MR-REASONH (PS-SUB)                
                                                                                
               MOVE DP015-UNP-ALP-NOR-OFF TO MR-REASONA (PS-SUB)                
      *                                                                         
               MOVE DP015-ASK-BRT-OFF  TO MR-EXT-PRICEA (PS-SUB)                
               MOVE DP015-BLUE         TO MR-EXT-PRICEC (PS-SUB)                
               MOVE DP015-HL-OFF       TO MR-EXT-PRICEH (PS-SUB)                
           END-PERFORM.                                                         
      /                                                                         
                                                                                
       4000-BUILD-INITIAL-PANEL.                                                
                                                                                
           INITIALIZE ASC-DATA-ARRAY.                                           
                                                                                
C26600*    MOVE IN001-STORE-NBR          TO  ASC-STORE-NBR.                     
C26600     MOVE IN001-STORE-NBR          TO  ASC-LOC-NBR.                       
           MOVE IN001-AREA-NBR           TO  ASC-AREA-NBR.                      
           MOVE IN001-STORE-NAME         TO  ASC-STORE-NAME.                    
                                                                                
W23511*    DEFAULT THE REASON CODE WITH VALUE FROM CALLING PROGRAM              
W23511     MOVE +0 TO ASC-SUB                                                   
W23511*                                                                         
W23511     PERFORM VARYING PS-SUB                                               
W23511         FROM 1 BY 1                                                      
W23511             UNTIL PS-SUB > PC-MAX-ADD-LINES                              
W23511*                                                                         
W23511         ADD +1 TO ASC-SUB                                                
W23511         MOVE IN001-REASON-MSG         TO  ASC-REASON (ASC-SUB)           
W23511     END-PERFORM.                                                         
                                                                                
           MOVE ZEROES TO PV-SCREEN-TOTALS                                      
                          ASC-TOT-QTY                                           
                          ASC-TOT-EXTD-PRICE.                                   
                                                                                
W21732     MOVE -1      TO ASKU01L.                                             
                                                                                
           SET DP030-SET-CURSOR-APPL-1              TO TRUE.                    
                                                                                
           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                                
                                                                                
      *----------------------------------------------------------------*        
      *    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *        
      *----------------------------------------------------------------*        
       4400-MOVE-COMMAREA-TO-SCREEN.                                            
                                                                                
           MOVE +0 TO ASC-SUB.                                                  
                                                                                
W26600*    MOVE ASC-STORE-NBR            TO  ASTRNBRO                           
C26600     MOVE ASC-LOC-NBR              TO  ASTRNBRO                           
           MOVE ASC-AREA-NBR             TO  AAREAO                             
           MOVE ASC-STORE-NAME           TO  ASTRNAMO                           
                                                                                
           PERFORM VARYING PS-SUB                                               
               FROM 1 BY 1                                                      
                   UNTIL PS-SUB > PC-MAX-ADD-LINES                              
                                                                                
               ADD  +1 TO ASC-SUB                                               
                                                                                
25248          IF ASC-SKU-ENTERED (ASC-SUB)                                     
25248              MOVE ASC-SKU (ASC-SUB)   TO MR-SKU (PS-SUB)                  
               ELSE                                                             
25248          IF ASC-UPC-ENTERED (ASC-SUB)                                     
25248              MOVE ASC-UPC (ASC-SUB)   TO MR-SKU (PS-SUB)                  
25248          ELSE                                                             
25248              MOVE SPACES TO MR-SKU (PS-SUB)                               
               END-IF                                                           
25248          END-IF                                                           
                                                                                
               IF  ASC-QTY (ASC-SUB) NUMERIC                                    
                   MOVE ASC-QTY (ASC-SUB) TO  MR-QTYO (PS-SUB)                  
               ELSE                                                             
                   MOVE ASC-QTYX (ASC-SUB) TO  MR-QTYX (PS-SUB)                 
               END-IF                                                           
                                                                                
               IF  ASC-PRICE-X (ASC-SUB) NUMERIC                                
                   MOVE ASC-PRICE (ASC-SUB)  TO  MR-PRICEO (PS-SUB)             
               ELSE                                                             
                   MOVE ASC-PRICE-X (ASC-SUB) TO  MR-PRICEO (PS-SUB)            
               END-IF                                                           
                                                                                
           IF  ASC-EXTD-PRICE (ASC-SUB) > ZERO                                  
               MOVE ASC-EXTD-PRICE (ASC-SUB) TO MR-EXT-PRICEO (PS-SUB)          
           ELSE                                                                 
               MOVE SPACES               TO  MR-EXT-PRICEX (PS-SUB)             
           END-IF                                                               
      *                                                                         
           IF  ASC-REASON (ASC-SUB) NOT EQUAL SPACES                            
               MOVE ASC-REASON (ASC-SUB) TO MR-REASONO (PS-SUB)                 
           ELSE                                                                 
               MOVE SPACES               TO  MR-REASONO (PS-SUB)                
           END-IF                                                               
      *                                                                         
W21732     IF  MR-SKUC (PS-SUB) NOT EQUAL DP015-RED                             
W21732         MOVE DP015-GREEN      TO  MR-SKUC (PS-SUB)                       
W21732         MOVE DP015-UNDERLINE  TO  MR-SKUH (PS-SUB)                       
               MOVE DP015-UNP-NUM-NOR-OFF                                       
W21732                               TO  MR-SKUA (PS-SUB)                       
           END-IF                                                               
                                                                                
           END-PERFORM.                                                         
                                                                                
           MOVE PC-TOTAL            TO MR-TOT-LINEO.                            
           MOVE ASC-TOT-QTY         TO MR-TOT-QTYO.                             
           MOVE ASC-TOT-EXTD-PRICE  TO MR-TOT-EXTD-PRICEO.                      
                                                                                
           IF  PS-NO-ERROR                                                      
                                                                                
W26600*        MOVE  ASC-STORE-NBR   TO   IN001-STORE-NBR                       
C26600         MOVE  ASC-LOC-NBR     TO   IN001-STORE-NBR                       
               MOVE  ASC-AREA-NBR    TO   IN001-AREA-NBR                        
               MOVE  ASC-STORE-NAME  TO   IN001-STORE-NAME                      
                                                                                
W21732         MOVE -1           TO  MR-SKUL (1)                                
25248                                                                           
25248          SET DP030-SET-CURSOR-APPL-1 TO TRUE                              
           END-IF.                                                              
      *                                                                         
      *----------------------------------------------------------------*        
      *    ENSURE DATA WAS ENTERED BEFORE UPDATING.                    *        
      *----------------------------------------------------------------*        
       5000-BEGIN-INSERT-PROCESS.                                               
                                                                                
           SET PS-INSERT-NOT-DONE TO TRUE.                                      
                                                                                
-->  *** VERIFY QTY/PRICE WERE ENTERED AND NOT JUST SKU                         
           IF PS-NO-ERROR                                                       
               PERFORM                                                          
                 VARYING ASC-SUB                                                
                   FROM 1 BY 1                                                  
                       UNTIL ASC-SUB > PC-MAX-ADD-LINES                         
                                                                                
25248            IF ASC-SKU-ENTERED (ASC-SUB) OR                                
25248               ASC-UPC-ENTERED (ASC-SUB)                                   
                     IF NOT ASC-VALID-QTY(ASC-SUB)                              
                         PERFORM 3200-VALIDATE-QTY                              
                     END-IF                                                     
                                                                                
                     IF NOT ASC-VALID-PRICE(ASC-SUB)                            
                         PERFORM 3300-VALIDATE-PRICE                            
                     END-IF                                                     
                 END-IF                                                         
               END-PERFORM                                                      
           END-IF.                                                              
                                                                                
           IF PS-NO-ERROR                                                       
               PERFORM                                                          
                 VARYING ASC-SUB                                                
                   FROM 1 BY 1                                                  
                       UNTIL ASC-SUB > PC-MAX-ADD-LINES                         
      *                                                                         
                  IF  (ASC-GOOD-SKU (ASC-SUB)                                   
25248             AND  ASC-SKU-ENTERED (ASC-SUB)                                
                  AND  ASC-ADJUSTMENTS-ALLOWED (ASC-SUB))                       
                       PERFORM 5001-CONTINUE-INSERT                             
                  END-IF                                                        
25248             IF  (ASC-GOOD-UPC (ASC-SUB)                                   
25248             AND  ASC-UPC-ENTERED (ASC-SUB)                                
25248             AND  ASC-ADJUSTMENTS-ALLOWED (ASC-SUB))                       
25248                  PERFORM 5001-CONTINUE-INSERT                             
25248             END-IF                                                        
               END-PERFORM                                                      
           END-IF.                                                              
                                                                                
      /                                                                         
      *----------------------------------------------------------------*        
      * ADD THIS ADJUSTMENT TO TADJADD                                 *        
      * TRY 3X BEFORE ISSUING A WARNING MESSAGE (FOR SQLCODE = -803)   *        
      *----------------------------------------------------------------*        
                                                                                
       5001-CONTINUE-INSERT.                                                    
                                                                                
           PERFORM 5100-PREPARE-TADJADD-ROW.                                    
                                                                                
           MOVE '*5001-CONTINUE-INSERT       *' TO DP013-PARAGRAPH              
           INITIALIZE PV-RETRY-COUNT.                                           
                                                                                
           PERFORM 5110-INSERT-TADJADD-ROW                                      
               WITH TEST AFTER                                                  
               UNTIL ((PS-INSERT-DONE)                                          
                 OR   (PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT)).               
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   CONTINUE                                                     
               WHEN SQLCODE = -803                                              
               WHEN SQLCODE = -811                                              
               WHEN SQLCODE = +100                                              
25248            IF ASC-SKU-ENTERED (ASC-SUB)                                   
                   SET PS-ERROR                                                 
                       ASC-SKU-INSERT-FAILED (ASC-SUB)                          
                       DP020-MSG-FATAL          TO  TRUE                        
25248            END-IF                                                         
25248            IF ASC-SKU-ENTERED (ASC-SUB)                                   
25248              SET PS-ERROR                                                 
25248                  ASC-UPC-INSERT-FAILED (ASC-SUB)                          
25248                  DP020-MSG-FATAL          TO  TRUE                        
25248            END-IF                                                         
                 MOVE PC-TSYMSG-02537         TO  DP020-MSG-NUMBER              
W21732           MOVE DP015-UNP-ALP-BRT-OFF   TO  MR-SKUA (ASC-SUB)             
W21732           MOVE DP015-RED               TO  MR-SKUC (ASC-SUB)             
W21732           MOVE DP015-REVERSE           TO  MR-SKUH (ASC-SUB)             
                 MOVE -1                      TO  MR-SKUL (ASC-SUB)             
25248            SET DP030-SET-CURSOR-APPL-1 TO TRUE                            
                                                                                
               WHEN SQLCODE = -911                                              
               WHEN SQLCODE = -913                                              
                   MOVE 'INSERT ROW TO INV ADJADD TABLE (TADJADD)' TO           
                             DP013-MESSAGE-TEXT(1)                              
                   PERFORM 9900-SOFT-ABORT                                      
           END-EVALUATE.                                                        
                                                                                
25248      MOVE ASC-SKU (ASC-SUB)            TO PV-EDIT-UPC-SKU.                
                                                                                
25248      IF (PV-EDIT-UPC-SKU (13:3) = '000' OR '999'                          
           OR  IN015-ADJUSTMENT-QTY EQUAL ZERO)                                 
               CONTINUE                                                         
           ELSE                                                                 
           IF NOT ASC-SKU-INSERT-FAILED (ASC-SUB)                               
               PERFORM 5300-WRITE-VSAM-ADJUST-REC                               
               PERFORM 5400-RESET-LINE                                          
25248      ELSE                                                                 
25248      IF NOT ASC-UPC-INSERT-FAILED (ASC-SUB)                               
25248          PERFORM 5300-WRITE-VSAM-ADJUST-REC                               
25248          PERFORM 5400-RESET-LINE                                          
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------------*        
      *    FIRST, GENERATE THE DATALESS KEY.  NEXT, PREPARE THE        *        
      *    REST OF THE HOST VARIABLES FOR TADJADD.                     *        
      *----------------------------------------------------------------*        
       5100-PREPARE-TADJADD-ROW.                                                
                                                                                
           ADD PC-11                     TO  ASC-ADD-NUM.                       
           COMPUTE PV-TODAYS-TIME        =  (DP020-SRC-TASK-NUMBER              
                                         +   ASC-ADD-NUM)                       
                                         *   PC-11.                             
           MOVE PV-HUND-SEC              TO  PV-SEED-BYTE-1-2.                  
           MOVE PV-SEC                   TO  PV-SEED-BYTE-3-4.                  
           MOVE PV-MIN                   TO  PV-SEED-BYTE-5-6.                  
           MOVE PV-HH                    TO  PV-SEED-BYTE-7-8.                  
           MOVE PV-INITIAL-SEED          TO  PV-SEED.                           
                                                                                
           COMPUTE PV-WORK-FIELD    =                                           
                  ((PV-SEED + PC-PRIME1) * PC-PRIME2).                          
                                                                                
           DIVIDE PV-WORK-FIELD BY  PC-ONE-BILLION                              
                  GIVING PV-WORK-FIELD2                                         
                  REMAINDER PV-RANDOM-NUMBER.                                   
                                                                                
           MOVE PV-RANDOM-NUMBER         TO  ASC-DKEY-NBR (ASC-SUB)             
                                             ADJADD-DKEY-NBR.                   
                                                                                
W26600*    MOVE ASC-STORE-NBR            TO  ADJADD-STORE-NBR                   
C26600     MOVE ASC-LOC-NBR-9            TO  ADJADD-LOC-NBR                     
W26600*                                      PV-STORE-NBR-X.                    
W26600*    MOVE PV-STORE-NBR-9           TO  ADJADD-LOC-NBR.                    
                                                                                
           MOVE ASC-AREA-NBR             TO  ADJADD-AREA-NBR.                   
                                                                                
25248      MOVE ASC-SKU (ASC-SUB)        TO PV-UPC.                             
W28582*    MOVE PV-SKU                   TO ADJADD-SKU-NBR.                     
W28582     IF NOT IN400-PV-DUMMY-UPC                                            
W28582         MOVE PV-SKU               TO ADJADD-SKU-NBR                      
W28582     ELSE                                                                 
W28582         MOVE IN400-ATT-SKU-OUT    TO ADJADD-SKU-NBR                      
W28582     END-IF.                                                              
25248      MOVE ASC-UPC (ASC-SUB)        TO PV-UPC.                             
25248      MOVE PV-UPC                   TO ADJADD-UPC-NBR.                     
25248                                                                           
           MOVE SPACE                    TO  ADJADD-MISSED-MD-IND.              
           MOVE DP020-USERID             TO  ADJADD-CHG-ID-NBR.                 
                                                                                
           MOVE ASC-REASON    (ASC-SUB)  TO  ADJADD-ADJ-RSN-TXT.                
           MOVE ASC-PRICE     (ASC-SUB)  TO  ADJADD-ADJ-UNIT-PR-AMT.            
           MOVE ASC-QTY       (ASC-SUB)  TO  ADJADD-ADJ-QTY                     
                                             IN015-ADJUSTMENT-QTY.              
                                                                                
           COMPUTE ADJADD-ADJ-EXTD-AMT = ADJADD-ADJ-QTY                         
                                       * ADJADD-ADJ-UNIT-PR-AMT.                
                                                                                
      *----------------------------------------------------------------*        
      *     INSERT THE TADJADD TABLE.                                  *        
      *----------------------------------------------------------------*        
       5110-INSERT-TADJADD-ROW.                                                 
                                                                                
           SET PS-INSERT-NOT-DONE        TO TRUE.                               
           PERFORM UNTIL PS-INSERT-DONE                                         
                      OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                
               EXEC SQL                                                         
                    INSERT                                                      
                    INTO  TADJADD                                               
C26600*                  (STORE_NBR                                             
W26600*                 , LOC_NBR                                               
C26600                   (LOC_NBR                                               
                        , AREA_NBR                                              
W21732                  , SKU_NBR                                               
25248                   , UPC_NBR                                               
                        , ADJ_UNIT_PR_AMT                                       
                        , ADJ_QTY                                               
                        , MISSED_MD_IND                                         
                        , DKEY_NBR                                              
                        , CHG_TMST                                              
                        , CHG_ID_NBR                                            
                        , ADJ_RSN_TXT                                           
                        , ADJ_EXTD_AMT)                                         
                   VALUES                                                       
C26600*                  (:ADJADD-STORE-NBR                                     
C26600*                 , :ADJADD-LOC-NBR                                       
C26600                   (:ADJADD-LOC-NBR                                       
                        , :ADJADD-AREA-NBR                                      
W21732                  , :ADJADD-SKU-NBR                                       
25248                   , :ADJADD-UPC-NBR                                       
                        , :ADJADD-ADJ-UNIT-PR-AMT                               
                        , :ADJADD-ADJ-QTY                                       
                        , :ADJADD-MISSED-MD-IND                                 
                        , :ADJADD-DKEY-NBR                                      
                        ,  CURRENT TIMESTAMP                                    
                        , :ADJADD-CHG-ID-NBR                                    
                        , :ADJADD-ADJ-RSN-TXT                                   
                        , :ADJADD-ADJ-EXTD-AMT)                                 
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = ZERO                                          
                        SET PS-INSERT-DONE TO TRUE                              
                        SET ASC-SKU-INSERT-OK (ASC-SUB) TO TRUE                 
25248                   SET ASC-UPC-INSERT-OK (ASC-SUB) TO TRUE                 
                   WHEN SQLCODE = -803                                          
                        ADD 1 TO PV-RETRY-COUNT                                 
                        COMPUTE PV-RANDOM-NUMBER =                              
                                PV-RANDOM-NUMBER *                              
                               (PC-11 * ASC-ADD-NUM)                            
                        ADD PC-11        TO  ASC-ADD-NUM                        
                        MOVE PV-RANDOM-NUMBER                                   
                                         TO  ASC-DKEY-NBR (ASC-SUB)             
                                             ADJADD-DKEY-NBR                    
                   WHEN SQLCODE = +100                                          
                        SET PS-INSERT-DONE TO TRUE                              
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                        ADD 1 TO PV-RETRY-COUNT                                 
                   WHEN SQLWARN0 NOT = SPACES                                   
                   WHEN SQLCODE < ZERO                                          
                   WHEN SQLCODE > ZERO                                          
                       MOVE '5110-INSERT-TADJADD-ROW'                           
                                         TO DP013-PARAGRAPH                     
                       MOVE 'INSERT A ROW ON THE TADJADD TABLE'                 
                                         TO DP013-MESSAGE-TEXT(1)               
                       MOVE SQLCA        TO DP013-SQLCA                         
                       MOVE 'TADJADD'    TO DP013-DB2-TABLE-NAME (1)            
                       SET DP013-DB2-ABEND                                      
                           DP013-XCTL-DISPLAY-RESTART TO TRUE                   
                       PERFORM DP013-0000-PROCESS-ABEND                         
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
      /----------------------------------------------------------------*        
      *    WRITE THE ADJUSTMENT VSAM RECORD.                           *        
      *----------------------------------------------------------------*        
       5300-WRITE-VSAM-ADJUST-REC.                                              
                                                                                
           MOVE IN001-STORE-NBR          TO IN015-STORE-NBR.                    
W21732     MOVE ASC-SKU-NBR(ASC-SUB)     TO IN015-SKU-NBR.                      
           IF  IN015-ADJUSTMENT-QTY POSITIVE                                    
               SET IN015-POSITIVE-ADJUSTMENT                                    
                                         TO  TRUE                               
           ELSE                                                                 
               SET IN015-NEGATIVE-ADJUSTMENT                                    
                                         TO  TRUE                               
           END-IF.                                                              
                                                                                
           IF INVPAR-ACTL-UNIT-BK-DTE = PC-NINES-DATE                           
               MOVE 'N' TO IN015-UNIT-BOOK-IND                                  
           ELSE                                                                 
               MOVE 'Y' TO IN015-UNIT-BOOK-IND                                  
           END-IF.                                                              
                                                                                
           EXEC CICS WRITE                                                      
                FROM  (IN015-ADJUSTMENT-RECORD)                                 
                RIDFLD(PV-RBA)                                                  
                RBA                                                             
                FILE  ('INADJUST')                                              
                RESP  (PV-CICS-RESPONSE)                                        
           END-EXEC.                                                            
                                                                                
           IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)                       
               SET PS-ERROR                                                     
                   DP013-LOGIC-ABEND                                            
                   DP013-NO-ROLLBACK     TO TRUE                                
               MOVE '5300-WRITE-VSAM-ADJUST-REC'                                
                                         TO DP013-PARAGRAPH                     
               MOVE 'INVALID RESPONSE FROM WRITE COMMAND:'                      
                                         TO DP013-MESSAGE-TEXT (1)              
               MOVE PV-CICS-RESPONSE     TO PV-DISPLAY-RESP                     
               MOVE PV-DISPLAY-RESP      TO DP013-MESSAGE-TEXT (2)              
               PERFORM DP013-0000-PROCESS-ABEND                                 
           END-IF.                                                              
      *----------------------------------------------------------------*        
      *    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *        
      *----------------------------------------------------------------*        
       5400-RESET-LINE.                                                         
                                                                                
           IF NOT ASC-SKU-INSERT-FAILED (ASC-SUB)                               
               MOVE SPACES            TO MR-SKU          (ASC-SUB)              
                                         MR-QTYX         (ASC-SUB)              
                                         MR-PRICEX       (ASC-SUB)              
                                         MR-EXT-PRICEX   (ASC-SUB)              
                                         MR-REASONO      (ASC-SUB)              
               MOVE SPACES            TO ASC-SKU         (ASC-SUB)              
25248                                    ASC-UPC         (ASC-SUB)              
                                         ASC-QTYX        (ASC-SUB)              
                                         ASC-PRICE-X     (ASC-SUB)              
                                         ASC-EXTD-PRICEX (ASC-SUB)              
                                         ASC-REASON      (ASC-SUB)              
               MOVE SPACES        TO ASC-QTY-ERROR-SW    (ASC-SUB)              
                                     ASC-PRICE-ERROR-SW  (ASC-SUB)              
                                     ASC-GOOD-SKU-SW     (ASC-SUB)              
25248                                ASC-GOOD-UPC-SW     (ASC-SUB)              
25248                                ASC-SKU-INSERT-SW   (ASC-SUB)              
25248                                ASC-UPC-INSERT-SW   (ASC-SUB)              
                                     ASC-QTY-ENTERED-SW   (ASC-SUB)             
                                     ASC-PRICE-ENTERED-SW (ASC-SUB)             
               SET ASC-SKU-NOT-ENTERED (ASC-SUB) TO TRUE                        
25248          SET ASC-UPC-NOT-ENTERED (ASC-SUB) TO TRUE                        
           END-IF.                                                              
                                                                                
25248 /*****************************************************************        
  |   * 6000-VALIDATE-UPC.                                                      
  |   ******************************************************************        
  |    6000-VALIDATE-UPC.                                                       
  |                                                                             
  |        PERFORM 6100-FORMAT-NUMERIC-UPC.                                     
  |        IF NOT ASC-BAD-UPC (ASC-SUB)                                         
25248          PERFORM 6200-EDIT-UPC                                            
W28545         IF IN400-PV-NOT-FOUND                                            
25248              PERFORM 6999-SET-UPC-ERROR                                   
  |            ELSE                                                             
  |                PERFORM 3110-VALIDATE-ADJ-ALLOWED                            
  |            END-IF                                                           
  |        END-IF.                                                              
  |                                                                             
  |   ******************************************************************        
  |   * 6100-FORMAT-NUMERIC-UPC.                                                
  |   ******************************************************************        
  |    6100-FORMAT-NUMERIC-UPC.                                                 
  |                                                                             
  |        SET ASC-GOOD-UPC (ASC-SUB) TO TRUE.                                  
  |                                                                             
  |        MOVE ASC-UPC (ASC-SUB)     TO  DP010I-UNEDITED-FIELD.                
  |        MOVE PC-15                 TO  DP010I-MAXIMUM-DIGITS.                
  |        MOVE ZERO                  TO  DP010I-MAXIMUM-DECIMALS.              
  |        SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                             
  |                                                                             
263126     CALL DP010I-NUMERIC-EDIT-ROUTINE                                     
263126          USING DP010I-NUMERIC-EDIT-AREA.                                 
  |                                                                             
  |        IF  DP010I-ERROR-DETECTED                                            
  |            PERFORM 6999-SET-UPC-ERROR                                       
  |        ELSE                                                                 
  |            MOVE DP010I-NUM-FIELD-15-DIG-2-DEC TO PV-EDIT-15                 
  |            MOVE PV-EDIT-15-X      TO ASC-UPC (ASC-SUB)                      
  |        END-IF.                                                              
  |                                                                             
  |   ******************************************************************        
  |   * 6200-EDIT-UPC. CALL COMMON PRICING INPD400                              
  |   ******************************************************************        
  |    6200-EDIT-UPC.                                                           
  |                                                                             
W28545                                                                          
W28545     INITIALIZE IN400-PV-INPUT-AREA.                                      
W28545                                                                          
F28545     MOVE IN001-DB2-ACTL-INV-DTE  TO IN400-PV-EFF-DTE-IN.                 
W28545     MOVE ASC-LOC-NBR-9           TO IN400-PV-LOC-IN-NUM.                 
W28545     MOVE 'UPC'                   TO IN400-PV-LOOKUP-TYPE-IN.             
W28545     MOVE ZEROS                   TO PV-SKU.                              
W28545     MOVE ASC-UPC (ASC-SUB)       TO PV-UPC.                              
W28545     MOVE PV-UPC                  TO IN400-PV-UPC-NBR-IN.                 
W28545     INSPECT IN400-PV-UPC-NBR-IN REPLACING LEADING                        
W28545     ' ' BY '0'.                                                          
W28545                                                                          
W28545     PERFORM IN400-LOOKUP-RETAIL.                                         
W28545                                                                          
W28545     IF IN400-PV-FOUND                                                    
W28545         MOVE IN400-PRC-STATUS-OUT TO PV-STAT-CDE                         
W28545         MOVE IN400-PRC-SKU-OUT    TO PV-UPC                              
W28545         MOVE PV-UPC               TO ASC-SKU (ASC-SUB)                   
W28582         IF IN400-PV-DUMMY-UPC                                            
W28582             MOVE IN400-ATT-UPC-OUT TO PV-UPC                             
W28582             MOVE PV-UPC            TO ASC-SKU (ASC-SUB)                  
W28582         END-IF                                                           
W28545     ELSE                                                                 
W28545         IF IN400-PV-NOT-FOUND                                            
W28545             MOVE ZEROS            TO PV-STAT-CDE                         
W28545     ELSE                                                                 
W28545             MOVE '6200-EDIT-UPC'  TO DP013-PARAGRAPH                     
W28545             MOVE 'CALL INPD400 '  TO DP013-MESSAGE-TEXT (1)              
W28545             MOVE IN400-PV-RETURN-RSN                                     
W28545                                   TO DP013-MESSAGE-TEXT (2)              
W28545             MOVE IN400-PV-PARAGRAPH                                      
W28545                                   TO DP013-MESSAGE-TEXT (3)              
W28545             MOVE IN400-PV-PRC-SQLCDE                                     
W28545                                   TO DP013-SQLCA                         
W28545             MOVE '???????'        TO DP013-DB2-TABLE-NAME (1)            
W28545             SET DP013-DB2-ABEND                                          
W28545                     DP013-XCTL-DISPLAY-RESTART                           
W28545                                   TO TRUE                                
W28545             PERFORM DP013-0000-PROCESS-ABEND                             
W28545                                                                          
W28545     END-IF.                                                              
W28545     MOVE PV-STAT-CDE              TO  ASC-STATUS-CODE (ASC-SUB).         
25248                                                                           
  |   ******************************************************************        
  |   * 6999-SET-UPC-ERROR.                                                     
  |   ******************************************************************        
  |    6999-SET-UPC-ERROR.                                                      
  |                                                                             
  |        SET PS-ERROR                                                         
  |            ASC-BAD-UPC (ASC-SUB)                                            
  |            DP020-MSG-FATAL           TO  TRUE.                              
  |        MOVE PC-TSYMSG-00073          TO  DP020-MSG-NUMBER.                  
  |        MOVE DP015-UNP-NUM-BRT-OFF    TO  MR-SKUA (ASC-SUB)                  
  |        MOVE DP015-RED                TO  MR-SKUC (ASC-SUB)                  
  |        MOVE DP015-REVERSE            TO  MR-SKUH (ASC-SUB)                  
  |        MOVE -1                       TO  MR-SKUL (ASC-SUB).                 
  |        SET DP030-SET-CURSOR-APPL-1   TO TRUE.                               
25248                                                                           
W28545                                                                          
W28545*----------------------------------------------------------------*        
W28545*    COMMON PRICE LOOK-UP PROCEDURE DIVISION COPYBOOK                     
W28545*----------------------------------------------------------------*        
W28545                                                                          
W28545     COPY INPD400.                                                        
W28545                                                                          
      /----------------------------------------------------------------*        
      *    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *        
      *    AND THE ERROR SWITCHES.                                     *        
      *----------------------------------------------------------------*        
       9900-SOFT-ABORT.                                                         
                                                                                
           SET PS-ERROR                TO  TRUE.                                
           SET DP020-MSG-FATAL         TO  TRUE.                                
           MOVE PC-TSYMSG-00551        TO  DP020-MSG-NUMBER.                    
                                                                                
      /----------------------------------------------------------------*        
      *    ABEND PROCESSOR MODULE                                      *        
      *----------------------------------------------------------------*        
                                                                                
           COPY DPPD013.                                                        
