000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400 PROGRAM-ID.    MLKUP004.                                         00040000
000500 AUTHOR.        PRITHIVIRAJ SUBRAMANIAN.                          00050000
000600 INSTALLATION.  KOHLS.                                            00060000
000700 DATE-WRITTEN   NOVEMBER, 2013.                                   00070000
000800 DATE-COMPILED.                                                   00080000
000900***************************************************************** 00090000
001000*  THIS PROGRAM COMPARES THE MUC TABLE INFORMATION WITH THE       00100000
001100*  EXISTING FILE OF MLK022, IF THE PRICE CHANGE ID MATCHES        00110000
001200*  AND PRICE CHANGE TYPE CODE IS MDA THEN CHANGE THAT PRICE       00120000
001300*  CHANGE TYPE CODE TO MUC AND WRITE IT TO THE OUTPUT FILE IF     00130000
001400*  IF IT DOESN'T MATCH THEN WRITE THE RECORD DIRECTLY TO THE      00140000
001500*  OUTPUT FILE WHICH WILL BE FED AS AN INPUT TO THE JOB MLK023.   00150000
001500*  COMMIT WILL BE TAKEN AT THE END OF THE PROGRAM AS THIS PROGRAM 00151000
001500*  CONVERTS THE MDA TO MUC AND WRITES TO THE OUTPUT AND THEN      00152000
001500*  UPDATES THE XMT_MKUP_CNCL_MDSE TABLE SO COMMIT  IS TAKEN AT THE00153000
001500*  END ONCE THE PROGRAM GETS COMPLETED I.E ONCE PROCESSED ALL THE 00154000
001500*  THE RECORDS.                                                   00155000
001600* ****************************************************************00156000
001700* CHANGE DESCRIPTION                                              00157000
001800* ****************************************************************00158000
001900* DATE  11/07/2013                                                00159000
002000*  CHANGE MADE: INITIAL VERSION.                                  00160000
002100* MADE BY: PRITHIVIRAJ S (COGNIZANT)    TKID: TKMAJC7             00170000
002200***************************************************************** 00180000
002300 ENVIRONMENT DIVISION.                                            00190000
008400 CONFIGURATION SECTION.                                           00200000
008500 SOURCE-COMPUTER.        IBM-3090.                                00210000
008600 OBJECT-COMPUTER.        IBM-3090.                                00220000
002400 INPUT-OUTPUT SECTION.                                            00230000
002500*                                                                 00240000
002600 FILE-CONTROL.                                                    00250000
002700*                                                                 00260000
002800     SELECT INPUT-PERM-PRCHG-ATTRIB                               00270000
002900         ASSIGN TO INP01.                                         00280000
003000*                                                                 00290000
003100     SELECT  CC-DATE-FILE                                         00300000
003200         ASSIGN TO INP02.                                         00310000
003300*                                                                 00320000
003400     SELECT PCHG-OUT-FILE                                         00330000
003500         ASSIGN TO OUT01.                                         00340000
003600*                                                                 00350000
003700***************************************************************** 00360000
003800 DATA DIVISION.                                                   00370000
003900***************************************************************** 00380000
004000 FILE SECTION.                                                    00390000
004100*                                                                 00400000
004200 FD  INPUT-PERM-PRCHG-ATTRIB                                      00410000
004300     RECORDING MODE IS F                                          00420000
004400     BLOCK CONTAINS 0 RECORDS                                     00430000
004500     LABEL RECORDS ARE STANDARD.                                  00440000
004600*                                                                 00450000
004700 01  PERM-PRCHG-ATTRIB-REC        PIC X(080).                     00460000
004800*                                                                 00470000
004900 FD  CC-DATE-FILE                                                 00480000
005000     RECORDING MODE IS F                                          00490000
005100     BLOCK CONTAINS 0 RECORDS                                     00500000
005200     LABEL RECORDS ARE STANDARD.                                  00510000
005300*                                                                 00520000
005400 01  CC-DATE-REC                  PIC X(080).                     00530000
005500*                                                                 00540000
005600 FD  PCHG-OUT-FILE                                                00550000
005700     RECORDING MODE IS F                                          00560000
005800     BLOCK CONTAINS 0 RECORDS                                     00570000
005900     LABEL RECORDS ARE STANDARD.                                  00580000
006000*                                                                 00590000
006100 01  PCHG-OUT-REC                 PIC X(080).                     00600000
006200*                                                                 00610000
006300***************************************************************** 00620000
006400 WORKING-STORAGE SECTION.                                         00630000
006500*                                                                 00640000
006600 01  PS-PROGRAM-SWITCHES.                                         00650000
006700     05  PS-EOF-MUC-SW                PIC X(01)  VALUE 'N'.       00660000
006800         88  PS-EOF-MUC-YES                      VALUE 'Y'.       00670000
006900         88  PS-EOF-MUC-NO                       VALUE 'N'.       00680000
007000     05  PS-EOF-SKU-SW                PIC X(01)  VALUE 'N'.       00690000
007100         88  PS-EOF-SKU-YES                      VALUE 'Y'.       00700000
007200         88  PS-EOF-SKU-NO                       VALUE 'N'.       00710000
007000     05  PS-EOF-CC-SW                 PIC X(01)  VALUE 'N'.       00720000
007100         88  PS-EOF-CC-YES                       VALUE 'Y'.       00721000
007200         88  PS-EOF-CC-NO                        VALUE 'N'.       00722000
007300     05  PS-MUC-SW                    PIC X(01)  VALUE 'N'.       00723000
007400         88  PS-MUC-YES                          VALUE 'Y'.       00724000
007500         88  PS-MUC-NO                           VALUE 'N'.       00725000
007600     05  PS-MUC-COUNT-SW              PIC X(01)  VALUE 'N'.       00726000
007700         88  PS-MUC-COUNT-YES                    VALUE 'Y'.       00727000
007800         88  PS-MUC-COUNT-NO                     VALUE 'N'.       00728000
007600     05  PS-SEL-SW                    PIC X(01)  VALUE 'N'.       00729000
007700         88  PS-SEL-YES                          VALUE 'Y'.       00730000
007800         88  PS-SEL-NO                           VALUE 'N'.       00740000
007900*                                                                 00750000
008000 01  PC-PROGRAM-CONSTANTS.                                        00760000
008100     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'MLKUP004'.00770000
008200     05  PC-MAXIMUM-RETRY-COUNT       PIC S9(04) VALUE +2         00780000
008300                                                  COMP SYNC.      00790000
008400*                                                                 00800000
008500 01  PV-PROGRAM-VARIABLES.                                        00810000
008600     05  PV-RECS-READ-SKU             PIC  9(09) VALUE  0.        00820000
008700     05  PV-RECS-READ-MUC             PIC  9(09) VALUE  0.        00830000
008800     05  PV-RECS-WRITE-SKU            PIC  9(09) VALUE  0.        00840000
008900     05  PV-RECS-WRITE-MUC            PIC  9(09) VALUE  0.        00850000
009000     05  PV-MUC-COUNT                 PIC S9(09) VALUE +0         00860000
009000                                                  COMP-3.         00870000
009100     05  PV-PRCHG-ID                  PIC  S9(09) COMP.           00880000
009200     05  PV-PRCHG-EFF-DTE             PIC  X(10).                 00890000
009300     05  PV-SKU-NBR                   PIC  S9(8)V COMP-3.         00900000
009400     05  PV-MKUP-CNCL-CDE             PIC  X(01).                 00910000
009100     05  PV-FILE-PRCHG-ID             PIC  S9(09) COMP.           00920000
009200     05  PV-FILE-PRCHG-EFF-DTE        PIC  X(10).                 00930000
009300     05  PV-FILE-SKU-NBR              PIC  S9(8)V COMP-3.         00940000
009400     05  PV-FILE-MKUP-CNCL-CDE        PIC  X(01).                 00941000
009500     05  PV-RETRY-COUNT               PIC  S9(04) VALUE +0        00942000
009600                                                  COMP SYNC.      00943000
009700     05  PV-UPDATE-MUC-COUNT          PIC  9(09) VALUE  0.        00944000
009200     05  PV-PROCESS-EFF-DATE          PIC  X(10).                 00945000
009800*                                                                 00946000
009900 01  PV-ABEND-FIELDS.                                             00947000
010000     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'MLKUP004'.00948000
010100     05  FILLER                       PIC  X(01) VALUE SPACES.    00949000
010200     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00950000
010300     05  FILLER                       PIC  X(01) VALUE SPACES.    00960000
010400     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    00970000
010500     05  FILLER                       PIC  X(01) VALUE SPACES.    00980000
010600     05  PV-OPERATION-ATTEMPTED       PIC  X(50) VALUE SPACE.     00990000
010700     05  FILLER                       PIC  X(01) VALUE SPACES.    01000000
010800     05  PV-ABEND-CODE                PIC  S9(04) VALUE +0  COMP. 01010000
010900*                                                                 01020000
011000******************************************************************01030000
011100* CC- CONTROL CARD                                                01040000
011200******************************************************************01050000
011300 01  CC-CONTROL-REC.                                              01060000
011400     05  CC-COMMENT-IND               PIC X(01)      VALUE SPACES.01070000
011500         88  CC-COMMENT-RECORD                       VALUE '*'.   01080000
011600     05  CC-CONTROL-DATE.                                         01090000
011700         10  CC-DATE-CC               PIC X(02)      VALUE SPACES.01100000
011800         10  CC-DATE-YY               PIC X(02)      VALUE SPACES.01110000
011900         10  CC-DATE-DASH-1           PIC X(01)      VALUE SPACES.01120000
012000             88  CC-VALID-DATE-DASH-1                VALUE '-'.   01130000
012100         10  CC-DATE-MM               PIC X(02)      VALUE SPACES.01140000
012200             88  CC-VALID-DATE-MM                    VALUES ARE   01150000
012300                 '01' THRU '12'.                                  01160000
012400         10  CC-DATE-DASH-2           PIC X(01)      VALUE SPACES.01170000
012500             88  CC-VALID-DATE-DASH-2                VALUE '-'.   01180000
012600         10  CC-DATE-DD               PIC X(02)      VALUE SPACES.01190000
012700             88  CC-VALID-DATE-DD                    VALUES ARE   01200000
012800                 '01' THRU '31'.                                  01210000
012900     05  FILLER                       PIC X(69)      VALUE SPACES.01220000
013000                                                                  01230000
013100***************************************************************** 01240000
013200* MERCH LEDGER NEW PERM SKU/STORE DATA ATTRIBUTES LAYOUT- INPUT * 01250000
013300***************************************************************** 01260000
013400***************************************************************** 01270000
013500     COPY MLRD002.                                                01280000
014000******************************************************************01290000
014000*  VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004       *01300000
014000******************************************************************01310000
014000     COPY DPWS004.                                                01320000
014000******************************************************************01330000
016200*                                                                 01340000
016300***************************************************************** 01350000
016400*  DCLGEN                                                       * 01360000
016500***************************************************************** 01370000
016600*                                                                 01380000
016700     EXEC SQL                                                     01390000
016800         INCLUDE XMT00024                                         01400000
016900     END-EXEC.                                                    01410000
017000*                                                                 01420000
017000******************************************************************01430000
017000*  SQL COMMUNICATIONS WORK AREA                                  *01440000
017000******************************************************************01450000
017000     EXEC SQL                                                     01460000
017000         INCLUDE SQLCA                                            01470000
017000     END-EXEC.                                                    01480000
017000*                                                                 01490000
017100***************************************************************** 01500000
017200 PROCEDURE DIVISION.                                              01510000
017300***************************************************************** 01520000
017400     DISPLAY '**** BEGINNING MLKUP004 ****'.                      01530000
017500     DISPLAY ' '.                                                 01540000
017600*                                                                 01550000
017700 0000-MAIN-PARA.                                                  01560000
017800     PERFORM 1000-INITIALIZATION.                                 01570000
017900     PERFORM 2000-MAIN-PROCESS.                                   01580000
018000     PERFORM 9000-EOJ.                                            01590000
018100*                                                                 01600000
018200        STOP RUN.                                                 01610000
018300*                                                                 01620000
018400***************************************************************** 01630000
018500*  INITIALIZE PARA                                                01640000
018600***************************************************************** 01650000
018700 1000-INITIALIZATION.                                             01660000
018800*                                                                 01670000
018900     MOVE '1000-INITIALIZATION ' TO PV-ABEND-PARAGRAPH.           01680000
019000*                                                                 01690000
019300     OPEN INPUT  INPUT-PERM-PRCHG-ATTRIB                          01700000
019400                 CC-DATE-FILE                                     01710000
019500          OUTPUT PCHG-OUT-FILE.                                   01720000
019600*                                                                 01730000
019700     INITIALIZE PV-PROGRAM-VARIABLES.                             01740000
019800     INITIALIZE CC-CONTROL-REC.                                   01750000
019900     INITIALIZE ML002-PERM-PRCHG-ATTRIB-RECS.                     01760000
020100*                                                                 01770000
020200***************************************************************** 01780000
020300*  MAIN PROCESS PARA                                              01790000
020400***************************************************************** 01800000
020500 2000-MAIN-PROCESS.                                               01810000
020600*                                                                 01820000
020700     MOVE '2000-MAIN-PROCESS ' TO PV-ABEND-PARAGRAPH.             01830000
020800*                                                                 01840000
020900       PERFORM 2050-READ-CC-DATE-FILE                             01850000
021000       PERFORM 2075-CHECK-COUNT-MUC-PARA                          01860000
021100       PERFORM UNTIL PS-EOF-SKU-YES                               01870000
021200         PERFORM 2100-READ-SUM-SKU-FILE                           01880000
021300           IF ML002-PRCHG-TYP-CDE = 'MDA' AND                     01890000
021400              PS-MUC-COUNT-YES                                    01900000
021500             PERFORM 2200-CHECK-MUC-PARA                          01910000
021600           ELSE                                                   01920000
021600            IF  PS-EOF-SKU-NO                                     01930000
021700             WRITE PCHG-OUT-REC FROM ML002-PERM-PRCHG-ATTRIB-RECS 01940000
021800               ADD 1               TO PV-RECS-WRITE-SKU           01950000
021900            END-IF                                                01960000
021900           END-IF                                                 01970000
022000      END-PERFORM.                                                01980000
022100*                                                                 01990000
022200******************************************************************02000000
022300* READ THE DATE CONTROL CARD                                      02010000
022400******************************************************************02020000
022500 2050-READ-CC-DATE-FILE.                                          02030000
022600*                                                                 02040000
022700     MOVE '2050-READ-CC-DATE-FILE ' TO PV-ABEND-PARAGRAPH.        02050000
022800*                                                                 02060000
022900     READ CC-DATE-FILE                                            02070000
023000         INTO CC-CONTROL-REC                                      02080000
023100         AT END                                                   02090000
023200             SET PS-EOF-CC-YES TO TRUE                            02100000
023200     END-READ.                                                    02110000
023300*                                                                 02120000
023300     IF PS-EOF-CC-YES                                             02130000
023300         DISPLAY ' '                                              02140000
023300         DISPLAY '*** NO VALID CONTROL CARD TO PROCESS ***'       02150000
023300         DISPLAY ' '                                              02160000
023300         PERFORM 9999-ABEND                                       02170000
023300     ELSE                                                         02180000
023300         DISPLAY ' ' CC-CONTROL-REC                               02190000
023300         IF CC-DATE-CC IS NUMERIC                                 02200000
023300             AND CC-DATE-YY IS NUMERIC                            02210000
023300             AND CC-VALID-DATE-MM                                 02220000
023300             AND CC-VALID-DATE-DD                                 02230000
023300             AND CC-VALID-DATE-DASH-1                             02240000
023300             AND CC-VALID-DATE-DASH-2                             02250000
023300             MOVE CC-CONTROL-DATE TO PV-PROCESS-EFF-DATE          02260000
023300             DISPLAY ' '                                          02270000
023300             DISPLAY 'PV-PROCESS-EFF-DATE: ' PV-PROCESS-EFF-DATE  02280000
023300             DISPLAY ' '                                          02290000
023300         ELSE                                                     02300000
023300             DISPLAY ' '                                          02310000
023300             DISPLAY '   *** INVALID CONTROL CARD ***'            02320000
023300             PERFORM 9999-ABEND                                   02330000
023300         END-IF                                                   02340000
023300     END-IF.                                                      02340100
023300*                                                                 02340200
023400******************************************************************02340300
023500* CHECK IF ANY PRICE CHANGE IN MUC FOR THE CURRENT DATE           02340400
023600******************************************************************02340500
023700 2075-CHECK-COUNT-MUC-PARA.                                       02340600
023800*                                                                 02340700
023900     MOVE '2075-CHECK-COUNT-MUC-PARA ' TO PV-ABEND-PARAGRAPH.     02340800
024000*                                                                 02340900
024100     SET PS-MUC-COUNT-NO  TO TRUE                                 02341000
024200*    MOVE CC-CONTROL-DATE TO PV-PROCESS-EFF-DATE                  02342000
024200*                                                                 02343000
024200     PERFORM                                                      02344000
024200         WITH TEST AFTER                                          02345000
024200         VARYING PV-RETRY-COUNT FROM 1 BY 1                       02346000
024200         UNTIL (PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT)          02347000
024200             OR (SQLCODE = 0)                                     02348000
024200             OR (SQLCODE = +100)                                  02349000
024200*                                                                 02350000
024300      EXEC SQL                                                    02360000
024400        SELECT COUNT(*)                                           02370000
024500          INTO :PV-MUC-COUNT                                      02380000
024600          FROM                                                    02390000
024700             XMT_MKUP_CNCL_MDSE                                   02400000
024800          WHERE                                                   02410000
024900             PRCHG_EFF_DTE = : PV-PROCESS-EFF-DATE AND            02420000
024900             MKUP_CNCL_STAT_CDE = 'S'                             02430000
025000          WITH UR                                                 02440000
025100      END-EXEC                                                    02450000
025200         EVALUATE SQLCODE                                         02460000
025300             WHEN 0                                               02470000
025400               IF PV-MUC-COUNT > ZEROES                           02480000
025500                 SET PS-MUC-COUNT-YES  TO TRUE                    02490000
025600               END-IF                                             02500000
025800             WHEN 100                                             02510000
025800              MOVE ZEROES           TO PV-MUC-COUNT               02520000
025800             WHEN -911                                            02530000
025900             WHEN -913                                            02540000
026000                 ADD 1               TO PV-RETRY-COUNT            02550000
026100             WHEN OTHER                                           02560000
026200                MOVE '2075-CHECK-COUNT-MUC-PARA'                  02570000
026300                                     TO PV-ABEND-PARAGRAPH        02580000
026400                 MOVE 'SELECT COUNT OF XMT_MKUP_CNCL_MDSE'        02590000
026500                                     TO PV-OPERATION-ATTEMPTED    02600000
026600                 PERFORM 9999-SQL-ABEND                           02610000
026700         END-EVALUATE                                             02620000
027500     END-PERFORM.                                                 02630000
027500*                                                                 02640000
026800      IF PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                  02650000
026900          MOVE '2075-CHECK-COUNT-MUC-PARA'                        02660000
027000                                  TO PV-ABEND-PARAGRAPH           02670000
027100          MOVE 'SELECT COUNT OF XMT_MKUP_CNCL_MDSE'               02680000
027200                                  TO PV-OPERATION-ATTEMPTED       02690000
027300          PERFORM 9999-SQL-ABEND                                  02700000
027400      END-IF.                                                     02710000
027500*                                                                 02720000
027600***************************************************************** 02730000
027700*  READ SKU PERM EXTRACT FILE                                   * 02740000
027800***************************************************************** 02750000
027900 2100-READ-SUM-SKU-FILE.                                          02760000
028000*                                                                 02770000
028100     MOVE '2100-READ-SUM-SKU-FILE ' TO PV-ABEND-PARAGRAPH.        02780000
028200*                                                                 02790000
028300       READ INPUT-PERM-PRCHG-ATTRIB                               02800000
028400          INTO ML002-PERM-PRCHG-ATTRIB-RECS                       02810000
028500       AT END                                                     02820000
028600          SET PS-EOF-SKU-YES      TO TRUE                         02830000
028700       END-READ.                                                  02840000
028800*                                                                 02850000
028900       IF PS-EOF-SKU-NO                                           02860000
029000            ADD 1                   TO PV-RECS-READ-SKU           02870000
029100       END-IF.                                                    02880000
029200*                                                                 02890000
029300***************************************************************** 02900000
029400* CHECK SKU AND MUC TABLE AND CHANGE MDA TO MUC FOR MATCHING RECS 02910000
029500***************************************************************** 02920000
029600 2200-CHECK-MUC-PARA.                                             02930000
029700*                                                                 02940000
029800     MOVE '2200-CHECK-MUC-PARA ' TO PV-ABEND-PARAGRAPH.           02950000
029700*                                                                 02960000
029700*                                                                 02970000
029900     IF ML002-PRCHG-EFF-DTE NOT = PV-FILE-PRCHG-EFF-DTE OR        02980000
029900        ML002-PRCHG-ID      NOT = PV-FILE-PRCHG-ID      OR        02990000
029900        ML002-SKU-NBR       NOT = PV-FILE-SKU-NBR                 02990100
029800         MOVE ML002-PRCHG-EFF-DTE    TO PV-FILE-PRCHG-EFF-DTE     02990200
029800         MOVE ML002-PRCHG-ID         TO PV-FILE-PRCHG-ID          02990300
029800         MOVE ML002-SKU-NBR          TO PV-FILE-SKU-NBR           02990400
029900         SET PS-SEL-YES              TO TRUE                      02990500
029900     ELSE                                                         02990600
029900         SET PS-SEL-NO               TO TRUE                      02990700
029900     END-IF.                                                      02990800
029900*                                                                 02990900
029900     IF PS-SEL-YES                                                02991000
024200*                                                                 02992000
024200     PERFORM                                                      02993000
024200         WITH TEST AFTER                                          02994000
024200         VARYING PV-RETRY-COUNT FROM 1 BY 1                       02995000
024200         UNTIL (PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT)          02996000
024200             OR (SQLCODE = 0)                                     02997000
024200             OR (SQLCODE = 100)                                   02998000
024200*                                                                 02999000
030000      EXEC SQL                                                    03000000
030100         SELECT PRCHG_EFF_DTE,                                    03010000
030200                PRCHG_ID,                                         03020000
030300                SKU_NBR,                                          03030000
030400                MKUP_CNCL_STAT_CDE                                03040000
030500         INTO                                                     03050000
030600               :PV-PRCHG-EFF-DTE,                                 03060000
030700               :PV-PRCHG-ID,                                      03070000
030800               :PV-SKU-NBR,                                       03080000
030900               :PV-MKUP-CNCL-CDE                                  03090000
031000        FROM                                                      03100000
031100             XMT_MKUP_CNCL_MDSE                                   03110000
031200        WHERE                                                     03120000
031400             PRCHG_EFF_DTE = :PV-FILE-PRCHG-EFF-DTE AND           03130000
031300             PRCHG_ID = :PV-FILE-PRCHG-ID AND                     03140000
031500             SKU_NBR = :PV-FILE-SKU-NBR AND                       03150000
031600             MKUP_CNCL_STAT_CDE = 'S'                             03160000
031700        WITH UR                                                   03170000
031800      END-EXEC                                                    03180000
031900*                                                                 03190000
032000     EVALUATE SQLCODE                                             03200000
032100       WHEN 0                                                     03210000
032800*      WHEN 100                                                   03220000
032400         MOVE 'MUC'                TO ML002-PRCHG-TYP-CDE         03230000
032500         WRITE PCHG-OUT-REC FROM ML002-PERM-PRCHG-ATTRIB-RECS     03240000
032600         ADD 1                     TO PV-RECS-WRITE-MUC           03250000
032600*          IF PV-MKUP-CNCL-CDE NOT = SPACE                        03260000
032700             PERFORM 2400-UPDATE-STATUS-PARA                      03270000
032700*          END-IF                                                 03271000
032800        WHEN +100                                                 03272000
032500         WRITE PCHG-OUT-REC FROM ML002-PERM-PRCHG-ATTRIB-RECS     03273000
032600         ADD 1                     TO PV-RECS-WRITE-MUC           03274000
032800        WHEN -911                                                 03275000
032900        WHEN -913                                                 03276000
033000                 ADD 1               TO PV-RETRY-COUNT            03277000
033100        WHEN OTHER                                                03278000
033200                MOVE '2200-CHECK-MUC-PARA'                        03279000
033300                                     TO PV-ABEND-PARAGRAPH        03280000
033400                MOVE 'SELECT ON XMT_MKUP_CNCL_MDSE'               03290000
033500                                     TO PV-OPERATION-ATTEMPTED    03300000
033600                 PERFORM 9999-SQL-ABEND                           03310000
033700         END-EVALUATE                                             03320000
033700         END-PERFORM                                              03330000
033800      IF PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                  03340000
033900          MOVE '2200-CHECK-MUC-PARA'                              03350000
034000                                  TO PV-ABEND-PARAGRAPH           03360000
034100          MOVE 'SELECT XMT_MKUP_CNCL_MDSE '                       03370000
034200                                  TO PV-OPERATION-ATTEMPTED       03380000
034300          PERFORM 9999-SQL-ABEND                                  03390000
034400      END-IF                                                      03400000
034400     ELSE                                                         03410000
034400       IF PV-MKUP-CNCL-CDE NOT = SPACE  AND                       03420000
034400          SQLCODE = ZERO                                          03430000
032400         MOVE 'MUC'                TO ML002-PRCHG-TYP-CDE         03440000
032500         WRITE PCHG-OUT-REC FROM ML002-PERM-PRCHG-ATTRIB-RECS     03440100
032600         ADD 1                     TO PV-RECS-WRITE-MUC           03440200
             ELSE                                                       03440300
032500         WRITE PCHG-OUT-REC FROM ML002-PERM-PRCHG-ATTRIB-RECS     03440400
032600         ADD 1                     TO PV-RECS-WRITE-MUC           03440500
032600       END-IF                                                     03440600
032600     END-IF.                                                      03440700
034500*                                                                 03440800
034600***************************************************************** 03440900
034700*  UPDATE THE STATUS CODE OF XMT_MKUP_CNCL_MDSE TABLE           * 03441000
034800***************************************************************** 03442000
034900 2400-UPDATE-STATUS-PARA.                                         03443000
035000*                                                                 03444000
035100     MOVE '2400-UPDATE-STATUS-PARA '  TO PV-ABEND-PARAGRAPH.      03445000
024200*                                                                 03446000
024200     PERFORM                                                      03447000
024200         WITH TEST AFTER                                          03448000
024200         VARYING PV-RETRY-COUNT FROM 1 BY 1                       03449000
024200         UNTIL (PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT)          03450000
024200             OR (SQLCODE = 0)                                     03460000
024200*                                                                 03470000
035300     EXEC SQL                                                     03480000
035400       UPDATE XMT_MKUP_CNCL_MDSE                                  03490000
035500          SET MKUP_CNCL_STAT_CDE = 'P'                            03500000
035600       WHERE PRCHG_ID = :PV-PRCHG-ID AND                          03510000
035700             PRCHG_EFF_DTE = :PV-PRCHG-EFF-DTE AND                03520000
035800             SKU_NBR = :PV-SKU-NBR AND                            03530000
035900             MKUP_CNCL_STAT_CDE = 'S'                             03540000
036000     END-EXEC                                                     03550000
036100*                                                                 03560000
036200         EVALUATE SQLCODE                                         03570000
036300             WHEN 0                                               03580000
036400                 ADD 1               TO PV-UPDATE-MUC-COUNT       03590000
036600             WHEN -911                                            03600000
036700             WHEN -913                                            03610000
036800                 ADD 1               TO PV-RETRY-COUNT            03620000
036900             WHEN OTHER                                           03630000
037000                MOVE '2400-UPDATE-STATUS-PARA '                   03640000
037100                                     TO PV-ABEND-PARAGRAPH        03650000
037200                 MOVE 'UPDATE XMT_MKUP_CNCL_MDSE'                 03660000
037300                                     TO PV-OPERATION-ATTEMPTED    03670000
037400                 PERFORM 9999-SQL-ABEND                           03680000
037500         END-EVALUATE                                             03690000
037500     END-PERFORM.                                                 03700000
037600      IF PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                  03710000
037700          MOVE '2400-UPDATE-STATUS-PARA '                         03720000
037800                                  TO PV-ABEND-PARAGRAPH           03730000
037900          MOVE 'UPDATE XMT_MKUP_CNCL_MDSE'                        03740000
038000                                  TO PV-OPERATION-ATTEMPTED       03750000
038100          PERFORM 9999-SQL-ABEND                                  03760000
038200      END-IF.                                                     03770000
038300*                                                                 03780000
039700***************************************************************** 03790000
039800*  END OF JOB OPERATIONS                                        * 03800000
039900***************************************************************** 03810000
040000 9000-EOJ.                                                        03820000
040100*                                                                 03830000
040200     MOVE '9000-EOJ ' TO PV-ABEND-PARAGRAPH.                      03840000
040300*                                                                 03850000
040400     CLOSE INPUT-PERM-PRCHG-ATTRIB                                03860000
040500           CC-DATE-FILE                                           03870000
040600           PCHG-OUT-FILE.                                         03880000
040700*                                                                 03890000
040800     EXEC SQL                                                     03900000
040900      COMMIT                                                      03910000
041000     END-EXEC.                                                    03920000
041100*                                                                 03930000
036200      EVALUATE SQLCODE                                            03940000
036300          WHEN 0                                                  03950000
036400              CONTINUE                                            03960000
036900          WHEN OTHER                                              03970000
037000              MOVE '9000-EOJ '    TO PV-ABEND-PARAGRAPH           03980000
037200              MOVE 'COMMIT XMT_MKUP_CNCL_MDSE'                    03990000
037300                                  TO PV-OPERATION-ATTEMPTED       04000000
037400              PERFORM 9999-SQL-ABEND                              04010000
037500      END-EVALUATE.                                               04020000
041800*                                                                 04030000
041200      DISPLAY 'SKU RECORD READ COUNT      : ' PV-RECS-READ-SKU.   04040000
041300      DISPLAY 'MUC-SKU RECORD WRITE COUNT : ' PV-RECS-WRITE-MUC.  04050000
041400      DISPLAY 'SKU RECORD WRITE COUNT     : ' PV-RECS-WRITE-SKU.  04060000
041500      DISPLAY 'UPDATE MUC COUNT           : '                     04070000
041600                                             PV-UPDATE-MUC-COUNT. 04080000
041700*                                                                 04090000
041800***************************************************************** 04100000
041900*  ABEND PARAGRAPH                                              * 04110000
042000***************************************************************** 04120000
042100 9999-SQL-ABEND.                                                  04130000
042200*                                                                 04140000
042300         DISPLAY '** ABEND            **'.                        04150000
042400         DISPLAY '** PROGRAM NAME     ** = '                      04160000
042500                                          PC-PROGRAM-NAME.        04170000
042600         DISPLAY '** PARAGRAPH        ** = '                      04180000
042700                                          PV-ABEND-PARAGRAPH.     04190000
042800         DISPLAY '** OPERATION        ** = '                      04200000
042900                                          PV-OPERATION-ATTEMPTED. 04210000
043000         DISPLAY '** SKU RECORD READ  ** = '                      04220000
043100                                          PV-RECS-READ-SKU.       04230000
043200         DISPLAY '** MUC RECORD WRITE ** = '                      04240000
043300                                          PV-RECS-WRITE-MUC.      04250000
043400         DISPLAY '** SKU RECORD WRITE ** = '                      04260000
043500                                          PV-RECS-WRITE-SKU.      04270000
043600         DISPLAY '** UPDATE MUC COUNT ** = '                      04280000
043700                                          PV-UPDATE-MUC-COUNT.    04290000
043800                                                                  04300000
043900         COPY DPPD004.                                            04310000
044000                                                                  04320000
044100         MOVE +4013 TO PV-ABEND-CODE.                             04330000
044200         CALL 'ILBOABN0'  USING PV-ABEND-CODE.                    04340000
044300*                                                                 04350000
044300******************************************************************04360000
044300*  THIS ROUTINE FORCES AN ABEND                                   04370000
044300******************************************************************04380000
044300 9999-ABEND.                                                      04390000
044300                                                                  04400000
044300     MOVE +4013 TO PV-ABEND-CODE.                                 04410000
044300     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         04420000
