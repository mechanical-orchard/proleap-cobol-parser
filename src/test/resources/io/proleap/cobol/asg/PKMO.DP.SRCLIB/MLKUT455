       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    MLKUT455.                                         00020000
       AUTHOR.        RONNA BUTZ.                                       00030000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
       DATE-WRITTEN.  12-28-1999.                                       00050000
       DATE-COMPILED.                                                   00060000
      ******************************************************************00070000
      *                                                                 00080000
      * MLKUT455 -                                                      00090000
      *                                                                 00100000
      * THIS PROGRAM WILL CREATE THE EXTRACT FOR THE RECALC PROGRAM     00110000
      * ON TABLE TMNDPTS.  THIS PROGRAM WAS CLONED FROM MLKUT409.       00120001
      *                                                                 00130000
      ******************************************************************00140000
      *                                                                 00150000
       ENVIRONMENT DIVISION.                                            00160000
      *                                                                 00170000
       CONFIGURATION SECTION.                                           00180000
      *                                                                 00190000
       SOURCE-COMPUTER.        IBM-3090.                                00200000
       OBJECT-COMPUTER.        IBM-3090.                                00210000
      *                                                                 00220000
       INPUT-OUTPUT SECTION.                                            00230000
       FILE-CONTROL.                                                    00240000
                                                                        00250000
           SELECT MNDPTS-EXTR-FILE                                      00260000
               ASSIGN TO OUT01.                                         00270000
                                                                        00280000
      ******************************************************************00290000
       DATA DIVISION.                                                   00300000
      ******************************************************************00310000
                                                                        00320000
       FILE SECTION.                                                    00330000
                                                                        00340000
       FD  MNDPTS-EXTR-FILE                                             00350000
           RECORDING MODE IS F                                          00360000
           LABEL RECORDS ARE STANDARD                                   00370000
           BLOCK CONTAINS 0 RECORDS.                                    00380000
                                                                        00390000
       01  MNDPTS-EXTR-REC             PIC X(18).                       00400000
                                                                        00410000
      *                                                                 00420000
      ******************************************************************00430000
       WORKING-STORAGE SECTION.                                         00440000
      ******************************************************************00450000
                                                                        00460000
       01  PS-PROGRAM-SWITCHES.                                         00470000
           05  PS-TMNDPTS-DONE         PIC X       VALUE 'N'.           00480000
               88  PS-TMNDPTS-IS-DONE              VALUE 'Y'.           00490000
               88  PS-TMNDPTS-IS-NOT-DONE          VALUE 'N'.           00500000
                                                                        00510000
       01  PA-PROGRAM-ACCUMULATORS                 COMP-3.              00520000
           05  PA-TMNDPTS-ROWS-FETCHED PIC S9(13)  VALUE ZERO.          00530000
           05  PA-OUTPUT-RECS-WRITTEN  PIC S9(13)  VALUE ZERO.          00540000
                                                                        00550000
       01  CD-COUNTER-DISPLAY.                                          00560000
           05  CD-COUNT-HOLD1          PIC Z,ZZZ,ZZZ,ZZZ,ZZ9.           00570000
                                                                        00580000
       01 ABEND-AREAS.                                                  00590000
           05 ABEND-CODE               PIC S9(04)  VALUE ZERO           00600000
                                                   COMP SYNC.           00610000
               88  AC-BAD-DATA                     VALUE +4003.         00620000
               88  AC-DB2-ERROR                    VALUE +4013.         00630000
           05  AA-ABEND-LIT            PIC X(40)   VALUE                00640000
                 '*****       ABEND'.                                   00650000
           05  AA-PROGRAM-LIT          PIC X(40)   VALUE                00660000
                   '*****   PROGRAM: MLKUT455'.                         00670000
           05  AA-PARAGRAPH-LIT.                                        00680000
               10  FILLER              PIC X(17)   VALUE                00690000
                   '***** PARAGRAPH: '.                                 00700000
               10  AA-PARAGRAPH-NAME   PIC X(35)   VALUE SPACES.        00710000
           05  AA-MESSAGE-LINE.                                         00720000
               10  FILLER              PIC X(06)   VALUE '*****'.       00730000
               10  AA-MESSAGE          PIC X(127)  VALUE SPACES.        00740000
           05  AA-DB2-ERROR-LIT        PIC X(40)   VALUE                00750000
                   '*****    DB2 ERROR'.                                00760000
           05  AA-DB2-OPERATION-LIT.                                    00770000
               10  FILLER              PIC X(17)   VALUE                00780000
                   '***** OPERATION: '.                                 00790000
               10  AA-DB2-OPERATION.                                    00800000
                   15  AA-DB2-OP-1     PIC X(25)   VALUE SPACES.        00810000
                   15  AA-DB2-OP-2     PIC X(25)   VALUE SPACES.        00820000
           05  AA-DB2-TABLE-1          PIC X(08)   VALUE SPACES.        00830000
           05  AA-DB2-TABLE-2          PIC X(08)   VALUE SPACES.        00840000
           05  AA-DB2-TABLE-3          PIC X(08)   VALUE SPACES.        00850000
           05  AA-DB2-TABLE-4          PIC X(08)   VALUE SPACES.        00860000
                                                                        00870000
      *** TMNDPTS EXTRACT FILE                                          00880000
       01  EXTR-RECORD.                                                 00890000
           05  EXTR-DEPT-NBR    PIC X(03).                              00900000
           05  FILLER           PIC X(02)        VALUE SPACES.          00910000
       EJECT                                                            00920000
                                                                        00930000
      ******************************************************************00940000
      *  DB2 ERROR MESSAGES FORMAT AREA.                                00950000
      ******************************************************************00960000
           COPY DPWS004.                                                00970000
                                                                        00980000
      ******************************************************************00990000
      *  DB2 ERRORS                                                     01000000
      ******************************************************************01010000
           COPY SQLCA2.                                                 01020000
                                                                        01030000
      ******************************************************************01040000
      *  DB2 COMMUNICATION AREA                                         01050000
      ******************************************************************01060000
           EXEC SQL                                                     01070000
                INCLUDE SQLCA                                           01080000
           END-EXEC.                                                    01090000
                                                                        01100000
      ******************************************************************01110000
      *  DB2 TMNDPTS TABLE LAYOUT                                       01120000
      ******************************************************************01130000
           EXEC SQL                                                     01140000
                INCLUDE TMNDPTS                                         01150000
           END-EXEC.                                                    01160000
                                                                        01170000
      ****************************************************              01180000
      * M/L DATE TABLE AND CURRENT OPEN FISCAL DATE INFO *              01190000
      ****************************************************              01200000
           EXEC SQL                                                     01210000
               INCLUDE TDTATTR                                          01220000
           END-EXEC.                                                    01230000
                                                                        01240000
      ****************************************************              01250000
      * M/L DATE CONTROL INFO                            *              01260000
      ****************************************************              01270000
           EXEC SQL                                                     01280001
               INCLUDE TMLCNTL                                          01290001
           END-EXEC.                                                    01300001
                                                                        01310000
      ******************************************************************01320000
      *  DB2 TMNDPTS CURSOR                                             01330000
      ******************************************************************01340000
           EXEC SQL                                                     01350000
               DECLARE TMNDPTS_CURSOR CURSOR FOR                        01360000
                                                                        01370000
                 SELECT DISTINCT DEPT_NBR                               01380000
                 FROM TMNDPTS                                           01390000
                     ,TMLCNTL                                           01400002
                 WHERE (FSCL_MN_END_DTE BETWEEN                         01410000
                        :DTATTR-PFM-END-DTE AND                         01420000
                        MXPSTG_FSCL_MN_DTE)                             01430000
                 ORDER BY DEPT_NBR                                      01440000
                                                                        01450000
           END-EXEC.                                                    01460000
                                                                        01470000
       EJECT                                                            01480000
                                                                        01490000
      ******************************************************************01500000
       PROCEDURE DIVISION.                                              01510000
      ******************************************************************01520000
                                                                        01530000
      ******************************************************************01540000
       A000-MAIN-MODULE.                                                01550000
      ******************************************************************01560000
      *                                                                 01570000
           PERFORM B000-INITIALIZE.                                     01580000
                                                                        01590000
           PERFORM B100-PROCESS-DATA.                                   01600000
                                                                        01610000
           PERFORM B900-EOJ-ROUTINE.                                    01620000
                                                                        01630000
           STOP RUN.                                                    01640000
                                                                        01650000
       EJECT                                                            01660000
                                                                        01670000
      ******************************************************************01680000
       B000-INITIALIZE.                                                 01690000
      ******************************************************************01700000
      *                                                                 01710000
           OPEN OUTPUT MNDPTS-EXTR-FILE.                                01720000
           PERFORM 7100-SELECT-DB2-DATES.                               01730000
                                                                        01740000
                                                                        01750000
       EJECT                                                            01760000
                                                                        01770000
      ******************************************************************01780000
       B100-PROCESS-DATA.                                               01790000
      ******************************************************************01800000
      *                                                                 01810000
           PERFORM Z210-OPEN-CURSOR-TMNDPTS.                            01820000
                                                                        01830000
           PERFORM Z220-FETCH-TMNDPTS.                                  01840000
                                                                        01850000
           PERFORM                                                      01860000
             UNTIL PS-TMNDPTS-IS-DONE                                   01870000
               PERFORM C100-WRITE-EXTRACT                               01880000
               PERFORM Z220-FETCH-TMNDPTS                               01890000
           END-PERFORM.                                                 01900000
                                                                        01910000
           PERFORM Z230-CLOSE-CURSOR-TMNDPTS.                           01920000
                                                                        01930000
       EJECT                                                            01940000
                                                                        01950000
      ******************************************************************01960000
       C100-WRITE-EXTRACT.                                              01970000
      ******************************************************************01980000
      *                                                                 01990000
           MOVE MNDPTS-DEPT-NBR        TO EXTR-DEPT-NBR.                02000000
           WRITE MNDPTS-EXTR-REC                                        02010000
               FROM EXTR-RECORD.                                        02020000
           ADD 1                       TO PA-OUTPUT-RECS-WRITTEN.       02030000
                                                                        02040000
       EJECT                                                            02050000
                                                                        02060000
      ******************************************************************02070000
       B900-EOJ-ROUTINE.                                                02080000
      ******************************************************************02090000
      *                                                                 02100000
           DISPLAY ' '.                                                 02110000
           DISPLAY '  PROGRAM MLKUT455 PROCESSING SUMMARY'.             02120000
           DISPLAY '  -----------------------------------'.             02130000
           DISPLAY ' '.                                                 02140000
      *                                                                 02150000
           MOVE PA-TMNDPTS-ROWS-FETCHED TO CD-COUNT-HOLD1.              02160000
           DISPLAY 'TMNDPTS ROWS FETCHED =      ' CD-COUNT-HOLD1.       02170000
      *                                                                 02180000
           MOVE PA-OUTPUT-RECS-WRITTEN TO CD-COUNT-HOLD1.               02190000
           DISPLAY 'EXTRACT RECORDS WRITTEN =   ' CD-COUNT-HOLD1.       02200000
      *                                                                 02210000
           DISPLAY ' '.                                                 02220000
                                                                        02230000
           CLOSE MNDPTS-EXTR-FILE.                                      02240000
                                                                        02250000
       EJECT                                                            02260000
                                                                        02270000
       EJECT                                                            02280000
                                                                        02290000
      ******************************************************************02300000
       Z210-OPEN-CURSOR-TMNDPTS.                                        02310000
      ******************************************************************02320000
      *                                                                 02330000
           EXEC SQL                                                     02340000
               OPEN TMNDPTS_CURSOR                                      02350000
           END-EXEC.                                                    02360000
                                                                        02370000
           EVALUATE TRUE                                                02380000
               WHEN SQLCODE < 0                                         02390000
                   MOVE 'Z210-OPEN-CURSOR-TMNDPTS'                      02400000
                                       TO AA-PARAGRAPH-NAME             02410000
                   MOVE 'TMNDPTS TABLE ERROR'                           02420000
                                       TO AA-MESSAGE                    02430000
                   MOVE 'OPEN CURSOR'  TO AA-DB2-OPERATION              02440000
                   PERFORM Z998-SQL-ERROR                               02450000
               WHEN SQLCODE > 0                                         02460000
               WHEN SQLWARN0 NOT = SPACES                               02470000
                   MOVE 'Z210-OPEN-CURSOR-TMNDPTS'                      02480000
                                       TO AA-PARAGRAPH-NAME             02490000
                   MOVE 'TMNDPTS TABLE WARNING'                         02500000
                                       TO AA-MESSAGE                    02510000
                   MOVE 'OPEN CURSOR'  TO AA-DB2-OPERATION              02520000
                   PERFORM Z998-SQL-ERROR                               02530000
           END-EVALUATE.                                                02540000
                                                                        02550000
       EJECT                                                            02560000
                                                                        02570000
      ******************************************************************02580000
       Z220-FETCH-TMNDPTS.                                              02590000
      ******************************************************************02600000
      *                                                                 02610000
           EXEC SQL                                                     02620000
               FETCH TMNDPTS_CURSOR                                     02630000
                INTO :MNDPTS-DEPT-NBR                                   02640000
           END-EXEC.                                                    02650000
                                                                        02660000
           EVALUATE TRUE                                                02670000
               WHEN SQLCODE = 0                                         02680000
                   ADD +1              TO PA-TMNDPTS-ROWS-FETCHED       02690000
               WHEN SQLCODE = +100                                      02700000
                   MOVE 'Y'            TO PS-TMNDPTS-DONE               02710000
               WHEN SQLCODE < 0                                         02720000
                   MOVE 'Z220-FETCH-TMNDPTS'                            02730000
                                       TO AA-PARAGRAPH-NAME             02740000
                   MOVE 'TMNDPTS TABLE ERROR'                           02750000
                                       TO AA-MESSAGE                    02760000
                   MOVE 'FETCH'        TO AA-DB2-OPERATION              02770000
                   PERFORM Z998-SQL-ERROR                               02780000
               WHEN ((SQLCODE > 0) AND (SQLCODE NOT = +100))            02790000
               WHEN SQLWARN0 NOT = SPACES                               02800000
                   MOVE 'Z220-FETCH-TMNDPTS'                            02810000
                                       TO AA-PARAGRAPH-NAME             02820000
                   MOVE 'TMNDPTS TABLE WARNING'                         02830000
                                       TO AA-MESSAGE                    02840000
                   MOVE 'FETCH'        TO AA-DB2-OPERATION              02850000
                   PERFORM Z998-SQL-ERROR                               02860000
           END-EVALUATE.                                                02870000
                                                                        02880000
       EJECT                                                            02890000
                                                                        02900000
      ******************************************************************02910000
       Z230-CLOSE-CURSOR-TMNDPTS.                                       02920000
      ******************************************************************02930000
      *                                                                 02940000
           EXEC SQL                                                     02950000
               CLOSE TMNDPTS_CURSOR                                     02960000
           END-EXEC.                                                    02970000
                                                                        02980000
           EVALUATE TRUE                                                02990000
               WHEN SQLCODE < 0                                         03000000
                   MOVE 'Z230-CLOSE-CURSOR-TMNDPTS'                     03010000
                                       TO AA-PARAGRAPH-NAME             03020000
                   MOVE 'TMNDPTS TABLE ERROR'                           03030000
                                       TO AA-MESSAGE                    03040000
                   MOVE 'CLOSE CURSOR' TO AA-DB2-OPERATION              03050000
                   PERFORM Z998-SQL-ERROR                               03060000
               WHEN SQLCODE > 0                                         03070000
               WHEN SQLWARN0 NOT = SPACES                               03080000
                   MOVE 'Z230-CLOSE-CURSOR-TMNDPTS'                     03090000
                                       TO AA-PARAGRAPH-NAME             03100000
                   MOVE 'TMNDPTS TABLE WARNING'                         03110000
                                       TO AA-MESSAGE                    03120000
                   MOVE 'CLOSE CURSOR' TO AA-DB2-OPERATION              03130000
                   PERFORM Z998-SQL-ERROR                               03140000
           END-EVALUATE.                                                03150000
                                                                        03160000
       EJECT                                                            03170000
                                                                        03180000
       7100-SELECT-DB2-DATES.                                           03190000
      *                                                                 03200000
           EXEC SQL                                                     03210000
               SELECT  PFM_END_DTE                                      03220000
                INTO  :DTATTR-PFM-END-DTE                               03230000
                FROM TDTATTR                                            03240000
                    ,TMLCNTL                                            03250002
                WHERE KY_DTE  = OPN_FSCL_MN_DTE                         03260000
           END-EXEC.                                                    03270000
      *                                                                 03280000
           EVALUATE SQLCODE                                             03290000
               WHEN 0                                                   03300000
                   DISPLAY 'DTATTR-PFM-END-DTE: '                       03310000
                            DTATTR-PFM-END-DTE                          03320000
               WHEN OTHER                                               03330000
                  MOVE '7100-SELECT-DB2-DATES'                          03340000
                                       TO AA-PARAGRAPH-NAME             03350000
                   PERFORM Z998-SQL-ERROR                               03360000
           END-EVALUATE.                                                03370000
      *                                                                 03380000
      *                                                                 03390000
      ******************************************************************03400000
       Z998-SQL-ERROR.                                                  03410000
      ******************************************************************03420000
      *                                                                 03430000
                                                                        03440000
           CLOSE MNDPTS-EXTR-FILE.                                      03450000
                                                                        03460000
           DISPLAY AA-ABEND-LIT.                                        03470000
           DISPLAY AA-DB2-ERROR-LIT.                                    03480000
           DISPLAY AA-PROGRAM-LIT.                                      03490000
           DISPLAY AA-PARAGRAPH-LIT.                                    03500000
           DISPLAY AA-MESSAGE-LINE.                                     03510000
           DISPLAY AA-DB2-OPERATION-LIT.                                03520000
           SET AC-DB2-ERROR TO TRUE.                                    03530000
           MOVE +4013                  TO ABEND-CODE.                   03540000
                                                                        03550000
           COPY DPPD004.                                                03560000
           CALL 'ILBOABN0' USING ABEND-CODE.                            03570000
                                                                        03580000
