      ***************************************************************** 00010000
       IDENTIFICATION DIVISION.                                         00020000
      ***************************************************************** 00030000
                                                                        00040000
       PROGRAM-ID.             TCKUP004.                                00050000
       AUTHOR.                 JIM MYERS.                               00060000
       INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
       DATE-WRITTEN            MARCH    2002.                           00080000
       DATE-COMPILED.                                                   00090000
                                                                        00100000
      ******************************************************************00101000
      *   DATE 05/02/2002                                               00102000
      *   CHANGE INTERNAL PROGRAM DOC TO BE GENERIC SO PROGRAM CAN BE   00103000
      *   USED FOR MULTIPLE USES.  ALSO CHANGED ALL REFERENCES TO ADJ   00103100
      *   AND ADJUST TO UPDT AND UPDATE.                                00103200
      *   MADE BY: JIM MYERS   _________   WR/IR #: __________________  00105000
060122******************************************************************00105200
060122*   DATE 06/01/2022                                               00105300
060122*   CHANGE PROGRAM TO LOCATE THE ACTUAL STORE NUMBER BEFORE       00105400
060122*   ATTEMPTING THE TEPCRD UPDATE.                                 00105500
060122*   MADE BY: DAN PAYNTER             WR/IR #: CHG0270232          00105700
112922******************************************************************00105800
112922*   DATE 11/29/2022                                               00105900
112922*   COMMENT OUT THE STORE LOCATION LOGIC UNTIL A NEW DB2 INDEX    00106000
112922*   CAN BE ADDED TO TEPCRD (LIKELY IN JAN).                       00106100
112922*   MADE BY: DAN PAYNTER             WR/IR #: CHG0278672          00106200
      ***************************************************************** 00107000
052523*   DATE 05/25/2023                                               00108000
052523*   REINSTALL THE STORE LOCATION LOGIC BECAUSE THE NEW DB2        00109000
052523*   INDEX ON TEPCRD IS NOW IN PLACE                               00109100
052523*   MADE BY: DAN PAYNTER             WR/IR #: CHG0289014          00109201
      ***************************************************************** 00109300
      ***************************************************************** 00110000
      *                                                               * 00120000
      *  THIS PROGRAM UPDATES THE TEPCRD TABLE AND MARKS ALL INPUT    * 00130000
      *  TRANSACTIONS TO A 'P' FROM A 'U'.                            * 00140000
      *                                                               * 00150000
      *   INPUT: INP01 - CONTAINS UPDATE RECORDS FOR UPDATE THE TEPCRD* 00160000
      *                  TABLE                                        * 00170000
      *                                                               * 00190000
      ***************************************************************** 00200000
      *  UPDATES EACH TRANSACTION IN THE DATABASE TO PROCESSED.       * 00240000
      *                                                               * 00250000
      ***************************************************************** 00260000
       ENVIRONMENT DIVISION.                                            00270000
      ***************************************************************** 00280000
                                                                        00290000
       CONFIGURATION SECTION.                                           00300000
                                                                        00310000
       SOURCE-COMPUTER.        IBM-3090.                                00320000
                                                                        00330000
       OBJECT-COMPUTER.        IBM-3090.                                00340000
                                                                        00350000
       INPUT-OUTPUT SECTION.                                            00360000
                                                                        00370000
       FILE-CONTROL.                                                    00380000
                                                                        00390000
           SELECT MATCHED-UPDATE-FILE                                   00400000
               ASSIGN TO INP01.                                         00410000
                                                                        00420000
      ******************************************************************00440000
       DATA DIVISION.                                                   00450000
      ******************************************************************00460000
                                                                        00470000
       FILE SECTION.                                                    00480000
                                                                        00490000
       FD  MATCHED-UPDATE-FILE                                          00500000
           RECORDING MODE IS F                                          00510000
           BLOCK CONTAINS 0 RECORDS                                     00520000
           LABEL RECORDS ARE STANDARD.                                  00530000
                                                                        00540000
052523 01  MATCHED-UPDT-INPUT-RECORD       PIC X(100).                  00550000
                                                                        00560000
      ******************************************************************00580000
       WORKING-STORAGE SECTION.                                         00590000
      ******************************************************************00600000
                                                                        00610000
      ******************************************************************00620000
      *   PROGRAM SWITCHES                                             *00630000
      ******************************************************************00640000
       01  PS-PROGRAM-SWITCHES.                                         00650000
           05  PS-END-OF-INPUT-FILE-SW       PIC X(01)  VALUE 'N'.      00660000
               88  PS-END-OF-INPUT-FILE                 VALUE 'Y'.      00670000
060122     05  PV-EPCRD-FND-IND              PIC X(01)  VALUE 'N'.      00671000
060122     05  PV-EPCRD-STR-NBR              PIC S9(4) USAGE COMP.      00672000
                                                                        00680000
      ******************************************************************00690000
      *   PROGRAM CONSTANTS                                            *00700000
      ******************************************************************00710000
       01  PC-CONSTANTS.                                                00720000
           05  PC-LIT-P                    PIC X         VALUE 'P'.     00730000
060122     05  PC-DUP-ROWS                 PIC S9(04) VALUE -811.       00730100
060122     05  PC-DEFLT-ECOM-SETL-STR      PIC S9(04) VALUE 873.        00730200
           05  PC-PERIOD                   PIC X         VALUE '.'.     00740000
           05  PC-CURRENT-PROGRAM-NAME     PIC X(08)     VALUE          00750000
                                                         'TCKUP004'.    00760000
           05  PC-ABEND-MSSG                PIC X(12)      VALUE        00770000
               '** ABEND ** '.                                          00780000
           05  PC-DB-ERROR-PREFIX           PIC X(09)      VALUE        00790000
               'DB2 ERROR'.                                             00800000
           05  PC-DB-ATTEMPTING-MSSG        PIC X(14)      VALUE        00810000
               'ATTEMPTING TO '.                                        00820000
                                                                        00830000
      ******************************************************************00840000
      *   PROGRAM VARIABLES.                                           *00850000
      ******************************************************************00860000
       01  PV-PROGRAM-VARIABLES.                                        00870000
           05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACE.   00880000
           05  PV-DB2-ERROR-MSSG           PIC  X(40)    VALUE SPACE.   00890000
           05  PV-PARTN-NBR                PIC  S9(4)    COMP           00920000
                                                         VALUE ZERO.    00930000
           05  PV-STR-NBR                  PIC  S9(4)    COMP           00940000
                                                         VALUE ZERO.    00950000
052523     05  PV-ORIG-STR-NBR             PIC  S9(4)    COMP           00951000
052523                                                   VALUE ZERO.    00952000
           05  PV-RGST-ID                  PIC  S9(4)    COMP           00960000
                                                         VALUE ZERO.    00970000
           05  PV-TRN-NBR                  PIC  S9(4)    COMP           00980000
                                                         VALUE ZERO.    00990000
           05  PV-SLS-CORR-SEQ-NBR         PIC  S9(4)    COMP           01000000
                                                         VALUE ZERO.    01010000
           05  PV-TNDR-SEQ-NBR             PIC  S9(4)    COMP           01011000
                                                         VALUE ZERO.    01012000
112922     05  PV-UPDATE-COUNTER           PIC  9(7)     VALUE ZERO.    01020000
112922     05  PV-SQL100-COUNTER           PIC  9(7)     VALUE ZERO.    01020100
052523     05  PV-UPDATE-COUNTER-PAY       PIC  9(7)     VALUE ZERO.    01020200
052523     05  PV-SQL100-COUNTER-PAY       PIC  9(7)     VALUE ZERO.    01020300
112922     05  PV-COMMIT-COUNTER           PIC  9(7)     VALUE ZERO.    01020400
           05  PV-SLS-DTE                  PIC  X(10).                  01021000
           05  PV-START-TIME               PIC  X(08).                  01022000
                                                                        01030000
       01  ABEND-CODE  COMP                PIC S9(04)    VALUE ZEROS.   01190000
           88  ABEND-4013-DB2-ERROR                      VALUE +4013.   01200000
      ******************************************************************01210000
      *  INPUT FILE LAYOUT                                             *01220000
      ******************************************************************01230000
           COPY TCRD009.                                                01240000
      ******************************************************************01250000
      *    STANDARD DB2 ERROR HANDLING AREA                            *01260000
      ******************************************************************01270000
           COPY DPWS004.                                                01280000
      ******************************************************************01290000
      *    STANDARD DB2 DCLGEN FOR THE CREDIT TENDER TABLE (TEPCRD)    *01300000
      ******************************************************************01310000
           EXEC SQL                                                     01320000
               INCLUDE TEPCRD                                           01330000
           END-EXEC.                                                    01340000
      ******************************************************************01341000
      *    STANDARD DB2 DCLGEN FOR THE PAYMENT DBE TABLE   (TEPPAY)    *01342000
      ******************************************************************01343000
           EXEC SQL                                                     01344000
               INCLUDE TEPPAY                                           01345000
           END-EXEC.                                                    01346000
      ******************************************************************01350000
      *    STANDARD DB2 DCLGEN FOR THE PARTITION TABLE (TEPPART)       *01360000
      ******************************************************************01370000
           EXEC SQL                                                     01380000
               INCLUDE TEPPART                                          01390000
           END-EXEC.                                                    01400000
      ******************************************************************01470000
      *    STANDARD DB2 COMMUNICATIONS AREA                            *01480000
      ******************************************************************01490000
           EXEC SQL                                                     01500000
               INCLUDE SQLCA                                            01510000
           END-EXEC.                                                    01520000
                                                                        01530000
      ***************************************************************** 01540000
      * PROCEDURE DIVISION.                                           * 01550000
      ***************************************************************** 01560000
       PROCEDURE DIVISION.                                              01570000
                                                                        01580000
      ******************************************************************01590000
      * 0000-MAINLINE-PARAGRAPH                                        *01600000
      *                                                                *01610000
      ******************************************************************01620000
       0000-MAINLINE-PARAGRAPH.                                         01630000
                                                                        01640000
           PERFORM 1000-INITIALIZE-PROGRAM.                             01650000
                                                                        01660000
           PERFORM 2000-READ-MATCHED-UPDT-FILE.                         01670000
                                                                        01680000
           PERFORM 3000-PROCESS-RECORDS                                 01690000
               UNTIL PS-END-OF-INPUT-FILE.                              01700000
                                                                        01710000
           DISPLAY 'PV-UPDATE-COUNTER ' PV-UPDATE-COUNTER.              01711000
           DISPLAY 'PV-SQL100-COUNTER ' PV-SQL100-COUNTER.              01711100
           DISPLAY 'PV-UPDATE-CNTR-PAY ' PV-UPDATE-COUNTER-PAY.         01711200
           DISPLAY 'PV-SQL100-CNTR-PAY ' PV-SQL100-COUNTER-PAY.         01711300
                                                                        01712000
           GOBACK.                                                      01720000
                                                                        01730000
      ******************************************************************01750000
      * 1000-INITIALIZE-PROGRAM                                         01760000
      *  -  OPEN FILES                                                  01770000
      ******************************************************************01780000
       1000-INITIALIZE-PROGRAM.                                         01800000
                                                                        01810000
           OPEN INPUT  MATCHED-UPDATE-FILE.                             01820000
                                                                        01830000
           MOVE 0           TO PV-COMMIT-COUNTER.                       01840000
                                                                        01850000
      ******************************************************************01851000
      *2000-READ-MATCHED-UPDT-FILE.                                    *01852000
      ******************************************************************01853000
       2000-READ-MATCHED-UPDT-FILE.                                     01854000
                                                                        01854100
           READ  MATCHED-UPDATE-FILE                                    01855000
               INTO TC009-DATA                                          01856000
               AT END                                                   01857000
                   SET PS-END-OF-INPUT-FILE TO TRUE                     01858000
           END-READ.                                                    01859000
                                                                        01859700
      ******************************************************************01860000
      * 3000-PROCESS-RECORDS                                           *01870000
      ******************************************************************01880000
       3000-PROCESS-RECORDS.                                            01890000
                                                                        01900000
           IF PV-COMMIT-COUNTER > 500                                   01910000
              PERFORM 8000-COMMIT                                       01920000
              MOVE 0        TO PV-COMMIT-COUNTER                        01930000
           END-IF.                                                      01940000
                                                                        01941000
           PERFORM 3100-SELECT-PARTN-NUMBER.                            01950000
                                                                        01950100
052523     IF TC009-COBRAND-PYMT-IND = 'Y' OR                           01950200
052523        (TC009-TRLING-TRN-IND = 'Y' AND                           01950300
052523         TC009-TRN-TYP-CDE = '30')                                01950400
052523         PERFORM 4001-LOCATE-TEPPAY-ROW                           01950500
052523     ELSE                                                         01950600
060122         PERFORM 4000-LOCATE-TEPCRD-ROW                           01951000
052523     END-IF.                                                      01951100
                                                                        01952000
           PERFORM  2000-READ-MATCHED-UPDT-FILE.                        01960000
                                                                        01970000
      ******************************************************************02140000
      **  3100-SELECT-PARTN-NUMBER                                    **02141000
      **  RETRIEVE PARTITION NUMBER FROM TEPPART TABLE                **02141100
      ******************************************************************02142000
       3100-SELECT-PARTN-NUMBER.                                        02142100
                                                                        02142200
           MOVE TC009-SLS-DTE          TO PV-SLS-DTE.                   02142300
                                                                        02142400
           EXEC SQL                                                     02142500
              SELECT PARTN_NBR                                          02142600
              INTO  :PV-PARTN-NBR                                       02142700
              FROM TEPPART                                              02142800
              WHERE SLS_DTE   = :PV-SLS-DTE                             02142900
052523        AND   DB_STRUC_CDE  = 'O'                                 02143000
052523        AND   STR_GP_CDE    = 'A'                                 02143100
           END-EXEC.                                                    02143200
                                                                        02143300
           EVALUATE TRUE                                                02143400
               WHEN SQLCODE = ZERO                                      02143500
                   CONTINUE                                             02143600
               WHEN SQLWARN0 NOT EQUAL SPACE                            02143700
               WHEN SQLCODE NOT EQUAL ZERO                              02143800
                   MOVE '3100-SELECT-PARTITION-NUMBER'                  02143900
                                              TO PV-PARAGRAPH-NAME      02144000
                   MOVE 'SELECT OF PARTN NBR'                           02144100
                                              TO PV-DB2-ERROR-MSSG      02144200
                   PERFORM 9400-DB2-ERROR                               02144300
           END-EVALUATE.                                                02144400
                                                                        02144500
      ******************************************************************02160000
      **  UPDATE THE SETTLEMENT PROCESS CODE TO 'P' IN TEPCRD TABLE   **02161000
      ******************************************************************02162000
060122 4000-LOCATE-TEPCRD-ROW.                                          02163000
                                                                        02170000
           MOVE  TC009-STR-NBR          TO PV-STR-NBR.                  02172000
052523     MOVE  TC009-ORIG-STR-NBR     TO PV-ORIG-STR-NBR.             02172100
           MOVE  TC009-RGST-ID          TO PV-RGST-ID.                  02173000
           MOVE  TC009-TRN-NBR          TO PV-TRN-NBR.                  02174000
           MOVE  TC009-SLS-CORR-SEQ-NBR TO PV-SLS-CORR-SEQ-NBR.         02175000
           MOVE  TC009-TNDR-SEQ-NBR     TO PV-TNDR-SEQ-NBR.             02176000
           MOVE  TC009-STRT-TIME        TO PV-START-TIME.               02177000
060122     MOVE 'N' TO PV-EPCRD-FND-IND.                                02178000
                                                                        02240000
           EXEC SQL                                                     02240100
               UPDATE TEPCRD                                            02240200
                   SET STTLMNT_PRCD_CDE   = :PC-LIT-P                   02240300
                   WHERE PARTN_NBR        = :PV-PARTN-NBR               02240400
                     AND STR_NBR          = :PV-STR-NBR                 02240500
                     AND RGST_ID          = :PV-RGST-ID                 02240600
                     AND TRN_NBR          = :PV-TRN-NBR                 02240700
                     AND STRT_TM          = :PV-START-TIME              02240800
                     AND SLS_CORR_SEQ_NBR = :PV-SLS-CORR-SEQ-NBR        02240900
                     AND TNDR_SEQ_NBR     = :PV-TNDR-SEQ-NBR            02241000
060122     END-EXEC.                                                    02241100
                                                                        02350000
           EVALUATE TRUE                                                02360000
               WHEN SQLCODE = ZERO                                      02370000
060122             MOVE 'Y' TO PV-EPCRD-FND-IND                         02370100
                   ADD   +1      TO PV-UPDATE-COUNTER                   02370200
                                    PV-COMMIT-COUNTER                   02370300
               WHEN SQLCODE = +100                                      02381000
060122             MOVE 'N' TO PV-EPCRD-FND-IND                         02382000
052523             IF PV-STR-NBR NOT = PC-DEFLT-ECOM-SETL-STR           02382100
060122                 ADD   +1      TO PV-SQL100-COUNTER               02382200
060122                 DISPLAY 'NOT FOUND FOR UPDATE'                   02382300
060122                 DISPLAY 'PARTN_NBR: ' PV-PARTN-NBR               02382400
060122                 DISPLAY 'STR_NBR: ' PV-STR-NBR                   02382500
052523                 DISPLAY 'ORIG_STR_NBR: ' PV-ORIG-STR-NBR         02382600
060122                 DISPLAY 'RGST_ID: ' PV-RGST-ID                   02382700
060122                 DISPLAY 'TRN_NBR: ' PV-TRN-NBR                   02382800
060122                 DISPLAY 'STRT_TM: ' PV-START-TIME                02382900
060122                 DISPLAY 'SLS_CORR: ' PV-SLS-CORR-SEQ-NBR         02383000
060122                 DISPLAY 'TNDR_SEQ: ' PV-TNDR-SEQ-NBR             02383100
052523             ELSE                                                 02383200
052523                 PERFORM 4010-UPD-CRD-ROW-ORIG-STR-NBR            02383300
052523             END-IF                                               02392000
               WHEN OTHER                                               02400000
060122             MOVE '4000-LOCATE-TEPCRD-ROW'                        02410000
                                              TO PV-PARAGRAPH-NAME      02420000
060122             MOVE 'TO LOCATE TEPCRD '                             02430000
                                              TO PV-DB2-ERROR-MSSG      02440000
                   PERFORM 9400-DB2-ERROR                               02450000
           END-EVALUATE.                                                02460000
                                                                        02470000
052523******************************************************************02470100
052523**  UPDATE THE SETTLEMENT PROCESS CODE TO 'P' IN TEPPAY TABLE   **02470200
052523******************************************************************02470300
052523 4001-LOCATE-TEPPAY-ROW.                                          02470400
052523                                                                  02470500
052523     MOVE  TC009-STR-NBR          TO PV-STR-NBR.                  02470600
052523     MOVE  TC009-RGST-ID          TO PV-RGST-ID.                  02470800
052523     MOVE  TC009-TRN-NBR          TO PV-TRN-NBR.                  02470900
052523     MOVE  TC009-SLS-CORR-SEQ-NBR TO PV-SLS-CORR-SEQ-NBR.         02471000
052523     MOVE  TC009-STRT-TIME        TO PV-START-TIME.               02471200
052523                                                                  02471400
052523     EXEC SQL                                                     02471500
052523         UPDATE TEPPAY                                            02471600
052523             SET STTLMNT_PRCD_CDE   = :PC-LIT-P                   02471700
052523             WHERE PARTN_NBR        = :PV-PARTN-NBR               02471800
052523               AND STR_NBR          = :PV-STR-NBR                 02471900
052523               AND RGST_ID          = :PV-RGST-ID                 02472000
052523               AND TRN_NBR          = :PV-TRN-NBR                 02472100
052523               AND STRT_TM          = :PV-START-TIME              02472200
052523               AND SLS_CORR_SEQ_NBR = :PV-SLS-CORR-SEQ-NBR        02472300
052523     END-EXEC.                                                    02472500
052523                                                                  02472600
052523     EVALUATE TRUE                                                02472700
052523         WHEN SQLCODE = ZERO                                      02472800
052523             ADD   +1      TO PV-UPDATE-COUNTER-PAY               02473000
052523                              PV-COMMIT-COUNTER                   02473100
052523         WHEN SQLCODE = +100                                      02473200
052523             ADD       +1      TO PV-SQL100-COUNTER-PAY           02473500
052523             DISPLAY 'NOT FOUND FOR UPDATE'                       02473600
052523             DISPLAY 'PARTN_NBR: ' PV-PARTN-NBR                   02473700
052523             DISPLAY 'STR_NBR: ' PV-STR-NBR                       02473800
052523             DISPLAY 'RGST_ID: ' PV-RGST-ID                       02474000
052523             DISPLAY 'TRN_NBR: ' PV-TRN-NBR                       02474100
052523             DISPLAY 'STRT_TM: ' PV-START-TIME                    02474200
052523             DISPLAY 'SLS_CORR: ' PV-SLS-CORR-SEQ-NBR             02474300
052523         WHEN OTHER                                               02474800
052523             MOVE '4001-LOCATE-TEPPAY-ROW'                        02474901
052523                                        TO PV-PARAGRAPH-NAME      02475000
052523             MOVE 'TO LOCATE TEPPAY '                             02475100
052523                                        TO PV-DB2-ERROR-MSSG      02475200
052523             PERFORM 9400-DB2-ERROR                               02475300
052523     END-EVALUATE.                                                02475400
                                                                        02475500
052523******************************************************************02475600
052523**  UPDATE THE SETTLEMENT PROCESS CODE TO 'P' IN TEPCRD TABLE   **02475700
052523**  USING THE ORIGINAL STORE NUMBER FROM THE SETTLEMENT FILE    **02475800
052523******************************************************************02475900
052523 4010-UPD-CRD-ROW-ORIG-STR-NBR.                                   02476000
052523                                                                  02476100
052523     EXEC SQL                                                     02476200
052523         UPDATE TEPCRD                                            02476300
052523             SET STTLMNT_PRCD_CDE   = :PC-LIT-P                   02476400
052523             WHERE PARTN_NBR        = :PV-PARTN-NBR               02476500
052523               AND STR_NBR          = :PV-ORIG-STR-NBR            02476600
052523               AND RGST_ID          = :PV-RGST-ID                 02476700
052523               AND TRN_NBR          = :PV-TRN-NBR                 02476800
052523               AND STRT_TM          = :PV-START-TIME              02476900
052523               AND SLS_CORR_SEQ_NBR = :PV-SLS-CORR-SEQ-NBR        02477000
052523               AND TNDR_SEQ_NBR     = :PV-TNDR-SEQ-NBR            02477100
052523     END-EXEC.                                                    02477200
052523                                                                  02477300
052523     EVALUATE TRUE                                                02477400
052523         WHEN SQLCODE = ZERO                                      02477500
052523             MOVE 'Y' TO PV-EPCRD-FND-IND                         02477600
052523             ADD   +1      TO PV-UPDATE-COUNTER                   02477700
052523                              PV-COMMIT-COUNTER                   02477800
052523         WHEN SQLCODE = +100                                      02477900
052523             MOVE 'N' TO PV-EPCRD-FND-IND                         02478000
052523             EXEC SQL                                             02478100
052523                 SELECT 'Y'                                       02478200
052523                     ,STR_NBR                                     02478300
052523                 INTO :PV-EPCRD-FND-IND                           02478400
052523                     ,:PV-EPCRD-STR-NBR                           02478500
052523                 FROM TEPCRD                                      02478600
052523                 WHERE PARTN_NBR        = :PV-PARTN-NBR           02478700
052523                   AND RGST_ID          = :PV-RGST-ID             02478800
052523                   AND TRN_NBR          = :PV-TRN-NBR             02478900
052523                   AND STRT_TM          = :PV-START-TIME          02479000
052523                   AND SLS_CORR_SEQ_NBR = :PV-SLS-CORR-SEQ-NBR    02479100
052523                   AND TNDR_SEQ_NBR     = :PV-TNDR-SEQ-NBR        02479200
052523             END-EXEC                                             02479300
052523             IF PV-EPCRD-FND-IND = 'Y'                            02479400
052523                 MOVE PV-EPCRD-STR-NBR TO PV-STR-NBR              02479500
052523                 IF SQLCODE = PC-DUP-ROWS                         02479600
052523                     DISPLAY 'BELOW RECORD UPDATED '              02479700
052523                     DISPLAY 'PARTN_NBR: ' PV-PARTN-NBR           02479800
052523                     DISPLAY 'STR_NBR: ' PV-STR-NBR               02479900
052523                     DISPLAY 'ORIG_STR_NBR: ' PV-ORIG-STR-NBR     02480000
052523                     DISPLAY 'RGST_ID: ' PV-RGST-ID               02480100
052523                     DISPLAY 'TRN_NBR: ' PV-TRN-NBR               02480200
052523                     DISPLAY 'STRT_TM: ' PV-START-TIME            02480300
052523                     DISPLAY 'SLS_CORR: ' PV-SLS-CORR-SEQ-NBR     02480400
052523                     DISPLAY 'TNDR_SEQ: ' PV-TNDR-SEQ-NBR         02480500
052523                 END-IF                                           02480600
052523                 PERFORM 4001-UPDATE-TEPCRD-PROCESS-CDE           02480700
052523             ELSE                                                 02480800
052523                 ADD   +1      TO PV-SQL100-COUNTER               02480900
052523                 DISPLAY 'NOT FOUND FOR UPDATE2'                  02481000
052523                 DISPLAY 'PARTN_NBR: ' PV-PARTN-NBR               02481100
052523                 DISPLAY 'STR_NBR: ' PV-STR-NBR                   02481200
052523                 DISPLAY 'ORIG_STR_NBR: ' PV-ORIG-STR-NBR         02481300
052523                 DISPLAY 'RGST_ID: ' PV-RGST-ID                   02481400
052523                 DISPLAY 'TRN_NBR: ' PV-TRN-NBR                   02481500
052523                 DISPLAY 'STRT_TM: ' PV-START-TIME                02481600
052523                 DISPLAY 'SLS_CORR: ' PV-SLS-CORR-SEQ-NBR         02481700
052523                 DISPLAY 'TNDR_SEQ: ' PV-TNDR-SEQ-NBR             02481800
052523             END-IF                                               02481900
052523         WHEN OTHER                                               02482000
052523             MOVE '4010-UPD-CRD-ROW-ORIG-STR-N'                   02482100
052523                                        TO PV-PARAGRAPH-NAME      02482200
052523             MOVE 'TO LOCATE TEPCRD '                             02482300
052523                                        TO PV-DB2-ERROR-MSSG      02482400
052523             PERFORM 9400-DB2-ERROR                               02482500
052523     END-EVALUATE.                                                02482600
                                                                        02482700
060122******************************************************************02482800
060122**  UPDATE THE SETTLEMENT PROCESS CODE TO 'P' IN TEPCRD TABLE   **02482900
060122******************************************************************02483000
060122 4001-UPDATE-TEPCRD-PROCESS-CDE.                                  02483100
060122                                                                  02483200
060122     MOVE  TC009-RGST-ID          TO PV-RGST-ID.                  02483300
060122     MOVE  TC009-TRN-NBR          TO PV-TRN-NBR.                  02483400
060122     MOVE  TC009-SLS-CORR-SEQ-NBR TO PV-SLS-CORR-SEQ-NBR.         02483500
060122     MOVE  TC009-TNDR-SEQ-NBR     TO PV-TNDR-SEQ-NBR.             02483600
060122     MOVE  TC009-STRT-TIME        TO PV-START-TIME.               02483700
060122                                                                  02483800
060122     EXEC SQL                                                     02483900
060122         UPDATE TEPCRD                                            02484000
060122             SET STTLMNT_PRCD_CDE   = :PC-LIT-P                   02484100
060122             WHERE PARTN_NBR        = :PV-PARTN-NBR               02484200
060122               AND STR_NBR          = :PV-STR-NBR                 02484300
060122               AND RGST_ID          = :PV-RGST-ID                 02484400
060122               AND TRN_NBR          = :PV-TRN-NBR                 02484500
060122               AND STRT_TM          = :PV-START-TIME              02484600
060122               AND SLS_CORR_SEQ_NBR = :PV-SLS-CORR-SEQ-NBR        02484700
060122               AND TNDR_SEQ_NBR     = :PV-TNDR-SEQ-NBR            02484800
060122     END-EXEC.                                                    02484900
060122                                                                  02485000
060122     EVALUATE TRUE                                                02485100
060122         WHEN SQLCODE = ZERO                                      02485200
060122             ADD   +1      TO PV-UPDATE-COUNTER                   02485300
060122                              PV-COMMIT-COUNTER                   02485400
060122         WHEN SQLCODE = +100                                      02485500
060122             ADD   +1      TO PV-SQL100-COUNTER                   02485600
060122             DISPLAY 'NOT FOUND FOR UPDATE3'                      02485700
060122             DISPLAY 'PARTN_NBR: ' PV-PARTN-NBR                   02485800
060122             DISPLAY 'STR_NBR: ' PV-STR-NBR                       02485900
052523             DISPLAY 'ORIG_STR_NBR: ' PV-ORIG-STR-NBR             02486000
060122             DISPLAY 'RGST_ID: ' PV-RGST-ID                       02486100
060122             DISPLAY 'TRN_NBR: ' PV-TRN-NBR                       02486200
060122             DISPLAY 'STRT_TM: ' PV-START-TIME                    02486300
060122             DISPLAY 'SLS_CORR: ' PV-SLS-CORR-SEQ-NBR             02486400
060122             DISPLAY 'TNDR_SEQ: ' PV-TNDR-SEQ-NBR                 02486500
060122         WHEN OTHER                                               02486600
060122             MOVE '4001-UPDATE-TEPCRD-PROCESS-CDE'                02486700
060122                                        TO PV-PARAGRAPH-NAME      02486800
060122             MOVE 'TO UPDATE TEPCRD '                             02486900
060122                                        TO PV-DB2-ERROR-MSSG      02487000
060122             PERFORM 9400-DB2-ERROR                               02487100
060122     END-EVALUATE.                                                02487200
                                                                        02487300
      ***************************************************************** 02488000
      * COMMIT DB2 CHANGES                                            * 02490000
      ***************************************************************** 02500000
       8000-COMMIT.                                                     02510000
                                                                        02520000
           EXEC SQL                                                     02530000
               COMMIT                                                   02540000
           END-EXEC.                                                    02550000
                                                                        02560000
           EVALUATE TRUE                                                02570000
               WHEN SQLCODE = ZERO                                      02580000
                   CONTINUE                                             02590000
               WHEN SQLWARN0 NOT EQUAL SPACE                            02600000
               WHEN SQLCODE NOT EQUAL ZERO                              02610000
                   MOVE '8000-COMMIT'    TO PV-PARAGRAPH-NAME           02620000
                   MOVE 'TO COMMIT '     TO PV-DB2-ERROR-MSSG           02630000
                   PERFORM 9400-DB2-ERROR                               02640000
           END-EVALUATE.                                                02650000
                                                                        02660000
      ******************************************************************02670000
      *    DB2 ERROR                                                   *02680000
      *      PERFORMED ONLY VIA (                         )            *02690000
      *    FUNCTION: HANDLE DB2 ERRORS                                 *02700000
      ******************************************************************02710000
       9400-DB2-ERROR.                                                  02720000
                                                                        02730000
           DISPLAY PC-ABEND-MSSG  PC-CURRENT-PROGRAM-NAME.              02740000
           DISPLAY PC-DB-ERROR-PREFIX                                   02750000
           DISPLAY PC-DB-ATTEMPTING-MSSG PV-DB2-ERROR-MSSG.             02760000
           DISPLAY 'PARTITION: ' PV-PARTN-NBR.                          02770000
           DISPLAY 'STORE:     ' PV-STR-NBR.                            02780000
           DISPLAY 'REGISTER:  ' PV-RGST-ID.                            02790000
           DISPLAY 'TRANS:     ' PV-TRN-NBR.                            02800000
           DISPLAY 'STRTTM:    ' PV-START-TIME.                         02810000
           DISPLAY 'SLSCORRSEQ:' PV-SLS-CORR-SEQ-NBR.                   02811000
           DISPLAY 'TNDRSEQ:   ' PV-TNDR-SEQ-NBR.                       02812000
           COPY DPPD004.                                                02820000
           SET ABEND-4013-DB2-ERROR TO TRUE.                            02830000
           CALL 'ILBOABN0' USING ABEND-CODE.                            02840000
