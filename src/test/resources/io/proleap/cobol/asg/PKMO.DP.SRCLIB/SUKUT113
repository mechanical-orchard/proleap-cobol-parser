000100******************************************************************00010002
000200 IDENTIFICATION DIVISION.                                         00020002
000300 PROGRAM-ID.             SUKUT113.                                00030002
000400 AUTHOR.                 LYNN MCADAMS.                            00040002
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050002
000600 DATE-WRITTEN            SEPTEMBER, 2005.                         00060002
000700 DATE-COMPILED.                                                   00070002
000800*----------------------------------------------------------------*00080002
000900* THIS PROGRAM WILL EXTRACT DATA FOR THE DAILY - NOT SCANNED     *00090099
001000* DETAIL REPORT.                                                 *00100099
001100*                                                                *00110002
001200* THE LAYOUT FOR THE INPUT FILE IS SURD065.                      *00120002
001300* THE LAYOUT FOR THE OUTPUT FILE IS SURD066.                     *00130002
001400*----------------------------------------------------------------*00140002
001500 ENVIRONMENT DIVISION.                                            00150002
001600 INPUT-OUTPUT SECTION.                                            00160002
001700                                                                  00170002
001800 FILE-CONTROL.                                                    00180002
001900                                                                  00190002
002000     SELECT INPUT-FILE ASSIGN TO INP01.                           00200002
002100     SELECT EXTRACT-FILE ASSIGN TO OUT01.                         00210002
002200                                                                  00220002
002300***************************************************************** 00230002
002400 DATA DIVISION.                                                   00240002
002500 FILE SECTION.                                                    00250002
002600*                                                                 00260002
002700 FD  INPUT-FILE                                                   00270002
002800     RECORDING MODE IS F                                          00280002
002900     LABEL RECORDS ARE STANDARD                                   00290002
003000     BLOCK CONTAINS 0 RECORDS.                                    00300002
003100 01  INPUT-RECORD                PIC X(43).                       00310002
003200                                                                  00320002
003300 FD  EXTRACT-FILE                                                 00330002
003400     RECORDING MODE IS F                                          00340002
003500     LABEL RECORDS ARE STANDARD                                   00350002
003600     BLOCK CONTAINS 0 RECORDS.                                    00360002
003700 01  EXTRACT-RECORD              PIC X(600).                      00370002
003800*                                                                 00380002
003900***************************************************************** 00390002
004000 WORKING-STORAGE SECTION.                                         00400002
004100                                                                  00410002
004200 01  PS-PROGRAM-SWITCHES.                                         00420002
004300     05  PS-END-OF-INPUT-FILE-SW        PIC X(01)  VALUE 'N'.     00430002
004400         88  PS-END-OF-INPUT-FILE                  VALUE 'Y'.     00440002
004500         88  PS-NOT-END-OF-INPUT-FILE              VALUE 'N'.     00450002
004600                                                                  00460002
004700     05  PS-VALID-DC-SW                 PIC X(01)  VALUE 'N'.     00470076
004800         88  PS-VALID-DC                           VALUE 'Y'.     00480076
004900         88  PS-NOT-VALID-DC                       VALUE 'N'.     00490076
005000                                                                  00500073
005100     05  PS-END-CARTON-CNT-SMO-CSR-SW   PIC X(01)  VALUE 'N'.     00510070
005200         88  PS-END-CARTON-CNT-SMO-CSR-YES         VALUE 'Y'.     00520070
005300         88  PS-END-CARTON-CNT-SMO-CSR-NO          VALUE 'N'.     00530070
005400                                                                  00540012
005500     05  PS-END-CARTON-CNT-CPS-CSR-SW      PIC X(01) VALUE 'N'.   00550070
005600         88  PS-END-CARTON-CNT-CPS-CSR-YES           VALUE 'Y'.   00560070
005700         88  PS-END-CARTON-CNT-CPS-CSR-NO            VALUE 'N'.   00570070
005800                                                                  00580010
005900     05  PS-END-MIXED-SKU-BCS-CSR-SW         PIC X(01) VALUE 'N'. 00590023
006000         88  PS-END-MIXED-SKU-BCS-CSR-YES              VALUE 'Y'. 00600023
006100         88  PS-END-MIXED-SKU-BCS-CSR-NO               VALUE 'N'. 00610023
006200                                                                  00620002
006300                                                                  00630002
006400 01  ABEND-CODE                       PIC S9(04) VALUE ZERO       00640002
006500                                                 COMP SYNC.       00650002
006600     88  ABEND-4013-DB2-ERROR                    VALUE +4013.     00660002
006700                                                                  00670002
006800 01  PV-PROGRAM-VARIABLES.                                        00680002
006900                                                                  00690006
007000     05  PV-TRN-NBR                   PIC S9(09) COMP.            00700022
007100     05  PV-RCVR-SEQ-NBR              PIC S9(09) COMP.            00710022
007200                                                                  00720019
007300     05  PV-MX-SK                     PIC X(01) VALUE SPACES.     00730099
007400     05  PV-MX-SKU-BCS-CSR-FETCH      PIC S9(09) COMP-3           00740060
007500                                              VALUE ZERO.         00750060
007600                                                                  00760022
007700     05  PV-SHFT-TMST                 PIC  X(26)  VALUE SPACES.   00770049
007800     05  PV-SHIFT-TIME                   PIC  X(08)  VALUE SPACES.00780006
007900     05  PV-SHIFT-TIME-R REDEFINES PV-SHIFT-TIME.                 00790006
008000         10  PV-SHFT-HH                  PIC  9(02).              00800006
008100         10  PV-PERIOD-1                 PIC  X(01).              00810006
008200         10  PV-SHFT-MN                  PIC  9(02).              00820006
008300         10  PV-PERIOD-2                 PIC  X(01).              00830006
008400         10  PV-SHFT-SS                  PIC  9(02).              00840006
008500                                                                  00850006
008600     05  PV-TMST                      PIC  X(26)  VALUE SPACES.   00860045
008700     05  PV-TMST-R REDEFINES PV-TMST.                             00870039
008800         10  PV-TMST-DATE.                                        00880006
008900             15  PV-TMST-CC                  PIC  9(02).          00890006
009000             15  PV-TMST-YY                  PIC  9(02).          00900006
009100             15  FILLER                      PIC  X(01).          00910034
009200             15  PV-TMST-MM                  PIC  9(02).          00920006
009300             15  FILLER                      PIC  X(01).          00930034
009400             15  PV-TMST-DD                  PIC  9(02).          00940006
009500         10  PV-TMST-DASH                    PIC  X(01).          00950043
009600         10  PV-TMST-TIME.                                        00960006
009700             15  PV-TMST-HH                  PIC  9(02).          00970006
009800             15  FILLER                      PIC  X(01).          00980006
009900             15  PV-TMST-MN                  PIC  9(02).          00990006
010000             15  FILLER                      PIC  X(01).          01000006
010100             15  PV-TMST-SS                  PIC  9(02).          01010006
010200         10  PV-TMST-PERIOD                  PIC  X(01).          01020045
010300         10  PV-TMST-MS                      PIC  X(06).          01030045
010400                                                                  01040045
010500     05  PV-PREV-LOC-NBR              PIC S9(04) VALUE ZEROES.    01050073
010600                                                                  01060002
010700     05  PV-CARTON-CNT-SMO            PIC S9(09) VALUE ZERO       01070070
010800                                                  COMP SYNC.      01080002
010900     05  PV-CARTON-CNT-CPS            PIC S9(09) VALUE ZERO       01090070
011000                                                  COMP SYNC.      01100009
011100     05  PV-DISTHD-P2L                PIC S9(9) COMP.             01110099
011200                                                                  01120099
011300     05  PV-ASN-PROD-COUNT            PIC S9(09) VALUE ZERO       01130009
011400                                                  COMP SYNC.      01140009
011500     05  PV-CRTN-DATA-COUNT           PIC S9(09) VALUE ZERO       01150009
011600                                                  COMP SYNC.      01160009
011700     05  PV-BCS-MX-SKU-CNT            PIC S9(09) VALUE ZERO       01170091
011800                                                  COMP SYNC.      01180016
011900     05  PV-READ-COUNT                PIC S9(09) VALUE ZERO       01190008
012000                                                  COMP SYNC.      01200008
012100     05  PV-WRITE-EXTR-COUNT          PIC S9(09) VALUE ZERO       01210008
012200                                                  COMP SYNC.      01220008
012300                                                                  01230008
012400     05  PV-DISPLAY-READ-CNT          PIC ZZZ,ZZZ,ZZ9.            01240008
012500     05  PV-DISPLAY-WRITE-CNT         PIC ZZZ,ZZZ,ZZ9.            01250008
012600                                                                  01260008
012700     05  PV-DISPLAY-TRN-NBR           PIC Z(9)-.                  01270008
012800     05  PV-DISPLAY-RCVR-SEQ-NBR      PIC Z(9)-.                  01280008
012900     05  PV-DISPLAY-TRN-LNE-NBR       PIC Z(9)-.                  01290008
013000     05  PV-DISPLAY-OPER-UNT-ID       PIC Z(9)-.                  01300008
013100     05  PV-DISPLAY-UPC-NBR           PIC Z(9)-.                  01310008
013200     05  PV-DISPLAY-ENT-ID            PIC Z(9)-.                  01320009
013300     05  PV-DISPLAY-PKSL-SEQ-NBR      PIC Z(9)-.                  01330016
013400     05  PV-DISPLAY-CART-COMB-NBR     PIC Z(9)-.                  01340016
013500     05  PV-DISPLAY-PREPK-ID          PIC Z(9)-.                  01350016
013600     05  PV-DISPLAY-USER-ID           PIC Z(9)-.                  01360022
013700     05  PV-DISPLAY-BCS-FETCH-CNT     PIC Z(9)-.                  01370061
013800     05  PV-DB2-CURRENT-TIMESTAMP     PIC X(26)  VALUE SPACE.     01380022
013900     05  PV-DB2-FUNCTION              PIC X(30)  VALUE SPACE.     01390022
014000     05  PV-DB2-TABLE-NAME1           PIC X(08)  VALUE SPACE.     01400022
014100     05  PV-DB2-TABLE-NAME2           PIC X(08)  VALUE SPACE.     01410022
014200     05  PV-DB2-TABLE-NAME3           PIC X(08)  VALUE SPACE.     01420022
014300                                                                  01430022
014400     05  PV-RETAIL-AMOUNT             PIC S9(09)V99 VALUE ZERO    01440022
014500                                                  COMP SYNC.      01450022
014600     05  PV-CURRENT-DATE              PIC X(10) VALUE SPACE.      01460022
014700                                                                  01470022
014800 01  DK-DB2-KEYS.                                                 01480030
014900     05  DK-OPER-UNT-ID             PIC S9(4) COMP VALUE ZERO.    01490031
015000     05  DK-TRN-NBR                 PIC S9(9) COMP VALUE ZERO.    01500031
015100     05  DK-RCVR-SEQ-NBR            PIC S9(9) COMP VALUE ZERO.    01510030
015200     05  DK-LOC-NBR                 PIC S9(4) COMP VALUE ZERO.    01520030
015300     05  DK-TRN-LNE-NBR             PIC S9(9) COMP VALUE ZERO.    01530030
015400                                                                  01540030
015500 01 PC-PROGRAM-CONSTANTS.                                         01550022
015600     05 PC-PROGRAM-NAME              PIC X(08)  VALUE 'SUKUT113'. 01560022
015700     05 PC-DEFAULT-TMST              PIC X(26)                    01570022
015800             VALUE '9999-09-09-09.09.09.999999'.                  01580022
015900     05 PC-INACTV-DTE                PIC X(10)                    01590022
016000             VALUE '9999-09-09'.                                  01600022
016100     05 PC-01                       PIC  X(01)  VALUE '1'.        01610022
016200     05 PC-DASH                     PIC  X(01)  VALUE '-'.        01620043
016300     05 PC-PERIOD                   PIC  X(01)  VALUE '.'.        01630045
016400     05 PC-MS                       PIC  X(06)  VALUE '999999'.   01640045
016500                                                                  01650022
016600 01  PV-ABEND-FIELDS.                                             01660022
016700     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         01670022
016800                                                 COMP SYNC.       01680022
016900     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'SUKUT113'.01690022
017000     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01700022
017100     05  PV-ABEND-OPERATION           PIC  X(51) VALUE SPACES.    01710022
017200     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30) VALUE SPACES.    01720022
017300     05  PV-DISPLAY-SQLCODE           PIC -9(05) VALUE ZEROES.    01730022
017400     05  PV-SQL-RETURN-CD             PIC  999-.                  01740022
017500     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01750022
017600     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01760022
017700     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01770022
017800     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01780022
017900                                                                  01790022
018000******************************************************************01800022
018100*  USED FOR DB2 ERROR MESSAGE BUILDING                            01810022
018200******************************************************************01820022
018300     COPY DPWS004.                                                01830022
018400                                                                  01840022
018500*----------------------------------------------------------------*01850022
018600*    ABEND PROCESSING COPYBOOK.                                  *01860022
018700*----------------------------------------------------------------*01870022
018800     COPY DPWS013.                                                01880022
018900                                                                  01890022
019000******************************************************************01900022
019100*   DB2 SQL COMMUNICATION AREA                                    01910022
019200******************************************************************01920022
019300     EXEC SQL                                                     01930022
019400          INCLUDE SQLCA                                           01940022
019500     END-EXEC.                                                    01950022
019600                                                                  01960022
019700*DB2 AREA FOR COMMUNICATIONS AREA2                                01970022
019800     COPY SQLCA2.                                                 01980022
019900                                                                  01990022
020000******************************************************************02000022
020100*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   02010022
020200*   RC-TROUBLE NOTIFICATION TABLE                                 02020022
020300******************************************************************02030022
020400     EXEC SQL                                                     02040022
020500          INCLUDE TTRBNTF                                         02050022
020600     END-EXEC.                                                    02060022
020700                                                                  02070022
020800******************************************************************02080022
020900*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   02090022
021000*   RC-TROUBLE DETAIL TABLE                                       02100022
021100******************************************************************02110022
021200     EXEC SQL                                                     02120022
021300          INCLUDE TTRBDTL                                         02130022
021400     END-EXEC.                                                    02140022
021500                                                                  02150022
021600******************************************************************02160022
021700*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   02170022
021800*   RC - KOHLS TO RETEK PROCESSING PARAMETERS TABLE               02180022
021900******************************************************************02190022
022000     EXEC SQL                                                     02200022
022100          INCLUDE TKRPRPM                                         02210022
022200     END-EXEC.                                                    02220022
022300                                                                  02230022
022400******************************************************************02240022
022500*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   02250022
022600*   PC - SHIFT TABLE                                              02260022
022700*   PCT_SHFT                                                      02270022
022800******************************************************************02280022
022900     EXEC SQL                                                     02290022
023000          INCLUDE PCT00004                                        02300022
023100     END-EXEC.                                                    02310022
023200                                                                  02320022
023300******************************************************************02330022
023400*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   02340022
023500*   PO-PURCHASE TABLE                                             02350022
023600******************************************************************02360022
023700     EXEC SQL                                                     02370022
023800          INCLUDE TPURCHS                                         02380022
023900     END-EXEC.                                                    02390022
024000                                                                  02400022
024100******************************************************************02410022
024200*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   02420022
024300*   RC-RECEIVER TABLE                                             02430022
024400******************************************************************02440022
024500     EXEC SQL                                                     02450022
024600          INCLUDE TRECEIV                                         02460022
024700     END-EXEC.                                                    02470022
024800                                                                  02480022
024900******************************************************************02490022
025000*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   02500022
025100*   SU-SHIPMENT UNIT TABLE                                        02510022
025200*   SUT_OTBND_CART                                                02520022
025300******************************************************************02530022
025400     EXEC SQL                                                     02540022
025500          INCLUDE SUT00024                                        02550022
025600     END-EXEC.                                                    02560022
025700                                                                  02570022
025800******************************************************************02580022
025900*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   02590022
026000*   SU-SHIPMENT UNIT/UPC ASSOCIATION TABLE                        02600022
026100*   SUT_OTBND_UPC                                                 02610022
026200******************************************************************02620022
026300     EXEC SQL                                                     02630022
026400          INCLUDE SUT00028                                        02640022
026500     END-EXEC.                                                    02650022
026600                                                                  02660022
026700******************************************************************02670022
026800*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   02680022
026900*   RC-COMPANY CONTROL TABLE                                      02690022
027000******************************************************************02700022
027100     EXEC SQL                                                     02710022
027200          INCLUDE TCOCNTL                                         02720022
027300     END-EXEC.                                                    02730022
027400                                                                  02740022
027500******************************************************************02750022
027600*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   02760022
027700*   EX-EXTERNAL ENTERPRISE NAME TABLE                             02770022
027800******************************************************************02780022
027900     EXEC SQL                                                     02790022
028000          INCLUDE TENTNME                                         02800022
028100     END-EXEC.                                                    02810022
028200                                                                  02820022
028300******************************************************************02830022
028400*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   02840022
028500*   EX-EXTERNAL ENTERPRISE TABLE                                  02850022
028600******************************************************************02860022
028700     EXEC SQL                                                     02870022
028800          INCLUDE TEXTENT                                         02880022
028900     END-EXEC.                                                    02890022
029000                                                                  02900022
029100******************************************************************02910099
029200*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   02920099
029300*   TR- CONTAINER/PO TRACKING TABLE                               02930099
029400******************************************************************02940099
029500     EXEC SQL                                                     02950099
029600          INCLUDE TIMCNRL                                         02960099
029700     END-EXEC.                                                    02970099
029800                                                                  02980099
029900******************************************************************02990022
030000*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   03000022
030100*   ET-TRADING PARTNERSHIP TABLE                                  03010022
030200******************************************************************03020022
030300     EXEC SQL                                                     03030022
030400          INCLUDE TTRDPRT                                         03040022
030500     END-EXEC.                                                    03050022
030600                                                                  03060022
030700******************************************************************03070022
030800*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   03080022
030900*   ET-TRADING PARTNER TRANSACTION SET TABLE                      03090022
031000******************************************************************03100022
031100     EXEC SQL                                                     03110022
031200          INCLUDE TTRDTRN                                         03120022
031300     END-EXEC.                                                    03130022
031400                                                                  03140022
031500******************************************************************03150022
031600*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   03160022
031700*   RC-PACK SLIP TABLE                                            03170022
031800******************************************************************03180022
031900     EXEC SQL                                                     03190022
032000          INCLUDE TPKSLIP                                         03200022
032100     END-EXEC.                                                    03210022
032200                                                                  03220022
032300******************************************************************03230022
032400*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   03240022
032500*   SU-INBOUND EDI PACKLIST/VENDOR SHIPMENT UNIT ASSOCIATION TABLE03250022
032600******************************************************************03260022
032700     EXEC SQL                                                     03270022
032800          INCLUDE TINPKSU                                         03280022
032900     END-EXEC.                                                    03290022
033000                                                                  03300022
033100******************************************************************03310022
033200*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   03320022
033300*   PURCHASE ORDER AUDIT REQUEST TABLE                            03330022
033400*   SUT_PO_AUD_REQ                                                03340022
033500******************************************************************03350022
033600     EXEC SQL                                                     03360022
033700          INCLUDE SUT00015                                        03370022
033800     END-EXEC.                                                    03380022
033900                                                                  03390022
034000******************************************************************03400022
034100*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   03410022
034200*   SU  - ASN RECEIVER PACKSLIPS TABLE                            03420022
034300******************************************************************03430022
034400     EXEC SQL                                                     03440022
034500          INCLUDE TSHPSUM                                         03450022
034600     END-EXEC.                                                    03460022
034700                                                                  03470022
034800******************************************************************03480022
034900*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   03490022
035000*   RC-RECEIPT ITEM TABLE                                         03500022
035100******************************************************************03510022
035200     EXEC SQL                                                     03520022
035300          INCLUDE TRECITM                                         03530022
035400     END-EXEC.                                                    03540022
035500                                                                  03550022
035600******************************************************************03560074
035700*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   03570074
035800*   LOGISTICS LOCATION TABLE                                      03580074
035900*   XLT_LOC TABLE                                                 03590074
036000******************************************************************03600074
036100     EXEC SQL                                                     03610074
036200          INCLUDE XLT00010                                        03620074
036300     END-EXEC.                                                    03630074
036400                                                                  03640074
036500     EXEC SQL                                                     03650099
036600          INCLUDE TDISTHD                                         03660099
036700     END-EXEC.                                                    03670099
036800*                                                                 03680099
036900                                                                  03690022
037000******************************************************************03700022
037100* RETRIEVES CARTON COUNT FOR A GIVEN DC, PO AND RCVR              03710022
037200********** FOR PBS ORDERS *********                               03720022
037300******************************************************************03730022
037400     EXEC SQL                                                     03740022
037500          DECLARE CARTON-CNT-SMO-CSR CURSOR FOR                   03750070
037600      SELECT COUNT(DISTINCT(A.SHIPT_UNT_ID))                      03760022
037700        FROM SUT_OTBND_UPC    A                                   03770022
037800           , SUT_OTBND_CART   B                                   03780022
037900       WHERE A.TRN_NBR        = :DK-TRN-NBR                       03790029
038000         AND A.RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR                  03800029
038100         AND A.SHIPT_UNT_ID   = B.SHIPT_UNT_ID                    03810022
038200         AND B.CART_SRC_CDE   = 'SMO'                             03820022
038300         AND B.ACTV_IND       = 'Y'                               03830022
038400         AND B.ORGN_LOC_NBR   = :DK-LOC-NBR                       03840029
038500     END-EXEC.                                                    03850022
038600                                                                  03860022
038700******************************************************************03870022
038800* RETRIEVES CARTON COUNT FOR A GIVEN DC, PO AND RCVR              03880022
038900********** FOR NON-PBS ORDERS *********                           03890022
039000******************************************************************03900022
039100     EXEC SQL                                                     03910022
039200          DECLARE CARTON-CNT-CPS-CSR CURSOR FOR                   03920070
039300      SELECT COUNT(DISTINCT(A.SHIPT_UNT_ID))                      03930022
039400        FROM SUT_OTBND_UPC    A                                   03940022
039500           , SUT_OTBND_CART   B                                   03950022
039600       WHERE A.TRN_NBR        = :DK-TRN-NBR                       03960029
039700         AND A.RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR                  03970029
039800         AND A.SHIPT_UNT_ID   = B.SHIPT_UNT_ID                    03980022
039900         AND B.CART_SRC_CDE   = 'CPS'                             03990022
040000         AND B.ACTV_IND       = 'Y'                               04000022
040100         AND B.ORGN_LOC_NBR   = :DK-LOC-NBR                       04010029
040200     END-EXEC.                                                    04020022
040300                                                                  04030022
040400******************************************************************04040022
040500* CHECKS TO SEE IF MIXED SKU CARTONS FOR GIVEN PO/RCVR.           04050022
040600********** FOR BULK(B), CASEPACK(C) OR SINGLE(S) TYPE ORDERS******04060091
040700******************************************************************04070022
040800     EXEC SQL                                                     04080022
040900          DECLARE MIXED-SKU-BCS-CSR CURSOR FOR                    04090023
041000      SELECT B.PO_NBR                                             04100022
041100           , B.PKSL_SEQ_NBR                                       04110022
041200           , B.CART_COMB_NBR                                      04120022
041300           , B.PO_LNE_NBR                                         04130022
041400           , B.TOT_CART_CNT                                       04140022
041500           , B.OTPK_UNT_QTY                                       04150022
041600        FROM TPKSLIP          A                                   04160022
041700           , TSHPSUM          B                                   04170022
041800       WHERE A.OPER_UNT_ID    = :DK-LOC-NBR                       04180029
041900         AND A.PO_NBR         = :DK-TRN-NBR                       04190029
042000         AND A.REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR                  04200029
042100         AND A.VER_STAT_CDE   = 'A'                               04210022
042200         AND B.PO_NBR         = A.PO_NBR                          04220022
042300         AND B.PKSL_SEQ_NBR   = A.SEQ_NBR                         04230022
042400         AND B.PO_LNE_NBR     = :DK-TRN-LNE-NBR                   04240029
042500    ORDER BY B.CART_COMB_NBR                                      04250022
042600     END-EXEC.                                                    04260022
042700                                                                  04270022
042800                                                                  04280022
042900******************************************************************04290022
043000*  RECORD LAYOUTS FOR THE DAILY - NOT SCANNED DETAIL REPORT       04300099
043100*  EXTRACT.                                                       04310022
043200***********************************************************       04320022
043300*INPUT FILE LAYOUT                                                04330022
043400     COPY SURD065.                                                04340022
043500*OUTPUT FILE LAYOUT                                               04350022
043600     COPY SURD066.                                                04360022
043700                                                                  04370022
043800******************************************************************04380022
043900*  COPYBOOK FOR USER MODULE.                                      04390022
044000******************************************************************04400022
044100     COPY XLWS067.                                                04410022
044200*                                                                 04420022
044300***********************************************************       04430022
044400 PROCEDURE DIVISION.                                              04440022
044500***********************************************************       04450022
044600     DISPLAY '***BEGINNING SUKUT113***'.                          04460022
044700                                                                  04470022
044800     PERFORM 1000-INITIALIZE.                                     04480022
044900                                                                  04490063
045000     PERFORM 7000-READ-INPUT-FILE.                                04500062
045100                                                                  04510062
045200     IF PS-END-OF-INPUT-FILE                                      04520063
045300         DISPLAY SPACES                                           04530063
045400         DISPLAY ALL '*'                                          04540063
045500         DISPLAY '  INPUT FILE IS EMPTY '                         04550063
045600         DISPLAY ALL '*'                                          04560063
045700         DISPLAY SPACES                                           04570063
045800     ELSE                                                         04580063
045900         PERFORM 2000-PROCESS-EXTRACTS                            04590076
046000             UNTIL PS-END-OF-INPUT-FILE                           04600076
046100     END-IF.                                                      04610063
046200                                                                  04620063
046300     PERFORM 9000-CLOSE-FILES.                                    04630022
046400                                                                  04640022
046500     GOBACK.                                                      04650022
046600                                                                  04660022
046700                                                                  04670022
046800******************************************************************04680022
046900*  DO FIRST TIME PROGRAM INITIALIZE TASKS.                        04690022
047000 1000-INITIALIZE.                                                 04700022
047100******************************************************************04710022
047200     INITIALIZE SU066-RECORD.                                     04720022
047300                                                                  04730022
047400     MOVE 0 TO PV-TRN-NBR.                                        04740022
047500     MOVE 0 TO PV-RCVR-SEQ-NBR.                                   04750022
047600                                                                  04760099
047700     OPEN INPUT  INPUT-FILE                                       04770022
047800          OUTPUT EXTRACT-FILE.                                    04780022
047900                                                                  04790022
048000     PERFORM 1100-SELECT-DATE.                                    04800099
048100                                                                  04810099
048200******************************************************************04820099
048300 1100-SELECT-DATE.                                                04830099
048400******************************************************************04840099
048500     EXEC SQL                                                     04850099
048600         SELECT BTCH_PRC_DTE                                      04860099
048700         INTO  :COCNTL-BTCH-PRC-DTE                               04870099
048800         FROM TCOCNTL                                             04880099
048900         WHERE OPER_UNT_ID   = 90                                 04890099
049000     END-EXEC.                                                    04900099
049100     EVALUATE TRUE                                                04910099
049200         WHEN SQLCODE = +0                                        04920099
049300         WHEN SQLCODE = +100                                      04930099
049400             CONTINUE                                             04940099
049500         WHEN SQLCODE < ZERO                                      04950099
049600         WHEN SQLCODE > ZERO                                      04960099
049700         WHEN SQLWARN0 NOT = SPACE                                04970099
049800             MOVE '1100-SELECT-DATE'                              04980099
049900                                      TO PV-ABEND-PARAGRAPH       04990099
050000             MOVE 'SELECT'            TO PV-DB2-FUNCTION          05000099
050100             PERFORM Z999-SQL-ERROR                               05010099
050200     END-EVALUATE.                                                05020099
050300                                                                  05030099
050400******************************************************************05040073
050500 1500-CHECK-DC.                                                   05050073
050600******************************************************************05060073
050700         MOVE SU065-LOC-NBR TO DK-LOC-NBR                         05070075
050800                                                                  05080073
050900         EXEC SQL                                                 05090073
051000           SELECT LOC_NBR                                         05100073
051100             INTO :XLT00010-LOC-NBR                               05110073
051200             FROM XLT_LOC                                         05120073
051300            WHERE LOC_NBR     = :DK-LOC-NBR                       05130073
051400              AND LOC_TYP_CDE = 'DC'                              05140073
051500*INCL ECOMM   AND E_BUS_IND   = 'N'                               05150099
051600              AND (OPN_DTE  = CURRENT DATE                        05160073
051700               OR  OPN_DTE  < CURRENT DATE)                       05170073
051800              AND  CLO_DTE  = '9999-09-09'                        05180073
051900         END-EXEC                                                 05190073
052000                                                                  05200073
052100         EVALUATE TRUE                                            05210073
052200             WHEN SQLCODE = +0                                    05220073
052300                  SET PS-VALID-DC TO TRUE                         05230076
052400             WHEN SQLCODE = +100                                  05240073
052500                  SET PS-NOT-VALID-DC TO TRUE                     05250076
052600             WHEN SQLWARN0 NOT = SPACE                            05260073
052700             WHEN SQLCODE  NOT = +0                               05270073
052800                  MOVE '1500-CHECK-DC'                            05280073
052900                                       TO PV-ABEND-PARAGRAPH      05290073
053000                  MOVE 'ATTEMPTING TO SELECT XLT_LOC'             05300073
053100                                       TO PV-ABEND-OPERATION      05310073
053200                  MOVE DK-LOC-NBR      TO                         05320073
053300                                    PV-DISPLAY-OPER-UNT-ID        05330073
053400                  PERFORM Z999-SQL-ERROR                          05340073
053500         END-EVALUATE.                                            05350073
053600                                                                  05360073
053700***************************************************************** 05370022
053800 2000-PROCESS-EXTRACTS.                                           05380022
053900***************************************************************** 05390022
054000     MOVE '2000-PROCESS-EXTRACTS   ' TO PV-ABEND-PARAGRAPH.       05400022
054100                                                                  05410022
054200     IF SU065-LOC-NBR = PV-PREV-LOC-NBR                           05420076
054300        CONTINUE                                                  05430076
054400     ELSE                                                         05440076
054500        PERFORM 1500-CHECK-DC                                     05450076
054600     END-IF                                                       05460076
054700                                                                  05470076
054800     IF PS-VALID-DC                                               05480076
054900        MOVE SU065-CRE-DTE         TO SU066-DATE                  05490076
055000        MOVE SU065-CART-SRC-CDE    TO SU066-CART-SRC-CDE          05500076
055100        MOVE SU065-CRE-DTE         TO SU066-CRE-DTE               05510076
055200        MOVE SU065-CRE-TM          TO SU066-CRE-TM                05520076
055300        MOVE SU065-CRE-USR-ID      TO SU066-CRE-USR-ID            05530076
055400        MOVE SU065-TRN-NBR         TO SU066-PO-NBR                05540076
055500        MOVE SU065-RCVR-SEQ-NBR    TO SU066-REC-SEQ-NBR           05550076
055600        MOVE SU065-TRN-LNE-NBR     TO SU066-TRN-LNE-NBR           05560099
055700                                                                  05570076
055800        PERFORM 3100-GET-FREEFORM-TEXT                            05580076
055900                                                                  05590076
056000        PERFORM 3200-GET-TKRPRPM                                  05600076
056100                                                                  05610076
056200        PERFORM 3300-GET-SHIFT                                    05620076
056300                                                                  05630076
056400        PERFORM 3400-GET-USER-NAME                                05640099
056500                                                                  05650076
056600        PERFORM 3500-GET-PO-DATA                                  05660076
056700                                                                  05670076
056800        PERFORM 3600-GET-PKGNG-CDE                                05680076
056900                                                                  05690076
057000        PERFORM 3700-GET-CARTON-CNT                               05700076
057100                                                                  05710076
057200        PERFORM 3800-GET-VENDOR-NAME                              05720076
057300                                                                  05730076
057400        PERFORM 3900-GET-SCAC-CDE                                 05740076
057500                                                                  05750076
057600        PERFORM 4100-CHECK-ASN-PROD                               05760076
057700                                                                  05770076
057800        IF PV-ASN-PROD-COUNT > 0                                  05780076
057900           MOVE 'Y'         TO SU066-VND-ASN-PRD-SW               05790076
058000        ELSE                                                      05800076
058100           IF EXTENT-ASN-TRSCP-IND = 'P'                          05810076
058200              MOVE 'Y'      TO SU066-VND-ASN-PRD-SW               05820076
058300           ELSE                                                   05830076
058400              MOVE ' '      TO SU066-VND-ASN-PRD-SW               05840076
058500           END-IF                                                 05850076
058600        END-IF                                                    05860076
058700                                                                  05870076
058800        PERFORM 4200-CHECK-CARTON-DATA                            05880076
058900        IF PV-CRTN-DATA-COUNT > 0                                 05890076
059000           MOVE 'Y'     TO SU066-ASN-CTN-DAT-SW                   05900076
059100        ELSE                                                      05910076
059200           MOVE ' '     TO SU066-ASN-CTN-DAT-SW                   05920076
059300        END-IF                                                    05930076
059400                                                                  05940076
059500        PERFORM 4300-CHECK-IF-PRMPT-QC-AUDIT                      05950076
059600                                                                  05960076
059700        PERFORM 4400-CHECK-MX-SKU-CARTONS                         05970076
059800                                                                  05980076
059900        PERFORM 8000-WRITE-EXTRACT                                05990076
060000                                                                  06000077
060100        MOVE SU065-TRN-NBR        TO PV-TRN-NBR                   06010077
060200        MOVE SU065-RCVR-SEQ-NBR   TO PV-RCVR-SEQ-NBR              06020077
060300     ELSE                                                         06030076
060400        CONTINUE                                                  06040076
060500     END-IF                                                       06050076
060600                                                                  06060076
060700     MOVE SU065-LOC-NBR   TO PV-PREV-LOC-NBR                      06070073
060800                                                                  06080076
060900*READ NEXT INPUT REC                                              06090076
061000     PERFORM 7000-READ-INPUT-FILE.                                06100022
061100                                                                  06110076
061200***************************************************************** 06120062
061300 2200-PROCESS-MX-SKU-BCS-CSR.                                     06130060
061400***************************************************************** 06140062
061500                                                                  06150060
061600        PERFORM 4600-GET-BCS-MX-SKU-CNT                           06160091
061700                                                                  06170060
061800        IF PV-BCS-MX-SKU-CNT > 0                                  06180091
061900           MOVE 'Y' TO PV-MX-SK                                   06190099
062000        END-IF.                                                   06200060
062100                                                                  06210060
062200***************************************************************** 06220022
062300** RETRIEVES 802 TROUBLE (REC DC COMMENTS) FOR PO/RCVR            06230099
062400 3100-GET-FREEFORM-TEXT.                                          06240060
062500***************************************************************** 06250022
062600     MOVE SU065-LOC-NBR      TO DK-OPER-UNT-ID                    06260099
062700     MOVE SU065-TRN-NBR      TO DK-TRN-NBR                        06270099
062800     MOVE SU065-RCVR-SEQ-NBR TO DK-RCVR-SEQ-NBR                   06280099
062900                                                                  06290031
063000     IF (SU065-TRN-NBR NOT = PV-TRN-NBR)                          06300022
063100        OR (SU065-RCVR-SEQ-NBR NOT = PV-RCVR-SEQ-NBR)             06310022
063200                                                                  06320094
063300         EXEC SQL                                                 06330099
063400           SELECT MIN (A.NOTIF_NBR)                               06340099
063500                , A.TRBL_RSN_CDE                                  06350099
063600                , B.FREEFORM_TEXT                                 06360099
063700             INTO :TRBNTF-NOTIF-NBR                               06370099
063800                , :TRBNTF-TRBL-RSN-CDE                            06380099
063900                , :TRBDTL-FREEFORM-TEXT                           06390099
064000             FROM TTRBNTF A                                       06400099
064100                , TTRBDTL B                                       06410099
064200            WHERE A.OPER_UNT_ID  = :DK-OPER-UNT-ID                06420099
064300              AND A.PO_NBR       = :DK-TRN-NBR                    06430099
064400              AND A.REC_SEQ_NBR  = :DK-RCVR-SEQ-NBR               06440099
064500              AND A.NOTIF_NBR    = B.NOTIF_NBR                    06450099
064600              AND A.TRBL_RSN_CDE = 802                            06460099
064700              AND (B.FREEFORM_TEXT > ' ')                         06470099
064800              AND B.FREEFORM_TEXT <> ('***PRE-RECEIVED***')       06480099
064900           GROUP BY A.NOTIF_NBR                                   06490099
065000                  , A.TRBL_RSN_CDE                                06500099
065100                  , B.FREEFORM_TEXT                               06510099
065200         END-EXEC                                                 06520099
065300                                                                  06530099
065400         EVALUATE TRUE                                            06540094
065500             WHEN SQLCODE = +0                                    06550094
065600                  MOVE 'N'         TO SU066-DC-COMMENT-MTPL-IND   06560099
065700                  MOVE 'Y'         TO SU066-TRBL-EXIST            06570099
065800                  MOVE TRBDTL-FREEFORM-TEXT-TEXT (1:20)           06580099
065900                                   TO SU066-FREEFORM-TEXT         06590099
066000                  MOVE TRBNTF-TRBL-RSN-CDE                        06600099
066100                                   TO SU066-TRBL-RSN-CDE          06610099
066200                  MOVE SPACES                                     06620099
066300                                   TO SU066-TRBL-SHT-DESC         06630099
066400             WHEN SQLCODE = -811                                  06640094
066500                  MOVE 'Y'         TO SU066-DC-COMMENT-MTPL-IND   06650099
066600                  MOVE 'Y'         TO SU066-TRBL-EXIST            06660099
066700                  MOVE TRBDTL-FREEFORM-TEXT-TEXT (1:20)           06670096
066800                                   TO SU066-FREEFORM-TEXT         06680094
066900                  MOVE TRBNTF-TRBL-RSN-CDE                        06690094
067000                                   TO SU066-TRBL-RSN-CDE          06700094
067100                  MOVE SPACES                                     06710099
067200                                   TO SU066-TRBL-SHT-DESC         06720099
067300             WHEN SQLCODE = +100                                  06730094
067400                  MOVE 'N'         TO SU066-DC-COMMENT-MTPL-IND   06740099
067500                  MOVE 'N'         TO SU066-TRBL-EXIST            06750094
067600                  MOVE SPACES                                     06760094
067700                                   TO SU066-FREEFORM-TEXT         06770094
067800                  MOVE 0                                          06780098
067900                                   TO SU066-TRBL-RSN-CDE          06790098
068000                  MOVE SPACES                                     06800099
068100                                   TO SU066-TRBL-SHT-DESC         06810099
068200             WHEN SQLWARN0 NOT = SPACE                            06820094
068300             WHEN SQLCODE  NOT = +0                               06830094
068400                  MOVE '3100-GET-FREEFORM-TEXT'                   06840094
068500                                       TO PV-ABEND-PARAGRAPH      06850094
068600                  MOVE 'ATTEMPTING TO SELECT TTRBNTF'             06860094
068700                                       TO PV-ABEND-OPERATION      06870094
068800                  MOVE SU065-TRN-NBR   TO                         06880099
068900                                    PV-DISPLAY-TRN-NBR            06890094
069000                  MOVE SU065-RCVR-SEQ-NBR TO                      06900099
069100                                    PV-DISPLAY-RCVR-SEQ-NBR       06910094
069200                  MOVE SU065-LOC-NBR      TO                      06920099
069300                                    PV-DISPLAY-OPER-UNT-ID        06930094
069400                  PERFORM Z999-SQL-ERROR                          06940094
069500         END-EVALUATE                                             06950094
069600     END-IF.                                                      06960094
069700                                                                  06970094
069800***************************************************************** 06980094
069900** RETRIEVES TIMESTAMP FOR A GIVEN DC.                            06990094
070000 3200-GET-TKRPRPM.                                                07000094
070100***************************************************************** 07010094
070200     MOVE SU065-CRE-DTE      TO PV-TMST-DATE.                     07020094
070300     MOVE PC-DASH            TO PV-TMST-DASH.                     07030094
070400     MOVE SU065-CRE-TM       TO PV-TMST-TIME.                     07040094
070500     MOVE PC-PERIOD          TO PV-TMST-PERIOD.                   07050094
070600     MOVE PC-MS              TO PV-TMST-MS.                       07060094
070700                                                                  07070094
070800     EXEC SQL                                                     07080094
070900       SELECT (TIMESTAMP(:PV-TMST) + FUNC_QTY HOURS)              07090094
071000         INTO  :PV-SHFT-TMST                                      07100094
071100         FROM TKRPRPM                                             07110094
071200        WHERE LOC_ID            = :SU065-LOC-NBR                  07120094
071300          AND INTFC_SYS_CDE     = 'KHL'                           07130094
071400          AND SYS_PRC_FUNC_CDE  = 'TIMEZN'                        07140094
071500          AND FUNC_PRC_STAT_CDE = 'AC'                            07150094
071600     END-EXEC.                                                    07160094
071700                                                                  07170094
071800     EVALUATE TRUE                                                07180094
071900         WHEN SQLCODE = +0                                        07190094
072000             MOVE PV-TMST-HH  TO PV-SHFT-HH                       07200094
072100             MOVE PC-PERIOD   TO PV-PERIOD-1                      07210094
072200             MOVE PV-TMST-MN  TO PV-SHFT-MN                       07220094
072300             MOVE PC-PERIOD   TO PV-PERIOD-2                      07230094
072400             MOVE PV-TMST-SS  TO PV-SHFT-SS                       07240094
072500         WHEN OTHER                                               07250094
072600             MOVE '3200-GET-TKRPRPM   ' TO PV-ABEND-PARAGRAPH     07260094
072700             MOVE 'GET TIMEZN INFO    ' TO PV-ABEND-OPERATION     07270094
072800             MOVE 'TKRPRPM     '        TO PV-DB2-TABLE-NAME1     07280094
072900             PERFORM Z999-SQL-ERROR                               07290094
073000     END-EVALUATE.                                                07300094
073100                                                                  07310094
073200***************************************************************** 07320094
073300** RETRIEVES SHIFT NUMBER FOR A GIVEN DC AND CREATE TMST.         07330094
073400 3300-GET-SHIFT.                                                  07340094
073500***************************************************************** 07350094
073600     EXEC SQL                                                     07360094
073700       SELECT SHFT_NBR                                            07370094
073800         INTO  :PCT00004-SHFT-NBR                                 07380094
073900         FROM PCT_SHFT                                            07390094
074000        WHERE OPER_UNT_ID       = :SU065-LOC-NBR                  07400094
074100          AND ((SHFT_BEG_TM    <= :PV-SHIFT-TIME                  07410094
074200          AND   SHFT_END_TM    >= :PV-SHIFT-TIME)                 07420094
074300           OR  (SHFT_END_TM    >= :PV-SHIFT-TIME                  07430094
074400          AND   SHFT_BEG_TM     > SHFT_END_TM)                    07440094
074500           OR  (SHFT_BEG_TM    <= :PV-SHIFT-TIME                  07450094
074600          AND   SHFT_BEG_TM     > SHFT_END_TM))                   07460094
074700     END-EXEC.                                                    07470094
074800                                                                  07480094
074900     EVALUATE TRUE                                                07490094
075000         WHEN SQLCODE = +0                                        07500094
075100             MOVE PCT00004-SHFT-NBR     TO SU066-SHFT-NBR         07510094
075200         WHEN SQLCODE = +100                                      07520094
075300             CONTINUE                                             07530094
075400         WHEN SQLWARN0 NOT = SPACE                                07540094
075500         WHEN SQLCODE  NOT = +0                                   07550094
075600              MOVE '3300-GET-SHIFT'                               07560094
075700                                   TO PV-ABEND-PARAGRAPH          07570094
075800              MOVE 'ATTEMPTING TO SELECT PCT_SHFT'                07580094
075900                                   TO PV-ABEND-OPERATION          07590094
076000              MOVE SU065-LOC-NBR      TO                          07600094
076100                                PV-DISPLAY-OPER-UNT-ID            07610094
076200              PERFORM Z999-SQL-ERROR                              07620094
076300     END-EVALUATE.                                                07630094
076400                                                                  07640094
076500***************************************************************** 07650094
076600** RETRIEVES THE ASSOCIATE'S NAME THAT MANUALLY RECEIVED THE      07660094
076700** PO RECEIVER BASED ON THEIR USER ID                             07670094
076800** CALL MODULE XLKUT067                                           07680094
076900 3400-GET-USER-NAME.                                              07690094
077000***************************************************************** 07700094
077100                                                                  07710094
077200     INITIALIZE XL067-USER-COMMAREA.                              07720094
077300                                                                  07730094
077400     SET XL067-BY-USER-ID        TO TRUE.                         07740094
077500     SET XL067-SELECT-BOTH-USERS TO TRUE.                         07750094
077600                                                                  07760094
077700     MOVE SU065-CRE-USR-ID       TO XL067-KEY-USER-ID.            07770094
077800                                                                  07780094
077900     CALL XL067-USER-PGM USING XL067-USER-COMMAREA                07790094
078000                                                                  07800094
078100     EVALUATE TRUE                                                07810094
078200      WHEN XL067-SUCCESSFUL                                       07820094
078300        MOVE XL067-COMBINED-NAME-1 TO SU066-COMBINED-NAME         07830094
078400      WHEN XL067-SQL-ERROR                                        07840094
078500        MOVE '3400-GET-USER-NAME'                                 07850094
078600                             TO PV-ABEND-PARAGRAPH                07860099
078700        MOVE 'ACCESS INFO FOR XLKUT067 INCORRECT'                 07870094
078800                             TO PV-DB2-OPERATION-ATTEMPTED        07880094
078900        MOVE SU065-CRE-USR-ID  TO PV-DISPLAY-USER-ID              07890094
079000        PERFORM Z999-SQL-ERROR                                    07900094
079100      WHEN SQLWARN0 NOT = SPACE                                   07910094
079200      WHEN SQLCODE  NOT = +0                                      07920094
079300        MOVE '3400-GET-USER-NAME'                                 07930094
079400                             TO PV-ABEND-PARAGRAPH                07940099
079500        MOVE 'UNSUCCESSFUL SELECT OF ASSOC NAME'                  07950094
079600                             TO PV-DB2-OPERATION-ATTEMPTED        07960094
079700        MOVE SU065-CRE-USR-ID  TO PV-DISPLAY-USER-ID              07970094
079800        PERFORM Z999-SQL-ERROR                                    07980094
079900     END-EVALUATE.                                                07990094
080000                                                                  08000094
080100***************************************************************** 08010094
080200** RETRIEVES PO INFORMATION FOR A GIVEN PO.                       08020094
080300 3500-GET-PO-DATA.                                                08030094
080400***************************************************************** 08040094
080500     IF SU065-TRN-NBR NOT = PV-TRN-NBR                            08050094
080600                                                                  08060094
080700        EXEC SQL                                                  08070094
080800          SELECT PO_TYP_CDE                                       08080094
080900               , DEPT_NBR                                         08090094
081000               , ENT_ID                                           08100094
081100               , IMPRT_VND_ID                                     08110094
081200               , IMPRT_FCTRY_ID                                   08120094
081300            INTO :PURCHS-PO-TYP-CDE                               08130094
081400               , :PURCHS-DEPT-NBR                                 08140094
081500               , :PURCHS-ENT-ID                                   08150094
081600               , :PURCHS-IMPRT-VND-ID                             08160094
081700               , :PURCHS-IMPRT-FCTRY-ID                           08170094
081800            FROM TPURCHS                                          08180094
081900           WHERE PO_NBR            = :SU065-TRN-NBR               08190094
082000             AND VER_STATUS_CDE    = 'A'                          08200094
082100        END-EXEC                                                  08210094
082200                                                                  08220094
082300        EVALUATE TRUE                                             08230094
082400            WHEN SQLCODE = +0                                     08240094
082500                MOVE PURCHS-PO-TYP-CDE     TO SU066-PO-TYP-CDE    08250094
082600                MOVE PURCHS-DEPT-NBR       TO SU066-DEPT-NBR      08260094
082700                MOVE PURCHS-ENT-ID         TO SU066-ENT-ID        08270094
082800                MOVE PURCHS-IMPRT-VND-ID   TO SU066-IMPRT-VND-ID  08280094
082900                MOVE PURCHS-IMPRT-FCTRY-ID TO SU066-IMPRT-FCTRY-ID08290094
083000            WHEN SQLCODE = +100                                   08300094
083100                CONTINUE                                          08310094
083200            WHEN SQLWARN0 NOT = SPACE                             08320094
083300            WHEN SQLCODE  NOT = +0                                08330094
083400                 MOVE '3500-GET-PO-DATA'                          08340094
083500                                      TO PV-ABEND-PARAGRAPH       08350094
083600                 MOVE 'ATTEMPTING TO SELECT TPURCHS'              08360094
083700                                      TO PV-ABEND-OPERATION       08370094
083800                 MOVE SU065-TRN-NBR      TO                       08380094
083900                                   PV-DISPLAY-TRN-NBR             08390094
084000                 PERFORM Z999-SQL-ERROR                           08400094
084100        END-EVALUATE                                              08410094
084200     END-IF.                                                      08420094
084300                                                                  08430094
084400***************************************************************** 08440094
084500** RETRIEVES RECEIVER INFORMATION FOR A GIVEN PO/RCVR.            08450094
084600 3600-GET-PKGNG-CDE.                                              08460094
084700***************************************************************** 08470094
084800     IF (SU065-TRN-NBR NOT = PV-TRN-NBR)                          08480094
084900        OR (SU065-RCVR-SEQ-NBR NOT = PV-RCVR-SEQ-NBR)             08490094
085000                                                                  08500094
085100        EXEC SQL                                                  08510094
085200          SELECT PACK_BY_ST_IND                                   08520094
085300               , PKGNG_CDE                                        08530094
085400               , CURR_OPER_UNT_ID                                 08540099
085500            INTO :RECEIV-PACK-BY-ST-IND                           08550094
085600               , :RECEIV-PKGNG-CDE                                08560094
085700               , :RECEIV-CURR-OPER-UNT-ID                         08570099
085800            FROM TRECEIV                                          08580094
085900           WHERE ORD_NBR           = :SU065-TRN-NBR               08590094
086000             AND REC_SEQ_NBR       = :SU065-RCVR-SEQ-NBR          08600094
086100             AND VER_STATUS_CDE    = 'A'                          08610094
086200        END-EXEC                                                  08620094
086300                                                                  08630094
086400        EVALUATE TRUE                                             08640094
086500            WHEN SQLCODE = +0                                     08650094
086600                IF RECEIV-PACK-BY-ST-IND = 'Y'                    08660094
086700                   MOVE SPACES           TO SU066-PKGNG-CDE       08670094
086800                ELSE                                              08680094
086900                   MOVE RECEIV-PKGNG-CDE TO SU066-PKGNG-CDE       08690094
087000                END-IF                                            08700094
087100                MOVE RECEIV-CURR-OPER-UNT-ID                      08710099
087200                                         TO SU066-OPER-UNT-ID     08720099
087300            WHEN SQLCODE = +100                                   08730094
087400                CONTINUE                                          08740094
087500            WHEN SQLWARN0 NOT = SPACE                             08750094
087600            WHEN SQLCODE  NOT = +0                                08760094
087700                 MOVE '3600-GET-PKGNG-CDE'                        08770094
087800                                      TO PV-ABEND-PARAGRAPH       08780094
087900                 MOVE 'ATTEMPTING TO SELECT TRECEIV'              08790094
088000                                      TO PV-ABEND-OPERATION       08800094
088100                 MOVE SU065-TRN-NBR      TO                       08810094
088200                                   PV-DISPLAY-TRN-NBR             08820094
088300                 MOVE SU065-RCVR-SEQ-NBR  TO                      08830094
088400                                   PV-DISPLAY-RCVR-SEQ-NBR        08840094
088500                 PERFORM Z999-SQL-ERROR                           08850094
088600        END-EVALUATE                                              08860094
088700     END-IF.                                                      08870094
088800                                                                  08880094
088900***************************************************************** 08890094
089000** RETRIEVES CARTON COUNT FOR A GIVEN RECEIVER.                   08900094
089100 3700-GET-CARTON-CNT.                                             08910094
089200***************************************************************** 08920094
089300     INITIALIZE PV-CARTON-CNT-SMO                                 08930094
089400     INITIALIZE PV-CARTON-CNT-CPS                                 08940094
089500                                                                  08950094
089600     IF SU066-PKGNG-CDE = ' '                                     08960094
089700        PERFORM 5010-OPEN-CARTON-CNT-SMO-CSR                      08970094
089800        PERFORM 5020-FETCH-CARTON-CNT-SMO-CSR                     08980094
089900               UNTIL PS-END-CARTON-CNT-SMO-CSR-YES                08990094
090000                                                                  09000094
090100        MOVE PV-CARTON-CNT-SMO TO SU066-CRTN-CNT                  09010094
090200                                                                  09020094
090300        PERFORM 5030-CLOSE-CARTON-CNT-SMO-CSR                     09030094
090400     ELSE                                                         09040094
090500        PERFORM 5110-OPEN-CARTON-CNT-CPS-CSR                      09050094
090600        PERFORM 5120-FETCH-CARTON-CNT-CPS-CSR                     09060094
090700               UNTIL PS-END-CARTON-CNT-CPS-CSR-YES                09070094
090800                                                                  09080094
090900        MOVE PV-CARTON-CNT-CPS     TO SU066-CRTN-CNT              09090094
091000                                                                  09100094
091100        PERFORM 5130-CLOSE-CARTON-CNT-CPS-CSR                     09110094
091200     END-IF.                                                      09120094
091300                                                                  09130099
091400     PERFORM 3700A-SUM-DISTHD-P2L.                                09140099
091500                                                                  09150099
091600     ADD PV-DISTHD-P2L TO SU066-CRTN-CNT.                         09160099
091700                                                                  09170099
091800***************************************************************** 09180099
091900 3700A-SUM-DISTHD-P2L.                                            09190099
092000***************************************************************** 09200099
092100                                                                  09210099
092200     MOVE 0      TO PV-DISTHD-P2L.                                09220099
092300                                                                  09230099
092400     EXEC SQL                                                     09240099
092500         SELECT SUM(P2L_CART_CNT)                                 09250099
092600         INTO   :PV-DISTHD-P2L                                    09260099
092700         FROM                                                     09270099
092800              TDISTHD                                             09280099
092900         WHERE OPER_UNT_ID           = :XLT00010-LOC-NBR          09290099
093000           AND DATE(CRE_TMST)        = :COCNTL-BTCH-PRC-DTE       09300099
093100           AND UCC128_DAT_USG_CDE    IN ('N','I')                 09310099
093200           AND ORD_NBR               = :DK-TRN-NBR                09320099
093300           AND RCVR_SEQ_NBR          = :DK-RCVR-SEQ-NBR           09330099
093400     END-EXEC.                                                    09340099
093500                                                                  09350099
093600     EVALUATE TRUE                                                09360099
093700         WHEN SQLCODE = +0                                        09370099
093800             CONTINUE                                             09380099
093900         WHEN SQLCODE = -305                                      09390099
094000             MOVE 0    TO PV-DISTHD-P2L                           09400099
094100         WHEN SQLCODE < ZERO                                      09410099
094200         WHEN SQLCODE > ZERO                                      09420099
094300         WHEN SQLWARN0 NOT = SPACE                                09430099
094400             MOVE '3700A-SUM-DISTHD-P2L'                          09440099
094500                                      TO PV-ABEND-PARAGRAPH       09450099
094600             MOVE 'SUM'               TO PV-DB2-FUNCTION          09460099
094700             PERFORM Z999-SQL-ERROR                               09470099
094800     END-EVALUATE.                                                09480099
094900*                                                                 09490099
095000***************************************************************** 09500094
095100** RETRIEVES VENDOR NAME FOR A GIVEN ENT-ID.                      09510094
095200 3800-GET-VENDOR-NAME.                                            09520094
095300***************************************************************** 09530094
095400                                                                  09540094
095500     IF SU065-TRN-NBR NOT = PV-TRN-NBR                            09550094
095600                                                                  09560094
095700        EXEC SQL                                                  09570094
095800          SELECT ENT_NAME_DESC                                    09580094
095900            INTO :ENTNME-ENT-NAME-DESC                            09590094
096000            FROM TENTNME                                          09600094
096100           WHERE ENT_ID            = :PURCHS-ENT-ID               09610094
096200             AND TYPE_CDE          = '01'                         09620094
096300        END-EXEC                                                  09630094
096400                                                                  09640094
096500        EVALUATE TRUE                                             09650094
096600            WHEN SQLCODE = +0                                     09660094
096700            WHEN SQLCODE = -811                                   09670094
096800                MOVE ENTNME-ENT-NAME-DESC  TO SU066-ENT-NAME-DESC 09680094
096900            WHEN SQLCODE = +100                                   09690094
097000                CONTINUE                                          09700094
097100            WHEN SQLWARN0 NOT = SPACE                             09710094
097200            WHEN SQLCODE  NOT = +0                                09720094
097300                 MOVE '3800-GET-VENDOR-NAME'                      09730094
097400                                      TO PV-ABEND-PARAGRAPH       09740094
097500                 MOVE 'ATTEMPTING TO SELECT TENTNME'              09750094
097600                                      TO PV-ABEND-OPERATION       09760094
097700                 MOVE PURCHS-ENT-ID      TO                       09770094
097800                                   PV-DISPLAY-ENT-ID              09780094
097900                 PERFORM Z999-SQL-ERROR                           09790094
098000        END-EVALUATE                                              09800094
098100     END-IF.                                                      09810094
098200                                                                  09820094
098300***************************************************************** 09830094
098400** RETRIEVES THE IMPORT DECONSOLIDATOR SCAC CODE FOR GIVEN PO.    09840094
098500 3900-GET-SCAC-CDE.                                               09850094
098600***************************************************************** 09860094
098700                                                                  09870094
098800     IF SU065-TRN-NBR NOT = PV-TRN-NBR                            09880099
098900                                                                  09890094
181356**     IF PURCHS-PO-TYP-CDE = 'IE' OR 'IM' OR 'IF' OR 'LD'        09900099
181356       IF PURCHS-PO-TYP-CDE = 'IE' OR 'IM' OR 'IF' OR 'LD' OR 'LE'09910099
099100           EXEC SQL                                               09920094
099200             SELECT B.SCAC_CDE                                    09930099
099300               INTO :EXTENT-SCAC-CDE                              09940094
099400               FROM TIMCNRL A                                     09950099
099500                  , TEXTENT B                                     09960099
099600              WHERE A.PO_NBR          = :DK-TRN-NBR               09970099
099700                AND A.DCONSLR_ENT_ID  = B.ENT_ID                  09980099
099800                FETCH FIRST 1 ROW ONLY                            09990099
099900           END-EXEC                                               10000094
100000                                                                  10010094
100100           EVALUATE TRUE                                          10020094
100200               WHEN SQLCODE = +0                                  10030094
100300               WHEN SQLCODE = -811                                10040094
100400                   MOVE EXTENT-ENT-ID     TO SU066-DECN-ENT-ID    10050099
100500                   MOVE EXTENT-SCAC-CDE   TO SU066-DECN-SCAC-CDE  10060099
100600               WHEN SQLCODE = +100                                10070094
100700                   MOVE ZEROES            TO SU066-DECN-ENT-ID    10080099
100800                   MOVE SPACES            TO SU066-DECN-SCAC-CDE  10090099
100900               WHEN SQLWARN0 NOT = SPACE                          10100094
101000               WHEN SQLCODE  NOT = +0                             10110094
101100                    MOVE '3900-GET-SCAC-CDE'                      10120094
101200                                         TO PV-ABEND-PARAGRAPH    10130094
101300                    MOVE 'ATTEMPTING TO SELECT SCAC   '           10140094
101400                                         TO PV-ABEND-OPERATION    10150094
101500                    MOVE 'TIMCNRL        '   TO PV-DB2-TABLE-NAME110160099
101600                    MOVE 'TEXTENT        '   TO PV-DB2-TABLE-NAME210170099
101700                    MOVE SU065-TRN-NBR      TO                    10180094
101800                                      PV-DISPLAY-TRN-NBR          10190094
101900                    PERFORM Z999-SQL-ERROR                        10200094
102000           END-EVALUATE                                           10210094
102100       ELSE                                                       10220094
102200           MOVE ZEROES                TO SU066-DECN-ENT-ID        10230094
102300           MOVE SPACES                TO SU066-DECN-SCAC-CDE      10240094
102400       END-IF                                                     10250094
102500     END-IF.                                                      10260094
102600                                                                  10270094
102700***************************************************************** 10280094
102800** CHECKS TO SEE IF VENDOR IS IN ASN PRODUCTION.                  10290094
102900 4100-CHECK-ASN-PROD.                                             10300094
103000***************************************************************** 10310094
103100                                                                  10320094
103200     IF SU065-TRN-NBR NOT = PV-TRN-NBR                            10330094
103300                                                                  10340094
103400        EXEC SQL                                                  10350094
103500          SELECT COUNT(*)                                         10360094
103600            INTO :PV-ASN-PROD-COUNT                               10370094
103700            FROM TTRDPRT A                                        10380094
103800               , TTRDTRN B                                        10390094
103900           WHERE A.ENT_ID          = :PURCHS-ENT-ID               10400094
104000             AND A.INACTV_DTE      = :PC-INACTV-DTE               10410094
104100             AND A.TP_DKEY         = B.TP_DKEY                    10420094
104200             AND B.INACTV_DTE      = :PC-INACTV-DTE               10430094
104300             AND B.TRAN_SET_CDE    = '856'                        10440094
104400             AND B.PROD_TEST_IND   = 'P'                          10450094
104500        END-EXEC                                                  10460094
104600                                                                  10470094
104700        EXEC SQL                                                  10480094
104800          SELECT ASN_TRSCP_IND                                    10490094
104900            INTO :EXTENT-ASN-TRSCP-IND                            10500094
105000            FROM TEXTENT                                          10510094
105100           WHERE ENT_ID            = :PURCHS-ENT-ID               10520094
105200             AND STATUS_CDE        = 'A'                          10530094
105300        END-EXEC                                                  10540094
105400                                                                  10550094
105500        EVALUATE TRUE                                             10560094
105600            WHEN SQLCODE = +0                                     10570094
105700            WHEN SQLCODE = +100                                   10580094
105800                CONTINUE                                          10590094
105900            WHEN SQLWARN0 NOT = SPACE                             10600094
106000            WHEN SQLCODE  NOT = +0                                10610094
106100                 MOVE '4100-CHECK-ASN-PROD'                       10620094
106200                                      TO PV-ABEND-PARAGRAPH       10630094
106300                 MOVE 'ATTEMPTING TO SELECT COUNT  '              10640094
106400                                      TO PV-ABEND-OPERATION       10650094
106500                 MOVE 'TTRDPRT        '     TO PV-DB2-TABLE-NAME1 10660094
106600                 MOVE 'TTRDTRN        '     TO PV-DB2-TABLE-NAME2 10670094
106700                 MOVE 'TEXTENT        '     TO PV-DB2-TABLE-NAME3 10680094
106800                 MOVE PURCHS-ENT-ID      TO                       10690094
106900                                   PV-DISPLAY-ENT-ID              10700094
107000                 PERFORM Z999-SQL-ERROR                           10710094
107100        END-EVALUATE                                              10720094
107200     END-IF.                                                      10730094
107300                                                                  10740094
107400***************************************************************** 10750094
107500** CHECK TO SEE IF CARTON DATA ATTACHED TO PACKSLIP.              10760094
107600 4200-CHECK-CARTON-DATA.                                          10770094
107700***************************************************************** 10780094
107800     IF (SU065-TRN-NBR NOT = PV-TRN-NBR)                          10790094
107900         OR (SU065-RCVR-SEQ-NBR NOT = PV-RCVR-SEQ-NBR)            10800094
108000                                                                  10810094
108100        EXEC SQL                                                  10820094
108200          SELECT COUNT(*)                                         10830094
108300            INTO :PV-CRTN-DATA-COUNT                              10840094
108400            FROM TPKSLIP A                                        10850094
108500               , TINPKSU B                                        10860094
108600           WHERE A.PO_NBR          = :SU065-TRN-NBR               10870094
108700             AND A.REC_SEQ_NBR     = :SU065-RCVR-SEQ-NBR          10880094
108800             AND A.PO_NBR          = B.PO_NBR                     10890094
108900             AND A.SEQ_NBR         = B.SEQ_NBR                    10900094
109000             AND A.VER_STAT_CDE    = 'A'                          10910094
109100        END-EXEC                                                  10920094
109200                                                                  10930094
109300        EVALUATE TRUE                                             10940094
109400            WHEN SQLCODE = +0                                     10950094
109500            WHEN SQLCODE = +100                                   10960094
109600                CONTINUE                                          10970094
109700            WHEN SQLWARN0 NOT = SPACE                             10980094
109800            WHEN SQLCODE  NOT = +0                                10990094
109900                 MOVE '3500-GET-PO-DATA'                          11000094
110000                                      TO PV-ABEND-PARAGRAPH       11010094
110100                 MOVE 'ATTEMPTING TO SELECT TPURCHS'              11020094
110200                                      TO PV-ABEND-OPERATION       11030094
110300                 MOVE SU065-TRN-NBR      TO                       11040094
110400                                   PV-DISPLAY-TRN-NBR             11050094
110500                 PERFORM Z999-SQL-ERROR                           11060094
110600        END-EVALUATE                                              11070094
110700     END-IF.                                                      11080094
110800                                                                  11090094
110900***************************************************************** 11100094
111000** CHECKS TO SEE IF PROMPTED QC AUDIT WAS DONE.                   11110094
111100** QC AUDIT INFO:  P = PASSED  F = FAILED  M = MIXED              11120094
111200**                 ' ' NO LONGER NEEDED                           11130094
111300 4300-CHECK-IF-PRMPT-QC-AUDIT.                                    11140094
111400***************************************************************** 11150094
111500     IF (SU065-TRN-NBR NOT = PV-TRN-NBR)                          11160094
111600         OR (SU065-RCVR-SEQ-NBR NOT = PV-RCVR-SEQ-NBR)            11170094
111700                                                                  11180094
111800        EXEC SQL                                                  11190094
111900          SELECT DISTINCT AUD_STAT_CDE                            11200094
112000            INTO :SUT00015-AUD-STAT-CDE                           11210094
112100            FROM SUT_PO_AUD_REQ                                   11220094
112200           WHERE PO_NBR            = :SU065-TRN-NBR               11230094
112300             AND RCVR_SEQ_NBR      = :SU065-RCVR-SEQ-NBR          11240094
112400             AND AUD_STAT_CDE      IN ('P','F')                   11250094
112500        END-EXEC                                                  11260094
112600                                                                  11270094
112700        EVALUATE TRUE                                             11280094
112800            WHEN SQLCODE = +0                                     11290094
112900                IF SUT00015-AUD-STAT-CDE = 'P'                    11300094
113000                   MOVE 'P' TO SU066-PR-QC-AU-SW                  11310094
113100                ELSE                                              11320094
113200                   MOVE 'F' TO SU066-PR-QC-AU-SW                  11330094
113300                END-IF                                            11340094
113400            WHEN SQLCODE = +100                                   11350094
113500                MOVE ' '    TO SU066-PR-QC-AU-SW                  11360094
113600            WHEN SQLCODE = -811                                   11370094
113700                MOVE 'M'    TO SU066-PR-QC-AU-SW                  11380094
113800            WHEN SQLWARN0 NOT = SPACE                             11390094
113900            WHEN SQLCODE  NOT = +0                                11400094
114000                 MOVE '4300-CHECK-IF-PRMPT-QC-AUDIT'              11410094
114100                                      TO PV-ABEND-PARAGRAPH       11420094
114200                 MOVE 'ATTEMPTING TO SELECT SUT_PO_AUD_REQ '      11430094
114300                                      TO PV-ABEND-OPERATION       11440094
114400                 MOVE SU065-TRN-NBR      TO                       11450094
114500                                   PV-DISPLAY-TRN-NBR             11460094
114600                 MOVE SU065-RCVR-SEQ-NBR TO                       11470094
114700                                   PV-DISPLAY-RCVR-SEQ-NBR        11480094
114800                 PERFORM Z999-SQL-ERROR                           11490094
114900        END-EVALUATE                                              11500094
115000     END-IF.                                                      11510094
115100                                                                  11520094
115200 4400-CHECK-MX-SKU-CARTONS.                                       11530094
115300                                                                  11540094
115400     IF SU066-PKGNG-CDE = 'B' OR 'C' OR 'S'                       11550094
115500        PERFORM 5310-OPEN-MIXED-SKU-BCS-CSR                       11560094
115600                                                                  11570094
115700        PERFORM 5320-FETCH-MIXED-SKU-BCS-CSR                      11580094
115800           UNTIL PS-END-MIXED-SKU-BCS-CSR-YES                     11590094
115900                 OR PV-MX-SK = 'Y'                                11600099
116000                                                                  11610099
116100        PERFORM 5330-CLOSE-MIXED-SKU-BCS-CSR                      11620094
116200     ELSE                                                         11630094
116300        CONTINUE                                                  11640094
116400     END-IF                                                       11650094
116500                                                                  11660094
116600     MOVE PV-MX-SK TO SU066-MX-SK-SW.                             11670099
116700                                                                  11680099
116800     INITIALIZE PV-MX-SK.                                         11690099
116900                                                                  11700094
117000***************************************************************** 11710094
117100 4600-GET-BCS-MX-SKU-CNT.                                         11720094
117200***************************************************************** 11730094
117300     INITIALIZE PV-BCS-MX-SKU-CNT                                 11740094
117400                                                                  11750094
117500        EXEC SQL                                                  11760094
117600           SELECT COUNT(*)                                        11770094
117700             INTO :PV-BCS-MX-SKU-CNT                              11780094
117800             FROM TSHPSUM                                         11790094
117900            WHERE PO_NBR        =  :SHPSUM-PO-NBR                 11800094
118000              AND PKSL_SEQ_NBR  =  :SHPSUM-PKSL-SEQ-NBR           11810094
118100              AND CART_COMB_NBR =  :SHPSUM-CART-COMB-NBR          11820094
118200              AND PO_LNE_NBR    <> :SHPSUM-PO-LNE-NBR             11830094
118300        END-EXEC                                                  11840094
118400                                                                  11850094
118500        EVALUATE TRUE                                             11860094
118600            WHEN SQLCODE = +0                                     11870094
118700            WHEN SQLCODE = +100                                   11880094
118800                CONTINUE                                          11890094
118900            WHEN SQLWARN0 NOT = SPACE                             11900094
119000            WHEN SQLCODE  NOT = +0                                11910094
119100                 MOVE '4600-GET-BCS-MX-SKU-CNT'                   11920094
119200                                      TO PV-ABEND-PARAGRAPH       11930094
119300                 MOVE 'ATTEMPTING TO SELECT COUNT  '              11940094
119400                                      TO PV-ABEND-OPERATION       11950094
119500                 MOVE 'TSHPSUM        '     TO PV-DB2-TABLE-NAME1 11960094
119600                 MOVE SHPSUM-PO-NBR      TO                       11970094
119700                                   PV-DISPLAY-TRN-NBR             11980094
119800                 MOVE SHPSUM-PKSL-SEQ-NBR TO                      11990094
119900                                   PV-DISPLAY-PKSL-SEQ-NBR        12000094
120000                 MOVE SHPSUM-CART-COMB-NBR TO                     12010094
120100                                   PV-DISPLAY-CART-COMB-NBR       12020094
120200                 MOVE SHPSUM-PO-LNE-NBR    TO                     12030094
120300                                   PV-DISPLAY-TRN-LNE-NBR         12040094
120400                 PERFORM Z999-SQL-ERROR                           12050094
120500        END-EVALUATE.                                             12060094
120600                                                                  12070094
120700***************************************************************** 12080094
120800 5010-OPEN-CARTON-CNT-SMO-CSR.                                    12090094
120900***************************************************************** 12100094
121000                                                                  12110094
121100     SET PS-END-CARTON-CNT-SMO-CSR-NO TO TRUE                     12120094
121200                                                                  12130094
121300     MOVE SU065-TRN-NBR           TO DK-TRN-NBR                   12140094
121400     MOVE SU065-RCVR-SEQ-NBR      TO DK-RCVR-SEQ-NBR              12150094
121500     MOVE SU065-LOC-NBR           TO DK-LOC-NBR                   12160094
121600                                                                  12170094
121700     EXEC SQL                                                     12180094
121800         OPEN CARTON-CNT-SMO-CSR                                  12190094
121900     END-EXEC.                                                    12200094
122000                                                                  12210094
122100     EVALUATE TRUE                                                12220094
122200         WHEN SQLCODE = +0                                        12230094
122300             CONTINUE                                             12240094
122400         WHEN SQLWARN0 NOT = SPACE                                12250094
122500         WHEN SQLCODE  NOT = +0                                   12260094
122600              MOVE SU065-TRN-NBR      TO PV-DISPLAY-TRN-NBR       12270094
122700              MOVE SU065-RCVR-SEQ-NBR TO PV-DISPLAY-RCVR-SEQ-NBR  12280094
122800              MOVE SU065-LOC-NBR      TO PV-DISPLAY-OPER-UNT-ID   12290094
122900                                                                  12300094
123000              MOVE '5010-OPEN-CARTON-CNT-SMO-CSR'                 12310094
123100                                   TO PV-ABEND-PARAGRAPH          12320094
123200              MOVE 'OPEN CURSOR '  TO PV-ABEND-OPERATION          12330094
123300              MOVE 'SUT_OTBND_UPC  '     TO PV-DB2-TABLE-NAME1    12340094
123400              MOVE 'SUT_OTBND_CART '     TO PV-DB2-TABLE-NAME2    12350094
123500                                                                  12360094
123600             PERFORM Z999-SQL-ERROR                               12370094
123700     END-EVALUATE.                                                12380094
123800                                                                  12390094
123900***************************************************************** 12400094
124000 5020-FETCH-CARTON-CNT-SMO-CSR.                                   12410094
124100***************************************************************** 12420094
124200                                                                  12430094
124300     EXEC SQL                                                     12440094
124400          FETCH CARTON-CNT-SMO-CSR                                12450094
124500           INTO  :PV-CARTON-CNT-SMO                               12460094
124600     END-EXEC.                                                    12470094
124700                                                                  12480094
124800     EVALUATE TRUE                                                12490094
124900         WHEN SQLCODE = +0                                        12500094
125000              CONTINUE                                            12510094
125100         WHEN SQLCODE = +100                                      12520094
125200              SET PS-END-CARTON-CNT-SMO-CSR-YES TO TRUE           12530094
125300         WHEN SQLWARN0 NOT = SPACE                                12540094
125400         WHEN SQLCODE  NOT = +0                                   12550094
125500              MOVE '5020-FETCH-CARTON-CNT-SMO-CSR'                12560094
125600                                   TO PV-ABEND-PARAGRAPH          12570094
125700              MOVE 'ATTEMPTING TO FETCH SMO CARTON COUNT    '     12580094
125800                                   TO PV-ABEND-OPERATION          12590094
125900                                                                  12600094
126000              MOVE SU065-TRN-NBR      TO                          12610094
126100                                PV-DISPLAY-TRN-NBR                12620094
126200                                                                  12630094
126300              MOVE SU065-RCVR-SEQ-NBR TO                          12640094
126400                                PV-DISPLAY-RCVR-SEQ-NBR           12650094
126500                                                                  12660094
126600              MOVE SU065-LOC-NBR      TO                          12670094
126700                                PV-DISPLAY-OPER-UNT-ID            12680094
126800                                                                  12690094
126900              PERFORM Z999-SQL-ERROR                              12700094
127000     END-EVALUATE.                                                12710094
127100                                                                  12720094
127200***************************************************************** 12730094
127300 5030-CLOSE-CARTON-CNT-SMO-CSR.                                   12740094
127400***************************************************************** 12750094
127500     EXEC SQL                                                     12760094
127600         CLOSE CARTON-CNT-SMO-CSR                                 12770094
127700     END-EXEC                                                     12780094
127800                                                                  12790094
127900     EVALUATE TRUE                                                12800094
128000         WHEN SQLCODE = ZERO                                      12810094
128100             CONTINUE                                             12820094
128200         WHEN OTHER                                               12830094
128300             MOVE '5030-CLOSE-CARTON-CNT-SMO-CSR'                 12840094
128400                                 TO PV-ABEND-PARAGRAPH            12850094
128500             MOVE 'CLOSE CURSOR '                                 12860094
128600                                 TO PV-ABEND-OPERATION            12870094
128700             MOVE 'SUT_OTBND_UPC  '                               12880094
128800                                 TO PV-DB2-TABLE-NAME1            12890094
128900             MOVE 'SUT_OTBND_CART '                               12900094
129000                                 TO PV-DB2-TABLE-NAME2            12910094
129100             PERFORM Z999-SQL-ERROR                               12920094
129200     END-EVALUATE.                                                12930094
129300                                                                  12940094
129400***************************************************************** 12950094
129500 5110-OPEN-CARTON-CNT-CPS-CSR.                                    12960094
129600***************************************************************** 12970094
129700                                                                  12980094
129800     SET PS-END-CARTON-CNT-CPS-CSR-NO TO TRUE                     12990094
129900                                                                  13000094
130000     MOVE SU065-TRN-NBR           TO DK-TRN-NBR                   13010094
130100     MOVE SU065-RCVR-SEQ-NBR      TO DK-RCVR-SEQ-NBR              13020094
130200     MOVE SU065-LOC-NBR           TO DK-LOC-NBR                   13030094
130300                                                                  13040094
130400     EXEC SQL                                                     13050094
130500         OPEN CARTON-CNT-CPS-CSR                                  13060094
130600     END-EXEC.                                                    13070094
130700                                                                  13080094
130800     EVALUATE TRUE                                                13090094
130900         WHEN SQLCODE = +0                                        13100094
131000             CONTINUE                                             13110094
131100         WHEN SQLWARN0 NOT = SPACE                                13120094
131200         WHEN SQLCODE  NOT = +0                                   13130094
131300              MOVE SU065-TRN-NBR      TO PV-DISPLAY-TRN-NBR       13140094
131400              MOVE SU065-RCVR-SEQ-NBR TO PV-DISPLAY-RCVR-SEQ-NBR  13150094
131500              MOVE SU065-LOC-NBR      TO PV-DISPLAY-OPER-UNT-ID   13160094
131600                                                                  13170094
131700              MOVE '5110-OPEN-CARTON-CNT-CPS-CSR'                 13180094
131800                                   TO PV-ABEND-PARAGRAPH          13190094
131900              MOVE 'OPEN CURSOR '  TO PV-ABEND-OPERATION          13200094
132000              MOVE 'SUT_OTBND_UPC  '     TO PV-DB2-TABLE-NAME1    13210094
132100              MOVE 'SUT_OTBND_CART '     TO PV-DB2-TABLE-NAME2    13220094
132200                                                                  13230094
132300             PERFORM Z999-SQL-ERROR                               13240094
132400     END-EVALUATE.                                                13250094
132500                                                                  13260094
132600***************************************************************** 13270094
132700 5120-FETCH-CARTON-CNT-CPS-CSR.                                   13280094
132800***************************************************************** 13290094
132900                                                                  13300094
133000     EXEC SQL                                                     13310094
133100          FETCH CARTON-CNT-CPS-CSR                                13320094
133200           INTO  :PV-CARTON-CNT-CPS                               13330094
133300     END-EXEC.                                                    13340094
133400                                                                  13350094
133500     EVALUATE TRUE                                                13360094
133600         WHEN SQLCODE = +0                                        13370094
133700              CONTINUE                                            13380094
133800         WHEN SQLCODE = +100                                      13390094
133900              SET PS-END-CARTON-CNT-CPS-CSR-YES TO TRUE           13400094
134000         WHEN SQLWARN0 NOT = SPACE                                13410094
134100         WHEN SQLCODE  NOT = +0                                   13420094
134200              MOVE '5120-FETCH-CARTON-CNT-CPS-CSR'                13430094
134300                                   TO PV-ABEND-PARAGRAPH          13440094
134400              MOVE 'ATTEMPTING TO FETCH BCS CARTON COUNT     '    13450094
134500                                   TO PV-ABEND-OPERATION          13460094
134600                                                                  13470094
134700              MOVE SU065-TRN-NBR      TO                          13480094
134800                                PV-DISPLAY-TRN-NBR                13490094
134900                                                                  13500094
135000              MOVE SU065-RCVR-SEQ-NBR TO                          13510094
135100                                PV-DISPLAY-RCVR-SEQ-NBR           13520094
135200                                                                  13530094
135300              MOVE SU065-LOC-NBR      TO                          13540094
135400                                PV-DISPLAY-OPER-UNT-ID            13550094
135500                                                                  13560094
135600              PERFORM Z999-SQL-ERROR                              13570094
135700     END-EVALUATE.                                                13580094
135800                                                                  13590094
135900***************************************************************** 13600094
136000 5130-CLOSE-CARTON-CNT-CPS-CSR.                                   13610094
136100***************************************************************** 13620094
136200     EXEC SQL                                                     13630094
136300         CLOSE CARTON-CNT-CPS-CSR                                 13640094
136400     END-EXEC                                                     13650094
136500                                                                  13660094
136600     EVALUATE TRUE                                                13670094
136700         WHEN SQLCODE = ZERO                                      13680094
136800             CONTINUE                                             13690094
136900         WHEN OTHER                                               13700094
137000             MOVE '5130-CLOSE-CARTON-CNT-CPS-CSR'                 13710094
137100                                 TO PV-ABEND-PARAGRAPH            13720094
137200             MOVE 'CLOSE CURSOR '                                 13730094
137300                                 TO PV-ABEND-OPERATION            13740094
137400             MOVE 'SUT_OTBND_UPC  '                               13750094
137500                                 TO PV-DB2-TABLE-NAME1            13760094
137600             MOVE 'SUT_OTBND_CART '                               13770094
137700                                 TO PV-DB2-TABLE-NAME2            13780094
137800             PERFORM Z999-SQL-ERROR                               13790094
137900     END-EVALUATE.                                                13800094
138000                                                                  13810094
138100***************************************************************** 13820094
138200 5310-OPEN-MIXED-SKU-BCS-CSR.                                     13830094
138300***************************************************************** 13840094
138400                                                                  13850094
138500     SET PS-END-MIXED-SKU-BCS-CSR-NO TO TRUE                      13860094
138600                                                                  13870094
138700     MOVE SU065-TRN-NBR           TO DK-TRN-NBR                   13880094
138800     MOVE SU065-RCVR-SEQ-NBR      TO DK-RCVR-SEQ-NBR              13890094
138900     MOVE SU065-LOC-NBR           TO DK-LOC-NBR                   13900094
139000     MOVE SU065-TRN-LNE-NBR       TO DK-TRN-LNE-NBR               13910094
139100                                                                  13920094
139200     EXEC SQL                                                     13930094
139300         OPEN MIXED-SKU-BCS-CSR                                   13940094
139400     END-EXEC.                                                    13950094
139500                                                                  13960094
139600     EVALUATE TRUE                                                13970094
139700         WHEN SQLCODE = +0                                        13980094
139800             CONTINUE                                             13990094
139900         WHEN SQLWARN0 NOT = SPACE                                14000094
140000         WHEN SQLCODE  NOT = +0                                   14010094
140100              MOVE SU065-TRN-NBR      TO PV-DISPLAY-TRN-NBR       14020094
140200              MOVE SU065-RCVR-SEQ-NBR TO PV-DISPLAY-RCVR-SEQ-NBR  14030094
140300              MOVE SU065-LOC-NBR      TO PV-DISPLAY-OPER-UNT-ID   14040094
140400                                                                  14050094
140500              MOVE '5310-OPEN-MIXED-SKU-BCS-CSR'                  14060094
140600                                   TO PV-ABEND-PARAGRAPH          14070094
140700              MOVE 'OPEN CURSOR '  TO PV-ABEND-OPERATION          14080094
140800              MOVE 'TPKSLIP        '     TO PV-DB2-TABLE-NAME1    14090094
140900              MOVE 'TSHPSUM        '     TO PV-DB2-TABLE-NAME2    14100094
141000                                                                  14110094
141100             PERFORM Z999-SQL-ERROR                               14120094
141200     END-EVALUATE.                                                14130094
141300                                                                  14140094
141400***************************************************************** 14150094
141500 5320-FETCH-MIXED-SKU-BCS-CSR.                                    14160094
141600***************************************************************** 14170094
141700                                                                  14180094
141800     EXEC SQL                                                     14190094
141900          FETCH MIXED-SKU-BCS-CSR                                 14200094
142000           INTO  :SHPSUM-PO-NBR                                   14210094
142100              ,  :SHPSUM-PKSL-SEQ-NBR                             14220094
142200              ,  :SHPSUM-CART-COMB-NBR                            14230094
142300              ,  :SHPSUM-PO-LNE-NBR                               14240094
142400              ,  :SHPSUM-TOT-CART-CNT                             14250094
142500              ,  :SHPSUM-OTPK-UNT-QTY                             14260094
142600     END-EXEC.                                                    14270094
142700                                                                  14280094
142800     EVALUATE TRUE                                                14290094
142900         WHEN SQLCODE = +0                                        14300094
143000              ADD +1 TO PV-MX-SKU-BCS-CSR-FETCH                   14310094
143100              PERFORM 2200-PROCESS-MX-SKU-BCS-CSR                 14320094
143200         WHEN SQLCODE = +100                                      14330094
143300              SET PS-END-MIXED-SKU-BCS-CSR-YES TO TRUE            14340094
143400         WHEN SQLWARN0 NOT = SPACE                                14350094
143500         WHEN SQLCODE  NOT = +0                                   14360094
143600              MOVE '5320-FETCH-MIXED-SKU-BCS-CSR'                 14370094
143700                                   TO PV-ABEND-PARAGRAPH          14380094
143800              MOVE 'ATTEMPTING TO FETCH BCS W/MX SKUS '           14390094
143900                                   TO PV-ABEND-OPERATION          14400094
144000                                                                  14410094
144100              MOVE SU065-TRN-NBR      TO                          14420094
144200                                PV-DISPLAY-TRN-NBR                14430094
144300                                                                  14440094
144400              MOVE SU065-RCVR-SEQ-NBR TO                          14450094
144500                                PV-DISPLAY-RCVR-SEQ-NBR           14460094
144600                                                                  14470094
144700              MOVE SU065-LOC-NBR      TO                          14480094
144800                                PV-DISPLAY-OPER-UNT-ID            14490094
144900                                                                  14500094
145000              PERFORM Z999-SQL-ERROR                              14510094
145100     END-EVALUATE.                                                14520094
145200                                                                  14530094
145300***************************************************************** 14540094
145400 5330-CLOSE-MIXED-SKU-BCS-CSR.                                    14550094
145500***************************************************************** 14560094
145600     EXEC SQL                                                     14570094
145700         CLOSE MIXED-SKU-BCS-CSR                                  14580094
145800     END-EXEC                                                     14590094
145900                                                                  14600094
146000     EVALUATE TRUE                                                14610094
146100         WHEN SQLCODE = ZERO                                      14620094
146200             CONTINUE                                             14630094
146300         WHEN OTHER                                               14640094
146400             MOVE '5330-CLOSE-MIXED-SKU-BCS-CSR'                  14650094
146500                                 TO PV-ABEND-PARAGRAPH            14660094
146600             MOVE 'CLOSE CURSOR '                                 14670094
146700                                 TO PV-ABEND-OPERATION            14680094
146800             MOVE 'TPKSLIP        '                               14690094
146900                                 TO PV-DB2-TABLE-NAME1            14700094
147000             MOVE 'TSHPSUM        '                               14710094
147100                                 TO PV-DB2-TABLE-NAME2            14720094
147200             PERFORM Z999-SQL-ERROR                               14730094
147300     END-EVALUATE.                                                14740094
147400                                                                  14750094
147500***************************************************************** 14760094
147600 7000-READ-INPUT-FILE.                                            14770094
147700***************************************************************** 14780094
147800      READ INPUT-FILE INTO SU065-RECORD                           14790094
147900        AT END                                                    14800094
148000           SET PS-END-OF-INPUT-FILE TO TRUE                       14810094
148100        NOT AT END                                                14820094
148200           ADD +1 TO PV-READ-COUNT                                14830094
148300      END-READ.                                                   14840094
148400                                                                  14850094
148500***************************************************************** 14860094
148600 8000-WRITE-EXTRACT.                                              14870094
148700***************************************************************** 14880094
148800     WRITE EXTRACT-RECORD                                         14890094
148900       FROM SU066-RECORD.                                         14900094
149000                                                                  14910094
149100     ADD +1 TO PV-WRITE-EXTR-COUNT.                               14920094
149200                                                                  14930094
149300***************************************************************** 14940094
149400 9000-CLOSE-FILES.                                                14950094
149500                                                                  14960094
149600     MOVE PV-READ-COUNT              TO PV-DISPLAY-READ-CNT.      14970094
149700     DISPLAY 'TOT RECS READ       : '   PV-DISPLAY-READ-CNT.      14980094
149800                                                                  14990094
149900     MOVE PV-WRITE-EXTR-COUNT        TO PV-DISPLAY-WRITE-CNT.     15000094
150000     DISPLAY 'TOT RECS WRITTEN    : '   PV-DISPLAY-WRITE-CNT.     15010094
150100                                                                  15020094
150200     MOVE PV-MX-SKU-BCS-CSR-FETCH    TO PV-DISPLAY-BCS-FETCH-CNT. 15030094
150300     DISPLAY 'BCS RECS FETCHED    : '   PV-DISPLAY-BCS-FETCH-CNT. 15040094
150400*                                                                 15050094
150500     CLOSE INPUT-FILE                                             15060094
150600           EXTRACT-FILE.                                          15070094
150700                                                                  15080094
150800                                                                  15090094
150900***************************************************************** 15100094
151000 Z999-SQL-ERROR.                                                  15110094
151100***************************************************************** 15120094
151200     MOVE SQLCODE                     TO PV-DISPLAY-SQLCODE.      15130094
151300                                                                  15140094
151400     DISPLAY '** ABEND **         ** = SQLERROR'.                 15150094
151500     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                15160094
151600     DISPLAY '** OPER UNT ID  ** = ' PV-DISPLAY-OPER-UNT-ID.      15170094
151700     DISPLAY '** TRN NBR      ** = ' PV-DISPLAY-TRN-NBR.          15180094
151800     DISPLAY '** RCVR SEQ NBR ** = ' PV-DISPLAY-RCVR-SEQ-NBR.     15190094
151900     DISPLAY '** TRN LNE NBR  ** = ' PV-DISPLAY-TRN-LNE-NBR.      15200094
152000                                                                  15210094
152100                                                                  15220094
152200     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             15230094
152300     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                15240094
152400     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME1.             15250094
152500     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME2.             15260094
152600     DISPLAY '** SQLCODE   ** = ' PV-DISPLAY-SQLCODE.             15270094
152700                                                                  15280094
152800     MOVE +4013                  TO PV-ABEND-CODE.                15290094
152900     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         15300094
