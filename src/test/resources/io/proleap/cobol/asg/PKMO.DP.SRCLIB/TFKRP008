      ******************************************************************00010001
       IDENTIFICATION DIVISION.                                         00020001
      ******************************************************************00030001
                                                                        00040001
       PROGRAM-ID.              TFKRP008.                               00050001
       AUTHOR.                  C PARMLEY.                              00060001
       INSTALLATION.            KOHLS DEPARTMENT STORES.                00070001
       DATE-WRITTEN.            07/15/2011.                             00080001
       DATE-COMPILED.                                                   00090001
                                                                        00100001
      ******************************************************************00110001
      * PROGRAM DESCRIPTION:                                            00120001
      * --------------------                                            00130001
      * GENCO DAILY TRANSFER ERROR REPORT                               00140001
      *                                                                 00150001
      * PROGRAM OBJECTIVE:                                              00160001
      * ------------------                                              00170001
      * SEQUENTIALLY READ DATA CREATED IN PROGRAM TFKUT008 AND CREATE   00180001
      * A REPORT OF ANY TRANSFERS NOT FOUND OR ALREADY POSITIVELY       00190001
      * RECEIVED.                                                       00200001
      *                                                                 00210001
      ******************************************************************00220001
      * CHANGE LOG:                                                     00230001
      * -----------                                                     00240001
      * WR/PROJ DATE       PGMR        DESCRIPTION OF CHANGES           00250001
      * ------- ---------- ----------- -------------------------------- 00260001
      * 40189   07-15-2011 C PARMLEY   ORIGINAL IMPLEMENTATION          00270001
      ******************************************************************00280001
                                                                        00290001
      ******************************************************************00300001
       ENVIRONMENT DIVISION.                                            00310001
      ******************************************************************00320001
                                                                        00330001
      ******************************************************************00340001
       CONFIGURATION SECTION.                                           00350001
                                                                        00360001
      ******************************************************************00370001
       INPUT-OUTPUT SECTION.                                            00380001
                                                                        00390001
      ******************************************************************00400001
       FILE-CONTROL.                                                    00410001
                                                                        00420001
           SELECT ERROR-XFER-DTL                                        00430001
               ASSIGN TO INP01.                                         00440001
                                                                        00450001
           SELECT CONTROL-CARD-DTE                                      00460001
               ASSIGN TO INP02.                                         00470008
                                                                        00480001
           SELECT ERROR-XFER-RPT                                        00490001
               ASSIGN TO RPT01.                                         00500001
                                                                        00510001
      /*****************************************************************00520001
       DATA DIVISION.                                                   00530001
      ******************************************************************00540001
                                                                        00550001
      ******************************************************************00560001
       FILE SECTION.                                                    00570001
                                                                        00580001
       FD  ERROR-XFER-DTL                                               00590001
           RECORDING MODE IS F                                          00600001
           BLOCK CONTAINS 0 RECORDS.                                    00610001
                                                                        00620001
       01  ERROR-XFER-DTL-RCD          PIC  X(200).                     00630001
                                                                        00640001
       FD  CONTROL-CARD-DTE                                             00650001
           RECORDING MODE F                                             00660001
           LABEL RECORDS ARE STANDARD                                   00670001
           RECORD CONTAINS 80 CHARACTERS                                00680001
           BLOCK CONTAINS 0 RECORDS                                     00690001
           DATA RECORD IS CNTRL-CARD-DTE-REC.                           00700001
                                                                        00710001
       01  CNTRL-CARD-DTE-REC          PIC  X(80).                      00720001
                                                                        00730001
       FD  ERROR-XFER-RPT                                               00740001
           RECORDING MODE IS F                                          00750001
           BLOCK CONTAINS 0 RECORDS.                                    00760001
                                                                        00770001
       01  ERROR-XFER-RPT-RCD          PIC  X(133).                     00780001
                                                                        00790001
      ******************************************************************00800001
       WORKING-STORAGE SECTION.                                         00810001
                                                                        00820001
      ******************************************************************00830001
       01  PS-PROGRAM-SWITCHES.                                         00840001
           05  PS-ERROR-XFER-DTL-EOF-SW                                 00850001
                                       PIC  X(01)          VALUE 'N'.   00860001
               88  PS-ERROR-XFER-DTL-EOF                   VALUE 'Y'.   00870001
               88  PS-NOT-ERROR-XFER-DTL-EOF               VALUE 'N'.   00880018
           05  PS-END-OF-CNTL-CRD-SW       PIC X(01).                   00890001
               88  PS-END-OF-CNTL-CRD-FILE              VALUE 'Y'.      00900001
               88  PS-NOT-END-OF-CNTL-CRD-FILE          VALUE 'N'.      00910001
                                                                        00920001
      ******************************************************************00930001
       01  PC-PROGRAM-CONSTANTS.                                        00940001
           05  PC-PROGRAM-NAME         PIC  X(08)          VALUE        00950001
               'TFKRP008'.                                              00960001
           05  PC-LINE-MAX             PIC S9(03)          VALUE +66    00970001
                                                           COMP-3.      00980001
           05  PC-MINUS                PIC  X(01)          VALUE '-'.   00990004
                                                                        01000001
      ******************************************************************01010001
       01  PT-PROGRAM-TOTALS.                                           01020001
           05  PT-FIRSTXFER-RCD-FND    PIC S9(09)          VALUE ZEROS  01030001
                                                           COMP-3.      01040001
           05  PT-RCD-WRTTN            PIC S9(09)          VALUE ZEROS  01050001
                                                           COMP-3.      01060001
           05  PT-DISPLAY-CNTR         PIC S9(09)          VALUE +0     01070001
                                                           COMP-3.      01080001
               88  PT-DISPLAY-CNTR-CNT                     VALUE        01090001
                   5000000.                                             01100001
      *            5000.                                                01110001
                                                                        01120001
      ******************************************************************01130001
       01  CC-DATES.                                                    01140001
           05  CC-PROCESS-DATE         PIC X(10)           VALUE SPACE. 01150001
                                                                        01160001
      ******************************************************************01170001
       01  PV-PROGRAM-VARIABLES.                                        01180001
           05  PV-PARAGRAPH-NAME       PIC  X(25)          VALUE SPACE. 01190001
           05  PV-ABEND-MESSAGE        PIC  X(50)          VALUE SPACE. 01200001
           05  PV-OPER-ATTEMPTED       PIC  X(30)          VALUE SPACE. 01210001
           05  PV-PREV-FR-LOC-NBR      PIC S9(04)          VALUE +0     01220001
                                                           COMP.        01230001
           05  PV-PREV-TO-LOC-NBR      PIC S9(04)          VALUE +0     01240001
                                                           COMP.        01250001
           05  PV-PREV-XFER-QTY-TOTAL  PIC S9(09)          VALUE +0     01260001
                                                           COMP.        01270001
           05  PV-PREV-XFER-RTL-TOTAL  PIC S9(09)V99       VALUE +0     01280001
                                                           COMP-3.      01290001
                                                                        01300001
           05  PV-LINE-COUNT           PIC S9(03)          VALUE +67    01310001
                                                           COMP-3.      01320001
           05  PV-PAGE-COUNT           PIC S9(05)          VALUE +0     01330001
                                                           COMP-3.      01340001
           05  PV-TOTAL-TRANS          PIC S9(09)          VALUE +0     01350001
                                                           COMP.        01360001
           05  PV-TOTAL-QTY            PIC S9(09)V99       VALUE +0     01370001
                                                           COMP-3.      01380001
           05  PV-TOTAL-RTL            PIC S9(09)V99       VALUE +0     01390001
                                                           COMP-3.      01400001
                                                                        01410001
      ******************************************************************01420001
       01  ABEND-CODE                   PIC S9(04)  VALUE +0  COMP SYNC.01430001
           88  AC-DB2-ERROR                         VALUE +4013.        01440001
           88  AC-NON-DB2-ERROR                     VALUE +4003.        01450001
           88  AC-DATE-ROUTINE-ERROR                VALUE +4019.        01460001
      ******************************************************************01470001
                                                                        01480001
       01  SDT-SYSTEM-DATE-TIME.                                        01490001
           05  SDT-YYYYMMDD            PIC  9(08)          VALUE ZEROS. 01500001
           05  FILLER REDEFINES SDT-YYYYMMDD.                           01510001
               10  SDT-YYYYMMDD-CCYY.                                   01520001
                   15  SDT-YYYYMMDD-CC PIC  X(02).                      01530001
                   15  SDT-YYYYMMDD-YY PIC  X(02).                      01540001
               10  SDT-YYYYMMDD-MM     PIC  X(02).                      01550001
               10  SDT-YYYYMMDD-DD     PIC  X(02).                      01560001
           05  SDT-HHMMSS              PIC  9(08)          VALUE ZEROS. 01570001
           05  FILLER REDEFINES SDT-HHMMSS.                             01580001
               10  SDT-HHMMSS-HH       PIC  X(02).                      01590001
               10  SDT-HHMMSS-MM       PIC  X(02).                      01600001
               10  SDT-HHMMSS-SS       PIC  X(02).                      01610001
               10  FILLER              PIC  X(02).                      01620001
                                                                        01630001
      ******************************************************************01640001
      **DATE LAYOUT                                                     01650001
      ******************************************************************01660001
       01  DB2-DATE.                                                    01670001
           05  DB2-DATE-CCYY           PIC X(04).                       01680001
           05  FILLER                  PIC X(01) VALUE '-'.             01690001
           05  DB2-DATE-MM             PIC X(02).                       01700001
           05  FILLER                  PIC X(01) VALUE '-'.             01710001
           05  DB2-DATE-DD             PIC X(02).                       01720001
                                                                        01730001
      *----------------------------------------------------------------*01740001
      *    COPYBOOK LAYOUT FOR THE CALENDAR ROUTINE                    *01750001
      *----------------------------------------------------------------*01760001
           COPY DPWS500.                                                01770001
                                                                        01780001
      *----------------------------------------------------------------*01790001
      *    VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004     *01800001
      *----------------------------------------------------------------*01810001
           COPY DPWS004.                                                01820001
                                                                        01830001
      *----------------------------------------------------------------*01840001
      *  ERROR XFER DETAIL                                              01850001
      *----------------------------------------------------------------*01860001
           COPY TFRD066.                                                01870001
                                                                        01880001
      *----------------------------------------------------------------*01890001
      *    COPYBOOK LAYOUT FOR THE CONTROL CARD                        *01900001
      *----------------------------------------------------------------*01910001
           COPY TFRD069.                                                01920001
                                                                        01930001
      *----------------------------------------------------------------*01940001
      * DB2 MESSAGE AREA                                                01950001
      *----------------------------------------------------------------*01960001
           COPY SQLCA2.                                                 01970001
                                                                        01980001
      *----------------------------------------------------------------*01990001
      * STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                 02000001
      *----------------------------------------------------------------*02010001
           EXEC SQL                                                     02020001
               INCLUDE SQLCA                                            02030001
           END-EXEC.                                                    02040001
                                                                        02050001
      *----------------------------------------------------------------*02060001
      * XST_LOC                                                         02070001
      *----------------------------------------------------------------*02080001
           EXEC SQL                                                     02090001
               INCLUDE XST00001                                         02100001
           END-EXEC.                                                    02110001
                                                                        02120001
      ******************************************************************02130001
      * COPY FOR STANDARD HEADING                                       02140001
      ******************************************************************02150001
           COPY DPWS132O.                                               02160001
                                                                        02170001
      ******************************************************************02180001
       01  RHL1-RPT-HEAD-LINE1.                                         02190001
           05  FILLER                  PIC  X(48)          VALUE SPACE. 02200001
           05  FILLER                  PIC  X(33)          VALUE        02210001
               'GENCO DAILY TRANSFER ERROR REPORT'.                     02220001
                                                                        02230001
      ******************************************************************02240001
       01  RHL2-RPT-HEAD-LINE2.                                         02250001
           05  FILLER                  PIC  X(49)          VALUE SPACE. 02260001
           05  FILLER                  PIC  X(11)          VALUE        02270001
               'FOR DATE  '.                                            02280001
           05  RHL2-DTE-BEGIN          PIC  X(10)          VALUE SPACE. 02290001
                                                                        02300001
      ******************************************************************02310001
       01  RHL3-RPT-HEAD-LINE3.                                         02320001
           05  FILLER                  PIC  X(05)          VALUE        02330001
               '  TO '.                                                 02340001
           05  FILLER                  PIC  X(23)          VALUE SPACE. 02350001
           05  FILLER                  PIC  X(08)          VALUE        02360001
               'TRANSFER'.                                              02370001
           05  FILLER                  PIC  X(04)          VALUE SPACE. 02380001
           05  FILLER                  PIC  X(08)          VALUE        02390001
               'CALLBACK'.                                              02400001
           05  FILLER                  PIC  X(03)          VALUE SPACE. 02410001
           05  FILLER                  PIC  X(06)          VALUE        02420001
               'CREATE'.                                                02430001
           05  FILLER                  PIC  X(05)          VALUE SPACE. 02440022
           05  FILLER                  PIC  X(08)          VALUE        02450001
               '1ST RCVD'.                                              02460001
           05  FILLER                  PIC  X(03)          VALUE SPACE. 02470001
           05  FILLER                  PIC  X(08)          VALUE        02480001
               '2ND RCVD'.                                              02490001
           05  FILLER                  PIC  X(05)          VALUE SPACE. 02500006
           05  FILLER                  PIC  X(05)          VALUE        02510001
               'TOTAL'.                                                 02520001
           05  FILLER                  PIC  X(06)          VALUE SPACE. 02530007
           05  FILLER                  PIC  X(05)          VALUE        02540001
               'TOTAL'.                                                 02550001
                                                                        02560001
      ******************************************************************02570001
       01  RHL4-RPT-HEAD-LINE4.                                         02580001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 02590001
           05  FILLER                  PIC  X(03)          VALUE        02600001
               'LOC'.                                                   02610001
           05  FILLER                  PIC  X(02)          VALUE SPACE. 02620001
           05  FILLER                  PIC  X(13)          VALUE        02630001
               'TRANSFER TYPE'.                                         02640001
           05  FILLER                  PIC  X(11)          VALUE SPACE. 02650001
           05  FILLER                  PIC  X(02)          VALUE        02660001
               'NO'.                                                    02670001
           05  FILLER                  PIC  X(09)          VALUE SPACE. 02680001
           05  FILLER                  PIC  X(02)          VALUE        02690001
               'NO'.                                                    02700001
           05  FILLER                  PIC  X(08)          VALUE SPACE. 02710001
           05  FILLER                  PIC  X(05)          VALUE        02720001
               'DATE'.                                                  02730001
           05  FILLER                  PIC  X(07)          VALUE SPACE. 02740023
           05  FILLER                  PIC  X(04)          VALUE        02750001
               'DATE'.                                                  02760001
           05  FILLER                  PIC  X(07)          VALUE SPACE. 02770023
           05  FILLER                  PIC  X(04)          VALUE        02780001
               'DATE'.                                                  02790001
           05  FILLER                  PIC  X(09)          VALUE SPACE. 02800006
           05  FILLER                  PIC  X(03)          VALUE        02810001
               'QTY'.                                                   02820001
           05  FILLER                  PIC  X(06)          VALUE SPACE. 02830001
           05  FILLER                  PIC  X(07)          VALUE        02840001
               'RETAIL'.                                                02850001
           05  FILLER                  PIC  X(02)          VALUE SPACE. 02860001
           05  FILLER                  PIC  X(11)          VALUE        02870001
               'RECEIVED BY'.                                           02880001
           05  FILLER                  PIC  X(03)          VALUE SPACE. 02890025
           05  FILLER                  PIC  X(05)          VALUE        02900001
               'ERROR'.                                                 02910001
                                                                        02920001
      ******************************************************************02930001
       01  RHL5-RPT-HEAD-LINE5.                                         02940001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 02950001
           05  FILLER                  PIC  X(04)          VALUE        02960001
               '----'.                                                  02970001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 02980001
           05  FILLER                  PIC  X(20)          VALUE        02990001
               '--------------------'.                                  03000001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 03010001
           05  FILLER                  PIC  X(11)          VALUE        03020001
               '-----------'.                                           03030001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 03040001
           05  FILLER                  PIC  X(08)          VALUE        03050001
               '--------'.                                              03060001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 03070001
           05  FILLER                  PIC  X(10)          VALUE        03080001
               '----------'.                                            03090001
           05  FILLER                  PIC  X(03)          VALUE SPACE. 03100022
           05  FILLER                  PIC  X(10)          VALUE        03110001
               '----------'.                                            03120001
           05  FILLER                  PIC  X(02)          VALUE SPACE. 03130026
           05  FILLER                  PIC  X(10)          VALUE        03140001
               '----------'.                                            03150001
           05  FILLER                  PIC  X(04)          VALUE SPACE. 03160026
           05  FILLER                  PIC  X(04)          VALUE        03170001
               '----'.                                                  03180001
           05  FILLER                  PIC  X(04)          VALUE SPACE. 03190001
           05  FILLER                  PIC  X(09)          VALUE        03200001
               '---------'.                                             03210001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 03220001
           05  FILLER                  PIC  X(11)          VALUE        03230001
               '-----------'.                                           03240001
           05  FILLER                  PIC  X(03)          VALUE SPACE. 03250025
           05  FILLER                  PIC  X(10)          VALUE        03260001
               '----------'.                                            03270001
      ******************************************************************03280016
       01  RHL6-RPT-HEAD-LINE6.                                         03290016
           05  FILLER                  PIC  X(32)          VALUE SPACE. 03300016
           05  FILLER                  PIC  X(46)          VALUE        03310016
           '****  NO DATA TO PROCESS FOR THIS REPORT  ****'.            03320016
                                                                        03330001
      ******************************************************************03340016
       01  RHL7-RPT-HEAD-LINE7.                                         03350016
           05  FILLER                  PIC  X(53)          VALUE SPACE. 03360016
           05  FILLER                  PIC  X(21)          VALUE        03370016
           '*** END OF REPORT ***'.                                     03380016
                                                                        03390016
      ******************************************************************03400001
      *  REPORT DETAIL                                                  03410001
      ******************************************************************03420001
       01  XRDL-XFER-RPT-DTL-LINE.                                      03430001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 03440001
           05  XRDL-TO-LOC-NBR         PIC  9(04)          VALUE ZEROS. 03450001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 03460001
           05  XRDL-TRANS-TYPE         PIC  X(20)          VALUE SPACE. 03470001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 03480001
           05  XRDL-STR-NBR            PIC  9(04)          VALUE ZEROS. 03490001
           05  FILLER                  PIC  X(01)          VALUE '-'.   03500001
           05  XRDL-SEQ-NBR            PIC  9(06)          VALUE ZEROS. 03510001
           05  FILLER                  PIC  X(03)          VALUE SPACE. 03520001
           05  XRDL-CLBK-NBR           PIC  X(04)          VALUE SPACE. 03530001
           05  FILLER                  PIC  X(03)          VALUE SPACE. 03540001
           05  XRDL-DTE-CMPLT-XFER     PIC  X(10)          VALUE SPACE. 03550001
           05  FILLER                  PIC  X(03)          VALUE SPACE. 03560022
           05  XRDL-XFER-DTE-RCVD1     PIC  X(10)          VALUE SPACE. 03570001
           05  FILLER                  PIC  X(02)          VALUE SPACE. 03580001
           05  XRDL-XFER-DTE-RCVD2     PIC  X(10)          VALUE SPACE. 03590001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 03600027
           05  XRDL-TOTAL-QTY          PIC  Z(06)9(01)     VALUE ZEROS. 03610027
           05  FILLER                  PIC  X(01)          VALUE SPACE. 03611027
           05  XRDL-TOTAL-RTL          PIC  Z(08)9(01).99  VALUE ZEROS. 03620027
           05  XRDL-MINUS              PIC  X(01)          VALUE SPACE. 03630009
           05  FILLER                  PIC  X(01)          VALUE SPACE. 03640027
           05  XRDL-RCVD-1ST-INIT      PIC  X(01)          VALUE SPACE. 03650001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 03660001
           05  XRDL-RCVD-LAST-NM       PIC  X(10)          VALUE SPACE. 03670007
           05  FILLER                  PIC  X(01)          VALUE SPACE. 03680001
           05  XRDL-ERROR              PIC  X(10)          VALUE SPACE. 03690001
      ******************************************************************03700001
      *  REPORT TOTALS                                                  03710001
      ******************************************************************03720001
       01  XRDL-XFER-RPT-TTL-LINE.                                      03730001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 03740015
           05  XRDL-TTL-ABBR           PIC  X(10)          VALUE SPACE. 03750015
           05  FILLER                  PIC  X(02)          VALUE SPACE. 03760012
           05  XRDL-TTL-TO-LOC         PIC  9(04)          VALUE ZEROS. 03770001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 03780001
           05  FILLER                  PIC  X(08)          VALUE        03790001
               'TOTALS: '.                                              03800001
           05  XRDL-TTL-TOTAL-TRANS    PIC  Z(06)9(01)     VALUE ZEROS. 03810009
           05  FILLER                  PIC  X(51)          VALUE SPACE. 03820028
           05  XRDL-TTL-TOTAL-QTY      PIC  Z(06)9(01)     VALUE ZEROS. 03830028
           05  FILLER                  PIC  X(01)          VALUE SPACE. 03831028
           05  XRDL-TTL-TOTAL-RTL      PIC  Z(08)9(01).99- VALUE ZEROS. 03840028
                                                                        03850001
      ******************************************************************03860001
       LINKAGE SECTION.                                                 03870001
                                                                        03880001
      /*****************************************************************03890001
       PROCEDURE DIVISION.                                              03900001
      ******************************************************************03910001
                                                                        03920001
      ******************************************************************03930001
      *  MAIN PROCESSING.                                               03940001
      ******************************************************************03950001
       0000-MAIN-MODULE.                                                03960001
                                                                        03970001
           DISPLAY '**********************************'.                03980001
           DISPLAY '* START OF TFKRP008               '.                03990001
           DISPLAY '**********************************'.                04000001
                                                                        04010001
           PERFORM 0100-INITIALIZE.                                     04020001
                                                                        04030001
           PERFORM 1000-PROCESS-XFER-DTL                                04190001
             UNTIL PS-ERROR-XFER-DTL-EOF.                               04200001
                                                                        04210001
           PERFORM 8240-WRITE-TOTAL-LINE.                               04220001
                                                                        04230001
           PERFORM 8900-CLOSE-FILES.                                    04240001
                                                                        04250001
           PERFORM 0900-DISPLAY-PROGRAM-TOTALS.                         04260001
                                                                        04270001
           GOBACK.                                                      04280001
                                                                        04290001
      ******************************************************************04300001
      *                                                                 04310001
      ******************************************************************04320001
       0100-INITIALIZE.                                                 04330001
                                                                        04340001
           ACCEPT SDT-YYYYMMDD         FROM DATE YYYYMMDD.              04350001
           ACCEPT SDT-HHMMSS           FROM TIME.                       04360001
                                                                        04370001
           DISPLAY 'TFKRP008 RUN DATE: ' SDT-YYYYMMDD ' - '             04380001
              SDT-HHMMSS.                                               04390001
                                                                        04400001
           MOVE SDT-YYYYMMDD-YY        TO DP132O-RUN-YEAR.              04410001
           MOVE SDT-YYYYMMDD-MM        TO DP132O-RUN-MONTH.             04420001
           MOVE SDT-YYYYMMDD-DD        TO DP132O-RUN-DAY.               04430001
           MOVE SDT-HHMMSS-HH          TO DP132O-RUN-HOUR.              04440001
           MOVE SDT-HHMMSS-MM          TO DP132O-RUN-MINUTE.            04450001
           MOVE 'TFKRP008'             TO DP132O-PROGRAM-NAME.          04460001
           MOVE 1                      TO DP132O-REPORT-NUMBER.         04470001
                                                                        04480001
           PERFORM 8000-OPEN-FILES.                                     04481021
                                                                        04482021
           PERFORM 8100-READ-ERROR-XFER-DTL.                            04483021
                                                                        04484021
           IF NOT PS-ERROR-XFER-DTL-EOF                                 04485021
               INITIALIZE DB2-DATE                                      04486021
               MOVE TF066-TRANSFER-DATE(1:4) TO DB2-DATE-CCYY           04487021
               MOVE TF066-TRANSFER-DATE(5:2) TO DB2-DATE-MM             04488021
               MOVE TF066-TRANSFER-DATE(7:2) TO DB2-DATE-DD             04489021
               MOVE DB2-DATE                 TO RHL2-DTE-BEGIN          04489121
           ELSE                                                         04489221
               PERFORM 1050-READ-CURR-DTE-CARD                          04489321
               PERFORM 1060-NO-DATA-ON-REPORT                           04489421
           END-IF.                                                      04489521
                                                                        04489621
      ******************************************************************04490001
       0900-DISPLAY-PROGRAM-TOTALS.                                     04500001
                                                                        04510001
           DISPLAY '**********************************'.                04520001
           DISPLAY '* TFKRP008 PROGRAM STATISTICS:    '.                04530001
           DISPLAY '**********************************'.                04540001
           DISPLAY '* TOTAL XFERS READ: ' PT-FIRSTXFER-RCD-FND.         04550001
           DISPLAY '* REPORT DETAIL WRITTEN: ' PT-RCD-WRTTN.            04560001
           DISPLAY '**********************************'.                04570001
           DISPLAY '**********************************'.                04580001
           DISPLAY '* END OF TFKRP008                 '.                04590001
           DISPLAY '**********************************'.                04600001
                                                                        04610001
      /*****************************************************************04620001
      *                                                                 04630001
      ******************************************************************04640001
       1000-PROCESS-XFER-DTL.                                           04650001
                                                                        04660001
           IF TF066-TO-STR-NBR NOT = PV-PREV-TO-LOC-NBR                 04670002
               PERFORM 8215-WRITE-XFER-RPT-TOT                          04680002
               MOVE TF066-TO-STR-NBR   TO PV-PREV-TO-LOC-NBR            04690002
           END-IF.                                                      04700001
                                                                        04710001
           PERFORM 2000-FMT-XFER-RPT-RCD.                               04720001
                                                                        04730001
           PERFORM 8100-READ-ERROR-XFER-DTL.                            04740001
                                                                        04750001
072500*----------------------------------------------------------       04751021
072700*     READ CONTROL CARD TFRD069.                                  04752021
072900*----------------------------------------------------------       04753021
073000 1050-READ-CURR-DTE-CARD.                                         04754021
073100                                                                  04755021
           OPEN INPUT CONTROL-CARD-DTE.                                 04756021
                                                                        04757021
073200     READ CONTROL-CARD-DTE                                        04758021
073300                          INTO TF069-CC-CONTROL-CARD              04759021
073400       AT END                                                     04759121
073500          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    04759221
073600                                                                  04759321
073700     IF PS-END-OF-CNTL-CRD-FILE                                   04759421
073800       DISPLAY ' '                                                04759521
073900       DISPLAY '** ABEND     **'                                  04759621
074000       DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME              04759721
074100       DISPLAY '** PARAGRAPH **  = 1050-READ-CURR-DTE-CARD'       04759821
074200       DISPLAY '** CONTROL FILE IS EMPTY  '                       04759921
074300       DISPLAY ' '                                                04760021
074400       MOVE +4003 TO ABEND-CODE                                   04760121
074500       CALL 'ILBOABN0' USING ABEND-CODE                           04760221
074600     ELSE                                                         04760321
074700       DISPLAY '** CURRENT TRANSFER DATE CONTROL CARD  **'        04760421
074800       DISPLAY '** TFCC011       **  = ' TF069-CC-CRNT-DTE        04760521
074900       DISPLAY ' '                                                04760621
075000     END-IF.                                                      04760721
075100                                                                  04760821
           INITIALIZE DB2-DATE.                                         04760921
           MOVE TF069-CC-CRNT-DTE(1:4)     TO DB2-DATE-CCYY.            04761021
           MOVE TF069-CC-CRNT-DTE(5:2)     TO DB2-DATE-MM.              04761121
           MOVE TF069-CC-CRNT-DTE(7:2)     TO DB2-DATE-DD.              04761221
                                                                        04761321
           CLOSE CONTROL-CARD-DTE.                                      04761421
                                                                        04761521
           PERFORM 8310-DATE-ROUTINE.                                   04761621
           MOVE DB2-DATE                   TO RHL2-DTE-BEGIN.           04761721
                                                                        04761821
      ******************************************************************04761921
      *  THIS ROUTINE WRITES HEADER AND NO DATA MESSAGE                 04762021
      ******************************************************************04762121
       1060-NO-DATA-ON-REPORT.                                          04762221
                                                                        04762321
           PERFORM 8220-WRITE-XFER-RPT-HDR.                             04762421
                                                                        04762521
           WRITE ERROR-XFER-RPT-RCD                                     04762621
             FROM RHL6-RPT-HEAD-LINE6                                   04762721
             AFTER ADVANCING 1 LINE.                                    04762821
                                                                        04762921
           WRITE ERROR-XFER-RPT-RCD                                     04763021
             FROM RHL7-RPT-HEAD-LINE7                                   04763121
             AFTER ADVANCING 1 LINE.                                    04763221
                                                                        04763321
      ******************************************************************04764001
       2000-FMT-XFER-RPT-RCD.                                           04770001
                                                                        04780001
           INITIALIZE                  XRDL-XFER-RPT-DTL-LINE.          04790001
           MOVE TF066-TO-STR-NBR         TO XRDL-TO-LOC-NBR.            04800002
           MOVE TF066-TRANSFER-TYPE-DESC TO XRDL-TRANS-TYPE.            04810002
           MOVE TF066-TRANSFER-NBR-STR   TO XRDL-STR-NBR.               04820002
           MOVE TF066-TRANSFER-NBR-SEQ   TO XRDL-SEQ-NBR.               04830002
           MOVE TF066-CALLBK-NBR       TO XRDL-CLBK-NBR.                04840002
           MOVE TF066-CREATE-DTE       TO XRDL-DTE-CMPLT-XFER.          04850002
           MOVE TF066-1ST-RCVD-DTE     TO XRDL-XFER-DTE-RCVD1.          04860002
           MOVE TF066-2ND-RCVD-DTE     TO XRDL-XFER-DTE-RCVD2.          04870002
           MOVE TF066-TOTAL-QTY        TO XRDL-TOTAL-QTY.               04880002
           MOVE TF066-TOTAL-RETAIL     TO XRDL-TOTAL-RTL.               04890002
           MOVE TF066-RCVD-BY-1ST-INIT TO XRDL-RCVD-1ST-INIT.           04900002
           MOVE TF066-RCVD-BY-LAST-NAME TO XRDL-RCVD-LAST-NM.           04910002
           MOVE TF066-ERROR-REASON      TO XRDL-ERROR.                  04920002
           ADD +1                       TO PV-TOTAL-TRANS.              04930005
           ADD TF066-TOTAL-QTY          TO PV-TOTAL-QTY.                04940005
           IF TF066-AMT-SIGN = PC-MINUS                                 04950004
               MOVE PC-MINUS            TO XRDL-MINUS                   04960008
               SUBTRACT TF066-TOTAL-RETAIL FROM PV-TOTAL-RTL            04970004
           ELSE                                                         04980004
               ADD TF066-TOTAL-RETAIL        TO PV-TOTAL-RTL            04990008
           END-IF.                                                      05000004
                                                                        05010001
           PERFORM 8200-WRITE-XFER-RPT-DTL.                             05020001
                                                                        05030001
      /*****************************************************************05040001
      *                                                                 05050001
      ******************************************************************05060001
       8000-OPEN-FILES.                                                 05070001
                                                                        05080001
           OPEN INPUT ERROR-XFER-DTL.                                   05090001
           OPEN OUTPUT ERROR-XFER-RPT.                                  05100001
                                                                        05110001
      ******************************************************************05120001
      *  READ INPUT DATA                                                05130001
      ******************************************************************05140001
       8100-READ-ERROR-XFER-DTL.                                        05150001
                                                                        05160001
           READ ERROR-XFER-DTL                                          05170001
             INTO TF066-RECVD-ERROR-REC                                 05180001
               AT END                                                   05190001
                 SET PS-ERROR-XFER-DTL-EOF                              05200001
                                       TO TRUE.                         05210001
                                                                        05220018
           IF PS-NOT-ERROR-XFER-DTL-EOF                                 05230018
               ADD +1 TO PT-FIRSTXFER-RCD-FND                           05240018
           END-IF.                                                      05250019
                                                                        05260001
      ******************************************************************05270001
      * 8200-WRITE-XFER-RPT-DTL                                         05280001
      ******************************************************************05290001
       8200-WRITE-XFER-RPT-DTL.                                         05300001
                                                                        05310001
           IF PV-LINE-COUNT >= PC-LINE-MAX                              05320001
               PERFORM 8220-WRITE-XFER-RPT-HDR                          05330002
           END-IF.                                                      05340001
                                                                        05350001
           WRITE ERROR-XFER-RPT-RCD                                     05360001
             FROM XRDL-XFER-RPT-DTL-LINE.                               05370001
                                                                        05380001
           ADD +1                      TO PT-RCD-WRTTN                  05390001
                                          PV-LINE-COUNT.                05400001
                                                                        05410001
      ******************************************************************05420001
      *                                                                 05430001
      ******************************************************************05440001
       8210-WRITE-DTL-BREAK-LINE.                                       05450001
                                                                        05460001
           IF PV-LINE-COUNT >= PC-LINE-MAX                              05470001
               PERFORM 8220-WRITE-XFER-RPT-HDR                          05480001
           ELSE                                                         05490001
               MOVE SPACE              TO ERROR-XFER-RPT-RCD            05500001
               WRITE ERROR-XFER-RPT-RCD                                 05510001
                 AFTER ADVANCING 1 LINE                                 05520001
                                                                        05530001
               ADD +1                  TO PV-LINE-COUNT                 05540001
           END-IF.                                                      05550001
                                                                        05560001
      ******************************************************************05570001
      * CHECK FOR NEW RTV LOCATION BREAK                                05580001
      ******************************************************************05590001
       8215-WRITE-XFER-RPT-TOT.                                         05600002
                                                                        05610001
           PERFORM 8240-WRITE-TOTAL-LINE.                               05620012
           MOVE ZERO               TO PV-PAGE-COUNT.                    05630012
           MOVE TF066-TO-STR-NBR   TO XST00001-LOC-NBR.                 05640012
           PERFORM 8230-GET-RTV-ABBR.                                   05650012
           MOVE XST00001-LOC-10-ABBR-NM TO XRDL-TTL-ABBR.               05660015
                                                                        05670001
      ******************************************************************05680002
      * CHECK FOR NEW RTV LOCATION BREAK                                05690002
      ******************************************************************05700002
       8220-WRITE-XFER-RPT-HDR.                                         05710002
                                                                        05720002
           IF TF066-TO-STR-NBR NOT = PV-PREV-TO-LOC-NBR                 05730002
               PERFORM 8240-WRITE-TOTAL-LINE                            05740012
               MOVE ZERO               TO PV-PAGE-COUNT                 05750002
               MOVE TF066-TO-STR-NBR   TO XST00001-LOC-NBR              05760012
               PERFORM 8230-GET-RTV-ABBR                                05770013
               MOVE XST00001-LOC-10-ABBR-NM TO XRDL-TTL-ABBR            05780015
           END-IF.                                                      05790002
                                                                        05800002
           ADD +1                      TO PV-PAGE-COUNT.                05810002
           MOVE PV-PAGE-COUNT          TO DP132O-PAGE-NUMBER.           05820002
                                                                        05830002
           WRITE ERROR-XFER-RPT-RCD                                     05840003
             FROM DP132O-STANDRD-HEADER-132-COLS                        05850002
             AFTER ADVANCING PAGE.                                      05860002
                                                                        05870002
           WRITE ERROR-XFER-RPT-RCD                                     05880003
             FROM RHL1-RPT-HEAD-LINE1                                   05890002
             AFTER ADVANCING 1 LINE.                                    05900002
                                                                        05910002
           WRITE ERROR-XFER-RPT-RCD                                     05920003
             FROM RHL2-RPT-HEAD-LINE2                                   05930002
             AFTER ADVANCING 1 LINE.                                    05940002
                                                                        05950002
           WRITE ERROR-XFER-RPT-RCD                                     05960003
             FROM RHL3-RPT-HEAD-LINE3                                   05970002
             AFTER ADVANCING 2 LINE.                                    05980002
                                                                        05990002
           WRITE ERROR-XFER-RPT-RCD                                     06000003
             FROM RHL4-RPT-HEAD-LINE4                                   06010002
             AFTER ADVANCING 1 LINE.                                    06020002
                                                                        06030002
           WRITE ERROR-XFER-RPT-RCD                                     06040003
             FROM RHL5-RPT-HEAD-LINE5                                   06050002
             AFTER ADVANCING 1 LINE.                                    06060002
                                                                        06070002
           MOVE SPACE                  TO ERROR-XFER-RPT-RCD.           06080003
           WRITE ERROR-XFER-RPT-RCD                                     06090003
             AFTER ADVANCING 1 LINE.                                    06100002
                                                                        06110002
           MOVE +8                     TO PV-LINE-COUNT.                06120002
                                                                        06130016
      ******************************************************************06290001
      *  THIS ROUTINE GETS THE RTV ABBR NAME                            06300012
      ******************************************************************06310001
       8230-GET-RTV-ABBR.                                               06320013
                                                                        06330001
           EXEC SQL                                                     06340001
             SELECT LOC_10_ABBR_NM                                      06350015
             INTO :XST00001-LOC-10-ABBR-NM                              06360015
             FROM XST_LOC                                               06370001
             WHERE LOC_NBR = :XST00001-LOC-NBR                          06380012
                WITH UR                                                 06381021
           END-EXEC.                                                    06390001
                                                                        06400001
           EVALUATE TRUE                                                06410001
               WHEN SQLCODE = +0                                        06420001
                   CONTINUE                                             06430001
               WHEN SQLCODE = +100                                      06440001
                   CONTINUE                                             06450001
               WHEN OTHER                                               06460001
                   MOVE 'SELECT-LOC     ' TO PV-PARAGRAPH-NAME          06470012
                   PERFORM 8800-DB2-ERROR-ROUTINE                       06480021
           END-EVALUATE.                                                06490001
                                                                        06500001
      *-----------------------------------------------------------------06510002
      * PRINTS THE TOTAL TRANSFERS, QTY AND RETAIL FOR RTV              06520002
      *-----------------------------------------------------------------06530002
       8240-WRITE-TOTAL-LINE.                                           06540002
           IF PV-PREV-TO-LOC-NBR NOT = ZERO                             06550002
               MOVE SPACE                  TO ERROR-XFER-RPT-RCD        06560003
               WRITE ERROR-XFER-RPT-RCD                                 06570003
                 AFTER ADVANCING 1 LINE                                 06580002
               MOVE PV-PREV-TO-LOC-NBR     TO XRDL-TTL-TO-LOC           06590002
               MOVE PV-TOTAL-TRANS         TO XRDL-TTL-TOTAL-TRANS      06600002
               MOVE PV-TOTAL-QTY           TO XRDL-TTL-TOTAL-QTY        06610002
               MOVE PV-TOTAL-RTL           TO XRDL-TTL-TOTAL-RTL        06620002
               WRITE ERROR-XFER-RPT-RCD                                 06630003
                           FROM XRDL-XFER-RPT-TTL-LINE                  06640010
                           AFTER ADVANCING 1 LINE                       06650010
               MOVE SPACE                  TO ERROR-XFER-RPT-RCD        06660010
               WRITE ERROR-XFER-RPT-RCD                                 06670010
                           AFTER ADVANCING 1 LINE                       06680010
               MOVE ZERO                   TO PV-TOTAL-TRANS            06690002
                                              PV-TOTAL-QTY              06700002
                                              PV-TOTAL-RTL              06710002
           END-IF.                                                      06720002
                                                                        06730002
                                                                        06740001
                                                                        07110001
268140*----------------------------------------------------------       07120001
268200* DATE ROUTINE TO SET UP THE PROCESS DATE IN                      07130001
268300* CCYYMMDD FORMAT.                                                07140001
268400*----------------------------------------------------------       07150001
268500 8310-DATE-ROUTINE.                                               07160001
268600                                                                  07170001
268700     INITIALIZE DPG51 DPG52 DPG53                                 07180001
268800                DPG54 DPG55 DPG56.                                07190001
268900                                                                  07200001
269000     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      07210001
269100     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      07220001
269200     MOVE DB2-DATE                   TO DPG52-DB2-ISO-DATE-FMT.   07230001
           DISPLAY 'DB2-DATE = ' DB2-DATE.                              07240001
269300                                                                  07250001
269400     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    07260001
269500                                             DPG54 DPG55 DPG56.   07270001
269600                                                                  07280001
269700     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  07290001
269800       DISPLAY '** ABEND **'                                      07300001
269900       DISPLAY '** PROGRAM = TFKRP008'                            07310001
270000       DISPLAY 'DATE = ' TF069-CC-CRNT-DTE                        07320001
270100       DISPLAY DPG54-ERROR-MESSAGE                                07330001
270200       MOVE 4019 TO ABEND-CODE                                    07340001
270300       CALL 'ILBOABN0' USING ABEND-CODE                           07350001
270400     END-IF.                                                      07360001
270500                                                                  07370001
      *-----------------------------------------------------------------07400001
      *8800-DB2-ERROR-ROUTINE.                                          07410021
      *-----------------------------------------------------------------07420001
       8800-DB2-ERROR-ROUTINE.                                          07430021
                                                                        07440001
           PERFORM 8900-CLOSE-FILES.                                    07450001
           MOVE SQLCODE TO SQLCODE2.                                    07460001
           MOVE SQLERRD(3) TO SQLERRD3.                                 07470001
                                                                        07480001
           DISPLAY '** ERROR **        = SQL ERROR'.                    07490001
           DISPLAY '** PROGRAM **      = '  PC-PROGRAM-NAME.            07500001
           DISPLAY '** PARAGRAPH **    = '  PV-PARAGRAPH-NAME.          07510001
           DISPLAY '** SQL ERROR **    = '  SQLCODE2.                   07520001
           DISPLAY '** SQLERRM  **     = '  SQLERRM.                    07530001
                                                                        07540001
      *----------------------------------------------------------------*07550001
      *  THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   07560001
      *  MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        07570001
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     07580001
      *  FORMAT.                                                        07590001
      *----------------------------------------------------------------*07600001
           COPY DPPD004.                                                07610001
                                                                        07620001
           CALL 'DSNTIAR' USING SQLCA                                   07630001
                                DP004-FORMATTED-MESSAGE                 07640001
                                DP004-ERROR-LINE-LENGTH.                07650001
                                                                        07660001
           DISPLAY DP004-ASTERISK-LINE.                                 07670001
                                                                        07680001
           PERFORM                                                      07690001
              VARYING DP004-MSG-IDX                                     07700001
              FROM 1 BY 1                                               07710001
              UNTIL DP004-MSG-IDX > DP004-MAX-MESSAGE-LINES             07720001
                  DISPLAY '**'                                          07730001
                          DP004-MESSAGE-LINE (DP004-MSG-IDX)            07740001
                          ' **'                                         07750001
           END-PERFORM.                                                 07760001
                                                                        07770001
           DISPLAY DP004-ASTERISK-LINE.                                 07780001
                                                                        07790001
           IF SQLCODE NOT = -911                                        07800001
               EXEC SQL                                                 07810001
                   COMMIT                                               07820001
               END-EXEC                                                 07830001
           END-IF.                                                      07840001
                                                                        07850001
           SET AC-DB2-ERROR TO TRUE.                                    07860001
                                                                        07870001
           CALL 'ILBOABN0' USING ABEND-CODE.                            07880001
                                                                        07890001
      ******************************************************************07900001
      *    CLOSE THE FILES.                                             07910001
      ******************************************************************07920001
       8900-CLOSE-FILES.                                                07930001
                                                                        07940001
           CLOSE ERROR-XFER-DTL                                         07950001
                 ERROR-XFER-RPT.                                        07960001
                                                                        07970001
      ******************************************************************07980001
      *  THIS ROUTINE FORCES AN ABEND DUE TO A NON-DB2 RELATED PROBLEM. 07990001
      ******************************************************************08000001
       9999-ABEND.                                                      08010001
                                                                        08020001
           DISPLAY '**********************************'.                08030001
           DISPLAY '**  ABEND     **'.                                  08040001
           DISPLAY '**  PROGRAM   **  = ' PC-PROGRAM-NAME.              08050001
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            08060001
           DISPLAY '**  OPERATION **  = ' PV-OPER-ATTEMPTED.            08070001
           DISPLAY '**********************************'.                08080001
           SET AC-NON-DB2-ERROR TO TRUE.                                08090001
           CALL 'ILBOABN0'  USING ABEND-CODE.                           08100001
                                                                        08110001
