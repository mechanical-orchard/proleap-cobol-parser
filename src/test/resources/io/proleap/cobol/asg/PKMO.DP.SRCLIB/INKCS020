       IDENTIFICATION DIVISION.                                         00010000
00003 *-----------------------*                                         00020000
00004  PROGRAM-ID.    INKCS020.                                         00030000
00005  AUTHOR.        TESS BESTE.                                       00040000
00006  INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
00007  DATE-WRITTEN.  08-02-93.                                         00060000
00008  DATE-COMPILED.                                                   00070000
00009 *----------------------------------------------------------------*00080000
00010 *    I020 - PHYSICAL INVENTORY STOCKROOM WITHDRAWAL SELECTION    *00090000
00011 *                                                                *00100000
00012 *    THIS PROGRAM ALLOWS THE USER ENTER DATA TO BE USED BY       *00110000
00013 *    SUBSEQUENT PROGRAMS TO CREATE A LIST OR TO BRING UP A       *00120000
00014 *    DETAIL SCREEN.                                              *00130000
00015 *                                                                *00140000
00016 *    IF THE OPERATOR IS LOCATED AT CORPORATE, THE PROGRAM        *00150000
00017 *    PROMPTS FOR A STORE NUMBER. THE STORE NUMBER MUST BE        *00160000
00018 *    NUMERIC AND NON-ZERO. IF THE OPERATOR IS LOCATED AT A       *00170000
00019 *    SELLING STORE, THE PROGRAM FILLS IN AND PROTECTS THE STORE  *00180000
00020 *    NUMBER.                                                     *00190000
00021 *                                                                *00200000
00022 *    A SHEET NUMBER MUST BE ENTERED. IT MUST BE NUMERIC AND NON- *00210000
00023 *    ZERO, OR IT MUST CONTAIN ONE OR MORE ASTERISKS.             *00220000
00024 *                                                                *00230000
00025 *    ALL ADDITIONAL EDITING IS DONE IN THE DETAIL PROGRAMS.      *00240000
00024 *                                                                *00250000
00026 *    CHANGES MADE WR#99999 - SCOTT JACKSON 1/7/98                *00260000
00026 *      CHANGE ASHEETA ATTRIBUTE TO ACCEPT ALPHANUMERIC (***)     *00270000
00026 *      ENTRY FOR SHEET NUMBER TO DISPLAY ALL SHEETS FOR STORE    *00280000
00024 *                                                                *00290000
00026 *    CHANGES MADE WR#99999 - SCOTT JACKSON 4/28/99               *00300000
00026 *      REMOVED REFERENCE TO DPG51-SYSTEM-DATE.  THE CALENDAR     *00310000
00026 *      ROUTINE NO LONGER USES THIS FIELD.                        *00320000
00024 *                                                                *00330000
00026 *    CHANGES MADE WR#99999 - JULIE SEIDLER 5/16/00               *00340000
00026 *      CHANGE PROGRAM TO CHECK IF ACTUAL-INV-DATE FOR THE STORE  *00350000
00026 *      AS BEEN SET WITH A VALID DATE.  IF THE ACTUAL-INV-DATE    *00360000
00026 *      CONTAINS 9'S, AN ERROR MESSAGE WILL APPEAR.               *00370000
      *                                                                *00380000
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES                    *00390000
      * -------  ----------  ----------------------------------------  *00400000
      * 22000    02-28-2001  CHANGE TO GIVE THE USER AN OPTION TO      *00410000
      *                      TOGGLE ON/OFF THEIR STOCKROOM WITHDRAWAL  *00420000
      *                      INDICATOR TO SAY THAT THEY HAVE NO        *00430000
      *                      STOCKROOM WITHDRAWAL.   -V. LEE YANG      *00440000
      * 22960    01-31-2002  UPDATE PROGRAM TO GIVE USER MORE          *00450000
      *                      MEANINGFUL FEEDBACK WHEN UPDATING THE     *00460000
      *                      STOCKROOM WITHDRAWAL INDICATOR.           *00470000
      *                                              -V. LEE YANG      *00480000
      * 25428    10-16-2003  ADD UNT_BKG_STAT_CDE TO INVPAR-CSR. DO    *00490000
      *                      NOT ALLOW CHANGES AFTER STORE SELECTED    *00500000
      *                      FOR UNIT BOOKING                          *00510000
      *                                              -SCOTT JACKSON    *00520000
W26600* W26600   06-29-2004  ROD JANSSEN INV STORE EXPANSION            00521000
W28545* W28545   03-29-2006  INV STORE EXPANSION CORRECTION             00522100
J28545* W28545   06-16-2006  TINVPAR/TINCNTL ARE USED TO GET            00522200
J28545*                      THE PROPER INV-ID AND STORE                00522300
J28545*                      -JAN BLAZICH                               00522400
      * W33304   05-01-2008  HOLDING INVENTORY LEDGER OPEN ACROSS       00522506
      *                      PERIODS INVENTORY SHORTAGEREPORTING        00522606
      *                      -JILL LIN                                  00522706
00026 ******************************************************************00523000
263126* CHANGED 10/25/2021    BY JIM HUNTER      WR: CHG0263126         00523108
263126* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00523208
263126* MAKING THE CALL DYNAMIC VS STATIC.                              00523308
00026 ******************************************************************00523409
1122RM* CHANGED 11/03/2022    BY BOB MCASEY      WR: CHG0277188         00523509
1122RM* ADDED THE DPKCS930 COPYBOOK. CHANGED THE PARAMETERS FOR CALLING 00523609
1122RM* THE CICS ARCHITECTURE API.                                      00523709
1122RM*---------------------------------------------------------------* 00523809
00027                                                                   00524000
00030  ENVIRONMENT DIVISION.                                            00525000
00034  DATA DIVISION.                                                   00526000
00036                                                                   00527000
00037  WORKING-STORAGE SECTION.                                         00528000
00038 *                                                                 00529000
00039  01  PC-PROGRAM-CONSTANTS.                                        00530000
00040      05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'IN020A  '. 00540000
00041      05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'INKM020 '. 00550000
00042      05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'INKCS020'. 00560000
00043      05  PC-TSYMSG-NUMBERS.                                       00570000
00044          10  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.      00580000
00045          10  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.      00590000
00046          10  PC-TSYMSG-00010       PIC  9(05)  VALUE  00010.      00600000
00047          10  PC-TSYMSG-00017       PIC  9(05)  VALUE  00017.      00610000
22000          10  PC-TSYMSG-00046       PIC  9(05)  VALUE  00046.      00620000
22000          10  PC-TSYMSG-00059       PIC  9(05)  VALUE  00059.      00630000
00048          10  PC-TSYMSG-00550       PIC  9(05)  VALUE  00550.      00640000
00049          10  PC-TSYMSG-00551       PIC  9(05)  VALUE  00551.      00650000
22960          10  PC-TSYMSG-02894       PIC  9(05)  VALUE  02894.      00660000
22960          10  PC-TSYMSG-02895       PIC  9(05)  VALUE  02895.      00670000
22960          10  PC-TSYMSG-02896       PIC  9(05)  VALUE  02896.      00680000
22960          10  PC-TSYMSG-02897       PIC  9(05)  VALUE  02897.      00690000
00050      05  PC-HEADQUARTERS           PIC  X(02)  VALUE  'HQ'.       00700000
00051      05  PC-OPERATING-CO           PIC  X(02)  VALUE  '03'.       00710000
00052      05  PC-CALENDAR-ROUTINE       PIC  X(08)  VALUE  'DPKUT500'. 00720000
JS0516     05  PC-NINES                PIC  X(10)  VALUE  '9999-09-09'. 00730000
00053 *                                                                 00740000
00054  01  PS-PROGRAM-SWITCHES.                                         00750000
00055      05  PS-ERROR-SW               PIC  X      VALUE  'N'.        00760000
00056          88  PS-ERROR                          VALUE  'Y'.        00770000
00057          88  PS-NO-ERROR                       VALUE  'N'.        00780000
00058                                                                   00790000
00059  01  PV-PROGRAM-VARIABLES.                                        00800000
00060      05  PV-ASTERISK-CNT           PIC S9(04)  VALUE +0           00810000
00061                                                COMP SYNC.         00820000
22960      05  PV-STKRMW-TEST            PIC S9(04)  VALUE ZEROES       00830000
22960                                                COMP SYNC.         00840000
00062      05  PV-STKRMW-END-DTE                                        00850000
00063                                    PIC  X(10).                    00860000
00064      05  PV-ACTL-INV-DTE-YYYYMMDD  PIC  X(08).                    00870000
00065      05  PV-STKRMW-END-DTE-YYYYMMDD                               00880000
00066                                    PIC  X(08).                    00890000
00067      05  PV-CURRENT-DTE-YYYYMMDD   PIC  X(08).                    00900000
00068                                                                   00910000
00069  01  PV-DB2-KEY-AREA.                                             00920000
W26600     05  PV-DB2-STORE-NBR          PIC  X(04).                    00930000
W26600     05  PV-DB2-STORE-NBR-9 REDEFINES                             00940000
W26600         PV-DB2-STORE-NBR          PIC  9(04).                    00950000
W26600     05  PV-EDIT-LOC-NBR           PIC 9(04)  VALUE ZEROS.        00960000
00071 *----------------------------------------------------------------*00970000
00072 *    MAP LAYOUT                                                  *00980000
00073 *----------------------------------------------------------------*00990000
00074                                                                   01000000
W26600     COPY INKM020.                                                01010000
00076      EJECT                                                        01020000
00077 *----------------------------------------------------------------*01030000
00078 *    ATTRIBUTE SETTINGS COPYBOOK.                                *01040000
00079 *----------------------------------------------------------------*01050000
00080                                                                   01060000
00081      COPY DPWS015.                                                01070000
00082                                                                   01080000
00083 *----------------------------------------------------------------*01090000
00084 *    FUNCTION KEYS COPYBOOK                                      *01100000
00085 *----------------------------------------------------------------*01110000
00086                                                                   01120000
00087      COPY DPWS016.                                                01130000
00088                                                                   01140000
00089 *----------------------------------------------------------------*01150000
00090 *    COPY BOOK FOR NUMERIC EDIT SUBROUTINE (DPKUT100) PARAMETER  *01160000
00091 *    LIST.                                                       *01170000
00092 *----------------------------------------------------------------*01180000
00093                                                                   01190000
00094      COPY DPWS010I.                                               01200000
00095                                                                   01210000
00096 *----------------------------------------------------------------*01220000
00097 *    COPY BOOK FOR CURRENT SYSTEM DATE/TIME PROCEDURE DIVISION   *01230000
00098 *    ROUTINE                                                      01240000
00099 *----------------------------------------------------------------*01250000
00100                                                                   01260000
00101      COPY DPWS017.                                                01270000
00102                                                                   01280000
00103 *----------------------------------------------------------------*01290000
00104 *    COPY BOOK FOR CALENDAR SUBROUTINE (DPKUT500)                 01300000
00105 *----------------------------------------------------------------*01310000
00106                                                                   01320000
00107      COPY DPWS500.                                                01330000
00108                                                                   01340000
00109 ******************************************************************01350000
00110 ** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS            **01360000
00111 ** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **01370000
00112 ******************************************************************01380000
00113      COPY DPWS030.                                                01390000
1122RM     COPY DPWS930.                                                01391009
00114                                                                   01400000
00115 ***************************************************************** 01410000
00116 *    STANDARD COMMAREA.                                           01420000
00117 ***************************************************************** 01430000
00118                                                                   01440000
00119      COPY DPWS020.                                                01450000
00120      05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01460000
00121                                                                   01470000
00122 ***************************************************************** 01480000
00123 *    INTER-APPLICATION COMMAREA.                                  01490000
00124 ***************************************************************** 01500000
00125                                                                   01510000
00126          10  INTER-APPL-COMM-AREA PIC X(200).                     01520000
W26600     COPY INWS001.                                                01530000
00128 ***************************************************************** 01540000
00129 *    SPECIFIC COMMMAREA FOR INKCS020.                             01550000
00130 ***************************************************************** 01560000
00131          10  ASC-SPECIFIC-COMMAREA.                               01570000
W26600             15  ASC-STORE-NBR-X             PIC  X(04).          01580000
00133              15  ASC-STORE-NBR               REDEFINES            01590000
W26600                 ASC-STORE-NBR-X             PIC  9(04).          01600000
00135              15  ASC-SHEET-NBR-X             PIC  X(06).          01610000
00136              15  ASC-SHEET-NBR               REDEFINES            01620000
00137                  ASC-SHEET-NBR-X             PIC  9(06).          01630000
00138              15  ASC-STORE-NAME              PIC  X(25).          01640000
22000 * THIS FILLER SHOULD TAKE INTO CONSIDERATION THE 200 BYTES ABOVE. 01650000
22000              15  FILLER                      PIC  X(2631).        01660000
00140      EJECT                                                        01670000
00141 *----------------------------------------------------------------*01680000
00142 *    ABEND PROCESSING COPYBOOK.                                  *01690000
00143 *----------------------------------------------------------------*01700000
00144                                                                   01710000
00145      COPY DPWS013.                                                01720000
00146                                                                   01730000
00147 *---------------------------------------------------------------* 01740000
00148 *    DB2 AREA FOR STORE TABLE                                   * 01750000
00149 *---------------------------------------------------------------* 01760000
00150      EXEC SQL                                                     01770000
W26600          INCLUDE XMT00001                                        01780000
00152      END-EXEC.                                                    01790000
22000                                                                   01800000
22000 *---------------------------------------------------------------* 01810000
22000 *    DB2 AREA FOR STOCKROOM WITHDRAWAL TABLE                    * 01820000
22000 *---------------------------------------------------------------* 01830000
22000      EXEC SQL                                                     01840000
22000           INCLUDE TSTKRMW                                         01850000
22000      END-EXEC.                                                    01860000
22000                                                                   01870000
00153 *---------------------------------------------------------------* 01880000
00154 *    DB2 AREA FOR INVENTORY PARAMETERS TABLE                    * 01890000
00155 *---------------------------------------------------------------* 01900000
00156      EXEC SQL                                                     01910000
00157           INCLUDE TINVPAR                                         01920000
00158      END-EXEC.                                                    01930000
00159                                                                   01940000
J28545*-----------------------------------------------------------      01941000
J28545*   DB2 AREA FOR INVENTORY CONTROL TABLE                          01942000
J28545*-----------------------------------------------------------      01943000
J28545     EXEC SQL                                                     01944000
J28545          INCLUDE TINCNTL                                         01945000
J28545     END-EXEC.                                                    01946000
J28545                                                                  01950000
                                                                        01960002
00160      EXEC SQL                                                     01960101
00161          DECLARE INVPAR-CSR CURSOR FOR                            01961000
J28545             SELECT  A.ACTL_INV_DTE                               01970002
J28545                    ,A.ACTL_INV_DTE + A.STKRM_DAY_QTY DAYS        01980002
J28545                    ,A.ITM_CTOFF_IND                              01990002
J28545                    ,A.STKRM_WDRWL_IND                            02000002
J28545                    ,A.UNT_BKG_STAT_CDE                           02010002
J28545                    ,B.INV_ID                                     02011002
J28545                    ,B.INV_NM                                     02012004
J28545             FROM     TINVPAR A                                   02020002
J28545                     ,TINCNTL B                                   02021002
J28545             WHERE  (A.INV_ID   = B.INV_ID                        02031002
J28545               AND   B.ACTV_IND = 'Y')                            02032002
J28545               AND   A.LOC_NBR         = :INVPAR-LOC-NBR          02033002
J28545               AND   A.ACTL_FIN_BK_DTE = :PC-NINES                02040002
W33304               AND   A.LOC_INV_STAT_CDE = 'IN'                    02041007
00168      END-EXEC.                                                    02050000
00169 *---------------------------------------------------------------* 02060000
00170 *    DB2 AREA FOR COMMUNICATIONS                                * 02070000
00171 *---------------------------------------------------------------* 02080000
00172      EXEC SQL                                                     02090000
00173           INCLUDE SQLCA                                           02100000
00174      END-EXEC.                                                    02110000
00175                                                                   02120000
00176                                                                   02130000
00177  EJECT                                                            02140000
00178  LINKAGE SECTION.                                                 02150000
00179                                                                   02160000
00180  01  DFHCOMMAREA.                                                 02170000
00181      05  FILLER                         OCCURS  1 TO 4072 TIMES   02180000
00182                                         DEPENDING ON EIBCALEN.    02190000
00183          10  FILLER                     PIC X.                    02200000
00184                                                                   02210000
00185                                                                   02220000
00186  PROCEDURE DIVISION.                                              02230000
00187 ***************************************************************** 02240000
00188 ** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 02250000
00189 ** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 02260000
00190 ** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 02270000
00191 **                                                             ** 02280000
00192 ** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 02290000
00193 ** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 02300000
00194 ***************************************************************** 02310000
00195  0000-MAIN-MODULE.                                                02320000
00196      INITIALIZE DP030-CICS-API-FIELDS.                            02330000
00197      MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02340000
00198      MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02350000
00199      MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02360000
00200      SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02370000
00201      MOVE LENGTH OF IN020AI        TO DP030-MAP-LENGTH (1).       02380000
00202      MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02390000
00203      PERFORM 0001-CALL-CICS-ARCH-API.                             02400000
00204 *                                                                 02410000
00205      PERFORM 1000-CONTROL-PROCESSING.                             02420000
00206 *                                                                 02430000
00207      MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02440000
00208      PERFORM 0001-CALL-CICS-ARCH-API.                             02450000
00209                                                                   02460000
00210  0001-CALL-CICS-ARCH-API.                                         02470000
1122RM*    CALL 'DPKCS030' USING DFHEIBLK                               02480009
1122RM     CALL DP930-CICS-ARCH-API                                     02481009
1122RM                     USING DFHEIBLK                               02482009
00212                            DFHCOMMAREA                            02490000
00213                            DP030-CICS-API-FIELDS                  02500000
00214                            DP020-STANDARD-COMMAREA                02510000
00215                            IN020AI.                               02520000
00216 *                                                                 02530000
00217      IF  DP030-RC-CALL-SUCCESSFUL                                 02540000
00218          CONTINUE                                                 02550000
00219      ELSE                                                         02560000
00220          SET DP013-NO-ROLLBACK                                    02570000
00221              DP013-XCTL-DISPLAY-RESTART                           02580000
00222              DP013-CICS-ABEND      TO TRUE                        02590000
00223          MOVE 'BEFORE 0000-MAIN-MODULE'                           02600000
00224                                    TO DP013-PARAGRAPH             02610000
1122RM*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX02620009
1122RM*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      02630009
1122RM         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O02631009
1122RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02632009
00227          MOVE DP030-RETURN-CODE                                   02640000
00228                                    TO DP013-MESSAGE-TEXT (3)      02650000
00229          PERFORM DP013-0000-PROCESS-ABEND                         02660000
00230      END-IF.                                                      02670000
00231  EJECT                                                            02680000
00232 *----------------------------------------------------------------*02690000
00233 *    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02700000
00234 *    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02710000
00235 *----------------------------------------------------------------*02720000
00236                                                                   02730000
00237  1000-CONTROL-PROCESSING.                                         02740000
00238                                                                   02750000
00239      EVALUATE TRUE                                                02760000
00240          WHEN DP020-NEXT-ACT-INITIAL                              02770000
00241              INITIALIZE ASC-SPECIFIC-COMMAREA                     02780000
00242              PERFORM 4000-BUILD-INITIAL-PANEL                     02790000
00243                                                                   02800000
00244          WHEN DP020-NEXT-ACT-READ-MAP                             02810000
00245              PERFORM 2000-FKEY-PROCESSING                         02820000
00246                                                                   02830000
00247          WHEN DP020-NEXT-ACT-RETURN                               02840000
00248 *            *----------------------------------------------------02850000
00249 *            * IF THE MESSAGE NUMBER IS SET TO 550, THIS PROGRAM  02860000
00250 *            * IS BEING RETURNED TO FROM THE STOCKROOM WITHDRAWAL 02870000
00251 *            * ADD PROGRAM AFTER A SUCCESSFUL ADD. IN THAT CASE,  02880000
00252 *            * THE SPECIFICATION SCREEN SHOULD BE DISPLAYED WITH  02890000
00253 *            * THE STORE NUMBER INTACT AND THE SHEET NUMBER EMPTY.02900000
00254 *            *----------------------------------------------------02910000
00255              IF DP020-MSG-NUMBER = PC-TSYMSG-00550                02920000
00256                  MOVE ASC-STORE-NBR-X            TO ASTOREO       02930000
00257                  IF DP020-LOCATION-TYPE = PC-HEADQUARTERS         02940000
00258                      MOVE DP015-UNP-NUM-NOR-OFF  TO ASTOREA       02950000
00259                      MOVE DP015-GREEN            TO ASTOREC       02960000
00260                      MOVE DP015-UNDERLINE        TO ASTOREH       02970000
00261                  END-IF                                           02980000
00262                  INITIALIZE ASC-SHEET-NBR-X                       02990000
00263                  MOVE -1                         TO ASHEETL       03000000
00264                  SET DP030-SET-CURSOR-APPL-1     TO TRUE          03010000
00265                  MOVE SPACE                      TO ASHEETO       03020000
00266              ELSE                                                 03030000
00267                  PERFORM 3000-EDIT-DATA-IN-COMMAREA               03040000
00268                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             03050000
00269              END-IF                                               03060000
00270                                                                   03070000
00271          WHEN OTHER                                               03080000
00272              SET DP013-LOGIC-ABEND                                03090000
00273                  DP013-NO-ROLLBACK TO TRUE                        03100000
00274              MOVE '1000-CONTROL-PROCESSING'                       03110000
00275                                    TO  DP013-PARAGRAPH            03120000
00276              MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   03130000
00277                                    TO  DP013-MESSAGE-TEXT(1)      03140000
00278              MOVE DP020-NEXT-APPL-ACTIVITY                        03150000
00279                                    TO DP013-MESSAGE-TEXT(2)       03160000
00280              PERFORM DP013-0000-PROCESS-ABEND                     03170000
00281      END-EVALUATE.                                                03180000
00282                                                                   03190000
00283 *----------------------------------------------------------------*03200000
00284 * FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*03210000
00285 * SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*03220000
00286 * EDITS.                                                         *03230000
00287 *----------------------------------------------------------------*03240000
00288                                                                   03250000
00289  2000-FKEY-PROCESSING.                                            03260000
00290      EVALUATE TRUE                                                03270000
00291                                                                   03280000
00292          WHEN DP020-SRC-AID = DP016-CLEAR                         03290000
00293              PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03300000
00294              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03310000
00295                                                                   03320000
00296          WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     03330000
00297              INITIALIZE ASC-SPECIFIC-COMMAREA                     03340000
00298              PERFORM 4000-BUILD-INITIAL-PANEL                     03350000
00299              PERFORM 3200-RESET-ATTRIBUTES                        03360000
00300                                                                   03370000
00301          WHEN OTHER                                               03380000
00302              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 03390000
00303              PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03400000
00304              IF  PS-NO-ERROR                                      03410000
00305                  SET DP030-CONTINUE-GO TO TRUE                    03420000
00306                  PERFORM 2100-CHECK-FUNCTION-KEY                  03430000
00307              ELSE                                                 03440000
00308                  SET DP030-OVERRIDE-GO TO TRUE                    03450000
00309                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             03460000
00310              END-IF                                               03470000
00311      END-EVALUATE.                                                03480000
00312                                                                   03490000
00313                                                                   03500000
00314 *----------------------------------------------------------------*03510000
00315 * ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *03520000
00316 * FIRST. NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED    *03530000
00317 * FROM THE CICS ARCHITECTURE API.                                *03540000
00318 *----------------------------------------------------------------*03550000
00319                                                                   03560000
00320  2100-CHECK-FUNCTION-KEY.                                         03570000
00321      EVALUATE TRUE                                                03580000
22000          WHEN DP020-FK-LOCAL-FUNC-11 (DP020-SRC-AID)              03590000
22000              PERFORM 6000-SET-STOCKROOM-IND                       03600000
22000              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03610000
22000                                                                   03620000
00322          WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 03630000
00323              PERFORM 2110-PREPARE-INTER-APPL-COMM                 03640000
00324                                                                   03650000
00325          WHEN DP020-SRC-AID = DP016-ENTER                         03660000
00326              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03670000
00327                                                                   03680000
00328          WHEN OTHER                                               03690000
00329              SET DP013-NO-ROLLBACK                                03700000
00330                  DP013-XCTL-DISPLAY-RESTART                       03710000
00331                  DP013-CICS-ABEND  TO TRUE                        03720000
00332              MOVE '2100-CHECK-FUNCTION-KEY'                       03730000
00333                                    TO DP013-PARAGRAPH             03740000
00334              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      03750000
00335                                    TO DP013-MESSAGE-TEXT (1)      03760000
00336              PERFORM DP013-0000-PROCESS-ABEND                     03770000
00337      END-EVALUATE.                                                03780000
00338                                                                   03790000
00339                                                                   03800000
00340 ******************************************************************03810000
00341 ** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **03820000
00342 ** INTER-APPLICATION COMMAREA.                                  **03830000
00343 ******************************************************************03840000
00344                                                                   03850000
00345  2110-PREPARE-INTER-APPL-COMM.                                    03860000
00346      INITIALIZE IN001-INTER-APPL-COMM-AREA.                       03870000
00347      MOVE ASC-STORE-NBR-X TO IN001-STORE-NBR-X                    03880000
00348                              PV-DB2-STORE-NBR.                    03890000
00349      MOVE ASC-SHEET-NBR-X TO IN001-SHEET-NBR-X.                   03900000
00350      MOVE ASC-STORE-NAME  TO IN001-STORE-NAME.                    03910000
00351                                                                   03920000
00352 *    *------------------------------------------------------------03930000
00353 *    * CHECK WHETHER TODAY FALLS WITHIN THE STOCKROOM WITHDRAWAL  03940000
00354 *    * PERIOD AND SET THE SWITCH IN THE INTER APPL COMMAREA       03950000
00355 *    * ACCORDINGLY.                                               03960000
00356 *    *------------------------------------------------------------03970000
00357                                                                   03980000
00358      PERFORM 2150-OPEN-CURSOR.                                    03990000
00359                                                                   04000000
00360      EVALUATE TRUE                                                04010000
00361          WHEN SQLCODE = 0                                         04020000
00362              PERFORM 2160-FETCH                                   04030000
00363                                                                   04040000
JS0516             IF SQLCODE = +100                                    04050000
00365                  SET IN001-NOT-IN-WITHDRAWAL-PERIOD               04060000
00366                      IN001-ITM-CTOFF-HASNT-OCCURRED TO TRUE       04070000
00367              ELSE                                                 04080000
J28545               MOVE INCNTL-INV-ID TO IN001-INV-ID                 04081000
J28545               MOVE INCNTL-INV-NM TO IN001-INV-NM                 04082000
JS0516               IF INVPAR-ACTL-INV-DTE = PC-NINES                  04090000
00365                  SET IN001-NOT-IN-WITHDRAWAL-PERIOD               04100000
00366                      IN001-ITM-CTOFF-HASNT-OCCURRED TO TRUE       04110000
JS0516               ELSE                                               04120000
00368                  PERFORM 2175-FMT-STKRM-DTES-FOR-CMPARE           04130000
00369                  IF PV-CURRENT-DTE-YYYYMMDD                       04140000
00370                                      < PV-ACTL-INV-DTE-YYYYMMDD OR04150000
00371                     PV-CURRENT-DTE-YYYYMMDD                       04160000
00372                                      > PV-STKRMW-END-DTE-YYYYMMDD 04170000
00373                      SET IN001-NOT-IN-WITHDRAWAL-PERIOD TO TRUE   04180000
00374                  ELSE                                             04190000
00375                      SET IN001-IN-WITHDRAWAL-PERIOD TO TRUE       04200000
00376                          MOVE PV-ACTL-INV-DTE-YYYYMMDD            04210000
00377                               TO IN001-ACTL-INV-DTE-YYYYMMDD      04220000
W25428*CHECK BOOKING STATUS                                             04230000
W25428                     IF INVPAR-UNT-BKG-STAT-CDE NOT EQUAL 'IN'    04240007
W25428                        SET IN001-UNIT-BOOK-HAS-OCCURRED  TO TRUE 04250000
W25428                     ELSE                                         04260000
W25428                        SET IN001-UNIT-BOOK-HASNT-OCCURRED TO TRUE04270000
00378                      END-IF                                       04280000
W25428                 END-IF                                           04290000
00379                  MOVE INVPAR-ITM-CTOFF-IND TO IN001-ITM-CTOFF-IND 04300000
00380                END-IF                                             04310000
00380              END-IF                                               04320000
00381                                                                   04330000
00382              PERFORM 2170-CLOSE-CURSOR                            04340000
00383          WHEN OTHER                                               04350000
00384              SET  DP030-OVERRIDE-GO                               04360000
00385                   DP020-MSG-WARNING TO TRUE                       04370000
00386 *            ---- WAIT 15 SECONDS, THEN RETRY ----                04380000
00387              MOVE PC-TSYMSG-00551   TO DP020-MSG-NUMBER           04390000
00388          END-EVALUATE.                                            04400000
00389                                                                   04410000
00390                                                                   04420000
00391 *----------------------------------------------------------------*04430000
00392 * OPEN THE INVENTORY PARAMETERS CURSOR.                          *04440000
00393 *----------------------------------------------------------------*04450000
00394                                                                   04460000
00395  2150-OPEN-CURSOR.                                                04470000
W26600                                                                  04480000
W26600     MOVE PV-DB2-STORE-NBR-9  TO INVPAR-LOC-NBR.                  04490000
W26600                                                                  04500000
00396      EXEC SQL                                                     04510000
00397           OPEN INVPAR-CSR                                         04520000
00398      END-EXEC.                                                    04530000
00399                                                                   04540000
00400      EVALUATE TRUE                                                04550000
00401          WHEN SQLCODE = ZERO                                      04560000
00402          WHEN SQLCODE = -904                                      04570000
00403          WHEN SQLCODE = -913                                      04580000
00404              CONTINUE                                             04590000
00405          WHEN SQLWARN0 NOT = SPACES                               04600000
00406          WHEN SQLCODE  NOT = ZERO                                 04610000
00407              MOVE '2150-OPEN-CURSOR'                              04620000
00408                                TO DP013-PARAGRAPH                 04630000
00409              MOVE 'OPEN INVENTORY PARAMETERS CURSOR'              04640000
00410                                TO DP013-MESSAGE-TEXT (1)          04650000
00411              MOVE SQLCA        TO DP013-SQLCA                     04660000
00412              MOVE 'TINVPAR'    TO DP013-DB2-TABLE-NAME (1)        04670000
00413              SET DP013-DB2-ABEND                                  04680000
00414                  DP013-XCTL-DISPLAY-RESTART TO TRUE               04690000
00415              PERFORM DP013-0000-PROCESS-ABEND                     04700000
00416      END-EVALUATE.                                                04710000
00417  EJECT                                                            04720000
00418 *----------------------------------------------------------------*04730000
00419 *    FETCH THE INVENTORY PARAMETERS CURSOR.                      *04740000
00420 *----------------------------------------------------------------*04750000
00421                                                                   04760000
00422  2160-FETCH.                                                      04770000
00423                                                                   04780000
00424      EXEC SQL                                                     04790000
00425           FETCH INVPAR-CSR                                        04800000
00426           INTO  :INVPAR-ACTL-INV-DTE                              04810000
00427               , :PV-STKRMW-END-DTE                                04820000
00428               , :INVPAR-ITM-CTOFF-IND                             04830000
22000               , :INVPAR-STKRM-WDRWL-IND                           04840000
W25428              , :INVPAR-UNT-BKG-STAT-CDE                          04850000
J28545              , :INCNTL-INV-ID                                    04851000
J28545              , :INCNTL-INV-NM                                    04852000
00429      END-EXEC.                                                    04860000
00430                                                                   04870000
00431      EVALUATE TRUE                                                04880000
00432          WHEN SQLCODE = ZERO                                      04890000
00433          WHEN SQLCODE = +100                                      04900000
00434               CONTINUE                                            04910000
00435          WHEN SQLWARN0 NOT = SPACE                                04920000
00436          WHEN SQLCODE  NOT = ZERO                                 04930000
00437               MOVE '2160-FETCH'                                   04940000
00438                                TO DP013-PARAGRAPH                 04950000
00439               MOVE 'FETCH INVENTORY PARAMETERS CURSOR'            04960000
00440                                TO DP013-MESSAGE-TEXT (1)          04970000
00441               MOVE SQLCA       TO DP013-SQLCA                     04980000
00442               SET DP013-DB2-ABEND                                 04990000
00443                                TO TRUE                            05000000
00444               PERFORM DP013-0000-PROCESS-ABEND                    05010000
00445      END-EVALUATE.                                                05020000
00446  EJECT                                                            05030000
00447 *----------------------------------------------------------------*05040000
00448 * CLOSE THE INVENTORY PARAMETERS CURSOR.                          05050000
00449 *----------------------------------------------------------------*05060000
00450                                                                   05070000
00451  2170-CLOSE-CURSOR.                                               05080000
00452      EXEC SQL                                                     05090000
00453          CLOSE INVPAR-CSR                                         05100000
00454      END-EXEC.                                                    05110000
00455 *                                                                 05120000
00456      EVALUATE TRUE                                                05130000
00457          WHEN SQLCODE = ZERO                                      05140000
00458              CONTINUE                                             05150000
00459          WHEN SQLWARN0 NOT = SPACES                               05160000
00460          WHEN SQLCODE  NOT = ZERO                                 05170000
00461              MOVE '2170-CLOSE-CURSOR'                             05180000
00462                                TO DP013-PARAGRAPH                 05190000
00463              MOVE 'CLOSE INVENTORY PARAMETERS'                    05200000
00464                                TO DP013-MESSAGE-TEXT (1)          05210000
00465              MOVE SQLCA        TO DP013-SQLCA                     05220000
00466              MOVE 'TINVPAR '   TO DP013-DB2-TABLE-NAME (1)        05230000
00467              SET DP013-DB2-ABEND                                  05240000
00468                  DP013-XCTL-DISPLAY-RESTART TO TRUE               05250000
00469              PERFORM DP013-0000-PROCESS-ABEND                     05260000
00470      END-EVALUATE.                                                05270000
00471  EJECT                                                            05280000
00472 *----------------------------------------------------------------*05290000
00473 *    FORMAT THE DATES USED TO DETERMINE WHETHER OR NOT TODAY IS  *05300000
00474 *    WITHIN THE STOCKROOM WITHDRAWAL PERIOD INTO A COMMON FORMAT *05310000
00475 *    FOR COMPARISON.                                             *05320000
00476 *----------------------------------------------------------------*05330000
00477                                                                   05340000
00478  2175-FMT-STKRM-DTES-FOR-CMPARE.                                  05350000
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              05360000
00479      PERFORM DP017-0000-GET-CURR-DATE-TIME.                       05370000
00481      SET  DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                    05380000
00482      SET  DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                    05390000
00483      MOVE ZERO                      TO DPG51-INCR-DECR-DAYS-9     05400000
00484                                        DPG51-INCR-DECR-BUS-DAYS-9.05410000
00485      SET  DPG52-LK-DTE-ISO-FMT        TO TRUE.                    05420000
00486                                                                   05430000
00487 *    *------------------------------------------------------------05440000
00488 *    * FORMAT THE ACTUAL INVENTORY DATE FROM TINVPAR              05450000
00489 *    *------------------------------------------------------------05460000
00490      MOVE INVPAR-ACTL-INV-DTE TO DPG52-LK-DATE-INPUT.             05470000
00491      PERFORM 2180-CALL-CALENDAR-ROUTINE.                          05480000
00492      MOVE DPG55-DB2-ISO-DATE TO PV-ACTL-INV-DTE-YYYYMMDD.         05490000
00493                                                                   05500000
00494 *    *------------------------------------------------------------05510000
00495 *    * FORMAT THE STOCKROOM WITHDRAWAL END DATE (ACTUAL INVENTORY 05520000
00496 *    * DATE + STOCKROOM DAYS FROM TINVPAR).                       05530000
00497 *    *------------------------------------------------------------05540000
JS1298     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              05550000
JS1298     SET  DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                    05560000
JS1298     SET  DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                    05570000
JS1298     MOVE ZERO                      TO DPG51-INCR-DECR-DAYS-9     05580000
JS1298                                       DPG51-INCR-DECR-BUS-DAYS-9.05590000
                                                                        05600000
00485      SET  DPG52-LK-DTE-ISO-FMT        TO TRUE.                    05610000
00498      MOVE PV-STKRMW-END-DTE TO DPG52-LK-DATE-INPUT.               05620000
00499      PERFORM 2180-CALL-CALENDAR-ROUTINE.                          05630000
00500      MOVE DPG55-DB2-ISO-DATE TO PV-STKRMW-END-DTE-YYYYMMDD.       05640000
00501                                                                   05650000
00502 *    *------------------------------------------------------------05660000
00503 *    * FORMAT THE CURRENT SYSTEM DATE.                            05670000
00504 *    *------------------------------------------------------------05680000
JS1298     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              05690000
JS1298     SET  DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                    05700000
JS1298     SET  DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                    05710000
JS1298     MOVE ZERO                      TO DPG51-INCR-DECR-DAYS-9     05720000
JS1298                                       DPG51-INCR-DECR-BUS-DAYS-9.05730000
00485      SET  DPG52-LK-DTE-ISO-FMT        TO TRUE.                    05740000
00505      MOVE DP017-EDITED-DATE-YYYYMMDD TO DPG52-LK-DATE-INPUT.      05750000
00506      PERFORM 2180-CALL-CALENDAR-ROUTINE.                          05760000
00507      MOVE DPG55-DB2-ISO-DATE TO PV-CURRENT-DTE-YYYYMMDD.          05770000
00508                                                                   05780000
00509                                                                   05790000
00510  2180-CALL-CALENDAR-ROUTINE.                                      05800000
00511      CALL PC-CALENDAR-ROUTINE USING DPG51                         05810000
00512                                     DPG52                         05820000
00513                                     DPG53                         05830000
00514                                     DPG54                         05840000
00515                                     DPG55                         05850000
00516                                     DPG56.                        05860000
00517      EVALUATE TRUE                                                05870000
00518          WHEN DPG54-SEVERE-ERROR                                  05880000
00519          WHEN DPG54-DATE-INVALID                                  05890000
00520              MOVE '2175-FMT-STKRM-DTES-FOR-CMPARE'                05900000
00521                                    TO  DP013-PARAGRAPH            05910000
00522              MOVE 'ERROR DETECTED BY CALENDAR ROUTINE:'           05920000
00523                                    TO  DP013-MESSAGE-TEXT (1)     05930000
00524              MOVE DPG54-ERROR-MESSAGE                             05940000
00525                                    TO  DP013-MESSAGE-TEXT (2)     05950000
00526              SET DP013-LOGIC-ABEND TO  TRUE                       05960000
00527              PERFORM DP013-0000-PROCESS-ABEND                     05970000
00528      END-EVALUATE.                                                05980000
00529                                                                   05990000
00530 *----------------------------------------------------------------*06000000
00531 * MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*06010000
00532 * THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *06020000
00533 * APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *06030000
00534 *----------------------------------------------------------------*06040000
00535                                                                   06050000
00536  2200-MOVE-SCREEN-TO-COMMAREA.                                    06060000
00537      IF  ASTOREL > ZERO                                           06070000
00538          MOVE ASTOREI        TO ASC-STORE-NBR-X                   06080000
00539      ELSE                                                         06090000
00540          IF  ASTOREF = DP015-ERASE-EOF                            06100000
00541              MOVE SPACE      TO ASC-STORE-NBR-X                   06110000
00542          END-IF                                                   06120000
00543      END-IF.                                                      06130000
00544                                                                   06140000
00545      IF  ASHEETL > ZERO                                           06150000
00546          MOVE ASHEETI        TO ASC-SHEET-NBR-X                   06160000
00547      ELSE                                                         06170000
00548          IF  ASHEETF = DP015-ERASE-EOF                            06180000
00549              MOVE SPACE      TO ASC-SHEET-NBR-X                   06190000
00550          END-IF                                                   06200000
00551      END-IF.                                                      06210000
00552                                                                   06220000
00553 *----------------------------------------------------------------*06230000
00554 * ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *06240000
00555 * CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *06250000
00556 * A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*06260000
00557 * IN THE DESTINATION PROGRAM, NOT HERE.                          *06270000
00558 *----------------------------------------------------------------*06280000
00559                                                                   06290000
00560  3000-EDIT-DATA-IN-COMMAREA.                                      06300000
00561                                                                   06310000
00562      PERFORM 3200-RESET-ATTRIBUTES.                               06320000
00563                                                                   06330000
00564      IF  ASC-SHEET-NBR-X > SPACE                                  06340000
00565          INSPECT ASC-SHEET-NBR-X                                  06350000
00566              TALLYING PV-ASTERISK-CNT                             06360000
00567              FOR ALL '*'                                          06370000
00568          IF PV-ASTERISK-CNT > ZERO                                06380000
00569              MOVE ALL '*'               TO ASC-SHEET-NBR-X        06390000
00570          ELSE                                                     06400000
00571              MOVE ASC-SHEET-NBR-X       TO DP010I-UNEDITED-FIELD  06410000
00572              MOVE LENGTH OF ASC-SHEET-NBR                         06420000
00573                                         TO DP010I-MAXIMUM-DIGITS  06430000
00574              MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS06440000
00575              SET  DP010I-NEGATIVE-NOT-ALLOWED                     06450000
00576                                         TO TRUE                   06460000
263126             CALL DP010I-NUMERIC-EDIT-ROUTINE                     06471008
263126                  USING DP010I-NUMERIC-EDIT-AREA                  06472008
00578                                                                   06480000
00579              IF DP010I-ERROR-DETECTED                             06490000
00580                  SET  PS-ERROR                                    06500000
00581                       DP020-MSG-FATAL        TO TRUE              06510000
00582 *                ---- MUST BE NUMERIC ----                        06520000
00583                  MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER  06530000
SJ                     MOVE DP015-UNP-ALP-BRT-OFF  TO ASHEETA           06540000
00585                  MOVE DP015-RED              TO ASHEETC           06550000
00586                  MOVE DP015-REVERSE          TO ASHEETH           06560000
00587                  MOVE -1                     TO ASHEETL           06570000
00588                  SET DP030-SET-CURSOR-APPL-1 TO TRUE              06580000
00589              ELSE                                                 06590000
00590                  MOVE DP010I-NUMERIC-FIELD TO ASC-SHEET-NBR       06600000
00591                  IF ASC-SHEET-NBR  = ZERO                         06610000
00592                      SET  PS-ERROR                                06620000
00593                           DP020-MSG-FATAL      TO TRUE            06630000
00594 *                    ---- CANNOT BE ZERO ----                     06640000
00595                      MOVE PC-TSYMSG-00010      TO DP020-MSG-NUMBER06650000
SJ                         MOVE DP015-UNP-ALP-BRT-OFF                   06660000
SJ                                                   TO ASHEETA         06670000
00598                      MOVE DP015-RED            TO ASHEETC         06680000
00599                      MOVE DP015-REVERSE        TO ASHEETH         06690000
00600                      MOVE -1                   TO ASHEETL         06700000
00601                      SET DP030-SET-CURSOR-APPL-1                  06710000
00602                                                TO TRUE            06720000
00603                  END-IF                                           06730000
00604              END-IF                                               06740000
00605          END-IF                                                   06750000
00606      ELSE                                                         06760000
22000          IF DP020-FK-LOCAL-FUNC-11 (DP020-SRC-AID)                06770000
22000 *            ---- DO NOT VALIDATE/EDIT THIS FIELD ON THIS FUNC    06780000
22000              CONTINUE                                             06790000
22000          ELSE                                                     06800000
00607              SET  PS-ERROR                                        06810000
00608                   DP020-MSG-FATAL        TO TRUE                  06820000
00609 *            ---- REQUIRED ENTRY ----                             06830000
00610              MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      06840000
SJ                 MOVE DP015-UNP-ALP-BRT-OFF  TO ASHEETA               06850000
00612              MOVE DP015-RED              TO ASHEETC               06860000
00613              MOVE DP015-REVERSE          TO ASHEETH               06870000
00614              MOVE -1                     TO ASHEETL               06880000
00615              SET DP030-SET-CURSOR-APPL-1 TO TRUE                  06890000
22000          END-IF                                                   06900000
00616      END-IF.                                                      06910000
00617                                                                   06920000
00618                                                                   06930000
00619      IF DP020-LOCATION-TYPE = PC-HEADQUARTERS                     06940000
00620          IF ASC-STORE-NBR-X > SPACE                               06950000
00621              MOVE ASC-STORE-NBR-X       TO DP010I-UNEDITED-FIELD  06960000
00622              MOVE LENGTH OF ASC-STORE-NBR                         06970000
00623                                         TO DP010I-MAXIMUM-DIGITS  06980000
00624              MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS06990000
00625              SET  DP010I-NEGATIVE-NOT-ALLOWED                     07000000
00626                                         TO TRUE                   07010000
263126             CALL DP010I-NUMERIC-EDIT-ROUTINE                     07021008
263126                  USING DP010I-NUMERIC-EDIT-AREA                  07022008
00628                                                                   07030000
00629              IF DP010I-ERROR-DETECTED                             07040000
00630                  SET  PS-ERROR                                    07050000
00631                       DP020-MSG-FATAL        TO TRUE              07060000
00632 *                ---- MUST BE NUMERIC ----                        07070000
00633                  MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER  07080000
00634                  MOVE DP015-UNP-NUM-BRT-OFF  TO ASTOREA           07090000
00635                  MOVE DP015-RED              TO ASTOREC           07100000
00636                  MOVE DP015-REVERSE          TO ASTOREH           07110000
00637                  MOVE -1                     TO ASTOREL           07120000
00638                  SET DP030-SET-CURSOR-APPL-1 TO TRUE              07130000
00639              ELSE                                                 07140000
00640                  MOVE DP010I-NUMERIC-FIELD TO ASC-STORE-NBR       07150000
00641                  IF ASC-STORE-NBR  = ZERO                         07160000
00642                      SET  PS-ERROR                                07170000
00643                           DP020-MSG-FATAL         TO TRUE         07180000
00644 *                    ---- CANNOT BE ZERO ----                     07190000
00645                      MOVE PC-TSYMSG-00010      TO DP020-MSG-NUMBER07200000
00646                      MOVE DP015-UNP-NUM-BRT-OFF                   07210000
00647                                                TO ASTOREA         07220000
00648                      MOVE DP015-RED            TO ASTOREC         07230000
00649                      MOVE DP015-REVERSE        TO ASTOREH         07240000
00650                      MOVE -1                   TO ASTOREL         07250000
00651                      SET DP030-SET-CURSOR-APPL-1                  07260000
00652                                                TO TRUE            07270000
00653                  ELSE                                             07280000
00654                      PERFORM 3300-GET-STORE-NAME                  07290000
00655                      EVALUATE TRUE                                07300000
00656                          WHEN SQLCODE = 0                         07310000
W26600                             MOVE XMT00001-LOC-NM                 07320000
00658                                                  TO ASC-STORE-NAME07330000
00659                          WHEN SQLCODE = +100                      07340000
00660                              SET  PS-ERROR                        07350000
00661                                   DP020-MSG-FATAL       TO TRUE   07360000
00662 *                            ---- STORE DOES NOT EXIST ----       07370000
00663                              MOVE PC-TSYMSG-00017                 07380000
00664                                                TO DP020-MSG-NUMBER07390000
00665                              MOVE DP015-UNP-NUM-BRT-OFF TO ASTOREA07400000
00666                              MOVE DP015-RED             TO ASTOREC07410000
00667                              MOVE DP015-REVERSE         TO ASTOREH07420000
00668                              MOVE -1                    TO ASTOREL07430000
00669                              SET DP030-SET-CURSOR-APPL-1          07440000
00670                                                         TO TRUE   07450000
00671                          WHEN OTHER                               07460000
00672                              SET  PS-ERROR                        07470000
00673                                   DP020-MSG-WARNING      TO TRUE  07480000
00674 *                            ---- WAIT 15 SECONDS, THEN RETRY ----07490000
00675                              MOVE PC-TSYMSG-00551                 07500000
00676                                                TO DP020-MSG-NUMBER07510000
00677                      END-EVALUATE                                 07520000
00678                  END-IF                                           07530000
00679              END-IF                                               07540000
00680          ELSE                                                     07550000
00681              SET  PS-ERROR                                        07560000
00682                   DP020-MSG-FATAL        TO TRUE                  07570000
00683 *            ---- REQUIRED ENTRY ----                             07580000
00684              MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      07590000
00685              MOVE DP015-UNP-NUM-BRT-OFF  TO ASTOREA               07600000
00686              MOVE DP015-RED              TO ASTOREC               07610000
00687              MOVE DP015-REVERSE          TO ASTOREH               07620000
00688              MOVE -1                     TO ASTOREL               07630000
00689              SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07640000
00690          END-IF                                                   07650000
00691      ELSE                                                         07660000
W28545         MOVE DP020-LOCATION-NBR  TO PV-EDIT-LOC-NBR              07670000
W26600         MOVE PV-EDIT-LOC-NBR TO ASC-STORE-NBR-X                  07680000
00693          PERFORM 3300-GET-STORE-NAME                              07690000
W26600         MOVE XMT00001-LOC-NM    TO ASC-STORE-NAME                07700000
00695      END-IF.                                                      07710000
00696                                                                   07720000
00697      IF  PS-NO-ERROR                                              07730000
00698          IF DP020-LOCATION-TYPE = PC-HEADQUARTERS                 07740000
00699              MOVE -1                  TO ASTOREL                  07750000
00700          ELSE                                                     07760000
00701              MOVE -1                  TO ASHEETL                  07770000
00702          END-IF                                                   07780000
00703          SET DP030-SET-CURSOR-APPL-1  TO TRUE                     07790000
00704      END-IF.                                                      07800000
00705                                                                   07810000
00706 ******************************************************************07820000
00707 ** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **07830000
00708 ** MAP.                                                         **07840000
00709 ******************************************************************07850000
00710                                                                   07860000
00711  3200-RESET-ATTRIBUTES.                                           07870000
00712      IF DP020-LOCATION-TYPE = PC-HEADQUARTERS                     07880000
00713          MOVE DP015-UNP-NUM-NOR-OFF  TO ASTOREA                   07890000
00714          MOVE DP015-GREEN            TO ASTOREC                   07900000
00715          MOVE DP015-UNDERLINE        TO ASTOREH                   07910000
00716      ELSE                                                         07920000
00717          MOVE DP015-ASK-NOR-OFF      TO ASTOREA                   07930000
00718          MOVE DP015-BLUE             TO ASTOREC                   07940000
00719          MOVE DP015-HL-OFF           TO ASTOREH                   07950000
00720      END-IF.                                                      07960000
00721                                                                   07970000
SJ         MOVE DP015-UNP-ALP-NOR-OFF      TO ASHEETA.                  07980000
00723      MOVE DP015-GREEN                TO ASHEETC.                  07990000
00724      MOVE DP015-UNDERLINE            TO ASHEETH.                  08000000
00725                                                                   08010000
00726  3300-GET-STORE-NAME.                                             08020000
W26600                                                                  08030000
W26600     MOVE ASC-STORE-NBR       TO PV-DB2-STORE-NBR.                08040000
W26600     MOVE PV-DB2-STORE-NBR-9  TO XMT00001-LOC-NBR.                08050000
W26600                                                                  08060000
00727      EXEC SQL                                                     08070000
W26600         SELECT LOC_NM                                            08080000
W26600         INTO  :XMT00001-LOC-NM                                   08090000
W26600         FROM  XMT_LOC                                            08100000
W26600         WHERE LOC_NBR = :XMT00001-LOC-NBR                        08110000
00733      END-EXEC.                                                    08120000
00734                                                                   08130000
00735      EVALUATE TRUE                                                08140000
00736          WHEN SQLCODE = ZERO                                      08150000
00737          WHEN SQLCODE = +100                                      08160000
00738          WHEN SQLCODE = -904                                      08170000
00739          WHEN SQLCODE = -913                                      08180000
00740              CONTINUE                                             08190000
00741          WHEN SQLWARN0 NOT = SPACE                                08200000
00742          WHEN SQLCODE  NOT = ZERO                                 08210000
00743               MOVE '3300-GET-STORE-NAME'                          08220000
00744                            TO  DP013-PARAGRAPH                    08230000
W26600              MOVE 'READ XMTLOC '                                 08240000
00746                            TO  DP013-MESSAGE-TEXT (1)             08250000
00747               MOVE SQLCA   TO  DP013-SQLCA                        08260000
00748               SET DP013-DB2-ABEND                                 08270000
00749                            TO  TRUE                               08280000
00750               PERFORM DP013-0000-PROCESS-ABEND                    08290000
00751      END-EVALUATE.                                                08300000
00752                                                                   08310000
00753                                                                   08320000
00754 *----------------------------------------------------------------*08330000
00755 *  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *08340000
00756 *  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *08350000
00757 *  IT HERE.                                                      *08360000
00758 *----------------------------------------------------------------*08370000
00759                                                                   08380000
00760  4000-BUILD-INITIAL-PANEL.                                        08390000
00761      IF DP020-LOCATION-TYPE = PC-HEADQUARTERS                     08400000
00762          MOVE DP015-UNP-NUM-NOR-OFF  TO ASTOREA                   08410000
00763          MOVE DP015-GREEN            TO ASTOREC                   08420000
00764          MOVE DP015-UNDERLINE        TO ASTOREH                   08430000
00765          MOVE -1                     TO ASTOREL                   08440000
00766          MOVE LOW-VALUES             TO ASTOREO                   08450000
00767      ELSE                                                         08460000
W28545         MOVE DP020-LOCATION-NBR     TO PV-EDIT-LOC-NBR           08470000
W26600         MOVE PV-EDIT-LOC-NBR        TO ASTOREO                   08480000
00769          MOVE -1                     TO ASHEETL                   08490000
00770      END-IF.                                                      08500000
00771                                                                   08510000
00772      SET DP030-SET-CURSOR-APPL-1 TO TRUE.                         08520000
00773      MOVE SPACE                  TO ASHEETO.                      08530000
00774                                                                   08540000
00775                                                                   08550000
00776 *----------------------------------------------------------------*08560000
00777 *    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *08570000
00778 *----------------------------------------------------------------*08580000
00779                                                                   08590000
00780  4400-MOVE-COMMAREA-TO-SCREEN.                                    08600000
00781      MOVE ASC-STORE-NBR-X TO ASTOREO.                             08610000
00782      MOVE ASC-SHEET-NBR-X TO ASHEETO.                             08620000
22000                                                                   08630000
22000 *----------------------------------------------------------------*08640000
22000 *    SET STOCKROOM WITHDRAWAL INDICATOR TO 'N'                   *08650000
22000 *----------------------------------------------------------------*08660000
22000  6000-SET-STOCKROOM-IND.                                          08670000
W26600                                                                  08680000
W26600     MOVE ASC-STORE-NBR       TO PV-DB2-STORE-NBR.                08690000
W26600     MOVE PV-DB2-STORE-NBR-9  TO INVPAR-LOC-NBR.                  08700000
W26600                                                                  08701000
22960      EXEC SQL                                                     08702000
J28545         SELECT  A.UNT_BKG_STAT_CDE                               08703005
J28545                ,A.STKRM_WDRWL_IND                                08704005
J28545                ,A.INV_ID                                         08704105
22960          INTO   :INVPAR-UNT-BKG-STAT-CDE                          08705000
22960                ,:INVPAR-STKRM-WDRWL-IND                           08706000
J28545               ,:INVPAR-INV-ID                                    08706105
J28545         FROM  TINVPAR  A                                         08707005
J28545              ,TINCNTL  B                                         08707105
J28545         WHERE A.LOC_NBR             = :INVPAR-LOC-NBR            08708005
J28545             AND A.INV_ID            = B.INV_ID                   08708105
J28545             AND B.ACTV_IND          = 'Y'                        08708205
J28545             AND A.ACTL_FIN_BK_DTE   = :PC-NINES                  08709005
W33304             AND A.LOC_INV_STAT_CDE  = 'IN'                       08709107
22960      END-EXEC.                                                    08710000
22960                                                                   08720000
22960      IF SQLCODE = ZERO                                            08730000
22960          IF INVPAR-STKRM-WDRWL-IND = 'N'                          08740000
22960              MOVE PC-TSYMSG-02894   TO DP020-MSG-NUMBER           08750000
22960          ELSE                                                     08760000
W33304             IF INVPAR-UNT-BKG-STAT-CDE = 'IN'                    08770007
W33304                 OR INVPAR-UNT-BKG-STAT-CDE = 'SL'                08780007
W26600                 MOVE ASC-STORE-NBR  TO PV-DB2-STORE-NBR          08790000
W26600                 MOVE PV-DB2-STORE-NBR-9 TO INVPAR-LOC-NBR        08800000
W26600                 MOVE ASC-STORE-NBR  TO XMT00001-LOC-NBR          08810000
22000                  EXEC SQL                                         08820000
22000                      UPDATE TINVPAR A                             08830000
22000                          SET STKRM_WDRWL_IND = 'N'                08840000
W26600                     WHERE A.LOC_NBR       = :INVPAR-LOC-NBR      08850000
22000                          AND A.ACTL_FIN_BK_DTE  = :PC-NINES       08860000
J28545                         AND A.INV_ID      =  :INVPAR-INV-ID      08861005
22000                          AND NOT EXISTS                           08870000
22000                             (SELECT 1                             08880000
22000                              FROM TSTKRMW B                       08890000
W26600                             WHERE B.LOC_NBR = :XMT00001-LOC-NBR) 08900000
22000                  END-EXEC                                         08910000
22000                  IF SQLCODE = ZERO                                08920000
22000                      MOVE PC-TSYMSG-00059   TO DP020-MSG-NUMBER   08930000
22000                  ELSE                                             08940000
W26600                     MOVE ASC-STORE-NBR  TO PV-DB2-STORE-NBR      08950000
W26600                     MOVE PV-DB2-STORE-NBR-9 TO STKRMW-LOC-NBR    08960000
22960                      EXEC SQL                                     08970000
22960                          SELECT COUNT(*)                          08980000
22960                            INTO :PV-STKRMW-TEST                   08990000
22960                            FROM TSTKRMW                           09000000
W26600                           WHERE LOC_NBR = :STKRMW-LOC-NBR        09010000
22960                      END-EXEC                                     09020000
22000                      IF SQLCODE = ZERO                            09030000
22960                          MOVE PC-TSYMSG-02896 TO DP020-MSG-NUMBER 09040000
22960                      ELSE                                         09050000
22960                          MOVE PC-TSYMSG-00046 TO DP020-MSG-NUMBER 09060000
22960                      END-IF                                       09070000
22000                  END-IF                                           09080000
22960              ELSE                                                 09090000
22960                  MOVE PC-TSYMSG-02895   TO DP020-MSG-NUMBER       09100000
22960              END-IF                                               09110000
22960          END-IF                                                   09120000
22960      ELSE                                                         09130000
22960          MOVE PC-TSYMSG-02897 TO DP020-MSG-NUMBER                 09140000
22960      END-IF.                                                      09150000
22000      SET DP020-MSG-INFORMATIONAL TO TRUE.                         09160000
22000                                                                   09170000
00784 *----------------------------------------------------------------*09180000
00785 *    CURRENT SYSTEM DATE/TIME MODULE                              09190000
00786 *----------------------------------------------------------------*09200000
00787                                                                   09210000
00788      COPY DPPD017.                                                09220000
00789                                                                   09230000
00790 *----------------------------------------------------------------*09240000
00791 *    ABEND PROCESSOR MODULE                                      *09250000
00792 *----------------------------------------------------------------*09260000
00793                                                                   09270000
00794      COPY DPPD013.                                                09280000
