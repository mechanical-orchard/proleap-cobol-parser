000100***************************************************************** 00010006
000200 IDENTIFICATION DIVISION.                                         00020006
000300***************************************************************** 00030006
000400                                                                  00040006
000500 PROGRAM-ID.             MRKUP059.                                00050006
000600 AUTHOR.                 SCOTT VANG.                              00060006
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070006
000800 DATE-WRITTEN            05-08-95.                                00080006
000900 DATE-COMPILED.                                                   00090006
001000                                                                  00100006
001100***************************************************************** 00110006
001200*  DELETE INVALID SKUS AND UPDATE DISCONTINUED FROM INFOREM     * 00120006
001300*                                                               * 00130006
001400*  THIS PROGRAM WILL DELETE SKUS DELETED FROM FASHION SALES.    * 00140006
001500*  SKUS THAT ARE DISCONTINUED IN FASHION SALES WILL BE          * 00150006
001600*  DISCONTINUED IN INFOREM.  A REPORT LISTING THE SKUS AND      * 00160006
001700*  SKU DESCRIPTIONS OF UPDATED RECORDS WILL BE CREATED.         * 00170006
001800*                                                               * 00180006
001900***************************************************************** 00190006
002000* 01/05/99 - AEK                                                * 00200006
002100*  CHANGED WHERE PART OF SELECT CLAUSE SO THAT THE PROGRAM      * 00210006
002200*  CORRECTLY TURN'S OFF SKUS FOR  SYSTEM '0'                    * 00220006
002300*                                                               * 00230006
002400* 03/22/99 - LINDA FRIESS      PITS # 291943                    * 00240006
002500*  ADDED DATE COMPARISON TO SELECT IN PARAGRAPH X100            * 00250006
002600*                                                               * 00260006
002700* 05/13/99 - ANNE KINTOPF      PITS # 309322                    * 00270006
002800*  ADDED CODE TO DELETE ROWS OFF TMRISHS TABLE IF THEY ARE      * 00280006
002900*  MORE THAN 15 WEEKS OLD. THE ROWS THAT ARE DELETED ARE        * 00290006
003000*  WRITTEN TO A NEW OUTPUT FILE BEFORE THEY ARE DELETED.        * 00300006
003100*                                                               * 00310006
003200* 09/01/99 - T BAGWELL                                          * 00320006
003300*  REMOVE CODE THAT PROCESSES STATUS CODES AS A NEW PROGRAM     * 00330006
003400*  (MRKUP096) NOW HANDLES THOSE TRANSACTIONS.                   * 00340006
003500*                                                               * 00350006
003600* 04/10/00 - T BAGWELL                                          * 00360011
003700*  REMOVE TMDSEAR TABLE FROM COPY LIST                          * 00370011
003800*                                                               * 00380011
002600*  CHANGED 06/10/04 BY ANNE KINTOPF               WR# 02223     * 00392013
002700*    CHANGED PROGRAM TO EXPECT A 5 DIGIT NUMERIC STORE          * 00393013
002800*    NUMBER FOR STORE NUMBER EXPANSION.                         * 00394013
003100***************************************************************** 00395013
004000 ENVIRONMENT DIVISION.                                            00400006
004100***************************************************************** 00410006
004200                                                                  00420006
004300 CONFIGURATION SECTION.                                           00430006
004400                                                                  00440006
004500 SOURCE-COMPUTER.        IBM-3090.                                00450006
004600 OBJECT-COMPUTER.        IBM-3090.                                00460006
004700                                                                  00470006
004800 INPUT-OUTPUT SECTION.                                            00480006
004900                                                                  00490006
005000 FILE-CONTROL.                                                    00500006
005100                                                                  00510006
005200     SELECT OUTPUT-FILE           ASSIGN TO OUT01.                00520006
005300*                                                                 00530006
005400     SELECT OUTPUT2-FILE          ASSIGN TO OUT02.                00540006
005500*                                                                 00550006
005600***************************************************************** 00560006
005700 DATA DIVISION.                                                   00570006
005800***************************************************************** 00580006
005900*                                                                 00590006
006000 FILE SECTION.                                                    00600006
006100                                                                  00610006
006200*                                                                 00620006
006300 FD  OUTPUT-FILE                                                  00630006
006400     RECORDING MODE F                                             00640006
006500     BLOCK CONTAINS 0 RECORDS                                     00650006
006600     RECORD CONTAINS 221 CHARACTERS                               00660018
006700     LABEL RECORDS ARE OMITTED                                    00670006
006800     DATA RECORD IS OUTPUT-REC.                                   00680006
006900                                                                  00690006
007000 01  OUTPUT-REC.                                                  00700006
007100     05  OUTPUT-LAYOUT                        PIC X(220).         00710006
007200                                                                  00720006
007300 FD  OUTPUT2-FILE                                                 00730006
007400     RECORDING MODE F                                             00740006
007500     BLOCK CONTAINS 0 RECORDS                                     00750006
007600     RECORD CONTAINS 221 CHARACTERS                               00760018
007700     LABEL RECORDS ARE OMITTED                                    00770006
007800     DATA RECORD IS OUTPUT2-REC.                                  00780006
007900                                                                  00790006
008000 01  OUTPUT2-REC.                                                 00800006
008100     05  OUTPUT2-LAYOUT                       PIC X(220).         00810006
008200*                                                                 00820006
008300******************************************                        00830006
008400 WORKING-STORAGE SECTION.                                         00840006
008500******************************************                        00850006
009100******************************************                        00910006
009200* STANDARD HEADER LINE - KOHLS 132 COL                            00920006
009300******************************************                        00930006
009400* COPYBOOKS FOR THE CALENDAR ROUTINE                              00940006
009500******************************************                        00950006
009600     COPY DPWS024.                                                00960006
009700     COPY DPWS500.                                                00970006
009800******************************************                        00980006
009900* COPYBOOK FOR OUTPUT RECOVERY DATASET                            00990006
010000******************************************                        01000006
010100     COPY MRRD166.                                                01010006
010200                                                                  01020006
010300 01  FILLER.                                                      01030006
010400     05  FILLER                      PIC  X(36)    VALUE          01040006
010500         ' ***** WORKING STORAGE PGM=MRKUP059 '.                  01050006
010600     05  FILLER                      PIC  X(10)    VALUE          01060006
010700         ' LOCATION='.                                            01070006
010800     05  PGM-LOCATION                PIC  X(04)    VALUE SPACE.   01080006
010900     05  FILLER                      PIC  X(06)    VALUE          01090006
011000         ' *****'.                                                01100006
011100                                                                  01110006
011200 01  PROGRAM-SWITCHES.                                            01120006
011300     05  PS-EOC-ITEM-CSR             PIC  X(01)    VALUE 'N'.     01130006
011400         88  EOC-ITEM-CSR                          VALUE 'Y'.     01140006
011500                                                                  01150006
011600     05  PS-EOF-ITST-CSR             PIC  X(01)    VALUE 'N'.     01160006
011700         88  EOF-ITST-CSR                          VALUE 'Y'.     01170006
011800                                                                  01180006
011900     05  PS-EOF-ISFE-CSR             PIC  X(01)    VALUE 'N'.     01190006
012000         88  EOF-ISFE-CSR                          VALUE 'Y'.     01200006
012100                                                                  01210006
012200     05  PS-EOF-ISHS-CSR             PIC  X(01)    VALUE 'N'.     01220006
012300         88  EOF-ISHS-CSR                          VALUE 'Y'.     01230006
012400                                                                  01240006
012500     05  PS-EOF-TMRISHS-CSR          PIC  X(01)    VALUE 'N'.     01250006
012600         88  EOF-TMRISHS-CSR                       VALUE 'Y'.     01260006
012700                                                                  01270006
012800 01  PC-CONSTANTS.                                                01280006
012900     05  PC-PGM-DPKUT500             PIC  X(08)    VALUE          01290006
013000                                                   'DPKUT500'.    01300006
013100     05  PC-PLUS-1                   PIC S9(04)    VALUE +1       01310006
013200                                                   COMP SYNC.     01320006
013300     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     01330006
013400                                                   COMP SYNC.     01340006
013500     05  PC-N                        PIC  X(01)    VALUE 'N'.     01350006
013600     05  PC-Y                        PIC  X(01)    VALUE 'Y'.     01360006
013700     05  PC-RT-ZERO                  PIC S9(03)V   VALUE ZERO     01370006
013800                                                   COMP-3.        01380006
013900     05  PC-RT-DAY-ZERO              PIC S9(03)V   VALUE ZERO     01390006
014000                                                   COMP-3.        01400006
014100     05  PC-FT-X                     PIC  X(01)    VALUE 'X'.     01410006
014200     05  PC-OP-QTY-0                 PIC S9(9)     VALUE ZEROES   01420006
014300                                                   COMP-3.        01430006
014400     05  PC-OUTL-QTY-0               PIC S9(9)     VALUE ZEROES   01440006
014500                                                   COMP-3.        01450006
014600                                                                  01460006
014700     05  PC-MAX-LINES                 PIC S9(3)      VALUE +52.   01470006
014800     05  PC-1                         PIC  X         VALUE '1'.   01480006
014900     05  PC-2                         PIC  X         VALUE '2'.   01490006
015000     05  PC-3                         PIC  X         VALUE '3'.   01500006
015100     05  PC-4                         PIC  X         VALUE '4'.   01510006
015200     05  PC-5                         PIC  X         VALUE '5'.   01520006
015300                                                                  01530006
015400 01  PV-ACCUMULATOR-FIELDS.                                       01540006
015500     05  PV-DELETE-CNT               PIC S9(07)    VALUE ZERO     01550006
015600                                                   COMP-3.        01560006
015700     05  PV-CHANGE-CNT               PIC S9(07)    VALUE ZERO     01570006
015800                                                   COMP-3.        01580006
015900     05  PV-DELETE-HIST-CNT          PIC S9(07)    VALUE ZERO     01590006
016000                                                   COMP-3.        01600006
016100     05  PV-CURR-TMST                PIC  X(26)    VALUE SPACES.  01610006
016200     05  PV-COMMIT-TMST              PIC  X(26)    VALUE SPACES.  01620006
016300     05  PV-BEGIN-WEEK-YEAR.                                      01630006
016400         10  PV-BEGIN-CCYY               PIC  X(04).              01640006
016500         10  FILLER REDEFINES PV-BEGIN-CCYY.                      01650006
016600             15  PV-BEGIN-CENTURY        PIC  X(02).              01660006
016700             15  PV-BEGIN-YEAR           PIC  X(02).              01670006
016800         10  PV-BEGIN-WEEK               PIC  X(02).              01680006
016900     05  PV-END-WEEK-YEAR.                                        01690006
017000         10  PV-END-CCYY                 PIC  X(04).              01700006
017100         10  FILLER REDEFINES PV-END-CCYY.                        01710006
017200             15  PV-END-CENTURY          PIC  X(02).              01720006
017300             15  PV-END-YEAR             PIC  X(02).              01730006
017400         10  PV-END-WEEK                 PIC  X(02).              01740006
017500     05  PV-F2                       PIC  X(02)    VALUE 'F2'.    01750006
017600     05  PV-DATE.                                                 01760006
017700         10  PV-CC                   PIC 9(2) VALUE ZEROES.       01770006
017800         10  PV-YR                   PIC 9(2) VALUE ZEROES.       01780006
017900         10  PV-MO                   PIC 9(2) VALUE ZEROES.       01790006
018000         10  PV-DY                   PIC 9(2) VALUE ZEROES.       01800006
018100*                                                                 01810006
018200*                                                                 01820006
018300 01  CD-CPU-DATE.                                                 01830006
018400     05  CD-CPU-YR                    PIC 9(2)       VALUE ZEROS. 01840006
018500     05  CD-CPU-MO                    PIC 9(2)       VALUE ZEROS. 01850006
018600     05  CD-CPU-DY                    PIC 9(2)       VALUE ZEROS. 01860006
018700*                                                                 01870006
018800 01  PV-CPU-DATE.                                                 01880006
018900     05  PV-CPU-MO                    PIC 9(2)       VALUE ZEROS. 01890006
019000     05  FILLER                       PIC X(1)       VALUE '/'.   01900006
019100     05  PV-CPU-DY                    PIC 9(2)       VALUE ZEROS. 01910006
019200     05  FILLER                       PIC X(1)       VALUE '/'.   01920006
019300     05  PV-CPU-YR                    PIC 9(2)       VALUE ZEROS. 01930006
019400*                                                                 01940006
019500 01  CT-CPU-TIME.                                                 01950006
019600     05  CT-CPU-HR                    PIC 9(2)       VALUE ZEROS. 01960006
019700     05  CT-CPU-MIN                   PIC 9(2)       VALUE ZEROS. 01970006
019800     05  CT-CPU-SEC                   PIC 9(2)       VALUE ZEROS. 01980006
019900     05  CT-CPU-HSEC                  PIC 9(2)       VALUE ZEROS. 01990006
020000*                                                                 02000006
020100 01  PV-MISC-FIELDS.                                              02010006
020200     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     02020006
020300                                                   COMP SYNC.     02030006
020400     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  02040006
020500                                                                  02050006
020600     05  PV-DELETE-ITEM              PIC  S9(15)V  VALUE ZERO     02060006
020700                                                    COMP-3.       02070006
020800     05  PV-CHANGE-ITEM              PIC  S9(15)V  VALUE ZERO     02080006
020900                                                    COMP-3.       02090006
021000     05  PV-LINE-CNT                 PIC  S9(04)   VALUE ZEROS    02100006
021100                                                    COMP-3.       02110006
021200     05  PV-PAGE-CNT                 PIC 9(04)     VALUE ZEROS    02120006
021300                                                     COMP-3.      02130006
021400     05  PV-DEPT-NBR                 PIC   X(03)   VALUE SPACES.  02140006
021500                                                                  02150006
021600     05  PV-DEPT-NBR-HOLD            PIC   X(03)   VALUE SPACES.  02160006
021700                                                                  02170006
021800     05  PV-DEPT-DESC                PIC   X(25)   VALUE SPACES.  02180006
021900                                                                  02190006
022200     05  PV-STAT-CDE                 PIC S9(03)V   VALUE ZERO     02220006
022300                                                      COMP-3.     02230006
022400     05  PV-RT-NBR                   PIC S9(03)V   VALUE ZERO     02240006
022500                                                       COMP-3.    02250006
022600     05  PV-RT-DAY-NBR               PIC S9(03)V   VALUE ZERO     02260006
022700                                                        COMP-3.   02270006
022800     05  PV-FT-CDE                   PIC  X(01)    VALUE SPACES.  02280006
022900                                                                  02290006
023000     05  PV-CLASS-NBR                PIC  X(02)    VALUE SPACES.  02300006
023100                                                                  02310006
023200     05  PV-SEQ-NBR                  PIC  X(03)    VALUE SPACES.  02320006
023300                                                                  02330006
023400     EXEC SQL                                                     02340006
023500         INCLUDE TCKRSTCN                                         02350006
023600     END-EXEC.                                                    02360006
023700                                                                  02370006
023800     EXEC SQL                                                     02380006
023900         INCLUDE TMRITEM                                          02390006
024000     END-EXEC.                                                    02400006
024100                                                                  02410006
024200     EXEC SQL                                                     02420006
024300         INCLUDE TMRITST                                          02430006
024400     END-EXEC.                                                    02440006
024500                                                                  02450006
024600     EXEC SQL                                                     02460006
024700         INCLUDE TMRISFE                                          02470006
024800     END-EXEC.                                                    02480006
024900                                                                  02490006
025000     EXEC SQL                                                     02500006
025100         INCLUDE TSK                                              02510006
025200     END-EXEC.                                                    02520006
025300                                                                  02530006
025400     EXEC SQL                                                     02540006
025500         INCLUDE TMRISHS                                          02550006
025600     END-EXEC.                                                    02560006
025700                                                                  02570006
025800* DB2 COMMUNICATION AREA                                          02580006
025900                                                                  02590006
026000     EXEC SQL                                                     02600006
026100         INCLUDE SQLCA                                            02610006
026200     END-EXEC.                                                    02620006
026300                                                                  02630006
026400* DB2 COMMUNICATION AREA2                                         02640006
026500                                                                  02650006
026600     COPY SQLCA2.                                                 02660006
026700                                                                  02670006
026800******************************************                        02680006
026900                                                                  02690006
027000     EXEC SQL                                                     02700006
027100       DECLARE DEL_CSR CURSOR WITH HOLD FOR                       02710006
027200     SELECT A.ITEM_NBR                                            02720006
027300       FROM TMRITEM A                                             02730006
027400       WHERE NOT EXISTS(SELECT 'X'         FROM TSK B             02740006
027500                         WHERE A.ITEM_NBR = B.ITEM_NMBR)          02750006
027600     END-EXEC.                                                    02760006
027700******************************************                        02770006
027800                                                                  02780006
027900     EXEC SQL                                                     02790006
028000       DECLARE TMRITST CURSOR WITH HOLD FOR                       02800006
028100     SELECT      ITEM_NBR                                         02810006
028200                ,STR_NBR                                          02820006
028300                ,COMSTK_QTY                                       02830006
028400                ,SPOQSW_CDE                                       02840006
028500                ,SPOQ_QTY                                         02850006
028600                ,FT_CDE                                           02860006
028700                ,OSTRAT_QTY                                       02870006
028800                ,CSTOCK_QTY                                       02880006
028900                ,MINOUTL_QTY                                      02890006
029000                ,MAXOUTL_QTY                                      02900006
029100                ,FOQ_QTY                                          02910006
029200                ,TMIN_QTY                                         02920006
029300                ,USERMIN_QTY                                      02930006
029400                ,USERMAX_QTY                                      02940006
029500                ,DD_FCTR                                          02950006
029600                ,DDI_FCTR                                         02960006
029700                ,LPP_QTY                                          02970006
029800                ,MADSS_QTY                                        02980006
029900                ,FWMAD_QTY                                        02990006
030000                ,TRNDP_PCT                                        03000006
030100                ,MSDTS_QTY                                        03010006
030200                ,MADTS_QTY                                        03020006
030300                ,LTVFACT_FCTR                                     03030006
030400                ,PCTZ_PCT                                         03040006
030500                ,MADSTAT_CDE                                      03050006
030600                ,DFLREG_CDE                                       03060006
030700                ,TSREG_CDE                                        03070006
030800                ,DIREG_CDE                                        03080006
030900                ,BYPREG_CDE                                       03090006
031000                ,LDD_FCTR                                         03100006
031100                ,LDDI_FCTR                                        03110006
031200                ,LMADSS_QTY                                       03120006
031300                ,LFWMAD_QTY                                       03130006
031400                ,LCPS_QTY                                         03140006
031500                ,OUTSTAT_CDE                                      03150006
031600                ,LRTFCST_NBR                                      03160006
031700                ,ORDSTAT_CDE                                      03170006
031800                ,PTAG_ID                                          03180006
031900                ,MINDD_QTY                                        03190006
032000                ,ON_ORDER_QTY                                     03200006
032100                ,MAXOQP_PCT                                       03210006
032200                ,OUTL_QTY                                         03220006
032300                ,OP_QTY                                           03230006
032400                ,FTJOPF_CDE                                       03240006
032500                ,CSTKMINT1_PCT                                    03250006
032600                ,CSTKMINT2_PCT                                    03260006
032700                ,CSTKMINT3_PCT                                    03270006
032800                ,CSTKMINT4_PCT                                    03280006
032900                ,CSTKMINT5_PCT                                    03290006
033000                ,CSTKMINT6_PCT                                    03300006
033100                ,CSTKMAXT1_PCT                                    03310006
033200                ,CSTKMAXT2_PCT                                    03320006
033300                ,CSTKMAXT3_PCT                                    03330006
033400                ,CSTKMAXT4_PCT                                    03340006
033500                ,CSTKMAXT5_PCT                                    03350006
033600                ,CSTKMAXT6_PCT                                    03360006
033700                ,SSTOCK_QTY                                       03370006
033800     FROM TMRITST A                                               03380006
033900     WHERE A.ITEM_NBR = :PV-DELETE-ITEM                           03390006
034000     END-EXEC.                                                    03400006
034100******************************************                        03410006
034200                                                                  03420006
034300                                                                  03430006
034400     EXEC SQL                                                     03440006
034500       DECLARE TMRISFE CURSOR WITH HOLD FOR                       03450006
034600     SELECT                                                       03460006
034700                 ITEM_NBR                                         03470006
034800                ,STR_NBR                                          03480006
034900                ,SEQ_NBR                                          03490006
035000                ,LFWM_QTY                                         03500006
035100                ,FWM_QTY                                          03510006
035200     FROM TMRISFE A                                               03520006
035300     WHERE A.ITEM_NBR = :PV-DELETE-ITEM                           03530006
035400     END-EXEC.                                                    03540006
035500*                                                                 03550006
035600******************************************                        03560006
035700                                                                  03570006
035800                                                                  03580006
035900     EXEC SQL                                                     03590006
036000       DECLARE TMRISHS CURSOR WITH HOLD FOR                       03600006
036100     SELECT                                                       03610006
036200                 ITM_NBR                                          03620006
036300                ,STR_NBR                                          03630006
036400                ,YR_NBR                                           03640006
036500                ,WK_NBR                                           03650006
036600                ,ITM_REV_ID                                       03660006
036700                ,SLS_HIST_QTY                                     03670006
036800                ,OH_HIST_QTY                                      03680006
036900                ,MAD_HIST_QTY                                     03690006
037000                ,DSD_HIST_QTY                                     03700006
037100     FROM TMRISHS A                                               03710006
037200     WHERE A.ITM_NBR = :PV-DELETE-ITEM                            03720006
037300     END-EXEC.                                                    03730006
037400*                                                                 03740006
037500     EXEC SQL                                                     03750006
037600          DECLARE TMRISHS_DEL_CSR CURSOR WITH HOLD FOR            03760006
037700     SELECT                                                       03770006
037800                 ITM_NBR                                          03780006
037900                ,STR_NBR                                          03790006
038000                ,YR_NBR                                           03800006
038100                ,WK_NBR                                           03810006
038200                ,ITM_REV_ID                                       03820006
038300                ,SLS_HIST_QTY                                     03830006
038400                ,OH_HIST_QTY                                      03840006
038500                ,MAD_HIST_QTY                                     03850006
038600                ,DSD_HIST_QTY                                     03860006
038700        FROM  TMRISHS                                             03870006
038800        WHERE (YR_NBR = :PV-END-CCYY AND WK_NBR > :PV-END-WEEK) OR03880017
038900          (YR_NBR = :PV-BEGIN-CCYY AND WK_NBR < :PV-BEGIN-WEEK) OR03890017
039000          (YR_NBR NOT IN (:PV-BEGIN-CCYY, :PV-END-CCYY))          03900017
039100     END-EXEC.                                                    03910006
039200*                                                                 03920006
039300***************************************************************** 03930006
039400 PROCEDURE DIVISION.                                              03940006
039500***************************************************************** 03950006
039600 A000-MAINLINE-PROCESSING.                                        03960006
039700                                                                  03970006
039800     PERFORM A100-INITIALIZATION.                                 03980006
039900                                                                  03990006
040000     PERFORM B000-PROCESS-DELETE-RECORD                           04000006
040100             UNTIL EOC-ITEM-CSR.                                  04010006
040200                                                                  04020006
040300     MOVE PC-N TO PS-EOC-ITEM-CSR                                 04030006
040400                                                                  04040006
040500                                                                  04050006
040600     PERFORM B002-PROCESS-TMRISHS-DELETE.                         04060006
040700                                                                  04070006
040800     CLOSE  OUTPUT-FILE                                           04080007
040900            OUTPUT2-FILE.                                         04090006
041000                                                                  04100006
041100     GOBACK.                                                      04110006
041200*                                                                 04120006
041300******************************************************************04130006
041400** OPEN THE SYSTEM FILE AND ACCEPT CONTROL CARDS.                 04140006
041500** CALL CALENDAR ROUTINES TO RETRIEVE VALUES NEEDED IN PROGRAM    04150006
041600******************************************************************04160006
041700 A100-INITIALIZATION.                                             04170006
041800                                                                  04180006
041900     OPEN OUTPUT OUTPUT-FILE                                      04190007
042000                 OUTPUT2-FILE.                                    04200006
042100                                                                  04210006
042200*                                                                 04220006
042300*  SET UP FIRST SCHEDULED COMMIT TIME                             04230006
042400*                                                                 04240006
042500     EXEC SQL                                                     04250006
042600         SELECT  (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)    04260006
042700           INTO  :PV-COMMIT-TMST                                  04270006
042800           FROM  TCKRSTCNTL                                       04280006
042900          WHERE  PLAN_NAME = 'MRKUP059'                           04290006
043000     END-EXEC.                                                    04300006
043100                                                                  04310006
043200     IF SQLCODE = +0                                              04320006
043300         CONTINUE                                                 04330006
043400     ELSE                                                         04340006
043500         DISPLAY 'PARAGRAPH A100, BAD SELECT FOR TIMESTAMP'       04350006
043600         DISPLAY 'SQLCODE ' SQLCODE                               04360006
043700         DISPLAY ' '                                              04370006
043800         PERFORM Z999-SQL-ERROR                                   04380006
043900     END-IF.                                                      04390006
044000                                                                  04400006
044100                                                                  04410006
044200     PERFORM S100-OPEN-DEL-CSR.                                   04420006
044300                                                                  04430006
044400******************************************************************04440006
044500*  PROCESS DELETE RECORD UNTIL EOC                               *04450006
044600******************************************************************04460006
044700 B000-PROCESS-DELETE-RECORD.                                      04470006
044800                                                                  04480006
044900     PERFORM T300-FETCH-DEL-ITEM-CURSOR.                          04490006
045000                                                                  04500006
045100     IF EOC-ITEM-CSR                                              04510006
045200       CONTINUE                                                   04520006
045300     ELSE                                                         04530006
045400       PERFORM T300-FETCH-DEL-ITEM-CURSOR                         04540006
045500           UNTIL EOC-ITEM-CSR                                     04550006
045600     END-IF.                                                      04560006
045700*                                                                 04570006
045800******************************************************************04580006
045900* THIS PARAGRAPH PROCESSES THE TMRISHS DELETE CURSOR.            *04590006
046000******************************************************************04600006
046100 B002-PROCESS-TMRISHS-DELETE.                                     04610015
046200                                                                  04620006
046300     PERFORM Z910-COMMIT.                                         04630006
046400     PERFORM R100-SET-CURSOR-DATE.                                04640006
046500     PERFORM O500-OPEN-TMRISHS-DEL-CURSOR.                        04650006
046600     PERFORM S500-FETCH-TMRISHS-DEL-CURSOR                        04660006
046700             UNTIL EOF-TMRISHS-CSR.                               04670006
046800     DISPLAY 'QUANTITY OF HISTORY RECORDS DELETED: '              04680006
046900                                               PV-DELETE-HIST-CNT.04690006
047000     PERFORM C500-CLOSE-TMRISHS-DEL-CURSOR.                       04700006
047100                                                                  04710006
047200******************************************************************04720006
047300*  CLOSE MRITST CURSOR                                           *04730006
047400******************************************************************04740006
047500 C200-CLOSE-TMRITST.                                              04750006
047600                                                                  04760006
047700     MOVE 'C200'                   TO PGM-LOCATION.               04770006
047800     MOVE 'C200-CLOSE-TMRITST     '                               04780006
047900                                   TO PV-ABEND-PARAGRAPH.         04790006
048000     EXEC SQL                                                     04800006
048100         CLOSE TMRITST                                            04810006
048200     END-EXEC.                                                    04820006
048300                                                                  04830006
048400     EVALUATE TRUE                                                04840006
048500       WHEN SQLCODE         = ZERO                                04850006
048600       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    04860006
048700         CONTINUE                                                 04870006
048800       WHEN OTHER                                                 04880006
048900         DISPLAY PV-ABEND-PARAGRAPH                               04890006
049000         PERFORM Z999-SQL-ERROR                                   04900006
049100     END-EVALUATE.                                                04910006
049200*                                                                 04920006
049300******************************************************************04930006
049400*  CLOSE DELETE CURSOR                                           *04940006
049500******************************************************************04950006
049600 C300-CLOSE-TMRISFE.                                              04960006
049700                                                                  04970006
049800     MOVE 'C300'                   TO PGM-LOCATION.               04980006
049900     MOVE 'C300-CLOSE-TMRISFE     '                               04990006
050000                                   TO PV-ABEND-PARAGRAPH.         05000006
050100     EXEC SQL                                                     05010006
050200         CLOSE TMRISFE                                            05020006
050300     END-EXEC.                                                    05030006
050400                                                                  05040006
050500     EVALUATE TRUE                                                05050006
050600       WHEN SQLCODE         = ZERO                                05060006
050700       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    05070006
050800         CONTINUE                                                 05080006
050900       WHEN OTHER                                                 05090006
051000         DISPLAY PV-ABEND-PARAGRAPH                               05100006
051100         PERFORM Z999-SQL-ERROR                                   05110006
051200     END-EVALUATE.                                                05120006
051300*                                                                 05130006
051400*                                                                 05140006
051500******************************************************************05150006
051600*  CLOSE DELETE CURSOR                                           *05160006
051700******************************************************************05170006
051800 C400-CLOSE-TMRISHS.                                              05180006
051900                                                                  05190006
052000     MOVE 'C400'                   TO PGM-LOCATION.               05200006
052100     MOVE 'C400-CLOSE-TMRISHS     '                               05210006
052200                                   TO PV-ABEND-PARAGRAPH.         05220006
052300     EXEC SQL                                                     05230006
052400         CLOSE TMRISHS                                            05240006
052500     END-EXEC.                                                    05250006
052600                                                                  05260006
052700     EVALUATE TRUE                                                05270006
052800       WHEN SQLCODE         = ZERO                                05280006
052900       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    05290006
053000         CONTINUE                                                 05300006
053100       WHEN OTHER                                                 05310006
053200         DISPLAY PV-ABEND-PARAGRAPH                               05320006
053300         PERFORM Z999-SQL-ERROR                                   05330006
053400     END-EVALUATE.                                                05340006
053500*                                                                 05350006
053600******************************************************************05360006
053700* CLOSE TMRISHS DELETE CURSOR                                     05370006
053800******************************************************************05380006
053900 C500-CLOSE-TMRISHS-DEL-CURSOR.                                   05390006
054000*                                                                 05400006
054100     MOVE 'C500'                   TO PGM-LOCATION.               05410006
054200     MOVE 'C500-CLOSE-TMRISHS-DEL-CURSOR'                         05420006
054300                                   TO PV-ABEND-PARAGRAPH.         05430006
054400                                                                  05440006
054500     EXEC SQL                                                     05450006
054600         CLOSE TMRISHS_DEL_CSR                                    05460006
054700     END-EXEC.                                                    05470006
054800                                                                  05480006
054900     EVALUATE TRUE                                                05490006
055000       WHEN SQLCODE         = ZERO                                05500006
055100       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    05510006
055200         CONTINUE                                                 05520006
055300       WHEN OTHER                                                 05530006
055400         DISPLAY PV-ABEND-PARAGRAPH                               05540006
055500         PERFORM Z999-SQL-ERROR                                   05550006
055600     END-EVALUATE.                                                05560006
055700*                                                                 05570006
055800******************************************************************05580006
055900** DELETE FROM THE TMRITEM TABLE FOR DELETE SKUS PROCESS        **05590006
056000******************************************************************05600006
056100 D001-DEL-SKUS-TMRITEM.                                           05610006
056200                                                                  05620006
056300     MOVE 'D001'                   TO PGM-LOCATION.               05630006
056400     MOVE 'D001-DEL-SKUS-TMRITEM'  TO PV-ABEND-PARAGRAPH.         05640006
056500                                                                  05650006
056600     EXEC SQL                                                     05660006
056700         DELETE                                                   05670006
056800           FROM TMRITEM                                           05680006
056900          WHERE ITEM_NBR = :PV-DELETE-ITEM                        05690006
057000     END-EXEC.                                                    05700006
057100                                                                  05710006
057200     EVALUATE TRUE                                                05720006
057300       WHEN SQLCODE         = ZERO                                05730006
057400       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    05740006
057500         CONTINUE                                                 05750006
057600       WHEN OTHER                                                 05760006
057700         DISPLAY PV-ABEND-PARAGRAPH                               05770006
057800         PERFORM Z999-SQL-ERROR                                   05780006
057900     END-EVALUATE.                                                05790006
058000*                                                                 05800006
058100******************************************************************05810006
058200** DELETE FROM THE TMRITST TABLE FOR DELETE SKUS PROCESS        **05820006
058300******************************************************************05830006
058400 D002-DEL-SKUS-TMRITST.                                           05840006
058500                                                                  05850006
058600     MOVE 'D002'                   TO PGM-LOCATION.               05860006
058700     MOVE 'D002-DEL-SKUS-TMRITST'  TO PV-ABEND-PARAGRAPH.         05870006
058800                                                                  05880006
058900     EXEC SQL                                                     05890006
059000         DELETE                                                   05900006
059100           FROM TMRITST                                           05910006
059200          WHERE ITEM_NBR = :PV-DELETE-ITEM                        05920006
059300     END-EXEC.                                                    05930006
059400                                                                  05940006
059500     EVALUATE TRUE                                                05950006
059600       WHEN SQLCODE         = ZERO                                05960006
059700       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    05970006
059800         CONTINUE                                                 05980006
059900       WHEN OTHER                                                 05990006
060000         DISPLAY PV-ABEND-PARAGRAPH                               06000006
060100         PERFORM Z999-SQL-ERROR                                   06010006
060200     END-EVALUATE.                                                06020006
060300*                                                                 06030006
060400******************************************************************06040006
060500** DELETE FROM THE TMRISHS TABLE FROM DATE CRITERIA             **06050006
060600******************************************************************06060006
060700 D003-DELETE-TMRISHS.                                             06070006
060800*                                                                 06080006
060900     MOVE 'D003'                   TO PGM-LOCATION.               06090006
061000     MOVE 'D003-DELETE-TMRISHS'    TO PV-ABEND-PARAGRAPH.         06100006
061100                                                                  06110006
061200     EXEC SQL                                                     06120006
061300         DELETE FROM TMRISHS                                      06130006
061400             WHERE CURRENT OF TMRISHS_DEL_CSR                     06140006
061500     END-EXEC.                                                    06150006
061600                                                                  06160006
061700     EVALUATE TRUE                                                06170006
061800       WHEN SQLCODE         = ZERO                                06180006
061900       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    06190006
062000         CONTINUE                                                 06200006
062100       WHEN OTHER                                                 06210006
062200         DISPLAY PV-ABEND-PARAGRAPH                               06220006
062300         PERFORM Z999-SQL-ERROR                                   06230006
062400     END-EVALUATE.                                                06240006
062500*                                                                 06250006
062600****************************************************************  06260006
062700* WRITES THE HEADING LINES FOR THE REPORT WHEN THERE IS A      *  06270006
062800* FULL PAGE.                                                   *  06280006
062900******************************************************************06290006
063000* THIS PARAGRAPH OPENS THE TMRITST CURSOR                         06300006
063100******************************************************************06310006
063200 O200-OPEN-TMRITST.                                               06320006
063300                                                                  06330006
063400     MOVE 'O200'                   TO PGM-LOCATION.               06340006
063500     MOVE 'O200-OPEN-TMRITST'      TO PV-ABEND-PARAGRAPH.         06350006
063600                                                                  06360006
063700     EXEC SQL                                                     06370006
063800         OPEN TMRITST                                             06380006
063900     END-EXEC.                                                    06390006
064000                                                                  06400006
064100     EVALUATE TRUE                                                06410006
064200       WHEN SQLCODE         = ZERO                                06420006
064300       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    06430006
064400         CONTINUE                                                 06440006
064500       WHEN OTHER                                                 06450006
064600         DISPLAY PV-ABEND-PARAGRAPH                               06460006
064700         PERFORM Z999-SQL-ERROR                                   06470006
064800     END-EVALUATE.                                                06480006
064900*                                                                 06490006
065000*                                                                 06500006
065100******************************************************************06510006
065200* THIS PARAGRAPH OPENS THE TMRITST CURSOR                         06520006
065300******************************************************************06530006
065400 O300-OPEN-TMRISFE.                                               06540006
065500                                                                  06550006
065600     MOVE 'O300'                   TO PGM-LOCATION.               06560006
065700     MOVE 'O300-OPEN-TMRISFE'      TO PV-ABEND-PARAGRAPH.         06570006
065800                                                                  06580006
065900     EXEC SQL                                                     06590006
066000         OPEN TMRISFE                                             06600006
066100     END-EXEC.                                                    06610006
066200                                                                  06620006
066300     EVALUATE TRUE                                                06630006
066400       WHEN SQLCODE         = ZERO                                06640006
066500       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    06650006
066600         CONTINUE                                                 06660006
066700       WHEN OTHER                                                 06670006
066800         DISPLAY PV-ABEND-PARAGRAPH                               06680006
066900         PERFORM Z999-SQL-ERROR                                   06690006
067000     END-EVALUATE.                                                06700006
067100*                                                                 06710006
067200******************************************************************06720006
067300* THIS PARAGRAPH OPENS THE TMRISHS CURSOR                         06730006
067400******************************************************************06740006
067500 O400-OPEN-TMRISHS.                                               06750006
067600                                                                  06760006
067700     MOVE 'O400'                   TO PGM-LOCATION.               06770006
067800     MOVE 'O400-OPEN-TMRISHS'      TO PV-ABEND-PARAGRAPH.         06780006
067900                                                                  06790006
068000     EXEC SQL                                                     06800006
068100         OPEN TMRISHS                                             06810006
068200     END-EXEC.                                                    06820006
068300                                                                  06830006
068400     EVALUATE TRUE                                                06840006
068500       WHEN SQLCODE         = ZERO                                06850006
068600       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    06860006
068700         CONTINUE                                                 06870006
068800       WHEN OTHER                                                 06880006
068900         DISPLAY PV-ABEND-PARAGRAPH                               06890006
069000         PERFORM Z999-SQL-ERROR                                   06900006
069100     END-EVALUATE.                                                06910006
069200*                                                                 06920006
069300******************************************************************06930006
069400* THIS PARAGRAPH OPENS THE TMRISHS DELETE CURSOR                  06940006
069500******************************************************************06950006
069600 O500-OPEN-TMRISHS-DEL-CURSOR.                                    06960006
069700*                                                                 06970006
069800     MOVE 'O500'                   TO PGM-LOCATION.               06980006
069900     MOVE 'O500-OPEN-TMRISHS-DEL-CURSOR'   TO PV-ABEND-PARAGRAPH. 06990006
070000                                                                  07000006
070100     EXEC SQL                                                     07010006
070200         OPEN TMRISHS_DEL_CSR                                     07020006
070300     END-EXEC.                                                    07030006
070400                                                                  07040006
070500     EVALUATE TRUE                                                07050006
070600       WHEN SQLCODE         = ZERO                                07060006
070700       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    07070006
070800         CONTINUE                                                 07080006
070900       WHEN OTHER                                                 07090006
071000         DISPLAY PV-ABEND-PARAGRAPH                               07100006
071100         PERFORM Z999-SQL-ERROR                                   07110006
071200     END-EVALUATE.                                                07120006
071300*                                                                 07130006
071400******************************************************************07140006
071500* THIS PARAGRAPH SETS THE DATE FOR THE CURSOR                    *07150006
071600******************************************************************07160006
071700 R100-SET-CURSOR-DATE.                                            07170006
071800                                                                  07180006
071900     ACCEPT DPG51-SYSTEM-DATE-N    FROM DATE.                     07190006
072000     MOVE DPG51-SYSTEM-DATE-YR     TO PV-YR.                      07200006
072100     MOVE DPG51-SYSTEM-DATE-MO     TO PV-MO.                      07210006
072200     MOVE DPG51-SYSTEM-DATE-DY     TO PV-DY.                      07220006
072300     IF DPG51-SYSTEM-DATE-YR > 80                                 07230006
072400         MOVE 19                   TO PV-CC                       07240006
072500     ELSE                                                         07250006
072600         MOVE 20                   TO PV-CC                       07260006
072700     END-IF.                                                      07270006
072800                                                                  07280006
072900     MOVE PV-DATE                  TO DPG52-LK-DATE-INPUT.        07290006
073000                                                                  07300006
073100     MOVE SPACES                TO DPG51-INCREMENT-DECREMENT-FLAG.07310006
073200     MOVE PV-F2                    TO DPG51-CALENDAR-TYPE.        07320006
073300     SET DPG52-LK-DTE-ISO          TO TRUE.                       07330006
073400                                                                  07340006
073500     PERFORM R200-CALENDAR-ROUTINE.                               07350006
073600     MOVE DPG56-FISCAL-YEAR-NBR    TO PV-END-YEAR.                07360006
073700     IF PV-END-YEAR > 80                                          07370006
073800         MOVE 19                   TO PV-END-CENTURY              07380006
073900     ELSE                                                         07390006
074000         MOVE 20                   TO PV-END-CENTURY              07400006
074100     END-IF.                                                      07410006
074200     MOVE DPG56-FISCAL-WEEK-NBR    TO PV-END-WEEK.                07420006
074300     DISPLAY 'FISCAL WEEK NUMBER: ' PV-END-WEEK-YEAR.             07430006
074400                                                                  07440006
074500     MOVE SPACES                   TO DPG52-LK-DATE-INPUT.        07450006
074600     MOVE PV-END-WEEK-YEAR         TO DPG52-LK-DATE-INPUT.        07460006
074700     SET DPG52-LK-DTE-FISC-WEEK-CC TO TRUE.                       07470006
074800     MOVE 15                     TO DPG51-INCR-DECR-FISCAL-WEEK-9.07480006
074900     SET DPG51-DECREMENT-DATE      TO TRUE.                       07490006
075000                                                                  07500006
075100     PERFORM R200-CALENDAR-ROUTINE.                               07510006
075200     MOVE DPG56-FISCAL-YEAR-NBR    TO PV-BEGIN-YEAR.              07520006
075300     IF PV-BEGIN-YEAR > 80                                        07530006
075400         MOVE 19                   TO PV-BEGIN-CENTURY            07540006
075500     ELSE                                                         07550006
075600         MOVE 20                   TO PV-BEGIN-CENTURY            07560006
075700     END-IF.                                                      07570006
075800     MOVE DPG56-FISCAL-WEEK-NBR    TO PV-BEGIN-WEEK.              07580006
075900     DISPLAY 'FISCAL WEEK NUMBER: ' PV-BEGIN-WEEK-YEAR.           07590006
076000                                                                  07600006
076100*                                                                 07610006
076200******************************************************************07620006
076300* CALLS THE DATE ROUTINE.                                         07630006
076400******************************************************************07640006
076500 R200-CALENDAR-ROUTINE.                                           07650006
076600*                                                                 07660006
076700     CALL PC-PGM-DPKUT500 USING DPG51 DPG52                       07670006
076800                                DPG53 DPG54                       07680006
076900                                DPG55 DPG56.                      07690006
077000     EVALUATE TRUE                                                07700006
077100     WHEN DPG54-SEVERE-ERROR                                      07710006
077200         DISPLAY 'SEVERE ERROR IN CALENDAR ROUTINE'               07720006
077300         DISPLAY DPG54-ERROR-MESSAGE                              07730006
077400         DISPLAY 'INPUT DATE: '  DPG52-LK-DATE-INPUT              07740006
077500         CALL 'ILBOABN0'        USING PV-ABEND-CODE               07750006
077600     WHEN DPG54-WARNING-ERROR                                     07760006
077700         DISPLAY 'WARNING ERROR IN CALENDAR ROUTINE'              07770006
077800         DISPLAY DPG54-ERROR-MESSAGE                              07780006
077900     WHEN DPG54-NO-ERROR                                          07790006
078000         CONTINUE                                                 07800006
078100     END-EVALUATE.                                                07810006
078200*                                                                 07820006
078300******************************************************************07830006
078400* THIS PARAGRAPH OPENS THE DEL CURSOR                             07840006
078500******************************************************************07850006
078600 S100-OPEN-DEL-CSR.                                               07860006
078700                                                                  07870006
078800     MOVE 'S100'                   TO PGM-LOCATION.               07880006
078900     MOVE 'S100-OPEN-DEL-CSR'      TO PV-ABEND-PARAGRAPH.         07890006
079000                                                                  07900006
079100     EXEC SQL                                                     07910006
079200         OPEN DEL_CSR                                             07920006
079300     END-EXEC.                                                    07930006
079400                                                                  07940006
079500     EVALUATE TRUE                                                07950006
079600       WHEN SQLCODE         = ZERO                                07960006
079700       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    07970006
079800         CONTINUE                                                 07980006
079900       WHEN OTHER                                                 07990006
080000         DISPLAY PV-ABEND-PARAGRAPH                               08000006
080100         PERFORM Z999-SQL-ERROR                                   08010006
080200     END-EVALUATE.                                                08020006
080300*                                                                 08030006
080400******************************************************************08040006
080500* THIS PARAGRAPH OPENS THE CHG CURSOR                             08050006
080600******************************************************************08060006
080700** SELECT FROM THE TMRITEM TABLE TO GATHER VALUES FOR OUTPUT    **08070006
080800******************************************************************08080006
080900 S100-SELECT-TMRITEM.                                             08090006
081000                                                                  08100006
081100     MOVE 'S100'                   TO PGM-LOCATION.               08110006
081200     MOVE 'S100-SELECT-TMRITEM  '  TO PV-ABEND-PARAGRAPH.         08120006
081300                                                                  08130006
081400     EXEC SQL                                                     08140006
081500          SELECT ITEM_NBR                                         08150006
081600                ,UCYCLE_CDE                                       08160006
081700                ,TSL_NBR                                          08170006
081800                ,BYPDDU_CDE                                       08180006
081900                ,BYPSCL_NBR                                       08190006
082000                ,FRCDDU_CDE                                       08200006
082100                ,BYPZSL_CDE                                       08210006
082200                ,BYPTFP_CDE                                       08220006
082300                ,BYPZOH_CDE                                       08230006
082400                ,BYPBEF_CDE                                       08240006
082500                ,BYPAFT_CDE                                       08250006
082600                ,LUMPSW_CDE                                       08260006
082700                ,MINBI_FCTR                                       08270006
082800                ,DDFTSW_CDE                                       08280006
082900                ,RT_NBR                                           08290006
083000                ,RTF_FCTR                                         08300006
083100                ,ZOPSW_CDE                                        08310006
083200                ,OUTLSW_CDE                                       08320006
083300                ,ZSSTOCK_CDE                                      08330006
083400                ,PACKSW_CDE                                       08340006
083500                ,DSER_CDE                                         08350006
083600                ,LT_QTY                                           08360006
083700                ,IMIN_QTY                                         08370006
083800                ,IMAX_QTY                                         08380006
083900                ,SSADJ_PCT                                        08390006
084000                ,RT_DAY_NBR                                       08400006
084100                ,DDUPRM_SW                                        08410006
084200                ,ORD_GROUP_SW                                     08420006
084300              INTO                                                08430006
084400                 :MRITEM-ITEM-NBR,                                08440006
084500                 :MRITEM-UCYCLE-CDE,                              08450006
084600                 :MRITEM-TSL-NBR,                                 08460006
084700                 :MRITEM-BYPDDU-CDE,                              08470006
084800                 :MRITEM-BYPSCL-NBR,                              08480006
084900                 :MRITEM-FRCDDU-CDE,                              08490006
085000                 :MRITEM-BYPZSL-CDE,                              08500006
085100                 :MRITEM-BYPTFP-CDE,                              08510006
085200                 :MRITEM-BYPZOH-CDE,                              08520006
085300                 :MRITEM-BYPBEF-CDE,                              08530006
085400                 :MRITEM-BYPAFT-CDE,                              08540006
085500                 :MRITEM-LUMPSW-CDE,                              08550006
085600                 :MRITEM-MINBI-FCTR,                              08560006
085700                 :MRITEM-DDFTSW-CDE,                              08570006
085800                 :MRITEM-RT-NBR,                                  08580006
085900                 :MRITEM-RTF-FCTR,                                08590006
086000                 :MRITEM-ZOPSW-CDE,                               08600006
086100                 :MRITEM-OUTLSW-CDE,                              08610006
086200                 :MRITEM-ZSSTOCK-CDE,                             08620006
086300                 :MRITEM-PACKSW-CDE,                              08630006
086400                 :MRITEM-DSER-CDE,                                08640006
086500                 :MRITEM-LT-QTY,                                  08650006
086600                 :MRITEM-IMIN-QTY,                                08660006
086700                 :MRITEM-IMAX-QTY,                                08670006
086800                 :MRITEM-SSADJ-PCT,                               08680006
086900                 :MRITEM-RT-DAY-NBR,                              08690006
087000                 :MRITEM-DDUPRM-SW,                               08700006
087100                 :MRITEM-ORD-GROUP-SW                             08710006
087200           FROM TMRITEM                                           08720006
087300          WHERE ITEM_NBR = :PV-DELETE-ITEM                        08730006
087400     END-EXEC.                                                    08740006
087500                                                                  08750006
087600     EVALUATE TRUE                                                08760006
087700       WHEN SQLCODE         = ZERO                                08770006
087800       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    08780006
087900         CONTINUE                                                 08790006
088000       WHEN OTHER                                                 08800006
088100         DISPLAY PV-ABEND-PARAGRAPH                               08810006
088200         PERFORM Z999-SQL-ERROR                                   08820006
088300     END-EVALUATE.                                                08830006
088400*                                                                 08840006
088500******************************************************************08850006
088600** FETCH FROM THE TMRITST TABLE TO GATHER VALUES FOR OUTPUT     **08860006
088700******************************************************************08870006
088800 S200-FETCH-TMRITST.                                              08880006
088900                                                                  08890006
089000     MOVE 'S200'                   TO PGM-LOCATION.               08900006
089100     MOVE 'S200-SELECT-TMRITST  '  TO PV-ABEND-PARAGRAPH.         08910006
089200                                                                  08920006
089300     EXEC SQL                                                     08930006
089400          FETCH TMRITST                                           08940006
089500           INTO                                                   08950006
089600                :MRITST-ITEM-NBR,                                 08960006
089700                :MRITST-STR-NBR,                                  08970006
089800                :MRITST-COMSTK-QTY,                               08980006
089900                :MRITST-SPOQSW-CDE,                               08990006
090000                :MRITST-SPOQ-QTY,                                 09000006
090100                :MRITST-FT-CDE,                                   09010006
090200                :MRITST-OSTRAT-QTY,                               09020006
090300                :MRITST-CSTOCK-QTY,                               09030006
090400                :MRITST-MINOUTL-QTY,                              09040006
090500                :MRITST-MAXOUTL-QTY,                              09050006
090600                :MRITST-FOQ-QTY,                                  09060006
090700                :MRITST-TMIN-QTY,                                 09070006
090800                :MRITST-USERMIN-QTY,                              09080006
090900                :MRITST-USERMAX-QTY,                              09090006
091000                :MRITST-DD-FCTR,                                  09100006
091100                :MRITST-DDI-FCTR,                                 09110006
091200                :MRITST-LPP-QTY,                                  09120006
091300                :MRITST-MADSS-QTY,                                09130006
091400                :MRITST-FWMAD-QTY,                                09140006
091500                :MRITST-TRNDP-PCT,                                09150006
091600                :MRITST-MSDTS-QTY,                                09160006
091700                :MRITST-MADTS-QTY,                                09170006
091800                :MRITST-LTVFACT-FCTR,                             09180006
091900                :MRITST-PCTZ-PCT,                                 09190006
092000                :MRITST-MADSTAT-CDE,                              09200006
092100                :MRITST-DFLREG-CDE,                               09210006
092200                :MRITST-TSREG-CDE,                                09220006
092300                :MRITST-DIREG-CDE,                                09230006
092400                :MRITST-BYPREG-CDE,                               09240006
092500                :MRITST-LDD-FCTR,                                 09250006
092600                :MRITST-LDDI-FCTR,                                09260006
092700                :MRITST-LMADSS-QTY,                               09270006
092800                :MRITST-LFWMAD-QTY,                               09280006
092900                :MRITST-LCPS-QTY,                                 09290006
093000                :MRITST-OUTSTAT-CDE,                              09300006
093100                :MRITST-LRTFCST-NBR,                              09310006
093200                :MRITST-ORDSTAT-CDE,                              09320006
093300                :MRITST-PTAG-ID,                                  09330006
093400                :MRITST-MINDD-QTY,                                09340006
093500                :MRITST-ON-ORDER-QTY,                             09350006
093600                :MRITST-MAXOQP-PCT,                               09360006
093700                :MRITST-OUTL-QTY,                                 09370006
093800                :MRITST-OP-QTY,                                   09380006
093900                :MRITST-FTJOPF-CDE,                               09390006
094000                :MRITST-CSTKMINT1-PCT,                            09400006
094100                :MRITST-CSTKMINT2-PCT,                            09410006
094200                :MRITST-CSTKMINT3-PCT,                            09420006
094300                :MRITST-CSTKMINT4-PCT,                            09430006
094400                :MRITST-CSTKMINT5-PCT,                            09440006
094500                :MRITST-CSTKMINT6-PCT,                            09450006
094600                :MRITST-CSTKMAXT1-PCT,                            09460006
094700                :MRITST-CSTKMAXT2-PCT,                            09470006
094800                :MRITST-CSTKMAXT3-PCT,                            09480006
094900                :MRITST-CSTKMAXT4-PCT,                            09490006
095000                :MRITST-CSTKMAXT5-PCT,                            09500006
095100                :MRITST-CSTKMAXT6-PCT,                            09510006
095200                :MRITST-SSTOCK-QTY                                09520006
095300     END-EXEC.                                                    09530006
095400                                                                  09540006
095500     EVALUATE TRUE                                                09550006
095600       WHEN SQLCODE         = ZERO                                09560006
095700         CONTINUE                                                 09570006
095800       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    09580006
095900         SET EOF-ITST-CSR TO TRUE                                 09590006
096000         CONTINUE                                                 09600006
096100       WHEN OTHER                                                 09610006
096200         DISPLAY PV-ABEND-PARAGRAPH                               09620006
096300         PERFORM Z999-SQL-ERROR                                   09630006
096400     END-EVALUATE.                                                09640006
096500*                                                                 09650006
096600******************************************************************09660006
096700** FETCH FROM THE TMRISFE TABLE TO GATHER VALUES FOR OUTPUT     **09670006
096800******************************************************************09680006
096900 S300-FETCH-TMRISFE.                                              09690006
097000                                                                  09700006
097100     MOVE 'S300'                   TO PGM-LOCATION.               09710006
097200     MOVE 'S300-SELECT-TMRISFE  '  TO PV-ABEND-PARAGRAPH.         09720006
097300                                                                  09730006
097400     EXEC SQL                                                     09740006
097500          FETCH TMRISFE                                           09750006
097600           INTO                                                   09760006
097700            :MRISFE-ITEM-NBR,                                     09770006
097800            :MRISFE-STR-NBR,                                      09780006
097900            :MRISFE-SEQ-NBR,                                      09790006
098000            :MRISFE-LFWM-QTY,                                     09800006
098100            :MRISFE-FWM-QTY                                       09810006
098200     END-EXEC.                                                    09820006
098300                                                                  09830006
098400     EVALUATE TRUE                                                09840006
098500       WHEN SQLCODE         = ZERO                                09850006
098600         CONTINUE                                                 09860006
098700       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    09870006
098800         SET EOF-ISFE-CSR TO TRUE                                 09880006
098900         CONTINUE                                                 09890006
099000       WHEN OTHER                                                 09900006
099100         DISPLAY PV-ABEND-PARAGRAPH                               09910006
099200         PERFORM Z999-SQL-ERROR                                   09920006
099300     END-EVALUATE.                                                09930006
099400*                                                                 09940006
099500******************************************************************09950006
099600** FETCH FROM THE TMRISHS TABLE TO GATHER VALUES FOR OUTPUT     **09960006
099700******************************************************************09970006
099800 S400-FETCH-TMRISHS.                                              09980006
099900                                                                  09990006
100000     MOVE 'S400'                   TO PGM-LOCATION.               10000006
100100     MOVE 'S400-SELECT-TMRISHS  '  TO PV-ABEND-PARAGRAPH.         10010006
100200                                                                  10020006
100300     EXEC SQL                                                     10030006
100400          FETCH TMRISHS                                           10040006
100500           INTO                                                   10050006
100600            :MRISHS-ITM-NBR,                                      10060006
100700            :MRISHS-STR-NBR,                                      10070006
100800            :MRISHS-YR-NBR,                                       10080006
100900            :MRISHS-WK-NBR,                                       10090006
101000            :MRISHS-ITM-REV-ID,                                   10100006
101100            :MRISHS-SLS-HIST-QTY,                                 10110006
101200            :MRISHS-OH-HIST-QTY,                                  10120006
101300            :MRISHS-MAD-HIST-QTY,                                 10130006
101400            :MRISHS-DSD-HIST-QTY                                  10140006
101500     END-EXEC.                                                    10150006
101600                                                                  10160006
101700     EVALUATE TRUE                                                10170006
101800       WHEN SQLCODE         = ZERO                                10180006
101900         CONTINUE                                                 10190006
102000       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    10200006
102100         SET EOF-ISHS-CSR TO TRUE                                 10210006
102200         CONTINUE                                                 10220006
102300       WHEN OTHER                                                 10230006
102400         DISPLAY PV-ABEND-PARAGRAPH                               10240006
102500         PERFORM Z999-SQL-ERROR                                   10250006
102600     END-EVALUATE.                                                10260006
102700*                                                                 10270006
102800******************************************************************10280006
102900******************************************************************10290006
103000 S500-FETCH-TMRISHS-DEL-CURSOR.                                   10300006
103100*                                                                 10310006
103200     MOVE 'S500'                   TO PGM-LOCATION.               10320006
103300     MOVE 'S500-FETCH-TMRISHS-DEL-CURSOR' TO PV-ABEND-PARAGRAPH.  10330006
103400                                                                  10340006
103500     EXEC SQL                                                     10350006
103600         FETCH TMRISHS_DEL_CSR                                    10360006
103700         INTO  :MRISHS-ITM-NBR,                                   10370006
103800               :MRISHS-STR-NBR,                                   10380006
103900               :MRISHS-YR-NBR,                                    10390006
104000               :MRISHS-WK-NBR,                                    10400006
104100               :MRISHS-ITM-REV-ID,                                10410006
104200               :MRISHS-SLS-HIST-QTY,                              10420006
104300               :MRISHS-OH-HIST-QTY,                               10430006
104400               :MRISHS-MAD-HIST-QTY,                              10440006
104500               :MRISHS-DSD-HIST-QTY                               10450006
104600     END-EXEC.                                                    10460006
104700                                                                  10470006
104800     EVALUATE TRUE                                                10480006
104900       WHEN SQLCODE         = ZERO                                10490006
105000         PERFORM W005-WRITE-OUTPUT-DEL-TMRISHS                    10500006
105100         PERFORM D003-DELETE-TMRISHS                              10510006
105200         ADD PC-PLUS-1 TO PV-DELETE-HIST-CNT                      10520006
105300         PERFORM Z900-COMMIT-TEST                                 10530006
105400       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    10540006
105500         SET EOF-TMRISHS-CSR TO TRUE                              10550006
105600       WHEN OTHER                                                 10560006
105700         DISPLAY PV-ABEND-PARAGRAPH                               10570006
105800         PERFORM Z999-SQL-ERROR                                   10580006
105900     END-EVALUATE.                                                10590006
106000*                                                                 10600006
106100******************************************************************10610006
106200* THIS PARAGRAPH FETCHES THE ITEM CURSOR FOR DELETE RECORDS      *10620006
106300******************************************************************10630006
106400 T300-FETCH-DEL-ITEM-CURSOR.                                      10640006
106500                                                                  10650006
106600     MOVE 'T300'                   TO PGM-LOCATION.               10660006
106700     MOVE 'T300-FETCH-DEL-ITEM-CURSOR'                            10670006
106800                                   TO PV-ABEND-PARAGRAPH.         10680006
106900                                                                  10690006
107000     EXEC SQL                                                     10700006
107100       FETCH DEL_CSR                                              10710006
107200        INTO                                                      10720006
107300             :PV-DELETE-ITEM                                      10730006
107400     END-EXEC.                                                    10740006
107500                                                                  10750006
107600     EVALUATE TRUE                                                10760006
107700       WHEN SQLCODE         = ZERO                                10770006
107800         CONTINUE                                                 10780006
107900       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    10790006
108000         PERFORM U000-CLOSE-DEL-ITEM-CSR                          10800006
108100         SET EOC-ITEM-CSR TO TRUE                                 10810006
108200         CONTINUE                                                 10820006
108300       WHEN OTHER                                                 10830006
108400         DISPLAY PV-ABEND-PARAGRAPH                               10840006
108500         PERFORM Z999-SQL-ERROR                                   10850006
108600     END-EVALUATE.                                                10860006
108700*                                                                 10870006
108800     IF NOT EOC-ITEM-CSR                                          10880006
108900                                                                  10890006
109000         ADD PC-PLUS-1 TO PV-DELETE-CNT                           10900006
109100                                                                  10910006
109200         DISPLAY 'DELETED ITEM NUMBER: ' PV-DELETE-ITEM           10920006
109300                                                                  10930006
109400         PERFORM S100-SELECT-TMRITEM                              10940006
109500                                                                  10950006
109600         PERFORM W001-WRITE-OUTPUT-TMRITEM                        10960006
109700                                                                  10970006
109800         PERFORM D001-DEL-SKUS-TMRITEM                            10980006
109900                                                                  10990006
110000         PERFORM O200-OPEN-TMRITST                                11000006
110100         MOVE SPACES TO PS-EOF-ITST-CSR                           11010006
110200         PERFORM S200-FETCH-TMRITST                               11020006
110300                                                                  11030006
110400         PERFORM UNTIL EOF-ITST-CSR                               11040006
110500              PERFORM W002-WRITE-OUTPUT-TMRITST                   11050006
110600              PERFORM S200-FETCH-TMRITST                          11060006
110700         END-PERFORM                                              11070006
110800                                                                  11080006
110900         PERFORM C200-CLOSE-TMRITST                               11090006
111000                                                                  11100006
111100         PERFORM O300-OPEN-TMRISFE                                11110006
111200         MOVE SPACES TO PS-EOF-ISFE-CSR                           11120006
111300         PERFORM S300-FETCH-TMRISFE                               11130006
111400                                                                  11140006
111500         PERFORM UNTIL EOF-ISFE-CSR                               11150006
111600              PERFORM W003-WRITE-OUTPUT-TMRISFE                   11160006
111700              PERFORM S300-FETCH-TMRISFE                          11170006
111800         END-PERFORM                                              11180006
111900                                                                  11190006
112000         PERFORM C300-CLOSE-TMRISFE                               11200006
112100                                                                  11210006
112200         PERFORM O400-OPEN-TMRISHS                                11220006
112300         MOVE SPACES TO PS-EOF-ISHS-CSR                           11230006
112400         PERFORM S400-FETCH-TMRISHS                               11240006
112500                                                                  11250006
112600         PERFORM UNTIL EOF-ISHS-CSR                               11260006
112700              PERFORM W004-WRITE-OUTPUT-TMRISHS                   11270006
112800              PERFORM S400-FETCH-TMRISHS                          11280006
112900         END-PERFORM                                              11290006
113000                                                                  11300006
113100         PERFORM C400-CLOSE-TMRISHS                               11310006
113200                                                                  11320006
113300         PERFORM D002-DEL-SKUS-TMRITST                            11330006
113400                                                                  11340006
113500         PERFORM Z900-COMMIT-TEST                                 11350006
113600     ELSE                                                         11360006
113700         DISPLAY 'QUANTITY OF ITEMS DELETED: ' PV-DELETE-CNT      11370006
113800     END-IF.                                                      11380006
113900*                                                                 11390006
114000******************************************************************11400006
114100*  CLOSE DELETE CURSOR                                           *11410006
114200******************************************************************11420006
114300 U000-CLOSE-DEL-ITEM-CSR.                                         11430006
114400                                                                  11440006
114500     MOVE 'U000'                   TO PGM-LOCATION.               11450006
114600     MOVE 'U000-CLOSE-DEL-ITEM-CSR'                               11460006
114700                                   TO PV-ABEND-PARAGRAPH.         11470006
114800     EXEC SQL                                                     11480006
114900         CLOSE DEL_CSR                                            11490006
115000     END-EXEC.                                                    11500006
115100                                                                  11510006
115200     EVALUATE TRUE                                                11520006
115300       WHEN SQLCODE         = ZERO                                11530006
115400       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    11540006
115500         CONTINUE                                                 11550006
115600       WHEN OTHER                                                 11560006
115700         DISPLAY PV-ABEND-PARAGRAPH                               11570006
115800         PERFORM Z999-SQL-ERROR                                   11580006
115900     END-EVALUATE.                                                11590006
116000*                                                                 11600006
116100******************************************************************11610006
116200** WRITE OUTPUT RECOVERY FILE WITH MRITEM TABLE DATA.           **11620006
116300******************************************************************11630006
116400 W001-WRITE-OUTPUT-TMRITEM.                                       11640006
116500                                                                  11650006
116600     MOVE 'W001'                     TO PGM-LOCATION.             11660006
116700     MOVE 'W001-WRITE-OUTPUT-TMRITEM'  TO PV-ABEND-PARAGRAPH.     11670006
116800                                                                  11680006
116900     INITIALIZE MR166-MRITEM-REC.                                 11690006
117000     MOVE PC-1                       TO MR166-MRITEM-KEY-NBR.     11700006
117100                                                                  11710006
117200     MOVE MRITEM-ITEM-NBR            TO MR166-MRITEM-ITEM-NBR     11720006
117300     MOVE MRITEM-UCYCLE-CDE          TO MR166-MRITEM-UCYCLE-CDE   11730006
117400     MOVE MRITEM-TSL-NBR             TO MR166-MRITEM-TSL-NBR      11740006
117500     MOVE MRITEM-BYPDDU-CDE          TO MR166-MRITEM-BYPDDU-CDE   11750006
117600     MOVE MRITEM-BYPSCL-NBR          TO MR166-MRITEM-BYPSCL-NBR   11760006
117700     MOVE MRITEM-FRCDDU-CDE          TO MR166-MRITEM-FRCDDU-CDE   11770006
117800     MOVE MRITEM-BYPZSL-CDE          TO MR166-MRITEM-BYPZSL-CDE   11780006
117900     MOVE MRITEM-BYPTFP-CDE          TO MR166-MRITEM-BYPTFP-CDE   11790006
118000     MOVE MRITEM-BYPZOH-CDE          TO MR166-MRITEM-BYPZOH-CDE   11800006
118100     MOVE MRITEM-BYPBEF-CDE          TO MR166-MRITEM-BYPBEF-CDE   11810006
118200     MOVE MRITEM-BYPAFT-CDE          TO MR166-MRITEM-BYPAFT-CDE   11820006
118300     MOVE MRITEM-LUMPSW-CDE          TO MR166-MRITEM-LUMPSW-CDE   11830006
118400     MOVE MRITEM-MINBI-FCTR          TO MR166-MRITEM-MINBI-FCTR   11840006
118500     MOVE MRITEM-DDFTSW-CDE          TO MR166-MRITEM-DDFTSW-CDE   11850006
118600     MOVE MRITEM-RT-NBR              TO MR166-MRITEM-RT-NBR       11860006
118700     MOVE MRITEM-RTF-FCTR            TO MR166-MRITEM-RTF-FCTR     11870006
118800     MOVE MRITEM-ZOPSW-CDE           TO MR166-MRITEM-ZOPSW-CDE    11880006
118900     MOVE MRITEM-OUTLSW-CDE          TO MR166-MRITEM-OUTLSW-CDE   11890006
119000     MOVE MRITEM-ZSSTOCK-CDE         TO MR166-MRITEM-ZSSTOCK-CDE  11900006
119100     MOVE MRITEM-PACKSW-CDE          TO MR166-MRITEM-PACKSW-CDE   11910006
119200     MOVE MRITEM-DSER-CDE            TO MR166-MRITEM-DSER-CDE     11920006
119300     MOVE MRITEM-LT-QTY              TO MR166-MRITEM-LT-QTY       11930006
119400     MOVE MRITEM-IMIN-QTY            TO MR166-MRITEM-IMIN-QTY     11940006
119500     MOVE MRITEM-IMAX-QTY            TO MR166-MRITEM-IMAX-QTY     11950006
119600     MOVE MRITEM-SSADJ-PCT           TO MR166-MRITEM-SSADJ-PCT    11960006
119700     MOVE MRITEM-RT-DAY-NBR          TO MR166-MRITEM-RT-DAY-NBR   11970006
119800     MOVE MRITEM-DDUPRM-SW           TO MR166-MRITEM-DDUPRM-SW    11980006
119900     MOVE MRITEM-ORD-GROUP-SW        TO MR166-MRITEM-ORD-GROUP-SW.11990006
120000                                                                  12000006
120100     WRITE OUTPUT-REC FROM MR166-MRITEM-REC.                      12010006
120200*                                                                 12020006
120300******************************************************************12030006
120400** WRITE OUTPUT RECOVERY FILE WITH MRITST TABLE DATA.           **12040006
120500******************************************************************12050006
120600 W002-WRITE-OUTPUT-TMRITST.                                       12060006
120700                                                                  12070006
120800     MOVE 'W002'                     TO PGM-LOCATION.             12080006
120900     MOVE 'W002-WRITE-OUTPUT-TMRITST'  TO PV-ABEND-PARAGRAPH.     12090006
121000                                                                  12100006
121100     INITIALIZE MR166-MRITEM-REC.                                 12110006
121200     MOVE PC-2                       TO MR166-MRITST-KEY-NBR.     12120006
121300                                                                  12130006
121400     MOVE MRITST-ITEM-NBR            TO MR166-MRITST-ITEM-NBR     12140006
121500     MOVE MRITST-STR-NBR             TO MR166-MRITST-STR-NBR      12150006
121600     MOVE MRITST-COMSTK-QTY          TO MR166-MRITST-COMSTK-QTY   12160006
121700     MOVE MRITST-SPOQSW-CDE          TO MR166-MRITST-SPOQSW-CDE   12170006
121800     MOVE MRITST-SPOQ-QTY            TO MR166-MRITST-SPOQ-QTY     12180006
121900     MOVE MRITST-FT-CDE              TO MR166-MRITST-FT-CDE       12190006
122000     MOVE MRITST-OSTRAT-QTY          TO MR166-MRITST-OSTRAT-QTY   12200006
122100     MOVE MRITST-CSTOCK-QTY          TO MR166-MRITST-CSTOCK-QTY   12210006
122200     MOVE MRITST-MINOUTL-QTY         TO MR166-MRITST-MINOUTL-QTY  12220006
122300     MOVE MRITST-MAXOUTL-QTY         TO MR166-MRITST-MAXOUTL-QTY  12230006
122400     MOVE MRITST-FOQ-QTY             TO MR166-MRITST-FOQ-QTY      12240006
122500     MOVE MRITST-TMIN-QTY            TO MR166-MRITST-TMIN-QTY     12250006
122600     MOVE MRITST-USERMIN-QTY         TO MR166-MRITST-USERMIN-QTY  12260006
122700     MOVE MRITST-USERMAX-QTY         TO MR166-MRITST-USERMAX-QTY  12270006
122800     MOVE MRITST-DD-FCTR             TO MR166-MRITST-DD-FCTR      12280006
122900     MOVE MRITST-DDI-FCTR            TO MR166-MRITST-DDI-FCTR     12290006
123000     MOVE MRITST-LPP-QTY             TO MR166-MRITST-LPP-QTY      12300006
123100     MOVE MRITST-MADSS-QTY           TO MR166-MRITST-MADSS-QTY    12310006
123200     MOVE MRITST-FWMAD-QTY           TO MR166-MRITST-FWMAD-QTY    12320006
123300     MOVE MRITST-TRNDP-PCT           TO MR166-MRITST-TRNDP-PCT    12330006
123400     MOVE MRITST-MSDTS-QTY           TO MR166-MRITST-MSDTS-QTY    12340006
123500     MOVE MRITST-MADTS-QTY           TO MR166-MRITST-MADTS-QTY    12350006
123600     MOVE MRITST-LTVFACT-FCTR        TO MR166-MRITST-LTVFACT-FCTR 12360006
123700     MOVE MRITST-PCTZ-PCT            TO MR166-MRITST-PCTZ-PCT     12370006
123800     MOVE MRITST-MADSTAT-CDE         TO MR166-MRITST-MADSTAT-CDE  12380006
123900     MOVE MRITST-DFLREG-CDE          TO MR166-MRITST-DFLREG-CDE   12390006
124000     MOVE MRITST-TSREG-CDE           TO MR166-MRITST-TSREG-CDE    12400006
124100     MOVE MRITST-DIREG-CDE           TO MR166-MRITST-DIREG-CDE    12410006
124200     MOVE MRITST-BYPREG-CDE          TO MR166-MRITST-BYPREG-CDE   12420006
124300     MOVE MRITST-LDD-FCTR            TO MR166-MRITST-LDD-FCTR     12430006
124400     MOVE MRITST-LDDI-FCTR           TO MR166-MRITST-LDDI-FCTR    12440006
124500     MOVE MRITST-LMADSS-QTY          TO MR166-MRITST-LMADSS-QTY   12450006
124600     MOVE MRITST-LFWMAD-QTY          TO MR166-MRITST-LFWMAD-QTY   12460006
124700     MOVE MRITST-LCPS-QTY            TO MR166-MRITST-LCPS-QTY     12470006
124800     MOVE MRITST-OUTSTAT-CDE         TO MR166-MRITST-OUTSTAT-CDE  12480006
124900     MOVE MRITST-LRTFCST-NBR         TO MR166-MRITST-LRTFCST-NBR  12490006
125000     MOVE MRITST-ORDSTAT-CDE         TO MR166-MRITST-ORDSTAT-CDE  12500006
125100     MOVE MRITST-PTAG-ID             TO MR166-MRITST-PTAG-ID      12510006
125200     MOVE MRITST-MINDD-QTY           TO MR166-MRITST-MINDD-QTY    12520006
125300     MOVE MRITST-ON-ORDER-QTY        TO MR166-MRITST-ON-ORDER-QTY 12530006
125400     MOVE MRITST-MAXOQP-PCT          TO MR166-MRITST-MAXOQP-PCT   12540006
125500     MOVE MRITST-OUTL-QTY            TO MR166-MRITST-OUTL-QTY     12550006
125600     MOVE MRITST-OP-QTY              TO MR166-MRITST-OP-QTY       12560006
125700     MOVE MRITST-FTJOPF-CDE          TO MR166-MRITST-FTJOPF-CDE   12570006
125800     MOVE MRITST-CSTKMINT1-PCT       TO MR166-MRITST-CSTKMINT1-PCT12580006
125900     MOVE MRITST-CSTKMINT2-PCT       TO MR166-MRITST-CSTKMINT2-PCT12590006
126000     MOVE MRITST-CSTKMINT3-PCT       TO MR166-MRITST-CSTKMINT3-PCT12600006
126100     MOVE MRITST-CSTKMINT4-PCT       TO MR166-MRITST-CSTKMINT4-PCT12610006
126200     MOVE MRITST-CSTKMINT5-PCT       TO MR166-MRITST-CSTKMINT5-PCT12620006
126300     MOVE MRITST-CSTKMINT6-PCT       TO MR166-MRITST-CSTKMINT6-PCT12630006
126400     MOVE MRITST-CSTKMAXT1-PCT       TO MR166-MRITST-CSTKMAXT1-PCT12640006
126500     MOVE MRITST-CSTKMAXT2-PCT       TO MR166-MRITST-CSTKMAXT2-PCT12650006
126600     MOVE MRITST-CSTKMAXT3-PCT       TO MR166-MRITST-CSTKMAXT3-PCT12660006
126700     MOVE MRITST-CSTKMAXT4-PCT       TO MR166-MRITST-CSTKMAXT4-PCT12670006
126800     MOVE MRITST-CSTKMAXT5-PCT       TO MR166-MRITST-CSTKMAXT5-PCT12680006
126900     MOVE MRITST-CSTKMAXT6-PCT       TO MR166-MRITST-CSTKMAXT6-PCT12690006
127000     MOVE MRITST-SSTOCK-QTY          TO MR166-MRITST-SSTOCK-QTY   12700006
127100                                                                  12710006
127200     WRITE OUTPUT-REC FROM MR166-MRITST-REC.                      12720006
127300*                                                                 12730006
127400******************************************************************12740006
127500** WRITE OUTPUT RECOVERY FILE WITH MRISFE TABLE DATA.           **12750006
127600******************************************************************12760006
127700 W003-WRITE-OUTPUT-TMRISFE.                                       12770006
127800                                                                  12780006
127900     MOVE 'W003'                   TO PGM-LOCATION.               12790006
128000     MOVE 'W003-WRITE-OUTPUT-TMRISFE'  TO PV-ABEND-PARAGRAPH.     12800006
128100                                                                  12810006
128200     INITIALIZE MR166-MRITEM-REC.                                 12820006
128300     MOVE PC-3                  TO MR166-MRISFE-KEY-NBR.          12830006
128400                                                                  12840006
128500     MOVE MRISFE-ITEM-NBR       TO MR166-MRISFE-ITEM-NBR          12850006
128600     MOVE MRISFE-STR-NBR        TO MR166-MRISFE-STR-NBR           12860006
128700     MOVE MRISFE-SEQ-NBR        TO MR166-MRISFE-SEQ-NBR           12870006
128800     MOVE MRISFE-LFWM-QTY       TO MR166-MRISFE-LFWM-QTY          12880006
128900     MOVE MRISFE-FWM-QTY        TO MR166-MRISFE-FWM-QTY           12890006
129000                                                                  12900006
129100     WRITE OUTPUT-REC FROM MR166-MRISFE-REC.                      12910006
129200*                                                                 12920006
129300******************************************************************12930006
129400** WRITE OUTPUT RECOVERY FILE WITH MRISHS TABLE DATA.           **12940006
129500******************************************************************12950006
129600 W004-WRITE-OUTPUT-TMRISHS.                                       12960006
129700                                                                  12970006
129800     MOVE 'W004'                   TO PGM-LOCATION.               12980006
129900     MOVE 'W004-WRITE-OUTPUT-TMRISHS'  TO PV-ABEND-PARAGRAPH.     12990006
130000                                                                  13000006
130100     INITIALIZE MR166-MRITEM-REC.                                 13010006
130200     MOVE PC-4                  TO MR166-MRISHS-KEY-NBR.          13020006
130300                                                                  13030006
130400     MOVE MRISHS-ITM-NBR        TO MR166-MRISHS-ITM-NBR.          13040006
130500     MOVE MRISHS-STR-NBR        TO MR166-MRISHS-STR-NBR.          13050006
130600     MOVE MRISHS-YR-NBR         TO MR166-MRISHS-YR-NBR.           13060006
130700     MOVE MRISHS-WK-NBR         TO MR166-MRISHS-WK-NBR.           13070006
130800     MOVE MRISHS-ITM-REV-ID     TO MR166-MRISHS-ITM-REV-ID.       13080006
130900     MOVE MRISHS-SLS-HIST-QTY   TO MR166-MRISHS-SLS-HIST-QTY.     13090006
131000     MOVE MRISHS-OH-HIST-QTY    TO MR166-MRISHS-OH-HIST-QTY.      13100006
131100     MOVE MRISHS-MAD-HIST-QTY   TO MR166-MRISHS-MAD-HIST-QTY.     13110006
131200     MOVE MRISHS-DSD-HIST-QTY   TO MR166-MRISHS-DSD-HIST-QTY.     13120006
131300                                                                  13130006
131400     WRITE OUTPUT-REC FROM MR166-MRISHS-REC.                      13140006
131500*                                                                 13150006
131600******************************************************************13160006
131700** WRITE OUTPUT RECOVERY FILE WITH MRISHS TABLE DATA.           **13170006
131800******************************************************************13180006
131900 W005-WRITE-OUTPUT-DEL-TMRISHS.                                   13190006
132000                                                                  13200006
132100     MOVE 'W005'                   TO PGM-LOCATION.               13210006
132200     MOVE 'W005-WRITE-DEL-OUTPUT-TMRISHS'  TO PV-ABEND-PARAGRAPH. 13220006
132300                                                                  13230006
132400     INITIALIZE MR166-MRITEM-REC.                                 13240006
132500     MOVE PC-5                  TO MR166-MRISHS-KEY-NBR.          13250006
132600                                                                  13260006
132700     MOVE MRISHS-ITM-NBR        TO MR166-MRISHS-ITM-NBR.          13270006
132800     MOVE MRISHS-STR-NBR        TO MR166-MRISHS-STR-NBR.          13280006
132900     MOVE MRISHS-YR-NBR         TO MR166-MRISHS-YR-NBR.           13290006
133000     MOVE MRISHS-WK-NBR         TO MR166-MRISHS-WK-NBR.           13300006
133100     MOVE MRISHS-ITM-REV-ID     TO MR166-MRISHS-ITM-REV-ID.       13310006
133200     MOVE MRISHS-SLS-HIST-QTY   TO MR166-MRISHS-SLS-HIST-QTY.     13320006
133300     MOVE MRISHS-OH-HIST-QTY    TO MR166-MRISHS-OH-HIST-QTY.      13330006
133400     MOVE MRISHS-MAD-HIST-QTY   TO MR166-MRISHS-MAD-HIST-QTY.     13340006
133500     MOVE MRISHS-DSD-HIST-QTY   TO MR166-MRISHS-DSD-HIST-QTY.     13350006
133600                                                                  13360006
133700     WRITE OUTPUT2-REC FROM MR166-MRISHS-REC.                     13370006
133800*                                                                 13380006
133900 EJECT                                                            13390006
134000******************************************************************13400006
134100*     DB2 COMMIT TEST                                            *13410006
134200*                                                                *13420006
134300******************************************************************13430006
134400                                                                  13440006
134500 Z900-COMMIT-TEST.                                                13450006
134600*-----------------                                                13460006
134700                                                                  13470006
134800     MOVE 'Z900'                   TO PGM-LOCATION.               13480006
134900     MOVE 'Z900-COMMIT-TEST     '  TO PV-ABEND-PARAGRAPH.         13490006
135000                                                                  13500006
135100*  GET THE CURRENT TIMESTAMP                                      13510006
135200                                                                  13520006
135300     EXEC SQL                                                     13530006
135400         SET :PV-CURR-TMST = CURRENT TIMESTAMP                    13540006
135500     END-EXEC.                                                    13550006
135600                                                                  13560006
135700     IF SQLCODE = +0                                              13570006
135800         CONTINUE                                                 13580006
135900     ELSE                                                         13590006
136000         DISPLAY 'PARAGRAPH Z900  BAD SET FOR CURRENT TIMESTAMP'  13600006
136100         DISPLAY ' '                                              13610006
136200         PERFORM Z999-SQL-ERROR.                                  13620006
136300                                                                  13630006
136400*  COMPARE TO THE NEXT SCHEDULED COMMIT TIME                      13640006
136500                                                                  13650006
136600     IF PV-CURR-TMST > PV-COMMIT-TMST                             13660006
136700         PERFORM Z910-COMMIT.                                     13670006
136800                                                                  13680006
136900 EJECT                                                            13690006
137000******************************************************************13700006
137100*     DB2 COMMIT PROCESSING                                      *13710006
137200*                                                                *13720006
137300******************************************************************13730006
137400                                                                  13740006
137500 Z910-COMMIT.                                                     13750006
137600*------------                                                     13760006
137700                                                                  13770006
137800*  TAKE COMMIT                                                    13780006
137900                                                                  13790006
138000     EXEC SQL                                                     13800006
138100         COMMIT                                                   13810008
138200     END-EXEC.                                                    13820006
138300                                                                  13830006
138400     IF SQLCODE = +0                                              13840006
138500         CONTINUE                                                 13850006
138600     ELSE                                                         13860006
138700         DISPLAY 'PARAGRAPH Z910  BAD COMMIT'                     13870006
138800         DISPLAY ' '                                              13880006
138900         PERFORM Z999-SQL-ERROR.                                  13890006
139000                                                                  13900006
139100*  GET THE NEXT SCHEDULED COMMIT TIME                             13910006
139200                                                                  13920006
139300     EXEC SQL                                                     13930006
139400         SELECT  (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)    13940006
139500           INTO  :PV-COMMIT-TMST                                  13950006
139600           FROM  TCKRSTCNTL                                       13960006
139700          WHERE  PLAN_NAME = 'MRKUP059'                           13970006
139800     END-EXEC.                                                    13980006
139900                                                                  13990006
140000     IF SQLCODE = +0                                              14000006
140100         CONTINUE                                                 14010006
140200     ELSE                                                         14020006
140300         DISPLAY 'PARAGRAPH Z910  SELECT FOR NEXT TIMESTAMP'      14030006
140400         DISPLAY ' '                                              14040006
140500         PERFORM Z999-SQL-ERROR.                                  14050006
140600                                                                  14060006
140700*                                                                 14070006
140800******************************************************************14080006
140900*   ERROR MESSAGE ROUTINE                                         14090006
141000******************************************************************14100006
141100 Z999-SQL-ERROR.                                                  14110006
141200                                                                  14120006
141300     MOVE SQLCODE    TO SQLCODE2.                                 14130006
141400     MOVE SQLERRD(3) TO SQLERRD3.                                 14140006
141500     DISPLAY '** ABEND **       ** = SQLERROR'.                   14150006
141600     DISPLAY '** PROGRAM        ** = MRKUP059'.                   14160006
141700     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  14170006
141800     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  14180006
141900     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   14190006
142000     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  14200006
142100     MOVE +4013 TO PV-ABEND-CODE.                                 14210006
142200     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         14220006
142300******************************************************************14230006
