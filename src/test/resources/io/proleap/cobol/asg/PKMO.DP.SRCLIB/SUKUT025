000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.    SUKUT025.                                         00050000
000600 AUTHOR.        DENISE HAHN                                       00060000
000700 INSTALLATION.  KOHLS.                                            00070000
000800 DATE-WRITTEN   JULY, 1999.                                       00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  THIS PROGRAM DELETE THE SPECIFIED ROWS FROM THE TLBPTDA TABLE. 00120000
001300******************************************************************00130000
001400                                                                  00140000
001500******************************************************************00150000
001600 ENVIRONMENT DIVISION.                                            00160000
001700******************************************************************00170000
001800                                                                  00180000
001900 CONFIGURATION SECTION.                                           00190000
002000                                                                  00200000
002100 SOURCE-COMPUTER.        IBM-3090.                                00210000
002200 OBJECT-COMPUTER.        IBM-3090.                                00220000
002300                                                                  00230000
002400 INPUT-OUTPUT SECTION.                                            00240000
002500                                                                  00250000
002600 FILE-CONTROL.                                                    00260000
002700                                                                  00270000
002800     SELECT LBL-PRT-DATA-EXTRACT                                  00280000
002900         ASSIGN TO INP01.                                         00290000
003000******************************************************************00300000
003100 DATA DIVISION.                                                   00310000
003200******************************************************************00320000
003300                                                                  00330000
003400 FILE SECTION.                                                    00340000
003500                                                                  00350001
003600 FD  LBL-PRT-DATA-EXTRACT                                         00360000
003700     RECORDING MODE IS F                                          00370000
003800     LABEL RECORDS ARE STANDARD                                   00380000
003900     BLOCK CONTAINS 0 RECORDS.                                    00390000
004000                                                                  00400000
004100 01  LBL-PRT-DATA-RECORD.                                         00410000
004200     05   LBP-TRIP-ID           PIC  S9(9) COMP.                  00420000
004300     05   LBP-CRE-USR-ID        PIC   X(8).                       00430000
004400     05   LBP-LBL-PRT-BTCH-ID   PIC  S9(4) COMP.                  00440000
P48069*    05   LBP-CRE-TMST          PIC   X(26).                      00450005
004600*                                                                 00460000
004700*                                                                 00470000
004800******************************************************************00480000
004900 WORKING-STORAGE SECTION.                                         00490000
005000******************************************************************00500000
005100*                                                                 00510000
005200******************************************************************00520000
005300*  DB2 FORMATTED MESSAGE AREA                                     00530000
005400******************************************************************00540000
005500     COPY DPWS004.                                                00550000
005600*                                                                 00560000
005700******************************************************************00570000
005800*  COMMUNICATIONS AREA FOR DB2                                    00580000
005900******************************************************************00590000
006000     EXEC SQL                                                     00600000
006100          INCLUDE SQLCA                                           00610000
006200     END-EXEC.                                                    00620000
006300                                                                  00630000
006400******************************************************************00640000
006500*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE SHIPMENT UNIT      00650000
006600*  TABLE                                                          00660000
006700******************************************************************00670000
006800     EXEC SQL                                                     00680000
006900          INCLUDE TLBPTDA                                         00690000
007000     END-EXEC.                                                    00700000
007100*                                                                 00710000
007200 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00720000
007300                                                   COMP SYNC.     00730000
007400 01  PS-PROGRAM-SWITCHES.                                         00740000
007500     05  PS-END-OF-FILE-SW           PIC  X(01)    VALUE 'N'.     00750000
007600         88  PS-END-OF-FILE                        VALUE 'Y'.     00760000
007700         88  PS-NOT-END-OF-FILE                    VALUE 'N'.     00770000
007800                                                                  00780000
007900                                                                  00790000
008000 01  PC-PROGRAM-CONSTANTS.                                        00800000
008100     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00810000
008200         'SUKUT025'.                                              00820000
008300     05  PC-COMMIT-HOLD              PIC 9(3)      VALUE 100.     00830000
008400                                                                  00840000
008500                                                                  00850000
008600 01  DK-DB2-KEYS.                                                 00860000
008700     05   DK-TRIP-ID                 PIC  S9(9) COMP.             00870000
008800     05   DK-CRE-USR-ID              PIC   X(8).                  00880000
008900     05   DK-LBL-PRT-BTCH-ID         PIC  S9(4) COMP.             00890000
009000/    05   DK-CRE-TMST                PIC   X(26).                 00900000
009100                                                                  00910000
009200 01  PV-PROGRAM-VARIABLES.                                        00920000
009300     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  00930000
009400     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  00940000
009500     05  PV-DELETE-COUNT             PIC S9(09)    VALUE ZERO     00950000
009600                                                   COMP SYNC.     00960000
009700     05  PV-TOTAL-DELETE-COUNT       PIC S9(09)    VALUE ZERO     00970000
009800                                                   COMP SYNC.     00980000
009810     05  PV-DISPLAY-DELETE           PIC  ZZZ,ZZZ,ZZ9.            00981003
009900     05  PV-NOT-FOUND-COUNT          PIC S9(09)    VALUE ZERO     00990000
010000                                                   COMP SYNC.     01000000
010100     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             01010000
010200     05  PV-DISPLAY-TRIP             PIC 9(09)     VALUE ZEROES.  01020000
010300     05  PV-DB2-COUNT                PIC S9(09)    VALUE ZERO     01030000
010400                                                   COMP-3.        01040000
010500     05  PV-SQLERRD3                 PIC S9(09)    VALUE ZERO     01050000
010600                                                   COMP-3.        01060000
010700     05  PV-TMST                     PIC X(26)     VALUE SPACES.  01070000
010800******************************************************************01080000
010900 PROCEDURE DIVISION.                                              01090000
011000******************************************************************01100000
011100                                                                  01110000
011200 0000-PROGRAM-MAINLINE.                                           01120000
011300******************************************************************01130000
011400* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     01140000
011500*      PROGRAM.                                                   01150000
011600******************************************************************01160000
011700                                                                  01170000
011800     PERFORM 1000-INITIALIZE.                                     01180000
011900     IF PS-NOT-END-OF-FILE                                        01190000
012000         PERFORM 2000-PROCESS-LABEL-DELETE                        01200000
012100            UNTIL PS-END-OF-FILE                                  01210000
012200     END-IF.                                                      01220000
012300     PERFORM 9000-EOJ-ROUTINE.                                    01230000
012400                                                                  01240000
012500     STOP RUN.                                                    01250000
012600                                                                  01260000
012700 1000-INITIALIZE.                                                 01270000
012800******************************************************************01280000
012900*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    01290000
013000*    -- OPEN INPUT FILE                                           01300000
013100*    -- READ FILE                                                 01310000
013200******************************************************************01320000
013300                                                                  01330000
013400     OPEN INPUT  LBL-PRT-DATA-EXTRACT.                            01340000
013500     PERFORM 7000-READ-LABEL-DELETES.                             01350000
013600                                                                  01360000
013700******************************************************************01370000
013800 2000-PROCESS-LABEL-DELETE.                                       01380000
013900                                                                  01390000
014000     PERFORM 8000-DELETE-LABEL-DATA.                              01400000
014100                                                                  01410000
014200     IF PV-DELETE-COUNT > PC-COMMIT-HOLD                          01420000
014300                                                                  01430000
014400         EXEC SQL                                                 01440000
014500              SET :PV-TMST = CURRENT TIMESTAMP                    01450000
014600         END-EXEC                                                 01460000
014700                                                                  01470000
014800         EXEC SQL                                                 01480000
014900            COMMIT                                                01490000
015000         END-EXEC                                                 01500000
015100                                                                  01510000
015200         IF SQLCODE NOT = +0                                      01520000
015300             DISPLAY '### COMMIT FAILED ! ###'                    01530000
015400             MOVE '2000-PROCESS-LABEL-DELETE'                     01540000
015500                         TO PV-PARAGRAPH-NAME                     01550000
015600             MOVE 'COMMIT OF TLBPTDA'                             01560002
015700                         TO PV-DB2-OPERATION-ATTEMPTED            01570000
015800             PERFORM 9100-SQL-ABEND                               01580000
015900         END-IF                                                   01590000
016000         DISPLAY 'RECS DELETED : '  PV-TOTAL-DELETE-COUNT 'TIME ST01600000
016100-        'AMP : '  PV-TMST                                        01610000
016200         MOVE +0 TO PV-DELETE-COUNT                               01620000
016300     END-IF.                                                      01630000
016400                                                                  01640000
016500     PERFORM 7000-READ-LABEL-DELETES.                             01650000
016600                                                                  01660000
016700******************************************************************01670000
016800 7000-READ-LABEL-DELETES.                                         01680000
016900      READ LBL-PRT-DATA-EXTRACT                                   01690000
017000****       INTO LBL-PRT-DATA-RECORD                               01700000
017100           AT END SET PS-END-OF-FILE TO TRUE.                     01710000
017200                                                                  01720000
017300******************************************************************01730000
017400*  DELETE THE ROW FROM THE LABEL PRINT DATA TABLE                 01740000
017500******************************************************************01750000
017600 8000-DELETE-LABEL-DATA.                                          01760000
017700                                                                  01770000
017800     MOVE  LBP-TRIP-ID          TO  PV-DISPLAY-TRIP.              01780000
017900     MOVE  LBP-TRIP-ID          TO  DK-TRIP-ID.                   01790000
018000     MOVE  LBP-CRE-USR-ID       TO  DK-CRE-USR-ID.                01800000
018100     MOVE  LBP-LBL-PRT-BTCH-ID  TO  DK-LBL-PRT-BTCH-ID.           01810000
018200***  MOVE  LBP-CRE-TMST         TO  DK-CRE-TMST.                  01820001
018300                                                                  01830000
018400     EXEC SQL                                                     01840000
018500         DELETE                                                   01850000
018600             FROM  TLBPTDA                                        01860004
018700             WHERE TRIP_ID         = :DK-TRIP-ID                  01870000
018800               AND CRE_USR_ID      = :DK-CRE-USR-ID               01880000
018900               AND LBL_PRT_BTCH_ID = :DK-LBL-PRT-BTCH-ID          01890000
019000***            AND CRE_TMST        = :DK-CRE-TMST                 01900001
019100     END-EXEC.                                                    01910000
019200                                                                  01920000
019300     EVALUATE TRUE                                                01930000
019400         WHEN SQLCODE = 0                                         01940000
019500             MOVE SQLERRD(3) TO PV-SQLERRD3                       01950000
019600             ADD PV-SQLERRD3 TO PV-DELETE-COUNT                   01960000
019700                                PV-TOTAL-DELETE-COUNT             01970000
019800         WHEN SQLCODE = +100                                      01980000
019900             ADD +1           TO PV-NOT-FOUND-COUNT               01990000
020000         WHEN SQLCODE < 0                                         02000000
020100         WHEN SQLCODE > 0                                         02010000
020200         WHEN SQLWARN0 = 'W'                                      02020000
020300             MOVE '8000-DELETE-LABEL-DATA'                        02030000
020400                         TO PV-PARAGRAPH-NAME                     02040000
020500             MOVE 'DELETE OF TLBPTDA'                             02050002
020600                         TO PV-DB2-OPERATION-ATTEMPTED            02060000
020700             PERFORM 9100-SQL-ABEND                               02070000
020800     END-EVALUATE.                                                02080000
020900                                                                  02090000
021000 9000-EOJ-ROUTINE.                                                02100000
021100******************************************************************02110000
021200*  CLOSE OUTPUT FILE.  CLOSE THE CURSOR.                          02120000
021300******************************************************************02130000
021400     CLOSE LBL-PRT-DATA-EXTRACT.                                  02140000
021500                                                                  02150000
021600     MOVE PV-TOTAL-DELETE-COUNT  TO PV-DISPLAY-COUNT.             02160000
021700     DISPLAY 'TOTAL LABEL DATA RECORDS DELETED ' PV-DISPLAY-COUNT.02170000
021800     MOVE PV-NOT-FOUND-COUNT TO PV-DISPLAY-COUNT.                 02180000
021900     DISPLAY 'TOTAL LABEL DATA RECS NOT FOUND ' PV-DISPLAY-COUNT. 02190000
022000                                                                  02200000
022100 9100-SQL-ABEND.                                                  02210000
022200******************************************************************02220000
022300*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    02230000
022400*  ERROR OR WARNING CODE OCCURS.                                  02240000
022500******************************************************************02250000
022600     DISPLAY '9100-SQL-ABEND'.                                    02260000
022700     DISPLAY '** ABEND     **'.                                   02270000
022800     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        02280000
022900     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              02290000
023000     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     02300000
023100                                                                  02310000
023200******************************************************************02320000
023300* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    02330000
023400* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         02340000
023500* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     02350000
023600* FORMAT.                                                         02360000
023700******************************************************************02370000
023800     COPY DPPD004.                                                02380000
023900                                                                  02390000
024000     MOVE +4013                  TO ABEND-CODE.                   02400000
024100     CALL 'ILBOABN0' USING ABEND-CODE.                            02410000
