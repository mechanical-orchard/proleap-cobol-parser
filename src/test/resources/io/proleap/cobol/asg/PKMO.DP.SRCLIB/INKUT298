       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    INKUT298.                                         00020000
       AUTHOR.        JOHN SELWITSCHKA.                                 00030000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
       DATE-WRITTEN.  01-04-08.                                         00050000
       DATE-COMPILED.                                                   00060000
      ******************************************************************00070000
      *                                                                 00080000
      * INKUT298 - PHYSICAL INVENTORY STORE EXPECTED ADJUSTMENTS        00090000
      *                                                                 00100000
      * THIS PROGRAM WILL READ THE PHYSICAL INVENTORY COUNT FILE AND    00110000
      * COMPARE INVENTORY ADJUSTMENTS TO STORE EXPECTED QUANTITY. IF    00120000
      * THEY ARE EQUAL, THIS MEANS THAT STORE EXPECTED QUANTITY HAS     00130000
      * NOT REFLECTED RECEIVED MERCHANDISE. FOR THESE RECORDS, A REPORT 00140000
      * DETAIL RECORD WILL BE CREATED WITH THE REQUIRED STORE EXPECTED  00150000
      * ADJUSTMENT AMOUNT. THESE RECORDS WILL BE SENT TO THE RECEIVING  00160000
      * SYSTEM. ALSO, A MASSADD OR MASSDEL RECORD WILL BE CREATED,      00160100
      * DEPENDING ON WHETHER IT IS A POSITIVE OR NEGATIVE ADJUSTMENT.   00160200
      ******************** HISTORY OF CHANGES **************************00160300
      * CHG ID/                                                        *00160400
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES                    *00160500
      * -------  ----------  ----------------------------------------  *00160600
      * W33744   01-04-2008  J.SELWITSCHKA                             *00160700
      *                      INITIAL IMPLEMENTATION                    *00160800
W33304* W33304   06-04-2008  JILL LIN                                  *00160901
W33304*                      HOLDING INVENTORY LEDGER OPEN ACROSS      *00161001
W33304*                      PERIODS INVENTORY SHORTAGE REPORTING      *00161101
SR3403* SR3403   03-05-2012  ANUJ GUPTA                                *00161202
SR3403*                      LARGE RETAIL PROJECT                      *00161302
      ******************************************************************00161502
                                                                        00161602
       ENVIRONMENT DIVISION.                                            00162000
                                                                        00163000
       CONFIGURATION SECTION.                                           00164000
                                                                        00165000
       SOURCE-COMPUTER.        IBM-3090.                                00166000
       OBJECT-COMPUTER.        IBM-3090.                                00167000
                                                                        00168000
       INPUT-OUTPUT SECTION.                                            00169000
       FILE-CONTROL.                                                    00170000
                                                                        00180000
           SELECT PHY-CNT-FILE                                          00190000
               ASSIGN TO INP01.                                         00200000
                                                                        00210000
           SELECT RPT-DETAIL-FILE                                       00220000
               ASSIGN TO OUT01.                                         00230000
                                                                        00240000
           SELECT MASSADD-FILE                                          00250000
               ASSIGN TO OUT02.                                         00260000
                                                                        00270000
           SELECT MASSDEL-FILE                                          00280000
               ASSIGN TO OUT03.                                         00290000
                                                                        00300000
      ******************************************************************00310000
       DATA DIVISION.                                                   00320000
      ******************************************************************00330000
                                                                        00340000
       FILE SECTION.                                                    00350000
                                                                        00360000
       FD  PHY-CNT-FILE                                                 00370000
           RECORDING MODE F                                             00380000
           LABEL RECORDS OMITTED                                        00390000
           BLOCK CONTAINS  0 RECORDS.                                   00400000
       01  PHY-CNT-RECORD              PIC X(080).                      00410000
                                                                        00420000
       FD  RPT-DETAIL-FILE                                              00430000
           RECORDING MODE IS F                                          00440000
           LABEL RECORDS ARE STANDARD                                   00450000
           BLOCK CONTAINS 0 RECORDS.                                    00460000
                                                                        00470000
       01  RPT-DETAIL-RECORD           PIC X(150).                      00480000
                                                                        00490000
       FD  MASSADD-FILE                                                 00500000
           RECORDING MODE IS F                                          00510000
           LABEL RECORDS ARE STANDARD                                   00520000
           BLOCK CONTAINS 0 RECORDS.                                    00530000
                                                                        00540000
SR3403 01  MASSADD-RECORD              PIC X(100).                      00551002
                                                                        00560000
       FD  MASSDEL-FILE                                                 00570000
           RECORDING MODE IS F                                          00580000
           LABEL RECORDS ARE STANDARD                                   00590000
           BLOCK CONTAINS 0 RECORDS.                                    00600000
                                                                        00610000
SR3403 01  MASSDEL-RECORD              PIC X(100).                      00621002
                                                                        00630000
      ******************************************************************00640000
       WORKING-STORAGE SECTION.                                         00650000
      ******************************************************************00660000
                                                                        00670000
      *** INPUT CONTROL RECORD                                          00680000
       01  CC-CONTROL-CARD.                                             00690000
           05  CC-EXTR-START-CCYY-MM-DD                                 00700000
                                       PIC X(10).                       00710000
           05  FILLER                  PIC X(70).                       00720000
                                                                        00730000
      *** INPUT PHYSICAL COUNT FILE                                     00740000
           COPY INWS016.                                                00750000
                                                                        00760000
      *** RECEIVING SYSTEM REPORT DETAIL RECORD                         00770000
           COPY INRD030.                                                00780000
                                                                        00790000
      *** OUTPUT PHYSICAL INVENTORY FILE                                00800000
           COPY INWS009.                                                00810000
                                                                        00820000
       01  PA-PROGRAM-ACCUMULATORS.                                     00830000
           05  PA-PHY-CNT-IN           PIC 9(09)    VALUE ZERO.         00840000
           05  PA-RPT-DETAIL-CNT       PIC 9(09)    VALUE ZERO.         00850000
           05  PA-MASSADD-CNT          PIC 9(09)    VALUE ZERO.         00860000
           05  PA-MASSDEL-CNT          PIC 9(09)    VALUE ZERO.         00870000
                                                                        00880000
       01  PC-PROGRAM-CONSTANTS.                                        00890000
           05  PC-PROGRAM-NAME         PIC X(08)   VALUE 'INKUT298'.    00900000
           05  PC-MASSADD-AREA-NBR     PIC 9(06)   VALUE 999555.        00910000
           05  PC-MASSDEL-AREA-NBR     PIC 9(06)   VALUE 888555.        00920000
           05  PC-DEFAULT-DTE          PIC X(10)   VALUE '9999-09-09'.  00930000
                                                                        00940000
       01  PV-PROGRAM-VARIABLES.                                        00950000
                                                                        00960000
      * TIMESTAMP FORMAT IS CCYY-MM-DD-HH.MM.SS.NNNNNN                  00970000
           05  PV-CURRENT-TIMESTAMP    PIC  X(26) VALUE SPACES.         00980000
           05  PV-WRK-ADJUSTMENT-AMT   PIC S9(06)V VALUE ZERO COMP-3.   00990000
           05  PV-SKU-9                PIC  9(08)      VALUE ZERO.      01000000
           05  PV-DISP-DEPT            PIC  9(04)      VALUE ZERO.      01010000
           05  PV-DISP-ENT-ID          PIC  9(09)      VALUE ZERO.      01020000
           05  PV-DISP-LBL-SEQ         PIC  9(09)      VALUE ZERO.      01030000
           05  PV-DISP-SKU             PIC  9(08)      VALUE ZERO.      01040000
                                                                        01050000
                                                                        01060000
       01  PS-PROGRAM-SWITCHES.                                         01070000
           05  PS-PHY-FILE-AT-END-SW      PIC X    VALUE 'N'.           01080000
               88  PS-PHY-FILE-AT-END-YES          VALUE 'Y'.           01090000
               88  PS-PHY-FILE-AT-END-NO           VALUE 'N'.           01100000
           05  PS-TDTATTR-FOUND-SW        PIC X    VALUE 'N'.           01110000
               88  PS-TDTATTR-FOUND-YES            VALUE 'Y'.           01120000
               88  PS-TDTATTR-FOUND-NO             VALUE 'N'.           01130000
           05  PS-QTYS-EQUAL-SW           PIC X    VALUE 'N'.           01140000
               88  PS-QTYS-EQUAL-YES               VALUE 'Y'.           01150000
               88  PS-QTYS-EQUAL-NO                VALUE 'N'.           01160000
                                                                        01170000
       01 ABEND-AREAS.                                                  01180000
           05 ABEND-CODE               PIC S9(04)  VALUE ZERO           01190000
                                                   COMP SYNC.           01200000
               88  AC-CONTROL-CARD                 VALUE +4001.         01210000
               88  AC-CONTROL-CARD                 VALUE +4002.         01220000
               88  AC-BAD-TUPCPLS-000-STR          VALUE +4003.         01230000
               88  AC-DB2-ERROR                    VALUE +4013.         01240000
           05  AA-ABEND-LIT            PIC X(40)   VALUE                01250000
                 '*****       ABEND'.                                   01260000
           05  AA-PROGRAM-LIT          PIC X(40)   VALUE                01270000
                   '*****   PROGRAM: INKUT298'.                         01280000
           05  AA-PARAGRAPH-LIT.                                        01290000
               10  FILLER              PIC X(17)   VALUE                01300000
                   '***** PARAGRAPH: '.                                 01310000
               10  AA-PARAGRAPH-NAME   PIC X(35)   VALUE SPACES.        01320000
           05  AA-MESSAGE-LINE.                                         01330000
               10  FILLER              PIC X(06)   VALUE '*****'.       01340000
               10  AA-MESSAGE          PIC X(127)  VALUE SPACES.        01350000
           05  AA-DB2-ERROR-LIT        PIC X(40)   VALUE                01360000
                   '*****    DB2 ERROR'.                                01370000
           05  AA-DB2-OPERATION-LIT.                                    01380000
               10  FILLER              PIC X(17)   VALUE                01390000
                   '***** OPERATION: '.                                 01400000
               10  AA-DB2-OPERATION.                                    01410000
                   15  AA-DB2-OP-1     PIC X(25)   VALUE SPACES.        01420000
                   15  AA-DB2-OP-2     PIC X(25)   VALUE SPACES.        01430000
           05  AA-DB2-TABLE-1          PIC X(08)   VALUE SPACES.        01440000
           05  AA-DB2-TABLE-2          PIC X(08)   VALUE SPACES.        01450000
           05  AA-DB2-TABLE-3          PIC X(08)   VALUE SPACES.        01460000
           05  AA-DB2-TABLE-4          PIC X(08)   VALUE SPACES.        01470000
           05  AA-DB2-TABLE-5          PIC X(08)   VALUE SPACES.        01480000
                                                                        01490000
      ******************************************************************01500000
      *  DB2 COMMUNICATION AREA                                         01510000
      ******************************************************************01520000
           EXEC SQL                                                     01530000
                INCLUDE SQLCA                                           01540000
           END-EXEC.                                                    01550000
                                                                        01560000
      ******************************************************************01570000
      *  DB2 ERROR MESSAGES FORMAT AREA.                                01580000
      ******************************************************************01590000
           COPY DPWS004.                                                01600000
                                                                        01610000
      ******************************************************************01620000
      *  DB2 TINVPAR TABLE LAYOUT (INVENTORY PARAMETERS)                01630000
      ******************************************************************01640000
           EXEC SQL                                                     01650000
                INCLUDE TINVPAR                                         01660000
           END-EXEC.                                                    01670000
                                                                        01680000
      ******************************************************************01690000
      *  DB2 TINCNTL TABLE LAYOUT (INVENTORY CONTROL)                   01700000
      ******************************************************************01710000
           EXEC SQL                                                     01720000
                INCLUDE TINCNTL                                         01730000
           END-EXEC.                                                    01740000
                                                                        01750000
      ******************************************************************01760000
      *  DB2 IMT00000  XMT_VND                                          01770000
      ******************************************************************01780000
           EXEC SQL                                                     01790000
                INCLUDE XMT00000                                        01800000
           END-EXEC.                                                    01810000
                                                                        01820000
      ******************************************************************01830000
      *  DB2 IMV00001  IMV_SKU                                          01840000
      ******************************************************************01850000
           EXEC SQL                                                     01860000
                INCLUDE IMV00001                                        01870000
           END-EXEC.                                                    01880000
                                                                        01890000
      ******************************************************************01900000
      *    COMMON PRICING WORKING STORAGE COPYBOOK                      01910000
      ******************************************************************01920000
           COPY INWS400.                                                01930000
                                                                        01940000
      ******************************************************************01950000
       PROCEDURE DIVISION.                                              01960000
      ******************************************************************01970000
                                                                        01980000
      ******************************************************************01990000
       0000-MAINLINE.                                                   02000000
      ******************************************************************02010000
                                                                        02020000
           PERFORM 1000-INITIALIZATION.                                 02030000
                                                                        02040000
           PERFORM 2000-PROCESS-PHY-FILE                                02050000
               UNTIL PS-PHY-FILE-AT-END-YES.                            02060000
                                                                        02070000
           PERFORM 8000-EOJ.                                            02080000
                                                                        02090000
           STOP RUN.                                                    02100000
                                                                        02110000
      ******************************************************************02120000
       1000-INITIALIZATION.                                             02130000
      ******************************************************************02140000
                                                                        02150000
           OPEN INPUT  PHY-CNT-FILE.                                    02160000
           OPEN OUTPUT RPT-DETAIL-FILE                                  02170000
                       MASSADD-FILE                                     02180000
                       MASSDEL-FILE.                                    02190000
                                                                        02200000
           EXEC SQL                                                     02210000
               SET :PV-CURRENT-TIMESTAMP = CURRENT TIMESTAMP            02220000
           END-EXEC.                                                    02230000
                                                                        02240000
           EVALUATE TRUE                                                02250000
               WHEN SQLCODE = 0                                         02260000
                   CONTINUE                                             02270000
               WHEN OTHER                                               02280000
                   MOVE '1000-INITIALIZATION'                           02290000
                                       TO AA-PARAGRAPH-NAME             02300000
                   MOVE 'GET TIMESTAMP ERROR'                           02310000
                                       TO AA-MESSAGE                    02320000
                   MOVE 'SET   '       TO AA-DB2-OPERATION              02330000
                   PERFORM 9999-SQL-ABEND                               02340000
           END-EVALUATE.                                                02350000
                                                                        02360000
           INITIALIZE IN030-REPORT-DETAIL                               02370000
                      IN009-EDITED-INVENTORY-RECORD.                    02380000
                                                                        02390000
           PERFORM 2100-READ-PHY-CNT-FILE.                              02400000
                                                                        02410000
      ******************************************************************02420000
      * READ THE PHYSCIAL COUNT FILE. IF THE UNIT BOOKING ADJUSTMENTS  *02430000
      * ARE EQUAL TO STORE EXPECTED QUATITIES, CREATE RECORDS TO BACK  *02440000
      * THE ADJUSTMENTS.                                               *02450000
      ******************************************************************02460000
       2000-PROCESS-PHY-FILE.                                           02470000
      ******************************************************************02480000
                                                                        02490000
           PERFORM 3000-PROCESS-ADJUSTMENT.                             02500000
                                                                        02510000
           PERFORM 2100-READ-PHY-CNT-FILE.                              02520000
                                                                        02530000
      ******************************************************************02540000
       2100-READ-PHY-CNT-FILE.                                          02550000
      ******************************************************************02560000
                                                                        02570000
           READ PHY-CNT-FILE INTO IN016-PHYSICAL-COUNT-RECORD           02580000
               AT END                                                   02590000
                   SET PS-PHY-FILE-AT-END-YES TO TRUE                   02600000
           END-READ.                                                    02610000
                                                                        02620000
           IF PS-PHY-FILE-AT-END-NO                                     02630000
               ADD 1       TO PA-PHY-CNT-IN                             02640000
           END-IF.                                                      02650000
                                                                        02660000
      ******************************************************************02670000
       3000-PROCESS-ADJUSTMENT.                                         02680000
      ******************************************************************02690000
                                                                        02700000
      * BUILD AND WRITE REPORT DETAIL RECORD                            02710000
           MOVE IN016-DEPT-9              TO IN030-DEPT-NBR.            02720000
           MOVE IN016-CLASS-9             TO IN030-SUB-CL-NBR.          02730000
           INSPECT IN016-SKU   REPLACING LEADING SPACES BY ZERO.        02740000
           INSPECT IN016-STORE REPLACING LEADING SPACES BY ZERO.        02750000
           MOVE IN016-SKU                 TO PV-SKU-9                   02760000
           IF IN016-STORE-9 = IN030-LOC-NBR                             02770000
               CONTINUE                                                 02780000
           ELSE                                                         02790000
               MOVE IN016-STORE-9         TO INVPAR-LOC-NBR             02800000
               PERFORM 7000-SELECT-TINVPAR                              02810000
           END-IF.                                                      02820000
           IF IN016-STORE-9 = IN030-LOC-NBR AND                         02830000
              PV-SKU-9      = IN030-SKU-NBR                             02840000
               CONTINUE                                                 02850000
           ELSE                                                         02860000
               INITIALIZE IN400-PV-INPUT-AREA                           02870000
               MOVE IN016-STORE-9         TO IN400-PV-LOC-IN            02880000
               MOVE PV-SKU-9              TO IN400-PV-SKU-IN            02890000
               MOVE INVPAR-ACTL-INV-DTE   TO IN400-PV-EFF-DTE-IN        02900000
               SET IN400-PV-SKU-LOOKUP    TO TRUE                       02910000
               PERFORM IN400-LOOKUP-RETAIL                              02920000
               IF NOT IN400-PV-INVALID-KEY-INPUT                        02930000
                   CONTINUE                                             02940000
               ELSE                                                     02950000
                   DISPLAY '** ERROR DURING RETAIL LOOKUP **'           02960000
                   DISPLAY 'LOC           : ' IN400-PV-LOC-IN           02970000
                   DISPLAY 'SKU           : ' IN400-PV-SKU-IN           02980000
                   DISPLAY 'ACTL INV DATE : ' IN400-PV-EFF-DTE-IN       02990000
                   DISPLAY IN400-PV-PARAGRAPH                           03000000
                   MOVE '3000-PROCESS-ADJUSTMENT' TO AA-PARAGRAPH-NAME  03010000
                   MOVE IN400-PV-RETURN-RSN       TO AA-DB2-OPERATION   03020000
                   MOVE 'COMMON RETAIL LOOKUP'    TO AA-MESSAGE         03030000
                   PERFORM 9999-SQL-ABEND                               03040000
               END-IF                                                   03050000
           END-IF.                                                      03060000
           IF PV-SKU-9      = IN030-SKU-NBR                             03070000
               CONTINUE                                                 03080000
           ELSE                                                         03090000
               MOVE PV-SKU-9              TO IMV00001-SKU-NBR           03100000
               PERFORM 7100-LOOKUP-VND-SKU                              03110000
           END-IF.                                                      03120000
           MOVE IN016-STORE-9             TO IN030-LOC-NBR              03130000
           MOVE PV-SKU-9                  TO IN030-SKU-NBR.             03140000
           MOVE INVPAR-ACTL-INV-DTE       TO IN030-INV-DTE.             03150000
           MOVE INVPAR-ACTL-UNIT-BK-DTE   TO IN030-UNIT-BK-DTE.         03160000
           MOVE IN400-PRC-UNIT-RTL-OUT    TO IN030-UNIT-RTL-AMT.        03170000
           MOVE IN016-ADJUSTMENT-AMT      TO IN030-ADJ-UNITS.           03180000
           COMPUTE IN030-EXTD-RTL-AMT = IN030-ADJ-UNITS *               03190000
                                        IN030-UNIT-RTL-AMT              03200000
           END-COMPUTE.                                                 03210000
           MOVE XMT00000-PRIM-VND-NM      TO IN030-VENDOR-NAME.         03220000
           MOVE IMV00001-SKU-DESC         TO IN030-SKU-DESC.            03230000
           PERFORM 3100-WRITE-RPT-DETAIL-REC.                           03240000
                                                                        03250000
      * BUILD AND WRITE MASSADD OR MASSDEL RECORD                       03260000
           MOVE IN016-STORE-9             TO IN009-STORE-NUMBER.        03270000
           IF IN016-STORE-9 = IN009-STORE-NUMBER                        03280000
               CONTINUE                                                 03290000
           ELSE                                                         03300000
               MOVE ZERO                  TO IN009-LINE-NUMBER          03310000
                                             IN009-SCAN-LINE-NUMBER     03320000
           END-IF.                                                      03330000
           ADD +1                         TO IN009-LINE-NUMBER          03340000
                                             IN009-SCAN-LINE-NUMBER.    03350000
           MOVE PV-SKU-9                  TO IN009-SKU.                 03360000
           MOVE IN030-UNIT-RTL-AMT        TO IN009-PRICE.               03370000
           MOVE 'N'                       TO IN009-MISSED-MARKDOWN-IND. 03380000
           MOVE PV-CURRENT-TIMESTAMP (6:2)                              03390000
                                          TO IN009-SCAN-DTE (1:2).      03400000
           MOVE PV-CURRENT-TIMESTAMP (9:2)                              03410000
                                          TO IN009-SCAN-DTE (3:2).      03420000
           MOVE PV-CURRENT-TIMESTAMP (12:2)                             03430000
                                          TO IN009-SCAN-TIMESTAMP (1:2).03440000
           MOVE PV-CURRENT-TIMESTAMP (15:2)                             03450000
                                          TO IN009-SCAN-TIMESTAMP (3:2).03460000
           MOVE PV-CURRENT-TIMESTAMP (18:2)                             03470000
                                          TO IN009-SCAN-TIMESTAMP (5:2).03480000
           MOVE IN016-DEPT-9              TO IN009-DEPT.                03490000
           MOVE IN016-CLASS-9             TO IN009-SUB-CLASS            03500000
                                             IN009-MAJ-CLASS.           03510000
           MOVE '0'                       TO IN009-MAJ-CLASS (4:1).     03520000
           MOVE ZERO                      TO IN009-UPC-CODE.            03530000
           IF IN030-ADJ-UNITS < ZERO                                    03540000
               MOVE PC-MASSADD-AREA-NBR   TO IN009-AREA-NUMBER          03550000
               COMPUTE IN009-QUANTITY-COMP = IN030-ADJ-UNITS * -1       03560000
               PERFORM 3200-WRITE-MASSADD-REC                           03570000
           ELSE                                                         03580000
               MOVE PC-MASSDEL-AREA-NBR   TO IN009-AREA-NUMBER          03590000
               MOVE IN030-ADJ-UNITS       TO IN009-QUANTITY-COMP        03600000
               PERFORM 3300-WRITE-MASSDEL-REC                           03610000
           END-IF.                                                      03620000
                                                                        03630000
      ******************************************************************03640000
       3100-WRITE-RPT-DETAIL-REC.                                       03650000
      ******************************************************************03660000
                                                                        03670000
           WRITE RPT-DETAIL-RECORD FROM IN030-REPORT-DETAIL.            03680000
                                                                        03690000
           ADD +1 TO PA-RPT-DETAIL-CNT.                                 03700000
                                                                        03710000
      ******************************************************************03720000
       3200-WRITE-MASSADD-REC.                                          03730000
      ******************************************************************03740000
                                                                        03750000
           WRITE MASSADD-RECORD FROM IN009-EDITED-INVENTORY-RECORD.     03760000
                                                                        03770000
           ADD +1 TO PA-MASSADD-CNT.                                    03780000
                                                                        03790000
      ******************************************************************03800000
       3300-WRITE-MASSDEL-REC.                                          03810000
      ******************************************************************03820000
                                                                        03830000
           WRITE MASSDEL-RECORD FROM IN009-EDITED-INVENTORY-RECORD.     03840000
                                                                        03850000
           ADD +1 TO PA-MASSDEL-CNT.                                    03860000
                                                                        03870000
      ******************************************************************03880000
       7000-SELECT-TINVPAR.                                             03890000
      ******************************************************************03900000
                                                                        03910000
           EXEC SQL                                                     03920000
               SELECT ACTL_UNIT_BK_DTE                                  03930000
                     ,MAX(ACTL_INV_DTE)                                 03940000
               INTO  :INVPAR-ACTL-UNIT-BK-DTE                           03950000
                    ,:INVPAR-ACTL-INV-DTE                               03960000
               FROM  TINVPAR A                                          03970000
                    ,TINCNTL B                                          03980000
               WHERE B.ACTV_IND      = 'Y'                              03990000
                 AND A.INV_ID        = B.INV_ID                         04000000
                 AND LOC_NBR         = :INVPAR-LOC-NBR                  04010000
                 AND ACTL_FIN_BK_DTE = :PC-DEFAULT-DTE                  04020000
W33304           AND A.LOC_INV_STAT_CDE = 'IN'                          04021001
                 AND ACTL_INV_DTE   <> :PC-DEFAULT-DTE                  04030000
               GROUP BY LOC_NBR                                         04040000
                      , ACTL_UNIT_BK_DTE                                04050000
                      , PLND_INV_DTE                                    04060000
               WITH UR                                                  04070000
           END-EXEC.                                                    04080000
                                                                        04090000
           EVALUATE TRUE                                                04100000
               WHEN SQLCODE = ZERO                                      04110000
                   CONTINUE                                             04120000
               WHEN SQLCODE = +100                                      04130000
                   MOVE PC-DEFAULT-DTE TO INVPAR-ACTL-UNIT-BK-DTE       04140000
               WHEN SQLCODE = -904                                      04150000
               WHEN SQLCODE = -913                                      04160000
                   MOVE '7000-SELECT-TINVPAR'                           04170000
                                       TO AA-PARAGRAPH-NAME             04180000
                   MOVE 'SELECT'       TO AA-DB2-OPERATION              04190000
                   MOVE 'FIN BK DATE ERROR'                             04200000
                                       TO AA-MESSAGE                    04210000
                   MOVE 'TINVPAR'      TO AA-DB2-TABLE-1                04220000
                   MOVE 'TINCNTL'      TO AA-DB2-TABLE-2                04230000
                   PERFORM 9999-SQL-ABEND                               04240000
           END-EVALUATE.                                                04250000
                                                                        04260000
      ******************************************************************04270000
       7100-LOOKUP-VND-SKU.                                             04280000
      ******************************************************************04290000
                                                                        04300000
           EXEC SQL                                                     04310000
               SELECT D.PRIM_VND_NM                                     04320000
                     ,E.SKU_DESC                                        04330000
               INTO  :XMT00000-PRIM-VND-NM                              04340000
                    ,:IMV00001-SKU-DESC                                 04350000
               FROM  TSKXREF A                                          04360000
                    ,TUPC    B                                          04370000
                    ,TVNDSTL C                                          04380000
                    ,XMT_VND D                                          04390000
                    ,IMV_SKU E                                          04400000
               WHERE A.SKU         = :IMV00001-SKU-NBR                  04410000
                 AND A.INTR_UPC_ID = B.INTR_UPC_ID                      04420000
                 AND B.VS_ID       = C.VS_ID                            04430000
                 AND C.VS_ID       = E.VS_ID                            04440000
                 AND C.ENT_ID      = D.ENT_ID                           04450000
               WITH UR                                                  04460000
           END-EXEC.                                                    04470000
                                                                        04480000
           EVALUATE TRUE                                                04490000
               WHEN SQLCODE = ZERO                                      04500000
                   CONTINUE                                             04510000
               WHEN SQLCODE = +100                                      04520000
                   MOVE 'UNKNOWN                       '                04530000
                     TO XMT00000-PRIM-VND-NM                            04540000
                        IMV00001-SKU-DESC                               04550000
               WHEN SQLCODE = -904                                      04560000
               WHEN SQLCODE = -913                                      04570000
                   MOVE '7100-LOOKUP-VND-SKU'                           04580000
                                       TO AA-PARAGRAPH-NAME             04590000
                   MOVE 'SELECT'       TO AA-DB2-OPERATION              04600000
                   MOVE 'VND SKU LOOKUP ERROR'                          04610000
                                       TO AA-MESSAGE                    04620000
                   MOVE 'TSKXREF'      TO AA-DB2-TABLE-1                04630000
                   MOVE 'TUPC   '      TO AA-DB2-TABLE-2                04640000
                   MOVE 'TVNDSTL'      TO AA-DB2-TABLE-3                04650000
                   MOVE 'XMT_VND'      TO AA-DB2-TABLE-4                04660000
                   MOVE 'IMV_SKU'      TO AA-DB2-TABLE-5                04670000
                   PERFORM 9999-SQL-ABEND                               04680000
           END-EVALUATE.                                                04690000
                                                                        04700000
      ******************************************************************04710000
       8000-EOJ.                                                        04720000
      ******************************************************************04730000
                                                                        04740000
           DISPLAY ' '.                                                 04750000
           DISPLAY '  PROGRAM INKUT298 PROCESSING SUMMARY'.             04760000
           DISPLAY '  -----------------------------------'.             04770000
           DISPLAY ' '.                                                 04780000
           DISPLAY ' PHYSICAL COUNT RECORDS READ  : '                   04790000
                         PA-PHY-CNT-IN.                                 04800000
           DISPLAY ' REPORT DETAIL RECORDS WRITTEN: '                   04810000
                         PA-RPT-DETAIL-CNT.                             04820000
           DISPLAY ' MASSADD RECORDS WRITTEN      : '                   04830000
                         PA-MASSADD-CNT.                                04840000
           DISPLAY ' MASSDEL RECORDS WRITTEN      : '                   04850000
                         PA-MASSDEL-CNT.                                04860000
                                                                        04870000
           CLOSE PHY-CNT-FILE                                           04880000
                 RPT-DETAIL-FILE                                        04890000
                 MASSADD-FILE                                           04900000
                 MASSDEL-FILE.                                          04910000
                                                                        04920000
      ******************************************************************04930000
       9900-COMMON-ABEND-ROUTINE.                                       04940000
      ******************************************************************04950000
      *                                                                 04960000
           DISPLAY AA-ABEND-LIT.                                        04970000
           DISPLAY AA-PROGRAM-LIT.                                      04980000
           DISPLAY AA-PARAGRAPH-LIT.                                    04990000
           DISPLAY AA-MESSAGE-LINE.                                     05000000
           DISPLAY ABEND-CODE.                                          05010000
                                                                        05020000
           PERFORM 9999-ABEND.                                          05030000
                                                                        05040000
      ******************************************************************05050000
       9999-SQL-ABEND.                                                  05060000
      ******************************************************************05070000
      *                                                                 05080000
           CLOSE PHY-CNT-FILE                                           05090000
                 RPT-DETAIL-FILE                                        05100000
                 MASSADD-FILE                                           05110000
                 MASSDEL-FILE.                                          05120000
                                                                        05130000
           DISPLAY AA-ABEND-LIT.                                        05140000
           DISPLAY AA-DB2-ERROR-LIT.                                    05150000
           DISPLAY AA-PROGRAM-LIT.                                      05160000
           DISPLAY AA-PARAGRAPH-LIT.                                    05170000
           DISPLAY AA-MESSAGE-LINE.                                     05180000
           DISPLAY AA-DB2-OPERATION-LIT.                                05190000
           DISPLAY AA-DB2-TABLE-1.                                      05200000
           DISPLAY AA-DB2-TABLE-2.                                      05210000
           DISPLAY AA-DB2-TABLE-3.                                      05220000
           DISPLAY AA-DB2-TABLE-4.                                      05230000
           DISPLAY AA-DB2-TABLE-5.                                      05240000
           SET AC-DB2-ERROR TO TRUE.                                    05250000
           MOVE +4013                  TO ABEND-CODE.                   05260000
                                                                        05270000
           COPY DPPD004.                                                05280000
           PERFORM 9999-ABEND.                                          05290000
                                                                        05300000
       9999-ABEND.                                                      05310000
                                                                        05320000
           CALL 'ILBOABN0' USING ABEND-CODE.                            05330000
                                                                        05340000
      ******************************************************************05350000
      *  COMMON PRICING PROCEDURE DIVISION COPYBOOK                     05360000
      ******************************************************************05370000
           COPY INPD400.                                                05380000
                                                                        05390000
