000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    DPKCS057.                                         00040000
000500 AUTHOR.        CHERI MASTEL - COMPUWARE.                         00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  05-01-96.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    Z057 - BROWSE/DISPLAY MNEMONIC VSAM AUDIT LOG.             * 00110000
001200*                                                               * 00120000
001300*    THIS PROGRAM GENERATES A LIST OF ENTRIES FROM THE VSAM     * 00130000
001400*    AUDIT LOG FILE OF MAINTENANCE TO MNEMONIC AND MENUITEM ROWS. 00140000
001500*                                                               * 00150000
001600*    THIS PROGRAM ALLOWS BROWSING VIA A SCROLLABLE LIST.        * 00160000
001700*    - NO SELECTIONS ARE ALLOWED.                               * 00170000
001800*    - THERE ARE NO FUNCTIONS TO NAVIGATE TO.                   * 00180000
001900*---------------------------------------------------------------* 00190000
990318*  03/18/99  JJR  CHANGED PC-DPCAUDIT-MAX-REC-LEN FROM +908     * 00191023
990318*                                                   TO +934.    * 00191123
990318*---------------------------------------------------------------* 00192023
262023*  CHANGED 09/28/2021    BY JIM HUNTER      WR: CHG0262023      * 00193025
262023*  CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE  * 00194025
262023*  MAKING THE CALL DYNAMIC VS STATIC                            * 00195025
262023*---------------------------------------------------------------* 00196025
002000                                                                  00200000
002100 ENVIRONMENT DIVISION.                                            00210000
002200                                                                  00220000
002300 DATA DIVISION.                                                   00230000
002400                                                                  00240000
002500 WORKING-STORAGE SECTION.                                         00250000
002600                                                                  00260000
002700***************************************************************** 00270000
002800*    THE VSAM "DPCAUDIT" FILE IS AN ESDS, NOT A KEYED FILE.     * 00280000
002900*    THEREFORE ALL RECORDS WILL BE READ.                        * 00290000
003000*    - THOSE MATCHING THE MNEMONIC ENTERED ON THE CRITERIA SPEC * 00300000
003100*      WILL BE DISPLAYED.                                       * 00310000
003200*    - IF NO MNEMONIC WAS ENTERED ON THE CRITERIA SPEC, ALL     * 00320000
003300*      WILL BE DISPLAYED.                                       * 00330000
003400***************************************************************** 00340000
003500 01  DK-VSAM-MATCHING-KEY.                                        00350000
003600     15  DK-VSAM-MATCHING-MNEMONIC      PIC  X(08)  VALUE SPACE.  00360000
003700                                                                  00370000
003800                                                                  00380000
003900 01  PC-PROGRAM-CONSTANTS.                                        00390000
004000     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00400000
004100                                                    'DP057A  '.   00410000
004200     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00420000
004300                                                    'DPKM057 '.   00430000
004400     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00440000
004500                                                    'DPKCS057'.   00450000
004600     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00460000
004700     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     00470000
004800                                                    COMP SYNC.    00480000
004900     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00490000
005000                                                    COMP SYNC.    00500000
005100     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00510000
005200                                                    +1000000      00520000
005300                                                    COMP-3.       00530000
005400     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00540000
005500                                                    COMP SYNC.    00550000
005600     05  PC-OPERCO-NBR                  PIC  X(02)  VALUE '03'.   00560000
005700     05  PC-OPERATING-COMPANY           PIC  X(02)  VALUE '03'.   00570000
005800     05  PC-DPCAUDIT-FILE               PIC  X(08)  VALUE         00580000
005900                                                    'DPCAUDIT'.   00590000
006000     05  PC-DPCAUDIT-MAX-REC-LEN        PIC  S9(4)  VALUE         00600000
990318                                                    +934.         00610023
006200     05  PC-DPCAUDIT-RBA-ZERO           PIC  S9(9)  VALUE +0      00620000
006300                                                    COMP SYNC.    00630000
006400     05  PC-PM-LQW-DESC.                                          00640000
006500         10  PC-PM-LQW-DESC-ITEM        PIC  X(08)  VALUE         00650000
006600                                                    ', ITEM: '.   00660000
006700         10  PC-PM-LQW-DESC-BLOCK       PIC  X(08)  VALUE         00670000
006800                                                    ', BLCK: '.   00680000
006900                                                                  00690000
007000     05  PC-TSYMSG-NUMBERS.                                       00700000
007100         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00710000
007200         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00720000
007300         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00730000
007400         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00740000
007500         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00750000
007600         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00760000
007700         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00770000
007800                                                                  00780011
007900     05  PC-VSAM-ACTION-CODES.                                    00790018
008000         10  PC-ADD                     PIC  X(03)  VALUE  'ADD'. 00800018
008100         10  PC-UPD                     PIC  X(03)  VALUE  'UPD'. 00810018
008200         10  PC-REP                     PIC  X(03)  VALUE  'REP'. 00820018
008300         10  PC-DEL                     PIC  X(03)  VALUE  'DEL'. 00830018
008400                                                                  00840018
008500 01  PS-PROGRAM-SWITCHES.                                         00850018
008600     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00860018
008700         88  PS-NO-ERROR                            VALUE 'Y'.    00870018
008800         88  PS-ERROR                               VALUE 'N'.    00880018
008900     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00890018
009000         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00900018
009100         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00910018
009200     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    00920018
009300         88  PS-DONE                                VALUE 'Y'.    00930018
009400         88  PS-NOT-DONE                            VALUE 'N'.    00940018
009500                                                                  00950018
009600 01  PV-PROGRAM-VARIABLES.                                        00960018
009700     05  PV-SUB                         PIC S9(04)  VALUE +0      00970018
009800                                                    COMP SYNC.    00980018
009900     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00990018
010000                                                    COMP SYNC.    01000018
010100     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01010018
010200                                                    COMP-3.       01020018
010300     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01030018
010400                                                    COMP-3.       01040018
010500     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01050018
010600                                                    COMP-3.       01060018
010700     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01070018
010800                                                    COMP-3.       01080018
010900     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01090018
011000                                                    COMP-3.       01100018
011100     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01110018
011200                                                    COMP-3.       01120018
011300     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01130018
011400                                                    COMP SYNC.    01140018
011500     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01150018
011600                                                    COMP SYNC.    01160018
011700     05  PV-ITEM                        PIC S9(04)  VALUE +0      01170018
011800                                                    COMP SYNC.    01180018
011900     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01190018
012000                                                    COMP SYNC.    01200018
012100     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01210018
012200                                                    COMP SYNC.    01220018
012300     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01230018
012400                                                    COMP SYNC.    01240018
012500     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01250018
012600                                                    COMP SYNC.    01260018
012700     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01270018
012800                                                    COMP SYNC.    01280018
012900     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01290018
013000                                                    COMP SYNC.    01300018
013100     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01310018
013200                                                    COMP SYNC.    01320018
013300     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01330018
013400                                                    COMP SYNC.    01340018
013500     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01350018
013600                                                    COMP SYNC.    01360018
013700     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01370018
013800                                                    COMP SYNC.    01380018
013900     05  PV-LQW-LENGTH                  PIC S9(4)   VALUE +0      01390018
014000                                                    COMP SYNC.    01400018
014100     05  PV-DPCAUDIT-MAX-REC-LEN        PIC S9(4)   VALUE +0.     01410018
014200     05  PV-DPCAUDIT-REC-LEN            PIC S9(4)   VALUE +0      01420018
014300                                                    COMP SYNC.    01430018
014400     05  PV-DPCAUDIT-RBA                PIC S9(9)   VALUE +0      01440018
014500                                                    COMP SYNC.    01450018
014600     05  PV-TIMESTAMP-26CHAR.                                     01460018
014700         10  PV-TIMESTAMP-19CHAR        PIC X(19)   VALUE SPACES. 01470018
014800         10  FILLER                     PIC X(07)   VALUE SPACES. 01480018
014900                                                                  01490018
015000     05  PV-VSAM-ACTION-CODES.                                    01500019
015100         10  PV-UNKNOWN                 PIC  X(03)  VALUE  SPACES.01510019
015200                                                                  01520018
015300 01  PM-PROGRAM-MESSAGES.                                         01530018
015400     05  PM-ABEND-INFO-A.                                         01540018
015500         10  FILLER                PIC X(15)   VALUE              01550018
015600                                   'DP020-SRC-AID: '.             01560018
015700         10  PM-A-SRC-AID          PIC X(02)   VALUE  SPACE.      01570018
015800         10  FILLER                PIC X(19)   VALUE              01580018
015900                                   '. DP020-FK-ACTION: '.         01590018
016000         10  PM-A-FK-ACTION        PIC X(01)   VALUE  SPACE.      01600018
016100         10  FILLER                PIC X(22)   VALUE              01610018
016200                                   '. DP020-FK-DISPN-IND: '.      01620018
016300         10  PM-A-FK-DISPN         PIC X(01)   VALUE  SPACE.      01630018
016400         10  FILLER                PIC X(01)   VALUE '.'.         01640018
016500         10  FILLER                PIC X(19)   VALUE SPACE.       01650018
016600                                                                  01660018
016700     05  PM-LQW-ABEND-MSG.                                        01670018
016800         10  FILLER                     PIC X(06)   VALUE         01680018
016900                                                    'TS Q: '.     01690018
017000         10  PM-LQW-NAME.                                         01700018
017100             15  PM-LQW-TERM-ID         PIC X(04).                01710018
017200             15  PM-LQW-TASK            PIC 9(05).                01720018
017300             15  PM-LQW-SEQ             PIC 9(01).                01730018
017400         10  PM-LQW-DESC                PIC X(08)   VALUE         01740018
017500                                                    ', ITEM: '.   01750018
017600         10  PM-LQW-ITEM-OR-BLOCK       PIC 9(04)   VALUE ZERO.   01760018
017700         10  FILLER                     PIC X(10)   VALUE         01770018
017800                                                    ', LENGTH: '. 01780018
017900         10  PM-LQW-LENGTH              PIC 9(04)   VALUE ZERO.   01790018
018000         10  FILLER                     PIC X(01)   VALUE '.'.    01800018
018100                                                                  01810018
018200******************************************************************01820018
018300**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01830018
018400**  THIS MUST BE THE EXACT SAME FORMAT AS A BLOCK IN THE        **01840018
018500**  APPLICATION-SPECIFIC COMMAREA.                              **01850018
018600**  (SEE:    15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.)             **01860018
018700******************************************************************01870018
018800 01  LQW-LIST-QUEUE-WORK-AREA.                                    01880018
018900     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01890018
019000     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           01900018
019100                                        INDEXED BY LQW-IDX.       01910018
019200         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01920018
019300         10  LQW-SCREEN-LIST-FIELDS.                              01930018
019400*                *************************************************01940018
019500*                * FIELDS SPECIFIC TO THIS APPLICATION:          *01950018
019600*                *************************************************01960018
019700             15  LQW-MNEMONIC            PIC  X(08).              01970018
019800             15  LQW-REC-TYPE            PIC  X(08).              01980018
019900             15  LQW-ACTION              PIC  X(03).              01990021
020000             15  LQW-REQUESTOR           PIC  X(07).              02000018
020100             15  LQW-ACTION-TMSTP        PIC  X(19).              02010018
020200             15  LQW-PREVIOUS-TMSTP      PIC  X(19).              02020018
020300*    05  LQW-FILLER                          PIC  X(3273)         02030021
020400*                                            VALUE SPACES.        02040018
020500                                                                  02050018
020600*---------------------------------------------------------------* 02060018
020700*    MAP LAYOUT                                                 * 02070018
020800*---------------------------------------------------------------* 02080018
020900     COPY DPKM057.                                                02090018
021000                                                                  02100018
021100 01  MR-OCCURS-LAYOUT                   REDEFINES  DP057AO.       02110018
021200     05  FILLER                         PIC X(42).                02120018
021300     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          02130018
021400                                                                  02140018
021500         10  MR-MNEMONICL               PIC S9(04) COMP.          02150018
021600         10  MR-MNEMONICA               PIC  X(01).               02160018
021700         10  MR-MNEMONICC               PIC  X(01).               02170018
021800         10  MR-MNEMONICH               PIC  X(01).               02180018
021900         10  MR-MNEMONIC                PIC  X(08).               02190018
022000                                                                  02200018
022100         10  MR-REC-TYPEL               PIC S9(04) COMP.          02210018
022200         10  MR-REC-TYPEA               PIC  X(01).               02220018
022300         10  MR-REC-TYPEC               PIC  X(01).               02230018
022400         10  MR-REC-TYPEH               PIC  X(01).               02240018
022500         10  MR-REC-TYPE                PIC  X(08).               02250018
022600                                                                  02260018
022700         10  MR-ACTIONL                 PIC S9(04) COMP.          02270018
022800         10  MR-ACTIONA                 PIC  X(01).               02280018
022900         10  MR-ACTIONC                 PIC  X(01).               02290018
023000         10  MR-ACTIONH                 PIC  X(01).               02300018
023100         10  MR-ACTION                  PIC  X(03).               02310021
023200                                                                  02320018
023300         10  MR-REQUESTORL              PIC S9(04) COMP.          02330018
023400         10  MR-REQUESTORA              PIC  X(01).               02340018
023500         10  MR-REQUESTORC              PIC  X(01).               02350018
023600         10  MR-REQUESTORH              PIC  X(01).               02360018
023700         10  MR-REQUESTOR               PIC  X(07).               02370018
023800                                                                  02380018
023900         10  MR-ACTION-TMSTPL           PIC S9(04) COMP.          02390018
024000         10  MR-ACTION-TMSTPA           PIC  X(01).               02400018
024100         10  MR-ACTION-TMSTPC           PIC  X(01).               02410018
024200         10  MR-ACTION-TMSTPH           PIC  X(01).               02420018
024300         10  MR-ACTION-TMSTP            PIC  X(19).               02430018
024400                                                                  02440018
024500         10  MR-PREVIOUS-TMSTPL         PIC S9(04) COMP.          02450018
024600         10  MR-PREVIOUS-TMSTPA         PIC  X(01).               02460018
024700         10  MR-PREVIOUS-TMSTPC         PIC  X(01).               02470018
024800         10  MR-PREVIOUS-TMSTPH         PIC  X(01).               02480018
024900         10  MR-PREVIOUS-TMSTP          PIC  X(19).               02490018
025000     05  FILLER                         PIC  X(36).               02500021
025100                                                                  02510018
025200                                                                  02520018
025300*---------------------------------------------------------------* 02530018
025400*    "DPCAUDIT" RECORD LAYOUT FOR VSAM ESDS AUDIT LOG FILE.     * 02540018
025500*---------------------------------------------------------------* 02550018
025600     COPY DPRD520.                                                02560018
025700                                                                  02570018
025800                                                                  02580018
025900*---------------------------------------------------------------* 02590018
026000*    CICS SYSTEM MESSAGES                                       * 02600018
026100*---------------------------------------------------------------* 02610018
026200     COPY DPRD507I.                                               02620018
026300                                                                  02630018
026400                                                                  02640018
026500*---------------------------------------------------------------* 02650018
026600*    STANDARD ATTENTION IDENTIFIER LIST                         * 02660018
026700*---------------------------------------------------------------* 02670018
026800     COPY DFHAID.                                                 02680018
026900                                                                  02690018
027000                                                                  02700018
027100*---------------------------------------------------------------* 02710018
027200*    STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST      * 02720018
027300*---------------------------------------------------------------* 02730018
027400     COPY DFHBMSCA.                                               02740018
027500                                                                  02750018
027600                                                                  02760018
027700*---------------------------------------------------------------* 02770018
027800*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02780018
027900*---------------------------------------------------------------* 02790018
028000     COPY DPWS015.                                                02800018
028100                                                                  02810018
028200                                                                  02820018
028300*---------------------------------------------------------------* 02830018
028400*    FUNCTION KEYS COPYBOOK.                                    * 02840018
028500*---------------------------------------------------------------* 02850018
028600     COPY DPWS016.                                                02860018
028700                                                                  02870018
028800                                                                  02880018
028900*---------------------------------------------------------------* 02890018
029000*    NUMERIC EDIT LAYOUT.                                       * 02900018
029100*---------------------------------------------------------------* 02910018
029200     COPY DPWS010I.                                               02920018
029300                                                                  02930018
      *---------------------------------------------------------------* 02940026
      *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02950026
      *---------------------------------------------------------------* 02960026
                                                                        02970026
           COPY DPWS030.                                                02980026
           COPY DPWS930.                                                02990026
030000                                                                  03000018
030100*---------------------------------------------------------------* 03010018
030200*    STANDARD COMMAREA.                                         * 03020018
030300*---------------------------------------------------------------* 03030018
030400     COPY DPWS020.                                                03040018
030500     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03050018
030600                                                                  03060018
030700*---------------------------------------------------------------* 03070018
030800* INTER-APPLICATION COMMAREA.                                   * 03080018
030900*   DPWS062 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 03090018
031000*             SPEC SCREEN.                                      * 03100018
031100*---------------------------------------------------------------* 03110018
031200         10  INTER-APPL-COMM-AREA       PIC X(200).               03120018
031300                                                                  03130018
031400     COPY DPWS062.                                                03140018
031500                                                                  03150018
031600*---------------------------------------------------------------* 03160018
031700*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03170018
031800*---------------------------------------------------------------* 03180018
031900         10  ASC-SPECIFIC-COMMAREA.                               03190018
032000             15  ASC-LIST-KEYS.                                   03200018
032100*                *************************************************03210018
032200*                * KEYS SPECIFIC TO THIS APPLICATION:            *03220018
032300*                *************************************************03230018
032400                 20  ASC-KEY-MATCHING-MNEMONIC       PIC  X(08).  03240018
032500             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03250018
032600*                *************************************************03260018
032700*                * ONE BLOCK MUST MATCH EXACTLY TO THE LISTQ.    *03270018
032800*                * (SEE: 01  LQW-LIST-QUEUE-WORK-AREA.)          *03280018
032900*                *************************************************03290018
033000                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03300018
033100                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03310018
033200                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03320018
033300                 20  ASC-ITEM-ARRAY.                              03330018
033400                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        03340018
033500*                        *****************************************03350018
033600*                        * 14 LINES OF DATA PRESENTED IN LIST:   *03360018
033700*                        *****************************************03370018
033800                         30  ASC-LIST-ITEM-NUMBER    PIC S9(09)   03380018
033900                                                     COMP-3.      03390018
034000                         30  ASC-SCREEN-LIST-FIELDS.              03400018
034100*                        *****************************************03410018
034200*                        * FIELDS SPECIFIC TO THIS APPLICATION:  *03420018
034300*                        *****************************************03430018
034400                             35  ASC-MNEMONIC        PIC  X(08).  03440018
034500                             35  ASC-REC-TYPE        PIC  X(08).  03450018
034600                             35  ASC-ACTION          PIC  X(03).  03460020
034700                             35  ASC-REQUESTOR       PIC  X(07).  03470018
034800                             35  ASC-ACTION-TMSTP    PIC  X(19).  03480018
034900                             35  ASC-PREVIOUS-TMSTP  PIC  X(19).  03490018
035000*                *************************************************03500018
035100*                * FIELDS REQUIRED FOR CICS ARCHITECTURE:        *03510018
035200*                *************************************************03520018
035300             15  ASC-BLK-SUB                         PIC S9(04)   03530018
035400                                                          COMP    03540018
035500                                                          SYNC.   03550018
035600             15  ASC-ITEM-SUB                        PIC S9(04)   03560018
035700                                                          COMP    03570018
035800                                                          SYNC.   03580018
035900             15  ASC-NUMBER-OF-ITEMS-TOTAL           PIC S9(09)   03590018
036000                                                          COMP-3. 03600018
036100             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03610018
036200                                                          COMP-3. 03620018
036300             15  ASC-NUMBER-OF-ITEMS-SKIPPED         PIC S9(09)   03630018
036400                                                          COMP-3. 03640018
036500             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03650018
036600                                                          COMP-3. 03660018
036700             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03670018
036800                                                          COMP-3. 03680018
036900             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03690018
037000                                                          COMP-3. 03700018
037100             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03710018
037200                                                          COMP    03720018
037300                                                          SYNC.   03730018
037400             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03740018
037500                 88  ASC-ITEMS-LEFT-IN-FILE          VALUE 'Y'.   03750018
037600                 88  ASC-NO-ITEMS-LEFT-IN-FILE       VALUE 'N'.   03760018
037700             15  ASC-LIST-QUEUE-NAME.                             03770018
037800                 20  ASC-LIST-TERM-ID                PIC  X(04).  03780018
037900                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03790018
038000                                                          COMP-3. 03800018
038100                 20  ASC-LIST-SEQ                    PIC  9(01).  03810018
038200             15  ASC-START-ITEM-REQUEST.                          03820018
038300                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03830018
038400             15  FILLER                              PIC  X(870). 03840022
038500                                                                  03850018
038600*---------------------------------------------------------------* 03860018
038700*    ABEND PROCESSING COPYBOOK.                                 * 03870018
038800*---------------------------------------------------------------* 03880018
038900     COPY DPWS013.                                                03890018
039000                                                                  03900018
039100                                                                  03910018
039200 LINKAGE SECTION.                                                 03920018
039300                                                                  03930018
039400 01  DFHCOMMAREA.                                                 03940018
039500     05  FILLER                         OCCURS  1 TO 4072 TIMES   03950018
039600                                        DEPENDING ON EIBCALEN.    03960018
039700         10  FILLER                     PIC X.                    03970018
039800                                                                  03980018
039900                                                                  03990018
040000 PROCEDURE DIVISION.                                              04000018
040100******************************************************************04010018
040200**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **04020018
040300**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **04030018
040400**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **04040018
040500******************************************************************04050018
040600 0000-MAIN-MODULE.                                                04060018
040700     INITIALIZE DP030-CICS-API-FIELDS.                            04070018
040800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04080018
040900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04090018
041000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04100018
041100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04110018
041200     MOVE LENGTH OF DP057AI        TO DP030-MAP-LENGTH (1).       04120018
041300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04130018
041400     PERFORM 0001-CALL-CICS-ARCH-API.                             04140018
041500                                                                  04150018
041600     PERFORM 1000-CONTROL-PROCESSING.                             04160018
041700                                                                  04170018
041800     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04180018
041900     PERFORM 0001-CALL-CICS-ARCH-API.                             04190018
042000                                                                  04200018
042100                                                                  04210018
042200******************************************************************04220018
042300**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **04230018
042400**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **04240018
042500******************************************************************04250018
042600 0001-CALL-CICS-ARCH-API.                                         04260018
042700     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04270027
042800                                    DFHCOMMAREA                   04280027
042900                                    DP030-CICS-API-FIELDS         04290027
043000                                    DP020-STANDARD-COMMAREA       04300027
043100                                    DP057AI.                      04310027
043200                                                                  04320018
043300     IF  DP030-RC-CALL-SUCCESSFUL                                 04330018
043400         CONTINUE                                                 04340018
043500     ELSE                                                         04350018
043600         SET DP013-NO-ROLLBACK                                    04360018
043700             DP013-XCTL-DISPLAY-RESTART                           04370018
043800             DP013-CICS-ABEND      TO TRUE                        04380018
043900         MOVE '0001-CALL-CICS-ARCH-API'                           04390018
044000                                   TO DP013-PARAGRAPH             04400018
044100         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04410028
044200-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04420028
044300         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04430018
044400         PERFORM DP013-0000-PROCESS-ABEND                         04440018
044500     END-IF.                                                      04450018
044600                                                                  04460018
044700                                                                  04470018
044800*----------------------------------------------------------------*04480018
044900* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04490018
045000* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04500018
045100*                                                                *04510018
045200* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04520018
045300*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04530018
045400*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04540018
045500*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04550018
045600*----------------------------------------------------------------*04560018
045700 1000-CONTROL-PROCESSING.                                         04570018
045800                                                                  04580018
045900     EVALUATE TRUE                                                04590018
046000         WHEN DP020-NEXT-ACT-INITIAL                              04600018
046100*            *****************************************************04610018
046200*            * NEXT ACT: INITIAL                                 *04620018
046300*            *****************************************************04630018
046400             INITIALIZE ASC-SPECIFIC-COMMAREA                     04640018
046500             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            04650018
046600             MOVE DP020-SRC-TASK-NUMBER                           04660018
046700                                   TO ASC-LIST-TASK-NUMBER        04670018
046800             MOVE PC-LIST-QUEUE-SEQ                               04680018
046900                                   TO ASC-LIST-SEQ                04690018
047000             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04700018
047100***-----$TEMPLATE NOTE$-------------------------------------------04710018
047200*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,04720018
047300*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  04730018
047400*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.04740018
047500***---------------------------------------------------------------04750018
047600             IF  PS-COMMAREA-NOT-VALID                            04760018
047700***              MOVE PC-TSYMSG-99901                             04770018
047800***                                TO DP020-MSG-NUMBER            04780018
047900***              SET DP020-MSG-FATAL                              04790018
048000***                                TO TRUE                        04800018
048100                 SET DP020-NEXT-ACT-APPL-ERROR                    04810018
048200                                   TO TRUE                        04820018
048300             ELSE                                                 04830018
048400                 PERFORM 4000-BUILD-INITIAL-PANEL                 04840018
048500             END-IF                                               04850018
048600                                                                  04860018
048700         WHEN DP020-NEXT-ACT-READ-MAP                             04870018
048800*            *****************************************************04880018
048900*            * NEXT ACT: READ MAP                                *04890018
049000*            *****************************************************04900018
049100             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04910018
049200                                   TO PV-TOP-ITEM                 04920018
049300             PERFORM 2000-PROCESS-PANEL                           04930018
049400                                                                  04940018
049500         WHEN DP020-NEXT-ACT-RETURN                               04950018
049600*            *****************************************************04960018
049700*            * NEXT ACT: RETURN FROM MAINTENANCE PROGRAM         *04970018
049800*            *****************************************************04980018
049900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04990018
050000                                   TO PV-TOP-ITEM                 05000018
050100             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05010018
050200             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05020018
050300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05030018
050400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05040018
050500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05050018
050600                                                                  05060018
050700         WHEN OTHER                                               05070018
050800*            *****************************************************05080018
050900*            * NEXT ACT: OTHER (UNDEFINED)                       *05090018
051000*            *****************************************************05100018
051100             SET DP013-LOGIC-ABEND TO TRUE                        05110018
051200             SET DP013-NO-ROLLBACK TO TRUE                        05120018
051300             MOVE '1000-CONTROL-PROCESSING'                       05130018
051400                                   TO DP013-PARAGRAPH             05140018
051500             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05150018
051600                                   TO DP013-MESSAGE-TEXT(1)       05160018
051700             PERFORM DP013-0000-PROCESS-ABEND                     05170018
051800     END-EVALUATE.                                                05180018
051900                                                                  05190018
052000                                                                  05200018
052100*----------------------------------------------------------------*05210018
052200* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05220018
052300* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05230018
052400*----------------------------------------------------------------*05240018
052500 1100-PROCESS-INTER-APPL-COMM.                                    05250018
052600                                                                  05260018
052700     SET PS-COMMAREA-VALID         TO TRUE.                       05270018
052800     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05280018
052900     MOVE DP062-SEL-MNEMONIC       TO ASC-KEY-MATCHING-MNEMONIC   05290018
053000                                      DK-VSAM-MATCHING-MNEMONIC.  05300018
053100                                                                  05310018
053200                                                                  05320018
053300*----------------------------------------------------------------*05330018
053400* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05340018
053500* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05350018
053600* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05360018
053700* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05370018
053800* FUNCTION KEYS CAN GET THIS FAR.                                *05380018
053900*----------------------------------------------------------------*05390018
054000 2000-PROCESS-PANEL.                                              05400018
054100     EVALUATE TRUE                                                05410018
054200         WHEN DP020-SRC-AID = DP016-CLEAR                         05420018
054300*            *****************************************************05430018
054400*            * PFKEY ACTION: CLEAR                         <ESC> *05440018
054500*            *   <CLEAR> ("ESC" KEY)                             *05450018
054600*            *                                                   *05460018
054700*            * PRESENT SCREEN AS IT WAS AT THE TIME OF THE LAST  *05470018
054800*            * <ENTER>, INCLUDING ANY ERROR MESSAGES.            *05480018
054900*            *****************************************************05490018
055000             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05500018
055100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05510018
055200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05520018
055300                                                                  05530018
055400         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05540018
055500*            *****************************************************05550018
055600*            * PFKEY ACTION: REFRESH                             *05560018
055700*            *                                                   *05570018
055800*            * PRESENT SCREEN AS FOLLOWS:                        *05580018
055900*            * - BRING BACK WHAT WAS LAST SAVED.                 *05590018
056000*            * - SHOW SCREEN AS ORIGINALLY PRESENTED (BLANK OR   *05600018
056100*            *   WITH DATA FROM DATABASE).                       *05610018
056200*            *****************************************************05620018
056300             MOVE DP062-SEL-MNEMONIC TO ASC-KEY-MATCHING-MNEMONIC 05630018
056400                                        DK-VSAM-MATCHING-MNEMONIC 05640018
056500             PERFORM 2050-DELETE-LIST-QUEUE                       05650018
056600             PERFORM 4000-BUILD-INITIAL-PANEL                     05660018
056700                                                                  05670018
056800         WHEN OTHER                                               05680018
056900*            *****************************************************05690018
057000*            * PFKEY ACTION: OTHER (APPLICATION SPECIFIC)        *05700018
057100*            *****************************************************05710018
057200             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05720018
057300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05730018
057400             IF  PS-NO-ERROR                                      05740018
057500                 SET DP030-CONTINUE-GO                            05750018
057600                                 TO TRUE                          05760018
057700                 PERFORM 2100-CHECK-FUNCTION-KEY                  05770018
057800             ELSE                                                 05780018
057900                 SET DP030-OVERRIDE-GO                            05790018
058000                                 TO TRUE                          05800018
058100             END-IF                                               05810018
058200     END-EVALUATE.                                                05820018
058300                                                                  05830018
058400                                                                  05840018
058500*----------------------------------------------------------------*05850018
058600*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *05860018
058700*----------------------------------------------------------------*05870018
058800 2050-DELETE-LIST-QUEUE.                                          05880018
058900                                                                  05890018
059000     EXEC CICS                                                    05900018
059100         DELETEQ TS                                               05910018
059200             QUEUE (ASC-LIST-QUEUE-NAME)                          05920018
059300             RESP  (PV-CICS-RESP)                                 05930018
059400     END-EXEC.                                                    05940018
059500                                                                  05950018
059600     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       05960018
059700        (PV-CICS-RESP = DFHRESP(QIDERR))                          05970018
059800         CONTINUE                                                 05980018
059900     ELSE                                                         05990018
060000         SET DP013-CICS-ABEND      TO TRUE                        06000018
060100         SET DP013-NO-ROLLBACK     TO TRUE                        06010018
060200                                                                  06020018
060300         MOVE '2050-DELETE-LIST-QUEUE'                            06030018
060400                                   TO DP013-PARAGRAPH             06040018
060500         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06050018
060600                                   TO DP013-MESSAGE-TEXT (1)      06060018
060700         PERFORM DP013-0000-PROCESS-ABEND                         06070018
060800     END-IF.                                                      06080018
060900                                                                  06090018
061000     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06100018
061100                                                                  06110018
061200                                                                  06120018
061300*----------------------------------------------------------------*06130018
061400* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06140018
061500* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06150018
061600* CICS ARCHITECTURE API.                                         *06160018
061700*----------------------------------------------------------------*06170018
061800 2100-CHECK-FUNCTION-KEY.                                         06180018
061900     EVALUATE TRUE                                                06190018
062000                                                                  06200018
062100         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  06210018
062200*            *****************************************************06220018
062300*            * APPLICATION-SPECIFIC PFKEY: FIRST PAGE            *06230018
062400*            *****************************************************06240018
062500             MOVE +1               TO PV-TOP-ITEM                 06250018
062600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06260018
062700                                                                  06270018
062800         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   06280018
062900*            *****************************************************06290018
063000*            * APPLICATION-SPECIFIC PFKEY: PREV PAGE             *06300018
063100*            *****************************************************06310018
063200             PERFORM 2110-BROWSE-BACKWARD                         06320018
063300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06330018
063400                                                                  06340018
063500         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   06350018
063600*            *****************************************************06360018
063700*            * APPLICATION-SPECIFIC PFKEY: NEXT PAGE             *06370018
063800*            *****************************************************06380018
063900             PERFORM 2120-BROWSE-FORWARD                          06390018
064000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06400018
064100                                                                  06410018
064200         WHEN DP020-SRC-AID = DP016-ENTER                         06420018
064300*            *****************************************************06430018
064400*            * APPLICATION-SPECIFIC PFKEY: <ENTER>               *06440018
064500*            *   EDIT DATA AND PRESENT IT ON THE SCREEN          *06450018
064600*            *****************************************************06460018
064700             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   06470018
064800             IF  PS-ERROR                                         06480018
064900                 CONTINUE                                         06490018
065000             ELSE                                                 06500018
065100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06510018
065200             END-IF                                               06520018
065300                                                                  06530018
065400         WHEN OTHER                                               06540018
065500*            *****************************************************06550018
065600*            * APPLICATION-SPECIFIC PFKEY: "OTHER" (UNDEFINED)   *06560018
065700*            *****************************************************06570018
065800             SET DP013-NO-ROLLBACK                                06580018
065900                 DP013-XCTL-DISPLAY-RESTART                       06590018
066000                 DP013-CICS-ABEND  TO TRUE                        06600018
066100             MOVE '2100-CHECK-FUNCTION-KEY'                       06610018
066200                                   TO DP013-PARAGRAPH             06620018
066300             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06630018
066400                                   TO DP013-MESSAGE-TEXT (1)      06640018
066500             MOVE 'OR CODE MISSING FROM THIS PROGRAM TO PROCESS:' 06650018
066600                                   TO DP013-MESSAGE-TEXT (2)      06660018
066700             MOVE DP020-SRC-AID    TO PM-A-SRC-AID                06670018
066800             MOVE DP020-FK-ACTION (DP020-SRC-AID)                 06680018
066900                                   TO PM-A-FK-ACTION              06690018
067000             MOVE DP020-FK-DISPN-IND (DP020-SRC-AID)              06700018
067100                                   TO PM-A-FK-DISPN               06710018
067200             MOVE PM-ABEND-INFO-A  TO DP013-MESSAGE-TEXT (3)      06720018
067300             MOVE 'REVIEW PFKEYS SETUP FOR THIS MNEMONIC.'        06730018
067400                                   TO DP013-MESSAGE-TEXT (4)      06740018
067500             PERFORM DP013-0000-PROCESS-ABEND                     06750018
067600     END-EVALUATE.                                                06760018
067700                                                                  06770018
067800                                                                  06780018
067900*----------------------------------------------------------------*06790018
068000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *06800018
068100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *06810018
068200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *06820018
068300*    MESSAGE.                                                    *06830018
068400*----------------------------------------------------------------*06840018
068500 2110-BROWSE-BACKWARD.                                            06850018
068600     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    06860018
068700         GIVING PV-TOP-ITEM.                                      06870018
068800                                                                  06880018
068900     IF  ((PV-TOP-ITEM < +1)                                      06890018
069000       OR (PV-TOP-ITEM = +1))                                     06900018
069100         MOVE +1                   TO PV-TOP-ITEM                 06910018
069200*        -- TOP OF LIST --                                        06920018
069300         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06930018
069400         SET DP020-MSG-INFORMATIONAL TO TRUE                      06940018
069500     END-IF.                                                      06950018
069600                                                                  06960018
069700                                                                  06970018
069800*----------------------------------------------------------------*06980018
069900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *06990018
070000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07000018
070100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07010018
070200*----------------------------------------------------------------*07020018
070300 2120-BROWSE-FORWARD.                                             07030018
070400                                                                  07040018
070500     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07050018
070600         GIVING PV-TOP-ITEM.                                      07060018
070700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07070018
070800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07080018
070900                                   TO PV-TOP-ITEM                 07090018
071000*        -- BOTTOM OF LIST --                                     07100018
071100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07110018
071200         SET DP020-MSG-INFORMATIONAL                              07120018
071300                                   TO TRUE                        07130018
071400     ELSE                                                         07140018
071500         COMPUTE PV-BOTTOM-ITEM =                                 07150018
071600             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07160018
071700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07170018
071800*            -- BOTTOM OF LIST --                                 07180018
071900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07190018
072000             SET DP020-MSG-INFORMATIONAL                          07200018
072100                                   TO TRUE                        07210018
072200         END-IF                                                   07220018
072300     END-IF.                                                      07230018
072400                                                                  07240018
072500                                                                  07250018
072600*----------------------------------------------------------------*07260018
072700*    "JUMP BROWSE" FEATURE OF THE ARCHITECTURE:                  *07270018
072800*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07280018
072900*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07290018
073000*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07300018
073100*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *07310018
073200*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07320018
073300*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *07330018
073400*----------------------------------------------------------------*07340018
073500 2130-CHECK-FOR-JUMP-BROWSE.                                      07350018
073600     SET PS-NO-ERROR               TO TRUE.                       07360018
073700     IF (ASC-START-ITEM-REQUEST = SPACE)                          07370018
073800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07380018
073900                                   TO PV-TOP-ITEM                 07390018
074000     ELSE                                                         07400018
074100         MOVE ASC-START-ITEM-REQUEST                              07410018
074200                                   TO DP010I-UNEDITED-FIELD       07420018
074300         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       07430018
074400         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     07440018
074500         SET DP010I-NEGATIVE-NOT-ALLOWED                          07450018
074600                                   TO TRUE                        07460018
262023         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07471025
262023              USING DP010I-NUMERIC-EDIT-AREA                      07472025
074800                                                                  07480018
074900         IF  NOT DP010I-ERROR-DETECTED                            07490018
075000             MOVE DP010I-NUMERIC-FIELD                            07500018
075100                                   TO  ASC-START-ITEM-REQUEST-N   07510018
075200             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07520018
075300                 IF  ASC-START-ITEM-REQUEST-N >                   07530018
075400                                          ASC-NUMBER-OF-ITEMS-READ07540018
075500                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07550018
075600                     COMPUTE PV-TOP-ITEM =                        07560018
075700                             ASC-NUMBER-OF-ITEMS-READ             07570018
075800                             - PC-ITEMS-PER-PANEL + 1             07580018
075900                     IF  PV-TOP-ITEM < +1                         07590018
076000                         MOVE +1   TO PV-TOP-ITEM                 07600018
076100                         MOVE PC-TSYMSG-00070                     07610018
076200                                   TO DP020-MSG-NUMBER            07620018
076300                         SET DP020-MSG-INFORMATIONAL              07630018
076400                                   TO TRUE                        07640018
076500                     END-IF                                       07650018
076600                 ELSE                                             07660018
076700                     MOVE ASC-START-ITEM-REQUEST-N                07670018
076800                                   TO PV-TOP-ITEM                 07680018
076900                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      07690018
077000                     COMPUTE PV-BOTTOM-ITEM =                     07700018
077100                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     07710018
077200                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ07720018
077300*                        -- BOTTOM OF LIST --                     07730018
077400                         MOVE PC-TSYMSG-00070                     07740018
077500                                   TO DP020-MSG-NUMBER            07750018
077600                         SET DP020-MSG-INFORMATIONAL              07760018
077700                                   TO TRUE                        07770018
077800                     END-IF                                       07780018
077900                 END-IF                                           07790018
078000             ELSE                                                 07800018
078100*                --- VALUE OUT OF RANGE ----                      07810018
078200                 MOVE PC-TSYMSG-00101                             07820018
078300                                   TO DP020-MSG-NUMBER            07830018
078400                 MOVE -1           TO ASTRTITL                    07840018
078500                 SET DP030-SET-CURSOR-APPL-1                      07850018
078600                                   TO TRUE                        07860018
078700                 MOVE DP015-REVERSE                               07870018
078800                                   TO ASTRTITH                    07880018
078900                 MOVE DP015-RED    TO ASTRTITC                    07890018
079000                 MOVE DP015-UNP-NUM-BRT-MDT                       07900018
079100                                   TO ASTRTITA                    07910018
079200                 SET DP020-MSG-FATAL                              07920018
079300                                   TO TRUE                        07930018
079400                 SET PS-ERROR      TO TRUE                        07940018
079500             END-IF                                               07950018
079600                                                                  07960018
079700         ELSE                                                     07970018
079800             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07980018
079900             MOVE -1               TO ASTRTITL                    07990018
080000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08000018
080100             MOVE DP015-REVERSE    TO ASTRTITH                    08010018
080200             MOVE DP015-RED        TO ASTRTITC                    08020018
080300             MOVE DP015-UNP-NUM-BRT-MDT                           08030018
080400                                   TO ASTRTITA                    08040018
080500             SET DP020-MSG-FATAL   TO TRUE                        08050018
080600             SET PS-ERROR          TO TRUE                        08060018
080700         END-IF                                                   08070018
080800     END-IF.                                                      08080018
080900                                                                  08090018
081000                                                                  08100018
081100******************************************************************08110018
081200** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **08120018
081300** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **08130018
081400**                                                              **08140018
081500** FOR THIS APPLICATION, THE ONLY ENTERABLE FIELD IS THE        **08150018
081600** "JUMP-BROWSE"; THIS IS NOT A SELECTABLE LIST.                **08160018
081700******************************************************************08170018
081800 2200-MOVE-SCREEN-TO-COMMAREA.                                    08180018
081900                                                                  08190018
082000     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             08200018
082100     MOVE +1                       TO PV-SUB.                     08210018
082200                                                                  08220018
082300     PERFORM 3100-SET-SUBSCRIPTS.                                 08230018
082400     IF  ASTRTITL > ZERO                                          08240018
082500         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          08250018
082600     ELSE                                                         08260018
082700         IF  ASTRTITF = DP015-ERASE-EOF                           08270018
082800             INITIALIZE ASC-START-ITEM-REQUEST                    08280018
082900         END-IF                                                   08290018
083000     END-IF.                                                      08300018
083100                                                                  08310018
083200                                                                  08320018
083300*----------------------------------------------------------------*08330018
083400** FOR THIS APPLICATION, THE ONLY ENTERABLE FIELD IS THE        **08340018
083500** "JUMP-BROWSE"; THIS IS NOT A SELECTABLE LIST.                **08350018
083600*----------------------------------------------------------------*08360018
083700 3000-EDIT-DATA-IN-COMMAREA.                                      08370018
083800     SET PS-NO-ERROR               TO TRUE.                       08380018
083900     PERFORM 3200-RESET-ATTRIBUTES.                               08390018
084000     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     08400018
084100**                                                                08410018
084200* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              08420018
084300* EDITTING IS DONE FROM THE BOTTOM UP.                            08430018
084400**                                                                08440018
084500     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       08450018
084600         ASC-ITEMS-DISPLAYED - 1.                                 08460018
084700     PERFORM 3100-SET-SUBSCRIPTS.                                 08470018
084800                                                                  08480018
084900                                                                  08490018
085000*----------------------------------------------------------------*08500018
085100*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *08510018
085200*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*08520018
085300*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *08530018
085400*                                                                *08540018
085500*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *08550018
085600*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *08560018
085700*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *08570018
085800*    US IN THE 2ND BLOCK OF THE ARRAY.                           *08580018
085900*----------------------------------------------------------------*08590018
086000 3100-SET-SUBSCRIPTS.                                             08600018
086100                                                                  08610018
086200     COMPUTE ASC-ITEM-SUB =                                       08620018
086300         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        08630018
086400                                                                  08640018
086500     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         08650018
086600         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            08660018
086700                                                                  08670018
086800         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               08680018
086900     ELSE                                                         08690018
087000         MOVE +1                     TO ASC-BLK-SUB               08700018
087100     END-IF.                                                      08710018
087200                                                                  08720018
087300                                                                  08730018
087400******************************************************************08740018
087500** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **08750018
087600******************************************************************08760018
087700 3200-RESET-ATTRIBUTES.                                           08770018
087800     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   08780018
087900     MOVE DP015-GREEN              TO ASTRTITC.                   08790018
088000     MOVE DP015-UNDERLINE          TO ASTRTITH.                   08800018
088100                                                                  08810018
088200                                                                  08820018
088300******************************************************************08830018
088400** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **08840018
088500** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **08850018
088600** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **08860018
088700** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **08870018
088800**                                                              **08880018
088900** NO SELECTIONS ARE ALLOWED BY THIS PROGRAM.                   **08890018
089000******************************************************************08900018
089100 3300-EDIT-SELECTIONS.                                            08910018
089200                                                                  08920018
089300     SUBTRACT +1                 FROM PV-ITEM-IN-USE.             08930018
089400     SUBTRACT +1                 FROM ASC-ITEM-SUB.               08940018
089500     IF  ASC-ITEM-SUB < 1                                         08950018
089600         SUBTRACT +1             FROM ASC-BLK-SUB                 08960018
089700         MOVE PC-ITEMS-PER-PANEL TO   ASC-ITEM-SUB                08970018
089800     END-IF.                                                      08980018
089900                                                                  08990018
090000                                                                  09000018
090100*----------------------------------------------------------------*09010018
090200*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *09020018
090300*    INITIALIZE ALL COUNTERS AND FLAGS.                          *09030018
090400*    READ THE VSAM FILE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *09040018
090500*    DISPLAY THE PANEL TO USER.                                  *09050018
090600*----------------------------------------------------------------*09060018
090700 4000-BUILD-INITIAL-PANEL.                                        09070018
090800                                                                  09080018
090900     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             09090018
091000                                ASC-BLOCK-ENTRIES (2).            09100018
091100     MOVE +1                 TO ASC-BLK-SUB.                      09110018
091200     SET ASC-ITEMS-LEFT-IN-FILE                                   09120018
091300                             TO TRUE.                             09130018
091400                                                                  09140018
091500     MOVE +0                 TO ASC-ITEM-SUB                      09150018
091600                                ASC-NUMBER-OF-ITEMS-TOTAL         09160018
091700                                ASC-NUMBER-OF-ITEMS-READ          09170018
091800                                ASC-NUMBER-OF-ITEMS-SKIPPED       09180018
091900                                ASC-HIGHEST-BLOCK-WRITTEN         09190018
092000                                ASC-ITEM-AT-TOP-OF-PANEL.         09200018
092100                                                                  09210018
092200     PERFORM 4300-READ-ITEMS-FROM-VSAM.                           09220018
092300                                                                  09230018
092400     MOVE +1                   TO  PV-TOP-ITEM.                   09240018
092500     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          09250018
092600         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    09260018
092700         SET DP020-MSG-FATAL   TO  TRUE                           09270018
092800         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               09280018
092900     ELSE                                                         09290018
093000         MOVE -1               TO ASTRTITL                        09300018
093100         SET DP030-SET-CURSOR-APPL-1                              09310018
093200                               TO TRUE                            09320018
093300         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     09330018
093400     END-IF.                                                      09340018
093500                                                                  09350018
093600                                                                  09360018
093700*----------------------------------------------------------------*09370018
093800* READ THE VSAM "DPCAUDIT" MNEMONIC/MENUITEM AUDIT LOG FILE.     *09380018
093900*   FOR THE MNEMONIC ENTERED ON THE CRITERIA SPEC SCREEN  -OR-   *09390018
094000*   FOR ALL MNEMONICS IF NO CRITERIA WAS ENTERED.                *09400018
094100*----------------------------------------------------------------*09410018
094200*    READ THE ITEMS FROM THE VSAM FILE AND MOVE THEM INTO THE    *09420018
094300*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *09430018
094400*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *09440018
094500*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *09450018
094600*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *09460018
094700*                                                                *09470018
094800*    DUE TO THE SIZE OF THE VSAM, AND THE ORDER IN WHICH THE     *09480018
094900*    RECS ARE SORTED, THE ENTIRE VSAM IS READ INTO THE PROGRAM   *09490018
095000*    UPON INITIALIZATION.                                        *09500018
095100*----------------------------------------------------------------*09510018
095200 4300-READ-ITEMS-FROM-VSAM.                                       09520018
095300                                                                  09530018
095400     PERFORM 4302-STARTBR-VSAM.                                   09540018
095500                                                                  09550018
095600     PERFORM                                                      09560018
095700         VARYING PV-READ-COUNT                                    09570018
095800         FROM 1 BY 1                                              09580018
095900         UNTIL (ASC-NO-ITEMS-LEFT-IN-FILE)                        09590018
096000         OR    (PV-READ-COUNT > PC-MAX-ITEMS)                     09600018
096100                                                                  09610018
096200         PERFORM 4310-READ-VSAM                                   09620018
096300                                                                  09630018
096400         IF  ASC-ITEMS-LEFT-IN-FILE                               09640018
096500             ADD +1      TO ASC-NUMBER-OF-ITEMS-TOTAL             09650018
096600             IF  DP062-ALL-MNEMONICS                              09660018
096700             OR (DP062-SEL-MNEMONIC = DP520-REQUEST)              09670018
096800                 ADD +1  TO ASC-NUMBER-OF-ITEMS-READ              09680018
096900                 PERFORM 4320-SAVE-RECORD-FOR-DISPLAY             09690018
097000             ELSE                                                 09700018
097100                 ADD +1  TO ASC-NUMBER-OF-ITEMS-SKIPPED           09710018
097200             END-IF                                               09720018
097300         END-IF                                                   09730018
097400     END-PERFORM.                                                 09740018
097500                                                                  09750018
097600     PERFORM 4390-ENDBR-VSAM.                                     09760018
097700                                                                  09770018
097800     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          09780018
097900         MOVE +1               TO ASC-BLK-SUB                     09790018
098000         PERFORM 5100-WRITE-TEMP-STORAGE                          09800018
098100         ADD +1                TO ASC-BLK-SUB                     09810018
098200         PERFORM 5100-WRITE-TEMP-STORAGE                          09820018
098300                                                                  09830018
098400         MOVE 1                TO ASC-BLK-SUB                     09840018
098500                                  PV-BLOCK-NUMBER                 09850018
098600         PERFORM 4410-READ-TEMP-STORAGE                           09860018
098700         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             09870018
098800             MOVE 2            TO ASC-BLK-SUB                     09880018
098900                                  PV-BLOCK-NUMBER                 09890018
099000             PERFORM 4410-READ-TEMP-STORAGE                       09900018
099100         END-IF                                                   09910018
099200     END-IF.                                                      09920018
099300                                                                  09930018
099400                                                                  09940018
099500*----------------------------------------------------------------*09950018
099600* SET THE STARTING POSITION FOR BROWSE, IN PREPARATION TO        *09960018
099700* READ THE NEXT RECORD FROM THE VSAM ESDS "DPCAUDIT" FILE -      *09970018
099800* MNEMONIC/MENUITEM AUDIT LOG.                                   *09980018
099900*----------------------------------------------------------------*09990018
100000 4302-STARTBR-VSAM.                                               10000018
100100                                                                  10010018
100200     MOVE PC-DPCAUDIT-RBA-ZERO     TO  PV-DPCAUDIT-RBA.           10020018
100300     EXEC CICS                                                    10030018
100400          STARTBR DATASET(PC-DPCAUDIT-FILE)                       10040018
100500                  RIDFLD (PV-DPCAUDIT-RBA)                        10050018
100600                  RBA                                             10060018
100700                  RESP   (PV-CICS-RESP)                           10070018
100800     END-EXEC.                                                    10080018
100900                                                                  10090018
101000     IF (PV-CICS-RESP = DFHRESP(NORMAL))                          10100018
101100         CONTINUE                                                 10110018
101200     ELSE                                                         10120018
101300         SET DP013-CICS-ABEND      TO TRUE                        10130018
101400         SET DP013-NO-ROLLBACK     TO TRUE                        10140018
101500         MOVE '4302-STARTBR-VSAM'  TO DP013-PARAGRAPH             10150018
101600         MOVE 'ERROR TRYING TO START BROWSE ON DPCAUDIT'          10160018
101700                                   TO DP013-MESSAGE-TEXT (1)      10170018
101800         PERFORM DP013-0000-PROCESS-ABEND                         10180018
101900     END-IF.                                                      10190018
102000                                                                  10200018
102100                                                                  10210018
102200*----------------------------------------------------------------*10220018
102300* READ THE NEXT RECORD FROM THE VSAM ESDS "DPCAUDIT" FILE -      *10230018
102400* MNEMONIC/MENUITEM AUDIT LOG.                                   *10240018
102500*----------------------------------------------------------------*10250018
102600 4310-READ-VSAM.                                                  10260018
102700                                                                  10270018
102800     MOVE PC-DPCAUDIT-MAX-REC-LEN  TO  PV-DPCAUDIT-REC-LEN.       10280018
102900*****MOVE PC-DPCAUDIT-RBA-ZERO     TO  PV-DPCAUDIT-RBA.           10290018
103000                                                                  10300018
103100     EXEC CICS                                                    10310018
103200          READNEXT DATASET(PC-DPCAUDIT-FILE)                      10320018
103300                   INTO   (DP520-DPCAUDIT-RECORD)                 10330018
103400                   LENGTH (PV-DPCAUDIT-REC-LEN)                   10340018
103500                   RIDFLD (PV-DPCAUDIT-RBA)                       10350018
103600                   RBA                                            10360018
103700                   RESP  (PV-CICS-RESP)                           10370018
103800     END-EXEC.                                                    10380018
103900                                                                  10390018
104000     IF (PV-CICS-RESP = DFHRESP(NORMAL))                          10400018
104100         CONTINUE                                                 10410018
104200     ELSE                                                         10420018
104300         SET ASC-NO-ITEMS-LEFT-IN-FILE TO TRUE                    10430018
104400         IF (PV-CICS-RESP = DFHRESP(NOTFND))                      10440018
104500         OR (PV-CICS-RESP = DFHRESP(ENDFILE))                     10450018
104600             CONTINUE                                             10460018
104700         ELSE                                                     10470018
104800             SET DP013-CICS-ABEND      TO TRUE                    10480018
104900             SET DP013-NO-ROLLBACK     TO TRUE                    10490018
105000             MOVE '4310-READ-VSAM '    TO DP013-PARAGRAPH         10500018
105100             MOVE 'ERROR TRYING TO START BROWSE ON DPCAUDIT'      10510018
105200                                       TO DP013-MESSAGE-TEXT (1)  10520018
105300             PERFORM DP013-0000-PROCESS-ABEND                     10530018
105400     END-IF.                                                      10540018
105500                                                                  10550018
105600*----------------------------------------------------------------*10560018
105700* THIS RECORD FROM THE VSAM ESDS AUDIT LOG FILE IS TO BE SAVED   *10570018
105800* FOR DISPLAY, BECAUSE IT MATCHES THE SELECTION CRITERIA:        *10580018
105900* SELECT RECORDS FOR ALL MNEMONICS IF NO CRITERIA WAS ENTERED.   *10590018
106000* OR                                                             *10600018
106100* SELECT RECORDS FOR ONLY MATCHING MNEMONICS, IF A MNEMONIC WAS  *10610018
106200* ENTERED ON THE CRITERIA SPEC SCREEN.                           *10620018
106300*                                                                *10630018
106400* SAVE IN BLOCK 1 OR 2, IN THE NEXT AVAILABLE ITEM.              *10640018
106500*----------------------------------------------------------------*10650018
106600 4320-SAVE-RECORD-FOR-DISPLAY.                                    10660018
106700     IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                        10670018
106800         ADD +1            TO ASC-ITEM-SUB                        10680018
106900     ELSE                                                         10690018
107000         ADD +1            TO ASC-BLK-SUB                         10700018
107100         MOVE +1           TO ASC-ITEM-SUB                        10710018
107200                                                                  10720018
107300         IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 10730018
107400             MOVE +1       TO ASC-BLK-SUB                         10740018
107500             SET ASC-BLOCK-MODIFIED (1)                           10750018
107600                           TO TRUE                                10760018
107700             PERFORM 5100-WRITE-TEMP-STORAGE                      10770018
107800             MOVE ASC-BLOCK-ENTRIES (PC-MAX-BLOCKS-IN-ARRAY)      10780018
107900                           TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)      10790018
108000             ADD +1        TO ASC-BLK-SUB                         10800018
108100             INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)           10810018
108200             SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)              10820018
108300                           TO TRUE                                10830018
108400         END-IF                                                   10840018
108500     END-IF.                                                      10850018
108600                                                                  10860018
108700     MOVE ASC-NUMBER-OF-ITEMS-READ                                10870018
108800                           TO ASC-LIST-ITEM-NUMBER                10880018
108900                                     (ASC-BLK-SUB ASC-ITEM-SUB).  10890018
109000*    *************************************************            10900018
109100*    * MOVE FIELDS FROM VSAM TO COMMAREA             *            10910018
109200*    *************************************************            10920018
109300     MOVE DP520-REQUEST         TO ASC-MNEMONIC                   10930018
109400                                      (ASC-BLK-SUB ASC-ITEM-SUB). 10940018
109500     MOVE DP520-VSAM-REC-TYPE   TO ASC-REC-TYPE                   10950018
109600                                      (ASC-BLK-SUB ASC-ITEM-SUB). 10960018
109700                                                                  10970018
109800     EVALUATE TRUE                                                10980018
109900         WHEN DP520-VSAM-ADD                                      10990018
110000             MOVE PC-ADD        TO ASC-ACTION                     11000018
110100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11010018
110200         WHEN DP520-VSAM-UPDATE                                   11020018
110300             MOVE PC-UPD        TO ASC-ACTION                     11030018
110400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11040018
110500         WHEN DP520-VSAM-REPLACE                                  11050018
110600             MOVE PC-REP        TO ASC-ACTION                     11060018
110700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11070018
110800         WHEN DP520-VSAM-DELETE                                   11080018
110900             MOVE PC-DEL        TO ASC-ACTION                     11090018
111000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11100018
111100         WHEN OTHER                                               11110018
111200             MOVE DP520-VSAM-ACTION                               11120018
111300                                TO PV-UNKNOWN                     11130019
111400             MOVE PV-UNKNOWN    TO ASC-ACTION                     11140019
111500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11150018
111600     END-EVALUATE.                                                11160018
111700                                                                  11170018
111800     MOVE DP520-REQUESTOR       TO ASC-REQUESTOR                  11180018
111900                                      (ASC-BLK-SUB ASC-ITEM-SUB). 11190018
112000     MOVE DP520-CURRENT-TMESTP  TO PV-TIMESTAMP-26CHAR.           11200018
112100     MOVE PV-TIMESTAMP-19CHAR   TO ASC-ACTION-TMSTP               11210018
112200                                      (ASC-BLK-SUB ASC-ITEM-SUB). 11220018
112300     MOVE DP520-MNEMONIC-PRIOR-TMESTP                             11230018
112400                                TO PV-TIMESTAMP-26CHAR.           11240018
112500     MOVE PV-TIMESTAMP-19CHAR   TO ASC-PREVIOUS-TMSTP             11250018
112600                                      (ASC-BLK-SUB ASC-ITEM-SUB). 11260018
112700                                                                  11270018
112800                                                                  11280018
112900*----------------------------------------------------------------*11290018
113000* END BROWSE AFTER ALL "READNEXT" ON VSAM ESDS "DPCAUDIT" FILE - *11300018
113100* MNEMONIC/MENUITEM AUDIT LOG.                                   *11310018
113200*----------------------------------------------------------------*11320018
113300 4390-ENDBR-VSAM.                                                 11330018
113400                                                                  11340018
113500     EXEC CICS                                                    11350018
113600          ENDBR DATASET(PC-DPCAUDIT-FILE)                         11360018
113700          RESP  (PV-CICS-RESP)                                    11370018
113800     END-EXEC.                                                    11380018
113900                                                                  11390018
114000     IF (PV-CICS-RESP = DFHRESP(NORMAL))                          11400018
114100         CONTINUE                                                 11410018
114200     ELSE                                                         11420018
114300         SET DP013-CICS-ABEND      TO TRUE                        11430018
114400         SET DP013-NO-ROLLBACK     TO TRUE                        11440018
114500         MOVE '4390-ENDBR-VSAM'    TO DP013-PARAGRAPH             11450018
114600         MOVE 'ERROR TRYING TO END BROWSE ON DPCAUDIT'            11460018
114700                                   TO DP013-MESSAGE-TEXT (1)      11470018
114800         PERFORM DP013-0000-PROCESS-ABEND                         11480018
114900     END-IF.                                                      11490018
115000                                                                  11500018
115100                                                                  11510018
115200*----------------------------------------------------------------*11520018
115300* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *11530018
115400*----------------------------------------------------------------*11540018
115500 4400-MOVE-COMMAREA-TO-SCREEN.                                    11550018
115600     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             11560018
115700         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          11570018
115800         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          11580018
115900             MOVE +1    TO ASC-BLK-SUB                            11590018
116000             PERFORM 5100-WRITE-TEMP-STORAGE                      11600018
116100             ADD +1     TO ASC-BLK-SUB                            11610018
116200             PERFORM 5100-WRITE-TEMP-STORAGE                      11620018
116300             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             11630018
116400                 GIVING PV-BLOCK-NUMBER                           11640018
116500                 REMAINDER PV-REMAINDER                           11650018
116600             IF  PV-REMAINDER > ZERO                              11660018
116700                 ADD +1 TO PV-BLOCK-NUMBER                        11670018
116800             END-IF                                               11680018
116900             MOVE +1    TO ASC-BLK-SUB                            11690018
117000             PERFORM 4410-READ-TEMP-STORAGE                       11700018
117100             ADD +1     TO ASC-BLK-SUB                            11710018
117200                           PV-BLOCK-NUMBER                        11720018
117300             PERFORM 4410-READ-TEMP-STORAGE                       11730018
117400     END-IF.                                                      11740018
117500     MOVE +1            TO ASC-BLK-SUB.                           11750018
117600     COMPUTE ASC-ITEM-SUB =                                       11760018
117700         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              11770018
117800         + PC-ITEMS-PER-PANEL).                                   11780018
117900                                                                  11790018
118000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        11800018
118100         ADD +1         TO ASC-BLK-SUB                            11810018
118200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            11820018
118300     END-IF.                                                      11830018
118400                                                                  11840018
118500     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           11850018
118600         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                11860018
118700     PERFORM 4420-FORMAT-LIST-LINES                               11870018
118800         VARYING PV-SUB                                           11880018
118900         FROM PC-ITEMS-PER-PANEL BY -1                            11890018
119000         UNTIL PV-SUB < +1.                                       11900018
119100                                                                  11910018
119200     COMPUTE ASC-ITEMS-DISPLAYED =                                11920018
119300         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          11930018
119400     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    11940018
119500                                      ASTRTITO.                   11950018
119600     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    11960018
119700     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    11970018
119800                                                                  11980018
119900     IF  DP020-MSG-NUMBER-X = SPACE                               11990018
120000         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  12000018
120100*            --- MORE ITEMS TO DISPLAY ----                       12010018
120200             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            12020018
120300             SET DP020-MSG-INFORMATIONAL TO TRUE                  12030018
120400         END-IF                                                   12040018
120500     END-IF.                                                      12050018
120600                                                                  12060018
120700                                                                  12070018
120800*----------------------------------------------------------------*12080018
120900*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *12090018
121000*----------------------------------------------------------------*12100018
121100 4410-READ-TEMP-STORAGE.                                          12110018
121200                                                                  12120018
121300     MOVE LENGTH OF ASC-BLOCK-ENTRIES(ASC-BLK-SUB)                12130018
121400                                             TO PV-LQW-LENGTH.    12140018
121500                                                                  12150018
121600     EXEC CICS                                                    12160018
121700         READQ TS                                                 12170018
121800             QUEUE (ASC-LIST-QUEUE-NAME)                          12180018
121900             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               12190018
122000             ITEM  (PV-BLOCK-NUMBER)                              12200018
122100             LENGTH(PV-LQW-LENGTH)                                12210018
122200             RESP  (PV-CICS-RESP)                                 12220018
122300     END-EXEC.                                                    12230018
122400                                                                  12240018
122500     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       12250018
122600       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     12260018
122700         CONTINUE                                                 12270018
122800     ELSE                                                         12280018
122900         SET DP013-CICS-ABEND     TO TRUE                         12290018
123000         SET DP013-NO-ROLLBACK    TO TRUE                         12300018
123100         MOVE '4410-READ-TEMP-STORAGE'                            12310018
123200                                  TO DP013-PARAGRAPH              12320018
123300         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      12330018
123400                                  TO DP013-MESSAGE-TEXT(1)        12340018
123500         MOVE ASC-LIST-TERM-ID    TO PM-LQW-TERM-ID               12350018
123600         MOVE ASC-LIST-TASK-NUMBER                                12360018
123700                                  TO PM-LQW-TASK                  12370018
123800         MOVE ASC-LIST-SEQ        TO PM-LQW-SEQ                   12380018
123900         MOVE PC-PM-LQW-DESC-BLOCK                                12390018
124000                                  TO PM-LQW-DESC                  12400018
124100         MOVE PV-BLOCK-NUMBER     TO PM-LQW-ITEM-OR-BLOCK         12410018
124200         MOVE PV-LQW-LENGTH       TO PM-LQW-LENGTH                12420018
124300         MOVE PM-LQW-ABEND-MSG    TO DP013-MESSAGE-TEXT(2)        12430018
124400         PERFORM DP013-0000-PROCESS-ABEND                         12440018
124500     END-IF.                                                      12450018
124600                                                                  12460018
124700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             12470018
124800                                                                  12480018
124900     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         12490018
125000         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               12500018
125100     END-IF.                                                      12510018
125200                                                                  12520018
125300                                                                  12530018
125400*----------------------------------------------------------------*12540018
125500*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *12550018
125600*----------------------------------------------------------------*12560018
125700 4420-FORMAT-LIST-LINES.                                          12570018
125800     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      12580018
125900         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                12590018
126000         MOVE SPACE              TO MR-MNEMONIC       (PV-SUB)    12600018
126100                                    MR-REC-TYPE       (PV-SUB)    12610018
126200                                    MR-ACTION         (PV-SUB)    12620018
126300                                    MR-REQUESTOR      (PV-SUB)    12630018
126400                                    MR-ACTION-TMSTP   (PV-SUB)    12640018
126500                                    MR-PREVIOUS-TMSTP (PV-SUB)    12650018
126600     ELSE                                                         12660018
126700         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           12670018
126800             MOVE ASC-MNEMONIC      (ASC-BLK-SUB ASC-ITEM-SUB)    12680018
126900                                 TO MR-MNEMONIC       (PV-SUB)    12690018
127000             MOVE ASC-REC-TYPE      (ASC-BLK-SUB ASC-ITEM-SUB)    12700018
127100                                 TO MR-REC-TYPE       (PV-SUB)    12710018
127200             MOVE ASC-ACTION        (ASC-BLK-SUB ASC-ITEM-SUB)    12720018
127300                                 TO MR-ACTION         (PV-SUB)    12730018
127400             MOVE ASC-REQUESTOR     (ASC-BLK-SUB ASC-ITEM-SUB)    12740018
127500                                 TO MR-REQUESTOR      (PV-SUB)    12750018
127600             MOVE ASC-ACTION-TMSTP  (ASC-BLK-SUB ASC-ITEM-SUB)    12760018
127700                                 TO MR-ACTION-TMSTP   (PV-SUB)    12770018
127800             MOVE ASC-PREVIOUS-TMSTP                              12780018
127900                                    (ASC-BLK-SUB ASC-ITEM-SUB)    12790018
128000                                 TO MR-PREVIOUS-TMSTP (PV-SUB)    12800018
128100         END-IF                                                   12810018
128200     END-IF.                                                      12820018
128300     SUBTRACT +1 FROM ASC-ITEM-SUB                                12830018
128400     IF  ASC-ITEM-SUB < + 1                                       12840018
128500         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  12850018
128600         MOVE +1                 TO ASC-BLK-SUB                   12860018
128700     END-IF.                                                      12870018
128800                                                                  12880018
128900                                                                  12890018
129000*----------------------------------------------------------------*12900018
129100*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *12910018
129200*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *12920018
129300*----------------------------------------------------------------*12930018
129400 5100-WRITE-TEMP-STORAGE.                                         12940018
129500     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     12950018
129600                                   TO PV-LIST-ITEM-NUMBER.        12960018
129700     COMPUTE PV-BLOCK-NUMBER =                                    12970018
129800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    12980018
129900                                                                  12990018
130000     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             13000018
130100     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             13010018
130200         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      13020018
130300             PERFORM 5105-REWRITE-ASC-LISTQ                       13030018
130400         END-IF                                                   13040018
130500     ELSE                                                         13050018
130600         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       13060018
130700         ASC-HIGHEST-BLOCK-WRITTEN + 1                            13070018
130800         PERFORM 5110-WRITE-ASC-LISTQ                             13080018
130900         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   13090018
131000     END-IF.                                                      13100018
131100                                                                  13110018
131200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             13120018
131300                                                                  13130018
131400                                                                  13140018
131500******************************************************************13150018
131600** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **13160018
131700** SPECIFIC COMMAREA.                                           **13170018
131800******************************************************************13180018
131900 5105-REWRITE-ASC-LISTQ.                                          13190018
132000     EXEC CICS                                                    13200018
132100         WRITEQ TS                                                13210018
132200             QUEUE (ASC-LIST-QUEUE-NAME)                          13220018
132300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               13230018
132400             ITEM  (PV-BLOCK-NUMBER)                              13240018
132500             REWRITE                                              13250018
132600             RESP  (PV-CICS-RESP)                                 13260018
132700     END-EXEC.                                                    13270018
132800                                                                  13280018
132900     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           13290018
133000         CONTINUE                                                 13300018
133100     ELSE                                                         13310018
133200         SET DP013-CICS-ABEND            TO TRUE                  13320018
133300         SET DP013-NO-ROLLBACK           TO TRUE                  13330018
133400         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       13340018
133500         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     13350018
133600                                         TO DP013-MESSAGE-TEXT(1) 13360018
133700         PERFORM DP013-0000-PROCESS-ABEND                         13370018
133800     END-IF.                                                      13380018
133900                                                                  13390018
134000                                                                  13400018
134100******************************************************************13410018
134200** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **13420018
134300** SPECIFIC COMMAREA.                                           **13430018
134400******************************************************************13440018
134500 5110-WRITE-ASC-LISTQ.                                            13450018
134600     EXEC CICS                                                    13460018
134700         WRITEQ TS                                                13470018
134800             QUEUE (ASC-LIST-QUEUE-NAME)                          13480018
134900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               13490018
135000             ITEM  (PV-BLOCK-NUMBER)                              13500018
135100             RESP  (PV-CICS-RESP)                                 13510018
135200     END-EXEC.                                                    13520018
135300     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      13530018
135400         SET DP013-CICS-ABEND      TO TRUE                        13540018
135500         SET DP013-NO-ROLLBACK     TO TRUE                        13550018
135600         MOVE '5110-WRITE-ASC-LISTQ'                              13560018
135700                                   TO DP013-PARAGRAPH             13570018
135800         MOVE 'ATTEMPTING TO WRITE TEMP STORAGE QUEUE'            13580018
135900                                   TO DP013-MESSAGE-TEXT(1)       13590018
136000         PERFORM DP013-0000-PROCESS-ABEND                         13600018
136100     END-IF.                                                      13610018
136200                                                                  13620018
136300                                                                  13630018
136400******************************************************************13640018
136500** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **13650018
136600** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY AND    **13660018
136700** DISPLAY THE PANEL TO THE USER.                               **13670018
136800**                                                              **13680018
136900** BECAUSE THIS PROGRAM'S SCROLLABLE LIST                       **13690018
137000**   - ALLOWS NO SELECTIONS                                     **13700018
137100**   - ALLOWS NO NAVIGATION TO OTHER FUNCTIONS                  **13710018
137200** THIS PROGRAM DOES NOT USE THE TEMP SEL-QUEUE UTILIZED BY     **13720018
137300** "LIST" PROGRAMS.  THEREFORE THIS "REFRESH" EXECUTES THE CODE **13730018
137400** THAT WAS USED TO BUILD THE INITIAL PANEL.                    **13740018
137500******************************************************************13750018
137600 6000-REFRESH-PANEL-FROM-TEMP.                                    13760018
137700     PERFORM 4000-BUILD-INITIAL-PANEL.                            13770018
137800                                                                  13780018
137900                                                                  13790018
138000*----------------------------------------------------------------*13800018
138100*    ABEND PROCESSOR MODULE                                      *13810018
138200*----------------------------------------------------------------*13820018
138300     COPY DPPD013.                                                13830018
