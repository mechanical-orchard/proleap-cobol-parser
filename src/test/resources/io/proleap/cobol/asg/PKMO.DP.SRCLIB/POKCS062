000100                                                                  00010014
000200 IDENTIFICATION DIVISION.                                         00020014
000300 PROGRAM-ID.    POKCS062.                                         00030014
000400 AUTHOR.        NATALIYA PALATNIK                                 00040014
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050014
000600 DATE-WRITTEN.  02-26-94.                                         00060014
000700 DATE-COMPILED.                                                   00070014
000800                                                                  00080014
000900*---------------------------------------------------------------* 00090014
001000*    W062 - PO STORE / DC SUMMARY SCREEN.                       * 00100014
001100*                                                               * 00110014
001200*                                                               * 00120014
001300*---------------------------------------------------------------* 00130014
001400*     10-15-99   CHIRS KUNSTMANN    TKMA318     WR 20302        * 00140014
001500*  ADDED LOGIC TO HANDLE TRI-STATE DC TABLE.                    * 00150014
001600*                                                               * 00160014
001700*---------------------------------------------------------------* 00170014
001701*CHANGE  LOG                                                    * 00170119
C98147* DATE  20/11/2014                                              * 00170220
C98147*       CHANGE MADE: PO EXTENDED DIGIT CHANGES.                 * 00170320
C98147*       EXTENDED PO# FROM 7 TO 8 IN MAP POKM062.                * 00170420
C98147*      MADE BY: COGNIZANT              WR/IR: CHG0098147        * 00170520
C98147* DATE  03/2021                                                 * 00170622
C98147*       CHANGE MADE: REMOVED TABLE TSTVNDC                      * 00170722
C98147*      MADE BY: JEAN KURK                                       * 00170922
C98147*---------------------------------------------------------------* 00175020
076319* DATE  10/27/2021                                                00176024
076320*            - CHANGE CALL OF 'DPKUT100' TO                     * 00177024
076321*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00178024
076322*              MAKING THE CALL DYNAMIC VS STATIC                * 00179024
076323*     MADE BY: GERMAN BANDA            WR/IR #: CHG0263126        00179125
076312*                                                               * 00179224
076318*---------------------------------------------------------------* 00179324
CICS  *  CHANGED 11/14/2022    BY BARB SCHULTZ    WR: CHG0278485      * 00179429
CICS  *                                                               * 00179526
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00179626
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00179726
CICS  *---------------------------------------------------------------* 00180026
001800                                                                  00181026
001900/                                                                 00190014
002000 ENVIRONMENT DIVISION.                                            00200014
002100                                                                  00210014
002200 DATA DIVISION.                                                   00220014
002300                                                                  00230014
002400 WORKING-STORAGE SECTION.                                         00240014
002500                                                                  00250014
002600 01  DK-DB2-KEYS.                                                 00260014
002700     05  DK-PO-NBR                 PIC S9(9) COMP VALUE +0.       00270014
002800     05  DK-IMPRT-AGNT-PO-NBR-BEG  PIC S9(9) COMP VALUE +0.       00280014
002900     05  DK-IMPRT-AGNT-PO-NBR-END  PIC S9(9) COMP VALUE +0.       00290014
003000     05  DK-DEPT-NBR               PIC X(3)  VALUE SPACES.        00300014
003100     05  DK-CL-NBR-BEG             PIC X(2)  VALUE SPACES.        00310014
003200     05  DK-CL-NBR-END             PIC X(2)  VALUE SPACES.        00320014
003300     05  DK-SKU-SEQ-NBR-BEG        PIC X(3)  VALUE SPACES.        00330014
003400     05  DK-SKU-SEQ-NBR-END        PIC X(3)  VALUE SPACES.        00340014
003500     05  DK-STATUS-CDE-BEG         PIC X(2)  VALUE SPACES.        00350014
003600     05  DK-STATUS-CDE-END         PIC X(2)  VALUE SPACES.        00360014
003700     05  DK-STATUS-CLS-BEG         PIC X(3)  VALUE SPACES.        00370014
003800     05  DK-STATUS-CLS-END         PIC X(3)  VALUE SPACES.        00380014
003900     05  DK-PO-TYP-CDE-BEG         PIC X(2)  VALUE SPACES.        00390014
004000     05  DK-PO-TYP-CDE-END         PIC X(2)  VALUE SPACES.        00400014
004100     05  DK-STR-NBR                PIC S9(04) COMP VALUE +0.      00410014
004200     05  DK-EDI-IND-BEG            PIC X(1)  VALUE SPACES.        00420014
004300     05  DK-EDI-IND-END            PIC X(1)  VALUE SPACES.        00430014
004400     05  DK-AD-EVNT-DTE-BEG        PIC X(10) VALUE SPACES.        00440014
004500     05  DK-AD-EVNT-DTE-END        PIC X(10) VALUE SPACES.        00450014
004600     05  DK-OTB-PER-NBR-BEG        PIC X(04) VALUE SPACES.        00460014
004700     05  DK-OTB-PER-NBR-END        PIC X(04) VALUE SPACES.        00470014
004800     05  DK-DONT-SHIP-BEF-DTE-B    PIC X(10) VALUE SPACES.        00480014
004900     05  DK-DONT-SHIP-BEF-DTE-E    PIC X(10) VALUE SPACES.        00490014
005000     05  DK-ENT-NAME-DESC          PIC X(30).                     00500014
005100     05  DK-ENT-NAME-DESC-BYTE REDEFINES DK-ENT-NAME-DESC         00510014
005200                                   PIC X(01)                      00520014
005300                                   OCCURS 30 TIMES.               00530014
005400     05  DK-VEND-STYL-NME          PIC X(20).                     00540014
005500     05  DK-VEND-STYL-NME-BYTE REDEFINES DK-VEND-STYL-NME         00550014
005600                                   PIC X(01)                      00560014
005700                                   OCCURS 20 TIMES.               00570014
005800     05  DK-AGRMT-TYP-ID           PIC X(01)  VALUE SPACES.       00580014
005900     05  DK-TYP-CDE                PIC S9(04) VALUE +0            00590014
006000                                              COMP.               00600014
006100                                                                  00610014
006200 01  PC-PROGRAM-CONSTANTS.                                        00620014
006300     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00630014
006400                                                    'PO062A  '.   00640014
006500     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00650014
006600                                                    'POKM062 '.   00660014
006700     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00670014
006800                                                    'POKCS062'.   00680014
006900     05  PC-APPL-MAP                    PIC S9(04)  VALUE  +1     00690014
007000                                                    COMP.         00700014
007100     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00710014
007200     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00720014
007300     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00730014
007400     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +13     00740014
007500                                                    COMP SYNC.    00750014
007600     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00760014
007700                                                    COMP SYNC.    00770014
007800     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00780014
007900                                                    +1000000      00790014
008000                                                    COMP-3.       00800014
008100     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00810014
008200                                                    COMP SYNC.    00820014
008300     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      00830014
008400                                                    COMP-3.       00840014
008500     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00850014
008600     05  PC-0                       PIC S9(09)  COMP VALUE ZERO.  00860014
008700     05  PC-PO-REV-FMT                  PIC  X(01)  VALUE '1'.    00870014
008800                                                                  00880014
008900     05  PC-TSYMSG-NUMBERS.                                       00890014
009000         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00900014
009100         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00910014
009200         10  PC-TSYMSG-00017            PIC  9(05)  VALUE 00017.  00920014
009300         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  00930014
009400         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00940014
009500         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00950014
009600         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00960014
009700         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00970014
009800         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00980014
009900         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00990014
010000         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01000014
010100         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01010014
010200         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01020014
010300         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01030014
010400         10  PC-TSYMSG-00168            PIC  9(05)  VALUE 00168.  01040014
010500         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01050014
010600         10  PC-TSYMSG-00310            PIC  9(05)  VALUE 00310.  01060014
010700         10  PC-TSYMSG-00330            PIC  9(05)  VALUE 00330.  01070014
010800         10  PC-TSYMSG-00486            PIC  9(05)  VALUE 00486.  01080014
010900         10  PC-TSYMSG-00587            PIC  9(05)  VALUE 00587.  01090014
011000         10  PC-TSYMSG-00588            PIC  9(05)  VALUE 00588.  01100014
011100         10  PC-TSYMSG-00620            PIC  9(05)  VALUE 00620.  01110014
011200         10  PC-TSYMSG-00621            PIC  9(05)  VALUE 00621.  01120014
011300                                                                  01130014
011400 01  PS-PROGRAM-SWITCHES.                                         01140014
011500     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01150014
011600         88  PS-NO-ERROR                            VALUE 'Y'.    01160014
011700         88  PS-ERROR                               VALUE 'N'.    01170014
011800     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01180014
011900         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01190014
012000         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01200014
012100     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01210014
012200         88  PS-DONE                                VALUE 'Y'.    01220014
012300         88  PS-NOT-DONE                            VALUE 'N'.    01230014
012400     05  PS-SKIP-SW                     PIC  X(01)  VALUE 'N'.    01240014
012500         88  PS-DONT-SKIP                           VALUE 'N'.    01250014
012600         88  PS-SKIP                                VALUE 'Y'.    01260014
012700                                                                  01270014
012800 01  PV-PROGRAM-VARIABLES.                                        01280014
012900     05  PV-NULL                        PIC S9(04)  VALUE +0      01290014
013000                                                    COMP SYNC.    01300014
013100     05  PV-SUB                         PIC S9(04)  VALUE +0      01310014
013200                                                    COMP SYNC.    01320014
013300     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01330014
013400                                                    COMP SYNC.    01340014
013500     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01350014
013600                                                    COMP-3.       01360014
013700     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01370014
013800                                                    COMP-3.       01380014
013900     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01390014
014000                                                    COMP-3.       01400014
014100     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01410014
014200                                                    COMP-3.       01420014
014300     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01430014
014400                                                    COMP-3.       01440014
014500     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01450014
014600                                                    COMP-3.       01460014
014700     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01470014
014800                                                    COMP-3.       01480014
014900     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01490014
015000                                                    COMP SYNC.    01500014
015100     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01510014
015200                                                    COMP SYNC.    01520014
015300     05  PV-ITEM                        PIC S9(04)  VALUE +0      01530014
015400                                                    COMP SYNC.    01540014
015500     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01550014
015600                                                    COMP SYNC.    01560014
015700     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01570014
015800                                                    COMP SYNC.    01580014
015900     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01590014
016000                                                    COMP SYNC.    01600014
016100     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01610014
016200                                                    COMP SYNC.    01620014
016300     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01630014
016400                                                    COMP SYNC.    01640014
016500     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01650014
016600                                                    COMP SYNC.    01660014
016700     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01670014
016800                                                    COMP SYNC.    01680014
016900     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01690014
017000                                                    COMP SYNC.    01700014
017100     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01710014
017200                                                    COMP SYNC.    01720014
017300     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01730014
017400                                                    COMP SYNC.    01740014
017500     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01750014
017600                                                    COMP SYNC.    01760014
017700     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01770014
017800                                                    COMP SYNC.    01780014
017900     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      01790014
018000                                                    COMP-3.       01800014
018100     05  PV-DB2-DATE                    PIC  X(10).               01810014
018200     05  FILLER  REDEFINES PV-DB2-DATE.                           01820014
018300         10  PV-DB2-DATE-CC             PIC  X(02).               01830014
018400         10  PV-DB2-DATE-YY             PIC  X(02).               01840014
018500         10  FILLER                     PIC  X(01).               01850014
018600         10  PV-DB2-DATE-MM             PIC  X(02).               01860014
018700         10  FILLER                     PIC  X(01).               01870014
018800         10  PV-DB2-DATE-DD             PIC  X(02).               01880014
018900     05  PV-DISPLAY-DATE.                                         01890014
019000         10  PV-DISPLAY-DATE-MM         PIC  X(02).               01900014
019100         10  PV-DISPLAY-DATE-DD         PIC  X(02).               01910014
019200         10  PV-DISPLAY-DATE-YY         PIC  X(02).               01920014
019300     05  PV-DONT-SHIP-BEF-DTE           PIC  X(06).               01930014
019400     05  PV-CAN-IFNOT-SHIP-DTE          PIC  X(06).               01940014
019500     05  PV-DB2-START-DATE.                                       01950014
019600         10 PV-DB2-START-CC             PIC 99      VALUE ZERO.   01960014
019700         10 PV-DB2-START-YY             PIC 99      VALUE ZERO.   01970014
019800         10 PV-DB2-START-MM             PIC 99      VALUE ZERO.   01980014
019900         10 PV-DB2-START-DD             PIC 99      VALUE ZERO.   01990014
020000     05  PV-DB2-STOP-DATE.                                        02000014
020100         10 PV-DB2-STOP-CC              PIC 99      VALUE ZERO.   02010014
020200         10 PV-DB2-STOP-YY              PIC 99      VALUE ZERO.   02020014
020300         10 PV-DB2-STOP-MM              PIC 99      VALUE ZERO.   02030014
020400         10 PV-DB2-STOP-DD              PIC 99      VALUE ZERO.   02040014
020500     05  PV-DB2-CURR-DATE.                                        02050014
020600         10 PV-DB2-CURR-CC              PIC 99      VALUE ZERO.   02060014
020700         10 PV-DB2-CURR-YY              PIC 99      VALUE ZERO.   02070014
020800         10 PV-DB2-CURR-MM              PIC 99      VALUE ZERO.   02080014
020900         10 PV-DB2-CURR-DD              PIC 99      VALUE ZERO.   02090014
021000     05  PV-CURRENT-DATE                PIC  X(10).               02100014
021100     05  PV-STR-NBR                     PIC 999     VALUE ZERO.   02110014
021200     05  PV-DC-NAME                     PIC X(5)    VALUE SPACES. 02120014
021300     05  PV-DC-NBR                      PIC S9(4) COMP.           02130014
021400     05  PV-ALLOC-DATE                  PIC  X(10).               02140014
021500                                                                  02150014
021600*---------------------------------------------------------------* 02160014
021700*---------------------------------------------------------------* 02170014
021800*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 02180014
021900*---------------------------------------------------------------* 02190014
022000                                                                  02200014
022100     COPY POWS012.                                                02210014
022200                                                                  02220014
022300/                                                                 02230014
022400*---------------------------------------------------------------* 02240014
022500*    MAP LAYOUT                                                 * 02250014
022600*---------------------------------------------------------------* 02260014
022700                                                                  02270014
022800     COPY POKM062.                                                02280014
022900                                                                  02290014
023000 01  MR-OCCURS-LAYOUT                   REDEFINES  PO062AO.       02300014
C98147     05  FILLER                         PIC X(104).               02310020
023200                                                                  02320014
023300     05  MR-SCROLL-AREA                 OCCURS 13 TIMES.          02330014
023400         10  FILLER                     PIC X(05).                02340014
023500         10  MR-STORE-NBR-X.                                      02350014
023600             15  MR-STORE-NBR           PIC ZZZZ.                 02360014
023700                                                                  02370014
023800         10  FILLER                     PIC X(05).                02380014
023900         10  MR-STORE-NAME              PIC X(40).                02390014
024000                                                                  02400014
024100         10  FILLER                     PIC X(05).                02410014
024200         10  MR-DC                      PIC X(02).                02420014
024300                                                                  02430014
024400         10  FILLER                     PIC X(05).                02440014
024500         10  MR-CURR-ALLOC              PIC Z(09).                02450014
024600                                                                  02460014
024700         10  FILLER                     PIC X(05).                02470014
024800         10  MR-CURR-RCVD               PIC Z(09).                02480014
024900                                                                  02490014
025000                                                                  02500014
025100/                                                                 02510014
025200*---------------------------------------------------------------* 02520014
025300*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02530014
025400*---------------------------------------------------------------* 02540014
025500                                                                  02550014
025600     COPY DPWS015.                                                02560014
025700                                                                  02570014
025800*---------------------------------------------------------------* 02580014
025900*    FUNCTION KEYS COPYBOOK.                                    * 02590014
026000*---------------------------------------------------------------* 02600014
026100                                                                  02610014
026200     COPY DPWS016.                                                02620014
026300                                                                  02630014
026400*---------------------------------------------------------------* 02640014
026500*    NUMERIC EDIT LAYOUT.                                       * 02650014
026600*---------------------------------------------------------------* 02660014
026700                                                                  02670014
026800     COPY DPWS010I.                                               02680014
026900                                                                  02690014
027000/                                                                 02700014
027100*---------------------------------------------------------------* 02710014
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02720027
027300*---------------------------------------------------------------* 02730014
027400                                                                  02740014
027500     COPY DPWS030.                                                02750014
CICS       COPY DPWS930.                                                02751026
027600                                                                  02760014
027700/                                                                 02770014
027800*---------------------------------------------------------------* 02780014
027900*    STANDARD COMMAREA.                                         * 02790014
028000*---------------------------------------------------------------* 02800014
028100                                                                  02810014
028200     COPY DPWS020.                                                02820014
028300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02830014
028400                                                                  02840014
028500*---------------------------------------------------------------* 02850014
028600* INTER-APPLICATION COMMAREA.                                   * 02860014
028700*---------------------------------------------------------------* 02870014
028800                                                                  02880014
028900         10  INTER-APPL-COMM-AREA       PIC X(200).               02890014
029000     COPY POWS011.                                                02900014
029100     COPY POWS013.                                                02910014
029200     COPY POWS017.                                                02920014
029300*---------------------------------------------------------------* 02930014
029400*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02940014
029500*---------------------------------------------------------------* 02950014
029600         10  ASC-SPECIFIC-COMMAREA.                               02960014
029700             15  ASC-CLASS-RANGE-SW       PIC X(01).              02970014
029800                 88  ASC-CLASS-RANGE      VALUE 'Y'.              02980014
029900             15  ASC-LIST-KEYS.                                   02990014
030000                 20  ASC-KEY-PO-NBR       PIC S9(9) COMP.         03000014
030100                 20  ASC-KEY-DEPT-NBR     PIC X(3).               03010014
030200                 20  ASC-KEY-VENDOR-NAME  PIC X(30).              03020014
030300             15  ASC-BLOCK-ENTRIES      OCCURS 2 TIMES.           03030014
030400                 20  ASC-BLOCK-MODIFIED-SW                        03040014
030500                                        PIC X(01).                03050014
030600                     88  ASC-BLOCK-NOT-MODIFIED    VALUE 'N'.     03060014
030700                     88  ASC-BLOCK-MODIFIED        VALUE 'Y'.     03070014
030800                                                                  03080014
030900                 20  ASC-ITEM-ARRAY.                              03090014
031000                     25  ASC-ITEM-ENTRIES OCCURS 13 TIMES.        03100014
031100                         30  ASC-LIST-ITEM-NUMBER                 03110014
031200                                        PIC S9(09) COMP-3.        03120014
031300                         30  ASC-STORE-NBR     PIC S9(04) COMP.   03130014
031400                         30  ASC-STORE-NAME    PIC X(40).         03140014
031500                         30  ASC-DC            PIC X(02).         03150014
031600                         30  ASC-CURR-ALLOC    PIC 9(09).         03160014
031700                         30  ASC-CURR-RCVD     PIC 9(09).         03170014
031800                                                                  03180014
031900             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     03190014
032000             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     03200014
032100             15  ASC-NUMBER-OF-ITEMS-READ                         03210014
032200                                        PIC S9(09) COMP-3.        03220014
032300             15  ASC-NUMBER-OF-SELECTED-ITEMS                     03230014
032400                                        PIC S9(09) COMP-3.        03240014
032500             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        03250014
032600             15  ASC-ITEM-AT-TOP-OF-PANEL                         03260014
032700                                        PIC S9(09) COMP-3.        03270014
032800             15  ASC-ITEM-AT-BOT-OF-PANEL                         03280014
032900                                        PIC S9(09) COMP-3.        03290014
033000             15  ASC-HIGHEST-BLOCK-WRITTEN                        03300014
033100                                        PIC S9(04) COMP SYNC.     03310014
033200             15  ASC-START-OF-SELECTED-RANGE                      03320014
033300                                        PIC S9(09) COMP-3.        03330014
033400             15  ASC-END-OF-SELECTED-RANGE                        03340014
033500                                        PIC S9(09) COMP-3.        03350014
033600             15  ASC-ITEMS-LEFT-INDICATOR                         03360014
033700                                        PIC X(01).                03370014
033800                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     03380014
033900                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     03390014
034000             15  ASC-ITEMS-LEFT-INDICATOR1                        03400014
034100                                        PIC X(01).                03410014
034200                 88  ASC-ITEMS-LEFT-ON-DB-1        VALUE 'Y'.     03420014
034300                 88  ASC-NO-ITEMS-LEFT-ON-DB-1     VALUE 'N'.     03430014
034400             15  ASC-ITEMS-LEFT-INDICATOR2                        03440014
034500                                        PIC X(01).                03450014
034600                 88  ASC-ITEMS-LEFT-ON-DB-2        VALUE 'Y'.     03460014
034700                 88  ASC-NO-ITEMS-LEFT-ON-DB-2     VALUE 'N'.     03470014
034800             15  ASC-TEMP-QUEUE-UPDATE-SW                         03480014
034900                                        PIC X(01).                03490014
035000                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     03500014
035100                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     03510014
035200             15  ASC-LIST-QUEUE-NAME.                             03520014
035300                 20  ASC-LIST-TERM-ID   PIC X(04).                03530014
035400                 20  ASC-LIST-TASK-NUMBER                         03540014
035500                                        PIC S9(05) COMP-3.        03550014
035600                 20  ASC-LIST-SEQ       PIC 9(01).                03560014
035700             15  ASC-SEL-QUEUE-NAME.                              03570014
035800                 20  ASC-SEL-TERM-ID    PIC X(04).                03580014
035900                 20  ASC-SEL-TASK-NUMBER                          03590014
036000                                        PIC S9(05) COMP-3.        03600014
036100                 20  ASC-SEL-SEQ        PIC 9(01).                03610014
036200                                                                  03620014
036300             15  ASC-START-ITEM-REQUEST.                          03630014
036400                 20  ASC-START-ITEM-REQUEST-N                     03640014
036500                                        PIC 9(07).                03650014
036600/                                                                 03660014
036700*---------------------------------------------------------------* 03670014
036800*    ABEND PROCESSING COPYBOOK.                                 * 03680014
036900*---------------------------------------------------------------* 03690014
037000                                                                  03700014
037100     COPY DPWS013.                                                03710014
037200                                                                  03720014
037300/                                                                 03730014
037400*---------------------------------------------------------------* 03740014
037500*    DB2 AREA FOR THE PURCHASE ORDER TABLE                      * 03750014
037600*---------------------------------------------------------------* 03760014
037700     EXEC SQL                                                     03770014
037800          INCLUDE TPURCHS                                         03780014
037900     END-EXEC.                                                    03790014
038000                                                                  03800014
038100/                                                                 03810014
038200*---------------------------------------------------------------* 03820014
038300*    DB2 AREA FOR THE PURCHASE ORDER LINE ITEM TABLE            * 03830014
038400*---------------------------------------------------------------* 03840014
038500     EXEC SQL                                                     03850014
038600          INCLUDE TPURITM                                         03860014
038700     END-EXEC.                                                    03870014
038800                                                                  03880014
038900/                                                                 03890014
039000*---------------------------------------------------------------* 03900014
039100*    DB2 AREA FOR THE MERCHANDISE STORE DISTRIBUTION            * 03910014
039200*---------------------------------------------------------------* 03920014
039300     EXEC SQL                                                     03930014
039400          INCLUDE TMESTDS                                         03940014
039500     END-EXEC.                                                    03950014
039600                                                                  03960014
039700/                                                                 03970014
040302*---------------------------------------------------------------* 04030214
040303*    DB2 AREA FOR LOCATION                                      * 04030314
040304*---------------------------------------------------------------* 04030414
040305     EXEC SQL                                                     04030514
040306          INCLUDE XMT00001                                        04030614
040307     END-EXEC.                                                    04030714
040308                                                                  04030814
040309*---------------------------------------------------------------* 04030914
040310*    DB2 AREA FOR DC LOCATION ASSIGNMENT                        * 04031014
040320*---------------------------------------------------------------* 04032014
040330     EXEC SQL                                                     04033014
040340          INCLUDE XMT00002                                        04034014
040350     END-EXEC.                                                    04035014
040360                                                                  04036014
040370*---------------------------------------------------------------* 04037014
040380*    DB2 AREA FOR THE STORE VENDOR DC TABLE                     * 04038014
040390*---------------------------------------------------------------* 04039014
040400*    EXEC SQL                                                     04040021
040500*         INCLUDE TSTVNDC                                         04050021
040600*    END-EXEC.                                                    04060021
040700                                                                  04070014
040800/                                                                 04080014
040900*---------------------------------------------------------------* 04090014
041000*    DB2 AREA FOR THE PO PLANNED SHIPMENT TABLE                 * 04100014
041100*---------------------------------------------------------------* 04110014
041200     EXEC SQL                                                     04120014
041300          INCLUDE TPLNSHP                                         04130014
041400     END-EXEC.                                                    04140014
041500                                                                  04150014
041600/                                                                 04160014
041700*---------------------------------------------------------------* 04170014
041800*    DB2 AREA FOR THE RECEIVING STORE DISTRIBUTION TABLE         *04180014
041900*---------------------------------------------------------------* 04190014
042000                                                                  04200014
042100     EXEC SQL                                                     04210014
042200         INCLUDE TRECDIS                                          04220014
042300     END-EXEC.                                                    04230014
042400                                                                  04240014
042500/                                                                 04250014
042600*---------------------------------------------------------------* 04260014
042700*    DB2 AREA FOR COMMUNICATIONS                                * 04270014
042800*---------------------------------------------------------------* 04280014
042900     EXEC SQL                                                     04290014
043000          INCLUDE SQLCA                                           04300014
043100     END-EXEC.                                                    04310014
043200                                                                  04320014
043300/                                                                 04330014
043400*---------------------------------------------------------------* 04340014
043500*  CURSOR TO SELECT STORES                                      * 04350014
043600*  ALSO CHECKING WHETHER DC1 OR DC2 IS ACTIVE                   * 04360014
043700*  THE ACTIVE DC IS THEN USED TO SORT THE PO STORE-DC SUMMARY   * 04370014
043800*  SCREEN IN ASCENDING ORDER ACCORDING TO DC                    * 04380014
043900*  DC1 OR DC2 ARE USED IF ANY ONE STORE HAS SWITCHED THE DC     * 04390014
044000*  ONE WILL REPRESENT THE ACTIVE DC AND THE OTHER THE OLD ONE   * 04400014
044100*---------------------------------------------------------------* 04410014
044200                                                                  04420014
044300     EXEC SQL                                                     04430014
044400          DECLARE STORE-CURSOR CURSOR FOR                         04440014
044500          SELECT                                                  04450014
044600                 XL1.LOC_NBR,                                     04460014
044800                 XL1.LOC_5_ABBR_NM,                               04480014
044900                 XL1.LOC_NM,                                      04490014
045000                 SUM(B.STR_DISTRO_QTY),                           04500014
045100                 XL2.LOC_NBR,                                     04510014
045200                 XL2.LOC_5_ABBR_NM                                04520014
045400            FROM TMESTDS B,                                       04540016
045500                 TPURITM C,                                       04550014
045600                 TPLNSHP D,                                       04560014
045800                 XMT_LOC XL1                                      04580016
045900                ,XMT_LOC XL2                                      04590014
046000          WHERE  B.PO_NBR = :ASC-KEY-PO-NBR                       04600014
046100            AND  XL1.LOC_NBR = B.STR_NBR                          04610016
046200            AND  XL1.LOC_TYP_CDE IN ('CS', 'DS', 'RV')            04620016
046300            AND  C.PO_NBR = B.PO_NBR                              04630014
046400            AND  C.PO_LNE_NBR = B.PO_LNE_NBR                      04640014
046500            AND  C.VER_STATUS_CDE = 'A'                           04650014
046600            AND  C.STATUS_CDE NOT IN ('CA')                       04660014
046700            AND  D.PO_NBR = B.PO_NBR                              04670014
046800            AND  D.VER_STATUS_CDE = 'A'                           04680014
047300             AND XL2.LOC_TYP_CDE = 'DC'                           04730016
047510             AND  XL2.LOC_NBR =                                   04751016
047520               (SELECT DC_NBR                                     04752016
047530                  FROM XMT_DC_LOC_ASGMT DLA1                      04753016
047540                 WHERE DLA1.LOC_NBR = XL1.LOC_NBR                 04754016
047550                   AND DLA1.PO_STRT_DTE =                         04755016
047560                      (SELECT MAX(PO_STRT_DTE)                    04756016
047570                         FROM XMT_DC_LOC_ASGMT DLA2               04757016
047580                        WHERE DLA2.PO_STRT_DTE <=                 04758016
047590                              D.DONT_SHIP_BEF_DTE                 04759016
047591                          AND DLA1.LOC_NBR = DLA2.LOC_NBR))       04759116
047600          GROUP BY XL1.LOC_NBR,                                   04760014
047700                   XL1.LOC_5_ABBR_NM,                             04770014
047800                   XL1.LOC_NM,                                    04780014
047900                   XL2.LOC_NBR,                                   04790014
048000                   XL2.LOC_5_ABBR_NM                              04800014
051100*--THE ORDER BY CLAUSE IS REFERENCING THE 5TH AND 1ST LINE OF THE 05110014
051200*--SELECT STATEMENT FOR PROPER SORTING SEQUENCE                   05120014
051300*--DC FIRST, THEN IN ASCENDING ORDER ACCORDING TO STORE NUMBER    05130014
051400          ORDER BY 5,1                                            05140014
051500     END-EXEC.                                                    05150014
051600                                                                  05160014
051700/                                                                 05170014
051800*---------------------------------------------------------------* 05180014
051900*  CURSOR TO SELECT STORES                                      * 05190014
052000*---------------------------------------------------------------* 05200014
052100                                                                  05210014
052200     EXEC SQL                                                     05220014
052300          DECLARE STORE-CURSOR1 CURSOR FOR                        05230014
052400          SELECT A.STR_NBR,                                       05240014
052500                 XL.LOC_NBR,                                      05250014
052700                 XL.LOC_5_ABBR_NM,                                05270014
052800                 XL.LOC_NM,                                       05280014
052900                 A.OPER_UNT_ID,                                   05290014
053000                 SUM(A.AP_VERIFY_ITM_QTY)                         05300014
053100            FROM TRECDIS  A,                                      05310014
053300                 XMT_LOC  XL                                      05330014
053400          WHERE  A.ORD_NBR= :ASC-KEY-PO-NBR                       05340014
053500            AND  XL.LOC_NBR = A.STR_NBR                           05350014
053600            AND    NOT EXISTS (SELECT 1                           05360014
053700                               FROM TMESTDS B                     05370014
053800                               WHERE  B.STR_NBR = A.STR_NBR       05380014
053900                                AND   B.PO_NBR = :ASC-KEY-PO-NBR )05390014
053920          GROUP BY A.STR_NBR,                                     05392014
053930                   XL.LOC_NBR,                                    05393014
053950                   XL.LOC_5_ABBR_NM,                              05395014
053960                   XL.LOC_NM,                                     05396014
053970                   A.OPER_UNT_ID                                  05397014
053980          ORDER BY A.OPER_UNT_ID,                                 05398014
053990                   XL.LOC_NBR                                     05399014
054000     END-EXEC.                                                    05400014
054100/                                                                 05410014
054200*---------------------------------------------------------------* 05420014
054300*  CURSOR TO SELECT STORES                                      * 05430014
054400*---------------------------------------------------------------* 05440014
054500                                                                  05450014
054600     EXEC SQL                                                     05460014
054700          DECLARE STORE-CURSOR2 CURSOR FOR                        05470014
054800          SELECT A.STR_NBR,                                       05480014
054900                 XL.LOC_NBR,                                      05490014
055100                 XL.LOC_5_ABBR_NM,                                05510014
055200                 XL.LOC_NM,                                       05520014
055300                 SUM(A.STR_DISTRO_QTY)                            05530014
055400            FROM TMESTDS  A,                                      05540014
055600                 TPURITM  D                                       05560014
055700                ,XMT_LOC  XL                                      05570014
055800          WHERE  A.PO_NBR = :ASC-KEY-PO-NBR                       05580014
055900            AND  XL.LOC_NBR = A.STR_NBR                           05590014
056000            AND  D.PO_NBR = A.PO_NBR                              05600014
056100            AND  D.PO_LNE_NBR = A.PO_LNE_NBR                      05610014
056200            AND  D.VER_STATUS_CDE = 'A'                           05620014
056300            AND  D.STATUS_CDE NOT IN ('CA')                       05630014
056500          AND      NOT EXISTS (SELECT 1                           05650014
056600                               FROM TRECDIS B                     05660014
056700                               WHERE  B.STR_NBR = A.STR_NBR       05670014
056800                                AND   B.ORD_NBR= :ASC-KEY-PO-NBR )05680014
056900          GROUP BY A.STR_NBR,                                     05690014
057000                   XL.LOC_NBR,                                    05700014
057200                   XL.LOC_5_ABBR_NM,                              05720014
057300                   XL.LOC_NM                                      05730014
057400     END-EXEC.                                                    05740014
057500/                                                                 05750014
057600 LINKAGE SECTION.                                                 05760014
057700                                                                  05770014
057800 01  DFHCOMMAREA.                                                 05780014
057900     05  FILLER                         OCCURS  1 TO 4072 TIMES   05790014
058000                                        DEPENDING ON EIBCALEN.    05800014
058100         10  FILLER                     PIC X.                    05810014
058200                                                                  05820014
058300/                                                                 05830014
058400 PROCEDURE DIVISION.                                              05840014
058500*---------------------------------------------------------------* 05850014
058600*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 05860014
058700*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 05870014
058800*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 05880014
058900*---------------------------------------------------------------* 05890014
059000 0000-MAIN-MODULE.                                                05900014
059100                                                                  05910014
059200     INITIALIZE DP030-CICS-API-FIELDS.                            05920014
059300                                                                  05930014
059400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05940014
059500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05950014
059600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05960014
059700                                                                  05970014
059800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05980014
059900                                                                  05990014
060000     MOVE LENGTH OF PO062AI        TO DP030-MAP-LENGTH (1).       06000014
060100     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     06010014
060200                                                                  06020014
060300     PERFORM 0001-CALL-CICS-ARCH-API.                             06030014
060400     PERFORM 1000-CONTROL-PROCESSING                              06040014
060500                                                                  06050014
060600     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06060014
060700     PERFORM 0001-CALL-CICS-ARCH-API.                             06070014
060800                                                                  06080014
060900*---------------------------------------------------------------* 06090014
061000*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 06100014
061100*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 06110014
061200*---------------------------------------------------------------* 06120014
061300 0001-CALL-CICS-ARCH-API.                                         06130014
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      06140026
061500                                    DFHCOMMAREA                   06150026
061600                                    DP030-CICS-API-FIELDS         06160026
061700                                    DP020-STANDARD-COMMAREA       06170026
061800                                    PO062AI.                      06180026
061900                                                                  06190014
062000     IF  DP030-RC-CALL-SUCCESSFUL                                 06200014
062100         CONTINUE                                                 06210014
062200     ELSE                                                         06220014
062300         SET DP013-NO-ROLLBACK                                    06230014
062400             DP013-XCTL-DISPLAY-RESTART                           06240014
062500             DP013-CICS-ABEND      TO TRUE                        06250014
062600         MOVE '0001-CALL-CICS-ARCH-API'                           06260014
062700                                   TO DP013-PARAGRAPH             06270014
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O06280026
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06290026
063000         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06300014
063100         PERFORM DP013-0000-PROCESS-ABEND                         06310014
063200     END-IF.                                                      06320014
063300                                                                  06330014
063400*----------------------------------------------------------------*06340014
063500* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06350014
063600* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06360014
063700*                                                                *06370014
063800*----------------------------------------------------------------*06380014
063900                                                                  06390014
064000 1000-CONTROL-PROCESSING.                                         06400014
064100                                                                  06410014
064200     EVALUATE TRUE                                                06420014
064300         WHEN DP020-NEXT-ACT-INITIAL                              06430014
064400             INITIALIZE ASC-SPECIFIC-COMMAREA                     06440014
064500             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06450014
064600                                      ASC-SEL-TERM-ID             06460014
064700             MOVE DP020-SRC-TASK-NUMBER                           06470014
064800                                   TO ASC-LIST-TASK-NUMBER        06480014
064900                                      ASC-SEL-TASK-NUMBER         06490014
065000             MOVE PC-LIST-QUEUE-SEQ                               06500014
065100                                   TO ASC-LIST-SEQ                06510014
065200             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 06520014
065300             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06530014
065400*  THE IF CONDITION CAN NEVER BE TRUE. NOT-VALID IS NEVER SET     06540014
065500*            IF  PS-COMMAREA-NOT-VALID                            06550014
065600*                SET DP020-NEXT-ACT-APPL-ERROR                    06560014
065700*                                  TO TRUE                        06570014
065800*            ELSE                                                 06580014
065900                 PERFORM 4000-BUILD-INITIAL-PANEL                 06590014
066000*            END-IF                                               06600014
066100                                                                  06610014
066200         WHEN DP020-NEXT-ACT-READ-MAP                             06620014
066300             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06630014
066400                                   TO PV-TOP-ITEM                 06640014
066500             PERFORM 2000-PROCESS-PANEL                           06650014
066600                                                                  06660014
066700         WHEN DP020-NEXT-ACT-RETURN                               06670014
066800             PERFORM 2050-DELETE-LIST-QUEUE                       06680014
066900             PERFORM 4000-BUILD-INITIAL-PANEL                     06690014
067000                                                                  06700014
067100         WHEN OTHER                                               06710014
067200             SET DP013-LOGIC-ABEND TO TRUE                        06720014
067300             SET DP013-NO-ROLLBACK TO TRUE                        06730014
067400             MOVE '1000-CONTROL-PROCESSING'                       06740014
067500                                   TO DP013-PARAGRAPH             06750014
067600             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06760014
067700                                   TO DP013-MESSAGE-TEXT(1)       06770014
067800             PERFORM DP013-0000-PROCESS-ABEND                     06780014
067900     END-EVALUATE.                                                06790014
068000                                                                  06800014
068100/                                                                 06810014
068200*----------------------------------------------------------------*06820014
068300* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *06830014
068400*----------------------------------------------------------------*06840014
068500                                                                  06850014
068600 1100-PROCESS-INTER-APPL-COMM.                                    06860014
068700                                                                  06870014
068800     SET PS-COMMAREA-VALID         TO TRUE.                       06880014
068900     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06890014
069000                                                                  06900014
069100     IF DP020-INT-APPL-FORMAT-IND = PC-PO-REV-FMT                 06910014
069200         MOVE PO011-PO-NBR             TO ASC-KEY-PO-NBR          06920014
069300         MOVE PO011-DEPT-NBR           TO ASC-KEY-DEPT-NBR        06930014
069400         MOVE PO011-VENDOR-NAME        TO ASC-KEY-VENDOR-NAME     06940014
069500     ELSE                                                         06950014
069600         MOVE PO017-PO-NBR             TO ASC-KEY-PO-NBR          06960014
069700         MOVE PO017-DEPT-NBR           TO ASC-KEY-DEPT-NBR        06970014
069800         MOVE PO017-ENT-NAME-DESC      TO ASC-KEY-VENDOR-NAME     06980014
069900     END-IF.                                                      06990014
070000                                                                  07000014
070100*----------------------------------------------------------------*07010014
070200* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *07020014
070300* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *07030014
070400* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *07040014
070500* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *07050014
070600* FUNCTION KEYS CAN GET THIS FAR.                                *07060014
070700*----------------------------------------------------------------*07070014
070800                                                                  07080014
070900 2000-PROCESS-PANEL.                                              07090014
071000     EVALUATE TRUE                                                07100014
071100         WHEN DP020-SRC-AID = DP016-CLEAR                         07110014
071200             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07120014
071300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07130014
071400                                                                  07140014
071500         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07150014
071600             PERFORM 2050-DELETE-LIST-QUEUE                       07160014
071700             PERFORM 4000-BUILD-INITIAL-PANEL                     07170014
071800                                                                  07180014
071900                                                                  07190014
072000         WHEN OTHER                                               07200014
072100             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07210014
072200             PERFORM 2100-CHECK-FUNCTION-KEY                      07220014
072300     END-EVALUATE.                                                07230014
072400                                                                  07240014
072500/                                                                 07250014
072600*----------------------------------------------------------------*07260014
072700*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *07270014
072800*----------------------------------------------------------------*07280014
072900 2050-DELETE-LIST-QUEUE.                                          07290014
073000                                                                  07300014
073100     EXEC CICS                                                    07310014
073200         DELETEQ TS                                               07320014
073300           QUEUE (ASC-LIST-QUEUE-NAME)                            07330014
073400            RESP (PV-CICS-RESP)                                   07340014
073500     END-EXEC.                                                    07350014
073600                                                                  07360014
073700     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07370014
073800        (PV-CICS-RESP = DFHRESP(QIDERR))                          07380014
073900         CONTINUE                                                 07390014
074000     ELSE                                                         07400014
074100         SET DP013-CICS-ABEND      TO TRUE                        07410014
074200         SET DP013-NO-ROLLBACK     TO TRUE                        07420014
074300                                                                  07430014
074400         MOVE '2050-DELETE-LIST-QUEUE'                            07440014
074500                                   TO DP013-PARAGRAPH             07450014
074600         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    07460014
074700                                   TO DP013-MESSAGE-TEXT (1)      07470014
074800         PERFORM DP013-0000-PROCESS-ABEND                         07480014
074900     END-IF.                                                      07490014
075000                                                                  07500014
075100     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  07510014
075200                                                                  07520014
075300/                                                                 07530014
075400*----------------------------------------------------------------*07540014
075500* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*07550014
075600* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *07560014
075700* CICS ARCHITECTURE API.                                         *07570014
075800*----------------------------------------------------------------*07580014
075900 2100-CHECK-FUNCTION-KEY.                                         07590014
076000                                                                  07600014
076100     EVALUATE TRUE                                                07610014
076200                                                                  07620014
076300         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07630014
076400             MOVE +1               TO PV-TOP-ITEM                 07640014
076500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07650014
076600             PERFORM 3200-RESET-ATTRIBUTES                        07660014
076700                                                                  07670014
076800         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07680014
076900             PERFORM 2110-BROWSE-BACKWARD                         07690014
077000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07700014
077100             PERFORM 3200-RESET-ATTRIBUTES                        07710014
077200                                                                  07720014
077300         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07730014
077400             PERFORM 2120-BROWSE-FORWARD                          07740014
077500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07750014
077600             PERFORM 3200-RESET-ATTRIBUTES                        07760014
077700                                                                  07770014
077800         WHEN DP020-SRC-AID = DP016-ENTER                         07780014
077900             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   07790014
078000             IF  PS-ERROR                                         07800014
078100                 CONTINUE                                         07810014
078200             ELSE                                                 07820014
078300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07830014
078400             END-IF                                               07840014
078500                                                                  07850014
078600         WHEN OTHER                                               07860014
078700             SET DP013-NO-ROLLBACK                                07870014
078800                 DP013-XCTL-DISPLAY-RESTART                       07880014
078900                 DP013-CICS-ABEND  TO TRUE                        07890014
079000             MOVE '2100-CHECK-FUNCTION-KEY'                       07900014
079100                                   TO DP013-PARAGRAPH             07910014
079200             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07920014
079300                                   TO DP013-MESSAGE-TEXT (1)      07930014
079400             PERFORM DP013-0000-PROCESS-ABEND                     07940014
079500     END-EVALUATE.                                                07950014
079600                                                                  07960014
079700/                                                                 07970014
079800*----------------------------------------------------------------*07980014
079900*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07990014
080000*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *08000014
080100*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *08010014
080200*    MESSAGE.                                                    *08020014
080300*----------------------------------------------------------------*08030014
080400                                                                  08040014
080500 2110-BROWSE-BACKWARD.                                            08050014
080600                                                                  08060014
080700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    08070014
080800         GIVING PV-TOP-ITEM.                                      08080014
080900                                                                  08090014
081000     IF  ((PV-TOP-ITEM < +1)                                      08100014
081100       OR (PV-TOP-ITEM = +1))                                     08110014
081200         MOVE +1                   TO PV-TOP-ITEM                 08120014
081300*        -- TOP OF LIST --                                        08130014
081400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            08140014
081500         SET DP020-MSG-INFORMATIONAL                              08150014
081600                                   TO TRUE                        08160014
081700     END-IF.                                                      08170014
081800                                                                  08180014
081900/                                                                 08190014
082000*----------------------------------------------------------------*08200014
082100*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *08210014
082200*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *08220014
082300*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *08230014
082400*----------------------------------------------------------------*08240014
082500                                                                  08250014
082600 2120-BROWSE-FORWARD.                                             08260014
082700                                                                  08270014
082800     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              08280014
082900         GIVING PV-TOP-ITEM.                                      08290014
083000                                                                  08300014
083100     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   08310014
083200         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08320014
083300                                   TO PV-TOP-ITEM                 08330014
083400*        -- BOTTOM OF LIST --                                     08340014
083500         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08350014
083600         SET DP020-MSG-INFORMATIONAL                              08360014
083700                                   TO TRUE                        08370014
083800     ELSE                                                         08380014
083900         COMPUTE PV-BOTTOM-ITEM =                                 08390014
084000             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 08400014
084100         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            08410014
084200*            -- BOTTOM OF LIST --                                 08420014
084300             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08430014
084400             SET DP020-MSG-INFORMATIONAL                          08440014
084500                                   TO TRUE                        08450014
084600         END-IF                                                   08460014
084700     END-IF.                                                      08470014
084800                                                                  08480014
084900/                                                                 08490014
085000*----------------------------------------------------------------*08500014
085100*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *08510014
085200*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *08520014
085300*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *08530014
085400*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *08540014
085500*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *08550014
085600*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *08560014
085700*----------------------------------------------------------------*08570014
085800                                                                  08580014
085900 2130-CHECK-FOR-JUMP-BROWSE.                                      08590014
086000                                                                  08600014
086100     SET PS-NO-ERROR               TO TRUE.                       08610014
086200     IF (ASC-START-ITEM-REQUEST = SPACE)                          08620014
086300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08630014
086400                                   TO PV-TOP-ITEM                 08640014
086500     ELSE                                                         08650014
086600         MOVE ASC-START-ITEM-REQUEST                              08660014
086700                                   TO DP010I-UNEDITED-FIELD       08670014
086800         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       08680014
086900         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     08690014
087000         SET DP010I-NEGATIVE-NOT-ALLOWED                          08700014
087100                                   TO TRUE                        08710014
264220         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08721023
264230                         USING DP010I-NUMERIC-EDIT-AREA           08722023
087300                                                                  08730014
087400         IF  NOT DP010I-ERROR-DETECTED                            08740014
087500             MOVE DP010I-NUMERIC-FIELD                            08750014
087600                                   TO ASC-START-ITEM-REQUEST-N    08760014
087700             IF  ASC-START-ITEM-REQUEST-N > ZERO                  08770014
087800                 IF  ASC-START-ITEM-REQUEST-N >                   08780014
087900                                          ASC-NUMBER-OF-ITEMS-READ08790014
088000                     MOVE SPACE TO ASC-START-ITEM-REQUEST         08800014
088100                     COMPUTE PV-TOP-ITEM =                        08810014
088200                             ASC-NUMBER-OF-ITEMS-READ             08820014
088300                             - PC-ITEMS-PER-PANEL + 1             08830014
088400                     IF  PV-TOP-ITEM < +1                         08840014
088500                         MOVE +1   TO PV-TOP-ITEM                 08850014
088600                         MOVE PC-TSYMSG-00070                     08860014
088700                                   TO DP020-MSG-NUMBER            08870014
088800                         SET DP020-MSG-INFORMATIONAL              08880014
088900                                   TO TRUE                        08890014
089000                     END-IF                                       08900014
089100                 ELSE                                             08910014
089200                     MOVE ASC-START-ITEM-REQUEST-N                08920014
089300                                   TO PV-TOP-ITEM                 08930014
089400                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      08940014
089500                     COMPUTE PV-BOTTOM-ITEM =                     08950014
089600                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08960014
089700                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08970014
089800*                        -- BOTTOM OF LIST --                     08980014
089900                         MOVE PC-TSYMSG-00070                     08990014
090000                                   TO DP020-MSG-NUMBER            09000014
090100                         SET DP020-MSG-INFORMATIONAL              09010014
090200                                   TO TRUE                        09020014
090300                     END-IF                                       09030014
090400                 END-IF                                           09040014
090500             ELSE                                                 09050014
090600*                --- VALUE OUT OF RANGE ----                      09060014
090700                 MOVE PC-TSYMSG-00101                             09070014
090800                                   TO DP020-MSG-NUMBER            09080014
090900                 MOVE -1           TO ASTRTITL                    09090014
091000                 SET DP030-SET-CURSOR-APPL-1                      09100014
091100                                   TO TRUE                        09110014
091200                 MOVE DP015-REVERSE                               09120014
091300                                   TO ASTRTITH                    09130014
091400                 MOVE DP015-RED    TO ASTRTITC                    09140014
091500                 MOVE DP015-UNP-NUM-BRT-MDT                       09150014
091600                                   TO ASTRTITA                    09160014
091700                 SET DP020-MSG-FATAL                              09170014
091800                                   TO TRUE                        09180014
091900                 SET PS-ERROR      TO TRUE                        09190014
092000             END-IF                                               09200014
092100                                                                  09210014
092200         ELSE                                                     09220014
092300             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09230014
092400             MOVE -1               TO ASTRTITL                    09240014
092500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09250014
092600             MOVE DP015-REVERSE    TO ASTRTITH                    09260014
092700             MOVE DP015-RED        TO ASTRTITC                    09270014
092800             MOVE DP015-UNP-NUM-BRT-MDT                           09280014
092900                                   TO ASTRTITA                    09290014
093000             SET DP020-MSG-FATAL   TO TRUE                        09300014
093100             SET PS-ERROR          TO TRUE                        09310014
093200         END-IF                                                   09320014
093300     END-IF.                                                      09330014
093400                                                                  09340014
093500/                                                                 09350014
093600*----------------------------------------------------------------*09360014
093700*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *09370014
093800*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *09380014
093900*----------------------------------------------------------------*09390014
094000 2200-MOVE-SCREEN-TO-COMMAREA.                                    09400014
094100                                                                  09410014
094200     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             09420014
094300     MOVE +1                       TO PV-SUB.                     09430014
094400                                                                  09440014
094500     PERFORM 3100-SET-SUBSCRIPTS.                                 09450014
094600                                                                  09460014
094700     IF  ASTRTITL > ZERO                                          09470014
094800         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      09480014
094900     ELSE                                                         09490014
095000         IF  ASTRTITF = DP015-ERASE-EOF                           09500014
095100             INITIALIZE ASC-START-ITEM-REQUEST                    09510014
095200         END-IF                                                   09520014
095300     END-IF.                                                      09530014
095400                                                                  09540014
095500     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          09550014
095600         VARYING PV-SUB                                           09560014
095700         FROM 1 BY 1                                              09570014
095800         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      09580014
095900                                                                  09590014
096000/                                                                 09600014
096100*----------------------------------------------------------------*09610014
096200*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *09620014
096300*----------------------------------------------------------------*09630014
096400 2210-MOVE-LINES-TO-COMMAREA.                                     09640014
096500                                                                  09650014
096600                                                                  09660014
096700     ADD +1                        TO ASC-ITEM-SUB.               09670014
096800                                                                  09680014
096900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        09690014
097000         ADD +1                    TO ASC-BLK-SUB                 09700014
097100         MOVE +1                   TO ASC-ITEM-SUB                09710014
097200     END-IF.                                                      09720014
097300                                                                  09730014
097400/                                                                 09740014
097500*----------------------------------------------------------------*09750014
097600*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *09760014
097700*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*09770014
097800*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *09780014
097900*                                                                *09790014
098000*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *09800014
098100*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *09810014
098200*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *09820014
098300*    US IN THE 2ND BLOCK OF THE ARRAY.                           *09830014
098400*----------------------------------------------------------------*09840014
098500                                                                  09850014
098600 3100-SET-SUBSCRIPTS.                                             09860014
098700                                                                  09870014
098800     COMPUTE ASC-ITEM-SUB =                                       09880014
098900         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        09890014
099000                                                                  09900014
099100     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         09910014
099200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            09920014
099300                                                                  09930014
099400         MOVE PC-MAX-BLOCKS-IN-ARRAY                              09940014
099500                                   TO ASC-BLK-SUB                 09950014
099600     ELSE                                                         09960014
099700         MOVE +1                   TO ASC-BLK-SUB                 09970014
099800     END-IF.                                                      09980014
099900                                                                  09990014
100000*----------------------------------------------------------------*10000014
100100*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *10010014
100200*----------------------------------------------------------------*10020014
100300                                                                  10030014
100400 3200-RESET-ATTRIBUTES.                                           10040014
100500                                                                  10050014
100600     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   10060014
100700     MOVE DP015-GREEN              TO ASTRTITC.                   10070014
100800     MOVE DP015-UNDERLINE          TO ASTRTITH.                   10080014
100900                                                                  10090014
101000/                                                                 10100014
101100*----------------------------------------------------------------*10110014
101200*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *10120014
101300*    INITIALIZE ALL COUNTERS AND FLAGS.                          *10130014
101400*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *10140014
101500*    DISPLAY THE PANEL TO USER.                                  *10150014
101600*----------------------------------------------------------------*10160014
101700                                                                  10170014
101800 4000-BUILD-INITIAL-PANEL.                                        10180014
101900                                                                  10190014
102000     INITIALIZE ASC-BLOCK-ENTRIES (1)                             10200014
102100                ASC-BLOCK-ENTRIES (2).                            10210014
102200                                                                  10220014
102300     MOVE +1                       TO ASC-BLK-SUB.                10230014
102400                                                                  10240014
102500     SET ASC-ITEMS-LEFT-ON-DB                                     10250014
102600         ASC-ITEMS-LEFT-ON-DB-1                                   10260014
102700         ASC-ITEMS-LEFT-ON-DB-2    TO TRUE.                       10270014
102800                                                                  10280014
102900     MOVE +0                       TO ASC-ITEM-SUB                10290014
103000                                      ASC-NUMBER-OF-ITEMS-READ    10300014
103100                                      ASC-NUMBER-OF-SELECTED-ITEMS10310014
103200                                      ASC-HIGHEST-BLOCK-WRITTEN   10320014
103300                                      ASC-START-OF-SELECTED-RANGE 10330014
103400                                      ASC-END-OF-SELECTED-RANGE   10340014
103500                                      ASC-ITEM-AT-TOP-OF-PANEL.   10350014
103600                                                                  10360014
103700     PERFORM 4010-OPEN-CURSOR.                                    10370014
103800     PERFORM 4030-OPEN-CURSOR.                                    10380014
103900     PERFORM 4040-OPEN-CURSOR.                                    10390014
104000     PERFORM 4070-OTHER-FIELDS.                                   10400014
104100                                                                  10410014
104200     PERFORM 4300-READ-ITEMS-FROM-DB.                             10420014
104300                                                                  10430014
104400     PERFORM 4020-CLOSE-CURSOR.                                   10440014
104500     PERFORM 4050-CLOSE-CURSOR.                                   10450014
104600     PERFORM 4060-CLOSE-CURSOR.                                   10460014
104700                                                                  10470014
104800     MOVE +1                       TO PV-TOP-ITEM.                10480014
104900                                                                  10490014
105000     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          10500014
105100         SET DP020-NEXT-ACT-APPL-ERROR                            10510014
105200                                   TO TRUE                        10520014
105300         SET DP020-MSG-FATAL       TO TRUE                        10530014
105400         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            10540014
105500     ELSE                                                         10550014
105600         MOVE -1                   TO MR-STORE-NBR (1)            10560014
105700         SET DP030-SET-CURSOR-APPL-1                              10570014
105800                                   TO TRUE                        10580014
105900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     10590014
106000     END-IF.                                                      10600014
106100                                                                  10610014
106200/                                                                 10620014
106300*----------------------------------------------------------------*10630014
106400* OPEN THE STORE CURSOR                                          *10640014
106500*----------------------------------------------------------------*10650014
106600                                                                  10660014
106700 4010-OPEN-CURSOR.                                                10670014
106800                                                                  10680014
106900     PERFORM                                                      10690014
107000         WITH TEST AFTER                                          10700014
107100         VARYING PV-RETRY-COUNTER                                 10710014
107200         FROM 1 BY 1                                              10720014
107300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10730014
107400            OR (SQLCODE = +0))                                    10740014
107500                                                                  10750014
107600         EXEC SQL                                                 10760014
107700             OPEN STORE-CURSOR                                    10770014
107800         END-EXEC                                                 10780014
107900                                                                  10790014
108000         EVALUATE TRUE                                            10800014
108100             WHEN SQLCODE = +0                                    10810014
108200                  CONTINUE                                        10820014
108300             WHEN SQLCODE = -904                                  10830014
108400             WHEN SQLCODE = -913                                  10840014
108500                  CONTINUE                                        10850014
108600             WHEN SQLWARN0 NOT = SPACE                            10860014
108700             WHEN SQLCODE  NOT = +0                               10870014
108800                  MOVE '4010-OPEN-CURSOR'                         10880014
108900                                   TO DP013-PARAGRAPH             10890014
109000                  MOVE 'OPEN STORE CURSOR '                       10900014
109100                                   TO DP013-MESSAGE-TEXT (1)      10910014
109200                  MOVE SQLCA       TO DP013-SQLCA                 10920014
109300                  MOVE 'TPURCHS'   TO DP013-DB2-TABLE-NAME (1)    10930014
109400                  MOVE 'TPURITM'   TO DP013-DB2-TABLE-NAME (2)    10940014
109500                  MOVE 'TPLNSHP'   TO DP013-DB2-TABLE-NAME (3)    10950014
109600                  MOVE 'TENTNME'   TO DP013-DB2-TABLE-NAME (4)    10960014
109700                  SET DP013-DB2-ABEND                             10970014
109800                                   TO TRUE                        10980014
109900                  PERFORM DP013-0000-PROCESS-ABEND                10990014
110000         END-EVALUATE                                             11000014
110100     END-PERFORM.                                                 11010014
110200                                                                  11020014
110300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11030014
110400         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             11040014
110500         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              11050014
110600                                   TO DP013-MESSAGE-TEXT (1)      11060014
110700         MOVE SQLCA                TO DP013-SQLCA                 11070014
110800         SET DP013-DB2-ABEND       TO TRUE                        11080014
110900         PERFORM DP013-0000-PROCESS-ABEND                         11090014
111000     END-IF.                                                      11100014
111100                                                                  11110014
111200/                                                                 11120014
111300*----------------------------------------------------------------*11130014
111400* CLOSE THE PO CURSOR                                            *11140014
111500*----------------------------------------------------------------*11150014
111600                                                                  11160014
111700 4020-CLOSE-CURSOR.                                               11170014
111800                                                                  11180014
111900     EXEC SQL                                                     11190014
112000         CLOSE STORE-CURSOR                                       11200014
112100     END-EXEC.                                                    11210014
112200                                                                  11220014
112300     EVALUATE TRUE                                                11230014
112400         WHEN SQLCODE = +0                                        11240014
112500              CONTINUE                                            11250014
112600         WHEN SQLWARN0 NOT = SPACE                                11260014
112700         WHEN SQLCODE  NOT = +0                                   11270014
112800              MOVE '4020-CLOSE-CURSOR'                            11280014
112900                                   TO DP013-PARAGRAPH             11290014
113000              MOVE 'CLOSE STORE  CURSOR'                          11300014
113100                                   TO DP013-MESSAGE-TEXT (1)      11310014
113200              MOVE SQLCA           TO DP013-SQLCA                 11320014
113300              MOVE 'TPURCHS'       TO DP013-DB2-TABLE-NAME (1)    11330014
113400              MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (2)    11340014
113500              MOVE 'TPLNSHP'       TO DP013-DB2-TABLE-NAME (3)    11350014
113600              MOVE 'TENTNME'       TO DP013-DB2-TABLE-NAME (4)    11360014
113700              SET DP013-DB2-ABEND  TO TRUE                        11370014
113800              PERFORM DP013-0000-PROCESS-ABEND                    11380014
113900     END-EVALUATE.                                                11390014
114000                                                                  11400014
114100/                                                                 11410014
114200*----------------------------------------------------------------*11420014
114300* OPEN THE STORE CURSOR                                          *11430014
114400*----------------------------------------------------------------*11440014
114500                                                                  11450014
114600 4030-OPEN-CURSOR.                                                11460014
114700                                                                  11470014
114800     PERFORM                                                      11480014
114900         WITH TEST AFTER                                          11490014
115000         VARYING PV-RETRY-COUNTER                                 11500014
115100         FROM 1 BY 1                                              11510014
115200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11520014
115300            OR (SQLCODE = +0))                                    11530014
115400                                                                  11540014
115500         EXEC SQL                                                 11550014
115600             OPEN STORE-CURSOR1                                   11560014
115700         END-EXEC                                                 11570014
115800                                                                  11580014
115900         EVALUATE TRUE                                            11590014
116000             WHEN SQLCODE = +0                                    11600014
116100                  CONTINUE                                        11610014
116200             WHEN SQLCODE = -904                                  11620014
116300             WHEN SQLCODE = -913                                  11630014
116400                  CONTINUE                                        11640014
116500             WHEN SQLWARN0 NOT = SPACE                            11650014
116600             WHEN SQLCODE  NOT = +0                               11660014
116700                  MOVE '4030-OPEN-CURSOR'                         11670014
116800                                   TO DP013-PARAGRAPH             11680014
116900                  MOVE 'OPEN STORE CURSOR '                       11690014
117000                                   TO DP013-MESSAGE-TEXT (1)      11700014
117100                  MOVE SQLCA       TO DP013-SQLCA                 11710014
117200                  SET DP013-DB2-ABEND                             11720014
117300                                   TO TRUE                        11730014
117400                  MOVE 'XMT_LOC'   TO DP013-DB2-TABLE-NAME (1)    11740014
117500                  MOVE 'TRECDIS'   TO DP013-DB2-TABLE-NAME (2)    11750014
117600                  MOVE 'TMESTDS'   TO DP013-DB2-TABLE-NAME (3)    11760014
117700                  PERFORM DP013-0000-PROCESS-ABEND                11770014
117800         END-EVALUATE                                             11780014
117900     END-PERFORM.                                                 11790014
118000                                                                  11800014
118100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11810014
118200         MOVE '4030-OPEN-CURSOR'   TO DP013-PARAGRAPH             11820014
118300         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              11830014
118400                                   TO DP013-MESSAGE-TEXT (1)      11840014
118500         MOVE SQLCA                TO DP013-SQLCA                 11850014
118600         SET DP013-DB2-ABEND       TO TRUE                        11860014
118700         PERFORM DP013-0000-PROCESS-ABEND                         11870014
118800     END-IF.                                                      11880014
118900                                                                  11890014
119000*----------------------------------------------------------------*11900014
119100* OPEN THE STORE CURSOR                                          *11910014
119200*----------------------------------------------------------------*11920014
119300                                                                  11930014
119400 4040-OPEN-CURSOR.                                                11940014
119500                                                                  11950014
119600     PERFORM                                                      11960014
119700         WITH TEST AFTER                                          11970014
119800         VARYING PV-RETRY-COUNTER                                 11980014
119900         FROM 1 BY 1                                              11990014
120000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12000014
120100            OR (SQLCODE = +0))                                    12010014
120200                                                                  12020014
120300         EXEC SQL                                                 12030014
120400             OPEN STORE-CURSOR2                                   12040014
120500         END-EXEC                                                 12050014
120600                                                                  12060014
120700         EVALUATE TRUE                                            12070014
120800             WHEN SQLCODE = +0                                    12080014
120900                  CONTINUE                                        12090014
121000             WHEN SQLCODE = -904                                  12100014
121100             WHEN SQLCODE = -913                                  12110014
121200                  CONTINUE                                        12120014
121300             WHEN SQLWARN0 NOT = SPACE                            12130014
121400             WHEN SQLCODE  NOT = +0                               12140014
121500                  MOVE '4040-OPEN-CURSOR'                         12150014
121600                                   TO DP013-PARAGRAPH             12160014
121700                  MOVE 'OPEN STORE CURSOR '                       12170014
121800                                   TO DP013-MESSAGE-TEXT (1)      12180014
121900                  MOVE SQLCA       TO DP013-SQLCA                 12190014
122000                  SET DP013-DB2-ABEND                             12200014
122100                                   TO TRUE                        12210014
122200                  MOVE 'XMT_LOC'   TO DP013-DB2-TABLE-NAME (1)    12220014
122300                  MOVE 'TRECDIS'   TO DP013-DB2-TABLE-NAME (2)    12230014
122400                  MOVE 'TMESTDS'   TO DP013-DB2-TABLE-NAME (3)    12240014
122500                  PERFORM DP013-0000-PROCESS-ABEND                12250014
122600         END-EVALUATE                                             12260014
122700     END-PERFORM.                                                 12270014
122800                                                                  12280014
122900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        12290014
123000         MOVE '4040-OPEN-CURSOR'   TO DP013-PARAGRAPH             12300014
123100         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              12310014
123200                                   TO DP013-MESSAGE-TEXT (1)      12320014
123300         MOVE SQLCA                TO DP013-SQLCA                 12330014
123400         SET DP013-DB2-ABEND       TO TRUE                        12340014
123500         PERFORM DP013-0000-PROCESS-ABEND                         12350014
123600     END-IF.                                                      12360014
123700                                                                  12370014
123800/                                                                 12380014
123900*----------------------------------------------------------------*12390014
124000* CLOSE THE PO CURSOR                                            *12400014
124100*----------------------------------------------------------------*12410014
124200                                                                  12420014
124300 4050-CLOSE-CURSOR.                                               12430014
124400                                                                  12440014
124500     EXEC SQL                                                     12450014
124600         CLOSE STORE-CURSOR1                                      12460014
124700     END-EXEC.                                                    12470014
124800                                                                  12480014
124900     EVALUATE TRUE                                                12490014
125000         WHEN SQLCODE = +0                                        12500014
125100              CONTINUE                                            12510014
125200         WHEN SQLWARN0 NOT = SPACE                                12520014
125300         WHEN SQLCODE  NOT = +0                                   12530014
125400              MOVE '4050-CLOSE-CURSOR'                            12540014
125500                                   TO DP013-PARAGRAPH             12550014
125600              MOVE 'CLOSE STORE  CURSOR'                          12560014
125700                                   TO DP013-MESSAGE-TEXT (1)      12570014
125800              MOVE SQLCA           TO DP013-SQLCA                 12580014
125900              MOVE 'XMT_LOC'       TO DP013-DB2-TABLE-NAME (1)    12590014
126000              MOVE 'TMESTDS'       TO DP013-DB2-TABLE-NAME (2)    12600014
126100              MOVE 'TRECDIS'       TO DP013-DB2-TABLE-NAME (3)    12610014
126200              SET DP013-DB2-ABEND  TO TRUE                        12620014
126300              PERFORM DP013-0000-PROCESS-ABEND                    12630014
126400     END-EVALUATE.                                                12640014
126500                                                                  12650014
126600/                                                                 12660014
126700*----------------------------------------------------------------*12670014
126800*----------------------------------------------------------------*12680014
126900 4060-CLOSE-CURSOR.                                               12690014
127000                                                                  12700014
127100     EXEC SQL                                                     12710014
127200         CLOSE STORE-CURSOR2                                      12720014
127300     END-EXEC.                                                    12730014
127400                                                                  12740014
127500     EVALUATE TRUE                                                12750014
127600         WHEN SQLCODE = +0                                        12760014
127700              CONTINUE                                            12770014
127800         WHEN SQLWARN0 NOT = SPACE                                12780014
127900         WHEN SQLCODE  NOT = +0                                   12790014
128000              MOVE '4060-CLOSE-CURSOR'                            12800014
128100                                   TO DP013-PARAGRAPH             12810014
128200              MOVE 'CLOSE STORE  CURSOR'                          12820014
128300                                   TO DP013-MESSAGE-TEXT (1)      12830014
128400              MOVE SQLCA           TO DP013-SQLCA                 12840014
128500              MOVE 'XMT_LOC'       TO DP013-DB2-TABLE-NAME (1)    12850014
128600              MOVE 'TMESTDS'       TO DP013-DB2-TABLE-NAME (2)    12860014
128700              MOVE 'TRECDIS'       TO DP013-DB2-TABLE-NAME (3)    12870014
128800              SET DP013-DB2-ABEND  TO TRUE                        12880014
128900              PERFORM DP013-0000-PROCESS-ABEND                    12890014
129000     END-EVALUATE.                                                12900014
129100                                                                  12910014
129200/                                                                 12920014
129300 4070-OTHER-FIELDS.                                               12930014
129400*----------------------------------------------------------------*12940014
129500* GET OTHER SCREEN FIELDS FROM TPURCHS                           *12950014
129600*    THIS LOGIC WAS COPIED FROM POKCS014                         *12960014
129700*----------------------------------------------------------------*12970014
129800                                                                  12980014
129900     PERFORM                                                      12990014
130000         WITH TEST AFTER                                          13000014
130100         VARYING PV-RETRY-COUNTER                                 13010014
130200         FROM 1 BY 1                                              13020014
130300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13030014
130400             OR (SQLCODE = ZERO)                                  13040014
130500             OR (SQLCODE = +100))                                 13050014
130600             EXEC SQL                                             13060014
130700                 SELECT A.DEPT_NBR,                               13070014
130800                        A.NEW_STR_PO_IND,                         13080014
130900                        B.ENT_ID,                                 13090014
131000                        B.DONT_SHIP_BEF_DTE,                      13100014
131100                        CURRENT DATE                              13110014
131200                 INTO :PURCHS-DEPT-NBR,                           13120014
131300                      :PURCHS-NEW-STR-PO-IND,                     13130014
131400                      :PURCHS-ENT-ID,                             13140014
131500                      :PLNSHP-DONT-SHIP-BEF-DTE,                  13150014
131600                      :PV-ALLOC-DATE                              13160014
131700                 FROM TPURCHS A,                                  13170014
131800                      TPLNSHP B                                   13180014
131900                 WHERE   A.PO_NBR = :ASC-KEY-PO-NBR               13190014
132000                   AND   A.VER_STATUS_CDE = 'A'                   13200014
132100                   AND   B.PO_NBR = A.PO_NBR                      13210014
132200                   AND   B.VER_STATUS_CDE = 'A'                   13220014
132300             END-EXEC                                             13230014
132400         EVALUATE TRUE                                            13240014
132500             WHEN SQLCODE = ZERO                                  13250014
132600             WHEN SQLCODE = +100                                  13260014
132700             WHEN SQLCODE = -904                                  13270014
132800             WHEN SQLCODE = -913                                  13280014
132900                 CONTINUE                                         13290014
133000             WHEN SQLWARN0 NOT = SPACES                           13300014
133100             WHEN SQLCODE < ZERO                                  13310014
133200             WHEN SQLCODE > ZERO                                  13320014
133300                 MOVE '4070-OTHER-FIELDS           '              13330014
133400                                   TO DP013-PARAGRAPH             13340014
133500                 MOVE 'SQL ERROR SELECTING PO'                    13350014
133600                                   TO DP013-MESSAGE-TEXT (1)      13360014
133700                 MOVE SQLCA        TO DP013-SQLCA                 13370014
133800                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)    13380014
133900                 MOVE 'TPLNSHP '   TO DP013-DB2-TABLE-NAME (2)    13390014
134000                 SET DP013-DB2-ABEND                              13400014
134100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           13410014
134200                 PERFORM DP013-0000-PROCESS-ABEND                 13420014
134300         END-EVALUATE                                             13430014
134400     END-PERFORM.                                                 13440014
134500*                                                                 13450014
134600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13460014
134700         MOVE '4070-OTHER-FIELDS           '                      13470014
134800                                   TO DP013-PARAGRAPH             13480014
134900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  13490014
135000                                   TO DP013-MESSAGE-TEXT (1)      13500014
135100         MOVE SQLCA                TO DP013-SQLCA                 13510014
135200         MOVE 'TPURCHS '           TO DP013-DB2-TABLE-NAME (1)    13520014
135300         MOVE 'TPLNSHP '           TO DP013-DB2-TABLE-NAME (2)    13530014
135400         SET DP013-DB2-ABEND                                      13540014
135500             DP013-XCTL-DISPLAY-RESTART                           13550014
135600                                   TO TRUE                        13560014
135700         PERFORM DP013-0000-PROCESS-ABEND                         13570014
135800     END-IF.                                                      13580014
135900                                                                  13590014
136000     IF SQLCODE = ZERO                                            13600014
136100         IF PLNSHP-DONT-SHIP-BEF-DTE > '0001-01-01'               13610014
136200             MOVE PLNSHP-DONT-SHIP-BEF-DTE                        13620014
136300                                   TO PV-ALLOC-DATE               13630014
136400         END-IF                                                   13640014
136500     END-IF.                                                      13650014
136600                                                                  13660014
136700*----------------------------------------------------------------*13670014
136800                                                                  13680014
136900 4300-READ-ITEMS-FROM-DB.                                         13690014
137000                                                                  13700014
137100     PERFORM                                                      13710014
137200         VARYING PV-READ-COUNT                                    13720014
137300         FROM 1 BY 1                                              13730014
137400         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    13740014
137500            OR (ASC-NO-ITEMS-LEFT-ON-DB-2))                       13750014
137600                                                                  13760014
137700         PERFORM 4310-FETCH                                       13770014
137800         IF ASC-NO-ITEMS-LEFT-ON-DB                               13780014
137900           PERFORM 4330-FETCH                                     13790014
138000         END-IF                                                   13800014
138100         IF ASC-NO-ITEMS-LEFT-ON-DB AND                           13810014
138200            ASC-NO-ITEMS-LEFT-ON-DB-1                             13820014
138300*          PERFORM 4340-FETCH                                     13830014
138400              SET ASC-NO-ITEMS-LEFT-ON-DB-2                       13840014
138500                                   TO TRUE                        13850014
138600         END-IF                                                   13860014
138700                                                                  13870014
138800         IF  ASC-ITEMS-LEFT-ON-DB  OR                             13880014
138900             ASC-ITEMS-LEFT-ON-DB-1 OR                            13890014
139000             ASC-ITEMS-LEFT-ON-DB-2                               13900014
139100             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                13910014
139200                 ADD +1            TO ASC-ITEM-SUB                13920014
139300             ELSE                                                 13930014
139400                 ADD +1            TO ASC-BLK-SUB                 13940014
139500                 MOVE +1           TO ASC-ITEM-SUB                13950014
139600                                                                  13960014
139700                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         13970014
139800                     MOVE +1       TO ASC-BLK-SUB                 13980014
139900                     SET ASC-BLOCK-MODIFIED (1)                   13990014
140000                                   TO TRUE                        14000014
140100                     PERFORM 5100-WRITE-TEMP-STORAGE              14010014
140200                     MOVE ASC-BLOCK-ENTRIES                       14020014
140300                               (PC-MAX-BLOCKS-IN-ARRAY)           14030014
140400                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 14040014
140500                     ADD +1        TO ASC-BLK-SUB                 14050014
140600                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   14060014
140700                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      14070014
140800                                   TO TRUE                        14080014
140900                 END-IF                                           14090014
141000             END-IF                                               14100014
141100             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    14110014
141200             MOVE ASC-NUMBER-OF-ITEMS-READ                        14120014
141300                                   TO ASC-LIST-ITEM-NUMBER        14130014
141400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14140014
141500            IF  ASC-ITEMS-LEFT-ON-DB OR                           14150014
141600                ASC-ITEMS-LEFT-ON-DB-1 OR                         14160014
141700                ASC-ITEMS-LEFT-ON-DB-2                            14170014
141800           MOVE  XMT00001-LOC-NBR                                 14180014
141900                     TO ASC-STORE-NBR ( ASC-BLK-SUB ASC-ITEM-SUB )14190014
142000*  ADD A SELECT HERE TO SEE IF THIS STORE BELONGS TO THE TRI-STATE14200014
142100*   DC. IF IT DOES, MOVE A '3P' TO THE DC NAME.                   14210014
142200*                                                                 14220014
142300*          IF PURCHS-NEW-STR-PO-IND = 'Y'                         14230022
142400*              PERFORM 4360-CHECK-TSTVNDC                         14240022
142500*          END-IF                                                 14250022
142600           MOVE  XMT00001-LOC-NM                                  14260014
142700               TO ASC-STORE-NAME ( ASC-BLK-SUB ASC-ITEM-SUB )     14270014
142800           MOVE  MESTDS-STR-DISTRO-QTY                            14280014
142900               TO ASC-CURR-ALLOC ( ASC-BLK-SUB ASC-ITEM-SUB )     14290014
143000           MOVE  RECDIS-AP-VERIFY-ITM-QTY                         14300014
143100               TO ASC-CURR-RCVD  ( ASC-BLK-SUB ASC-ITEM-SUB )     14310014
143200           IF PV-DC-NAME = SPACES                                 14320014
143300              MOVE '**' TO ASC-DC (ASC-BLK-SUB ASC-ITEM-SUB)      14330014
143400           ELSE                                                   14340014
143500              STRING PV-DC-NAME (4:2) DELIMITED BY SIZE           14350014
143600                INTO ASC-DC (ASC-BLK-SUB ASC-ITEM-SUB)            14360014
143700           END-IF                                                 14370014
143800           END-IF                                                 14380014
143900        END-IF                                                    14390014
144000                                                                  14400014
144100     END-PERFORM.                                                 14410014
144200                                                                  14420014
144300     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          14430014
144400         MOVE +1                   TO ASC-BLK-SUB                 14440014
144500         PERFORM 5100-WRITE-TEMP-STORAGE                          14450014
144600         ADD +1                    TO ASC-BLK-SUB                 14460014
144700         PERFORM 5100-WRITE-TEMP-STORAGE                          14470014
144800                                                                  14480014
144900         MOVE 1                    TO ASC-BLK-SUB                 14490014
145000                                      PV-BLOCK-NUMBER             14500014
145100         PERFORM 4410-READ-TEMP-STORAGE                           14510014
145200         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             14520014
145300             MOVE 2                TO ASC-BLK-SUB                 14530014
145400                                      PV-BLOCK-NUMBER             14540014
145500             PERFORM 4410-READ-TEMP-STORAGE                       14550014
145600         END-IF                                                   14560014
145700     END-IF.                                                      14570014
145800                                                                  14580014
145900/                                                                 14590014
146000*----------------------------------------------------------------*14600014
146100*    FETCH A ROW                                                 *14610014
146200*----------------------------------------------------------------*14620014
146300                                                                  14630014
146400 4310-FETCH.                                                      14640014
146500                                                                  14650014
146600     EXEC SQL                                                     14660014
146700         FETCH STORE-CURSOR                                       14670014
146800          INTO :XMT00001-LOC-NBR,                                 14680014
147000               :XMT00001-LOC-5-ABBR-NM,                           14700014
147100               :XMT00001-LOC-NM,                                  14710014
147200               :MESTDS-STR-DISTRO-QTY,                            14720014
147300               :PV-DC-NBR,                                        14730014
147400               :PV-DC-NAME                                        14740014
147500     END-EXEC.                                                    14750014
147600                                                                  14760014
147700     EVALUATE TRUE                                                14770014
147800         WHEN SQLCODE = +0                                        14780014
147900           PERFORM 4315-SELECT-RECDIS                             14790014
148000           CONTINUE                                               14800014
148100         WHEN SQLCODE = +100                                      14810014
148200              SET ASC-NO-ITEMS-LEFT-ON-DB                         14820014
148300                                   TO TRUE                        14830014
148400         WHEN SQLWARN0 NOT = SPACE                                14840014
148500         WHEN SQLCODE < +0                                        14850014
148600         WHEN SQLCODE > +0                                        14860014
148700              MOVE '4310-FETCH-CURSOR'                            14870014
148800                                   TO DP013-PARAGRAPH             14880014
148900              MOVE 'FETCH STORE CURSOR'                           14890014
149000                                   TO DP013-MESSAGE-TEXT (1)      14900014
149100              MOVE SQLCA           TO DP013-SQLCA                 14910014
149200              MOVE 'TPURCHS'       TO DP013-DB2-TABLE-NAME (1)    14920014
149300              MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (2)    14930014
149400              MOVE 'TPLNSHP'       TO DP013-DB2-TABLE-NAME (3)    14940014
149500              MOVE 'TENTNME'       TO DP013-DB2-TABLE-NAME (4)    14950014
149600              SET DP013-DB2-ABEND  TO TRUE                        14960014
149700              PERFORM DP013-0000-PROCESS-ABEND                    14970014
149800     END-EVALUATE.                                                14980014
149900                                                                  14990014
150000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15000014
150100         MOVE '4310-FETCH-CURSOR'  TO DP013-PARAGRAPH             15010014
150200         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             15020014
150300                                   TO DP013-MESSAGE-TEXT (1)      15030014
150400         MOVE SQLCA                TO DP013-SQLCA                 15040014
150500         SET DP013-DB2-ABEND                                      15050014
150600             DP013-XCTL-DISPLAY-RESTART                           15060014
150700                                   TO TRUE                        15070014
150800         PERFORM DP013-0000-PROCESS-ABEND                         15080014
150900     END-IF.                                                      15090014
151000                                                                  15100014
151100/                                                                 15110014
151200 4315-SELECT-RECDIS.                                              15120014
151400     MOVE XMT00001-LOC-NBR   TO RECDIS-STR-NBR.                   15140014
151500                                                                  15150014
151600     EXEC SQL                                                     15160014
151700          SELECT SUM(AP_VERIFY_ITM_QTY)                           15170014
151800           INTO :RECDIS-AP-VERIFY-ITM-QTY:PV-NULL                 15180014
151900            FROM TRECDIS                                          15190014
152000          WHERE  ORD_NBR        = :ASC-KEY-PO-NBR                 15200014
152100            AND  STR_NBR        = :RECDIS-STR-NBR                 15210014
152200            AND  VER_STATUS_CDE = 'A'                             15220014
152300     END-EXEC.                                                    15230014
152400     EVALUATE TRUE                                                15240014
152500         WHEN SQLCODE = +0                                        15250014
152600           IF PV-NULL < ZERO                                      15260014
152700              MOVE ZERO TO RECDIS-AP-VERIFY-ITM-QTY               15270014
152800           END-IF                                                 15280014
152900                                                                  15290014
153000         WHEN SQLCODE = +100                                      15300014
153100              MOVE ZERO TO RECDIS-AP-VERIFY-ITM-QTY               15310014
153200                                                                  15320014
153300                                                                  15330014
153400         WHEN SQLWARN0 NOT = SPACE                                15340014
153500         WHEN SQLCODE < +0                                        15350014
153600         WHEN SQLCODE > +0                                        15360014
153700              MOVE '4315-FETCH-CURSOR'                            15370014
153800                                   TO DP013-PARAGRAPH             15380014
153900              MOVE 'FETCH STORE CURSOR'                           15390014
154000                                   TO DP013-MESSAGE-TEXT (1)      15400014
154100              MOVE SQLCA           TO DP013-SQLCA                 15410014
154200              MOVE 'TPURCHS'       TO DP013-DB2-TABLE-NAME (1)    15420014
154300              MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (2)    15430014
154400              MOVE 'TPLNSHP'       TO DP013-DB2-TABLE-NAME (3)    15440014
154500              MOVE 'TENTNME'       TO DP013-DB2-TABLE-NAME (4)    15450014
154600              SET DP013-DB2-ABEND  TO TRUE                        15460014
154700              PERFORM DP013-0000-PROCESS-ABEND                    15470014
154800     END-EVALUATE.                                                15480014
154900*----------------------------------------------------------------*15490014
155000*    FETCH A ROW                                                 *15500014
155100*----------------------------------------------------------------*15510014
155200                                                                  15520014
155300 4330-FETCH.                                                      15530014
155400                                                                  15540014
155500     EXEC SQL                                                     15550014
155600         FETCH STORE-CURSOR1                                      15560014
155700          INTO :RECDIS-STR-NBR,                                   15570014
155800               :XMT00001-LOC-NBR,                                 15580014
156000               :XMT00001-LOC-5-ABBR-NM,                           15600014
156100               :XMT00001-LOC-NM,                                  15610014
156200               :RECDIS-OPER-UNT-ID,                               15620014
156300               :RECDIS-AP-VERIFY-ITM-QTY                          15630014
156400     END-EXEC.                                                    15640014
156500                                                                  15650014
156600     EVALUATE TRUE                                                15660014
156700         WHEN SQLCODE = +0                                        15670014
156800              MOVE ZERO TO MESTDS-STR-DISTRO-QTY                  15680014
156900              PERFORM 4350-FIND-DC                                15690014
157000                                                                  15700014
157100         WHEN SQLCODE = +100                                      15710014
157200              SET ASC-NO-ITEMS-LEFT-ON-DB-1                       15720014
157300                                   TO TRUE                        15730014
157400         WHEN SQLWARN0 NOT = SPACE                                15740014
157500         WHEN SQLCODE < +0                                        15750014
157600         WHEN SQLCODE > +0                                        15760014
157700              MOVE '4330-FETCH-CURSOR'                            15770014
157800                                   TO DP013-PARAGRAPH             15780014
157900              MOVE 'FETCH STORE CURSOR'                           15790014
158000                                   TO DP013-MESSAGE-TEXT (1)      15800014
158100              MOVE SQLCA           TO DP013-SQLCA                 15810014
158200              MOVE 'XMT_LOC'       TO DP013-DB2-TABLE-NAME (1)    15820014
158300              MOVE 'TMESTDS'       TO DP013-DB2-TABLE-NAME (2)    15830014
158400              MOVE 'TRECDIS'       TO DP013-DB2-TABLE-NAME (3)    15840014
158500              SET DP013-DB2-ABEND  TO TRUE                        15850014
158600              PERFORM DP013-0000-PROCESS-ABEND                    15860014
158700     END-EVALUATE.                                                15870014
158800                                                                  15880014
158900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15890014
159000         MOVE '4330-FETCH-CURSOR'  TO DP013-PARAGRAPH             15900014
159100         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             15910014
159200                                   TO DP013-MESSAGE-TEXT (1)      15920014
159300         MOVE SQLCA                TO DP013-SQLCA                 15930014
159400         SET DP013-DB2-ABEND                                      15940014
159500             DP013-XCTL-DISPLAY-RESTART                           15950014
159600                                   TO TRUE                        15960014
159700         PERFORM DP013-0000-PROCESS-ABEND                         15970014
159800     END-IF.                                                      15980014
159900                                                                  15990014
160000*----------------------------------------------------------------*16000014
160100*    FETCH A ROW                                                 *16010014
160200*----------------------------------------------------------------*16020014
160300                                                                  16030014
160400 4340-FETCH.                                                      16040014
160500                                                                  16050014
160600     EXEC SQL                                                     16060014
160700         FETCH STORE-CURSOR2                                      16070014
160800          INTO :MESTDS-STR-NBR,                                   16080014
160900               :XMT00001-LOC-NBR,                                 16090014
161100               :XMT00001-LOC-5-ABBR-NM,                           16110014
161200               :XMT00001-LOC-NM,                                  16120014
161300               :MESTDS-STR-DISTRO-QTY                             16130014
161400     END-EXEC.                                                    16140014
161500                                                                  16150014
161600     EVALUATE TRUE                                                16160014
161700         WHEN SQLCODE = +0                                        16170014
161800              MOVE ZERO TO RECDIS-AP-VERIFY-ITM-QTY               16180014
161900                                                                  16190014
162000         WHEN SQLCODE = +100                                      16200014
162100              SET ASC-NO-ITEMS-LEFT-ON-DB-2                       16210014
162200                                   TO TRUE                        16220014
162300         WHEN SQLWARN0 NOT = SPACE                                16230014
162400         WHEN SQLCODE < +0                                        16240014
162500         WHEN SQLCODE > +0                                        16250014
162600              MOVE '4340-FETCH-CURSOR'                            16260014
162700                                   TO DP013-PARAGRAPH             16270014
162800              MOVE 'FETCH STORE CURSOR'                           16280014
162900                                   TO DP013-MESSAGE-TEXT (1)      16290014
163000              MOVE SQLCA           TO DP013-SQLCA                 16300014
163100              MOVE 'XMT_LOC'       TO DP013-DB2-TABLE-NAME (1)    16310014
163200              MOVE 'TMESTDS'       TO DP013-DB2-TABLE-NAME (2)    16320014
163300              MOVE 'TRECDIS'       TO DP013-DB2-TABLE-NAME (3)    16330014
163400              SET DP013-DB2-ABEND  TO TRUE                        16340014
163500              PERFORM DP013-0000-PROCESS-ABEND                    16350014
163600     END-EVALUATE.                                                16360014
163700                                                                  16370014
163800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16380014
163900         MOVE '4340-FETCH-CURSOR'  TO DP013-PARAGRAPH             16390014
164000         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             16400014
164100                                   TO DP013-MESSAGE-TEXT (1)      16410014
164200         MOVE SQLCA                TO DP013-SQLCA                 16420014
164300         SET DP013-DB2-ABEND                                      16430014
164400             DP013-XCTL-DISPLAY-RESTART                           16440014
164500                                   TO TRUE                        16450014
164600         PERFORM DP013-0000-PROCESS-ABEND                         16460014
164700     END-IF.                                                      16470014
164800                                                                  16480014
164900 4350-FIND-DC.                                                    16490014
165000                                                                  16500014
165100     PERFORM                                                      16510014
165200         WITH TEST AFTER                                          16520014
165300         VARYING PV-RETRY-COUNTER                                 16530014
165400         FROM 1 BY 1                                              16540014
165500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16550014
165600            OR (SQLCODE = +0) OR (SQLCODE = +100))                16560014
165700                                                                  16570014
165800         EXEC SQL                                                 16580014
165900              SELECT XL2.LOC_5_ABBR_NM                            16590014
166000                INTO :PV-DC-NAME                                  16600014
166200                FROM TPLNSHP B                                    16620016
166310                    ,XMT_LOC XL1                                  16631014
166320                    ,XMT_LOC XL2                                  16632014
166330              WHERE  XL1.LOC_NBR = :RECDIS-STR-NBR                16633016
166340                AND  XL1.LOC_TYP_CDE IN ('CS', 'DS', 'RV')        16634016
166350                AND  B.PO_NBR = :ASC-KEY-PO-NBR                   16635014
166360                AND  B.VER_STATUS_CDE = 'A'                       16636014
166500                 AND XL2.LOC_TYP_CDE = 'DC'                       16650016
166710                AND  XL2.LOC_NBR =                                16671016
166720                  (SELECT DC_NBR                                  16672016
166730                     FROM XMT_DC_LOC_ASGMT DLA1                   16673016
166740                    WHERE DLA1.LOC_NBR = XL1.LOC_NBR              16674016
166750                      AND DLA1.PO_STRT_DTE =                      16675016
166760                         (SELECT MAX(PO_STRT_DTE)                 16676016
166770                            FROM XMT_DC_LOC_ASGMT DLA2            16677016
166780                           WHERE DLA2.PO_STRT_DTE <=              16678016
166790                                 B.DONT_SHIP_BEF_DTE              16679016
166791                             AND DLA1.LOC_NBR = DLA2.LOC_NBR))    16679116
168700         END-EXEC                                                 16870014
168800                                                                  16880014
168900         EVALUATE TRUE                                            16890014
169000             WHEN SQLCODE = +0                                    16900014
169100                  CONTINUE                                        16910014
169200             WHEN SQLCODE = +100                                  16920014
169300                  MOVE SPACES TO PV-DC-NAME                       16930014
169400             WHEN SQLCODE = -904                                  16940014
169500             WHEN SQLCODE = -913                                  16950014
169600                  CONTINUE                                        16960014
169700             WHEN SQLWARN0 NOT = SPACE                            16970014
169800             WHEN SQLCODE  NOT = +0                               16980014
169900                  MOVE '4350-FIND-DC'                             16990014
170000                                   TO DP013-PARAGRAPH             17000014
170100                  MOVE 'SELECT XMT_LOC    '                       17010014
170200                                   TO DP013-MESSAGE-TEXT (1)      17020014
170300                  MOVE SQLCA       TO DP013-SQLCA                 17030014
170400                  SET DP013-DB2-ABEND                             17040014
170500                                   TO TRUE                        17050014
170600                  MOVE 'XMT_LOC'   TO DP013-DB2-TABLE-NAME (1)    17060014
170700                  MOVE 'TPLNSHP'   TO DP013-DB2-TABLE-NAME (2)    17070014
170800                  PERFORM DP013-0000-PROCESS-ABEND                17080014
170900         END-EVALUATE                                             17090014
171000     END-PERFORM.                                                 17100014
171100                                                                  17110014
171200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17120014
171300         MOVE '4350-FIND-DC    '   TO DP013-PARAGRAPH             17130014
171400         MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                   17140014
171500                                   TO DP013-MESSAGE-TEXT (1)      17150014
171600         MOVE SQLCA                TO DP013-SQLCA                 17160014
171700         SET DP013-DB2-ABEND       TO TRUE                        17170014
171800         PERFORM DP013-0000-PROCESS-ABEND                         17180014
171900     END-IF.                                                      17190014
172000                                                                  17200014
172100*4360-CHECK-TSTVNDC.                                              17210022
172200*----------------------------------------------------------------*17220014
172300*   IS THIS STORE REALLY A TRI-STATE DC STORE.                   *17230014
172400*----------------------------------------------------------------*17240014
172500*                                                                 17250022
172600*    PERFORM                                                      17260022
172700*        WITH TEST AFTER                                          17270022
172800*        VARYING PV-RETRY-COUNTER                                 17280022
172900*        FROM 1 BY 1                                              17290022
173000*        UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17300022
173100*           OR (SQLCODE = +0) OR (SQLCODE = +100))                17310022
173200*                                                                 17320022
173300*        EXEC SQL                                                 17330022
173400*             SELECT XL.LOC_5_ABBR_NM                             17340022
173500*               INTO :PV-DC-NAME                                  17350022
173600*               FROM   XMT_LOC XL,                                17360022
173700*                      TSTVNDC B                                  17370022
173900*             WHERE XL.LOC_NBR = :XMT00001-LOC-NBR                17390022
174100*               AND SHIP_TO_TMP_DC_NBR = XL.LOC_NBR               17410022
174200*               AND ENT_ID = :PURCHS-ENT-ID                       17420022
174220*               AND (DEPT_NBR = '999'                             17422022
174230*                    OR DEPT_NBR = :PURCHS-DEPT-NBR)              17423022
174240*               AND (:PV-ALLOC-DATE BETWEEN EFF_BEG_DTE           17424022
174250*                                       AND EFF_END_DTE)          17425022
174260*        END-EXEC                                                 17426022
174790*                                                                 17479022
174800*        EVALUATE TRUE                                            17480022
174900*            WHEN SQLCODE = +0                                    17490022
175000*                 CONTINUE                                        17500022
175100*            WHEN SQLCODE = +100                                  17510022
175200*            WHEN SQLCODE = -904                                  17520022
175300*            WHEN SQLCODE = -913                                  17530022
175400*                 CONTINUE                                        17540022
175500*            WHEN SQLWARN0 NOT = SPACE                            17550022
175600*            WHEN SQLCODE  NOT = +0                               17560022
175700*                 MOVE '4360-CHECK-TSTVNDC'                       17570022
175800*                                  TO DP013-PARAGRAPH             17580022
175900*                 MOVE 'SELECT TSTVNDC    '                       17590022
176000*                                  TO DP013-MESSAGE-TEXT (1)      17600022
176100*                 MOVE SQLCA       TO DP013-SQLCA                 17610022
176200*                 SET DP013-DB2-ABEND                             17620022
176300*                                  TO TRUE                        17630022
176400*                 MOVE 'XMT_LOC'   TO DP013-DB2-TABLE-NAME (1)    17640022
176500*                 MOVE 'TSTVNDC'   TO DP013-DB2-TABLE-NAME (2)    17650022
176600*                 PERFORM DP013-0000-PROCESS-ABEND                17660022
176700*        END-EVALUATE                                             17670022
176800*    END-PERFORM.                                                 17680022
176900*                                                                 17690022
177000*    IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17700022
177100*        MOVE '4360-CHECK-TSTVNDC' TO DP013-PARAGRAPH             17710022
177200*        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                   17720022
177300*                                  TO DP013-MESSAGE-TEXT (1)      17730022
177400*        MOVE SQLCA                TO DP013-SQLCA                 17740022
177500*        SET DP013-DB2-ABEND       TO TRUE                        17750022
177600*        PERFORM DP013-0000-PROCESS-ABEND                         17760022
177700*    END-IF.                                                      17770022
177800                                                                  17780014
177900*----------------------------------------------------------------*17790014
178000* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *17800014
178100*----------------------------------------------------------------*17810014
178200                                                                  17820014
178300 4400-MOVE-COMMAREA-TO-SCREEN.                                    17830014
178400                                                                  17840014
178500     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             17850014
178600         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          17860014
178700         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          17870014
178800             MOVE +1               TO ASC-BLK-SUB                 17880014
178900             PERFORM 5100-WRITE-TEMP-STORAGE                      17890014
179000             ADD +1                TO ASC-BLK-SUB                 17900014
179100             PERFORM 5100-WRITE-TEMP-STORAGE                      17910014
179200             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             17920014
179300                 GIVING PV-BLOCK-NUMBER                           17930014
179400                 REMAINDER PV-REMAINDER                           17940014
179500             IF  PV-REMAINDER > ZERO                              17950014
179600                 ADD +1            TO PV-BLOCK-NUMBER             17960014
179700             END-IF                                               17970014
179800             MOVE +1               TO ASC-BLK-SUB                 17980014
179900             PERFORM 4410-READ-TEMP-STORAGE                       17990014
180000             ADD +1                TO ASC-BLK-SUB                 18000014
180100                                      PV-BLOCK-NUMBER             18010014
180200             PERFORM 4410-READ-TEMP-STORAGE                       18020014
180300     END-IF.                                                      18030014
180400                                                                  18040014
180500     MOVE +1                       TO ASC-BLK-SUB.                18050014
180600                                                                  18060014
180700     COMPUTE ASC-ITEM-SUB =                                       18070014
180800         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              18080014
180900         + PC-ITEMS-PER-PANEL).                                   18090014
181000                                                                  18100014
181100     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        18110014
181200         ADD +1                    TO ASC-BLK-SUB                 18120014
181300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            18130014
181400     END-IF.                                                      18140014
181500                                                                  18150014
181600     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           18160014
181700         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                18170014
181800                                                                  18180014
181900     PERFORM 4420-FORMAT-LIST-LINES                               18190014
182000         VARYING PV-SUB                                           18200014
182100         FROM PC-ITEMS-PER-PANEL BY -1                            18210014
182200         UNTIL PV-SUB < +1.                                       18220014
182300                                                                  18230014
182400     COMPUTE ASC-ITEMS-DISPLAYED =                                18240014
182500         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          18250014
182600                                                                  18260014
182700     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    18270014
182800                                      ASTRTITO.                   18280014
182900                                                                  18290014
183000     MOVE ASC-KEY-PO-NBR           TO APONUMO.                    18300014
183100     MOVE ASC-KEY-DEPT-NBR         TO ADEPTO.                     18310014
183200     MOVE ASC-KEY-VENDOR-NAME      TO AVENDNMO.                   18320014
183300     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    18330014
183400     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    18340014
183500                                                                  18350014
183600     IF  DP020-MSG-NUMBER-X = SPACE                               18360014
183700         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  18370014
183800*            --- MORE ITEMS TO DISPLAY ----                       18380014
183900             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            18390014
184000             SET DP020-MSG-INFORMATIONAL                          18400014
184100                                   TO TRUE                        18410014
184200         END-IF                                                   18420014
184300     END-IF.                                                      18430014
184400                                                                  18440014
184500*----------------------------------------------------------------*18450014
184600*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *18460014
184700*----------------------------------------------------------------*18470014
184800                                                                  18480014
184900 4410-READ-TEMP-STORAGE.                                          18490014
185000                                                                  18500014
185100     EXEC CICS                                                    18510014
185200         READQ TS                                                 18520014
185300             QUEUE (ASC-LIST-QUEUE-NAME)                          18530014
185400             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               18540014
185500             ITEM  (PV-BLOCK-NUMBER)                              18550014
185600             RESP  (PV-CICS-RESP)                                 18560014
185700     END-EXEC.                                                    18570014
185800                                                                  18580014
185900     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       18590014
186000       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     18600014
186100         CONTINUE                                                 18610014
186200     ELSE                                                         18620014
186300         SET DP013-CICS-ABEND      TO TRUE                        18630014
186400         SET DP013-NO-ROLLBACK     TO TRUE                        18640014
186500         MOVE '4410-READ-TEMP-STORAGE'                            18650014
186600                                   TO DP013-PARAGRAPH             18660014
186700         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      18670014
186800                                   TO DP013-MESSAGE-TEXT(1)       18680014
186900         PERFORM DP013-0000-PROCESS-ABEND                         18690014
187000     END-IF.                                                      18700014
187100                                                                  18710014
187200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      18720014
187300                                   TO TRUE.                       18730014
187400                                                                  18740014
187500     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         18750014
187600         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               18760014
187700     END-IF.                                                      18770014
187800                                                                  18780014
187900/                                                                 18790014
188000*----------------------------------------------------------------*18800014
188100*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *18810014
188200*----------------------------------------------------------------*18820014
188300                                                                  18830014
188400 4420-FORMAT-LIST-LINES.                                          18840014
188500                                                                  18850014
188600     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      18860014
188700         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                18870014
188800         MOVE ZEROES     TO MR-STORE-NBR        (PV-SUB)          18880014
188900                            MR-CURR-ALLOC       (PV-SUB)          18890014
189000                            MR-CURR-RCVD        (PV-SUB)          18900014
189100         MOVE SPACES     TO MR-STORE-NAME       (PV-SUB)          18910014
189200                            MR-DC               (PV-SUB)          18920014
189300     ELSE                                                         18930014
189400                                                                  18940014
189500         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           18950014
189600             MOVE ASC-STORE-NBR (ASC-BLK-SUB ASC-ITEM-SUB)        18960014
189700                               TO MR-STORE-NBR (PV-SUB)           18970014
189800             MOVE ASC-STORE-NAME (ASC-BLK-SUB ASC-ITEM-SUB)       18980014
189900                               TO MR-STORE-NAME (PV-SUB)          18990014
190000             MOVE ASC-DC (ASC-BLK-SUB ASC-ITEM-SUB)               19000014
190100                               TO MR-DC (PV-SUB)                  19010014
190200             MOVE ASC-CURR-ALLOC (ASC-BLK-SUB ASC-ITEM-SUB)       19020014
190300                               TO MR-CURR-ALLOC (PV-SUB)          19030014
190400             MOVE ASC-CURR-RCVD  (ASC-BLK-SUB ASC-ITEM-SUB)       19040014
190500                               TO MR-CURR-RCVD  (PV-SUB)          19050014
190600                                                                  19060014
190700         END-IF                                                   19070014
190800     END-IF.                                                      19080014
190900                                                                  19090014
191000     SUBTRACT +1 FROM ASC-ITEM-SUB.                               19100014
191100                                                                  19110014
191200     IF  ASC-ITEM-SUB < + 1                                       19120014
191300         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                19130014
191400         MOVE +1                   TO ASC-BLK-SUB                 19140014
191500     END-IF.                                                      19150014
191600                                                                  19160014
191700*----------------------------------------------------------------*19170014
191800*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *19180014
191900*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *19190014
192000*----------------------------------------------------------------*19200014
192100                                                                  19210014
192200 5100-WRITE-TEMP-STORAGE.                                         19220014
192300                                                                  19230014
192400     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     19240014
192500                                   TO PV-LIST-ITEM-NUMBER.        19250014
192600     COMPUTE PV-BLOCK-NUMBER =                                    19260014
192700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    19270014
192800                                                                  19280014
192900     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             19290014
193000     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             19300014
193100         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      19310014
193200             PERFORM 5105-REWRITE-ASC-LISTQ                       19320014
193300         END-IF                                                   19330014
193400     ELSE                                                         19340014
193500         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       19350014
193600         ASC-HIGHEST-BLOCK-WRITTEN + 1                            19360014
193700         PERFORM 5110-WRITE-ASC-LISTQ                             19370014
193800         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   19380014
193900     END-IF.                                                      19390014
194000                                                                  19400014
194100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      19410014
194200                                   TO TRUE.                       19420014
194300                                                                  19430014
194400/                                                                 19440014
194500*----------------------------------------------------------------*19450014
194600*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *19460014
194700*  SPECIFIC COMMAREA.                                            *19470014
194800*----------------------------------------------------------------*19480014
194900 5105-REWRITE-ASC-LISTQ.                                          19490014
195000                                                                  19500014
195100     EXEC CICS                                                    19510014
195200         WRITEQ TS                                                19520014
195300             QUEUE (ASC-LIST-QUEUE-NAME)                          19530014
195400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19540014
195500             ITEM  (PV-BLOCK-NUMBER)                              19550014
195600             REWRITE                                              19560014
195700             RESP  (PV-CICS-RESP)                                 19570014
195800     END-EXEC.                                                    19580014
195900                                                                  19590014
196000     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           19600014
196100         CONTINUE                                                 19610014
196200     ELSE                                                         19620014
196300         SET DP013-CICS-ABEND      TO TRUE                        19630014
196400         SET DP013-NO-ROLLBACK     TO TRUE                        19640014
196500         MOVE '5105-REWRITE-ASC-LISTQ'                            19650014
196600                                   TO DP013-PARAGRAPH             19660014
196700         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     19670014
196800                                   TO DP013-MESSAGE-TEXT(1)       19680014
196900         PERFORM DP013-0000-PROCESS-ABEND                         19690014
197000     END-IF.                                                      19700014
197100                                                                  19710014
197200/                                                                 19720014
197300*----------------------------------------------------------------*19730014
197400*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *19740014
197500*  SPECIFIC COMMAREA.                                            *19750014
197600*----------------------------------------------------------------*19760014
197700 5110-WRITE-ASC-LISTQ.                                            19770014
197800                                                                  19780014
197900     EXEC CICS                                                    19790014
198000         WRITEQ TS                                                19800014
198100             QUEUE (ASC-LIST-QUEUE-NAME)                          19810014
198200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19820014
198300             ITEM  (PV-BLOCK-NUMBER)                              19830014
198400             RESP  (PV-CICS-RESP)                                 19840014
198500     END-EXEC.                                                    19850014
198600                                                                  19860014
198700     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      19870014
198800         SET DP013-CICS-ABEND      TO TRUE                        19880014
198900         SET DP013-NO-ROLLBACK     TO TRUE                        19890014
199000         MOVE '5110-WRITE-ASC-LISTQ'                              19900014
199100                                   TO DP013-PARAGRAPH             19910014
199200         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           19920014
199300                                   TO DP013-MESSAGE-TEXT(1)       19930014
199400         PERFORM DP013-0000-PROCESS-ABEND                         19940014
199500     END-IF.                                                      19950014
199600                                                                  19960014
199700/                                                                 19970014
199800*----------------------------------------------------------------*19980014
199900*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *19990014
200000*----------------------------------------------------------------*20000014
200100                                                                  20010014
200200 5205-WRITE-SEL-QUEUE.                                            20020014
200300                                                                  20030014
200400     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            20040014
200500                                   TO PO012-SELECTED-ITEMS.       20050014
200600                                                                  20060014
200700     EXEC CICS                                                    20070014
200800          WRITEQ TS                                               20080014
200900              QUEUE (ASC-SEL-QUEUE-NAME)                          20090014
201000              FROM  (PO012-PO-SELECT-RECORD)                      20100014
201100              ITEM  (PV-SEL-QUEUE-ITEM)                           20110014
201200              RESP  (PV-CICS-RESP)                                20120014
201300     END-EXEC.                                                    20130014
201400                                                                  20140014
201500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          20150014
201600         CONTINUE                                                 20160014
201700     ELSE                                                         20170014
201800         SET DP013-CICS-ABEND      TO TRUE                        20180014
201900         SET DP013-NO-ROLLBACK     TO TRUE                        20190014
202000         MOVE '5205-WRITE-SEL-QUEUE'                              20200014
202100                                   TO DP013-PARAGRAPH             20210014
202200         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          20220014
202300                                   TO DP013-MESSAGE-TEXT(1)       20230014
202400         PERFORM DP013-0000-PROCESS-ABEND                         20240014
202500     END-IF.                                                      20250014
202600                                                                  20260014
202700/                                                                 20270014
202800*----------------------------------------------------------------*20280014
202900*    ABEND PROCESSOR MODULE                                      *20290014
203000*----------------------------------------------------------------*20300014
203100                                                                  20310014
203200     COPY DPPD013.                                                20320014
