000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.             TCKRP003.                                00050000
000600 AUTHOR.                 BARB SCHULTZ.                            00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            FEBRUARY 2002.                           00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100***************************************************************** 00110000
001200*                                                               * 00120000
001300*  THIS PROGRAM CREATES THE DAILY DEBIT CARD EXCEPTION REPORT.  * 00130000
001400*                                                               * 00140000
001500*   INPUT: INP01 - MERCHANT ACTIVITY FILE                       * 00150000
001600*          INP02 - COSA FILE                                    * 00160000
001700*          INP02 - DIRECT READ TO TEPTND TABLE                  * 00170000
001800*          INP03 - CONTROL DATE                                 * 00180000
001900*  OUTPUT: RPT01 - REPORT SHOWING ALL DEBIT CARDS THAT ARE      * 00190000
002000*                  EITHER ON THE MERCHANT ACTIVITY FILE AND     * 00200000
002100*                  NOT ON THE COSA FILE OR VICE VERSA.          * 00210000
002200*                                                               * 00220000
002300***************************************************************** 00230000
002400*                                                               * 00240000
002500*  THE PROGRAM COMPARES THE MERCHANT ACTIVITY FILE AND THE COSA * 00250000
002600*  FILE THAT WAS CREATED IN AN EARLIER STEP.  IF THERE ARE ANY  * 00260000
002700*  EXCEPTIONS, THEY WILL BE WRITTEN ON TO THE EXCEPTION REPORT. * 00270000
002800*  ANY MERCHANT ACTIVITY FILE RECORD THAT DOES NOT MATCH WILL BE* 00280000
002900*  WRITTEN OUT TO THE MERCHANT ACTIVITY FILE.  ALL COSA RECORDS * 00290000
003000*  WILL BE WRITTEN OUT TO AN OUTPUT FILE WITH A MATCH FLAG AND  * 00300000
003100*  A OLD/NEW RECORD FLAG.  EXCEPTIONS MUST BE TWO DAYS OLD.     * 00310000
003200*                                                               * 00320000
003300*  A FILE WILL ALSO BE CREATED OF ALL DETAIL RECORDS THAT ARE   * 00330000
003400*  ON THE REPORT.   THIS FILE IS USED IN TCKUP005 TO INSERT     * 00340000
003500*  ROWS TO THE EPT_TNDR_EXC AND EPT_TNDR_EXC_RPT_DTE TABLES.    * 00350000
003600*                                                               * 00360000
003700***************************************************************** 00370000
003800**  CHANGE LOG                                                    00380000
003900***************************************************************** 00390000
004000**  PROD DATE     INITIALS     DESCRIPTION                        00400000
004100**  ----------    --------     ---------------------------------- 00410000
004200**  01/01/2010      MAL        CHANGE PROGRAM VARIABLES           00420000
004300**                             PV-DAY-TOTAL AND                   00430000
004400**                             PV-GRAND-DAY-TOTAL OCCURRENCES     00440000
004500**                             FROM 180 TO 380 TO ACCOMMODATE     00450000
004600**                             RETURNS UP TO 380 DAYS.            00460000
004700**                             INC 1098078.                       00470000
004800**                                                                00480000
004900**  10/18/2012    COGNIZANT    CHANGED THE CONTROL CARD LAYOUT    00490000
005000**                             OF INP03 TO CCYYMMDD CCYYMMDD      00500000
005100**                             FORMAT.                            00510000
005200**                             INTRODUCED NEW CONTROL CARD TO     00520000
005300**                             FETCH THE NEXT POS DATE IN THE     00530000
005400**                             FORMAT CCYYMMDD (TCCC028).         00540000
005500***************************************************************** 00550000
005600*   10/19/2015    COGNIZANT    MODIFIED PROGRAM TO ADD THREE    * 00560000
005700*                              CHARACTER DESCRIPTION TO THE FILE* 00570000
005800*                              BEING PASSED TO TCKRP001 CREATED * 00580000
005900*                              IN TCKRP003 (CHG0124628).        * 00590000
006000*   05/18/2016    ACCENTURE    MODIFIED PROGRAM TO ADD TWO      * 00600000
006100*                              PV VARIABLES TO HOLD LAST 4 DIGIT* 00610000
006200*                              OF TC003 TC002 CARD NUMBERS.     * 00620000
006300*                              3000-KEY-MATCHES PARA AND        * 00630000
006400*                              3700-CHECK-OTHER-CRITERIA ARE    * 00640000
006500*                              CHANGED TO MATCH LAST 4 NBRS     * 00650000
006600*                              CHG0139454                       * 00660000
006700***************************************************************** 00670000
062222*   06/22/2022    DAN PAYNTER  UNMASK THE CARD ACCOUNTS AS SHOWN* 00671000
062222*                              ON THE DEBIT EXCEPTION REPORT    * 00672000
062222*                              CHG0271280                       * 00673000
062222***************************************************************** 00678000
071922*   07/19/2022    DAN PAYNTER  DETOKENIZE THE COSA CARD ACCTS   * 00679002
071922*                              ON THE DEBIT EXCEPTION REPORT    * 00679102
071922*                              CHG0272169                       * 00679202
071922***************************************************************** 00679302
006800 ENVIRONMENT DIVISION.                                            00680000
006900***************************************************************** 00690000
007000                                                                  00700000
007100 CONFIGURATION SECTION.                                           00710000
007200                                                                  00720000
007300 SOURCE-COMPUTER.        IBM-3090.                                00730000
007400                                                                  00740000
007500 OBJECT-COMPUTER.        IBM-3090.                                00750000
007600                                                                  00760000
007700 INPUT-OUTPUT SECTION.                                            00770000
007800                                                                  00780000
007900 FILE-CONTROL.                                                    00790000
008000                                                                  00800000
008100     SELECT MERCHANT-ACTIVITY-IN-FILE                             00810000
008200         ASSIGN TO INP01.                                         00820000
008300                                                                  00830000
008400     SELECT COSA-IN-FILE                                          00840000
008500         ASSIGN TO INP02.                                         00850000
008600                                                                  00860000
008700     SELECT CONTROL-DATE-FILE                                     00870000
008800         ASSIGN TO INP03.                                         00880000
008900                                                                  00890000
009000     SELECT EXCEPT-DAYS-NUMBER-FILE                               00900000
009100         ASSIGN TO INP04.                                         00910000
009200                                                                  00920000
009300     SELECT NXT-POS-DATE-CARD-FILE                                00930000
009400         ASSIGN TO INP05.                                         00940000
009500                                                                  00950000
009600     SELECT DEBIT-EXCEPT-REPORT-FILE                              00960000
009700         ASSIGN TO RPT01.                                         00970000
009800                                                                  00980000
009900     SELECT MERCHANT-ACTIVITY-OUT-FILE                            00990000
010000         ASSIGN TO OUT01.                                         01000000
010100                                                                  01010000
010200     SELECT COSA-OUT-FILE                                         01020000
010300         ASSIGN TO OUT02.                                         01030000
010400                                                                  01040000
010500     SELECT MATCHED-FILE                                          01050000
010600         ASSIGN TO OUT03.                                         01060000
010700                                                                  01070000
010800*  10/28/09 - BJS ADDED THE FOLLOWING 2 LINES FOR NEW FILE        01080000
010900     SELECT EXCEPT-FILE                                           01090000
011000         ASSIGN TO OUT04.                                         01100000
011100                                                                  01110000
011200******************************************************************01120000
011300 DATA DIVISION.                                                   01130000
011400******************************************************************01140000
011500                                                                  01150000
011600 FILE SECTION.                                                    01160000
011700                                                                  01170000
011800 FD  MERCHANT-ACTIVITY-IN-FILE                                    01180000
011900     RECORDING MODE IS F                                          01190000
012000     BLOCK CONTAINS 0 RECORDS                                     01200000
012100     LABEL RECORDS ARE STANDARD.                                  01210000
012200                                                                  01220000
012300 01  MERCHANT-ACTIVITY-IN-RECORD PIC X(80).                       01230000
012400                                                                  01240000
012500 FD  COSA-IN-FILE                                                 01250000
012600     RECORDING MODE IS F                                          01260000
012700     BLOCK CONTAINS 0  RECORDS.                                   01270000
012800                                                                  01280000
012900 01  COSA-IN-RECORD      PIC  X(69).                              01290000
013000                                                                  01300000
013100 FD  CONTROL-DATE-FILE                                            01310000
013200     RECORDING MODE IS F                                          01320000
013300     BLOCK CONTAINS 0 RECORDS                                     01330000
013400     LABEL RECORDS ARE OMITTED.                                   01340000
013500                                                                  01350000
013600 01  CONTROL-DATE-RECORD              PIC X(80).                  01360000
013700                                                                  01370000
013800 FD  EXCEPT-DAYS-NUMBER-FILE                                      01380000
013900     RECORDING MODE IS F                                          01390000
014000     BLOCK CONTAINS 0 RECORDS                                     01400000
014100     LABEL RECORDS ARE OMITTED.                                   01410000
014200                                                                  01420000
014300 01  EXCEPT-DAYS-NUMBER-REC           PIC X(80).                  01430000
014400                                                                  01440000
014500 FD  NXT-POS-DATE-CARD-FILE                                       01450000
014600     RECORDING MODE IS F                                          01460000
014700     BLOCK CONTAINS 0 RECORDS                                     01470000
014800     LABEL RECORDS ARE STANDARD.                                  01480000
014900                                                                  01490000
015000 01  NXT-POS-DATE-CARD-RECORD   PIC X(80).                        01500000
015100*                                                                 01510000
015200*  10/28/09 - BJS ADDED THE FOLLOWING 5 LINES FOR NEW FILE        01520000
015300 FD  DEBIT-EXCEPT-REPORT-FILE                                     01530000
015400     RECORDING MODE IS F                                          01540000
015500     BLOCK CONTAINS 0  RECORDS.                                   01550000
015600                                                                  01560000
015700 01  DEBIT-EXCEPT-REPORT-RECORD PIC  X(132).                      01570000
015800                                                                  01580000
015900 FD  MERCHANT-ACTIVITY-OUT-FILE                                   01590000
016000     RECORDING MODE IS F                                          01600000
016100     BLOCK CONTAINS 0 RECORDS                                     01610000
016200     LABEL RECORDS ARE STANDARD.                                  01620000
016300                                                                  01630000
016400 01  MERCHANT-ACTIVITY-OUT-RECORD PIC X(80).                      01640000
016500                                                                  01650000
016600 FD  COSA-OUT-FILE                                                01660000
016700     RECORDING MODE IS F                                          01670000
016800     BLOCK CONTAINS 0  RECORDS.                                   01680000
016900                                                                  01690000
017000 01  COSA-OUT-RECORD      PIC  X(72).                             01700000
017100                                                                  01710000
017200 FD  MATCHED-FILE                                                 01720000
017300     RECORDING MODE IS F                                          01730000
017400     BLOCK CONTAINS 0  RECORDS.                                   01740000
017500                                                                  01750000
017600 01  MATCHED-RECORD       PIC  X(69).                             01760000
017700                                                                  01770000
017800 FD  EXCEPT-FILE                                                  01780000
017900     RECORDING MODE IS F                                          01790000
018000     BLOCK CONTAINS 0  RECORDS.                                   01800000
018100                                                                  01810000
018200 01  EXCEPT-RECORD        PIC  X(78).                             01820000
018300                                                                  01830000
018400******************************************************************01840000
018500 WORKING-STORAGE SECTION.                                         01850000
018600******************************************************************01860000
018700 01  FILLER                            PIC X(50)  VALUE           01870000
018800     ' *** WORKING STORAGE STARTS HERE FOR TCKRP003 *** '.        01880000
018900                                                                  01890000
019000******************************************************************01900000
019100*    PRINT LINE WORK AREAS / STANDARD HEADER                     *01910000
019200******************************************************************01920000
019300     COPY DPWS132O.                                               01930000
019400                                                                  01940000
019500******************************************************************01950000
019600* RECORD LAYOUT FOR INPUT DATE CARD                              *01960000
019700******************************************************************01970000
019800 01  CC-CONTROL-CARD.                                             01980000
019900     05  CC-CURRENT-DATE.                                         01990000
020000         10  CC-CURRENT-CC       PIC 9(02)    VALUE  ZERO.        02000000
020100         10  CC-CURRENT-YY       PIC 9(02)    VALUE  ZERO.        02010000
020200         10  CC-CURRENT-MM       PIC 9(02)    VALUE  ZERO.        02020000
020300         10  CC-CURRENT-DD       PIC 9(02)    VALUE  ZERO.        02030000
020400     05  FILLER                  PIC X(01)    VALUE SPACE.        02040000
020500     05  CC-PREVIOUS-DATE.                                        02050000
020600         10  CC-PREVIOUS-CC      PIC 9(02)    VALUE  ZERO.        02060000
020700         10  CC-PREVIOUS-YY      PIC 9(02)    VALUE  ZERO.        02070000
020800         10  CC-PREVIOUS-MM      PIC 9(02)    VALUE  ZERO.        02080000
020900         10  CC-PREVIOUS-DD      PIC 9(02)    VALUE  ZERO.        02090000
021000     05  FILLER                  PIC X(63)    VALUE SPACE.        02100000
021100                                                                  02110000
021200******************************************************************02120000
021300* RECORD LAYOUT FOR INPUT EXCEPTION DAYS NUMBER                  *02130000
021400******************************************************************02140000
021500 01  CC-EXCEPT-DAYS-CARD.                                         02150000
021600    05  FILLER                  PIC X(38)    VALUE                02160000
021700        'NUMBER OF EXCEPTION DAYS TO DISPLAY = '.                 02170000
021800    05  CC-EXCEPT-DAYS-NUMBER   PIC 9(03)    VALUE 0.             02180000
021900    05  FILLER                  PIC X(39)    VALUE SPACE.         02190000
022000                                                                  02200000
022100******************************************************************02210000
022200* RECORD LAYOUT FOR INPUT DATE CARD (POS NEXT DATE)              *02220000
022300******************************************************************02230000
022400 01  CC-CONTROL-CARD-INP03.                                       02240000
022500     05  CC-CONTROL-CARD-DISP-INP03.                              02250000
022600         10  CC-CONTROL-NAME-INP03  PIC X(19)    VALUE SPACE.     02260000
022700             88  CC-DATE-CONTROL-NAME-INP03      VALUE            02270000
022800                 'NEXT P.O.S. DATE = '.                           02280000
022900         10  CC-NXT-POS-DATE        PIC 9(08)    VALUE ZERO.      02290000
023000     05  FILLER                     PIC X(53)    VALUE SPACE.     02300000
023100*                                                                 02310000
023200******************************************************************02320000
023300*   ABEND CODE - AND NUMBER FOR EACH POSSIBLE TYPE OF ABEND.     *02330000
023400******************************************************************02340000
023500 01  AC-ABEND-CODE                    PIC S9(04) VALUE ZERO       02350000
023600                                                 COMP SYNC.       02360000
023700     88  AC-CONTROL-CARD-ERROR                   VALUE +4003.     02370000
023800     88  AC-CALENDAR-ROUTINE-ERROR               VALUE +4019.     02380000
023900     88  AC-TABLE-OVERFLOW                       VALUE +4004.     02390000
024000                                                                  02400000
024100 01  ABEND-CODE                       PIC S9(04) VALUE ZERO       02410000
024200                                                 COMP SYNC.       02420000
024300                                                                  02430000
024400 01  SUBSCRIPTS.                                                  02440000
024500     05  SUB                          PIC S9(04) VALUE ZERO       02450000
024600                                                 COMP.            02460000
024700******************************************************************02470000
024800*   PROGRAM SWITCHES                                             *02480000
024900******************************************************************02490000
025000 01  PS-PROGRAM-SWITCHES.                                         02500000
025100     05  PS-END-OF-COSA-CSR-SW         PIC X(01)  VALUE 'N'.      02510000
025200         88  PS-END-OF-COSA-FILE                  VALUE 'Y'.      02520000
025300     05  PS-END-OF-ACT-FILE-SW         PIC X(01)  VALUE 'N'.      02530000
025400         88  PS-END-OF-ACT-FILE                   VALUE 'Y'.      02540000
025500     05  PS-END-OF-CONTROL-FILE-SW     PIC  X(01) VALUE 'N'.      02550000
025600         88  PS-END-OF-CONTROL-FILE               VALUE 'Y'.      02560000
025700     05  PS-END-OF-EXCEPT-FILE-SW      PIC  X(01) VALUE 'N'.      02570000
025800         88  PS-END-OF-EXCEPT-FILE                VALUE 'Y'.      02580000
025900     05  PS-END-OF-NXT-DATE-FILE-SW    PIC X(01)  VALUE 'N'.      02590000
026000         88  PS-END-OF-NXT-DATE-FILE              VALUE 'Y'.      02600000
026100         88  PS-NOT-END-OF-NXT-DATE-FILE          VALUE 'N'.      02610000
026200     05  PS-COSA-SW                    PIC  X(01) VALUE 'N'.      02620000
026300         88  PS-COSA                              VALUE 'Y'.      02630000
026400         88  PS-NO-COSA                           VALUE 'N'.      02640000
026500     05  PS-CHECK-REC-SW               PIC  X(01) VALUE 'Y'.      02650000
026600         88  PS-CHECK-REC                         VALUE 'Y'.      02660000
026700         88  PS-BYPASS-REC                        VALUE 'N'.      02670000
026800     05  PS-DATE-SW                    PIC  X(01) VALUE 'N'.      02680000
026900         88  PS-FOUND-DATE                        VALUE 'Y'.      02690000
027000         88  PS-NOT-FOUND-DATE                    VALUE 'N'.      02700000
027100     05  PS-VOID-SW                    PIC  X(01) VALUE 'N'.      02710000
027200         88  PS-VOID                              VALUE 'Y'.      02720000
027300         88  PS-NOT-VOID                          VALUE 'N'.      02730000
027400     05  PS-PRINT-STORE-TOTALS-SW      PIC  X(01) VALUE 'N'.      02740000
027500         88  PS-PRINT-STORE-TOTALS                VALUE 'Y'.      02750000
027600         88  PS-NO-STORE-TOTALS                   VALUE 'N'.      02760000
027700                                                                  02770000
027800******************************************************************02780000
027900*   PROGRAM CONSTANTS                                            *02790000
028000******************************************************************02800000
028100 01  PC-CONSTANTS.                                                02810000
028200     05  PC-LINE-LIMIT               PIC S9(04)    VALUE +60.     02820000
028300     05  PC-PROGRAM-NAME             PIC X(08)     VALUE          02830000
028400                                                   'TCKRP003'.    02840000
028500     05  PC-REPORT-NBR-1             PIC 9(01)     VALUE 1.       02850000
028600                                                                  02860000
028700******************************************************************02870000
028800*   PROGRAM ACCUMULATERS.                                        *02880000
028900******************************************************************02890000
029000 01  PA-ACCUMULATORS                 COMP-3.                      02900000
029100     05  PA-PAGE-CNT-1               PIC S9(05)    VALUE ZEROES.  02910000
029200     05  PA-LINE-CNT-1               PIC S9(03)    VALUE ZEROES.  02920000
029300     05  PA-PAGE-CNT-2               PIC S9(05)    VALUE ZEROES.  02930000
029400     05  PA-LINE-CNT-2               PIC S9(03)    VALUE ZEROES.  02940000
029500     05  PA-PAGE-CNT-3               PIC S9(05)    VALUE ZEROES.  02950000
029600     05  PA-LINE-CNT-3               PIC S9(03)    VALUE ZEROES.  02960000
029700     05  PA-COSA-FILE-RECS-READ      PIC S9(07)    VALUE ZEROES.  02970000
029800     05  PA-ACT-FILE-RECS-READ       PIC S9(07)    VALUE ZEROES.  02980000
029900     05  PA-LINE-EXCEPT-CNT          PIC  9(07)    VALUE ZEROES.  02990000
030000                                                                  03000000
030100******************************************************************03010000
030200*   PROGRAM VARIABLES.                                           *03020000
030300******************************************************************03030000
030400 01  PV-PROGRAM-VARIABLES.                                        03040000
071922     05  PV-ACCT-LEN                 PIC  9(09) VALUE ZEROES.     03041002
071922     05  PV-ACCT-NBR-19              PIC  X(19) VALUE SPACES.     03043002
030500     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACE.   03050000
030600     05  PV-OPERATION-MSG-1          PIC  X(40) VALUE SPACE.      03060000
030700     05  PV-OPERATION-MSG-2          PIC  X(40) VALUE SPACE.      03070000
030800     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  03080000
030900     05  PV-SLS-DTE                  PIC  X(10) VALUE SPACES.     03090000
031000     05  PV-DAY-BEFORE               PIC  X(08) VALUE SPACES.     03100000
031100     05  PV-PARTN-NBR                PIC  S9(4) VALUE ZEROES COMP.03110000
031200     05  PV-STR-NBR                  PIC  S9(4) VALUE ZEROES COMP.03120000
031300     05  PV-RGST-ID                  PIC  S9(4) VALUE ZEROES COMP.03130000
031400     05  PV-TRN-NBR                  PIC  S9(4) VALUE ZEROES COMP.03140000
031500     05  PV-SAVE-STORE-NBR           PIC  S9(4)    VALUE ZEROES.  03150000
031600     05  PV-EXCEPT-CNT               PIC  S9(5)    VALUE ZEROES.  03160000
031700     05  PV-SAVE-CARD-NBR            PIC  X(16)    VALUE ZEROES.  03170000
031800     05  PV-CARD-NBR-RJ              PIC  X(19) JUST RIGHT.       03180000
031900     05  PV-TC003-CARD-NBR-RJ        PIC  X(19) JUST RIGHT.       03190000
032000     05  PV-TC002-CARD-NBR-RJ        PIC  X(19) JUST RIGHT.       03200000
032100     05  PV-TOTAL-TRAN-AMT           PIC  S9(7)V99 VALUE ZEROES.  03210000
032200     05  PV-TOTAL-TNDR-AMT           PIC  S9(7)V99 VALUE ZEROES.  03220000
032300     05  PV-TOTAL-SALECOR-AMT        PIC  S9(7)V99 VALUE ZEROES.  03230000
032400     05  PV-TOTAL-BANKADJ-AMT        PIC  S9(7)V99 VALUE ZEROES.  03240000
032500     05  PV-TOTAL-VOID-AMT           PIC  S9(7)V99 VALUE ZEROES.  03250000
032600     05  PV-TOTAL-LATE-AMT           PIC  S9(7)V99 VALUE ZEROES.  03260000
032700     05  PV-TOTAL-RETURN-AMT         PIC  S9(7)V99 VALUE ZEROES.  03270000
032800     05  PV-TOTAL-REVERSAL-AMT       PIC  S9(7)V99 VALUE ZEROES.  03280000
032900     05  PV-GRAND-TOTAL-TRAN-AMT     PIC  S9(7)V99 VALUE ZEROES.  03290000
033000     05  PV-GRAND-TOTAL-TNDR-AMT     PIC  S9(7)V99 VALUE ZEROES.  03300000
033100     05  PV-GRAND-TOTAL-SALECOR-AMT  PIC  S9(7)V99 VALUE ZEROES.  03310000
033200     05  PV-GRAND-TOTAL-LATE-AMT     PIC  S9(7)V99 VALUE ZEROES.  03320000
033300     05  PV-GRAND-TOTAL-VOID-AMT     PIC  S9(7)V99 VALUE ZEROES.  03330000
033400     05  PV-GRAND-TOTAL-BANKADJ-AMT  PIC  S9(7)V99 VALUE ZEROES.  03340000
033500     05  PV-GRAND-TOTAL-RETURN-AMT   PIC  S9(7)V99 VALUE ZEROES.  03350000
033600     05  PV-GRAND-TOTAL-REVERSAL-AMT PIC  S9(7)V99 VALUE ZEROES.  03360000
033700     05  PV-REQUEST-MSG-TYP.                                      03370000
033800         10  PV-REQUEST-MSG-TYP-1    PIC  99       VALUE ZEROES.  03380000
033900         10  PV-REQUEST-MSG-TYP-2    PIC  99       VALUE ZEROES.  03390000
034000     05  PV-PROCESSING-CD.                                        03400000
034100         10  PV-PROCESSING-CD-1      PIC  99       VALUE ZEROES.  03410000
034200         10  PV-PROCESSING-CD-2      PIC  9999     VALUE ZEROES.  03420000
034300     05  PV-TWO-DAYS-AGO             PIC  X(10)  VALUE SPACES.    03430000
034400     05  PV-TWO-DAYS-AGO-WOD.                                     03440000
034500         10  PV-CCYY-WOD             PIC  9(04)    VALUE ZEROES.  03450000
034600         10  PV-MM-WOD               PIC  9(02)    VALUE ZEROES.  03460000
034700         10  PV-DD-WOD               PIC  9(02)    VALUE ZEROES.  03470000
034800     05  PV-TWO-DAYS-AGO-WD.                                      03480000
034900         10  PV-CCYY-WD              PIC  9(04)    VALUE ZEROES.  03490000
035000         10  PV-FILLER-1             PIC  X(01)    VALUE '-'.     03500000
035100         10  PV-MM-WD                PIC  9(02)    VALUE ZEROES.  03510000
035200         10  PV-FILLER-2             PIC  X(01)    VALUE '-'.     03520000
035300         10  PV-DD-WD                PIC  9(02)    VALUE ZEROES.  03530000
035400                                                                  03540000
035500*    IF THE NUMBER OF THE OCCURRENCES CHANGES FROM 380            03550000
035600*       CHANGE BOTH TABLES AND INPUT CONTROL CARD TCCC010         03560000
035700                                                                  03570000
035800     05  PV-DAY-TOTAL.                                            03580000
035900         10  PV-DAY-TOTALS OCCURS 380 TIMES                       03590000
036000                        INDEXED BY PV-DAY-IDX.                    03600000
036100             15  PV-DATE                 PIC X(10).               03610000
036200             15  PV-TRAN-AMT             PIC S9(7)V99.            03620000
036300             15  PV-TNDR-AMT             PIC S9(7)V99.            03630000
036400             15  PV-SALECOR-AMT          PIC S9(7)V99.            03640000
036500             15  PV-BANKADJ-AMT          PIC S9(7)V99.            03650000
036600             15  PV-LATE-AMT             PIC S9(7)V99.            03660000
036700             15  PV-VOID-AMT             PIC S9(7)V99.            03670000
036800             15  PV-RETURN-AMT           PIC S9(7)V99.            03680000
036900             15  PV-REVERSAL-AMT         PIC S9(7)V99.            03690000
037000     05  PV-GRAND-DAY-TOTAL.                                      03700000
037100         10  PV-GRAND-TOTALS OCCURS 380 TIMES                     03710000
037200                                    INDEXED BY PV-GRAND-IDX.      03720000
037300             15  PV-GRAND-DATE           PIC X(10).               03730000
037400             15  PV-GRAND-TRAN-AMT       PIC S9(7)V99.            03740000
037500             15  PV-GRAND-TNDR-AMT       PIC S9(7)V99.            03750000
037600             15  PV-GRAND-SALECOR-AMT    PIC S9(7)V99.            03760000
037700             15  PV-GRAND-BANKADJ-AMT    PIC S9(7)V99.            03770000
037800             15  PV-GRAND-LATE-AMT       PIC S9(7)V99.            03780000
037900             15  PV-GRAND-VOID-AMT       PIC S9(7)V99.            03790000
038000             15  PV-GRAND-RETURN-AMT     PIC S9(7)V99.            03800000
038100             15  PV-GRAND-REVERSAL-AMT   PIC S9(7)V99.            03810000
038200                                                                  03820000
038300******************************************************************03830000
038400*   DATE AND TIME FIELDS.                                        *03840000
038500******************************************************************03850000
038600 01  PV-DATE-AND-TIME-FIELDS.                                     03860000
038700     05  PV-HOLD-CCYY.                                            03870000
038800         10  PV-HOLD-CC              PIC 9(02)     VALUE 20.      03880000
038900         10  PV-HOLD-YY              PIC 9(02)     VALUE ZEROES.  03890000
039000     05  PV-POS-CCYYMMDD.                                         03900000
039100         10  PV-POS-CC               PIC 9(02)     VALUE ZEROES.  03910000
039200         10  PV-POS-YY               PIC 9(02)     VALUE ZEROES.  03920000
039300         10  PV-POS-MM               PIC 9(02)     VALUE ZEROES.  03930000
039400         10  PV-POS-DD               PIC 9(02)     VALUE ZEROES.  03940000
039500     05  PV-CURR-DATE-CCYYMMDD.                                   03950000
039600         10  PV-CURR-DATE-CCYY       PIC 9(04)     VALUE ZEROES.  03960000
039700         10  PV-CURR-DATE-MM         PIC 9(02)     VALUE ZEROES.  03970000
039800         10  PV-CURR-DATE-DD         PIC 9(02)     VALUE ZEROES.  03980000
039900     05  PV-CURR-TIME.                                            03990000
040000         10  PV-CURR-TIME-HH         PIC  9(02)    VALUE ZEROES.  04000000
040100         10  PV-CURR-TIME-MM         PIC  9(02)    VALUE ZEROES.  04010000
040200         10  PV-CURR-TIME-SS         PIC  9(02)    VALUE ZEROES.  04020000
040300     05  PV-SPLIT-TIME.                                           04030000
040400         10  PV-SPLIT-TIME-HH        PIC  9(02)    VALUE ZEROES.  04040000
040500         10  PV-SPLIT-TIME-MM        PIC  9(02)    VALUE ZEROES.  04050000
040600         10  PV-SPLIT-TIME-SS        PIC  9(02)    VALUE ZEROES.  04060000
040700     05  PV-SPLIT-TIME-S.                                         04070000
040800         10  PV-TIME-HH-S            PIC  9(02)    VALUE ZEROES.  04080000
040900         10  FILLER                  PIC  X(01)    VALUE ':'.     04090000
041000         10  PV-TIME-MM-S            PIC  9(02)    VALUE ZEROES.  04100000
041100         10  FILLER                  PIC  X(01)    VALUE ':'.     04110000
041200         10  PV-TIME-SS-S            PIC  9(02)    VALUE ZEROES.  04120000
041300     05  PV-SPLIT-TIME-C.                                         04130000
041400         10  PV-TIME-HH-C            PIC  9(02)    VALUE ZEROES.  04140000
041500         10  FILLER                  PIC  X(01)    VALUE '.'.     04150000
041600         10  PV-TIME-MM-C            PIC  9(02)    VALUE ZEROES.  04160000
041700         10  FILLER                  PIC  X(01)    VALUE '.'.     04170000
041800         10  PV-TIME-SS-C            PIC  9(02)    VALUE ZEROES.  04180000
041900     05  PV-SPLIT-DATE.                                           04190000
042000         10  PV-CC-S                 PIC  9(02)    VALUE 20.      04200000
042100         10  PV-YY-S                 PIC  9(02)    VALUE ZEROES.  04210000
042200         10  PV-S1                   PIC  X(01)    VALUE '-'.     04220000
042300         10  PV-MM-S                 PIC  9(02)    VALUE ZEROES.  04230000
042400         10  PV-S2                   PIC  X(01)    VALUE '-'.     04240000
042500         10  PV-DD-S                 PIC  9(02)    VALUE ZEROES.  04250000
042600     05  PV-DB2-DATE REDEFINES PV-SPLIT-DATE PIC X(10).           04260000
042700     05  PV-SPLIT-DATE-CCYYMMDD.                                  04270000
042800         10  PV-SPLIT-DATE-CCYY.                                  04280000
042900             15  PV-SPLIT-DATE-CC    PIC  9(02)    VALUE ZEROES.  04290000
043000             15  PV-SPLIT-DATE-YY    PIC  9(02)    VALUE ZEROES.  04300000
043100         10  PV-SPLIT-DATE-MM        PIC  9(02)    VALUE ZEROES.  04310000
043200         10  PV-SPLIT-DATE-DD        PIC  9(02)    VALUE ZEROES.  04320000
043300     05  PV-TABLE-DATE-CCYYMMDD.                                  04330000
043400         10  PV-TABLE-DATE-CCYY      PIC  9(04)    VALUE ZEROES.  04340000
043500         10  PV-TABLE-DATE-MM        PIC  9(02)    VALUE ZEROES.  04350000
043600         10  PV-TABLE-DATE-DD        PIC  9(02)    VALUE ZEROES.  04360000
043700     05  PV-MDATE-MMDDCCYY.                                       04370000
043800         10  PV-MDATE-MM             PIC  9(02)    VALUE ZEROES.  04380000
043900         10  PV-MDATE-DD             PIC  9(02)    VALUE ZEROES.  04390000
044000         10  PV-MDATE-CCYY           PIC  9(04)    VALUE ZEROES.  04400000
044100     05  PV-SPLIT-MMDD.                                           04410000
044200         10  PV-MM                   PIC  9(02)    VALUE ZEROES.  04420000
044300         10  PV-DD                   PIC  9(02)    VALUE ZEROES.  04430000
044400     05  PV-SPLIT-CCYY.                                           04440000
044500         10  PV-CC                   PIC  9(02)    VALUE ZEROES.  04450000
044600         10  PV-YY                   PIC  9(02)    VALUE ZEROES.  04460000
044700     05  PV-SPLIT-DATE-1.                                         04470000
044800         10  PV-SPLIT-MM             PIC  9(02)    VALUE ZEROES.  04480000
044900         10  PV-SLASH-1              PIC  X(01)    VALUE '/'.     04490000
045000         10  PV-SPLIT-DD             PIC  9(02)    VALUE ZEROES.  04500000
045100         10  PV-SLASH-2              PIC  X(01)    VALUE '/'.     04510000
045200         10  PV-SPLIT-CC             PIC  9(02)    VALUE 20.      04520000
045300         10  PV-SPLIT-YY             PIC  9(02)    VALUE ZEROES.  04530000
045400     05  PV-TRAN-DATE.                                            04540000
045500         10  PV-TRAN-MM              PIC  9(02)    VALUE ZEROES.  04550000
045600         10  PV-SLASH-1              PIC  X(01)    VALUE '/'.     04560000
045700         10  PV-TRAN-DD              PIC  9(02)    VALUE ZEROES.  04570000
045800         10  PV-SLASH-2              PIC  X(01)    VALUE '/'.     04580000
045900         10  PV-TRAN-CCYY            PIC  9(02)    VALUE ZEROES.  04590000
046000     05  PV-WRK-SLS-DATE-CCYYMMDD.                                04600000
046100         10  PV-WRK-SLS-CCYY         PIC  9(04)    VALUE ZEROES.  04610000
046200         10  PV-WRK-SLS-MM           PIC  9(02)    VALUE ZEROES.  04620000
046300         10  PV-WRK-SLS-DD           PIC  9(02)    VALUE ZEROES.  04630000
046400                                                                  04640000
046500     05  PV-ISO-SLS-DATE.                                         04650000
046600         10  PV-ISO-SLS-CCYY         PIC  9(04)    VALUE ZEROES.  04660000
046700         10  PV-ISO-DASH1            PIC  X(01)    VALUE '-'.     04670000
046800         10  PV-ISO-SLS-MM           PIC  9(02)    VALUE ZEROES.  04680000
046900         10  PV-ISO-DASH2            PIC  X(01)    VALUE '-'.     04690000
047000         10  PV-ISO-SLS-DD           PIC  9(02)    VALUE ZEROES.  04700000
047100                                                                  04710000
047200*  USED FOR DUPLICATE FIFTH THIRD RECORDS                         04720000
047300     05  PV-HOLD-MAF.                                             04730000
047400         10  PV-MAF-STORE-NBR        PIC  9(04)  VALUE ZEROES.    04740000
047500         10  PV-MAF-REG-NBR          PIC  9(04)  VALUE ZEROES.    04750000
047600         10  PV-MAF-TRAN-NBR         PIC  9(04)  VALUE ZEROES.    04760000
047700         10  PV-MAF-SLS-DTE          PIC  X(08)  VALUE SPACES.    04770000
047800         10  PV-MAF-CARD-NBR         PIC  X(19)  VALUE SPACES.    04780000
047900*  USED FOR AFTER MIDNIGHT LOGIC                                  04790000
048000     05  PV-HOLD-TC003.                                           04800000
048100         10  PV-HOLD-STORE-NBR       PIC  9(04)  VALUE ZEROES.    04810000
048200         10  PV-HOLD-REG-NBR         PIC  9(04)  VALUE ZEROES.    04820000
048300         10  PV-HOLD-TRAN-NBR        PIC  9(04)  VALUE ZEROES.    04830000
048400         10  PV-HOLD-SLS-DTE         PIC  X(08)  VALUE SPACES.    04840000
048500         10  PV-HOLD-STRT-TM         PIC  X(6)   VALUE SPACES.    04850000
048600         10  PV-HOLD-TRAN-SEQ-NBR    PIC S9(04)  VALUE ZEROES.    04860000
048700         10  PV-HOLD-TRAN-TYPE       PIC  X(02)  VALUE SPACES.    04870000
048800         10  PV-HOLD-TRAN-DISP       PIC  X(01)  VALUE SPACE.     04880000
048900         10  PV-HOLD-CARD-NBR        PIC  X(19)  VALUE SPACES.    04890000
049000         10  PV-HOLD-TRAN-AMT        PIC  S9(7)V99 VALUE ZEROES.  04900000
049100         10  PV-HOLD-TYP-CDE         PIC  X(01)  VALUE SPACE.     04910000
049200         10  PV-HOLD-ADJ-DISP        PIC  X(03)  VALUE SPACES.    04920000
049300         10  PV-HOLD-RESPONSE-CDE    PIC  9(03)  VALUE ZEROES.    04930000
049400         10  PV-HOLD-STATE-CDE       PIC  X(02)  VALUE SPACES.    04940000
049500         10  PV-HOLD-STORE-NAME-ABBR PIC  X(10)  VALUE SPACES.    04950000
049600                                                                  04960000
049700******************************************************************04970000
049800*  TOP OF PAGE HEADING LINE FOR PRINTING A 132 CHARACTER REPORT. *04980000
049900******************************************************************04990000
050000     COPY DPWS132.                                                05000000
050100                                                                  05010000
050200 01  SPACE-LINE.                                                  05020000
050300     05  FILLER                      PIC  X(132)   VALUE SPACES.  05030000
050400                                                                  05040000
071922******************************************************************05041002
071922* LAYOUT THAT DEFINES THE PARAMETERS NEEDED TO INVOKE PROTEGRITY *05042002
071922* MODULE                                                         *05043002
071922******************************************************************05044002
071922     COPY PTYCCSIP.                                               05045002
071922******************************************************************05047002
071922* LAYOUT THAT DEFINES THE WORKING VARIABLES TO INVOKE PROTEGRITY *05048002
071922* MODULE                                                         *05049002
071922******************************************************************05049102
071922     COPY DPWS031.                                                05049202
050500******************************************************************05050000
050600*    STANDARD DB2 ERROR HANDLING AREA                            *05060000
050700******************************************************************05070000
050800     COPY DPWS004.                                                05080000
050900                                                                  05090000
051000******************************************************************05100000
051100*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)            *05110000
051200******************************************************************05120000
051300     COPY DPWS500.                                                05130000
051400                                                                  05140000
051500******************************************************************05150000
051600*    STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA             *05160000
051700******************************************************************05170000
051800     EXEC SQL                                                     05180000
051900          INCLUDE SQLCA                                           05190000
052000     END-EXEC.                                                    05200000
052100                                                                  05210000
052200     COPY SQLCA2.                                                 05220000
052300                                                                  05230000
052400******************************************************************05240000
052500*    STANDARD DB2 DCLGEN FOR THE PARTITION TABLE (TEPPART)       *05250000
052600******************************************************************05260000
052700     EXEC SQL                                                     05270000
052800          INCLUDE TEPPART                                         05280000
052900     END-EXEC.                                                    05290000
053000                                                                  05300000
053100******************************************************************05310000
053200*    STANDARD DB2 DCLGEN FOR THE PARTITION TABLE (TEPTND)        *05320000
053300******************************************************************05330000
053400     EXEC SQL                                                     05340000
053500          INCLUDE TEPTND                                          05350000
053600     END-EXEC.                                                    05360000
053700                                                                  05370000
053800******************************************************************05380000
053900*  HEADING LINES DEBIT EXCEPTION REPORT                          *05390000
054000******************************************************************05400000
054100 01  T1-TITLE-LINE-1.                                             05410000
054200     05  FILLER                      PIC  X(47)    VALUE SPACES.  05420000
054300     05  T1-TITLE                    PIC  X(27)    VALUE          05430000
054400         'DEBIT EXCEPTION REPORT FOR '.                           05440000
054500     05  T1-PROCESS-DTE              PIC  X(10)    VALUE SPACES.  05450000
054600     05  FILLER                      PIC  X(42)    VALUE SPACES.  05460000
054700                                                                  05470000
054800 01  H1-COLUMN-HEADING-1.                                         05480000
054900     05  FILLER                      PIC  X(74)    VALUE SPACES.  05490000
055000     05  FILLER                      PIC  X(06)    VALUE          05500000
055100         'SOURCE'.                                                05510000
055200     05  FILLER                      PIC  X(01)    VALUE SPACES.  05520000
055300     05  FILLER                      PIC  X(04)    VALUE          05530000
055400         'SALE'.                                                  05540000
055500     05  FILLER                      PIC  X(28)    VALUE SPACES.  05550000
055600                                                                  05560000
055700 01  H2-COLUMN-HEADING-1.                                         05570000
055800     05  FILLER                      PIC  X(04)    VALUE SPACES.  05580000
055900     05  FILLER                      PIC  X(04)    VALUE          05590000
056000         'DATE'.                                                  05600000
056100     05  FILLER                      PIC  X(08)    VALUE SPACES.  05610000
056200     05  FILLER                      PIC  X(04)    VALUE          05620000
056300         'TIME'.                                                  05630000
056400     05  FILLER                      PIC  X(05)    VALUE SPACES.  05640000
056500     05  FILLER                      PIC  X(05)    VALUE          05650000
056600         'STORE'.                                                 05660000
056700     05  FILLER                      PIC  X(04)    VALUE SPACES.  05670000
056800     05  FILLER                      PIC  X(03)    VALUE          05680000
056900         'REG'.                                                   05690000
057000     05  FILLER                      PIC  X(05)    VALUE SPACES.  05700000
057100     05  FILLER                      PIC  X(04)    VALUE          05710000
057200         'TRAN'.                                                  05720000
057300     05  FILLER                      PIC  X(07)    VALUE SPACES.  05730000
057400     05  FILLER                      PIC  X(11)    VALUE          05740000
057500         'CARD NUMBER'.                                           05750000
057600     05  FILLER                      PIC  X(11)    VALUE SPACES.  05760000
057700     05  FILLER                      PIC  X(04)    VALUE          05770000
057800         'CODE'.                                                  05780000
057900     05  FILLER                      PIC  X(02)    VALUE SPACES.  05790000
058000     05  FILLER                      PIC  X(04)    VALUE          05800000
058100         'TYPE'.                                                  05810000
058200     05  FILLER                      PIC  X(04)    VALUE SPACES.  05820000
058300     05  FILLER                      PIC  X(05)    VALUE          05830000
058400         'SALES'.                                                 05840000
058500     05  FILLER                      PIC  X(05)    VALUE SPACES.  05850000
058600     05  FILLER                      PIC  X(06)    VALUE          05860000
058700         'REASON'.                                                05870000
058800     05  FILLER                      PIC  X(20)    VALUE SPACES.  05880000
058900                                                                  05890000
059000 01  NO-EXCEPT-LINE.                                              05900000
059100     05  FILLER                      PIC  X(04)    VALUE SPACES.  05910000
059200     05  FILLER                      PIC  X(26)    VALUE          05920000
059300         'NO EXCEPTIONS FOR THIS RUN'.                            05930000
059400     05  FILLER                      PIC  X(102)   VALUE SPACES.  05940000
059500                                                                  05950000
059600******************************************************************05960000
059700*  DETAIL LINE.                                                   05970000
059800******************************************************************05980000
059900 01  D1-DETAIL-LINE-1.                                            05990000
060000     05  FILLER                      PIC  X(01)    VALUE SPACES.  06000000
060100     05  D1-DATE                     PIC  X(10).                  06010000
060200     05  FILLER                      PIC  X(03)    VALUE SPACES.  06020000
060300     05  D1-TIME                     PIC  X(08).                  06030000
060400     05  FILLER                      PIC  X(04)    VALUE SPACES.  06040000
060500     05  D1-STORE                    PIC  X(04).                  06050000
060600     05  FILLER                      PIC  X(04)    VALUE SPACES.  06060000
060700     05  D1-REG                      PIC  X(04).                  06070000
060800     05  FILLER                      PIC  X(04)    VALUE SPACES.  06080000
060900     05  D1-TRAN                     PIC  X(04).                  06090000
061000     05  FILLER                      PIC  X(05)    VALUE SPACES.  06100000
061100     05  D1-CARD                     PIC  X(19).                  06110000
061200     05  FILLER                      PIC  X(06)    VALUE SPACES.  06120000
061300     05  D1-SOURCE-CODE              PIC  X(02).                  06130000
061400     05  FILLER                      PIC  X(04)    VALUE SPACES.  06140000
061500     05  D1-SALE-TYPE                PIC  X(01).                  06150000
061600     05  FILLER                      PIC  X(02)    VALUE SPACES.  06160000
061700     05  D1-SALES-AMT                PIC  ZZZZZZ.99-.             06170000
061800     05  FILLER                      PIC  X(04)    VALUE SPACES.  06180000
061900     05  D1-REASON-CODE              PIC  X(35).                  06190000
062000                                                                  06200000
062100 01  S1-SUB-TOTAL-LINE-1.                                         06210000
062200     05  FILLER                      PIC  X(01)    VALUE SPACES.  06220000
062300     05  FILLER                      PIC  X(16)    VALUE          06230000
062400         'DEBIT BANK TOTAL'.                                      06240000
062500     05  FILLER                      PIC  X(03)    VALUE ' - '.   06250000
062600     05  S1-STORE-NBR                PIC  X(04).                  06260000
062700     05  FILLER                      PIC  X(59)    VALUE SPACES.  06270000
062800     05  S1-SALES-AMT-1              PIC  ZZZZZZZZ.99-.           06280000
062900     05  FILLER                      PIC  X(30)    VALUE SPACES.  06290000
063000                                                                  06300000
063100 01  S2-SUB-TOTAL-LINE-2.                                         06310000
063200     05  FILLER                      PIC  X(01)    VALUE SPACES.  06320000
063300     05  FILLER                      PIC  X(17)    VALUE          06330000
063400         'SALES AUDIT TOTAL'.                                     06340000
063500     05  FILLER                      PIC  X(03)    VALUE ' - '.   06350000
063600     05  S2-STORE-NBR                PIC  X(04).                  06360000
063700     05  FILLER                      PIC  X(58)    VALUE SPACES.  06370000
063800     05  S2-SALES-AMT-2              PIC  ZZZZZZZZ.99-.           06380000
063900     05  FILLER                      PIC  X(27)    VALUE SPACES.  06390000
064000                                                                  06400000
064100 01  S3-SUB-TOTAL-LINE-3.                                         06410000
064200     05  FILLER                      PIC  X(01)    VALUE SPACES.  06420000
064300     05  FILLER                      PIC  X(21)    VALUE          06430000
064400         'BANK ADJUSTMENT TOTAL'.                                 06440000
064500     05  FILLER                      PIC  X(03)    VALUE ' - '.   06450000
064600     05  S3-STORE-NBR                PIC  X(04).                  06460000
064700     05  FILLER                      PIC  X(54)    VALUE SPACES.  06470000
064800     05  S3-SALES-AMT-3              PIC  ZZZZZZZZ.99-.           06480000
064900     05  FILLER                      PIC  X(30)    VALUE SPACES.  06490000
065000                                                                  06500000
065100 01  S4-SUB-TOTAL-LINE-4.                                         06510000
065200     05  FILLER                      PIC  X(01)    VALUE SPACES.  06520000
065300     05  FILLER                      PIC  X(22)    VALUE          06530000
065400         'SALES CORRECTION TOTAL'.                                06540000
065500     05  FILLER                      PIC  X(03)    VALUE ' - '.   06550000
065600     05  S4-STORE-NBR                PIC  X(04).                  06560000
065700     05  FILLER                      PIC  X(53)    VALUE SPACES.  06570000
065800     05  S4-SALES-AMT-4              PIC  ZZZZZZZZ.99-.           06580000
065900     05  FILLER                      PIC  X(44)    VALUE SPACES.  06590000
066000                                                                  06600000
066100 01  S5-SUB-TOTAL-LINE-5.                                         06610000
066200     05  FILLER                      PIC  X(01)    VALUE SPACES.  06620000
066300     05  FILLER                      PIC  X(10)    VALUE          06630000
066400         'LATE TOTAL'.                                            06640000
066500     05  FILLER                      PIC  X(03)    VALUE ' - '.   06650000
066600     05  S5-STORE-NBR                PIC  X(04).                  06660000
066700     05  FILLER                      PIC  X(65)    VALUE SPACES.  06670000
066800     05  S5-SALES-AMT-5              PIC  ZZZZZZZZ.99-.           06680000
066900     05  FILLER                      PIC  X(46)    VALUE SPACES.  06690000
067000                                                                  06700000
067100 01  S6-SUB-TOTAL-LINE-6.                                         06710000
067200     05  FILLER                      PIC  X(01)    VALUE SPACES.  06720000
067300     05  FILLER                      PIC  X(10)    VALUE          06730000
067400         'VOID TOTAL'.                                            06740000
067500     05  FILLER                      PIC  X(03)    VALUE ' - '.   06750000
067600     05  S6-STORE-NBR                PIC  X(04).                  06760000
067700     05  FILLER                      PIC  X(65)    VALUE SPACES.  06770000
067800     05  S6-SALES-AMT-6              PIC  ZZZZZZZZ.99-.           06780000
067900     05  FILLER                      PIC  X(44)    VALUE SPACES.  06790000
068000                                                                  06800000
068100 01  S7-SUB-TOTAL-LINE-7.                                         06810000
068200     05  FILLER                      PIC  X(01)    VALUE SPACES.  06820000
068300     05  FILLER                      PIC  X(14)    VALUE          06830000
068400         'REVERSAL TOTAL'.                                        06840000
068500     05  FILLER                      PIC  X(03)    VALUE ' - '.   06850000
068600     05  S7-STORE-NBR                PIC  X(04).                  06860000
068700     05  FILLER                      PIC  X(61)    VALUE SPACES.  06870000
068800     05  S7-SALES-AMT-7              PIC  ZZZZZZZZ.99-.           06880000
068900     05  FILLER                      PIC  X(44)    VALUE SPACES.  06890000
069000                                                                  06900000
069100 01  S8-SUB-TOTAL-LINE-8.                                         06910000
069200     05  FILLER                      PIC  X(01)    VALUE SPACES.  06920000
069300     05  FILLER                      PIC  X(12)    VALUE          06930000
069400         'RETURN TOTAL'.                                          06940000
069500     05  FILLER                      PIC  X(03)    VALUE ' - '.   06950000
069600     05  S8-STORE-NBR                PIC  X(04).                  06960000
069700     05  FILLER                      PIC  X(63)    VALUE SPACES.  06970000
069800     05  S8-SALES-AMT-8              PIC  ZZZZZZZZ.99-.           06980000
069900     05  FILLER                      PIC  X(44)    VALUE SPACES.  06990000
070000                                                                  07000000
070100 01  G1-GRAND-DAILY-TOTAL-LINE-1.                                 07010000
070200     05  FILLER                      PIC  X(01)    VALUE SPACES.  07020000
070300     05  FILLER                      PIC  X(22)    VALUE          07030000
070400         'GRAND DEBIT BANK TOTAL'.                                07040000
070500     05  FILLER                      PIC  X(04)    VALUE ' - '.   07050000
070600     05  G1-DATE1                    PIC  X(10)    VALUE SPACES.  07060000
070700     05  FILLER                      PIC  X(45)    VALUE SPACES.  07070000
070800     05  G1-SALES-AMT-1              PIC  ZZZZZZZZZ.99-.          07080000
070900     05  FILLER                      PIC  X(27)    VALUE SPACES.  07090000
071000                                                                  07100000
071100 01  G2-GRAND-DAILY-TOTAL-LINE-2.                                 07110000
071200     05  FILLER                      PIC  X(01)    VALUE SPACES.  07120000
071300     05  FILLER                      PIC  X(23)    VALUE          07130000
071400         'GRAND SALES AUDIT TOTAL'.                               07140000
071500     05  FILLER                      PIC  X(04)    VALUE ' - '.   07150000
071600     05  G1-DATE2                    PIC  X(10)    VALUE SPACES.  07160000
071700     05  FILLER                      PIC  X(44)    VALUE SPACES.  07170000
071800     05  G1-SALES-AMT-2              PIC  ZZZZZZZZZ.99-.          07180000
071900     05  FILLER                      PIC  X(27)    VALUE SPACES.  07190000
072000                                                                  07200000
072100 01  G3-GRAND-DAILY-TOTAL-LINE-3.                                 07210000
072200     05  FILLER                      PIC  X(01)    VALUE SPACES.  07220000
072300     05  FILLER                      PIC  X(27)    VALUE          07230000
072400         'GRAND BANK ADJUSTMENT TOTAL'.                           07240000
072500     05  FILLER                      PIC  X(04)    VALUE ' - '.   07250000
072600     05  G1-DATE3                    PIC  X(10)    VALUE SPACES.  07260000
072700     05  FILLER                      PIC  X(40)    VALUE SPACES.  07270000
072800     05  G1-SALES-AMT-3              PIC  ZZZZZZZZZ.99-.          07280000
072900     05  FILLER                      PIC  X(27)    VALUE SPACES.  07290000
073000                                                                  07300000
073100 01  G4-GRAND-DAILY-TOTAL-LINE-4.                                 07310000
073200     05  FILLER                      PIC  X(01)    VALUE SPACES.  07320000
073300     05  FILLER                      PIC  X(28)    VALUE          07330000
073400         'GRAND SALES CORRECTION TOTAL'.                          07340000
073500     05  FILLER                      PIC  X(04)    VALUE ' - '.   07350000
073600     05  G1-DATE4                    PIC  X(10)    VALUE SPACES.  07360000
073700     05  FILLER                      PIC  X(39)    VALUE SPACES.  07370000
073800     05  G1-SALES-AMT-4              PIC  ZZZZZZZZZ.99-.          07380000
073900     05  FILLER                      PIC  X(27)    VALUE SPACES.  07390000
074000                                                                  07400000
074100 01  G5-GRAND-DAILY-TOTAL-LINE-5.                                 07410000
074200     05  FILLER                      PIC  X(01)    VALUE SPACES.  07420000
074300     05  FILLER                      PIC  X(16)    VALUE          07430000
074400         'GRAND LATE TOTAL'.                                      07440000
074500     05  FILLER                      PIC  X(04)    VALUE ' - '.   07450000
074600     05  G1-DATE5                    PIC  X(10)    VALUE SPACES.  07460000
074700     05  FILLER                      PIC  X(51)    VALUE SPACES.  07470000
074800     05  G1-SALES-AMT-5              PIC  ZZZZZZZZZ.99-.          07480000
074900     05  FILLER                      PIC  X(27)    VALUE SPACES.  07490000
075000                                                                  07500000
075100 01  G6-GRAND-DAILY-TOTAL-LINE-6.                                 07510000
075200     05  FILLER                      PIC  X(01)    VALUE SPACES.  07520000
075300     05  FILLER                      PIC  X(16)    VALUE          07530000
075400         'GRAND VOID TOTAL'.                                      07540000
075500     05  FILLER                      PIC  X(04)    VALUE ' - '.   07550000
075600     05  G1-DATE6                    PIC  X(10)    VALUE SPACES.  07560000
075700     05  FILLER                      PIC  X(51)    VALUE SPACES.  07570000
075800     05  G1-SALES-AMT-6              PIC  ZZZZZZZZZ.99-.          07580000
075900     05  FILLER                      PIC  X(27)    VALUE SPACES.  07590000
076000                                                                  07600000
076100 01  G7-GRAND-DAILY-TOTAL-LINE-7.                                 07610000
076200     05  FILLER                      PIC  X(01)    VALUE SPACES.  07620000
076300     05  FILLER                      PIC  X(20)    VALUE          07630000
076400         'GRAND REVERSAL TOTAL'.                                  07640000
076500     05  FILLER                      PIC  X(04)    VALUE ' - '.   07650000
076600     05  G1-DATE7                    PIC  X(10)    VALUE SPACES.  07660000
076700     05  FILLER                      PIC  X(47)    VALUE SPACES.  07670000
076800     05  G1-SALES-AMT-7              PIC  ZZZZZZZZZ.99-.          07680000
076900     05  FILLER                      PIC  X(27)    VALUE SPACES.  07690000
077000                                                                  07700000
077100 01  G8-GRAND-DAILY-TOTAL-LINE-8.                                 07710000
077200     05  FILLER                      PIC  X(01)    VALUE SPACES.  07720000
077300     05  FILLER                      PIC  X(18)    VALUE          07730000
077400         'GRAND RETURN TOTAL'.                                    07740000
077500     05  FILLER                      PIC  X(04)    VALUE ' - '.   07750000
077600     05  G1-DATE8                    PIC  X(10)    VALUE SPACES.  07760000
077700     05  FILLER                      PIC  X(49)    VALUE SPACES.  07770000
077800     05  G1-SALES-AMT-8              PIC  ZZZZZZZZZ.99-.          07780000
077900     05  FILLER                      PIC  X(27)    VALUE SPACES.  07790000
078000                                                                  07800000
078100 01  G1-GRAND-TOTAL-LINE-1.                                       07810000
078200     05  FILLER                      PIC  X(01)    VALUE SPACES.  07820000
078300     05  FILLER                      PIC  X(22)    VALUE          07830000
078400         'GRAND DEBIT BANK TOTAL'.                                07840000
078500     05  FILLER                      PIC  X(59)    VALUE SPACES.  07850000
078600     05  G2-SALES-AMT-1              PIC  ZZZZZZZZZ.99-.          07860000
078700     05  FILLER                      PIC  X(27)    VALUE SPACES.  07870000
078800                                                                  07880000
078900 01  G2-GRAND-TOTAL-LINE-2.                                       07890000
079000     05  FILLER                      PIC  X(01)    VALUE SPACES.  07900000
079100     05  FILLER                      PIC  X(23)    VALUE          07910000
079200         'GRAND SALES AUDIT TOTAL'.                               07920000
079300     05  FILLER                      PIC  X(58)    VALUE SPACES.  07930000
079400     05  G2-SALES-AMT-2              PIC  ZZZZZZZZZ.99-.          07940000
079500     05  FILLER                      PIC  X(27)    VALUE SPACES.  07950000
079600                                                                  07960000
079700 01  G3-GRAND-TOTAL-LINE-3.                                       07970000
079800     05  FILLER                      PIC  X(01)    VALUE SPACES.  07980000
079900     05  FILLER                      PIC  X(27)    VALUE          07990000
080000         'GRAND BANK ADJUSTMENT TOTAL'.                           08000000
080100     05  FILLER                      PIC  X(54)    VALUE SPACES.  08010000
080200     05  G2-SALES-AMT-3              PIC  ZZZZZZZZZ.99-.          08020000
080300     05  FILLER                      PIC  X(27)    VALUE SPACES.  08030000
080400                                                                  08040000
080500 01  G4-GRAND-TOTAL-LINE-4.                                       08050000
080600     05  FILLER                      PIC  X(01)    VALUE SPACES.  08060000
080700     05  FILLER                      PIC  X(28)    VALUE          08070000
080800         'GRAND SALES CORRECTION TOTAL'.                          08080000
080900     05  FILLER                      PIC  X(53)    VALUE SPACES.  08090000
081000     05  G2-SALES-AMT-4              PIC  ZZZZZZZZZ.99-.          08100000
081100     05  FILLER                      PIC  X(27)    VALUE SPACES.  08110000
081200                                                                  08120000
081300 01  G5-GRAND-TOTAL-LINE-5.                                       08130000
081400     05  FILLER                      PIC  X(01)    VALUE SPACES.  08140000
081500     05  FILLER                      PIC  X(28)    VALUE          08150000
081600         'GRAND SALES LATE TOTAL      '.                          08160000
081700     05  FILLER                      PIC  X(53)    VALUE SPACES.  08170000
081800     05  G2-SALES-AMT-5              PIC  ZZZZZZZZZ.99-.          08180000
081900     05  FILLER                      PIC  X(27)    VALUE SPACES.  08190000
082000                                                                  08200000
082100 01  G6-GRAND-TOTAL-LINE-6.                                       08210000
082200     05  FILLER                      PIC  X(01)    VALUE SPACES.  08220000
082300     05  FILLER                      PIC  X(28)    VALUE          08230000
082400         'GRAND SALES VOID TOTAL      '.                          08240000
082500     05  FILLER                      PIC  X(53)    VALUE SPACES.  08250000
082600     05  G2-SALES-AMT-6              PIC  ZZZZZZZZZ.99-.          08260000
082700     05  FILLER                      PIC  X(27)    VALUE SPACES.  08270000
082800                                                                  08280000
082900 01  G7-GRAND-TOTAL-LINE-7.                                       08290000
083000     05  FILLER                      PIC  X(01)    VALUE SPACES.  08300000
083100     05  FILLER                      PIC  X(28)    VALUE          08310000
083200         'GRAND REVERSAL TOTAL        '.                          08320000
083300     05  FILLER                      PIC  X(53)    VALUE SPACES.  08330000
083400     05  G2-SALES-AMT-7              PIC  ZZZZZZZZZ.99-.          08340000
083500     05  FILLER                      PIC  X(27)    VALUE SPACES.  08350000
083600                                                                  08360000
083700 01  G8-GRAND-TOTAL-LINE-8.                                       08370000
083800     05  FILLER                      PIC  X(01)    VALUE SPACES.  08380000
083900     05  FILLER                      PIC  X(28)    VALUE          08390000
084000         'GRAND RETURN TOTAL          '.                          08400000
084100     05  FILLER                      PIC  X(53)    VALUE SPACES.  08410000
084200     05  G2-SALES-AMT-8              PIC  ZZZZZZZZZ.99-.          08420000
084300     05  FILLER                      PIC  X(27)    VALUE SPACES.  08430000
084400                                                                  08440000
084500******************************************************************08450000
084600*  COSA FILE LAYOUT BUILT IN TCKUT002                            *08460000
084700******************************************************************08470000
084800     COPY TCWS002.                                                08480000
084900                                                                  08490000
085000******************************************************************08500000
085100*  COSA FILE OUTPUT BUILT IN THIS PROGRAM                        *08510000
085200******************************************************************08520000
085300 01  PV-COSA-OUT.                                                 08530000
085400     05  PV-PARTN-NBR-OUT        PIC  9(04).                      08540000
085500     05  PV-STR-NBR-OUT          PIC  9(04).                      08550000
085600     05  PV-SLS-DTE-OUT          PIC  X(08).                      08560000
085700     05  PV-STRT-TIME-OUT        PIC  X(06).                      08570000
085800     05  PV-RGST-ID-OUT          PIC  9(04).                      08580000
085900     05  PV-TRN-NBR-OUT          PIC  9(04).                      08590000
086000     05  PV-SLS-CORR-SEQ-NBR-OUT PIC  S9(04).                     08600000
086100     05  PV-TNDR-SEQ-NBR-OUT      PIC  S9(04).                    08610000
086200     05  PV-CARD-NBR-OUT         PIC  X(19).                      08620000
086300     05  PV-TNDR-AMT-OUT         PIC  S9(7)V99.                   08630000
086400     05  PV-MATCH-CDE-OUT        PIC  X(01).                      08640000
086500         88  PV-MATCH-OUT         VALUE 'Y'.                      08650000
086600         88  PV-NOT-MATCHED-OUT   VALUE 'N'.                      08660000
086700     05  PV-SALE-TYPE-OUT        PIC  X(01).                      08670000
086800         88  PV-SALES-CORR-OUT    VALUE 'C'.                      08680000
086900         88  PV-LATE-OUT          VALUE 'L'.                      08690000
087000         88  PV-LATE-VOID-OUT     VALUE 'W'.                      08700000
087100         88  PV-REVERSAL-OUT      VALUE 'R'.                      08710000
087200         88  PV-NORMAL-SALE-OUT   VALUE 'S'.                      08720000
087300         88  PV-RETURN-OUT        VALUE 'X'.                      08730000
087400         88  PV-VOID-OUT          VALUE 'V'.                      08740000
087500     05  PV-REC-IND-OUT          PIC  X(01).                      08750000
087600         88  PV-NEW-RECORD-OUT    VALUE 'N'.                      08760000
087700         88  PV-OLD-RECORD-OUT    VALUE 'O'.                      08770000
087800     05  PV-REASON-CDE           PIC  X(03).                      08780000
087900                                                                  08790000
088000******************************************************************08800000
088100*  MERCHANT ACTIVITY LAYOUT BUILT IN TCKUT001                    *08810000
088200******************************************************************08820000
088300     COPY TCWS003.                                                08830000
088400                                                                  08840000
088500******************************************************************08850000
088600*  EXCEPTION FILE - WILL BE INSERTED INTO A TABLE IN TCKUP005    *08860000
088700******************************************************************08870000
088800     COPY TCRD021.                                                08880000
088900                                                                  08890000
089000***************************************************************** 08900000
089100* PROCEDURE DIVISION.                                           * 08910000
089200***************************************************************** 08920000
089300 PROCEDURE DIVISION.                                              08930000
089400                                                                  08940000
089500******************************************************************08950000
089600* 0000-MAINLINE-PARAGRAPH                                        *08960000
089700*      PRODUCE DAILY DEBIT EXCEPTION REPORT                      *08970000
089800******************************************************************08980000
089900 0000-MAINLINE-PARAGRAPH.                                         08990000
090000                                                                  09000000
090100     PERFORM 1000-INITIALIZE-PROGRAM.                             09010000
090200                                                                  09020000
090300     PERFORM 2000-PROCESS-ACT-DATA                                09030000
090400       UNTIL PS-END-OF-ACT-FILE AND                               09040000
090500             PS-END-OF-COSA-FILE.                                 09050000
090600                                                                  09060000
090700     IF PV-EXCEPT-CNT  = 0                                        09070000
090800         WRITE DEBIT-EXCEPT-REPORT-RECORD                         09080000
090900           FROM NO-EXCEPT-LINE                                    09090000
091000           AFTER ADVANCING 5 LINES                                09100000
091100     END-IF.                                                      09110000
091200                                                                  09120000
091300     PERFORM 6000-STORE-TOTALS.                                   09130000
091400     PERFORM 7000-GRAND-TOTAL-LINE.                               09140000
091500                                                                  09150000
091600     PERFORM 8000-END-PROGRAM.                                    09160000
091700                                                                  09170000
091800     GOBACK.                                                      09180000
091900                                                                  09190000
092000******************************************************************09200000
092100* 1000-INITIALIZE-PROGRAM                                         09210000
092200*  -  OPEN FILES                                                  09220000
092300*  -  FORMAT REPORT HEADINGS                                      09230000
092400*  -  READ 1ST RECORD ON ACT DATA FILE                            09240000
092500*  -  READ 1ST RECORD ON COSA FILE                                09250000
092600******************************************************************09260000
092700 1000-INITIALIZE-PROGRAM.                                         09270000
092800                                                                  09280000
092900     OPEN INPUT  MERCHANT-ACTIVITY-IN-FILE                        09290000
093000                 COSA-IN-FILE                                     09300000
093100                 CONTROL-DATE-FILE                                09310000
093200                 EXCEPT-DAYS-NUMBER-FILE                          09320000
093300                 NXT-POS-DATE-CARD-FILE                           09330000
093400          OUTPUT DEBIT-EXCEPT-REPORT-FILE                         09340000
093500                 MERCHANT-ACTIVITY-OUT-FILE                       09350000
093600                 COSA-OUT-FILE                                    09360000
093700                 MATCHED-FILE                                     09370000
093800                 EXCEPT-FILE.                                     09380000
093900                                                                  09390000
071922     MOVE PC-PROGRAM-NAME  TO DP031-PROGRAM-NAME.                 09391002
071922                                                                  09392002
094000     READ CONTROL-DATE-FILE INTO CC-CONTROL-CARD                  09400000
094100        AT END                                                    09410000
094200           SET PS-END-OF-CONTROL-FILE TO TRUE.                    09420000
094300                                                                  09430000
094400     IF PS-END-OF-CONTROL-FILE                                    09440000
094500        DISPLAY 'DATE CARD MISSING '                              09450000
094600        MOVE '1000-INITIALIZE-PROGRAM ' TO PV-PARAGRAPH-NAME      09460000
094700        SET AC-CONTROL-CARD-ERROR TO TRUE                         09470000
094800        PERFORM 9999-ABEND                                        09480000
094900     ELSE                                                         09490000
095000        DISPLAY PC-PROGRAM-NAME ' CONTROL DATE:  '                09500000
095100             CC-CURRENT-DATE ' ' CC-PREVIOUS-DATE                 09510000
095200        MOVE CC-CURRENT-DATE    TO PV-POS-CCYYMMDD                09520000
095300*  10/28/09 - BJS ADDED THE FOLLOWING 5 LINES FOR NEW FILE        09530000
095400        MOVE PV-POS-MM  TO PV-ISO-SLS-MM                          09540000
095500        MOVE PV-POS-DD  TO PV-ISO-SLS-DD                          09550000
095600        MOVE PV-POS-YY  TO PV-HOLD-YY                             09560000
095700        MOVE PV-HOLD-CCYY TO PV-ISO-SLS-CCYY                      09570000
095800        MOVE PV-ISO-SLS-DATE TO TC021-RPT-DTE                     09580000
095900        MOVE CC-CURRENT-YY   TO PV-SPLIT-YY                       09590000
096000                                PV-YY-S                           09600000
096100        MOVE CC-CURRENT-MM   TO PV-SPLIT-MM                       09610000
096200                                PV-MM-S                           09620000
096300        MOVE CC-CURRENT-DD   TO PV-SPLIT-DD                       09630000
096400                                PV-DD-S                           09640000
096500        MOVE PV-SPLIT-DATE-1 TO T1-PROCESS-DTE                    09650000
096600        PERFORM 8500-SUBTRACT-1-DAY                               09660000
096700     END-IF.                                                      09670000
096800                                                                  09680000
096900     PERFORM 1400-FORMAT-HEADINGS.                                09690000
097000                                                                  09700000
097100     INITIALIZE PV-DAY-TOTAL                                      09710000
097200                PV-GRAND-DAY-TOTAL.                               09720000
097300                                                                  09730000
097400     MOVE ZERO TO  TC002-STR-NBR                                  09740000
097500                   TC002-RGST-ID                                  09750000
097600                   TC002-TRN-NBR                                  09760000
097700                   TC002-CARD-NBR                                 09770000
097800                   TC003-STORE-NBR.                               09780000
097900                                                                  09790000
098000     PERFORM 1200-READ-ACT-DATA-FILE.                             09800000
098100                                                                  09810000
098200     PERFORM 1100-READ-COSA-FILE.                                 09820000
098300                                                                  09830000
098400     MOVE '20'      TO PV-SPLIT-DATE-CC.                          09840000
098500     MOVE PV-POS-YY TO PV-SPLIT-DATE-YY.                          09850000
098600     MOVE PV-POS-MM TO PV-SPLIT-DATE-MM.                          09860000
098700     MOVE PV-POS-DD TO PV-SPLIT-DATE-DD.                          09870000
098800                                                                  09880000
098900     MOVE PV-SPLIT-DATE-CCYYMMDD TO PV-TWO-DAYS-AGO-WOD.          09890000
099000                                                                  09900000
099100     PERFORM 1300-SET-SAVE-STORE-NBR.                             09910000
099200                                                                  09920000
099300     PERFORM 9000-ADD-DATE-2-GRND-TOTAL-TBL.                      09930000
099400                                                                  09940000
099500***************************************************************** 09950000
099600*     READ SORTED COSA FILE                                       09960000
099700***************************************************************** 09970000
099800 1100-READ-COSA-FILE.                                             09980000
099900*    DISPLAY '1100-READ-COSA-FILE'                                09990000
100000     READ COSA-IN-FILE INTO TC002-DATA                            10000000
100100        AT END                                                    10010000
100200           SET PS-END-OF-COSA-FILE TO TRUE                        10020000
100300     END-READ.                                                    10030000
100400                                                                  10040000
100500     IF PS-END-OF-COSA-FILE                                       10050000
100600        CONTINUE                                                  10060000
100700     ELSE                                                         10070000
100800        ADD +1 TO PA-COSA-FILE-RECS-READ                          10080000
071922        PERFORM 6100-PROCESS-RECORDS                              10081002
100900*    CHANGE SIGN FOR RETURNS                                      10090000
101000                                                                  10100000
101100           EVALUATE TC002-SALE-TYPE                               10110000
101200             WHEN 'V'                                             10120000
101300             WHEN 'W'                                             10130000
101400             WHEN 'R'                                             10140000
101500             WHEN 'X'                                             10150000
101600*            WHEN 'C'                                             10160000
101700               COMPUTE TC002-TNDR-AMT = TC002-TNDR-AMT * -1       10170000
101800           END-EVALUATE                                           10180000
101900     END-IF.                                                      10190000
102000                                                                  10200000
102100                                                                  10210000
102200******************************************************************10220000
102300*    READ SORTED ACT-DATA-FILE                                   *10230000
102400******************************************************************10240000
102500 1200-READ-ACT-DATA-FILE.                                         10250000
102600*    DISPLAY '1200-READ-ACT-DATA-FILE.'                           10260000
102700     MOVE TC003-STORE-NBR TO PV-MAF-STORE-NBR.                    10270000
102800     MOVE TC003-REG-NBR   TO PV-MAF-REG-NBR.                      10280000
102900     MOVE TC003-TRAN-NBR  TO PV-MAF-TRAN-NBR.                     10290000
103000     MOVE TC003-SLS-DTE   TO PV-MAF-SLS-DTE.                      10300000
103100     MOVE TC003-CARD-NBR  TO PV-MAF-CARD-NBR.                     10310000
103200                                                                  10320000
103300     READ MERCHANT-ACTIVITY-IN-FILE INTO TC003-MAF-DATA           10330000
103400        AT END                                                    10340000
103500           SET PS-END-OF-ACT-FILE TO TRUE                         10350000
103600     END-READ.                                                    10360000
103700                                                                  10370000
103800     IF PS-END-OF-ACT-FILE                                        10380000
103900        CONTINUE                                                  10390000
104000     ELSE                                                         10400000
104100        ADD +1 TO PA-ACT-FILE-RECS-READ                           10410000
104200     END-IF.                                                      10420000
104300                                                                  10430000
104400******************************************************************10440000
104500* 1300-SET-SAVE-STORE-NBR.                                        10450000
104600*     THIS PARAGRAH SETS THE PV-SAVE-STORE-NBR VARIALE TO THE     10460000
104700*     LOWEST STORE NUMBER ON EITHER THE COSA FILE OR THE MAF FILE.10470000
104800*     IF BOTH FILES ARE AT END, THE PV-SAVE-STORE-NBR IS NOT      10480000
104900*     USED AND THERE IS NO NEED TO SET A VALUE.                   10490000
105000******************************************************************10500000
105100                                                                  10510000
105200 1300-SET-SAVE-STORE-NBR.                                         10520000
105300*    DISPLAY '1300-SET-SAVE-STORE-NBR.'                           10530000
105400                                                                  10540000
105500     IF PS-END-OF-COSA-FILE                                       10550000
105600         IF PS-END-OF-ACT-FILE                                    10560000
105700             CONTINUE                                             10570000
105800         ELSE                                                     10580000
105900             MOVE TC003-STORE-NBR TO PV-SAVE-STORE-NBR            10590000
106000         END-IF                                                   10600000
106100     ELSE                                                         10610000
106200         IF PS-END-OF-ACT-FILE                                    10620000
106300             MOVE TC002-STR-NBR TO PV-SAVE-STORE-NBR              10630000
106400         ELSE                                                     10640000
106500             IF TC003-STORE-NBR < TC002-STR-NBR                   10650000
106600                 MOVE TC003-STORE-NBR TO PV-SAVE-STORE-NBR        10660000
106700             ELSE                                                 10670000
106800                 MOVE TC002-STR-NBR   TO PV-SAVE-STORE-NBR        10680000
106900             END-IF                                               10690000
107000         END-IF                                                   10700000
107100     END-IF.                                                      10710000
107200                                                                  10720000
107300******************************************************************10730000
107400* 1400-FORMAT-HEADINGS                                            10740000
107500*     GET CURRENT DATE AND TIME FROM SYSTEM.                      10750000
107600*     FORMAT REPORT FIELDS IN THE TOP PAGE HEADING LINE.          10760000
107700*     FORMAT HEADING LINE 2 WITH CONVERTED POS DATE.              10770000
107800******************************************************************10780000
107900 1400-FORMAT-HEADINGS.                                            10790000
108000*    DISPLAY '1400-FORMAT-HEADINGS.'                              10800000
108100                                                                  10810000
108200     MOVE FUNCTION CURRENT-DATE (1:8) TO PV-CURR-DATE-CCYYMMDD.   10820000
108300     ACCEPT PV-CURR-TIME FROM TIME.                               10830000
108400                                                                  10840000
108500     MOVE PV-CURR-DATE-MM             TO DP132-RUN-MONTH.         10850000
108600     MOVE PV-CURR-DATE-DD             TO DP132-RUN-DAY.           10860000
108700     MOVE PV-CURR-DATE-CCYY           TO DP132-RUN-YEAR.          10870000
108800                                                                  10880000
108900     MOVE PV-CURR-TIME-HH             TO DP132-RUN-HOUR.          10890000
109000     MOVE PV-CURR-TIME-MM             TO DP132-RUN-MINUTE.        10900000
109100     MOVE PC-PROGRAM-NAME             TO DP132-PROGRAM-NAME.      10910000
109200     MOVE PC-REPORT-NBR-1             TO DP132-REPORT-NUMBER.     10920000
109300                                                                  10930000
109400     PERFORM 4200-WRITE-PAGE-HEADINGS-1.                          10940000
109500                                                                  10950000
109600******************************************************************10960000
109700* DETERMINE IF A PAGE BREAK IS NECESSARY                         *10970000
109800* DETERMINE IF THIS IS AN ADJUSTMENT RECORD, IF SO IS IT A       *10980000
109900*  REQUIRED PAY FORCE, REQUIRED PAY APPROVE, REQUIRED PAY DENIED *10990000
110000* DETERMINE WHAT REASON MESSAGE WILL BE ON THE REPORT            *11000000
110100******************************************************************11010000
110200 2000-PROCESS-ACT-DATA.                                           11020000
110300                                                                  11030000
110400*    DISPLAY '2000-PROCESS-ACT-DATA.'                             11040000
110500     MOVE COSA-IN-RECORD TO PV-COSA-OUT.                          11050000
110600                                                                  11060000
110700     IF PA-LINE-CNT-1 > PC-LINE-LIMIT                             11070000
110800        PERFORM 4200-WRITE-PAGE-HEADINGS-1                        11080000
110900     END-IF.                                                      11090000
111000                                                                  11100000
111100     IF TC003-ADJ-REC                                             11110000
111200      IF TC003-AUTH-PAY OR                                        11120000
111300         TC003-REQ-PAY-FORCE OR                                   11130000
111400         TC003-REQ-PAY-APPR                                       11140000
111500           SET PS-CHECK-REC TO TRUE                               11150000
111600      ELSE                                                        11160000
111700       SET PS-BYPASS-REC TO TRUE                                  11170000
111800       IF PS-END-OF-ACT-FILE                                      11180000
111900          MOVE SPACE TO TC003-SLS-DTE                             11190000
112000       ELSE                                                       11200000
112100          PERFORM 1200-READ-ACT-DATA-FILE                         11210000
112200       END-IF                                                     11220000
112300      END-IF                                                      11230000
112400     ELSE                                                         11240000
112500       IF TC002-SLS-DTE NUMERIC                                   11250000
112600          SET PS-CHECK-REC TO TRUE                                11260000
112700       ELSE                                                       11270000
112800          IF TC003-SLS-DTE NUMERIC                                11280000
112900             MOVE '99999999' TO TC002-SLS-DTE                     11290000
113000             SET PS-CHECK-REC TO TRUE                             11300000
113100          ELSE                                                    11310000
113200             SET PS-BYPASS-REC TO TRUE                            11320000
113300             IF PS-END-OF-ACT-FILE                                11330000
113400                CONTINUE                                          11340000
113500             ELSE                                                 11350000
113600                PERFORM 1200-READ-ACT-DATA-FILE                   11360000
113700             END-IF                                               11370000
113800          END-IF                                                  11380000
113900       END-IF                                                     11390000
114000     END-IF.                                                      11400000
114100                                                                  11410000
114200     IF TC003-SLS-DTE NUMERIC                                     11420000
114300       IF TC003-SLS-DTE > ZERO                                    11430000
114400          MOVE TC003-SLS-DTE TO PV-SPLIT-DATE-CCYYMMDD            11440000
114500          MOVE PV-SPLIT-DATE-CCYY TO PV-SPLIT-CCYY                11450000
114600          MOVE PV-SPLIT-DATE-MM   TO PV-SPLIT-MM                  11460000
114700          MOVE PV-SPLIT-DATE-DD   TO PV-SPLIT-DD                  11470000
114800          MOVE PV-CC              TO PV-SPLIT-CC                  11480000
114900          MOVE PV-YY              TO PV-SPLIT-YY                  11490000
115000       END-IF                                                     11500000
115100     ELSE                                                         11510000
115200       MOVE '99999999' TO TC003-SLS-DTE                           11520000
115300       MOVE '9999'     TO TC003-STORE-NBR                         11530000
115400       MOVE  9999      TO TC003-REG-NBR                           11540000
115500       MOVE  9999      TO TC003-TRAN-NBR                          11550000
115600       SET PS-CHECK-REC TO TRUE                                   11560000
115700     END-IF.                                                      11570000
115800                                                                  11580000
115900     MOVE SPACES        TO D1-SALE-TYPE.                          11590000
116000                                                                  11600000
116100*  TC003 - MAF    TC002 - COSA                                    11610000
116200                                                                  11620000
116300     IF PS-CHECK-REC                                              11630000
116400       IF TC003-STORE-NBR = TC002-STR-NBR                         11640000
116500         IF TC003-SLS-DTE = TC002-SLS-DTE                         11650000
116600           IF TC003-REG-NBR = TC002-RGST-ID                       11660000
116700             IF TC003-TRAN-NBR = TC002-TRN-NBR                    11670000
116800               PERFORM 2600-SALE-TYPE                             11680000
116900             ELSE                                                 11690000
117000               IF TC003-TRAN-NBR > TC002-TRN-NBR                  11700000
117100                 IF TC002-SLS-DTE < PV-TWO-DAYS-AGO-WOD           11710000
117200                   PERFORM 3300-MISSING-BANK-TRAN                 11720000
117300                 ELSE                                             11730000
117400                   PERFORM 3500-NO-MATCH                          11740000
117500                 END-IF                                           11750000
117600               ELSE                                               11760000
117700                 IF TC003-TRAN-NBR < TC002-TRN-NBR                11770000
117800                   PERFORM 3400-MISSING-SA-TRANSACTION            11780000
117900                 END-IF                                           11790000
118000               END-IF                                             11800000
118100             END-IF                                               11810000
118200           ELSE                                                   11820000
118300             IF TC003-REG-NBR > TC002-RGST-ID                     11830000
118400               IF TC002-SLS-DTE < PV-TWO-DAYS-AGO-WOD             11840000
118500                 PERFORM 3300-MISSING-BANK-TRAN                   11850000
118600               ELSE                                               11860000
118700                 PERFORM 3500-NO-MATCH                            11870000
118800               END-IF                                             11880000
118900             ELSE                                                 11890000
119000               IF TC003-REG-NBR < TC002-RGST-ID                   11900000
119100                 PERFORM 3400-MISSING-SA-TRANSACTION              11910000
119200               END-IF                                             11920000
119300             END-IF                                               11930000
119400           END-IF                                                 11940000
119500         ELSE                                                     11950000
119600           IF TC003-SLS-DTE > TC002-SLS-DTE                       11960000
119700             IF TC002-SLS-DTE < PV-TWO-DAYS-AGO-WOD               11970000
119800                PERFORM 3700-CHECK-OTHER-CRITERIA                 11980000
119900                IF PV-MATCH-OUT                                   11990000
120000                   CONTINUE                                       12000000
120100                ELSE                                              12010000
120200                   PERFORM 3300-MISSING-BANK-TRAN                 12020000
120300                END-IF                                            12030000
120400             ELSE                                                 12040000
120500                IF TC002-SLS-DTE = PV-TWO-DAYS-AGO-WOD AND        12050000
120600                   TC002-SALE-TYPE NOT EQUAL 'C'                  12060000
120700                    PERFORM 3550-MAF-AFTER-MIDNIGHT               12070000
120800                ELSE                                              12080000
120900                    PERFORM 3500-NO-MATCH                         12090000
121000                END-IF                                            12100000
121100             END-IF                                               12110000
121200           ELSE                                                   12120000
121300             IF TC003-SLS-DTE < TC002-SLS-DTE AND                 12130000
121400                TC003-SLS-DTE NOT = ZEROES AND                    12140000
121500                TC002-SALE-TYPE NOT EQUAL 'C'                     12150000
121600                PERFORM 3400-MISSING-SA-TRANSACTION               12160000
121700             ELSE                                                 12170000
121800               IF TC003-SLS-DTE = ZEROES                          12180000
121900                 PERFORM 3600-EMPTY-MAF                           12190000
122000               ELSE                                               12200000
122100                 PERFORM 3700-CHECK-OTHER-CRITERIA                12210000
122200                 IF PV-MATCH-OUT                                  12220000
122300                    CONTINUE                                      12230000
122400                 ELSE                                             12240000
122500                    PERFORM 3400-MISSING-SA-TRANSACTION           12250000
122600                 END-IF                                           12260000
122700               END-IF                                             12270000
122800             END-IF                                               12280000
122900           END-IF                                                 12290000
123000         END-IF                                                   12300000
123100       ELSE                                                       12310000
123200         IF TC003-STORE-NBR > TC002-STR-NBR                       12320000
123300           IF TC002-SLS-DTE < PV-TWO-DAYS-AGO-WOD                 12330000
123400             PERFORM 3300-MISSING-BANK-TRAN                       12340000
123500           ELSE                                                   12350000
123600             PERFORM 3500-NO-MATCH                                12360000
123700           END-IF                                                 12370000
123800         ELSE                                                     12380000
123900           IF TC003-STORE-NBR < TC002-STR-NBR                     12390000
124000             IF TC002-SALE-TYPE NOT EQUAL 'C'                     12400000
124100               PERFORM 3400-MISSING-SA-TRANSACTION                12410000
124200             ELSE                                                 12420000
124300               PERFORM 3525-NO-BANK-MATCH                         12430000
124400             END-IF                                               12440000
124500           END-IF                                                 12450000
124600         END-IF                                                   12460000
124700       END-IF                                                     12470000
124800     END-IF.                                                      12480000
124900                                                                  12490000
125000     PERFORM 4800-CHECK-FOR-STORE-CHANGE.                         12500000
125100                                                                  12510000
125200     MOVE SPACES TO D1-REASON-CODE.                               12520000
125300     MOVE 'N' TO PV-MATCH-CDE-OUT.                                12530000
125400                                                                  12540000
125500******************************************************************12550000
125600* END OF COSA FILE                                                12560000
125700******************************************************************12570000
125800 2100-END-OF-COSA.                                                12580000
125900                                                                  12590000
126000*    DISPLAY '2100-END-OF-COSA.'                                  12600000
126100     SET PV-DAY-IDX TO 1.                                         12610000
126200     SET PS-NOT-FOUND-DATE TO TRUE.                               12620000
126300     SEARCH PV-DAY-TOTALS                                         12630000
126400       AT END                                                     12640000
126500         IF PS-NOT-FOUND-DATE                                     12650000
126600            PERFORM 2400-ADD-MAF-DATE-TO-TABLE                    12660000
126700         END-IF                                                   12670000
126800       WHEN PV-DATE (PV-DAY-IDX) = TC003-SLS-DTE                  12680000
126900         IF TC003-MAF-REC                                         12690000
127000            ADD TC003-TRAN-AMT TO PV-TRAN-AMT(PV-DAY-IDX)         12700000
127100         ELSE                                                     12710000
127200            ADD TC003-TRAN-AMT TO PV-BANKADJ-AMT(PV-DAY-IDX)      12720000
127300         END-IF                                                   12730000
127400         SET PS-FOUND-DATE TO TRUE                                12740000
127500     END-SEARCH.                                                  12750000
127600     SET PS-NOT-FOUND-DATE TO TRUE.                               12760000
127700     MOVE TC002-PARTN-NBR TO PV-PARTN-NBR.                        12770000
127800     MOVE TC003-STORE-NBR TO PV-STR-NBR.                          12780000
127900     MOVE TC003-REG-NBR   TO PV-RGST-ID.                          12790000
128000     MOVE TC003-TRAN-NBR  TO PV-TRN-NBR.                          12800000
128100     MOVE 'MISSING SA TRANSACTION' TO D1-REASON-CODE.             12810000
128200*  10/28/09 - BJS ADDED THE FOLLOWING 10 LINES FOR NEW FILE       12820000
128300     MOVE 'MSA'                    TO TC021-REASON-CDE.           12830000
128400****  SINCE DEBIT CARDS HAVE VARIABLE LENGTHS, DEPENDING ON WHAT  12840000
128500****  TYPE OF DEBIT CARD IT IS, IT IS NECESSARY TO RIGHT JUSTIFY  12850000
128600****  THE ACCOUNT NUMBER.  THE SPACES WILL BE TO THE LEFT AND     12860000
128700****  ALL NUMBERS EXCEPT THE LAST 4 WILL BE MASKED (*).           12870000
128800                                                                  12880000
128900     MOVE TC003-CARD-NBR        TO TC021-CARD-NBR.                12890000
062222     MOVE TC003-CARD-NBR(1:19)  TO PV-CARD-NBR-RJ                 12900000
062222                                   D1-CARD.                       12901000
062222*    PERFORM 5100-MASK-CARD-NUMBER.                               12920000
129300     PERFORM 4400-WRITE-ACT-DETAIL-LINE-1.                        12930000
129400     PERFORM 4300-WRITE-BLANK-LINE.                               12940000
129500     SET TC002-NOT-MATCHED TO TRUE.                               12950000
129600     PERFORM 4700-WRITE-UNMATCH-MAF-RECORD.                       12960000
129700     PERFORM 1200-READ-ACT-DATA-FILE.                             12970000
129800                                                                  12980000
129900******************************************************************12990000
130000* END-OF-ACT-FILE                                                 13000000
130100******************************************************************13010000
130200 2200-END-OF-ACT.                                                 13020000
130300*    DISPLAY '2200-END-OF-ACT.'                                   13030000
130400     SET PS-NOT-FOUND-DATE TO TRUE.                               13040000
130500     SET PV-DAY-IDX TO 1.                                         13050000
130600     SEARCH PV-DAY-TOTALS                                         13060000
130700        AT END                                                    13070000
130800           IF PS-NOT-FOUND-DATE                                   13080000
130900              PERFORM 2300-ADD-COSA-DATE-TO-TABLE                 13090000
131000           END-IF                                                 13100000
131100        WHEN PV-DATE (PV-DAY-IDX) = TC002-SLS-DTE                 13110000
131200           EVALUATE TC002-SALE-TYPE                               13120000
131300             WHEN 'V'                                             13130000
131400               COMPUTE TC002-TNDR-AMT = TC002-TNDR-AMT * -1       13140000
131500               ADD TC002-TNDR-AMT TO PV-VOID-AMT(PV-DAY-IDX)      13150000
131600             WHEN 'W'                                             13160000
131700               COMPUTE TC002-TNDR-AMT = TC002-TNDR-AMT * -1       13170000
131800               ADD TC002-TNDR-AMT TO PV-LATE-AMT(PV-DAY-IDX)      13180000
131900             WHEN 'L'                                             13190000
132000               ADD TC002-TNDR-AMT TO PV-LATE-AMT(PV-DAY-IDX)      13200000
132100             WHEN 'R'                                             13210000
132200               COMPUTE TC002-TNDR-AMT = TC002-TNDR-AMT * -1       13220000
132300               ADD TC002-TNDR-AMT TO PV-REVERSAL-AMT(PV-DAY-IDX)  13230000
132400             WHEN 'X'                                             13240000
132500               COMPUTE TC002-TNDR-AMT = TC002-TNDR-AMT * -1       13250000
132600               ADD TC002-TNDR-AMT TO PV-RETURN-AMT(PV-DAY-IDX)    13260000
132700             WHEN 'S'                                             13270000
132800               ADD TC002-TNDR-AMT TO PV-TNDR-AMT(PV-DAY-IDX)      13280000
132900             WHEN 'C'                                             13290000
133000               COMPUTE TC002-TNDR-AMT = TC002-TNDR-AMT * -1       13300000
133100               ADD TC002-TNDR-AMT TO PV-SALECOR-AMT(PV-DAY-IDX)   13310000
133200           END-EVALUATE                                           13320000
133300           SET PS-FOUND-DATE TO TRUE                              13330000
133400     END-SEARCH.                                                  13340000
133500     SET PS-NOT-FOUND-DATE TO TRUE.                               13350000
133600     IF TC002-VOID                                                13360000
133700        CONTINUE                                                  13370000
133800     ELSE                                                         13380000
133900      IF TC002-SLS-DTE < PV-TWO-DAYS-AGO-WOD                      13390000
134000        MOVE 'MISSING BANK TRANSACTION' TO D1-REASON-CODE         13400000
134100        MOVE 'MSB'                      TO TC021-REASON-CDE       13410000
134200        MOVE TC002-SLS-DTE       TO  PV-WRK-SLS-DATE-CCYYMMDD     13420000
134300        MOVE PV-WRK-SLS-CCYY     TO  PV-ISO-SLS-CCYY              13430000
134400        MOVE PV-WRK-SLS-MM       TO  PV-ISO-SLS-MM                13440000
134500        MOVE PV-WRK-SLS-DD       TO  PV-ISO-SLS-DD                13450000
134600        MOVE '-'                 TO  PV-ISO-DASH1                 13460000
134700        MOVE '-'                 TO  PV-ISO-DASH2                 13470000
134800        MOVE PV-ISO-SLS-DATE     TO  PV-SLS-DTE                   13480000
134900        MOVE TC002-STR-NBR       TO  PV-STR-NBR                   13490000
135000        MOVE TC002-RGST-ID       TO  PV-RGST-ID                   13500000
135100        MOVE TC002-TRN-NBR       TO  PV-TRN-NBR                   13510000
135200*  10/28/09 - BJS ADDED THE FOLLOWING 11 LINES FOR NEW FILE       13520000
135300        PERFORM 4100-READ-COSA                                    13530000
135400****  SINCE DEBIT CARDS HAVE VARIABLE LENGTHS, DEPENDING ON WHAT  13540000
135500****  TYPE OF DEBIT CARD IT IS, IT IS NECESSARY TO RIGHT JUSTIFY  13550000
135600****  THE ACCOUNT NUMBER.  THE SPACES WILL BE TO THE LEFT AND     13560000
135700****  ALL NUMBERS EXCEPT THE LAST 4 WILL BE MASKED (*).           13570000
135800                                                                  13580000
135900        MOVE TC002-CARD-NBR TO TC021-CARD-NBR                     13590000
136000        MOVE TC002-CARD-NBR(1:EPTND-TNDR-ID-LEN-NBR)              13600000
136100                                TO PV-CARD-NBR-RJ                 13610000
062222                                   D1-CARD                        13611000
062222*       PERFORM 5000-MASK-CARD-NUMBER                             13630000
136400        PERFORM 4500-WRITE-COSA-DETAIL-LINE-1                     13640000
136500        PERFORM 4300-WRITE-BLANK-LINE                             13650000
136600        SET TC002-NOT-MATCHED TO TRUE                             13660000
136700      END-IF                                                      13670000
136800     END-IF.                                                      13680000
136900     PERFORM 4600-WRITE-COSA-RECORD.                              13690000
137000     PERFORM 1100-READ-COSA-FILE.                                 13700000
137100                                                                  13710000
137200******************************************************************13720000
137300* ADD DATE TO TABLE AND ADD THE COSA SALES AMT TO THE TOTAL      *13730000
137400******************************************************************13740000
137500 2300-ADD-COSA-DATE-TO-TABLE.                                     13750000
137600*    DISPLAY '2300-ADD-COSA-DATE-TO-TABLE.'                       13760000
137700                                                                  13770000
137800     SET PV-DAY-IDX TO 1.                                         13780000
137900     SEARCH  PV-DAY-TOTALS                                        13790000
138000        AT END                                                    13800000
138100           CONTINUE                                               13810000
138200        WHEN PV-DATE (PV-DAY-IDX) = SPACES                        13820000
138300           EVALUATE TC002-SALE-TYPE                               13830000
138400             WHEN 'V'                                             13840000
138500                COMPUTE TC002-TNDR-AMT = TC002-TNDR-AMT * -1      13850000
138600                ADD TC002-TNDR-AMT TO PV-VOID-AMT(PV-DAY-IDX)     13860000
138700             WHEN 'W'                                             13870000
138800                COMPUTE TC002-TNDR-AMT = TC002-TNDR-AMT * -1      13880000
138900                ADD TC002-TNDR-AMT TO PV-LATE-AMT(PV-DAY-IDX)     13890000
139000             WHEN 'L'                                             13900000
139100                ADD TC002-TNDR-AMT TO PV-LATE-AMT(PV-DAY-IDX)     13910000
139200             WHEN 'R'                                             13920000
139300                COMPUTE TC002-TNDR-AMT = TC002-TNDR-AMT * -1      13930000
139400                ADD TC002-TNDR-AMT TO PV-REVERSAL-AMT(PV-DAY-IDX) 13940000
139500             WHEN 'X'                                             13950000
139600                COMPUTE TC002-TNDR-AMT = TC002-TNDR-AMT * -1      13960000
139700                ADD TC002-TNDR-AMT TO PV-RETURN-AMT(PV-DAY-IDX)   13970000
139800             WHEN 'S'                                             13980000
139900                ADD TC002-TNDR-AMT TO PV-TNDR-AMT(PV-DAY-IDX)     13990000
140000             WHEN 'C'                                             14000000
140100                COMPUTE TC002-TNDR-AMT = TC002-TNDR-AMT * -1      14010000
140200                ADD TC002-TNDR-AMT TO PV-SALECOR-AMT(PV-DAY-IDX)  14020000
140300           END-EVALUATE                                           14030000
140400           MOVE TC002-SLS-DTE TO PV-DATE(PV-DAY-IDX)              14040000
140500     END-SEARCH.                                                  14050000
140600                                                                  14060000
140700******************************************************************14070000
140800* ADD DATE TO TABLE AND ADD THE MAF SALES AMT TO THE TOTAL       *14080000
140900******************************************************************14090000
141000 2400-ADD-MAF-DATE-TO-TABLE.                                      14100000
141100                                                                  14110000
141200*    DISPLAY '2400-ADD-MAF-DATE-TO-TABLE.'                        14120000
141300     SET PV-DAY-IDX TO 1.                                         14130000
141400     SEARCH  PV-DAY-TOTALS                                        14140000
141500        AT END                                                    14150000
141600           CONTINUE                                               14160000
141700        WHEN PV-DATE (PV-DAY-IDX) = SPACES OR LOW-VALUES          14170000
141800           MOVE TC003-SLS-DTE TO PV-DATE(PV-DAY-IDX)              14180000
141900           IF TC003-MAF-REC                                       14190000
142000             ADD TC003-TRAN-AMT TO PV-TRAN-AMT(PV-DAY-IDX)        14200000
142100           ELSE                                                   14210000
142200             ADD TC003-TRAN-AMT TO PV-BANKADJ-AMT(PV-DAY-IDX)     14220000
142300           END-IF                                                 14230000
142400     END-SEARCH.                                                  14240000
142500                                                                  14250000
142600******************************************************************14260000
142700* ADD THE STORE TOTALS TO THE GRAND TOTALS IN THE CORRECT DAY    *14270000
142800******************************************************************14280000
142900 2500-ADD-STR-BY-DAY.                                             14290000
143000                                                                  14300000
143100     IF  PV-GRAND-DATE (PV-GRAND-IDX) = PV-DATE(PV-DAY-IDX)       14310000
143200         ADD  PV-TRAN-AMT(PV-DAY-IDX)                             14320000
143300                       TO PV-GRAND-TRAN-AMT(PV-GRAND-IDX)         14330000
143400         ADD  PV-TNDR-AMT(PV-DAY-IDX)                             14340000
143500                       TO PV-GRAND-TNDR-AMT(PV-GRAND-IDX)         14350000
143600         ADD  PV-SALECOR-AMT(PV-DAY-IDX)                          14360000
143700                       TO PV-GRAND-SALECOR-AMT(PV-GRAND-IDX)      14370000
143800         ADD  PV-BANKADJ-AMT(PV-DAY-IDX)                          14380000
143900                       TO PV-GRAND-BANKADJ-AMT(PV-GRAND-IDX)      14390000
144000         ADD  PV-VOID-AMT(PV-DAY-IDX)                             14400000
144100                       TO PV-GRAND-VOID-AMT(PV-GRAND-IDX)         14410000
144200         ADD  PV-LATE-AMT(PV-DAY-IDX)                             14420000
144300                       TO PV-GRAND-LATE-AMT(PV-GRAND-IDX)         14430000
144400         ADD  PV-REVERSAL-AMT(PV-DAY-IDX)                         14440000
144500                       TO PV-GRAND-REVERSAL-AMT(PV-GRAND-IDX)     14450000
144600         ADD  PV-RETURN-AMT(PV-DAY-IDX)                           14460000
144700                       TO PV-GRAND-RETURN-AMT(PV-GRAND-IDX)       14470000
144800         SET PV-DAY-IDX         UP BY +1                          14480000
144900         SET PV-GRAND-IDX       TO +1                             14490000
145000     ELSE                                                         14500000
145100         SET PV-GRAND-IDX      UP BY +1                           14510000
145200     END-IF.                                                      14520000
145300                                                                  14530000
145400******************************************************************14540000
145500*    CHECK THAT MAF RECORD AND COSA RECORD HAVE MATCHING         *14550000
145600*    SALE TRANSACTION TYPES.                                     *14560000
145700******************************************************************14570000
145800 2600-SALE-TYPE.                                                  14580000
145900                                                                  14590000
146000*    DISPLAY '2600-SALE-TYPE.'                                    14600000
146100     EVALUATE TC002-SALE-TYPE                                     14610000
146200       WHEN 'V'                                                   14620000
146300       WHEN 'X'                                                   14630000
146400           IF TC003-TRAN-TYPE = '06'                              14640000
146500               PERFORM 3000-KEY-MATCHES                           14650000
146600           ELSE                                                   14660000
146700               PERFORM 3800-MISMATCH-ON-SALE-TYPE                 14670000
146800           END-IF                                                 14680000
146900       WHEN 'S'                                                   14690000
147000       WHEN 'L'                                                   14700000
147100       WHEN 'C'                                                   14710000
147200           IF TC003-TRAN-TYPE = '05'                              14720000
147300               PERFORM 3000-KEY-MATCHES                           14730000
147400           ELSE                                                   14740000
147500               PERFORM 3800-MISMATCH-ON-SALE-TYPE                 14750000
147600           END-IF                                                 14760000
147700       WHEN OTHER                                                 14770000
147800           PERFORM 3000-KEY-MATCHES                               14780000
147900     END-EVALUATE.                                                14790000
148000                                                                  14800000
148100******************************************************************14810000
148200*    LOGIC FOR IF DATE, STORE, REGISTER AND TRANSACTION NUMBER   *14820000
148300*    MATCHES                                                     *14830000
148400******************************************************************14840000
148500 3000-KEY-MATCHES.                                                14850000
148600                                                                  14860000
148700*    DISPLAY '3000-KEY-MATCHES.'                                  14870000
148800     IF TC003-TRAN-AMT = TC002-TNDR-AMT                           14880000
148900*       IF TC003-CARD-NBR = TC002-CARD-NBR                        14890000
149000        MOVE TC003-CARD-NBR  TO PV-TC003-CARD-NBR-RJ              14900000
149100        MOVE TC002-CARD-NBR  TO PV-TC002-CARD-NBR-RJ              14910000
149200        IF PV-TC003-CARD-NBR-RJ(16:4) = PV-TC002-CARD-NBR-RJ(16:4)14920000
149300            SET PV-MATCH-OUT TO TRUE                              14930000
149400            PERFORM 4600-WRITE-COSA-RECORD                        14940000
149500            IF PV-DAY-BEFORE = TC002-SLS-DTE                      14950000
149600               PERFORM 4650-WRITE-MATCHED-RECORD                  14960000
149700            END-IF                                                14970000
149800            IF PS-END-OF-ACT-FILE                                 14980000
149900               CONTINUE                                           14990000
150000            ELSE                                                  15000000
150100               PERFORM 1200-READ-ACT-DATA-FILE                    15010000
150200            END-IF                                                15020000
150300            IF PS-END-OF-COSA-FILE                                15030000
150400               CONTINUE                                           15040000
150500            ELSE                                                  15050000
150600               PERFORM 1100-READ-COSA-FILE                        15060000
150700            END-IF                                                15070000
150800        ELSE                                                      15080000
150900            PERFORM 3100-SEARCH-DAY-TOTALS-COSA                   15090000
151000            SET PS-NOT-FOUND-DATE TO TRUE                         15100000
151100            MOVE 'CARD NUMBER DIFFERENT' TO D1-REASON-CODE        15110000
151200            MOVE 'CRD'                   TO TC021-REASON-CDE      15120000
062222            MOVE TC002-CARD-NBR     TO D1-CARD                    15130000
151400*  10/28/09 - BJS ADDED THE FOLLOWING 10 LINES FOR NEW FILE       15140000
151500****  SINCE DEBIT CARDS HAVE VARIABLE LENGTHS, DEPENDING ON WHAT  15150000
151600****  TYPE OF DEBIT CARD IT IS, IT IS NECESSARY TO RIGHT JUSTIFY  15160000
151700****  THE ACCOUNT NUMBER.  THE SPACES WILL BE TO THE LEFT AND     15170000
151800****  ALL NUMBERS EXCEPT THE LAST 4 WILL BE MASKED (*).           15180000
151900                                                                  15190000
152000            MOVE TC002-CARD-NBR TO TC021-CARD-NBR                 15200000
152100            MOVE TC002-CARD-NBR(1:19)                             15210000
152200                                TO PV-CARD-NBR-RJ                 15220000
062222                                   D1-CARD                        15221000
062222*           PERFORM 5100-MASK-CARD-NUMBER                         15230000
152400            PERFORM 4500-WRITE-COSA-DETAIL-LINE-1                 15240000
152500            SET TC002-NOT-MATCHED TO TRUE                         15250000
152600            PERFORM 4600-WRITE-COSA-RECORD                        15260000
152700*  10/28/09 - BJS ADDED THE FOLLOWING 4 LINES FOR NEW FILE        15270000
152800            MOVE TC003-CARD-NBR TO TC021-CARD-NBR                 15280000
152900            MOVE TC003-CARD-NBR(1:19)                             15290000
153000                              TO PV-CARD-NBR-RJ                   15300000
062222                                 D1-CARD                          15301000
062222*           PERFORM 5100-MASK-CARD-NUMBER                         15310000
153200            IF PS-END-OF-COSA-FILE                                15320000
153300                PERFORM 1200-READ-ACT-DATA-FILE                   15330000
153400            ELSE                                                  15340000
153500                PERFORM 1100-READ-COSA-FILE                       15350000
153600            END-IF                                                15360000
153700            PERFORM 3200-SEARCH-DAY-TOTALS-MAF                    15370000
153800            MOVE 'CARD NUMBER DIFFERENT' TO D1-REASON-CODE        15380000
153900            MOVE 'CRD'                   TO TC021-REASON-CDE      15390000
154000            PERFORM 4400-WRITE-ACT-DETAIL-LINE-1                  15400000
154100            PERFORM 4300-WRITE-BLANK-LINE                         15410000
154200            SET TC002-NOT-MATCHED TO TRUE                         15420000
154300            PERFORM 4700-WRITE-UNMATCH-MAF-RECORD                 15430000
154400            IF PS-END-OF-ACT-FILE                                 15440000
154500                PERFORM 1100-READ-COSA-FILE                       15450000
154600            ELSE                                                  15460000
154700                PERFORM 1200-READ-ACT-DATA-FILE                   15470000
154800            END-IF                                                15480000
154900        END-IF                                                    15490000
155000     ELSE                                                         15500000
155100        IF TC003-MAF-REC                                          15510000
155200          MOVE 'SALES AMOUNT DIFFERS' TO D1-REASON-CODE           15520000
155300          MOVE 'AMT'                  TO TC021-REASON-CDE         15530000
155400          PERFORM 3200-SEARCH-DAY-TOTALS-MAF                      15540000
155500          PERFORM 3100-SEARCH-DAY-TOTALS-COSA                     15550000
155600          SET PS-NOT-FOUND-DATE TO TRUE                           15560000
155700*  10/28/09 - BJS ADDED THE FOLLOWING 9 LINES FOR NEW FILE        15570000
155800****  SINCE DEBIT CARDS HAVE VARIABLE LENGTHS, DEPENDING ON WHAT  15580000
155900****  TYPE OF DEBIT CARD IT IS, IT IS NECESSARY TO RIGHT JUSTIFY  15590000
156000****  THE ACCOUNT NUMBER.  THE SPACES WILL BE TO THE LEFT AND     15600000
156100****  ALL NUMBERS EXCEPT THE LAST 4 WILL BE MASKED (*).           15610000
156200                                                                  15620000
156300          MOVE TC003-CARD-NBR TO TC021-CARD-NBR                   15630000
156400          MOVE TC003-CARD-NBR(1:19)                               15640000
156500                                TO PV-CARD-NBR-RJ                 15650000
062222                                   D1-CARD                        15651000
062222*         PERFORM 5100-MASK-CARD-NUMBER                           15660000
156700          PERFORM 4500-WRITE-COSA-DETAIL-LINE-1                   15670000
156800          PERFORM 4400-WRITE-ACT-DETAIL-LINE-1                    15680000
156900          PERFORM 4300-WRITE-BLANK-LINE                           15690000
157000          SET TC002-NOT-MATCHED TO TRUE                           15700000
157100          PERFORM 4600-WRITE-COSA-RECORD                          15710000
157200          PERFORM 4700-WRITE-UNMATCH-MAF-RECORD                   15720000
157300          IF PS-END-OF-ACT-FILE                                   15730000
157400             CONTINUE                                             15740000
157500          ELSE                                                    15750000
157600             PERFORM 1200-READ-ACT-DATA-FILE                      15760000
157700          END-IF                                                  15770000
157800          IF PS-END-OF-COSA-FILE                                  15780000
157900             CONTINUE                                             15790000
158000          ELSE                                                    15800000
158100             PERFORM 1100-READ-COSA-FILE                          15810000
158200*********** 07-27-09 MAB  (INC000000868842)                       15820000
158300*********** ADDED THE MISSING END-IF BELOW.                       15830000
158400          END-IF                                                  15840000
158500        ELSE                                                      15850000
158600          MOVE 'UNMATCHED ADJUSTMENT' TO D1-REASON-CODE           15860000
158700*  10/28/09 - BJS ADDED THE FOLLOWING LINE FOR NEW FILE           15870000
158800          MOVE 'UNA'                  TO TC021-REASON-CDE         15880000
158900*         IF TC003-CARD-NBR = TC002-CARD-NBR                      15890000
159000          MOVE TC003-CARD-NBR  TO PV-TC003-CARD-NBR-RJ            15900000
159100          MOVE TC002-CARD-NBR  TO PV-TC002-CARD-NBR-RJ            15910000
159200          IF PV-TC003-CARD-NBR-RJ(16:4) =                         15920000
159300                                   PV-TC002-CARD-NBR-RJ(16:4)     15930000
159400              SET PV-MATCH-OUT TO TRUE                            15940000
159500              PERFORM 4600-WRITE-COSA-RECORD                      15950000
159600              IF PS-END-OF-ACT-FILE                               15960000
159700                 CONTINUE                                         15970000
159800              ELSE                                                15980000
159900                 PERFORM 1200-READ-ACT-DATA-FILE                  15990000
160000              END-IF                                              16000000
160100              IF PS-END-OF-COSA-FILE                              16010000
160200                 CONTINUE                                         16020000
160300              ELSE                                                16030000
160400                 PERFORM 1100-READ-COSA-FILE                      16040000
160500              END-IF                                              16050000
160600          ELSE                                                    16060000
160700              PERFORM 3100-SEARCH-DAY-TOTALS-COSA                 16070000
160800              SET PS-NOT-FOUND-DATE TO TRUE                       16080000
160900              MOVE 'CARD NUMBER DIFFERENT' TO D1-REASON-CODE      16090000
161000*  10/28/09 - BJS ADDED THE FOLLOWING 11 LINES FOR NEW FILE       16100000
161100              MOVE 'CRD'                   TO TC021-REASON-CDE    16110000
062222              MOVE TC002-CARD-NBR     TO D1-CARD                  16120000
161300****  SINCE DEBIT CARDS HAVE VARIABLE LENGTHS, DEPENDING ON WHAT  16130000
161400****  TYPE OF DEBIT CARD IT IS, IT IS NECESSARY TO RIGHT JUSTIFY  16140000
161500****  THE ACCOUNT NUMBER.  THE SPACES WILL BE TO THE LEFT AND     16150000
161600****  ALL NUMBERS EXCEPT THE LAST 4 WILL BE MASKED (*).           16160000
161700                                                                  16170000
161800              MOVE TC002-CARD-NBR TO TC021-CARD-NBR               16180000
161900              MOVE TC002-CARD-NBR(1:19)                           16190000
162000                                TO PV-CARD-NBR-RJ                 16200000
062222                                   D1-CARD                        16201000
062222*             PERFORM 5100-MASK-CARD-NUMBER                       16210000
162200              PERFORM 4500-WRITE-COSA-DETAIL-LINE-1               16220000
162300              SET TC002-NOT-MATCHED TO TRUE                       16230000
162400              PERFORM 4600-WRITE-COSA-RECORD                      16240000
162500              IF PS-END-OF-COSA-FILE                              16250000
162600                  PERFORM 1200-READ-ACT-DATA-FILE                 16260000
162700              ELSE                                                16270000
162800                  PERFORM 1100-READ-COSA-FILE                     16280000
162900              END-IF                                              16290000
163000              PERFORM 3200-SEARCH-DAY-TOTALS-MAF                  16300000
163100              MOVE 'CARD NUMBER DIFFERENT' TO D1-REASON-CODE      16310000
163200*  10/28/09 - BJS ADDED THE FOLLOWING LINE FOR NEW FILE           16320000
163300              MOVE 'CRD'                   TO TC021-REASON-CDE    16330000
163400              PERFORM 4400-WRITE-ACT-DETAIL-LINE-1                16340000
163500              PERFORM 4300-WRITE-BLANK-LINE                       16350000
163600              SET TC002-NOT-MATCHED TO TRUE                       16360000
163700              PERFORM 4700-WRITE-UNMATCH-MAF-RECORD               16370000
163800              IF PS-END-OF-ACT-FILE                               16380000
163900                  PERFORM 1100-READ-COSA-FILE                     16390000
164000              ELSE                                                16400000
164100                  PERFORM 1200-READ-ACT-DATA-FILE                 16410000
164200              END-IF                                              16420000
164300          END-IF                                                  16430000
164400        END-IF                                                    16440000
164500     END-IF.                                                      16450000
164600                                                                  16460000
164700******************************************************************16470000
164800*    SEARCH THROUGH DAY TOTALS FOR CORRECT DAY AND ADD TO COSA   *16480000
164900*     TOTALS                                                     *16490000
165000******************************************************************16500000
165100 3100-SEARCH-DAY-TOTALS-COSA.                                     16510000
165200                                                                  16520000
165300*    DISPLAY '3100-SEARCH-DAY-TOTALS-COSA.'                       16530000
165400     SET PS-NOT-FOUND-DATE TO TRUE                                16540000
165500     SET PV-DAY-IDX TO 1                                          16550000
165600     SEARCH PV-DAY-TOTALS                                         16560000
165700       AT END                                                     16570000
165800         IF PS-NOT-FOUND-DATE                                     16580000
165900            PERFORM 2300-ADD-COSA-DATE-TO-TABLE                   16590000
166000         END-IF                                                   16600000
166100       WHEN PV-DATE (PV-DAY-IDX) = TC002-SLS-DTE                  16610000
166200         EVALUATE TC002-SALE-TYPE                                 16620000
166300            WHEN 'V'                                              16630000
166400               COMPUTE TC002-TNDR-AMT = TC002-TNDR-AMT * -1       16640000
166500               ADD TC002-TNDR-AMT TO PV-VOID-AMT(PV-DAY-IDX)      16650000
166600            WHEN 'W'                                              16660000
166700               COMPUTE TC002-TNDR-AMT = TC002-TNDR-AMT * -1       16670000
166800               ADD TC002-TNDR-AMT TO PV-LATE-AMT(PV-DAY-IDX)      16680000
166900            WHEN 'L'                                              16690000
167000               ADD TC002-TNDR-AMT TO PV-LATE-AMT(PV-DAY-IDX)      16700000
167100            WHEN 'R'                                              16710000
167200               COMPUTE TC002-TNDR-AMT = TC002-TNDR-AMT * -1       16720000
167300               ADD TC002-TNDR-AMT TO PV-REVERSAL-AMT(PV-DAY-IDX)  16730000
167400            WHEN 'X'                                              16740000
167500               COMPUTE TC002-TNDR-AMT = TC002-TNDR-AMT * -1       16750000
167600               ADD TC002-TNDR-AMT TO PV-RETURN-AMT(PV-DAY-IDX)    16760000
167700            WHEN 'S'                                              16770000
167800               ADD TC002-TNDR-AMT TO PV-TNDR-AMT(PV-DAY-IDX)      16780000
167900            WHEN 'C'                                              16790000
168000               COMPUTE TC002-TNDR-AMT = TC002-TNDR-AMT * -1       16800000
168100               ADD TC002-TNDR-AMT TO PV-SALECOR-AMT(PV-DAY-IDX)   16810000
168200         END-EVALUATE                                             16820000
168300         SET PS-FOUND-DATE TO TRUE                                16830000
168400     END-SEARCH.                                                  16840000
168500                                                                  16850000
168600******************************************************************16860000
168700*  SEARCH THROUGH DAY TOTALS AND ADD TO MAF TOTALS               *16870000
168800******************************************************************16880000
168900 3200-SEARCH-DAY-TOTALS-MAF.                                      16890000
169000                                                                  16900000
169100*    DISPLAY '3200-SEARCH-DAY-TOTALS-MAF.'                        16910000
169200     SET PS-NOT-FOUND-DATE TO TRUE.                               16920000
169300     SET PV-DAY-IDX TO 1.                                         16930000
169400     SEARCH PV-DAY-TOTALS                                         16940000
169500        AT END                                                    16950000
169600          IF PS-NOT-FOUND-DATE                                    16960000
169700             PERFORM 2400-ADD-MAF-DATE-TO-TABLE                   16970000
169800          END-IF                                                  16980000
169900        WHEN PV-DATE (PV-DAY-IDX) = TC003-SLS-DTE                 16990000
170000          IF TC003-MAF-REC                                        17000000
170100             ADD TC003-TRAN-AMT TO PV-TRAN-AMT(PV-DAY-IDX)        17010000
170200          ELSE                                                    17020000
170300             ADD TC003-TRAN-AMT TO PV-BANKADJ-AMT(PV-DAY-IDX)     17030000
170400          END-IF                                                  17040000
170500          SET PS-FOUND-DATE TO TRUE                               17050000
170600     END-SEARCH.                                                  17060000
170700                                                                  17070000
170800******************************************************************17080000
170900*   MISSING BANK TRANSACTION                                     *17090000
171000******************************************************************17100000
171100 3300-MISSING-BANK-TRAN.                                          17110000
171200                                                                  17120000
171300*    DISPLAY '3300-MISSING-BANK-TRAN.'                            17130000
171400     IF PS-END-OF-COSA-FILE                                       17140000
171500        PERFORM 2100-END-OF-COSA                                  17150000
171600     ELSE                                                         17160000
171700        PERFORM 3100-SEARCH-DAY-TOTALS-COSA                       17170000
171800        SET PS-NOT-FOUND-DATE TO TRUE                             17180000
171900        IF TC002-VOID                                             17190000
172000           CONTINUE                                               17200000
172100        ELSE                                                      17210000
172200           MOVE 'MISSING BANK TRANSACTION' TO D1-REASON-CODE      17220000
172300*  10/28/09 - BJS ADDED THE FOLLOWING LINE FOR NEW FILE           17230000
172400           MOVE 'MSB'                      TO TC021-REASON-CDE    17240000
172500           MOVE TC002-SLS-DTE       TO  PV-WRK-SLS-DATE-CCYYMMDD  17250000
172600           MOVE PV-WRK-SLS-CCYY     TO  PV-ISO-SLS-CCYY           17260000
172700           MOVE PV-WRK-SLS-MM       TO  PV-ISO-SLS-MM             17270000
172800           MOVE PV-WRK-SLS-DD       TO  PV-ISO-SLS-DD             17280000
172900           MOVE '-'                 TO  PV-ISO-DASH1              17290000
173000           MOVE '-'                 TO  PV-ISO-DASH2              17300000
173100           MOVE PV-ISO-SLS-DATE     TO  PV-SLS-DTE                17310000
173200           MOVE TC002-STR-NBR       TO  PV-STR-NBR                17320000
173300           MOVE TC002-RGST-ID       TO  PV-RGST-ID                17330000
173400           MOVE TC002-TRN-NBR       TO  PV-TRN-NBR                17340000
173500*  10/28/09 - BJS ADDED THE FOLLOWING 11 LINES FOR NEW FILE       17350000
173600           PERFORM 4100-READ-COSA                                 17360000
173700****  SINCE DEBIT CARDS HAVE VARIABLE LENGTHS, DEPENDING ON WHAT  17370000
173800****  TYPE OF DEBIT CARD IT IS, IT IS NECESSARY TO RIGHT JUSTIFY  17380000
173900****  THE ACCOUNT NUMBER.  THE SPACES WILL BE TO THE LEFT AND     17390000
174000****  ALL NUMBERS EXCEPT THE LAST 4 WILL BE MASKED (*).           17400000
174100                                                                  17410000
174200           MOVE TC002-CARD-NBR TO TC021-CARD-NBR                  17420000
174300           MOVE TC002-CARD-NBR(1:EPTND-TNDR-ID-LEN-NBR)           17430000
174400                                TO PV-CARD-NBR-RJ                 17440000
062222                                   D1-CARD                        17450000
062222*          PERFORM 5000-MASK-CARD-NUMBER                          17460000
174700           PERFORM 4500-WRITE-COSA-DETAIL-LINE-1                  17470000
174800           PERFORM 4300-WRITE-BLANK-LINE                          17480000
174900           SET TC002-NOT-MATCHED TO TRUE                          17490000
175000        END-IF                                                    17500000
175100        PERFORM 4600-WRITE-COSA-RECORD                            17510000
175200        IF PS-END-OF-COSA-FILE                                    17520000
175300           PERFORM 1200-READ-ACT-DATA-FILE                        17530000
175400        ELSE                                                      17540000
175500           PERFORM 1100-READ-COSA-FILE                            17550000
175600        END-IF                                                    17560000
175700     END-IF.                                                      17570000
175800                                                                  17580000
175900******************************************************************17590000
176000*   MISSING SALES AUDIT TRANSACTION (COSA)                       *17600000
176100******************************************************************17610000
176200 3400-MISSING-SA-TRANSACTION.                                     17620000
176300                                                                  17630000
176400*    DISPLAY '3400-MISSING-SA-TRANSACTION.'                       17640000
176500     IF PS-END-OF-ACT-FILE                                        17650000
176600        PERFORM 2200-END-OF-ACT                                   17660000
176700     ELSE                                                         17670000
176800        MOVE TC003-SLS-DTE       TO  PV-WRK-SLS-DATE-CCYYMMDD     17680000
176900        MOVE PV-WRK-SLS-CCYY     TO  PV-ISO-SLS-CCYY              17690000
177000        MOVE PV-WRK-SLS-MM       TO  PV-ISO-SLS-MM                17700000
177100        MOVE PV-WRK-SLS-DD       TO  PV-ISO-SLS-DD                17710000
177200        MOVE '-'                 TO  PV-ISO-DASH1                 17720000
177300        MOVE '-'                 TO  PV-ISO-DASH2                 17730000
177400        MOVE PV-ISO-SLS-DATE     TO  PV-SLS-DTE                   17740000
177500        MOVE TC003-STORE-NBR     TO  PV-STR-NBR                   17750000
177600        MOVE TC003-REG-NBR       TO  PV-RGST-ID                   17760000
177700        MOVE TC003-TRAN-NBR      TO  PV-TRN-NBR                   17770000
177800        PERFORM 4100-READ-COSA                                    17780000
177900        IF PS-NO-COSA                                             17790000
178000           PERFORM 3200-SEARCH-DAY-TOTALS-MAF                     17800000
178100           SET PS-NOT-FOUND-DATE    TO TRUE                       17810000
178200           MOVE 'MISSING SA TRANSACTION'                          17820000
178300                         TO D1-REASON-CODE                        17830000
178400*  10/28/09 - BJS ADDED THE FOLLOWING 4 LINES FOR NEW FILE        17840000
178500           MOVE 'MSA'    TO TC021-REASON-CDE                      17850000
178600           MOVE TC003-CARD-NBR  TO TC021-CARD-NBR                 17860000
178700           MOVE TC003-CARD-NBR(1:19)                              17870000
178800                                TO PV-CARD-NBR-RJ                 17880000
062222                                   D1-CARD                        17881000
062222*          PERFORM 5100-MASK-CARD-NUMBER                          17890000
179000           PERFORM 4400-WRITE-ACT-DETAIL-LINE-1                   17900000
179100           PERFORM 4300-WRITE-BLANK-LINE                          17910000
179200           SET TC002-NOT-MATCHED TO TRUE                          17920000
179300           PERFORM 4700-WRITE-UNMATCH-MAF-RECORD                  17930000
179400           IF PS-END-OF-ACT-FILE                                  17940000
179500              PERFORM 1100-READ-COSA-FILE                         17950000
179600           ELSE                                                   17960000
179700              PERFORM 1200-READ-ACT-DATA-FILE                     17970000
179800           END-IF                                                 17980000
179900        ELSE                                                      17990000
180000*COMMENTED THIS CODE OUT BECAUSE IN ORDER TO GET HERE THERE       18000000
180100*WAS NO COSA TRANSACTION AT 1:00 AM WHEN THE FILE WAS PULLED.     18010000
180200*THE COSA TRAN CAME BETWEEN THE PULL AND THE RUNNING OF THIS      18020000
180300*PROGRAM WHEN THE LOADER CAME BACK UP AS A LATE. I WILL NOW       18030000
180400*SAY THE LATE MATCHES AND WRITE THE COSA RECORD OUT TO A          18040000
180500*FILE SO IT CAN HAVE THE SETTLEMENT PROCESS CODE UPDATED.         18050000
180600*11/18/2002                                                       18060000
180700*          MOVE 'BANK REVERSAL TRANSACTION'                       18070000
180800*                       TO D1-REASON-CODE                         18080000
180900*          PERFORM 4400-WRITE-ACT-DETAIL-LINE-1                   18090000
181000*          PERFORM 4300-WRITE-BLANK-LINE                          18100000
181100*          PERFORM 4700-WRITE-UNMATCH-MAF-RECORD                  18110000
181200*PUT THIS CODE BACK IN FOR VOIDED DEBIT TRANSACTIONS.  IF THE     18120000
181300*COSA DEBIT TRANSACTION IS VOIDED THIS IS THE SAME AS NO COSA     18130000
181400*TRANSACTION AND THIS HAS TO GO ON THE REPORT SINCE THERE IS      18140000
181500*A COMPLETED SALE ON THE MAF FILE. ALSO ADDED TNDR-TYP-CDE = '19' 18150000
181600*TO THE SELECT IN 4100-. 02/03/2003                               18160000
181700           IF EPTND-TNDR-VOID-IND = 'Y'                           18170000
181800             PERFORM 3200-SEARCH-DAY-TOTALS-MAF                   18180000
181900             SET PS-NOT-FOUND-DATE    TO TRUE                     18190000
182000             MOVE 'BANK REVERSAL TRANSACTION'                     18200000
182100                        TO D1-REASON-CODE                         18210000
182200*  10/28/09 - BJS ADDED THE FOLLOWING 10 LINES FOR NEW FILE       18220000
182300             MOVE 'BRE' TO TC021-REASON-CDE                       18230000
182400****  SINCE DEBIT CARDS HAVE VARIABLE LENGTHS, DEPENDING ON WHAT  18240000
182500****  TYPE OF DEBIT CARD IT IS, IT IS NECESSARY TO RIGHT JUSTIFY  18250000
182600****  THE ACCOUNT NUMBER.  THE SPACES WILL BE TO THE LEFT AND     18260000
182700****  ALL NUMBERS EXCEPT THE LAST 4 WILL BE MASKED (*).           18270000
182800                                                                  18280000
182900             MOVE EPTND-TNDR-ID TO TC021-CARD-NBR                 18290000
183000             MOVE EPTND-TNDR-ID(1:EPTND-TNDR-ID-LEN-NBR)          18300000
183100                                TO PV-CARD-NBR-RJ                 18310000
062222                                   D1-CARD                        18311000
062222*            PERFORM 5000-MASK-CARD-NUMBER                        18320000
183300             PERFORM 4400-WRITE-ACT-DETAIL-LINE-1                 18330000
183400             PERFORM 4300-WRITE-BLANK-LINE                        18340000
183500             PERFORM 4700-WRITE-UNMATCH-MAF-RECORD                18350000
183600           ELSE                                                   18360000
183700*  ADDED IF STATEMENT FOR DUPLICATE MAF TRANSACTIONS              18370000
183800             IF TC003-STORE-NBR = PV-MAF-STORE-NBR AND            18380000
183900                TC003-REG-NBR = PV-MAF-REG-NBR AND                18390000
184000                TC003-TRAN-NBR = PV-MAF-TRAN-NBR AND              18400000
184100                TC003-SLS-DTE = PV-MAF-SLS-DTE AND                18410000
184200                TC003-CARD-NBR = PV-MAF-CARD-NBR                  18420000
184300                  MOVE 'DUP BANK TRANSACTION' TO D1-REASON-CODE   18430000
184400*  10/28/09 - BJS ADDED THE FOLLOWING 4 LINES FOR NEW FILE        18440000
184500                  MOVE 'DBT'                  TO TC021-REASON-CDE 18450000
184600                  MOVE TC003-CARD-NBR(1:19)                       18460000
184700                                TO PV-CARD-NBR-RJ                 18470000
062222                                   D1-CARD                        18471000
062222*                 PERFORM 5100-MASK-CARD-NUMBER                   18480000
184900                  PERFORM 4400-WRITE-ACT-DETAIL-LINE-1            18490000
185000                  PERFORM 4300-WRITE-BLANK-LINE                   18500000
185100                  SET TC002-NOT-MATCHED TO TRUE                   18510000
185200                  PERFORM 4700-WRITE-UNMATCH-MAF-RECORD           18520000
185300             ELSE                                                 18530000
185400                  MOVE EPTND-PARTN-NBR TO PV-PARTN-NBR-OUT        18540000
185500                  MOVE PV-STR-NBR      TO PV-STR-NBR-OUT          18550000
185600                  MOVE TC003-SLS-DTE   TO PV-SLS-DTE-OUT          18560000
185700                  MOVE EPTND-STRT-TM   TO PV-SPLIT-TIME-S         18570000
185800                  MOVE PV-TIME-HH-S    TO PV-SPLIT-TIME-HH        18580000
185900                  MOVE PV-TIME-MM-S    TO PV-SPLIT-TIME-MM        18590000
186000                  MOVE PV-TIME-SS-S    TO PV-SPLIT-TIME-SS        18600000
186100                  MOVE PV-SPLIT-TIME   TO PV-STRT-TIME-OUT        18610000
186200                  MOVE PV-RGST-ID      TO PV-RGST-ID-OUT          18620000
186300                  MOVE PV-TRN-NBR      TO PV-TRN-NBR-OUT          18630000
186400                  MOVE EPTND-SLS-CORR-SEQ-NBR TO                  18640000
186500                                          PV-SLS-CORR-SEQ-NBR-OUT 18650000
186600                  MOVE EPTND-TNDR-SEQ-NBR TO PV-TNDR-SEQ-NBR-OUT  18660000
186700                  MOVE EPTND-TNDR-ID   TO PV-CARD-NBR-OUT         18670000
186800                  MOVE EPTND-TNDR-AMT  TO PV-TNDR-AMT-OUT         18680000
186900                  SET PV-MATCH-OUT TO TRUE                        18690000
187000                  SET PV-LATE-OUT TO TRUE                         18700000
187100                  SET PV-NEW-RECORD-OUT TO TRUE                   18710000
187200                  PERFORM 4600-WRITE-COSA-RECORD                  18720000
187300             END-IF                                               18730000
187400*          ELSE                                                   18740000
187500*            SET PV-MATCH-OUT TO TRUE                             18750000
187600*            PERFORM 4600-WRITE-COSA-RECORD                       18760000
187700           END-IF                                                 18770000
187800           IF PS-END-OF-ACT-FILE                                  18780000
187900              CONTINUE                                            18790000
188000           ELSE                                                   18800000
188100              PERFORM 1200-READ-ACT-DATA-FILE                     18810000
188200           END-IF                                                 18820000
188300        END-IF                                                    18830000
188400     END-IF.                                                      18840000
188500                                                                  18850000
188600******************************************************************18860000
188700*    DOES NOT MATCH AND IS NOT 2 DAYS OLD                        *18870000
188800*    WRITE A COSA RECORD                                         *18880000
188900*    READ ANOTHER COSA RECORD                                    *18890000
189000******************************************************************18900000
189100 3500-NO-MATCH.                                                   18910000
189200*    DISPLAY '3500-NO-MATCH.'                                     18920000
189300******** 07-27-09 MAB  (INC000000868842)                          18930000
189400******** ADDED THE IF CODE TO CORRECT THE PROBLEM DESCRIBED BELOW 18940000
189500     IF PS-END-OF-COSA-CSR-SW = 'N'                               18950000
189600        SET TC002-NOT-MATCHED TO TRUE                             18960000
189700        PERFORM 4600-WRITE-COSA-RECORD                            18970000
189800     END-IF.                                                      18980000
189900                                                                  18990000
190000******** 07-27-09 MAB  (INC000000868842)                          19000000
190100******** COMMENTED OUT THE CODE BELOW BECAUSE IT WAS MOVED        19010000
190200******** BETWEEN THE IF/END-IF ABOVE.  THIS CODE WAS CAUSING      19020000
190300******** A PROBLEM OF WRITING OUT A DUPLICATE OF THE LAST COSA    19030000
190400******** RECORD SET TO AN UNMATCHED STATUS, WHEN THE LAST COSA    19040000
190500******** RECORD HAD BEEN MATCHED IN PRIOR PROCESSING.             19050000
190600**   SET TC002-NOT-MATCHED TO TRUE.                               19060000
190700**   PERFORM 4600-WRITE-COSA-RECORD.                              19070000
190800                                                                  19080000
190900     IF PS-END-OF-COSA-FILE                                       19090000
191000        PERFORM 2100-END-OF-COSA                                  19100000
191100     ELSE                                                         19110000
191200        PERFORM 1100-READ-COSA-FILE                               19120000
191300     END-IF.                                                      19130000
191400                                                                  19140000
191500******************************************************************19150000
191600*    DOES NOT MATCH                                              *19160000
191700*    READ ANOTHER MAF RECORD                                     *19170000
191800******************************************************************19180000
191900 3525-NO-BANK-MATCH.                                              19190000
192000                                                                  19200000
192100*    DISPLAY '3525-NO-BANK-MATCH. '                               19210000
192200     SET TC002-NOT-MATCHED TO TRUE.                               19220000
192300     PERFORM 4700-WRITE-UNMATCH-MAF-RECORD.                       19230000
192400                                                                  19240000
192500     IF PS-END-OF-ACT-FILE                                        19250000
192600         PERFORM 2200-END-OF-ACT                                  19260000
192700     ELSE                                                         19270000
192800         PERFORM 1200-READ-ACT-DATA-FILE                          19280000
192900     END-IF.                                                      19290000
193000                                                                  19300000
193100******************************************************************19310000
193200*    MAF RECORD WAS WRITTEN AFTER MIDNIGHT SO IT HAS TOMORROW'S  *19320000
193300*    DATE ON IT WHILE THE COSA RECORD HAS THE PROCESSING DATE ON *19330000
193400*    IT.  THEY WILL NEVER MATCH SO I CHANGED THE MAF DATE TO     *19340000
193500*    EQUAL THE COSA SLS DATE.  WE WILL WRITE IT ON THE MAF       *19350000
193600*    UNMATCHED FILE AND THE NEXT DAY THE UNMATCHED MAF WILL      *19360000
193700*    MATCH WITH THE UNMATCHED COSA RECORD.                       *19370000
193800******************************************************************19380000
193900 3550-MAF-AFTER-MIDNIGHT.                                         19390000
194000                                                                  19400000
194100*    DISPLAY '3550-MAF-AFTER-MIDNIGHT.'                           19410000
194200     IF TC003-SLS-DTE = '99999999'                                19420000
194300         CONTINUE                                                 19430000
194400     ELSE                                                         19440000
194500         MOVE TC002-SLS-DTE      TO TC003-SLS-DTE                 19450000
194600         MOVE TC003-STORE-NBR    TO PV-HOLD-STORE-NBR             19460000
194700         MOVE TC003-REG-NBR      TO PV-HOLD-REG-NBR               19470000
194800         MOVE TC003-TRAN-NBR     TO PV-HOLD-TRAN-NBR              19480000
194900         MOVE TC003-SLS-DTE      TO PV-HOLD-SLS-DTE               19490000
195000         MOVE TC003-STRT-TM      TO PV-HOLD-STRT-TM               19500000
195100         MOVE TC003-TRAN-SEQ-NBR TO PV-HOLD-TRAN-SEQ-NBR          19510000
195200         MOVE TC003-TRAN-TYPE    TO PV-HOLD-TRAN-TYPE             19520000
195300         MOVE TC003-TRAN-DISP    TO PV-HOLD-TRAN-DISP             19530000
195400         MOVE TC003-CARD-NBR     TO PV-HOLD-CARD-NBR              19540000
195500         MOVE TC003-TRAN-AMT     TO PV-HOLD-TRAN-AMT              19550000
195600         MOVE TC003-TYP-CDE      TO PV-HOLD-TYP-CDE               19560000
195700         MOVE TC003-ADJ-DISP     TO PV-HOLD-ADJ-DISP              19570000
195800         MOVE TC003-RESPONSE-CDE TO PV-HOLD-RESPONSE-CDE          19580000
195900         MOVE TC003-STATE-CDE    TO PV-HOLD-STATE-CDE             19590000
196000         MOVE TC003-STORE-NAME-ABBR TO PV-HOLD-STORE-NAME-ABBR    19600000
196100         MOVE TC003-TYP-CDE      TO PV-HOLD-TYP-CDE               19610000
196200         MOVE TC003-ADJ-DISP     TO PV-HOLD-ADJ-DISP              19620000
196300         MOVE TC003-RESPONSE-CDE TO PV-HOLD-RESPONSE-CDE          19630000
196400         MOVE TC003-STATE-CDE    TO PV-HOLD-STATE-CDE             19640000
196500         MOVE TC003-STORE-NAME-ABBR TO PV-HOLD-STORE-NAME-ABBR    19650000
196600         WRITE MERCHANT-ACTIVITY-OUT-RECORD FROM                  19660000
196700               PV-HOLD-TC003                                      19670000
196800         PERFORM 1200-READ-ACT-DATA-FILE                          19680000
196900     END-IF.                                                      19690000
197000                                                                  19700000
197100******************************************************************19710000
197200*    LOGIC FOR EMPTY MAF FILE                                    *19720000
197300******************************************************************19730000
197400 3600-EMPTY-MAF.                                                  19740000
197500                                                                  19750000
197600*    DISPLAY '3600-EMPTY-MAF.'                                    19760000
197700     PERFORM 3100-SEARCH-DAY-TOTALS-COSA.                         19770000
197800     SET PS-NOT-FOUND-DATE TO TRUE.                               19780000
197900     MOVE 'MISSING BANK TRANSACTION' TO D1-REASON-CODE.           19790000
198000     MOVE 'MSB'                      TO TC021-REASON-CDE.         19800000
198100     MOVE TC002-SLS-DTE       TO  PV-WRK-SLS-DATE-CCYYMMDD.       19810000
198200     MOVE PV-WRK-SLS-CCYY     TO  PV-ISO-SLS-CCYY.                19820000
198300     MOVE PV-WRK-SLS-MM       TO  PV-ISO-SLS-MM.                  19830000
198400     MOVE PV-WRK-SLS-DD       TO  PV-ISO-SLS-DD.                  19840000
198500     MOVE '-'                 TO  PV-ISO-DASH1.                   19850000
198600     MOVE '-'                 TO  PV-ISO-DASH2.                   19860000
198700     MOVE PV-ISO-SLS-DATE     TO  PV-SLS-DTE.                     19870000
198800     MOVE TC002-STR-NBR       TO  PV-STR-NBR.                     19880000
198900     MOVE TC002-RGST-ID       TO  PV-RGST-ID.                     19890000
199000     MOVE TC002-TRN-NBR       TO  PV-TRN-NBR.                     19900000
199100*  10/28/09 - BJS ADDED THE FOLLOWING 11 LINES FOR NEW FILE       19910000
199200     PERFORM 4100-READ-COSA.                                      19920000
199300****  SINCE DEBIT CARDS HAVE VARIABLE LENGTHS, DEPENDING ON WHAT  19930000
199400****  TYPE OF DEBIT CARD IT IS, IT IS NECESSARY TO RIGHT JUSTIFY  19940000
199500****  THE ACCOUNT NUMBER.  THE SPACES WILL BE TO THE LEFT AND     19950000
199600****  ALL NUMBERS EXCEPT THE LAST 4 WILL BE MASKED (*).           19960000
199700                                                                  19970000
199800     MOVE TC002-CARD-NBR TO TC021-CARD-NBR.                       19980000
199900     MOVE TC002-CARD-NBR(1:EPTND-TNDR-ID-LEN-NBR)                 19990000
062222                                TO PV-CARD-NBR-RJ                 20000000
062222                                   D1-CARD.                       20010000
062222*    PERFORM 5000-MASK-CARD-NUMBER.                               20020000
200300     PERFORM 4500-WRITE-COSA-DETAIL-LINE-1.                       20030000
200400     PERFORM 4300-WRITE-BLANK-LINE.                               20040000
200500     SET TC002-NOT-MATCHED TO TRUE.                               20050000
200600     PERFORM 4600-WRITE-COSA-RECORD.                              20060000
200700     IF PS-END-OF-COSA-FILE                                       20070000
200800        PERFORM 1200-READ-ACT-DATA-FILE                           20080000
200900     ELSE                                                         20090000
201000        PERFORM 1100-READ-COSA-FILE                               20100000
201100     END-IF.                                                      20110000
201200                                                                  20120000
201300******************************************************************20130000
201400* IF THE MAF DATE IS GREATER THAN THE COSA DATE AND THE COSA     *20140000
201500* RECORD IS A CORRECTION, THERE WAS NOT A COSA TRANSACTION AT    *20150000
201600* FIRST BUT THEN A CORRECTION WAS ENTERED.  IF THE STR, TRAN, REG*20160000
201700* AND AMOUNT OF THE CORRECTION MATCHES THE MAF RECORD, THEM MATCH*20170000
201800* THEM.                                                          *20180000
201900******************************************************************20190000
202000 3700-CHECK-OTHER-CRITERIA.                                       20200000
202100*    DISPLAY '3700-CHECK-OTHER-CRITERIA.'                         20210000
202200     IF TC003-STORE-NBR = TC002-STR-NBR                           20220000
202300       IF TC003-REG-NBR = TC002-RGST-ID                           20230000
202400         IF TC003-TRAN-NBR = TC002-TRN-NBR                        20240000
202500           IF TC003-TRAN-AMT = TC002-TNDR-AMT                     20250000
202600*            IF TC003-CARD-NBR = TC002-CARD-NBR                   20260000
202700             MOVE TC003-CARD-NBR  TO PV-TC003-CARD-NBR-RJ         20270000
202800             MOVE TC002-CARD-NBR  TO PV-TC002-CARD-NBR-RJ         20280000
202900             IF PV-TC003-CARD-NBR-RJ(16:4) =                      20290000
203000                                       PV-TC002-CARD-NBR-RJ(16:4) 20300000
203100               SET PV-MATCH-OUT TO TRUE                           20310000
203200               PERFORM 4600-WRITE-COSA-RECORD                     20320000
203300               IF PS-END-OF-ACT-FILE                              20330000
203400                  CONTINUE                                        20340000
203500               ELSE                                               20350000
203600                  PERFORM 1200-READ-ACT-DATA-FILE                 20360000
203700               END-IF                                             20370000
203800               IF PS-END-OF-COSA-FILE                             20380000
203900                  CONTINUE                                        20390000
204000               ELSE                                               20400000
204100                  PERFORM 1100-READ-COSA-FILE                     20410000
204200               END-IF                                             20420000
204300             END-IF                                               20430000
204400           END-IF                                                 20440000
204500         END-IF                                                   20450000
204600       END-IF                                                     20460000
204700     END-IF.                                                      20470000
204800******************************************************************20480000
204900* THE MAF AND COSA TRANSACTION HAD DIFFERENT TRANSACTION SALE    *20490000
205000* TYPE.  WRITE MISMATCH MESSAGE TO ERROR REPORT, SET NOT MATCHED *20500000
205100* FLAGS, AND READ NEXT RECORDS FROM BOTH FILES.                  *20510000
205200******************************************************************20520000
205300 3800-MISMATCH-ON-SALE-TYPE.                                      20530000
205400                                                                  20540000
205500*    DISPLAY '3800-MISMATCH-ON-SALE-TYPE.'                        20550000
205600     MOVE 'SALE TYPE DIFFERS' TO D1-REASON-CODE.                  20560000
205700*  10/28/09 - BJS ADDED THE FOLLOWING LINE FOR NEW FILE           20570000
205800     MOVE 'STD'               TO TC021-REASON-CDE.                20580000
205900                                                                  20590000
206000     PERFORM 3200-SEARCH-DAY-TOTALS-MAF.                          20600000
206100     PERFORM 3100-SEARCH-DAY-TOTALS-COSA.                         20610000
206200                                                                  20620000
206300*  10/28/09 - BJS ADDED THE FOLLOWING 9 LINES FOR NEW FILE        20630000
206400     MOVE TC002-CARD-NBR     TO TC021-CARD-NBR.                   20640000
206500****  SINCE DEBIT CARDS HAVE VARIABLE LENGTHS, DEPENDING ON WHAT  20650000
206600****  TYPE OF DEBIT CARD IT IS, IT IS NECESSARY TO RIGHT JUSTIFY  20660000
206700****  THE ACCOUNT NUMBER.  THE SPACES WILL BE TO THE LEFT AND     20670000
206800****  ALL NUMBERS EXCEPT THE LAST 4 WILL BE MASKED (*).           20680000
206900                                                                  20690000
207000     MOVE TC002-CARD-NBR TO TC021-CARD-NBR.                       20700000
207100     MOVE TC002-CARD-NBR(1:19)  TO PV-CARD-NBR-RJ                 20710000
062222                                   D1-CARD.                       20711000
062222*    PERFORM 5100-MASK-CARD-NUMBER.                               20720000
207300     PERFORM 4500-WRITE-COSA-DETAIL-LINE-1.                       20730000
207400     PERFORM 4400-WRITE-ACT-DETAIL-LINE-1.                        20740000
207500     PERFORM 4300-WRITE-BLANK-LINE.                               20750000
207600                                                                  20760000
207700     PERFORM 4600-WRITE-COSA-RECORD.                              20770000
207800     PERFORM 4700-WRITE-UNMATCH-MAF-RECORD.                       20780000
207900                                                                  20790000
208000     PERFORM 1200-READ-ACT-DATA-FILE.                             20800000
208100     PERFORM 1100-READ-COSA-FILE.                                 20810000
208200                                                                  20820000
208300******************************************************************20830000
208400* READ TEPTND FOR THE FOLLOWING SITUATIONS...                    *20840000
208500* RECORD WAS NOT ON SEQUENTIAL COSA FILE BUT IT MIGHT NOT BE A   *20850000
208600* DEBIT TRANSACTION.  ANOTHER TYPE OF TENDER COULD HAVE BEEN USED*20860000
208700* IF A DEBIT CARD WAS DENIED BUT SOMEHOW WENT TO THE BANK.  ALSO *20870000
208800* THE TRANSACTION COULD HAVE BEEN VOIDED BUT ACCIDENTALLY        *20880000
208900* WENT TO THE BANK.                                              *20890000
209000******************************************************************20900000
209100 4100-READ-COSA.                                                  20910000
209200                                                                  20920000
209300*    DISPLAY '4100-READ-COSA.'                                    20930000
209400     EXEC SQL                                                     20940000
209500        SELECT TNDR_TYP_CDE                                       20950000
209600             , TNDR_VOID_IND                                      20960000
209700             , A.PARTN_NBR                                        20970000
209800             , STRT_TM                                            20980000
209900             , SLS_CORR_SEQ_NBR                                   20990000
210000             , TNDR_SEQ_NBR                                       21000000
210100             , TNDR_ID                                            21010000
210200             , TNDR_AMT                                           21020000
210300             , TNDR_ID_LEN_NBR                                    21030000
210400        INTO  :EPTND-TNDR-TYP-CDE                                 21040000
210500             ,:EPTND-TNDR-VOID-IND                                21050000
210600             ,:EPTND-PARTN-NBR                                    21060000
210700             ,:EPTND-STRT-TM                                      21070000
210800             ,:EPTND-SLS-CORR-SEQ-NBR                             21080000
210900             ,:EPTND-TNDR-SEQ-NBR                                 21090000
211000             ,:EPTND-TNDR-ID                                      21100000
211100             ,:EPTND-TNDR-AMT                                     21110000
211200             ,:EPTND-TNDR-ID-LEN-NBR                              21120000
211300        FROM TEPTND        A                                      21130000
211400            ,TEPPART       B                                      21140000
211500        WHERE B.SLS_DTE   = :PV-SLS-DTE                           21150000
211600          AND A.PARTN_NBR = B.PARTN_NBR                           21160000
211700          AND A.STR_NBR   = :PV-STR-NBR                           21170000
211800          AND A.RGST_ID   = :PV-RGST-ID                           21180000
211900          AND A.TRN_NBR   = :PV-TRN-NBR                           21190000
212000          AND A.TNDR_TYP_CDE = '19'                               21200000
212100     END-EXEC.                                                    21210000
212200                                                                  21220000
212300     EVALUATE TRUE                                                21230000
212400         WHEN SQLCODE = +0                                        21240000
212500             SET PS-COSA TO TRUE                                  21250000
212600         WHEN SQLCODE = -811                                      21260000
212700             SET PS-COSA TO TRUE                                  21270000
212800         WHEN SQLCODE = +100                                      21280000
212900             SET PS-NO-COSA TO TRUE                               21290000
213000         WHEN OTHER                                               21300000
213100             MOVE '4100-READ-COSA                '                21310000
213200                               TO PV-PARAGRAPH-NAME               21320000
213300             MOVE 'PROBLEM READING TEPTND TABLE '                 21330000
213400                               TO PV-DB2-OPERATION-ATTEMPTED      21340000
213500             PERFORM Z900-SQL-ABEND                               21350000
213600     END-EVALUATE.                                                21360000
213700                                                                  21370000
213800******************************************************************21380000
213900* WRITE PAGE HEADINGS FOR EXCEPTION REPORT                       *21390000
214000******************************************************************21400000
214100 4200-WRITE-PAGE-HEADINGS-1.                                      21410000
214200                                                                  21420000
214300*    DISPLAY '4200-WRITE-PAGE-HEADINGS-1.'                        21430000
214400     MOVE +7 TO PA-LINE-CNT-1.                                    21440000
214500     ADD  +1 TO PA-PAGE-CNT-1.                                    21450000
214600                                                                  21460000
214700     MOVE PA-PAGE-CNT-1 TO DP132-PAGE-NUMBER.                     21470000
214800                                                                  21480000
214900     WRITE DEBIT-EXCEPT-REPORT-RECORD                             21490000
215000      FROM DP132-STANDRD-HEADER-132-COLS                          21500000
215100      AFTER ADVANCING PAGE.                                       21510000
215200                                                                  21520000
215300     WRITE DEBIT-EXCEPT-REPORT-RECORD                             21530000
215400      FROM T1-TITLE-LINE-1                                        21540000
215500      AFTER ADVANCING 1 LINE.                                     21550000
215600                                                                  21560000
215700     WRITE DEBIT-EXCEPT-REPORT-RECORD                             21570000
215800      FROM H1-COLUMN-HEADING-1                                    21580000
215900      AFTER ADVANCING 2 LINES.                                    21590000
216000                                                                  21600000
216100     WRITE DEBIT-EXCEPT-REPORT-RECORD                             21610000
216200      FROM H2-COLUMN-HEADING-1                                    21620000
216300      AFTER ADVANCING 1 LINES.                                    21630000
216400                                                                  21640000
216500******************************************************************21650000
216600* WRITE BLANK LINE                                               *21660000
216700******************************************************************21670000
216800 4300-WRITE-BLANK-LINE.                                           21680000
216900                                                                  21690000
217000*    DISPLAY '4300-WRITE-BLANK-LINE.'                             21700000
217100     ADD  +1 TO PA-LINE-CNT-1.                                    21710000
217200                                                                  21720000
217300     WRITE DEBIT-EXCEPT-REPORT-RECORD                             21730000
217400         FROM SPACE-LINE                                          21740000
217500         AFTER ADVANCING 1 LINE.                                  21750000
217600                                                                  21760000
217700******************************************************************21770000
217800* WRITE MERCHANT ACTIVITY DETAIL LINE                            *21780000
217900*  10/28/09 - BJS ADDED LINES FOR THE NEW FILE IN THIS PARAGRAPH *21790000
218000******************************************************************21800000
218100 4400-WRITE-ACT-DETAIL-LINE-1.                                    21810000
218200                                                                  21820000
218300*    DISPLAY '4400-WRITE-ACT-DETAIL-LINE-1.'                      21830000
218400     MOVE TC003-SLS-DTE      TO PV-SPLIT-DATE-CCYYMMDD            21840000
218500     MOVE PV-SPLIT-DATE-MM   TO PV-TRAN-MM                        21850000
218600                                PV-ISO-SLS-MM.                    21860000
218700     MOVE PV-SPLIT-DATE-DD   TO PV-TRAN-DD                        21870000
218800                                PV-ISO-SLS-DD.                    21880000
218900     MOVE PV-SPLIT-DATE-CCYY TO PV-SPLIT-CCYY                     21890000
219000                                PV-ISO-SLS-CCYY.                  21900000
219100     MOVE PV-ISO-SLS-DATE    TO TC021-SLS-DTE.                    21910000
219200     MOVE PV-CC              TO PV-SPLIT-CC.                      21920000
219300     MOVE PV-YY              TO PV-SPLIT-YY.                      21930000
219400     MOVE PV-SPLIT-CCYY      TO PV-TRAN-CCYY.                     21940000
219500     MOVE PV-SPLIT-DATE-1    TO D1-DATE.                          21950000
219600     MOVE TC003-STRT-TM      TO PV-SPLIT-TIME.                    21960000
219700     MOVE PV-SPLIT-TIME-HH   TO PV-TIME-HH-S                      21970000
219800                                PV-TIME-HH-C.                     21980000
219900     MOVE PV-SPLIT-TIME-MM   TO PV-TIME-MM-S                      21990000
220000                                PV-TIME-MM-C.                     22000000
220100     MOVE PV-SPLIT-TIME-SS   TO PV-TIME-SS-S                      22010000
220200                                PV-TIME-SS-C.                     22020000
220300     MOVE PV-SPLIT-TIME-S    TO D1-TIME.                          22030000
220400     MOVE PV-SPLIT-TIME-C    TO TC021-STRT-TIME.                  22040000
220500     MOVE TC003-STORE-NBR    TO D1-STORE                          22050000
220600                                TC021-STR-NBR.                    22060000
220700     MOVE TC003-REG-NBR      TO D1-REG                            22070000
220800                                TC021-RGST-ID.                    22080000
220900     MOVE TC003-TRAN-NBR     TO D1-TRAN                           22090000
221000                                TC021-TRN-NBR.                    22100000
062222     MOVE TC003-CARD-NBR     TO D1-CARD.                          22110000
221200     IF TC003-MAF-REC                                             22120000
221300        MOVE 'B '               TO D1-SOURCE-CODE                 22130000
221400                                   TC021-SOURCE-CDE               22140000
221500        ADD TC003-TRAN-AMT      TO PV-TOTAL-TRAN-AMT              22150000
221600     ELSE                                                         22160000
221700        MOVE 'BA'               TO D1-SOURCE-CODE                 22170000
221800        ADD TC003-TRAN-AMT      TO PV-TOTAL-BANKADJ-AMT           22180000
221900     END-IF.                                                      22190000
222000                                                                  22200000
222100*                                                                 22210000
222200*  TC003-TRAN-TYPE OF '05' IS A SALES  TRANSACTION                22220000
222300*                     '06' IS A RETURN TRANSACTION                22230000
222400*                                                                 22240000
222500     IF TC003-TRAN-TYPE = '05'                                    22250000
222600         MOVE 'S'               TO D1-SALE-TYPE                   22260000
222700                                   TC021-SALE-TYPE                22270000
222800     ELSE                                                         22280000
222900         IF TC003-TRAN-TYPE = '06'                                22290000
223000             MOVE 'X'               TO D1-SALE-TYPE               22300000
223100                                    TC021-SALE-TYPE               22310000
223200         ELSE                                                     22320000
223300             MOVE SPACE             TO D1-SALE-TYPE               22330000
223400                                    TC021-SALE-TYPE               22340000
223500         END-IF                                                   22350000
223600     END-IF.                                                      22360000
223700                                                                  22370000
223800     MOVE TC003-TRAN-AMT        TO D1-SALES-AMT                   22380000
223900                                   TC021-TNDR-AMT.                22390000
224000                                                                  22400000
224100     MOVE 1                     TO TC021-TNDR-SEQ-NBR.            22410000
224200                                                                  22420000
224300     WRITE EXCEPT-RECORD FROM TC021-DATA.                         22430000
224400     ADD +1 TO PA-LINE-EXCEPT-CNT.                                22440000
224500                                                                  22450000
224600     WRITE DEBIT-EXCEPT-REPORT-RECORD                             22460000
224700       FROM D1-DETAIL-LINE-1                                      22470000
224800       AFTER ADVANCING 1 LINE.                                    22480000
224900                                                                  22490000
225000     MOVE 'Y' TO PS-PRINT-STORE-TOTALS-SW.                        22500000
225100                                                                  22510000
225200     ADD +1 TO PA-LINE-CNT-1                                      22520000
225300               PV-EXCEPT-CNT.                                     22530000
225400                                                                  22540000
225500******************************************************************22550000
225600* WRITE COSA DETAIL LINE FOR EXCEPTION REPORT                    *22560000
225700*  10/28/09 - BJS ADDED LINES FOR THE NEW FILE IN THIS PARAGRAPH *22570000
225800******************************************************************22580000
225900 4500-WRITE-COSA-DETAIL-LINE-1.                                   22590000
226000                                                                  22600000
226100*    DISPLAY '4500-WRITE-COSA-DETAIL-LINE-1.'                     22610000
226200     MOVE TC002-SLS-DTE      TO PV-SPLIT-DATE-CCYYMMDD.           22620000
226300     MOVE PV-SPLIT-DATE-MM   TO PV-SPLIT-MM                       22630000
226400                                PV-ISO-SLS-MM.                    22640000
226500     MOVE PV-SPLIT-DATE-DD   TO PV-SPLIT-DD                       22650000
226600                                PV-ISO-SLS-DD.                    22660000
226700     MOVE PV-SPLIT-DATE-CCYY TO PV-SPLIT-CCYY                     22670000
226800                                PV-ISO-SLS-CCYY.                  22680000
226900     MOVE PV-ISO-SLS-DATE    TO TC021-SLS-DTE.                    22690000
227000     MOVE PV-CC              TO PV-SPLIT-CC.                      22700000
227100     MOVE PV-YY              TO PV-SPLIT-YY.                      22710000
227200     MOVE PV-SPLIT-DATE-1    TO D1-DATE.                          22720000
227300     MOVE TC002-STRT-TIME    TO PV-SPLIT-TIME                     22730000
227400     MOVE PV-SPLIT-TIME-HH   TO PV-TIME-HH-S                      22740000
227500                                PV-TIME-HH-C.                     22750000
227600     MOVE PV-SPLIT-TIME-MM   TO PV-TIME-MM-S                      22760000
227700                                PV-TIME-MM-C.                     22770000
227800     MOVE PV-SPLIT-TIME-SS   TO PV-TIME-SS-S                      22780000
227900                                PV-TIME-SS-C.                     22790000
228000     MOVE PV-SPLIT-TIME-S    TO D1-TIME.                          22800000
228100     MOVE PV-SPLIT-TIME-C    TO TC021-STRT-TIME.                  22810000
228200     MOVE TC002-STR-NBR      TO D1-STORE                          22820000
228300                                TC021-STR-NBR.                    22830000
228400     MOVE TC002-RGST-ID      TO D1-REG                            22840000
228500                                TC021-RGST-ID.                    22850000
228600     MOVE TC002-TRN-NBR      TO D1-TRAN                           22860000
228700                                TC021-TRN-NBR.                    22870000
062222     MOVE TC002-CARD-NBR     TO D1-CARD.                          22880000
228900     MOVE 'S '               TO D1-SOURCE-CODE                    22890000
229000                                TC021-SOURCE-CDE.                 22900000
229100     MOVE TC002-TNDR-SEQ-NBR TO TC021-TNDR-SEQ-NBR.               22910000
229200     EVALUATE TC002-SALE-TYPE                                     22920000
229300         WHEN 'C'                                                 22930000
229400            MOVE 'C'            TO D1-SALE-TYPE                   22940000
229500                                   TC021-SALE-TYPE                22950000
229600            ADD TC002-TNDR-AMT  TO PV-TOTAL-SALECOR-AMT           22960000
229700         WHEN 'L'                                                 22970000
229800            MOVE 'L'            TO D1-SALE-TYPE                   22980000
229900                                   TC021-SALE-TYPE                22990000
230000            ADD TC002-TNDR-AMT  TO PV-TOTAL-LATE-AMT              23000000
230100         WHEN 'W'                                                 23010000
230200            MOVE 'W'            TO D1-SALE-TYPE                   23020000
230300                                   TC021-SALE-TYPE                23030000
230400            ADD TC002-TNDR-AMT  TO PV-TOTAL-SALECOR-AMT           23040000
230500         WHEN 'R'                                                 23050000
230600            MOVE 'R'            TO D1-SALE-TYPE                   23060000
230700                                   TC021-SALE-TYPE                23070000
230800            ADD TC002-TNDR-AMT  TO PV-TOTAL-REVERSAL-AMT          23080000
230900         WHEN 'X'                                                 23090000
231000            MOVE 'X'            TO D1-SALE-TYPE                   23100000
231100                                   TC021-SALE-TYPE                23110000
231200            ADD TC002-TNDR-AMT  TO PV-TOTAL-RETURN-AMT            23120000
231300         WHEN 'S'                                                 23130000
231400            MOVE 'S'            TO D1-SALE-TYPE                   23140000
231500                                   TC021-SALE-TYPE                23150000
231600            ADD TC002-TNDR-AMT  TO PV-TOTAL-TNDR-AMT              23160000
231700         WHEN 'V'                                                 23170000
231800            MOVE 'V'            TO D1-SALE-TYPE                   23180000
231900                                   TC021-SALE-TYPE                23190000
232000            ADD TC002-TNDR-AMT  TO PV-TOTAL-VOID-AMT              23200000
232100     END-EVALUATE.                                                23210000
232200     MOVE TC002-TNDR-AMT     TO D1-SALES-AMT                      23220000
232300                                TC021-TNDR-AMT.                   23230000
232400                                                                  23240000
232500*  10/28/09 - BJS ADDED THE FOLLOWING 2 LINES FOR NEW FILE        23250000
232600     WRITE EXCEPT-RECORD FROM TC021-DATA.                         23260000
232700     ADD +1 TO PA-LINE-EXCEPT-CNT.                                23270000
232800                                                                  23280000
232900     WRITE DEBIT-EXCEPT-REPORT-RECORD                             23290000
233000       FROM D1-DETAIL-LINE-1                                      23300000
233100       AFTER ADVANCING 1 LINE.                                    23310000
233200                                                                  23320000
233300     MOVE 'Y' TO PS-PRINT-STORE-TOTALS-SW.                        23330000
233400                                                                  23340000
233500     ADD +1 TO PA-LINE-CNT-1                                      23350000
233600               PV-EXCEPT-CNT.                                     23360000
233700                                                                  23370000
233800******************************************************************23380000
233900* WRITE COSA RECORD TO OUTPUT FILE                               *23390000
234000******************************************************************23400000
234100 4600-WRITE-COSA-RECORD.                                          23410000
234200                                                                  23420000
234300*    DISPLAY '4600-WRITE-COSA-RECORD.'                            23430000
234400     MOVE TC021-REASON-CDE TO PV-REASON-CDE.                      23440000
234500     WRITE COSA-OUT-RECORD FROM PV-COSA-OUT.                      23450000
234600                                                                  23460000
234700******************************************************************23470000
234800* WRITE MATCHED RECORDS OUT TO AN OUTPUT FILE                    *23480000
234900******************************************************************23490000
235000 4650-WRITE-MATCHED-RECORD.                                       23500000
235100                                                                  23510000
235200*    DISPLAY '4650-WRITE-MATCHED-RECORD.'                         23520000
235300     WRITE MATCHED-RECORD FROM PV-COSA-OUT.                       23530000
235400                                                                  23540000
235500******************************************************************23550000
235600* WRITE UNMATCHED MAF RECORD TO OUTPUT FILE                      *23560000
235700******************************************************************23570000
235800 4700-WRITE-UNMATCH-MAF-RECORD.                                   23580000
235900                                                                  23590000
236000*    DISPLAY '4700-WRITE-UNMATCH-MAF-RECORD.'                     23600000
236100     WRITE MERCHANT-ACTIVITY-OUT-RECORD FROM                      23610000
236200           MERCHANT-ACTIVITY-IN-RECORD.                           23620000
236300                                                                  23630000
236400******************************************************************23640000
236500* 4800-CHECK-FOR-STORE-CHANGE                                    *23650000
236600*     THIS PARAGRAH DETERMINES IF THERE HAS BEEN A CHANGE IN     *23660000
236700*     STORE NUMBER ON THE COSA AND MAF FILES.                    *23670000
236800*     IF BOTH FILES ARE AT END, THE FINAL STORE TOTALS ARE DONE  *23680000
236900*     AT EOJ PROCESSING AND SHOULD NOT BE PERFORMED HERE.        *23690000
237000*     IF THERE HAS BEEN A CHANGE IN STORE NUMBER, PARAGRAPH      *23700000
237100*     6000-STORE-TOTALS IS PERFORMED.                            *23710000
237200******************************************************************23720000
237300 4800-CHECK-FOR-STORE-CHANGE.                                     23730000
237400                                                                  23740000
237500*    DISPLAY '4800-CHECK-FOR-STORE-CHANGE.'                       23750000
237600     IF PS-END-OF-COSA-FILE                                       23760000
237700         IF PS-END-OF-ACT-FILE                                    23770000
237800             CONTINUE                                             23780000
237900         ELSE                                                     23790000
238000             IF TC003-STORE-NBR > PV-SAVE-STORE-NBR               23800000
238100                 PERFORM 6000-STORE-TOTALS                        23810000
238200             END-IF                                               23820000
238300         END-IF                                                   23830000
238400     ELSE                                                         23840000
238500         IF PS-END-OF-ACT-FILE                                    23850000
238600             IF TC002-STR-NBR   > PV-SAVE-STORE-NBR               23860000
238700                 PERFORM 6000-STORE-TOTALS                        23870000
238800             END-IF                                               23880000
238900         ELSE                                                     23890000
239000             IF TC003-STORE-NBR > PV-SAVE-STORE-NBR AND           23900000
239100                TC002-STR-NBR   > PV-SAVE-STORE-NBR               23910000
239200                 PERFORM 6000-STORE-TOTALS                        23920000
239300             END-IF                                               23930000
239400         END-IF                                                   23940000
239500     END-IF.                                                      23950000
239600*  10/28/09 - BJS ADDED THE FOLLOWING 16 LINES FOR NEW FILE       23960000
239700******************************************************************23970000
239800 5000-MASK-CARD-NUMBER.                                           23980000
239900******************************************************************23990000
240000*    DISPLAY '5000-MASK-CARD-NUMBER.'                             24000000
240100         STRING '***************'                                 24010000
240200                 PV-CARD-NBR-RJ (16:4)                            24020000
240300                 DELIMITED BY SIZE                                24030000
240400                 INTO D1-CARD.                                    24040000
240500                                                                  24050000
240600******************************************************************24060000
240700 5100-MASK-CARD-NUMBER.                                           24070000
240800******************************************************************24080000
240900*    DISPLAY '5100-MASK-CARD-NUMBER.'                             24090000
241000         STRING '***************'                                 24100000
241100                 PV-CARD-NBR-RJ (13:4)                            24110000
241200                 DELIMITED BY SIZE                                24120000
241300                 INTO D1-CARD.                                    24130000
241400                                                                  24140000
241500******************************************************************24150000
241600*    ADD STORE TOTALS (PER DAY) TO GRAND TOTALS (PER DAY)        *24160000
241700*    ZERO OUT STORE TOTALS (PER DAY)                             *24170000
241800*    WRITE OUT STORE TOTALS (COMBINED DAYS)                      *24180000
241900*    ADD COMBINED STORE TOTALS TO COMBINED GRAND TOTALS          *24190000
242000*    ZERO OUT COMBINED STORE TOTALS                              *24200000
242100******************************************************************24210000
242200 6000-STORE-TOTALS.                                               24220000
242300                                                                  24230000
242400*    DISPLAY '6000-STORE-TOTALS.'                                 24240000
242500     SET PV-DAY-IDX              TO +1.                           24250000
242600     SET PV-GRAND-IDX            TO +1.                           24260000
242700                                                                  24270000
242800     PERFORM 2500-ADD-STR-BY-DAY                                  24280000
242900         UNTIL PV-GRAND-IDX > CC-EXCEPT-DAYS-NUMBER               24290000
243000           OR  PV-DATE(PV-DAY-IDX) = SPACES.                      24300000
243100     IF PV-GRAND-IDX  > CC-EXCEPT-DAYS-NUMBER                     24310000
243200         DISPLAY 'TABLE OVERFLOW '                                24320000
243300         MOVE '6000-STORE-TOTALS       ' TO PV-PARAGRAPH-NAME     24330000
243400         SET AC-TABLE-OVERFLOW     TO TRUE                        24340000
243500         PERFORM 9999-ABEND                                       24350000
243600     END-IF.                                                      24360000
243700                                                                  24370000
243800     IF PS-PRINT-STORE-TOTALS                                     24380000
243900        MOVE PV-TOTAL-TRAN-AMT    TO S1-SALES-AMT-1               24390000
244000        MOVE PV-TOTAL-TNDR-AMT    TO S2-SALES-AMT-2               24400000
244100        MOVE PV-TOTAL-BANKADJ-AMT TO S3-SALES-AMT-3               24410000
244200        MOVE PV-TOTAL-SALECOR-AMT TO S4-SALES-AMT-4               24420000
244300        MOVE PV-TOTAL-LATE-AMT    TO S5-SALES-AMT-5               24430000
244400        MOVE PV-TOTAL-VOID-AMT    TO S6-SALES-AMT-6               24440000
244500        MOVE PV-TOTAL-REVERSAL-AMT TO S7-SALES-AMT-7              24450000
244600        MOVE PV-TOTAL-RETURN-AMT  TO S8-SALES-AMT-8               24460000
244700        MOVE PV-SAVE-STORE-NBR    TO S1-STORE-NBR                 24470000
244800                                     S2-STORE-NBR                 24480000
244900                                     S3-STORE-NBR                 24490000
245000                                     S4-STORE-NBR                 24500000
245100                                     S5-STORE-NBR                 24510000
245200                                     S6-STORE-NBR                 24520000
245300                                     S7-STORE-NBR                 24530000
245400                                     S8-STORE-NBR                 24540000
245500        ADD  PV-TOTAL-TRAN-AMT    TO PV-GRAND-TOTAL-TRAN-AMT      24550000
245600        ADD  PV-TOTAL-TNDR-AMT    TO PV-GRAND-TOTAL-TNDR-AMT      24560000
245700        ADD  PV-TOTAL-BANKADJ-AMT TO PV-GRAND-TOTAL-BANKADJ-AMT   24570000
245800        ADD  PV-TOTAL-SALECOR-AMT TO PV-GRAND-TOTAL-SALECOR-AMT   24580000
245900        ADD  PV-TOTAL-LATE-AMT    TO PV-GRAND-TOTAL-LATE-AMT      24590000
246000        ADD  PV-TOTAL-VOID-AMT    TO PV-GRAND-TOTAL-VOID-AMT      24600000
246100        ADD  PV-TOTAL-REVERSAL-AMT TO PV-GRAND-TOTAL-REVERSAL-AMT 24610000
246200        ADD  PV-TOTAL-RETURN-AMT  TO PV-GRAND-TOTAL-RETURN-AMT    24620000
246300        WRITE DEBIT-EXCEPT-REPORT-RECORD                          24630000
246400          FROM S1-SUB-TOTAL-LINE-1                                24640000
246500          AFTER ADVANCING 1 LINES                                 24650000
246600        WRITE DEBIT-EXCEPT-REPORT-RECORD                          24660000
246700          FROM S2-SUB-TOTAL-LINE-2                                24670000
246800          AFTER ADVANCING 1 LINES                                 24680000
246900        WRITE DEBIT-EXCEPT-REPORT-RECORD                          24690000
247000          FROM S3-SUB-TOTAL-LINE-3                                24700000
247100          AFTER ADVANCING 1 LINES                                 24710000
247200        WRITE DEBIT-EXCEPT-REPORT-RECORD                          24720000
247300          FROM S4-SUB-TOTAL-LINE-4                                24730000
247400          AFTER ADVANCING 1 LINES                                 24740000
247500        WRITE DEBIT-EXCEPT-REPORT-RECORD                          24750000
247600          FROM S5-SUB-TOTAL-LINE-5                                24760000
247700          AFTER ADVANCING 1 LINES                                 24770000
247800        WRITE DEBIT-EXCEPT-REPORT-RECORD                          24780000
247900          FROM S6-SUB-TOTAL-LINE-6                                24790000
248000          AFTER ADVANCING 1 LINES                                 24800000
248100        WRITE DEBIT-EXCEPT-REPORT-RECORD                          24810000
248200          FROM S7-SUB-TOTAL-LINE-7                                24820000
248300          AFTER ADVANCING 1 LINES                                 24830000
248400        WRITE DEBIT-EXCEPT-REPORT-RECORD                          24840000
248500          FROM S8-SUB-TOTAL-LINE-8                                24850000
248600          AFTER ADVANCING 1 LINES                                 24860000
248700        MOVE SPACES TO DEBIT-EXCEPT-REPORT-RECORD                 24870000
248800        WRITE DEBIT-EXCEPT-REPORT-RECORD                          24880000
248900           AFTER ADVANCING 1 LINES                                24890000
249000        ADD +9 TO PA-LINE-CNT-1                                   24900000
249100     END-IF.                                                      24910000
249200                                                                  24920000
249300     INITIALIZE PV-DAY-TOTAL.                                     24930000
249400                                                                  24940000
249500     MOVE 'N' TO PS-PRINT-STORE-TOTALS-SW.                        24950000
249600                                                                  24960000
249700     PERFORM 1300-SET-SAVE-STORE-NBR.                             24970000
249800                                                                  24980000
249900     MOVE ZERO       TO PV-TOTAL-TNDR-AMT                         24990000
250000                        PV-TOTAL-TRAN-AMT                         25000000
250100                        PV-TOTAL-SALECOR-AMT                      25010000
250200                        PV-TOTAL-LATE-AMT                         25020000
250300                        PV-TOTAL-VOID-AMT                         25030000
250400                        PV-TOTAL-REVERSAL-AMT                     25040000
250500                        PV-TOTAL-RETURN-AMT                       25050000
250600                        PV-TOTAL-BANKADJ-AMT.                     25060000
250700                                                                  25070000
250800     IF PA-LINE-CNT-1 > PC-LINE-LIMIT                             25080000
250900        PERFORM 4200-WRITE-PAGE-HEADINGS-1                        25090000
251000     END-IF.                                                      25100000
251100                                                                  25110000
071922******************************************************************25111002
071922* PROCESS THE RECORDS TO DETOKENIZE THE CARD NUMBER               25112002
071922******************************************************************25113002
071922 6100-PROCESS-RECORDS.                                            25114002
071922                                                                  25115002
071922     INITIALIZE PV-ACCT-LEN.                                      25116002
071922                                                                  25117002
071922**DETOKENIZING DEBIT CARD NUMBER                                  25120102
071922     MOVE TC002-CARD-NBR       TO PV-ACCT-NBR-19                  25120202
071922     INSPECT FUNCTION REVERSE(PV-ACCT-NBR-19)                     25120402
071922         TALLYING PV-ACCT-LEN FOR LEADING SPACES                  25120502
071922     COMPUTE PV-ACCT-LEN = 19 - PV-ACCT-LEN                       25120602
071922     IF PV-ACCT-LEN < 7                                           25120702
071922        CONTINUE                                                  25120802
071922     ELSE                                                         25120902
071922        PERFORM 6110-DETOKENIZE-ACCT                              25121102
071922        MOVE DP031-CLEAR-TEXT  TO TC002-CARD-NBR                  25121202
071922     END-IF.                                                      25121302
071922                                                                  25121802
071922******************************************************************25122002
071922* CALLS THE PROTEGRITY MODULE TO DETOKENIZE THE CARD NUMBER.      25122102
071922******************************************************************25122202
071922 6110-DETOKENIZE-ACCT.                                            25122302
071922                                                                  25122402
071922     INITIALIZE DP031-PROTEG-PGM-PARAMETERS                       25122502
071922                CSI-PARAMETERS.                                   25122602
071922                                                                  25122702
071922     MOVE PV-ACCT-NBR-19            TO DP031-CIPHER-TEXT.         25123302
071922     MOVE 19                        TO DP031-INPUT-LEN.           25123402
071922                                                                  25123602
071922     MOVE 'ACCOUNT-NUMBER'          TO DP031-FIELD.               25123702
071922     SET CSI-DECRYPT-FUNCTION       TO TRUE.                      25123802
071922     SET DP031-ACCTNBR              TO TRUE.                      25123902
071922     PERFORM DP031-0000-PROTG-TOKEN-DETOKEN.                      25124002
071922     IF CSI-RETURN-CODE NOT = ZERO                                25124102
071922        DISPLAY 'STORE NBR      : '    TC002-STR-NBR              25124202
071922        DISPLAY 'REGISTER ID    : '    TC002-RGST-ID              25124302
071922        DISPLAY 'TRANS NBR      : '    TC002-TRN-NBR              25124402
071922        DISPLAY 'ACCOUNT NBR    : '    TC002-CARD-NBR             25124502
071922        PERFORM DP031-9999-ABEND                                  25124602
071922     END-IF.                                                      25124702
071922                                                                  25124802
251200******************************************************************25125000
251300*    WRITE OUT GRAND TOTAL                                       *25130000
251400******************************************************************25140000
251500 7000-GRAND-TOTAL-LINE.                                           25150000
251600                                                                  25160000
251700*    DISPLAY '7000-GRAND-TOTAL-LINE.'                             25170000
251800     MOVE +7 TO PA-LINE-CNT-1.                                    25180000
251900     ADD  +1 TO PA-PAGE-CNT-1.                                    25190000
252000                                                                  25200000
252100     MOVE PA-PAGE-CNT-1 TO DP132-PAGE-NUMBER.                     25210000
252200                                                                  25220000
252300     WRITE DEBIT-EXCEPT-REPORT-RECORD                             25230000
252400      FROM DP132-STANDRD-HEADER-132-COLS                          25240000
252500      AFTER ADVANCING PAGE.                                       25250000
252600                                                                  25260000
252700     WRITE DEBIT-EXCEPT-REPORT-RECORD                             25270000
252800      FROM T1-TITLE-LINE-1                                        25280000
252900      AFTER ADVANCING 1 LINE.                                     25290000
253000                                                                  25300000
253100     PERFORM                                                      25310000
253200       VARYING PV-GRAND-IDX                                       25320000
253300       FROM 1 BY 1                                                25330000
253400       UNTIL PV-GRAND-IDX > CC-EXCEPT-DAYS-NUMBER                 25340000
253500         OR  PV-GRAND-DATE(PV-GRAND-IDX) = SPACES                 25350000
253600                                                                  25360000
253700        MOVE PV-GRAND-DATE(PV-GRAND-IDX)                          25370000
253800                             TO PV-SPLIT-DATE-CCYYMMDD            25380000
253900        MOVE PV-SPLIT-DATE-MM   TO PV-SPLIT-MM                    25390000
254000        MOVE PV-SPLIT-DATE-DD   TO PV-SPLIT-DD                    25400000
254100        MOVE PV-SPLIT-DATE-CCYY TO PV-SPLIT-CCYY                  25410000
254200        MOVE PV-CC              TO PV-SPLIT-CC                    25420000
254300        MOVE PV-YY              TO PV-SPLIT-YY                    25430000
254400        IF PV-GRAND-TRAN-AMT(PV-GRAND-IDX)      > 0               25440000
254500        OR PV-GRAND-TNDR-AMT(PV-GRAND-IDX)      > 0               25450000
254600        OR PV-GRAND-SALECOR-AMT(PV-GRAND-IDX)   > 0               25460000
254700        OR PV-GRAND-BANKADJ-AMT(PV-GRAND-IDX)   > 0               25470000
254800        OR PV-GRAND-LATE-AMT(PV-GRAND-IDX)      > 0               25480000
254900        OR PV-GRAND-VOID-AMT(PV-GRAND-IDX)      > 0               25490000
255000        OR PV-GRAND-REVERSAL-AMT(PV-GRAND-IDX)  > 0               25500000
255100        OR PV-GRAND-RETURN-AMT(PV-GRAND-IDX)    > 0               25510000
255200            MOVE PV-SPLIT-DATE-1 TO G1-DATE1                      25520000
255300                                    G1-DATE2                      25530000
255400                                    G1-DATE3                      25540000
255500                                    G1-DATE4                      25550000
255600                                    G1-DATE5                      25560000
255700                                    G1-DATE6                      25570000
255800                                    G1-DATE7                      25580000
255900                                    G1-DATE8                      25590000
256000        ELSE                                                      25600000
256100            MOVE SPACES          TO G1-DATE1                      25610000
256200                                    G1-DATE2                      25620000
256300                                    G1-DATE3                      25630000
256400                                    G1-DATE4                      25640000
256500                                    G1-DATE5                      25650000
256600                                    G1-DATE6                      25660000
256700                                    G1-DATE7                      25670000
256800                                    G1-DATE8                      25680000
256900        END-IF                                                    25690000
257000        MOVE PV-GRAND-TRAN-AMT(PV-GRAND-IDX)                      25700000
257100                      TO G1-SALES-AMT-1                           25710000
257200        MOVE PV-GRAND-TNDR-AMT(PV-GRAND-IDX)                      25720000
257300                      TO G1-SALES-AMT-2                           25730000
257400        MOVE PV-GRAND-SALECOR-AMT(PV-GRAND-IDX)                   25740000
257500                      TO G1-SALES-AMT-4                           25750000
257600        MOVE PV-GRAND-BANKADJ-AMT(PV-GRAND-IDX)                   25760000
257700                      TO G1-SALES-AMT-3                           25770000
257800        MOVE PV-GRAND-LATE-AMT(PV-GRAND-IDX)                      25780000
257900                      TO G1-SALES-AMT-5                           25790000
258000        MOVE PV-GRAND-VOID-AMT(PV-GRAND-IDX)                      25800000
258100                      TO G1-SALES-AMT-6                           25810000
258200        MOVE PV-GRAND-REVERSAL-AMT(PV-GRAND-IDX)                  25820000
258300                      TO G1-SALES-AMT-7                           25830000
258400        MOVE PV-GRAND-RETURN-AMT(PV-GRAND-IDX)                    25840000
258500                      TO G1-SALES-AMT-8                           25850000
258600                                                                  25860000
258700        IF G1-DATE1 = SPACES                                      25870000
258800           CONTINUE                                               25880000
258900        ELSE                                                      25890000
259000           WRITE DEBIT-EXCEPT-REPORT-RECORD                       25900000
259100              FROM G1-GRAND-DAILY-TOTAL-LINE-1                    25910000
259200              AFTER ADVANCING 1 LINES                             25920000
259300           ADD +1 TO PA-LINE-CNT-1                                25930000
259400        END-IF                                                    25940000
259500                                                                  25950000
259600        IF G1-DATE2 = SPACES                                      25960000
259700           CONTINUE                                               25970000
259800        ELSE                                                      25980000
259900           WRITE DEBIT-EXCEPT-REPORT-RECORD                       25990000
260000              FROM G2-GRAND-DAILY-TOTAL-LINE-2                    26000000
260100              AFTER ADVANCING 1 LINES                             26010000
260200           ADD +1 TO PA-LINE-CNT-1                                26020000
260300        END-IF                                                    26030000
260400                                                                  26040000
260500        IF G1-DATE3 = SPACES                                      26050000
260600           CONTINUE                                               26060000
260700        ELSE                                                      26070000
260800           WRITE DEBIT-EXCEPT-REPORT-RECORD                       26080000
260900              FROM G3-GRAND-DAILY-TOTAL-LINE-3                    26090000
261000              AFTER ADVANCING 1 LINES                             26100000
261100           ADD +1 TO PA-LINE-CNT-1                                26110000
261200        END-IF                                                    26120000
261300                                                                  26130000
261400        IF G1-DATE4 = SPACES                                      26140000
261500           CONTINUE                                               26150000
261600        ELSE                                                      26160000
261700           WRITE DEBIT-EXCEPT-REPORT-RECORD                       26170000
261800              FROM G4-GRAND-DAILY-TOTAL-LINE-4                    26180000
261900              AFTER ADVANCING 1 LINES                             26190000
262000           ADD +1 TO PA-LINE-CNT-1                                26200000
262100        END-IF                                                    26210000
262200                                                                  26220000
262300        IF G1-DATE5 = SPACES                                      26230000
262400           CONTINUE                                               26240000
262500        ELSE                                                      26250000
262600           WRITE DEBIT-EXCEPT-REPORT-RECORD                       26260000
262700              FROM G5-GRAND-DAILY-TOTAL-LINE-5                    26270000
262800              AFTER ADVANCING 1 LINES                             26280000
262900           ADD +1 TO PA-LINE-CNT-1                                26290000
263000        END-IF                                                    26300000
263100                                                                  26310000
263200        IF G1-DATE6 = SPACES                                      26320000
263300           CONTINUE                                               26330000
263400        ELSE                                                      26340000
263500           WRITE DEBIT-EXCEPT-REPORT-RECORD                       26350000
263600              FROM G6-GRAND-DAILY-TOTAL-LINE-6                    26360000
263700              AFTER ADVANCING 1 LINES                             26370000
263800           ADD +1 TO PA-LINE-CNT-1                                26380000
263900        END-IF                                                    26390000
264000                                                                  26400000
264100        IF G1-DATE7 = SPACES                                      26410000
264200           CONTINUE                                               26420000
264300        ELSE                                                      26430000
264400           WRITE DEBIT-EXCEPT-REPORT-RECORD                       26440000
264500              FROM G7-GRAND-DAILY-TOTAL-LINE-7                    26450000
264600              AFTER ADVANCING 1 LINES                             26460000
264700           ADD +1 TO PA-LINE-CNT-1                                26470000
264800        END-IF                                                    26480000
264900                                                                  26490000
265000        IF G1-DATE8 = SPACES                                      26500000
265100           CONTINUE                                               26510000
265200        ELSE                                                      26520000
265300           WRITE DEBIT-EXCEPT-REPORT-RECORD                       26530000
265400              FROM G8-GRAND-DAILY-TOTAL-LINE-8                    26540000
265500              AFTER ADVANCING 1 LINES                             26550000
265600           ADD +1 TO PA-LINE-CNT-1                                26560000
265700        END-IF                                                    26570000
265800                                                                  26580000
265900        IF G1-DATE1 = SPACES AND                                  26590000
266000           G1-DATE2 = SPACES AND                                  26600000
266100           G1-DATE3 = SPACES AND                                  26610000
266200           G1-DATE4 = SPACES AND                                  26620000
266300           G1-DATE5 = SPACES AND                                  26630000
266400           G1-DATE6 = SPACES AND                                  26640000
266500           G1-DATE7 = SPACES AND                                  26650000
266600           G1-DATE8 = SPACES                                      26660000
266700             CONTINUE                                             26670000
266800        ELSE                                                      26680000
266900             PERFORM 4300-WRITE-BLANK-LINE                        26690000
267000        END-IF                                                    26700000
267100                                                                  26710000
267200        IF PA-LINE-CNT-1 > PC-LINE-LIMIT                          26720000
267300           PERFORM 4200-WRITE-PAGE-HEADINGS-1                     26730000
267400        END-IF                                                    26740000
267500     END-PERFORM.                                                 26750000
267600                                                                  26760000
267700     IF PA-LINE-CNT-1 > PC-LINE-LIMIT                             26770000
267800        PERFORM 4200-WRITE-PAGE-HEADINGS-1                        26780000
267900     END-IF.                                                      26790000
268000                                                                  26800000
268100     MOVE PV-GRAND-TOTAL-TRAN-AMT    TO G2-SALES-AMT-1.           26810000
268200     MOVE PV-GRAND-TOTAL-TNDR-AMT    TO G2-SALES-AMT-2.           26820000
268300     MOVE PV-GRAND-TOTAL-BANKADJ-AMT TO G2-SALES-AMT-3.           26830000
268400     MOVE PV-GRAND-TOTAL-SALECOR-AMT TO G2-SALES-AMT-4.           26840000
268500     MOVE PV-GRAND-TOTAL-LATE-AMT    TO G2-SALES-AMT-5.           26850000
268600     MOVE PV-GRAND-TOTAL-VOID-AMT    TO G2-SALES-AMT-6.           26860000
268700     MOVE PV-GRAND-TOTAL-REVERSAL-AMT TO G2-SALES-AMT-7.          26870000
268800     MOVE PV-GRAND-TOTAL-RETURN-AMT  TO G2-SALES-AMT-8.           26880000
268900                                                                  26890000
269000     PERFORM 4300-WRITE-BLANK-LINE.                               26900000
269100     WRITE DEBIT-EXCEPT-REPORT-RECORD                             26910000
269200       FROM G1-GRAND-TOTAL-LINE-1                                 26920000
269300       AFTER ADVANCING 1 LINES.                                   26930000
269400     WRITE DEBIT-EXCEPT-REPORT-RECORD                             26940000
269500       FROM G2-GRAND-TOTAL-LINE-2                                 26950000
269600       AFTER ADVANCING 1 LINES.                                   26960000
269700     WRITE DEBIT-EXCEPT-REPORT-RECORD                             26970000
269800       FROM G3-GRAND-TOTAL-LINE-3                                 26980000
269900       AFTER ADVANCING 1 LINES.                                   26990000
270000     WRITE DEBIT-EXCEPT-REPORT-RECORD                             27000000
270100       FROM G4-GRAND-TOTAL-LINE-4                                 27010000
270200       AFTER ADVANCING 1 LINES.                                   27020000
270300     WRITE DEBIT-EXCEPT-REPORT-RECORD                             27030000
270400       FROM G5-GRAND-TOTAL-LINE-5                                 27040000
270500       AFTER ADVANCING 1 LINES.                                   27050000
270600     WRITE DEBIT-EXCEPT-REPORT-RECORD                             27060000
270700       FROM G6-GRAND-TOTAL-LINE-6                                 27070000
270800       AFTER ADVANCING 1 LINES.                                   27080000
270900     WRITE DEBIT-EXCEPT-REPORT-RECORD                             27090000
271000       FROM G7-GRAND-TOTAL-LINE-7                                 27100000
271100       AFTER ADVANCING 1 LINES.                                   27110000
271200     WRITE DEBIT-EXCEPT-REPORT-RECORD                             27120000
271300       FROM G8-GRAND-TOTAL-LINE-8                                 27130000
271400       AFTER ADVANCING 1 LINES.                                   27140000
271500                                                                  27150000
271600******************************************************************27160000
271700* 8000-END-PROGRAM                                               *27170000
271800*     CLOSE FILES AND CURSORS                                    *27180000
271900******************************************************************27190000
272000 8000-END-PROGRAM.                                                27200000
272100                                                                  27210000
272200*    DISPLAY '8000-END-PROGRAM.'                                  27220000
272300     DISPLAY 'EXCEPT TABLE COUNT ' PA-LINE-EXCEPT-CNT.            27230000
272400     CLOSE DEBIT-EXCEPT-REPORT-FILE                               27240000
272500           MERCHANT-ACTIVITY-IN-FILE                              27250000
272600           COSA-IN-FILE                                           27260000
272700           CONTROL-DATE-FILE                                      27270000
272800           EXCEPT-DAYS-NUMBER-FILE                                27280000
272900           NXT-POS-DATE-CARD-FILE                                 27290000
273000           MERCHANT-ACTIVITY-OUT-FILE                             27300000
273100           COSA-OUT-FILE                                          27310000
273200           MATCHED-FILE                                           27320000
273300           EXCEPT-FILE.                                           27330000
273400                                                                  27340000
273500******************************************************************27350000
273600* 8500-SUBTRACT-1-DAY                                            *27360000
273700*     SUBTRACT 1 DAY FROM PROCESSING DAY                         *27370000
273800*     IF THE MAF MATCHES TO THE COSA WRAP, THEN WRITE THIS RECORD*27380000
273900*        TO AN OUTPUT FILE                                       *27390000
274000******************************************************************27400000
274100 8500-SUBTRACT-1-DAY.                                             27410000
274200                                                                  27420000
274300*    DISPLAY '8500-SUBTRACT-1-DAY.'                               27430000
274400     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              27440000
274500                                                                  27450000
274600     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   27460000
274700     SET  DPG51-DECREMENT-DATE   TO TRUE.                         27470000
274800     MOVE 1                      TO DPG51-INCR-DECR-DAYS-9.       27480000
274900     SET  DPG52-LK-DTE-ISO       TO TRUE.                         27490000
275000     MOVE CC-CURRENT-DATE        TO DPG52-LK-DATE-INPUT.          27500000
275100     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    27510000
275200                                             DPG54 DPG55 DPG56.   27520000
275300     EVALUATE TRUE                                                27530000
275400         WHEN DPG54-SEVERE-ERROR                                  27540000
275500         WHEN DPG54-DATE-INVALID                                  27550000
275600             MOVE '8500-SUBTRACT-1-DAY'                           27560000
275700                                           TO PV-PARAGRAPH-NAME   27570000
275800             MOVE 'ERROR CONVERTING PROCESSING DATE'              27580000
275900                                           TO PV-OPERATION-MSG-1  27590000
276000             SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                27600000
276100             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  27610000
276200             PERFORM 9999-ABEND                                   27620000
276300     END-EVALUATE.                                                27630000
276400                                                                  27640000
276500     MOVE DPG55-DB2-ISO-DATE     TO PV-DAY-BEFORE.                27650000
276600                                                                  27660000
276700                                                                  27670000
276800******************************************************************27680000
276900* 9000-ADD-DATE-2-GRND-TOTAL-TBL                                 *27690000
277000*     LOAD THE LAST 21 BUSINESS DAYS TO THE PV-GRND-TOTAL TABLE  *27700000
277100*     EXCEPTION DAYS NUMBER FROM INPUT CONTROL CARD WILL         *27710000
277200*     DETERMINE HOW MANYS DAYS TO MOVE TO THE TABLE              *27720000
277300*            ************  MAX IS 30  MAX OCCURS IN TABLE ***    *27730000
277400******************************************************************27740000
277500 9000-ADD-DATE-2-GRND-TOTAL-TBL.                                  27750000
277600                                                                  27760000
277700*    DISPLAY '9000-ADD-DATE-2-GRND-TOTAL-TBL.'                    27770000
277800     PERFORM 9010-PROCESS-NEXT-DATE-CARD.                         27780000
277900*                                                                 27790000
278000     READ EXCEPT-DAYS-NUMBER-FILE  INTO CC-EXCEPT-DAYS-CARD       27800000
278100        AT END                                                    27810000
278200           SET PS-END-OF-EXCEPT-FILE  TO TRUE.                    27820000
278300                                                                  27830000
278400     IF PS-END-OF-EXCEPT-FILE                                     27840000
278500        DISPLAY 'EXCEPT DAYS FILE MISSING '                       27850000
278600        MOVE '9000-ADD-DATE-2-GRND-TOTAL-TBL'                     27860000
278700                                 TO PV-PARAGRAPH-NAME             27870000
278800        SET AC-CONTROL-CARD-ERROR TO TRUE                         27880000
278900        PERFORM 9999-ABEND                                        27890000
279000     ELSE                                                         27900000
279100         SET PV-GRAND-IDX        TO +1                            27910000
279200         MOVE CC-EXCEPT-DAYS-NUMBER                               27920000
279300                                 TO SUB                           27930000
279400         SUBTRACT +1               FROM SUB                       27940000
279500         PERFORM 9100-DATES-TO-ADD                                27950000
279600           UNTIL SUB = 0                                          27960000
279700         MOVE CC-NXT-POS-DATE    TO  PV-POS-CCYYMMDD              27970000
279800         MOVE PV-POS-MM          TO  PV-TABLE-DATE-MM             27980000
279900         MOVE PV-POS-DD          TO  PV-TABLE-DATE-DD             27990000
280000         MOVE PV-POS-YY          TO  PV-HOLD-YY                   28000000
280100         MOVE '20'               TO  PV-HOLD-CC                   28010000
280200         MOVE PV-HOLD-CCYY       TO  PV-TABLE-DATE-CCYY           28020000
280300         MOVE PV-TABLE-DATE-CCYYMMDD                              28030000
280400                                 TO  PV-GRAND-DATE(PV-GRAND-IDX)  28040000
280500     END-IF.                                                      28050000
280600                                                                  28060000
280700******************************************************************28070000
280800* 9010-PROCESS-NEXT-DATE-CARD                                     28080000
280900******************************************************************28090000
281000                                                                  28100000
281100 9010-PROCESS-NEXT-DATE-CARD.                                     28110000
281200                                                                  28120000
281300*    DISPLAY '9010-PROCESS-NEXT-DATE-CARD.'                       28130000
281400     READ NXT-POS-DATE-CARD-FILE INTO CC-CONTROL-CARD-INP03       28140000
281500         AT END                                                   28150000
281600             SET PS-END-OF-NXT-DATE-FILE TO TRUE.                 28160000
281700                                                                  28170000
281800     IF PS-END-OF-NXT-DATE-FILE                                   28180000
281900         MOVE '9010-PROCESS-NEXT-DATE-CARD ' TO PV-PARAGRAPH-NAME 28190000
282000         MOVE 'DATE CARD MISSING           ' TO PV-OPERATION-MSG-128200000
282100         PERFORM 9999-ABEND                                       28210000
282200     END-IF.                                                      28220000
282300                                                                  28230000
282400     DISPLAY 'NEXT POS DATE: ' CC-NXT-POS-DATE.                   28240000
282500*                                                                 28250000
282600******************************************************************28260000
282700* 9100-DATES-TO-ADD.                                             *28270000
282800*     LOAD DATES TO PV-GRAND-DATE IN THE PV-GRAND-TOTALS TABLE   *28280000
282900*     LOAD DATES IN ASENDING SEQUENCE BY SETTING SUB TO THE      *28290000
283000*     CONTROL CARD NUMBER AND SUBTRACT 1 UNTIL SUB = 0           *28300000
283100******************************************************************28310000
283200 9100-DATES-TO-ADD.                                               28320000
283300*    DISPLAY '9100-DATES-TO-ADD.'                                 28330000
283400     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              28340000
283500                                                                  28350000
283600     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   28360000
283700     SET  DPG51-DECREMENT-DATE   TO TRUE.                         28370000
283800     MOVE SUB                    TO DPG51-INCR-DECR-DAYS-9.       28380000
283900     SET  DPG52-LK-DTE-ISO       TO TRUE.                         28390000
284000     MOVE CC-NXT-POS-DATE(1:8)   TO DPG52-LK-DATE-INPUT.          28400000
284100     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    28410000
284200                                             DPG54 DPG55 DPG56.   28420000
284300     EVALUATE TRUE                                                28430000
284400         WHEN DPG54-SEVERE-ERROR                                  28440000
284500         WHEN DPG54-DATE-INVALID                                  28450000
284600             MOVE '9100-DATES-TO-ADD'                             28460000
284700                                           TO PV-PARAGRAPH-NAME   28470000
284800             MOVE 'ERROR CONVERTING PROCESSING DATE'              28480000
284900                                           TO PV-OPERATION-MSG-1  28490000
285000             SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                28500000
285100             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  28510000
285200             PERFORM 9999-ABEND                                   28520000
285300     END-EVALUATE.                                                28530000
285400                                                                  28540000
285500     MOVE DPG55-DB2-ISO-DATE     TO PV-GRAND-DATE(PV-GRAND-IDX).  28550000
285600     SET PV-GRAND-IDX  UP BY +1.                                  28560000
285700     SUBTRACT +1               FROM SUB.                          28570000
285800                                                                  28580000
285900***************************************************************** 28590000
286000* 9999-ABEND                                                      28600000
286100*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  28610000
286200***************************************************************** 28620000
286300 9999-ABEND.                                                      28630000
286400                                                                  28640000
286500     DISPLAY '9999-ABEND.'                                        28650000
286600     DISPLAY '** ABEND           **'.                             28660000
286700     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          28670000
286800     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        28680000
286900     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         28690000
287000                                                                  28700000
287100******************************************************************28710000
287200*     Z900-SQL-ABEND                                             *28720000
287300* ==> PROCESSES:                                                 *28730000
287400*     -PERFORMS ABEND PROCESSING FOR SQL ERRORS.                 *28740000
287500* ==> PERFORMED FROM:  B200-PROCESS-EXCEPTIONS                   *28750000
287600*                      D000-FETCH-TKMCACT-CURSOR                 *28760000
287700*                      G100-GET-STORE-NAME                       *28770000
287800******************************************************************28780000
287900 Z900-SQL-ABEND.                                                  28790000
288000                                                                  28800000
288100     DISPLAY 'Z900-SQL-ABEND'.                                    28810000
288200     DISPLAY '**  ABEND     **'.                                  28820000
288300     DISPLAY '**  PROGRAM   ** = ' PC-PROGRAM-NAME.               28830000
288400     DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.             28840000
288500     DISPLAY '**  OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.    28850000
288600                                                                  28860000
288700******************************************************************28870000
288800* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *28880000
288900* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *28890000
289000* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *28900000
289100* FORMAT.                                                        *28910000
289200******************************************************************28920000
289300                                                                  28930000
289400     COPY DPPD004.                                                28940000
289500                                                                  28950000
289600     MOVE +4013 TO ABEND-CODE.                                    28960000
289700     CALL 'ILBOABN0' USING ABEND-CODE.                            28970000
071922                                                                  28971002
071922******************************************************************28980002
071922* COPY MEMBER DPPD031 CONTAINS STATEMENTS NEEDED TO INVOKE        28990002
071922* PROTEGRITY MODULE FOR PROTECTION / UNPROTECTION                 29000002
071922******************************************************************29010002
071922     COPY DPPD031.                                                29020002
071922                                                                  29030002
