000100*-----------------------*                                         00010004
000200 IDENTIFICATION DIVISION.                                         00020004
000300*-----------------------*                                         00030004
000400 PROGRAM-ID.    APKUT105.                                         00040004
000500 AUTHOR.        PAUL KEBER - STRATAGEM.                           00050004
000600 DATE-WRITTEN.  NOVEMBER, 1995.                                   00060004
000700                                                                  00070004
000800*----------------------------------------------------------------*00080028
000900*                                                                *00090028
001000*    COBOL II WITH SQL                                           *00100028
001100*                                                                *00110028
001200*         --- PO/STORE RECEIPT EXTRACT ---                       *00120028
001210*                                                                *00121028
001220*    THIS PROGRAM CREATES EXTRACT FILES CONSISTING OF RECEIPT    *00122028
001230*    INFORMATION NEEDED BY CLASS DISTRIBUTION PROCESSING         *00123028
001240*    (APKUP254).  THESE FILES WILL BE USED TO ELIMINATE THE      *00124028
001250*    BULK PO LINE, STORE PO LINE, BULK SUM, STORE SUM, BULK,     *00125028
001260*    AND STORE CURSORS IN APKUP254.                              *00126028
001270*                                                                *00127028
001280*    THE PO/STORE PO LINES FILE WILL CONTAIN RECEIPTS DATA FROM  *00128028
001290*    THE BULK OR STORE RECEIPTS CURSOR FOR EACH PRICE CLAIM      *00129028
001291*    CURSOR ENTRY WHERE THE PO LINE NUMBERS FROM EACH CURSOR     *00129128
001292*    MATCH.  ONLY ONE SET OF PO LINES FILE RECORDS WILL BE       *00129228
001293*    CREATED FOR EACH UNIQUE PO LINE NUMBER FOR A PO/STORE.      *00129328
001294*                                                                *00129428
001295*    THE PO/STORE RECEIPTS SUM FILE WILL CONTAIN A RUNNING       *00129528
001296*    TOTAL OF THE RECEIVER COSTS FOR EACH ROW RETRIEVED FROM     *00129628
001297*    THE BULK OR STORE RECEIPTS CURSOR.                          *00129728
001298*                                                                *00129828
001299*    THE PO/STORE RECEIPTS FILE WILL CONTAIN RECEIPTS DATA FOR   *00129928
001300*    EACH ROW RETRIEVED FROM THE BULK OR STORE RECEIPTS CURSOR.  *00130028
001310*                                                                *00131028
001400* DB2 TABLES:                                                    *00140028
001500*  1. AP-RELEASED PO/STORES            (TPOSTRR)                 *00150028
001600*  2. AP-PRICE CLAIM ADJUSTMENTS       (TPRCCLM)                 *00160028
001700*  3. RECEIVER                         (TRECEIV)                 *00170028
001800*  4. PURCHASE ITEM                    (TPURITM)                 *00180028
001900*  5. RECEIPT DISTRIBUTION             (TRECDIS)                 *00190028
002000*  6. RECEIPT ITEM                     (TRECITM)                 *00200028
002100*  7. NON-INVOICED RECEIPT             (TNINREC)                 *00210028
002200*  8. LOCATION                         (XFT00017)                *00220029
002300*  9. SKU CROSS REFERENCE              (TSKXREF)                 *00230028
002310* 10. PURCHASE ORDER HEADER TABLE      (TPURCHS)                 *00231028
002400*                                                                *00240028
002500* OUTPUT:                                                        *00250028
002600*  1. PO-LINES-FILE                    (APRD100)                 *00260028
002700*  2. RECEIPTS-SUM-FILE                (APRD101)                 *00270028
002800*  3. RECEIPTS-FILE                    (APRD105)                 *00280028
002900*                                                                *00290028
003000*----------------------------------------------------------------*00300028
005400*   CHANGES:                                                     *00540028
005500*                                                                *00550028
005600*   06/17/96  MARY KING                                          *00560028
005700*           - ADDED LOGIC IN B200 TO PERIODICALLY DISPLAY        *00570028
005800*             THE PO/STORE THE PROGRAM IS PROCESSING.  TO        *00580028
005900*             DO THIS, TAPCNTL WAS INCLUDED SO A SELECT          *00590028
006000*             OF CURRENT TIME + 60 SECONDS COULD BE DONE         *00600028
006100*             WITHOUT INFLUENCING OTHER PROGRAM LOGIC.           *00610028
006200*           - REMOVED DB2 RETRY LOGIC.                           *00620028
006300*                                                                *00630028
006400*   04/23/97  MARILYN WILKINSON                                  *00640028
006500*           - ADDED LOGIC FOR DEFERRED BOOKING  - SELECT         *00650028
006600*             OPER UNT AND FIND ITS TYPE CODE (R500)             *00660028
006700*                                                                *00670028
006800*   10/22/98  MIKE BESKE                         WR# ?????       *00680028
006900*           - PEOPLESOFT CONVERSION.  ADDED THE SKU-SEQ-NBR      *00690028
007000*             TO THE BULK_CSR AND STORE_CSR.  THIS IS PART       *00700028
007100*             OF THE CHANGE OVER FROM THE PURCHASE JOURNAL       *00710028
007200*             TO THE ADJUSTMENT JOURNAL.  THIS CHANGE WILL       *00720028
007300*             ALLOW CLASS DISTRIBUTION TO HAPPEN AT THE SKU      *00730028
007400*             LEVEL.  PARAS MOD R300-, R400-, W100-, W300-       *00740028
007500*                                                                *00750028
007600*   05/31/02  NANCY EILBES                       WR# 22902       *00760028
007700*           - ADDED 'OR 0 = 1' TO VER-NBR WHERE CONDITION        *00770028
007800*             IN THE STORE CURSOR TO FORCE DB2 TO GO AFTER       *00780028
007900*             TRECDIS BEFORE TPURITM WHEN CHOOSING ACCESS        *00790028
008000*             PATH.                                              *00800028
008100*                                                                *00810028
008200*   06/04/02  NANCY EILBES                       WR# 22902       *00820028
008300*      ADDED SEVERAL STATEMENTS TO THE WHERE CONDITION IN        *00830028
008400*      THE BULK CURSOR TO FORCE DB2 TO GO AFTER TRECDIS          *00840028
008500*      BEFORE TPURITM WHEN CHOOSING THE ACCESS PATH.             *00850028
008600*                                                                *00860028
008700* 02/07/2003                                                     *00870028
008800*    CHANGE MADE: ARKPO PHASE3 PROJECT.                          *00880028
008900*    UPDATED PGM COMMENT BLOCK WITH THE FILENAMES.               *00890028
009000*    CHANGED -PURCHASE-ORDER TO -PO-NBR FOR THE 3 COPYBOOK       *00900028
009100*    FIELD NAMES.                                                *00910028
009200* MADE BY:  MIKE BESKE                          WR#: 23500       *00920028
009300*                                                                *00930028
009400* 05/12/2003                                                     *00940028
009500*    CHANGE MADE: NI-SKU CHANGES.                                *00950028
009600*    ADDED TSKXREF AND A NEW PARAGRAPH TO SELECT SKU FROM IT     *00960028
009700*    CHANGED BULK_CSR & STORE_CSR TO NOT SELECT SKU_SEQ_NBR,     *00970028
009800*    BUT RATHER SELECT ITM_NBR & RMS_PO_SKU_NBR.  CODE WAS       *00980028
009900*    ADDED TO MOVE RMS_PO_SKU_NBR TO A NEW WORK FIELD FOR        *00990028
010000*    THE SKU (PV-SKU-NBR) IF IT IS NOT = ZERO.  OTHERWISE        *01000028
010100*    SKXREF-SKU WILL BE MOVED TO PV-SKU-NBR.                     *01010028
010200* MADE BY:  MIKE BESKE                          WR#: 22557       *01020028
010300*                                                                *01030028
010400* 06/02/2003                                                     *01040028
010500*    CHANGE MADE:                                                *01050028
010600*    ADDED CODE TO MOVE ZERO TO PV-SKU-NBR IF PURITM-RMS-PO-     *01060028
010700*    NBR AND PURITM-ITM-NBR BOTH ARE ZERO.  PARA S100- WILL      *01070028
010800*    ONLY BE PERFORMED IF PURITM-RMS-PO-NBR = 0 AND PURITM-      *01080028
010900*    ITM-NBR NOT = 0.                                             01090004
011000* MADE BY:  MIKE BESKE                          IR#: 553511      *01100028
011100*                                                                *01110028
011200* 06/22/2003                                                     *01120028
011300*    CHANGE MADE:                                                *01130028
011400*    IN PARA S100-, IF THE PURITM-ITM-NBR CAN NOT FIND A         *01140028
011500*    MATCH TO GET A SKU NUMBER, THEN ZEROES WILL BE MOVED TO     *01150028
011600*    SKXREF-SKU.                                                 *01160028
011700* MADE BY:  MIKE BESKE                          IR#: 559383      *01170028
011800*                                                                *01180028
011900* 12/15/2003                                                     *01190028
012000*    CHANGE MADE:                                                *01200028
012100*    STORE CURSOR WAS MODIFIED TO CHANGE DB2 ACCESS PATH.        *01210028
012200*    SEE COMMENTS IN CURSOR FOR SPECIFICS.                       *01220028
012300* MADE BY:  NANCY EILBES                        IR#: 616628      *01230028
012400*                                                                *01240028
012500* 04/01/2004                                                     *01250028
012600*    CHANGE MADE:  REPLACED TSTR000 WITH XFT00003                *01260028
012700*    (FI_XFT_LOC).  RECODED PARA R500- TO USE THE NEW TABLE.     *01270028
012800* MADE BY:  MIKE BESKE                          WR#: 25805       *01280028
012810*                                                                *01281028
012820* 10/06/2004                                                     *01282028
012830*    CHANGE MADE:  MODIFIED LOGIC TO LOAD AN ARRAY WITH          *01283028
012840*    LOCATION NUMBER AND LOCATION TYPE IN INITIALIZATION         *01284028
012841*    AND THEN SEARCH THIS ARRAY TO GET THE LOCATION TYPE         *01284128
012842*    FOR THE OPER-UNT-ID BEING PROCESSED INSTEAD OF DOING        *01284228
012843*    A SELECT AGAINST XFT_LOC EACH TIME.  ADDED A COMMIT         *01284328
012844*    TO BE PERFORMED AFTER XFT PROCESSING IS COMPLETE TO         *01284428
012845*    RELEASE THE THREAD TO DB3P.                                 *01284528
012846*    MADE BY:  NANCY EILBES             WR/IR #: P000690867      *01284628
012847*                                                                *01284728
012848* 02/16/2005                                                     *01284828
012849*    CHANGE MADE:  ADDED WORK FIELD PV-TOTAL-REC-COST WITH       *01284928
012850*    3 DIGITS AFTER THE DECIMAL POINT AND CHANGED LOGIC TO       *01285028
012860*    ACCUMULATE PV_TOTAL_COST INTO THIS FIELD INSTEAD OF         *01286028
012870*    DIRECTLY INTO AP101-TOTAL-REC-COST TO REDUCE EFFECT OF      *01287028
012880*    ROUNDING.  WHEN PO/STORE CHANGES, PV-TOTAL-REC-COST IS      *01288028
012890*    MOVED TO AP101-TOTAL-REC-COST JUST BEFORE THAT RECORD       *01289028
012891*    IS WRITTEN.                                                 *01289128
012892*    MADE BY:  NANCY EILBES             WR/IR #: WR28327         *01289228
012893*                                                                *01289328
012894* 11/15/2005                                                     *01289428
012895*    CHANGE MADE:  MODIFIED BULK AND STORE CURSORS TO TWEAK      *01289528
012896*    DB2 ACCESS PATH BACK TO ACCESSING TRECDIS BEFORE            *01289628
012897*    TPURITM.                                                    *01289728
012898*    MADE BY:  NANCY EILBES             WR/IR #: P000822974      *01289828
012899*                                                                *01289928
012900* 03/11/2007                                                     *01290028
012901*    CHANGE MADE:  MODIFIED PROGRAM FOR THE MATCH BY DC          *01290128
012902*    PROJECT.  THE PROCESS WAS CHANGED TO USE THE NEW            *01290228
012903*    MATCH LEVEL CODE RATHER THAN THE STORE NUMBER ON THE        *01290328
012904*    TPOSTRR.  THIS REQUIRED THE ADDITIONAL DC_CSR SO THE        *01290428
012905*    RECORDS COULD BE PROCESSED AS EITHER BULK (P), STORE        *01290528
012906*    (S) OR DISTRIBUTION CENTER (D).                             *01290628
012907*    MADE BY:  MICHELE RINDFLEISCH      WR/IR #: WR21578         *01290728
012908*                                                                *01290828
012909* DATE  03/27/2007                                               *01290928
012910*     CHANGE MADE: RECOMPILE FROM PRODUCTION TO INCORPORATE      *01291028
012911*     CHANGES TO PS_XFT_LOC TABLE FOR STORE DEMOGRAPHICS.        *01291128
012912*     MADE BY: KEVIN CATLIN            WR/IR #: WR31452          *01291228
012913*                                                                *01291328
012914* DATE  02/04/2008                                               *01291428
012915*     CHANGE MADE: PRIVATE LABEL ACCOUNTING PROJECT.             *01291528
012916*     MODIFIED BULK, STORE & DC CURSORS TO ADD COMPUTATION       *01291628
012917*     OF PI.PRD_1ST_COST_AMT AND IN THE UNION DUPLICATED         *01291728
012918*     THE COMPUTATION OF NR.UNT_COST_AMT. IN PARAGRAPH D100-     *01291828
012919*     REPLACED THE STATEMENT PROCESSING TOTAL-REC-COST WITH      *01291928
012920*     WITH AN 'IF' STATEMENT TO ADD TOTAL-1ST-COST TO            *01292028
012921*     TOTAL-REC-COST WHEN PO-TYP-CDE IS 'IM', 'IE' OR 'IF',      *01292128
012922*     OTHERWISE, CONTINUE TO ADD TOTAL-COST. ADDED PARAGRAPH     *01292228
012923*     S200-SELECT-PO-TYPE TO SELECT PO-TYP-CDE FROM TPURCHS      *01292328
012924*     TABLE FOR PO-BEING-PROCESSED. ADDED THE PERFORM OF         *01292428
012925*     THIS PARAGRAPH TO C100-. ADDED TPURCHS DCLGEN TO WS.       *01292528
012926*     MADE BY: IRMA NAVA               WR/IR #: WR32664          *01292628
012927*                                                                *01292728
012928* DATE  05/08/2008                                               *01292828
012929*   CHANGE MADE: PRIVATE LABEL GIVEBACK PROJECT.                 *01292928
012930*   DURING POST-GIVEBACK VALIDATION, IT WAS DETERMINED THAT TOO  *01293028
012931*   MUCH LOAD WAS BEING COLLECTED FOR DOMESTIC PRIVATE LABEL POS *01293128
012932*   THAT HAD MIXED BRAND ITEMS.  MODIFIED APRD105 TO ADD A NEW   *01293228
012933*   COST FIELD TO HOLD THE TOTAL 'LOADED' COST SO THIS WOULD BE  *01293328
012934*   AVAILABLE IN APKUP254 TO CHANGE THE WAY THE LOAD AMOUNT IS   *01293428
012935*   CALCULATED.  APKUT105 POPULATES THIS NEW FIELD.              *01293528
012936*   MADE BY: NANCY EILBES            WR/IR #: WR34309            *01293628
012937*                                                                *01293728
012938* DATE  09/01/2011                                               *01293830
012939*   CHANGE MADE: PROGRAM WAS MODIFIED FOR DB2 RE-PLATFORM        *01293930
012940*   TO ORACLE AS PART OF THE PEOPLESOFT FINANCIAL UPGRADE TO     *01294030
012941*   VERSION 9.1.                                                 *01294130
012942*   - DB2 TABLE NAME WILL BE CHANGED FROM FI_XFT_LOC TO          *01294230
012943*     XFT_LOC.                                                   *01294330
012944*     ITS DCLGEN CHANGED FROM XFT00003 TO XFT00017.              *01294430
012945*   - CHANGES DONE IN PARA B100-, X100-,X200- AND X300-          *01294530
012950*     MADE BY: GURUNANAK               WR/IR #: WR37038          *01295030
012951*                                                                *01295130
012952******************************************************************01295230
012953 EJECT                                                            01295330
012954                                                                  01295430
012955 ENVIRONMENT DIVISION.                                            01295530
012956 CONFIGURATION SECTION.                                           01295630
012957 SOURCE-COMPUTER. IBM-3090.                                       01295730
012958 OBJECT-COMPUTER. IBM-3090.                                       01295830
012959                                                                  01295930
012960*                                                                 01296030
012961 INPUT-OUTPUT SECTION.                                            01296130
012962 FILE-CONTROL.                                                    01296230
012963*                                                                 01296330
012964     SELECT PO-LINES-FILE        ASSIGN TO UT-S-OUT01.            01296430
012965     SELECT RECEIPTS-SUM-FILE    ASSIGN TO UT-S-OUT02.            01296530
012966     SELECT RECEIPTS-FILE        ASSIGN TO UT-S-OUT03.            01296630
012967*                                                                 01296730
012968 DATA DIVISION.                                                   01296830
012970 FILE SECTION.                                                    01297004
012980*                                                                 01298004
012990*                                                                 01299004
013000 FD  PO-LINES-FILE                                                01300004
013100     RECORDING MODE IS F                                          01310004
013200     BLOCK CONTAINS 0 CHARACTERS                                  01320004
013300     LABEL RECORDS ARE STANDARD                                   01330004
013400     DATA RECORD IS PO-LINES-RECORD.                              01340004
013500*                                                                 01350004
013600 01  PO-LINES-RECORD           PIC X(60).                         01360004
013700*                                                                 01370004
013800 FD  RECEIPTS-SUM-FILE                                            01380004
013900     RECORDING MODE IS F                                          01390004
014000     BLOCK CONTAINS 0 CHARACTERS                                  01400004
014100     LABEL RECORDS ARE STANDARD                                   01410004
014200     DATA RECORD IS RECEIPTS-SUM-RECORD.                          01420004
014300*                                                                 01430004
014400 01  RECEIPTS-SUM-RECORD       PIC X(20).                         01440004
014500*                                                                 01450004
014600 FD  RECEIPTS-FILE                                                01460004
014700     RECORDING MODE IS F                                          01470004
014800     BLOCK CONTAINS 0 CHARACTERS                                  01480004
014900     LABEL RECORDS ARE STANDARD                                   01490004
015000     DATA RECORD IS RECEIPTS-RECORD.                              01500004
015100*                                                                 01510004
015200 01  RECEIPTS-RECORD           PIC X(200).                        01520004
015300*                                                                 01530004
015400 EJECT                                                            01540004
015500 WORKING-STORAGE SECTION.                                         01550004
015600                                                                  01560004
015700 01  PV-PROGRAM-VARIABLES.                                        01570004
015800     05  FILLER                  PIC  X(30)  VALUE                01580004
015900         '** BEGINING OF APKUT105 W/S **'.                        01590004
016000     05  PV-PO-BEING-PROCESSED   PIC S9(09)  VALUE ZEROS          01600004
016100                                             COMP.                01610004
016200     05  PV-PO-COUNT             PIC S9(9)   VALUE ZEROS          01620004
016300                                             COMP.                01630004
016400     05  PV-STORE-BEING-PROCESSED PIC S9(4)  VALUE ZEROS          01640004
016500                                             COMP.                01650004
016600     05  PV-SAVE-PREV-OPER-UNT-ID PIC S9(4)  VALUE ZEROS          01660004
016700                                             COMP.                01670004
016800                                                                  01680004
016900     05  PV-OPER-UNT-ID-NBR      PIC S9(04)  COMP-3 VALUE ZEROS.  01690004
017000                                                                  01700004
017100     05  PV-RECEIPT-TYPE         PIC  X(02)  VALUE SPACES.        01710004
017200         88 PV-RECEIVER                      VALUE 'RV'.          01720004
017300         88 PV-NON-INVC-RECEIPT              VALUE 'NR'.          01730004
017400     05  PV-TOTAL-COST           PIC S9(09)V9(3)                  01740004
017500                                             VALUE ZEROS          01750004
017600                                             COMP-3.              01760004
017610     05  PV-TOTAL-1ST-COST       PIC S9(09)V9(3)                  01761010
017620                                             VALUE ZEROS          01762010
017630                                             COMP-3.              01763010
017700     05  PV-TOTAL-REC-COST       PIC S9(09)V9(3)                  01770004
017800                                             VALUE ZEROS          01780004
017900                                             COMP-3.              01790004
018000     05  PV-CURRENT-TIME         PIC  X(26)   VALUE SPACES.       01800004
018100     05  PV-TEMP-DISPLAY-TIME    PIC  X(26)   VALUE SPACES.       01810004
018200     05  PV-NEXT-DISPLAY-TIME    PIC  X(26)   VALUE SPACES.       01820004
018300     05  PV-DISPLAY-PO           PIC  9(09)   VALUE ZEROS.        01830004
018400     05  PV-DISPLAY-STORE        PIC  9(04)   VALUE ZEROS.        01840004
018500     05  PV-SKU-NBR              PIC  9(08)   VALUE ZEROS.        01850004
018600     05  PV-ITM-NBR              PIC  9(15)   VALUE ZEROS.        01860004
018700                                                                  01870004
018800 01  PS-PROGRAM-SWITCHES.                                         01880004
018900     05  PS-INVOICED-BY-SW       PIC  X(01)  VALUE 'B'.           01890004
019000         88  INVOICED-BY-BULK                VALUE 'B'.           01900004
019100         88  INVOICED-BY-STORE               VALUE 'S'.           01910004
019200         88  INVOICED-BY-DC                  VALUE 'D'.           01920004
019300     05  PS-OUT-OF-POS-SW        PIC  X(01)  VALUE ' '.           01930004
019400         88  OUT-OF-POS                      VALUE 'Y'.           01940004
019500         88  MORE-POS                        VALUE ' '.           01950004
019600     05  PS-OUT-OF-PRCCLMS-SW    PIC  X(01)  VALUE ' '.           01960004
019700         88  OUT-OF-PRCCLMS                  VALUE 'Y'.           01970004
019800         88  MORE-PRCCLMS                    VALUE ' '.           01980004
019900     05  PS-OUT-OF-RECEIPTS-SW   PIC  X(01)  VALUE ' '.           01990004
020000         88  OUT-OF-RECEIPTS                 VALUE 'Y'.           02000004
020100         88  MORE-RECEIPTS                   VALUE ' '.           02010004
020200     05  WS-LOCATION-CSR-SW      PIC X(1)    VALUE 'N'.           02020004
020300         88  END-OF-LOC-CSR                  VALUE 'Y'.           02030004
020400         88  NOT-END-OF-LOC-CSR              VALUE 'N'.           02040013
020500                                                                  02050013
020600 01  PC-PROGRAM-CONSTANTS.                                        02060013
020700     05  PC-DC-TYPE-CODE         PIC   X(2)  VALUE 'DC'.          02070004
020800     05  PC-STORE-ZEROS          PIC  S9(4)  VALUE ZEROS          02080004
020900                                             COMP.                02090004
020920                                                                  02092013
021000 01  WS-LOCATION-TABLE-AREA.                                      02100004
021100     05 WS-LOCATION-TABLE OCCURS 1500 TIMES INDEXED BY LOC-INDX.  02110004
021200        10  WS-LOC-NBR          PIC S9(4)    COMP.                02120004
021300        10  WS-LOC-TYP-CDE      PIC X(2).                         02130004
021400                                                                  02140004
021500 01  WS-SAVE-LOC-TYP-CDE           PIC X(2)   VALUE SPACES.       02150004
021600 01  PC-LOC-TBL-MAX                PIC S9(09) COMP SYNC           02160004
021700                                              VALUE +1500.        02170004
021800                                                                  02180004
021900 EJECT                                                            02190004
022000*                                                                 02200004
022100*    PO/STORE PO LINES FILE                                       02210004
022200*                                                                 02220004
022210     COPY APRD100.                                                02221004
022220/                                                                 02222004
022230*                                                                 02223004
022240*    PO/STORE PO RECEIPTS SUM FILE                                02224004
022250*                                                                 02225004
022260     COPY APRD101.                                                02226004
022270/                                                                 02227004
022280*                                                                 02228004
022290*    PO/STORE PO RECEIPTS FILE                                    02229004
022300*                                                                 02230004
022400     COPY APRD105.                                                02240004
022500/                                                                 02250004
022600*                                                                 02260004
022700*    TPOSTRR DCLGEN                                               02270004
022800*                                                                 02280004
022900     EXEC SQL                                                     02290004
023000         INCLUDE TPOSTRR                                          02300004
023100     END-EXEC.                                                    02310004
023200/                                                                 02320004
023300*                                                                 02330004
023400*    TPRCCLM DCLGEN                                               02340004
023500*                                                                 02350004
023600     EXEC SQL                                                     02360004
023700         INCLUDE TPRCCLM                                          02370004
023800     END-EXEC.                                                    02380004
023900/                                                                 02390004
024000*                                                                 02400004
024100*    TRECEIV DCLGEN                                               02410004
024200*                                                                 02420004
024300     EXEC SQL                                                     02430004
024400         INCLUDE TRECEIV                                          02440004
024500     END-EXEC.                                                    02450004
024600/                                                                 02460004
024700*                                                                 02470004
024800*    TPURITM DCLGEN                                               02480004
024900*                                                                 02490004
025000     EXEC SQL                                                     02500004
025100         INCLUDE TPURITM                                          02510004
025200     END-EXEC.                                                    02520004
025300/                                                                 02530004
025400*                                                                 02540004
025500*    TRECDIS DCLGEN                                               02550004
025600*                                                                 02560004
025700     EXEC SQL                                                     02570004
025800         INCLUDE TRECDIS                                          02580004
025900     END-EXEC.                                                    02590004
026000/                                                                 02600004
026100*                                                                 02610004
026200*    TRECITM DCLGEN                                               02620004
026300*                                                                 02630004
026400     EXEC SQL                                                     02640004
026500         INCLUDE TRECITM                                          02650004
026600     END-EXEC.                                                    02660004
026700/                                                                 02670004
026800*                                                                 02680004
026900*    TNINREC DCLGEN                                               02690004
027000*                                                                 02700004
027100     EXEC SQL                                                     02710004
027200         INCLUDE TNINREC                                          02720004
027300     END-EXEC.                                                    02730004
027400/                                                                 02740004
027500*                                                                 02750004
027600*    TAPCNTL DCLGEN                                               02760004
027700*                                                                 02770004
027800     EXEC SQL                                                     02780004
027900         INCLUDE TAPCNTL                                          02790004
028000     END-EXEC.                                                    02800004
028100/                                                                 02810004
028200*                                                                 02820004
028710*    XFT00017 DCLGEN                                              02871029
028720*                                                                 02872029
028730     EXEC SQL                                                     02873029
028740         INCLUDE XFT00017                                         02874029
028750     END-EXEC.                                                    02875029
028800/                                                                 02880004
028900*                                                                 02890004
029000*    TSKXREF DCLGEN                                               02900004
029100*                                                                 02910004
029200     EXEC SQL                                                     02920004
029300         INCLUDE TSKXREF                                          02930004
029400     END-EXEC.                                                    02940004
029500/                                                                 02950004
029511*                                                                 02951110
029520*    TPURCHS DCLGEN                                               02952010
029530*                                                                 02953010
029540     EXEC SQL                                                     02954010
029550         INCLUDE TPURCHS                                          02955010
029560     END-EXEC.                                                    02956010
029570/                                                                 02957010
029600*                                                                 02960004
029700*    SQL COMMUNICATIONS AREA DCLGEN                               02970004
029800*                                                                 02980004
029900     EXEC SQL                                                     02990004
030000         INCLUDE SQLCA                                            03000004
030100     END-EXEC.                                                    03010004
030200/                                                                 03020004
030300*----------------------------------------------------------------*03030004
030400*    CURSOR DECLARATIONS                                          03040004
030500*----------------------------------------------------------------*03050004
030600*----------------------------------------------------------------*03060004
030700* PO_CSR RETURNS THE PURCHASE ORDERS TO BE PROCESSED.            *03070004
030800*----------------------------------------------------------------*03080004
030900     EXEC SQL                                                     03090004
031000         DECLARE PO_CSR CURSOR                                    03100004
031100             FOR SELECT                                           03110004
031200                 PO_NBR                                           03120004
031300                ,STR_NBR                                          03130004
031400                ,MTCH_LVL_CDE                                     03140004
031500             FROM                                                 03150004
031600                 TPOSTRR                                          03160004
031700             WHERE                                                03170004
031800                  STATUS_CDE = ' '                                03180004
031900             ORDER BY                                             03190004
032000                   PO_NBR,                                        03200004
032100                   STR_NBR                                        03210004
032200     END-EXEC.                                                    03220004
032300/                                                                 03230004
032400*----------------------------------------------------------------*03240004
032500* BULK_CSR GETS ALL RECEIPT COSTS FOR THE BULK PURCHASE ORDER    *03250004
032510* BEING PROCESSED.  UNION IS USED TO RETRIEVE THE SAME INFORMA-  *03251004
032511* TION REGARDLESS OF WHETHER THE RECEIPT IS AN INVOICED OR NON-  *03251104
032512* INVOICED RECEIPT.  THE 'ALL' PART OF UNION ALLOWS FOR THE      *03251204
032513* RETRIEVAL OF ANY ROWS DUPLICATED ON BOTH TABLES.  THE DATA IS  *03251304
032514* RETRIEVED IN ORDER BY CLASS NUMBER, SEQUENCE NUMBER, STORE     *03251404
032515* NUMBER, AND RECEIPT TYPE.                                      *03251504
032516* NOTE:  CERTAIN FIELDS ARE RETRIEVED ONLY TO FACILITATE LATER   *03251604
032517*        UPDATING.  SINCE THESE FIELDS ARE UNIQUE TO EACH TABLE, *03251704
032518*        'DUMMY' VALUES ARE USED TO BALANCE OUT THE UNION CALL.  *03251804
032519*----------------------------------------------------------------*03251904
032520     EXEC SQL                                                     03252004
032530       DECLARE BULK_CSR CURSOR FOR                                03253004
032540         SELECT                                                   03254004
032550              PI.CL_NBR                                           03255004
032560             ,RV.REC_SEQ_NBR                                      03256004
032570             ,RD.STR_NBR                                          03257004
032580             ,'RV'                                                03258004
032590             ,RD.AP_VERIFY_ITM_QTY                                03259004
032600             ,(RD.AP_VERIFY_ITM_QTY * PI.UNT_COST_AMT)            03260010
032620             ,(RD.AP_VERIFY_ITM_QTY * PI.PRD_1ST_COST_AMT)        03262010
032700             ,PI.GP_RTL_AMT                                       03270004
032800             ,PI.GP_QTY                                           03280004
032900             ,PI.UNT_RTL_PR_AMT                                   03290004
033000             ,RV.REC_TMST                                         03300004
033100             ,RV.VERFYD_TMST                                      03310004
033200             ,RD.ORD_LNE_NBR                                      03320004
033300             ,RD.OPER_UNT_ID                                      03330004
033400             ,RD.FCLTY_ID                                         03340004
033500             ,RD.STR_FCLTY_ID                                     03350004
033600             ,RD.CRE_TMST                                         03360004
033700             ,RV.CRE_TMST                                         03370004
033800             ,0                                                   03380004
033900             ,PI.RMS_PO_SKU_NBR                                   03390004
034000             ,PI.ITM_NBR                                          03400004
034100             ,0                                                   03410004
034200         FROM                                                     03420004
034300             TRECEIV RV,                                          03430004
034400             TPURITM PI,                                          03440004
034500             TRECDIS RD,                                          03450004
034600             TRECITM RI                                           03460004
034700                                                                  03470004
034800         WHERE RV.ORD_NBR        = :PV-PO-BEING-PROCESSED         03480004
034900           AND RV.STATUS_CDE     = 'VE'                           03490004
035000           AND RV.AP_PRC_CDE     = 'M'                            03500004
035100           AND RV.FS_POST_TMST  ^= '9999-09-09-09.09.09.999999'   03510004
035200           AND RD.AP_PRC_CDE IN ('M', ' ')                        03520004
035300                                                                  03530004
035400           AND RV.ORD_NBR        = RI.ORD_NBR                     03540004
035500           AND RV.ORD_NBR        = RD.ORD_NBR                     03550004
035600           AND RV.ORD_NBR        = PI.PO_NBR                      03560004
035700                                                                  03570004
035800           AND RV.VER_STATUS_CDE = 'A'                            03580004
035900           AND RI.VER_STATUS_CDE = 'A'                            03590004
036000           AND RD.VER_STATUS_CDE = 'A'                            03600004
036100                                                                  03610004
036200           AND RV.REC_SEQ_NBR    = RI.REC_SEQ_NBR                 03620004
036300           AND RV.REC_SEQ_NBR    = RD.REC_SEQ_NBR                 03630004
036400                                                                  03640004
036500           AND RI.OPER_UNT_ID    = RD.OPER_UNT_ID                 03650004
036600           AND RI.FCLTY_ID       = RD.FCLTY_ID                    03660004
036700                                                                  03670004
036800           AND RI.ORD_LNE_NBR    = RD.ORD_LNE_NBR                 03680004
036900           AND RI.ORD_LNE_NBR    = PI.APP_PO_LNE_NBR              03690004
037000           AND RI.PO_VER_NBR     = PI.VER_NBR                     03700004
037100                                                                  03710004
037200****  THE FOLLOWING CONDITIONS WERE ADDED TO ENCOURAGE DB2 TO     03720004
037300****  ACCESS TRECDIS BEFORE TPURITM.                              03730004
037400****  IN AN EXPLAIN OF THIS CURSOR, THE TABLES SHOULD BE ACCESSED 03740004
037500****  IN THIS SEQUENCE: TRECEIV, TRECITM, TRECDIS AND TPURITM.    03750004
037600           AND RD.ORD_NBR     = RD.ORD_NBR                        03760004
037700           AND RD.ORD_LNE_NBR = RD.ORD_LNE_NBR                    03770004
037800           AND RD.REC_SEQ_NBR = RD.REC_SEQ_NBR                    03780004
037900           AND RD.OPER_UNT_ID = RD.OPER_UNT_ID                    03790004
038000           AND RD.FCLTY_ID    = RD.FCLTY_ID                       03800004
038100           AND RD.CRE_TMST    = RD.CRE_TMST                       03810004
038200           AND (RI.PO_VER_NBR    = PI.VER_NBR  OR 0 = 1)          03820004
038300                                                                  03830004
038400         UNION ALL                                                03840004
038500                                                                  03850004
038600         SELECT                                                   03860004
038700              PI.CL_NBR                                           03870004
038800             ,NR.NON_INVC_SEQ_NBR                                 03880004
038900             ,NR.STR_NBR                                          03890004
039000             ,'NR'                                                03900004
039100             ,NR.NON_INVC_UNT_QTY                                 03910004
039200             ,(NR.NON_INVC_UNT_QTY * NR.UNT_COST_AMT)             03920004
039211             ,(NR.NON_INVC_UNT_QTY * NR.UNT_COST_AMT)             03921110
039300             ,PI.GP_RTL_AMT                                       03930004
039400             ,PI.GP_QTY                                           03940004
039500             ,PI.UNT_RTL_PR_AMT                                   03950004
039600             ,NR.REC_TMST                                         03960004
039700             ,CURRENT TIMESTAMP                                   03970004
039800             ,NR.PO_LNE_NBR                                       03980004
039900             ,0                                                   03990004
040000             ,0                                                   04000004
040100             ,0                                                   04010004
040200             ,CURRENT TIMESTAMP                                   04020004
040300             ,CURRENT TIMESTAMP                                   04030004
040400             ,NR.ORIG_DISC_PCT                                    04040004
040500             ,PI.RMS_PO_SKU_NBR                                   04050004
040600             ,PI.ITM_NBR                                          04060004
040700             ,NR.DC_NBR                                           04070004
040800                                                                  04080004
040900         FROM                                                     04090004
041000             TNINREC NR,                                          04100004
041100             TPURITM PI                                           04110004
041200                                                                  04120004
041300         WHERE NR.PO_NBR          = :PV-PO-BEING-PROCESSED        04130004
041400           AND NR.PO_NBR          = PI.PO_NBR                     04140004
041500           AND NR.PO_LNE_NBR      = PI.APP_PO_LNE_NBR             04150004
041600           AND PI.VER_STATUS_CDE  = 'A'                           04160004
041700           AND NR.STATUS_CDE      = 'M'                           04170004
041800                                                                  04180004
041900         ORDER BY 13                                              04190024
042000                                                                  04200004
042100     END-EXEC.                                                    04210004
042200/                                                                 04220004
042300*----------------------------------------------------------------*04230004
042400* STORE_CSR GETS ALL RECEIPT COSTS FOR THE STORE PURCHASE ORDER  *04240004
042500* BEING PROCESSED.  IT IS SET UP THE SAME AS BULK_CSR EXCEPT     *04250004
042600* THAT CRITERIA IS INCLUDED TO MATCH ON STORE AS WELL AS PO      *04260004
042700* NUMBER AND A STATUS CODE OF MATCHED IS REQUIRED ON TRECDIS     *04270004
042800* INSTEAD OF TRECEIV.  (TRECEIV STATUS IS THE ONLY STATUS        *04280004
042900* UPDATED FOR BULK IN THE MATCH PROCESS WHEREAS TRECDIS IS THE   *04290004
043000* ONLY STATUS UPDATED FOR BY STORE PROCESSING.)                  *04300004
043100*----------------------------------------------------------------*04310004
043200     EXEC SQL                                                     04320004
043300       DECLARE STORE_CSR CURSOR FOR                               04330004
043400         SELECT                                                   04340004
043500             PI.CL_NBR                                            04350004
043600            ,RV.REC_SEQ_NBR                                       04360004
043700            ,RD.STR_NBR                                           04370004
043800            ,'RV'                                                 04380004
043900            ,RD.AP_VERIFY_ITM_QTY                                 04390004
044000            ,(RD.AP_VERIFY_ITM_QTY * PI.UNT_COST_AMT)             04400010
044021            ,(RD.AP_VERIFY_ITM_QTY * PI.PRD_1ST_COST_AMT)         04402110
044100            ,PI.GP_RTL_AMT                                        04410004
044200            ,PI.GP_QTY                                            04420004
044300            ,PI.UNT_RTL_PR_AMT                                    04430004
044400            ,RV.REC_TMST                                          04440004
044500            ,RV.VERFYD_TMST                                       04450004
044600            ,RD.ORD_LNE_NBR                                       04460004
044700            ,RD.OPER_UNT_ID                                       04470004
044800            ,RD.FCLTY_ID                                          04480004
044900            ,RD.STR_FCLTY_ID                                      04490004
045000            ,RD.CRE_TMST                                          04500004
045100            ,RV.CRE_TMST                                          04510004
045200            ,0                                                    04520004
045300            ,PI.RMS_PO_SKU_NBR                                    04530004
045400            ,PI.ITM_NBR                                           04540004
045500             ,0                                                   04550004
045600         FROM                                                     04560004
045700             TRECEIV RV,                                          04570004
045800             TPURITM PI,                                          04580004
045900             TRECDIS RD,                                          04590004
046000             TRECITM RI                                           04600004
046100         WHERE RV.ORD_NBR        = :PV-PO-BEING-PROCESSED         04610004
046200           AND RD.STR_NBR        = :PV-STORE-BEING-PROCESSED      04620004
046300           AND RV.STATUS_CDE     = 'VE'                           04630004
046400           AND RV.FS_POST_TMST  ^= '9999-09-09-09.09.09.999999'   04640004
046500           AND RD.AP_PRC_CDE     = 'M'                            04650004
046600                                                                  04660004
046700           AND RV.ORD_NBR        = RI.ORD_NBR                     04670004
046800           AND RV.ORD_NBR        = RD.ORD_NBR                     04680004
046900           AND RV.ORD_NBR        = PI.PO_NBR                      04690004
047000                                                                  04700004
047100           AND RV.VER_STATUS_CDE = 'A'                            04710004
047200           AND RI.VER_STATUS_CDE = 'A'                            04720004
047300           AND RD.VER_STATUS_CDE = 'A'                            04730004
047400                                                                  04740004
047500           AND RV.REC_SEQ_NBR    = RI.REC_SEQ_NBR                 04750004
047600           AND RV.REC_SEQ_NBR    = RD.REC_SEQ_NBR                 04760004
047700                                                                  04770004
047800           AND RI.OPER_UNT_ID    = RD.OPER_UNT_ID                 04780004
047900           AND RI.FCLTY_ID       = RD.FCLTY_ID                    04790004
048000                                                                  04800004
048100           AND RI.ORD_LNE_NBR    = RD.ORD_LNE_NBR                 04810004
048200           AND RI.ORD_LNE_NBR    = PI.APP_PO_LNE_NBR              04820004
048300                                                                  04830004
048400           AND  RI.PO_VER_NBR    = PI.VER_NBR                     04840004
048500                                                                  04850004
048600****  IN THE FOLLOWING CONDITION, 'OR 0=1' WAS ADDED (MAY 2002)   04860004
048700****  TO ENCOURAGE DB2 TO ACCESS TABLE TRECDIS BEFORE TPURITM.    04870004
048800****  SOME TIME PRIOR TO AUGUST 2003, THE SEQUENCE THAT DB2 CHOSE 04880004
048900****  TO ACCESS THESE TABLES CHANGED.  WE WERE UNABLE TO DETERMINE04890004
049000****  THE REASON FOR THIS CHANGE, BUT IT WAS DETERMINED THAT      04900004
049100****  REMOVING THIS STATEMENT ENCOURAGED DB2 TO ONCE AGAIN ACCESS 04910004
049200****  THE TABLES IN THE MOST DESIRABLE SEQUENCE.                  04920004
049300****                                                              04930004
049400****  IN AN EXPLAIN OF THIS CURSOR, THE TABLES SHOULD BE ACCESSED 04940004
049500****  IN THIS SEQUENCE: TRECEIV, TRECITM, TRECDIS AND TPURITM.    04950004
049600****  THE FOLLOWING MAY NEED TO BE REINSTATED TO ACHIEVE THAT.    04960004
049700****                                                              04970004
049800           AND (RI.PO_VER_NBR    = PI.VER_NBR  OR 0 = 1)          04980004
049900                                                                  04990004
050000         UNION ALL                                                05000004
050100                                                                  05010004
050200         SELECT                                                   05020004
050300              PI.CL_NBR                                           05030004
050400             ,NR.NON_INVC_SEQ_NBR                                 05040004
050500             ,NR.STR_NBR                                          05050004
050600             ,'NR'                                                05060004
050700             ,NR.NON_INVC_UNT_QTY                                 05070004
050800             ,(NR.NON_INVC_UNT_QTY * NR.UNT_COST_AMT)             05080004
050810             ,(NR.NON_INVC_UNT_QTY * NR.UNT_COST_AMT)             05081010
050900             ,PI.GP_RTL_AMT                                       05090004
051000             ,PI.GP_QTY                                           05100004
051100             ,PI.UNT_RTL_PR_AMT                                   05110004
051200             ,NR.REC_TMST                                         05120004
051300             ,CURRENT TIMESTAMP                                   05130004
051400             ,NR.PO_LNE_NBR                                       05140004
051500             ,0                                                   05150004
051600             ,0                                                   05160004
051700             ,0                                                   05170004
051800             ,CURRENT TIMESTAMP                                   05180004
051900             ,CURRENT TIMESTAMP                                   05190004
052000             ,NR.ORIG_DISC_PCT                                    05200004
052100             ,PI.RMS_PO_SKU_NBR                                   05210004
052200             ,PI.ITM_NBR                                          05220004
052300             ,NR.DC_NBR                                           05230004
052400                                                                  05240004
052500         FROM                                                     05250004
052600             TNINREC NR,                                          05260004
052700             TPURITM PI                                           05270004
052800         WHERE NR.PO_NBR          = :PV-PO-BEING-PROCESSED        05280004
052900           AND NR.PO_NBR          = PI.PO_NBR                     05290004
053000           AND NR.STR_NBR         = :PV-STORE-BEING-PROCESSED     05300004
053100           AND NR.PO_LNE_NBR      = PI.APP_PO_LNE_NBR             05310004
053200           AND PI.VER_STATUS_CDE  = 'A'                           05320004
053300           AND NR.STATUS_CDE      = 'M'                           05330004
053400         ORDER BY 13                                              05340024
053500     END-EXEC.                                                    05350004
053600/                                                                 05360004
053700*----------------------------------------------------------------*05370004
053800* DC_CSR GETS ALL RECEIPT COSTS FOR THE DC BEING PROCESSED.      *05380004
053900* IT IS SET UP THE SAME AS BULK_CSR EXCEPT THAT CRITERIA IS      *05390004
054000* INCLUDED TO MATCH ON STORE AS WELL AS PO NUMBER AND A STATUS   *05400004
054100* CODE OF MATCHED IS REQUIRED ON TRECEIV INSTEAD OF TRECDIS.     *05410004
054200* (TRECEIV STATUS IS THE ONLY STATUS UPDATED FOR BULK IN THE     *05420004
054300* MATCH PROCESS WHEREAS TRECDIS IS THE ONLY STATUS UPDATED FOR   *05430004
054400* BY STORE PROCESSING.)                                          *05440004
054500*----------------------------------------------------------------*05450004
054600     EXEC SQL                                                     05460004
054700       DECLARE DC_CSR CURSOR FOR                                  05470004
054800         SELECT                                                   05480004
054900             PI.CL_NBR                                            05490004
055000            ,RV.REC_SEQ_NBR                                       05500004
055100            ,RD.STR_NBR                                           05510004
055200            ,'RV'                                                 05520004
055300            ,RD.AP_VERIFY_ITM_QTY                                 05530004
055400            ,(RD.AP_VERIFY_ITM_QTY * PI.UNT_COST_AMT)             05540010
055421            ,(RD.AP_VERIFY_ITM_QTY * PI.PRD_1ST_COST_AMT)         05542110
055500            ,PI.GP_RTL_AMT                                        05550004
055600            ,PI.GP_QTY                                            05560004
055610            ,PI.UNT_RTL_PR_AMT                                    05561004
055620            ,RV.REC_TMST                                          05562004
055630            ,RV.VERFYD_TMST                                       05563004
055640            ,RD.ORD_LNE_NBR                                       05564004
055650            ,RD.OPER_UNT_ID                                       05565004
055660            ,RD.FCLTY_ID                                          05566004
055670            ,RD.STR_FCLTY_ID                                      05567004
055680            ,RD.CRE_TMST                                          05568004
055690            ,RV.CRE_TMST                                          05569004
055700            ,0                                                    05570004
055701            ,PI.RMS_PO_SKU_NBR                                    05570104
055702            ,PI.ITM_NBR                                           05570204
055703            ,0                                                    05570304
055704                                                                  05570404
055705         FROM                                                     05570504
055706             TRECEIV RV,                                          05570604
055707             TPURITM PI,                                          05570704
055708             TRECDIS RD,                                          05570804
055709             TRECITM RI                                           05570904
055710         WHERE RV.ORD_NBR        = :PV-PO-BEING-PROCESSED         05571004
055711           AND RV.OPER_UNT_ID    = :PV-STORE-BEING-PROCESSED      05571105
055712           AND RV.STATUS_CDE     = 'VE'                           05571204
055713           AND RV.FS_POST_TMST  ^= '9999-09-09-09.09.09.999999'   05571304
055714           AND RV.AP_PRC_CDE     = 'M'                            05571404
055715           AND RD.AP_PRC_CDE IN ('M', ' ')                        05571504
055716                                                                  05571604
055717           AND RV.ORD_NBR        = RI.ORD_NBR                     05571704
055718           AND RV.ORD_NBR        = RD.ORD_NBR                     05571804
055719           AND RV.ORD_NBR        = PI.PO_NBR                      05571904
055720                                                                  05572004
055721           AND RV.VER_STATUS_CDE = 'A'                            05572104
055722           AND RI.VER_STATUS_CDE = 'A'                            05572204
055723           AND RD.VER_STATUS_CDE = 'A'                            05572304
055724                                                                  05572404
055725           AND RV.REC_SEQ_NBR    = RI.REC_SEQ_NBR                 05572504
055726           AND RV.REC_SEQ_NBR    = RD.REC_SEQ_NBR                 05572604
055727                                                                  05572704
055728           AND RI.OPER_UNT_ID    = RD.OPER_UNT_ID                 05572804
055729           AND RI.FCLTY_ID       = RD.FCLTY_ID                    05572904
055730                                                                  05573004
055731           AND RI.ORD_LNE_NBR    = RD.ORD_LNE_NBR                 05573104
055732           AND RI.ORD_LNE_NBR    = PI.APP_PO_LNE_NBR              05573204
055733                                                                  05573304
055734           AND  RI.PO_VER_NBR    = PI.VER_NBR                     05573404
055735                                                                  05573504
055736****  IN THE FOLLOWING CONDITION, 'OR 0=1' WAS ADDED (MAY 2002)   05573604
055737****  TO ENCOURAGE DB2 TO ACCESS TABLE TRECDIS BEFORE TPURITM.    05573704
055738****  SOME TIME PRIOR TO AUGUST 2003, THE SEQUENCE THAT DB2 CHOSE 05573804
055739****  TO ACCESS THESE TABLES CHANGED.  WE WERE UNABLE TO DETERMINE05573904
055740****  THE REASON FOR THIS CHANGE, BUT IT WAS DETERMINED THAT      05574004
055741****  REMOVING THIS STATEMENT ENCOURAGED DB2 TO ONCE AGAIN ACCESS 05574104
055742****  THE TABLES IN THE MOST DESIRABLE SEQUENCE.                  05574204
055743****                                                              05574304
055744****  IN AN EXPLAIN OF THIS CURSOR, THE TABLES SHOULD BE ACCESSED 05574404
055745****  IN THIS SEQUENCE: TRECEIV, TRECITM, TRECDIS AND TPURITM.    05574504
055746****  THE FOLLOWING MAY NEED TO BE REINSTATED TO ACHIEVE THAT.    05574604
055747****                                                              05574704
055748           AND (RI.PO_VER_NBR    = PI.VER_NBR  OR 0 = 1)          05574804
055749                                                                  05574904
055750         UNION ALL                                                05575004
055751                                                                  05575104
055752         SELECT                                                   05575204
055753              PI.CL_NBR                                           05575304
055754             ,NR.NON_INVC_SEQ_NBR                                 05575404
055755             ,NR.STR_NBR                                          05575504
055756             ,'NR'                                                05575604
055757             ,NR.NON_INVC_UNT_QTY                                 05575704
055758             ,(NR.NON_INVC_UNT_QTY * NR.UNT_COST_AMT)             05575804
055760             ,(NR.NON_INVC_UNT_QTY * NR.UNT_COST_AMT)             05576010
055762             ,PI.GP_RTL_AMT                                       05576210
055763             ,PI.GP_QTY                                           05576310
055764             ,PI.UNT_RTL_PR_AMT                                   05576410
055765             ,NR.REC_TMST                                         05576510
055766             ,CURRENT TIMESTAMP                                   05576610
055767             ,NR.PO_LNE_NBR                                       05576710
055768             ,0                                                   05576810
055769             ,0                                                   05576910
055770             ,0                                                   05577010
055771             ,CURRENT TIMESTAMP                                   05577110
055772             ,CURRENT TIMESTAMP                                   05577210
055773             ,NR.ORIG_DISC_PCT                                    05577310
055774             ,PI.RMS_PO_SKU_NBR                                   05577410
055775             ,PI.ITM_NBR                                          05577510
055776             ,NR.DC_NBR                                           05577610
055777                                                                  05577710
055778         FROM                                                     05577810
055779             TNINREC NR,                                          05577910
055780             TPURITM PI                                           05578010
055781         WHERE NR.PO_NBR          = :PV-PO-BEING-PROCESSED        05578110
055782           AND NR.PO_NBR          = PI.PO_NBR                     05578210
055783           AND NR.DC_NBR          = :PV-STORE-BEING-PROCESSED     05578310
055784           AND NR.PO_LNE_NBR      = PI.APP_PO_LNE_NBR             05578410
055785           AND PI.VER_STATUS_CDE  = 'A'                           05578510
055786           AND NR.STATUS_CDE      = 'M'                           05578610
055787         ORDER BY 13                                              05578724
055788     END-EXEC.                                                    05578810
055789/                                                                 05578910
055790*----------------------------------------------------------------*05579010
055791* PRCCLM_CSR RETRIEVES ALL PRICE CLAIM ROWS ASSOCIATED WITH A    *05579110
055792* PO/STORE HAVING A DISTINCT PO LINE NUMBER FOR PJ DOC TYPES.    *05579210
055793* (NOTE: THE STORE ON TPRCCLM WILL BE ZERO FOR BULK.)            *05579310
055794*----------------------------------------------------------------*05579410
055795     EXEC SQL                                                     05579510
055796       DECLARE PRCCLM_CSR CURSOR FOR                              05579610
055797         SELECT DISTINCT PO_LNE_NBR                               05579710
055798         FROM TPRCCLM                                             05579810
055799         WHERE PO_NBR  = :PV-PO-BEING-PROCESSED                   05579910
055800           AND STR_NBR = :PV-STORE-BEING-PROCESSED                05580010
055801           AND DOC_TYP_CDE IN ('CP', 'DP')                        05580110
055802             ORDER BY                                             05580210
055803                   PO_LNE_NBR                                     05580310
055810     END-EXEC.                                                    05581004
055820/                                                                 05582004
055830*----------------------------------------------------------------*05583004
055840*  LOCATION CURSOR - RETURNS THE LOCATION NUMBERS AND THEIR TYPE  05584004
055850*  CODES FROM THE DOMAIN LOCATION TABLES TO ALLOW VALIDATION OF   05585004
055860*  STORE NUMBERS ON THE INCOMING INVOICES.                        05586004
055870*----------------------------------------------------------------*05587004
055880     EXEC SQL                                                     05588004
055890          DECLARE LOCATION_CSR CURSOR FOR                         05589004
055900            SELECT LOC_NBR                                        05590004
056000                 , LOC_TYP_CDE                                    05600004
056100              FROM XFT_LOC                                        05610029
056200             WHERE LOC_TYP_CDE IN ('DS','DC','HQ')                05620004
056300               AND CURRENT DATE <= FINCL_CLO_DTE                  05630004
056400     END-EXEC.                                                    05640004
056500*----------------------------------------------------------------*05650004
056600*  ABEND DATA AREAS                                              *05660004
056700*----------------------------------------------------------------*05670004
056800 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          05680004
056900                                             COMP SYNC.           05690004
057000     88  AC-TABLE-OVERFLOW                   VALUE +4004.         05700004
057100     88  AC-INVALID-DATA                     VALUE +4008.         05710004
057200     88  AC-DB2-ERROR                        VALUE +4013.         05720004
057300     88  AC-NO-INVOICES-ERROR                VALUE +4020.         05730004
057400                                                                  05740004
057500                                                                  05750004
057600 01  ABEND-AREAS.                                                 05760004
057700     05  AA-ABEND-LIT            PIC  X(40)  VALUE                05770004
057710             '*****       ABEND'.                                 05771004
057720     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                05772004
057730             '*****   PROGRAM: APKUT105'.                         05773004
057740     05  AA-PARAGRAPH-LIT.                                        05774004
057750         10  FILLER              PIC  X(17)  VALUE                05775004
057760             '***** PARAGRAPH: '.                                 05776004
057770         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        05777004
057780     05  AA-MESSAGE-LINE.                                         05778004
057790         10  FILLER              PIC  X(06)  VALUE '*****'.       05779004
057800         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        05780004
057900     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                05790004
058000             '*****    DB2 ERROR'.                                05800004
058100     05  AA-DB2-OPERATION-LIT.                                    05810004
058200         10  FILLER              PIC  X(17)  VALUE                05820004
058300             '***** OPERATION: '.                                 05830004
058310         10  AA-DB2-OPERATION.                                    05831004
058320             15  AA-DB2-OP-1     PIC  X(50)  VALUE SPACES.        05832004
058330             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        05833004
058340     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        05834004
058350     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        05835004
058360     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        05836004
058370     05  AA-DB2-TABLE-4          PIC  X(08)  VALUE SPACES.        05837004
058380     05  AA-DB2-TABLE-5          PIC  X(08)  VALUE SPACES.        05838004
058390                                                                  05839004
058400     COPY DPWS004.                                                05840004
058500                                                                  05850004
058600 01  FILLER                      PIC  X(25)  VALUE                05860004
058700     '** END OF APKUT105 W/S **'.                                 05870004
058800 EJECT                                                            05880004
058900 PROCEDURE DIVISION.                                              05890004
059000 A100-MAIN.                                                       05900004
059100                                                                  05910004
059200     PERFORM B100-INITIALIZE.                                     05920004
059300                                                                  05930004
059400     PERFORM B200-RETRIEVE-INPUT-POS                              05940004
059500       UNTIL OUT-OF-POS.                                          05950004
059600                                                                  05960004
059700     PERFORM B300-END-PROGRAM.                                    05970004
059800                                                                  05980004
059900     GOBACK.                                                      05990004
060000                                                                  06000004
060100 EJECT                                                            06010004
060200*----------------------------------------------------------------*06020004
060300*    INITIALIZATION PROCESSING                                   *06030004
060400*    CALLED FROM A100-MAIN                                       *06040004
060500*----------------------------------------------------------------*06050004
060600 B100-INITIALIZE.                                                 06060004
060700                                                                  06070004
060800     OPEN OUTPUT PO-LINES-FILE                                    06080004
060900                 RECEIPTS-SUM-FILE                                06090004
061000                 RECEIPTS-FILE.                                   06100004
061100                                                                  06110004
061200     INITIALIZE DCLTPOSTRR                                        06120004
061300                DCLTPRCCLM                                        06130004
061400                DCLTRECEIV                                        06140004
061500                DCLTPURITM                                        06150004
061600                DCLTRECDIS                                        06160004
061700                DCLTRECITM                                        06170004
061800                DCLTNINREC                                        06180004
061910                DCLXFT00017                                       06191029
062000                DCLTSKXREF.                                       06200004
062100                                                                  06210004
062200     PERFORM X100-OPEN-LOCATION-CSR.                              06220004
062300     PERFORM X200-LOAD-LOCATION-TBL.                              06230004
062400     PERFORM X300-CLOSE-LOCATION-CSR.                             06240004
062500     PERFORM X400-COMMIT.                                         06250004
062600                                                                  06260004
062700     PERFORM Y100-OPEN-PO-CSR.                                    06270004
062800                                                                  06280004
062900                                                                  06290004
063000 EJECT                                                            06300004
063100*----------------------------------------------------------------*06310004
063200*    FETCHES THE PURCHASE ORDERS TO BE PROCESSED FROM POSTRR.    *06320004
063300*----------------------------------------------------------------*06330004
063400 B200-RETRIEVE-INPUT-POS.                                         06340004
063500                                                                  06350004
063600     INITIALIZE AP100-RECORD                                      06360004
063700                AP101-RECORD                                      06370004
063800                AP105-RECORD                                      06380004
063900                PS-PROGRAM-SWITCHES.                              06390004
064000                                                                  06400004
064100     PERFORM R100-FETCH-RELEASED-POS.                             06410004
064200                                                                  06420004
064300     PERFORM R900-GET-TIMES.                                      06430004
064400     IF PV-CURRENT-TIME > PV-NEXT-DISPLAY-TIME                    06440004
064500         MOVE POSTRR-PO-NBR        TO PV-DISPLAY-PO               06450004
064600         MOVE POSTRR-STR-NBR       TO PV-DISPLAY-STORE            06460004
064700         DISPLAY 'PO = ' PV-DISPLAY-PO                            06470004
064800                 '  STR = ' PV-DISPLAY-STORE                      06480004
064900                 '  TIME = ' PV-CURRENT-TIME                      06490004
065000         MOVE PV-TEMP-DISPLAY-TIME TO PV-NEXT-DISPLAY-TIME        06500004
065100     END-IF.                                                      06510004
065200                                                                  06520004
065300     IF MORE-POS                                                  06530004
065400         PERFORM C100-PROCESS-INPUT-POS                           06540004
065500     END-IF.                                                      06550004
065600                                                                  06560004
065700 EJECT                                                            06570004
065800*----------------------------------------------------------------*06580004
065900*    ENDING PROCESSING: DISPLAYS COUNT OF POS AND CLOSES FILES.  *06590004
066000*    CALLED FROM A100-MAIN                                       *06600004
066100*----------------------------------------------------------------*06610004
066200 B300-END-PROGRAM.                                                06620004
066300                                                                  06630004
066400     DISPLAY 'NBR OF POS READ FROM TPOSTRR = ' PV-PO-COUNT.       06640004
066500                                                                  06650004
066600     PERFORM Y110-CLOSE-PO-CSR.                                   06660004
066700                                                                  06670004
066800     CLOSE PO-LINES-FILE                                          06680004
066900           RECEIPTS-SUM-FILE                                      06690004
067000           RECEIPTS-FILE.                                         06700004
067100 EJECT                                                            06710004
067200*----------------------------------------------------------------*06720004
067300*    CONTROLS THE PROCESSING OF EACH PO.                         *06730004
067400*----------------------------------------------------------------*06740004
067500 C100-PROCESS-INPUT-POS.                                          06750004
067600                                                                  06760004
067700     MOVE POSTRR-PO-NBR  TO PV-PO-BEING-PROCESSED                 06770004
067800                            AP100-PO-NBR                          06780004
067900                            AP101-PO-NBR                          06790004
068000                            AP105-PO-NBR.                         06800004
068100                                                                  06810004
068200     MOVE POSTRR-STR-NBR TO PV-STORE-BEING-PROCESSED              06820004
068300                            AP100-STORE-NUMBER                    06830004
068400                            AP101-STORE-NUMBER                    06840004
068500                            AP105-STORE-NUMBER.                   06850004
068600                                                                  06860004
068610     PERFORM S200-SELECT-PO-TYPE.                                 06861024
068700                                                                  06870004
068800     IF POSTRR-MTCH-LVL-CDE = 'P'                                 06880004
068900         SET INVOICED-BY-BULK TO TRUE                             06890004
069000         PERFORM Y300-OPEN-BULK-CSR                               06900004
069100         PERFORM R300-FETCH-BULK-RECEIPTS                         06910004
069200     ELSE                                                         06920004
069300       IF POSTRR-MTCH-LVL-CDE = 'S'                               06930004
069400           SET INVOICED-BY-STORE TO TRUE                          06940004
069500           PERFORM Y400-OPEN-STORE-CSR                            06950004
069600           PERFORM R400-FETCH-STORE-RECEIPTS                      06960004
069700       ELSE                                                       06970004
069800           SET INVOICED-BY-DC TO TRUE                             06980004
069900           PERFORM Y500-OPEN-DC-CSR                               06990004
070000           PERFORM R450-FETCH-DC-RECEIPTS                         07000004
070100       END-IF                                                     07010004
070200     END-IF.                                                      07020004
070300                                                                  07030004
070400     IF MORE-RECEIPTS                                             07040004
070500         PERFORM Y200-OPEN-PRCCLM-CSR                             07050004
070600         PERFORM R200-FETCH-PRICE-CLAIM                           07060004
070700         PERFORM D100-PROCESS-RECEIPTS                            07070004
070800           UNTIL OUT-OF-RECEIPTS                                  07080004
070900         PERFORM Y210-CLOSE-PRCCLM-CSR                            07090004
071000         COMPUTE AP101-TOTAL-REC-COST = PV-TOTAL-REC-COST + .005  07100004
071100         PERFORM W200-WRITE-RECEIPTS-SUM                          07110004
071200         INITIALIZE PV-TOTAL-REC-COST                             07120004
071300     END-IF.                                                      07130004
071400                                                                  07140004
071410     IF INVOICED-BY-BULK                                          07141004
071420         PERFORM Y310-CLOSE-BULK-CSR                              07142004
071430     ELSE                                                         07143004
071440       IF INVOICED-BY-STORE                                       07144004
071450         PERFORM Y410-CLOSE-STORE-CSR                             07145004
071460       ELSE                                                       07146004
071470         PERFORM Y510-CLOSE-DC-CSR                                07147004
071480       END-IF                                                     07148004
071490     END-IF.                                                      07149004
071500                                                                  07150004
071600 EJECT                                                            07160004
071700*----------------------------------------------------------------*07170004
071800*    CONTROLS THE PROCESSING OF EACH PO/STORE RECEIPT            *07180004
071900*----------------------------------------------------------------*07190004
072000 D100-PROCESS-RECEIPTS.                                           07200004
072100                                                                  07210004
072201     IF PURCHS-PO-TYP-CDE = 'IM' OR 'IE' OR 'IF'                  07220118
072204        ADD PV-TOTAL-COST      TO PV-TOTAL-REC-COST               07220427
072205        MOVE PV-TOTAL-COST     TO AP105-TOTAL-COST                07220523
072206                                  AP105-EXTD-LOAD-COST            07220627
072207     ELSE                                                         07220727
072208        ADD PV-TOTAL-1ST-COST  TO PV-TOTAL-REC-COST               07220827
072209        MOVE PV-TOTAL-1ST-COST TO AP105-TOTAL-COST                07220927
072210        MOVE PV-TOTAL-COST     TO AP105-EXTD-LOAD-COST            07221027
072211     END-IF.                                                      07221127
072220                                                                  07222010
072400     MOVE PURITM-CL-NBR            TO AP105-CLASS-NUMBER.         07240004
072500     MOVE NINREC-NON-INVC-SEQ-NBR  TO AP105-RECEIVER-SEQ-NUMBER.  07250004
072600     MOVE NINREC-STR-NBR           TO AP105-STR-NBR.              07260004
072700     MOVE PV-RECEIPT-TYPE          TO AP105-RECEIPT-TYPE.         07270004
072800     MOVE NINREC-NON-INVC-UNT-QTY  TO AP105-NR-NON-INVC-UNT-QTY.  07280004
073000     MOVE PURITM-GP-RTL-AMT        TO AP105-PI-GP-RTL-AMT.        07300004
073100     MOVE PURITM-GP-QTY            TO AP105-PI-GP-QTY.            07310004
073200     MOVE PURITM-UNT-RTL-PR-AMT    TO AP105-PI-UNT-RTL-PR-AMT.    07320004
073300     MOVE NINREC-REC-TMST          TO AP105-NR-REC-TMST.          07330004
073400     MOVE RECEIV-VERFYD-TMST       TO AP105-RV-VERFYD-TMST.       07340004
073500     MOVE NINREC-PO-LNE-NBR        TO AP105-NR-PO-LNE-NBR.        07350004
073600     MOVE RECDIS-OPER-UNT-ID       TO AP105-RD-OPER-UNT-ID.       07360004
073700     MOVE RECDIS-FCLTY-ID          TO AP105-RD-FCLTY-ID.          07370004
073800     MOVE RECDIS-STR-FCLTY-ID      TO AP105-RD-STR-FCLTY-ID.      07380004
073900     MOVE RECDIS-CRE-TMST          TO AP105-RD-CRE-TMST.          07390004
074000     MOVE RECEIV-CRE-TMST          TO AP105-RV-CRE-TMST.          07400004
074100     MOVE NINREC-ORIG-DISC-PCT     TO AP105-NR-ORIG-DISC-PCT.     07410004
074200     MOVE PV-SKU-NBR               TO AP105-SKU-NBR.              07420004
074300                                                                  07430004
074400     IF PV-RECEIVER                                               07440004
074500        IF RECDIS-OPER-UNT-ID      NOT = PV-SAVE-PREV-OPER-UNT-ID 07450004
074600           PERFORM R500-SELECT-OPER-UNT-TYP-CDE                   07460004
074700           MOVE RECDIS-OPER-UNT-ID    TO PV-SAVE-PREV-OPER-UNT-ID 07470004
074800        END-IF                                                    07480004
074900        MOVE WS-SAVE-LOC-TYP-CDE      TO AP105-RV-OPER-UNT-TYP-CDE07490004
075000     ELSE                                                         07500004
075100        MOVE SPACES                   TO AP105-RV-OPER-UNT-TYP-CDE07510004
075200     END-IF.                                                      07520004
075300                                                                  07530004
075310     PERFORM W300-WRITE-RECEIPTS.                                 07531004
075320                                                                  07532004
075330     IF  MORE-PRCCLMS                                             07533004
075340     AND NINREC-PO-LNE-NBR > PRCCLM-PO-LNE-NBR                    07534004
075350         PERFORM R200-FETCH-PRICE-CLAIM                           07535004
075360           UNTIL NINREC-PO-LNE-NBR <= PRCCLM-PO-LNE-NBR           07536004
075370              OR OUT-OF-PRCCLMS                                   07537004
075380     END-IF.                                                      07538004
075390                                                                  07539004
075400     IF  MORE-PRCCLMS                                             07540004
075401     AND NINREC-PO-LNE-NBR = PRCCLM-PO-LNE-NBR                    07540104
075402         MOVE NINREC-PO-LNE-NBR       TO AP100-PO-LINE-NUMBER     07540204
075403         MOVE PURITM-CL-NBR           TO AP100-CLASS-NUMBER       07540304
075404         MOVE NINREC-NON-INVC-SEQ-NBR TO AP100-RECEIVER-SEQ-NUMBER07540404
075405         MOVE NINREC-STR-NBR          TO AP100-STR-NBR            07540504
075406         MOVE PV-RECEIPT-TYPE         TO AP100-RECEIPT-TYPE       07540604
075407         MOVE NINREC-NON-INVC-UNT-QTY TO AP100-NR-NON-INVC-UNT-QTY07540704
075408         MOVE PV-SKU-NBR              TO AP100-SKU-NBR            07540804
075409         PERFORM W100-WRITE-PO-LINES                              07540904
075410     END-IF.                                                      07541004
075420                                                                  07542004
075430     IF INVOICED-BY-BULK                                          07543004
075440         PERFORM R300-FETCH-BULK-RECEIPTS                         07544004
075450     ELSE                                                         07545004
075460       IF INVOICED-BY-STORE                                       07546004
075470         PERFORM R400-FETCH-STORE-RECEIPTS                        07547004
075480       ELSE                                                       07548004
075490         PERFORM R450-FETCH-DC-RECEIPTS                           07549004
075500       END-IF                                                     07550004
075600     END-IF.                                                      07560004
075700                                                                  07570004
075800 EJECT                                                            07580004
075900*----------------------------------------------------------------*07590004
076000*    RETRIEVES THE PURCHASE ORDERS TO BE PROCESSED.              *07600004
076100*----------------------------------------------------------------*07610004
076200 R100-FETCH-RELEASED-POS.                                         07620004
076300                                                                  07630004
076400     EXEC SQL                                                     07640004
076500         FETCH PO_CSR                                             07650004
076600         INTO :POSTRR-PO-NBR                                      07660004
076700             ,:POSTRR-STR-NBR                                     07670004
076800             ,:POSTRR-MTCH-LVL-CDE                                07680004
076900     END-EXEC.                                                    07690004
076910                                                                  07691004
076920     EVALUATE TRUE                                                07692004
076930         WHEN SQLCODE = ZERO                                      07693004
076940              ADD 1 TO PV-PO-COUNT                                07694004
076950                                                                  07695004
076960         WHEN SQLCODE = +100                                      07696004
076970              SET OUT-OF-POS TO TRUE                              07697004
076980                                                                  07698004
076990         WHEN SQLWARN0 NOT = SPACES                               07699004
077000         WHEN SQLCODE  NOT = ZERO                                 07700004
077100             MOVE 'R100-FETCH-RELEASED-POS'                       07710004
077200                              TO AA-PARAGRAPH-NAME                07720004
077300             MOVE 'UNSUCCESSFUL FETCH WITH PO_CSR'                07730004
077400                              TO AA-DB2-OP-1                      07740004
077500             MOVE 'TPOSTRR'   TO AA-DB2-TABLE-1                   07750004
077600             MOVE SPACES      TO AA-DB2-TABLE-2                   07760004
077700                                 AA-DB2-TABLE-3                   07770004
077800                                 AA-DB2-TABLE-4                   07780004
077900                                 AA-DB2-TABLE-5                   07790004
078000             PERFORM Z998-DB2-ABEND                               07800004
078100     END-EVALUATE.                                                07810004
078200 EJECT                                                            07820004
078300*----------------------------------------------------------------*07830004
078400*    RETRIEVES THE PRICE CLAIM PO LINES FOR A PO/STORE.          *07840004
078500*----------------------------------------------------------------*07850004
078600 R200-FETCH-PRICE-CLAIM.                                          07860004
078700                                                                  07870004
078800     EXEC SQL                                                     07880004
078900         FETCH PRCCLM_CSR                                         07890004
079000         INTO :PRCCLM-PO-LNE-NBR                                  07900004
079100     END-EXEC.                                                    07910004
079200                                                                  07920004
079300     EVALUATE TRUE                                                07930004
079400         WHEN SQLCODE = +100                                      07940004
079500              SET OUT-OF-PRCCLMS TO TRUE                          07950004
079600         WHEN SQLCODE = ZERO                                      07960004
079700              CONTINUE                                            07970004
079800                                                                  07980004
079900         WHEN SQLWARN0 NOT = SPACES                               07990004
080000         WHEN SQLCODE  NOT = ZERO                                 08000004
080100             MOVE ' R200-FETCH-PRICE-CLAIM'                       08010004
080200                              TO AA-PARAGRAPH-NAME                08020004
080300             MOVE 'UNSUCCESSFUL FETCH WITH PRCCLMS CSR'           08030004
080400                              TO AA-DB2-OP-1                      08040004
080500             MOVE 'TPRCCLM'   TO AA-DB2-TABLE-1                   08050004
080600             MOVE SPACES      TO AA-DB2-TABLE-2                   08060004
080700                                 AA-DB2-TABLE-3                   08070004
080800                                 AA-DB2-TABLE-4                   08080004
080900                                 AA-DB2-TABLE-5                   08090004
081000             PERFORM Z998-DB2-ABEND                               08100004
081100     END-EVALUATE.                                                08110004
081101                                                                  08110123
081200 EJECT                                                            08120004
081300*----------------------------------------------------------------*08130004
081400*    RETRIEVES THE RECEIPT INFORMATION FOR THE BULK PURCHASE     *08140004
081500*    ORDER BEING PROCESSED.                                      *08150004
081600*    NOTE:  A NOT FOUND CONDITION IN THIS INSTANCE RESULTS       *08160004
081700*           IN THE OUT OF RECEIPTS SWITCH BEING SET.             *08170004
081800*    CALLED FROM B200-PROCESS-POS                                *08180004
081900*                C300-PROCESS-RECEIPTS                           *08190004
082000*----------------------------------------------------------------*08200004
082100 R300-FETCH-BULK-RECEIPTS.                                        08210004
082200                                                                  08220004
082300     EXEC SQL                                                     08230004
082400         FETCH BULK_CSR                                           08240004
082500         INTO                                                     08250004
082600               :PURITM-CL-NBR                                     08260004
082700              ,:NINREC-NON-INVC-SEQ-NBR                           08270004
082800              ,:NINREC-STR-NBR                                    08280004
082900              ,:PV-RECEIPT-TYPE                                   08290004
083000              ,:NINREC-NON-INVC-UNT-QTY                           08300004
083100              ,:PV-TOTAL-COST                                     08310004
083110              ,:PV-TOTAL-1ST-COST                                 08311010
083200              ,:PURITM-GP-RTL-AMT                                 08320004
083300              ,:PURITM-GP-QTY                                     08330004
083400              ,:PURITM-UNT-RTL-PR-AMT                             08340004
083500              ,:NINREC-REC-TMST                                   08350004
083600              ,:RECEIV-VERFYD-TMST                                08360004
083700              ,:NINREC-PO-LNE-NBR                                 08370004
083800              ,:RECDIS-OPER-UNT-ID                                08380004
083900              ,:RECDIS-FCLTY-ID                                   08390004
084000              ,:RECDIS-STR-FCLTY-ID                               08400004
084100              ,:RECDIS-CRE-TMST                                   08410004
084200              ,:RECEIV-CRE-TMST                                   08420004
084300              ,:NINREC-ORIG-DISC-PCT                              08430004
084400              ,:PURITM-RMS-PO-SKU-NBR                             08440004
084500              ,:PURITM-ITM-NBR                                    08450004
084600              ,:NINREC-DC-NBR                                     08460004
084700     END-EXEC.                                                    08470004
084800                                                                  08480004
084900     EVALUATE TRUE                                                08490004
085000         WHEN SQLCODE = ZEROS                                     08500004
085100              IF PURITM-RMS-PO-SKU-NBR NOT = 0                    08510004
085200                 MOVE PURITM-RMS-PO-SKU-NBR TO PV-SKU-NBR         08520004
085300              ELSE                                                08530004
085400                 IF PURITM-ITM-NBR = 0                            08540004
085500                    MOVE ZEROES             TO PV-SKU-NBR         08550004
085600                 ELSE                                             08560004
085700                    PERFORM S100-SELECT-SKU                       08570004
085800                    MOVE SKXREF-SKU         TO PV-SKU-NBR         08580004
085900                 END-IF                                           08590004
086000              END-IF                                              08600004
086100                                                                  08610004
086200         WHEN SQLCODE = +100                                      08620004
086300              SET OUT-OF-RECEIPTS TO TRUE                         08630004
086400                                                                  08640004
086500         WHEN SQLWARN0 NOT = SPACES                               08650004
086600         WHEN SQLCODE  NOT = ZERO                                 08660004
086700             MOVE 'R300-FETCH-BULK-RECEIPTS'                      08670004
086800                                 TO AA-PARAGRAPH-NAME             08680004
086900             MOVE 'UNSUCCESSFUL FETCH WITH BULK_CSR'              08690004
087000                                 TO AA-DB2-OPERATION              08700004
087100             MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                08710004
087200             MOVE 'TRECITM'      TO AA-DB2-TABLE-2                08720004
087300             MOVE 'TRECDIS'      TO AA-DB2-TABLE-3                08730004
087400             MOVE 'TPURITM'      TO AA-DB2-TABLE-4                08740004
087500             MOVE 'TNINREC'      TO AA-DB2-TABLE-5                08750004
087600             PERFORM Z998-DB2-ABEND                               08760004
087700     END-EVALUATE.                                                08770004
087800 EJECT                                                            08780004
087900*----------------------------------------------------------------*08790004
088000*    RETRIEVES THE RECEIPT INFORMATION FOR THE STORE/PURCHASE    *08800004
088100*    ORDER BEING PROCESSED.                                      *08810004
088200*    NOTE:  A NOT FOUND CONDITION IN THIS INSTANCE RESULTS       *08820004
088300*           IN THE OUT OF RECEIPTS SWITCH BEING SET.             *08830004
088400*    CALLED FROM B200-PROCESS-POS                                *08840004
088500*                C300-PROCESS-RECEIPTS                           *08850004
088600*----------------------------------------------------------------*08860004
088700 R400-FETCH-STORE-RECEIPTS.                                       08870004
088800                                                                  08880004
088900     EXEC SQL                                                     08890004
089000         FETCH STORE_CSR                                          08900004
089100         INTO                                                     08910004
089200               :PURITM-CL-NBR                                     08920004
089300              ,:NINREC-NON-INVC-SEQ-NBR                           08930004
089400              ,:NINREC-STR-NBR                                    08940004
089500              ,:PV-RECEIPT-TYPE                                   08950004
089600              ,:NINREC-NON-INVC-UNT-QTY                           08960004
089700              ,:PV-TOTAL-COST                                     08970004
089720              ,:PV-TOTAL-1ST-COST                                 08972010
089800              ,:PURITM-GP-RTL-AMT                                 08980004
089900              ,:PURITM-GP-QTY                                     08990004
090000              ,:PURITM-UNT-RTL-PR-AMT                             09000004
090100              ,:NINREC-REC-TMST                                   09010004
090200              ,:RECEIV-VERFYD-TMST                                09020004
090300              ,:NINREC-PO-LNE-NBR                                 09030004
090400              ,:RECDIS-OPER-UNT-ID                                09040004
090500              ,:RECDIS-FCLTY-ID                                   09050004
090600              ,:RECDIS-STR-FCLTY-ID                               09060004
090700              ,:RECDIS-CRE-TMST                                   09070004
090800              ,:RECEIV-CRE-TMST                                   09080004
090900              ,:NINREC-ORIG-DISC-PCT                              09090004
091000              ,:PURITM-RMS-PO-SKU-NBR                             09100004
091100              ,:PURITM-ITM-NBR                                    09110004
091200              ,:NINREC-DC-NBR                                     09120004
091300     END-EXEC.                                                    09130004
091400                                                                  09140004
091500     EVALUATE TRUE                                                09150004
091600         WHEN SQLCODE = ZEROS                                     09160004
091700              IF PURITM-RMS-PO-SKU-NBR NOT = 0                    09170004
091800                 MOVE PURITM-RMS-PO-SKU-NBR TO PV-SKU-NBR         09180004
091900              ELSE                                                09190004
092000                 IF PURITM-ITM-NBR = 0                            09200004
092100                    MOVE ZEROES             TO PV-SKU-NBR         09210004
092200                 ELSE                                             09220004
092300                    PERFORM S100-SELECT-SKU                       09230004
092400                    MOVE SKXREF-SKU         TO PV-SKU-NBR         09240004
092500                 END-IF                                           09250004
092600              END-IF                                              09260004
092700                                                                  09270004
092800         WHEN SQLCODE = +100                                      09280004
092900              SET OUT-OF-RECEIPTS TO TRUE                         09290004
093000                                                                  09300004
093100         WHEN SQLWARN0 NOT = SPACES                               09310004
093200         WHEN SQLCODE  NOT = ZERO                                 09320004
093300             MOVE 'R400-FETCH-STORE-RECEIPTS'                     09330004
093400                                 TO AA-PARAGRAPH-NAME             09340004
093500             MOVE 'UNSUCCESSFUL FETCH WITH STORE_CSR'             09350004
093600                                 TO AA-DB2-OPERATION              09360004
093700             MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                09370004
093800             MOVE 'TRECITM'      TO AA-DB2-TABLE-2                09380004
093900             MOVE 'TRECDIS'      TO AA-DB2-TABLE-3                09390004
094000             MOVE 'TPURITM'      TO AA-DB2-TABLE-4                09400004
094100             MOVE 'TNINREC'      TO AA-DB2-TABLE-5                09410004
094200             PERFORM Z998-DB2-ABEND                               09420004
094300     END-EVALUATE.                                                09430004
094400 EJECT                                                            09440004
094500*----------------------------------------------------------------*09450004
094600*    RETRIEVES THE RECEIPT INFORMATION FOR THE DC ORDER BEING    *09460004
094700*    PROCESSED.                                                  *09470004
094800*    NOTE:  A NOT FOUND CONDITION IN THIS INSTANCE RESULTS       *09480004
094900*           IN THE OUT OF RECEIPTS SWITCH BEING SET.             *09490004
095000*    CALLED FROM C100-PROCESS-INPUT-POS                          *09500004
095100*----------------------------------------------------------------*09510004
095200 R450-FETCH-DC-RECEIPTS.                                          09520004
095300                                                                  09530004
095400     EXEC SQL                                                     09540004
095500         FETCH DC_CSR                                             09550004
095600         INTO                                                     09560004
095700               :PURITM-CL-NBR                                     09570004
095800              ,:NINREC-NON-INVC-SEQ-NBR                           09580004
095900              ,:NINREC-STR-NBR                                    09590004
096000              ,:PV-RECEIPT-TYPE                                   09600004
096100              ,:NINREC-NON-INVC-UNT-QTY                           09610004
096200              ,:PV-TOTAL-COST                                     09620004
096220              ,:PV-TOTAL-1ST-COST                                 09622010
096300              ,:PURITM-GP-RTL-AMT                                 09630004
096400              ,:PURITM-GP-QTY                                     09640004
096500              ,:PURITM-UNT-RTL-PR-AMT                             09650004
096501              ,:NINREC-REC-TMST                                   09650104
096502              ,:RECEIV-VERFYD-TMST                                09650204
096503              ,:NINREC-PO-LNE-NBR                                 09650304
096504              ,:RECDIS-OPER-UNT-ID                                09650404
096505              ,:RECDIS-FCLTY-ID                                   09650504
096506              ,:RECDIS-STR-FCLTY-ID                               09650604
096507              ,:RECDIS-CRE-TMST                                   09650704
096508              ,:RECEIV-CRE-TMST                                   09650804
096509              ,:NINREC-ORIG-DISC-PCT                              09650904
096510              ,:PURITM-RMS-PO-SKU-NBR                             09651004
096511              ,:PURITM-ITM-NBR                                    09651104
096512              ,:NINREC-DC-NBR                                     09651204
096513     END-EXEC.                                                    09651304
096514                                                                  09651404
096515     EVALUATE TRUE                                                09651504
096516         WHEN SQLCODE = ZEROS                                     09651604
096517              IF PURITM-RMS-PO-SKU-NBR NOT = 0                    09651704
096518                 MOVE PURITM-RMS-PO-SKU-NBR TO PV-SKU-NBR         09651804
096519              ELSE                                                09651904
096520                 IF PURITM-ITM-NBR = 0                            09652004
096521                    MOVE ZEROES             TO PV-SKU-NBR         09652104
096522                 ELSE                                             09652204
096523                    PERFORM S100-SELECT-SKU                       09652304
096524                    MOVE SKXREF-SKU         TO PV-SKU-NBR         09652404
096525                 END-IF                                           09652504
096526              END-IF                                              09652604
096527                                                                  09652704
096528         WHEN SQLCODE = +100                                      09652804
096529             SET OUT-OF-RECEIPTS TO TRUE                          09652904
096530                                                                  09653004
096531         WHEN SQLWARN0 NOT = SPACES                               09653104
096532         WHEN SQLCODE  NOT = ZERO                                 09653204
096533             MOVE 'R450-FETCH-DC-RECEIPTS'                        09653304
096534                                 TO AA-PARAGRAPH-NAME             09653404
096535             MOVE 'UNSUCCESSFUL FETCH WITH DC_CSR'                09653504
096536                                 TO AA-DB2-OPERATION              09653604
096537             MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                09653704
096538             MOVE 'TRECITM'      TO AA-DB2-TABLE-2                09653804
096539             MOVE 'TRECDIS'      TO AA-DB2-TABLE-3                09653904
096540             MOVE 'TPURITM'      TO AA-DB2-TABLE-4                09654004
096541             MOVE 'TNINREC'      TO AA-DB2-TABLE-5                09654104
096542             PERFORM Z998-DB2-ABEND                               09654204
096543     END-EVALUATE.                                                09654304
096544 EJECT                                                            09654404
096545*----------------------------------------------------------------*09654504
096546*    RETRIEVES TYPE CODE FOR THE OPER UNIT ID                    *09654604
096547*----------------------------------------------------------------*09654704
096548 R500-SELECT-OPER-UNT-TYP-CDE.                                    09654804
096549                                                                  09654904
096550     PERFORM VARYING LOC-INDX FROM 1 BY 1                         09655004
096551       UNTIL WS-LOC-NBR(LOC-INDX) = RECDIS-OPER-UNT-ID            09655104
096552          OR WS-LOC-NBR(LOC-INDX) = ZEROES                        09655204
096553          OR LOC-INDX > 1500                                      09655304
096554     END-PERFORM.                                                 09655404
096555                                                                  09655504
096556     IF  LOC-INDX > 1500                                          09655604
096557         MOVE SPACES TO WS-SAVE-LOC-TYP-CDE                       09655704
096558     ELSE                                                         09655804
096559         MOVE WS-LOC-TYP-CDE (LOC-INDX) TO WS-SAVE-LOC-TYP-CDE    09655904
096560     END-IF.                                                      09656004
096570                                                                  09657004
096580 EJECT                                                            09658004
096590*----------------------------------------------------------------*09659004
096600*    RETRIEVES TIMES FOR JUDGING WHEN TO DISPLAY.                *09660004
096700*----------------------------------------------------------------*09670004
096800 R900-GET-TIMES.                                                  09680004
096900                                                                  09690004
097000     EXEC SQL                                                     09700004
097100         SELECT  CURRENT TIMESTAMP                                09710004
097200                ,CURRENT TIMESTAMP + 60 SECONDS                   09720004
097300         INTO    :PV-CURRENT-TIME                                 09730004
097400                ,:PV-TEMP-DISPLAY-TIME                            09740004
097500         FROM  TAPCNTL                                            09750004
097600     END-EXEC.                                                    09760004
097700                                                                  09770004
097800     EVALUATE TRUE                                                09780004
097900         WHEN SQLCODE = ZERO                                      09790004
098000              CONTINUE                                            09800004
098100                                                                  09810004
098200         WHEN SQLWARN0 NOT = SPACES                               09820004
098300         WHEN SQLCODE  NOT = ZERO                                 09830004
098400             MOVE 'R900-GET-TIMES'                                09840004
098500                              TO AA-PARAGRAPH-NAME                09850004
098600             MOVE 'UNSUCCESSFUL SELECT OF TIMES'                  09860004
098700                              TO AA-DB2-OP-1                      09870004
098800             MOVE 'TAPCNTL'   TO AA-DB2-TABLE-1                   09880004
098900             MOVE SPACES      TO AA-DB2-TABLE-2                   09890004
099000                                 AA-DB2-TABLE-3                   09900004
099100                                 AA-DB2-TABLE-4                   09910004
099200                                 AA-DB2-TABLE-5                   09920004
099300             PERFORM Z998-DB2-ABEND                               09930004
099400     END-EVALUATE.                                                09940004
099500 EJECT                                                            09950004
099600*----------------------------------------------------------------*09960004
099700*    SELECTS THE SKU FROM TSKXREF                                *09970004
099800*----------------------------------------------------------------*09980004
099900 S100-SELECT-SKU.                                                 09990004
100000                                                                  10000004
100100     EXEC SQL                                                     10010004
100200        SELECT B.SKU                                              10020004
100300          INTO :SKXREF-SKU                                        10030004
100400         FROM TSKXREF B                                           10040004
100500        WHERE B.ITM_NBR        = :PURITM-ITM-NBR                  10050004
100600     END-EXEC.                                                    10060004
100700                                                                  10070004
100800     EVALUATE TRUE                                                10080004
100900         WHEN SQLCODE = ZERO                                      10090004
101000              CONTINUE                                            10100004
101100                                                                  10110004
101200         WHEN SQLCODE = +100                                      10120004
101300              MOVE ZEROES TO SKXREF-SKU                           10130004
101400                                                                  10140004
101500         WHEN SQLWARN0 NOT = SPACES                               10150004
101600         WHEN SQLCODE  NOT = ZERO                                 10160004
101700             MOVE PURITM-ITM-NBR TO PV-ITM-NBR                    10170004
101800             DISPLAY 'PURITM ITM NBR = ' PV-ITM-NBR               10180004
101900             MOVE 'S100-SELECT-SKU    '                           10190004
102000                              TO AA-PARAGRAPH-NAME                10200004
102100             MOVE 'UNSUCCESSFUL SELECT OF SKU'                    10210004
102200                              TO AA-DB2-OP-1                      10220004
102300             MOVE 'TSKXREF'   TO AA-DB2-TABLE-1                   10230004
102400             MOVE SPACES      TO AA-DB2-TABLE-2                   10240004
102500                                 AA-DB2-TABLE-3                   10250004
102600                                 AA-DB2-TABLE-4                   10260004
102700                                 AA-DB2-TABLE-5                   10270004
102800             PERFORM Z998-DB2-ABEND                               10280004
102900     END-EVALUATE.                                                10290004
103000 EJECT                                                            10300004
103010*----------------------------------------------------------------*10301010
103020*    SELECTS PO TYPE FROM TPURCHS                                *10302010
103030*----------------------------------------------------------------*10303010
103040 S200-SELECT-PO-TYPE.                                             10304010
103050                                                                  10305010
103060     EXEC SQL                                                     10306010
103070        SELECT PO_TYP_CDE                                         10307012
103080          INTO :PURCHS-PO-TYP-CDE                                 10308010
103090          FROM TPURCHS                                            10309011
103091         WHERE PO_NBR = :PV-PO-BEING-PROCESSED                    10309111
103092           AND VER_STATUS_CDE = 'A'                               10309225
103093     END-EXEC.                                                    10309310
103094                                                                  10309410
103095     EVALUATE TRUE                                                10309510
103096         WHEN SQLCODE = ZERO                                      10309610
103097              CONTINUE                                            10309710
103101         WHEN SQLWARN0 NOT = SPACES                               10310110
103102         WHEN SQLCODE  NOT = ZERO                                 10310210
103104              MOVE  PV-PO-BEING-PROCESSED  TO PV-DISPLAY-PO       10310419
103105              DISPLAY 'PO BEING PROCESSED = ' PV-DISPLAY-PO       10310519
103106              MOVE 'S200-SELECT-PO-TYPE'                          10310611
103107                             TO AA-PARAGRAPH-NAME                 10310719
103108              MOVE 'UNSUCCESSFUL SELECT OF PO TYPE'               10310811
103109                             TO AA-DB2-OP-1                       10310919
103110              MOVE 'TPURCHS' TO AA-DB2-TABLE-1                    10311019
103115              PERFORM Z998-DB2-ABEND                              10311511
103116     END-EVALUATE.                                                10311611
103117 EJECT                                                            10311711
103120*----------------------------------------------------------------*10312010
103200*    WRITES THE PO/STORE PO LINES FILE RECORDS.                  *10320004
103300*----------------------------------------------------------------*10330004
103400 W100-WRITE-PO-LINES.                                             10340004
103500                                                                  10350004
103600     WRITE PO-LINES-RECORD FROM AP100-RECORD.                     10360004
103700 SKIP3                                                            10370004
103800*----------------------------------------------------------------*10380004
103900*    WRITES THE PO/STORE RECEIPTS SUM RECORDS.                   *10390004
104000*----------------------------------------------------------------*10400004
104100 W200-WRITE-RECEIPTS-SUM.                                         10410004
104200                                                                  10420004
104300     WRITE RECEIPTS-SUM-RECORD FROM AP101-RECORD.                 10430004
104400 SKIP3                                                            10440004
104500*----------------------------------------------------------------*10450004
104600*    WRITES THE PO/STORE RECEIPTS RECORDS.                       *10460004
104700*----------------------------------------------------------------*10470004
104800 W300-WRITE-RECEIPTS.                                             10480004
104900                                                                  10490004
105000     WRITE RECEIPTS-RECORD FROM AP105-RECORD.                     10500004
105100                                                                  10510004
105200 EJECT                                                            10520004
105300*----------------------------------------------------------------*10530004
105400*  OPEN LOCATION CURSOR                                          *10540004
105500*----------------------------------------------------------------*10550004
105600 X100-OPEN-LOCATION-CSR.                                          10560004
105700                                                                  10570004
105800     EXEC SQL                                                     10580004
105900        OPEN LOCATION_CSR                                         10590004
106000     END-EXEC.                                                    10600004
106100                                                                  10610004
106200     EVALUATE TRUE                                                10620004
106300         WHEN SQLCODE = ZERO                                      10630004
106400              CONTINUE                                            10640004
106500         WHEN SQLWARN0 NOT = SPACES                               10650004
106600         WHEN SQLCODE  NOT = ZERO                                 10660004
106700              MOVE 'X100-OPEN-LOCATION-CSR        '               10670004
106800                            TO AA-PARAGRAPH-NAME                  10680004
106900              MOVE 'UNSUCCESSFUL OPEN LOCATION CURSOR'            10690004
107000                            TO AA-DB2-OPERATION                   10700004
107100              MOVE 'XFT00017' TO AA-DB2-TABLE-1                   10710029
107200              MOVE SPACES     TO AA-DB2-TABLE-2                   10720004
107300              PERFORM Z998-DB2-ABEND                              10730004
107400     END-EVALUATE.                                                10740004
107500                                                                  10750004
107600*----------------------------------------------------------------*10760004
107700*  FETCH ROWS FROM LOCATION CURSOR AND LOAD INTO LOCATION TABLE  *10770004
107800*  FOR STORE NUMBER VALIDATION.                                  *10780004
107900*----------------------------------------------------------------*10790004
108000 X200-LOAD-LOCATION-TBL.                                          10800004
108100                                                                  10810004
108200     PERFORM VARYING LOC-INDX FROM 1 BY 1                         10820004
108300       UNTIL LOC-INDX > PC-LOC-TBL-MAX                            10830004
108400           MOVE ZEROES TO WS-LOC-NBR(LOC-INDX)                    10840004
108500           MOVE SPACES TO WS-LOC-TYP-CDE(LOC-INDX)                10850004
108600     END-PERFORM.                                                 10860004
108700                                                                  10870004
108800     PERFORM VARYING LOC-INDX FROM 1 BY 1                         10880004
108900       UNTIL LOC-INDX > PC-LOC-TBL-MAX                            10890004
109000          OR END-OF-LOC-CSR                                       10900004
109100             EXEC SQL                                             10910004
109200                  FETCH LOCATION_CSR                              10920004
109300                  INTO :XFT00017-LOC-NBR                          10930029
109400                     , :XFT00017-LOC-TYP-CDE                      10940029
109500             END-EXEC                                             10950004
109600                                                                  10960004
109700             EVALUATE TRUE                                        10970004
109800               WHEN SQLCODE = +100                                10980004
109900                    SET END-OF-LOC-CSR TO TRUE                    10990004
110000               WHEN SQLCODE = ZERO                                11000004
110100                    IF  LOC-INDX > PC-LOC-TBL-MAX                 11010004
110200                        MOVE 'X200-LOAD-LOCATION-TBL'             11020004
110300                                              TO AA-PARAGRAPH-NAME11030004
110400                        MOVE 'LOCATION TABLE EXCEEDS MAX ENTRIES' 11040004
110500                                              TO AA-MESSAGE       11050004
110600                        SET AC-TABLE-OVERFLOW TO TRUE             11060004
110700                        PERFORM Z999-ABEND                        11070004
110800                    END-IF                                        11080004
110900                                                                  11090004
111000                    MOVE XFT00017-LOC-NBR TO WS-LOC-NBR(LOC-INDX) 11100029
111100                    MOVE XFT00017-LOC-TYP-CDE                     11110029
111200                                       TO WS-LOC-TYP-CDE(LOC-INDX)11120004
111300               WHEN SQLWARN0 NOT = SPACES                         11130004
111400               WHEN SQLCODE  NOT = ZERO                           11140004
111500                    MOVE 'X200-LOAD-LOCATION-TBL        '         11150004
111600                                  TO AA-PARAGRAPH-NAME            11160004
111700                    MOVE 'UNSUCCESSFUL FETCH LOCATION CSR'        11170004
111800                                  TO AA-DB2-OPERATION             11180004
111900                    MOVE 'XFT00017' TO AA-DB2-TABLE-1             11190029
112000                    MOVE SPACES     TO AA-DB2-TABLE-2             11200004
112100                    PERFORM Z998-DB2-ABEND                        11210004
112200             END-EVALUATE                                         11220004
112300     END-PERFORM.                                                 11230004
112400                                                                  11240004
112500*----------------------------------------------------------------*11250004
112600*  CLOSE LOCATION CURSOR                                         *11260004
112700*----------------------------------------------------------------*11270004
112800 X300-CLOSE-LOCATION-CSR.                                         11280004
112900                                                                  11290004
113000     EXEC SQL                                                     11300004
113100        CLOSE LOCATION_CSR                                        11310004
113200     END-EXEC.                                                    11320004
113300                                                                  11330004
113400     EVALUATE TRUE                                                11340004
113500         WHEN SQLCODE = ZERO                                      11350004
113600              CONTINUE                                            11360004
113700         WHEN SQLWARN0 NOT = SPACES                               11370004
113800         WHEN SQLCODE  NOT = ZERO                                 11380004
113900              MOVE 'X300-CLOSE-LOCATION-CSR        '              11390004
114000                            TO AA-PARAGRAPH-NAME                  11400004
114100              MOVE 'UNSUCCESSFUL CLOSE LOCATION CURSOR'           11410004
114200                            TO AA-DB2-OPERATION                   11420004
114300              MOVE 'XFT00017' TO AA-DB2-TABLE-1                   11430029
114400              MOVE SPACES     TO AA-DB2-TABLE-2                   11440004
114500              PERFORM Z998-DB2-ABEND                              11450004
114600     END-EVALUATE.                                                11460004
114610                                                                  11461004
114620 EJECT                                                            11462004
114630*----------------------------------------------------------------*11463004
114640*  COMMITS AFTER XFT TABLE IS PROCESSED TO RELEASE DB3P THREAD.  *11464004
114650*----------------------------------------------------------------*11465004
114660 X400-COMMIT.                                                     11466004
114661                                                                  11466104
114662     EXEC SQL                                                     11466204
114663         COMMIT                                                   11466304
114664     END-EXEC.                                                    11466404
114665                                                                  11466504
114666     EVALUATE TRUE                                                11466604
114667         WHEN SQLCODE = ZEROS                                     11466704
114668              CONTINUE                                            11466804
114669         WHEN OTHER                                               11466904
114670             MOVE 'X400-COMMIT'  TO AA-PARAGRAPH-NAME             11467004
114671             MOVE 'UNSUCCESSFUL COMMIT'                           11467104
114672                                 TO AA-DB2-OPERATION              11467204
114673             MOVE SPACES         TO AA-DB2-TABLE-1                11467304
114674                                    AA-DB2-TABLE-2                11467404
114675                                    AA-DB2-TABLE-3                11467504
114676             PERFORM Z998-DB2-ABEND                               11467604
114677     END-EVALUATE.                                                11467704
114678                                                                  11467804
114679*----------------------------------------------------------------*11467904
114680*    OPENS THE PURCHASE ORDER CURSOR.                            *11468004
114681*    CALLED FROM B100-INITIALIZATION                             *11468104
114682*----------------------------------------------------------------*11468204
114683 Y100-OPEN-PO-CSR.                                                11468304
114684                                                                  11468404
114685     EXEC SQL                                                     11468504
114686         OPEN PO_CSR                                              11468604
114687     END-EXEC.                                                    11468704
114688                                                                  11468804
114689     EVALUATE TRUE                                                11468904
114690         WHEN SQLCODE = ZERO                                      11469004
114691              CONTINUE                                            11469104
114692                                                                  11469204
114693         WHEN SQLCODE = +100                                      11469304
114694             MOVE 'Y100-OPEN-PO-CSR' TO AA-PARAGRAPH-NAME         11469404
114695             MOVE 'NO POS TO BE PROCESSED' TO AA-DB2-OPERATION    11469504
114696             MOVE 'TPOSTRR'      TO AA-DB2-TABLE-1                11469604
114697             SET OUT-OF-POS      TO TRUE                          11469704
114698             PERFORM Z998-DB2-ABEND                               11469804
114699                                                                  11469904
114700         WHEN SQLWARN0 NOT = SPACES                               11470004
114800         WHEN SQLCODE  NOT = ZERO                                 11480004
114900             MOVE 'Y100-OPEN-PO-CSR' TO AA-PARAGRAPH-NAME         11490004
115000             MOVE 'UNSUCCESSFUL OPEN ON PO_CSR'                   11500004
115100                                 TO AA-DB2-OPERATION              11510004
115200             MOVE 'TPOSTRR'      TO AA-DB2-TABLE-1                11520004
115300             MOVE SPACES         TO AA-DB2-TABLE-2                11530004
115400                                    AA-DB2-TABLE-3                11540004
115500                                    AA-DB2-TABLE-4                11550004
115600                                    AA-DB2-TABLE-5                11560004
115700             PERFORM Z998-DB2-ABEND                               11570004
115800     END-EVALUATE.                                                11580004
115900 EJECT                                                            11590004
116000*----------------------------------------------------------------*11600004
116100*    CLOSES THE PURCHASE ORDER CURSOR                            *11610004
116200*----------------------------------------------------------------*11620004
116300 Y110-CLOSE-PO-CSR.                                               11630004
116400                                                                  11640004
116500     EXEC SQL                                                     11650004
116600         CLOSE PO_CSR                                             11660004
116700     END-EXEC.                                                    11670004
116800                                                                  11680004
116900     EVALUATE TRUE                                                11690004
117000         WHEN SQLCODE = ZERO                                      11700004
117100              CONTINUE                                            11710004
117200                                                                  11720004
117300         WHEN SQLWARN0 NOT = SPACES                               11730004
117400         WHEN SQLCODE  NOT = ZERO                                 11740004
117500             MOVE 'Y110-CLOSE-PO-CSR' TO AA-PARAGRAPH-NAME        11750004
117600             MOVE 'UNSUCCESSFUL CLOSE ON PO_CSR'                  11760004
117700                                 TO AA-DB2-OPERATION              11770004
117800             MOVE 'TPOSTRR'      TO AA-DB2-TABLE-1                11780004
117900             MOVE SPACES         TO AA-DB2-TABLE-2                11790004
118000                                    AA-DB2-TABLE-3                11800004
118100                                    AA-DB2-TABLE-4                11810004
118200                                    AA-DB2-TABLE-5                11820004
118300             PERFORM Z998-DB2-ABEND                               11830004
118400     END-EVALUATE.                                                11840004
118500 EJECT                                                            11850004
118600*----------------------------------------------------------------*11860004
118700*    OPENS THE PRICE CLAIM ADJUSTMENT CURSOR.                    *11870004
118800*----------------------------------------------------------------*11880004
118900 Y200-OPEN-PRCCLM-CSR.                                            11890004
119000                                                                  11900004
119100     EXEC SQL                                                     11910004
119200         OPEN PRCCLM_CSR                                          11920004
119300     END-EXEC.                                                    11930004
119400                                                                  11940004
119500     EVALUATE TRUE                                                11950004
119600         WHEN SQLCODE = ZERO                                      11960004
119700             CONTINUE                                             11970004
119800                                                                  11980004
119900         WHEN SQLWARN0 NOT = SPACES                               11990004
120000         WHEN SQLCODE  NOT = ZERO                                 12000004
120100             MOVE 'Y200-OPEN-PRCCLM-CSR' TO AA-PARAGRAPH-NAME     12010004
120200             MOVE 'UNSUCCESSFUL OPEN ON PRCCLM_CSR'               12020004
120300                                 TO AA-DB2-OPERATION              12030004
120400             MOVE 'TPRCCLM'      TO AA-DB2-TABLE-1                12040004
120500             MOVE SPACES         TO AA-DB2-TABLE-2                12050004
120600                                    AA-DB2-TABLE-3                12060004
120700                                    AA-DB2-TABLE-4                12070004
120800                                    AA-DB2-TABLE-5                12080004
120900             PERFORM Z998-DB2-ABEND                               12090004
121000     END-EVALUATE.                                                12100004
121100 EJECT                                                            12110004
121200*----------------------------------------------------------------*12120004
121300*    CLOSES THE ADJUSTMENT CURSOR                                *12130004
121400*----------------------------------------------------------------*12140004
121500 Y210-CLOSE-PRCCLM-CSR.                                           12150004
121600                                                                  12160004
121700     EXEC SQL                                                     12170004
121800         CLOSE PRCCLM_CSR                                         12180004
121900     END-EXEC.                                                    12190004
122000                                                                  12200004
122100     EVALUATE TRUE                                                12210004
122200         WHEN SQLCODE = ZERO                                      12220004
122300              CONTINUE                                            12230004
122400                                                                  12240004
122500         WHEN SQLWARN0 NOT = SPACES                               12250004
122600         WHEN SQLCODE  NOT = ZERO                                 12260004
122700             MOVE 'Y210-CLOSE-PRCCLM-CSR' TO AA-PARAGRAPH-NAME    12270004
122800             MOVE 'UNSUCCESSFUL CLOSE ON PRCCLM_CSR'              12280004
122900                                 TO AA-DB2-OPERATION              12290004
123000             MOVE 'TPRCCLM'      TO AA-DB2-TABLE-1                12300004
123100             MOVE SPACES         TO AA-DB2-TABLE-2                12310004
123200                                    AA-DB2-TABLE-3                12320004
123300                                    AA-DB2-TABLE-4                12330004
123400                                    AA-DB2-TABLE-5                12340004
123500             PERFORM Z998-DB2-ABEND                               12350004
123600     END-EVALUATE.                                                12360004
123700 EJECT                                                            12370004
123800*----------------------------------------------------------------*12380004
123900*    OPENS THE BULK RECEIPTS CURSOR.                             *12390004
124000*    CALLED FROM B200-PROCESS-POS                                *12400004
124100*----------------------------------------------------------------*12410004
124200 Y300-OPEN-BULK-CSR.                                              12420004
124300                                                                  12430004
124400     EXEC SQL                                                     12440004
124500         OPEN BULK_CSR                                            12450004
124600     END-EXEC.                                                    12460004
124700                                                                  12470004
124800     EVALUATE TRUE                                                12480004
124900         WHEN SQLCODE = ZERO                                      12490004
125000              CONTINUE                                            12500004
125100                                                                  12510004
125200         WHEN SQLWARN0 NOT = SPACES                               12520004
125300         WHEN SQLCODE  NOT = ZERO                                 12530004
125400             MOVE 'Y300-OPEN-BULK-CSR' TO AA-PARAGRAPH-NAME       12540004
125500             MOVE 'UNSUCCESSFUL OPEN ON BULK_CSR'                 12550004
125600                                 TO AA-DB2-OPERATION              12560004
125700             MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                12570004
125800             MOVE 'TRECITM'      TO AA-DB2-TABLE-2                12580004
125900             MOVE 'TRECDIS'      TO AA-DB2-TABLE-3                12590004
126000             MOVE 'TPURITM'      TO AA-DB2-TABLE-4                12600004
126100             MOVE 'TNINREC'      TO AA-DB2-TABLE-5                12610004
126200             PERFORM Z998-DB2-ABEND                               12620004
126300     END-EVALUATE.                                                12630004
126400                                                                  12640004
126500                                                                  12650004
126600*----------------------------------------------------------------*12660004
126700*    CLOSES THE BULK RECEIPTS CURSOR.                            *12670004
126800*    CALLED FROM B200-PROCESS-POS                                *12680004
126900*----------------------------------------------------------------*12690004
127000 Y310-CLOSE-BULK-CSR.                                             12700004
127100                                                                  12710004
127200     EXEC SQL                                                     12720004
127300         CLOSE BULK_CSR                                           12730004
127400     END-EXEC.                                                    12740004
127500                                                                  12750004
127600     EVALUATE TRUE                                                12760004
127700         WHEN SQLCODE = ZERO                                      12770004
127800              CONTINUE                                            12780004
127900                                                                  12790004
128000         WHEN SQLWARN0 NOT = SPACES                               12800004
128100         WHEN SQLCODE  NOT = ZERO                                 12810004
128200             MOVE 'Y310-CLOSE-BULK-CSR' TO AA-PARAGRAPH-NAME      12820004
128300             MOVE 'UNSUCCESSFUL CLOSE ON BULK_CSR'                12830004
128400                                 TO AA-DB2-OPERATION              12840004
128500             MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                12850004
128600             MOVE 'TRECITM'      TO AA-DB2-TABLE-2                12860004
128700             MOVE 'TRECDIS'      TO AA-DB2-TABLE-3                12870004
128800             MOVE 'TPURITM'      TO AA-DB2-TABLE-4                12880004
128900             MOVE 'TNINREC'      TO AA-DB2-TABLE-5                12890004
129000             PERFORM Z998-DB2-ABEND                               12900004
129100     END-EVALUATE.                                                12910004
129200 EJECT                                                            12920004
129300*----------------------------------------------------------------*12930004
129400*    OPENS THE STORE RECEIPTS CURSOR.                            *12940004
129500*    CALLED FROM B200-PROCESS-POS                                *12950004
129600*----------------------------------------------------------------*12960004
129700 Y400-OPEN-STORE-CSR.                                             12970004
129800                                                                  12980004
129900     EXEC SQL                                                     12990004
130000         OPEN STORE_CSR                                           13000004
130100     END-EXEC.                                                    13010004
130200                                                                  13020004
130300     EVALUATE TRUE                                                13030004
130400         WHEN SQLCODE = ZERO                                      13040004
130500              CONTINUE                                            13050004
130600                                                                  13060004
130700         WHEN SQLWARN0 NOT = SPACES                               13070004
130800         WHEN SQLCODE  NOT = ZERO                                 13080004
130900             MOVE 'Y400-OPEN-STORE-CSR' TO AA-PARAGRAPH-NAME      13090004
131000             MOVE 'UNSUCCESSFUL OPEN ON STORE_CSR'                13100004
131100                                 TO AA-DB2-OPERATION              13110004
131200             MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                13120004
131300             MOVE 'TRECITM'      TO AA-DB2-TABLE-2                13130004
131400             MOVE 'TRECDIS'      TO AA-DB2-TABLE-3                13140004
131500             MOVE 'TPURITM'      TO AA-DB2-TABLE-4                13150004
131600             MOVE 'TNINREC'      TO AA-DB2-TABLE-5                13160004
131700             PERFORM Z998-DB2-ABEND                               13170004
131800     END-EVALUATE.                                                13180004
131900                                                                  13190004
132000                                                                  13200004
132100*----------------------------------------------------------------*13210004
132200*    CLOSES THE STORE RECEIPTS CURSOR.                           *13220004
132300*    CALLED FROM B200-PROCESS-POS                                *13230004
132400*----------------------------------------------------------------*13240004
132500 Y410-CLOSE-STORE-CSR.                                            13250004
132600                                                                  13260004
132700     EXEC SQL                                                     13270004
132800         CLOSE STORE_CSR                                          13280004
132900     END-EXEC.                                                    13290004
133000                                                                  13300004
133100     EVALUATE TRUE                                                13310004
133200         WHEN SQLCODE = ZERO                                      13320004
133300              CONTINUE                                            13330004
133400                                                                  13340004
133500         WHEN SQLWARN0 NOT = SPACES                               13350004
133600         WHEN SQLCODE  NOT = ZERO                                 13360004
133700             MOVE 'Y410-CLOSE-STORE-CSR' TO AA-PARAGRAPH-NAME     13370004
133800             MOVE 'UNSUCCESSFUL CLOSE ON STORE_CSR'               13380004
133900                                 TO AA-DB2-OPERATION              13390004
134000             MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                13400004
134100             MOVE 'TRECITM'      TO AA-DB2-TABLE-2                13410004
134200             MOVE 'TRECDIS'      TO AA-DB2-TABLE-3                13420004
134300             MOVE 'TPURITM'      TO AA-DB2-TABLE-4                13430004
134400             MOVE 'TNINREC'      TO AA-DB2-TABLE-5                13440004
134500             PERFORM Z998-DB2-ABEND                               13450004
134600     END-EVALUATE.                                                13460004
134700 EJECT                                                            13470004
134800*----------------------------------------------------------------*13480004
134900*    OPENS THE DC CURSOR                                         *13490004
135000*    CALLED FROM C100-PROCESS-INPUT-POS                          *13500004
135100*----------------------------------------------------------------*13510004
135200 Y500-OPEN-DC-CSR.                                                13520004
135300                                                                  13530004
135400     EXEC SQL                                                     13540004
135500         OPEN DC_CSR                                              13550004
135600     END-EXEC.                                                    13560004
135700                                                                  13570004
135800     EVALUATE TRUE                                                13580004
135900         WHEN SQLCODE = ZERO                                      13590004
136000              CONTINUE                                            13600004
136100                                                                  13610004
136200         WHEN SQLWARN0 NOT = SPACES                               13620004
136300         WHEN SQLCODE  NOT = ZERO                                 13630004
136400             MOVE 'Y500-OPEN-DC-CSR' TO AA-PARAGRAPH-NAME         13640004
136410             MOVE 'UNSUCCESSFUL OPEN ON DC_CSR'                   13641004
136420                                 TO AA-DB2-OPERATION              13642004
136430             MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                13643004
136440             MOVE 'TRECITM'      TO AA-DB2-TABLE-2                13644004
136450             MOVE 'TRECDIS'      TO AA-DB2-TABLE-3                13645004
136460             MOVE 'TPURITM'      TO AA-DB2-TABLE-4                13646004
136470             MOVE 'TNINREC'      TO AA-DB2-TABLE-5                13647004
136480             PERFORM Z998-DB2-ABEND                               13648004
136490     END-EVALUATE.                                                13649004
136491                                                                  13649104
136492                                                                  13649204
136493*----------------------------------------------------------------*13649304
136494*    CLOSES THE DC CURSOR                                        *13649404
136495*    CALLED FROM C100-PROCESS-INPUT-POS                          *13649504
136496*----------------------------------------------------------------*13649604
136497 Y510-CLOSE-DC-CSR.                                               13649704
136498                                                                  13649804
136499     EXEC SQL                                                     13649904
136500         CLOSE DC_CSR                                             13650004
136501     END-EXEC.                                                    13650104
136502                                                                  13650204
136503     EVALUATE TRUE                                                13650304
136504         WHEN SQLCODE = ZERO                                      13650404
136505              CONTINUE                                            13650504
136506                                                                  13650604
136507         WHEN SQLWARN0 NOT = SPACES                               13650704
136508         WHEN SQLCODE  NOT = ZERO                                 13650804
136509             MOVE 'Y510-CLOSE-DC-CSR' TO AA-PARAGRAPH-NAME        13650904
136510             MOVE 'UNSUCCESSFUL CLOSE ON DC_CSR'                  13651004
136511                                 TO AA-DB2-OPERATION              13651104
136512             MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                13651204
136513             MOVE 'TRECITM'      TO AA-DB2-TABLE-2                13651304
136514             MOVE 'TRECDIS'      TO AA-DB2-TABLE-3                13651404
136515             MOVE 'TPURITM'      TO AA-DB2-TABLE-4                13651504
136516             MOVE 'TNINREC'      TO AA-DB2-TABLE-5                13651604
136517             PERFORM Z998-DB2-ABEND                               13651704
136518     END-EVALUATE.                                                13651804
136519 EJECT                                                            13651904
136520*----------------------------------------------------------------*13652004
136521*    ABEND ROUTINE FOR DB2 ERRORS                                *13652104
136522*----------------------------------------------------------------*13652204
136523 Z998-DB2-ABEND.                                                  13652304
136524                                                                  13652404
136525     DISPLAY 'PO BEING PROCESSED = ' PV-PO-BEING-PROCESSED.       13652504
136526     DISPLAY 'STORE BEING PROCESSED = ' PV-STORE-BEING-PROCESSED. 13652604
136527     DISPLAY AA-ABEND-LIT.                                        13652704
136528     DISPLAY AA-DB2-ERROR-LIT.                                    13652804
136529     DISPLAY AA-PROGRAM-LIT.                                      13652904
136530     DISPLAY AA-PARAGRAPH-LIT.                                    13653004
136531     DISPLAY AA-DB2-OPERATION-LIT.                                13653104
136532     DISPLAY AA-DB2-TABLE-1.                                      13653204
136533     DISPLAY AA-DB2-TABLE-2.                                      13653304
136534     DISPLAY AA-DB2-TABLE-3.                                      13653404
136535     DISPLAY AA-DB2-TABLE-4.                                      13653504
136536     SET AC-DB2-ERROR TO TRUE.                                    13653604
136537                                                                  13653704
136538     COPY DPPD004.                                                13653804
136539                                                                  13653904
136540     CALL 'ILBOABN0' USING ABEND-CODE.                            13654004
136550                                                                  13655004
136560 Z999-ABEND.                                                      13656004
136570                                                                  13657004
136580     DISPLAY AA-ABEND-LIT.                                        13658004
136590     DISPLAY AA-PROGRAM-LIT.                                      13659004
136600     DISPLAY AA-PARAGRAPH-LIT.                                    13660004
136700     DISPLAY AA-MESSAGE-LINE.                                     13670004
136800                                                                  13680004
136900     CALL 'ILBOABN0' USING ABEND-CODE.                            13690004
