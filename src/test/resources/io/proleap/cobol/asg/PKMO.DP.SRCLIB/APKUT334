000100 IDENTIFICATION DIVISION.                                         00010002
000200 PROGRAM-ID.     APKUT334.                                        00020060
000300 AUTHOR.         SCOTT KRUSCHKA.                                  00030030
000400 DATE-WRITTEN.   04/08/2008.                                      00040066
000500 DATE-COMPILED.                                                   00050002
000600***************************************************************** 00060002
000700*  COBOL 2 WITH SQL                                             * 00070002
000800*                                                               * 00080002
000900*  WEEKLY MATCH LEVELS EXTRACT.                                 * 00090060
001000*                                                               * 00100002
001100*  CREATE WEEKLY FILE OF MATCH LEVELS THAT INCLUDES VENDOR,     * 00110060
001200*  VENDOR NAME, ENTER DATE, MATCH LEVEL, INVOICE COUNT,         * 00120060
001300*  PO COUNT & TOTAL COST.  THIS FILE IS LATER FTP'D TO THE LAN  * 00130060
001400*  AS A COMMA DELIMITED FILE.                                   * 00140060
001500*                                                               * 00150060
001600***************************************************************** 00160002
001700*---------------------------------------------------------------* 00170002
001800* CHANGE LOG:                                                   * 00180002
001900*                                                               * 00190002
001910* 07/30/2008                                                    * 00191080
001920*   UPDATE DB2 QUERY.  DC'S WERE HARDCODED.  UPDATED TO COMPARE * 00192076
001921*   THE DC AGAINST THE STORE NUMBER.  IF THEY'RE EQUAL, IT'S A  * 00192176
001922*   DC.                                                         * 00192276
001930* MADE BY: SCOTT KRUSCHKA              WR/IR #: WR34276         * 00193080
002000*                                                               * 00200025
001910* 01/15/2018                                                    * 00201084
001920*   ADDED A NEW PO TYPE CODE 'LE' IN THE LEVELS_CSR.            * 00202082
001921* MADE BY: BARB SCHULTZ                WR/IR #: CHG0181356      * 00203083
002000*                                                               * 00206082
002100*---------------------------------------------------------------* 00210002
002200                                                                  00220002
002300 ENVIRONMENT DIVISION.                                            00230002
002400 CONFIGURATION SECTION.                                           00240002
002500 SOURCE-COMPUTER.    IBM-3090.                                    00250002
002600 OBJECT-COMPUTER.    IBM-3090.                                    00260002
002700                                                                  00270002
002800 INPUT-OUTPUT SECTION.                                            00280002
002900 FILE-CONTROL.                                                    00290002
003000     SELECT LEVELS-FILE     ASSIGN TO UT-S-OUT01.                 00300060
003100                                                                  00310002
003200 DATA DIVISION.                                                   00320002
003300 FILE SECTION.                                                    00330002
003400                                                                  00340002
003500 FD  LEVELS-FILE                                                  00350060
003600     RECORDING MODE IS F                                          00360002
003700     LABEL RECORDS ARE STANDARD                                   00370002
003800     DATA RECORD IS LEVELS-REC.                                   00380060
003900                                                                  00390043
004000 01  LEVELS-REC             PIC X(100).                           00400060
004100                                                                  00410043
004200 WORKING-STORAGE SECTION.                                         00420002
004300                                                                  00430002
004400 01  LEVELS-HEADER-REC.                                           00440060
004500     05  LV-HDR-VENDOR          PIC X(09) VALUE "VENDOR ID".      00450060
004600     05  LV-HDR-DELIMIT-01      PIC X(01) VALUE ",".              00460060
004700     05  LV-HDR-VENDOR-NAME     PIC X(11) VALUE "VENDOR NAME".    00470060
004800     05  LV-HDR-DELIMIT-02      PIC X(01) VALUE ",".              00480060
004900     05  LV-HDR-ENTER-DATE      PIC X(10) VALUE "ENTER DATE".     00490060
005000     05  LV-HDR-DELIMIT-03      PIC X(01) VALUE ",".              00500060
005100     05  LV-HDR-MATCH-LEVEL     PIC X(11) VALUE "MATCH LEVEL".    00510060
005200     05  LV-HDR-DELIMIT-04      PIC X(01) VALUE ",".              00520060
005300     05  LV-HDR-INV-COUNT       PIC X(13) VALUE "INVOICE COUNT".  00530060
005400     05  LV-HDR-DELIMIT-05      PIC X(01) VALUE ",".              00540060
005500     05  LV-HDR-PO-COUNT        PIC X(08) VALUE "PO COUNT".       00550060
005600     05  LV-HDR-DELIMIT-06      PIC X(01) VALUE ",".              00560060
005700     05  LV-HDR-NET-COST-AMT    PIC X(10) VALUE "TOTAL COST".     00570067
005800     05  LV-HDR-DELIMIT-07      PIC X(01) VALUE ",".              00580060
005900     05  FILLER                 PIC X(21) VALUE SPACES.           00590066
006000                                                                  00600060
006100 01  LEVELS-DETAIL-REC.                                           00610060
006200     05  LV-DTL-VENDOR          PIC X(09).                        00620060
006300     05  LV-DTL-DELIMIT-01      PIC X(01) VALUE ",".              00630060
006400     05  LV-DTL-VENDOR-NAME     PIC X(30).                        00640060
006500     05  LV-DTL-DELIMIT-02      PIC X(01) VALUE ",".              00650060
006600     05  LV-DTL-DATE            PIC X(10).                        00660060
006700     05  LV-DTL-DELIMIT-03      PIC X(01) VALUE ",".              00670060
006800     05  LV-DTL-LEVEL           PIC X(05).                        00680060
006900     05  LV-DTL-DELIMIT-04      PIC X(01) VALUE ",".              00690067
007000     05  LV-DTL-INV-COUNT       PIC ---------9.                   00700060
007100     05  LV-DTL-DELIMIT-05      PIC X(01) VALUE ",".              00710060
007200     05  LV-DTL-PO-COUNT        PIC ---------9.                   00720060
007300     05  LV-DTL-DELIMIT-06      PIC X(01) VALUE ",".              00730060
007400     05  LV-DTL-NET-COST-AMT    PIC ---------9.99.                00740060
007500     05  LV-DTL-DELIMIT-07      PIC X(01) VALUE ",".              00750060
007600     05  FILLER                 PIC X(06).                        00760060
007700                                                                  00770043
007800 01  PV-PROGRAM-VARIABLES.                                        00780002
007900     05  FILLER                  PIC  X(31)  VALUE                00790033
008000         '** BEGINNING OF APKUT334 W/S **'.                       00800060
008100     05  PV-PROGRAM-NAME         PIC  X(08)  VALUE 'APKUT334'.    00810060
008200     05  PV-START-DATE           PIC  X(10)  VALUE SPACES.        00820049
008300     05  PV-END-DATE             PIC  X(10)  VALUE SPACES.        00830049
008400     05  PV-STORE                PIC  X(05)  VALUE SPACES.        00840049
008500     05  PV-INV-COUNT            PIC  S9(09)    COMP   VALUE 0.   00850065
008600     05  PV-PO-COUNT             PIC  S9(09)    COMP   VALUE 0.   00860065
008700     05  PV-UNIT-COST-AMT        PIC  S9(9)V999 COMP-3 VALUE 0.   00870035
008800                                                                  00880022
008900 01  PC-COUNTERS.                                                 00890033
009000     05  PC-COUNT-LEVELS-READ    PIC  9(07)  VALUE ZEROS.         00900061
009100     05  PC-COUNT-LEVELS-WRITTEN PIC  9(07)  VALUE ZEROS.         00910061
009200                                                                  00920022
009300 01  PS-PROGRAM-SWITCHES.                                         00930022
009400     05  PS-END-OF-LEVELS-SW     PIC X(01)    VALUE 'N'.          00940060
009500         88  MORE-LEVELS-CSR                  VALUE 'N'.          00950060
009600         88  END-OF-LEVELS-CSR                VALUE 'Y'.          00960060
009700                                                                  00970022
009800*----------------------------------------------------------------*00980022
009900*  COMMUNICATIONS AREA2 FOR DB2                                  *00990022
010000*----------------------------------------------------------------*01000022
010100     COPY SQLCA2.                                                 01010022
010200                                                                  01020022
010300     EXEC SQL                                                     01030022
010400          INCLUDE SQLCA                                           01040022
010500     END-EXEC.                                                    01050022
010600                                                                  01060022
010700*----------------------------------------------------------------*01070022
010800*  AP CONTROL TABLE                                              *01080022
010900*----------------------------------------------------------------*01090022
011000     EXEC SQL                                                     01100022
011100          INCLUDE TAPCNTL                                         01110022
011200     END-EXEC.                                                    01120022
011300                                                                  01130022
011400*----------------------------------------------------------------*01140022
011500*  INVOICE TABLE                                                 *01150049
011600*----------------------------------------------------------------*01160022
011700     EXEC SQL                                                     01170022
011800          INCLUDE TINVOIC                                         01180049
011900     END-EXEC.                                                    01190022
012000                                                                  01200022
012100*----------------------------------------------------------------*01210063
012200* EXTERNAL ENTERPRISE NAME TABLE                                 *01220063
012300*----------------------------------------------------------------*01230063
012400     EXEC SQL                                                     01240063
012500          INCLUDE TENTNME                                         01250063
012600     END-EXEC.                                                    01260063
012700                                                                  01270063
012800*----------------------------------------------------------------*01280063
012900* EXTERNAL ENTERPRISE TABLE                                      *01290063
013000*----------------------------------------------------------------*01300063
013100     EXEC SQL                                                     01310063
013200          INCLUDE TEXTENT                                         01320063
013300     END-EXEC.                                                    01330063
013400                                                                  01340063
013500*----------------------------------------------------------------*01350030
013600*  PURCHASE ORDER HEADER TABLE                                   *01360030
013700*----------------------------------------------------------------*01370030
013800     EXEC SQL                                                     01380030
013900          INCLUDE TPURCHS                                         01390030
014000     END-EXEC.                                                    01400030
014100                                                                  01410030
014200*----------------------------------------------------------------*01420022
014300*   LEVELS CSR - WEEKLY EXTRACT OF MATCH LEVELS                  *01430063
014400*----------------------------------------------------------------*01440022
017501     EXEC SQL                                                     01750169
017502       DECLARE LEVELS_CSR CURSOR FOR                              01750270
017503         SELECT VENDOR                                            01750370
017504              , NAME                                              01750470
017505              , DATE                                              01750570
017506              , LEVEL                                             01750670
017507              , COUNT(*)                                          01750770
017508              , COUNT(DISTINCT PO)                                01750870
017509              , SUM(COST)                                         01750970
017510           FROM                                                   01751070
017511             (SELECT RMIT_VND_ID AS VENDOR                        01751170
017512                   , ENT_NAME_DESC AS NAME                        01751270
017513                   , (CASE STR_NBR                                01751370
017514                        WHEN 0 THEN 'BULK'                        01751470
017515                        WHEN DC_NBR THEN 'DC'                     01751577
017526                        ELSE 'STORE'                              01752670
017527                        END) AS LEVEL                             01752770
017528                   , INVC_NET_COST_AMT AS COST                    01752870
017529                   , CRE_DTE AS DATE                              01752970
017530                   , PO_NBR  AS PO                                01753070
017531                FROM                                              01753170
017532                     TINVOIC I                                    01753270
017533                   , TENTNME N                                    01753370
017534                   , TEXTENT E                                    01753470
017535               WHERE RMIT_VND_ID ^= '009206194'                   01753570
017536                 AND INVC_TYP_CDE  = 'MI'                         01753670
017538                 AND CRE_DTE BETWEEN :PV-START-DATE               01753870
017539                                 AND :PV-END-DATE                 01753970
017540                 AND I.ENTR_MTHD_CDE = 'ED'                       01754070
017541                 AND I.RMIT_VND_ID = E.DUN_NBR                    01754170
017542                 AND E.ENT_ID      = N.ENT_ID                     01754270
017543                 AND N.TYPE_CDE    = '01'                         01754370
017544                 AND NOT EXISTS                                   01754470
017545                   (SELECT 1 FROM TPURCHS P                       01754572
017546                      WHERE P.PO_NBR = I.PO_NBR                   01754670
017547                       AND (P.PO_TYP_CDE IN ('LD','IM','IE','IF', 01754781
017547                                                            'LE') 01754881
017548                            OR P.DIR_STR_IND = 'Y'))              01754981
017549             ) AS VT                                              01755081
017550         GROUP BY VENDOR , NAME, LEVEL, DATE                      01755181
017560     END-EXEC.                                                    01756069
017600                                                                  01760042
017700*----------------------------------------------------------------*01770022
017800*  ABEND DATA AREAS                                              *01780022
017900*----------------------------------------------------------------*01790022
018000 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          01800022
018100                                             COMP SYNC.           01810022
018200     88  AC-BAD-DATA                         VALUE +4003.         01820022
018300     88  AC-DB2-ERROR                        VALUE +4013.         01830022
018400                                                                  01840022
018500 01  ABEND-AREAS.                                                 01850022
018600     05  AA-ABEND-LIT            PIC  X(40)  VALUE                01860022
018700             '*****       ABEND'.                                 01870022
018800     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                01880022
018900             '*****   PROGRAM: APKUT334'.                         01890063
019000     05  AA-PARAGRAPH-LIT.                                        01900022
019100         10  FILLER              PIC  X(17)  VALUE                01910022
019200             '***** PARAGRAPH: '.                                 01920022
019300         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        01930022
019400     05  AA-MESSAGE-LINE.                                         01940022
019500         10  FILLER              PIC  X(06)  VALUE '*****'.       01950022
019600         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        01960022
019700     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                01970022
019800             '*****    DB2 ERROR'.                                01980022
019900     05  AA-DB2-OPERATION-LIT.                                    01990022
020000         10  FILLER              PIC  X(17)  VALUE                02000022
020100             '***** OPERATION: '.                                 02010022
020200         10  AA-DB2-OPERATION.                                    02020022
020300             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        02030022
020400             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        02040022
020500     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        02050022
020600     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        02060022
020700     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        02070022
020800     05  AA-DB2-TABLE-4          PIC  X(08)  VALUE SPACES.        02080032
020900                                                                  02090022
021000     COPY DPWS004.                                                02100022
021100 01  FILLER                      PIC  X(25)  VALUE                02110022
021200     '** END OF APKUT334 W/S **'.                                 02120063
021300                                                                  02130022
021400 PROCEDURE DIVISION.                                              02140022
021500                                                                  02150042
021600 A100-MAIN.                                                       02160022
021700     PERFORM B100-INITIALIZATION.                                 02170022
021800                                                                  02180022
021900     PERFORM B200-PROCESS-LEVELS                                  02190060
022000       UNTIL END-OF-LEVELS-CSR.                                   02200060
022100                                                                  02210022
022200     PERFORM B300-END-PROGRAM.                                    02220022
022300                                                                  02230022
022400     GOBACK.                                                      02240022
022500                                                                  02250022
022600 B100-INITIALIZATION.                                             02260022
022700*----------------------------------------------------------------*02270022
022800*    OPEN OUTPUT FILE AND PERFORM INITIALIZATION.                *02280022
022900*----------------------------------------------------------------*02290022
023000     OPEN OUTPUT LEVELS-FILE.                                     02300060
023100                                                                  02310022
023200     INITIALIZE DCLTINVOIC                                        02320049
023300                DCLTENTNME                                        02330066
023310                DCLTEXTENT                                        02331066
023320                DCLTPURCHS                                        02332066
023400                LEVELS-REC.                                       02340060
023500                                                                  02350022
023600     PERFORM S100-GET-DATES.                                      02360022
023700                                                                  02370023
023800** THIS INITIAL WRITE PUTS A RECORD OF HEADINGS AS THE FIRST      02380063
023900** RECORD ON THE FILE.                                            02390063
024000                                                                  02400063
024100     MOVE LEVELS-HEADER-REC TO LEVELS-REC.                        02410063
024200     PERFORM W100-WRITE-LEVELS-REC.                               02420063
024300                                                                  02430063
024400     PERFORM Y100-OPEN-LEVELS-CSR.                                02440060
024500                                                                  02450022
024600     PERFORM R100-FETCH-LEVELS.                                   02460060
024700     IF END-OF-LEVELS-CSR                                         02470060
024800         DISPLAY '***  APKUT334  ***'                             02480063
024900         DISPLAY 'FIRST FETCH OF LEVELS CURSOR'                   02490060
025000         DISPLAY 'NOTHING FOUND'                                  02500049
025100         DISPLAY ' '                                              02510022
025200     END-IF.                                                      02520022
025300                                                                  02530022
025400 B200-PROCESS-LEVELS.                                             02540060
025500*----------------------------------------------------------------*02550022
025600*    CREATING OUTPUT FILE BY MOVING FIELDS FETCHED INTO THEIR    *02560022
025700*    CORRESPONDING FIELDS.                                       *02570049
025800*----------------------------------------------------------------*02580022
025900     INITIALIZE LEVELS-REC.                                       02590060
026000                                                                  02600022
026100     MOVE INVOIC-RMIT-VND-ID       TO LV-DTL-VENDOR.              02610068
026110     INSPECT ENTNME-ENT-NAME-DESC REPLACING ALL ',' BY ' '.       02611073
026200     MOVE ENTNME-ENT-NAME-DESC     TO LV-DTL-VENDOR-NAME.         02620067
026300     MOVE INVOIC-CRE-DTE           TO LV-DTL-DATE.                02630067
026310     MOVE PV-STORE                 TO LV-DTL-LEVEL.               02631069
027400     MOVE PV-INV-COUNT             TO LV-DTL-INV-COUNT.           02740065
027500     MOVE PV-PO-COUNT              TO LV-DTL-PO-COUNT.            02750065
027600     MOVE INVOIC-INVC-NET-COST-AMT TO LV-DTL-NET-COST-AMT.        02760065
027700     MOVE LEVELS-DETAIL-REC        TO LEVELS-REC.                 02770060
027800                                                                  02780022
027900     PERFORM W100-WRITE-LEVELS-REC.                               02790060
028000                                                                  02800022
028100     PERFORM R100-FETCH-LEVELS.                                   02810060
028200                                                                  02820022
028300 B300-END-PROGRAM.                                                02830022
028400*----------------------------------------------------------------*02840022
028500*    ENDING PROCESSING: DISPLAYS COUNTS, AND CLOSES FILES.       *02850022
028600*----------------------------------------------------------------*02860022
028700     CLOSE LEVELS-FILE.                                           02870060
028800                                                                  02880022
028900     DISPLAY '       '.                                           02890066
029000     DISPLAY '**********************************'.                02900066
029100     DISPLAY '******** APKUT334 SUMMARY ********'.                02910065
029200     DISPLAY 'START DATE = ' PV-START-DATE.                       02920066
029300     DISPLAY 'END DATE   = ' PV-END-DATE.                         02930066
029400     DISPLAY 'LEVELS FETCHED = ' PC-COUNT-LEVELS-READ.            02940060
029500     DISPLAY 'TOTAL RECORDS WRITTEN  = ' PC-COUNT-LEVELS-WRITTEN. 02950060
029600     DISPLAY '**********************************'.                02960066
029700     DISPLAY '       '.                                           02970066
029800                                                                  02980026
029900     PERFORM Y200-CLOSE-LEVELS-CSR.                               02990060
030000                                                                  03000026
030100 R100-FETCH-LEVELS.                                               03010060
030200*----------------------------------------------------------------*03020026
030300*  RETRIEVES THE LEVELS_CSR DATA                                 *03030060
030400*----------------------------------------------------------------*03040026
030500     EXEC SQL                                                     03050042
030600         FETCH   LEVELS_CSR                                       03060060
030700          INTO  :INVOIC-RMIT-VND-ID                               03070065
030800               ,:ENTNME-ENT-NAME-DESC                             03080065
030900               ,:INVOIC-CRE-DTE                                   03090065
031000               ,:PV-STORE                                         03100071
031100               ,:PV-INV-COUNT                                     03110065
031200               ,:PV-PO-COUNT                                      03120065
031300               ,:INVOIC-INVC-NET-COST-AMT                         03130065
031400     END-EXEC.                                                    03140042
031500                                                                  03150041
031600     EVALUATE TRUE                                                03160026
031700         WHEN SQLCODE = ZERO                                      03170026
031800             ADD 1 TO PC-COUNT-LEVELS-READ                        03180060
031900         WHEN SQLCODE = +100                                      03190026
032000             SET END-OF-LEVELS-CSR TO TRUE                        03200060
032100                                                                  03210026
032200         WHEN SQLWARN0 NOT = SPACES                               03220026
032300         WHEN SQLCODE  NOT = ZERO                                 03230026
032400             MOVE 'R100-FETCH-LEVELS'                             03240060
032500                                        TO AA-PARAGRAPH-NAME      03250026
032600             MOVE 'UNSUCCESSFUL FETCH WITH LEVELS_CSR'            03260060
032700                                        TO AA-DB2-OPERATION       03270026
032800             MOVE 'TINVOIC'             TO AA-DB2-TABLE-1         03280049
032900             MOVE 'TENTNME'             TO AA-DB2-TABLE-2         03290065
033000             MOVE 'TEXTENT'             TO AA-DB2-TABLE-3         03300065
033100             MOVE 'TPURCHS'             TO AA-DB2-TABLE-4         03310065
033200             PERFORM Z998-DB2-ABEND                               03320026
033300     END-EVALUATE.                                                03330026
033400                                                                  03340026
033500 S100-GET-DATES.                                                  03350026
033600*----------------------------------------------------------------*03360026
033700*    SELECT THE BEGINNING AND ENDING DATES BY USING              *03370036
033800*    PREV_WK_END_DTE.  THIS PROGRAM RUNS AFTER IT'S UPDATED      *03380049
033900*    BY APKUP076 IN JOB APK200.                                  *03390036
034000*    THE EXTRACT DATES SHOULD BE FOR MONDAY THRU SUNDAY.         *03400049
034100*----------------------------------------------------------------*03410026
034200                                                                  03420026
034300         EXEC SQL                                                 03430026
034400             SELECT  (PREV_WK_END_DTE - 5 DAYS)                   03440049
034500                    ,(PREV_WK_END_DTE + 1 DAY)                    03450049
034600               INTO  :PV-START-DATE                               03460026
034700                    ,:PV-END-DATE                                 03470026
034800               FROM  TAPCNTL                                      03480026
034900         END-EXEC.                                                03490026
035000                                                                  03500026
035100         EVALUATE TRUE                                            03510026
035200           WHEN SQLCODE = ZERO                                    03520026
035300             CONTINUE                                             03530026
035400           WHEN SQLWARN0 NOT = SPACES                             03540026
035500           WHEN SQLCODE NOT  = ZERO                               03550026
035600             MOVE 'S100-GET-DATES'                                03560026
035700                                 TO AA-PARAGRAPH-NAME             03570026
035800             MOVE 'UNSUCCESSFUL SELECT'                           03580026
035900                                 TO AA-DB2-OPERATION              03590026
036000             MOVE 'TAPCNTL'      TO AA-DB2-TABLE-1                03600026
036100             MOVE SPACES         TO AA-DB2-TABLE-2                03610026
036200                                    AA-DB2-TABLE-3                03620026
036300                                    AA-DB2-TABLE-4                03630032
036400             PERFORM Z998-DB2-ABEND                               03640026
036500         END-EVALUATE.                                            03650026
036600                                                                  03660026
036700 W100-WRITE-LEVELS-REC.                                           03670060
036800*----------------------------------------------------------------*03680026
036900*    WRITE THE RECORDS TO THE FILE                               *03690049
037000*----------------------------------------------------------------*03700026
037100                                                                  03710026
037200     WRITE LEVELS-REC.                                            03720060
037300                                                                  03730026
037400     ADD 1 TO PC-COUNT-LEVELS-WRITTEN.                            03740060
037500                                                                  03750026
037600 Y100-OPEN-LEVELS-CSR.                                            03760060
037700*---------------------------------------------------------------- 03770026
037800*    OPEN LEVELS_CSR CURSOR.                                      03780060
037900*---------------------------------------------------------------- 03790026
038000                                                                  03800026
038100     EXEC SQL                                                     03810026
038200         OPEN LEVELS_CSR                                          03820060
038300     END-EXEC.                                                    03830026
038400                                                                  03840026
038500     EVALUATE TRUE                                                03850026
038600         WHEN SQLCODE = ZERO                                      03860026
038700             CONTINUE                                             03870026
038800         WHEN SQLWARN0 NOT = SPACES                               03880026
038900         WHEN SQLCODE  NOT = ZERO                                 03890026
039000             MOVE 'Y100-OPEN-LEVELS-CSR'                          03900060
039100                                 TO AA-PARAGRAPH-NAME             03910026
039200             MOVE 'UNSUCCESSFUL OPEN ON LEVELS_CSR'               03920060
039300                                 TO AA-DB2-OPERATION              03930026
039400             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                03940049
039500             MOVE 'TENTNME'      TO AA-DB2-TABLE-2                03950065
039600             MOVE 'TEXTENT'      TO AA-DB2-TABLE-3                03960065
039700             MOVE 'TPURCHS'      TO AA-DB2-TABLE-4                03970065
039800             MOVE SPACES         TO AA-MESSAGE                    03980026
039900             PERFORM Z998-DB2-ABEND                               03990026
040000     END-EVALUATE.                                                04000026
040100                                                                  04010026
040200 Y200-CLOSE-LEVELS-CSR.                                           04020060
040300*---------------------------------------------------------------- 04030026
040400*    CLOSE THE LEVELS_CSR CURSOR.                               * 04040060
040500*---------------------------------------------------------------- 04050026
040600                                                                  04060026
040700     EXEC SQL                                                     04070026
040800         CLOSE LEVELS_CSR                                         04080060
040900     END-EXEC.                                                    04090026
041000                                                                  04100026
041100     EVALUATE TRUE                                                04110026
041200         WHEN SQLCODE = ZERO                                      04120026
041300              CONTINUE                                            04130026
041400                                                                  04140026
041500         WHEN SQLWARN0 NOT = SPACES                               04150026
041600         WHEN SQLCODE  NOT = ZERO                                 04160026
041700             MOVE 'Y200-CLOSE-LEVELS-CSR'                         04170060
041800                                 TO AA-PARAGRAPH-NAME             04180026
041900             MOVE 'UNSUCCESSFUL CLOSE ON LEVELS_CSR'              04190060
042000                                 TO AA-DB2-OPERATION              04200026
042100             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                04210049
042200             MOVE 'TENTNME'      TO AA-DB2-TABLE-2                04220065
042300             MOVE 'TEXTENT'      TO AA-DB2-TABLE-3                04230065
042400             MOVE 'TPURCHS'      TO AA-DB2-TABLE-4                04240065
042500             MOVE SPACES         TO AA-MESSAGE                    04250026
042600             PERFORM Z998-DB2-ABEND                               04260026
042700     END-EVALUATE.                                                04270026
042800                                                                  04280026
042900 Z998-DB2-ABEND.                                                  04290026
043000*----------------------------------------------------------------*04300026
043100*    ABEND ROUTINE FOR DB2 ERRORS                                *04310026
043200*----------------------------------------------------------------*04320026
043300     CLOSE LEVELS-FILE.                                           04330060
043400                                                                  04340026
043500     DISPLAY AA-ABEND-LIT.                                        04350026
043600     DISPLAY AA-DB2-ERROR-LIT.                                    04360026
043700     DISPLAY AA-PROGRAM-LIT.                                      04370026
043800     DISPLAY AA-PARAGRAPH-LIT.                                    04380026
043900     DISPLAY AA-DB2-OPERATION-LIT.                                04390026
044000     DISPLAY AA-DB2-TABLE-1.                                      04400026
044100     DISPLAY AA-DB2-TABLE-2.                                      04410026
044200     DISPLAY AA-DB2-TABLE-3.                                      04420026
044300     DISPLAY AA-DB2-TABLE-4.                                      04430032
044400     SET AC-DB2-ERROR TO TRUE.                                    04440026
044500                                                                  04450026
044600     COPY DPPD004.                                                04460026
044700                                                                  04470026
044800     CALL 'ILBOABN0' USING ABEND-CODE.                            04480026
044900                                                                  04490026
