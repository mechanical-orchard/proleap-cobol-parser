000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.    RCKUT057.                                         00020001
000300 AUTHOR.        DENISE HAHN.                                      00030001
000310 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00031001
000400 DATE-WRITTEN.  3/10/98.                                          00040001
000500****************************************************************  00050001
000600*  THIS PROGRAM WILL READ THE RECEIPTS EXTRACT FILE CREATED BY *  00060001
000610*  RCKUT056, AND CREATE A NEW EXTRACT BASED ON INFORMATION IN  *  00061001
000620*  THE CONTROL CARD.                                           *  00062001
000630*  CONTROL CARD WILL CONTAIN DATE/TYPE CODE FOR EXTRACT        *  00063001
000631*  VALID DATE CODES ARE: AR=USE ARRIVED DATE                   *  00063101
000632*                        VE=USE VERIFIED DATE                  *  00063201
000640*  VALID TYPE CODES ARE:  P=USE PERIOD NUMBER                  *  00064001
000650*                         Q=USE QUARTER NUMBER                 *  00065001
000700****************************************************************  00070001
000800 ENVIRONMENT DIVISION.                                            00080001
000900 INPUT-OUTPUT SECTION.                                            00090001
001000                                                                  00100001
001100 FILE-CONTROL.                                                    00110001
001110                                                                  00111001
001200     SELECT DATE-FILE          ASSIGN TO UT-S-IN01.               00120001
001210     SELECT EXTRACT-FILE       ASSIGN TO UT-S-IN02.               00121001
001220     SELECT NEW-EXTRACT-FILE   ASSIGN TO UT-S-OUT01.              00122001
001300                                                                  00130001
001400 DATA DIVISION.                                                   00140001
001500                                                                  00150001
001600 FILE SECTION.                                                    00160001
001700*                                                                 00170001
001800 FD  DATE-FILE                                                    00180001
001900     RECORDING MODE IS F                                          00190001
002000     LABEL RECORDS ARE STANDARD                                   00200001
002100     RECORD CONTAINS 80                                           00210001
002200     BLOCK CONTAINS 0 RECORDS                                     00220001
002300     DATA RECORD IS DATE-RECORD.                                  00230001
002400 01  DATE-RECORD                 PIC X(80).                       00240001
002500*                                                                 00250001
002520 FD  EXTRACT-FILE                                                 00252001
002530     RECORDING MODE IS F                                          00253001
002540     LABEL RECORDS ARE STANDARD                                   00254001
002550     RECORD CONTAINS 250                                          00255001
002560     BLOCK CONTAINS 0 RECORDS                                     00256001
002570     DATA RECORD IS EXTRACT-RECORD.                               00257001
002580 01  EXTRACT-RECORD              PIC X(250).                      00258001
002590*                                                                 00259001
002591 FD  NEW-EXTRACT-FILE                                             00259101
002592     RECORDING MODE IS F                                          00259201
002593     LABEL RECORDS ARE STANDARD                                   00259301
002594     RECORD CONTAINS 250                                          00259401
002595     BLOCK CONTAINS 0 RECORDS                                     00259501
002596     DATA RECORD IS NEW-EXTRACT-RECORD.                           00259601
002597 01  NEW-EXTRACT-RECORD          PIC X(250).                      00259701
002600*                                                                 00260001
002700/                                                                 00270001
002800 WORKING-STORAGE SECTION.                                         00280001
002900                                                                  00290001
002912 01 CC-CONTROL-CARD-PARAMETERS.                                   00291201
002913    05 CC-EXTRACT-DATE                PIC X(02) VALUE SPACES.     00291301
002914       88  CC-VALID-DATE                        VALUE 'AR' 'VE'.  00291401
002915       88  CC-ARRIVED-DATE-EXTRACT              VALUE 'AR'.       00291501
002916       88  CC-VERIFYD-DATE-EXTRACT              VALUE 'VE'.       00291601
002917    05 FILLER                         PIC X(01) VALUE SPACE.      00291701
002918    05 CC-EXTRACT-TYPE                PIC X(01) VALUE SPACE.      00291801
002919       88  CC-VALID-TYPE                        VALUE 'P' 'Q'.    00291901
002920       88  CC-PERIOD-NUMBER                     VALUE 'P'.        00292001
002921       88  CC-QUARTER-NUMBER                    VALUE 'Q'.        00292101
002922    05 FILLER                         PIC X(76) VALUE SPACE.      00292201
002923                                                                  00292301
002924 01  PS-PROGRAM-SWITCHES.                                         00292401
002925     05  PS-EXTRACT-SW                PIC X(01)  VALUE 'N'.       00292501
002926         88  PS-EOF-EXTRACT                      VALUE 'Y'.       00292601
002927                                                                  00292701
002928 01  PV-DATE-RECORD.                                              00292801
002929     05  PV-DATE-START                PIC X(10) VALUE SPACE.      00292901
002930     05  FILLER                       PIC X(01) VALUE SPACE.      00293001
002931     05  PV-DATE-END                  PIC X(10) VALUE SPACE.      00293101
002932     05  FILLER                       PIC X(01) VALUE SPACE.      00293201
002933     05  PV-DATE-FISCAL-PERIOD        PIC 9(02) VALUE ZEROES.     00293301
002934     05  FILLER                       PIC X(01) VALUE SPACE.      00293401
002935     05  PV-DATE-FISCAL-QUARTER       PIC 9(01) VALUE ZERO.       00293501
002936     05  FILLER                       PIC X(54)  VALUE SPACES.    00293601
002937                                                                  00293701
002938 01  PV-PROGRAM-VARIABLES.                                        00293801
002939     05  PV-EXTRACT-READ              PIC  9(09) VALUE ZEROES.    00293901
002940     05  PV-EXTRACT-BYPASSED          PIC  9(09) VALUE ZEROES.    00294001
002941     05  PV-EXTRACT-WRITTEN           PIC  9(09) VALUE ZEROES.    00294101
002942     05  PV-DISPLAY-COUNT             PIC ZZZ,ZZZ,ZZ9.            00294201
002943                                                                  00294301
002950 01  PV-ABEND-CODE                    PIC S9(04)   VALUE +0       00295001
002951                                                   COMP SYNC.     00295101
002952                                                                  00295201
002953 01  PV-ABEND-FIELDS.                                             00295301
002954     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'RCKUT057'.00295401
002955     05  PV-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    00295506
002956     05  PV-ABEND-MESSAGE-1           PIC X(60)  VALUE SPACES.    00295606
002957     05  PV-ABEND-MESSAGE-2           PIC X(60)  VALUE SPACES.    00295706
002958                                                                  00295806
022500*                                                                 02250001
031020***********************************************************       03102001
031030*  COPYBOOK USED IN CREATING EXTRACT FILE.                *       03103001
031040***********************************************************       03104001
031050     COPY RCRD035.                                                03105009
031060*                                                                 03106001
031100/                                                                 03110001
031200 PROCEDURE DIVISION.                                              03120001
031300                                                                  03130001
031400     PERFORM 1000-INITIALIZATION.                                 03140001
031500                                                                  03150001
031600     PERFORM 2000-PROCESS-EXTRACTS                                03160001
031700         UNTIL PS-EOF-EXTRACT.                                    03170001
031800                                                                  03180001
032100     CLOSE DATE-FILE                                              03210001
032110           EXTRACT-FILE                                           03211001
032120           NEW-EXTRACT-FILE.                                      03212001
032200                                                                  03220001
032300     MOVE PV-EXTRACT-READ  TO PV-DISPLAY-COUNT                    03230001
032400     DISPLAY 'NUMBER OF EXTRACT RECORDS READ     '                03240001
032500                                  PV-DISPLAY-COUNT.               03250001
032501     MOVE PV-EXTRACT-BYPASSED TO PV-DISPLAY-COUNT                 03250101
032502     DISPLAY 'NUMBER OF EXTRACT RECORDS BYPASSED '                03250201
032503                                  PV-DISPLAY-COUNT.               03250301
032510     MOVE PV-EXTRACT-WRITTEN TO PV-DISPLAY-COUNT                  03251001
032530     DISPLAY 'NUMBER OF EXTRACT RECORDS WRITTEN  '                03253001
032540                                  PV-DISPLAY-COUNT.               03254001
032541     DISPLAY '                                      '.            03254108
032550     DISPLAY '--------------------------------------'.            03255008
032600                                                                  03260001
032700     GOBACK.                                                      03270001
032800                                                                  03280001
032801/                                                                 03280101
032802 1000-INITIALIZATION.                                             03280201
032803                                                                  03280301
032804     OPEN INPUT  DATE-FILE                                        03280401
032805                 EXTRACT-FILE                                     03280502
032806          OUTPUT NEW-EXTRACT-FILE.                                03280601
034101                                                                  03410101
034102     ACCEPT CC-CONTROL-CARD-PARAMETERS FROM SYSIN.                03410201
034103                                                                  03410301
034104     DISPLAY '--------------------------------------'.            03410408
034105     DISPLAY '-        PROGRAM - RCKUT057          -'.            03410508
034106     DISPLAY '--------------------------------------'.            03410608
034107     DISPLAY '                                      '.            03410708
034108                                                                  03410808
034109                                                                  03410908
034110     DISPLAY 'CONTROL CARD SET-UP FOR THIS RUN IS:  '             03411008
034111             CC-CONTROL-CARD-PARAMETERS.                          03411108
034112                                                                  03411208
034113     PERFORM 1100-CHECK-CC-PARAMETERS.                            03411308
034114     PERFORM 7000-READ-DATE.                                      03411408
034115     PERFORM 7100-READ-EXTRACT.                                   03411508
034116                                                                  03411608
034117 1100-CHECK-CC-PARAMETERS.                                        03411708
034118                                                                  03411808
034119*-------------------------------------------------------------    03411908
034120* CHECK THAT A VALID DATE HAS BEEN REQUESTED ('AR' OR 'VE')       03412008
034121*-------------------------------------------------------------    03412108
034122                                                                  03412208
034123     MOVE '1100-CHECK-CC-PARAMETERS'   TO PV-ABEND-PARAGRAPH.     03412308
034124                                                                  03412408
034125     IF NOT CC-VALID-DATE                                         03412508
034126        DISPLAY '***************************'                     03412608
034127        DISPLAY 'PROGRAM:  :         ' PV-ABEND-PROGRAM           03412708
034128        DISPLAY 'PARAGRAPH :         ' PV-ABEND-PARAGRAPH         03412808
034129        DISPLAY 'CONTROL PARAMETERS: ' CC-CONTROL-CARD-PARAMETERS 03412908
034130        DISPLAY 'DATE INDICATOR "' CC-EXTRACT-DATE '" ID INVALID' 03413008
034131        DISPLAY 'RUN ABORTED'                                     03413108
034132        DISPLAY '***************************'                     03413208
034133        MOVE 4003  TO PV-ABEND-CODE                               03413308
034134        DISPLAY 'PV-ABEND-CODE = ' PV-ABEND-CODE                  03413408
034135        CALL 'ILBOABN0'   USING PV-ABEND-CODE                     03413508
034136     END-IF.                                                      03413608
034137                                                                  03413708
034138*-------------------------------------------------------------    03413808
034139* CHECK THAT A VALID TYPE HAS BEEN REQUESTED ('P' OR 'Q')         03413908
034140*-------------------------------------------------------------    03414008
034141                                                                  03414108
034142     IF NOT CC-VALID-TYPE                                         03414208
034143        DISPLAY '***************************'                     03414308
034144        DISPLAY 'PROGRAM:  :         ' PV-ABEND-PROGRAM           03414408
034145        DISPLAY 'PARAGRAPH :         ' PV-ABEND-PARAGRAPH         03414508
034146        DISPLAY 'CONTROL PARAMETERS: ' CC-CONTROL-CARD-PARAMETERS 03414608
034147        DISPLAY 'TYPE INDICATOR "' CC-EXTRACT-TYPE '" IS INVALID' 03414708
034148        DISPLAY 'RUN ABORTED'                                     03414808
034149        DISPLAY '***************************'                     03414908
034150        MOVE 4003  TO PV-ABEND-CODE                               03415008
034151        DISPLAY 'PV-ABEND-CODE = ' PV-ABEND-CODE                  03415108
034152        CALL 'ILBOABN0'   USING PV-ABEND-CODE                     03415208
034153     END-IF.                                                      03415308
042214                                                                  04221401
042215 2000-PROCESS-EXTRACTS.                                           04221501
042216                                                                  04221601
042218     MOVE '2000-PROCESS-EXTRACTS'   TO PV-ABEND-PARAGRAPH.        04221804
042219                                                                  04221904
042220*-----------------------------------------------------------------04222001
042221* EXTRACT RECORDS BASED ON CONTROL CARD.                          04222101
042222*    -  IF CONTROL CARD INDICATES ARRIVED-DATE & PERIOD           04222201
042223*    -     AND  EXTRACT-ARRIVE-PERIOD = DATE FILE PERIOD          04222301
042224*    -          WRITE NEW EXTRACT                                 04222401
042225*    -  IF CONTROL CARD INDICATES ARRIVED-DATE & QUARTER          04222501
042226*    -     AND  EXTRACT-ARRIVE-QUARTER = DATE FILE QUARTER        04222601
042227*    -          WRITE NEW EXTRACT                                 04222701
042228*    -  IF CONTROL CARD INDICATES VERIFIED-DATE & PERIOD          04222801
042229*    -     AND  EXTRACT-VERIFIED-PERIOD = DATE FILE PERIOD        04222901
042230*    -          WRITE NEW EXTRACT                                 04223001
042231*    -  IF CONTROL CARD INDICATES VERIFIED-DATE & QUARTER         04223101
042232*    -     AND  EXTRACT-VERIFIED-QUARTER = DATE FILE QUARTER      04223201
042233*    -          WRITE NEW EXTRACT                                 04223301
042234*-----------------------------------------------------------------04223401
042235                                                                  04223501
042236     ADD  1  TO  PV-EXTRACT-READ.                                 04223601
042237                                                                  04223701
042238     IF  CC-ARRIVED-DATE-EXTRACT  AND                             04223801
042239         CC-PERIOD-NUMBER         AND                             04223901
042240         RC035-ARRIVE-PERIOD-NBR   =  PV-DATE-FISCAL-PERIOD       04224001
042241         PERFORM 8000-WRITE-EXTRACT                               04224101
042242     ELSE                                                         04224201
042243     IF  CC-ARRIVED-DATE-EXTRACT  AND                             04224301
042244         CC-QUARTER-NUMBER        AND                             04224401
042245         RC035-ARRIVE-QTR-NBR      =  PV-DATE-FISCAL-QUARTER      04224501
042246         PERFORM 8000-WRITE-EXTRACT                               04224601
042247     ELSE                                                         04224701
042248     IF  CC-VERIFYD-DATE-EXTRACT  AND                             04224801
042249         CC-PERIOD-NUMBER         AND                             04224901
042250         RC035-VRFYD-PERIOD-NBR    =  PV-DATE-FISCAL-PERIOD       04225001
042251         PERFORM 8000-WRITE-EXTRACT                               04225101
042252     ELSE                                                         04225201
042253     IF  CC-VERIFYD-DATE-EXTRACT  AND                             04225302
042254         CC-QUARTER-NUMBER        AND                             04225401
042255         RC035-VRFYD-QTR-NBR       =  PV-DATE-FISCAL-QUARTER      04225501
042256         PERFORM 8000-WRITE-EXTRACT                               04225601
042257     ELSE                                                         04225701
042258     ADD  1  TO  PV-EXTRACT-BYPASSED.                             04225801
042278                                                                  04227801
042280     PERFORM 7100-READ-EXTRACT.                                   04228001
042281                                                                  04228101
057310                                                                  05731001
057330 7000-READ-DATE.                                                  05733001
057331                                                                  05733104
057332     MOVE '7000-READ-DATE'   TO PV-ABEND-PARAGRAPH.               05733204
057334                                                                  05733401
057335     READ DATE-FILE  INTO  PV-DATE-RECORD.                        05733501
067226                                                                  06722601
067228     DISPLAY 'DATE RECORD SET-UP FOR THIS RUN IS:   '             06722801
067229             PV-DATE-RECORD.                                      06722901
067230                                                                  06723001
067231 7100-READ-EXTRACT.                                               06723101
067232                                                                  06723204
067233     MOVE '7100-READ-EXTRACT'   TO PV-ABEND-PARAGRAPH.            06723304
067234                                                                  06723404
067236     READ EXTRACT-FILE  INTO  RC035-RCVR-EXTRACT-RECORD           06723601
067237         AT END                                                   06723702
067238            SET PS-EOF-EXTRACT TO TRUE.                           06723801
067239                                                                  06723901
067240 8000-WRITE-EXTRACT.                                              06724001
067241                                                                  06724104
067242     MOVE '8000-WRITE-EXTRACT'  TO PV-ABEND-PARAGRAPH.            06724204
067244                                                                  06724401
067245     WRITE NEW-EXTRACT-RECORD FROM RC035-RCVR-EXTRACT-RECORD.     06724505
067246                                                                  06724601
067247     ADD  1  TO  PV-EXTRACT-WRITTEN.                              06724701
067251                                                                  06725101
