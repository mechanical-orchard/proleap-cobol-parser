      ******************************************************************00010000
       IDENTIFICATION DIVISION.                                         00020000
      ******************************************************************00030000
      *                                                                 00040000
       PROGRAM-ID.   PXKUT089.                                          00050000
       AUTHOR.       RICH KELLEN.                                       00060000
       INSTALLATION. KOHLS DEPARTMENT STORES.                           00070000
       DATE-WRITTEN. APRIL 2007.                                        00080000
       DATE-COMPILED.                                                   00090000
      *                                                                 00100000
      ***************************************************************** 00110000
      * WR30069 - MOS ML/FS UOW ADJUSTMENT ENGINE.                    * 00120000
      * THIS PROGRAM ANALYZES MOS EVENT AND UNIT OF WORK DATA TO      * 00121000
      * DETERMINE WHAT ADJUSTMENTS NEED TO BE MADE TO THE FS AND ML   * 00122000
      * BALANCES. IT ALSO DETERMINES CREATES FILES TO MAINTAIN PRICE  * 00123000
      * CHANGE HISTORY TABLES ON UNIX.                                * 00124000
      *                                                               * 00125000
      ***************************************************************** 00126000
      ******************** HISTORY OF CHANGES **************************00127000
      * CHG ID/                                                        *00128000
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES                    *00129000
      * -------  ----------  ----------------------------------------  *00130000
      * WR30069  06/23/2007  INITIAL IMPLEMENTATION                    *00140000
032310* WR36394  03/23/2010  ADDED MARKDOWN CANCEL FLAG FOR PXRD090.   *00141001
      ******************************************************************00141138
C82519* CHG0082519 5/27/2014  REMOVED 2 DAY OUT CHECK TO SEND ALL       00141239
C82519*                       MOS DATA TO FS.                           00141339
CHG959******************************************************************00142147
CHG959* CHG0262959 10/21/2021 MODIFIED PROGRAM TO LOOK UP ITEM NUMBER   00142247
CHG959*                       IN TSKXREF TABLE WHEN THE STORE/SKU       00142347
CHG959*                       COMBINATION IS NOT PRESENT IN TSKST TABLE 00142447
CHG959*                       5015-GET-ITEM-NUMBER IS THE NEW PARAGRAPH 00142547
CHG959*                       TO LOOK UP THE ITEM NUMBER FOR THE SKU    00142647
CHG959*                       FROM TSKXREF TABLE.                       00142747
CHG959*                       ALL CHANGES ARE TAGGED TO CHG959.         00142848
CHG959******************************************************************00142948
      ******************************************************************00143000
       ENVIRONMENT DIVISION.                                            00144000
      ******************************************************************00145000
      *                                                                 00146000
       CONFIGURATION SECTION.                                           00147000
       SOURCE-COMPUTER.   IBM-3090.                                     00148000
       OBJECT-COMPUTER.   IBM-3090.                                     00149000
      *                                                                 00150000
       INPUT-OUTPUT SECTION.                                            00160000
       FILE-CONTROL.                                                    00170000
           SELECT IN-FILE                                               00180000
               ASSIGN                       TO INP01.                   00190000
      *                                                                 00200000
           SELECT MLFS-CONTROL-FILE                                     00210000
               ASSIGN                       TO INP02.                   00220000
      *                                                                 00230000
            SELECT REPROCESS-OUT-FILE                                   00240000
              ASSIGN                        TO OUT01.                   00250000
      *                                                                 00260000
            SELECT ML-UPDATE-FILE                                       00270000
              ASSIGN                        TO OUT02.                   00280000
      *                                                                 00290000
            SELECT FS-UPDATE-FILE                                       00300000
              ASSIGN                        TO OUT03.                   00310000
      *                                                                 00320000
            SELECT FS-ZERO-FILE                                         00330000
              ASSIGN                        TO OUT04.                   00340000
      *                                                                 00350000
            SELECT PRCHG-HIST-FILE                                      00360000
              ASSIGN                        TO OUT05.                   00370000
      *                                                                 00380000
            SELECT PRCHG-HIST-SUM-FILE                                  00390000
              ASSIGN                        TO OUT06.                   00400000
      *                                                                 00410000
            SELECT PRCHG-EXTR-FILE                                      00420000
              ASSIGN                        TO OUT07.                   00430000
      *                                                                 00440000
            SELECT WHSE-FS-ZERO-FILE                                    00450000
              ASSIGN                        TO OUT08.                   00460000
      *                                                                 00470000
      ******************************************************************00480000
       DATA DIVISION.                                                   00490000
      ******************************************************************00500000
      *                                                                 00510000
       FILE SECTION.                                                    00520000
       FD  IN-FILE                                                      00530000
           RECORDING MODE F                                             00540000
           BLOCK CONTAINS 0 RECORDS                                     00550000
           LABEL RECORDS ARE STANDARD                                   00560000
           DATA RECORD IS REPROCESS-IN-RECORD.                          00570000
       01  IN-RECORD                             PIC X(118).            00580000
      *                                                                 00590000
       FD  MLFS-CONTROL-FILE                                            00600000
           RECORDING MODE F                                             00610000
           BLOCK CONTAINS 0 RECORDS                                     00620000
           LABEL RECORDS ARE STANDARD                                   00630000
           DATA RECORD IS REPROCESS-IN-RECORD.                          00640000
       01  MLFS-CONTROL-RECORD.                                         00650000
         05  MOS-CONTROL-DAYS                    PIC -999.              00660000
         05  FILLER                              PIC X(76).             00670000
      *                                                                 00680000
       FD REPROCESS-OUT-FILE                                            00690000
           RECORDING MODE IS F                                          00700000
           BLOCK CONTAINS 0 RECORDS                                     00710000
           DATA RECORD IS REPROCESS-OUT-RECORD.                         00720000
                                                                        00730000
       01 REPROCESS-OUT-RECORD                   PIC X(118).            00740000
      *                                                                 00750000
       FD ML-UPDATE-FILE                                                00760000
           RECORDING MODE IS F                                          00770000
           BLOCK CONTAINS 0 RECORDS                                     00780000
           DATA RECORD IS ML-UPDATE-RECORD.                             00790000
                                                                        00800000
       01 ML-UPDATE-RECORD                       PIC X(200).            00810000
      *                                                                 00820000
       FD FS-UPDATE-FILE                                                00830000
           RECORDING MODE IS F                                          00840000
           BLOCK CONTAINS 0 RECORDS                                     00850000
           DATA RECORD IS FS-UPDATE-RECORD.                             00860000
                                                                        00870000
       01 FS-UPDATE-RECORD                       PIC X(200).            00880000
      *                                                                 00890000
       FD FS-ZERO-FILE                                                  00900000
           RECORDING MODE IS F                                          00910000
           BLOCK CONTAINS 0 RECORDS                                     00920000
           DATA RECORD IS FS-ZERO-RECORD.                               00930000
                                                                        00940000
       01 FS-ZERO-RECORD                         PIC X(200).            00950000
      *                                                                 00960000
       FD PRCHG-HIST-FILE                                               00970000
           RECORDING MODE IS F                                          00980000
           BLOCK CONTAINS 0 RECORDS                                     00990000
           DATA RECORD IS PRCHG-HIST-RECORD.                            01000000
                                                                        01010000
       01 PRCHG-HIST-RECORD                      PIC X(121).            01020000
      *                                                                 01030000
       FD PRCHG-HIST-SUM-FILE                                           01040000
           RECORDING MODE IS F                                          01050000
           BLOCK CONTAINS 0 RECORDS                                     01060000
           DATA RECORD IS PRCHG-HIST-SUM-RECORD.                        01070000
                                                                        01080000
032310 01 PRCHG-HIST-SUM-RECORD                  PIC X(049).            01090000
      *                                                                 01100000
       FD PRCHG-EXTR-FILE                                               01110000
           RECORDING MODE IS F                                          01120000
           BLOCK CONTAINS 0 RECORDS                                     01130000
           DATA RECORD IS PRCHG-EXTR-FILE-REC.                          01140000
                                                                        01150000
       01 PRCHG-EXTR-RECORD                      PIC X(068).            01160000
      *                                                                 01170000
       FD WHSE-FS-ZERO-FILE                                             01180000
           RECORDING MODE IS F                                          01190000
           BLOCK CONTAINS 0 RECORDS                                     01200000
           DATA RECORD IS PRCHG-EXTR-FILE-REC.                          01210000
                                                                        01220000
       01 WHSE-FS-ZERO-REC                       PIC X(037).            01230000
      *                                                                 01240000
       WORKING-STORAGE SECTION.                                         01250000
      *                                                                 01260000
           COPY SQLCA2.                                                 01270000
      *                                                                 01280000
                                                                        01290000
       01 ABEND-CODE                      PIC S9(04)    VALUE ZERO      01300000
                                                        COMP SYNC.      01310000
           88  ABEND-4001-WRITE-ERROR                      VALUE +4001. 01320000
           88  ABEND-4002-READ-ERROR                       VALUE +4002. 01330000
           88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003. 01340000
           88  ABEND-4004-TABLE-ERROR                      VALUE +4004. 01350000
           88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 01360000
           88  ABEND-4006-CLOSE-ERROR                      VALUE +4006. 01370000
           88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 01380000
           88  ABEND-4008-DATS-ERROR                       VALUE +4008. 01390000
           88  ABEND-4009-KEY-DATS-ERROR                   VALUE +4009. 01400000
           88  ABEND-4013-DB2-ERROR                        VALUE +4013. 01410000
      *                                                                 01420000
       01 SD-SYSTEM-DATE.                                               01430000
          05  SD-SYSTEM-YEAR              PIC  9(02)  VALUE ZEROS.      01440000
          05  SD-SYSTEM-MONTH             PIC  9(02)  VALUE ZEROS.      01450000
          05  SD-SYSTEM-DAY               PIC  9(02)  VALUE ZEROS.      01460000
                                                                        01470000
       01 ST-SYSTEM-TIME.                                               01480000
          05  ST-SYSTEM-HOUR              PIC  9(02)  VALUE ZEROS.      01490000
          05  ST-SYSTEM-MINUTE            PIC  9(02)  VALUE ZEROS.      01500000
      *                                                                 01510000
       01 SA-SAVE-AREAS.                                                01520000
          05  SA-OUT-RECORD               PIC X(201)   VALUE SPACES.    01530000
          05  SA-PAGE-COUNT               PIC 9(05)    VALUE ZEROS.     01540000
          05  SA-CURRENT-DATE             PIC  X(10)  VALUE SPACES.     01550000
          05  SA-CURR-DATE REDEFINES SA-CURRENT-DATE.                   01560000
              10 SA-CURR-CENTURY          PIC  X(02).                   01570000
              10 SA-CURR-YEAR             PIC  X(02).                   01580000
              10 FILLER                   PIC  X(01).                   01590000
              10 SA-CURR-MONTH            PIC  X(02).                   01600000
              10 FILLER                   PIC  X(01).                   01610000
              10 SA-CURR-DAY              PIC  X(02).                   01620000
          05  SA-CURRENT-TIME             PIC  X(08)  VALUE SPACES.     01630000
          05  SA-CURR-TIME REDEFINES SA-CURRENT-TIME.                   01640000
              10 SA-CURR-HOUR             PIC  X(02).                   01650000
              10 FILLER                   PIC  X(01).                   01660000
              10 SA-CURR-MINUTE           PIC  X(02).                   01670000
              10 FILLER                   PIC  X(01).                   01680000
              10 SA-CURR-SECOND           PIC  X(02).                   01690000
      *                                                                 01700000
       01 PC-PROGRAM-CONSTANTS.                                         01710000
          05  PC-PXKUT089                 PIC X(10)      VALUE          01720000
              'PXKUT089  '.                                             01730000
           05  PC-CURRENT-PROGRAM-NAME    PIC X(08)                     01740000
               VALUE 'PXKUT089'.                                        01750000
          05  PC-MLFS-CTL-DAYS            PIC 9(3)   VALUE 0.           01760000
          05  PC-SUM-CTL-DAYS             PIC 9(3)   VALUE 0.           01770000
          05  PC-ADV-PAGE-SYMBOL          PIC X      VALUE '1'.         01780000
          05  PC-TYPE-CDE                 PIC X(02)  VALUE '01'.        01790000
          05  PC-PROGRAM-NAME             PIC X(08)  VALUE              01800000
              'PXKUT089'.                                               01810000
          05  PC-YES                      PIC X(1)   VALUE 'Y'.         01820000
          05  PC-NO                       PIC X(1)   VALUE 'N'.         01830000
          05  PC-MAX-ROLLUP-TBL-ENTRIES   PIC S9(04) VALUE +300         01840000
                                                     COMP-3.            01850000
          05  PC-MAX-TBL-ENTRIES          PIC S9(04) VALUE +300         01860000
                                                     COMP-3.            01870000
          05  PC-MAX-OPN-STORES           PIC S9(04) VALUE +1500        01880000
                                                     COMP-3.            01890000
          05  PC-MAX-PAGE-LINES           PIC S9(03) VALUE +60          01900000
                                                     COMP-3.            01910000
          05  PC-MAX-RETRY-CNT            PIC S9(04) VALUE 3            01920000
                                                     COMP SYNC.         01930000
          05  PC-MORE-THAN-MAX-RETRY      PIC S9(04) VALUE 4            01940000
                                                     COMP SYNC.         01950000
          05  PC-REPORT-LINE-COUNTER          PIC 9(03) VALUE 100.      01960000
          05  PC-PAGE-COUNTER                 PIC 9(03) VALUE ZEROS.    01970000
C22922    05  PC-MISC-DEPT                    PIC 9(02) VALUE 99.       01973031
C22922    05  PC-MISC-SUB-CL                  PIC 9(02) VALUE 10.       01973132
C22922    05  PC-MISC-MAJ-CL                  PIC 9(02) VALUE 10.       01973232
C22922    05  PC-UNKNOWN-VENDOR               PIC 9(04) VALUE 5161.     01974031
      *                                                                 01980000
       01 PV-PROGRAM-VARIABLES.                                         01990000
          05  PV-XST00010-SKU-NBR         PIC 9(08)    VALUE ZERO.      02000000
          05  PV-PREV-SKU-NBR             PIC 9(08)    VALUE ZERO.      02010000
          05  PV-TIMESTAMP                PIC X(26) VALUE SPACES.       02020000
          05  PV-DATE-IN                  PIC X(10)    VALUE SPACE.     02030000
          05  PV-LOC-NBR-NUMERIC          PIC 9(4)     VALUE ZERO.      02040000
          05  PV-ONHAND-QTY               PIC S9(7)    VALUE ZERO.      02050000
          05  PV-SQLCODE                  PIC +9(04).                   02060000
          05  PV-RECORDS-BYPASSED         PIC  9(09) VALUE ZERO.        02070000
          05  PV-OPERATION-MSG            PIC X(60)  VALUE SPACES.      02071000
          05  PV-CURS-CNT                 PIC 9(7)   VALUE ZERO.        02072000
          05  PV-WRITE-CNT                PIC 9(7)   VALUE ZERO         02073000
                                                     COMP-3.            02074000
          05  PV-READ-CNT                 PIC 9(7)      VALUE ZERO      02075000
                                                        COMP-3.         02076000
          05  PV-RETRY-CNT                PIC S9(04)    VALUE +0        02077000
                                                        COMP SYNC.      02078000
          05  PV-MLFS-CONTROL-REC.                                      02079000
            10  PV-MLFS-CTL-DAYS-IN       PIC -999.                     02080000
            10  FILLER                    PIC X(80).                    02090000
          05  PV-SUM-CONTROL-REC.                                       02100000
            10  PV-SUM-CTL-DAYS-IN        PIC -999.                     02110000
            10  FILLER                    PIC X(80).                    02120000
          05  PV-NBR-OF-INPUT-RECS        PIC  9(09)    VALUE  0.       02130000
          05  PV-NBR-OF-OUTPUT-RECS       PIC  9(09)    VALUE  0.       02140000
          05  PV-NBR-OF-REPROCESS-RECS    PIC  9(09)    VALUE  0.       02150000
          05  PV-NBR-OF-ML-RECS           PIC  9(09)    VALUE  0.       02160000
          05  PV-NBR-OF-FS-RECS           PIC  9(09)    VALUE  0.       02170000
          05  PV-NBR-OF-FS-ZERO-RECS      PIC  9(09)    VALUE  0.       02180000
          05  PV-NBR-OF-PRCHG-HIST-RECS   PIC  9(15)    VALUE  0.       02190000
          05  PV-NBR-OF-PRCHG-SUM-RECS    PIC  9(15)    VALUE  0.       02200000
          05  PV-NBR-OF-PRCHG-EXTR-RECS   PIC  9(15)    VALUE  0.       02210000
          05  PV-NBR-OF-PRCHG-WHSE-RECS   PIC  9(15)    VALUE  0.       02220000
          05  PV-NBR-ZERO-OH-CNT          PIC  9(15)    VALUE  0.       02230000
          05  PV-CURRENT-DATE             PIC X(08)     VALUE SPACE.    02240000
          05  PV-DATE-6-MONTHS.                                         02250000
            10  PV-DATE-6-MONTHS-CC        PIC 9(02).                   02260000
            10  PV-DATE-6-MONTHS-YYMMDD    PIC 9(06).                   02270000
          05  PV-DATE-6-MONTHS-RED REDEFINES PV-DATE-6-MONTHS           02280000
                                           PIC 9(8).                    02290000
          05  PV-DATE-6-MONTHS-CHECK       PIC S9(07)V   COMP-3.        02300000
          05  PV-LIMIT-DATE-TMST.                                       02310000
            10  PV-LIMIT-DATE                PIC X(10)     VALUE SPACE. 02320000
            10  PV-LIMIT-TIME                PIC X(16)     VALUE        02330000
                '-00.00.00.000000'.                                     02340000
          05  PV-2-YR-LIMIT-DATE-CCYYMMDD.                              02350000
            10  PV-2-YR-LIMIT-DATE-CC      PIC 9(02)     VALUE ZERO.    02360000
            10  PV-2-YR-LIMIT-DATE-YYMMDD  PIC 9(06)     VALUE ZERO.    02370000
          05  PV-2-YR-LIMIT-DATE-YYMMDD-SQL PIC S9(07)V   COMP-3.       02380000
          05  PV-2-YR-LIMIT-DATE-TMST.                                  02390000
            10  PV-2-YR-LIMIT-DATE          PIC X(10)     VALUE SPACE.  02400000
            10  PV-2-YR-LIMIT-TIME          PIC X(16)     VALUE         02410000
                '-00.00.00.000000'.                                     02420000
          05  PV-LSRCP-LIMIT-DATE-CCYYMMDD.                             02430000
            10  PV-LSRCP-LIMIT-DATE-CC     PIC 9(02)     VALUE ZERO.    02440000
            10  PV-LSRCP-LIMIT-DATE-YYMMDD PIC 9(06)     VALUE ZERO.    02450000
          05  PV-LSRCP-LIMIT-DATE-TMST.                                 02460000
            10  PV-LSRCP-LIMIT-DATE         PIC X(10)     VALUE SPACE.  02470000
            10  PV-2-YR-LIMIT-TIME          PIC X(16)     VALUE         02480000
                '-00.00.00.000000'.                                     02490000
          05  PV-FIRST-DAY-OF-WEEK        PIC X(10)    VALUE SPACE.     02500000
          05  PV-DATE-FIRST-DAY-1-YEAR    PIC X(10)    VALUE SPACE.     02510000
          05  PV-DATE-LAST-DAY-1-YEAR     PIC X(10)    VALUE SPACE.     02520000
          05  PV-LAST-DAY-OF-WEEK         PIC X(10)    VALUE SPACE.     02530000
          05  PV-FISCAL-WEEK-TY           PIC 9(02)    VALUE ZERO.      02540000
          05  PV-FISCAL-WEEK-LY           PIC 9(02)    VALUE ZERO.      02550000
          05  PV-FISCAL-YEAR-TY           PIC 9(04)    VALUE ZERO.      02560000
          05  PV-FISCAL-YEAR-LY           PIC 9(04)    VALUE ZERO.      02570000
          05  PV-ACTG-MONTH               PIC X(02)    VALUE SPACE.     02580000
          05  PV-CURRENT-DATE-YYMMDD-SQL  PIC S9(07)V   COMP-3.         02590000
          05  PV-CALL-DEPT         PIC X(03)      VALUE SPACES.         02600000
          05  PV-CALL-MANAGER      PIC X(02)      VALUE SPACES.         02610000
          05  PV-DMM-NMBR          PIC 9(03)      VALUE ZEROS.          02620000
          05  PV-BUYER-NMBR        PIC 9(03)      VALUE ZEROS.          02630000
          05  PV-BUYER-NAME        PIC X(20)      VALUE SPACES.         02640000
          05  PV-ABEND-CODE        PIC S9(04)     VALUE +0              02650000
                                                  COMP SYNC.            02660000
          05  PV-PARA-NAME         PIC X(35).                           02670000
          05  PV-UNPACK-SU-DATE    PIC  9(06)     VALUE 0.              02680000
          05  PV-LN-CNT-FOR-TOT    PIC S9(03)     VALUE +99             02690000
                                                  COMP-3.               02700000
          05  PV-PAGE-CNT          PIC S9(05)     VALUE ZERO.           02710000
      *                                                                 02720000
          05  PV-DB2-OUT-DATE          PIC X(10)      VALUE SPACES.     02730000
          05  PV-CURRENT-WEEKDAY       PIC X(09)      VALUE SPACES.     02740000
          05  PV-DECREMENT-1ST         PIC 9(02)      VALUE ZERO.       02750000
          05  PV-NULL-INDICATORS.                                       02760000
              10  PV-SUMMED-ONORD-QTY-NULL        PIC S9(04) VALUE +0   02770000
                                                             COMP.      02780000
C22922    05  PV-DUMMY-SKU                        PIC 9(08).            02781031
C22922    05  PV-DUMMY-SKU-X  REDEFINES PV-DUMMY-SKU.                   02781131
C22922        10  PV-DUMMY-SKU-DEPT               PIC X(03).            02782031
C22922        10  PV-DUMMY-SKU-SUB                PIC X(02).            02782131
C22922        10  FILLER                          PIC X(03).            02782231
C22922    05  PV-ROW-EXIST                        PIC X(1) VALUE SPACE. 02782331
       05  PC-CURRENT-DATE.                                             02790000
           10  PC-CURRENT-DATE-CC     PIC 9(2) VALUE 20.                02800000
           10  PC-CURRENT-DATE-YY     PIC 9(2).                         02810000
           10  FILLER                 PIC X VALUE '-'.                  02820000
           10  PC-CURRENT-DATE-MM     PIC 9(2).                         02830000
           10  FILLER                 PIC X VALUE '-'.                  02840000
           10  PC-CURRENT-DATE-DD     PIC 9(2).                         02850000
       05  CURRENT-DATE.                                                02860000
           10  CURRENT-DATE-YY     PIC 9(2).                            02870000
           10  CURRENT-DATE-MM     PIC 9(2).                            02880000
           10  CURRENT-DATE-DD     PIC 9(2).                            02890000
      *                                                                 02900000
       01 PS-PROGRAM-SWITCHES.                                          02910000
          05  END-OF-IN-FILE-SW        PIC X(1)    VALUE 'N'.           02920000
              88  PS-END-OF-IN-FILE                VALUE 'Y'.           02930000
          05  END-OF-EVENT-FILE-SW     PIC X(1)    VALUE 'N'.           02940000
              88  PS-END-OF-EVENT-FILE             VALUE 'Y'.           02950000
              88  PS-NOT-END-OF-EVENT-FILE         VALUE 'N'.           02960000
          05  PS-END-OF-MLFS-CTL-FILE-SW PIC X(1)  VALUE 'N'.           02970000
              88  PS-END-OF-MLFS-CTL-FILE          VALUE 'Y'.           02980000
          05  PS-END-OF-SUM-CTL-FILE-SW PIC X(1)   VALUE 'N'.           02990000
              88  PS-END-OF-SUM-CTL-FILE           VALUE 'Y'.           03000000
          05  PS-PROCESS-SW             PIC X(1)   VALUE 'N'.           03010000
              88  PS-ML-AND-FS                     VALUE '1'.           03020000
              88  PS-ML-ONLY                       VALUE '2'.           03030000
              88  PS-SUM                           VALUE '3'.           03040000
              88  PS-ZERO                          VALUE '4'.           03050000
              88  PS-REPROCESS                     VALUE '5'.           03060000
              88  PS-NON-MOS                       VALUE '6'.           03070000
C22922    05  PS-DEPT-NOT-FOUND-SW     PIC X(1)    VALUE 'N'.           03071031
C22922        88  PS-DEPT-NOT-FOUND-YES            VALUE 'Y'.           03072031
C22922        88  PS-DEPT-NOT-FOUND-NO             VALUE 'N'.           03073031
C22922    05  PS-DEPT-INVALID-SW       PIC X(1)    VALUE 'N'.           03074031
C22922        88  PS-DEPT-INVALID                  VALUE 'Y'.           03075031
C22922        88  PS-DEPT-VALID                    VALUE 'N'.           03076031
C22922    05  PS-SL-VALID-SW           PIC X(1)    VALUE 'N'.           03077031
C22922        88  PS-SL-VALID                      VALUE 'Y'.           03078031
C22922        88  PS-SL-INVALID                    VALUE 'N'.           03079031
      *                                                                 03080000
      ******************************************************************03090000
      **TIMESTAMP VARIABLES                                             03100000
      ******************************************************************03110000
       01 DF-DATE-TIME-FIELDS.                                          03120000
          05 DF-ACCEPT-DATE.                                            03130000
             10  DF-ACCEPT-YR                  PIC 9(02) VALUE ZEROS.   03140000
             10  DF-ACCEPT-MO                  PIC 9(02) VALUE ZEROS.   03150000
             10  DF-ACCEPT-DY                  PIC 9(02) VALUE ZEROS.   03160000
          05 DF-ACCEPT-TIME.                                            03170000
             10  DF-ACCEPT-HR                  PIC 9(02) VALUE ZEROS.   03180000
             10  DF-ACCEPT-MN                  PIC 9(02) VALUE ZEROS.   03190000
             10  DF-ACCEPT-SS                  PIC 9(04) VALUE ZEROS.   03200000
          05 DF-FORMAT-DATE.                                            03210000
             10  DF-FORMAT-DATE-MM             PIC 9(02) VALUE ZEROS.   03220000
             10  FILLER                        PIC X(01) VALUE '/'.     03230000
             10  DF-FORMAT-DATE-DD             PIC 9(02) VALUE ZEROS.   03240000
             10  FILLER                        PIC X(01) VALUE '/'.     03250000
             10  DF-FORMAT-DATE-YY             PIC 9(02) VALUE ZEROS.   03260000
      ******************************************************************03270000
      * DB2 ERROR MESSAGES FORMAT AREA.                                 03280000
      ******************************************************************03290000
           COPY DPWS004.                                                03300000
                                                                        03310000
      ******************************************************************03320000
      * CALENDAR ROUTINE WORK AREA.                                     03330000
      ******************************************************************03340000
           COPY DPWS500.                                                03350000
      *                                                                 03360000
      ******************************************************************03370000
      * COPY MEMBER FOR THE MERGED MOS UOW/EVENT FILE                   03380000
      ******************************************************************03390000
      *                                                                 03400000
           COPY PXRD088.                                                03410000
      ******************************************************************03420000
      * COPY MEMBER FOR THE MOS PXT_PRCHG_HIST TABLE UPDATE FILE        03430000
      ******************************************************************03440000
      *                                                                 03450000
           COPY PXRD089.                                                03460000
      ******************************************************************03470000
      * COPY MEMBER FOR THE MOS PRCHG_HIST_SUM TABLE UPDATE FILE        03480000
      ******************************************************************03490000
      *                                                                 03500000
           COPY PXRD090.                                                03510000
      ******************************************************************03520000
      * COPY MEMBER FOR THE MOS PXT_PRCHG_EXTR TABLE UPDATE FILE        03530000
      ******************************************************************03540000
      *                                                                 03550000
           COPY PXRD091.                                                03560000
      ******************************************************************03570000
      * COPY MEMBER FOR THE FS UPDATE FILE                              03580000
      ******************************************************************03590000
      *                                                                 03600000
           COPY FSRD035.                                                03610000
      ******************************************************************03620000
      * COPY MEMBER FOR THE ML UPDATE FILE                              03630000
      ******************************************************************03640000
      *                                                                 03650000
           COPY MLRD017.                                                03660000
      ******************************************************************03670000
      * COPY MEMBER FOR THE FS ZERO QTY FILE                            03680000
      ******************************************************************03690000
      *                                                                 03700000
           COPY PXRD093.                                                03710000
      ******************************************************************03720000
      * SQLCA AREA                                                      03730000
      ******************************************************************03740000
      *                                                                 03750000
           EXEC SQL                                                     03760000
               INCLUDE SQLCA                                            03770000
           END-EXEC.                                                    03780000
      *                                                                 03790000
      ******************************************************************03800000
      * TABLE DECLARATIONS FOR TSKST                                    03810000
      ******************************************************************03820000
           EXEC SQL                                                     03830000
               INCLUDE TSKST                                            03840000
           END-EXEC.                                                    03850000
                                                                        03860000
      ******************************************************************03870000
      * TABLE DECLARATIONS FOR TSKXREF                                  03880000
      ******************************************************************03890000
           EXEC SQL                                                     03900000
               INCLUDE TSKXREF                                          03910000
           END-EXEC.                                                    03920000
                                                                        03930000
      ******************************************************************03940000
      * TABLE DECLARATIONS FOR XST_SKU_LOC                              03950000
      ******************************************************************03960000
           EXEC SQL                                                     03970000
               INCLUDE XST00008                                         03980000
           END-EXEC.                                                    03990000
                                                                        04000000
      ******************************************************************04010000
      * TABLE DECLARATIONS FOR XST_SKU                                  04020000
      ******************************************************************04030000
           EXEC SQL                                                     04040000
               INCLUDE XST00010                                         04050000
           END-EXEC.                                                    04060000
                                                                        04070000
      ******************************************************************04080000
      * TABLE DECLARATIONS FOR XST_DMA                                  04090000
      ******************************************************************04100000
           EXEC SQL                                                     04110000
               INCLUDE XST00067                                         04120000
           END-EXEC.                                                    04130000
                                                                        04140000
      ******************************************************************04150000
      * TABLE DECLARATIONS FOR XST_VND_STYL                             04160000
      ******************************************************************04170000
           EXEC SQL                                                     04180000
               INCLUDE XST00013                                         04190000
           END-EXEC.                                                    04200000
                                                                        04210000
      ******************************************************************04220000
      * TABLE DECLARATIONS FOR XST_BUS_AREA                             04230000
      ******************************************************************04240000
           EXEC SQL                                                     04250000
               INCLUDE XST00024                                         04260000
           END-EXEC.                                                    04270000
                                                                        04280000
      ******************************************************************04290000
      * TABLE DECLARATIONS FOR XST_BUS_GP                               04300000
      ******************************************************************04310000
           EXEC SQL                                                     04320000
               INCLUDE XST00016                                         04330000
           END-EXEC.                                                    04340000
                                                                        04350000
      ******************************************************************04360000
      * TABLE DECLARATIONS FOR XST_DEPT                                 04370000
      ******************************************************************04380000
           EXEC SQL                                                     04390000
               INCLUDE XST00015                                         04400000
           END-EXEC.                                                    04410000
                                                                        04420000
                                                                        04430000
      ******************************************************************04440000
       PROCEDURE DIVISION.                                              04450000
      ******************************************************************04460000
      *                                                                 04470000
          EJECT                                                         04480000
       0000-MAINLINE-PROCESSING.                                        04490000
      ******************************************************************04500000
      * MAIN PROCESSING ROUTINE                                       * 04510000
      ******************************************************************04520000
                                                                        04530000
            PERFORM 1000-INIT.                                          04540000
            PERFORM 2000-PROCESS-IN-FILE                                04550000
              UNTIL PS-END-OF-IN-FILE.                                  04560000
                                                                        04570000
            PERFORM 9000-END-OF-JOB.                                    04580000
                                                                        04590000
            GOBACK.                                                     04600000
                                                                        04610000
      ******************************************************************04620000
      * OPEN FILES GET CURRENT DATE AND TIME FROM DB2.     *            04630000
      ******************************************************************04640000
      *                                                                 04650000
       1000-INIT.                                                       04660000
           MOVE '*1000-INIT.              *' TO PV-PARA-NAME.           04670000
           INITIALIZE ML017-PRICE-CHANGE-RECORD.                        04680000
           INITIALIZE FS035-ADJUSTMENT-RECORD.                          04690000
           OPEN INPUT  IN-FILE                                          04700000
                       MLFS-CONTROL-FILE                                04710000
                OUTPUT REPROCESS-OUT-FILE                               04720000
                       ML-UPDATE-FILE                                   04730000
                       FS-UPDATE-FILE                                   04740000
                       FS-ZERO-FILE                                     04750000
                       PRCHG-HIST-FILE                                  04760000
                       PRCHG-HIST-SUM-FILE                              04770000
                       PRCHG-EXTR-FILE                                  04780000
                       WHSE-FS-ZERO-FILE.                               04790000
           PERFORM 8050-READ-MLFS-CONTROL-FILE.                         04800000
           PERFORM 8000-READ-IN-FILE.                                   04810000
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              04820000
           SET DPG51-FISCAL-JAN-DEC-F2                                  04830000
               DPG51-DO-NOT-INCR-DECR-DATE                              04840000
               DPG52-LK-DTE-ISO-FMT        TO TRUE.                     04850000
           ACCEPT CURRENT-DATE FROM DATE.                               04860000
           MOVE CURRENT-DATE-MM  TO PC-CURRENT-DATE-MM.                 04870000
           MOVE CURRENT-DATE-DD  TO PC-CURRENT-DATE-DD.                 04880000
           MOVE CURRENT-DATE-YY  TO PC-CURRENT-DATE-YY.                 04890000
           MOVE PC-CURRENT-DATE TO DPG52-LK-DATE-INPUT                  04900000
                                                                        04910000
           CALL DP500-KOHLS-CALENDAR-ROUTINE                            04920000
               USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               04930000
                                                                        04940000
           IF DPG54-DATE-INVALID                                        04950000
               DISPLAY '** ABEND ** IN PXKUT089'                        04960000
               DISPLAY '** PARAGRAPH: 1100-PROCESS-CONTROL-CARD.'       04970000
               DISPLAY '** INVALID PROCESS DATE ON CONTROL CARD.'       04980000
               DISPLAY '** CALENDAR ROUTINE ERROR MESSAGE = '           04990000
                           DPG54-ERROR-MESSAGE                          05000000
               DISPLAY '** DPG51 = ' DPG51                              05010000
               DISPLAY '** DPG52 = ' DPG52                              05020000
               DISPLAY '** DPG53 = ' DPG53                              05030000
               DISPLAY '** DPG54 = ' DPG54                              05040000
               DISPLAY '** DPG55 = ' DPG55                              05050000
               DISPLAY '** DPG56 = ' DPG56                              05060000
               MOVE +4003 TO ABEND-CODE                                 05070000
               CALL 'ILBOABN0' USING ABEND-CODE                         05080000
           ELSE                                                         05090000
               IF DPG54-SEVERE-ERROR                                    05100000
                   DISPLAY '** ABEND ** IN PXKUT089'                    05110000
                   DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE.'   05120000
                   DISPLAY '** CALLED BY 1100-PROCESS-CONTROL-CARD.'    05130000
                   DISPLAY '** ERROR MESSAGE = ' DPG54-ERROR-MESSAGE    05140000
                   DISPLAY '** DPG51 = ' DPG51                          05150000
                   DISPLAY '** DPG52 = ' DPG52                          05160000
                   DISPLAY '** DPG53 = ' DPG53                          05170000
                   DISPLAY '** DPG54 = ' DPG54                          05180000
                   DISPLAY '** DPG55 = ' DPG55                          05190000
                   DISPLAY '** DPG56 = ' DPG56                          05200000
                   MOVE +4003 TO ABEND-CODE                             05210000
                   CALL 'ILBOABN0' USING ABEND-CODE                     05220000
               ELSE                                                     05230000
                   IF DPG54-WARNING-ERROR                               05240000
                       DISPLAY                                          05250000
                             '** WARNING RETURNED BY CALENDAR ROUTINE.' 05260000
                       DISPLAY                                          05270000
                             '** CALLED BY 1100-PROCESS-CONTROL-CARD.'  05280000
                       DISPLAY                                          05290000
                             '** WARNING MESSAGE = ' DPG54-ERROR-MESSAGE05300000
                   END-IF                                               05310000
               END-IF                                                   05320000
           END-IF.                                                      05330000
                                                                        05340000
                                                                        05350000
           MOVE DPG56-FISCAL-PERIOD-NBR   TO  PV-ACTG-MONTH.            05360000
                                                                        05370000
                                                                        05380000
           EXEC SQL                                                     05390000
                SELECT CURRENT TIMESTAMP                                05400000
                INTO  :PV-TIMESTAMP                                     05410000
                FROM   SYSIBM.SYSDUMMY1                                 05420000
           END-EXEC.                                                    05430000
                                                                        05440000
      ******************************************************************05450000
      * PROCESS LOOKUP OF MOS EVENT INVENTORY END DAYS                  05460000
      * THE UNLOAD PROCESS THAT FEEDS THIS PROCESS ONLY SELECTS ROWS    05470000
      * WITH A STAT-CODE ='AA','AP' OR 'RA', SO, IF THE TYPE CODE       05480000
      * DOESN'T='AA' OR 'AP' IS MUST EQUAL 'RA' (REVERSAL).             05490000
      ******************************************************************05500000
       2000-PROCESS-IN-FILE.                                            05510000
           MOVE PXRD088-SKU-NBR  TO XST00010-SKU-NBR                    05520000
           MOVE PXRD088-STR-NBR  TO XST00008-LOC-NBR                    05530000
           IF PXRD088-SKU-NBR NOT = PV-PREV-SKU-NBR                     05540000
             AND PXRD088-UOW-STAT-CDE  > SPACE                          05550012
             PERFORM 5000-BUSINESS-AREA                                 05560000
             MOVE PXRD088-SKU-NBR TO PV-PREV-SKU-NBR.                   05560105
C22922      IF PS-DEPT-NOT-FOUND-YES                                    05561031
C22922          MOVE PC-UNKNOWN-VENDOR   TO XST00013-ENT-ID             05561131
C22922          MOVE XST00010-SKU-NBR TO PV-DUMMY-SKU                   05561231
C22922          MOVE PV-DUMMY-SKU-DEPT TO XST00013-DEPT-NBR             05561431
C22922          MOVE PV-DUMMY-SKU-SUB TO XST00013-SUB-CL-NBR            05561631
C22922          PERFORM 5001-CHECK-VALID-DEPT                           05561731
C22922          IF PS-DEPT-VALID                                        05561831
C22922             PERFORM 5002-BUSINESS-AREA-DEPT                      05561931
C22922             PERFORM 5003-CHECK-VALID-SL                          05562031
C22922             IF PS-SL-INVALID                                     05562131
C22922                MOVE PC-MISC-DEPT TO XST00013-DEPT-NBR            05562733
C22922                MOVE PC-MISC-SUB-CL TO XST00013-SUB-CL-NBR        05562833
C22922                MOVE PC-MISC-MAJ-CL TO XST00013-MAJ-CL-NBR        05562933
C22922                MOVE PC-MISC-DEPT TO XST00016-BUS-AREA-ID         05563033
C22922                MOVE PC-MISC-DEPT TO XST00016-BUS-GP-NBR          05563133
C22922             END-IF                                               05563231
C22922          ELSE                                                    05563331
C22922              MOVE PC-MISC-DEPT TO XST00013-DEPT-NBR              05563431
C22922              MOVE PC-MISC-SUB-CL TO XST00013-SUB-CL-NBR          05563532
C22922              MOVE PC-MISC-MAJ-CL TO XST00013-MAJ-CL-NBR          05563632
C22922              MOVE PC-MISC-DEPT TO XST00016-BUS-AREA-ID           05563731
C22922              MOVE PC-MISC-DEPT TO XST00016-BUS-GP-NBR            05563831
C22922          END-IF                                                  05563931
C22922      END-IF.                                                     05564031
                                                                        05580000
           MOVE PXRD088-SKU-NBR   TO SKXREF-SKU.                        05590000
           MOVE PXRD088-STR-NBR   TO TSKST-LOC-NBR.                     05600000
           PERFORM 5010-ONHAND-QTY.                                     05610000
           PERFORM 3000-CHECK-EVENT-DAYS.                               05620000
                                                                        05630000
      *** NO UOW TRANSACTIONS FOR THIS STORE/SKU/DATE                   05640000
           IF PXRD088-UOW-STAT-CDE NOT > SPACE                          05650000
             PERFORM 2010-PROCESS-NO-UOW                                05660000
           ELSE                                                         05670000
      *** NON-MOS - SKU/STORE NOT FOUND ON MOS TABLE                    05680000
           IF PS-NON-MOS                                                05690000
      *** KNOWN THEFT UOW - SENT TO FS ONLY                             05700000
             IF PXRD088-UOW-TYP-CDE  = '04'                             05710000
               PERFORM 2020-PROCESS-NON-MOS-KT                          05720000
             ELSE                                                       05730000
      *** NOT KNOWN THEFT OR MOS                                        05740000
               PERFORM 2030-NOT-KT-OR-MOS                               05750000
      *** MOS & UOW - SKU/STORE FOUND ON MOS TABLE AND UOW DATA EXISTS  05760000
           ELSE                                                         05770000
             IF PXRD088-UOW-TYP-CDE  = '01'                             05780000
               PERFORM 2040-MOS-TYPE-AND-UOW                            05790000
             ELSE                                                       05800000
      *** KNOWN THEFT - SENT TO FS ONLY                                 05810000
             IF PXRD088-UOW-TYP-CDE  = '04'                             05820000
               PERFORM 2050-KT-AND-MOS                                  05830000
             ELSE                                                       05840000
               PERFORM 2030-NOT-KT-OR-MOS.                              05850000
                                                                        05860000
           PERFORM 8000-READ-IN-FILE.                                   05870000
                                                                        05880000
      ******************************************************************05890000
      * PROCESS RECORD WHERE SKU/LOCATION ON MOS EVENT TABLE BUT        05900000
      *  NO UNIT OF WORK DATA EXISTS.                                   05910000
      ******************************************************************05920000
       2010-PROCESS-NO-UOW.                                             05930000
           MOVE TSKST-ONHAND-QTY  TO PV-ONHAND-QTY                      05940000
           IF PS-ZERO                                                   05950000
             PERFORM 2100-CREATE-ZERO-FS-REC                            05960000
             IF XST00010-SKU-NBR NOT = PV-XST00010-SKU-NBR              05970000
               PERFORM 5020-UNIT-RETAIL-AMOUNT                          05980000
               MOVE XST00010-SKU-NBR TO PV-XST00010-SKU-NBR             05990000
             END-IF                                                     06000000
             MOVE XST00008-UNT-RTL-AMT  TO PXRD088-OLD-UNT-RTL-AMT      06010000
             MOVE 0                     TO PXRD088-NEW-UNT-RTL-AMT      06020000
             MOVE TSKST-ONHAND-QTY      TO PXRD088-SCND-UNT-QTY         06030000
             MOVE '01'                  TO PXRD088-UOW-TYP-CDE          06040000
             PERFORM 2500-PXT-PRCHG-EXTR-REC                            06050000
           ELSE                                                         06060000
             NEXT SENTENCE.                                             06070000
                                                                        06080000
      ******************************************************************06090000
      * PROCESS KNOWN THEFT RECORD WHERE SKU/LOCATION NOT ON            06100000
      *  MOS EVENT TABLE.                                               06110000
      * NO RECORDS ARE CREATED TO UPDATE PXT_PRCHG TABLES OR ML.        06120000
      ******************************************************************06130000
       2020-PROCESS-NON-MOS-KT.                                         06140000
           PERFORM 2200-PXT-PRCHG-HIST-REC.                             06150000
           IF PXRD088-UOW-STAT-CDE = 'AA' OR 'AP'                       06160000
             MOVE PXRD088-SCND-UNT-QTY TO PV-ONHAND-QTY                 06170000
             SET FS035-ACTN-NEG TO TRUE                                 06180000
             PERFORM 2300-CREATE-FS-REC                                 06190000
           ELSE                                                         06200000
           IF PXRD088-UOW-STAT-CDE > SPACE                              06210000
      *   MUST BE 'RA', CREATE RECORDS TO REVERSE QTY                   06220000
             MOVE PXRD088-SCND-UNT-QTY TO PV-ONHAND-QTY                 06230000
             SET FS035-ACTN-PLS TO TRUE                                 06240000
             PERFORM 2300-CREATE-FS-REC.                                06250000
                                                                        06260000
      ******************************************************************06270000
      * PROCESS RECORD WHERE SKU/LOCATION NOT ON MOS EVENT TABLE AND    06280000
      *  NOT A KNOWN THEFT OR MOS TYPE.                                 06290000
      * NON-MOS (TYPE-CD NOT= '01') DO NOT CREATE RECORDS TO UPDATE     06300000
      *  PXT_PRCHG TABLES.                                              06310000
      ******************************************************************06320000
       2030-NOT-KT-OR-MOS.                                              06330000
           IF PXRD088-UOW-STAT-CDE = 'AA' OR 'AP'                       06340000
             PERFORM 2200-PXT-PRCHG-HIST-REC                            06350000
             MOVE PXRD088-SCND-UNT-QTY TO PV-ONHAND-QTY                 06360000
             SET FS035-ACTN-NEG TO TRUE                                 06370000
             PERFORM 2300-CREATE-FS-REC                                 06380000
             SET ML017-MARKDOWN TO TRUE                                 06390000
             PERFORM 2400-CREATE-ML-REC                                 06400000
           ELSE                                                         06410000
      *   MUST BE 'RA', CREATE RECORDS TO REVERSE QTY                   06420000
           IF PXRD088-UOW-STAT-CDE > SPACE                              06430000
             PERFORM 2200-PXT-PRCHG-HIST-REC                            06440000
             MOVE PXRD088-SCND-UNT-QTY TO PV-ONHAND-QTY                 06450000
             SET FS035-ACTN-PLS TO TRUE                                 06460000
             PERFORM 2300-CREATE-FS-REC                                 06470000
             SET ML017-MARKDOWN-CANCEL TO TRUE                          06480000
             PERFORM 2405-CREATE-ML-REV-REC.                            06490000
                                                                        06500000
      ******************************************************************06510000
      * PROCESS MOS TYPE AND UOW TRANSACTION                            06520000
      ******************************************************************06530000
       2040-MOS-TYPE-AND-UOW.                                           06540000
           IF PS-ML-AND-FS                                              06550000
             IF PXRD088-UOW-STAT-CDE = 'AA' OR 'AP'                     06560000
               MOVE PXRD088-SCND-UNT-QTY TO PV-ONHAND-QTY               06570000
               SET FS035-ACTN-NEG TO TRUE                               06580000
               PERFORM 2300-CREATE-FS-REC                               06590000
               SET ML017-MARKDOWN TO TRUE                               06600000
               PERFORM 2400-CREATE-ML-REC                               06610000
               PERFORM 2200-PXT-PRCHG-HIST-REC                          06620000
             ELSE                                                       06630000
      * MUST BE 'RA', CREATE RECORDS TO REVERSE QTY                     06640000
               IF PXRD088-UOW-STAT-CDE > SPACE                          06650000
                 MOVE PXRD088-SCND-UNT-QTY TO PV-ONHAND-QTY             06660000
                 SET FS035-ACTN-PLS TO TRUE                             06670000
                 PERFORM 2300-CREATE-FS-REC                             06680000
                 SET ML017-MARKDOWN-CANCEL TO TRUE                      06690000
                 PERFORM 2405-CREATE-ML-REV-REC                         06700000
                 PERFORM 2200-PXT-PRCHG-HIST-REC                        06710000
               END-IF                                                   06720000
           ELSE                                                         06730000
      * ML ONLY                                                         06740000
           IF PS-ML-ONLY                                                06750000
             IF PXRD088-UOW-STAT-CDE = 'AA' OR 'AP'                     06760000
               MOVE PXRD088-SCND-UNT-QTY TO PV-ONHAND-QTY               06770000
               SET ML017-MARKDOWN TO TRUE                               06780000
               PERFORM 2400-CREATE-ML-REC                               06790000
               PERFORM 2200-PXT-PRCHG-HIST-REC                          06800000
             ELSE                                                       06810000
      * MUST BE 'RA', CREATE RECORDS TO REVERSE QTY                     06820000
             IF PXRD088-UOW-STAT-CDE > SPACE                            06830000
               MOVE PXRD088-SCND-UNT-QTY TO PV-ONHAND-QTY               06840000
               SET ML017-MARKDOWN-CANCEL TO TRUE                        06850000
               PERFORM 2405-CREATE-ML-REV-REC                           06860000
               PERFORM 2200-PXT-PRCHG-HIST-REC                          06870000
             END-IF                                                     06880000
           ELSE                                                         06890000
      * DAY AFTER PC-MLFS-CTL-DAYS                                      06900000
           IF PS-ZERO                                                   06910000
             IF PXRD088-REPROCESS-YES                                   06920000
      * THE ML AND FS ADJUSTMENT RECORDS WERE CREATED WHEN THE          06930000
      * REPROCESS RECORD WAS CREATED, SO, ONLY THE ZERO TRANSACTION     06940000
      * NEEDS TO BE CREATED NOW.                                        06950000
                 MOVE TSKST-ONHAND-QTY  TO PV-ONHAND-QTY                06960000
                 PERFORM 2500-PXT-PRCHG-EXTR-REC                        06970000
                 PERFORM 2100-CREATE-ZERO-FS-REC                        06980000
             ELSE                                                       06990000
             IF PXRD088-UOW-STAT-CDE = 'AA' OR 'AP'                     07000000
               MOVE PXRD088-SCND-UNT-QTY TO PV-ONHAND-QTY               07010000
               SET ML017-MARKDOWN TO TRUE                               07020000
               PERFORM 2400-CREATE-ML-REC                               07030000
               PERFORM 2200-PXT-PRCHG-HIST-REC                          07040000
               PERFORM 2500-PXT-PRCHG-EXTR-REC                          07050000
               PERFORM 2100-CREATE-ZERO-FS-REC                          07060000
               SET FS035-ACTN-NEG TO TRUE                               07070000
               PERFORM 2300-CREATE-FS-REC                               07080000
             ELSE                                                       07090000
             IF PXRD088-UOW-STAT-CDE > SPACE                            07100000
               MOVE PXRD088-SCND-UNT-QTY TO PV-ONHAND-QTY               07110000
               SET ML017-MARKDOWN-CANCEL TO TRUE                        07120000
               PERFORM 2405-CREATE-ML-REV-REC                           07130000
               PERFORM 2200-PXT-PRCHG-HIST-REC                          07140000
               PERFORM 2500-PXT-PRCHG-EXTR-REC                          07150000
               PERFORM 2100-CREATE-ZERO-FS-REC                          07160000
               SET FS035-ACTN-PLS TO TRUE                               07170000
               PERFORM 2300-CREATE-FS-REC                               07180000
             END-IF                                                     07190000
           ELSE                                                         07200000
           IF PS-REPROCESS                                              07210000
      * WE ONLY WANT TO REPROCESS A RECORD IF IT WILL CAUSE A 'ZERO'    07220000
      * RECORD TO BE CREATED FOR FS.                                    07221000
             SET PXRD088-REPROCESS-YES TO TRUE                          07222000
             PERFORM 8100-WRITE-REPROCESS-OUT-FILE                      07223000
             IF PXRD088-UOW-STAT-CDE = 'AA' OR 'AP'                     07224000
               MOVE PXRD088-SCND-UNT-QTY TO PV-ONHAND-QTY               07225000
               SET ML017-MARKDOWN TO TRUE                               07226000
               PERFORM 2400-CREATE-ML-REC                               07227000
               PERFORM 2200-PXT-PRCHG-HIST-REC                          07228000
               SET FS035-ACTN-NEG TO TRUE                               07229000
               PERFORM 2300-CREATE-FS-REC                               07230000
             ELSE                                                       07240000
             IF PXRD088-UOW-STAT-CDE > SPACE                            07250000
               MOVE PXRD088-SCND-UNT-QTY TO PV-ONHAND-QTY               07260000
               SET ML017-MARKDOWN-CANCEL TO TRUE                        07270000
               PERFORM 2405-CREATE-ML-REV-REC                           07280000
               PERFORM 2200-PXT-PRCHG-HIST-REC                          07290000
               SET FS035-ACTN-PLS TO TRUE                               07300000
               PERFORM 2300-CREATE-FS-REC                               07310000
             END-IF                                                     07320000
           ELSE                                                         07321000
             DISPLAY 'ERROR DETERMINING PROCESSING OPTION - '           07322000
               PXRD088-STR-NBR ' - ' PXRD088-SKU-NBR ' - '              07323000
               PXRD088-UNT-OF-WRK-DEV-ID  ' - '                         07324000
               PXRD088-MOS-TRN-SCN-SEQ-NBR.                             07325000
                                                                        07326000
      ******************************************************************07327000
      * PROCESS KNOWN THEFT RECORD WHERE SKU/LOCATION ON                07328000
      *  MOS EVENT TABLE                                                07329000
      * NO RECORDS ARE CREATED TO UPDATE PXT_PRCHG TABLES OR ML.        07330000
      ******************************************************************07330100
       2050-KT-AND-MOS.                                                 07330200
           PERFORM 2200-PXT-PRCHG-HIST-REC.                             07330300
           IF PXRD088-UOW-STAT-CDE = 'AA' OR 'AP'                       07330400
             MOVE PXRD088-SCND-UNT-QTY TO PV-ONHAND-QTY                 07330500
             SET FS035-ACTN-NEG TO TRUE                                 07330600
             PERFORM 2300-CREATE-FS-REC                                 07330700
           ELSE                                                         07330800
      * MUST BE 'RA', CREATE RECORDS TO REVERSE QTY                     07330900
             IF PXRD088-UOW-STAT-CDE > SPACE                            07331000
               MOVE PXRD088-SCND-UNT-QTY TO PV-ONHAND-QTY               07332000
               SET FS035-ACTN-PLS TO TRUE                               07333000
               PERFORM 2300-CREATE-FS-REC.                              07334000
                                                                        07335000
      ******************************************************************07336000
      * CREATE RECORD TO ZERO ML                                        07337000
      ******************************************************************07338000
       2100-CREATE-ZERO-FS-REC.                                         07339000
           MOVE SKXREF-ITM-NBR            TO  FS035-ITM-NBR.            07340000
           MOVE PXRD088-STR-NBR           TO  PV-LOC-NBR-NUMERIC.       07350000
           MOVE PV-LOC-NBR-NUMERIC        TO  FS035-LOC-NBR.            07360000
           SET FS035-OH-ADJ TO TRUE.                                    07370000
      ** THE ADJ QTY WILL USE THE QTY FROM TSKST IN ORDER TO ZERO OUT   07380000
      ** THE ENTIRE ONHAND QTY.                                         07390000
           MOVE PV-ONHAND-QTY             TO  FS035-ADJ-QTY             07400000
           IF PV-ONHAND-QTY  > 0                                        07410000
             SET FS035-ACTN-NEG TO TRUE                                 07420000
           ELSE                                                         07430000
             SET FS035-ACTN-PLS TO TRUE.                                07440000
           MOVE ' 888'                    TO  FS035-BTCH-NBR            07450000
           MOVE SPACE                     TO  FS035-UNT-BKG-IND         07460000
           MOVE 'PXKUT089'                TO  FS035-ADJ-SRC-PGM-NM      07470000
      * RECORDS TO ZERO OUT FS QTY'S DON'T NEED TO BE WRITTEN IF THE    07480000
      * ON HAND QTY IS ALREADY ZERO.                                    07490000
           PERFORM 8130-FS-ZERO-FILE.                                   07500000
           MOVE PXRD088-SKU-NBR           TO PXRD093-SKU-NBR.           07510000
           MOVE PXRD088-STR-NBR           TO PXRD093-STR-NBR.           07520000
           MOVE PV-ONHAND-QTY             TO PXRD093-QTY.               07530000
           MOVE PC-CURRENT-DATE           TO PXRD093-PROCESS-DTE.       07540000
           INITIALIZE FS035-ADJUSTMENT-RECORD.                          07550000
           PERFORM 8170-WHSE-FS-ZERO-FILE.                              07560000
           INITIALIZE PXRD093-ZERO-FILE.                                07570000
                                                                        07580000
      ******************************************************************07590000
      * CREATE RECORD TO PXT_PRCHG_HIST TABLE                           07600000
      ******************************************************************07610000
       2200-PXT-PRCHG-HIST-REC.                                         07620000
           MOVE PXRD088-UNT-OF-WRK-DEV-ID TO PXRD089-UNT-OF-WRK-DEV-ID. 07630000
           MOVE PXRD088-ASSOC-ID          TO PXRD089-ASSOC-ID.          07640000
           MOVE PXRD088-UOW-BEG-TMST      TO PXRD089-UOW-BEG-TMST.      07650000
           MOVE PXRD088-STR-NBR           TO PXRD089-STR-NBR.           07660000
           MOVE PXRD088-SKU-NBR           TO PXRD089-SKU-NBR.           07670000
           MOVE PXRD088-UOW-TYP-CDE       TO PXRD089-UOW-TYP-CDE.       07680000
           MOVE PV-TIMESTAMP              TO PXRD089-CRE-TMST.          07690000
           IF PXRD088-UOW-STAT-CDE = 'RA'                               07700000
             COMPUTE PXRD089-PRCD-UNT-QTY = PXRD088-SCND-UNT-QTY * -1   07710000
           ELSE                                                         07720000
             MOVE PXRD088-SCND-UNT-QTY    TO PXRD089-PRCD-UNT-QTY.      07730000
           MOVE PXRD088-OLD-UNT-RTL-AMT   TO PXRD089-OLD-UNT-RTL-AMT.   07740000
           MOVE PXRD088-NEW-UNT-RTL-AMT   TO PXRD089-NEW-UNT-RTL-AMT.   07750000
           PERFORM 8140-PRCHG-HIST-FILE.                                07760000
           MOVE 'N'                       TO PXRD090-SYS-GEND-IND.      07770000
           PERFORM 2600-PXT-PRCHG-HIST-SUM-REC.                         07780000
                                                                        07790000
      ******************************************************************07800000
      * CREATE RECORD TO FS                                             07810000
      ******************************************************************07820000
       2300-CREATE-FS-REC.                                              07830000
           MOVE SKXREF-ITM-NBR            TO  FS035-ITM-NBR.            07840000
           MOVE PXRD088-STR-NBR           TO  PV-LOC-NBR-NUMERIC.       07850000
           MOVE PV-LOC-NBR-NUMERIC        TO  FS035-LOC-NBR.            07860000
           SET FS035-OH-ADJ TO TRUE.                                    07870000
      *    MOVE FS035-ACTN-CDE            TO  FS035-ACTN-CDE            07880000
      ** THE ADJ QTY WILL EITHER USE THE QTY FROM THE UOW RECORD        07890000
      ** OR FROM TSKST IF THE UOW DATA IS NOT CONTAINED ON THE INPUT    07900000
      ** RECORD. ONE OR THE OTHER QTY IS PUT INTO PV-ONHAND-QTY BEFORE  07910000
      ** THIS PARA IS EXECUTED.                                         07920000
           MOVE PV-ONHAND-QTY             TO  FS035-ADJ-QTY             07930000
           MOVE ' 888'                    TO  FS035-BTCH-NBR            07940000
           MOVE SPACE                     TO  FS035-UNT-BKG-IND         07950000
           MOVE 'PXKUT089'                TO  FS035-ADJ-SRC-PGM-NM      07960000
           PERFORM 8120-FS-UPDATE-FILE.                                 07970000
           INITIALIZE FS035-ADJUSTMENT-RECORD.                          07980000
                                                                        07990000
      ******************************************************************08000000
      * CREATE RECORD TO ML                                             08010000
      ******************************************************************08020000
       2400-CREATE-ML-REC.                                              08030000
           SET ML017-NORMAL-TRANS TO TRUE.                              08040000
           MOVE PXRD088-UNT-OF-WRK-DEV-ID (16:5) TO ML017-PC-DOC-5-NBR. 08050000
           MOVE PXRD088-UNT-OF-WRK-DEV-ID (14:7)                        08060000
                                          TO ML017-PC-DOC-7-NBR-PIC9.   08070000
           MOVE PXRD088-UOW-BEG-TMST (6:2) TO ML017-PC-DTE-MM.          08080000
           MOVE PXRD088-UOW-BEG-TMST (9:2) TO ML017-PC-DTE-DD.          08090000
           MOVE DPG56-FISCAL-PERIOD-NBR TO ML017-PC-KOHLS-MM.           08100000
           MOVE PXRD088-SKU-NBR     TO ML017-PC-SKU.                    08110000
           MOVE '4'                 TO ML017-PC-CDE.                    08120000
           MOVE '4'                 TO ML017-PC-RSN-CDE.                08130000
           SET ML017-STORE-MKDN-MKON TO TRUE.                           08140000
           MOVE PXRD088-OLD-UNT-RTL-AMT TO ML017-PC-OLD-PR-AMT.         08150000
           MOVE PXRD088-NEW-UNT-RTL-AMT TO ML017-PC-NEW-PR-AMT.         08160000
      ** THE ADJ QTY WILL EITHER USE THE QTY FROM THE UOW RECORD        08170000
      ** OR FROM TSKST IF THE UOW DATA IS NOT CONTAINED ON THE INPUT    08180000
      ** RECORD. ONE OR THE OTHER QTY IS PUT INTO PV-ONHAND-QTY BEFORE  08190000
      ** THIS PARA IS EXECUTED.                                         08200000
           MOVE PV-ONHAND-QTY       TO ML017-PC-QTY.                    08210000
           MOVE '888'               TO ML017-PC-BATCH-NBR.              08220000
           MOVE PXRD088-ML-TRN-CDE  TO ML017-PC-MKDN-MKUP-RSN-CDE.      08230000
           COMPUTE ML017-PC-DIFFER-AMT = PXRD088-OLD-UNT-RTL-AMT -      08240000
             PXRD088-NEW-UNT-RTL-AMT.                                   08250000
           COMPUTE ML017-PC-TOT-DOC-QTY = PXRD088-OLD-UNT-RTL-AMT *     08260000
             PXRD088-SCND-UNT-QTY.                                      08270000
           MOVE PXRD088-STR-NBR     TO ML017-PC-STORE-NBR.              08280000
           MOVE PXRD088-MOS-TRN-SCN-SEQ-NBR                             08290000
             TO ML017-PC-LINE-NBR.                                      08300000
           MOVE XST00013-SUB-CL-NBR TO ML017-PC-CLASS-NBR.              08310000
           MOVE XST00013-DEPT-NBR   TO ML017-PC-DEPT-NBR.               08320000
           MOVE XST00013-MAJ-CL-NBR TO ML017-PC-MAJ-CLASS.              08330000
           MOVE XST00013-ENT-ID     TO ML017-PC-ENT-ID.                 08340000
           PERFORM 8110-ML-UPDATE-FILE.                                 08350000
           INITIALIZE ML017-PRICE-CHANGE-RECORD.                        08360000
                                                                        08370000
      ******************************************************************08380000
      * CREATE REVERSAL RECORD TO ML                                    08390000
      ******************************************************************08400000
       2405-CREATE-ML-REV-REC.                                          08410000
           SET ML017-NORMAL-TRANS TO TRUE.                              08420000
           MOVE PXRD088-UNT-OF-WRK-DEV-ID (16:5) TO ML017-PC-DOC-5-NBR. 08430000
           MOVE PXRD088-UNT-OF-WRK-DEV-ID (14:7)                        08440000
                                          TO ML017-PC-DOC-7-NBR-PIC9.   08450000
           MOVE PXRD088-UOW-BEG-TMST (6:2) TO ML017-PC-DTE-MM.          08460000
           MOVE PXRD088-UOW-BEG-TMST (9:2) TO ML017-PC-DTE-DD.          08470000
           MOVE DPG56-FISCAL-PERIOD-NBR TO ML017-PC-KOHLS-MM.           08480000
           MOVE PXRD088-SKU-NBR     TO ML017-PC-SKU.                    08490000
           MOVE '4'                 TO ML017-PC-CDE.                    08500000
           MOVE '4'                 TO ML017-PC-RSN-CDE.                08510000
           SET ML017-STORE-MKDN-MKON TO TRUE.                           08520000
           MOVE PXRD088-NEW-UNT-RTL-AMT TO ML017-PC-OLD-PR-AMT.         08530000
           MOVE PXRD088-OLD-UNT-RTL-AMT TO ML017-PC-NEW-PR-AMT.         08540000
      ** THE ADJ QTY WILL EITHER USE THE QTY FROM THE UOW RECORD        08550000
      ** OR FROM TSKST IF THE UOW DATA IS NOT CONTAINED ON THE INPUT    08560000
      ** RECORD. ONE OR THE OTHER QTY IS PUT INTO PV-ONHAND-QTY BEFORE  08570000
      ** THIS PARA IS EXECUTED.                                         08580000
           MOVE PV-ONHAND-QTY       TO ML017-PC-QTY.                    08590000
           MOVE '888'               TO ML017-PC-BATCH-NBR.              08600000
           MOVE PXRD088-ML-TRN-CDE  TO ML017-PC-MKDN-MKUP-RSN-CDE.      08610000
           COMPUTE ML017-PC-DIFFER-AMT = PXRD088-OLD-UNT-RTL-AMT -      08620000
             PXRD088-NEW-UNT-RTL-AMT.                                   08630000
           COMPUTE ML017-PC-TOT-DOC-QTY = PXRD088-OLD-UNT-RTL-AMT *     08640000
             PXRD088-SCND-UNT-QTY.                                      08650000
           MOVE PXRD088-STR-NBR     TO ML017-PC-STORE-NBR.              08660000
           MOVE PXRD088-MOS-TRN-SCN-SEQ-NBR                             08670000
             TO ML017-PC-LINE-NBR.                                      08680000
           MOVE XST00013-SUB-CL-NBR TO ML017-PC-CLASS-NBR.              08690000
           MOVE XST00013-DEPT-NBR   TO ML017-PC-DEPT-NBR.               08700000
           MOVE XST00013-MAJ-CL-NBR TO ML017-PC-MAJ-CLASS.              08710000
           MOVE XST00013-ENT-ID     TO ML017-PC-ENT-ID.                 08720000
           PERFORM 8110-ML-UPDATE-FILE.                                 08730000
           INITIALIZE ML017-PRICE-CHANGE-RECORD.                        08740000
                                                                        08750000
      ******************************************************************08760000
      * CREATE RECORD TO UPDATE PXT-PRCHG-EXTR TABLE,                   08761000
      ******************************************************************08762000
       2500-PXT-PRCHG-EXTR-REC.                                         08763000
           MOVE PXRD088-STR-NBR         TO PXRD091-STR-NBR.             08763100
           MOVE PXRD088-SKU-NBR         TO PXRD091-SKU-NBR.             08763200
           MOVE PXRD088-UOW-TYP-CDE     TO PXRD091-UOW-TYP-CDE.         08763300
           MOVE PXRD088-SCND-UNT-QTY    TO PXRD091-PRCD-UNT-QTY.        08763400
           MOVE PXRD088-OLD-UNT-RTL-AMT TO PXRD091-OLD-UNT-RTL-AMT.     08763500
           MOVE PXRD088-NEW-UNT-RTL-AMT TO PXRD091-NEW-UNT-RTL-AMT.     08763600
           MOVE PV-TIMESTAMP            TO PXRD091-CRE-TMST.            08763700
           PERFORM 8160-PRCHG-EXTR-FILE.                                08763800
           MOVE 'Y'                     TO PXRD090-SYS-GEND-IND.        08763900
           PERFORM 2600-PXT-PRCHG-HIST-SUM-REC.                         08764000
                                                                        08765000
      ******************************************************************08766000
      * CREATE RECORD TO UPDATE PXT-PRCHG-HIST-SUM TABLE                08767000
      ******************************************************************08768000
       2600-PXT-PRCHG-HIST-SUM-REC.                                     08769000
           MOVE XST00016-BUS-AREA-ID      TO PXRD090-BUS-AREA-ID.       08770000
           MOVE XST00016-BUS-GP-NBR       TO PXRD090-BUS-GP-NBR.        08780000
           MOVE XST00013-DEPT-NBR         TO PXRD090-DEPT-NBR.          08790000
           MOVE XST00013-MAJ-CL-NBR       TO PXRD090-MAJ-CL-NBR.        08800000
           MOVE PXRD088-STR-NBR           TO PXRD090-STR-NBR.           08810000
           MOVE PXRD088-UOW-TYP-CDE       TO PXRD090-UOW-TYP-CDE.       08820000
           IF PXRD088-UOW-STAT-CDE = 'RA'                               08830000
             COMPUTE PXRD090-SCND-UNT-QTY = PXRD088-SCND-UNT-QTY * -1   08840000
032310       MOVE PC-YES                  TO PXRD090-MKDN-CANC-IND      08850000
           ELSE                                                         08860000
             MOVE PXRD088-SCND-UNT-QTY    TO PXRD090-SCND-UNT-QTY       08870000
032310       MOVE PC-NO                   TO PXRD090-MKDN-CANC-IND      08880000
032310     END-IF.                                                      08890000
           MOVE PXRD088-OLD-UNT-RTL-AMT   TO PXRD090-OLD-UNT-RTL-AMT.   08900000
           MOVE PXRD088-NEW-UNT-RTL-AMT   TO PXRD090-NEW-UNT-RTL-AMT.   08910000
           PERFORM 8150-PRCHG-HIST-SUM-FILE.                            08920000
                                                                        08930000
      ******************************************************************08940000
      * CHECKS EVENT DAYS TO DETERMINE ACTION BASED ON DAYS SINCE EVENT 08950000
      *  AND INVENTORY START DAYS.                                      08960000
      ******************************************************************08970000
       3000-CHECK-EVENT-DAYS.                                           08980000
           IF PXRD088-MOS-EVENT-NOT-FOUND                               08990000
             SET PS-NON-MOS TO TRUE                                     09000000
           ELSE                                                         09010000
      * THE FOLLOWING CONDITIONS ONLY APPLY TO RECORDS THAT HAVE ARE    09020000
      * DEFINED FOR AN MOS EVENT(PXRD088-MOS-EVENT-FOUND)               09030000
             IF PXRD088-DAYS-SINCE-INV-STRT = 1                         09040000
               AND PXRD088-DAYS-SINCE-EVENT = PC-MLFS-CTL-DAYS + 1      09050000
      * THIS INDICATES THAT INVENTORY STARTED YESTERDAY AND THE 'ZERO   09060000
      * OUT' FUNCTION WILL BE DELAYED UNTIL TOMORROW, IF NEEDED.        09070000
               SET PS-REPROCESS TO TRUE                                 09080000
               ADD 1 TO PXRD088-DAYS-SINCE-INV-STRT                     09090000
             ELSE                                                       09100000
C82519*        IF PXRD088-DAYS-SINCE-EVENT <  PC-MLFS-CTL-DAYS          09110038
C82519           SET PS-ML-AND-FS TO TRUE.                              09120038
C82519*        ELSE                                                     09130038
      *          IF PXRD088-DAYS-SINCE-EVENT = PC-MLFS-CTL-DAYS + 1     09140000
      *            AND PXRD088-UOW-STAT-CDE NOT > SPACE                 09150000
      *            SET PS-ZERO TO TRUE                                  09160000
      *          ELSE                                                   09170000
C82519*              SET PS-ML-ONLY TO TRUE.                            09180038
      ******************************************************************09190000
      * SELECT BUSINESS AREA                                            09200000
      ******************************************************************09210000
       5000-BUSINESS-AREA.                                              09220000
                                                                        09230000
           EXEC SQL                                                     09240000
            SELECT  D.DEPT_NBR                                          09250000
                   ,D.SUB_CL_NBR                                        09260000
                   ,D.MAJ_CL_NBR                                        09270000
                   ,D.ENT_ID                                            09280000
                   ,F.BUS_AREA_ID                                       09290000
                   ,F.BUS_GP_NBR                                        09300000
                                                                        09310000
            INTO   :XST00013-DEPT-NBR                                   09320000
                  ,:XST00013-SUB-CL-NBR                                 09330000
                  ,:XST00013-MAJ-CL-NBR                                 09340000
                  ,:XST00013-ENT-ID                                     09350000
                  ,:XST00016-BUS-AREA-ID                                09360000
                  ,:XST00016-BUS-GP-NBR                                 09370000
                                                                        09380000
            FROM   XST_SKU          C                                   09390000
                  ,XST_VND_STYL     D                                   09400000
                  ,XST_DEPT         E                                   09410000
                  ,XST_BUS_GP       F                                   09420000
                                                                        09430000
            WHERE C.SKU_NBR      = :XST00010-SKU-NBR                    09440000
              AND D.STYL_ID      = C.STYL_ID                            09450000
              AND E.DEPT_NBR     = D.DEPT_NBR                           09460000
              AND F.BUS_GP_NBR   = E.BUS_GP_NBR                         09470000
            WITH UR                                                     09480000
           END-EXEC.                                                    09490000
                                                                        09500000
           EVALUATE TRUE                                                09510000
             WHEN SQLCODE = +0                                          09520000
C22922         SET PS-DEPT-NOT-FOUND-NO TO TRUE                         09531031
             WHEN SQLCODE = +100                                        09540000
C22922         SET PS-DEPT-NOT-FOUND-YES TO TRUE                        09541031
             WHEN OTHER                                                 09560000
               MOVE SQLCODE TO PV-SQLCODE                               09570000
                                                                        09580000
               DISPLAY '                                 '              09590000
               DISPLAY '*********************************'              09600000
               DISPLAY 'PARAGRAPH     : 5000-BUSINESS-AREA'             09610000
               DISPLAY 'ERROR SELECTING BUSINESS AREA   '               09620000
               DISPLAY 'SQLCODE       : ' PV-SQLCODE                    09630000
               DISPLAY '*********************************'              09640000
               DISPLAY '                                 '              09650000
                                                                        09660000
               STRING 'ERROR SELECTING BUSINESS AREA SQLCODE= '         09670000
                      PV-SQLCODE DELIMITED BY SIZE INTO                 09680000
                      PV-OPERATION-MSG                                  09690000
               END-STRING                                               09700000
                                                                        09710000
               MOVE '5000-BUSINESS-AREA' TO PV-PARA-NAME                09720000
                                                                        09730000
               PERFORM 9999-SQL-ERROR                                   09740000
                                                                        09750000
           END-EVALUATE.                                                09760000
C22922******************************************************************09761031
C22922* CHECKING VALID DEPT                                             09762031
C22922******************************************************************09763031
C22922 5001-CHECK-VALID-DEPT.                                           09764031
C22922                                                                  09765031
C22922     EXEC SQL                                                     09766031
C22922      SELECT   '1'                                                09767031
C22922      INTO    :PV-ROW-EXIST                                       09769631
C22922      FROM   XST_DEPT         D                                   09770231
C22922      WHERE D.DEPT_NBR     = :XST00013-DEPT-NBR                   09770731
C22922      WITH UR                                                     09771231
C22922     END-EXEC.                                                    09771331
C22922                                                                  09771431
C22922     EVALUATE TRUE                                                09771531
C22922       WHEN SQLCODE = +0                                          09771631
C22922         SET PS-DEPT-VALID TO TRUE                                09771731
C22922       WHEN SQLCODE = +100                                        09771831
C22922         SET PS-DEPT-INVALID TO TRUE                              09771931
C22922       WHEN OTHER                                                 09772131
C22922         MOVE SQLCODE TO PV-SQLCODE                               09772231
C22922                                                                  09772331
C22922         DISPLAY '                                 '              09772431
C22922         DISPLAY '*********************************'              09772531
C22922         DISPLAY 'PARAGRAPH : 5001-CHECK-VALID-DEPT'              09772631
C22922         DISPLAY 'ERROR CHECKING ON VALID DEPT    '               09772731
C22922         DISPLAY 'SQLCODE       : ' PV-SQLCODE                    09772831
C22922         DISPLAY '*********************************'              09772931
C22922         DISPLAY '                                 '              09773031
C22922                                                                  09773131
C22922         STRING 'ERROR CHECKING ON VALID DEPT SQLCODE= '          09773231
C22922                PV-SQLCODE DELIMITED BY SIZE INTO                 09773331
C22922                PV-OPERATION-MSG                                  09773431
C22922         END-STRING                                               09773531
C22922                                                                  09773631
C22922         MOVE '5001-CHECK-VALID-DEPT' TO PV-PARA-NAME             09773731
C22922                                                                  09773831
C22922         PERFORM 9999-SQL-ERROR                                   09773931
C22922                                                                  09774031
C22922     END-EVALUATE.                                                09774131
C22922                                                                  09775031
C22922******************************************************************09776031
C22922* SELECT BUSINESS AREA                                            09777031
C22922******************************************************************09778031
C22922 5002-BUSINESS-AREA-DEPT.                                         09779031
C22922                                                                  09779131
C22922     EXEC SQL                                                     09779231
C22922      SELECT   G.BUS_AREA_ID                                      09779431
C22922              ,G.BUS_GP_NBR                                       09779531
C22922      INTO    :XST00016-BUS-AREA-ID                               09779731
C22922             ,:XST00016-BUS-GP-NBR                                09779931
C22922      FROM   XST_DEPT         D                                   09780131
C22922            ,XST_BUS_GP       G                                   09780231
C22922      WHERE D.DEPT_NBR     = :XST00013-DEPT-NBR                   09780431
C22922        AND D.BUS_GP_NBR   = G.BUS_GP_NBR                         09780631
C22922      WITH UR                                                     09780831
C22922     END-EXEC.                                                    09780931
C22922                                                                  09781031
C22922     EVALUATE TRUE                                                09781131
C22922       WHEN SQLCODE = +0                                          09781231
C22922         CONTINUE                                                 09781431
C22922       WHEN OTHER                                                 09781731
C22922         MOVE SQLCODE TO PV-SQLCODE                               09781831
C22922                                                                  09781931
C22922         DISPLAY '                                 '              09782031
C22922         DISPLAY '************************************'           09782131
C22922         DISPLAY 'PARAGRAPH  :5002-BUSINESS-AREA-DEPT'            09782231
C22922         DISPLAY 'ERROR SELECTING BUSINESS GROUP  '               09782331
C22922         DISPLAY 'SQLCODE       : ' PV-SQLCODE                    09782431
C22922         DISPLAY '************************************'           09782531
C22922         DISPLAY '                                    '           09782631
C22922                                                                  09782731
C22922         STRING 'ERROR SELECTING BUSNIESS AREA SQLCODE= '         09782831
C22922                PV-SQLCODE DELIMITED BY SIZE INTO                 09782931
C22922                PV-OPERATION-MSG                                  09783031
C22922         END-STRING                                               09783131
C22922                                                                  09783231
C22922         MOVE '5002-BUSINESS-AREA-DEPT' TO PV-PARA-NAME           09783331
C22922                                                                  09783431
C22922         PERFORM 9999-SQL-ERROR                                   09783531
C22922                                                                  09783631
C22922     END-EVALUATE.                                                09783731
C22922                                                                  09783831
C22922******************************************************************09784031
C22922*CHECKING VALID SUB CLASS ENTERED                                 09784131
C22922******************************************************************09785031
C22922 5003-CHECK-VALID-SL.                                             09786031
C22922                                                                  09787031
C22922     EXEC SQL                                                     09788031
C22922      SELECT C.MAJ_CL_NBR                                         09789031
C22922      INTO   :XST00013-MAJ-CL-NBR                                 09789431
C22922      FROM   XST_SUB_CL       C                                   09789731
C22922            ,XST_DEPT         D                                   09789831
C22922      WHERE D.DEPT_NBR     = :XST00013-DEPT-NBR                   09790131
C22922        AND C.SUB_CL_NBR   = :XST00013-SUB-CL-NBR                 09790231
C22922        AND D.DEPT_NBR     = C.DEPT_NBR                           09790431
C22922      WITH UR                                                     09790531
C22922     END-EXEC.                                                    09790631
C22922                                                                  09790731
C22922     EVALUATE TRUE                                                09790831
C22922       WHEN SQLCODE = +0                                          09790931
C22922         SET PS-SL-VALID TO TRUE                                  09791031
C22922       WHEN SQLCODE = +100                                        09791131
C22922         SET PS-SL-INVALID TO TRUE                                09791231
C22922       WHEN OTHER                                                 09791331
C22922         MOVE SQLCODE TO PV-SQLCODE                               09791431
C22922                                                                  09791531
C22922         DISPLAY '                                 '              09791631
C22922         DISPLAY '*********************************'              09791731
C22922         DISPLAY 'PARAGRAPH  : 5003-CHECK-VALIDT-SL'              09791831
C22922         DISPLAY 'ERROR SELECTING MAJOR CLASS     '               09791931
C22922         DISPLAY 'SQLCODE       : ' PV-SQLCODE                    09792031
C22922         DISPLAY '*********************************'              09792131
C22922         DISPLAY '                                 '              09792231
C22922                                                                  09792331
C22922         STRING 'ERROR SELECTING BUSINESS AREA SQLCODE= '         09792431
C22922                PV-SQLCODE DELIMITED BY SIZE INTO                 09792531
C22922                PV-OPERATION-MSG                                  09792631
C22922         END-STRING                                               09792731
C22922                                                                  09792831
C22922         MOVE '5003-CHECK-VALIDT-SL' TO PV-PARA-NAME              09792931
C22922                                                                  09793031
C22922         PERFORM 9999-SQL-ERROR                                   09793131
C22922                                                                  09793231
C22922     END-EVALUATE.                                                09793331
C22922                                                                  09793431
      * SELECT ONHAND QTY                                               09794000
      ******************************************************************09800000
       5010-ONHAND-QTY.                                                 09810000
                                                                        09820000
           EXEC SQL                                                     09830000
            SELECT  A.ONHAND_QTY                                        09840000
                   ,A.ITEM_NMBR                                         09850000
            INTO  :TSKST-ONHAND-QTY                                     09860000
                 ,:SKXREF-ITM-NBR                                       09870000
                                                                        09880000
            FROM TSKST    A                                             09890000
                ,TSKXREF  B                                             09900000
                                                                        09910000
            WHERE B.SKU        = :SKXREF-SKU                            09920000
             AND  A.LOC_NBR    = :TSKST-LOC-NBR                         09930000
             AND  A.ITEM_NMBR  = B.ITM_NBR                              09940000
            WITH UR                                                     09950000
           END-EXEC.                                                    09960000
                                                                        09970000
           EVALUATE TRUE                                                09980000
             WHEN SQLCODE = +0                                          09990000
               CONTINUE                                                 10000000
             WHEN SQLCODE = +100                                        10010000
               MOVE 0 TO TSKST-ONHAND-QTY                               10020000
               DISPLAY 'ONHAND QTY NOT FOUND - ' SKXREF-SKU ' - '       10040000
                                                 TSKST-LOC-NBR          10050000
CHG959         PERFORM 5015-GET-ITEM-NUMBER                             10051047
             WHEN OTHER                                                 10060000
               MOVE SQLCODE TO PV-SQLCODE                               10070000
                                                                        10080000
               DISPLAY '                                 '              10090000
               DISPLAY '*********************************'              10100000
               DISPLAY 'PARAGRAPH     : 5010-ONHAND-QTY  '              10110000
               DISPLAY 'ERROR SELECTING ONHAND QTY      '               10120000
               DISPLAY 'SQLCODE       : ' PV-SQLCODE                    10130000
               DISPLAY '*********************************'              10140000
               DISPLAY '                                 '              10150000
                                                                        10160000
               STRING 'ERROR SELECTING ONHAND QTY SQLCODE= '            10170000
                      PV-SQLCODE DELIMITED BY SIZE INTO                 10180000
                      PV-OPERATION-MSG                                  10190000
               END-STRING                                               10200000
                                                                        10210000
               MOVE '5010-ONHAND-QTY' TO PV-PARA-NAME                   10220000
                                                                        10230000
               PERFORM 9999-SQL-ERROR                                   10240000
                                                                        10250000
           END-EVALUATE.                                                10260000
                                                                        10270000
CHG959******************************************************************10270147
CHG959* SELECT ITEM NUMBER                                              10271047
CHG959******************************************************************10272047
CHG959 5015-GET-ITEM-NUMBER.                                            10273047
CHG959                                                                  10274047
CHG959     EXEC SQL                                                     10275047
CHG959      SELECT A.ITM_NBR                                            10276047
CHG959        INTO :SKXREF-ITM-NBR                                      10278047
CHG959        FROM TSKXREF  A                                           10279247
CHG959      WHERE A.SKU        = :SKXREF-SKU                            10279547
CHG959      WITH UR                                                     10279947
CHG959     END-EXEC.                                                    10280047
CHG959                                                                  10280147
CHG959     EVALUATE TRUE                                                10280247
CHG959       WHEN SQLCODE = +0                                          10280347
CHG959         CONTINUE                                                 10280447
CHG959       WHEN SQLCODE = +100                                        10280547
CHG959         DISPLAY 'ITEM NUMBER NOT FOUND IN TSKXREF TABLE : '      10280647
CHG959         DISPLAY 'SKU NUMBER - ' SKXREF-SKU                       10280847
CHG959         DISPLAY 'LOC NMR - ' TSKST-LOC-NBR                       10280947
CHG959         CONTINUE                                                 10281047
CHG959       WHEN OTHER                                                 10281147
CHG959         DISPLAY 'ITEM NUMBER NOT FOUND - ' SKXREF-SKU ' - '      10281247
CHG959         MOVE SQLCODE TO PV-SQLCODE                               10281347
CHG959                                                                  10281447
CHG959         DISPLAY '                                 '              10281547
CHG959         DISPLAY '*************************************'          10281647
CHG959         DISPLAY 'PARAGRAPH     : 5015-GET-ITEM-NUMBER '          10281747
CHG959         DISPLAY 'ERROR SELECTING ITEM NUMBER '                   10281847
CHG959         DISPLAY 'SQLCODE       : ' PV-SQLCODE                    10281947
CHG959         DISPLAY '*************************************'          10282047
CHG959         DISPLAY '                                 '              10282147
CHG959                                                                  10282247
CHG959         STRING 'ERROR SELECTING ITEM NUMBER SQLCODE= '           10282347
CHG959                PV-SQLCODE DELIMITED BY SIZE INTO                 10282447
CHG959                PV-OPERATION-MSG                                  10282547
CHG959         END-STRING                                               10282647
CHG959                                                                  10282747
CHG959         MOVE '5015-GET-ITEM-NUMBER' TO PV-PARA-NAME              10282847
CHG959                                                                  10282947
CHG959         PERFORM 9999-SQL-ERROR                                   10283047
CHG959                                                                  10283147
CHG959     END-EVALUATE.                                                10283247
      ******************************************************************10284000
      * SELECT UNIT RETAIL AMOUNT FOR SPECFIC STORE                     10290000
      ******************************************************************10300000
       5020-UNIT-RETAIL-AMOUNT.                                         10310000
                                                                        10320000
           EXEC SQL                                                     10330000
            SELECT  UNT_RTL_AMT                                         10340000
                   ,UNT_COST_AMT                                        10350000
                                                                        10360000
            INTO  :XST00008-UNT-RTL-AMT                                 10370000
                 ,:XST00008-UNT-COST-AMT                                10380000
                                                                        10390000
            FROM XST_SKU_LOC A                                          10400000
                ,XST_SKU     B                                          10410000
                                                                        10420000
            WHERE A.LOC_NBR     = :XST00008-LOC-NBR                     10430000
             AND  A.BEG_TMST   <= CURRENT TIMESTAMP                     10440000
             AND (A.END_TMST    > CURRENT TIMESTAMP                     10450000
              OR  A.END_TMST    IS NULL)                                10460000
             AND  B.SKU_NBR     = :XST00010-SKU-NBR                     10470000
             AND  A.INTR_UPC_ID = B.INTR_UPC_ID                         10480000
            WITH UR                                                     10490000
           END-EXEC.                                                    10500000
                                                                        10510000
           EVALUATE TRUE                                                10520000
             WHEN SQLCODE = +0                                          10530000
               CONTINUE                                                 10540000
             WHEN SQLCODE = +100                                        10550000
               PERFORM 5030-UNIT-RETAIL-AMOUNT-STR-0                    10560000
             WHEN OTHER                                                 10570000
               MOVE SQLCODE TO PV-SQLCODE                               10580000
                                                                        10590000
               DISPLAY '                                 '              10600000
               DISPLAY '*********************************'              10610000
               DISPLAY 'PARAGRAPH     : 5020-UNIT-RETAIL-AMOUNT'        10620000
               DISPLAY 'ERROR SELECTING RETAIL AMT      '               10630000
               DISPLAY 'SQLCODE       : ' PV-SQLCODE                    10640000
               DISPLAY '*********************************'              10650000
               DISPLAY '                                 '              10660000
                                                                        10670000
               STRING 'ERROR SELECTING RETAIL AMT SQLCODE= '            10680000
                      PV-SQLCODE DELIMITED BY SIZE INTO                 10690000
                      PV-OPERATION-MSG                                  10700000
               END-STRING                                               10710000
                                                                        10720000
               MOVE '5020-UNIT-RETAIL-AMOUNT' TO PV-PARA-NAME           10730000
                                                                        10740000
               PERFORM 9999-SQL-ERROR                                   10750000
                                                                        10760000
           END-EVALUATE.                                                10770000
                                                                        10780000
      ******************************************************************10790000
      * SELECT UNIT RETAIL AMOUNT FOR STORE ZERO                        10800000
      ******************************************************************10810000
       5030-UNIT-RETAIL-AMOUNT-STR-0.                                   10820000
                                                                        10830000
           EXEC SQL                                                     10840000
            SELECT  UNT_RTL_AMT                                         10850000
                   ,UNT_COST_AMT                                        10860000
                                                                        10870000
            INTO  :XST00008-UNT-RTL-AMT                                 10880000
                 ,:XST00008-UNT-COST-AMT                                10890000
                                                                        10900000
            FROM XST_SKU_LOC A                                          10910000
                ,XST_SKU     B                                          10920000
                                                                        10930000
            WHERE A.LOC_NBR     = 0                                     10940000
             AND  A.BEG_TMST   <= CURRENT TIMESTAMP                     10950000
             AND (A.END_TMST    > CURRENT TIMESTAMP                     10960000
              OR  A.END_TMST    IS NULL)                                10970000
             AND  B.SKU_NBR     = :XST00010-SKU-NBR                     10980000
             AND  A.INTR_UPC_ID = B.INTR_UPC_ID                         10990000
            WITH UR                                                     11000000
           END-EXEC.                                                    11010000
                                                                        11020000
           EVALUATE TRUE                                                11030000
             WHEN SQLCODE = +0                                          11040000
               CONTINUE                                                 11050000
             WHEN SQLCODE = +100                                        11060000
               DISPLAY 'RETAIL AMT NOT FOUND - ' XST00008-LOC-NBR       11070000
                                      ' - '      XST00010-SKU-NBR       11080000
               MOVE 0 TO XST00008-UNT-RTL-AMT                           11090000
                         XST00008-UNT-COST-AMT                          11100000
             WHEN OTHER                                                 11110000
               MOVE SQLCODE TO PV-SQLCODE                               11120000
                                                                        11130000
               DISPLAY '                                 '              11140000
               DISPLAY '*********************************'              11150000
               DISPLAY 'PARAGRAPH     : 5020-UNIT-RETAIL-AMOUNT'        11160000
               DISPLAY 'ERROR SELECTING RETAIL AMT      '               11170000
               DISPLAY 'SQLCODE       : ' PV-SQLCODE                    11180000
               DISPLAY '*********************************'              11190000
               DISPLAY '                                 '              11200000
                                                                        11210000
               STRING 'ERROR SELECTING RETAIL AMT SQLCODE= '            11220000
                      PV-SQLCODE DELIMITED BY SIZE INTO                 11230000
                      PV-OPERATION-MSG                                  11240000
               END-STRING                                               11250000
                                                                        11260000
               MOVE '5020-UNIT-RETAIL-AMOUNT' TO PV-PARA-NAME           11270000
                                                                        11280000
               PERFORM 9999-SQL-ERROR                                   11290000
                                                                        11300000
           END-EVALUATE.                                                11310000
                                                                        11320000
      ******************************************************************11330000
      *  READ INPUT EOW FILE                                           *11340000
      ******************************************************************11350000
       8000-READ-IN-FILE.                                               11360000
           ADD 1 TO PV-NBR-OF-INPUT-RECS.                               11370000
           READ IN-FILE INTO PXRD088-MERGED-EVENT-UOW-FILE              11380000
             AT END                                                     11390000
               SET PS-END-OF-IN-FILE TO TRUE.                           11400000
                                                                        11410000
      ******************************************************************11420000
      *  READ MLFS CONTROL FILE                                        *11430000
      ******************************************************************11440000
       8050-READ-MLFS-CONTROL-FILE.                                     11450000
           READ MLFS-CONTROL-FILE INTO PV-MLFS-CONTROL-REC              11460000
             AT END                                                     11470000
               SET PS-END-OF-MLFS-CTL-FILE TO TRUE.                     11480000
           IF PS-END-OF-MLFS-CTL-FILE                                   11490000
            DISPLAY 'NO MLFS CONTROL REC-DEFAULT USED' UPON CONSOLE     11500000
            MOVE 8                         TO PC-MLFS-CTL-DAYS          11510000
           ELSE                                                         11520000
            MOVE PV-MLFS-CTL-DAYS-IN       TO PC-MLFS-CTL-DAYS.         11530000
           DISPLAY 'MLFS CONTROL PARM ' PC-MLFS-CTL-DAYS.               11540000
                                                                        11550000
      ******************************************************************11560000
      *  WRITE REPROCESS OUT FILE                                     * 11570000
      ******************************************************************11580000
       8100-WRITE-REPROCESS-OUT-FILE.                                   11590000
           ADD 1 TO PV-NBR-OF-REPROCESS-RECS.                           11600000
           WRITE REPROCESS-OUT-RECORD FROM                              11610000
             PXRD088-MERGED-EVENT-UOW-FILE.                             11620000
                                                                        11630000
      ******************************************************************11640000
      *  WRITE ML-UPDATE-FILE                                         * 11650000
      ******************************************************************11660000
       8110-ML-UPDATE-FILE.                                             11670000
           ADD 1 TO PV-NBR-OF-ML-RECS.                                  11680000
           WRITE ML-UPDATE-RECORD FROM                                  11690000
             ML017-PRICE-CHANGE-RECORD.                                 11700000
                                                                        11710000
      ******************************************************************11720000
      *  WRITE FS-UPDATE-FILE                                         * 11730000
      ******************************************************************11740000
       8120-FS-UPDATE-FILE.                                             11750000
           ADD 1 TO PV-NBR-OF-FS-RECS.                                  11760000
           WRITE FS-UPDATE-RECORD FROM                                  11770000
             FS035-ADJUSTMENT-RECORD.                                   11780000
                                                                        11790000
      ******************************************************************11800000
      *  WRITE FS-ZERO-FILE                                           * 11810000
      ******************************************************************11820000
       8130-FS-ZERO-FILE.                                               11830000
           ADD 1 TO PV-NBR-OF-FS-ZERO-RECS.                             11840000
           IF FS035-ADJ-QTY NOT = 0                                     11850000
             WRITE FS-ZERO-RECORD FROM                                  11860000
               FS035-ADJUSTMENT-RECORD                                  11870000
           ELSE                                                         11880000
             ADD 1 TO PV-NBR-ZERO-OH-CNT.                               11890000
                                                                        11891000
      ******************************************************************11892000
      *  WRITE PRCHG-HIST-FILE                                        * 11893000
      ******************************************************************11894000
       8140-PRCHG-HIST-FILE.                                            11895000
           ADD 1 TO PV-NBR-OF-PRCHG-HIST-RECS.                          11896000
           WRITE PRCHG-HIST-RECORD FROM                                 11897000
             PXRD089-PRCHG-HIST-UPD-FILE.                               11898000
                                                                        11899000
      ******************************************************************11900000
      *  WRITE PRCHG-HIST-SUM-FILE                                    * 11910000
      ******************************************************************11920000
       8150-PRCHG-HIST-SUM-FILE.                                        11930000
           ADD 1 TO PV-NBR-OF-PRCHG-SUM-RECS.                           11940000
           WRITE PRCHG-HIST-SUM-RECORD FROM                             11950000
             PXRD090-PRCHG-HIST-SUM-FILE.                               11960000
                                                                        11970000
      ******************************************************************11980000
      *  WRITE PRCHG-EXTR-FILE                                        * 11990000
      ******************************************************************12000000
       8160-PRCHG-EXTR-FILE.                                            12010000
           ADD 1 TO PV-NBR-OF-PRCHG-EXTR-RECS.                          12020000
           WRITE PRCHG-EXTR-RECORD FROM                                 12030000
             PXRD091-PRCHG-EXTR-UPD-FILE.                               12040000
                                                                        12050000
      ******************************************************************12060000
      *  WRITE PRCHG-EXTR-FILE                                        * 12070000
      ******************************************************************12080000
       8170-WHSE-FS-ZERO-FILE.                                          12090000
           ADD 1 TO PV-NBR-OF-PRCHG-WHSE-RECS.                          12100000
           WRITE WHSE-FS-ZERO-REC FROM                                  12110000
             PXRD093-ZERO-FILE.                                         12120000
                                                                        12130000
      ******************************************************************12140000
      *  CLOSE FILES, DISPLAY COUNTERS                                 *12150000
      ******************************************************************12160000
       9000-END-OF-JOB.                                                 12170000
           SUBTRACT 1 FROM PV-NBR-OF-INPUT-RECS.                        12180000
           DISPLAY 'NBR OF INPUT RECS READ        - '                   12190000
                   PV-NBR-OF-INPUT-RECS.                                12200000
           DISPLAY 'NBR OF REPROCESS RECS WRITTEN - '                   12210000
                   PV-NBR-OF-REPROCESS-RECS.                            12220000
           DISPLAY 'NBR OF ML RECS WRITTEN        - '                   12230000
                   PV-NBR-OF-ML-RECS.                                   12240000
           DISPLAY 'NBR OF FS RECS WRITTEN        - '                   12250000
                   PV-NBR-OF-FS-RECS.                                   12260000
           DISPLAY 'NBR OF MLFS ZERO RECS WRITTEN - '                   12270000
                   PV-NBR-OF-FS-ZERO-RECS.                              12280000
           DISPLAY 'NBR OF PRCHG HIST WRITTEN     - '                   12290000
                   PV-NBR-OF-PRCHG-HIST-RECS.                           12300000
           DISPLAY 'NBR OF PRCHG SUM WRITTEN      - '                   12310000
                   PV-NBR-OF-PRCHG-SUM-RECS.                            12320000
           DISPLAY 'NBR OF PRCHG EXTR WRITTEN     - '                   12330000
                   PV-NBR-OF-PRCHG-EXTR-RECS.                           12340000
           DISPLAY 'NBR OF PRCHG WHSE WRITTEN     - '                   12350000
                   PV-NBR-OF-PRCHG-WHSE-RECS.                           12360000
           DISPLAY 'NBR OF FS ZERO RECS NOT WRITTEN - '                 12370000
                   PV-NBR-ZERO-OH-CNT.                                  12380000
           CLOSE IN-FILE                                                12390000
                 MLFS-CONTROL-FILE                                      12400000
                 REPROCESS-OUT-FILE                                     12410000
                 ML-UPDATE-FILE                                         12420000
                 FS-UPDATE-FILE                                         12430000
                 FS-ZERO-FILE                                           12440000
                 PRCHG-HIST-FILE                                        12450000
                 PRCHG-HIST-SUM-FILE                                    12460000
                 PRCHG-EXTR-FILE                                        12470000
                 WHSE-FS-ZERO-FILE.                                     12480000
      *                                                                 12490000
                                                                        12500000
      ******************************************************************12510000
      * 9900-GET-DATE-TIME - GET THE CURRENT DATE AND TIME FROM DB2   * 12520000
      ******************************************************************12530000
       9900-GET-DATE-TIME.                                              12540000
           MOVE '*9900-GET-DATE-TIME.             *' TO PV-PARA-NAME.   12550000
                                                                        12560000
           EXEC SQL                                                     12570000
               SET :SA-CURRENT-DATE = CURRENT DATE                      12580000
           END-EXEC.                                                    12590000
                                                                        12600000
           EXEC SQL                                                     12610000
               SET :SA-CURRENT-TIME = CURRENT TIME                      12620000
           END-EXEC.                                                    12630000
                                                                        12640000
           EVALUATE TRUE                                                12650000
               WHEN SQLCODE = ZERO                                      12660000
                   MOVE SA-CURR-YEAR       TO SD-SYSTEM-YEAR            12670000
                   MOVE SA-CURR-MONTH      TO SD-SYSTEM-MONTH           12680000
                   MOVE SA-CURR-DAY        TO SD-SYSTEM-DAY             12690000
                   MOVE SA-CURR-HOUR       TO ST-SYSTEM-HOUR            12700000
                   MOVE SA-CURR-MINUTE     TO ST-SYSTEM-MINUTE          12710000
               WHEN OTHER                                               12720000
                   PERFORM 9999-SQL-ERROR                               12730000
           END-EVALUATE.                                                12740000
                                                                        12750000
       9999-SQL-ERROR.                                                  12760000
      ******************************************************************12770000
      * ABEND ROUTINE FOR BAD SQL CALLS                               * 12780000
      ******************************************************************12790000
           DISPLAY '** ABEND **          = SQL ERROR'.                  12800000
           DISPLAY '** PROGRAM **        = PXKUT089'                    12810000
           DISPLAY '** PARAGRAPH **      = ' PV-PARA-NAME               12820000
      *                                                                 12830000
      ******************************************************************12840000
      * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    12850000
      * MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         12860000
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     12870000
      * FORMAT.                                                         12880000
      ******************************************************************12890000
            COPY DPPD004.                                               12900000
      *                                                                 12910000
           MOVE +4013                      TO ABEND-CODE.               12920000
           CALL 'ILBOABN0' USING ABEND-CODE.                            12930000
                                                                        12940000
