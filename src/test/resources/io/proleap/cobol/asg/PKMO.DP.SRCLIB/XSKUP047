000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    XSKUP047.                                         00020000
000300 AUTHOR.        BARB ERTL.                                        00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  11/01/2002.                                       00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800**       WH STORE ASSIGN MESSAGE TO POPULATE XST_DC_LOC_ASGMT     00080000
000900******************************************************************00090000
001000**THIS IS A CALLED MODULE FOR LOCATION TABLES.  THIS PROGRAM      00100000
001100**     WILL PERFORM UPDATES/INSERTS/DELETES FOR THE               00110000
001200**     XST_DC_LOC_ASGMT TABLE.  IT DOES THE FOLLOWING WITH        00120000
001300**     THESE RETURN CODES:                                        00130000
001400**     0000 - END PROGRAM                                         00140000
001500**    -0530 - END PROGRAM                                         00150000
001600**    -0803 - END PROGRAM                                         00160000
001700**    -0911 - RETRY INSERT UP TO 5 TIMES AND THEN END PROGRAM     00170000
001800******************************************************************00180000
001900 ENVIRONMENT DIVISION.                                            00190000
002000 CONFIGURATION SECTION.                                           00200000
002100 SOURCE-COMPUTER.  IBM-3090.                                      00210000
002200 OBJECT-COMPUTER.  IBM-3090.                                      00220000
002300 DATA DIVISION.                                                   00230000
002400                                                                  00240000
002500 WORKING-STORAGE SECTION.                                         00250000
002600******************************************************************00260000
002700**PROGRAM SWITCHES                                                00270000
002800******************************************************************00280000
002900 01  PS-PROGRAM-SWITCHES.                                         00290000
003000     05  PS-PROCESS-CONTINUE-SW      PIC X(01)  VALUE 'Y'.        00300000
003100         88  PS-PROCESS-CONTINUE                VALUE 'Y'.        00310000
003200         88  PS-PROCESS-COMPLETE                VALUE 'N'.        00320000
003300******************************************************************00330000
003400**PROGRAM CONSTANTS                                               00340000
003500******************************************************************00350000
003600 01  PC-PROGRAM-CONSTANTS.                                        00360000
003700     05  PC-RETRY-MAX                PIC 9(01)  VALUE 5.          00370000
003800******************************************************************00380000
003900**PROGRAM VARIABLES                                               00390000
004000******************************************************************00400000
004100 01  PV-PROGRAM-VARIABLES.                                        00410000
004200     05  PV-RETRY-COUNTER            PIC 9(01)  VALUE ZEROS.      00420000
004300     05  PV-RETURN-CODE              PIC S9(04) VALUE 0.          00430008
004400******************************************************************00440000
004500**COPYBOOKS                                                       00450000
004600******************************************************************00460000
004700***DB2 MESSAGE AREA                                               00470000
004800     COPY SQLCA2.                                                 00480016
004900***MESSAGE COPYBOOK                                               00490000
005000     COPY HORD100.                                                00500016
005100******************************************************************00510000
005200**TABLE INCLUSIONS                                                00520000
005300******************************************************************00530000
005400***DB2 COMMUNICATIONS AREA                                        00540000
005500     EXEC SQL                                                     00550000
005600          INCLUDE SQLCA                                           00560000
005700     END-EXEC.                                                    00570000
005800* ------------------------------------------------------------- * 00580000
005900*  SQL AND COBOL DECLARATIONS FOR DC LOCATION ASSIGNMENT TABLE    00590010
006000*  XST_DC_LOC_ASGMT                                               00600000
006100* ------------------------------------------------------------- * 00610000
006200     EXEC SQL                                                     00620000
006300         INCLUDE XST00020                                         00630000
006400     END-EXEC.                                                    00640000
006500                                                                  00650000
006600 LINKAGE SECTION.                                                 00660000
006700******************************************************************00670000
006800**LINKAGE VARIABLES                                               00680000
006900******************************************************************00690000
007000 01  LV-LINKAGE-VARIABLES.                                        00700000
007100     05  LV-HORD100-RECORD               PIC X(500).              00710000
007200     05  LV-RETURN-CODE                  PIC S9(04).              00720000
007300                                                                  00730000
007400 PROCEDURE DIVISION USING LV-LINKAGE-VARIABLES.                   00740000
007500******************************************************************00750000
007600 0000-MAINLINE.                                                   00760000
007700                                                                  00770000
007800      PERFORM 1000-INITIALIZATION.                                00780000
007900      PERFORM 2000-PROCESS-MESSAGE                                00790000
008000              UNTIL PS-PROCESS-COMPLETE.                          00800000
008100      PERFORM 9999-WRAPUP.                                        00810000
008200                                                                  00820000
008300***************************************************************** 00830000
008400**INITIALIZATION AREA - ALL MOVES TO UPDATE/INSERT                00840000
008500***************************************************************** 00850000
008600 1000-INITIALIZATION.                                             00860000
008700                                                                  00870000
008800     INITIALIZE PV-RETRY-COUNTER.                                 00880000
008900                                                                  00890000
009000     SET PS-PROCESS-CONTINUE         TO TRUE.                     00900003
009100                                                                  00910003
009200     MOVE LV-HORD100-RECORD          TO HORD100-RECORD.           00920000
009300                                                                  00930000
009400     IF HO100-SA-ASSIGN-DATE = HO100-SA-OLD-ASSIGN-DATE           00940003
009500         IF HO100-SA-WH = HO100-SA-OLD-WH                         00950003
009600             SET PS-PROCESS-COMPLETE TO TRUE                      00960003
009700         END-IF                                                   00970003
009800     END-IF.                                                      00980003
009900                                                                  00990003
010000     IF PS-PROCESS-CONTINUE                                       01000003
010100         MOVE HO100-SA-STORE-NUMBER      TO XST00020-LOC-NBR      01010003
010200         MOVE HO100-SA-ASSIGN-DATE       TO XST00020-EFF-BEG-DTE  01020003
010300         MOVE HO100-SA-WH                TO XST00020-DC-NBR       01030003
010400     END-IF.                                                      01040003
010500***************************************************************** 01050000
010600**MAIN PROGRAM LOGIC - READS ACTION TYPE ON HORD100 RECORD        01060000
010700***************************************************************** 01070000
010800 2000-PROCESS-MESSAGE.                                            01080000
010900                                                                  01090000
011000     EVALUATE TRUE                                                01100000
011100        WHEN HO100-ACTN-TYP-INSERT                                01110000
011200             PERFORM 2100-INSERT-DATA                             01120000
011300        WHEN HO100-ACTN-TYP-UPDATE                                01130000
011400*  WAREHOUSE HAS CHANGED FOR BEGINNING DATE                       01140012
011500             IF HO100-SA-ASSIGN-DATE = HO100-SA-OLD-ASSIGN-DATE   01150005
011600                 PERFORM 2200-UPDATE-DATA                         01160005
011700             ELSE                                                 01170005
011800*  BEGINNING DATE CHANGED                                         01180012
011900                 IF HO100-SA-WH = HO100-SA-OLD-WH                 01190005
012000                     MOVE HO100-SA-OLD-ASSIGN-DATE TO             01200006
012100                               XST00020-EFF-BEG-DTE               01210005
012200                     PERFORM 2300-DELETE-DATA                     01220005
012300                     MOVE HO100-SA-ASSIGN-DATE TO                 01230005
012400                               XST00020-EFF-BEG-DTE               01240005
012500                     PERFORM 2100-INSERT-DATA                     01250005
012600                 END-IF                                           01260012
012700             END-IF                                               01270005
012800                                                                  01280005
012900        WHEN HO100-ACTN-TYP-DELETE                                01290000
013000             PERFORM 2300-DELETE-DATA                             01300001
013100     END-EVALUATE.                                                01310000
013200                                                                  01320000
013300     SET PS-PROCESS-COMPLETE TO TRUE.                             01330015
013400     MOVE SQLCODE TO PV-RETURN-CODE.                              01340008
013500                                                                  01350008
013600***************************************************************** 01360000
013700**INSERT ACTION TYPE                                              01370000
013800***************************************************************** 01380000
013900 2100-INSERT-DATA.                                                01390000
014000                                                                  01400000
014100     PERFORM                                                      01410014
014200         WITH TEST AFTER                                          01420014
014300         VARYING PV-RETRY-COUNTER                                 01430014
014400         FROM 1 BY 1                                              01440014
014500         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    01450014
014600            OR SQLCODE = 0                                        01460014
014700            OR PS-PROCESS-COMPLETE                                01470014
014800                                                                  01480014
014900         EXEC SQL                                                 01490014
015000             INSERT INTO XST_DC_LOC_ASGMT                         01500014
015100                 (LOC_NBR                                         01510014
015200                , EFF_BEG_DTE                                     01520014
015300                , DC_NBR)                                         01530014
015400             VALUES (: XST00020-LOC-NBR                           01540014
015500                   , : XST00020-EFF-BEG-DTE                       01550014
015600                   , : XST00020-DC-NBR)                           01560014
015700         END-EXEC                                                 01570014
015800                                                                  01580000
015900         EVALUATE TRUE                                            01590014
016000             WHEN SQLCODE = -911                                  01600014
016100             WHEN SQLCODE = -913                                  01610014
016200             WHEN SQLCODE = 0                                     01620014
016300                 CONTINUE                                         01630014
016400             WHEN SQLWARN0 NOT = SPACE                            01640014
016500             WHEN SQLCODE NOT =  ZERO                             01650014
016600                 SET PS-PROCESS-COMPLETE TO TRUE                  01660014
016700         END-EVALUATE                                             01670014
016800     END-PERFORM.                                                 01680014
016900                                                                  01690014
017000     EVALUATE TRUE                                                01700000
017100        WHEN SQLCODE = -913                                       01710000
017200        WHEN SQLCODE = -911                                       01720000
017300             IF  PV-RETRY-COUNTER >= PC-RETRY-MAX                 01730000
017400                 SET PS-PROCESS-COMPLETE TO TRUE                  01740000
017500             ELSE                                                 01750000
017600                 ADD +1                  TO PV-RETRY-COUNTER      01760000
017700             END-IF                                               01770000
017800        WHEN OTHER                                                01780000
017900             SET PS-PROCESS-COMPLETE     TO TRUE                  01790005
018000     END-EVALUATE.                                                01800000
018100                                                                  01810000
018200******************************************************************01820000
018300**UPDATE ACTION TYPE                                              01830000
018400******************************************************************01840000
018500 2200-UPDATE-DATA.                                                01850000
018600                                                                  01860000
018700     PERFORM                                                      01870014
018800         WITH TEST AFTER                                          01880014
018900         VARYING PV-RETRY-COUNTER                                 01890014
019000         FROM 1 BY 1                                              01900014
019100         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    01910014
019200            OR SQLCODE = 0                                        01920014
019300            OR PS-PROCESS-COMPLETE                                01930014
019400                                                                  01940014
019500         EXEC SQL                                                 01950014
019600             UPDATE XST_DC_LOC_ASGMT                              01960014
019700                SET DC_NBR      = : XST00020-DC-NBR               01970014
019800              WHERE LOC_NBR = : XST00020-LOC-NBR                  01980014
019900                AND EFF_BEG_DTE = : XST00020-EFF-BEG-DTE          01990014
020000         END-EXEC                                                 02000014
020100                                                                  02010000
020200         EVALUATE TRUE                                            02020014
020300             WHEN SQLCODE = -911                                  02030014
020400             WHEN SQLCODE = -913                                  02040014
020500             WHEN SQLCODE = 0                                     02050014
020600                 CONTINUE                                         02060014
020700             WHEN SQLWARN0 NOT = SPACE                            02070014
020800             WHEN SQLCODE NOT =  ZERO                             02080014
020900                 SET PS-PROCESS-COMPLETE TO TRUE                  02090014
021000         END-EVALUATE                                             02100014
021100     END-PERFORM.                                                 02110014
021200                                                                  02120014
021300     EVALUATE TRUE                                                02130000
021400        WHEN SQLCODE = -911                                       02140000
021500             IF  PV-RETRY-COUNTER >= PC-RETRY-MAX                 02150000
021600                 SET PS-PROCESS-COMPLETE TO TRUE                  02160000
021700             ELSE                                                 02170000
021800                 ADD +1                  TO PV-RETRY-COUNTER      02180000
021900             END-IF                                               02190000
022000        WHEN OTHER                                                02200000
022100             SET PS-PROCESS-COMPLETE     TO TRUE                  02210000
022200     END-EVALUATE.                                                02220000
022300                                                                  02230000
022400******************************************************************02240000
022500**DELETE TYPE ACTION                                              02250000
022600******************************************************************02260000
022700 2300-DELETE-DATA.                                                02270000
022800                                                                  02280000
022900     PERFORM                                                      02290014
023000         WITH TEST AFTER                                          02300014
023100         VARYING PV-RETRY-COUNTER                                 02310014
023200         FROM 1 BY 1                                              02320014
023300         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    02330014
023400            OR SQLCODE = 0                                        02340014
023500            OR PS-PROCESS-COMPLETE                                02350014
023600                                                                  02360014
023700         EXEC SQL                                                 02370014
023800             DELETE FROM XST_DC_LOC_ASGMT                         02380014
023900              WHERE LOC_NBR   = : XST00020-LOC-NBR                02390014
024000                AND EFF_BEG_DTE = : XST00020-EFF-BEG-DTE          02400014
024100         END-EXEC                                                 02410014
024200                                                                  02420000
024300         EVALUATE TRUE                                            02430014
024400             WHEN SQLCODE = -911                                  02440014
024500             WHEN SQLCODE = -913                                  02450014
024600             WHEN SQLCODE = 0                                     02460014
024700                 CONTINUE                                         02470014
024800             WHEN SQLWARN0 NOT = SPACE                            02480014
024900             WHEN SQLCODE NOT =  ZERO                             02490014
025000                 SET PS-PROCESS-COMPLETE TO TRUE                  02500014
025100         END-EVALUATE                                             02510014
025200     END-PERFORM.                                                 02520014
025300                                                                  02530014
025400     EVALUATE TRUE                                                02540000
025500        WHEN SQLCODE = -911                                       02550000
025600        WHEN SQLCODE = -913                                       02560000
025700             IF  PV-RETRY-COUNTER >= PC-RETRY-MAX                 02570000
025800                 SET PS-PROCESS-COMPLETE TO TRUE                  02580000
025900             ELSE                                                 02590000
026000                 ADD +1                  TO PV-RETRY-COUNTER      02600000
026100             END-IF                                               02610000
026200        WHEN OTHER                                                02620000
026300             SET PS-PROCESS-COMPLETE     TO TRUE                  02630000
026400     END-EVALUATE.                                                02640000
026500                                                                  02650000
026600******************************************************************02660000
026700**PASS SQLCODE TO CALLING AND EXIT PROGRAM                        02670000
026800******************************************************************02680000
026900 9999-WRAPUP.                                                     02690000
027000                                                                  02700000
027100     MOVE PV-RETURN-CODE TO LV-RETURN-CODE.                       02710008
027200                                                                  02720000
027300     EXIT PROGRAM.                                                02730000
