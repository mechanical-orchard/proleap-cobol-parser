000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.             SNKUP005.                                00050000
000600 AUTHOR.                 PAT LEE.                                 00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            05-11-92.                                00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100***************************************************************** 00110000
001200*     ASSOCIATE ASN TO PO                                       * 00120000
001300*                                                               * 00130000
001400*  THIS PROGRAM WILL IDENTIFY TROUBLES WITH THE ADVANCE SHIP-   * 00140000
001500*  MENT NOTICES AND WITH THE PURCHASE ORDER LINE ITEM ASSOCIA-  * 00150000
001600*  TIONS.  THIS PROCESS INCLUDES IDENTIFICATION OF EARLY AND    * 00160000
001700*  LATE SHIPMENTS, POSSIBLE SUBSTITUTIONS, OVERSHIPMENTS,       * 00170000
001800*  UNDER SHIPMENTS, AND PRICE DISCREPANCIES.                    * 00180000
001900***************************************************************** 00190000
002000* CHANGED ??/??/?? BY ??????????????????????????????????????????  00200000
002100*   WR#                                                           00210000
003000***************************************************************** 00220020
002600* CHANGED 11/07/14 BY PRITHIVIRAJ SUBRAMANIAN (COGNIZANT)       * 00230020
001300*              CHANGES THRU OUT THE PROGRAM TO INCREASE SIZE OF * 00240020
001300*              PO# FROM 7 DIGITS TO 8 DIGITS.                   * 00250020
001300*              CHANGE TAGGED WITH *PS 11/07/2014                * 00260020
002800*                                                               * 00270020
003000***************************************************************** 00280020
263627* CHANGED 11/04/2021    BY JIM HUNTER      WR: CHG0263627         00282028
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00283028
263627* MAKING THE CALL DYNAMIC VS STATIC.                              00284028
002300*                                                                 00290000
002400***************************************************************** 00300000
002500 ENVIRONMENT DIVISION.                                            00310000
002600***************************************************************** 00320000
002700                                                                  00330000
002800 CONFIGURATION SECTION.                                           00340000
002900                                                                  00350000
003000 SOURCE-COMPUTER.        IBM-3090.                                00360000
003100 OBJECT-COMPUTER.        IBM-3090.                                00370000
003200                                                                  00380000
003300 INPUT-OUTPUT SECTION.                                            00390000
003400                                                                  00400000
003500 FILE-CONTROL.                                                    00410000
003600*                                                                 00420000
003700***************************************************************** 00430000
003800 DATA DIVISION.                                                   00440000
003900***************************************************************** 00450000
004000*                                                                 00460000
004100 FILE SECTION.                                                    00470000
004200*                                                                 00480000
004300 WORKING-STORAGE SECTION.                                         00490000
004400*                                                                 00500000
004500 01  FILLER.                                                      00510000
004600     05  FILLER                      PIC  X(36)    VALUE          00520000
004700         ' ***** WORKING STORAGE PGM=SNKUP005 '.                  00530000
004800     05  PGM-COMPILED                PIC  X(20)    VALUE SPACE.   00540000
004900     05  FILLER                      PIC  X(10)    VALUE          00550000
005000         ' LOCATION='.                                            00560000
005100     05  PGM-LOCATION                PIC  X(04)    VALUE SPACE.   00570000
005200     05  FILLER                      PIC  X(06)    VALUE          00580000
005300         ' *****'.                                                00590000
005400/                                                                 00600000
005500 01  CD-CPU-DATE.                                                 00610000
005600     05  CD-CPU-DATE-YY               PIC 9(02)      VALUE ZEROS. 00620000
005700     05  CD-CPU-DATE-MM               PIC 9(02)      VALUE ZEROS. 00630000
005800     05  CD-CPU-DATE-DD               PIC 9(02)      VALUE ZEROS. 00640000
005900/                                                                 00650000
006000 01  PS-PROGRAM-SWITCHES.                                         00660000
006100     05  PS-END-OF-ASNHDR-ASNORD-IND PIC  X(01)    VALUE 'N'.     00670000
006200         88  PS-END-OF-ASNHDR-ASNORD-CURSOR        VALUE 'Y'.     00680000
006300     05  PS-END-OF-ASNDTL-ASDTPL-IND PIC  X(01)    VALUE 'N'.     00690000
006400         88  PS-END-OF-ASNDTL-ASDTPL-CURSOR        VALUE 'Y'.     00700000
006500         88  PS-BGN-OF-ASNDTL-ASDTPL-CURSOR        VALUE 'N'.     00710000
006600     05  PS-END-OF-ASNORD-SUM-IND    PIC  X(01)    VALUE 'N'.     00720000
006700         88  PS-END-OF-ASNORD-SUM-CSR              VALUE 'Y'.     00730000
006800         88  PS-NOT-END-OF-ASNORD-SUM-CSR          VALUE 'N'.     00740000
006900     05  PS-END-OF-ASNORD-IND        PIC  X(01)    VALUE 'N'.     00750000
007000         88  PS-END-OF-ASNORD                      VALUE 'Y'.     00760000
007100         88  PS-NOT-END-OF-ASNORD                  VALUE 'N'.     00770000
007200     05  PS-END-OF-PO-STORE-IND      PIC  X(01)    VALUE 'N'.     00780000
007300         88  PS-END-OF-PO-STORE                    VALUE 'Y'.     00790000
007400         88  PS-BGN-OF-PO-STORE                    VALUE 'N'.     00800000
007500*----------------------------------------------------------------*00810000
007600*  INCLUDED PROGRAM SWITCHES FOR XLKUT001       **   WR # 230ZZ  *00820000
007700*----------------------------------------------------------------*00830000
007800     05  PS-CALL-API-SW               PIC  X    VALUE 'N'.        00840000
007900         88  PS-CALL-API-NO                     VALUE 'N'.        00850000
008000         88  PS-CALL-API-YES                    VALUE 'Y'.        00860000
008100*----------------------------------------------------------------*00870000
008200* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *00880000
008300*----------------------------------------------------------------*00890000
008400*                                                                 00900000
008500 01  PC-PROGRAM-CONSTANTS.                                        00910000
008600     05  PC-ILBOABN0                 PIC  X(08)    VALUE          00920000
008700                                                   'ILBOABN0'.    00930000
009000     05  PC-DPKUT500                 PIC X(10)     VALUE          00940000
009100                                                   'DPKUT500  '.  00950000
009200     05  PC-CMD-CODE-D               PIC X(02)     VALUE 'D-'.    00960000
009300     05  PC-3                        PIC X(02)     VALUE '03'.    00970000
009400     05  PC-POS-3                    PIC S9(04)    VALUE +3       00980000
009500                                                   COMP SYNC.     00990000
009600     05  PC-POS-7                    PIC S9(04)    VALUE +7       01000000
009700                                                   COMP SYNC.     01010000
009600*PS 11/07/2014 CHANGE STARTS                                      01020020
009600     05  PC-POS-8                    PIC S9(04)    VALUE +8       01030020
009700                                                   COMP SYNC.     01040020
009600*PS 11/07/2014 CHANGE ENDS                                        01050020
009800     05  PC-POS-10                   PIC S9(04)    VALUE +10      01060000
009900                                                   COMP-3.        01070000
010000     05  PC-POS-19                   PIC S9(04)    VALUE +19      01080000
010100                                                   COMP-3.        01090000
010200     05  PC-POS-20                   PIC S9(04)    VALUE +20      01100000
010300                                                   COMP-3.        01110000
010400     05  PC-POS-90                   PIC S9(04)    VALUE +90      01120000
010500                                                   COMP-3.        01130000
010600*    05  PC-NEG-904                  PIC S9(04)    VALUE -904     01140000
010700*                                                  COMP SYNC.     01150000
010800*    05  PC-NEG-913                  PIC S9(04)    VALUE -913     01160000
010900*                                                  COMP SYNC.     01170000
011000     05  PC-OPERCO-NBR               PIC  X(02)    VALUE '03'.    01180000
011100     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     01190000
011200                                                   COMP SYNC.     01200000
011300     05  PC-SUCCESSFUL               PIC S9(04)    VALUE +0       01210000
011400                                                   COMP SYNC.     01220000
011500     05  PC-A                        PIC  X(01)    VALUE 'A'.     01230000
011600     05  PC-C                        PIC  X(01)    VALUE 'C'.     01240000
011700     05  PC-E                        PIC  X(01)    VALUE 'E'.     01250000
011800     05  PC-L                        PIC  X(01)    VALUE 'L'.     01260000
011900     05  PC-M                        PIC  X(01)    VALUE 'M'.     01270000
012000     05  PC-N                        PIC  X(01)    VALUE 'N'.     01280000
012100     05  PC-P                        PIC  X(01)    VALUE 'P'.     01290000
012200     05  PC-Y                        PIC  X(01)    VALUE 'Y'.     01300000
013100*                                                                 01310000
013200 01  PV-NULLS-TABLE.                                              01320000
013300     05  PV-TOT-ASSOC-QTY-NULL        PIC S9(04)   VALUE +0       01330000
013400                                                   COMP SYNC.     01340000
013500     05  PV-ALLOC-NULL                PIC S9(04)   VALUE +0       01350000
013600                                                   COMP SYNC.     01360000
013700/                                                                 01370000
013800*                                                                 01380000
013900 01  PV-PROGRAM-VARIABLES.                                        01390000
014000     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZEROES   01400000
014100                                                   COMP SYNC.     01410000
014200     05  PV-CPPCDT-SQLCODE           PIC S9(09)    COMP.          01420000
014300     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  01430000
014400     05  PV-CURRENT-DTE-CCYYMMDD.                                 01440000
014500         10  PV-CURRENT-DTE-CC       PIC  9(02)    VALUE ZEROES.  01450000
014600         10  PV-CURRENT-DTE-YY       PIC  9(02)    VALUE ZEROES.  01460000
014700         10  FILLER                  PIC  X(01)    VALUE '-'.     01470000
014800         10  PV-CURRENT-DTE-MM       PIC  9(02)    VALUE ZEROES.  01480000
014900         10  FILLER                  PIC  X(01)    VALUE '-'.     01490000
015000         10  PV-CURRENT-DTE-DD       PIC  9(02)    VALUE ZEROES.  01500000
015100     05  PV-CURRENT-DTE-REDF REDEFINES                            01510000
015200         PV-CURRENT-DTE-CCYYMMDD     PIC  X(10).                  01520000
015300     05  PV-DTE-PLUS10-CCYYMMDD.                                  01530000
015400         10  PV-DTE-PLUS10-CC        PIC  9(02)    VALUE ZEROES.  01540000
015500         10  PV-DTE-PLUS10-YY        PIC  9(02)    VALUE ZEROES.  01550000
015600         10  FILLER                  PIC  X(01)    VALUE '-'.     01560000
015700         10  PV-DTE-PLUS10-MM        PIC  9(02)    VALUE ZEROES.  01570000
015800         10  FILLER                  PIC  X(01)    VALUE '-'.     01580000
015900         10  PV-DTE-PLUS10-DD        PIC  9(02)    VALUE ZEROES.  01590000
016000     05  PV-DTE-PLUS10-REDF REDEFINES                             01600000
016100         PV-DTE-PLUS10-CCYYMMDD      PIC  X(10).                  01610000
016200     05  PV-DATE1-CCYYMMDD.                                       01620000
016300         10  PV-DATE1-CC             PIC  9(02)    VALUE ZEROES.  01630000
016400         10  PV-DATE1-YY             PIC  9(02)    VALUE ZEROES.  01640000
016500         10  PV-DATE1-MM             PIC  9(02)    VALUE ZEROES.  01650000
016600         10  PV-DATE1-DD             PIC  9(02)    VALUE ZEROES.  01660000
016700     05  PV-DATE2-CCYYMMDD.                                       01670000
016800         10  PV-DATE2-CC             PIC  9(02)    VALUE ZEROES.  01680000
016900         10  PV-DATE2-YY             PIC  9(02)    VALUE ZEROES.  01690000
017000         10  PV-DATE2-MM             PIC  9(02)    VALUE ZEROES.  01700000
017100         10  PV-DATE2-DD             PIC  9(02)    VALUE ZEROES.  01710000
017200     05  PV-TOT-ASSOC-QTY            PIC S9(07)    VALUE ZEROES   01720000
017300                                                   COMP-3.        01730000
017400     05  PV-TOT-ASSOC-QTY-DISP       PIC  9(05)    VALUE ZEROES.  01740000
017500     05  PV-TOT-CURRENT-ASSOC-QTY    PIC S9(07)    VALUE ZEROES   01750000
017600                                                   COMP-3.        01760000
017700     05  PV-TOT-QTY-ALLOC            PIC S9(07)    VALUE ZEROES   01770000
017800                                                   COMP-3.        01780000
017900     05  PV-QTY-VARIANCE             PIC S9(07)    VALUE ZEROES   01790000
018000                                                   COMP-3.        01800000
018100     05  PW-QTY-VARIANCE             PIC  9(06)    VALUE ZEROES.  01810000
018200     05  PV-PO-NBR                   PIC  X(22)    VALUE SPACES.  01820000
018200*PS 11/07/2014 CHANGE STARTS                                      01830021
018300     05  PV-NUMERIC-PO-NBR           PIC  9(08)    VALUE ZEROES.  01840021
018200*PS 11/07/2014 CHANGE ENDS                                        01850021
018400     05  PV-INTEGER-PO-NBR           PIC S9(09)    COMP           01860000
018500                                                   VALUE +0.      01870000
018600     05  PV-INTEGER-PO-LNE-NBR       PIC S9(09)    COMP           01880000
018700                                                   VALUE +0.      01890000
018800     05  PV-POCLASS                  PIC  X(02)    VALUE SPACES.  01900000
018900     05  PV-POCSTYLE                 PIC  X(03)    VALUE SPACES.  01910000
019000     05  PV-SUM-ASNHDR               PIC  X(30)    VALUE SPACES.  01920000
019200                                                                  01930017
C94517 01  PV-VALUE1-8.                                                 01940026
C94517     05  FILLER                      PIC  X(01)    VALUE SPACE.   01950026
C94517     05  PV-VALUE2-8                 PIC  X(07)    VALUE SPACE.   01960026
C94517                                                                  01970026
021500*  NUMERIC EDIT LAYOUT                                            01980000
021600*                                                                 01990000
021700     COPY DPWS010I.                                               02000000
021800                                                                  02010016
022200*  DATE EDIT LAYOUT - DPKUT500                                    02020000
022300*                                                                 02030000
022400     COPY DPWS500.                                                02040000
022500/                                                                 02050000
022600     COPY MAWS900.                                                02060000
022700/                                                                 02070000
023200*  ASN HEADER TABLE LAYOUT                                        02080000
023300*                                                                 02090000
023400     EXEC SQL                                                     02100000
023500         INCLUDE TASNHDR                                          02110000
023600     END-EXEC.                                                    02120000
023700/                                                                 02130000
023800*  ASN ORDER TABLE LAYOUT                                         02140000
023900*                                                                 02150000
024000     EXEC SQL                                                     02160000
024100         INCLUDE TASNORD                                          02170000
024200     END-EXEC.                                                    02180000
024300/                                                                 02190000
024400*  ASN ITEM DETAIL TABLE LAYOUT                                   02200000
024500*                                                                 02210000
024600     EXEC SQL                                                     02220000
024700         INCLUDE TASNDTL                                          02230000
024800     END-EXEC.                                                    02240000
024900/                                                                 02250000
025000*  MATCH ASN DETAIL ITEM TO THE PO LINE ITEM TABLE LAYOUT         02260000
025100*                                                                 02270000
025200     EXEC SQL                                                     02280000
025300         INCLUDE TASDTPL                                          02290000
025400     END-EXEC.                                                    02300000
025500/                                                                 02310000
025600*  PO TABLE LAYOUT                                                02320000
025700     EXEC SQL                                                     02330000
025800         INCLUDE TPURCHS                                          02340000
025900     END-EXEC.                                                    02350000
027000/                                                                 02360000
027100*  PLANNED SHIPMENT TABLE LAYOUT                                  02370000
027200     EXEC SQL                                                     02380000
027300         INCLUDE TPLNSHP                                          02390000
027400     END-EXEC.                                                    02400000
027500/                                                                 02410000
028300*  DB2 COMMUNICATION AREA                                         02420000
028400*                                                                 02430000
028500     EXEC SQL                                                     02440000
028600         INCLUDE SQLCA                                            02450000
028700     END-EXEC.                                                    02460000
028800/                                                                 02470000
028900*  DB2 COMMUNICATION AREA2                                        02480000
029000*                                                                 02490000
029100     COPY SQLCA2.                                                 02500000
029200/                                                                 02510000
029300*                                                                 02520000
029400*  CURSOR TO FETCH ASNHDR AND ASNORD DATE                         02530000
029500*  FOR PREVIOUSLY UNMATCED (IE. PENDING) ASN'S                    02540000
029600*                                                                 02550000
029700     EXEC SQL                                                     02560000
029800        DECLARE ASNHDR_ASNORD_CRSR CURSOR FOR                     02570000
029900         SELECT DISTINCT                                          02580000
030000                A.SHIP_DTE,                                       02590000
030100                B.PO_NBR,                                         02600000
030200                B.ASNHDR_ID                                       02610000
030300           FROM TASNHDR A,                                        02620000
030400                TASNORD B                                         02630000
030500          WHERE A.ASNHDR_ID   = B.ASNHDR_ID                       02640000
030600            AND B.MTCH_PO_CDE = :PC-P                             02650000
030700     END-EXEC.                                                    02660000
030800/                                                                 02670000
030900/                                                                 02680000
031000***************************************************************** 02690000
031100 PROCEDURE DIVISION.                                              02700000
031200                                                                  02710000
031300 A000-MAINLINE-PROCESSING.                                        02720000
031400*                                                                 02730000
031500     DISPLAY '***********************************'.               02740000
031600     DISPLAY '*         S N K U P 0 0 5         *'.               02750000
031700     DISPLAY '***********************************'.               02760000
031800*                                                                 02770000
031900     MOVE 'A000'                  TO PGM-LOCATION.                02780000
032000     MOVE 'A000-MAINLINE-PROCESSING'                              02790000
032100                                  TO PV-ABEND-PARAGRAPH.          02800000
032200*    DISPLAY PV-ABEND-PARAGRAPH.                                  02810000
032300*                                                                 02820000
032400     PERFORM A100-PROCESS-CURRENT-DATE.                           02830000
032500     PERFORM X100-OPEN-ASNHDR-ASNORD-CURSOR.                      02840000
032600     PERFORM S100-FETCH-ASNHDR-ASNORD-CURSR.                      02850000
032700                                                                  02860000
032800                                                                  02870000
032900     PERFORM                                                      02880000
033000       UNTIL PS-END-OF-ASNHDR-ASNORD-CURSOR                       02890000
033100                                                                  02900000
033200          PERFORM B000-IDENTIFY-PO-HEADER-ERRORS                  02910000
033300                                                                  02920000
033400          PERFORM S100-FETCH-ASNHDR-ASNORD-CURSR                  02930000
033500                                                                  02940000
033600     END-PERFORM.                                                 02950000
033700                                                                  02960000
033800     PERFORM Y100-CLOSE-ASNHDR-ASNORD-CURSR.                      02970000
033900                                                                  02980015
034000     GOBACK.                                                      02990000
034100*                                                                 03000000
034200/                                                                 03010000
034300******************************************************************03020000
034400*  THIS PARA ACCEPTS THE CURRENT DATE AND REFORMATS IT INTO      *03030000
034500*  AN ACCEPTABLE DB2 DATE FORMAT.                                *03040000
034600******************************************************************03050000
034700 A100-PROCESS-CURRENT-DATE.                                       03060000
034800*                                                                 03070000
034900     MOVE 'A100'                  TO PGM-LOCATION.                03080000
035000     MOVE 'A100-PROCESS-CURRENT-DATE    '                         03090000
035100                                  TO PV-ABEND-PARAGRAPH.          03100000
035200*    DISPLAY PV-ABEND-PARAGRAPH.                                  03110000
035300*                                                                 03120000
035400     ACCEPT CD-CPU-DATE FROM DATE.                                03130000
035500                                                                  03140000
035600     IF CD-CPU-DATE-YY > PC-POS-90                                03150000
035700         MOVE PC-POS-19          TO PV-CURRENT-DTE-CC             03160000
035800     ELSE                                                         03170000
035900         MOVE PC-POS-20          TO PV-CURRENT-DTE-CC             03180000
036000     END-IF.                                                      03190000
036100                                                                  03200000
036200     MOVE CD-CPU-DATE-YY         TO PV-CURRENT-DTE-YY.            03210000
036300     MOVE CD-CPU-DATE-MM         TO PV-CURRENT-DTE-MM.            03220000
036400     MOVE CD-CPU-DATE-DD         TO PV-CURRENT-DTE-DD.            03230000
036500                                                                  03240000
036600     MOVE PV-CURRENT-DTE-CC       TO PV-DATE1-CC.                 03250000
036700     MOVE PV-CURRENT-DTE-YY       TO PV-DATE1-YY.                 03260000
036800     MOVE PV-CURRENT-DTE-MM       TO PV-DATE1-MM.                 03270000
036900     MOVE PV-CURRENT-DTE-DD       TO PV-DATE1-DD.                 03280000
037000                                                                  03290000
037100*                                                                 03300000
037200*  DETERMINE CURRENT DATE PLUS 10                                 03310000
037300*                                                                 03320000
037400     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              03330000
037500     SET DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                    03340000
037600     SET DPG51-INCREMENT-DATE         TO TRUE.                    03350000
037700     MOVE PC-POS-10                   TO DPG51-INCR-DECR-DAYS-9.  03360000
037800     MOVE ZEROS                   TO DPG51-INCR-DECR-BUS-DAYS-9.  03370000
037900     SET DPG52-LK-DTE-ISO             TO TRUE.                    03380000
038000     MOVE PV-DATE1-CCYYMMDD           TO DPG52-LK-DATE-INPUT.     03390000
038100     CALL PC-DPKUT500                                             03400000
038200                    USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.    03410000
038300     IF DPG54-SEVERE-ERROR                                        03420000
038400         DISPLAY '***     S N K U P 0 0 5    ***'                 03430000
038500         DISPLAY '*** ERROR CALLING DPUT500 - TYPE (10) ***'      03440000
038600         DISPLAY DPG54-ERROR-MESSAGE                              03450000
038700     ELSE                                                         03460000
038800         MOVE DPG55-DB2-ISO-DATE-FMT                              03470000
038900                                 TO PV-DTE-PLUS10-CCYYMMDD        03480000
039000         DISPLAY 'CURRENT DATE + 10 = ' PV-DTE-PLUS10-CCYYMMDD    03490000
039100     END-IF.                                                      03500000
039200                                                                  03510000
039300/                                                                 03520000
039400******************************************************************03530000
039500*                                                                *03540000
039600*  THIS PARA DETERMINES IF A SHIPMENT IS EARLY OR LATE BY COM-   *03550000
039700*  PARING THE ASN'S SHIP DATE TO THE PO'S SHIP AND CANCEL DATE.  *03560000
039800*  IF IT IS, UPDATE THE ASNORD EARLY-LATE-CDE WITH APPROPRIATE   *03570000
039900*  CODE.                                                         *03580000
040000******************************************************************03590000
040100 B000-IDENTIFY-PO-HEADER-ERRORS.                                  03600000
040200*                                                                 03610000
040300     MOVE 'B000'                  TO PGM-LOCATION.                03620000
040400     MOVE 'B000-IDENTIFY-PO-HEADER-ERRORS'                        03630000
040500                                  TO PV-ABEND-PARAGRAPH.          03640000
040600*    DISPLAY PV-ABEND-PARAGRAPH.                                  03650000
040700*                                                                 03660000
040800     INITIALIZE PV-DATE1-CCYYMMDD.                                03670000
040900     INITIALIZE PV-DATE2-CCYYMMDD.                                03680000
041000*                                                                 03690000
041100     PERFORM B100-EDIT-ASNORD-PO-NBR.                             03700000
041200                                                                  03710000
041300     PERFORM R100-GET-PO-INFO.                                    03720000
041400*                                                                 03730000
041500*  FORMAT THE ASN SHIP DATE                                       03740000
041600*                                                                 03750000
041700     MOVE ASNHDR-SHIP-DTE (1:2)   TO PV-DATE1-CC.                 03760000
041800     MOVE ASNHDR-SHIP-DTE (3:2)   TO PV-DATE1-YY.                 03770000
041900     MOVE ASNHDR-SHIP-DTE (6:2)   TO PV-DATE1-MM.                 03780000
042000     MOVE ASNHDR-SHIP-DTE (9:2)   TO PV-DATE1-DD.                 03790000
042100*                                                                 03800000
042200*  DETERMINE IF THE SHIPMENT IS EARLY                             03810000
042300*                                                                 03820000
042400                                                                  03830000
042500     MOVE PLNSHP-DONT-SHIP-BEF-DTE (1:2)   TO PV-DATE2-CC.        03840000
042600     MOVE PLNSHP-DONT-SHIP-BEF-DTE (3:2)   TO PV-DATE2-YY.        03850000
042700     MOVE PLNSHP-DONT-SHIP-BEF-DTE (6:2)   TO PV-DATE2-MM.        03860000
042800     MOVE PLNSHP-DONT-SHIP-BEF-DTE (9:2)   TO PV-DATE2-DD.        03870000
042900                                                                  03880000
043000     IF PV-DATE1-CCYYMMDD < PV-DATE2-CCYYMMDD                     03890000
043100         MOVE PC-E                TO ASNORD-EARLY-LTE-CDE         03900000
043200         PERFORM S700-UPDATE-ASNORD                               03910000
043300     ELSE                                                         03920000
043400*                                                                 03930000
043500*  DETERMINE IF THE SHIPMENT IS LATE (GT PO CANCEL DATE+3 DAYS)   03940000
043600*                                                                 03950000
043700         INITIALIZE PV-DATE2-CCYYMMDD                             03960000
043800                                                                  03970000
043900         MOVE PLNSHP-CAN-IFNOT-SHIP-DTE (1:2)  TO PV-DATE2-CC     03980000
044000         MOVE PLNSHP-CAN-IFNOT-SHIP-DTE (3:2)  TO PV-DATE2-YY     03990000
044100         MOVE PLNSHP-CAN-IFNOT-SHIP-DTE (6:2)  TO PV-DATE2-MM     04000000
044200         MOVE PLNSHP-CAN-IFNOT-SHIP-DTE (9:2)  TO PV-DATE2-DD     04010000
044300                                                                  04020000
044400                                                                  04030000
044500         IF PV-DATE1-CCYYMMDD > PV-DATE2-CCYYMMDD                 04040000
044600             MOVE PC-L            TO ASNORD-EARLY-LTE-CDE         04050000
044700             PERFORM S700-UPDATE-ASNORD                           04060000
044800         END-IF                                                   04070000
044900     END-IF.                                                      04080000
045000*                                                                 04090000
045100/                                                                 04100000
045200******************************************************************04110000
045300*  FORMAT PO NUMBER INTO EIGHT DIGIT NUMERIC                     *04120024
045400******************************************************************04130000
045500 B100-EDIT-ASNORD-PO-NBR.                                         04140000
045600*                                                                 04150000
045700     MOVE 'B100'                  TO PGM-LOCATION.                04160000
045800     MOVE 'B100-EDIT-ASNORD-PO-NBR  '                             04170000
045900                                  TO PV-ABEND-PARAGRAPH.          04180000
046000*    DISPLAY PV-ABEND-PARAGRAPH.                                  04190000
046100*PS 11/07/2014 CHANGE STARTS                                      04200020
046200     IF ASNORD-PO-NBR (8:1) = SPACE                               04210026
046200        MOVE ASNORD-PO-NBR (1:7)  TO PV-VALUE2-8                  04220026
046200        MOVE PV-VALUE1-8          TO DP010I-UNEDITED-FIELD        04230026
046200     ELSE                                                         04240026
046200        MOVE ASNORD-PO-NBR (1:8)  TO DP010I-UNEDITED-FIELD        04250026
046200     END-IF.                                                      04260026
046300     MOVE PC-POS-8                TO DP010I-MAXIMUM-DIGITS.       04270020
046100*PS 11/07/2014 CHANGE ENDS                                        04280020
046400     MOVE ZERO                    TO DP010I-MAXIMUM-DECIMALS.     04290000
046500     SET DP010I-NEGATIVE-NOT-ALLOWED                              04300000
046600                                  TO TRUE.                        04310000
263627     CALL DP010I-NUMERIC-EDIT-ROUTINE                             04321028
263627          USING DP010I-NUMERIC-EDIT-AREA.                         04322028
046800     MOVE DP010I-NUMERIC-FIELD    TO PV-NUMERIC-PO-NBR.           04330026
046900     MOVE PV-NUMERIC-PO-NBR       TO PV-INTEGER-PO-NBR.           04340000
047000*                                                                 04350021
047100/                                                                 04360000
047200******************************************************************04370000
047300*                                                                *04380000
047400******************************************************************04390000
047500 R100-GET-PO-INFO.                                                04400000
047600*                                                                 04410000
047700     MOVE 'R100'                  TO PGM-LOCATION.                04420000
047800     MOVE 'R100-GET-PO-INFO'                                      04430000
047900                                  TO PV-ABEND-PARAGRAPH.          04440000
048000*    DISPLAY PV-ABEND-PARAGRAPH.                                  04450000
048100*                                                                 04460000
048200     EXEC SQL                                                     04470000
048300       SELECT A.DONT_SHIP_BEF_DTE                                 04480000
048400             ,(A.CAN_IFNOT_SHIP_DTE + 3 DAYS)                     04490000
048500             ,A.EXT_CAN_DTE                                       04500000
048600             ,B.DEPT_NBR                                          04510000
048700        INTO :PLNSHP-DONT-SHIP-BEF-DTE                            04520000
048800            ,:PLNSHP-CAN-IFNOT-SHIP-DTE                           04530000
048900            ,:PLNSHP-EXT-CAN-DTE                                  04540000
049000            ,:PURCHS-DEPT-NBR                                     04550000
049100        FROM TPLNSHP A,                                           04560000
049200             TPURCHS B                                            04570000
049300       WHERE A.PO_NBR         = B.PO_NBR                          04580000
049400        AND  B.PO_NBR         = :PV-INTEGER-PO-NBR                04590000
049500        AND  B.VER_STATUS_CDE = 'A'                               04600000
049600        AND  A.VER_STATUS_CDE = B.VER_STATUS_CDE                  04610000
049700     END-EXEC.                                                    04620000
049800*                                                                 04630000
049900     MOVE SQLCODE    TO SQLCODE2.                                 04640000
050000*                                                                 04650000
050100     EVALUATE TRUE                                                04660000
050200       WHEN SQLCODE = ZEROS                                       04670000
050300         CONTINUE                                                 04680000
050400       WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                    04690000
050500         DISPLAY '******************************************'     04700000
050600         DISPLAY 'WARNING ISSUED ON SELECT OF TPLNSHP  AND  '     04710000
050700         DISPLAY 'TPURCHS TABLES                            '     04720000
050800         DISPLAY '******************************************'     04730000
050900         DISPLAY 'PV-NBR = ' PV-INTEGER-PO-NBR                    04740000
051000         DISPLAY  PV-ABEND-PARAGRAPH                              04750000
051100         PERFORM  Z998-SQL-WARNING                                04760000
051200       WHEN  SQLCODE < ZERO                                       04770000
051300         DISPLAY '******************************************'     04780000
051400         DISPLAY 'ERROR ISSUED ON SELECT OF TPLNSHP AND     '     04790000
051500         DISPLAY 'TPURCHS TABLES                            '     04800000
051600         DISPLAY '******************************************'     04810000
051700         DISPLAY  PV-ABEND-PARAGRAPH                              04820000
051800         PERFORM  Z999-SQL-ERROR                                  04830000
051900     END-EVALUATE.                                                04840000
052000                                                                  04850015
052100******************************************************************04860000
052200*  FETCHES THE ASN HEADER INFORMATION.                           *04870000
052300******************************************************************04880000
052400 S100-FETCH-ASNHDR-ASNORD-CURSR.                                  04890000
052500*                                                                 04900000
052600     MOVE 'S100'                  TO PGM-LOCATION.                04910000
052700     MOVE 'S100-FETCH-ASNHDR-ASNORD-CURSR'                        04920000
052800                                  TO PV-ABEND-PARAGRAPH.          04930000
053000*    DISPLAY PV-ABEND-PARAGRAPH.                                  04940000
053100*                                                                 04950000
053200     EXEC SQL                                                     04960000
053300        FETCH  ASNHDR_ASNORD_CRSR                                 04970000
053400         INTO :ASNHDR-SHIP-DTE,                                   04980000
053500              :ASNORD-PO-NBR,                                     04990000
053600              :ASNORD-ASNHDR-ID                                   05000000
053700     END-EXEC.                                                    05010000
053800*                                                                 05020000
053900     MOVE SQLCODE    TO SQLCODE2.                                 05030000
054000*                                                                 05040000
054100     EVALUATE TRUE                                                05050000
054200       WHEN SQLCODE = ZEROS                                       05060000
054300         CONTINUE                                                 05070000
054400       WHEN SQLCODE = PC-ROW-NOT-FOUND                            05080000
054500         SET PS-END-OF-ASNHDR-ASNORD-CURSOR                       05090000
054600                                  TO TRUE                         05100000
054700       WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                    05110000
054800         DISPLAY '******************************************'     05120000
054900         DISPLAY 'WARNING ISSUED ON FETCH OF ASNHDR ASNORD C'     05130000
055000         DISPLAY '******************************************'     05140000
055100         DISPLAY  PV-ABEND-PARAGRAPH                              05150000
055200         PERFORM  Z998-SQL-WARNING                                05160000
055300       WHEN  SQLCODE < ZERO                                       05170000
055400         DISPLAY '******************************************'     05180000
055500         DISPLAY 'ERROR ISSUED ON FETCH OF ASNHDR ASNORD CSR'     05190000
055600         DISPLAY '******************************************'     05200000
055700         DISPLAY  PV-ABEND-PARAGRAPH                              05210000
055800         PERFORM  Z999-SQL-ERROR                                  05220000
055900     END-EVALUATE.                                                05230000
056000*                                                                 05240000
056100                                                                  05250016
056200/                                                                 05260000
056300******************************************************************05270000
056400*  UPDATE THE ASN ORDER DETAIL TABLE                             *05280000
056500******************************************************************05290000
056600 S700-UPDATE-ASNORD.                                              05300000
056700*                                                                 05310000
056800     MOVE 'S700'                  TO PGM-LOCATION.                05320000
056900     MOVE 'S700-UPDATE-ASNORD       '                             05330000
057000                                  TO PV-ABEND-PARAGRAPH.          05340000
057100*    DISPLAY PV-ABEND-PARAGRAPH.                                  05350000
057200*                                                                 05360000
057300     EXEC SQL                                                     05370000
057400       UPDATE TASNORD                                             05380000
057500          SET EARLY_LTE_CDE = :ASNORD-EARLY-LTE-CDE               05390000
057600        WHERE ASNHDR_ID     = :ASNORD-ASNHDR-ID                   05400000
057700          AND PO_NBR        = :ASNORD-PO-NBR                      05410000
057800     END-EXEC.                                                    05420000
057900*                                                                 05430000
058000     MOVE SQLCODE    TO SQLCODE2.                                 05440000
058100*                                                                 05450000
058200     EVALUATE TRUE                                                05460000
058300       WHEN SQLCODE = ZEROS                                       05470000
058400         CONTINUE                                                 05480000
058500       WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                    05490000
058600         DISPLAY '******************************************'     05500000
058700         DISPLAY 'WARNING ISSUED ON UPDATE OF ASDTPL TABLE  '     05510000
058800         DISPLAY 'ASNORD-ASNHDR-ID: '                             05520000
058900                  ASNORD-ASNHDR-ID                                05530000
059000         DISPLAY 'ASNORD-PO-NBR: '                                05540000
059100                  ASNORD-PO-NBR                                   05550000
059200         DISPLAY '******************************************'     05560000
059300         DISPLAY  PV-ABEND-PARAGRAPH                              05570000
059400         PERFORM  Z998-SQL-WARNING                                05580000
059500       WHEN  SQLCODE < ZERO                                       05590000
059600         DISPLAY '******************************************'     05600000
059700         DISPLAY 'ERROR ISSUED ON UPDATE OF ASDTPL TABLE    '     05610000
059800         DISPLAY 'ASNORD-ASNHDR-ID: '                             05620000
059900                  ASNORD-ASNHDR-ID                                05630000
060000         DISPLAY 'ASNORD-PO-NBR: '                                05640000
060100                  ASNORD-PO-NBR                                   05650000
060200         DISPLAY '******************************************'     05660000
060300         DISPLAY  PV-ABEND-PARAGRAPH                              05670000
060400         PERFORM  Z999-SQL-ERROR                                  05680000
060500     END-EVALUATE.                                                05690000
060600*                                                                 05700000
060700/                                                                 05710000
060800******************************************************************05720000
060900*     OPENS THE ASNHDR ASNORD CURSOR                             *05730000
061000*                                                                *05740000
061100******************************************************************05750000
061200 X100-OPEN-ASNHDR-ASNORD-CURSOR.                                  05760000
061300*                                                                 05770000
061400     MOVE 'X100'                  TO PGM-LOCATION.                05780000
061500     MOVE 'X100-OPEN-ASNHDR-ASNORD-CURSOR'                        05790000
061600                                  TO PV-ABEND-PARAGRAPH.          05800000
061700*    DISPLAY PV-ABEND-PARAGRAPH.                                  05810000
061800*                                                                 05820000
061900     EXEC SQL                                                     05830000
062000         OPEN ASNHDR_ASNORD_CRSR                                  05840000
062100     END-EXEC.                                                    05850000
062200*                                                                 05860000
062300     MOVE SQLCODE    TO SQLCODE2.                                 05870000
062400*                                                                 05880000
062500     EVALUATE TRUE                                                05890000
062600       WHEN SQLCODE         = ZERO                                05900000
062700         CONTINUE                                                 05910000
062800       WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                    05920000
062900         DISPLAY '******************************************'     05930000
063000         DISPLAY 'WARNING ISSUED ON OPEN OF ASNHDR ASNORD CS'     05940000
063100         DISPLAY '******************************************'     05950000
063200         DISPLAY  PV-ABEND-PARAGRAPH                              05960000
063300         PERFORM  Z998-SQL-WARNING                                05970000
063400       WHEN  SQLCODE < ZERO                                       05980000
063500         DISPLAY '******************************************'     05990000
063600         DISPLAY 'ERROR ISSUED ON OPEN OF ASNHDR ASNORD CSR '     06000000
063700         DISPLAY '******************************************'     06010000
063800         DISPLAY  PV-ABEND-PARAGRAPH                              06020000
063900         PERFORM  Z999-SQL-ERROR                                  06030000
064000     END-EVALUATE.                                                06040000
064100*                                                                 06050000
064200/                                                                 06060000
064300/                                                                 06070000
064400******************************************************************06080000
064500*     CLOSES THE ASNHDR ASNORD CURSOR                            *06090000
064600*                                                                *06100000
064700******************************************************************06110000
064800 Y100-CLOSE-ASNHDR-ASNORD-CURSR.                                  06120000
064900*                                                                 06130000
065000     MOVE 'Y100'                  TO PGM-LOCATION.                06140000
065100     MOVE 'Y100-CLOSE-ASNHDR-ASNORD-CURSR'                        06150000
065200                                  TO PV-ABEND-PARAGRAPH.          06160000
065300*    DISPLAY PV-ABEND-PARAGRAPH.                                  06170000
065400*                                                                 06180000
065500     EXEC SQL                                                     06190000
065600         CLOSE ASNHDR_ASNORD_CRSR                                 06200000
065700     END-EXEC.                                                    06210000
065800*                                                                 06220000
065900     MOVE SQLCODE    TO SQLCODE2.                                 06230000
066000*                                                                 06240000
066100     EVALUATE TRUE                                                06250000
066200       WHEN SQLCODE         = ZERO                                06260000
066300         CONTINUE                                                 06270000
066400       WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                    06280000
066500         DISPLAY '******************************************'     06290000
066600         DISPLAY 'WARNING ISSUED ON CLOSE OF ASNHDR ASNORD C'     06300000
066700         DISPLAY '******************************************'     06310000
066800         DISPLAY  PV-ABEND-PARAGRAPH                              06320000
066900         PERFORM  Z998-SQL-WARNING                                06330000
067000       WHEN  SQLCODE < ZERO                                       06340000
067100         DISPLAY '******************************************'     06350000
067200         DISPLAY 'ERROR ISSUED ON CLOSE OF ASNHDR ASNORD CSR'     06360000
067300         DISPLAY '******************************************'     06370000
067400         DISPLAY  PV-ABEND-PARAGRAPH                              06380000
067500         PERFORM  Z999-SQL-ERROR                                  06390000
067600     END-EVALUATE.                                                06400000
067700*                                                                 06410000
067800/                                                                 06420000
067900 EJECT                                                            06430000
068000 EJECT                                                            06440000
068100******************************************************************06450000
068200*     SQL WARNING OR ERROR PROCESSING                            *06460000
068300*                                                                *06470000
068400******************************************************************06480000
068500                                                                  06490000
068600 Z998-SQL-WARNING.                                                06500000
068700*-----------------                                                06510000
068800                                                                  06520000
068900     MOVE SQLCODE    TO SQLCODE2.                                 06530000
069000     MOVE SQLERRD(3) TO SQLERRD3.                                 06540000
069100     DISPLAY '** ABEND **       ** = SQLWARNING'.                 06550000
069200     DISPLAY '** PROGRAM        ** = SNKUP005'.                   06560000
069300     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  06570000
069400     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  06580000
069500     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                  06590000
069600     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                  06600000
069700     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                  06610000
069800     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                  06620000
069900     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                  06630000
070000     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                  06640000
070100     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                  06650000
070200     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                  06660000
070300     EXEC SQL                                                     06670000
070400         COMMIT                                                   06680000
070500     END-EXEC.                                                    06690000
070600     MOVE +4013 TO PV-ABEND-CODE.                                 06700000
070700     CALL PC-ILBOABN0 USING PV-ABEND-CODE.                        06710000
070800*                                                                 06720000
070900 Z999-SQL-ERROR.                                                  06730000
071000*---------------                                                  06740000
071100                                                                  06750000
071200     MOVE SQLCODE    TO SQLCODE2.                                 06760000
071300     MOVE SQLERRD(3) TO SQLERRD3.                                 06770000
071400     DISPLAY '** ABEND **       ** = SQLERROR'.                   06780000
071500     DISPLAY '** PROGRAM        ** = SNKUP005'.                   06790000
071600     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  06800000
071700     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  06810000
071800     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   06820000
071900     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  06830000
072000     EXEC SQL                                                     06840000
072100         COMMIT                                                   06850000
072200     END-EXEC.                                                    06860000
072300     MOVE +4013 TO PV-ABEND-CODE.                                 06870000
072400     CALL PC-ILBOABN0 USING PV-ABEND-CODE.                        06880000
