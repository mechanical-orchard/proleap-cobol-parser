000010 IDENTIFICATION DIVISION.                                         00001000
000020 TITLE 'CREATE PURGED ACCOUNTS FILE'                              00002000
000030                                                                  00003000
000040 PROGRAM-ID.             ARKUT121.                                00004000
000050 AUTHOR.                 CHERI PARMLEY.                           00005000
000060 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00006000
000070 DATE-WRITTEN            AUGUST 2016.                             00007000
000080 DATE-COMPILED.                                                   00008000
000090                                                                  00009000
000091***************************************************************** 00009100
000092* CREATE FD ACCOUNT PURGE FILE FOR EVOC                         * 00009219
000093*                                                               * 00009518
000094*  THIS PROGRAM WILL READ A MONTHLY ACCOUNT PURGED FILE WHICH   * 00009618
000094*  IS A LARGE VARIABLE LENGTH FILE AND CONDENSE IT TO ONLY 3    * 00009718
000095*  SELECTED FIELDS ON THE NEW OUTPUT FILE.                      * 00009818
000095*  ITS THEN USED TO SEND FROM FD TO THE CMDM SERVER             * 00009918
000095*                                                               * 00010018
000096*  FULL_ACCT_NO (16 BYTES)                                      * 00010118
000096*  FULL_ACCT_NO (10 BYTES)                                      * 00010218
000096*  PURGE DATE (FROM THE HEADER OF THE FILE)                     * 00010318
000096*                                                               * 00011018
000108***************************************************************** 00011100
000109* CHANGE HISTORY                                                * 00011200
000110*     MADE BY:                                                  * 00011301
000111*     DATE:                                                     * 00011401
000129***************************************************************** 00014600
000130 ENVIRONMENT DIVISION.                                            00014700
000131                                                                  00014800
000132 CONFIGURATION SECTION.                                           00014900
000133                                                                  00015000
000134 SOURCE-COMPUTER.        IBM-3090.                                00015100
000135 OBJECT-COMPUTER.        IBM-3090.                                00015200
000136                                                                  00015300
000137 INPUT-OUTPUT SECTION.                                            00015400
000138                                                                  00015500
000139 FILE-CONTROL.                                                    00015600
000140                                                                  00015700
000141     SELECT AR-INPUT-FILE                                         00015801
000142         ASSIGN TO INP01.                                         00015900
000143                                                                  00016000
000144     SELECT AR-OUTPUT-FILE                                        00016101
000145         ASSIGN TO OUT01.                                         00016200
000146                                                                  00016300
000152                                                                  00016900
000153 DATA DIVISION.                                                   00017000
000154 FILE SECTION.                                                    00017100
000155                                                                  00017200
000156                                                                  00017300
002400 FD  AR-INPUT-FILE                                                00017402
002500     RECORDING MODE IS V                                          00017502
002600     LABEL RECORDS ARE STANDARD                                   00017602
002700     BLOCK CONTAINS 0 RECORDS                                     00017702
002800     RECORD CONTAINS 19 TO 21917 CHARACTERS.                      00017820
000170 01  AR-INPUT-REC1                    PIC X(19).                  00018404
000170 01  AR-INPUT-REC2                    PIC X(21917).               00018520
000180                                                                  00018604
000190 FD  AR-OUTPUT-FILE                                               00018704
000191     RECORDING MODE IS F                                          00018804
000192     LABEL RECORDS ARE STANDARD                                   00018904
000193     BLOCK CONTAINS 0 RECORDS.                                    00019004
000194 01  AR-OUTPUT-RECORD               PIC  X(080).                  00019104
000195*                                                                 00019204
000207                                                                  00020300
000208 WORKING-STORAGE SECTION.                                         00020400
000209                                                                  00020500
000210 01  PS-SWITCHES.                                                 00020600
000211     05  PS-EOF-SW                    PIC X(01) VALUE 'N'.        00020700
000212         88  PS-EOF                             VALUE 'Y'.        00020800
000240                                                                  00024300
000250 01  PV-COUNTERS.                                                 00024400
000251     05  PV-INPUT-COUNT               PIC S9(09) COMP-3           00024500
000252                                          VALUE ZERO.             00024600
000253     05  PV-OUTPUT-COUNT              PIC S9(09) COMP-3           00024701
000254                                          VALUE ZERO.             00024800
000272                                                                  00026600
000273 01  PV-OTHER-STUFF.                                              00026700
000274     05  PV-HOLD-DATE                 PIC X(10) VALUE SPACES.     00026804
000283                                                                  00027700
000287     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'ARKUT121'. 00028100
000302                                                                  00029800
000303     05  PV-DISP-NBR                  PIC ZZZ,ZZZ,ZZ9.            00029900
000304     05  PV-ABEND-CODE                PIC S9(04) COMP SYNC        00030000
000305                                                 VALUE ZERO.      00030100
000306 01  PV-ABEND-FIELDS.                                             00030200
000307     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'ARKUT121'.00030300
000308     05  PV-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    00030400
000309     05  PV-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    00030500
000310     05  PV-ABEND-STRUCTURE-1         PIC X(8)   VALUE SPACES.    00030600
000311     05  PV-ABEND-STRUCTURE-2         PIC X(8)   VALUE SPACES.    00030700
000312     05  PV-ABEND-STRUCTURE-3         PIC X(8)   VALUE SPACES.    00030800
000313                                                                  00030900
       01  AR-PURGE-REC.                                                00031003
           05  AR-HDR-TRL-RECORD            PIC X(03).                  00031103
           05  AR-HDG-DATE                  PIC X(10).                  00031203
000340                                                                  00032100
000346                                                                  00034200
000347*  USED FOR INPUT FILE                                            00034300
000348     COPY ARRD099.                                                00034404
000349                                                                  00034500
000350*  USED FOR OUTPUT FILE                                           00034600
000351     COPY ARRD098.                                                00034704
000352                                                                  00034800
000388                                                                  00038600
000488*                                                                 00050500
000498******************************************************************00050600
000499 PROCEDURE DIVISION.                                              00050700
000500     PERFORM 1000-INITIALIZE.                                     00050800
000501     PERFORM 2000-PROCESS UNTIL PS-EOF.                           00050900
000502     PERFORM 9000-EOJ.                                            00051000
000503     GOBACK.                                                      00051100
000504                                                                  00051200
000505 1000-INITIALIZE.                                                 00051300
000506                                                                  00051400
000507*    DISPLAY '1000-INITIALIZE'                                    00051500
000508     OPEN INPUT  AR-INPUT-FILE                                    00051602
000509          OUTPUT AR-OUTPUT-FILE.                                  00051702
000512                                                                  00052000
000515     PERFORM 8000-READ-INPUT-FILE.                                00052300
000516                                                                  00052400
000517     IF PS-EOF                                                    00052500
000518         DISPLAY ALL '*'                                          00052600
000519         DISPLAY '**  INP01 ACCT FILE IS EMPTY **'                00052702
000520         DISPLAY ALL '*'                                          00052800
000521     END-IF.                                                      00052900
000522                                                                  00053000
000593                                                                  00059200
000594 2000-PROCESS.                                                    00059300
000595***  DISPLAY '2000-PROCESS'                                       00059400
000596     INITIALIZE AR098-PURGE-REC.                                  00059504
000597                                                                  00059600
000598     IF AR099-SYS-ID = 'HDR '                                     00059804
               MOVE AR099-HDR-DATE TO PV-HOLD-DATE                      00059910
           ELSE                                                         00060004
               IF AR099-SYS-ID = 'TLR '                                 00060110
                   CONTINUE                                             00060204
               ELSE                                                     00060304
                   PERFORM 2500-WRITE-ACCT-FILE                         00060404
               END-IF                                                   00060504
           END-IF.                                                      00060604
000704                                                                  00070300
000705     PERFORM 8000-READ-INPUT-FILE.                                00070400
000706                                                                  00070500
000707                                                                  00070600
000708 2500-WRITE-ACCT-FILE.                                            00070704
000709**** DISPLAY '2500-WRITE-ACCT-FILE'                               00070804
001502                                                                  00157100
           MOVE PV-HOLD-DATE             TO AR098-PURGE-DATE.           00157404
           MOVE AR099-FULL-ACCT-NO       TO AR098-ACCT-NBR-16.          00157504
           MOVE AR099-FULL-ACCT-NO(7:10) TO AR098-ACCT-NBR-10.          00157604
001506                                                                  00157700
001507     WRITE AR-OUTPUT-RECORD                                       00157804
001508       FROM AR098-PURGE-REC.                                      00157904
001509                                                                  00158000
001510     ADD +1 TO PV-OUTPUT-COUNT.                                   00158105
001511                                                                  00159000
001708                                                                  00186600
001700 8000-READ-INPUT-FILE.                                            00186705
001701     READ AR-INPUT-FILE                                           00186805
001702         INTO AR099-FD-PURGE-ACCT-DATA                            00186913
001703     AT END                                                       00187005
001704         SET PS-EOF                   TO TRUE                     00187105
001705     NOT AT END                                                   00187205
001706         ADD 1                        TO PV-INPUT-COUNT           00187305
               IF AR099-SYS-ID = 'HDR '                                 00187611
                   MOVE AR-INPUT-REC1 TO AR099-FD-PURGE-ACCT-HDR-TRL    00187711
               END-IF                                                   00188011
001707     END-READ.                                                    00188105
001708                                                                  00188205
001709 9000-EOJ.                                                        00188300
001710                                                                  00188400
001711     CLOSE AR-INPUT-FILE                                          00188504
001712           AR-OUTPUT-FILE.                                        00188604
001715                                                                  00188700
001716     DISPLAY '--------------------------------------------'.      00188800
001717     DISPLAY '     * ARKUT121 SUMMARY STATISTICS *        '.      00188900
001718     DISPLAY '--------------------------------------------'.      00189000
001719     DISPLAY '############################################'.      00189100
001720     DISPLAY '                                            '.      00189200
001721     DISPLAY '            DISPLAY TOTALS                  '.      00189300
001722     DISPLAY '                                            '.      00189400
001723     DISPLAY '############################################'.      00189500
001724     MOVE PV-INPUT-COUNT              TO PV-DISP-NBR.             00189600
001725     DISPLAY 'EXTRACTS READ                = ' PV-DISP-NBR.       00189700
001726                                                                  00189800
001727     MOVE PV-OUTPUT-COUNT             TO PV-DISP-NBR.             00189904
001728     DISPLAY 'RECORDS WRITTEN              = ' PV-DISP-NBR.       00190004
001729                                                                  00190100
001744                                                                  00190200
001780                                                                  00193800
001781 9910-ERROR.                                                      00193900
001782                                                                  00194000
001783      DISPLAY '** ABEND **       ** = '.                          00194100
001784      DISPLAY '** PROGRAM        ** = ' PC-PROGRAM-NAME.          00194200
001785      DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.       00194300
001787                                                                  00194500
001788      MOVE 4013                  TO PV-ABEND-CODE                 00194600
001790      CALL 'ILBOABN0' USING PV-ABEND-CODE.                        00194700
