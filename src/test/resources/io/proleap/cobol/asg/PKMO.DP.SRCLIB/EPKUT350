000100 IDENTIFICATION DIVISION.                                         00010006
000200 PROGRAM-ID.      EPKUT350.                                       00020006
000300 AUTHOR.          COGNIZANT.                                      00030006
000400 DATE-WRITTEN.    SEP, 2013.                                      00040006
000500                                                                  00050006
000600*-----------------------------------------------------------      00060006
000700*          STORE GROUP CORRECTION IDENTIFIER                      00070006
000800*-----------------------------------------------------------      00080006
000900*-----------------------------------------------------------      00090006
001000* HISTORY LOG:                                                    00100006
001100*-----------------------------------------------------------      00110006
001200*                                                                 00120099
001300* DATE: 09/30/2013                                                00130099
001400* WR/IR#:                                                         00140099
001500* PROGRAMMER: COGNIZANT                                           00150099
001600* THIS PROGRAM IS A MODIFIED VERSION OF EPKUT120.                 00160099
001700* DESCRIPTION: REMOVED THE EMERGENCY FILE EXTRACT PROCESS IN THE  00170099
001800*   NIGHTLY CYCLE. THIS IS DONE TO AVOID SORTING ISSUE FOR PROMO  00180099
001900*   SEND TO STORES.                                               00190099
002000* DATE: MM/DD/CCYY                                                00200099
002100* WR/IR#:                                                         00210099
002200* PROGRAMMER:                                                     00220099
002300* DESCRIPTION:                                                    00230099
002400*                                                                 00240099
002500*-----------------------------------------------------------      00250099
002600                                                                  00260099
002700*----------------------------------------------------------       00270099
002800 ENVIRONMENT DIVISION.                                            00280099
002900*----------------------------------------------------------       00290099
003000 CONFIGURATION SECTION.                                           00300099
003100 SOURCE-COMPUTER.        IBM-3090.                                00310099
003200 OBJECT-COMPUTER.        IBM-3090.                                00320099
003300                                                                  00330099
003400 INPUT-OUTPUT SECTION.                                            00340099
003500                                                                  00350099
003600 FILE-CONTROL.                                                    00360099
003700                                                                  00370099
003800     SELECT CONTROL-CARD-PGM-LAST-RUN-TMST                        00380099
003900       ASSIGN TO INP01.                                           00390099
004000     SELECT CONTROL-CARD-PGM-CURR-TMST                            00400099
004100       ASSIGN TO INP02.                                           00410099
004200     SELECT CONTROL-CARD-CURR-PRICG-DTE                           00420099
004300       ASSIGN TO INP03.                                           00430099
004400     SELECT CONTROL-CARD-FUTRE-CORR-DTE                           00440099
004500       ASSIGN TO INP04.                                           00450099
004600     SELECT CONTROL-CARD-CRIT-EFF-DTE                             00460099
004700       ASSIGN TO INP05.                                           00470099
004800     SELECT PROMO-NIGHT-FILE                                      00480099
004900       ASSIGN TO OUT01.                                           00490099
005000                                                                  00500099
005100 DATA DIVISION.                                                   00510099
005200 FILE SECTION.                                                    00520099
005300                                                                  00530099
005400 FD  CONTROL-CARD-PGM-LAST-RUN-TMST                               00540099
005500     RECORDING MODE F                                             00550099
005600     BLOCK CONTAINS 0 RECORDS                                     00560099
005700     LABEL RECORDS ARE OMITTED                                    00570099
005800     DATA RECORD IS CNTRL-CARD-PGM-LAST-RUN-REC.                  00580099
005900 01  CNTRL-CARD-PGM-LAST-RUN-REC                   PIC  X(080).   00590099
006000                                                                  00600099
006100 FD  CONTROL-CARD-PGM-CURR-TMST                                   00610099
006200     RECORDING MODE F                                             00620099
006300     BLOCK CONTAINS 0 RECORDS                                     00630099
006400     LABEL RECORDS ARE OMITTED                                    00640099
006500     DATA RECORD IS CNTRL-CARD-PGM-CURR-RUN-REC.                  00650099
006600 01  CNTRL-CARD-PGM-CURR-RUN-REC                   PIC  X(080).   00660099
006700                                                                  00670099
006800 FD  CONTROL-CARD-CURR-PRICG-DTE                                  00680099
006900     RECORDING MODE F                                             00690099
007000     BLOCK CONTAINS 0 RECORDS                                     00700099
007100     LABEL RECORDS ARE OMITTED                                    00710099
007200     DATA RECORD IS CNTRL-CARD-CURR-PRICG-DTE-REC.                00720099
007300 01  CNTRL-CARD-CURR-PRICG-DTE-REC                 PIC  X(080).   00730099
007400                                                                  00740099
007500 FD  CONTROL-CARD-FUTRE-CORR-DTE                                  00750099
007600     RECORDING MODE F                                             00760099
007700     BLOCK CONTAINS 0 RECORDS                                     00770099
007800     LABEL RECORDS ARE OMITTED                                    00780099
007900     DATA RECORD IS CNTRL-CARD-FUTRE-CORR-DTE-REC.                00790099
008000 01  CNTRL-CARD-FUTRE-CORR-DTE-REC                 PIC  X(080).   00800099
008100                                                                  00810099
008200 FD  CONTROL-CARD-CRIT-EFF-DTE                                    00820099
008300     RECORDING MODE F                                             00830099
008400     BLOCK CONTAINS 0 RECORDS                                     00840099
008500     LABEL RECORDS ARE OMITTED                                    00850099
008600     DATA RECORD IS CNTRL-CARD-CRIT-EFF-DTE-REC.                  00860099
008700 01  CNTRL-CARD-CRIT-EFF-DTE-REC                   PIC  X(080).   00870099
008800                                                                  00880099
008900 FD  PROMO-NIGHT-FILE                                             00890099
009000     RECORDING MODE F                                             00900099
009100     BLOCK CONTAINS 0 RECORDS                                     00910099
009200     LABEL RECORDS ARE OMITTED                                    00920099
009300     DATA RECORD IS PROMO-NIGHT-ID-RECORD.                        00930099
009400 01  PROMO-NIGHT-RECORD                            PIC  X(200).   00940099
009500                                                                  00950099
009600 WORKING-STORAGE SECTION.                                         00960099
009700*-----------------------------------------------------------      00970099
009800* PS - PROGRAM SWITCHES                                           00980099
009900*-----------------------------------------------------------      00990099
010000 01  PS-PROGRAM-SWITCHES.                                         01000099
010100     05  PS-RMS-STORE-CSR-EOF-SW                   PIC  X(001).   01010099
010200       88  PS-RMS-STORE-CSR-EOF                      VALUE 'Y'.   01020099
010300       88  PS-RMS-STORE-CSR-NOT-EOF                  VALUE 'N'.   01030099
010400     05  PS-ADHOC-STORE-CSR-EOF-SW                 PIC  X(001).   01040099
010500       88  PS-ADHOC-STORE-CSR-EOF                    VALUE 'Y'.   01050099
010600       88  PS-ADHOC-STORE-CSR-NOT-EOF                VALUE 'N'.   01060099
010700     05  PS-STORE-OVRRDE-CSR-EOF-SW                PIC  X(001).   01070099
010800       88  PS-STORE-OVRRDE-CSR-EOF                   VALUE 'Y'.   01080099
010900       88  PS-STORE-OVRRDE-CSR-NOT-EOF               VALUE 'N'.   01090099
011000     05  PS-PRNT-STORE-CALL-COMPLETE               PIC  X(001).   01100099
011100       88  PS-PRNT-CALL-COMPLETED                    VALUE 'Y'.   01110099
011200     05  PS-RMS-PRNT-STORE-NOT-FND-SW              PIC  X(001).   01120099
011300       88  PS-RMS-PRNT-STORE-FND                     VALUE 'Y'.   01130099
011400       88  PS-RMS-PRNT-STORE-NOT-FND                 VALUE 'N'.   01140099
011500     05  PS-ADHC-PRNT-STORE-NOT-FND-SW             PIC  X(001).   01150099
011600       88  PS-ADHC-PRNT-STORE-FND                    VALUE 'Y'.   01160099
011700       88  PS-ADHC-PRNT-STORE-NOT-FND                VALUE 'N'.   01170099
011800     05  PS-CHK-OVERRDS-LVL-SW                     PIC  X(001).   01180099
011900       88  PS-OVERRDS-CHK-OF-PRNT-STRGP              VALUE 'P'.   01190099
012000       88  PS-OVERRDS-CHK-OF-CHG-STRGP               VALUE 'C'.   01200099
012100       88  PS-NO-OVERRDS-CHK                         VALUE 'N'.   01210099
012200     05  PS-ADHC-OUTPUT-RECS-CREATE-SW             PIC  X(001).   01220099
012300       88  PS-ADHC-REC-CREATED                       VALUE 'Y'.   01230099
012400       88  PS-ADHC-RECS-NOT-CREATED                  VALUE 'N'.   01240099
012500     05  PS-WRITE-PROMO-SW                         PIC  X(001).   01250099
012600       88  PS-WRITE-PROMO                            VALUE 'Y'.   01260099
012700       88  PS-DONT-WRITE-PROMO                       VALUE 'N'.   01270099
012800     05  PS-FILE-STATUS                            PIC  X(002).   01280099
012900       88  PS-SUCCESSFUL-COMPLETION                  VALUE '00'.  01290099
013000       88  PS-END-OF-FILE                            VALUE '10'.  01300099
013100       88  PS-SUCCESSFUL-OPEN                        VALUE '97'.  01310099
013200     05  PS-END-OF-CNTL-CRD-SW                     PIC  X(001).   01320099
013300       88  PS-END-OF-CNTL-CRD-FILE                   VALUE 'Y'.   01330099
013400       88  PS-NOT-END-OF-CNTL-CRD-FILE               VALUE 'N'.   01340099
013500     05  PS-ACT-RMS-OVERRDS-EXIST-SW               PIC  X(001).   01350099
013600       88  PS-ACT-RMS-OVERRDS-EXIST                  VALUE 'Y'.   01360099
013700       88  PS-ACT-RMS-OVERRDS-DONT-EXIST             VALUE 'N'.   01370099
013800                                                                  01380099
013900*-----------------------------------------------------------      01390099
014000* PROGRAM CONSTANTS                                               01400099
014100*-----------------------------------------------------------      01410099
014200 01  PC-PROGRAM-CONSTANTS.                                        01420099
014300     05  PC-CURRENT-PROGRAM-NAME                   PIC  X(008)    01430099
014400       VALUE 'EPKUT350'.                                          01440099
014500     05  PC-PRICG-BUS-EVENT                        PIC  X(003)    01450099
014600       VALUE '090'.                                               01460099
014700     05  PC-PRICG-STR-GRP-EVENT                    PIC  X(003)    01470099
014800       VALUE '120'.                                               01480099
014900     05  PC-RMS-PRC-SETUP-IND                      PIC  X(001)    01490099
015000       VALUE 'R'.                                                 01500099
015100     05  PC-ADHOC-PRC-SETUP-IND                    PIC  X(001)    01510099
015200       VALUE 'A'.                                                 01520099
015300     05  PC-ADHOC-STR-GRP-TYP-CDE                  PIC  X(005)    01530099
015400       VALUE '99999'.                                             01540099
015500     05  PC-FILE-ACT-TYPE                          PIC  X(003)    01550099
015600       VALUE 'CHG'.                                               01560099
015700     05  PC-APPLY-NIGHTLY                          PIC  X(001)    01570099
015800       VALUE 'N'.                                                 01580099
015900     05  PC-PROMO-STAT-CDE                         PIC  X(001).   01590099
016000       88  PC-SCHEDULED-STATUS                       VALUE 'S'.   01600099
016100       88  PC-DELETE-STATUS                          VALUE 'D'.   01610099
016200       88  PC-CANCEL-STATUS                          VALUE 'C'.   01620099
016300     05  PC-ADD-STAT-CDE                           PIC  X(001)    01630099
016400       VALUE 'A'.                                                 01640099
016500     05  PC-DELETE-STAT-CDE                        PIC  X(001)    01650099
016600       VALUE 'D'.                                                 01660099
016700     05  PC-MDSE-INCL-BOTH-IND                     PIC  X(001)    01670099
016800       VALUE 'B'.                                                 01680099
016900     05  PC-STORE-TYPE                             PIC  X(001).   01690099
017000       88  PC-STORE-TYPE-RMS                         VALUE 'R'.   01700099
017100       88  PC-STORE-TYPE-ADHOC                       VALUE 'D'.   01710099
017200     05  PC-PERIOD                                 PIC  X(001)    01720099
017300       VALUE '.'.                                                 01730099
017400     05  PC-DASH                                   PIC  X(001)    01740099
017500       VALUE '-'.                                                 01750099
017600     05  PC-9S                                     PIC  X(006)    01760099
017700       VALUE '999999'.                                            01770099
017800     05  PC-59                                     PIC  X(002)    01780099
017900       VALUE '59'.                                                01790099
018000     05  PC-11                                     PIC  X(002)    01800099
018100       VALUE '11'.                                                01810099
018200                                                                  01820099
018300*-----------------------------------------------------------      01830099
018400* PV- PROGRAM VARIABLES                                           01840099
018500*-----------------------------------------------------------      01850099
018600 01  PV-PROGRAM-VARAIBLES.                                        01860099
018700     05  PV-SQL-SUB                                PIC S9(004)    01870099
018800                                                     VALUE +0     01880099
018900                                                     COMP.        01890099
019000     05  PV-ACTL-STRT-TMST.                                       01900099
019100       10  PV-ACTL-STRT-TMST-DATE                  PIC  X(010)    01910099
019200                                                     VALUE SPACES.01920099
019300       10  FILLER                                  PIC  X(016)    01930099
019400                                                     VALUE SPACES.01940099
019500     05  PV-ACTL-END-TMST.                                        01950099
019600       10  PV-ACTL-END-TMST-DATE                   PIC  X(010)    01960099
019700                                                     VALUE SPACES.01970099
019800       10  FILLER                                  PIC  X(016)    01980099
019900                                                     VALUE SPACES.01990099
020000     05  PV-PRNT-RMS-ACTL-STRT-TMST.                              02000099
020100       10  PV-PRNT-RMS-ACTL-STRT-DATE              PIC  X(010)    02010099
020200                                                     VALUE SPACES.02020099
020300       10  FILLER                                  PIC  X(016)    02030099
020400                                                     VALUE SPACES.02040099
020500     05  PV-PRNT-RMS-ACTL-END-TMST.                               02050099
020600       10  PV-PRNT-RMS-ACTL-END-DATE               PIC  X(010)    02060099
020700                                                     VALUE SPACES.02070099
020800       10  FILLER                                  PIC  X(016)    02080099
020900                                                     VALUE SPACES.02090099
021000     05  PV-PRNT-ADHOC-ACTL-STRT-TMST.                            02100099
021100       10  PV-PRNT-ADHOC-ACTL-STRT-DATE            PIC  X(010)    02110099
021200                                                     VALUE SPACES.02120099
021300       10  FILLER                                  PIC  X(016)    02130099
021400                                                     VALUE SPACES.02140099
021500     05  PV-PRNT-ADHOC-ACTL-END-TMST.                             02150099
021600       10  PV-PRNT-ADHOC-ACTL-END-DATE             PIC  X(010)    02160099
021700                                                     VALUE SPACES.02170099
021800       10  FILLER                                  PIC  X(016)    02180099
021900                                                     VALUE SPACES.02190099
022000     05  PV-SOR-LAST-UPD-TMST                      PIC  X(026)    02200099
022100                                                     VALUE SPACES.02210099
022200     05  PV-EFF-STRT-TMST                          PIC  X(026)    02220099
022300                                                     VALUE SPACES.02230099
022400     05  PV-EFF-END-TMST                           PIC  X(026)    02240099
022500                                                     VALUE SPACES.02250099
022600     05  PV-EFF-END-NULL                           PIC S9(004)    02260099
022700                                                     VALUE ZEROS  02270099
022800                                                     COMP.        02280099
022900     05  PV-ABEND-CODE                             PIC  9999      02290099
023000                                                     VALUE ZEROS  02300099
023100                                                     COMP.        02310099
023200     05  PV-FUL-FILE-STR                           PIC  9(005)    02320099
023300                                                     VALUE ZEROS. 02330099
023400     05  PV-STORE-PROMO-INTFC-ID                   PIC S9(010)    02340099
023500                                                     VALUE ZEROS  02350099
023600                                                     COMP-3.      02360099
023700     05  PV-STORE-MDSE-LNE-ID                      PIC S9(010)    02370099
023800                                                     VALUE ZEROS  02380099
023900                                                     COMP-3.      02390099
024000     05  PV-STORE-STR-SELN-HIER-CDE                PIC S9(002)    02400099
024100                                                     VALUE ZEROS  02410099
024200                                                     COMP-3.      02420099
024300     05  EP111-CC-DATE-PLUS1                       PIC  X(010)    02430099
024400                                                     VALUE SPACES.02440099
024500     05  EP113-CC-CRNT-DTE-MINUS1                  PIC  X(010)    02450099
024600                                                     VALUE SPACES.02460099
024700     05  PV-OVERRIDES-EXIST                        PIC  X(001)    02470099
024800                                                     VALUE SPACES.02480099
024900                                                                  02490099
025000                                                                  02500099
025100     05  PV-HOLD-TMST.                                            02510099
025200         10  PV-HOLD-TMST-DTE           PIC X(10)  VALUE SPACES.  02520099
025300         10  FILLER                     PIC X(01)  VALUE SPACES.  02530099
025400         10  PV-HOLD-TMST-TM.                                     02540099
025500             15  PV-HOLD-TMST-TM-HH     PIC X(02).                02550099
025600             15  PV-HOLD-TMST-TM-HH-NUM REDEFINES                 02560099
025700                 PV-HOLD-TMST-TM-HH     PIC 9(02).                02570099
025800             15  FILLER                 PIC X(01)  VALUE SPACES.  02580099
025900             15  PV-HOLD-TMST-TM-MM     PIC X(02).                02590099
026000             15  PV-HOLD-TMST-TM-MM-NUM REDEFINES                 02600099
026100                 PV-HOLD-TMST-TM-MM     PIC 9(02).                02610099
026200             15  FILLER                 PIC X(01)  VALUE SPACES.  02620099
026300             15  PV-HOLD-TMST-TM-SS     PIC X(02).                02630099
026400             15  PV-HOLD-TMST-TM-SS-NUM REDEFINES                 02640099
026500                 PV-HOLD-TMST-TM-SS     PIC 9(02).                02650099
026600             15  FILLER                 PIC X(01)  VALUE SPACES.  02660099
026700             15  PV-HOLD-TMST-TM-NN     PIC X(06).                02670099
026800             15  PV-HOLD-TMST-TM-NN-NUM REDEFINES                 02680099
026900                 PV-HOLD-TMST-TM-NN     PIC 9(06).                02690099
027000                                                                  02700099
027100     05  PV-FORMAT-TMST.                                          02710099
027200         10  PV-FORMAT-TMST-DTE         PIC X(10)  VALUE SPACES.  02720099
027300         10  PV-FORMAT-TMST-DASH        PIC X(01)  VALUE '-'.     02730099
027400         10  PV-FORMAT-TMST-TM.                                   02740099
027500             15  PV-FORMAT-TMST-TM-HH   PIC X(02).                02750099
027600             15  PV-FORMAT-TMST-TM-HH-NUM REDEFINES               02760099
027700                 PV-FORMAT-TMST-TM-HH   PIC 9(02).                02770099
027800             15  PV-FORMAT-TMST-TM-D1   PIC X(01)  VALUE '.'.     02780099
027900             15  PV-FORMAT-TMST-TM-MM   PIC X(02).                02790099
028000             15  PV-FORMAT-TMST-TM-MM-NUM REDEFINES               02800099
028100                 PV-FORMAT-TMST-TM-MM   PIC 9(02).                02810099
028200             15  PV-FORMAT-TMST-TM-D2   PIC X(01)  VALUE '.'.     02820099
028300             15  PV-FORMAT-TMST-TM-SS   PIC X(02).                02830099
028400             15  PV-FORMAT-TMST-TM-SS-NUM REDEFINES               02840099
028500                 PV-FORMAT-TMST-TM-SS   PIC 9(02).                02850099
028600             15  PV-FORMAT-TMST-TM-D3   PIC X(01)  VALUE '.'.     02860099
028700             15  PV-FORMAT-TMST-TM-NN   PIC X(06).                02870099
028800             15  PV-FORMAT-TMST-TM-NN-NUM REDEFINES               02880099
028900                 PV-FORMAT-TMST-TM-NN   PIC 9(06).                02890099
028901                                                                  02900099
028902*-----------------------------------------------------------      02910019
028903* IV- DB2 INDICATOR VARIABLES                                     02920019
028904*-----------------------------------------------------------      02930019
028905 01  IV-INDICATOR-VARIABLES.                                      02940019
028906     05  IV-PRNT-GP-TYP-CDE                        PIC S9(004)    02950096
028907                                                     VALUE ZEROS  02960019
028908                                                     COMP.        02970019
028909     05  IV-PRNT-STR-GP-CDE                        PIC S9(004)    02980020
028910                                                     VALUE ZEROS  02990019
028911                                                     COMP.        03000019
028912     05  IV-PRNT-STR-GP-ID                         PIC S9(004)    03010020
028913                                                     VALUE ZEROS  03020019
028914                                                     COMP.        03030019
028915     05  IV-PRNT-ADHC-GP-ID                        PIC S9(004)    03040020
028916                                                     VALUE ZEROS  03050019
028917                                                     COMP.        03060099
028918*----------------------------------------------------------       03070099
028919* FULL FILE EXTRACT OUTPUT FILE.                                  03080099
028920*----------------------------------------------------------       03090099
028930     COPY EPRD072.                                                03100099
028940                                                                  03110099
028950*----------------------------------------------------------       03120099
028960* EPCC400 CONTROL CARD LAYOUT                                     03130099
028970*----------------------------------------------------------       03140099
028980     COPY EPRD400.                                                03150099
028990                                                                  03160099
029000*----------------------------------------------------------       03170099
029100* EPCC401 CONTROL CARD LAYOUT                                     03180099
029200*----------------------------------------------------------       03190099
029300     COPY EPRD401.                                                03200099
029400                                                                  03210099
029500*----------------------------------------------------------       03220099
029600* EPCC111 CONTROL CARD LAYOUT                                     03230099
029700*----------------------------------------------------------       03240099
029800     COPY EPRD111.                                                03250099
029900                                                                  03260099
030000*----------------------------------------------------------       03270099
030100* EPCC113 CONTROL CARD LAYOUT                                     03280099
030200*----------------------------------------------------------       03290099
030300     COPY EPRD113.                                                03300099
030400                                                                  03310099
030500*----------------------------------------------------------       03320099
030600* EPCC128 CONTROL CARD LAYOUT                                     03330099
030700*----------------------------------------------------------       03340099
030800     COPY EPRD128.                                                03350099
030900                                                                  03360099
031000*----------------------------------------------------------       03370099
031100* DATE ROUTINE COPY MEMBERS                                       03380099
031200*----------------------------------------------------------       03390099
031300     COPY DPWS500.                                                03400099
031400                                                                  03410099
031500*-----------------------------------------------------------      03420099
031600* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         03430099
031700*-----------------------------------------------------------      03440099
031800     COPY DPWS004.                                                03450099
031900                                                                  03460099
032000*-----------------------------------------------------------      03470099
032100* DB2 ABEND COPYBOOK                                              03480099
032200*-----------------------------------------------------------      03490099
032300     COPY DPWS900.                                                03500099
032400                                                                  03510099
032500*-----------------------------------------------------------      03520099
032600* DB2 MESSAGE AREA                                                03530099
032700*-----------------------------------------------------------      03540099
032800     COPY SQLCA2.                                                 03550099
032900                                                                  03560099
033000 01  PC-PROGRAM-COUNTERS.                                         03570099
033100     05  PC-CNT-READ-RECS                          PIC  9(009)    03580099
033200                                                     VALUE 0.     03590099
033300     05  PC-CNT-NIGHT-RECS                         PIC  9(009)    03600099
033400                                                     VALUE 0.     03610099
033500     05  PC-CNT-PROMO-RECS                         PIC  9(009)    03620099
033600                                                     VALUE 0.     03630099
033700     05  PC-CNT-OVRRDE-RECS                        PIC  9(009)    03640099
033800                                                     VALUE 0.     03650099
033900     05  PC-CNT-ADHOC-RECS                         PIC  9(009)    03660099
034000                                                     VALUE 0.     03670099
034100     05  PC-CNT-RMS-RECS                           PIC  9(009)    03680099
034200                                                     VALUE 0.     03690099
034300     05  PC-CNT-PMAP-RECS                          PIC  9(009)    03700099
034400                                                     VALUE 0.     03710099
034500     05  PC-CNT-ERROR-RECS                         PIC  9(009)    03720099
034600                                                     VALUE 0.     03730099
034700     05  PC-CNT-ALL-RECS                           PIC  9(009)    03740099
034800                                                     VALUE 0.     03750099
034900     05  PC-CNT-SPACES                             PIC  9(009)    03760099
035000                                                     VALUE 0.     03770099
035100     05  PC-CNT-POS                                PIC  9(009)    03780099
035200                                                     VALUE 0.     03790099
035300     05  PC-MAX-RETRIES                            PIC S9(004)    03800099
035400                                                     VALUE +5     03810099
035500                                                     COMP.        03820099
035600                                                                  03830099
035700*-----------------------------------------------------------      03840099
035800* PARENT RMS LAYOUT FOR PARENT DB2 SELECT.                        03850099
035900*-----------------------------------------------------------      03860099
036000 01  PRNT-RMS-RECORD.                                             03870099
036100     10 PRNT-RMS-PROMO-INTFC-ID       PIC  S9(10)V COMP-3.        03880099
036200     10 PRNT-RMS-MDSE-LNE-ID          PIC  S9(10)V COMP-3.        03890099
036300     10 PRNT-RMS-STR-GP-TYP-CDE       PIC  S9(4) COMP.            03900099
036400     10 PRNT-RMS-STR-GP-ID            PIC  S9(4) COMP.            03910099
036500     10 PRNT-RMS-PROMO-PRIC-VER-ID    PIC  S9(10)V COMP-3.        03920099
036600     10 PRNT-RMS-STR-SELN-HIER-CDE    PIC  S9(2)V COMP-3.         03930099
036700     10 PRNT-RMS-STAT-CDE             PIC   X(1).                 03940099
036800     10 PRNT-RMS-PRNT-GP-TYP-CDE      PIC   X(1).                 03950099
036900     10 PRNT-RMS-PRNT-STR-GP-CDE      PIC  S9(4) COMP.            03960099
037000     10 PRNT-RMS-PRNT-STR-GP-ID       PIC  S9(4) COMP.            03970099
037100     10 PRNT-RMS-PRNT-ADHC-GP-ID      PIC  S9(10)V COMP-3.        03980099
037200     10 PRNT-RMS-PROMO-STRT-TMST      PIC   X(26).                03990099
037300     10 PRNT-RMS-PROMO-END-TMST       PIC   X(26).                04000099
037400     10 PRNT-RMS-ACTL-STRT-TMST       PIC   X(26).                04010099
037500     10 PRNT-RMS-ACTL-END-TMST        PIC   X(26).                04020099
037600     10 PRNT-RMS-LAST-UPD-TMST        PIC   X(26).                04030099
037700     10 PRNT-RMS-SOR-LAST-UPD-TMST    PIC   X(26).                04040099
037800     10 PRNT-RMS-LAST-ACTN-CDE        PIC   X(1).                 04050099
037900                                                                  04060099
038000*-----------------------------------------------------------      04070099
038100* PARENT ADHOC LAYOUT FOR PARENT DB2 SELECT.                      04080099
038200*-----------------------------------------------------------      04090099
038300 01  PRNT-ADHOC-RECORD.                                           04100099
038400     10 PRNT-ADHOC-PROMO-INTFC-ID                  PIC  S9(10)V   04110099
038500                                                     COMP-3.      04120099
038600     10 PRNT-ADHOC-MDSE-LNE-ID                     PIC  S9(10)V   04130099
038700                                                     COMP-3.      04140099
038800     10 PRNT-ADHOC-ADHC-STR-GP-ID                  PIC  S9(10)V   04150099
038900                                                     COMP-3.      04160099
039000     10 PRNT-ADHOC-PROMO-PRIC-VER-ID               PIC  S9(10)V   04170099
039100                                                     COMP-3.      04180099
039200     10 PRNT-ADHOC-STR-SELN-HIER-CDE               PIC  S9(2)V    04190099
039300                                                     COMP-3.      04200099
039400     10 PRNT-ADHOC-STAT-CDE                        PIC   X(1).    04210099
039500     10 PRNT-ADHOC-PROMO-STRT-TMST                 PIC   X(26).   04220099
039600     10 PRNT-ADHOC-PROMO-END-TMST                  PIC   X(26).   04230099
039700     10 PRNT-ADHOC-ACTL-STRT-TMST                  PIC   X(26).   04240099
039800     10 PRNT-ADHOC-ACTL-END-TMST                   PIC   X(26).   04250099
039900     10 PRNT-ADHOC-LAST-UPD-TMST                   PIC   X(26).   04260099
040000     10 PRNT-ADHOC-SOR-LAST-UPD-TMST               PIC   X(26).   04270099
040100     10 PRNT-ADHOC-LAST-ACTN-CDE                   PIC   X(1).    04280099
040200                                                                  04290099
040300*-----------------------------------------------------------      04300099
040400* ERROR HANDLING                                                  04310099
040500*-----------------------------------------------------------      04320099
040600 01  PV-MISC-ABEND-FIELDS.                                        04330099
040700     05  PV-PARAGRAPH-NAME                         PIC  X(030)    04340099
040800                                                     VALUE SPACE. 04350099
040900     05  PV-OPERATION-MSG-1                        PIC  X(040)    04360099
041000                                                     VALUE SPACE. 04370099
041100     05  PV-OPERATION-MSG-2                        PIC  X(040)    04380099
041200                                                     VALUE SPACE. 04390099
041300     05  PV-DB2-OPERATION                          PIC  X(030)    04400099
041400                                                     VALUE SPACE. 04410099
041500 01  ABEND-CODE                                    PIC S9(004)    04420099
041600                                                     VALUE ZEROS  04430099
041700                                                     COMP         04440099
041800                                                     SYNC.        04450099
041900   88  ABEND-4003-CTRL-CARD-ERROR                    VALUE +4003. 04460099
042000   88  ABEND-4013-DB2-ERROR                          VALUE +4013. 04470099
042100   88  ABEND-4019-CAL-SUB-ERROR                      VALUE +4019. 04480099
042200   88  ABEND-4020-MQ-ERROR                           VALUE +4020. 04490099
042300   88  ABEND-4444-FORCED-ABEND                       VALUE +4444. 04500099
042400   88  ABEND-4008                                    VALUE +4008. 04510099
042500                                                                  04520099
042600                                                                  04530099
042700*-----------------------------------------------------------      04540099
042800* DB2 COMMUNICATIONS AREA                                         04550099
042900*-----------------------------------------------------------      04560099
043000     EXEC SQL                                                     04570099
043100       INCLUDE SQLCA                                              04580099
043200     END-EXEC.                                                    04590099
043300                                                                  04600099
043400*-----------------------------------------------------------      04610099
043500* DB2 TABLE XST00028(XST_MDSE_LNE_SELN) - MERCHANDISE TABLE       04620099
043600*-----------------------------------------------------------      04630099
043700     EXEC SQL                                                     04640099
043800       INCLUDE XST00028                                           04650099
043900     END-EXEC.                                                    04660099
044000                                                                  04670099
044100*-----------------------------------------------------------      04680099
044200* DB2 TABLE XST00029(XST_PROMO_STR_GP) - STORE ZONE PRICING       04690099
044300*                                               TABLE             04700099
044400*-----------------------------------------------------------      04710099
044500     EXEC SQL                                                     04720099
044600       INCLUDE XST00029                                           04730099
044700     END-EXEC.                                                    04740099
044800                                                                  04750099
044900*-----------------------------------------------------------      04760099
045000* DB2 TABLE XST00031(XST_PROMO_ADHC_RLT) ADHOC RELATION           04770099
045100*-----------------------------------------------------------      04780099
045200     EXEC SQL                                                     04790099
045300       INCLUDE XST00031                                           04800099
045400     END-EXEC.                                                    04810099
045500                                                                  04820099
045600*----------------------------------------------------------------*04830099
045700* DB2 TABLE XST00013(XST_VND_STYL) - VENDOR STYLE TABLE           04840099
045800*----------------------------------------------------------------*04850099
045900     EXEC SQL                                                     04860099
046000       INCLUDE XST00013                                           04870099
046100     END-EXEC.                                                    04880099
046200                                                                  04890099
046300*----------------------------------------------------------------*04900099
046400* DB2 AREA FOR SYSDUMMY                                           04910099
046500*----------------------------------------------------------------*04920099
046600     EXEC SQL                                                     04930099
046700       INCLUDE SYSDUMMY                                           04940099
046800     END-EXEC.                                                    04950099
046900                                                                  04960099
047000*-----------------------------------------------------------      04970099
047100* RMS STORE CHANGE CURSOR. (RMS)                                  04980099
047200*-----------------------------------------------------------      04990099
047300     EXEC SQL                                                     05000099
047400       DECLARE RMS-STORE CURSOR FOR                               05010099
047500         SELECT STRGP.PROMO_INTFC_ID                              05020099
047600               ,STRGP.MDSE_LNE_ID                                 05030099
047700               ,STRGP.STR_GP_TYP_CDE                              05040099
047800               ,STRGP.STR_GP_ID                                   05050099
047900               ,STRGP.STR_SELN_HIER_CDE                           05060099
048000               ,STRGP.STAT_CDE                                    05070099
048100               ,STRGP.PRNT_GP_TYP_CDE                             05080099
048200               ,STRGP.PRNT_STR_GP_CDE                             05090099
048300               ,STRGP.PRNT_STR_GP_ID                              05100099
048400               ,STRGP.PRNT_ADHC_GP_ID                             05110099
048500               ,STRGP.ACTL_STRT_TMST                              05120099
048600               ,STRGP.ACTL_END_TMST                               05130099
048700               ,STRGP.LAST_UPD_TMST                               05140099
048800               ,STRGP.SOR_LAST_UPD_TMST                           05150099
048900               ,STRGP.LAST_ACTN_CDE                               05160099
049000               ,MDSSEL.PRICG_TYP_CDE                              05170099
049100         FROM XST_PROMO_STR_GP   STRGP                            05180099
049200             ,XST_MDSE_LNE_SELN  MDSSEL                           05190099
049300         WHERE MDSSEL.PROMO_INTFC_ID = STRGP.PROMO_INTFC_ID       05200099
049400           AND MDSSEL.MDSE_LNE_ID    = STRGP.MDSE_LNE_ID          05210099
049500           AND (STRGP.LAST_UPD_TMST                               05220099
049600               BETWEEN :EP400-CC-PREV-RUN-CUTOFF-TMST             05230099
049700                   AND :EP401-CC-CURR-RUN-CUTOFF-TMST)            05240099
049800           AND ((:EP111-CC-CRNT-DTE                               05250099
049900               BETWEEN DATE(STRGP.ACTL_STRT_TMST)                 05260099
050000                   AND DATE(STRGP.ACTL_END_TMST))                 05270099
050100           OR  (DATE(STRGP.ACTL_STRT_TMST)                        05280099
050200               BETWEEN :EP111-CC-DATE-PLUS1                       05290099
050300                   AND :EP113-CC-CRNT-DTE-MINUS1))                05300099
050400         UNION                                                    05310099
050500         SELECT STRGP.PROMO_INTFC_ID                              05320099
050600               ,STRGP.MDSE_LNE_ID                                 05330099
050700               ,STRGP.STR_GP_TYP_CDE                              05340099
050800               ,STRGP.STR_GP_ID                                   05350099
050900               ,STRGP.STR_SELN_HIER_CDE                           05360099
051000               ,STRGP.STAT_CDE                                    05370099
051100               ,STRGP.PRNT_GP_TYP_CDE                             05380099
051200               ,STRGP.PRNT_STR_GP_CDE                             05390099
051300               ,STRGP.PRNT_STR_GP_ID                              05400099
051400               ,STRGP.PRNT_ADHC_GP_ID                             05410099
051500               ,STRGP.ACTL_STRT_TMST                              05420099
051600               ,STRGP.ACTL_END_TMST                               05430099
051700               ,STRGP.LAST_UPD_TMST                               05440099
051800               ,STRGP.SOR_LAST_UPD_TMST                           05450099
051900               ,STRGP.LAST_ACTN_CDE                               05460099
052000               ,MDSSEL.PRICG_TYP_CDE                              05470099
052100         FROM XST_PROMO_STR_GP   STRGP                            05480099
052200             ,XST_MDSE_LNE_SELN  MDSSEL                           05490099
052300             ,XST_VND_STYL       VNDSYL                           05500099
052400         WHERE MDSSEL.PROMO_INTFC_ID = STRGP.PROMO_INTFC_ID       05510099
052500           AND MDSSEL.MDSE_LNE_ID    = STRGP.MDSE_LNE_ID          05520099
052600           AND STRGP.STAT_CDE = 'S'                               05530099
052700           AND MDSSEL.STAT_CDE = 'S'                              05540099
052800           AND MDSSEL.MDSE_HIER_CDE = 'STY'                       05550099
052900           AND MDSSEL.STYL_ID = VNDSYL.STYL_ID                    05560099
053000           AND (MDSSEL.DEPT_NBR <> VNDSYL.DEPT_NBR                05570099
053100            OR MDSSEL.MAJ_CL_NBR <> VNDSYL.MAJ_CL_NBR             05580099
053200            OR MDSSEL.SUB_CL_NBR <> VNDSYL.SUB_CL_NBR)            05590099
053300           AND VNDSYL.LAST_UPD_TMST                               05600099
053400               BETWEEN :EP400-CC-PREV-RUN-CUTOFF-TMST             05610099
053500                   AND :EP401-CC-CURR-RUN-CUTOFF-TMST             05620099
053600           AND VNDSYL.LAST_UPD_TMST < STRGP.ACTL_END_TMST         05630099
053700           AND ((:EP111-CC-CRNT-DTE                               05640099
053800               BETWEEN DATE(STRGP.ACTL_STRT_TMST)                 05650099
053900                   AND DATE(STRGP.ACTL_END_TMST))                 05660099
054000           OR  (DATE(STRGP.ACTL_STRT_TMST)                        05670099
054100               BETWEEN :EP111-CC-DATE-PLUS1                       05680099
054101                   AND :EP113-CC-CRNT-DTE-MINUS1))                05690099
054102         FOR FETCH ONLY                                           05700007
054103         WITH UR                                                  05710007
054104     END-EXEC.                                                    05720007
054105                                                                  05730007
054106*-----------------------------------------------------------      05740007
054107* ADHOC STORE CHANGE ID CURSOR.                                   05750009
054108*-----------------------------------------------------------      05760007
054109     EXEC SQL                                                     05770007
054110       DECLARE ADHOC-STORE CURSOR FOR                             05780007
054111         SELECT ADHOC.PROMO_INTFC_ID                              05790008
054112               ,ADHOC.MDSE_LNE_ID                                 05800007
054113               ,ADHOC.ADHC_STR_GP_ID                              05810007
054114               ,ADHOC.STR_SELN_HIER_CDE                           05820007
054115               ,ADHOC.STAT_CDE                                    05830008
054116               ,ADHOC.ACTL_STRT_TMST                              05840007
054117               ,ADHOC.ACTL_END_TMST                               05850007
054118               ,ADHOC.LAST_UPD_TMST                               05860008
054119               ,ADHOC.SOR_LAST_UPD_TMST                           05870008
054120               ,ADHOC.LAST_ACTN_CDE                               05880008
054121               ,MDSSEL.PRICG_TYP_CDE                              05890007
054122         FROM XST_PROMO_ADHC_RLT ADHOC                            05900008
054123             ,XST_MDSE_LNE_SELN  MDSSEL                           05910007
054124         WHERE ADHOC.PROMO_INTFC_ID  = MDSSEL.PROMO_INTFC_ID      05920008
054125           AND ADHOC.MDSE_LNE_ID     = MDSSEL.MDSE_LNE_ID         05930007
054126           AND (ADHOC.LAST_UPD_TMST                               05940015
054127               BETWEEN :EP400-CC-PREV-RUN-CUTOFF-TMST             05950008
054128                   AND :EP401-CC-CURR-RUN-CUTOFF-TMST)            05960007
054129           AND ((:EP111-CC-CRNT-DTE                               05970061
054130               BETWEEN DATE(ADHOC.ACTL_STRT_TMST)                 05980061
054131                   AND DATE(ADHOC.ACTL_END_TMST))                 05990061
054132           OR  (DATE(ADHOC.ACTL_STRT_TMST)                        06000061
054133               BETWEEN :EP111-CC-DATE-PLUS1                       06010061
054134                   AND :EP113-CC-CRNT-DTE-MINUS1))                06020061
054135         UNION                                                    06030099
054136         SELECT ADHOC.PROMO_INTFC_ID                              06040099
054137               ,ADHOC.MDSE_LNE_ID                                 06050099
054138               ,ADHOC.ADHC_STR_GP_ID                              06060099
054139               ,ADHOC.STR_SELN_HIER_CDE                           06070099
054140               ,ADHOC.STAT_CDE                                    06080099
054150               ,ADHOC.ACTL_STRT_TMST                              06090099
054160               ,ADHOC.ACTL_END_TMST                               06100099
054170               ,ADHOC.LAST_UPD_TMST                               06110099
054180               ,ADHOC.SOR_LAST_UPD_TMST                           06120099
054190               ,ADHOC.LAST_ACTN_CDE                               06130099
054200               ,MDSSEL.PRICG_TYP_CDE                              06140099
054300         FROM XST_PROMO_ADHC_RLT ADHOC                            06150099
054400             ,XST_MDSE_LNE_SELN  MDSSEL                           06160099
054500             ,XST_VND_STYL       VNDSYL                           06170099
054600         WHERE ADHOC.PROMO_INTFC_ID  = MDSSEL.PROMO_INTFC_ID      06180099
054700           AND ADHOC.MDSE_LNE_ID     = MDSSEL.MDSE_LNE_ID         06190099
054800           AND ADHOC.STAT_CDE = 'S'                               06200099
054900           AND MDSSEL.STAT_CDE = 'S'                              06210099
055000           AND MDSSEL.MDSE_HIER_CDE = 'STY'                       06220099
055100           AND MDSSEL.STYL_ID = VNDSYL.STYL_ID                    06230099
055200           AND (MDSSEL.DEPT_NBR <> VNDSYL.DEPT_NBR                06240099
055300            OR MDSSEL.MAJ_CL_NBR <> VNDSYL.MAJ_CL_NBR             06250099
055400            OR MDSSEL.SUB_CL_NBR <> VNDSYL.SUB_CL_NBR)            06260099
055500           AND VNDSYL.LAST_UPD_TMST                               06270099
055600               BETWEEN :EP400-CC-PREV-RUN-CUTOFF-TMST             06280099
055700                   AND :EP401-CC-CURR-RUN-CUTOFF-TMST             06290099
055800           AND VNDSYL.LAST_UPD_TMST < ADHOC.ACTL_END_TMST         06300099
055900           AND ((:EP111-CC-CRNT-DTE                               06310099
056000               BETWEEN DATE(ADHOC.ACTL_STRT_TMST)                 06320099
056100                   AND DATE(ADHOC.ACTL_END_TMST))                 06330099
056200           OR  (DATE(ADHOC.ACTL_STRT_TMST)                        06340099
056300               BETWEEN :EP111-CC-DATE-PLUS1                       06350099
056301                   AND :EP113-CC-CRNT-DTE-MINUS1))                06360099
056302         FOR FETCH ONLY                                           06370007
056303         WITH UR                                                  06380007
056304     END-EXEC.                                                    06390007
056305                                                                  06400007
056306*-----------------------------------------------------------      06410006
056307* STORE OVERRIDE CURSOR. (RMS & ADHOC STORES)                     06420011
056308*-----------------------------------------------------------      06430006
056309     EXEC SQL                                                     06440006
056310       DECLARE STORE-OVRRDE CURSOR FOR                            06450006
056311         SELECT STRGP.PROMO_INTFC_ID                              06460006
056312               ,STRGP.MDSE_LNE_ID                                 06470006
056313               ,STRGP.STR_GP_TYP_CDE                              06480006
056314               ,STRGP.STR_GP_ID                                   06490006
056315               ,STRGP.STR_SELN_HIER_CDE                           06500006
056316               ,STRGP.STAT_CDE                                    06510006
056317               ,STRGP.ACTL_STRT_TMST                              06520006
056318               ,STRGP.ACTL_END_TMST                               06530006
056319               ,STRGP.LAST_UPD_TMST                               06540006
056320               ,STRGP.SOR_LAST_UPD_TMST                           06550006
056321               ,MDSSEL.PRICG_TYP_CDE                              06560006
056322         FROM XST_PROMO_STR_GP   STRGP                            06570006
056323             ,XST_MDSE_LNE_SELN  MDSSEL                           06580006
056324         WHERE MDSSEL.PROMO_INTFC_ID = STRGP.PROMO_INTFC_ID       06590034
056325           AND MDSSEL.MDSE_LNE_ID    = STRGP.MDSE_LNE_ID          06600006
056326           AND STRGP.PROMO_INTFC_ID  = :PV-STORE-PROMO-INTFC-ID   06610011
056327           AND STRGP.MDSE_LNE_ID     = :PV-STORE-MDSE-LNE-ID      06620011
056400           AND (STRGP.STR_SELN_HIER_CDE                           06630006
056500                                   > :PV-STORE-STR-SELN-HIER-CDE) 06640011
056600           AND STRGP.STAT_CDE        IN ('S')                     06650073
056700           AND MDSSEL.STAT_CDE       IN ('S')                     06660073
056800           AND ((:EP111-CC-CRNT-DTE                               06670073
056900               BETWEEN DATE(STRGP.ACTL_STRT_TMST)                 06680073
057000                   AND DATE(STRGP.ACTL_END_TMST))                 06690073
057100           OR  (DATE(STRGP.ACTL_STRT_TMST)                        06700073
057200               BETWEEN :EP111-CC-DATE-PLUS1                       06710073
057300                   AND :EP113-CC-CRNT-DTE-MINUS1))                06720073
057400         FOR FETCH ONLY                                           06730006
057500         WITH UR                                                  06740006
057600     END-EXEC.                                                    06750006
057700                                                                  06760048
057800 LINKAGE SECTION.                                                 06770006
057900                                                                  06780006
058000*----------------------------------------------------------       06790006
058100 PROCEDURE DIVISION.                                              06800011
058200*----------------------------------------------------------       06810006
058300 0000-MAINLINE.                                                   06820006
058400                                                                  06830006
058500     PERFORM 1000-INITIALIZATION.                                 06840006
058600                                                                  06850006
058700     PERFORM 2000-PROCESS-STORE-GROUPS                            06860008
058800                                                                  06870006
058900     PERFORM 9999-WRAPUP.                                         06880006
059000                                                                  06890006
059100     GOBACK.                                                      06900006
059200                                                                  06910006
059300*0000-EXIT.                                                       06920006
059400 EJECT.                                                           06930006
059500                                                                  06940006
059600*----------------------------------------------------------       06950006
059700* 1000-INITIALIZATION.                                            06960006
059800*     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      06970006
059900*     FILES, READS INPUT FILES, AND PROCESSES ANY INPUT FILE      06980006
060000*     PARAMETERS IT MAY NEED TO USE TO READ THE PROMO             06990006
060100*     INTERFACE ID FILE.                                          07000006
060200*----------------------------------------------------------       07010006
060300 1000-INITIALIZATION.                                             07020006
060400                                                                  07030006
060500     OPEN INPUT  CONTROL-CARD-CURR-PRICG-DTE                      07040006
060600                 CONTROL-CARD-FUTRE-CORR-DTE                      07050006
060700                 CONTROL-CARD-PGM-LAST-RUN-TMST                   07060006
060710                 CONTROL-CARD-PGM-CURR-TMST                       07070099
060800                 CONTROL-CARD-CRIT-EFF-DTE.                       07080006
060900     OPEN OUTPUT PROMO-NIGHT-FILE.                                07090006
061100                                                                  07100006
061200     INITIALIZE EP072-PROMO-INTFC-RECORD.                         07110006
061300                                                                  07120006
061400     PERFORM 1010-READ-PGM-CURR-RUN-CARD.                         07130006
061500     PERFORM 1020-READ-PGM-LAST-RUN-CARD.                         07140006
061600     PERFORM 1030-READ-CURR-PRICG-DTE-CARD.                       07150006
061700     PERFORM 1040-READ-FUTRE-CORR-DTE-CARD.                       07160006
061800     PERFORM 1050-READ-CRIT-EFF-DTE-CARD.                         07170006
061900     PERFORM 6100-DATE-ROUTINE.                                   07180006
062000                                                                  07190006
062100*1000-EXIT.                                                       07200006
062200 EJECT.                                                           07210006
062300                                                                  07220006
064700*----------------------------------------------------------       07230006
064800* 1010-READ-PGM-CURR-RUN-CARD.                                    07240006
064900*     READ CONTROL CARD EPCC401. THIS CONTROL CARD CONTAINS       07250008
065000*     THE CURRENT TIMESTAMP                                       07260008
065100*----------------------------------------------------------       07270006
067600                                                                  07280006
067601 1010-READ-PGM-CURR-RUN-CARD.                                     07290099
067602                                                                  07300006
067603     READ CONTROL-CARD-PGM-CURR-TMST                              07310006
067604                                    INTO EP401-CC-CONTROL-CARD    07320008
067605       AT END                                                     07330006
067606          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    07340006
067607                                                                  07350006
067608     IF PS-END-OF-CNTL-CRD-FILE                                   07360006
067609       DISPLAY ' '                                                07370006
067610       DISPLAY '** ABEND     **'                                  07380006
067611       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      07390006
067612       DISPLAY '** PARAGRAPH **  = 1010-READ-PGM-CURR-RUN-CARD'   07400006
067613       DISPLAY '** CONTROL FILE IS EMPTY  '                       07410006
067614       DISPLAY ' '                                                07420006
067615       MOVE +4002 TO ABEND-CODE                                   07430006
067616       CALL 'ILBOABN0' USING ABEND-CODE                           07440006
067617     ELSE                                                         07450006
067618       DISPLAY '** PROGRAM CURRENT RUN CONTROL CARD  **'          07460006
067619       DISPLAY '** EPCC401    **  =' EP401-CC-CURR-RUN-CUTOFF-TMST07470008
067620       DISPLAY ' '                                                07480006
067621     END-IF.                                                      07490006
067622                                                                  07500006
067623*1010-EXIT.                                                       07510006
067624 EJECT.                                                           07520006
067625                                                                  07530006
067626*----------------------------------------------------------       07540006
067627* 1020-READ-PGM-LAST-RUN-CARD.                                    07550006
067628*  READ CONTROL CARD EPCC400. THIS CONTROL CARD CONTAINS          07560008
067629*  THE PRIOR DAY DATE AND TIMESTAMP AS 8 PM.                      07570008
067630*  EXAMPLE: IF JOB IS RUNNING ON 2013-10-09, THIS CONTROL         07580008
067631*  CARD WILL HAVE '2013-10-08-20.00.00.000000' TIMESTAMP.         07590008
067632*----------------------------------------------------------       07600006
067633 1020-READ-PGM-LAST-RUN-CARD.                                     07610006
067634                                                                  07620006
067635     READ CONTROL-CARD-PGM-LAST-RUN-TMST                          07630006
067636                                    INTO EP400-CC-CONTROL-CARD    07640008
067637       AT END                                                     07650006
067638          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    07660006
067639                                                                  07670006
067640     IF PS-END-OF-CNTL-CRD-FILE                                   07680006
067641       DISPLAY ' '                                                07690006
067642       DISPLAY '** ABEND     **'                                  07700006
067643       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      07710006
067644       DISPLAY '** PARAGRAPH **  = 1020-READ-PGM-LAST-RUN-CARD'   07720006
067645       DISPLAY '** CONTROL FILE IS EMPTY  '                       07730006
067646       DISPLAY ' '                                                07740006
067647       MOVE +4002 TO ABEND-CODE                                   07750006
067648       CALL 'ILBOABN0' USING ABEND-CODE                           07760006
067649     ELSE                                                         07770006
067650       DISPLAY '** PROGRAM LAST RUN CONTROL CARD  **'             07780006
067651       DISPLAY '** EPCC400    **  =' EP400-CC-PREV-RUN-CUTOFF-TMST07790008
067652       DISPLAY ' '                                                07800006
067653     END-IF.                                                      07810006
067654                                                                  07820006
067655*1020-EXIT.                                                       07830006
067656 EJECT.                                                           07840006
067700*----------------------------------------------------------       07850006
067800* 1030-READ-CURR-PRICG-DTE-CARD.                                  07860006
067900*     READ CONTROL CARD EPCC111. THIS CONTROL CARD CONTAINS       07870006
068000*     THE CURRENT PRICING DATE.                                   07880006
068100*----------------------------------------------------------       07890006
068200 1030-READ-CURR-PRICG-DTE-CARD.                                   07900006
068300                                                                  07910006
068400     READ CONTROL-CARD-CURR-PRICG-DTE                             07920006
068500                               INTO EP111-CC-CONTROL-CARD         07930006
068600       AT END                                                     07940006
068700          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    07950006
068800                                                                  07960006
068900     IF PS-END-OF-CNTL-CRD-FILE                                   07970006
069000       DISPLAY ' '                                                07980006
069100       DISPLAY '** ABEND     **'                                  07990006
069200       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      08000006
069300       DISPLAY '** PARAGRAPH **  = 1030-READ-CURR-PRICG-DTE-CARD' 08010006
069400       DISPLAY '** CONTROL FILE IS EMPTY  '                       08020006
069500       DISPLAY ' '                                                08030006
069600       MOVE +4002 TO ABEND-CODE                                   08040006
069700       CALL 'ILBOABN0' USING ABEND-CODE                           08050006
069800     ELSE                                                         08060006
069900       DISPLAY '** CURRENT PRICING DATE CONTROL CARD  **'         08070006
070000       DISPLAY '** EPCC111       **  = ' EP111-CC-CRNT-DTE        08080006
070100       DISPLAY ' '                                                08090006
070200     END-IF.                                                      08100006
070300                                                                  08110006
070400*1030-EXIT.                                                       08120006
070500 EJECT.                                                           08130006
070600                                                                  08140006
070700*----------------------------------------------------------       08150006
070800* 1040-READ-FUTRE-CORR-DTE-CARD.                                  08160006
070900*     READ CONTROL CARD EPCC113. THIS CONTROL CARD CONTAINS       08170006
071000*     THE NEXT FUTURE CORRECTIONS DATE                            08180006
071100*----------------------------------------------------------       08190006
071200 1040-READ-FUTRE-CORR-DTE-CARD.                                   08200006
071300                                                                  08210006
071400     READ CONTROL-CARD-FUTRE-CORR-DTE                             08220006
071500                               INTO EP113-CC-CONTROL-CARD         08230006
071600       AT END                                                     08240006
071700          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    08250006
071800                                                                  08260006
071900     IF PS-END-OF-CNTL-CRD-FILE                                   08270006
072000       DISPLAY ' '                                                08280006
072100       DISPLAY '** ABEND     **'                                  08290006
072200       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      08300006
072300       DISPLAY '** PARAGRAPH **  = 1040-READ-FUTRE-CORR-DTE-CARD' 08310006
072400       DISPLAY '** CONTROL FILE IS EMPTY  '                       08320006
072500       DISPLAY ' '                                                08330006
072600       MOVE +4002 TO ABEND-CODE                                   08340006
072700       CALL 'ILBOABN0' USING ABEND-CODE                           08350006
072800     ELSE                                                         08360006
072900       DISPLAY '** FUTURE CORRECTION DATE CONTROL CARD  **'       08370006
073000       DISPLAY '** EPCC113       **  = ' EP113-CC-CRNT-DTE        08380006
073100       DISPLAY ' '                                                08390006
073200     END-IF.                                                      08400006
073300                                                                  08410006
073400*1040-EXIT.                                                       08420006
073500 EJECT.                                                           08430006
073600                                                                  08440006
073700*----------------------------------------------------------       08450006
073800* 1050-READ-CRIT-EFF-DTE-CARD.                                    08460006
073900*     READ CONTROL CARD EPCC128  THIS CONTROL CARD CONTAINS       08470006
074000*     THE CRITICAL EFFECTIVE DATE, WHICH DETERMINES IF CHANGES    08480006
074100*     ARE EMERGENCY OR NIGHTLY.                                   08490006
074200*----------------------------------------------------------       08500006
074300 1050-READ-CRIT-EFF-DTE-CARD.                                     08510006
074400                                                                  08520006
074500     READ CONTROL-CARD-CRIT-EFF-DTE                               08530006
074600                               INTO EP128-CC-CONTROL-CARD         08540006
074700       AT END                                                     08550006
074800          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    08560006
074900                                                                  08570006
075000     IF PS-END-OF-CNTL-CRD-FILE                                   08580006
075100       DISPLAY ' '                                                08590006
075200       DISPLAY '** ABEND     **'                                  08600006
075300       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      08610006
075400       DISPLAY '** PARAGRAPH **  = 1050-READ-CRIT-EFF-DTE-CARD'   08620006
075500       DISPLAY '** CONTROL FILE IS EMPTY  '                       08630006
075600       DISPLAY ' '                                                08640006
075700       MOVE +4002 TO ABEND-CODE                                   08650006
075800       CALL 'ILBOABN0' USING ABEND-CODE                           08660006
075900     ELSE                                                         08670006
076000       DISPLAY '** CRITICAL EFFECTIVE DATE CONTROL CARD  **'      08680006
076100       DISPLAY '** EPCC128       **  = ' EP128-CC-CRITICAL-DTE    08690006
076200       DISPLAY ' '                                                08700006
076300     END-IF.                                                      08710006
076400                                                                  08720006
076500*1050-EXIT.                                                       08730006
076600 EJECT.                                                           08740006
076700                                                                  08750006
076800*----------------------------------------------------------       08760006
076900* 2000-PROCESS-STORE-GROUPS.                                      08770008
077000*     MAIN PROCESSING AREA - EXECUTES 2 QUERIES TO IDENTIFY ANY   08780033
077100*     CHANGES THAT WERE MADE TO EITHER THE ADHOC OR RMS STORE     08790008
077200*     TABLES. IF A CHANGED RECORD IS FOUND, THE ACTION CODE,      08800008
077300*     STAT CODE, AND ACTUAL START AND END DATES ARE EXAMINED TO   08810008
077400*     DETERMINE THE OUTPUT RECORDS THAT WILL NEED TO BE WRITTEN   08820008
077500*     OUT. A SECOND QUERY IS ALSO EXECUTED TO FIND ANY STORE      08830009
077600*     OVERRIDES WHICH MAY EXIST. IF AN OVERRIDE DOES EXIST,       08840008
077700*     ANOTHER OUTPUT RECORD IS PRODUCED FROM THE SECOND QUERY.    08850009
077800*----------------------------------------------------------       08860008
077900 2000-PROCESS-STORE-GROUPS.                                       08870008
078000                                                                  08880008
078100     PERFORM 2100-PROCESS-RMS-CURSOR.                             08890008
078200                                                                  08900008
078300     PERFORM 2200-PROCESS-ADHOC-CURSOR.                           08910008
078400                                                                  08920008
078500*2000-EXIT.                                                       08930008
078600 EJECT.                                                           08940008
078700                                                                  08950008
078800*----------------------------------------------------------       08960008
078900* 2100-PROCESS-RMS-CURSOR.                                        08970008
079000*     RMS PROCESSING AREA - EXECUTES A QUERY TO IDENTIFY ANY      08980009
079100*     CHANGES THAT WERE MADE TO THE RMS STORE TABLE. IF A         08990009
079200*     CHANGED RECORD IS FOUND, THE ACTION CODE, STAT CODE, AND    09000009
079300*     ACTUAL START AND END DATES ARE EXAMINED TO DETERMINE        09010009
079400*     THE OUTPUT RECORDS THAT WILL NEED TO BE WRITTEN OUT.        09020009
079500*     THE PARENT CODES ARE ALSO CHECKED, AND IF A PARENT          09030009
079600*     RELATION EXISTS, THE PARENT RECORD IS SELECTED AND          09040009
079700*     USED TO WRITE ADDITIONAL UPDATE RECORDS. IN ADDITION,       09050009
079800*     A SECOND QUERY IS EXECUTED TO FIND ANY STORE                09060009
079900*     OVERRIDES WHICH MAY EXIST. IF AN OVERRIDE DOES EXIST,       09070008
080000*     AN OUTPUT FILE IS PRODUCED FROM THE SECOND QUERY.           09080008
080100*----------------------------------------------------------       09090008
080200 2100-PROCESS-RMS-CURSOR.                                         09100012
080300                                                                  09110008
080400     PERFORM 2110-OPEN-RMS-STORE-CSR.                             09120008
080500     PERFORM 2120-FETCH-RMS-STORE-CSR                             09130008
080600       UNTIL PS-RMS-STORE-CSR-EOF.                                09140008
080700     PERFORM 2130-CLOSE-RMS-STORE-CSR.                            09150008
080800                                                                  09160008
080900*2100-EXIT.                                                       09170008
081000 EJECT.                                                           09180008
081100                                                                  09190008
081200*----------------------------------------------------------       09200008
081300* 2110-OPEN-RMS-STORE-CSR.                                        09210008
081400*     OPEN THE CURSOR TO BE USED IN FINDING CHANGED OR            09220008
081500*     UPDATED RMS STORES.                                         09230008
081600*----------------------------------------------------------       09240008
081700 2110-OPEN-RMS-STORE-CSR.                                         09250008
081800                                                                  09260008
081900     PERFORM                                                      09270008
082000         WITH TEST AFTER                                          09280008
082100         VARYING PV-SQL-SUB                                       09290008
082200         FROM 1 BY 1                                              09300008
082300         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 09310008
082400                OR  SQLCODE = 0)                                  09320008
082500                                                                  09330006
082600         EXEC SQL                                                 09340006
082700           OPEN RMS-STORE                                         09350009
082800         END-EXEC                                                 09360006
082900                                                                  09370006
083000         EVALUATE TRUE                                            09380006
083100           WHEN SQLCODE = -904                                    09390006
083200           WHEN SQLCODE = -911                                    09400006
083300           WHEN SQLCODE = -913                                    09410006
083400             CONTINUE                                             09420006
083500           WHEN SQLCODE = 0                                       09430006
083600             SET PS-RMS-STORE-CSR-NOT-EOF TO TRUE                 09440009
083700           WHEN SQLWARN0 NOT EQUAL SPACE                          09450006
083800           WHEN SQLCODE NOT EQUAL ZERO                            09460006
083900             MOVE '2110-OPEN-RMS-STORE-CSR'                       09470009
084000                                   TO PV-PARAGRAPH-NAME           09480006
084100             MOVE 'ERROR ON OPEN OF RMS STORE CURSOR'             09490009
084200                                   TO PV-DB2-OPERATION            09500006
084300             PERFORM 9900-SQL-ABEND-ROUTINE                       09510006
084400         END-EVALUATE                                             09520006
084500     END-PERFORM.                                                 09530006
084600                                                                  09540006
084700     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         09550006
084800       MOVE '2110-OPEN-RMS-STORE-CSR'                             09560009
084900                             TO  PV-PARAGRAPH-NAME                09570006
085000       MOVE 'OPEN RETRIES EXCEEDED'                               09580006
085100                              TO  PV-DB2-OPERATION                09590006
085200       PERFORM 9900-SQL-ABEND-ROUTINE                             09600006
085300     END-IF.                                                      09610006
085400                                                                  09620006
085500*2110-EXIT.                                                       09630008
085600 EJECT.                                                           09640006
085700                                                                  09650006
085800*----------------------------------------------------------       09660006
085900* 2120-FETCH-RMS-STORE-CSR.                                       09670008
086000*     FETCH THE DATA FROM THE RMS STORE CURSOR. IF A              09680009
086100*     RECORD IS FOUND USING THIS CURSOR, IT IS CHECKED FOR        09690010
086200*     A PARENT RELATION. A SECOND QUERY IS PERFORMED              09700010
086300*     THAT WILL CHECK THE XST_PROMO_STR_GP TABLE                  09710010
086400*     FOR OVERRIDES.                                              09720006
086500*----------------------------------------------------------       09730006
086600 2120-FETCH-RMS-STORE-CSR.                                        09740008
086700                                                                  09750006
086800     PERFORM                                                      09760006
086900         WITH TEST AFTER                                          09770006
087000         VARYING PV-SQL-SUB                                       09780006
087100         FROM 1 BY 1                                              09790006
087200         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 09800006
087300                   OR  SQLCODE = 0                                09810006
087400                   OR  SQLCODE = +100)                            09820006
087500                                                                  09830006
087600         EXEC SQL                                                 09840006
087700           FETCH RMS-STORE                                        09850009
087800            INTO :XST00029-PROMO-INTFC-ID                         09860011
087900                ,:XST00029-MDSE-LNE-ID                            09870011
088000                ,:XST00029-STR-GP-TYP-CDE                         09880011
088100                ,:XST00029-STR-GP-ID                              09890011
088200                ,:XST00029-STR-SELN-HIER-CDE                      09900011
088300                ,:XST00029-STAT-CDE                               09910011
088400                ,:XST00029-PRNT-GP-TYP-CDE                        09920020
088500                       :IV-PRNT-GP-TYP-CDE                        09930096
088600                ,:XST00029-PRNT-STR-GP-CDE                        09940020
088700                       :IV-PRNT-STR-GP-CDE                        09950020
088800                ,:XST00029-PRNT-STR-GP-ID                         09960020
088900                       :IV-PRNT-STR-GP-ID                         09970020
089000                ,:XST00029-PRNT-ADHC-GP-ID                        09980020
089100                       :IV-PRNT-ADHC-GP-ID                        09990020
089200                ,:XST00029-ACTL-STRT-TMST                         10000011
089300                ,:XST00029-ACTL-END-TMST                          10010011
089400                ,:XST00029-LAST-UPD-TMST                          10020011
089500                ,:XST00029-SOR-LAST-UPD-TMST                      10030011
089600                ,:XST00029-LAST-ACTN-CDE                          10040015
089700                ,:XST00028-PRICG-TYP-CDE                          10050015
089800         END-EXEC                                                 10060006
089900                                                                  10070006
090000         EVALUATE TRUE                                            10080006
090100           WHEN SQLCODE = -904                                    10090006
090200           WHEN SQLCODE = -911                                    10100006
090300           WHEN SQLCODE = -913                                    10110006
090400             CONTINUE                                             10120006
090500           WHEN SQLCODE = ZERO                                    10130006
090600             PERFORM 2140-CREATE-RMS-OUTPUT                       10140009
090700           WHEN SQLCODE = +100                                    10150006
090800             SET PS-RMS-STORE-CSR-EOF TO TRUE                     10160009
090900           WHEN SQLWARN0 NOT EQUAL SPACE                          10170006
091000           WHEN SQLCODE NOT EQUAL ZERO                            10180006
091100             MOVE '2120-FETCH-RMS-STORE-CSR'                      10190009
091200                                    TO PV-PARAGRAPH-NAME          10200006
091300             MOVE 'ERROR ON FETCHING RMS STORE CURSOR'            10210009
091400                                    TO PV-DB2-OPERATION           10220006
091500             PERFORM 9900-SQL-ABEND-ROUTINE                       10230006
091600         END-EVALUATE                                             10240006
091700     END-PERFORM.                                                 10250006
091800                                                                  10260006
091900     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         10270006
092000       MOVE '2120-FETCH-RMS-STORE-CSR'                            10280009
092100                               TO  PV-PARAGRAPH-NAME              10290006
092200       MOVE 'FETCH RETRIES EXCEEDED'                              10300006
092300                               TO  PV-DB2-OPERATION               10310006
092400       PERFORM 9900-SQL-ABEND-ROUTINE                             10320006
092500     END-IF.                                                      10330006
092600                                                                  10340006
092700*2120-EXIT.                                                       10350008
092800 EJECT.                                                           10360006
092900                                                                  10370006
093000*-----------------------------------------------------------      10380006
093100* 2130-CLOSE-RMS-STORE-CSR.                                       10390008
093200*-----------------------------------------------------------      10400006
093300 2130-CLOSE-RMS-STORE-CSR.                                        10410008
093400                                                                  10420006
093500     PERFORM                                                      10430006
093600         WITH TEST AFTER                                          10440006
093700         VARYING PV-SQL-SUB                                       10450006
093800         FROM 1 BY 1                                              10460006
093900         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 10470006
094000                   OR  SQLCODE = 0)                               10480006
094100                                                                  10490006
094200         EXEC SQL                                                 10500006
094300           CLOSE RMS-STORE                                        10510009
094400         END-EXEC                                                 10520006
094500                                                                  10530006
094600         EVALUATE TRUE                                            10540006
094700           WHEN SQLCODE = -904                                    10550006
094800           WHEN SQLCODE = -911                                    10560006
094900           WHEN SQLCODE = -913                                    10570006
095000           WHEN SQLCODE = 0                                       10580006
095100             CONTINUE                                             10590006
095200           WHEN SQLWARN0 NOT EQUAL SPACE                          10600006
095300           WHEN SQLCODE NOT EQUAL ZERO                            10610006
095400             MOVE '2130-CLOSE-RMS-STORE-CSR'                      10620008
095500                                       TO PV-PARAGRAPH-NAME       10630006
095600             MOVE 'ERROR ON CLOSE OF RMS STORE CURSOR'            10640009
095700                                       TO PV-DB2-OPERATION        10650006
095800             PERFORM 9900-SQL-ABEND-ROUTINE                       10660006
095900         END-EVALUATE                                             10670006
096000     END-PERFORM.                                                 10680006
096100                                                                  10690006
096200     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         10700006
096300       MOVE '2130-CLOSE-RMS-STORE-CSR'                            10710008
096400                               TO  PV-PARAGRAPH-NAME              10720006
096500       MOVE 'CLOSE RETRIES EXCEEDED'                              10730006
096600                               TO  PV-DB2-OPERATION               10740006
096700       PERFORM 9900-SQL-ABEND-ROUTINE                             10750006
096800     END-IF.                                                      10760006
096900                                                                  10770006
097000*2130-EXIT.                                                       10780008
097100 EJECT.                                                           10790006
097200                                                                  10800006
097300*-----------------------------------------------------------      10810009
097400* 2140-CREATE-RMS-OUTPUT.                                         10820027
097500*     DETERMINE WHICH OUTPUT RECORDS NEED TO BE PRODUCED          10830059
097600*     FROM THE RMS STORE GROUP QUERY.                             10840059
097700*-----------------------------------------------------------      10850027
097800 2140-CREATE-RMS-OUTPUT.                                          10860027
097900                                                                  10870027
098000*** IT'S POSSIBLE THE PROMO EFFECTIVE DATES ARE BEING CHANGED     10880089
098100*** AND THEREFORE THE PROMOTION MAY ALREADY BE AT THE STORES(S)   10890089
098200*** DUE TO WHAT THE DATES WERE.  THEREFORE, A DELETE RECORD       10900089
098300*** MUST BE SENT NO MATTER WHAT BECAUSE THE NEW DATES MAY HAVE    10910089
098400*** THE PROMOTION STARTING LATER.                                 10920089
098500     IF XST00029-STAT-CDE = 'S'                                   10930044
098600       IF XST00029-LAST-ACTN-CDE = 'U'                            10940089
098700         PERFORM 3005-RMS-DELREC-TO-CHG-STRGP-2                   10950089
098800         SET PS-OVERRDS-CHK-OF-CHG-STRGP TO TRUE                  10960090
098900       END-IF                                                     10970089
099000                                                                  10980089
099100       IF ((XST00029-ACTL-STRT-TMST > EP128-CC-CRITICAL-DTE       10990027
099200         AND XST00029-ACTL-STRT-TMST < EP113-CC-CRNT-DTE)         11000027
099300       OR (XST00029-ACTL-STRT-TMST <= EP128-CC-CRITICAL-DTE       11010027
099400         AND XST00029-ACTL-END-TMST >= EP111-CC-CRNT-DTE))        11020027
099500          PERFORM 3010-RMS-ADD-REC                                11030089
099600          SET PS-OVERRDS-CHK-OF-CHG-STRGP TO TRUE                 11040090
099700       END-IF                                                     11050043
099800     END-IF.                                                      11060043
099900                                                                  11070043
100000*** DELETES FOR CANCELED/DELETED STORE GROUPS WHICH ARE NOT       11080090
100100*** AN OVERRIDE TO A HIGHER LEVEL PARENT.                         11090090
100200     IF (XST00029-STAT-CDE = 'C' OR XST00029-STAT-CDE = 'D')      11100089
100300      AND (XST00029-PRNT-GP-TYP-CDE NOT EQUAL 'P'                 11110096
100400           OR IV-PRNT-GP-TYP-CDE = -1)                            11120096
100500      AND (XST00029-PRNT-GP-TYP-CDE NOT EQUAL 'A'                 11130096
100600           OR IV-PRNT-GP-TYP-CDE = -1)                            11140096
100700      AND (XST00029-LAST-ACTN-CDE = 'U')                          11150089
100800        PERFORM 3000-RMS-DELREC-TO-CHG-STRGP                      11160089
100900        SET PS-NO-OVERRDS-CHK TO TRUE                             11170090
101000     END-IF.                                                      11180089
101100                                                                  11190089
101200*** LOOK UP THE PARENT RECORD FOR A CANCELED/DELETED              11200090
101300*** OVERRIDE                                                      11210090
101400     IF XST00029-STAT-CDE = 'C' OR XST00029-STAT-CDE = 'D'        11220043
101500       IF XST00029-PRNT-GP-TYP-CDE = 'P'                          11230069
101600        AND IV-PRNT-GP-TYP-CDE NOT EQUAL -1                       11240096
101700          PERFORM 2150-SELECT-RMS-PRNT-REC                        11250096
101800            UNTIL PS-PRNT-CALL-COMPLETED                          11260096
101900       ELSE                                                       11270037
102000         IF XST00029-PRNT-GP-TYP-CDE = 'A'                        11280037
102100          AND IV-PRNT-GP-TYP-CDE NOT EQUAL -1                     11290096
102200            PERFORM 2160-SELECT-ADHC-PRNT-REC                     11300096
102300              UNTIL PS-PRNT-CALL-COMPLETED                        11310096
102400         END-IF                                                   11320037
102500       END-IF                                                     11330037
102600     END-IF.                                                      11340037
102700                                                                  11350037
102800*** CREATE A DELETE RECORD FOR STORE OVERRIDES WHICH              11360090
102900*** DON'T HAVE A 'S'CHEDULED PARENT.  THE RECORD WILL             11370090
103000*** BE SENT TO THE STORE GROUP ON THE OVERRIDE RECORD             11380090
103100     IF PS-RMS-PRNT-STORE-FND AND PRNT-RMS-STAT-CDE NOT EQUAL 'S' 11390094
103200       PERFORM 3000-RMS-DELREC-TO-CHG-STRGP                       11400089
103300       SET PS-NO-OVERRDS-CHK TO TRUE                              11410090
103400     END-IF.                                                      11420089
103500                                                                  11430089
103600*** IF OTHER OVERRIDES ARE ACTIVE UNDER THE PARENT SEND A         11440090
103700*** DELETE RECORD TO THE PARENT STORE GROUP. LATER, THE           11450090
103800*** PARENT AND ALL ACTIVE OVERRIDES WILL BE READDED.              11460090
103900*** IF NO OTHER OVERRIDES ARE ACTIVE UNDER THE PARENT SEND        11470090
104000*** THE DELETE TO THE OVERRIDE STORE GROUP AND THEN SEND          11480090
104100*** AN ADD WITH THE PARENT VALUES TO THE OVERRIDE STORE           11490090
104200*** GROUP.                                                        11500090
104300     IF PS-RMS-PRNT-STORE-FND AND PRNT-RMS-STAT-CDE = 'S'         11510089
104400       PERFORM 2170-CHK-FOR-PRNT-OVERRIDES                        11520089
104500       IF PS-ACT-RMS-OVERRDS-EXIST                                11530089
104600         PERFORM 3040-RMS-DELREC-TO-PRNT-STRGP                    11540089
104700         SET PS-OVERRDS-CHK-OF-PRNT-STRGP TO TRUE                 11550090
104800       ELSE                                                       11560089
104900         PERFORM 3000-RMS-DELREC-TO-CHG-STRGP                     11570089
105000         SET PS-NO-OVERRDS-CHK TO TRUE                            11580090
105100       END-IF                                                     11590089
105200                                                                  11600089
105300       IF ((PV-PRNT-RMS-ACTL-STRT-DATE > EP128-CC-CRITICAL-DTE    11610089
105400         AND PV-PRNT-RMS-ACTL-STRT-DATE < EP113-CC-CRNT-DTE)      11620089
105500         OR (PV-PRNT-RMS-ACTL-STRT-DATE                           11630089
105600                                      <= EP128-CC-CRITICAL-DTE))  11640089
105700           IF PS-ACT-RMS-OVERRDS-EXIST                            11650090
105800             PERFORM 3050-RMS-PRNTREC-TO-PRNT-STRGP               11660090
105900           ELSE                                                   11670089
106000             PERFORM 3020-RMS-PRNTREC-TO-CHG-STRGP                11680090
106100           END-IF                                                 11690089
106200       END-IF                                                     11700089
106300     END-IF.                                                      11710067
106400                                                                  11720067
106500*** A CANCELED/DELETED OVERRIDE WHICH HAS AN ADHOC PARENT         11730090
106600*** WILL BE SENT A DELETE RECORD TO THE OVERRIDE STORE            11740090
106700*** GROUP, AND DEPENDING ON THE PARENT EFFECTIVE DATES            11750090
106800*** AN ADD WITH THE ADHOC PARENT VALUES MAY BE SENT TO THE        11760090
106900*** OVERRIDE STORE GROUP.  ONLY STORE SPECIFIC STORE GROUPS       11770090
107000*** CAN OVERRIDE AN ADHOC STORE GROUP.                            11780090
107100     IF PS-ADHC-PRNT-STORE-FND                                    11790089
107200       PERFORM 3000-RMS-DELREC-TO-CHG-STRGP                       11800089
107300                                                                  11810089
107400       IF PRNT-ADHOC-STAT-CDE = 'S'                               11820089
107500         IF ((PV-PRNT-ADHOC-ACTL-STRT-DATE > EP128-CC-CRITICAL-DTE11830089
107600           AND PV-PRNT-ADHOC-ACTL-STRT-DATE                       11840089
107700                                        < EP113-CC-CRNT-DTE) OR   11850089
107800           (PV-PRNT-ADHOC-ACTL-STRT-DATE                          11860089
107900                                        <= EP128-CC-CRITICAL-DTE))11870089
108000             PERFORM 3120-ADHOC-PRNT-REC                          11880089
108100         END-IF                                                   11890089
108200       END-IF                                                     11900089
108300       SET PS-NO-OVERRDS-CHK TO TRUE                              11910090
108400     END-IF.                                                      11920067
108500                                                                  11930067
108600*** PROCESS ANY STORE OVERRIDES WHICH MAY EXIST FOR CURRENTLY     11940090
108700*** 'S'CHEDULED OUTPUTS WHICH WERE WRITTEN TO THE STORE           11950090
108800*** GROUP ON THE CHANGED RECORD.                                  11960090
108900     IF PS-OVERRDS-CHK-OF-CHG-STRGP                               11970090
109000       MOVE XST00029-PROMO-INTFC-ID                               11980067
109100                             TO PV-STORE-PROMO-INTFC-ID           11990067
109200       MOVE XST00029-MDSE-LNE-ID                                  12000067
109300                             TO PV-STORE-MDSE-LNE-ID              12010067
109400       MOVE XST00029-STR-SELN-HIER-CDE                            12020089
109500                             TO PV-STORE-STR-SELN-HIER-CDE        12030089
109600       MOVE PC-RMS-PRC-SETUP-IND                                  12040089
109700                             TO PC-STORE-TYPE                     12050067
109800       PERFORM 2300-FIND-STORE-OVERRIDES                          12060067
109900         UNTIL PS-STORE-OVRRDE-CSR-EOF                            12070067
110000     END-IF.                                                      12080067
110100                                                                  12090067
110200*** PROCESS STORE OVERRIDES WHICH EXIST FOR CURRENTLY             12100090
110300*** 'S'CHEDULED PARENTS WHICH HAD RECORDS WRITTEN TO THE          12110090
110400*** PARENT STORE GROUP.                                           12120090
110500     IF PS-OVERRDS-CHK-OF-PRNT-STRGP                              12130090
110600       MOVE XST00029-PROMO-INTFC-ID                               12140089
110700                             TO PV-STORE-PROMO-INTFC-ID           12150089
110800       MOVE XST00029-MDSE-LNE-ID                                  12160089
110900                             TO PV-STORE-MDSE-LNE-ID              12170089
111000       MOVE PRNT-RMS-STR-SELN-HIER-CDE                            12180090
111100                             TO PV-STORE-STR-SELN-HIER-CDE        12190090
111200       MOVE PC-RMS-PRC-SETUP-IND                                  12200089
111300                             TO PC-STORE-TYPE                     12210089
111400       PERFORM 2300-FIND-STORE-OVERRIDES                          12220089
111500         UNTIL PS-STORE-OVRRDE-CSR-EOF                            12230089
111600     END-IF.                                                      12240089
111700                                                                  12250089
111800     MOVE 'N'              TO PS-CHK-OVERRDS-LVL-SW               12260093
111900                              PS-ADHC-PRNT-STORE-NOT-FND-SW       12270067
112000                              PS-RMS-PRNT-STORE-NOT-FND-SW        12280067
112100                              PS-PRNT-STORE-CALL-COMPLETE         12290067
112200                              PS-STORE-OVRRDE-CSR-EOF-SW          12300093
112300                              PS-ACT-RMS-OVERRDS-EXIST-SW.        12310089
112400                                                                  12320067
112500*2140-EXIT.                                                       12330067
112600 EJECT.                                                           12340067
112700                                                                  12350067
112800*-----------------------------------------------------------      12360067
112900* 2150-SELECT-RMS-PRNT-REC.                                       12370089
113000*     IF THE RMS QUERY ON THE STORE TABLE IDENTIFES A PARENT      12380067
113100*     RELATIONSHIP, THIS SELECT IS EXECUTED TO FIND THE           12390067
113200*     PARENT RECORD. IF FOUND AN ADDITIONAL OUTPUT RECORD         12400067
113300*     IS PRODUCED.                                                12410067
113400*-----------------------------------------------------------      12420067
113500 2150-SELECT-RMS-PRNT-REC.                                        12430089
113600                                                                  12440067
113700     PERFORM                                                      12450067
113800         WITH TEST AFTER                                          12460067
113900         VARYING PV-SQL-SUB                                       12470067
114000         FROM 1 BY 1                                              12480067
114100         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 12490067
114200                   OR  SQLCODE = 0                                12500067
114300                   OR  SQLCODE = +100)                            12510067
114400                                                                  12520067
114500         EXEC SQL                                                 12530067
114600            SELECT STR_GP_TYP_CDE                                 12540049
114700                  ,STR_GP_ID                                      12550049
114800                  ,STAT_CDE                                       12560049
114900                  ,PROMO_STRT_TMST                                12570041
115000                  ,PROMO_END_TMST                                 12580041
115100                  ,ACTL_STRT_TMST                                 12590041
115200                  ,ACTL_END_TMST                                  12600041
115300                  ,STR_SELN_HIER_CDE                              12610082
115400                  ,SOR_LAST_UPD_TMST                              12620049
115500           INTO :PRNT-RMS-STR-GP-TYP-CDE                          12630049
115600               ,:PRNT-RMS-STR-GP-ID                               12640049
115700               ,:PRNT-RMS-STAT-CDE                                12650049
115800               ,:PRNT-RMS-PROMO-STRT-TMST                         12660049
115900               ,:PRNT-RMS-PROMO-END-TMST                          12670049
116000               ,:PRNT-RMS-ACTL-STRT-TMST                          12680049
116100               ,:PRNT-RMS-ACTL-END-TMST                           12690049
116200               ,:PRNT-RMS-STR-SELN-HIER-CDE                       12700082
116300               ,:PRNT-RMS-SOR-LAST-UPD-TMST                       12710049
116400           FROM XST_PROMO_STR_GP                                  12720049
116500           WHERE PROMO_INTFC_ID = :XST00029-PROMO-INTFC-ID        12730049
116600             AND MDSE_LNE_ID    = :XST00029-MDSE-LNE-ID           12740049
116700             AND STR_GP_TYP_CDE = :XST00029-PRNT-STR-GP-CDE       12750049
116800             AND STR_GP_ID      = :XST00029-PRNT-STR-GP-ID        12760049
116900           WITH UR                                                12770049
117000         END-EXEC                                                 12780049
117100                                                                  12790049
117200         EVALUATE TRUE                                            12800049
117300           WHEN SQLCODE = -904                                    12810049
117400           WHEN SQLCODE = -911                                    12820049
117500           WHEN SQLCODE = -913                                    12830049
117600             CONTINUE                                             12840049
117700           WHEN SQLCODE = ZERO                                    12850049
117800             SET PS-RMS-PRNT-STORE-FND  TO TRUE                   12860049
117900             SET PS-PRNT-CALL-COMPLETED TO TRUE                   12870049
118000             MOVE PRNT-RMS-ACTL-STRT-TMST                         12880067
118100                                     TO PV-PRNT-RMS-ACTL-STRT-TMST12890067
118200             MOVE PRNT-RMS-ACTL-END-TMST                          12900067
118300                                     TO PV-PRNT-RMS-ACTL-END-TMST 12910067
118400           WHEN SQLCODE = +100                                    12920067
118500             SET PS-RMS-PRNT-STORE-NOT-FND  TO TRUE               12930067
118600             SET PS-PRNT-CALL-COMPLETED     TO TRUE               12940067
118700           WHEN SQLWARN0 NOT EQUAL SPACE                          12950067
118800           WHEN SQLCODE NOT EQUAL ZERO                            12960067
118900             MOVE '2150-SELECT-RMS-PRNT-REC'                      12970089
119000                                     TO PV-PARAGRAPH-NAME         12980067
119100             MOVE 'ERROR ON SELECTING PARENT REC'                 12990067
119200                                     TO PV-DB2-OPERATION          13000067
119300             PERFORM 9900-SQL-ABEND-ROUTINE                       13010067
119400         END-EVALUATE                                             13020067
119500     END-PERFORM.                                                 13030067
119600                                                                  13040067
119700     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         13050067
119800       MOVE '2150-SELECT-RMS-PRNT-REC'                            13060089
119900                               TO  PV-PARAGRAPH-NAME              13070067
120000       MOVE 'SELECT RETRIES EXCEEDED'                             13080067
120100                               TO  PV-DB2-OPERATION               13090067
120200       PERFORM 9900-SQL-ABEND-ROUTINE                             13100067
120300     END-IF.                                                      13110067
120400                                                                  13120067
120500*2150-EXIT.                                                       13130067
120600 EJECT.                                                           13140067
120700                                                                  13150076
120800*-----------------------------------------------------------      13160067
120900* 2160-SELECT-ADHC-PRNT-REC.                                      13170089
121000*     FIND ADHOC PARENT STORE.                                    13180067
121100*-----------------------------------------------------------      13190067
121200 2160-SELECT-ADHC-PRNT-REC.                                       13200089
121300                                                                  13210067
121400     PERFORM                                                      13220067
121500         WITH TEST AFTER                                          13230067
121600         VARYING PV-SQL-SUB                                       13240067
121700         FROM 1 BY 1                                              13250067
121800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 13260067
121900                   OR  SQLCODE = 0                                13270067
122000                   OR  SQLCODE = +100)                            13280067
122100                                                                  13290067
122200         EXEC SQL                                                 13300067
122300           SELECT ADHC_STR_GP_ID                                  13310067
122400                 ,STAT_CDE                                        13320067
122500                 ,PROMO_STRT_TMST                                 13330067
122600                 ,PROMO_END_TMST                                  13340067
122700                 ,ACTL_STRT_TMST                                  13350067
122800                 ,ACTL_END_TMST                                   13360067
122900                 ,SOR_LAST_UPD_TMST                               13370067
123000           INTO  :PRNT-ADHOC-ADHC-STR-GP-ID                       13380067
123100                ,:PRNT-ADHOC-STAT-CDE                             13390067
123200                ,:PRNT-ADHOC-PROMO-STRT-TMST                      13400067
123300                ,:PRNT-ADHOC-PROMO-END-TMST                       13410067
123400                ,:PRNT-ADHOC-ACTL-STRT-TMST                       13420067
123500                ,:PRNT-ADHOC-ACTL-END-TMST                        13430067
123600                ,:PRNT-ADHOC-SOR-LAST-UPD-TMST                    13440067
123700           FROM XST_PROMO_ADHC_RLT                                13450067
123800           WHERE PROMO_INTFC_ID = :XST00029-PROMO-INTFC-ID        13460067
123900             AND MDSE_LNE_ID    = :XST00029-MDSE-LNE-ID           13470067
124000             AND ADHC_STR_GP_ID = :XST00029-PRNT-ADHC-GP-ID       13480067
124100           WITH UR                                                13490067
124200         END-EXEC                                                 13500067
124300                                                                  13510067
124400         EVALUATE TRUE                                            13520067
124500           WHEN SQLCODE = -904                                    13530067
124600           WHEN SQLCODE = -911                                    13540067
124700           WHEN SQLCODE = -913                                    13550067
124800             CONTINUE                                             13560067
124900           WHEN SQLCODE = ZERO                                    13570067
125000             SET PS-ADHC-PRNT-STORE-FND TO TRUE                   13580067
125100             SET PS-PRNT-CALL-COMPLETED TO TRUE                   13590067
125200           WHEN SQLCODE = +100                                    13600067
125300             SET PS-ADHC-PRNT-STORE-NOT-FND TO TRUE               13610067
125400             SET PS-PRNT-CALL-COMPLETED     TO TRUE               13620067
125500             MOVE PRNT-ADHOC-ACTL-STRT-TMST                       13630067
125600                                  TO PV-PRNT-ADHOC-ACTL-STRT-TMST 13640067
125700             MOVE PRNT-RMS-ACTL-END-TMST                          13650067
125800                                  TO PV-PRNT-ADHOC-ACTL-END-TMST  13660067
125900           WHEN SQLWARN0 NOT EQUAL SPACE                          13670067
126000           WHEN SQLCODE NOT EQUAL ZERO                            13680067
126100             MOVE '2160-SELECT-ADHC-PRNT-REC'                     13690089
126200                                     TO PV-PARAGRAPH-NAME         13700067
126300             MOVE 'ERROR ON SELECTING PRNT REC'                   13710089
126400                                     TO PV-DB2-OPERATION          13720067
126500             PERFORM 9900-SQL-ABEND-ROUTINE                       13730067
126600         END-EVALUATE                                             13740067
126700     END-PERFORM.                                                 13750067
126800                                                                  13760067
126900     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         13770067
127000       MOVE '2160-SELECT-ADHC-PRNT-REC'                           13780089
127100                               TO  PV-PARAGRAPH-NAME              13790067
127200       MOVE 'SELECT RETRIES EXCEEDED'                             13800067
127300                               TO  PV-DB2-OPERATION               13810067
127400       PERFORM 9900-SQL-ABEND-ROUTINE                             13820067
127500     END-IF.                                                      13830067
127600                                                                  13840067
127700*2160-EXIT.                                                       13850067
127800 EJECT.                                                           13860067
127900                                                                  13870067
128000*-----------------------------------------------------------      13880077
128100* 2170-CHK-FOR-PRNT-OVERRIDES.                                    13890077
128200*     WHEN AN OVERRIDE HAS BEEN CANCELED/DELETED AND AN           13900077
128300*     ACTIVE PARENT EXISTS, CHECK IF THERE ARE ANY ACTIVE         13910077
128400*     OVERRIDES WHICH STILL EXIST.                                13920077
128500*-----------------------------------------------------------      13930077
128600 2170-CHK-FOR-PRNT-OVERRIDES.                                     13940077
128700                                                                  13950078
128800     PERFORM                                                      13960080
128900       WITH TEST AFTER                                            13970080
129000       VARYING PV-SQL-SUB                                         13980080
129100       FROM 1 BY 1                                                13990080
129200       UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                   14000080
129300                 OR  SQLCODE = +0                                 14010080
129400                 OR  SQLCODE = +100)                              14020080
129500                                                                  14030079
129600         EXEC SQL                                                 14040079
129700          SELECT '1'                                              14050080
129800            INTO :PV-OVERRIDES-EXIST                              14060080
129900            FROM SYSIBM.SYSDUMMY1 X                               14070080
130000          WHERE EXISTS                                            14080080
130100            (SELECT '1'                                           14090080
130200               FROM XST_PROMO_STR_GP                              14100080
130300             WHERE PROMO_INTFC_ID    = :XST00029-PROMO-INTFC-ID   14110080
130400               AND MDSE_LNE_ID       = :XST00029-MDSE-LNE-ID      14120080
130500               AND PRNT_STR_GP_CDE   = :XST00029-PRNT-STR-GP-CDE  14130097
130600               AND PRNT_STR_GP_ID    = :XST00029-PRNT-STR-GP-ID   14140097
130700               AND STR_SELN_HIER_CDE > :PRNT-RMS-STR-SELN-HIER-CDE14150080
130800               AND STAT_CDE          IN ('S')                     14160082
130900               AND X.IBMREQD         = X.IBMREQD)                 14170080
131000                                                                  14180080
131100           WITH UR                                                14190079
131200         END-EXEC                                                 14200079
131300                                                                  14210079
131400         EVALUATE TRUE                                            14220079
131500           WHEN SQLCODE = -904                                    14230079
131600           WHEN SQLCODE = -911                                    14240079
131700           WHEN SQLCODE = -913                                    14250079
131800             CONTINUE                                             14260079
131900           WHEN SQLCODE = +0                                      14270082
132000             SET PS-ACT-RMS-OVERRDS-EXIST TO TRUE                 14280082
132100           WHEN SQLCODE = +100                                    14290079
132200             SET PS-ACT-RMS-OVERRDS-DONT-EXIST TO TRUE            14300085
132300           WHEN SQLWARN0 NOT EQUAL SPACE                          14310079
132400           WHEN SQLCODE NOT EQUAL ZERO                            14320079
132500             MOVE '2170-CHK-FOR-PRNT-OVERRIDES'                   14330082
132600                                     TO PV-PARAGRAPH-NAME         14340079
132700             MOVE 'ERROR ON CHECKING EXISTENCE OF OVERRIDES'      14350082
132800                                     TO PV-DB2-OPERATION          14360079
132900             PERFORM 9900-SQL-ABEND-ROUTINE                       14370079
133000         END-EVALUATE                                             14380079
133100     END-PERFORM.                                                 14390079
133200                                                                  14400079
133300     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         14410079
133400       MOVE '2170-CHK-FOR-PRNT-OVERRIDES'                         14420082
133500                               TO  PV-PARAGRAPH-NAME              14430079
133600       MOVE 'SELECT RETRIES EXCEEDED'                             14440079
133700                               TO  PV-DB2-OPERATION               14450079
133800       PERFORM 9900-SQL-ABEND-ROUTINE                             14460079
133900     END-IF.                                                      14470079
134000                                                                  14480078
134100*2170-EXIT.                                                       14490078
134200 EJECT.                                                           14500078
134300                                                                  14510078
134400*----------------------------------------------------------       14520078
134500* 2200-PROCESS-ADHOC-CURSOR.                                      14530078
134600*     ADHOC PROCESSING AREA - EXECUTES A QUERY TO IDENTIFY ANY    14540078
134700*     CHANGES THAT WERE MADE TO THE ADHOC STORE TABLE. IF A       14550078
134800*     CHANGED RECORD IS FOUND, THE ACTION CODE, STAT CODE, AND    14560078
134900*     ACTUAL START AND END DATES ARE EXAMINED TO DETERMINE        14570078
135000*     THE OUTPUT RECORDS THAT WILL NEED TO BE WRITTEN OUT.        14580078
135100*     A SECOND QUERY IS EXECUTED TO FIND ANY STORE                14590078
135200*     OVERRIDES WHICH MAY EXIST. IF AN OVERRIDE DOES EXIST,       14600078
135300*     AN OUTPUT FILE IS PRODUCED FROM THE SECOND QUERY.           14610078
135400*----------------------------------------------------------       14620078
135500 2200-PROCESS-ADHOC-CURSOR.                                       14630078
135600                                                                  14640078
135700     PERFORM 2210-OPEN-ADHOC-STORE-CSR.                           14650078
135800     PERFORM 2220-FETCH-ADHOC-STORE-CSR                           14660078
135900       UNTIL PS-ADHOC-STORE-CSR-EOF.                              14670078
136000     PERFORM 2230-CLOSE-ADHOC-STORE-CSR.                          14680078
136100                                                                  14690078
136200*2200-EXIT.                                                       14700078
136300 EJECT.                                                           14710078
136400                                                                  14720078
136500*----------------------------------------------------------       14730078
136600* 2210-OPEN-ADHOC-STORE-CSR.                                      14740078
136700*     OPEN THE CURSOR TO BE USED IN FINDING CHANGED OR            14750078
136800*     UPDATED ADHOC STORES.                                       14760078
136900*----------------------------------------------------------       14770078
137000 2210-OPEN-ADHOC-STORE-CSR.                                       14780078
137100                                                                  14790078
137200     PERFORM                                                      14800078
137300         WITH TEST AFTER                                          14810078
137400         VARYING PV-SQL-SUB                                       14820078
137500         FROM 1 BY 1                                              14830078
137600         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 14840078
137700                OR  SQLCODE = 0)                                  14850078
137800                                                                  14860078
137900         EXEC SQL                                                 14870078
138000           OPEN ADHOC-STORE                                       14880078
138100         END-EXEC                                                 14890078
138200                                                                  14900078
138300         EVALUATE TRUE                                            14910078
138400           WHEN SQLCODE = -904                                    14920078
138500           WHEN SQLCODE = -911                                    14930078
138600           WHEN SQLCODE = -913                                    14940078
138700             CONTINUE                                             14950078
138800           WHEN SQLCODE = 0                                       14960078
138900             SET PS-ADHOC-STORE-CSR-NOT-EOF TO TRUE               14970078
139000           WHEN SQLWARN0 NOT EQUAL SPACE                          14980078
139100           WHEN SQLCODE NOT EQUAL ZERO                            14990078
139200             MOVE '2210-OPEN-ADHOC-STORE-CSR'                     15000078
139300                                   TO PV-PARAGRAPH-NAME           15010078
139400             MOVE 'ERROR ON OPEN OF ADHOC STORE CURSOR'           15020078
139500                                   TO PV-DB2-OPERATION            15030078
139600             PERFORM 9900-SQL-ABEND-ROUTINE                       15040078
139700         END-EVALUATE                                             15050078
139800     END-PERFORM.                                                 15060078
139900                                                                  15070078
140000     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         15080078
140100       MOVE '2210-OPEN-ADHOC-STORE-CSR'                           15090078
140200                             TO  PV-PARAGRAPH-NAME                15100078
140300       MOVE 'OPEN RETRIES EXCEEDED'                               15110078
140400                              TO  PV-DB2-OPERATION                15120078
140500       PERFORM 9900-SQL-ABEND-ROUTINE                             15130078
140600     END-IF.                                                      15140078
140700                                                                  15150078
140800*2210-EXIT.                                                       15160078
140900 EJECT.                                                           15170078
141000                                                                  15180078
141100*----------------------------------------------------------       15190078
141200* 2220-FETCH-ADHOC-STORE-CSR.                                     15200078
141300*     FETCH THE DATA FROM THE ADHOC STORE CURSOR. IF A            15210078
141400*     RECORD IS FOUND USING THIS CURSOR, A SECOND QUERY IS        15220078
141500*     PERFORMED THAT WILL CHECK THE XST_PROMO_STR_GP TABLE        15230078
141600*     FOR OVERRIDES.                                              15240078
141700*----------------------------------------------------------       15250078
141800 2220-FETCH-ADHOC-STORE-CSR.                                      15260078
141900                                                                  15270078
142000     PERFORM                                                      15280078
142100         WITH TEST AFTER                                          15290078
142200         VARYING PV-SQL-SUB                                       15300078
142300         FROM 1 BY 1                                              15310078
142400         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 15320078
142500                   OR  SQLCODE = 0                                15330078
142600                   OR  SQLCODE = +100)                            15340078
142700                                                                  15350078
142800         EXEC SQL                                                 15360078
142900           FETCH ADHOC-STORE                                      15370078
143000            INTO :XST00031-PROMO-INTFC-ID                         15380078
143100                ,:XST00031-MDSE-LNE-ID                            15390078
143200                ,:XST00031-ADHC-STR-GP-ID                         15400078
143300                ,:XST00031-STR-SELN-HIER-CDE                      15410078
143400                ,:XST00031-STAT-CDE                               15420078
143500                ,:XST00031-ACTL-STRT-TMST                         15430078
143600                ,:XST00031-ACTL-END-TMST                          15440078
143700                ,:XST00031-LAST-UPD-TMST                          15450078
143800                ,:XST00031-SOR-LAST-UPD-TMST                      15460078
143900                ,:XST00031-LAST-ACTN-CDE                          15470078
144000                ,:XST00028-PRICG-TYP-CDE                          15480078
144100         END-EXEC                                                 15490078
144200                                                                  15500078
144300         EVALUATE TRUE                                            15510078
144400           WHEN SQLCODE = -904                                    15520078
144500           WHEN SQLCODE = -911                                    15530078
144600           WHEN SQLCODE = -913                                    15540078
144700             CONTINUE                                             15550078
144800           WHEN SQLCODE = ZERO                                    15560078
144900             PERFORM 2240-CREATE-ADHOC-OUTPUT                     15570078
145000           WHEN SQLCODE = +100                                    15580078
145100             SET PS-ADHOC-STORE-CSR-EOF TO TRUE                   15590078
145200           WHEN SQLWARN0 NOT EQUAL SPACE                          15600078
145300           WHEN SQLCODE NOT EQUAL ZERO                            15610078
145400             MOVE '2220-FETCH-ADHOC-STORE-CSR'                    15620078
145500                                    TO PV-PARAGRAPH-NAME          15630078
145600             MOVE 'ERROR ON FETCHING ADHOC STORE CURSOR'          15640078
145700                                    TO PV-DB2-OPERATION           15650078
145800             PERFORM 9900-SQL-ABEND-ROUTINE                       15660078
145900         END-EVALUATE                                             15670078
146000     END-PERFORM.                                                 15680078
146100                                                                  15690078
146200     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         15700078
146300       MOVE '2220-FETCH-ADHOC-STORE-CSR'                          15710078
146400                               TO  PV-PARAGRAPH-NAME              15720078
146500       MOVE 'FETCH RETRIES EXCEEDED'                              15730078
146600                               TO  PV-DB2-OPERATION               15740078
146700       PERFORM 9900-SQL-ABEND-ROUTINE                             15750078
146800     END-IF.                                                      15760078
146900                                                                  15770078
147000*2220-EXIT.                                                       15780078
147100 EJECT.                                                           15790078
147200                                                                  15800078
147300*-----------------------------------------------------------      15810078
147400* 2230-CLOSE-ADHOC-STORE-CSR.                                     15820078
147500*-----------------------------------------------------------      15830078
147600 2230-CLOSE-ADHOC-STORE-CSR.                                      15840078
147700                                                                  15850078
147800     PERFORM                                                      15860078
147900         WITH TEST AFTER                                          15870078
148000         VARYING PV-SQL-SUB                                       15880078
148100         FROM 1 BY 1                                              15890078
148200         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 15900078
148300                   OR  SQLCODE = 0)                               15910078
148400                                                                  15920078
148500         EXEC SQL                                                 15930078
148600           CLOSE ADHOC-STORE                                      15940078
148700         END-EXEC                                                 15950078
148800                                                                  15960078
148900         EVALUATE TRUE                                            15970078
149000           WHEN SQLCODE = -904                                    15980078
149100           WHEN SQLCODE = -911                                    15990078
149200           WHEN SQLCODE = -913                                    16000078
149300           WHEN SQLCODE = 0                                       16010078
149400             CONTINUE                                             16020078
149500           WHEN SQLWARN0 NOT EQUAL SPACE                          16030078
149600           WHEN SQLCODE NOT EQUAL ZERO                            16040078
149700             MOVE '2230-CLOSE-ADHOC-STORE-CSR'                    16050078
149800                                       TO PV-PARAGRAPH-NAME       16060078
149900             MOVE 'ERROR ON CLOSE OF ADHOC STORE CURSOR'          16070078
150000                                       TO PV-DB2-OPERATION        16080078
150100             PERFORM 9900-SQL-ABEND-ROUTINE                       16090078
150200         END-EVALUATE                                             16100078
150300     END-PERFORM.                                                 16110078
150400                                                                  16120078
150500     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         16130078
150600       MOVE '2230-CLOSE-ADHOC-STORE-CSR'                          16140078
150700                               TO  PV-PARAGRAPH-NAME              16150078
150800       MOVE 'CLOSE RETRIES EXCEEDED'                              16160078
150900                               TO  PV-DB2-OPERATION               16170078
151000       PERFORM 9900-SQL-ABEND-ROUTINE                             16180078
151100     END-IF.                                                      16190078
151200                                                                  16200078
151300*2230-EXIT.                                                       16210078
151400 EJECT.                                                           16220078
151500                                                                  16230078
151600*-----------------------------------------------------------      16240078
151700* 2240-CREATE-ADHOC-OUTPUT.                                       16250078
151800*     DETERMINE WHICH OUTPUT RECORDS NEED TO BE PRODUCED.         16260078
151900*-----------------------------------------------------------      16270078
152000 2240-CREATE-ADHOC-OUTPUT.                                        16280078
152100                                                                  16290078
152200*** IT'S POSSIBLE THE PROMO EFFECTIVE DATES ARE BEING CHANGED     16300099
152300*** AND THEREFORE THE PROMOTION MAY ALREADY BE AT THE STORES(S)   16310099
152400*** DUE TO WHAT THE DATES WERE.  THEREFORE, A DELETE RECORD       16320099
152500*** MUST BE SENT NO MATTER WHAT BECAUSE THE NEW DATES MAY HAVE    16330099
152600*** THE PROMOTION STARTING LATER.                                 16340099
152700     IF XST00031-LAST-ACTN-CDE = 'U'                              16350099
152800       PERFORM 3100-ADHC-DEL-REC                                  16360099
152900       SET PS-ADHC-REC-CREATED TO TRUE                            16370099
153000     END-IF.                                                      16380099
153100                                                                  16390078
153200     IF XST00031-STAT-CDE = 'S'                                   16400099
153300       IF ((XST00031-ACTL-STRT-TMST > EP128-CC-CRITICAL-DTE       16410078
153400         AND XST00031-ACTL-STRT-TMST < EP113-CC-CRNT-DTE)         16420078
153500       OR (XST00031-ACTL-STRT-TMST <= EP128-CC-CRITICAL-DTE       16430099
153600         AND XST00031-ACTL-END-TMST >= EP111-CC-CRNT-DTE))        16440078
153700           PERFORM 3110-ADHC-ADD-REC                              16450089
153800           SET PS-ADHC-REC-CREATED TO TRUE                        16460099
153900       END-IF                                                     16470078
154000     END-IF.                                                      16480078
154100                                                                  16490078
154200     IF PS-ADHC-REC-CREATED                                       16500078
154300       MOVE XST00031-PROMO-INTFC-ID                               16510078
154400                             TO PV-STORE-PROMO-INTFC-ID           16520078
154500       MOVE XST00031-MDSE-LNE-ID                                  16530078
154600                             TO PV-STORE-MDSE-LNE-ID              16540078
154700       MOVE XST00031-STR-SELN-HIER-CDE                            16550078
154800                             TO PV-STORE-STR-SELN-HIER-CDE        16560078
154900       MOVE  PC-ADHOC-PRC-SETUP-IND                               16570078
155000                             TO PC-STORE-TYPE                     16580078
155100       PERFORM 2300-FIND-STORE-OVERRIDES                          16590078
155200         UNTIL PS-STORE-OVRRDE-CSR-EOF                            16600078
155300     END-IF.                                                      16610078
155400                                                                  16620078
155500     MOVE 'N'              TO PS-ADHC-OUTPUT-RECS-CREATE-SW       16630078
155600                              PS-STORE-OVRRDE-CSR-EOF-SW.         16640078
155700                                                                  16650078
155800*2240-EXIT.                                                       16660078
155900 EJECT.                                                           16670078
156000                                                                  16680078
156100*----------------------------------------------------------       16690078
156200* 2300-FIND-STORE-OVERRIDES.                                      16700078
156300*     ONCE AN ADHOC STORE IS FOUND USING THE ADHOC CURSOR,        16710078
156400*     A SECOND CURSOR IS EXECUTED TO SEE IF ANY STORE OVERRIDES   16720078
156500*     EXIST FOR THAT STORE. IF AN OVERRIDE IS FOUND A PROMO       16730078
156600*     RECORD IS WRITTEN FROM THE OVERRIDE CURSOR, IF NOT          16740006
156700*     FOUND A PROMO RECORD IS WRIITEN FROM THE ADHOC CURSOR.      16750006
156800*----------------------------------------------------------       16760006
156900 2300-FIND-STORE-OVERRIDES.                                       16770009
157000                                                                  16780006
157100     PERFORM 2310-OPEN-STORE-OVRRDE-CSR.                          16790009
157200     PERFORM 2320-FETCH-STORE-OVRRDE-CSR                          16800077
157300       UNTIL PS-STORE-OVRRDE-CSR-EOF.                             16810056
157400     PERFORM 2330-CLOSE-STORE-OVRRDE-CSR.                         16820077
157500                                                                  16830006
157600*2300-EXIT.                                                       16840009
157700 EJECT.                                                           16850006
157800                                                                  16860006
157900*----------------------------------------------------------       16870006
158000* 2310-OPEN-STORE-OVRRDE-CSR.                                     16880009
158100*     OPEN THE STORE OVERRIDE CURSOR.                             16890006
158200*----------------------------------------------------------       16900006
158300 2310-OPEN-STORE-OVRRDE-CSR.                                      16910009
158400                                                                  16920006
158500     PERFORM                                                      16930006
158600         WITH TEST AFTER                                          16940006
158700         VARYING PV-SQL-SUB                                       16950006
158800         FROM 1 BY 1                                              16960006
158900         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 16970006
159000                   OR  SQLCODE = 0)                               16980006
159100                                                                  16990006
159200         EXEC SQL                                                 17000006
159300           OPEN STORE-OVRRDE                                      17010006
159400         END-EXEC                                                 17020006
159500                                                                  17030006
159600         EVALUATE TRUE                                            17040006
159700           WHEN SQLCODE = -904                                    17050006
159800           WHEN SQLCODE = -911                                    17060006
159900           WHEN SQLCODE = -913                                    17070006
160000             CONTINUE                                             17080006
160100           WHEN SQLCODE = 0                                       17090006
160200             SET PS-STORE-OVRRDE-CSR-NOT-EOF TO TRUE              17100006
160300           WHEN SQLWARN0 NOT EQUAL SPACE                          17110006
160400           WHEN SQLCODE NOT EQUAL ZERO                            17120006
160500             MOVE '2310-OPEN-STORE-OVRRDE-CSR'                    17130008
160600                                     TO PV-PARAGRAPH-NAME         17140006
160700             MOVE 'ERROR ON OPEN OF STORE OVRRDE CURSOR'          17150006
160800                                     TO PV-DB2-OPERATION          17160006
160900             PERFORM 9900-SQL-ABEND-ROUTINE                       17170006
161000         END-EVALUATE                                             17180006
161100     END-PERFORM.                                                 17190006
161200                                                                  17200006
161300     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         17210006
161400       MOVE '2310-OPEN-STORE-OVRRDE-CSR'                          17220008
161500                             TO  PV-PARAGRAPH-NAME                17230006
161600       MOVE 'OPEN RETRIES EXCEEDED'                               17240006
161700                              TO  PV-DB2-OPERATION                17250006
161800       PERFORM 9900-SQL-ABEND-ROUTINE                             17260006
161900     END-IF.                                                      17270006
162000                                                                  17280006
162100*2310-EXIT.                                                       17290009
162200 EJECT.                                                           17300006
162300                                                                  17310006
162400*----------------------------------------------------------       17320006
162500* 2320-FETCH-STORE-OVRRDE-CSR.                                    17330009
162600*     FETCH THE DATA FOR THE STORE OVERRIDE CURSOR. IF A          17340006
162700*     RECORD IS FOUND WITH THIS CURSOR, A PROMO RECORD IS         17350006
162800*     WRITTEN FOR THE OVERRIDE STORE. IF AN OVERRIDE IS NOT       17360006
162900*     FOUND, A PROMO RECORD IS WRITTEN FOR THE ADHOC STORE.       17370006
163000*----------------------------------------------------------       17380006
163100 2320-FETCH-STORE-OVRRDE-CSR.                                     17390009
163200                                                                  17400006
163300     PERFORM                                                      17410006
163400         WITH TEST AFTER                                          17420006
163500         VARYING PV-SQL-SUB                                       17430006
163600         FROM 1 BY 1                                              17440006
163700         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 17450006
163800                   OR  SQLCODE = 0                                17460006
163900                   OR  SQLCODE = +100)                            17470006
164000                                                                  17480006
164100         EXEC SQL                                                 17490006
164200           FETCH STORE-OVRRDE                                     17500006
164300            INTO  :XST00029-PROMO-INTFC-ID                        17510006
164400                 ,:XST00029-MDSE-LNE-ID                           17520006
164500                 ,:XST00029-STR-GP-TYP-CDE                        17530006
164600                 ,:XST00029-STR-GP-ID                             17540006
164700                 ,:XST00029-STR-SELN-HIER-CDE                     17550006
164800                 ,:XST00029-STAT-CDE                              17560006
164900                 ,:XST00029-ACTL-STRT-TMST                        17570006
165000                 ,:XST00029-ACTL-END-TMST                         17580006
165100                 ,:XST00029-LAST-UPD-TMST                         17590006
165200                 ,:XST00029-SOR-LAST-UPD-TMST                     17600006
165300                 ,:XST00028-PRICG-TYP-CDE                         17610006
165400         END-EXEC                                                 17620006
165500                                                                  17630006
165600         EVALUATE TRUE                                            17640006
165700           WHEN SQLCODE = -904                                    17650006
165800           WHEN SQLCODE = -911                                    17660006
165900           WHEN SQLCODE = -913                                    17670006
166000             CONTINUE                                             17680006
166100           WHEN SQLCODE = ZERO                                    17690006
166200           IF PC-STORE-TYPE-RMS                                   17700055
166300             PERFORM 3030-RMS-OVRRDE-OUTPUT                       17710089
166400           ELSE                                                   17720054
166500             PERFORM 3130-ADHC-OVRRDE-OUTPUT                      17730089
166600           END-IF                                                 17740054
166700           WHEN SQLCODE = +100                                    17750006
166800             SET PS-STORE-OVRRDE-CSR-EOF TO TRUE                  17760054
166900           WHEN SQLWARN0 NOT EQUAL SPACE                          17770006
167000           WHEN SQLCODE NOT EQUAL ZERO                            17780006
167100             MOVE '2320-FETCH-STORE-OVRRDE-CSR'                   17790008
167200                                    TO PV-PARAGRAPH-NAME          17800006
167300             MOVE 'ERROR ON FETCHING STORE OVRRDE CURSOR'         17810006
167400                                    TO PV-DB2-OPERATION           17820006
167500             DISPLAY 'SQLCODE= ' SQLCODE                          17830006
167600             PERFORM 9900-SQL-ABEND-ROUTINE                       17840006
167700         END-EVALUATE                                             17850006
167800     END-PERFORM.                                                 17860006
167900                                                                  17870006
168000     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         17880006
168100       MOVE '2320-FETCH-STORE-OVRRDE-CSR'                         17890008
168200                              TO  PV-PARAGRAPH-NAME               17900006
168300       MOVE 'FETCH RETRIES EXCEEDED'                              17910006
168400                              TO  PV-DB2-OPERATION                17920006
168500       PERFORM 9900-SQL-ABEND-ROUTINE                             17930006
168600     END-IF.                                                      17940006
168700                                                                  17950006
168800*2320-EXIT.                                                       17960009
168900 EJECT.                                                           17970006
169000                                                                  17980006
169100*-----------------------------------------------------------      17990006
169200* 2330-CLOSE-STORE-OVRRDE-CSR.                                    18000077
169300*     CLOSE THE STORE OVERRIDE CURSOR.                            18010006
169400*-----------------------------------------------------------      18020006
169500 2330-CLOSE-STORE-OVRRDE-CSR.                                     18030077
169600                                                                  18040006
169700     PERFORM                                                      18050006
169800         WITH TEST AFTER                                          18060006
169900         VARYING PV-SQL-SUB                                       18070006
170000         FROM 1 BY 1                                              18080006
170100         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 18090006
170200                   OR  SQLCODE = 0)                               18100006
170300                                                                  18110006
170400         EXEC SQL                                                 18120006
170500           CLOSE STORE-OVRRDE                                     18130006
170600         END-EXEC                                                 18140006
170700                                                                  18150006
170800         EVALUATE TRUE                                            18160006
170900           WHEN SQLCODE = -904                                    18170006
171000           WHEN SQLCODE = -911                                    18180006
171100           WHEN SQLCODE = -913                                    18190006
171200           WHEN SQLCODE = 0                                       18200006
171300             CONTINUE                                             18210006
171400           WHEN SQLWARN0 NOT EQUAL SPACE                          18220006
171500           WHEN SQLCODE NOT EQUAL ZERO                            18230006
171600             MOVE '2330-CLOSE-STORE-OVRRDE-CSR'                   18240077
171700                                     TO PV-PARAGRAPH-NAME         18250006
171800             MOVE 'ERROR ON CLOSE OF STORE OVRRDE CURSOR'         18260006
171900                                     TO PV-DB2-OPERATION          18270006
172000             PERFORM 9900-SQL-ABEND-ROUTINE                       18280006
172100         END-EVALUATE                                             18290006
172200     END-PERFORM.                                                 18300006
172300                                                                  18310006
172400     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         18320006
172500       MOVE '2330-CLOSE-STORE-OVRRDE-CSR'                         18330077
172600                               TO  PV-PARAGRAPH-NAME              18340006
172700       MOVE 'CLOSE RETRIES EXCEEDED'                              18350006
172800                               TO  PV-DB2-OPERATION               18360006
172900       PERFORM 9900-SQL-ABEND-ROUTINE                             18370006
173000     END-IF.                                                      18380006
173100                                                                  18390006
173200*2330-EXIT.                                                       18400077
173300 EJECT.                                                           18410006
173400                                                                  18420006
173500*-----------------------------------------------------------      18430009
173600* 3000-RMS-DELREC-TO-CHG-STRGP.                                   18440089
173700*     POPULATE COPYBOOK EPRD072 FOR EMERGENCY AND NIGHTLY         18450070
173800*     DELETE RECORDS WHICH SHOULD BE SENT TO THE STORE GROUP      18460089
173900*     WHICH IS ON THE IDENTIFIED CHANGED RECORD.                  18470089
174000*-----------------------------------------------------------      18480009
174100 3000-RMS-DELREC-TO-CHG-STRGP.                                    18490089
174200                                                                  18500009
174300     INITIALIZE EP072-PROMO-INTFC-RECORD.                         18510009
174400     MOVE PC-PRICG-STR-GRP-EVENT                                  18520026
174500                             TO EP072-BUSINESS-EVENT-ID.          18530009
174600     MOVE PC-RMS-PRC-SETUP-IND                                    18540009
174700                             TO EP072-PRC-SETUP-IND.              18550009
174800                                                                  18560089
174900     MOVE XST00029-STR-GP-TYP-CDE                                 18570089
175000                             TO EP072-SETUP-STR-GRP-TYP-CDE.      18580090
175100     MOVE XST00029-STR-GP-ID                                      18590089
175200                             TO EP072-SETUP-STR-GRP-ID.           18600089
175300     MOVE XST00029-STR-SELN-HIER-CDE                              18610089
175400                             TO EP072-STR-SELN-HIER-CDE.          18620089
175500     MOVE XST00029-STR-GP-TYP-CDE                                 18630089
175600                             TO EP072-DIST-STR-GRP-TYP-CDE.       18640089
175700     MOVE XST00029-STR-GP-ID                                      18650089
175800                             TO EP072-DIST-STR-GRP-ID.            18660089
175900                                                                  18670089
176000     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               18680009
176100     MOVE PC-DELETE-STAT-CDE                                      18690009
176200                             TO EP072-RECORD-ACTION               18700009
176300     MOVE XST00029-PROMO-INTFC-ID                                 18710009
176400                             TO EP072-PROMO-INTFC-ID.             18720009
176500     MOVE XST00029-MDSE-LNE-ID                                    18730009
176600                             TO EP072-MERCH-LNE-ID.               18740009
176700     MOVE XST00028-PRICG-TYP-CDE                                  18750009
176800                             TO EP072-PRICG-TYP-CDE.              18760009
176900     MOVE PC-MDSE-INCL-BOTH-IND                                   18770026
177000                             TO EP072-MDSE-INC-EXC-IND.           18780009
177100     MOVE XST00029-ACTL-STRT-TMST                                 18790009
177200                             TO EP072-STR-GRP-PROMO-STRT-TMST.    18800009
177300     MOVE XST00029-ACTL-END-TMST                                  18810009
177400                             TO EP072-STR-GRP-PROMO-END-TMST.     18820009
177500                                                                  18830097
177600*** WHEN A DELETE RECORD IS WRITTEN OUT FOR A CANCELED            18840097
177700*** OVERRIDE, AND AN ACTIVE PARENT EXISTS, AND THE RECORD         18850097
177800*** WILL BE DISTRIBUTED TO THE STORE GROUP OF THE CHANGED         18860097
177900*** RECORD...USE THE SOR-LAST-UPD-TMST FROM THE PARENT RECORD.    18870097
178000*** IF THE SOR-LAST-UPD-TMST OF THE CHANGED RECORD IS USED THE    18880097
178100*** SORTING WHICH OCCURS AFTER THIS PROGRAM WILL PUT THE ADD      18890097
178200*** OF THE PARENT VALUES FIRST AND THEN THE DELETE WHICH WILL     18900097
178300*** END UP LEAVING THE STORE GROUP WITH NOTHING.                  18910097
178400     IF PS-RMS-PRNT-STORE-FND AND PRNT-RMS-STAT-CDE = 'S'         18920097
178500       MOVE PRNT-RMS-SOR-LAST-UPD-TMST                            18930097
178600                             TO EP072-SOR-LAST-UPD-TMST           18940097
178700     ELSE                                                         18950097
178800       MOVE XST00029-SOR-LAST-UPD-TMST                            18960097
178900                             TO EP072-SOR-LAST-UPD-TMST           18970097
179000     END-IF.                                                      18980097
179100                                                                  18990009
179800*** WRITE A NIGHTLY RECORD OUT FOR THE DELETE                     19000070
179900     MOVE PC-APPLY-NIGHTLY                                        19010070
180000                             TO EP072-APPLY-IND.                  19020070
180100     PERFORM 4000-WRITE-NIGHT-APPLY-REC.                          19030089
180200     ADD 1 TO PC-CNT-RMS-RECS.                                    19040070
180300                                                                  19050070
180400*3000-EXIT.                                                       19060009
180500 EJECT.                                                           19070009
180600                                                                  19080009
180601*-----------------------------------------------------------      19090099
180602* 3005-RMS-DELREC-TO-CHG-STRGP-2.                                 19100089
180603*     POPULATE COPYBOOK EPRD072 FOR EMERGENCY AND NIGHTLY         19110070
180604*     DELETE RECORDS WHICH SHOULD BE SENT TO THE STORE GROUP      19120089
180605*     WHICH IS ON THE IDENTIFIED CHANGED RECORD.                  19130089
180606*-----------------------------------------------------------      19140009
180607 3005-RMS-DELREC-TO-CHG-STRGP-2.                                  19150089
180608                                                                  19160009
180609     INITIALIZE EP072-PROMO-INTFC-RECORD.                         19170009
180610     MOVE PC-PRICG-STR-GRP-EVENT                                  19180026
180611                             TO EP072-BUSINESS-EVENT-ID.          19190009
180612     MOVE PC-RMS-PRC-SETUP-IND                                    19200009
180613                             TO EP072-PRC-SETUP-IND.              19210009
180614                                                                  19220089
180615     MOVE XST00029-STR-GP-TYP-CDE                                 19230089
180616                             TO EP072-SETUP-STR-GRP-TYP-CDE.      19240090
180617     MOVE XST00029-STR-GP-ID                                      19250089
180618                             TO EP072-SETUP-STR-GRP-ID.           19260089
180619     MOVE XST00029-STR-SELN-HIER-CDE                              19270089
180620                             TO EP072-STR-SELN-HIER-CDE.          19280089
180621     MOVE XST00029-STR-GP-TYP-CDE                                 19290089
180622                             TO EP072-DIST-STR-GRP-TYP-CDE.       19300089
180623     MOVE XST00029-STR-GP-ID                                      19310089
180624                             TO EP072-DIST-STR-GRP-ID.            19320089
180625                                                                  19330089
180626     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               19340009
180627     MOVE PC-DELETE-STAT-CDE                                      19350009
180628                             TO EP072-RECORD-ACTION               19360009
180629     MOVE XST00029-PROMO-INTFC-ID                                 19370009
180630                             TO EP072-PROMO-INTFC-ID.             19380009
180631     MOVE XST00029-MDSE-LNE-ID                                    19390009
180632                             TO EP072-MERCH-LNE-ID.               19400009
180633     MOVE XST00028-PRICG-TYP-CDE                                  19410009
180634                             TO EP072-PRICG-TYP-CDE.              19420009
180635     MOVE PC-MDSE-INCL-BOTH-IND                                   19430026
180636                             TO EP072-MDSE-INC-EXC-IND.           19440009
180637     MOVE XST00029-ACTL-STRT-TMST                                 19450009
180638                             TO EP072-STR-GRP-PROMO-STRT-TMST.    19460009
180639     MOVE XST00029-ACTL-END-TMST                                  19470009
180640                             TO EP072-STR-GRP-PROMO-END-TMST.     19480009
180641                                                                  19490097
180642*** WHEN A DELETE RECORD IS WRITTEN OUT FOR A CANCELED            19500097
180643*** OVERRIDE, AND AN ACTIVE PARENT EXISTS, AND THE RECORD         19510097
180644*** WILL BE DISTRIBUTED TO THE STORE GROUP OF THE CHANGED         19520097
180645*** RECORD...USE THE SOR-LAST-UPD-TMST FROM THE PARENT RECORD.    19530097
180646*** IF THE SOR-LAST-UPD-TMST OF THE CHANGED RECORD IS USED THE    19540097
180647*** SORTING WHICH OCCURS AFTER THIS PROGRAM WILL PUT THE ADD      19550097
180648*** OF THE PARENT VALUES FIRST AND THEN THE DELETE WHICH WILL     19560097
180649*** END UP LEAVING THE STORE GROUP WITH NOTHING.                  19570097
180650     IF PS-RMS-PRNT-STORE-FND AND PRNT-RMS-STAT-CDE = 'S'         19580097
180651       MOVE PRNT-RMS-SOR-LAST-UPD-TMST                            19590097
180652                             TO EP072-SOR-LAST-UPD-TMST           19600097
180653     ELSE                                                         19610097
180654       MOVE XST00029-SOR-LAST-UPD-TMST                            19620097
180655                             TO EP072-SOR-LAST-UPD-TMST           19630097
180656     END-IF.                                                      19640097
180657                                                                  19650009
180658     PERFORM 3200-CALC-LAST-UPD-TMST.                             19660099
180659                                                                  19670009
180660                                                                  19680009
180661*** WRITE A NIGHTLY RECORD OUT FOR THE DELETE                     19690070
180662     MOVE PC-APPLY-NIGHTLY                                        19700070
180663                             TO EP072-APPLY-IND.                  19710070
180664     PERFORM 4000-WRITE-NIGHT-APPLY-REC.                          19720089
180665     ADD 1 TO PC-CNT-RMS-RECS.                                    19730070
180666                                                                  19740070
180667*3005-EXIT.                                                       19750009
180668 EJECT.                                                           19760009
180669                                                                  19770009
180700*-----------------------------------------------------------      19780009
180800* 3010-RMS-ADD-REC.                                               19790089
180900*     POPULATE COPYBOOK EPRD072 FOR EMERGENCY AND/OR NIGHTLY      19800089
181000*     ADD RECORDS.                                                19810089
181100*-----------------------------------------------------------      19820009
181200 3010-RMS-ADD-REC.                                                19830089
181300                                                                  19840009
181400     INITIALIZE EP072-PROMO-INTFC-RECORD.                         19850009
181500     MOVE PC-PRICG-STR-GRP-EVENT                                  19860026
181600                             TO EP072-BUSINESS-EVENT-ID.          19870009
181700     MOVE PC-RMS-PRC-SETUP-IND                                    19880009
181800                             TO EP072-PRC-SETUP-IND.              19890009
181900     MOVE XST00029-STR-GP-TYP-CDE                                 19900009
182000                             TO EP072-SETUP-STR-GRP-TYP-CDE.      19910009
182100     MOVE XST00029-STR-GP-ID                                      19920009
182200                             TO EP072-SETUP-STR-GRP-ID.           19930006
182300     MOVE XST00029-STR-SELN-HIER-CDE                              19940009
182400                             TO EP072-STR-SELN-HIER-CDE.          19950006
182500     MOVE XST00029-STR-GP-TYP-CDE                                 19960009
182600                             TO EP072-DIST-STR-GRP-TYP-CDE.       19970006
182700     MOVE XST00029-STR-GP-ID                                      19980009
182800                             TO EP072-DIST-STR-GRP-ID.            19990006
182900     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               20000006
183000                                                                  20010006
183100     MOVE XST00029-ACTL-STRT-TMST                                 20020064
183200                             TO PV-ACTL-STRT-TMST.                20030064
183300     MOVE XST00029-ACTL-END-TMST                                  20040064
183400                             TO PV-ACTL-END-TMST.                 20050064
183500                                                                  20060064
183600     IF (PV-ACTL-STRT-TMST-DATE > EP128-CC-CRITICAL-DTE           20070064
183700       AND PV-ACTL-STRT-TMST-DATE < EP113-CC-CRNT-DTE)            20080064
183800         MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND               20090013
184400     END-IF.                                                      20100009
184500                                                                  20110074
184600     MOVE PC-ADD-STAT-CDE    TO EP072-RECORD-ACTION               20120009
184700     MOVE XST00029-PROMO-INTFC-ID                                 20130009
184800                             TO EP072-PROMO-INTFC-ID.             20140006
184900     MOVE XST00029-MDSE-LNE-ID                                    20150009
185000                             TO EP072-MERCH-LNE-ID.               20160006
185100     MOVE XST00028-PRICG-TYP-CDE                                  20170006
185200                             TO EP072-PRICG-TYP-CDE.              20180006
185300     MOVE PC-MDSE-INCL-BOTH-IND                                   20190006
185400                             TO EP072-MDSE-INC-EXC-IND.           20200006
185500     MOVE XST00029-ACTL-STRT-TMST                                 20210009
185600                             TO EP072-STR-GRP-PROMO-STRT-TMST.    20220006
185700     MOVE XST00029-ACTL-END-TMST                                  20230009
185800                             TO EP072-STR-GRP-PROMO-END-TMST.     20240006
185900     MOVE XST00029-SOR-LAST-UPD-TMST                              20250009
186000                             TO EP072-SOR-LAST-UPD-TMST.          20260006
186100                                                                  20270006
186200     IF EP072-APPLY-NIGHTLY                                       20280006
186300       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         20290089
186400       ADD 1 TO PC-CNT-RMS-RECS                                   20300059
186500     ELSE                                                         20310006
186700       MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND                 20320006
186800       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         20330089
186900       ADD 1 TO PC-CNT-RMS-RECS                                   20340059
187000     END-IF.                                                      20350006
187100                                                                  20360006
187200*3010-EXIT.                                                       20370009
187300 EJECT.                                                           20380006
187400                                                                  20390006
187500*-----------------------------------------------------------      20400009
187600* 3020-RMS-ADDREC-TO-CHG-STRGP.                                   20410089
187700*     POPULATE COPYBOOK EPRD072 FOR EMERGENCY AND/OR NIGHTLY      20420089
187800*     ADD RECORDS WHICH ARE POPULATED WITH THE PARENT             20430089
187900*     EFFECTIVITY TIMESTAMPS.                                     20440089
188000*-----------------------------------------------------------      20450009
188100 3020-RMS-PRNTREC-TO-CHG-STRGP.                                   20460089
188200                                                                  20470009
188300     INITIALIZE EP072-PROMO-INTFC-RECORD.                         20480009
188400     MOVE PC-PRICG-STR-GRP-EVENT                                  20490026
188500                             TO EP072-BUSINESS-EVENT-ID.          20500009
188600     MOVE PC-RMS-PRC-SETUP-IND                                    20510009
188700                             TO EP072-PRC-SETUP-IND.              20520009
188800     MOVE PRNT-RMS-STR-GP-TYP-CDE                                 20530049
188900                             TO EP072-SETUP-STR-GRP-TYP-CDE.      20540050
189000     MOVE PRNT-RMS-STR-GP-ID                                      20550049
189100                             TO EP072-SETUP-STR-GRP-ID.           20560009
189200     MOVE XST00029-STR-SELN-HIER-CDE                              20570090
189300                             TO EP072-STR-SELN-HIER-CDE           20580090
189400     MOVE XST00029-STR-GP-TYP-CDE                                 20590089
189500                             TO EP072-DIST-STR-GRP-TYP-CDE        20600082
189600     MOVE XST00029-STR-GP-ID                                      20610089
189700                             TO EP072-DIST-STR-GRP-ID             20620082
189800     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               20630090
189900                                                                  20640009
190000     IF (PV-PRNT-RMS-ACTL-STRT-DATE > EP128-CC-CRITICAL-DTE       20650068
190100       AND PV-PRNT-RMS-ACTL-STRT-DATE < EP113-CC-CRNT-DTE)        20660068
190200         MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND               20670013
190700     END-IF.                                                      20680009
190800                                                                  20690009
190900     MOVE PC-ADD-STAT-CDE    TO EP072-RECORD-ACTION               20700009
191000     MOVE XST00029-PROMO-INTFC-ID                                 20710009
191100                             TO EP072-PROMO-INTFC-ID.             20720009
191200     MOVE XST00029-MDSE-LNE-ID                                    20730009
191300                             TO EP072-MERCH-LNE-ID.               20740009
191400     MOVE XST00028-PRICG-TYP-CDE                                  20750009
191500                             TO EP072-PRICG-TYP-CDE.              20760009
191600     MOVE PC-MDSE-INCL-BOTH-IND                                   20770009
191700                             TO EP072-MDSE-INC-EXC-IND.           20780009
191800     MOVE PRNT-RMS-ACTL-STRT-TMST                                 20790052
191900                             TO EP072-STR-GRP-PROMO-STRT-TMST.    20800009
192000     MOVE PRNT-RMS-ACTL-END-TMST                                  20810052
192100                             TO EP072-STR-GRP-PROMO-END-TMST.     20820009
192200     MOVE PRNT-RMS-SOR-LAST-UPD-TMST                              20830049
192300                             TO EP072-SOR-LAST-UPD-TMST.          20840009
192400                                                                  20850009
192500     IF EP072-APPLY-NIGHTLY                                       20860009
192600       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         20870089
192700       ADD 1 TO PC-CNT-RMS-RECS                                   20880059
192800     ELSE                                                         20890009
193000       MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND                 20900009
193100       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         20910089
193200       ADD 1 TO PC-CNT-RMS-RECS                                   20920059
193300     END-IF.                                                      20930009
193400                                                                  20940009
193500*3020-EXIT.                                                       20950009
193600 EJECT.                                                           20960009
193700                                                                  20970009
193800*-----------------------------------------------------------      20980050
193900* 3030-RMS-OVRRDE-OUTPUT.                                         20990089
194000*     POPULATE COPYBOOK EPRD072.                                  21000050
194100*-----------------------------------------------------------      21010050
194200 3030-RMS-OVRRDE-OUTPUT.                                          21020089
194300                                                                  21030050
194400     INITIALIZE EP072-PROMO-INTFC-RECORD.                         21040050
194500     MOVE PC-PRICG-BUS-EVENT                                      21050050
194600                             TO EP072-BUSINESS-EVENT-ID.          21060050
194700     MOVE PC-RMS-PRC-SETUP-IND                                    21070050
194800                             TO EP072-PRC-SETUP-IND.              21080050
194900     MOVE XST00029-STR-GP-TYP-CDE                                 21090050
195000                             TO EP072-SETUP-STR-GRP-TYP-CDE.      21100050
195100     MOVE XST00029-STR-GP-ID                                      21110050
195200                             TO EP072-SETUP-STR-GRP-ID.           21120050
195300     MOVE XST00029-STR-SELN-HIER-CDE                              21130050
195400                             TO EP072-STR-SELN-HIER-CDE.          21140050
195500     MOVE XST00029-STR-GP-TYP-CDE                                 21150050
195600                             TO EP072-DIST-STR-GRP-TYP-CDE.       21160050
195700     MOVE XST00029-STR-GP-ID                                      21170050
195800                             TO EP072-DIST-STR-GRP-ID.            21180050
195900     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               21190050
196000     MOVE XST00029-ACTL-STRT-TMST                                 21200064
196100                             TO PV-ACTL-STRT-TMST.                21210064
196200                                                                  21220050
196600       IF PV-ACTL-STRT-TMST-DATE < EP113-CC-CRNT-DTE              21230064
196700         MOVE PC-APPLY-NIGHTLY    TO EP072-APPLY-IND              21240058
196900       END-IF.                                                    21250050
197000                                                                  21260050
197100     MOVE PC-ADD-STAT-CDE    TO EP072-RECORD-ACTION.              21270050
197200     MOVE XST00029-PROMO-INTFC-ID                                 21280050
197300                             TO EP072-PROMO-INTFC-ID.             21290050
197400     MOVE XST00029-MDSE-LNE-ID                                    21300050
197500                             TO EP072-MERCH-LNE-ID.               21310050
197600     MOVE XST00028-PRICG-TYP-CDE                                  21320050
197700                             TO EP072-PRICG-TYP-CDE.              21330050
197800     MOVE PC-MDSE-INCL-BOTH-IND                                   21340050
197900                             TO EP072-MDSE-INC-EXC-IND.           21350050
198000     MOVE XST00029-ACTL-STRT-TMST                                 21360050
198100                             TO EP072-STR-GRP-PROMO-STRT-TMST.    21370050
198200     MOVE XST00029-ACTL-END-TMST                                  21380050
198300                             TO EP072-STR-GRP-PROMO-END-TMST.     21390050
198400     MOVE XST00029-SOR-LAST-UPD-TMST                              21400050
198500                             TO EP072-SOR-LAST-UPD-TMST.          21410050
198600                                                                  21420050
198700     IF EP072-APPLY-NIGHTLY                                       21430050
198800       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         21440089
198900       ADD 1 TO PC-CNT-OVRRDE-RECS                                21450059
199000     ELSE                                                         21460050
199200       MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND                 21470050
199300       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         21480089
199400       ADD 1 TO PC-CNT-OVRRDE-RECS                                21490059
199500     END-IF.                                                      21500050
199600                                                                  21510050
199700*3030-EXIT.                                                       21520050
199800 EJECT.                                                           21530050
199900                                                                  21540050
200000*-----------------------------------------------------------      21550089
200100* 3040-RMS-DELREC-TO-PRNT-STRGP.                                  21560089
200200*     POPULATE COPYBOOK EPRD072 FOR EMERGENCY AND NIGHTLY         21570089
200300*     DELETE RECORDS.                                             21580089
200400*-----------------------------------------------------------      21590089
200500 3040-RMS-DELREC-TO-PRNT-STRGP.                                   21600089
200600                                                                  21610089
200700     INITIALIZE EP072-PROMO-INTFC-RECORD.                         21620089
200800     MOVE PC-PRICG-STR-GRP-EVENT                                  21630089
200900                             TO EP072-BUSINESS-EVENT-ID.          21640089
201000     MOVE PC-RMS-PRC-SETUP-IND                                    21650089
201100                             TO EP072-PRC-SETUP-IND.              21660089
201200     MOVE PRNT-RMS-STR-GP-TYP-CDE                                 21670090
201300                             TO EP072-SETUP-STR-GRP-TYP-CDE.      21680093
201400     MOVE PRNT-RMS-STR-GP-ID                                      21690090
201500                             TO EP072-SETUP-STR-GRP-ID.           21700089
201600     MOVE PRNT-RMS-STR-SELN-HIER-CDE                              21710090
201700                             TO EP072-STR-SELN-HIER-CDE.          21720089
201800     MOVE PRNT-RMS-STR-GP-TYP-CDE                                 21730090
201900                             TO EP072-DIST-STR-GRP-TYP-CDE.       21740089
202000     MOVE PRNT-RMS-STR-GP-ID                                      21750090
202100                             TO EP072-DIST-STR-GRP-ID.            21760089
202200                                                                  21770089
202300     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               21780089
202400     MOVE PC-DELETE-STAT-CDE                                      21790089
202500                             TO EP072-RECORD-ACTION               21800089
202600     MOVE XST00029-PROMO-INTFC-ID                                 21810089
202700                             TO EP072-PROMO-INTFC-ID.             21820089
202800     MOVE XST00029-MDSE-LNE-ID                                    21830089
202900                             TO EP072-MERCH-LNE-ID.               21840089
203000     MOVE XST00028-PRICG-TYP-CDE                                  21850089
203100                             TO EP072-PRICG-TYP-CDE.              21860089
203200     MOVE PC-MDSE-INCL-BOTH-IND                                   21870089
203300                             TO EP072-MDSE-INC-EXC-IND.           21880089
203400     MOVE PRNT-RMS-ACTL-STRT-TMST                                 21890090
203500                             TO EP072-STR-GRP-PROMO-STRT-TMST.    21900089
203600     MOVE PRNT-RMS-ACTL-END-TMST                                  21910090
203700                             TO EP072-STR-GRP-PROMO-END-TMST.     21920089
203800     MOVE PRNT-RMS-SOR-LAST-UPD-TMST                              21930090
203900                             TO EP072-SOR-LAST-UPD-TMST.          21940089
204000                                                                  21950089
204700*** WRITE A NIGHTLY RECORD OUT FOR THE DELETE                     21960089
204800     MOVE PC-APPLY-NIGHTLY                                        21970089
204900                             TO EP072-APPLY-IND.                  21980089
205000     PERFORM 4000-WRITE-NIGHT-APPLY-REC.                          21990089
205100     ADD 1 TO PC-CNT-RMS-RECS.                                    22000089
205200                                                                  22010089
205300*3040-EXIT.                                                       22020089
205400 EJECT.                                                           22030089
205500                                                                  22040089
205600*-----------------------------------------------------------      22050089
205700* 3050-RMS-PRNTREC-TO-PRNT-STRGP.                                 22060090
205800*     POPULATE COPYBOOK EPRD072 FOR EMERGENCY AND/OR NIGHTLY      22070090
205900*     ADD RECORDS WHICH ARE POPULATED WITH THE PARENT             22080090
206000*     VALUES AND SENT TO THE PARENT STORE GROUP.                  22090090
206100*-----------------------------------------------------------      22100089
206200 3050-RMS-PRNTREC-TO-PRNT-STRGP.                                  22110090
206300                                                                  22120089
206400     INITIALIZE EP072-PROMO-INTFC-RECORD.                         22130089
206500     MOVE PC-PRICG-STR-GRP-EVENT                                  22140089
206600                             TO EP072-BUSINESS-EVENT-ID.          22150089
206700     MOVE PC-RMS-PRC-SETUP-IND                                    22160089
206800                             TO EP072-PRC-SETUP-IND.              22170089
206900     MOVE PRNT-RMS-STR-GP-TYP-CDE                                 22180089
207000                             TO EP072-SETUP-STR-GRP-TYP-CDE.      22190089
207100     MOVE PRNT-RMS-STR-GP-ID                                      22200089
207200                             TO EP072-SETUP-STR-GRP-ID.           22210089
207300     MOVE PRNT-RMS-STR-SELN-HIER-CDE                              22220091
207400                             TO EP072-STR-SELN-HIER-CDE           22230091
207500     MOVE PRNT-RMS-STR-GP-TYP-CDE                                 22240090
207600                             TO EP072-DIST-STR-GRP-TYP-CDE        22250089
207700     MOVE PRNT-RMS-STR-GP-ID                                      22260090
207800                             TO EP072-DIST-STR-GRP-ID             22270089
207900     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               22280091
208000                                                                  22290089
208100     IF (PV-PRNT-RMS-ACTL-STRT-DATE > EP128-CC-CRITICAL-DTE       22300089
208200       AND PV-PRNT-RMS-ACTL-STRT-DATE < EP113-CC-CRNT-DTE)        22310089
208300         MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND               22320089
208800     END-IF.                                                      22330089
208900                                                                  22340089
209000     MOVE PC-ADD-STAT-CDE    TO EP072-RECORD-ACTION               22350089
209100     MOVE XST00029-PROMO-INTFC-ID                                 22360089
209200                             TO EP072-PROMO-INTFC-ID.             22370089
209300     MOVE XST00029-MDSE-LNE-ID                                    22380089
209400                             TO EP072-MERCH-LNE-ID.               22390089
209500     MOVE XST00028-PRICG-TYP-CDE                                  22400089
209600                             TO EP072-PRICG-TYP-CDE.              22410089
209700     MOVE PC-MDSE-INCL-BOTH-IND                                   22420089
209800                             TO EP072-MDSE-INC-EXC-IND.           22430089
209900     MOVE PRNT-RMS-ACTL-STRT-TMST                                 22440089
210000                             TO EP072-STR-GRP-PROMO-STRT-TMST.    22450089
210100     MOVE PRNT-RMS-ACTL-END-TMST                                  22460089
210200                             TO EP072-STR-GRP-PROMO-END-TMST.     22470089
210300     MOVE PRNT-RMS-SOR-LAST-UPD-TMST                              22480089
210400                             TO EP072-SOR-LAST-UPD-TMST.          22490089
210500                                                                  22500089
210600     IF EP072-APPLY-NIGHTLY                                       22510089
210700       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         22520089
210800       ADD 1 TO PC-CNT-RMS-RECS                                   22530089
210900     ELSE                                                         22540089
211100       MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND                 22550089
211200       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         22560089
211300       ADD 1 TO PC-CNT-RMS-RECS                                   22570089
211400     END-IF.                                                      22580089
211500                                                                  22590089
211600*3050-EXIT.                                                       22600089
211700 EJECT.                                                           22610089
211800                                                                  22620089
211900*-----------------------------------------------------------      22630009
212000* 3100-ADHC-DEL-REC.                                              22640089
212100*     POPULATE COPYBOOK EPRD072 WITH DATA FROM ADHOC DELETE.      22650009
212200*-----------------------------------------------------------      22660009
212300 3100-ADHC-DEL-REC.                                               22670089
212400                                                                  22680009
212500     INITIALIZE EP072-PROMO-INTFC-RECORD.                         22690009
212600     MOVE PC-PRICG-STR-GRP-EVENT                                  22700029
212700                             TO EP072-BUSINESS-EVENT-ID.          22710009
212800     MOVE PC-ADHOC-PRC-SETUP-IND                                  22720009
212900                             TO EP072-PRC-SETUP-IND.              22730009
213000                                                                  22740099
213100     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                22750009
213200                             TO EP072-SETUP-STR-GRP-TYP-CDE.      22760009
213300     MOVE XST00031-ADHC-STR-GP-ID                                 22770009
213400                             TO EP072-SETUP-STR-GRP-ID.           22780009
213500     MOVE XST00031-STR-SELN-HIER-CDE                              22790009
213600                             TO EP072-STR-SELN-HIER-CDE.          22800009
213700     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                22810049
213800                             TO EP072-DIST-STR-GRP-TYP-CDE.       22820009
213900     MOVE XST00031-ADHC-STR-GP-ID                                 22830050
214000                             TO EP072-DIST-STR-GRP-ID.            22840009
214010                                                                  22850099
214100     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               22860009
214200     MOVE PC-DELETE-STAT-CDE                                      22870009
214300                             TO EP072-RECORD-ACTION.              22880009
214400     MOVE XST00031-PROMO-INTFC-ID                                 22890009
214500                             TO EP072-PROMO-INTFC-ID.             22900009
214600     MOVE XST00031-MDSE-LNE-ID                                    22910009
214700                             TO EP072-MERCH-LNE-ID.               22920009
214800     MOVE XST00028-PRICG-TYP-CDE                                  22930009
214900                             TO EP072-PRICG-TYP-CDE.              22940009
215000     MOVE PC-MDSE-INCL-BOTH-IND                                   22950009
215100                             TO EP072-MDSE-INC-EXC-IND.           22960009
215200     MOVE XST00031-ACTL-STRT-TMST                                 22970009
215300                             TO EP072-STR-GRP-PROMO-STRT-TMST.    22980009
215400     MOVE XST00031-ACTL-END-TMST                                  22990009
215500                             TO EP072-STR-GRP-PROMO-END-TMST.     23000009
215600     MOVE XST00031-SOR-LAST-UPD-TMST                              23010049
215700                             TO EP072-SOR-LAST-UPD-TMST.          23020009
215710     PERFORM 3200-CALC-LAST-UPD-TMST.                             23030099
215800                                                                  23040009
216500*** WRITE A NIGHTLY RECORD OUT FOR THE DELETE                     23050099
216600     MOVE PC-APPLY-NIGHTLY                                        23060099
216700                             TO EP072-APPLY-IND.                  23070099
216800     PERFORM 4000-WRITE-NIGHT-APPLY-REC.                          23080099
216900     ADD 1 TO PC-CNT-ADHOC-RECS.                                  23090099
217000                                                                  23100099
217100*3100-EXIT.                                                       23110009
217200 EJECT.                                                           23120009
217300                                                                  23130009
217400*-----------------------------------------------------------      23140009
217500* 3110-ADHC-ADD-REC.                                              23150089
217600*     POPULATE COPYBOOK EPRD072 WITH DATA FROM ADHOC CURSOR.      23160009
217700*-----------------------------------------------------------      23170009
217800 3110-ADHC-ADD-REC.                                               23180089
217900                                                                  23190009
218000     INITIALIZE EP072-PROMO-INTFC-RECORD.                         23200009
218100     MOVE PC-PRICG-STR-GRP-EVENT                                  23210029
218200                             TO EP072-BUSINESS-EVENT-ID.          23220009
218300     MOVE PC-ADHOC-PRC-SETUP-IND                                  23230009
218400                             TO EP072-PRC-SETUP-IND.              23240009
218500     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                23250009
218600                             TO EP072-SETUP-STR-GRP-TYP-CDE.      23260009
218700     MOVE XST00031-ADHC-STR-GP-ID                                 23270009
218800                             TO EP072-SETUP-STR-GRP-ID.           23280009
218900     MOVE XST00031-STR-SELN-HIER-CDE                              23290009
219000                             TO EP072-STR-SELN-HIER-CDE.          23300009
219100     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                23310049
219200                             TO EP072-DIST-STR-GRP-TYP-CDE.       23320009
219300     MOVE XST00031-ADHC-STR-GP-ID                                 23330049
219400                             TO EP072-DIST-STR-GRP-ID.            23340009
219500     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               23350009
219600                                                                  23360033
219700     MOVE XST00031-ACTL-STRT-TMST                                 23370064
219800                             TO PV-ACTL-STRT-TMST.                23380064
219900     MOVE XST00031-ACTL-END-TMST                                  23390064
220000                             TO PV-ACTL-END-TMST.                 23400064
220100                                                                  23410064
220200     IF (PV-ACTL-STRT-TMST-DATE > EP128-CC-CRITICAL-DTE           23420064
220300       AND PV-ACTL-STRT-TMST-DATE < EP113-CC-CRNT-DTE)            23430064
220400         MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND               23440064
221000     END-IF.                                                      23450064
221100                                                                  23460033
221200     MOVE PC-ADD-STAT-CDE    TO EP072-RECORD-ACTION               23470049
221300     MOVE XST00031-PROMO-INTFC-ID                                 23480009
221400                             TO EP072-PROMO-INTFC-ID.             23490009
221500     MOVE XST00031-MDSE-LNE-ID                                    23500009
221600                             TO EP072-MERCH-LNE-ID.               23510009
221700     MOVE XST00028-PRICG-TYP-CDE                                  23520009
221800                             TO EP072-PRICG-TYP-CDE.              23530009
221900     MOVE PC-MDSE-INCL-BOTH-IND                                   23540009
222000                             TO EP072-MDSE-INC-EXC-IND.           23550009
222100     MOVE XST00031-ACTL-STRT-TMST                                 23560009
222200                             TO EP072-STR-GRP-PROMO-STRT-TMST.    23570009
222300     MOVE XST00031-ACTL-END-TMST                                  23580009
222400                             TO EP072-STR-GRP-PROMO-END-TMST.     23590009
222500     MOVE XST00031-SOR-LAST-UPD-TMST                              23600049
222600                             TO EP072-SOR-LAST-UPD-TMST.          23610009
222700                                                                  23620009
222800     IF EP072-APPLY-NIGHTLY                                       23630009
222900       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         23640089
223000       ADD 1 TO PC-CNT-ADHOC-RECS                                 23650059
223100     ELSE                                                         23660009
223300       MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND                 23670009
223400       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         23680089
223500       ADD 1 TO PC-CNT-ADHOC-RECS                                 23690059
223600     END-IF.                                                      23700009
223700                                                                  23710009
223800*3110-EXIT.                                                       23720009
223900 EJECT.                                                           23730009
224000                                                                  23740009
224100*-----------------------------------------------------------      23750009
224200* 3120-ADHOC-PRNT-REC.                                            23760089
224300*     POPULATE COPYBOOK EPRD072 WITH DATA FROM ADHOC CURSOR.      23770009
224400*-----------------------------------------------------------      23780009
224500 3120-ADHOC-PRNT-REC.                                             23790089
224600                                                                  23800009
224700     INITIALIZE EP072-PROMO-INTFC-RECORD.                         23810009
224800     MOVE PC-PRICG-STR-GRP-EVENT                                  23820029
224900                             TO EP072-BUSINESS-EVENT-ID.          23830009
225000     MOVE PC-ADHOC-PRC-SETUP-IND                                  23840009
225100                             TO EP072-PRC-SETUP-IND.              23850009
225200     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                23860049
225300                             TO EP072-SETUP-STR-GRP-TYP-CDE.      23870009
225400     MOVE PRNT-ADHOC-ADHC-STR-GP-ID                               23880049
225500                             TO EP072-SETUP-STR-GRP-ID.           23890009
225600     MOVE XST00029-STR-SELN-HIER-CDE                              23900052
225700                             TO EP072-STR-SELN-HIER-CDE.          23910009
225800     MOVE XST00029-STR-GP-TYP-CDE                                 23920052
225900                             TO EP072-DIST-STR-GRP-TYP-CDE.       23930009
226000     MOVE XST00029-STR-GP-ID                                      23940052
226100                             TO EP072-DIST-STR-GRP-ID.            23950009
226200     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               23960009
226300                                                                  23970009
226400     IF (PV-PRNT-ADHOC-ACTL-STRT-DATE > EP128-CC-CRITICAL-DTE     23980068
226500       AND PV-PRNT-ADHOC-ACTL-STRT-DATE < EP113-CC-CRNT-DTE)      23990068
226600         MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND               24000033
227100     END-IF.                                                      24010033
227200                                                                  24020033
227300     MOVE PC-ADD-STAT-CDE    TO EP072-RECORD-ACTION.              24030052
227400     MOVE XST00029-PROMO-INTFC-ID                                 24040052
227500                             TO EP072-PROMO-INTFC-ID.             24050009
227600     MOVE XST00029-MDSE-LNE-ID                                    24060052
227700                             TO EP072-MERCH-LNE-ID.               24070009
227800     MOVE XST00028-PRICG-TYP-CDE                                  24080009
227900                             TO EP072-PRICG-TYP-CDE.              24090009
228000     MOVE PC-MDSE-INCL-BOTH-IND                                   24100009
228100                             TO EP072-MDSE-INC-EXC-IND.           24110009
228200     MOVE PRNT-ADHOC-ACTL-STRT-TMST                               24120052
228300                             TO EP072-STR-GRP-PROMO-STRT-TMST.    24130009
228400     MOVE PRNT-ADHOC-ACTL-END-TMST                                24140052
228500                             TO EP072-STR-GRP-PROMO-END-TMST.     24150009
228600     MOVE PRNT-ADHOC-SOR-LAST-UPD-TMST                            24160049
228700                             TO EP072-SOR-LAST-UPD-TMST.          24170009
228800                                                                  24180009
228900     IF EP072-APPLY-NIGHTLY                                       24190009
229000       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         24200089
229100       ADD 1 TO PC-CNT-ADHOC-RECS                                 24210059
229200     ELSE                                                         24220009
229400       MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND                 24230009
229500       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         24240089
229600       ADD 1 TO PC-CNT-ADHOC-RECS                                 24250059
229700     END-IF.                                                      24260009
229800                                                                  24270009
229900*3120-EXIT.                                                       24280009
230000 EJECT.                                                           24290009
230100                                                                  24300009
230200*-----------------------------------------------------------      24310009
230300* 3130-ADHC-OVRRDE-OUTPUT.                                        24320089
230400*     POPULATE COPYBOOK EPRD072.                                  24330009
230500*-----------------------------------------------------------      24340009
230600 3130-ADHC-OVRRDE-OUTPUT.                                         24350089
230700                                                                  24360009
230800     INITIALIZE EP072-PROMO-INTFC-RECORD.                         24370009
230900     MOVE PC-PRICG-BUS-EVENT                                      24380026
231000                             TO EP072-BUSINESS-EVENT-ID.          24390009
231100     MOVE PC-ADHOC-PRC-SETUP-IND                                  24400050
231200                             TO EP072-PRC-SETUP-IND.              24410050
231300     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                24420050
231400                             TO EP072-SETUP-STR-GRP-TYP-CDE.      24430050
231500     MOVE PRNT-ADHOC-ADHC-STR-GP-ID                               24440050
231600                             TO EP072-SETUP-STR-GRP-ID.           24450050
231700     MOVE XST00031-STR-SELN-HIER-CDE                              24460050
231800                             TO EP072-STR-SELN-HIER-CDE.          24470050
231900     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                24480050
232000                             TO EP072-DIST-STR-GRP-TYP-CDE.       24490050
232100     MOVE XST00031-ADHC-STR-GP-ID                                 24500050
232200                             TO EP072-DIST-STR-GRP-ID.            24510050
232300     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               24520009
232400     MOVE XST00031-ACTL-STRT-TMST                                 24530050
232500                             TO PV-ACTL-STRT-TMST.                24540009
232600                                                                  24550058
233000       IF PV-ACTL-STRT-TMST-DATE < EP113-CC-CRNT-DTE              24560064
233100         MOVE PC-APPLY-NIGHTLY    TO EP072-APPLY-IND              24570058
233300     END-IF.                                                      24580058
233400                                                                  24590058
233500     MOVE PC-ADD-STAT-CDE    TO EP072-RECORD-ACTION.              24600009
233600     MOVE XST00031-PROMO-INTFC-ID                                 24610050
233700                             TO EP072-PROMO-INTFC-ID.             24620009
233800     MOVE XST00031-MDSE-LNE-ID                                    24630050
233900                             TO EP072-MERCH-LNE-ID.               24640009
234000     MOVE XST00028-PRICG-TYP-CDE                                  24650009
234100                             TO EP072-PRICG-TYP-CDE.              24660009
234200     MOVE PC-MDSE-INCL-BOTH-IND                                   24670026
234300                             TO EP072-MDSE-INC-EXC-IND.           24680009
234400     MOVE XST00031-ACTL-STRT-TMST                                 24690050
234500                             TO EP072-STR-GRP-PROMO-STRT-TMST.    24700009
234600     MOVE XST00031-ACTL-END-TMST                                  24710050
234700                             TO EP072-STR-GRP-PROMO-END-TMST.     24720009
234800     MOVE XST00031-SOR-LAST-UPD-TMST                              24730050
234900                             TO EP072-SOR-LAST-UPD-TMST.          24740009
235000                                                                  24750009
235100     IF EP072-APPLY-NIGHTLY                                       24760009
235200       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         24770089
235300       ADD 1 TO PC-CNT-OVRRDE-RECS                                24780059
235400     ELSE                                                         24790009
235600       MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND                 24800009
235700       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         24810089
235800       ADD 1 TO PC-CNT-OVRRDE-RECS                                24820059
235900     END-IF.                                                      24830009
236000                                                                  24840009
236100*3130-EXIT.                                                       24850050
236200 EJECT.                                                           24860009
236201                                                                  24870099
236202*-----------------------------------------------------------      24880009
236203* 3200-CALC-LAST-UPD-TMST.                                        24890089
236204*     CALCULATE LAST-UPD-TMST FOR CREATED DELETE RECORDS.         24900009
236205*-----------------------------------------------------------      24910009
236206 3200-CALC-LAST-UPD-TMST.                                         24920089
236207                                                                  24930009
236208     INITIALIZE PV-HOLD-TMST                                      24940099
236209                PV-FORMAT-TMST.                                   24950099
236210                                                                  24960099
236220     MOVE EP072-SOR-LAST-UPD-TMST                                 24970099
236230                              TO PV-HOLD-TMST.                    24980099
236240                                                                  24990099
236250     MOVE PC-DASH             TO PV-FORMAT-TMST-DASH.             25000099
236260     MOVE PC-PERIOD           TO PV-FORMAT-TMST-TM-D1             25010099
236270                                 PV-FORMAT-TMST-TM-D2             25020099
236280                                 PV-FORMAT-TMST-TM-D3.            25030099
236290                                                                  25040099
236300     IF PV-HOLD-TMST-TM-NN-NUM > ZERO                             25050099
236400        COMPUTE PV-FORMAT-TMST-TM-NN-NUM =                        25060099
236500              (PV-HOLD-TMST-TM-NN-NUM - 1)                        25070099
236600        MOVE PV-HOLD-TMST-TM-SS TO PV-FORMAT-TMST-TM-SS           25080099
236700        MOVE PV-HOLD-TMST-TM-MM TO PV-FORMAT-TMST-TM-MM           25090099
236800        MOVE PV-HOLD-TMST-TM-HH TO PV-FORMAT-TMST-TM-HH           25100099
236900        MOVE PV-HOLD-TMST-DTE TO PV-FORMAT-TMST-DTE               25110099
237000     ELSE                                                         25120099
237100        IF PV-HOLD-TMST-TM-SS-NUM > ZERO                          25130099
237200           COMPUTE PV-FORMAT-TMST-TM-SS-NUM =                     25140099
237300                 (PV-HOLD-TMST-TM-SS-NUM - 1)                     25150099
237400           MOVE PC-9S TO PV-FORMAT-TMST-TM-NN                     25160099
237500           MOVE PV-HOLD-TMST-TM-HH TO PV-FORMAT-TMST-TM-HH        25170099
237600           MOVE PV-HOLD-TMST-TM-MM TO PV-FORMAT-TMST-TM-MM        25180099
237700           MOVE PV-HOLD-TMST-DTE   TO PV-FORMAT-TMST-DTE          25190099
237800        ELSE                                                      25200099
237900           IF PV-HOLD-TMST-TM-MM-NUM > ZERO                       25210099
238000              COMPUTE PV-FORMAT-TMST-TM-MM-NUM =                  25220099
238100                    (PV-HOLD-TMST-TM-MM-NUM - 1)                  25230099
238200              MOVE PC-9S TO PV-FORMAT-TMST-TM-NN                  25240099
238300              MOVE PC-59 TO PV-FORMAT-TMST-TM-SS                  25250099
238400              MOVE PV-HOLD-TMST-TM-HH TO PV-FORMAT-TMST-TM-HH     25260099
238500              MOVE PV-HOLD-TMST-DTE   TO PV-FORMAT-TMST-DTE       25270099
238600           ELSE                                                   25280099
238700               IF PV-HOLD-TMST-TM-HH-NUM > ZERO                   25290099
238800                  COMPUTE PV-FORMAT-TMST-TM-HH-NUM =              25300099
238900                       (PV-HOLD-TMST-TM-HH-NUM - 1)               25310099
239000                  MOVE PC-9S TO PV-FORMAT-TMST-TM-NN              25320099
239100                  MOVE PC-59 TO PV-FORMAT-TMST-TM-SS              25330099
239200                                PV-FORMAT-TMST-TM-MM              25340099
239300                  MOVE PV-HOLD-TMST-DTE TO                        25350099
239400                                        PV-FORMAT-TMST-DTE        25360099
239500               ELSE                                               25370099
239600                   PERFORM 6110-DATE-ROUTINE-FOR-TMST             25380099
239700                   MOVE PC-9S TO PV-FORMAT-TMST-TM-NN             25390099
239800                   MOVE PC-59 TO PV-FORMAT-TMST-TM-SS             25400099
239900                                 PV-FORMAT-TMST-TM-MM             25410099
240000                   MOVE PC-11 TO PV-FORMAT-TMST-TM-HH             25420099
240100               END-IF                                             25430099
240200           END-IF                                                 25440099
240300        END-IF                                                    25450099
240400     END-IF.                                                      25460099
240500                                                                  25470099
240600     MOVE PV-FORMAT-TMST TO EP072-SOR-LAST-UPD-TMST.              25480099
240601                                                                  25490099
240602*3200-EXIT.                                                       25500050
240603 EJECT.                                                           25510009
240604                                                                  25520099
240605*----------------------------------------------------------       25530009
240606* 4000-WRITE-NIGHT-APPLY-REC.                                     25540089
240607*     WRITES THE PROMO FULL FILE RECORD TO THE FULL FILE          25550009
240608*----------------------------------------------------------       25560009
240609 4000-WRITE-NIGHT-APPLY-REC.                                      25570089
240610                                                                  25580009
240611     WRITE PROMO-NIGHT-RECORD FROM EP072-PROMO-INTFC-RECORD.      25590009
240612                                                                  25600009
240613     ADD 1           TO PC-CNT-NIGHT-RECS                         25610009
240614                        PC-CNT-ALL-RECS.                          25620009
240615                                                                  25630009
240616*4000-EXIT.                                                       25640009
240617 EJECT.                                                           25650009
240618                                                                  25660099
240619*----------------------------------------------------------       25670006
240620* DATE ROUTINE TO SET UP THE PROCESS DATE IN                      25680006
240621* CCYYMMDD FORMAT.                                                25690006
240622*----------------------------------------------------------       25700006
240623 6100-DATE-ROUTINE.                                               25710006
240624                                                                  25720006
240625     INITIALIZE DPG51 DPG52 DPG53                                 25730006
240626                DPG54 DPG55 DPG56.                                25740006
240627                                                                  25750006
240628     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      25760006
240629     SET DPG51-INCREMENT-DATE       TO TRUE.                      25770006
240630     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      25780006
240631     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9.    25790006
240632     MOVE EP111-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    25800006
240633                                                                  25810006
240634     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    25820006
240700                                             DPG54 DPG55 DPG56.   25830006
240800                                                                  25840006
240900     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  25850006
241000       DISPLAY '** ABEND **'                                      25860006
241100       DISPLAY '** PROGRAM = EPKUT350'                            25870008
241200       DISPLAY 'DATE = ' EP111-CC-CRNT-DTE                        25880006
241300       DISPLAY DPG54-ERROR-MESSAGE                                25890006
241400       MOVE 4019 TO PV-ABEND-CODE                                 25900006
241500       CALL 'ILBOABN0' USING PV-ABEND-CODE                        25910006
241600     END-IF.                                                      25920006
241700                                                                  25930006
241800     MOVE DPG55-DB2-ISO-DATE-FMT     TO EP111-CC-DATE-PLUS1.      25940006
241900                                                                  25950006
242000     INITIALIZE DPG51 DPG52 DPG53                                 25960006
242100                DPG54 DPG55 DPG56.                                25970006
242200                                                                  25980006
242300     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      25990006
242400     SET DPG51-DECREMENT-DATE       TO TRUE.                      26000006
242500     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      26010006
242600     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9.    26020006
242700     MOVE EP113-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    26030006
242800                                                                  26040006
242900     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    26050006
243000                                             DPG54 DPG55 DPG56.   26060006
243100                                                                  26070006
243200     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  26080006
243300       DISPLAY '** ABEND **'                                      26090006
243400       DISPLAY '** PROGRAM = EPKUT350'                            26100008
243500       DISPLAY 'DATE = ' EP111-CC-CRNT-DTE                        26110006
243600       DISPLAY DPG54-ERROR-MESSAGE                                26120006
243700       MOVE 4019 TO PV-ABEND-CODE                                 26130006
243800       CALL 'ILBOABN0' USING PV-ABEND-CODE                        26140006
243900     END-IF.                                                      26150006
244000                                                                  26160006
244100     MOVE DPG55-DB2-ISO-DATE-FMT    TO EP113-CC-CRNT-DTE-MINUS1.  26170006
244200                                                                  26180006
244300*6100-EXIT.                                                       26190006
244400 EJECT.                                                           26200006
244500                                                                  26210006
244501*----------------------------------------------------------       26220099
244502* DATE ROUTINE TO SUBTRACT 1 DAY FROM LAST UPD TMST.              26230006
244503*----------------------------------------------------------       26240006
244504 6110-DATE-ROUTINE-FOR-TMST.                                      26250006
244505                                                                  26260006
244506     INITIALIZE DPG51 DPG52 DPG53                                 26270006
244507                DPG54 DPG55 DPG56.                                26280006
244508                                                                  26290006
244509     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      26300006
244510     SET DPG51-DECREMENT-DATE       TO TRUE.                      26310006
244511     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      26320006
244512     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9.    26330006
244513     MOVE PV-HOLD-TMST-DTE          TO DPG52-DB2-ISO-DATE-FMT.    26340006
244514                                                                  26350006
244515     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    26360006
244516                                             DPG54 DPG55 DPG56.   26370006
244517                                                                  26380006
244518     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  26390006
244519       DISPLAY '** ABEND **'                                      26400006
244520       DISPLAY '** PROGRAM = EPKUT350'                            26410008
244521       DISPLAY 'DATE = ' EP072-SOR-LAST-UPD-TMST                  26420006
244522       DISPLAY DPG54-ERROR-MESSAGE                                26430006
244523       MOVE 4019 TO PV-ABEND-CODE                                 26440006
244524       CALL 'ILBOABN0' USING PV-ABEND-CODE                        26450006
244525     END-IF.                                                      26460006
244526                                                                  26470006
244527     MOVE DPG55-DB2-ISO-DATE-FMT    TO PV-FORMAT-TMST-DTE.        26480006
244528                                                                  26490006
244529*6110-EXIT.                                                       26500006
244530 EJECT.                                                           26510006
244540                                                                  26520006
244600*----------------------------------------------------------       26530006
244700* 9900-SQL-ABEND-ROUTINE.                                         26540006
244800*     SQL ABEND ROUTINE.                                          26550006
244900*----------------------------------------------------------       26560006
245000 9900-SQL-ABEND-ROUTINE.                                          26570006
245100                                                                  26580006
245200     DISPLAY '** ABEND     **'.                                   26590006
245300     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        26600006
245400     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              26610006
245500     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               26620006
245600                                                                  26630006
245700     COPY DPPD004.                                                26640006
245800     SET ABEND-4013-DB2-ERROR TO TRUE.                            26650006
245900     CALL 'ILBOABN0' USING ABEND-CODE.                            26660006
246000                                                                  26670006
246100*9900-EXIT.                                                       26680006
246200 EJECT.                                                           26690006
246300                                                                  26700006
246400*----------------------------------------------------------       26710006
246500* 9999-WRAPUP.                                                    26720006
246600*     END OF PROGRAM ROUTINE.  CLOSES ALL FILES AND DISPLAYS      26730006
246700*     ANY DATA FROM THE PROGRAM.                                  26740006
246800*----------------------------------------------------------       26750006
246900 9999-WRAPUP.                                                     26760006
247000                                                                  26770006
247800     CLOSE CONTROL-CARD-CURR-PRICG-DTE                            26780006
247900           CONTROL-CARD-FUTRE-CORR-DTE                            26790006
247910           CONTROL-CARD-PGM-CURR-TMST                             26800099
248000           CONTROL-CARD-PGM-LAST-RUN-TMST                         26810006
248100           CONTROL-CARD-CRIT-EFF-DTE                              26820006
248200           PROMO-NIGHT-FILE.                                      26830006
248400                                                                  26840006
248500     DISPLAY ' '.                                                 26850006
248600     DISPLAY '*********************************************'.     26860006
248700     DISPLAY 'PROGRAM NAME: ' PC-CURRENT-PROGRAM-NAME.            26870006
248800     DISPLAY '*********************************************'.     26880006
248900     DISPLAY 'NUMBER OF NIGHT RECS WRITTEN: ' PC-CNT-NIGHT-RECS.  26890006
249100     DISPLAY 'NUMBER OF RECS FROM RMS QUERY: ' PC-CNT-RMS-RECS.   26900009
249200     DISPLAY 'NUMBER OF RECS FROM ADHC QUERY: ' PC-CNT-ADHOC-RECS.26910006
249300     DISPLAY 'NUMBER OF RECS FROM OVRD QUERY:' PC-CNT-OVRRDE-RECS.26920009
249400     DISPLAY 'ALL RECS WRITTEN: ' PC-CNT-ALL-RECS.                26930006
249500     DISPLAY '*********************************************'.     26940006
249600                                                                  26950006
249700*9999-EXIT.                                                       26960006
249800 EJECT.                                                           26970006
249900                                                                  26980006
