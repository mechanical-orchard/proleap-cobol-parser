000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400*                                                                 00040000
000500 PROGRAM-ID.    FSKRP120.                                         00050000
000600 AUTHOR.        LINDA FRIESS.                                     00060000
000700 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00070000
000800 DATE-WRITTEN.  03-17-2003.                                       00080000
000900 DATE-COMPILED.                                                   00090000
001000*                                                                 00100000
001100******************************************************************00110000
001200*       FSKRP120 - DAILY ADJUSTMENT & RECEIPT AUDIT REPORT       *00120000
001300******************************************************************00130000
001400*                                                                 00140000
001500*   THIS PROGRAM WILL PRINT A COMBINED AUDIT REPORT FOR ALL       00150000
001600*   ADJUSTMENTS AND RECEIPTS ON A GIVEN DAY.  THE REPORT WILL     00160000
001700*   BREAK ON DEPARTMENT AND MAJOR CLASS.                          00170000
001800*                                                                 00180000
001900******************************************************************00190000
002000*  CHANGE MADE: STORE NUMBER EXPANSION PROJECT.                  *00200038
002100*  REMOVE TRANSACTION TYPES 141 AND 142 (INVENTORY TYPES).       *00210038
002200*      MADE BY:  MARIA KLAMIK                                    *00220038
002300*         DATE:  04/19/2004               WR# 26355              *00230038
002400******************************************************************00240046
RONNA *  CHANGE MADE: ADD BATCH RANGE FOR 801 THROUGH 831              *00250046
RONNA *               FOR OMS CENTRAL STOCK                            *00260046
RONNA *      MADE BY:  RONNA MCDONALD                                  *00270045
RONNA *         DATE:  03/20/2013               WR# 41224               00280047
RONNA ******************************************************************00290046
OCFSFS* 08/27/13 - RACHEL GRAMANN               CHG# CHG0060713         00300054
OCFSFS*    - OCF SHIP FROM STORE PROJECT TO FEED MERCHANDISE CHANGES TO 00310050
OCFSFS*      FASHION SALES                                              00320050
OCFSFS***************************************************************** 00330050
111890* 05/21/2015 CHANGED BY:  JIM HUNTER        CHG0111890            00340063
111890* DESCRIPTION: CHANGED FOR RFID PROJECT.  RFID COUNTS WILL NOW    00350056
111890*              PASS 'RFID' IN THE BATCH NUMBER.  USA COUNTS       00360056
111890*              WILL CONTINUE TO PASS '9988' IN THE BATCH NUMBER.  00370056
111890*              THE FASHION REPORT PROGRAMS CAN NOW DISTINGUISH    00380056
111890*              RFID COUNTS FROM USA COUNTS.                       00390056
164325***************************************************************** 00400057
164325* 05/12/2017 CHANGED BY:  BARB SCHULTZ      CHG0164325            00410057
164325* DESCRIPTION: ADDED 'MISLOAD TSFR' BATCH TO THE PROGRAM FOR THE  00420058
164325*              STORE RECEIVING PROJECT.                           00430058
164325***************************************************************** 00440057
GIV2FS*  10/16/17 - JIM HUNTER   CHG0180589 (FIND GIV2FS)               00450063
GIV2FS*             CHANGED TO ALLOW FASHION TO ACCEPT UPDATES FROM GIV.00460059
GIV2FS*             GIV ADJUSTMENTS WILL BE DISTINGUISHED FROM OTHER    00470059
GIV2FS*             ADJUSTMENTS BY THE BATCH NUMBER WHICH WILL CONTAIN  00480059
GIV2FS*             'GIV'.                                              00490059
005940******************************************************************00500059
0518  *  05/13/18 - JIM ARENDT   CHG0199002 (FIND 0518)                 00510066
0518  *  CHANGE MADE: ADDED CODE FOR THE BOSS PROJECT TO READ THE       00520066
0518  *               TKRPRPM TABLE 'BSSRCV' TO RETRIEVE THE BOSS       00530066
0518  *               RECEIVER.  IF THE RECEIVER NUMBER EQUALS THE BOSS 00540066
0518  *               PARM, DISPLAY 'BSS' IN THE RECEIVER FIELD.        00550066
0518  *               CHANGES DENOTED BY '0518' IN COL 1-4.             00560066
002600******************************************************************00570066
002500 ENVIRONMENT DIVISION.                                            00580000
002600******************************************************************00590000
002700 CONFIGURATION SECTION.                                           00600000
002800******************************************************************00610000
002900 SOURCE-COMPUTER.    IBM-3090.                                    00620000
003000 OBJECT-COMPUTER.    IBM-3090.                                    00630000
003100******************************************************************00640000
003200 INPUT-OUTPUT SECTION.                                            00650000
003300******************************************************************00660000
003400 FILE-CONTROL.                                                    00670000
003500******************************************************************00680000
003600*                                                                 00690000
003700     SELECT CONTROL-FILE   ASSIGN TO INP01.                       00700000
003800*                                                                 00710000
008300     SELECT PRINT-REPORT   ASSIGN TO OUT01.                       00720000
008400*                                                                 00730000
008500******************************************************************00740000
008600 DATA DIVISION.                                                   00750000
009200***************************************************************** 00760000
009300*                                                                 00770000
009400 FILE SECTION.                                                    00780000
009500*                                                                 00790000
009600 FD  CONTROL-FILE                                                 00800000
009700     RECORDING MODE IS F                                          00810000
009800     DATA RECORD IS CONTROL-RECORD.                               00820000
009900                                                                  00830000
010000 01  CONTROL-RECORD                    PIC X(80).                 00840000
010100*                                                                 00850000
010200*                                                                 00860000
011000 FD  PRINT-REPORT                                                 00870000
011100     LABEL RECORDS ARE STANDARD                                   00880000
011200     RECORDING MODE IS F                                          00890000
011300     RECORD CONTAINS 132 CHARACTERS                               00900000
011400     BLOCK CONTAINS 0 RECORDS.                                    00910000
011500                                                                  00920000
011600 01  PRINT-LINE                       PIC X(132).                 00930000
011700*                                                                 00940000
011800******************************************************************00950000
011900 WORKING-STORAGE SECTION.                                         00960000
012000*                                                                 00970000
012700 01  CONTROL-DATA-IN.                                             00980000
012800     05  CTL-PROCESSING-DATE           PIC X(10).                 00990000
013500     05  FILLER                        PIC X(70).                 01000000
013600*                                                                 01010000
014200******************************************************            01020000
014300** STANDARD HEADER LINE - KOHLS 132 COL                           01030000
014400******************************************************            01040000
014500     COPY DPWS132.                                                01050000
014600*                                                                 01060000
014700 01  HEADING-LINE-2.                                              01070000
015300     05  FILLER                       PIC X(57)  VALUE SPACES.    01080000
015400     05  FILLER                       PIC X(17)  VALUE            01090000
015500         'SKU ON HAND AUDIT'.                                     01100000
015600     05  FILLER                       PIC X(58)  VALUE SPACES.    01110000
015700*                                                                 01120000
015800 01  HEADING-LINE-3.                                              01130000
015900     05  FILLER                       PIC X(02)  VALUE SPACES.    01140000
016000     05  FILLER                       PIC X(06)  VALUE 'DEPT: '.  01150000
016100     05  HL3-DEPT                     PIC ZZZ9.                   01160000
016200     05  FILLER                       PIC X(02)  VALUE SPACES.    01170000
016300     05  FILLER                       PIC X(13)  VALUE            01180000
016400                                                 'MAJOR CLASS: '. 01190000
016500     05  HL3-MAJOR-CLASS              PIC ZZZ9.                   01200000
016600     05  FILLER                       PIC X(02)  VALUE SPACES.    01210000
016601     05  FILLER                       PIC X(10)  VALUE            01220000
016602                                                 'SUBCLASS: '.    01230000
016700     05  HL3-SUBCLASS                 PIC ZZZ9.                   01240000
016800     05  FILLER                       PIC X(85)  VALUE SPACES.    01250000
017210*                                                                 01260000
017400 01  HEADING-LINE-4.                                              01270000
017500     05  FILLER                       PIC X(05)  VALUE SPACES.    01280000
017700     05  FILLER                       PIC X(03)  VALUE 'SKU'.     01290000
017800     05  FILLER                       PIC X(66)  VALUE SPACES.    01300000
OCFSFS     05  FILLER                       PIC X(19)  VALUE            01310051
OCFSFS         '  BATCH       BATCH'.                                   01320051
OCFSFS     05  FILLER                       PIC X(39)  VALUE SPACES.    01330051
018100*                                                                 01340000
018200 01  HEADING-LINE-5.                                              01350000
018300     05  FILLER                       PIC X(04)  VALUE SPACES.    01360000
018400     05  FILLER                       PIC X(48)  VALUE            01370000
018700         'NUMBER     STORE    ORDER NUMBER    UPDATE TYPE '.      01380000
OCFSFS     05  FILLER                       PIC X(45)  VALUE            01390051
OCFSFS         'FIELD      QTY   ACT      NO     DESCRIPTION'.          01400051
OCFSFS     05  FILLER                       PIC X(35)  VALUE SPACES.    01410051
019700*                                                                 01420000
019800 01  DETAIL-LINE-1.                                               01430000
019900     05  FILLER                       PIC X(03)  VALUE SPACES.    01440000
020000     05  DL1-SKU-NBR                  PIC ZZZZZZZ9.               01450000
020100     05  FILLER                       PIC X(04)  VALUE SPACES.    01460039
020200     05  DL1-STORE-NBR                PIC ZZZZ9.                  01470039
020300     05  FILLER                       PIC X(03)  VALUE SPACES.    01480068
020301     05  DL1-ORDER                    PIC X(13).                  01490068
020302     05  FILLER REDEFINES DL1-ORDER.                              01500000
020400         10  DL1-ORDER-NBR            PIC 9(09).                  01510068
020500         10  DL1-DASH                 PIC X(01).                  01520000
020501         10  DL1-RCVR-NBR             PIC 9(03).                  01530000
0518           10  DL1-RCVR-NBR-X REDEFINES DL1-RCVR-NBR                01540063
0518                                        PIC X(03).                  01550063
020502     05  FILLER                       PIC X(04)  VALUE SPACES.    01560000
020600     05  DL1-TYPE-CODE                PIC X(03).                  01570000
020700     05  FILLER                       PIC X(01)  VALUE SPACES.    01580000
OCFSFS     05  DL1-TYPE-DESC                PIC X(14).                  01590051
020800     05  DL1-QTY                      PIC -------9.               01600000
020900     05  FILLER                       PIC X(04)  VALUE SPACES.    01610000
021000     05  DL1-ACTION                   PIC X(01)  VALUE SPACES.    01620000
021100     05  FILLER                       PIC X(06)  VALUE SPACES.    01630000
021200     05  DL1-BATCH                    PIC X(04).                  01640000
021300     05  FILLER                       PIC X(04)  VALUE SPACES.    01650000
021400     05  DL1-BATCH-DESC               PIC X(22).                  01660000
OCFSFS     05  FILLER                       PIC X(28)  VALUE SPACES.    01670051
022700*                                                                 01680000
027600*                                                                 01690000
027700 01  BLANK-LINE.                                                  01700000
027800     05  FILLER                       PIC X(132) VALUE SPACES.    01710000
027900*                                                                 01720000
028000 01  END-OF-REPORT-LINE.                                          01730000
028100     05  FILLER                       PIC X(25)      VALUE        01740000
028200         ' ** END OF REPORT **     '.                             01750000
028300*                                                                 01760000
028400*                                                                 01770000
028500 01  PROGRAM-SWITCHES.                                            01780000
028600     05  PS-EOF-CONTROL-FILE         PIC  X(01)    VALUE 'N'.     01790000
028700         88  EOF-CONTROL-FILE                      VALUE 'Y'.     01800000
028800     05  PS-EOF-ADJ-RCPT-CURSOR      PIC  X(01)    VALUE 'N'.     01810000
028900         88  EOF-ADJ-RCPT-CURSOR                   VALUE 'Y'.     01820000
028901     05  PS-FIRST-TIME-THRU          PIC  X(01)    VALUE 'Y'.     01830000
028902         88  FIRST-TIME-THRU                       VALUE 'Y'.     01840000
031200*                                                                 01850000
031300 01  ABEND-CODE                       PIC S9(04)     VALUE +0     01860000
031400                                                     COMP SYNC.   01870000
031500     88  ABEND-4013                                  VALUE +4013. 01880000
031600*                                                                 01890000
031700 01  PC-CONSTANTS.                                                01900000
031800     05  PC-PROGRAM-NAME             PIC X(08)  VALUE 'FSKRP120'. 01910000
033100     05  PC-1                        PIC S9(03) VALUE +1          01920000
033200                                                COMP-3.           01930000
033300     05  PC-2                        PIC S9(03) VALUE +2          01940000
033400                                                COMP-3.           01950000
033401     05  PC-MAX-LINES                PIC S9(3)  VALUE +56         01960000
033402                                                COMP-3.           01970000
033403*                                                                 01980000
033404 01  PV-PROGRAM-VARIABLES.                                        01990000
046200     05  PV-PREV-DEPT                PIC 9(04).                   02000000
046201     05  PV-PREV-MAJ-CL              PIC 9(04).                   02010000
046202     05  PV-PREV-SUB-CL              PIC 9(04).                   02020000
046203     05  PV-RECS-PROCESSED           PIC S9(09) COMP-3 VALUE +0.  02030000
0618       05  PV-BOSS-PROCESSED           PIC S9(09) COMP-3 VALUE +0.  02040070
0518       05  PV-BOSS-PARM-RECV           PIC S9(09) COMP.             02050063
0518       05  PV-BOSS-PARM-DISP           PIC --------9.               02060069
046204     05  PV-DISP-RECS-PROC           PIC ZZZ,ZZZ,ZZ9.             02070000
046202     05  PV-BATCH-NBR-ALPHA          PIC X(04) VALUE ZEROS        02080000
                                                     JUST RIGHT.        02090000
046202     05  PV-BATCH-NBR-NUMERIC REDEFINES PV-BATCH-NBR-ALPHA        02100000
046202                                     PIC 9(04).                   02110000
046205*                                                                 02120000
046206     05  PV-EVALUATE-TYPE            PIC X(04).                   02130000
084400         88 PV-ONHAND-ADJ            VALUE '121'.                 02140000
084401         88 PV-STORE-RCPTS           VALUE '123'.                 02150000
OCFSFS         88 PV-SFS-ADJ               VALUE '125'.                 02160050
OCFSFS         88 PV-SFS-SALES-ADJ         VALUE '126'.                 02170051
084404         88 PV-ONHAND-DBL-BK         VALUE '143'.                 02180000
084405         88 PV-RECEIPT-TYPE          VALUE '000'.                 02190000
084406*                                                                 02200000
084407     05  PV-EVALUATE-BATCH           PIC 9(04).                   02210000
084408         88 PV-FAST-TRANSFER         VALUES 001 THRU 366.         02220000
164325         88 PV-MISLOAD-TSFR          VALUES 500 THRU 599.         02230057
0518           88 PV-BOSS-REQS             VALUES 601 THRU 699.         02240067
084601         88 PV-CENTRAL-STOCK         VALUES 701 THRU 731.         02250000
084602         88 PV-IN-STR-PRICE-CHG      VALUE  888.                  02260000
084601         88 PV-DATA-ENTRY-TRANSFER   VALUES 901 THRU 997.         02270000
084603         88 PV-USA-COUNTS            VALUE  9988.                 02280000
084604         88 PV-DATA-ENTRY            VALUE  9999.                 02290000
084605         88 PV-RECEIPT               VALUES 9001 THRU 9366.       02300000
RONNA          88 PV-OMS-CENTRAL-STOCK     VALUES 801  THRU 831.        02310045
                                                                        02320000
084407     05  PV-EVALUATE-BATCH-X         PIC X(04) JUST RIGHT.        02330000
084408         88 PV-FAST-TRANSFER-X       VALUES ' 001' THRU ' 366'.   02340000
084409         88 PV-FAST-TRANSFER-X2      VALUES '001 ' THRU '366 '.   02350057
164325         88 PV-MISLOAD-TSFR-X        VALUES ' 500' THRU ' 599'.   02360057
164325         88 PV-MISLOAD-TSFR-X2       VALUES '500 ' THRU '599 '.   02370057
0518           88 PV-BOSS-REQS-X           VALUES ' 601' THRU ' 699'.   02380067
0518           88 PV-BOSS-REQS-X2          VALUES '601 ' THRU '699 '.   02390067
084601         88 PV-CENTRAL-STOCK-X       VALUES ' 701' THRU ' 731'.   02400000
084601         88 PV-CENTRAL-STOCK-X2      VALUES '701 ' THRU '731 '.   02410000
084602         88 PV-IN-STR-PRICE-CHG-X    VALUE  ' 888'.               02420000
084602         88 PV-IN-STR-PRICE-CHG-X2   VALUE  '888 '.               02430000
084601         88 PV-DATA-ENTRY-TRANSFER-X VALUES ' 901' THRU ' 997'.   02440000
084601         88 PV-DATA-ENTRY-TRANSFER-X2 VALUES '901 ' THRU '997 '.  02450000
MK             88 PV-INVENTORY             VALUES 'INV3', 'INOL',       02460041
084608                                            'INAD'.               02470000
MK             88 PV-ECOM                  VALUES 'ECOM'.               02480040
RONNA          88 PV-OMS-CENTRAL-STOCK-X   VALUES ' 801' THRU ' 831'.   02490045
RONNA          88 PV-OMS-CENTRAL-STOCK-X2  VALUES '801 ' THRU '831 '.   02500045
OCFSFS         88 PV-OCF-ADJ               VALUE 'SFS'.                 02510050
111890         88 PV-RFID-ADJ              VALUE 'RFID'.                02520056
GIV2FS         88 PV-GIV-ADJ               VALUE 'GIV'.                 02530059
084609*                                                                 02540045
084609*                                                                 02550000
084610     05  PV-PAGE-CNT                 PIC S9(5)     VALUE +0       02560000
084611                                                   COMP-3.        02570000
084612     05  PV-LINE-CNT                 PIC S9(3)     VALUE +0       02580000
084613                                                   COMP-3.        02590000
084614     05  PV-PARAGRAPH-NAME           PIC X(30)     VALUE SPACES.  02600000
084615     05  PV-DB2-OPER-ATTEMPTED       PIC X(30)     VALUE SPACES.  02610000
084616*                                                                 02620000
084617 01  CD-CPU-DATE                      PIC 9(08).                  02630000
084618 01  FILLER REDEFINES CD-CPU-DATE.                                02640000
084619     05  CD-CPU-YEAR                  PIC 9(04).                  02650000
084620     05  CD-CPU-MON                   PIC 9(02).                  02660000
084621     05  CD-CPU-DAY                   PIC 9(02).                  02670000
084622*                                                                 02680000
084623 01  CT-CPU-TIME.                                                 02690000
084624     05  CT-CPU-HR                    PIC 9(02)     VALUE ZEROS.  02700000
084625     05  CT-CPU-MIN                   PIC 9(02)     VALUE ZEROS.  02710000
084626     05  CT-CPU-SEC                   PIC 9(02)     VALUE ZEROS.  02720000
084627     05  CT-CPU-HSEC                  PIC 9(02)     VALUE ZEROS.  02730000
084628*                                                                 02740000
084629***********************                                           02750000
084630*  DB2 TABLE LAYOUTS  *                                           02760000
084631***********************                                           02770000
084632*                                                                 02780000
084633     EXEC SQL                                                     02790000
084634         INCLUDE TSKXREF                                          02800000
084635     END-EXEC.                                                    02810000
084636*                                                                 02820000
0518       EXEC SQL                                                     02830063
0518           INCLUDE TKRPRPM                                          02840063
0518       END-EXEC.                                                    02850063
0518  *                                                                 02860063
084637**********************************************                    02870000
084638*   ONHAND ADJUSTMENT AUDIT TEMPORARY TABLE                       02880000
084639**********************************************                    02890000
084640     EXEC SQL                                                     02900000
084641         INCLUDE FST00003                                         02910000
084642     END-EXEC.                                                    02920000
084643*                                                                 02930000
084644**********************************************                    02940000
084645*   ONHAND RECEIPTS AUDIT TEMPORARY TABLE                         02950000
084646**********************************************                    02960000
084647     EXEC SQL                                                     02970000
084648         INCLUDE FST00004                                         02980000
084649     END-EXEC.                                                    02990000
084650*                                                                 03000000
084650*                                                                 03010061
084651*                                                                 03020000
084652* DB2 COMMUNICATION AREA                                          03030000
084653*                                                                 03040000
084654     EXEC SQL                                                     03050000
084655         INCLUDE SQLCA                                            03060000
084656     END-EXEC.                                                    03070000
084657*                                                                 03080000
084658* DB2 COMMUNICATION AREA2                                         03090000
084659*                                                                 03100000
084660     COPY SQLCA2.                                                 03110000
084661 EJECT                                                            03120000
084662*                                                                 03130000
084663* CURSOR FOR ADJUSTMENTS & RECEIPTS                               03140000
084664*                                                                 03150000
084665     EXEC SQL                                                     03160000
084666       DECLARE ADJ_RCPT_AUD_CSR CURSOR FOR                        03170000
084667         SELECT A.DEPT_NBR                                        03180000
084668               ,A.MAJ_CL_NBR                                      03190000
084669               ,A.SUB_CL_NBR                                      03200000
084670               ,B.SKU                                             03210000
084680               ,A.LOC_NBR                                         03220000
084690               ,A.ADJ_TYP_CDE                                     03230000
084700               ,A.ACTN_CDE                                        03240000
084800               ,A.ADJ_QTY                                         03250000
084900               ,A.BTCH_NBR                                        03260000
085000               ,0                                                 03270000
085100               ,0                                                 03280000
085200           FROM FSTT_OH_ADJ_AUD A                                 03290000
085300               ,TSKXREF B                                         03300000
085400          WHERE A.ITM_NBR = B.ITM_NBR                             03310000
085500            AND A.PRCG_DTE = :CTL-PROCESSING-DATE                 03320000
085600            AND A.TRN_STAT_CDE = 'C'                              03330000
085700            AND B.SKU_STAT_CDE > '00'                             03340000
085800       UNION ALL                                                  03350000
085900         SELECT C.DEPT_NBR                                        03360000
086000               ,C.MAJ_CL_NBR                                      03370000
086100               ,C.SUB_CL_NBR                                      03380000
086200               ,D.SKU                                             03390000
086300               ,C.LOC_NBR                                         03400000
086400               ,'000'                                             03410000
086500               ,' '                                               03420000
086600               ,C.LOC_RCPT_QTY                                    03430000
086700               ,C.BTCH_NBR                                        03440000
086800               ,C.PO_NBR                                          03450000
086900               ,C.RCVR_NBR                                        03460000
087000           FROM FSTT_OH_RCPT_AUD C                                03470000
087100               ,TSKXREF D                                         03480000
087200          WHERE C.ITM_NBR = D.ITM_NBR                             03490000
087300            AND C.PRCG_DTE = :CTL-PROCESSING-DATE                 03500000
087400            AND C.TRN_STAT_CDE = 'C'                              03510000
087500            AND D.SKU_STAT_CDE > '00'                             03520000
MK              ORDER BY 1,2,3,4,5,10,11                                03530044
087700       WITH UR                                                    03540000
087800       FOR FETCH ONLY                                             03550000
087801     END-EXEC.                                                    03560000
087802*                                                                 03570000
087803*---------------------------------------------------------------* 03580000
087804*   ERROR MESSAGE AREA FOR DB2                                    03590000
087805*---------------------------------------------------------------* 03600000
087806     COPY DPWS004.                                                03610000
087807*                                                                 03620000
087808 EJECT                                                            03630000
087809*                                                                 03640000
087810 LINKAGE SECTION.                                                 03650000
087811***************************************************************** 03660000
087812*PROCEDURE DIVISION.                                              03670000
087813***************************************************************** 03680000
087814 PROCEDURE DIVISION.                                              03690000
087815*                                                                 03700000
087816 A100-MAINLINE-PROCESSING.                                        03710000
087817*                                                                 03720000
087818     PERFORM B100-INITIALIZATION.                                 03730000
087819                                                                  03740000
087820     PERFORM B200-PROCESS-ADJ-RCPT-CURSOR                         03750000
087821             UNTIL EOF-ADJ-RCPT-CURSOR.                           03760000
087822*                                                                 03770000
087823     PERFORM B300-END-ROUTINE.                                    03780000
087824*                                                                 03790000
087825     STOP RUN.                                                    03800000
087826*                                                                 03810000
087827 EJECT                                                            03820000
087828***************************************************************** 03830000
087829*                                                                 03840000
087830*  - GET SYSTEM DATE & TIME AND MOVE TO REPORT HEADER             03850000
087831*  - READ CONTROL CARD WITH PROCESSING DATE                       03860000
087832*  - OPEN CURSOR                                                  03870000
087833*                                                                 03880000
087834***************************************************************** 03890000
087835 B100-INITIALIZATION.                                             03900000
087836*                                                                 03910000
087837     ACCEPT CT-CPU-TIME FROM TIME.                                03920000
087838     ACCEPT CD-CPU-DATE FROM DATE YYYYMMDD.                       03930000
087839*                                                                 03940000
087840     MOVE CT-CPU-HR     TO DP132-RUN-HOUR.                        03950000
087850     MOVE CT-CPU-MIN    TO DP132-RUN-MINUTE.                      03960000
087851*                                                                 03970000
087852     MOVE CD-CPU-MON    TO DP132-RUN-MONTH.                       03980000
087853     MOVE CD-CPU-DAY    TO DP132-RUN-DAY.                         03990000
087854     MOVE CD-CPU-YEAR   TO DP132-RUN-YEAR.                        04000000
087855*                                                                 04010000
087856     MOVE 1  TO DP132-REPORT-NUMBER                               04020000
087857                DP132-PAGE-NUMBER.                                04030000
087858     MOVE PC-PROGRAM-NAME TO DP132-PROGRAM-NAME.                  04040000
087859*                                                                 04050000
087860     OPEN INPUT  CONTROL-FILE                                     04060000
087870          OUTPUT PRINT-REPORT.                                    04070000
087880*                                                                 04080000
087890     PERFORM Z100-READ-CONTROL-FILE.                              04090000
087900*                                                                 04100000
0518       PERFORM C500-GET-BOSS-PARM-RCVR.                             04110069
087900*                                                                 04120069
088000     PERFORM Z200-OPEN-ADJ-RCPT-CURSOR.                           04130000
088001                                                                  04140000
088002 EJECT                                                            04150000
088003***************************************************************** 04160000
088004*                                                                 04170000
088005*  - FETCH ROW FROM CURSOR                                        04180000
088006*  - CHECK FOR BREAKS                                             04190000
088007*  - PRINT DETAIL LINE                                            04200000
088008*                                                                 04210000
088009***************************************************************** 04220000
088010 B200-PROCESS-ADJ-RCPT-CURSOR.                                    04230000
088011*                                                                 04240000
088012     PERFORM C100-FETCH-ADJ-RCPT-CSR.                             04250000
088013*                                                                 04260000
088014     IF EOF-ADJ-RCPT-CURSOR                                       04270000
088015        CONTINUE                                                  04280000
088016     ELSE                                                         04290000
088017        IF FIRST-TIME-THRU                                        04300000
088018           PERFORM C200-DEPT-MCL-BREAK                            04310000
088019           MOVE 'N' TO PS-FIRST-TIME-THRU                         04320000
088020        ELSE                                                      04330000
088030           IF (FST00003-DEPT-NBR NOT = PV-PREV-DEPT) OR           04340000
088040              (FST00003-MAJ-CL-NBR NOT = PV-PREV-MAJ-CL)          04350000
088050               PERFORM C200-DEPT-MCL-BREAK                        04360000
088060           ELSE                                                   04370000
088070              IF (FST00003-SUB-CL-NBR NOT = PV-PREV-SUB-CL)       04380000
088080                 PERFORM C300-SUBCLASS-BREAK                      04390000
088090              END-IF                                              04400000
088100           END-IF                                                 04410000
088200        END-IF                                                    04420000
088300                                                                  04430000
088400        PERFORM C400-FORMAT-DETAIL-LINE                           04440000
088500     END-IF.                                                      04450000
088501                                                                  04460000
088502 EJECT                                                            04470000
088503***************************************************************** 04480000
088504*                                                                 04490000
088505*  - PRINT CONTROL TOTALS, CLOSE FILES                            04500000
088506*                                                                 04510000
088507***************************************************************** 04520000
088508 B300-END-ROUTINE.                                                04530000
088509*                                                                 04540000
088510     WRITE PRINT-LINE FROM END-OF-REPORT-LINE                     04550000
088511         AFTER ADVANCING PC-2.                                    04560000
088512*                                                                 04570000
088513     MOVE PV-RECS-PROCESSED TO PV-DISP-RECS-PROC.                 04580000
088514     DISPLAY '*************************************************'. 04590000
088515     DISPLAY 'FSKRP120 - RECORDS PROCESSED: ' PV-DISP-RECS-PROC.  04600000
0618       MOVE PV-BOSS-PROCESSED TO PV-DISP-RECS-PROC.                 04610070
0618       DISPLAY '     BOSS  RECORDS PROCESSED: ' PV-DISP-RECS-PROC.  04620070
088516     DISPLAY '*************************************************'. 04630000
088517*                                                                 04640000
088518     CLOSE CONTROL-FILE                                           04650000
210700           PRINT-REPORT.                                          04660000
210701*                                                                 04670000
210702     PERFORM Z300-CLOSE-ADJ-RCPT-CURSOR.                          04680000
210703                                                                  04690000
210704 EJECT                                                            04700000
211000***************************************************************** 04710000
211100*                                                                 04720000
211200*  - FETCH ROW FROM ADJUSTMENT RECEIPT AUDIT CURSOR               04730000
211600*                                                                 04740000
211700***************************************************************** 04750000
211800 C100-FETCH-ADJ-RCPT-CSR.                                         04760000
211801*                                                                 04770000
222242     MOVE 'C100-FETCH-ADJ-RCPT-CSR'  TO PV-PARAGRAPH-NAME.        04780000
222243     MOVE 'FETCH ADJ RECEIPT CURSOR' TO PV-DB2-OPER-ATTEMPTED.    04790000
211801*                                                                 04800000
211802     EXEC SQL                                                     04810000
211803         FETCH ADJ_RCPT_AUD_CSR                                   04820000
211804          INTO :FST00003-DEPT-NBR,                                04830000
211805               :FST00003-MAJ-CL-NBR,                              04840000
211806               :FST00003-SUB-CL-NBR,                              04850000
211807               :SKXREF-SKU,                                       04860000
211808               :FST00003-LOC-NBR,                                 04870000
211809               :FST00003-ADJ-TYP-CDE,                             04880000
211810               :FST00003-ACTN-CDE,                                04890000
211811               :FST00003-ADJ-QTY,                                 04900000
211812               :FST00003-BTCH-NBR,                                04910000
211813               :FST00004-PO-NBR,                                  04920000
211814               :FST00004-RCVR-NBR                                 04930000
211815     END-EXEC.                                                    04940000
211816*                                                                 04950000
211817     EVALUATE TRUE                                                04960000
211818         WHEN SQLCODE = ZERO                                      04970000
211819             CONTINUE                                             04980000
211820         WHEN SQLCODE = +100                                      04990000
211821             SET EOF-ADJ-RCPT-CURSOR TO TRUE                      05000000
211822         WHEN SQLWARN0 NOT = SPACES                               05010000
211823         WHEN SQLCODE  NOT = ZERO                                 05020000
211824             PERFORM Z999-SQL-ABEND                               05030000
211825     END-EVALUATE.                                                05040000
211826                                                                  05050000
211827 EJECT                                                            05060000
211828***************************************************************** 05070000
211829*                                                                 05080000
211830*  - PAGE BREAK FOR NEW DEPT OR MAJOR CLASS                       05090000
211831*                                                                 05100000
211832***************************************************************** 05110000
211833 C200-DEPT-MCL-BREAK.                                             05120000
211834*                                                                 05130000
211835     MOVE FST00003-DEPT-NBR   TO HL3-DEPT.                        05140000
211836     MOVE FST00003-MAJ-CL-NBR TO HL3-MAJOR-CLASS.                 05150000
211837     MOVE FST00003-SUB-CL-NBR TO HL3-SUBCLASS.                    05160000
211838*                                                                 05170000
211839     PERFORM Z400-PRINT-REPORT-HEADERS.                           05180000
211840*                                                                 05190000
211850     MOVE FST00003-DEPT-NBR   TO PV-PREV-DEPT.                    05200000
211860     MOVE FST00003-MAJ-CL-NBR TO PV-PREV-MAJ-CL.                  05210000
211870     MOVE FST00003-SUB-CL-NBR TO PV-PREV-SUB-CL.                  05220000
211871*                                                                 05230000
211872***************************************************************** 05240000
211873*                                                                 05250000
211874*  - PRINT DEPT/MAJOR CLASS/SUBCLASS LINE WHEN SUBCLASS CHANGES   05260000
211875*                                                                 05270000
211876***************************************************************** 05280000
211877 C300-SUBCLASS-BREAK.                                             05290000
211878*                                                                 05300000
211879     MOVE FST00003-SUB-CL-NBR TO HL3-SUBCLASS.                    05310000
215900*                                                                 05320000
216000     WRITE PRINT-LINE FROM HEADING-LINE-3                         05330000
216100         AFTER ADVANCING PC-2.                                    05340000
216200*                                                                 05350000
216300     MOVE FST00003-SUB-CL-NBR TO PV-PREV-SUB-CL.                  05360000
216301                                                                  05370000
216302 EJECT                                                            05380000
216303***************************************************************** 05390000
216304*                                                                 05400000
216305*  - MOVE DATA TO DETAIL LINE & PRINT                             05410000
216306*                                                                 05420000
216307***************************************************************** 05430000
216308 C400-FORMAT-DETAIL-LINE.                                         05440000
216309*                                                                 05450000
           INITIALIZE PV-BATCH-NBR-ALPHA                                05460000
                      PV-BATCH-NBR-NUMERIC                              05470000
                      PV-EVALUATE-BATCH                                 05480000
                      PV-EVALUATE-BATCH-X.                              05490000
                                                                        05500000
216310     MOVE SKXREF-SKU           TO DL1-SKU-NBR.                    05510000
216320     MOVE FST00003-LOC-NBR     TO DL1-STORE-NBR.                  05520000
216330     MOVE SPACES               TO DL1-ORDER.                      05530000
216370     MOVE FST00003-ADJ-TYP-CDE TO DL1-TYPE-CODE.                  05540000
216380     MOVE FST00003-ADJ-QTY     TO DL1-QTY.                        05550000
216390     MOVE FST00003-ACTN-CDE    TO DL1-ACTION.                     05560000
216400     MOVE FST00003-BTCH-NBR    TO DL1-BATCH.                      05570000
216500*                                                                 05580000
           MOVE FST00003-BTCH-NBR TO PV-BATCH-NBR-ALPHA.                05590000
           IF PV-BATCH-NBR-NUMERIC NUMERIC                              05600000
              MOVE FST00003-BTCH-NBR TO PV-EVALUATE-BATCH               05610000
           ELSE                                                         05620000
              MOVE FST00003-BTCH-NBR TO PV-EVALUATE-BATCH-X             05630000
           END-IF.                                                      05640000
218700*                                                                 05650000
216700     EVALUATE TRUE                                                05660000
216800        WHEN PV-FAST-TRANSFER OR PV-FAST-TRANSFER-X               05670000
216800                              OR PV-FAST-TRANSFER-X2              05680000
216900            MOVE 'FAST TRANSFER'         TO DL1-BATCH-DESC        05690000
0518          WHEN PV-BOSS-REQS OR PV-BOSS-REQS-X                       05700067
0518                           OR PV-BOSS-REQS-X2                       05710067
0518              MOVE 'BOSS TRANSFERS '       TO DL1-BATCH-DESC        05720064
217200        WHEN PV-CENTRAL-STOCK OR PV-CENTRAL-STOCK-X               05730000
217200                              OR PV-CENTRAL-STOCK-X2              05740000
217300            MOVE 'CENTRAL STOCK'         TO DL1-BATCH-DESC        05750000
217400        WHEN PV-IN-STR-PRICE-CHG OR PV-IN-STR-PRICE-CHG-X         05760000
217400                                 OR PV-IN-STR-PRICE-CHG-X2        05770000
217500            MOVE 'IN-STORE PRICE CHANGE' TO DL1-BATCH-DESC        05780000
217400        WHEN PV-DATA-ENTRY-TRANSFER OR PV-DATA-ENTRY-TRANSFER-X   05790000
217400                                  OR PV-DATA-ENTRY-TRANSFER-X2    05800000
217500            MOVE 'DATA ENTRY TRANSFER'   TO DL1-BATCH-DESC        05810000
217600        WHEN PV-USA-COUNTS                                        05820000
217700            MOVE 'USA COUNT'             TO DL1-BATCH-DESC        05830000
217800        WHEN PV-DATA-ENTRY                                        05840000
217900            MOVE 'DATA ENTRY'            TO DL1-BATCH-DESC        05850000
218000        WHEN PV-RECEIPT                                           05860000
218100            MOVE 'RECEIPT'               TO DL1-BATCH-DESC        05870000
218200        WHEN PV-INVENTORY                                         05880000
218300            MOVE 'INVENTORY'             TO DL1-BATCH-DESC        05890000
MK            WHEN PV-ECOM                                              05900038
MK                MOVE 'RDM ADJUSTMENT'        TO DL1-BATCH-DESC        05910039
RONNA         WHEN PV-OMS-CENTRAL-STOCK OR PV-OMS-CENTRAL-STOCK-X       05920045
RONNA                               OR PV-OMS-CENTRAL-STOCK-X2          05930045
RONNA             MOVE 'OMS CENTRAL STOCK'     TO DL1-BATCH-DESC        05940045
OCFSFS        WHEN PV-OCF-ADJ                                           05950050
OCFSFS            MOVE 'OMS SFS'               TO DL1-BATCH-DESC        05960050
111890        WHEN PV-RFID-ADJ                                          05970056
111890            MOVE 'RFID COUNT'            TO DL1-BATCH-DESC        05980056
GIV2FS        WHEN PV-GIV-ADJ                                           05990059
GIV2FS            MOVE 'GIV ADJUSTMENT'        TO DL1-BATCH-DESC        06000059
164325        WHEN PV-MISLOAD-TSFR                                      06010057
164325            MOVE 'MISLOAD TSFR'          TO DL1-BATCH-DESC        06020057
218400        WHEN OTHER                                                06030038
218500            MOVE SPACES                  TO DL1-BATCH-DESC        06040038
218600     END-EVALUATE.                                                06050038
                                                                        06060038
218800     MOVE FST00003-ADJ-TYP-CDE TO PV-EVALUATE-TYPE.               06070038
218900     EVALUATE TRUE                                                06080000
219000        WHEN PV-ONHAND-ADJ                                        06090000
219100            MOVE 'ON HAND ADJ'     TO DL1-TYPE-DESC               06100051
219200        WHEN PV-STORE-RCPTS                                       06110000
219300            MOVE 'STORE RCPTS'     TO DL1-TYPE-DESC               06120051
OCFSFS        WHEN PV-SFS-ADJ                                           06130050
OCFSFS            MOVE 'SFS OH ADJ'      TO DL1-TYPE-DESC               06140051
OCFSFS        WHEN PV-SFS-SALES-ADJ                                     06150051
OCFSFS            MOVE 'SFS SETTLE ADJ'  TO DL1-TYPE-DESC               06160051
219800        WHEN PV-ONHAND-DBL-BK                                     06170000
219900            MOVE 'ONHAND DBL BK'   TO DL1-TYPE-DESC               06180051
220000        WHEN PV-RECEIPT-TYPE                                      06190000
220100            MOVE 'RECEIPT'         TO DL1-TYPE-DESC               06200000
220200            MOVE SPACES            TO DL1-TYPE-CODE               06210000
220300            MOVE FST00004-PO-NBR   TO DL1-ORDER-NBR               06220000
220400            MOVE '-'               TO DL1-DASH                    06230000
0518              IF FST00004-RCVR-NBR = PV-BOSS-PARM-RECV              06240063
0518                 MOVE 'BSS'          TO DL1-RCVR-NBR-X              06250063
0618                 ADD 1               TO PV-BOSS-PROCESSED           06260070
0518              ELSE                                                  06270063
220500               MOVE FST00004-RCVR-NBR                             06280061
220500                                   TO DL1-RCVR-NBR                06290061
0518              END-IF                                                06300063
0518                                                                    06310063
220600        WHEN OTHER                                                06320000
220700            MOVE SPACES          TO DL1-TYPE-DESC                 06330000
220800     END-EVALUATE.                                                06340000
220900*                                                                 06350000
221000     PERFORM D100-PRINT-DETAIL-LINE.                              06360000
221100     ADD +1 TO PV-RECS-PROCESSED.                                 06370000
221101                                                                  06380000
0518  ******************************************************************06390065
0518  *- READ TKRPRPM TO RETRIEVE THE BOSS RECEIVER PARM                06400065
0518  ******************************************************************06410065
0518   C500-GET-BOSS-PARM-RCVR.                                         06420063
0518                                                                    06430063
0518       EXEC SQL                                                     06440063
0518           SELECT FUNC_QTY                                          06450063
0518             INTO :PV-BOSS-PARM-RECV                                06460063
0518             FROM TKRPRPM                                           06470063
0518            WHERE LOC_ID            = 90                            06480063
0518              AND INTFC_SYS_CDE     = 'GIV'                         06490063
0518              AND SYS_PRC_FUNC_CDE  = 'BSSRCV'                      06500063
0518              AND FUNC_PRC_STAT_CDE = 'AC'                          06510063
0518            WITH UR                                                 06520063
0518       END-EXEC.                                                    06530063
0518                                                                    06540063
0518       EVALUATE TRUE                                                06550063
0518           WHEN SQLCODE = ZERO                                      06560063
0518               MOVE PV-BOSS-PARM-RECV      TO PV-BOSS-PARM-DISP     06570069
0518               DISPLAY ' BOSS PARM RECEIVER  = '                    06580063
0518                                              PV-BOSS-PARM-DISP     06590069
0518                                                                    06600063
0518           WHEN SQLWARN0 NOT = SPACES                               06610063
0518           WHEN SQLCODE  NOT = ZERO                                 06620063
0518               PERFORM Z999-SQL-ABEND                               06630063
0518                                                                    06640063
0518       END-EVALUATE.                                                06650063
0518                                                                    06660063
221102 EJECT                                                            06670000
221103***************************************************************** 06680000
221104 D100-PRINT-DETAIL-LINE.                                          06690000
221105*                                                                 06700000
221106     ADD PC-2 TO PV-LINE-CNT.                                     06710000
221107*                                                                 06720000
221108     IF PV-LINE-CNT > PC-MAX-LINES                                06730000
221109        PERFORM Z400-PRINT-REPORT-HEADERS                         06740000
221110        ADD PC-2 TO PV-LINE-CNT                                   06750000
221111     END-IF.                                                      06760000
221112*                                                                 06770000
221113     WRITE PRINT-LINE FROM DETAIL-LINE-1                          06780000
221114         AFTER ADVANCING PC-2.                                    06790000
221115*                                                                 06800000
221116     MOVE SPACES TO PRINT-LINE.                                   06810000
221117*                                                                 06820000
221118                                                                  06830000
221119 EJECT                                                            06840000
221120***************************************************************** 06850000
221121*                                                                 06860000
221122*  - READ CONTROL CARD CONTAINING PROCESSING DATE                 06870000
221123*                                                                 06880000
221124***************************************************************** 06890000
221125 Z100-READ-CONTROL-FILE.                                          06900000
221126*                                                                 06910000
221127     READ CONTROL-FILE INTO CONTROL-DATA-IN                       06920000
221128          AT END SET EOF-CONTROL-FILE TO TRUE.                    06930000
221129*                                                                 06940000
221130     IF EOF-CONTROL-FILE                                          06950000
221500        DISPLAY '** ABEND **'                                     06960000
221600        DISPLAY '** PROGRAM    = ' PC-PROGRAM-NAME                06970000
221700        DISPLAY '** PARAGRAPH  = Z100-READ-CONTROL-FILE'          06980000
221800        DISPLAY '** MESSAGE    = CONTROL FILE DATE NOT FOUND'     06990000
222000        MOVE +4003      TO ABEND-CODE                             07000000
222100        CALL 'ILBOABN0' USING ABEND-CODE                          07010000
222200     END-IF.                                                      07020000
222201                                                                  07030000
222202 EJECT                                                            07040000
222203******************************************************************07050000
222204 Z200-OPEN-ADJ-RCPT-CURSOR.                                       07060000
222205*                                                                 07070000
222206     MOVE 'Z200-OPEN-ADJ-RCPT-CURSOR' TO PV-PARAGRAPH-NAME.       07080000
222207     MOVE 'OPEN CURSOR '              TO PV-DB2-OPER-ATTEMPTED.   07090000
222208*                                                                 07100000
222209     EXEC SQL                                                     07110000
222210         OPEN ADJ_RCPT_AUD_CSR                                    07120000
222211     END-EXEC.                                                    07130000
222212                                                                  07140000
222213     EVALUATE TRUE                                                07150000
222214         WHEN SQLCODE = ZERO                                      07160000
222215             CONTINUE                                             07170000
222216         WHEN OTHER                                               07180000
222217             PERFORM Z999-SQL-ABEND                               07190000
222218     END-EVALUATE.                                                07200000
222219                                                                  07210000
222220*                                                                 07220000
222230******************************************************************07230000
222240 Z300-CLOSE-ADJ-RCPT-CURSOR.                                      07240000
222241*                                                                 07250000
222242     MOVE 'Z300-CLOSE-ADJ-RCPT-CURSOR' TO PV-PARAGRAPH-NAME.      07260000
222243     MOVE 'CLOSE CURSOR '              TO PV-DB2-OPER-ATTEMPTED.  07270000
222244*                                                                 07280000
222245     EXEC SQL                                                     07290000
222246         CLOSE ADJ_RCPT_AUD_CSR                                   07300000
222247     END-EXEC.                                                    07310000
222248                                                                  07320000
222249     EVALUATE TRUE                                                07330000
222250         WHEN SQLCODE = ZERO                                      07340000
222251             CONTINUE                                             07350000
222252         WHEN OTHER                                               07360000
222253             PERFORM Z999-SQL-ABEND                               07370000
222254     END-EVALUATE.                                                07380000
222255                                                                  07390000
222256 EJECT                                                            07400000
222257*                                                                 07410000
222258***************************************************************** 07420000
222259 Z400-PRINT-REPORT-HEADERS.                                       07430000
222260*                                                                 07440000
222261     ADD PC-1 TO PV-PAGE-CNT.                                     07450000
222262     MOVE PV-PAGE-CNT TO DP132-PAGE-NUMBER.                       07460000
222263*                                                                 07470000
222264     WRITE PRINT-LINE FROM DP132-STANDRD-HEADER-132-COLS          07480000
222265         AFTER ADVANCING PAGE.                                    07490000
222266*                                                                 07500000
222267     WRITE PRINT-LINE FROM HEADING-LINE-2                         07510000
222268         AFTER ADVANCING PC-1.                                    07520000
222269*                                                                 07530000
222270     WRITE PRINT-LINE FROM HEADING-LINE-3                         07540000
222271         AFTER ADVANCING PC-1.                                    07550000
222272*                                                                 07560000
222273     WRITE PRINT-LINE FROM HEADING-LINE-4                         07570000
222274         AFTER ADVANCING PC-2.                                    07580000
222275*                                                                 07590000
222276     WRITE PRINT-LINE FROM HEADING-LINE-5                         07600000
222277         AFTER ADVANCING PC-1.                                    07610000
222278*                                                                 07620000
222279     MOVE ZERO TO PV-LINE-CNT.                                    07630000
222280                                                                  07640000
222300*                                                                 07650000
222400***************************************************************** 07660000
222500 Z999-SQL-ABEND.                                                  07670000
222600*                                                                 07680000
222700     SET ABEND-4013            TO TRUE.                           07690000
222800     DISPLAY '**  ABEND     **'.                                  07700000
222900     DISPLAY '**  PROGRAM   **  = ' PC-PROGRAM-NAME.              07710000
223000     DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            07720000
223100     DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.        07730000
223200                                                                  07740000
223300*    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         07750000
223400*    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        07760000
223500                                                                  07770000
223600     COPY DPPD004.                                                07780000
223700                                                                  07790000
223800     CALL 'ILBOABN0'  USING ABEND-CODE.                           07800000
223900*                                                                 07810000
224000***************************************************************** 07820000
