000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.    BPKUT152.                                         00030099
000400 AUTHOR.        COGNIZANT.                                        00040085
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
000600 DATE-WRITTEN.  04/30/2010.                                       00060085
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900******************************************************************00090000
001000*   BPKUT152 - REFORMAT ACTUALS UNITS FOR LOAD TO EP              00100099
001100******************************************************************00110000
001200* THIS PROGRAM READS A FILE, WITH ACTUALS AMOUNTS AND UNITS       00120000
001300* FROM THE DATA WAREHOUSE, AND REFORMATS THE RECEIPT UNITS AND    00130072
001400* EOP UNITS FOR LOADING INTO AIM                                  00140001
001500******************************************************************00150000
001600* CHANGED: MM/DD/CCYY   NAME                WRN#2344              00160099
002500*                                                                 00250086
002600*  04/29/2010     SREELATHA PELLETI                               00260086
002700* EP UPGRADE                                                      00270086
002800*- CHANGED THE PROGRAM FOR EP UPGRADE PROCESS.                    00280099
002900*  PICKUP THE UNITS FOR ACTUAL RECEIPTS STAGING TABLE IN          00290086
003000*  INFORMATICA. OUTPUT LAYOUT IS IN BPRD150 FORMAT.               00300086
11752A*                                                                 00300199
11752A*  06/01/2017     J SELWITSCHKA                                   00301099
11752A*                 CHANGES FOR EP UPGRADE. GET SALES UNIT AND      00302099
11752A*                 SALES CLR RETAIL.                               00303099
11752A*                                                                 00303199
11752A*  06/22/2017     J SELWITSCHKA                                   00304099
11752A*     - NEW VERSION BPKUT152 IS A COPY OF BPKUT151 WITH EP        00305099
11752A*       UPGRADE CHANGES. CREATED BECAUSE EP UPGRADE VERSION       00306099
11752A*       WILL BE RUNNING IN PARALLEL WITH OLD VERSION.             00307099
11752A*                                                                 00308099
C71496*  09/28/2017     J SELWITSCHKA                                   00309099
C71496*     - FOR SALES CLEARANCE RETAIL USE 2 DECIMALS INSTEAD OF 4.   00309199
C71496*                                                                 00309499
003100******************************************************************00310000
003200                                                                  00320000
003300 EJECT                                                            00330000
003400 ENVIRONMENT DIVISION.                                            00340000
003500 CONFIGURATION SECTION.                                           00350000
003600                                                                  00360000
003700 SOURCE-COMPUTER. IBM-3090.                                       00370000
003800 OBJECT-COMPUTER. IBM-3090.                                       00380000
003900                                                                  00390000
004000 INPUT-OUTPUT SECTION.                                            00400000
004100 FILE-CONTROL.                                                    00410000
004200                                                                  00420000
004300     SELECT ACTUALS-IN1-FILE                                      00430099
004400         ASSIGN TO INP01.                                         00440000
004500                                                                  00450099
004600     SELECT ACTUALS-IN2-FILE                                      00460099
004700         ASSIGN TO INP02.                                         00470099
004800                                                                  00480099
004900     SELECT ACTUALS-IN3-FILE                                      00490099
005000         ASSIGN TO INP03.                                         00500099
005100                                                                  00510099
005200     SELECT ACTUALS-IN4-FILE                                      00520099
005300         ASSIGN TO INP04.                                         00530099
005400                                                                  00540099
005500     SELECT ACTUALS-IN5-FILE                                      00550099
005600         ASSIGN TO INP05.                                         00560099
005700                                                                  00570000
005800     SELECT CONTROL-CARD-FILE                                     00580099
005900         ASSIGN TO INP06.                                         00590099
006000                                                                  00600099
006100     SELECT GREC-UNITS-OUT-FILE                                   00610001
006200         ASSIGN TO OUT01.                                         00620001
006300                                                                  00630099
006400     SELECT EOP-UNITS-OUT-FILE                                    00640099
006500         ASSIGN TO OUT02.                                         00650099
006600 EJECT                                                            00660000
006700 DATA DIVISION.                                                   00670000
006800 FILE SECTION.                                                    00680000
006900                                                                  00690000
007000 FD  ACTUALS-IN1-FILE                                             00700099
007100     RECORDING MODE IS F                                          00710000
007200     LABEL RECORDS ARE STANDARD                                   00720000
007300     BLOCK CONTAINS 0 RECORDS.                                    00730000
007400                                                                  00740000
007500 01  ACTUALS-IN1-RECORD           PIC X(463).                     00750099
007600 EJECT                                                            00760000
007700 FD  ACTUALS-IN2-FILE                                             00770099
007800     RECORDING MODE IS F                                          00780099
007900     LABEL RECORDS ARE STANDARD                                   00790099
008000     BLOCK CONTAINS 0 RECORDS.                                    00800099
008100                                                                  00810099
008200 01  ACTUALS-IN2-RECORD           PIC X(463).                     00820099
008300 EJECT                                                            00830099
008400 FD  ACTUALS-IN3-FILE                                             00840099
008500     RECORDING MODE IS F                                          00850099
008600     LABEL RECORDS ARE STANDARD                                   00860099
008700     BLOCK CONTAINS 0 RECORDS.                                    00870099
008800                                                                  00880099
008900 01  ACTUALS-IN3-RECORD           PIC X(463).                     00890099
009000 EJECT                                                            00900099
009100 FD  ACTUALS-IN4-FILE                                             00910099
009200     RECORDING MODE IS F                                          00920099
009300     LABEL RECORDS ARE STANDARD                                   00930099
009400     BLOCK CONTAINS 0 RECORDS.                                    00940099
009500                                                                  00950099
009600 01  ACTUALS-IN4-RECORD           PIC X(463).                     00960099
009700 EJECT                                                            00970099
009800 FD  ACTUALS-IN5-FILE                                             00980099
009900     RECORDING MODE IS F                                          00990099
010000     LABEL RECORDS ARE STANDARD                                   01000099
010100     BLOCK CONTAINS 0 RECORDS.                                    01010099
010200                                                                  01020099
010300 01  ACTUALS-IN5-RECORD           PIC X(463).                     01030099
010400 EJECT                                                            01040099
010500 FD  CONTROL-CARD-FILE                                            01050099
010600     RECORDING MODE IS F                                          01060099
010700     LABEL RECORDS ARE STANDARD                                   01070099
010800     BLOCK CONTAINS 0 RECORDS.                                    01080099
010900                                                                  01090099
011000 01  CONTROL-CARD-RECORD         PIC X(80).                       01100099
011100 EJECT                                                            01110099
011200 FD  GREC-UNITS-OUT-FILE                                          01120001
011300     RECORDING MODE IS F                                          01130000
011400     LABEL RECORDS ARE STANDARD                                   01140000
011500     BLOCK CONTAINS 0 RECORDS.                                    01150000
011600                                                                  01160000
011700 01  GREC-UNITS-OUT-RECORD       PIC X(700).                      01170086
011800 EJECT                                                            01180000
011900 FD  EOP-UNITS-OUT-FILE                                           01190099
012000     RECORDING MODE IS F                                          01200099
012100     LABEL RECORDS ARE STANDARD                                   01210099
012200     BLOCK CONTAINS 0 RECORDS.                                    01220099
012300                                                                  01230099
012400 01  EOP-UNITS-OUT-RECORD        PIC X(700).                      01240099
012500 EJECT                                                            01250099
012600 WORKING-STORAGE SECTION.                                         01260000
012700                                                                  01270000
012800 01  DATE-CONTROL-CARD.                                           01280000
012900     05  DC-CONSTANT             PIC X(08).                       01290000
013000         88  DC-VALID-CONSTANT   VALUE 'BPKUT152'.                01300099
013100     05  FILLER                  PIC X(01).                       01310000
013200     05  DC-DATE.                                                 01320000
013300         10  DC-CCYY             PIC X(04).                       01330000
013400         10  FILLER              PIC X(01) VALUE '-'.             01340065
013500         10  DC-MM               PIC X(02).                       01350000
013600         10  FILLER              PIC X(01) VALUE '-'.             01360065
013700         10  DC-DD               PIC X(02).                       01370000
013800     05  FILLER                  PIC X(61).                       01380063
013900                                                                  01390000
014000 01  PC-PROGRAM-CONSTANTS.                                        01400000
014100     05  PC-1                    PIC  9(01)  VALUE 1.             01410000
014200     05  PC-PGM-NAME             PIC  X(08)  VALUE 'BPKUT152'.    01420099
014300     05  PC-VARIABLE             PIC  X(08)  VALUE '    GREC'.    01430014
014400     05  PC-UNT                  PIC  X(03)  VALUE 'UNT'.         01440014
014500     05  PC-ECOMM-CHANNEL        PIC  X(07)  VALUE 'VIRTSTR'.     01450007
014600     05  PC-STORE-CHANNEL        PIC  X(07)  VALUE 'PHYSSTR'.     01460020
014700     05  PC-DEPT-MAX             PIC S9(04)  VALUE +5000.         01470084
014800                                                                  01480000
014900 01  PS-PROGRAM-SWITCHES.                                         01490000
015000     05  PS-END-OF-CONTROL-CARDS-SW   PIC X      VALUE 'N'.       01500099
015100         88  PS-END-OF-CONTROL-CARDS             VALUE 'Y'.       01510099
015200     05  PS-END-OF-INPUT-SW      PIC X       VALUE 'N'.           01520000
015300         88  PS-END-OF-INPUT                 VALUE 'Y'.           01530000
015400     05  PS-END-OF-PROCESS-SW    PIC X       VALUE 'N'.           01540099
015500         88  PS-END-OF-PROCESS               VALUE 'Y'.           01550099
015600     05  PS-END-OF-DEPT-CURSOR-SW     PIC X(01)  VALUE 'N'.       01560028
015700         88  PS-END-OF-DEPT-CURSOR               VALUE 'Y'.       01570028
015800     05  PS-NO-OVERRIDE-DATE-SW       PIC X(01)  VALUE 'N'.       01580099
015900         88  PS-NO-OVERRIDE-DATE                 VALUE 'Y'.       01590099
016000                                                                  01600000
016100 01  PV-PROGRAM-VARIABLES.                                        01610000
016200     05  PV-ACTUALS-READ         PIC S9(09)  VALUE +0  COMP.      01620099
016300     05  PV-FILE1-ACTUALS-READ   PIC S9(09)  VALUE +0  COMP.      01620199
016400     05  PV-FILE2-ACTUALS-READ   PIC S9(09)  VALUE +0  COMP.      01621099
016500     05  PV-FILE3-ACTUALS-READ   PIC S9(09)  VALUE +0  COMP.      01622099
016600     05  PV-FILE4-ACTUALS-READ   PIC S9(09)  VALUE +0  COMP.      01623099
016700     05  PV-FILE5-ACTUALS-READ   PIC S9(09)  VALUE +0  COMP.      01624099
016800     05  PV-GREC-UNITS-WRITTEN   PIC S9(09)  VALUE +0  COMP.      01630001
016900     05  PV-EOP-UNITS-WRITTEN    PIC S9(09)  VALUE +0  COMP.      01640001
017000     05  PV-ABEND-CODE           PIC S9(04)  VALUE +0  COMP.      01650000
017100         88  PV-ABEND-4001                   VALUE 4001.          01660000
017200*            EMPTY INPUT FILE                                     01670000
017300         88  PV-ABEND-4003                   VALUE 4003.          01680000
017400*            INVALID CONTROL CARD                                 01690000
017500         88  PV-ABEND-4004                   VALUE 4004.          01700027
017600*            TABLE OVERFLOW                                       01710027
017700         88  PV-ABEND-4008                   VALUE 4008.          01720020
017800*            INVALID DATA                                         01730020
017900         88  PV-ABEND-4019                   VALUE 4019.          01740000
018000*            INVALID CALENDAR ROUTINE CALL                        01750000
018100     05  PV-DISPLAY-CNT          PIC  Z(8)9  VALUE ZERO.          01760027
018200     05  PV-DEPT-NBR             PIC  X(03)  VALUE SPACES.        01770011
018300     05  PV-MAJOR-CLASS-NBR      PIC  X(02)  VALUE SPACES.        01780011
018400     05  PV-WK-END-DATE          PIC  X(10)  VALUE SPACES.        01790099
018500     05  PV-NUM-OF-WEEK-FILE     PIC  9(01)  VALUE 1.             01800099
018600     05  PV-CURRENT-DATE.                                         01810062
018700         10  PV-CURRENT-YEAR     PIC  X(04)  VALUE SPACES.        01820062
018800         10  PV-FILLER           PIC  X(01)  VALUE '-'.           01830062
018900         10  PV-CURRENT-MONTH    PIC  X(02)  VALUE SPACES.        01840062
019000         10  PV-FILLER           PIC  X(01)  VALUE '-'.           01850062
019100         10  PV-CURRENT-DAY      PIC  X(02)  VALUE SPACES.        01860062
019200     05  PV-PROCESS-SEASON.                                       01870007
019300         10  PV-S-OR-F           PIC  X(01)  VALUE SPACES.        01880027
019400         10  PV-PROCESS-YEAR     PIC  9(04)  VALUE ZEROES.        01890029
019500         10  PV-FILLER           PIC  X(01)  VALUE 'W'.           01900007
019600         10  PV-PROCESS-WEEK     PIC  9(02)  VALUE ZEROES.        01910027
019700     05  PV-ECOMM-UNITS          PIC S9(14)V9(05) VALUE ZERO.     01920025
019800     05  PV-STORE-UNITS          PIC S9(14)V9(05) VALUE ZERO.     01930025
019900     05  PV-ECOMM-EOP-UNITS      PIC S9(14)V9(05) VALUE ZERO.     01940025
020000     05  PV-STORE-EOP-UNITS      PIC S9(14)V9(05) VALUE ZERO.     01950025
11752A     05  PV-ECOMM-SLS-UNITS      PIC S9(14)V9(05) VALUE ZERO.     01951099
11752A     05  PV-STORE-SLS-UNITS      PIC S9(14)V9(05) VALUE ZERO.     01952099
C71496     05  PV-ECOMM-SLS-CLR-RTL    PIC S9(15)V9(02) VALUE ZERO.     01953099
C71496     05  PV-STORE-SLS-CLR-RTL    PIC S9(15)V9(02) VALUE ZERO.     01954099
020100     05  PV-DB2-OPER-ATTEMPTED   PIC  X(30)  VALUE SPACES.        01960027
020200     05  PV-PARAGRAPH-NAME       PIC  X(30)  VALUE SPACES.        01970027
020300     05  PV-NBR-VALID-DEPTS      PIC S9(04)  VALUE ZEROES.        01980027
020400  EJECT                                                           01990000
020500 01  PROGRAM-TABLES.                                              02000027
020600****************************************************************  02010027
020700* DEPT/CLASSES THAT ARE VALID TO BUYER PLANNING                   02020027
020800****************************************************************  02030027
020900     05  PV-VALID-ENTRY             OCCURS 5000 TIMES             02040084
021000                                    INDEXED BY PV-INX.            02050027
021100        10 PV-VALID-DEPT            PIC X(03).                    02060027
021200        10 PV-VALID-CLASS           PIC X(02).                    02070027
021300  EJECT                                                           02080027
021400     COPY PARD135.                                                02090004
021500  EJECT                                                           02100000
021600     COPY BPRD102.                                                02110080
021700  EJECT                                                           02120006
021800     COPY DPWS010I.                                               02130007
021900  EJECT                                                           02140006
022000     COPY DPWS500.                                                02150006
022100  EJECT                                                           02160003
022200* OUTPUT COPY BOOK LAYOUT.                                        02170086
11752A*    COPY BPRD150.                                                02180099
11752A     COPY BPRD151.                                                02181099
022400  EJECT                                                           02190086
022500****************************************************************  02200003
022600* APPLICATION AVAILABILITY TABLE                                  02210003
022700***************************************************************   02220003
022800                                                                  02230003
022900     EXEC SQL                                                     02240003
023000         INCLUDE TAPLAVL                                          02250003
023100     END-EXEC.                                                    02260003
023200  EJECT                                                           02270000
023300****************************************************************  02280003
023400* MERCHANDISE AREA TABLE                                          02290003
023500****************************************************************  02300003
023600                                                                  02310003
023700     EXEC SQL                                                     02320003
023800         INCLUDE TMDSEAR                                          02330003
023900     END-EXEC.                                                    02340003
024000    EJECT                                                         02350003
024100****************************************************************  02360003
024200* MERCHANDISE LEDGER DATE CONTROL TABLE                           02370003
024300****************************************************************  02380003
024400                                                                  02390003
024500     EXEC SQL                                                     02400003
024600         INCLUDE TMLCNTL                                          02410003
024700     END-EXEC.                                                    02420003
024800    EJECT                                                         02430003
024900****************************************************************  02440058
025000* DATE ATTRIBUTE TABLE                                            02450072
025100****************************************************************  02460058
025200                                                                  02470058
025300     EXEC SQL                                                     02480058
025400         INCLUDE TDTATTR                                          02490058
025500     END-EXEC.                                                    02500058
025600    EJECT                                                         02510058
025700****************************************************************  02520003
025800*  COMMUNICATION AREAS FOR DB2                                    02530003
025900****************************************************************  02540003
026000                                                                  02550003
026100     EXEC SQL                                                     02560003
026200         INCLUDE SQLCA                                            02570003
026300     END-EXEC.                                                    02580003
026400    EJECT                                                         02590003
026500******************************************************************02600003
026600* DB2 COMMUNICATION AREA 2                                        02610003
026700******************************************************************02620003
026800                                                                  02630003
026900     COPY SQLCA2.                                                 02640003
027000    EJECT                                                         02650003
027100****************************************************************  02660003
027200*  ML VALID DEPT/CLASS CURSOR                                     02670003
027300****************************************************************  02680003
027400                                                                  02690003
027500     EXEC SQL                                                     02700003
027600          DECLARE VALID-DEPT-CSR CURSOR FOR                       02710003
027700          SELECT  A.DEPT_NBR                                      02720003
027800                 ,A.MAJ_CL_NBR                                    02730003
027900            FROM  TMDSEAR A                                       02740003
028000                 ,TAPLAVL B                                       02750003
028100           WHERE  A.OPERCO_NBR      = '03'                        02760003
028200             AND  A.MDSELV_CDE      = 'MCL'                       02770003
028300             AND  :PV-WK-END-DATE BETWEEN A.STRT_DTE              02780099
028400                                    AND A.END_DTE                 02790050
028500             AND  A.MDSEAR_DKEY     = B.MDSEAR_DKEY               02800003
028600             AND  :PV-WK-END-DATE BETWEEN                         02810099
028700                      B.MDSEAR_STRT_DTE AND B.MDSEAR_END_DTE      02820061
028800             AND  B.APLSYS_CDE      = 'BP'                        02830003
028900        ORDER BY  A.DEPT_NBR, A.MAJ_CL_NBR                        02840003
029000        WITH UR                                                   02850092
029100     END-EXEC.                                                    02860003
029200******************************************************************02870003
029300    EJECT                                                         02880003
029400****************************************************************  02890099
029500*  ML PROCESS DATES CURSOR                                        02900099
029600****************************************************************  02910099
029700                                                                  02920099
029800     EXEC SQL                                                     02930099
029900          DECLARE PROC-DATES-CSR CURSOR FOR                       02940099
030000          SELECT  DISTINCT(FSCL_WK_END_DTE)                       02950099
030100            FROM  TDTATTR                                         02960099
030200           WHERE  KY_DTE < :MLCNTL-PSTG-FSCL-WK-DTE               02970099
030300        ORDER BY  FSCL_WK_END_DTE DESC                            02980099
030400        FETCH FIRST 5 ROWS ONLY                                   02990099
030500        WITH UR                                                   03000099
030600     END-EXEC.                                                    03010099
030700******************************************************************03020099
030800    EJECT                                                         03030099
030900 PROCEDURE DIVISION.                                              03040099
031000                                                                  03050000
031100 0000-MAIN-MODULE.                                                03060000
031200                                                                  03070000
031300     PERFORM 1000-INITIALIZATION.                                 03080000
031400                                                                  03090000
031500     IF PS-NO-OVERRIDE-DATE                                       03100099
031600        PERFORM UNTIL PS-END-OF-PROCESS                           03110099
031700           MOVE ZEROES TO PV-ECOMM-UNITS                          03111099
031800           MOVE ZEROES TO PV-STORE-UNITS                          03112099
031900           MOVE ZEROES TO PV-ECOMM-EOP-UNITS                      03113099
032000           MOVE ZEROES TO PV-STORE-EOP-UNITS                      03114099
032100           PERFORM 7000-READ-ACTUALS-FILE                         03120099
032200           MOVE PA135-DEPT-NMBR       TO PV-DEPT-NBR              03130099
032300           MOVE PA135-MAJOR-CLASS     TO PV-MAJOR-CLASS-NBR       03140099
032400           IF NOT PS-END-OF-PROCESS                               03150099
032500              PERFORM 2000-PROCESS-ACTUALS                        03230099
032600                UNTIL PS-END-OF-INPUT                             03240099
032700              SET PV-INX TO 1                                     03260099
032800              SEARCH PV-VALID-ENTRY VARYING PV-INX                03270099
032900               WHEN PV-VALID-DEPT(PV-INX) EQUAL PV-DEPT-NBR AND   03280099
033000                 PV-VALID-CLASS(PV-INX) EQUAL PV-MAJOR-CLASS-NBR  03290099
033100               PERFORM 3000-FORMAT-OUPUT                          03300099
033200              END-SEARCH                                          03310099
033300              MOVE 'N' TO PS-END-OF-INPUT-SW                      03311099
033400           END-IF                                                 03320099
033500        END-PERFORM                                               03330099
033600     ELSE                                                         03340099
033700        PERFORM 7000-READ-ACTUALS-FILE                            03350099
033800        MOVE PA135-DEPT-NMBR       TO PV-DEPT-NBR                 03360099
033900        MOVE PA135-MAJOR-CLASS     TO PV-MAJOR-CLASS-NBR          03370099
034000        PERFORM 2000-PROCESS-ACTUALS                              03450099
034100          UNTIL PS-END-OF-INPUT                                   03460099
034200                                                                  03470099
034300        SET PV-INX TO 1                                           03480099
034400        SEARCH PV-VALID-ENTRY VARYING PV-INX                      03490099
034500         WHEN PV-VALID-DEPT(PV-INX) EQUAL PV-DEPT-NBR AND         03500099
034600           PV-VALID-CLASS(PV-INX) EQUAL PV-MAJOR-CLASS-NBR        03510099
034700         PERFORM 3000-FORMAT-OUPUT                                03520099
034800        END-SEARCH                                                03530099
034900        MOVE 'N' TO PS-END-OF-INPUT-SW                            03531099
035000     END-IF                                                       03540099
035100                                                                  03550099
035200     PERFORM 8000-EOJ-ROUTINE.                                    03560000
035300                                                                  03570000
035400     STOP RUN.                                                    03580000
035500 EJECT                                                            03590000
035600****************************************************************  03600000
035700*                                                                 03610000
035800****************************************************************  03620000
035900 1000-INITIALIZATION.                                             03630000
036000                                                                  03640000
036100     PERFORM 1500-GET-FISCAL-YEAR-WEEK.                           03650009
036200                                                                  03830027
036300     OPEN INPUT  ACTUALS-IN1-FILE                                 03840099
036400          INPUT  ACTUALS-IN2-FILE                                 03850099
036500          INPUT  ACTUALS-IN3-FILE                                 03860099
036600          INPUT  ACTUALS-IN4-FILE                                 03870099
036700          INPUT  ACTUALS-IN5-FILE                                 03880099
036800          OUTPUT GREC-UNITS-OUT-FILE                              03890001
036900          OUTPUT EOP-UNITS-OUT-FILE.                              03900099
037000                                                                  03910000
037100*    PERFORM 7000-READ-ACTUALS-FILE.                              03920099
037200                                                                  03930000
037300*    MOVE PA135-DEPT-NMBR       TO PV-DEPT-NBR.                   03940099
037400*    MOVE PA135-MAJOR-CLASS     TO PV-MAJOR-CLASS-NBR.            03950099
037500 EJECT                                                            03960000
037600******************************************************************03970000
037700* SET UP THE FISCAL YEAR AND WEEK THAT THE DATA IS FROM           03980000
037800******************************************************************03990000
037900 1500-GET-FISCAL-YEAR-WEEK.                                       04000000
038000                                                                  04010000
038100*    ACCEPT DATE-CONTROL-RECORD.                                  04020000
038200     OPEN INPUT  CONTROL-CARD-FILE.                               04030099
038300                                                                  04040099
038400     READ CONTROL-CARD-FILE INTO DATE-CONTROL-CARD                04050099
038500         AT END SET PS-END-OF-CONTROL-CARDS TO TRUE.              04060099
038600                                                                  04070000
038700     IF  DC-VALID-CONSTANT                                        04080000
038800         NEXT SENTENCE                                            04090000
038900     ELSE                                                         04100000
039000         DISPLAY PC-PGM-NAME '- ***************************'      04110020
039100         DISPLAY PC-PGM-NAME '- PROGRAM ABENDING'                 04120020
039200         DISPLAY PC-PGM-NAME '- CONTROL CARD INVALID'             04130020
039300         DISPLAY PC-PGM-NAME '- ' DATE-CONTROL-CARD               04140020
039400         DISPLAY PC-PGM-NAME '- ***************************'      04150020
039500         SET PV-ABEND-4003 TO TRUE                                04160000
039600         PERFORM 9900-ABEND.                                      04170000
039700                                                                  04180035
039800     IF  DC-DATE EQUAL SPACES                                     04190027
039900         PERFORM 1600-GET-PROCESSING-DATE                         04200031
040000         SET PS-NO-OVERRIDE-DATE TO TRUE                          04210099
040100     ELSE                                                         04220030
040200         MOVE DC-DATE TO PV-WK-END-DATE.                          04230099
040300                                                                  04240038
040400*    DISPLAY PC-PGM-NAME '- PROGRAM RUN DATE - '                  04250099
040500*                                PV-CURRENT-DATE.                 04260099
040600*    DISPLAY PC-PGM-NAME '- FISCAL WEEK PROCESSED - '             04270099
040700*                                   PV-PROCESS-SEASON.            04280099
040800 EJECT                                                            04290000
040900******************************************************************04300026
041000 1600-GET-PROCESSING-DATE.                                        04310026
041100                                                                  04320026
041200     EXEC SQL                                                     04321099
041300          SELECT                                                  04322099
041400                 PSTG_FSCL_WK_DTE                                 04323099
041500            INTO                                                  04324099
041600                 :MLCNTL-PSTG-FSCL-WK-DTE                         04325099
041700            FROM                                                  04326099
041800                 TMLCNTL                                          04327099
041900     END-EXEC.                                                    04328099
042000                                                                  04329099
042100     EVALUATE TRUE                                                04329199
042200         WHEN SQLCODE = ZERO                                      04329299
042300             CONTINUE                                             04329399
042400         WHEN OTHER                                               04329499
042500             MOVE '1600-GET-PROCESSING-DATE' TO PV-PARAGRAPH-NAME 04329599
042600             MOVE 'SELECT ROW FROM TMLCNTL'  TO                   04329699
042700                                             PV-DB2-OPER-ATTEMPTED04329799
042800             PERFORM 9999-SQL-ABEND                               04329899
042900     END-EVALUATE.                                                04329999
043000                                                                  04330099
043100     EXEC SQL                                                     04331026
043200         OPEN PROC-DATES-CSR                                      04340099
043300     END-EXEC.                                                    04350099
043400                                                                  04360026
043500     EVALUATE TRUE                                                04370026
043600         WHEN SQLCODE = ZERO                                      04380026
043700             CONTINUE                                             04390030
043800         WHEN OTHER                                               04400026
043900             MOVE '1600-GET-PROCESSING-DATE' TO PV-PARAGRAPH-NAME 04410026
044000             MOVE 'OPEN CURSOR FOR TDTATTR'  TO                   04420099
044100                                             PV-DB2-OPER-ATTEMPTED04430027
044200             PERFORM 9999-SQL-ABEND                               04440028
044300     END-EVALUATE.                                                04450026
044400                                                                  04460026
044500******************************************************************04470099
044600 1900-FETCH-PROCESSING-DATE.                                      04480099
044700                                                                  04490099
044800     EXEC SQL                                                     04500099
044900          FETCH PROC-DATES-CSR                                    04510099
045000          INTO  :PV-WK-END-DATE                                   04520099
045100     END-EXEC.                                                    04530099
045200                                                                  04540099
045300     EVALUATE TRUE                                                04550099
045400         WHEN SQLCODE = ZERO                                      04560099
045500             CONTINUE                                             04570099
045600         WHEN OTHER                                               04580099
045700             MOVE '1900-FETCH-PROCESSING-DATE'  TO                04590099
045800                                             PV-PARAGRAPH-NAME    04600099
045900             MOVE 'GET DATES FROM TMLCNTL'   TO                   04610099
046000                                             PV-DB2-OPER-ATTEMPTED04620099
046100             PERFORM 9999-SQL-ABEND                               04630099
046200     END-EVALUATE.                                                04640099
046300                                                                  04650099
046400******************************************************************04660058
046500 1700-GET-DATE-DETAILS.                                           04670072
046600                                                                  04680058
046700     EXEC SQL                                                     04690058
046800          SELECT                                                  04700058
046900                 SEA_DESC                                         04710059
047000                ,FSCL_YR_NBR                                      04720058
047100                ,FSCL_WK_NBR                                      04730058
047200            INTO                                                  04740058
047300                 :DTATTR-SEA-DESC                                 04750059
047400                ,:DTATTR-FSCL-YR-NBR                              04760058
047500                ,:DTATTR-FSCL-WK-NBR                              04770058
047600            FROM                                                  04780058
047700                 TDTATTR                                          04790058
047800            WHERE                                                 04800058
047900                 KY_DTE = :PV-WK-END-DATE                         04810099
048000     END-EXEC.                                                    04820058
048100                                                                  04830058
048200     EVALUATE TRUE                                                04840058
048300         WHEN SQLCODE = ZERO                                      04850058
048400             CONTINUE                                             04860058
048500         WHEN OTHER                                               04870058
048600             MOVE '1700-GET-DATE-DETAILS' TO PV-PARAGRAPH-NAME    04880072
048700             MOVE 'SELECT ROW FROM TDTATTR'  TO                   04890058
048800                                             PV-DB2-OPER-ATTEMPTED04900058
048900             PERFORM 9999-SQL-ABEND                               04910058
049000     END-EVALUATE.                                                04920058
049100                                                                  04930058
049200******************************************************************04940026
049300*                                                                *04950026
049400******************************************************************04960026
049500 1800-LOAD-VALID-DEPT-TABLE.                                      04970072
049600     EXEC SQL                                                     04980026
049700         FETCH VALID-DEPT-CSR                                     04990026
049800         INTO  :MDSEAR-DEPT-NBR                                   05000026
049900              ,:MDSEAR-MAJ-CL-NBR                                 05010026
050000     END-EXEC.                                                    05020026
050100                                                                  05030026
050200     EVALUATE SQLCODE                                             05040026
050300         WHEN ZERO                                                05050026
050400             MOVE MDSEAR-DEPT-NBR   TO PV-VALID-DEPT(PV-INX)      05060027
050500             MOVE MDSEAR-MAJ-CL-NBR TO PV-VALID-CLASS(PV-INX)     05070027
050600             ADD  PC-1              TO PV-NBR-VALID-DEPTS         05080034
050700         WHEN +100                                                05090026
050800             SET PS-END-OF-DEPT-CURSOR TO TRUE                    05100026
050900         WHEN OTHER                                               05110026
051000             MOVE '1800-LOAD-VALID-DEPT-TABLE' TO                 05120072
051100                  PV-PARAGRAPH-NAME                               05130026
051200             PERFORM 9999-SQL-ABEND                               05140028
051300     END-EVALUATE.                                                05150026
051400     EJECT                                                        05160026
051500******************************************************************05170000
051600* REFORMAT THE INPUT FILE SO THAT IT CAN BE PUT INTO THE          05180007
051700* EP DATABASE.                                                    05190086
051800******************************************************************05200000
051900 2000-PROCESS-ACTUALS.                                            05210000
052000                                                                  05220000
052100     IF  PA135-DEPT-NMBR EQUAL PV-DEPT-NBR                        05230011
052200         IF  PA135-MAJOR-CLASS EQUAL PV-MAJOR-CLASS-NBR           05240011
052300             CONTINUE                                             05250007
052400         ELSE                                                     05260007
052500             SET PV-INX TO 1                                      05270099
052600             SEARCH PV-VALID-ENTRY VARYING PV-INX                 05280099
052700              WHEN PV-VALID-DEPT(PV-INX) EQUAL PV-DEPT-NBR AND    05290099
052800                   PV-VALID-CLASS(PV-INX) EQUAL PV-MAJOR-CLASS-NBR05300099
052900                   PERFORM 3000-FORMAT-OUPUT                      05310007
053000             END-SEARCH                                           05320099
053100             MOVE PA135-DEPT-NMBR       TO PV-DEPT-NBR            05330099
053200             MOVE PA135-MAJOR-CLASS     TO PV-MAJOR-CLASS-NBR     05340099
053300     ELSE                                                         05350007
053400         SET PV-INX TO 1                                          05360099
053500         SEARCH PV-VALID-ENTRY VARYING PV-INX                     05370099
053600          WHEN PV-VALID-DEPT(PV-INX) EQUAL PV-DEPT-NBR AND        05380099
053700               PV-VALID-CLASS(PV-INX) EQUAL PV-MAJOR-CLASS-NBR    05390099
053800               PERFORM 3000-FORMAT-OUPUT                          05400007
053900         END-SEARCH                                               05410099
054000         MOVE PA135-DEPT-NMBR       TO PV-DEPT-NBR                05420099
054100         MOVE PA135-MAJOR-CLASS     TO PV-MAJOR-CLASS-NBR         05430099
054200     END-IF                                                       05440099
054300                                                                  05450007
054400     MOVE PA135-RECEIPTS-UNITS    TO DP010I-UNEDITED-FIELD.       05460010
054500     PERFORM 9000-CALL-DP010.                                     05470010
054600     IF  PA135-E-BUSINESS-CODE EQUAL 'Y'                          05480026
054700         ADD DP010I-NUM-FIELD-13-DIG-4-DEC TO PV-ECOMM-UNITS      05490026
054800     ELSE                                                         05500026
054900         ADD DP010I-NUM-FIELD-13-DIG-4-DEC TO PV-STORE-UNITS.     05510023
055000                                                                  05520007
055100     MOVE PA135-REG-INVTRY-UNITS  TO DP010I-UNEDITED-FIELD.       05530099
055200     PERFORM 9000-CALL-DP010.                                     05540099
055300     IF  PA135-E-BUSINESS-CODE EQUAL 'Y'                          05550099
055400         ADD DP010I-NUM-FIELD-13-DIG-4-DEC TO PV-ECOMM-EOP-UNITS  05560099
055500     ELSE                                                         05570099
055600         ADD DP010I-NUM-FIELD-13-DIG-4-DEC TO PV-STORE-EOP-UNITS. 05580099
055700                                                                  05590099
055800     MOVE PA135-CLEAR-INVTRY-UNITS  TO DP010I-UNEDITED-FIELD.     05600099
055900     PERFORM 9000-CALL-DP010.                                     05610099
056000     IF  PA135-E-BUSINESS-CODE EQUAL 'Y'                          05620099
056100         ADD DP010I-NUM-FIELD-13-DIG-4-DEC TO PV-ECOMM-EOP-UNITS  05630099
056200     ELSE                                                         05640099
056300         ADD DP010I-NUM-FIELD-13-DIG-4-DEC TO PV-STORE-EOP-UNITS. 05650099
056400                                                                  05660099
11752A     MOVE PA135-REG-SALES-UNITS   TO DP010I-UNEDITED-FIELD.       05661099
11752A     PERFORM 9000-CALL-DP010.                                     05662099
11752A     IF  PA135-E-BUSINESS-CODE EQUAL 'Y'                          05663099
11752A         ADD DP010I-NUM-FIELD-13-DIG-4-DEC TO PV-ECOMM-SLS-UNITS  05664099
11752A     ELSE                                                         05665099
11752A         ADD DP010I-NUM-FIELD-13-DIG-4-DEC TO PV-STORE-SLS-UNITS. 05666099
11752A                                                                  05667099
11752A     MOVE PA135-CLEAR-SALES-UNITS   TO DP010I-UNEDITED-FIELD.     05668099
11752A     PERFORM 9000-CALL-DP010.                                     05669099
11752A     IF  PA135-E-BUSINESS-CODE EQUAL 'Y'                          05669199
11752A         ADD DP010I-NUM-FIELD-13-DIG-4-DEC TO PV-ECOMM-SLS-UNITS  05669299
11752A     ELSE                                                         05669399
11752A         ADD DP010I-NUM-FIELD-13-DIG-4-DEC TO PV-STORE-SLS-UNITS. 05669499
11752A                                                                  05669599
11752A     MOVE PA135-CLEAR-SALES-AMT     TO DP010I-UNEDITED-FIELD.     05669699
11752A     PERFORM 9010-CALL-DP010.                                     05669799
11752A     IF  PA135-E-BUSINESS-CODE EQUAL 'Y'                          05669899
C71496       ADD DP010I-NUM-FIELD-15-DIG-2-DEC TO PV-ECOMM-SLS-CLR-RTL  05669999
11752A     ELSE                                                         05670099
C71496       ADD DP010I-NUM-FIELD-15-DIG-2-DEC TO PV-STORE-SLS-CLR-RTL. 05670199
11752A                                                                  05670899
056500     PERFORM 7000-READ-ACTUALS-FILE.                              05671099
056600                                                                  05680007
056700 EJECT                                                            05690007
056800******************************************************************05700020
056900* FORMAT AND WRITE THE OUTPUT FILE                                05710020
057000******************************************************************05720020
057100 2100-GET-DATE-VALD-DEPT.                                         05730099
057200                                                                  05730199
057300     IF PS-NO-OVERRIDE-DATE                                       05730399
057400        PERFORM 1900-FETCH-PROCESSING-DATE                        05730499
057500     END-IF                                                       05730599
057600     PERFORM 1700-GET-DATE-DETAILS                                05730699
057700     PERFORM 6800-GET-VALID-DEPT                                  05730799
057800     MOVE DTATTR-SEA-DESC(1:1)     TO PV-S-OR-F                   05730899
057900     MOVE DTATTR-FSCL-YR-NBR       TO PV-PROCESS-YEAR             05730999
058000     MOVE DTATTR-FSCL-WK-NBR       TO PV-PROCESS-WEEK             05731099
058100     MOVE PV-PROCESS-SEASON        TO                             05731199
058200          BP150-CALENDAR-NAME2.                                   05731299
058300                                                                  05731399
058400 EJECT                                                            05731499
058500******************************************************************05731599
058600* FORMAT AND WRITE THE OUTPUT FILE                                05732099
058700******************************************************************05733099
058800 3000-FORMAT-OUPUT.                                               05734099
058900     INITIALIZE BP150-RECORD.                                     05740086
059000     INITIALIZE BP150-ACTUAL-SALES.                               05750093
059100     INITIALIZE BP150-ACTUAL-RECEIPTS.                            05760093
059200     INITIALIZE BP150-ACTUAL-INVBAL-EOP-CT.                       05770093
059300     INITIALIZE GREC-UNITS-OUT-RECORD.                            05780086
059400     INITIALIZE EOP-UNITS-OUT-RECORD.                             05790086
059500     MOVE PV-DEPT-NBR        TO BP150-DEPARTMENT-NBR2             05800086
059600                               ,BP150-DEPARTMENT-NBR8.            05810099
059700     MOVE PV-MAJOR-CLASS-NBR TO BP150-CLASS-NBR2                  05820086
059800                               ,BP150-CLASS-NBR8.                 05830099
059900     MOVE PV-PROCESS-SEASON  TO BP150-CALENDAR-NAME2              05840095
060000                               ,BP150-CALENDAR-NAME8.             05850099
060100                                                                  05860011
060200***************************************************************   05870007
060300*        WRITE THE GREC E-COMMERCE RECORD                         05880007
060400***************************************************************   05890007
060500     IF  PV-ECOMM-UNITS NOT EQUAL ZERO                            05900007
060600         MOVE PC-ECOMM-CHANNEL TO BP150-ORGANIZATION-NAME2        05910086
060700         COMPUTE BP150-GREC-UNT EQUAL                             05920086
060800              PV-ECOMM-UNITS / 1000                               05930007
060900         MOVE ZEROES           TO PV-ECOMM-UNITS                  05940007
061000         PERFORM 7500-WRITE-GREC-OUTPUT.                          05950072
061100                                                                  05960007
061200***************************************************************   05970007
061300*        WRITE THE GREC BRICK AND MORTOR RECORD                   05980007
061400***************************************************************   05990007
061500     IF  PV-STORE-UNITS NOT EQUAL ZERO                            06000020
061600         MOVE PC-STORE-CHANNEL TO BP150-ORGANIZATION-NAME2        06010086
061700         COMPUTE BP150-GREC-UNT EQUAL                             06020086
061800              PV-STORE-UNITS / 1000                               06030020
061900         MOVE ZEROES           TO PV-STORE-UNITS                  06040020
062000         PERFORM 7500-WRITE-GREC-OUTPUT.                          06050072
062100                                                                  06060007
062200***************************************************************   06070007
062300*        WRITE THE EOP E-COMMERCE RECORD                          06080007
062400***************************************************************   06090007
062500     IF  PV-ECOMM-EOP-UNITS NOT EQUAL ZERO                        06100007
11752A     OR  PV-ECOMM-SLS-UNITS NOT EQUAL ZERO                        06101099
11752A     OR  PV-ECOMM-SLS-CLR-RTL NOT EQUAL ZERO                      06102099
062600         MOVE PC-ECOMM-CHANNEL TO BP150-ORGANIZATION-NAME8        06110086
062700         COMPUTE BP150-EOP-UNT EQUAL                              06120086
062800              PV-ECOMM-EOP-UNITS / 1000                           06130007
062900         MOVE ZEROES           TO PV-ECOMM-EOP-UNITS              06140007
11752A         COMPUTE BP150-SLS-UNT EQUAL                              06141099
11752A              PV-ECOMM-SLS-UNITS / 1000                           06142099
11752A         MOVE ZEROES           TO PV-ECOMM-SLS-UNITS              06143099
11752A         COMPUTE BP150-SLS-CLR-RTL EQUAL                          06144099
11752A              PV-ECOMM-SLS-CLR-RTL / 1000                         06145099
11752A         MOVE ZEROES           TO PV-ECOMM-SLS-CLR-RTL            06146099
063000         PERFORM 7600-WRITE-EOP-OUTPUT.                           06150072
063100                                                                  06160007
063200***************************************************************   06170007
063300*        WRITE THE EOP BRICK AND MORTOR RECORD                    06180007
063400***************************************************************   06190007
063500     IF  PV-STORE-EOP-UNITS NOT EQUAL ZERO                        06200020
11752A     OR  PV-STORE-SLS-UNITS NOT EQUAL ZERO                        06201099
11752A     OR  PV-STORE-SLS-CLR-RTL NOT EQUAL ZERO                      06202099
063600         MOVE PC-STORE-CHANNEL TO BP150-ORGANIZATION-NAME8        06210086
063700         COMPUTE BP150-EOP-UNT EQUAL                              06220086
063800              PV-STORE-EOP-UNITS / 1000                           06230020
063900         MOVE ZEROES           TO PV-STORE-EOP-UNITS              06240020
11752A         COMPUTE BP150-SLS-UNT EQUAL                              06241099
11752A              PV-STORE-SLS-UNITS / 1000                           06242099
11752A         MOVE ZEROES           TO PV-STORE-SLS-UNITS              06243099
11752A         COMPUTE BP150-SLS-CLR-RTL EQUAL                          06244099
11752A              PV-STORE-SLS-CLR-RTL / 1000                         06245099
11752A         MOVE ZEROES           TO PV-STORE-SLS-CLR-RTL            06246099
064000         PERFORM 7600-WRITE-EOP-OUTPUT.                           06250072
064100                                                                  06260007
064200 EJECT                                                            06270007
064300******************************************************************06280027
064400*                                                                *06290027
064500******************************************************************06300027
064600 6000-OPEN-VALID-DEPT-CURSOR.                                     06310027
064700                                                                  06320027
064800     EXEC SQL                                                     06330027
064900         OPEN VALID-DEPT-CSR                                      06340027
065000     END-EXEC.                                                    06350027
065100                                                                  06360027
065200     EVALUATE SQLCODE                                             06370036
065300         WHEN ZERO                                                06380036
065400             CONTINUE                                             06390036
065500         WHEN OTHER                                               06400036
065600             MOVE '6000-OPEN-VALID-DEPT-CURSOR' TO                06410036
065700                  PV-PARAGRAPH-NAME                               06420036
065800             PERFORM 9999-SQL-ABEND                               06430036
065900     END-EVALUATE.                                                06440036
066000     EJECT                                                        06450036
066100******************************************************************06460027
066200*                                                                *06470027
066300******************************************************************06480027
066400 6500-CLOSE-VALID-DEPT-CURSOR.                                    06490027
066500                                                                  06500027
066600     EXEC SQL                                                     06510027
066700         CLOSE VALID-DEPT-CSR                                     06520027
066800     END-EXEC.                                                    06530027
066900                                                                  06540027
067000******************************************************************06550099
067100*                                                                *06560099
067200******************************************************************06570099
067300 6600-CLOSE-PROC-DATES-CURSOR.                                    06580099
067400                                                                  06590099
067500     EXEC SQL                                                     06600099
067600         CLOSE PROC-DATES-CSR                                     06610099
067700     END-EXEC.                                                    06620099
067800                                                                  06630099
067900******************************************************************06630199
068000*                                                                *06630299
068100******************************************************************06630399
068200 6800-GET-VALID-DEPT.                                             06630499
068300                                                                  06630599
068400     PERFORM 6000-OPEN-VALID-DEPT-CURSOR.                         06631099
068500                                                                  06632099
068600     PERFORM 1800-LOAD-VALID-DEPT-TABLE                           06633099
068700       VARYING PV-INX FROM PC-1 BY PC-1                           06634099
068800             UNTIL PS-END-OF-DEPT-CURSOR                          06635099
068900                OR PC-DEPT-MAX LESS THAN PV-INX.                  06636099
069000                                                                  06637099
069100     IF  PV-INX GREATER THAN PC-DEPT-MAX                          06638099
069200         DISPLAY PC-PGM-NAME ' - **************************'      06639099
069300         DISPLAY PC-PGM-NAME ' - DEPT TABLE LIMITS EXCEEDED'      06639199
069400         DISPLAY PC-PGM-NAME ' - EXPAND DEPT TABLE'               06639299
069500         DISPLAY PC-PGM-NAME ' - **************************'      06639399
069600         SET PV-ABEND-4003 TO TRUE                                06639499
069700         PERFORM 9900-ABEND.                                      06639599
069800                                                                  06639699
069900     PERFORM 6500-CLOSE-VALID-DEPT-CURSOR.                        06639799
070000                                                                  06639899
070100******************************************************************06640007
070200* READ THE INPUT FILE                                             06650007
070300******************************************************************06660007
070400 7000-READ-ACTUALS-FILE.                                          06670072
070500                                                                  06680007
070600     EVALUATE PV-NUM-OF-WEEK-FILE                                 06690099
070700        WHEN 1                                                    06700099
070800          READ ACTUALS-IN1-FILE INTO PA135-RECORD                 06710099
070900             AT END                                               06720099
071000                SET PS-END-OF-INPUT TO TRUE                       06730099
071100                IF PV-ACTUALS-READ EQUAL ZERO                     06731099
071200                   SET PS-END-OF-PROCESS TO TRUE                  06732099
071300                END-IF                                            06733099
071400                ADD 1 TO PV-NUM-OF-WEEK-FILE                      06740099
071500                MOVE PV-ACTUALS-READ TO PV-FILE1-ACTUALS-READ     06740199
071600                MOVE ZEROES TO PV-ACTUALS-READ                    06741099
071700             NOT AT END                                           06750099
071800                IF PV-ACTUALS-READ EQUAL ZERO                     06751099
071900                   PERFORM 2100-GET-DATE-VALD-DEPT                06752099
072000                END-IF                                            06753099
072100                ADD PC-1 TO PV-ACTUALS-READ                       06760099
072200          END-READ                                                06770099
072300        WHEN 2                                                    06780099
072400          READ ACTUALS-IN2-FILE INTO PA135-RECORD                 06790099
072500             AT END                                               06800099
072600                SET PS-END-OF-INPUT TO TRUE                       06810099
072700                IF PV-ACTUALS-READ EQUAL ZERO                     06811099
072800                   SET PS-END-OF-PROCESS TO TRUE                  06812099
072900                END-IF                                            06813099
073000                ADD 1 TO PV-NUM-OF-WEEK-FILE                      06820099
073100                MOVE PV-ACTUALS-READ TO PV-FILE2-ACTUALS-READ     06820199
073200                MOVE ZEROES TO PV-ACTUALS-READ                    06821099
073300             NOT AT END                                           06830099
073400                IF PV-ACTUALS-READ EQUAL ZERO                     06831099
073500                   PERFORM 2100-GET-DATE-VALD-DEPT                06832099
073600                END-IF                                            06833099
073700                ADD PC-1 TO PV-ACTUALS-READ                       06840099
073800          END-READ                                                06850099
073900        WHEN 3                                                    06860099
074000          READ ACTUALS-IN3-FILE INTO PA135-RECORD                 06870099
074100             AT END                                               06880099
074200                SET PS-END-OF-INPUT TO TRUE                       06890099
074300                IF PV-ACTUALS-READ EQUAL ZERO                     06891099
074400                   SET PS-END-OF-PROCESS TO TRUE                  06892099
074500                END-IF                                            06893099
074600                ADD 1 TO PV-NUM-OF-WEEK-FILE                      06900099
074700                MOVE PV-ACTUALS-READ TO PV-FILE3-ACTUALS-READ     06900199
074800                MOVE ZEROES TO PV-ACTUALS-READ                    06901099
074900             NOT AT END                                           06910099
075000                IF PV-ACTUALS-READ EQUAL ZERO                     06911099
075100                   PERFORM 2100-GET-DATE-VALD-DEPT                06912099
075200                END-IF                                            06913099
075300                ADD PC-1 TO PV-ACTUALS-READ                       06920099
075400          END-READ                                                06930099
075500        WHEN 4                                                    06940099
075600          READ ACTUALS-IN4-FILE INTO PA135-RECORD                 06950099
075700             AT END                                               06960099
075800                SET PS-END-OF-INPUT TO TRUE                       06970099
075900                IF PV-ACTUALS-READ EQUAL ZERO                     06971099
076000                   SET PS-END-OF-PROCESS TO TRUE                  06972099
076100                END-IF                                            06973099
076200                ADD 1 TO PV-NUM-OF-WEEK-FILE                      06980099
076300                MOVE PV-ACTUALS-READ TO PV-FILE4-ACTUALS-READ     06980199
076400                MOVE ZEROES TO PV-ACTUALS-READ                    06981099
076500             NOT AT END                                           06990099
076600                IF PV-ACTUALS-READ EQUAL ZERO                     06991099
076700                   PERFORM 2100-GET-DATE-VALD-DEPT                06992099
076800                END-IF                                            06993099
076900                ADD PC-1 TO PV-ACTUALS-READ                       07000099
077000          END-READ                                                07010099
077100        WHEN 5                                                    07020099
077200          READ ACTUALS-IN5-FILE INTO PA135-RECORD                 07030099
077300             AT END                                               07040099
077400                SET PS-END-OF-INPUT TO TRUE                       07050099
077500                SET PS-END-OF-PROCESS TO TRUE                     07052099
077600                ADD 1 TO PV-NUM-OF-WEEK-FILE                      07060099
077700                MOVE PV-ACTUALS-READ TO PV-FILE5-ACTUALS-READ     07060199
077800                MOVE ZEROES TO PV-ACTUALS-READ                    07061099
077900             NOT AT END                                           07070099
078000                IF PV-ACTUALS-READ EQUAL ZERO                     07071099
078100                   PERFORM 2100-GET-DATE-VALD-DEPT                07072099
078200                END-IF                                            07073099
078300                ADD PC-1 TO PV-ACTUALS-READ                       07080099
078400          END-READ                                                07090099
078500     END-EVALUATE.                                                07100099
078600                                                                  07110099
078700*    IF PS-END-OF-INPUT AND PV-ACTUALS-READ EQUAL ZERO            07120099
078800*       SET PS-END-OF-PROCESS TO TRUE                             07130099
078900*    END-IF.                                                      07140099
079000                                                                  07150099
079100******************************************************************07160007
079200* WRITE THE GREC OUTPUT FILE                                      07170007
079300******************************************************************07180007
079400 7500-WRITE-GREC-OUTPUT.                                          07190072
079500                                                                  07200007
079600     WRITE GREC-UNITS-OUT-RECORD FROM BP150-ACTUAL-RECEIPTS.      07210088
079700                                                                  07220007
079800     ADD PC-1  TO PV-GREC-UNITS-WRITTEN.                          07230007
079900 EJECT                                                            07240007
080000******************************************************************07250007
080100* WRITE THE EOP OUTPUT FILE                                       07260007
080200******************************************************************07270007
080300 7600-WRITE-EOP-OUTPUT.                                           07280072
080400                                                                  07290007
080500     WRITE EOP-UNITS-OUT-RECORD FROM BP150-ACTUAL-INVBAL-EOP-CT.  07300088
080600                                                                  07310007
080700     ADD PC-1  TO PV-EOP-UNITS-WRITTEN.                           07320007
080800 EJECT                                                            07330007
080900******************************************************************07340007
081000*                                                                 07350007
081100******************************************************************07360007
081200 8000-EOJ-ROUTINE.                                                07370000
081300                                                                  07380000
081400     PERFORM 6600-CLOSE-PROC-DATES-CURSOR.                        07390099
081500                                                                  07400099
081600     CLOSE ACTUALS-IN1-FILE                                       07410099
081700           ACTUALS-IN2-FILE                                       07420099
081800           ACTUALS-IN3-FILE                                       07430099
081900           ACTUALS-IN4-FILE                                       07440099
082000           ACTUALS-IN5-FILE                                       07450099
082100           CONTROL-CARD-FILE                                      07460099
082200           GREC-UNITS-OUT-FILE                                    07470001
082300           EOP-UNITS-OUT-FILE.                                    07480099
082400                                                                  07490000
082500     DISPLAY '***** ' PC-PGM-NAME ' STATISTICS *****'.            07500008
082600     MOVE PV-FILE1-ACTUALS-READ     TO PV-DISPLAY-CNT.            07510099
082700     DISPLAY '*** FILE1 ITEM RECORDS READ: ' PV-DISPLAY-CNT.      07520099
082800     MOVE PV-FILE2-ACTUALS-READ     TO PV-DISPLAY-CNT.            07521099
082900     DISPLAY '*** FILE2 ITEM RECORDS READ: ' PV-DISPLAY-CNT.      07522099
083000     MOVE PV-FILE3-ACTUALS-READ     TO PV-DISPLAY-CNT.            07523099
083100     DISPLAY '*** FILE3 ITEM RECORDS READ: ' PV-DISPLAY-CNT.      07524099
083200     MOVE PV-FILE4-ACTUALS-READ     TO PV-DISPLAY-CNT.            07525099
083300     DISPLAY '*** FILE4 ITEM RECORDS READ: ' PV-DISPLAY-CNT.      07526099
083400     MOVE PV-FILE5-ACTUALS-READ     TO PV-DISPLAY-CNT.            07527099
083500     DISPLAY '*** FILE5 ITEM RECORDS READ: ' PV-DISPLAY-CNT.      07528099
083600     MOVE PV-GREC-UNITS-WRITTEN     TO PV-DISPLAY-CNT.            07530001
083700     DISPLAY '*** GREC RECORDS WRITTEN:   ' PV-DISPLAY-CNT.       07540000
083800     MOVE PV-EOP-UNITS-WRITTEN      TO PV-DISPLAY-CNT.            07550001
083900     DISPLAY '*** EOP RECORDS WRITTEN:   ' PV-DISPLAY-CNT.        07560000
084000                                                                  07570008
084100******************************************************************07580099
084200*                                                                 07590099
084300******************************************************************07600099
084400 9000-CALL-DP010.                                                 07610099
084500                                                                  07620099
084600     MOVE 12                      TO DP010I-MAXIMUM-DIGITS.       07630022
084700     MOVE ZEROES                  TO DP010I-MAXIMUM-DECIMALS.     07640010
084800     SET  DP010I-NEGATIVE-ALLOWED TO TRUE.                        07650010
084900                                                                  07660007
085000     CALL DP010I-NUMERIC-EDIT-ROUTINE USING                       07670010
085100                                   DP010I-NUMERIC-EDIT-AREA.      07680010
085200     IF DP010I-ERROR-DETECTED                                     07690019
085300         DISPLAY PC-PGM-NAME '- ***************************'      07700020
085400         DISPLAY PC-PGM-NAME ' - PROGRAM ABENDING'                07710020
085500         DISPLAY PC-PGM-NAME ' - INPUT DATA INVALID'              07720020
085600         DISPLAY PC-PGM-NAME ' - INPUT FIELD '                    07730020
085700                                 DP010I-UNEDITED-FIELD            07740020
085800         DISPLAY PC-PGM-NAME ' - ERROR INDICATOR '                07750020
085900                                 DP010I-ERROR-IND                 07760020
086000         DISPLAY PC-PGM-NAME ' - ***************************'     07770020
086100         SET PV-ABEND-4008 TO TRUE                                07780020
086200         PERFORM 9900-ABEND.                                      07790020
086300                                                                  07800099
11752A******************************************************************07801099
11752A*                                                                 07802099
11752A******************************************************************07803099
11752A 9010-CALL-DP010.                                                 07804099
11752A                                                                  07805099
11752A     MOVE 15                      TO DP010I-MAXIMUM-DIGITS.       07806099
11752A     MOVE 2                       TO DP010I-MAXIMUM-DECIMALS.     07807099
11752A     SET  DP010I-NEGATIVE-ALLOWED TO TRUE.                        07808099
11752A                                                                  07809099
11752A     CALL DP010I-NUMERIC-EDIT-ROUTINE USING                       07809199
11752A                                   DP010I-NUMERIC-EDIT-AREA.      07809299
11752A     IF DP010I-ERROR-DETECTED                                     07809399
11752A         DISPLAY PC-PGM-NAME '- ***************************'      07809499
11752A         DISPLAY PC-PGM-NAME ' - PROGRAM ABENDING'                07809599
11752A         DISPLAY PC-PGM-NAME ' - INPUT DATA INVALID'              07809699
11752A         DISPLAY PC-PGM-NAME ' - INPUT FIELD '                    07809799
11752A                                 DP010I-UNEDITED-FIELD            07809899
11752A         DISPLAY PC-PGM-NAME ' - ERROR INDICATOR '                07809999
11752A                                 DP010I-ERROR-IND                 07810099
11752A         DISPLAY PC-PGM-NAME ' - ***************************'     07810199
11752A         SET PV-ABEND-4008 TO TRUE                                07810299
11752A         PERFORM 9900-ABEND.                                      07810399
11752A                                                                  07810499
086400******************************************************************07811099
086500*                                                                 07820008
086600******************************************************************07830008
086700 9900-ABEND.                                                      07840008
086800     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         07850008
086900                                                                  07860028
087000******************************************************************07870028
087100*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL   *07880028
087200*                 ERROR OR WARNING CODE OCCURS.                  *07890028
087300******************************************************************07900028
087400 9999-SQL-ABEND.                                                  07910028
087500                                                                  07920028
087600     MOVE SQLCODE        TO  SQLCODE2.                            07930028
087700     MOVE SQLERRD(3)     TO  SQLERRD3.                            07940028
087800                                                                  07950028
087900     DISPLAY PC-PGM-NAME '***************************'            07960028
088000     DISPLAY PC-PGM-NAME '**       ABEND           **'            07970028
088100     DISPLAY PC-PGM-NAME '***************************'            07980028
088200     DISPLAY PC-PGM-NAME '** PARAGRAPH **      = '                07990028
088300                                       PV-PARAGRAPH-NAME          08000028
088400     DISPLAY PC-PGM-NAME '** OPERATION **      = '                08010028
088500                                       PV-DB2-OPER-ATTEMPTED      08020028
088600     DISPLAY PC-PGM-NAME '** ROWS PROCESSED ** = ' SQLERRD3.      08030028
088700     DISPLAY PC-PGM-NAME '** SQLCODE **        = ' SQLCODE2.      08040028
088800                                                                  08050028
088900     MOVE +4013         TO PV-ABEND-CODE                          08060028
089000     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         08070028
