000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400                                                                  00040001
000500 PROGRAM-ID.                VLKCS516.                             00050001
000600 AUTHOR.                    MICHAEL WALTERS.                      00060001
000700 INSTALLATION.              KOHLS DEPARTMENT STORES.              00070001
000800 DATE-WRITTEN.              06-03-96.                             00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100******************************************************************00110001
001200*  CICS PROGRAM - VLKCS516 - V516                                *00120002
001300*                                                                *00130001
001400*       PRETICKT SHIPMENT MAINTENANCE CRIT SPEC SCREEN           *00140002
001500*                                                                *00150001
001600*  THIS SCREEN WILL BE USED BY THE VENDOR LOGISTICS AS THE CRIT  *00160002
001700*  SPECIFICATION SCREEN FOR THE REST OF THE SHIPPING MAINTNENCE  *00170002
001800*  SYSTEM.                                                       *00180001
001900******************************************************************00190001
CICS  * CHANGED 11/14/2022    BY JIM HUNTER      WR: CHG0278236         00191016
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00192016
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00193016
CICS  ***************************************************************** 00194016
002000                                                                  00200001
002100 ENVIRONMENT DIVISION.                                            00210001
002400                                                                  00220001
002500 DATA DIVISION.                                                   00230001
002700                                                                  00240001
002800 WORKING-STORAGE SECTION.                                         00250001
002900*                                                                 00260001
003000 01  PV-PROGRAM-VARIABLES.                                        00270001
022100     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      00280001
022200                                                    COMP SYNC.    00290001
022100     05  PV-DATE-USA.                                             00291010
022200         10 PV-DATE-MM                  PIC  X(02)  VALUE SPACES. 00292010
022200         10 PV-SLASH1                   PIC  X(01)  VALUE '/'.    00293010
022200         10 PV-DATE-DD                  PIC  X(02)  VALUE SPACES. 00294010
022200         10 PV-SLASH2                   PIC  X(01)  VALUE '/'.    00294110
022200         10 PV-DATE-CC                  PIC  X(02)  VALUE SPACES. 00296010
022200         10 PV-DATE-YY                  PIC  X(02)  VALUE SPACES. 00297010
022100     05  PV-DATE-ISO.                                             00299010
022200         10 PV-DATE-CC                  PIC  X(02)  VALUE SPACES. 00299110
022200         10 PV-DATE-YY                  PIC  X(02)  VALUE SPACES. 00299210
022200         10 PV-DASH1                    PIC  X(01)  VALUE '-'.    00299310
022200         10 PV-DATE-MM                  PIC  X(02)  VALUE SPACES. 00299410
022200         10 PV-DASH2                    PIC  X(01)  VALUE '-'.    00299510
022200         10 PV-DATE-DD                  PIC  X(02)  VALUE SPACES. 00299610
022201*                                                                 00300001
022202 01  PC-PROGRAM-CONSTANTS.                                        00310001
022205     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'VL516A  '. 00320001
022206     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'VLKM516 '. 00330001
022207     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'VLKCS516'. 00340001
022207     05  PC-CALENDAR-PGM           PIC  X(08)  VALUE  'DPKUT500'. 00341006
022210     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00370001
022211                                               COMP-3.            00380001
022213     05  PC-TSYMSG-NUMBERS.                                       00400001
022214         10  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.      00410006
022221         10  PC-TSYMSG-01418       PIC  9(05)  VALUE  01418.      00471001
022221         10  PC-TSYMSG-01420       PIC  9(05)  VALUE  01420.      00472001
022222         10  PC-TSYMSG-01303       PIC  9(05)  VALUE  01303.      00480006
022224         10  PC-TSYMSG-01339       PIC  9(05)  VALUE  01339.      00482103
022237*                                                                 00540001
022238 01  PS-PROGRAM-SWITCHES.                                         00550001
022239     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        00560001
022240         88  PS-ERROR                          VALUE  'Y'.        00570001
022241         88  PS-NO-ERROR                       VALUE  'N'.        00580001
022242                                                                  00590001
022243 01  PM-PROGRAM-MESSAGES.                                         00600001
022244     05  PM-ABEND-INFO-A.                                         00610001
022245         10  FILLER                PIC X(15)   VALUE              00620001
022246                                   'DP020-SRC-AID: '.             00630001
022247         10  PM-A-SRC-AID          PIC X(02)   VALUE  SPACE.      00640001
022248         10  FILLER                PIC X(19)   VALUE              00650001
022249                                   '. DP020-FK-ACTION: '.         00660001
022250         10  PM-A-FK-ACTION        PIC X(01)   VALUE  SPACE.      00670001
022251         10  FILLER                PIC X(22)   VALUE              00680001
022252                                   '. DP020-FK-DISPN-IND: '.      00690001
022253         10  PM-A-FK-DISPN         PIC X(01)   VALUE  SPACE.      00700001
022254         10  FILLER                PIC X(01)   VALUE '.'.         00710001
022255         10  FILLER                PIC X(19)   VALUE SPACE.       00720001
022256                                                                  00730001
022257                                                                  00740001
022258*----------------------------------------------------------------*00750001
022259*    MAP LAYOUT                                                  *00760001
022260*----------------------------------------------------------------*00770001
022261                                                                  00780001
022262     COPY VLKM516.                                                00790001
022263                                                                  00800014
022264*----------------------------------------------------------------*00810001
022265*    ATTRIBUTE SETTINGS COPYBOOK.                                *00820001
022266*----------------------------------------------------------------*00830001
022267                                                                  00840001
022268     COPY DPWS015.                                                00850015
022269                                                                  00860001
022270*----------------------------------------------------------------*00870001
022271*    FUNCTION KEYS COPYBOOK                                      *00880001
022272*----------------------------------------------------------------*00890001
022273                                                                  00900001
022274     COPY DPWS016.                                                00910015
00231 *---------------------------------------------------------------* 00910101
00232 *    COPYBOOK FOR THE CALL TO RACF SECURITY SUBROUTINE          * 00910201
00233 *---------------------------------------------------------------* 00910301
00235      COPY DPWS008.                                                00910515
00236                                                                   00911001
006003*----------------------------------------------------------------*00911203
006004*    CURRENT DATE/TIME COPYBOOK                                  *00911303
006005*----------------------------------------------------------------*00911403
006007     COPY DPWS017.                                                00911615
                                                                        00911703
007201*----------------------------------------------------------------*00911803
007202*  DATE VALIDATION CALLING PARAMETER LIST                        *00911903
007203*----------------------------------------------------------------*00912003
007210     COPY DPWS500.                                                00912115
016600                                                                  00912203
022276******************************************************************00930001
022277** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **00940001
022278** SUB-ROUTINE (DPKUT100).                                      **00950001
022279******************************************************************00960001
022280     COPY DPWS010I.                                               00970015
022281                                                                  00980014
022282******************************************************************00990001
022283** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS            **01000001
022284** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **01010001
022285******************************************************************01020001
022286     COPY DPWS030.                                                01030015
CICS       COPY DPWS930.                                                01031016
022287                                                                  01040014
022288***************************************************************** 01050001
022289*    STANDARD COMMAREA.                                           01060001
022290***************************************************************** 01070001
022291                                                                  01080001
022292     COPY DPWS020.                                                01090015
022293     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01100001
022294                                                                  01110001
022295***************************************************************** 01120001
022296*    INTER-APPLICATION COMMAREA.                                  01130001
022297***************************************************************** 01140001
022298                                                                  01150001
022299         10  INTER-APPL-COMM-AREA PIC X(200).                     01160001
022300     COPY VLWS011.                                                01170015
022294                                                                  01171014
022301***************************************************************** 01180001
022302*    SPECIFIC COMMMAREA FOR VLKCS516.                             01190001
022303***************************************************************** 01200001
022304         10  ASC-SPECIFIC-COMMAREA.                               01210001
022305             15  ASC-DATE-LIMIT              PIC  X(10).          01220001
022307             15  ASC-SCAC-CODE               PIC  X(04).          01240003
022307             15  ASC-CARRIER-NAME            PIC  X(35).          01241001
022307             15  ASC-CARRIER-SHIP-NUMBER     PIC  X(18).          01242003
022307             15  ASC-SHIPT-GRP-ID            PIC S9(09) COMP.     01243005
022312             15  ASC-CURRENT-DATE            PIC  X(10).          01315001
022312             15  ASC-SHIPMENT-IND            PIC  X(01).          01316002
022313                 88 ASC-SHIPMENT-NOT-EXISTS       VALUE 'N'.      01317014
022314                 88 ASC-SHIPMENT-EXISTS           VALUE 'Y'.      01318014
022315                 88 ASC-SHIPMENT-DUPLICATE        VALUE 'D'.      01319014
022318                                                                  01320014
022319*----------------------------------------------------------------*01330001
022320*    ABEND PROCESSING COPYBOOK.                                  *01340001
022321*----------------------------------------------------------------*01350001
022322                                                                  01360001
022323     COPY DPWS013.                                                01370015
022324                                                                  01380001
022325*---------------------------------------------------------------* 01390001
022326*    DB2 AREA FOR COMMUNICATIONS                                * 01400001
022327*---------------------------------------------------------------* 01410001
022328     EXEC SQL                                                     01420001
022329          INCLUDE SQLCA                                           01430001
022330     END-EXEC.                                                    01440001
022340                                                                  01450001
022350*---------------------------------------------------------------* 01460001
022360*    DB2 AREA FOR THE PRETICKET REQEUSTE/SHIPPMENT ASSOCIATION  * 01470004
022370*---------------------------------------------------------------* 01480001
022380     EXEC SQL                                                     01490001
022390          INCLUDE TREQSHP                                         01500004
022400     END-EXEC.                                                    01510001
022500                                                                  01520001
022350*---------------------------------------------------------------* 01521004
022360*    DB2 AREA FOR THE PRETICKET SHIPMENT TABLE                  * 01522004
022370*---------------------------------------------------------------* 01523004
022380     EXEC SQL                                                     01524004
022390          INCLUDE TPTKSHP                                         01525004
022400     END-EXEC.                                                    01526004
022500                                                                  01527004
022350*---------------------------------------------------------------* 01528004
022360*    DB2 AREA FOR THE EXTERNAL ENTERPRISE TABLE                 * 01529004
022370*---------------------------------------------------------------* 01529104
022380     EXEC SQL                                                     01529204
022390          INCLUDE TEXTENT                                         01529304
022400     END-EXEC.                                                    01529404
022500                                                                  01529504
022600*---------------------------------------------------------------* 01530001
022700*    DB2 AREA FOR THE ENTERPRISE NAME TABLES                    * 01540001
022800*---------------------------------------------------------------* 01550001
022900     EXEC SQL                                                     01560001
023000          INCLUDE TENTNME                                         01570001
023100     END-EXEC.                                                    01580001
027303                                                                  01820001
027305 LINKAGE SECTION.                                                 01840001
027306                                                                  01850001
027307 01  DFHCOMMAREA.                                                 01860001
027308     05  FILLER                         OCCURS  1 TO 4072 TIMES   01870001
027309                                        DEPENDING ON EIBCALEN.    01880001
027310         10  FILLER                     PIC X.                    01890001
027311                                                                  01900001
027312                                                                  01910001
027313 PROCEDURE DIVISION.                                              01920001
027314***************************************************************** 01930001
027315** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 01940001
027316** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 01950001
027317** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 01960001
027318**                                                             ** 01970001
027319** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 01980001
027320** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 01990001
027321***************************************************************** 02000001
027322 0000-MAIN-MODULE.                                                02010001
027323     INITIALIZE DP030-CICS-API-FIELDS.                            02020001
027324     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02030001
027325     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02040001
027326     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02050001
027327     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02060001
027328     MOVE LENGTH OF VL516AI        TO DP030-MAP-LENGTH (1).       02070001
027329     MOVE PC-CURRENT-PROGRAM-NAME  TO DP013-PROGRAM.              02080001
027329     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02081001
027330     PERFORM 0001-CALL-CICS-ARCH-API.                             02090001
027331*                                                                 02100001
027332     PERFORM 1000-CONTROL-PROCESSING                              02110001
027333*                                                                 02120001
027334     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02130001
027335     PERFORM 0001-CALL-CICS-ARCH-API.                             02140001
027336                                                                  02150001
027337 0001-CALL-CICS-ARCH-API.                                         02160001
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02170016
027339                                    DFHCOMMAREA                   02180016
027340                                    DP030-CICS-API-FIELDS         02190016
027341                                    DP020-STANDARD-COMMAREA       02200016
027342                                    VL516AI.                      02210016
027343*                                                                 02220001
027344     IF  DP030-RC-CALL-SUCCESSFUL                                 02230001
027345         CONTINUE                                                 02240001
027346     ELSE                                                         02250001
027347         SET DP013-NO-ROLLBACK                                    02260001
027348             DP013-XCTL-DISPLAY-RESTART                           02270001
027349             DP013-CICS-ABEND      TO TRUE                        02280001
027350         MOVE 'BEFORE 0000-MAIN-MODULE'                           02290001
027351                                   TO DP013-PARAGRAPH             02300001
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O02301016
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02302016
027354         MOVE DP030-RETURN-CODE                                   02330001
027355                                   TO DP013-MESSAGE-TEXT (3)      02340001
027356         PERFORM DP013-0000-PROCESS-ABEND                         02350001
027357     END-IF.                                                      02360001
027358                                                                  02370014
027359*----------------------------------------------------------------*02380001
027360*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02390001
027361*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02400001
027362*----------------------------------------------------------------*02410001
027363                                                                  02420001
027364 1000-CONTROL-PROCESSING.                                         02430001
027365                                                                  02440001
027366     EVALUATE TRUE                                                02450001
027367         WHEN DP020-NEXT-ACT-INITIAL                              02460001
027368             INITIALIZE ASC-SPECIFIC-COMMAREA                     02470001
016610             PERFORM DP017-0000-GET-CURR-DATE-TIME                02471010
                                                                        02471108
                   MOVE DP017-EDITED-DATE-YYYYMMDD                      02472008
                               TO ASC-DATE-LIMIT                        02480008
                                  ASC-CURRENT-DATE                      02481008
                                                                        02482008
                   MOVE SPACES TO ASC-SCAC-CODE                         02490008
                                  ASC-CARRIER-NAME                      02490106
                                  ASC-CARRIER-SHIP-NUMBER               02490206
027371             PERFORM 4000-BUILD-INITIAL-PANEL                     02500001
027372                                                                  02510001
027373         WHEN DP020-NEXT-ACT-READ-MAP                             02520001
027374             PERFORM 2000-FKEY-PROCESSING                         02530001
027375                                                                  02540001
027376         WHEN DP020-NEXT-ACT-RETURN                               02550001
027377             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02560001
027378             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02570001
027379                                                                  02580001
027380         WHEN OTHER                                               02590001
027381             SET DP013-LOGIC-ABEND                                02600001
027382                 DP013-NO-ROLLBACK TO TRUE                        02610001
027383             MOVE '1000-CONTROL-PROCESSING'                       02620001
027384                                   TO  DP013-PARAGRAPH            02630001
027385             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   02640001
027386                                   TO  DP013-MESSAGE-TEXT(1)      02650001
027387             MOVE DP020-NEXT-APPL-ACTIVITY                        02660001
027388                                   TO DP013-MESSAGE-TEXT(2)       02670001
027389             PERFORM DP013-0000-PROCESS-ABEND                     02680001
027390     END-EVALUATE.                                                02690001
027391                                                                  02700001
027392*----------------------------------------------------------------*02710001
027393* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*02720001
027394* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*02730001
027395* EDITS.                                                         *02740001
027396*----------------------------------------------------------------*02750001
027398 2000-FKEY-PROCESSING.                                            02770001
027400     EVALUATE TRUE                                                02790001
027402         WHEN DP020-SRC-AID = DP016-CLEAR                         02810001
027403             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02820001
027404             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02830001
027406         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     02850001
027407             INITIALIZE ASC-SPECIFIC-COMMAREA                     02860001
027369             MOVE ASC-CURRENT-DATE                                02860108
                               TO ASC-DATE-LIMIT                        02860208
027370             MOVE SPACES TO ASC-SCAC-CODE                         02860308
                                  ASC-CARRIER-NAME                      02860406
                                  ASC-CARRIER-SHIP-NUMBER               02860506
027408             PERFORM 4000-BUILD-INITIAL-PANEL                     02870001
027409             PERFORM 3200-RESET-ATTRIBUTES                        02880001
027411         WHEN OTHER                                               02900001
027412             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 02910001
027413             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02920001
027414             IF  PS-NO-ERROR                                      02930001
027415                 SET DP030-CONTINUE-GO TO TRUE                    02940001
027416                 PERFORM 2100-CHECK-FUNCTION-KEY                  02950001
027417             ELSE                                                 02960001
027418                 SET DP030-OVERRIDE-GO TO TRUE                    02970001
027419             END-IF                                               02980001
027420     END-EVALUATE.                                                02990001
027420                                                                  02991014
027421******************************************************************03000001
027422** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **03010001
027423** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **03020001
027424** FROM THE CICS ARCHITECTURE API.                              **03030001
027425******************************************************************03040001
027426 2100-CHECK-FUNCTION-KEY.                                         03050001
027428     EVALUATE TRUE                                                03070001
027430*        WHEN THE UPDATE KEY IS PRESSED                           03081003
027440         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              03090003
027450             PERFORM 2110-PREPARE-INTER-APPL-COMM                 03090103
027430*        WHEN THE DELETE KEY IS PRESSED                           03091003
027440         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              03092003
027450             PERFORM 2110-PREPARE-INTER-APPL-COMM                 03092103
027731*        WHEN THE SHIPLIST KEY IS PRESSED                         03093003
027732         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              03094003
027450             PERFORM 2110-PREPARE-INTER-APPL-COMM                 03100003
028401         WHEN DP020-SRC-AID = DP016-ENTER                         03135501
028402             CONTINUE                                             03136001
028404         WHEN OTHER                                               03150001
028405             SET DP013-NO-ROLLBACK                                03160001
028406                 DP013-XCTL-DISPLAY-RESTART                       03170001
028407                 DP013-CICS-ABEND  TO TRUE                        03180001
028408             MOVE '2100-CHECK-FUNCTION-KEY'                       03190001
028409                                   TO DP013-PARAGRAPH             03200001
028410             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      03210001
028411                                   TO DP013-MESSAGE-TEXT (1)      03220001
028412             MOVE 'OR CODE MISSING FROM THIS PROGRAM TO PROCESS:' 03230001
028413                                   TO DP013-MESSAGE-TEXT (2)      03240001
028414             MOVE DP020-SRC-AID    TO PM-A-SRC-AID                03250001
028415             MOVE DP020-FK-ACTION (DP020-SRC-AID)                 03260001
028416                                   TO PM-A-FK-ACTION              03270001
028417             MOVE DP020-FK-DISPN-IND (DP020-SRC-AID)              03280001
028418                                   TO PM-A-FK-DISPN               03290001
028419             MOVE PM-ABEND-INFO-A  TO DP013-MESSAGE-TEXT (3)      03300001
028420             MOVE 'REVIEW PFKEYS SETUP FOR THIS MNEMONIC.'        03310001
028421                                   TO DP013-MESSAGE-TEXT (4)      03320001
028422             PERFORM DP013-0000-PROCESS-ABEND                     03330001
028423     END-EVALUATE.                                                03340001
028423                                                                  03341014
028424******************************************************************03350001
028425** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **03360001
028426** INTER-APPLICATION COMMAREA.                                  **03370001
028427******************************************************************03380001
028428 2110-PREPARE-INTER-APPL-COMM.                                    03390001
028429     INITIALIZE VL011-INTER-APPL-COMMAREA.                        03400003
028430     MOVE ASC-DATE-LIMIT           TO VL011-DATE-LIMIT.           03410003
028431     MOVE ASC-SCAC-CODE            TO VL011-SCAC-CODE.            03420003
028432     MOVE ASC-SHIPT-GRP-ID         TO VL011-SHIPT-GRP-ID.         03440014
                                                                        03450003
028436*----------------------------------------------------------------*03520001
028437* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*03530001
028438* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *03540001
028439* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *03550001
028440*----------------------------------------------------------------*03560001
028442 2200-MOVE-SCREEN-TO-COMMAREA.                                    03580001
028443     IF  ADTELMTL > ZERO                                          03590001
               IF ADTELMTI = SPACES                                     03591012
                   MOVE ASC-CURRENT-DATE TO ASC-DATE-LIMIT              03591112
                                            PV-DATE-ISO                 03591213
                   MOVE CORR PV-DATE-ISO TO PV-DATE-USA                 03591313
                   MOVE PV-DATE-USA      TO ADTELMTO                    03591413
               ELSE                                                     03592012
028444             MOVE ADTELMTI         TO PV-DATE-USA                 03600012
028444             MOVE CORR PV-DATE-USA TO PV-DATE-ISO                 03601012
028444             MOVE PV-DATE-ISO      TO ASC-DATE-LIMIT              03602012
028445         END-IF                                                   03610012
028445     ELSE                                                         03611012
028446         IF  ADTELMTF = DP015-ERASE-EOF                           03620001
                   MOVE ASC-CURRENT-DATE TO ASC-DATE-LIMIT              03632012
028448         END-IF                                                   03640001
028449     END-IF.                                                      03650001
028450                                                                  03660001
028451     IF  ASCACL > ZERO                                            03670001
028452         MOVE ASCACI               TO ASC-SCAC-CODE               03680003
028453     ELSE                                                         03690001
028454         IF  ASCACF = DP015-ERASE-EOF                             03700001
028455             MOVE SPACE            TO ASC-SCAC-CODE               03710003
028456         END-IF                                                   03720001
028457     END-IF.                                                      03730001
028458                                                                  03740001
028459     IF  ASHPNBRL > ZERO                                          03750001
028460         MOVE ASHPNBRI             TO ASC-CARRIER-SHIP-NUMBER     03760003
028461     ELSE                                                         03770001
028462         IF  ASHPNBRF = DP015-ERASE-EOF                           03780001
028463             MOVE SPACE            TO ASC-CARRIER-SHIP-NUMBER     03790003
028464         END-IF                                                   03800001
028465     END-IF.                                                      03810001
028466                                                                  03820001
029200*----------------------------------------------------------------*03830001
029300* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *03840001
029400* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *03850001
029500* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*03860001
029600* IN THE DESTINATION PROGRAM, NOT HERE.                          *03870001
029700*----------------------------------------------------------------*03880001
029900 3000-EDIT-DATA-IN-COMMAREA.                                      03900001
030000     PERFORM 3200-RESET-ATTRIBUTES.                               03910001
032300                                                                  03920014
032400     IF  ASC-CARRIER-SHIP-NUMBER = SPACES                         04360003
027440         IF DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                04361203
027440         OR DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)                04361603
032700             SET PS-ERROR                                         04361703
032800                 DP020-MSG-FATAL   TO TRUE                        04361803
032900             MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER            04361903
033000             MOVE DP015-UNP-ALP-BRT-OFF                           04362003
033100                                   TO ASHPNBRA                    04362103
033200             MOVE DP015-RED        TO ASHPNBRC                    04362203
033300             MOVE DP015-REVERSE    TO ASHPNBRH                    04362303
033400             MOVE -1               TO ASHPNBRL                    04362403
033500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  04362503
032700         END-IF                                                   04362603
032750     ELSE                                                         04363014
032500         PERFORM 3100-VALIDATE-CARR-SHIP-NBR                      04370006
032600         IF SQLCODE = +100                                        04380003
032700             SET PS-ERROR                                         04390003
032800                 DP020-MSG-FATAL   TO TRUE                        04400003
032900             MOVE PC-TSYMSG-01303  TO DP020-MSG-NUMBER            04410003
033000             MOVE DP015-UNP-ALP-BRT-OFF                           04420003
033100                                   TO ASHPNBRA                    04430003
033200             MOVE DP015-RED        TO ASHPNBRC                    04440003
033300             MOVE DP015-REVERSE    TO ASHPNBRH                    04450003
033400             MOVE -1               TO ASHPNBRL                    04460003
033500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  04470003
033550         END-IF                                                   04471014
033600     END-IF.                                                      04480003
033700*                                                                 04490001
033800     IF  ASC-SCAC-CODE > SPACES                                   04500003
032500         PERFORM 3300-VALIDATE-SCAC-CODE                          04501003
032600         IF SQLCODE = +0                                          04502003
                   MOVE ENTNME-ENT-NAME-DESC                            04502103
                                         TO ASC-CARRIER-NAME            04502203
                                            ACARNMEO                    04502313
               ELSE                                                     04502403
032700             SET PS-ERROR                                         04503002
032800                 DP020-MSG-FATAL   TO TRUE                        04504002
032900             MOVE PC-TSYMSG-01303  TO DP020-MSG-NUMBER            04505002
033000             MOVE DP015-UNP-ALP-BRT-OFF                           04506002
033100                                   TO ASCACA                      04507003
033200             MOVE DP015-RED        TO ASCACC                      04508003
033300             MOVE DP015-REVERSE    TO ASCACH                      04509003
033400             MOVE -1               TO ASCACL                      04509103
033500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  04509202
               END-IF                                                   04509302
           END-IF.                                                      04509402
032966*                                                                 04730103
032967*    DATE LIMIT EDIT CHECK                                        04730203
032968*                                                                 04730303
035516     MOVE DP017-CURRENT-DATE-YMD TO DPG51-SYSTEM-DATE.            04730403
035518     MOVE ASC-DATE-LIMIT         TO DPG52-LK-DATE-INPUT.          04730503
035519     SET DPG52-LK-DTE-ISO-FMT    TO TRUE.                         04730603
035520     SET DPG51-ACTUAL-CALENDAR-ONLY                               04730703
035521                                 TO TRUE.                         04730803
035522     SET DPG51-DO-NOT-INCR-DECR-DATE                              04730903
035523                                 TO TRUE.                         04731003
035524     CALL PC-CALENDAR-PGM USING DPG51 DPG52                       04731103
035525                                DPG53 DPG54                       04731203
035526                                DPG55 DPG56.                      04731303
035527     EVALUATE TRUE                                                04731403
035542         WHEN DPG54-NO-ERROR                                      04731503
035543             CONTINUE                                             04731603
035544                                                                  04731703
035545         WHEN DPG54-DATE-INVALID                                  04731803
035546             MOVE PC-TSYMSG-01339 TO DP020-MSG-NUMBER             04731903
035547             MOVE DP015-UNP-ALP-BRT-OFF                           04732003
035548                                  TO ADTELMTA                     04732103
035549             MOVE DP015-RED       TO ADTELMTC                     04732203
035550             MOVE DP015-REVERSE   TO ADTELMTH                     04732303
035551             MOVE -1              TO ADTELMTL                     04732403
035552             SET DP030-SET-CURSOR-APPL-1                          04732503
035552                 DP020-MSG-FATAL                                  04732609
035552                 PS-ERROR         TO TRUE                         04732709
035554                                                                  04732803
035555         WHEN DPG54-SEVERE-ERROR                                  04732903
035556             SET DP013-NO-ROLLBACK                                04733003
035557                                  TO TRUE                         04733103
035558             SET DP013-XCTL-DISPLAY-RESTART                       04733203
035559                                  TO TRUE                         04733303
035560             SET DP013-CICS-ABEND TO TRUE                         04733403
035561             MOVE '3000-EDIT-COMMAREA'                            04733503
035562                                   TO DP013-PARAGRAPH             04733603
035563             MOVE 'INVALID CALENDAR ROUTINE CALL'                 04733703
035564                                   TO DP013-MESSAGE-TEXT (1)      04733803
035565             MOVE DPG54-ERROR-MESSAGE                             04733903
035566                                   TO DP013-MESSAGE-TEXT (2)      04734003
035567             PERFORM DP013-0000-PROCESS-ABEND                     04734103
035568     END-EVALUATE.                                                04735003
035600*                                                                 04740003
037975     IF  PS-NO-ERROR                                              05030001
037976         MOVE -1                   TO ADTELMTL                    05040003
037977         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      05050014
037979     END-IF.                                                      05070001
037980                                                                  05071014
037980******************************************************************05080001
037981** VALIDATES THE EXISTENCE OF THE CARRIER SHIP NBR              **05090001
037982******************************************************************05100001
037983 3100-VALIDATE-CARR-SHIP-NBR.                                     05110006
093800     EXEC SQL                                                     05221005
093900          SELECT DISTINCT B.SHIPT_GRP_ID                          05222005
094000          INTO  :ASC-SHIPT-GRP-ID                                 05223005
094100          FROM TPTKSHP A                                          05224005
094100             , TREQSHP B                                          05224105
I94300          WHERE A.CARR_SHIPT_ID = :ASC-CARRIER-SHIP-NUMBER        05225005
                  AND A.SHIPT_NBR = B.SHIPT_NBR                         05225105
09450      END-EXEC.                                                    05226005
09451                                                                   05230005
094600     EVALUATE TRUE                                                05240003
094700         WHEN SQLCODE = ZERO                                      05250003
094800         WHEN SQLCODE = +100                                      05260003
                   CONTINUE                                             05261003
095200         WHEN SQLWARN0 NOT = SPACES                               05280003
095300         WHEN SQLCODE < ZERO                                      05290003
095400         WHEN SQLCODE > ZERO                                      05300003
095500             MOVE '3100-VALIDATE-CARR-SHIP-NBR'                   05310006
095600                               TO DP013-PARAGRAPH                 05320003
095700             MOVE 'SELECT PRETICKET SHIPMENT'                     05330003
095800                               TO DP013-MESSAGE-TEXT (1)          05340003
095700             MOVE ASC-CARRIER-SHIP-NUMBER                         05341003
095800                               TO DP013-MESSAGE-TEXT (2)          05342003
095900             MOVE SQLCA        TO DP013-SQLCA                     05350003
096000             MOVE 'TPTKSHP '   TO DP013-DB2-TABLE-NAME (1)        05360003
096100             SET DP013-DB2-ABEND                                  05370003
096200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               05380003
096300             PERFORM DP013-0000-PROCESS-ABEND                     05390003
096400     END-EVALUATE.                                                05400003
096400                                                                  05410014
188677******************************************************************07009001
188678** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **07010001
188679** MAP.                                                         **07020001
188680******************************************************************07030001
188681 3200-RESET-ATTRIBUTES.                                           07040001
188682     MOVE DP015-UNP-ALP-NOR-OFF    TO ADTELMTA                    07050002
188683                                      ASCACA                      07060002
188684                                      ASHPNBRA.                   07070002
188685     MOVE DP015-GREEN              TO ADTELMTC                    07080002
188686                                      ASCACC                      07090002
188687                                      ASHPNBRC.                   07100002
188688     MOVE DP015-UNDERLINE          TO ADTELMTH                    07110002
188689                                      ASCACH                      07120002
188690                                      ASHPNBRH.                   07130002
188700                                                                  07131014
037980******************************************************************07132103
037981** VALIDATES THE EXISTENCE OF THE SCAC CODE ENTERED             **07132203
037982******************************************************************07132303
037983 3300-VALIDATE-SCAC-CODE.                                         07132403
267309     PERFORM                                                      07132603
267310         WITH TEST AFTER                                          07132703
267311         VARYING PV-RETRY-COUNTER                                 07132803
267312         FROM 1 BY 1                                              07132903
267313         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07133003
267314                   OR (SQLCODE = ZERO)                            07133103
267315                   OR (SQLCODE = +100))                           07133203
267316                                                                  07133303
267317         EXEC SQL                                                 07133403
267319             SELECT  ENT_NAME_DESC                                07133512
267321             INTO    :ENTNME-ENT-NAME-DESC                        07133603
267323             FROM    TEXTENT A                                    07133703
267323                ,    TENTNME B                                    07133803
267325             WHERE A.SCAC_CDE = :ASC-SCAC-CODE                    07133903
267326               AND A.CARRIER_IND = 'Y'                            07134003
267327               AND A.STATUS_CDE = 'A'                             07134103
                     AND A.ENT_ID = B.ENT_ID                            07134203
                     AND B.TYPE_CDE = '01'                              07134303
267328         END-EXEC                                                 07134403
267329                                                                  07134503
267330         EVALUATE TRUE                                            07134603
267331             WHEN SQLCODE = ZERO                                  07134703
267332             WHEN SQLCODE = +100                                  07134803
267333                 CONTINUE                                         07134903
267334                                                                  07135003
267335             WHEN SQLCODE = -904                                  07135103
267336             WHEN SQLCODE = -913                                  07135203
267337                 CONTINUE                                         07135303
267338                                                                  07135403
267339             WHEN SQLWARN0 NOT = SPACES                           07135503
267340             WHEN SQLCODE < ZERO                                  07135603
267341             WHEN SQLCODE > ZERO                                  07135703
267342                 MOVE '3300-VALIDATE-SCAC-CODE'                   07135803
267343                                   TO DP013-PARAGRAPH             07135903
267344                 MOVE 'SELECT THE SCAC CODE'                      07136003
267345                                   TO DP013-MESSAGE-TEXT (1)      07136103
267346                 MOVE ASC-SCAC-CODE TO DP013-MESSAGE-TEXT (2)     07136203
267347                 MOVE SQLCA        TO DP013-SQLCA                 07136303
267348                 MOVE 'TEXTENT '   TO DP013-DB2-TABLE-NAME (1)    07136403
267349                 SET DP013-DB2-ABEND                              07136503
267350                     DP013-XCTL-DISPLAY-RESTART TO TRUE           07136603
267351                 PERFORM DP013-0000-PROCESS-ABEND                 07136703
267352         END-EVALUATE                                             07136803
267353     END-PERFORM.                                                 07136903
267354*                                                                 07137003
267355     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07137103
267356         MOVE '3300-VALIDATE-SCAC-CODE'                           07137203
267357                                   TO DP013-PARAGRAPH             07137303
267358         MOVE 'MAXIMUM RETRIES EXCEEDED SELECTING SCAC CDE'       07137403
267359                                   TO DP013-MESSAGE-TEXT (1)      07137503
267360         MOVE ASC-SCAC-CODE        TO DP013-MESSAGE-TEXT (1)      07137603
267361         MOVE SQLCA                TO DP013-SQLCA                 07137703
267362         MOVE 'TEXTENT '           TO DP013-DB2-TABLE-NAME (1)    07137803
267363         SET DP013-DB2-ABEND                                      07137903
267364             DP013-XCTL-DISPLAY-RESTART                           07138003
267365                                   TO TRUE                        07138103
267366         PERFORM DP013-0000-PROCESS-ABEND                         07138203
267367     END-IF.                                                      07138303
189525                                                                  07147014
189526*----------------------------------------------------------------*07150001
189527*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *07160001
189528*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *07170001
189529*  IT HERE.                                                      *07180001
189530*----------------------------------------------------------------*07190001
189531 4000-BUILD-INITIAL-PANEL.                                        07200001
189532     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        07210001
189533     MOVE -1                       TO ADTELMTL.                   07220001
189535     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        07221201
190027                                                                  07239014
190028*----------------------------------------------------------------*07240001
190029*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *07250001
190030*----------------------------------------------------------------*07260001
190031 4400-MOVE-COMMAREA-TO-SCREEN.                                    07270001
190032     MOVE ASC-DATE-LIMIT           TO PV-DATE-ISO.                07280012
190032     MOVE CORR PV-DATE-ISO         TO PV-DATE-USA.                07281012
190032     MOVE PV-DATE-USA              TO ADTELMTO.                   07282012
190033     MOVE ASC-SCAC-CODE            TO ASCACO.                     07290003
190033     MOVE ASC-CARRIER-NAME         TO ACARNMEO.                   07291001
190034     MOVE ASC-CARRIER-SHIP-NUMBER  TO ASHPNBRO.                   07300003
190035                                                                  07310014
190036*----------------------------------------------------------------*07320001
190037*    ABEND PROCESSOR MODULE                                      *07330001
190038*----------------------------------------------------------------*07340001
190040     COPY DPPD013.                                                07360015
190039                                                                  07361003
037001*----------------------------------------------------------------*07370003
037002*    GET CURRENT DATE AND TIME                                   *07380003
037003*----------------------------------------------------------------*07390003
037100     COPY DPPD017.                                                07410015
037010                                                                  07420003
