000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.      MAKUT145.                                       00020000
000300 AUTHOR.          L. GRIESBACH.                                   00030000
000400 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00040000
000500                                                                  00050000
000600***************************************************************** 00060000
000700**  THIS PROGRAM PROCESSES MERCHANDISE BRIDGING RECORDS FOR    ** 00070000
000800**  THE DIVISION, GROUPS, DEPS, CLASS, AND SUBCLASS TABLES.    ** 00080000
000900**                                                             ** 00090000
001000**  THE INPUT RECORDS TO THIS PROGRAM ARE GENERATED IN RMS.    ** 00100000
001100**  IN RMS, USERS MUST DO A TRANSACTION FOR EACH PIECE OF THE  ** 00110000
001200**  STRUCTURE.  INSERTIONS MUST BE DONE FROM THE TOP DOWN I.E. ** 00120000
001300**  GMA, DMA, DPT, MCL, SCL.  DELETIONS MUST BE DONE FROM THE  ** 00130000
001400**  BOTTOM UP I.E. SCL, MCL, DPT, DMA, GMA.  SO USERS CANNOT   ** 00140000
001500**  ADD A NEW MERCH LEVEL IF THE LEVEL ABOVE IT DOES NOT EXIST.** 00150000
001600**  LIKEWISE, THEY CANNOT DELETE A PART OF THE STRUCTURE WHEN  ** 00160000
001700**  A LEVEL BELOW IT IS STILL ACTIVE.                          ** 00170000
001800**                                                             ** 00180000
001900**  THE LOGIC IN THIS PROGRAM DOES NOT VALIDATE THE INTEGRITY  ** 00190000
002000**  OF THE DATA COMING FROM RMS.  FOR INSERTS, THERE IS NO     ** 00200000
002100**  VERIFICATION THAT THE MERCH LEVEL BEING INSERTED HAS AN    ** 00210000
002200**  ACTIVE PARENT ON TITMCLT - BEFORE IT INSERTS THE RECORD.   ** 00220000
002300**  FOR DELETIONS, THERE IS NO VERIFICATION THAT THE MERCH     ** 00230000
002400**  LEVEL BEING DELETED HAS ALL OF ITS CHILDREN EXPIRED ON     ** 00240000
002500**  TITMCLT - BEFORE IT EXPIRES THE RECORD.                    ** 00250000
002600**                                                             ** 00260000
002700**                                                             ** 00270000
002800***************************************************************** 00280000
002900*    WR/PITS#     DATE        DESCRIPTION                       * 00290000
003000*    --------   --------   -----------------------------------  * 00300000
003100***************************************************************** 00310000
003200* 09/02/2016 CHG0150794                                           00320000
003300*            REMOVED THE LOGIC WRITTING ERROR RECORDS TO OUTPUT   00330000
003400*            ERROR FILE FOR DUPLICATE INSERTS IN DIVISION,GROUPS  00340000
003500*            DEPS,CLASS AND SUBCLASS TABLES. CHANGE TAG - RMSRET  00350000
003600*            - COGNIZANT                                          00360000
070941***************************************************************** 00361004
070941* 07/30/2018 CHG0205458                                           00362005
070941*            ORACLE LOGON STANDARDS PROGRAM CHANGE                00363004
070941*            - COGNIZANT                                          00364004
070941******************************************************************00366004
003800                                                                  00380000
003900 ENVIRONMENT DIVISION.                                            00390000
004000 CONFIGURATION SECTION.                                           00400000
004100                                                                  00410000
004200 SOURCE-COMPUTER.       IBM-3090.                                 00420000
004300 OBJECT-COMPUTER.       IBM-3090.                                 00430000
004400                                                                  00440000
004500 INPUT-OUTPUT SECTION.                                            00450000
004600                                                                  00460000
004700 FILE-CONTROL.                                                    00470000
004800     SELECT MERCH-FILE              ASSIGN TO INP01.              00480000
004900                                                                  00490000
005000     SELECT ERROR-FILE              ASSIGN TO OUT01.              00500000
005001                                                                  00500101
005010     SELECT ORACLE-LOGON-FILE       ASSIGN TO ORALOGON.           00501001
005100                                                                  00510000
005300                                                                  00530001
005400                                                                  00540001
005500 DATA DIVISION.                                                   00550000
005600 FILE SECTION.                                                    00560000
005700                                                                  00570000
005800 FD  MERCH-FILE                                                   00580000
005900     RECORDING MODE F                                             00590000
006000     LABEL RECORDS OMITTED                                        00600000
006100     BLOCK CONTAINS  0 RECORDS.                                   00610000
006200 01  MERCH-RECORD                   PIC X(500).                   00620000
006300                                                                  00630000
006400 FD  ERROR-FILE                                                   00640000
006500     RECORDING MODE F                                             00650000
006600     LABEL RECORDS OMITTED                                        00660000
006700     BLOCK CONTAINS  0 RECORDS.                                   00670000
006800 01  ERROR-RECORD                   PIC X(80).                    00680000
006900                                                                  00690000
006910 FD  ORACLE-LOGON-FILE                                            00691001
006920     RECORDING MODE IS F                                          00692001
006930     LABEL RECORDS ARE STANDARD                                   00693001
006940     BLOCK CONTAINS 0 RECORDS                                     00694001
006950     RECORD CONTAINS 80 CHARACTERS                                00695001
006960     DATA RECORDS IS OL-ORACLE-LOGON-RECORD.                      00696001
006980 01  OL-ORACLE-LOGON-RECORD          PIC X(80).                   00698001
006990                                                                  00699001
007000 WORKING-STORAGE SECTION.                                         00700000
007100 01  WS-SWITCHES.                                                 00710000
007110     05  PS-END-OF-LOGON-FILE-SW    PIC X(01)    VALUE 'N'.       00711001
007120         88  PS-END-OF-LOGON-FILE                VALUE 'Y'.       00712001
007130     05  PS-END-OF-PROC-INST-FILE-SW PIC X(01)   VALUE 'N'.       00713001
007140         88  PS-END-OF-PROC-INST-FILE            VALUE 'Y'.       00714001
007150         88  PS-NOT-END-OF-PROC-INST-FILE        VALUE 'N'.       00715001
007160     05  PS-ORA-SRC-CTL-DONE-SW     PIC X(01)    VALUE 'N'.       00716001
007170         88  PS-ORA-SRC-EMPTY                    VALUE 'Y'.       00717001
007200     05  WS-TITMCLT-RCD-SW          PIC X(1)     VALUE 'N'.       00720000
007300         88  TITMCLT-RCD-EXISTS                  VALUE 'Y'.       00730000
007400         88  TITMCLT-RCD-DOES-NOT-EXIST          VALUE 'N'.       00740000
007500     05  WS-TITMCLC-RCD-SW          PIC X(1)     VALUE 'N'.       00750000
007600         88  TITMCLC-RCD-EXISTS                  VALUE 'Y'.       00760000
007700         88  TITMCLC-RCD-DOES-NOT-EXIST          VALUE 'N'.       00770000
007800     05  WS-MERCH-FILE-SW           PIC X(1)     VALUE 'N'.       00780000
007900         88  MERCH-EOF                           VALUE 'Y'.       00790000
008000         88  MERCH-NOT-EOF                       VALUE 'N'.       00800000
008100     05  WS-ROWS-SW                 PIC X(1)     VALUE 'N'.       00810000
008200         88  MORE-ROWS                           VALUE 'Y'.       00820000
008300         88  NO-MORE-ROWS                        VALUE 'N'.       00830000
008400     05  WS-CLC-RELATIONSHIPS-SW    PIC X(1)     VALUE 'N'.       00840000
008500         88  MORE-CLC-RELATIONSHIPS              VALUE 'Y'.       00850000
008600         88  NO-MORE-CLC-RELATIONSHIPS           VALUE 'N'.       00860000
008700     05  WS-CLC-EXPIRE-SW           PIC X(1)     VALUE 'N'.       00870000
008800         88  EXPIRE-RELATIONSHIP                 VALUE 'Y'.       00880000
008900         88  DO-NOT-EXPIRE-RELATIONSHIP          VALUE 'N'.       00890000
009000                                                                  00900000
009010                                                                  00901001
009020 01  CC-ORACLE-CONNECTION.                                        00902001
009030     05  CC-ORACLE-USERID             PIC X(40).                  00903001
009040         88 CC-AUTO-LOGON                         VALUE '/'.      00904001
009050     05  CC-ORACLE-PASSWORD           PIC X(40).                  00905001
009060                                                                  00906001
009100 01  WS-CONSTANTS.                                                00910000
009110     05  PC-AUTO-LOGON              PIC X(01)    VALUE '/'.       00911001
009200     05  WS-CO                      PIC X(2)     VALUE 'CO'.      00920000
009300     05  WS-GMA                     PIC X(3)     VALUE 'GMA'.     00930000
009400     05  WS-DMA                     PIC X(3)     VALUE 'DMA'.     00940000
009500     05  WS-DPT                     PIC X(3)     VALUE 'DPT'.     00950000
009600     05  WS-MCL                     PIC X(3)     VALUE 'MCL'.     00960000
009700     05  WS-SCL                     PIC X(3)     VALUE 'SCL'.     00970000
009800     05  WS-DIVISION-TABLE          PIC X(30)    VALUE            00980000
009900         'DIVISION                      '.                        00990000
010000     05  WS-GROUPS-TABLE            PIC X(30)    VALUE            01000000
010100         'GROUPS                        '.                        01010000
010200     05  WS-DEPS-TABLE              PIC X(30)    VALUE            01020000
010300         'DEPS                          '.                        01030000
010400     05  WS-CLASS-TABLE             PIC X(30)    VALUE            01040000
010500         'CLASS                         '.                        01050000
010600     05  WS-SUBCLASS-TABLE          PIC X(30)    VALUE            01060000
010700         'SUBCLASS                      '.                        01070000
010800     05  WS-MAX-SIZE                PIC S9(9)    COMP             01080000
010900                                                 VALUE 512.       01090000
011000     05  WS-INITIAL-END-TMST        PIC X(19)    VALUE            01100000
011100                                    '0000-00-00-23.59.59'.        01110000
011200     05  WS-MSGS.                                                 01120000
011300         10  WS-CORP-NOT-FOUND      PIC X(40)    VALUE            01130000
011400             'CORP NOT FOUND ON TITMCLT               '.          01140000
011500         10  WS-GMA-NOT-FOUND       PIC X(40)    VALUE            01150000
011600             'GMA NOT FOUND ON TITMCLT                '.          01160000
011700         10  WS-DMA-NOT-FOUND       PIC X(40)    VALUE            01170000
011800             'DMA NOT FOUND ON TITMCLT                '.          01180000
011900         10  WS-DPT-NOT-FOUND       PIC X(40)    VALUE            01190000
012000             'DPT NOT FOUND ON TITMCLT                '.          01200000
012100         10  WS-MCL-NOT-FOUND       PIC X(40)    VALUE            01210000
012200             'MCL NOT FOUND ON TITMCLT                '.          01220000
012300         10  WS-CLUSTER-NOT-FOUND   PIC X(40)    VALUE            01230000
012400             'CLUSTER NOT FOUND ON TITMCLT            '.          01240000
012500         10  WS-COULD-NOT-INSERT    PIC X(40)    VALUE            01250000
012600             'COULD NOT INSERT RELATION ON TITMCLC    '.          01260000
012700         10  WS-COULD-NOT-REALIGN   PIC X(40)    VALUE            01270000
012800             'COULD NOT REALIGN RELATION ON TITMCLC   '.          01280000
012900         10  WS-RCD-EXISTS-ON-INSERT                              01290000
013000                                    PIC X(40)    VALUE            01300000
013100             'RCD BEING INSERTED ALREADY EXISTS ON CLT'.          01310000
013200         10  WS-COULD-NOT-PROCESS-TABLE                           01320000
013300                                    PIC X(40)    VALUE            01330000
013400             'COULD NOT PROCESS TABLE                 '.          01340000
013500                                                                  01350000
013600 01  WS-VARIABLES.                                                01360000
013610     05  PV-ORACLE-USERID-LEN           PIC S9(04)  VALUE ZEROS   01361001
013620                                                    COMP SYNC.    01362001
013630     05  PV-ORACLE-PASSWORD-LEN         PIC S9(04)  VALUE ZEROS   01363001
013640                                                    COMP SYNC.    01364001
013700     05  WS-ITEM-CLUSTR-NAME-CORP.                                01370000
013800         10  WS-ITEM-CLUSTR-CORP    PIC X(4)     VALUE 'CORP'.    01380000
013900         10  FILLER                 PIC X(16)    VALUE SPACES.    01390000
014000     05  WS-ITEM-CLUSTR-NAME-GMA.                                 01400000
014100         10  WS-ITEM-CLUSTR-GMA     PIC X(2).                     01410000
014200         10  FILLER                 PIC X(18)    VALUE SPACES.    01420000
014300     05  WS-ITEM-CLUSTR-NAME-DMA.                                 01430000
014400         10  WS-ITEM-CLUSTR-DMA     PIC X(2).                     01440000
014500         10  FILLER                 PIC X(18)    VALUE SPACES.    01450000
014600     05  WS-ITEM-CLUSTR-NAME-DPT.                                 01460000
014700         10  WS-ITEM-CLUSTR-DPT     PIC X(3).                     01470000
014800         10  FILLER                 PIC X(17)    VALUE SPACES.    01480000
014900     05  WS-ITEM-CLUSTR-NAME-MCL.                                 01490000
015000         10  WS-ITEM-CLUSTR-MCL-DPT PIC X(3).                     01500000
015100         10  FILLER                 PIC X(1)     VALUE '-'.       01510000
015200         10  WS-ITEM-CLUSTR-MCL     PIC X(1).                     01520000
015300         10  FILLER                 PIC X(15)    VALUE SPACES.    01530000
015400     05  WS-ITEM-CLUSTR-NAME-SCL.                                 01540000
015500         10  WS-ITEM-CLUSTR-SCL-DPT PIC X(3).                     01550000
015600         10  FILLER                 PIC X(1)     VALUE '-'.       01560000
015700         10  WS-ITEM-CLUSTR-SCL     PIC X(2).                     01570000
015800         10  FILLER                 PIC X(14)    VALUE SPACES.    01580000
015900     05  WS-WORK-GMA                PIC 9(4).                     01590000
016000     05  WS-WORK-GMA-X REDEFINES WS-WORK-GMA.                     01600000
016100         10  WS-WORK-GMA-1-2        PIC 9(2).                     01610000
016200         10  WS-WORK-GMA-3-4        PIC 9(2).                     01620000
016300     05  WS-WORK-DMA                PIC 9(4).                     01630000
016400     05  WS-WORK-DMA-X REDEFINES WS-WORK-DMA.                     01640000
016500         10  WS-WORK-DMA-1-2        PIC 9(2).                     01650000
016600         10  WS-WORK-DMA-3-4        PIC 9(2).                     01660000
016700     05  WS-WORK-DPT                PIC 9(4).                     01670000
016800     05  WS-WORK-DPT-X REDEFINES WS-WORK-DPT.                     01680000
016900         10  WS-WORK-DPT-1          PIC 9.                        01690000
017000         10  WS-WORK-DPT-2-4        PIC 9(3).                     01700000
017100     05  WS-WORK-MAJCL              PIC 9(4).                     01710000
017200     05  WS-WORK-MAJCL-X REDEFINES WS-WORK-MAJCL.                 01720000
017300         10  WS-WORK-MAJCL-1-2      PIC 9(2).                     01730000
017400         10  WS-WORK-MAJCL-3        PIC 9(1).                     01740000
017500         10  WS-WORK-MAJCL-4        PIC 9(1).                     01750000
017600     05  WS-WORK-SUBCL              PIC 9(4).                     01760000
017700     05  WS-WORK-SUBCL-X REDEFINES WS-WORK-SUBCL.                 01770000
017800         10  WS-WORK-SUBCL-1-2      PIC 9(2).                     01780000
017900         10  WS-WORK-SUBCL-3-4      PIC 9(2).                     01790000
018000     05  WS-CPU-DATE.                                             01800000
018100         10  WS-CPU-YY              PIC 9(2)     VALUE ZEROS.     01810000
018200         10  WS-CPU-MM              PIC 9(2)     VALUE ZEROS.     01820000
018300         10  WS-CPU-DD              PIC 9(2)     VALUE ZEROS.     01830000
018400     05  WS-CURRENT-DATE            PIC X(10)    VALUE SPACES.    01840000
018500     05  WS-CURRENT-TMST-NEW        PIC X(19)    VALUE SPACES.    01850000
018600     05  WS-ABEND-CODE              PIC S9(4)    COMP SYNC        01860000
018700                                                 VALUE ZERO.      01870000
018800     05  WS-READ-COUNT              PIC S9(9)    COMP-3           01880000
018900                                                 VALUE ZERO.      01890000
019000     05  WS-ERROR-COUNT             PIC S9(9)    COMP-3           01900000
019100                                                 VALUE ZERO.      01910000
019200     05  WS-SKIP-ERROR-COUNT        PIC S9(9)    COMP-3           01920000
019300                                                 VALUE ZERO.      01930000
019400     05  WS-MSG-TEXT                PIC X(512).                   01940000
019500     05  WS-MSG-LENGTH              PIC S9(9)    COMP.            01950000
019600     05  WS-PRNT-CLUSTR-ID          PIC S9(9)    COMP-3           01960000
019700                                                 VALUE 0.         01970000
019800     05  WS-NEW-PRNT-CLUSTR-ID      PIC S9(9)    COMP-3           01980000
019900                                                 VALUE 0.         01990000
020000     05  WS-CLUSTR-ID               PIC S9(9)    COMP-3           02000000
020100                                                 VALUE 0.         02010000
020200     05  WS-OWNER-CLUSTR-ID         PIC S9(9)    COMP-3           02020000
020300                                                 VALUE 0.         02030000
020400                                                                  02040000
020500 01  WS-ERROR-RECORD.                                             02050000
020600     05  WS-ERROR-MSG               PIC X(40).                    02060000
020700     05  WS-ERROR-DATA1             PIC X(20).                    02070000
020800     05  WS-ERROR-DATA2             PIC X(20).                    02080000
020900                                                                  02090000
021000     COPY HMRD001.                                                02100000
021100                                                                  02110000
021200     EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     02120000
021300                                                                  02130000
021400 01  USERNAME                       PIC X(10)    VARYING.         02140000
021500 01  PASSWD                         PIC X(10)    VARYING.         02150000
021600 01  PC-ORACLE-ID                   PIC X(1)     VALUE '/'.       02160000
021700                                                                  02170000
021800 01  WS-CURRENT-TMST                PIC X(19)    VALUE SPACES.    02180000
021900 01  WS-CURR-END-TMST               PIC X(19)    VALUE SPACES.    02190000
022000*  TITMCLT NULL INDICATORS                                        02200000
022100 01  WS-CLT-EFF-END-DTE-NULL        PIC S9(4)    COMP.            02210000
022200 01  WS-CLUSTR-TYP-CDE-NULL         PIC S9(4)    COMP.            02220000
022300 01  WS-HIER-TYP-CDE-NULL           PIC S9(4)    COMP.            02230000
022400 01  WS-HIER-CDE-NULL               PIC S9(4)    COMP.            02240000
022500 01  WS-ITEM-CLUSTR-CDE-NULL        PIC S9(4)    COMP.            02250000
022600 01  WS-MDSE-NM-CDE-NULL            PIC S9(4)    COMP.            02260000
022700 01  WS-PROD-SERV-CDE-NULL          PIC S9(4)    COMP.            02270000
022800 01  WS-ARCH-DTE-NULL               PIC S9(4)    COMP.            02280000
022900 01  WS-OWNER-ID-NULL               PIC S9(4)    COMP.            02290000
023000 01  WS-SKU-NULL                    PIC S9(4)    COMP.            02300000
023100                                                                  02310000
023200*  TITMCLC NULL INDICATORS                                        02320000
023300 01  WS-CLC-EFF-END-DTE-NULL        PIC S9(4)    COMP.            02330000
023400 01  WS-CHLD-ITM-CLSTR-CDE-NULL     PIC S9(4)    COMP.            02340000
023500 01  WS-CHLD-ITM-UNT-QTY-NULL       PIC S9(4)    COMP.            02350000
023600                                                                  02360000
023700     EXEC SQL                                                     02370000
023800       INCLUDE TITMCLT                                            02380000
023900     END-EXEC.                                                    02390000
024000                                                                  02400000
024100     EXEC SQL                                                     02410000
024200       INCLUDE ITT00001                                           02420000
024300     END-EXEC.                                                    02430000
024400                                                                  02440000
024500     EXEC SQL END DECLARE SECTION END-EXEC.                       02450000
024600                                                                  02460000
024700     EXEC SQL                                                     02470000
024800         INCLUDE SQLCA                                            02480000
024900     END-EXEC.                                                    02490000
025000                                                                  02500000
025100     COPY SQLCA2.                                                 02510000
025200                                                                  02520000
025300                                                                  02530000
025400 PROCEDURE DIVISION.                                              02540000
025500 M0000-MAINLINE.                                                  02550000
025600                                                                  02560000
025700     PERFORM A1000-INITIALIZE                                     02570000
025800        THRU A1000-EXIT.                                          02580000
025900                                                                  02590000
026000     PERFORM B1000-PROCESS-MESSAGES                               02600000
026100        THRU B1000-EXIT                                           02610000
026200       UNTIL MERCH-EOF.                                           02620000
026300                                                                  02630000
026400     PERFORM H1000-EOJ-PROCESSING                                 02640000
026500        THRU H1000-EXIT.                                          02650000
026600                                                                  02660000
026700     STOP RUN.                                                    02670000
026800                                                                  02680000
026900                                                                  02690000
027000 A1000-INITIALIZE.                                                02700000
027100                                                                  02710000
027200     OPEN INPUT  MERCH-FILE                                       02720000
027300          OUTPUT ERROR-FILE.                                      02730000
027400                                                                  02740000
027500     ACCEPT WS-CPU-DATE FROM DATE.                                02750000
027600                                                                  02760000
027700     STRING '20'       DELIMITED BY SIZE                          02770000
027800            WS-CPU-YY  DELIMITED BY SIZE                          02780000
027900            '-'        DELIMITED BY SIZE                          02790000
028000            WS-CPU-MM  DELIMITED BY SIZE                          02800000
028100            '-'        DELIMITED BY SIZE                          02810000
028200            WS-CPU-DD  DELIMITED BY SIZE                          02820000
028300       INTO WS-CURRENT-DATE.                                      02830000
028400                                                                  02840000
028500     MOVE WS-INITIAL-END-TMST TO WS-CURR-END-TMST.                02850000
028600     MOVE WS-CURRENT-DATE     TO WS-CURR-END-TMST(1:10).          02860000
028700                                                                  02870000
028800*********  LOGON TO ORACLE  *************************             02880000
028900                                                                  02890000
028910     PERFORM A1010-CONNECT-TO-ORACLE.                             02891001
031600                                                                  03160000
031700     EXEC SQL                                                     03170000
031800         ALTER SESSION                                            03180000
031900            SET NLS_DATE_FORMAT = 'YYYY-MM-DD.HH24.MI.SS'         03190000
032000     END-EXEC.                                                    03200000
032100                                                                  03210000
032200     EXEC SQL                                                     03220000
032300         SELECT SYSDATE                                           03230000
032400           INTO :WS-CURRENT-TMST                                  03240000
032500           FROM DUAL                                              03250000
032600     END-EXEC.                                                    03260000
032700                                                                  03270000
032800     DISPLAY 'SYSDATE = ' WS-CURRENT-TMST.                        03280000
032900     MOVE WS-CURRENT-TMST TO WS-CURRENT-TMST-NEW.                 03290000
033000                                                                  03300000
033100*    INITIALIZE AND SET UP THE "COMMON" INITIAL VALUES            03310000
033200*    FOR THE TITMCLT INSERT                                       03320000
033300                                                                  03330000
033400     INITIALIZE DCLTITMCLT.                                       03340000
033500     MOVE WS-CURRENT-TMST       TO ITMCLT-EFF-BEG-TMST.           03350000
033600     MOVE 'S'                   TO ITMCLT-CLUSTR-TYP-CDE.         03360000
033700     MOVE 'M'                   TO ITMCLT-HIER-TYP-CDE.           03370000
033800     MOVE 'C'                   TO ITMCLT-ITEM-CLUSTR-CDE.        03380000
033900     MOVE ZEROS                 TO WS-CLUSTR-TYP-CDE-NULL         03390000
034000                                   WS-HIER-TYP-CDE-NULL           03400000
034100                                   WS-HIER-CDE-NULL               03410000
034200                                   WS-ITEM-CLUSTR-CDE-NULL.       03420000
034300     MOVE -1                    TO WS-MDSE-NM-CDE-NULL            03430000
034400                                   WS-PROD-SERV-CDE-NULL          03440000
034500                                   WS-ARCH-DTE-NULL               03450000
034600                                   WS-SKU-NULL.                   03460000
034700                                                                  03470000
034800*    INITIALIZE AND SET UP THE "COMMON" INITIAL VALUES            03480000
034900*    FOR THE TITMCLC INSERT                                       03490000
035000                                                                  03500000
035100     INITIALIZE ITT00001.                                         03510000
035200     MOVE 'M'                   TO REL-TYP-CDE.                   03520000
035300     MOVE WS-CURRENT-TMST       TO EFF-BEG-TMST.                  03530000
035400     MOVE 'C'                   TO CHLD-ITM-CLSTR-CDE.            03540000
035500     MOVE -1                    TO WS-CHLD-ITM-UNT-QTY-NULL.      03550000
035600                                                                  03560000
035700     EXEC SQL                                                     03570000
035800         DECLARE EXPCLC CURSOR FOR                                03580000
035900             SELECT CHLD_ITM_CLUSTR_ID                            03590000
036000               FROM TITMCLC                                       03600000
036100              WHERE PRNT_ITM_CLUSTR_ID = :PRNT-ITM-CLUSTR-ID      03610000
036200                AND REL_TYP_CDE        = 'M'                      03620000
036300                AND ((EFF_END_TMST IS NULL)                       03630000
036400                 OR  (EFF_END_TMST > :WS-CURR-END-TMST))          03640000
036500     END-EXEC.                                                    03650000
036600                                                                  03660000
036700 A1000-EXIT.                                                      03670000
036800     EXIT.                                                        03680000
036900                                                                  03690000
036910****************************************************************  03691001
036920*   CONNECT TO THE APPROPRIATE ORACLE SERVER.                  *  03692001
036930****************************************************************  03693001
036940 A1010-CONNECT-TO-ORACLE.                                         03694001
036950                                                                  03695001
036960     OPEN INPUT ORACLE-LOGON-FILE.                                03696001
036970                                                                  03697001
036980     PERFORM A1020-READ-ORACLE-LOGON.                             03698001
036990                                                                  03699001
036991     CLOSE ORACLE-LOGON-FILE.                                     03699101
036992                                                                  03699201
036993     IF ((PS-END-OF-LOGON-FILE)                                   03699301
036994             OR (CC-ORACLE-CONNECTION = SPACES))                  03699401
036995         DISPLAY '** ABEND **'                                    03699501
036996         DISPLAY 'MAKUT145 - ORACLE LOGON CONTROL CARD '          03699603
036997                   'NOT PROVIDED'                                 03699701
036998         SET PS-ORA-SRC-EMPTY TO TRUE                             03699801
036999         CALL 'ILBOABN0' USING WS-ABEND-CODE                      03699902
037000     END-IF.                                                      03700001
037001                                                                  03700101
037002     IF CC-AUTO-LOGON                                             03700201
037003         DISPLAY 'MAKUT145 - AUTO LOGON TO ORACLE'                03700303
037004         EXEC SQL                                                 03700401
037005              CONNECT :USERNAME                                   03700501
037006         END-EXEC                                                 03700601
037007     ELSE                                                         03700701
037008         INITIALIZE PV-ORACLE-USERID-LEN                          03700801
037009                    PV-ORACLE-PASSWORD-LEN                        03700901
037010         INSPECT CC-ORACLE-USERID                                 03701001
037011             TALLYING PV-ORACLE-USERID-LEN                        03701101
037012          FOR CHARACTERS BEFORE INITIAL SPACE                     03701201
037013      INSPECT CC-ORACLE-PASSWORD                                  03701301
037014          TALLYING PV-ORACLE-PASSWORD-LEN                         03701401
037015          FOR CHARACTERS BEFORE INITIAL SPACE                     03701501
037016      MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO           03701601
037017                USERNAME-ARR                                      03701701
037018      MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                   03701801
037019      MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO       03701901
037020                PASSWD-ARR                                        03702001
037021      MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                   03702101
037022      DISPLAY 'MAKUT145 - LOGON TO ORACLE AS USER '               03702201
037023                USERNAME-ARR                                      03702301
037024      EXEC SQL                                                    03702401
037025        CONNECT :USERNAME IDENTIFIED BY :PASSWD                   03702501
037026      END-EXEC                                                    03702601
037027      INITIALIZE CC-ORACLE-PASSWORD                               03702701
037028                 PASSWD                                           03702801
037029      END-IF.                                                     03702901
037030                                                                  03703001
037031     IF (SQLCODE NOT = 0)                                         03703101
037032         DISPLAY 'A1010-CONNECT-TO-ORACLE'                        03703202
037033         DISPLAY 'MAKUT145 - ERROR LOGGING ON TO ORACLE'          03703301
037034         PERFORM U9999-ABEND-ROUTINE                              03703401
037035     END-IF.                                                      03703501
037036                                                                  03703601
037037****************************************************************  03703701
037038** READ THE ORACLE LOGON CONTROL CARD.                        **  03703801
037039****************************************************************  03703901
037040 A1020-READ-ORACLE-LOGON.                                         03704001
037041                                                                  03704101
037042     READ ORACLE-LOGON-FILE                                       03704201
037043         INTO CC-ORACLE-CONNECTION                                03704301
037044         AT END                                                   03704401
037045             SET PS-END-OF-LOGON-FILE TO TRUE                     03704501
037046     END-READ.                                                    03704601
037047                                                                  03704701
037050                                                                  03705000
037100 B1000-PROCESS-MESSAGES.                                          03710000
037200                                                                  03720000
037300     PERFORM B1100-READ-MERCH-FILE                                03730000
037400        THRU B1100-EXIT.                                          03740000
037500     IF MERCH-EOF                                                 03750000
037600        GO TO B1000-EXIT                                          03760000
037700     END-IF.                                                      03770000
037800                                                                  03780000
037900     DISPLAY '***********************************************'.   03790000
038000     DISPLAY 'BEGIN PROCESSING NEW RECORD'.                       03800000
038100     DISPLAY 'RMS TABLE NAME:    ' HM001-RMS-TBL-NAME.            03810000
038200     DISPLAY 'ACTION TYPE CODE:  ' HM001-ACTN-TYP-CDE.            03820000
038300                                                                  03830000
038400     EVALUATE TRUE                                                03840000
038500         WHEN HM001-RMS-TBL-NAME = WS-DIVISION-TABLE              03850000
038600             DISPLAY 'GMA NO:  ' HM001-DIV-DIVISION               03860000
038700             DISPLAY 'GMA DESCRIPTION:  ' HM001-DIV-DIV-NAME      03870000
038800             PERFORM C1000-PROCESS-DIVISION-MSGS                  03880000
038900                THRU C1000-EXIT                                   03890000
039000         WHEN HM001-RMS-TBL-NAME = WS-GROUPS-TABLE                03900000
039100             DISPLAY 'DMA NO:  ' HM001-GRPS-GROUP-NO              03910000
039200             DISPLAY 'GMA NO:  ' HM001-GRPS-DIVISION              03920000
039300             DISPLAY 'DMA DESCRIPTION:  ' HM001-GRPS-GROUP-NAME   03930000
039400             PERFORM D1000-PROCESS-GROUP-MSGS                     03940000
039500                THRU D1000-EXIT                                   03950000
039600         WHEN HM001-RMS-TBL-NAME = WS-DEPS-TABLE                  03960000
039700             DISPLAY 'DPT NO:  ' HM001-DEPS-DEPT                  03970000
039800             DISPLAY 'DMA NO:  ' HM001-DEPS-GROUP-NO              03980000
039900             DISPLAY 'DPT DESCRIPTION:  ' HM001-DEPS-DEPT-NAME    03990000
040000             PERFORM E1000-PROCESS-DPT-MSGS                       04000000
040100                THRU E1000-EXIT                                   04010000
040200         WHEN HM001-RMS-TBL-NAME = WS-CLASS-TABLE                 04020000
040300             DISPLAY 'MCL NO:  ' HM001-CLASS-CLASS                04030000
040400             DISPLAY 'DPT NO:  ' HM001-CLASS-DEPT                 04040000
040500             DISPLAY 'MCL DESCRIPTION:  ' HM001-CLASS-CLASS-NAME  04050000
040600             PERFORM F1000-PROCESS-CLASS-MSGS                     04060000
040700                THRU F1000-EXIT                                   04070000
040800         WHEN HM001-RMS-TBL-NAME = WS-SUBCLASS-TABLE              04080000
040900             DISPLAY 'SCL NO:  ' HM001-SUBCL-SUBCLASS             04090000
041000             DISPLAY 'MCL NO:  ' HM001-SUBCL-CLASS                04100000
041100             DISPLAY 'DPT NO:  ' HM001-SUBCL-DEPT                 04110000
041200             DISPLAY 'SCL DESCRIPTION:  ' HM001-SUBCL-SUB-NAME    04120000
041300             PERFORM G1000-PROCESS-SUBCLASS-MSGS                  04130000
041400                THRU G1000-EXIT                                   04140000
041500         WHEN OTHER                                               04150000
041600             MOVE WS-COULD-NOT-PROCESS-TABLE TO WS-ERROR-MSG      04160000
041700             MOVE HM001-RMS-TBL-NAME(1:20)   TO WS-ERROR-DATA1    04170000
041800             MOVE SPACES                     TO WS-ERROR-DATA2    04180000
041900             PERFORM U8000-WRITE-ERROR-RECORD                     04190000
042000                THRU U8000-EXIT                                   04200000
042100     END-EVALUATE.                                                04210000
042200                                                                  04220000
042300 B1000-EXIT.                                                      04230000
042400     EXIT.                                                        04240000
042500                                                                  04250000
042600                                                                  04260000
042700 B1100-READ-MERCH-FILE.                                           04270000
042800                                                                  04280000
042900     READ MERCH-FILE INTO HMRD001-RECORD                          04290000
043000         AT END                                                   04300000
043100             SET MERCH-EOF TO TRUE                                04310000
043200             GO TO B1100-EXIT.                                    04320000
043300                                                                  04330000
043400     ADD 1                 TO WS-READ-COUNT.                      04340000
043500                                                                  04350000
043600 B1100-EXIT.                                                      04360000
043700     EXIT.                                                        04370000
043800                                                                  04380000
043900                                                                  04390000
044000 C1000-PROCESS-DIVISION-MSGS.                                     04400000
044100                                                                  04410000
044200     DISPLAY 'C1000-PROCESS-DIVISION-MSGS'.                       04420000
044300                                                                  04430000
044400     MOVE WS-GMA                     TO ITMCLT-HIER-CDE.          04440000
044500     MOVE HM001-DIV-DIVISION         TO WS-WORK-GMA.              04450000
044600     MOVE WS-WORK-GMA-3-4            TO WS-ITEM-CLUSTR-GMA.       04460000
044700     MOVE WS-ITEM-CLUSTR-NAME-GMA    TO ITMCLT-ITEM-CLUSTR-NAME.  04470000
044800     PERFORM U9000-SELECT-MERCH-LEVEL                             04480000
044900        THRU U9000-EXIT.                                          04490000
045000                                                                  04500000
045100     IF TITMCLT-RCD-EXISTS                                        04510000
045200         MOVE ITMCLT-ITEM-CLUSTR-ID  TO WS-CLUSTR-ID              04520000
045300     END-IF.                                                      04530000
045400                                                                  04540000
045500     IF HM001-ACTN-TYP-INSERT                                     04550000
045600         IF TITMCLT-RCD-DOES-NOT-EXIST                            04560000
045700             PERFORM U9100-SELECT-NEXT-SEQ-NBR                    04570000
045800                THRU U9100-EXIT                                   04580000
045900             MOVE ITMCLT-ITEM-CLUSTR-ID TO WS-CLUSTR-ID           04590000
046000                                                                  04600000
046100             MOVE WS-ITEM-CLUSTR-NAME-GMA                         04610000
046200                                     TO ITMCLT-ITEM-CLUSTR-NAME   04620000
046300             MOVE HM001-DIV-DIV-NAME TO ITMCLT-ITEM-CLUSTR-DESC   04630000
046400             MOVE -1                 TO WS-CLT-EFF-END-DTE-NULL   04640000
046500                                        WS-OWNER-ID-NULL          04650000
046600             PERFORM U9200-INSERT-MERCH-LEVEL                     04660000
046700                THRU U9200-EXIT                                   04670000
046800                                                                  04680000
046900             MOVE SPACES             TO ITMCLT-HIER-CDE           04690000
047000             MOVE WS-ITEM-CLUSTR-NAME-CORP                        04700000
047100                                     TO ITMCLT-ITEM-CLUSTR-NAME   04710000
047200             PERFORM U9000-SELECT-MERCH-LEVEL                     04720000
047300                THRU U9000-EXIT                                   04730000
047400                                                                  04740000
047500             IF TITMCLT-RCD-EXISTS                                04750000
047600                 MOVE ITMCLT-ITEM-CLUSTR-ID TO WS-PRNT-CLUSTR-ID  04760000
047700                                                                  04770000
047800                 MOVE WS-PRNT-CLUSTR-ID TO PRNT-ITM-CLUSTR-ID     04780000
047900                 MOVE WS-CLUSTR-ID      TO CHLD-ITM-CLUSTR-ID     04790000
048000                 MOVE -1                TO WS-CLC-EFF-END-DTE-NULL04800000
048100                                                                  04810000
048200                 PERFORM U9300-INSERT-PRNT-RELATION               04820000
048300                    THRU U9300-EXIT                               04830000
048400             ELSE                                                 04840000
048500                 MOVE WS-COULD-NOT-INSERT      TO WS-ERROR-MSG    04850000
048600                 MOVE WS-ITEM-CLUSTR-NAME-CORP TO WS-ERROR-DATA1  04860000
048700                 MOVE WS-ITEM-CLUSTR-NAME-GMA  TO WS-ERROR-DATA2  04870000
048800                 PERFORM U8000-WRITE-ERROR-RECORD                 04880000
048900                    THRU U8000-EXIT                               04890000
049000             END-IF                                               04900000
049100         ELSE                                                     04910000
049200*            MOVE WS-RCD-EXISTS-ON-INSERT  TO WS-ERROR-MSG        04920000
049300*            MOVE WS-ITEM-CLUSTR-NAME-GMA  TO WS-ERROR-DATA1      04930000
049400*            MOVE SPACES                   TO WS-ERROR-DATA2      04940000
049500*            PERFORM U8000-WRITE-ERROR-RECORD                     04950000
049600*               THRU U8000-EXIT                                   04960000
049700             ADD 1 TO WS-SKIP-ERROR-COUNT                         04970000
049800         END-IF                                                   04980000
049900     END-IF.                                                      04990000
050000                                                                  05000000
050100     IF HM001-ACTN-TYP-UPDATE                                     05010000
050200         IF TITMCLT-RCD-EXISTS                                    05020000
050300             MOVE WS-CLUSTR-ID       TO ITMCLT-ITEM-CLUSTR-ID     05030000
050400             MOVE HM001-DIV-DIV-NAME TO ITMCLT-ITEM-CLUSTR-DESC   05040000
050500             PERFORM U9400-UPDATE-DESCRIP                         05050000
050600                THRU U9400-EXIT                                   05060000
050700         ELSE                                                     05070000
050800             MOVE WS-CLUSTER-NOT-FOUND    TO WS-ERROR-MSG         05080000
050900             MOVE WS-ITEM-CLUSTR-NAME-GMA TO WS-ERROR-DATA1       05090000
051000             MOVE SPACES                  TO WS-ERROR-DATA2       05100000
051100             PERFORM U8000-WRITE-ERROR-RECORD                     05110000
051200                THRU U8000-EXIT                                   05120000
051300         END-IF                                                   05130000
051400     END-IF.                                                      05140000
051500                                                                  05150000
051600     IF HM001-ACTN-TYP-DELETE                                     05160000
051700         IF TITMCLT-RCD-EXISTS                                    05170000
051800             MOVE WS-CLUSTR-ID TO ITMCLT-ITEM-CLUSTR-ID           05180000
051900             PERFORM U9500-EXPIRE-MERCH-LEVEL                     05190000
052000                THRU U9500-EXIT                                   05200000
052100                                                                  05210000
052200             MOVE WS-CLUSTR-ID TO CHLD-ITM-CLUSTR-ID              05220000
052300             PERFORM U9600-SELECT-PRNT-RELATION                   05230000
052400                THRU U9600-EXIT                                   05240000
052500             IF TITMCLC-RCD-EXISTS                                05250000
052600                 PERFORM U9700-EXPIRE-PRNT-RELATION               05260000
052700                    THRU U9700-EXIT                               05270000
052800             END-IF                                               05280000
052900                                                                  05290000
053000             MOVE WS-CLUSTR-ID TO PRNT-ITM-CLUSTR-ID              05300000
053100             PERFORM U9800-EXPIRE-CHLD-RELATION                   05310000
053200                THRU U9800-EXIT                                   05320000
053300         END-IF                                                   05330000
053400     END-IF.                                                      05340000
053500                                                                  05350000
053600 C1000-EXIT.                                                      05360000
053700     EXIT.                                                        05370000
053800                                                                  05380000
053900                                                                  05390000
054000 D1000-PROCESS-GROUP-MSGS.                                        05400000
054100                                                                  05410000
054200     DISPLAY 'D1000-PROCESS-GROUP-MSGS'.                          05420000
054300                                                                  05430000
054400     MOVE WS-DMA                    TO ITMCLT-HIER-CDE.           05440000
054500     MOVE HM001-GRPS-GROUP-NO       TO WS-WORK-DMA.               05450000
054600     MOVE WS-WORK-DMA-3-4           TO WS-ITEM-CLUSTR-DMA.        05460000
054700     MOVE WS-ITEM-CLUSTR-NAME-DMA   TO ITMCLT-ITEM-CLUSTR-NAME.   05470000
054800     PERFORM U9000-SELECT-MERCH-LEVEL                             05480000
054900        THRU U9000-EXIT.                                          05490000
055000                                                                  05500000
055100     IF TITMCLT-RCD-EXISTS                                        05510000
055200         MOVE ITMCLT-ITEM-CLUSTR-ID TO WS-CLUSTR-ID               05520000
055300     END-IF.                                                      05530000
055400                                                                  05540000
055500     IF HM001-ACTN-TYP-INSERT                                     05550000
055600         IF TITMCLT-RCD-DOES-NOT-EXIST                            05560000
055700             PERFORM U9100-SELECT-NEXT-SEQ-NBR                    05570000
055800                THRU U9100-EXIT                                   05580000
055900             MOVE ITMCLT-ITEM-CLUSTR-ID TO WS-CLUSTR-ID           05590000
056000                                                                  05600000
056100             MOVE WS-ITEM-CLUSTR-NAME-DMA                         05610000
056200                                        TO ITMCLT-ITEM-CLUSTR-NAME05620000
056300             MOVE HM001-GRPS-GROUP-NAME TO ITMCLT-ITEM-CLUSTR-DESC05630000
056400             MOVE -1                    TO WS-CLT-EFF-END-DTE-NULL05640000
056500                                           WS-OWNER-ID-NULL       05650000
056600             PERFORM U9200-INSERT-MERCH-LEVEL                     05660000
056700                THRU U9200-EXIT                                   05670000
056800                                                                  05680000
056900             MOVE WS-GMA                TO ITMCLT-HIER-CDE        05690000
057000             MOVE HM001-GRPS-DIVISION   TO WS-WORK-GMA            05700000
057100             MOVE WS-WORK-GMA-3-4       TO WS-ITEM-CLUSTR-GMA     05710000
057200             MOVE WS-ITEM-CLUSTR-NAME-GMA                         05720000
057300                                        TO ITMCLT-ITEM-CLUSTR-NAME05730000
057400             PERFORM U9000-SELECT-MERCH-LEVEL                     05740000
057500                THRU U9000-EXIT                                   05750000
057600                                                                  05760000
057700             IF TITMCLT-RCD-EXISTS                                05770000
057800                 MOVE ITMCLT-ITEM-CLUSTR-ID TO WS-PRNT-CLUSTR-ID  05780000
057900                                                                  05790000
058000                 MOVE WS-PRNT-CLUSTR-ID TO PRNT-ITM-CLUSTR-ID     05800000
058100                 MOVE WS-CLUSTR-ID      TO CHLD-ITM-CLUSTR-ID     05810000
058200                 MOVE -1                TO WS-CLC-EFF-END-DTE-NULL05820000
058300                                                                  05830000
058400                 PERFORM U9300-INSERT-PRNT-RELATION               05840000
058500                    THRU U9300-EXIT                               05850000
058600             ELSE                                                 05860000
058700                 MOVE WS-COULD-NOT-INSERT     TO WS-ERROR-MSG     05870000
058800                 MOVE WS-ITEM-CLUSTR-NAME-GMA TO WS-ERROR-DATA1   05880000
058900                 MOVE WS-ITEM-CLUSTR-NAME-DMA TO WS-ERROR-DATA2   05890000
059000                 PERFORM U8000-WRITE-ERROR-RECORD                 05900000
059100                    THRU U8000-EXIT                               05910000
059200             END-IF                                               05920000
059300         ELSE                                                     05930000
059400*            MOVE WS-RCD-EXISTS-ON-INSERT  TO WS-ERROR-MSG        05940000
059500*            MOVE WS-ITEM-CLUSTR-NAME-DMA  TO WS-ERROR-DATA1      05950000
059600*            MOVE SPACES                   TO WS-ERROR-DATA2      05960000
059700*            PERFORM U8000-WRITE-ERROR-RECORD                     05970000
059800*               THRU U8000-EXIT                                   05980000
059900             ADD 1 TO WS-SKIP-ERROR-COUNT                         05990000
060000         END-IF                                                   06000000
060100     END-IF.                                                      06010000
060200                                                                  06020000
060300     IF HM001-ACTN-TYP-UPDATE                                     06030000
060400         IF TITMCLT-RCD-EXISTS                                    06040000
060500             PERFORM U9900-CHECK-REALIGNMENT                      06050000
060600                THRU U9900-EXIT                                   06060000
060700                                                                  06070000
060800             MOVE WS-CLUSTR-ID TO ITMCLT-ITEM-CLUSTR-ID           06080000
060900             MOVE HM001-GRPS-GROUP-NAME                           06090000
061000                               TO ITMCLT-ITEM-CLUSTR-DESC         06100000
061100             PERFORM U9400-UPDATE-DESCRIP                         06110000
061200                THRU U9400-EXIT                                   06120000
061300         ELSE                                                     06130000
061400             MOVE WS-CLUSTER-NOT-FOUND    TO WS-ERROR-MSG         06140000
061500             MOVE WS-ITEM-CLUSTR-NAME-DMA TO WS-ERROR-DATA1       06150000
061600             MOVE SPACES                  TO WS-ERROR-DATA2       06160000
061700             PERFORM U8000-WRITE-ERROR-RECORD                     06170000
061800                THRU U8000-EXIT                                   06180000
061900         END-IF                                                   06190000
062000     END-IF.                                                      06200000
062100                                                                  06210000
062200     IF HM001-ACTN-TYP-DELETE                                     06220000
062300         IF TITMCLT-RCD-EXISTS                                    06230000
062400             MOVE WS-CLUSTR-ID TO ITMCLT-ITEM-CLUSTR-ID           06240000
062500             PERFORM U9500-EXPIRE-MERCH-LEVEL                     06250000
062600                THRU U9500-EXIT                                   06260000
062700                                                                  06270000
062800             MOVE WS-CLUSTR-ID TO CHLD-ITM-CLUSTR-ID              06280000
062900             PERFORM U9600-SELECT-PRNT-RELATION                   06290000
063000                THRU U9600-EXIT                                   06300000
063100             IF TITMCLC-RCD-EXISTS                                06310000
063200                 PERFORM U9700-EXPIRE-PRNT-RELATION               06320000
063300                    THRU U9700-EXIT                               06330000
063400             END-IF                                               06340000
063500                                                                  06350000
063600             MOVE WS-CLUSTR-ID TO PRNT-ITM-CLUSTR-ID              06360000
063700             PERFORM U9800-EXPIRE-CHLD-RELATION                   06370000
063800                THRU U9800-EXIT                                   06380000
063900         END-IF                                                   06390000
064000     END-IF.                                                      06400000
064100                                                                  06410000
064200 D1000-EXIT.                                                      06420000
064300     EXIT.                                                        06430000
064400                                                                  06440000
064500                                                                  06450000
064600 E1000-PROCESS-DPT-MSGS.                                          06460000
064700                                                                  06470000
064800     DISPLAY 'E1000-PROCESS-DPT-MSGS'.                            06480000
064900                                                                  06490000
065000     MOVE WS-DPT                    TO ITMCLT-HIER-CDE.           06500000
065100     MOVE HM001-DEPS-DEPT           TO WS-WORK-DPT.               06510000
065200     MOVE WS-WORK-DPT-2-4           TO WS-ITEM-CLUSTR-DPT.        06520000
065300     MOVE WS-ITEM-CLUSTR-NAME-DPT   TO ITMCLT-ITEM-CLUSTR-NAME.   06530000
065400     PERFORM U9000-SELECT-MERCH-LEVEL                             06540000
065500        THRU U9000-EXIT.                                          06550000
065600                                                                  06560000
065700     IF TITMCLT-RCD-EXISTS                                        06570000
065800         MOVE ITMCLT-ITEM-CLUSTR-ID TO WS-CLUSTR-ID               06580000
065900     END-IF.                                                      06590000
066000                                                                  06600000
066100     IF HM001-ACTN-TYP-INSERT                                     06610000
066200         IF TITMCLT-RCD-DOES-NOT-EXIST                            06620000
066300             PERFORM U9100-SELECT-NEXT-SEQ-NBR                    06630000
066400                THRU U9100-EXIT                                   06640000
066500             MOVE ITMCLT-ITEM-CLUSTR-ID TO WS-CLUSTR-ID           06650000
066600                                           WS-OWNER-CLUSTR-ID     06660000
066700                                                                  06670000
066800             MOVE WS-ITEM-CLUSTR-NAME-DPT                         06680000
066900                                        TO ITMCLT-ITEM-CLUSTR-NAME06690000
067000             MOVE HM001-DEPS-DEPT-NAME  TO ITMCLT-ITEM-CLUSTR-DESC06700000
067100             MOVE -1                    TO WS-CLT-EFF-END-DTE-NULL06710000
067200             MOVE 0                     TO WS-OWNER-ID-NULL       06720000
067300             MOVE WS-OWNER-CLUSTR-ID    TO ITMCLT-OWNER-ID        06730000
067400             PERFORM U9200-INSERT-MERCH-LEVEL                     06740000
067500                THRU U9200-EXIT                                   06750000
067600                                                                  06760000
067700             MOVE WS-DMA                TO ITMCLT-HIER-CDE        06770000
067800             MOVE HM001-DEPS-GROUP-NO   TO WS-WORK-DMA            06780000
067900             MOVE WS-WORK-DMA-3-4       TO WS-ITEM-CLUSTR-DMA     06790000
068000             MOVE WS-ITEM-CLUSTR-NAME-DMA                         06800000
068100                                        TO ITMCLT-ITEM-CLUSTR-NAME06810000
068200             PERFORM U9000-SELECT-MERCH-LEVEL                     06820000
068300                THRU U9000-EXIT                                   06830000
068400                                                                  06840000
068500             IF TITMCLT-RCD-EXISTS                                06850000
068600                 MOVE ITMCLT-ITEM-CLUSTR-ID TO WS-PRNT-CLUSTR-ID  06860000
068700                                                                  06870000
068800                 MOVE WS-PRNT-CLUSTR-ID TO PRNT-ITM-CLUSTR-ID     06880000
068900                 MOVE WS-CLUSTR-ID      TO CHLD-ITM-CLUSTR-ID     06890000
069000                 MOVE -1                TO WS-CLC-EFF-END-DTE-NULL06900000
069100                                                                  06910000
069200                 PERFORM U9300-INSERT-PRNT-RELATION               06920000
069300                    THRU U9300-EXIT                               06930000
069400             ELSE                                                 06940000
069500                 MOVE WS-COULD-NOT-INSERT     TO WS-ERROR-MSG     06950000
069600                 MOVE WS-ITEM-CLUSTR-NAME-DMA TO WS-ERROR-DATA1   06960000
069700                 MOVE WS-ITEM-CLUSTR-NAME-DPT TO WS-ERROR-DATA2   06970000
069800                 PERFORM U8000-WRITE-ERROR-RECORD                 06980000
069900                    THRU U8000-EXIT                               06990000
070000             END-IF                                               07000000
070100         ELSE                                                     07010000
070200*            MOVE WS-RCD-EXISTS-ON-INSERT  TO WS-ERROR-MSG        07020000
070300*            MOVE WS-ITEM-CLUSTR-NAME-DPT  TO WS-ERROR-DATA1      07030000
070400*            MOVE SPACES                   TO WS-ERROR-DATA2      07040000
070500*            PERFORM U8000-WRITE-ERROR-RECORD                     07050000
070600*               THRU U8000-EXIT                                   07060000
070700             ADD 1 TO WS-SKIP-ERROR-COUNT                         07070000
070800         END-IF                                                   07080000
070900     END-IF.                                                      07090000
071000                                                                  07100000
071100     IF HM001-ACTN-TYP-UPDATE                                     07110000
071200         IF TITMCLT-RCD-EXISTS                                    07120000
071300             PERFORM U9900-CHECK-REALIGNMENT                      07130000
071400                THRU U9900-EXIT                                   07140000
071500                                                                  07150000
071600             MOVE WS-CLUSTR-ID TO ITMCLT-ITEM-CLUSTR-ID           07160000
071700             MOVE HM001-DEPS-DEPT-NAME                            07170000
071800                               TO ITMCLT-ITEM-CLUSTR-DESC         07180000
071900             PERFORM U9400-UPDATE-DESCRIP                         07190000
072000                THRU U9400-EXIT                                   07200000
072100         ELSE                                                     07210000
072200             MOVE WS-CLUSTER-NOT-FOUND    TO WS-ERROR-MSG         07220000
072300             MOVE WS-ITEM-CLUSTR-NAME-DPT TO WS-ERROR-DATA1       07230000
072400             MOVE SPACES                  TO WS-ERROR-DATA2       07240000
072500             PERFORM U8000-WRITE-ERROR-RECORD                     07250000
072600                THRU U8000-EXIT                                   07260000
072700         END-IF                                                   07270000
072800     END-IF.                                                      07280000
072900                                                                  07290000
073000     IF HM001-ACTN-TYP-DELETE                                     07300000
073100         IF TITMCLT-RCD-EXISTS                                    07310000
073200             MOVE WS-CLUSTR-ID TO ITMCLT-ITEM-CLUSTR-ID           07320000
073300             PERFORM U9500-EXPIRE-MERCH-LEVEL                     07330000
073400                THRU U9500-EXIT                                   07340000
073500                                                                  07350000
073600             MOVE WS-CLUSTR-ID TO CHLD-ITM-CLUSTR-ID              07360000
073700             PERFORM U9600-SELECT-PRNT-RELATION                   07370000
073800                THRU U9600-EXIT                                   07380000
073900             IF TITMCLC-RCD-EXISTS                                07390000
074000                 PERFORM U9700-EXPIRE-PRNT-RELATION               07400000
074100                    THRU U9700-EXIT                               07410000
074200             END-IF                                               07420000
074300                                                                  07430000
074400             MOVE WS-CLUSTR-ID TO PRNT-ITM-CLUSTR-ID              07440000
074500             PERFORM U9800-EXPIRE-CHLD-RELATION                   07450000
074600                THRU U9800-EXIT                                   07460000
074700         END-IF                                                   07470000
074800     END-IF.                                                      07480000
074900                                                                  07490000
075000 E1000-EXIT.                                                      07500000
075100     EXIT.                                                        07510000
075200                                                                  07520000
075300                                                                  07530000
075400 F1000-PROCESS-CLASS-MSGS.                                        07540000
075500                                                                  07550000
075600     DISPLAY 'F1000-PROCESS-CLASS-MSGS'.                          07560000
075700                                                                  07570000
075800     MOVE WS-MCL                  TO ITMCLT-HIER-CDE.             07580000
075900     MOVE HM001-CLASS-DEPT        TO WS-WORK-DPT.                 07590000
076000     MOVE WS-WORK-DPT-2-4         TO WS-ITEM-CLUSTR-MCL-DPT.      07600000
076100     MOVE HM001-CLASS-CLASS       TO WS-WORK-MAJCL.               07610000
076200     MOVE WS-WORK-MAJCL-3         TO WS-ITEM-CLUSTR-MCL.          07620000
076300     MOVE WS-ITEM-CLUSTR-NAME-MCL TO ITMCLT-ITEM-CLUSTR-NAME.     07630000
076400     PERFORM U9000-SELECT-MERCH-LEVEL                             07640000
076500        THRU U9000-EXIT.                                          07650000
076600                                                                  07660000
076700     IF TITMCLT-RCD-EXISTS                                        07670000
076800         MOVE ITMCLT-ITEM-CLUSTR-ID TO WS-CLUSTR-ID               07680000
076900     END-IF.                                                      07690000
077000                                                                  07700000
077100     IF HM001-ACTN-TYP-INSERT                                     07710000
077200         IF TITMCLT-RCD-DOES-NOT-EXIST                            07720000
077300             PERFORM U9100-SELECT-NEXT-SEQ-NBR                    07730000
077400                THRU U9100-EXIT                                   07740000
077500             MOVE ITMCLT-ITEM-CLUSTR-ID TO WS-CLUSTR-ID           07750000
077600                                                                  07760000
077700             MOVE WS-DPT          TO ITMCLT-HIER-CDE              07770000
077800             MOVE WS-WORK-DPT-2-4 TO WS-ITEM-CLUSTR-DPT           07780000
077900             MOVE WS-ITEM-CLUSTR-NAME-DPT                         07790000
078000                                  TO ITMCLT-ITEM-CLUSTR-NAME      07800000
078100             PERFORM U9000-SELECT-MERCH-LEVEL                     07810000
078200                THRU U9000-EXIT                                   07820000
078300                                                                  07830000
078400             IF TITMCLT-RCD-EXISTS                                07840000
078500                 MOVE ITMCLT-ITEM-CLUSTR-ID                       07850000
078600                                  TO WS-PRNT-CLUSTR-ID            07860000
078700                                     WS-OWNER-CLUSTR-ID           07870000
078800                                                                  07880000
078900                 MOVE WS-CLUSTR-ID                                07890000
079000                                  TO ITMCLT-ITEM-CLUSTR-ID        07900000
079100                 MOVE WS-MCL      TO ITMCLT-HIER-CDE              07910000
079200                 MOVE WS-ITEM-CLUSTR-NAME-MCL                     07920000
079300                                  TO ITMCLT-ITEM-CLUSTR-NAME      07930000
079400                 MOVE HM001-CLASS-CLASS-NAME                      07940000
079500                                  TO ITMCLT-ITEM-CLUSTR-DESC      07950000
079600                 MOVE -1          TO WS-CLT-EFF-END-DTE-NULL      07960000
079700                 MOVE 0           TO WS-OWNER-ID-NULL             07970000
079800                 MOVE WS-OWNER-CLUSTR-ID                          07980000
079900                                  TO ITMCLT-OWNER-ID              07990000
080000                 PERFORM U9200-INSERT-MERCH-LEVEL                 08000000
080100                    THRU U9200-EXIT                               08010000
080200                                                                  08020000
080300                 MOVE WS-PRNT-CLUSTR-ID TO PRNT-ITM-CLUSTR-ID     08030000
080400                 MOVE WS-CLUSTR-ID      TO CHLD-ITM-CLUSTR-ID     08040000
080500                 MOVE -1                TO WS-CLC-EFF-END-DTE-NULL08050000
080600                                                                  08060000
080700                 PERFORM U9300-INSERT-PRNT-RELATION               08070000
080800                    THRU U9300-EXIT                               08080000
080900             ELSE                                                 08090000
081000                 MOVE WS-COULD-NOT-INSERT     TO WS-ERROR-MSG     08100000
081100                 MOVE WS-ITEM-CLUSTR-NAME-DPT TO WS-ERROR-DATA1   08110000
081200                 MOVE WS-ITEM-CLUSTR-NAME-MCL TO WS-ERROR-DATA2   08120000
081300                 PERFORM U8000-WRITE-ERROR-RECORD                 08130000
081400                    THRU U8000-EXIT                               08140000
081500             END-IF                                               08150000
081600         ELSE                                                     08160000
081700*            MOVE WS-RCD-EXISTS-ON-INSERT  TO WS-ERROR-MSG        08170000
081800*            MOVE WS-ITEM-CLUSTR-NAME-MCL  TO WS-ERROR-DATA1      08180000
081900*            MOVE SPACES                   TO WS-ERROR-DATA2      08190000
082000*            PERFORM U8000-WRITE-ERROR-RECORD                     08200000
082100*               THRU U8000-EXIT                                   08210000
082200             ADD 1 TO WS-SKIP-ERROR-COUNT                         08220000
082300         END-IF                                                   08230000
082400     END-IF.                                                      08240000
082500                                                                  08250000
082600     IF HM001-ACTN-TYP-UPDATE                                     08260000
082700         IF TITMCLT-RCD-EXISTS                                    08270000
082800             MOVE WS-CLUSTR-ID TO ITMCLT-ITEM-CLUSTR-ID           08280000
082900             MOVE HM001-CLASS-CLASS-NAME                          08290000
083000                               TO ITMCLT-ITEM-CLUSTR-DESC         08300000
083100             PERFORM U9400-UPDATE-DESCRIP                         08310000
083200                THRU U9400-EXIT                                   08320000
083300         ELSE                                                     08330000
083400             MOVE WS-CLUSTER-NOT-FOUND    TO WS-ERROR-MSG         08340000
083500             MOVE WS-ITEM-CLUSTR-NAME-MCL TO WS-ERROR-DATA1       08350000
083600             MOVE SPACES                  TO WS-ERROR-DATA2       08360000
083700             PERFORM U8000-WRITE-ERROR-RECORD                     08370000
083800                THRU U8000-EXIT                                   08380000
083900         END-IF                                                   08390000
084000     END-IF.                                                      08400000
084100                                                                  08410000
084200     IF HM001-ACTN-TYP-DELETE                                     08420000
084300         IF TITMCLT-RCD-EXISTS                                    08430000
084400             MOVE WS-CLUSTR-ID TO ITMCLT-ITEM-CLUSTR-ID           08440000
084500             PERFORM U9500-EXPIRE-MERCH-LEVEL                     08450000
084600                THRU U9500-EXIT                                   08460000
084700                                                                  08470000
084800             MOVE WS-CLUSTR-ID TO CHLD-ITM-CLUSTR-ID              08480000
084900             PERFORM U9600-SELECT-PRNT-RELATION                   08490000
085000                THRU U9600-EXIT                                   08500000
085100             IF TITMCLC-RCD-EXISTS                                08510000
085200                 PERFORM U9700-EXPIRE-PRNT-RELATION               08520000
085300                    THRU U9700-EXIT                               08530000
085400             END-IF                                               08540000
085500                                                                  08550000
085600             MOVE WS-CLUSTR-ID TO PRNT-ITM-CLUSTR-ID              08560000
085700             PERFORM U9800-EXPIRE-CHLD-RELATION                   08570000
085800                THRU U9800-EXIT                                   08580000
085900         END-IF                                                   08590000
086000     END-IF.                                                      08600000
086100                                                                  08610000
086200 F1000-EXIT.                                                      08620000
086300     EXIT.                                                        08630000
086400                                                                  08640000
086500                                                                  08650000
086600 G1000-PROCESS-SUBCLASS-MSGS.                                     08660000
086700                                                                  08670000
086800     DISPLAY 'G1000-PROCESS-SUBCLASS-MSGS'.                       08680000
086900                                                                  08690000
087000     MOVE WS-SCL                  TO ITMCLT-HIER-CDE.             08700000
087100     MOVE HM001-SUBCL-DEPT        TO WS-WORK-DPT.                 08710000
087200     MOVE WS-WORK-DPT-2-4         TO WS-ITEM-CLUSTR-SCL-DPT.      08720000
087300     MOVE HM001-SUBCL-SUBCLASS    TO WS-WORK-SUBCL.               08730000
087400     MOVE WS-WORK-SUBCL-3-4       TO WS-ITEM-CLUSTR-SCL.          08740000
087500     MOVE WS-ITEM-CLUSTR-NAME-SCL TO ITMCLT-ITEM-CLUSTR-NAME.     08750000
087600     PERFORM U9000-SELECT-MERCH-LEVEL                             08760000
087700        THRU U9000-EXIT.                                          08770000
087800                                                                  08780000
087900     IF TITMCLT-RCD-EXISTS                                        08790000
088000         MOVE ITMCLT-ITEM-CLUSTR-ID TO WS-CLUSTR-ID               08800000
088100     END-IF.                                                      08810000
088200                                                                  08820000
088300     IF HM001-ACTN-TYP-INSERT                                     08830000
088400         IF TITMCLT-RCD-DOES-NOT-EXIST                            08840000
088500             PERFORM U9100-SELECT-NEXT-SEQ-NBR                    08850000
088600                THRU U9100-EXIT                                   08860000
088700             MOVE ITMCLT-ITEM-CLUSTR-ID TO WS-CLUSTR-ID           08870000
088800                                                                  08880000
088900**  NEED TO GET THE OWNER ID CLUSTER ID FOR THE SCL INSERT        08890000
089000**  INTO TITMCLT.  IF THE OWNER DPT CAN NOT BE FOUND ON           08900000
089100**  TITMCLT, THE INSERTION OF THIS RCD SHOULD BE BYPASSED.        08910000
089200**  HAVING A SCL W/O A TIE TO A DPT WOULD CAUSE TOO MANY          08920000
089300**  SYSTEM PROBLEMS.                                              08930000
089400             MOVE WS-DPT             TO ITMCLT-HIER-CDE           08940000
089500             MOVE WS-WORK-DPT-2-4    TO WS-ITEM-CLUSTR-DPT        08950000
089600             MOVE WS-ITEM-CLUSTR-NAME-DPT                         08960000
089700                                     TO ITMCLT-ITEM-CLUSTR-NAME   08970000
089800             PERFORM U9000-SELECT-MERCH-LEVEL                     08980000
089900                THRU U9000-EXIT                                   08990000
090000                                                                  09000000
090100             IF TITMCLT-RCD-EXISTS                                09010000
090200                 MOVE ITMCLT-ITEM-CLUSTR-ID                       09020000
090300                                     TO WS-OWNER-CLUSTR-ID        09030000
090400                                                                  09040000
090500                 MOVE WS-CLUSTR-ID   TO ITMCLT-ITEM-CLUSTR-ID     09050000
090600                 MOVE WS-SCL         TO ITMCLT-HIER-CDE           09060000
090700                 MOVE WS-ITEM-CLUSTR-NAME-SCL                     09070000
090800                                     TO ITMCLT-ITEM-CLUSTR-NAME   09080000
090900                 MOVE HM001-SUBCL-SUB-NAME                        09090000
091000                                     TO ITMCLT-ITEM-CLUSTR-DESC   09100000
091100                 MOVE -1             TO WS-CLT-EFF-END-DTE-NULL   09110000
091200                 MOVE 0              TO WS-OWNER-ID-NULL          09120000
091300                 MOVE WS-OWNER-CLUSTR-ID                          09130000
091400                                     TO ITMCLT-OWNER-ID           09140000
091500                                                                  09150000
091600                 PERFORM U9200-INSERT-MERCH-LEVEL                 09160000
091700                    THRU U9200-EXIT                               09170000
091800                                                                  09180000
091900                 MOVE WS-MCL            TO ITMCLT-HIER-CDE        09190000
092000                 MOVE WS-WORK-DPT-2-4   TO WS-ITEM-CLUSTR-MCL-DPT 09200000
092100                 MOVE HM001-SUBCL-CLASS TO WS-WORK-MAJCL          09210000
092200                 MOVE WS-WORK-MAJCL-3   TO WS-ITEM-CLUSTR-MCL     09220000
092300                 MOVE WS-ITEM-CLUSTR-NAME-MCL                     09230000
092400                                        TO ITMCLT-ITEM-CLUSTR-NAME09240000
092500                 PERFORM U9000-SELECT-MERCH-LEVEL                 09250000
092600                    THRU U9000-EXIT                               09260000
092700                                                                  09270000
092800                 IF TITMCLT-RCD-EXISTS                            09280000
092900                     MOVE ITMCLT-ITEM-CLUSTR-ID                   09290000
093000                                          TO WS-PRNT-CLUSTR-ID    09300000
093100                                                                  09310000
093200                     MOVE WS-PRNT-CLUSTR-ID                       09320000
093300                                          TO PRNT-ITM-CLUSTR-ID   09330000
093400                     MOVE WS-CLUSTR-ID    TO CHLD-ITM-CLUSTR-ID   09340000
093500                     MOVE -1            TO WS-CLC-EFF-END-DTE-NULL09350000
093600                                                                  09360000
093700                     PERFORM U9300-INSERT-PRNT-RELATION           09370000
093800                        THRU U9300-EXIT                           09380000
093900                 ELSE                                             09390000
094000                     MOVE WS-COULD-NOT-INSERT TO WS-ERROR-MSG     09400000
094100                     MOVE WS-ITEM-CLUSTR-NAME-MCL                 09410000
094200                                              TO WS-ERROR-DATA1   09420000
094300                     MOVE WS-ITEM-CLUSTR-NAME-SCL                 09430000
094400                                              TO WS-ERROR-DATA2   09440000
094500                     PERFORM U8000-WRITE-ERROR-RECORD             09450000
094600                        THRU U8000-EXIT                           09460000
094700                 END-IF                                           09470000
094800             ELSE                                                 09480000
094900                 MOVE WS-DPT-NOT-FOUND        TO WS-ERROR-MSG     09490000
095000                 MOVE WS-ITEM-CLUSTR-NAME-DPT TO WS-ERROR-DATA1   09500000
095100                 MOVE WS-ITEM-CLUSTR-NAME-SCL TO WS-ERROR-DATA2   09510000
095200                 PERFORM U8000-WRITE-ERROR-RECORD                 09520000
095300                    THRU U8000-EXIT                               09530000
095400             END-IF                                               09540000
095500         ELSE                                                     09550000
095600*            MOVE WS-RCD-EXISTS-ON-INSERT  TO WS-ERROR-MSG        09560000
095700*            MOVE WS-ITEM-CLUSTR-NAME-SCL  TO WS-ERROR-DATA1      09570000
095800*            MOVE SPACES                   TO WS-ERROR-DATA2      09580000
095900*            PERFORM U8000-WRITE-ERROR-RECORD                     09590000
096000*               THRU U8000-EXIT                                   09600000
096100             ADD 1 TO WS-SKIP-ERROR-COUNT                         09610000
096200         END-IF                                                   09620000
096300     END-IF.                                                      09630000
096400                                                                  09640000
096500     IF HM001-ACTN-TYP-UPDATE                                     09650000
096600         IF TITMCLT-RCD-EXISTS                                    09660000
096700             MOVE WS-CLUSTR-ID  TO ITMCLT-ITEM-CLUSTR-ID          09670000
096800             MOVE HM001-SUBCL-SUB-NAME                            09680000
096900                                TO ITMCLT-ITEM-CLUSTR-DESC        09690000
097000             PERFORM U9400-UPDATE-DESCRIP                         09700000
097100                THRU U9400-EXIT                                   09710000
097200         ELSE                                                     09720000
097300             MOVE WS-CLUSTER-NOT-FOUND    TO WS-ERROR-MSG         09730000
097400             MOVE WS-ITEM-CLUSTR-NAME-SCL TO WS-ERROR-DATA1       09740000
097500             MOVE SPACES                  TO WS-ERROR-DATA2       09750000
097600             PERFORM U8000-WRITE-ERROR-RECORD                     09760000
097700                THRU U8000-EXIT                                   09770000
097800         END-IF                                                   09780000
097900     END-IF.                                                      09790000
098000                                                                  09800000
098100     IF HM001-ACTN-TYP-DELETE                                     09810000
098200         IF TITMCLT-RCD-EXISTS                                    09820000
098300             MOVE WS-CLUSTR-ID TO ITMCLT-ITEM-CLUSTR-ID           09830000
098400             PERFORM U9500-EXPIRE-MERCH-LEVEL                     09840000
098500                THRU U9500-EXIT                                   09850000
098600                                                                  09860000
098700             MOVE WS-CLUSTR-ID TO CHLD-ITM-CLUSTR-ID              09870000
098800             PERFORM U9600-SELECT-PRNT-RELATION                   09880000
098900                THRU U9600-EXIT                                   09890000
099000             IF TITMCLC-RCD-EXISTS                                09900000
099100                 PERFORM U9700-EXPIRE-PRNT-RELATION               09910000
099200                    THRU U9700-EXIT                               09920000
099300             END-IF                                               09930000
099400                                                                  09940000
099500             MOVE WS-CLUSTR-ID TO PRNT-ITM-CLUSTR-ID              09950000
099600             PERFORM U9800-EXPIRE-CHLD-RELATION                   09960000
099700                THRU U9800-EXIT                                   09970000
099800         END-IF                                                   09980000
099900     END-IF.                                                      09990000
100000                                                                  10000000
100100 G1000-EXIT.                                                      10010000
100200     EXIT.                                                        10020000
100300                                                                  10030000
100400                                                                  10040000
100500 H1000-EOJ-PROCESSING.                                            10050000
100600                                                                  10060000
100700     CLOSE MERCH-FILE                                             10070000
100800           ERROR-FILE.                                            10080000
100900                                                                  10090000
101000     EXEC SQL                                                     10100000
101100         COMMIT RELEASE                                           10110000
101200     END-EXEC.                                                    10120000
101300                                                                  10130000
101400     IF SQLCODE = ZERO                                            10140000
101500         CONTINUE                                                 10150000
101600     ELSE                                                         10160000
101700         MOVE SQLCODE    TO SQLCODE2                              10170000
101800         MOVE SQLERRD(3) TO SQLERRD3                              10180000
101900         DISPLAY '** ABEND **       ** = SQLERROR'                10190000
102000         DISPLAY '** PROGRAM        ** = MAKUT145'                10200000
102100         DISPLAY '** SQLCODE        ** = ' SQLCODE                10210000
102200         DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3               10220000
102300         DISPLAY '** SQLERRM        ** = ' SQLERRM                10230000
102400         DISPLAY '** SQLERRMC       ** = ' SQLERRM                10240000
102500         MOVE SPACES TO WS-MSG-TEXT                               10250000
102600*    GET FULL TEXT OF ERROR MESSAGE                               10260000
102700                                                                  10270000
102800         CALL 'SQLGLM' USING WS-MSG-TEXT,                         10280000
102900                             WS-MAX-SIZE,                         10290000
103000                             WS-MSG-LENGTH                        10300000
103100         DISPLAY 'MESSAGE TEXT      ** = ' WS-MSG-TEXT            10310000
103200     END-IF.                                                      10320000
103300                                                                  10330000
103400     DISPLAY '*****************************************'.         10340000
103500     DISPLAY 'MAKUT145'.                                          10350000
103600     DISPLAY 'RCDS READ:          ' WS-READ-COUNT.                10360000
103700     DISPLAY 'ERROR RCDS:         ' WS-ERROR-COUNT.               10370000
103800     DISPLAY 'SKIPPED ERROR RCDS: ' WS-SKIP-ERROR-COUNT.          10380000
103900     DISPLAY '*****************************************'.         10390000
104000                                                                  10400000
104100     IF WS-ERROR-COUNT > 0                                        10410000
104200         MOVE 4095 TO RETURN-CODE                                 10420000
104300     ELSE                                                         10430000
104400         MOVE 0    TO RETURN-CODE                                 10440000
104500     END-IF.                                                      10450000
104600                                                                  10460000
104700 H1000-EXIT.                                                      10470000
104800     EXIT.                                                        10480000
104900                                                                  10490000
105000                                                                  10500000
105100 U8000-WRITE-ERROR-RECORD.                                        10510000
105200                                                                  10520000
105300     WRITE ERROR-RECORD FROM WS-ERROR-RECORD.                     10530000
105400                                                                  10540000
105500     ADD 1 TO WS-ERROR-COUNT.                                     10550000
105600                                                                  10560000
105700 U8000-EXIT.                                                      10570000
105800     EXIT.                                                        10580000
105900                                                                  10590000
106000                                                                  10600000
106100 U9000-SELECT-MERCH-LEVEL.                                        10610000
106200                                                                  10620000
106300     DISPLAY 'U9000-SELECT-MERCH-LEVEL'.                          10630000
106400                                                                  10640000
106500     SET TITMCLT-RCD-DOES-NOT-EXIST TO TRUE.                      10650000
106600                                                                  10660000
106700*    THE FIRST SELECT BELOW IS USED ONLY FOR THE CORP             10670000
106800*    LOOKUP.  ALL OTHER CALLS TO THIS PARAGRAPH WILL              10680000
106900*    HAVE A VALUE FOR ITMCLT-HIER-CDE.                            10690000
107000                                                                  10700000
107100     IF ITMCLT-HIER-CDE = SPACES                                  10710000
107200         EXEC SQL                                                 10720000
107300           SELECT ITEM_CLUSTR_ID                                  10730000
107400             INTO :ITMCLT-ITEM-CLUSTR-ID                          10740000
107500             FROM TITMCLT                                         10750000
107600            WHERE ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME     10760000
107700              AND HIER_TYP_CDE = 'M'                              10770000
107800              AND ((EFF_END_TMST IS NULL) OR                      10780000
107900                   (EFF_END_TMST > :WS-CURR-END-TMST))            10790000
108000         END-EXEC                                                 10800000
108100     ELSE                                                         10810000
108200         EXEC SQL                                                 10820000
108300           SELECT ITEM_CLUSTR_ID                                  10830000
108400             INTO :ITMCLT-ITEM-CLUSTR-ID                          10840000
108500             FROM TITMCLT                                         10850000
108600            WHERE ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME     10860000
108700              AND HIER_CDE         = :ITMCLT-HIER-CDE             10870000
108800              AND HIER_TYP_CDE     = 'M'                          10880000
108900              AND ((EFF_END_TMST IS NULL) OR                      10890000
109000                   (EFF_END_TMST > :WS-CURR-END-TMST))            10900000
109100         END-EXEC                                                 10910000
109200     END-IF.                                                      10920000
109300                                                                  10930000
109400     EVALUATE TRUE                                                10940000
109500         WHEN SQLCODE = ZEROS                                     10950000
109600             DISPLAY 'MERCH LEVEL FOUND'                          10960000
109700             DISPLAY 'ITEM-CLUSTR-NAME:  ' ITMCLT-ITEM-CLUSTR-NAME10970000
109800             SET TITMCLT-RCD-EXISTS         TO TRUE               10980000
109900         WHEN SQLCODE = +1403                                     10990000
110000             DISPLAY 'MERCH LEVEL NOT FOUND'                      11000000
110100             DISPLAY 'ITEM-CLUSTR-NAME:  ' ITMCLT-ITEM-CLUSTR-NAME11010000
110200             SET TITMCLT-RCD-DOES-NOT-EXIST TO TRUE               11020000
110300         WHEN OTHER                                               11030000
110400             DISPLAY 'U9000-SELECT-MERCH-LEVEL'                   11040000
110500             DISPLAY 'ITEM-CLUSTR-NAME:  ' ITMCLT-ITEM-CLUSTR-NAME11050000
110600             DISPLAY 'HIER-CDE:  ' ITMCLT-HIER-CDE                11060000
110700             PERFORM U9999-ABEND-ROUTINE                          11070000
110800     END-EVALUATE.                                                11080000
110900                                                                  11090000
111000 U9000-EXIT.                                                      11100000
111100     EXIT.                                                        11110000
111200                                                                  11120000
111300                                                                  11130000
111400 U9100-SELECT-NEXT-SEQ-NBR.                                       11140000
111500                                                                  11150000
111600     EXEC SQL                                                     11160000
111700         SELECT ITEM_CLUSTR_SEQ.NEXTVAL                           11170000
111800           INTO :ITMCLT-ITEM-CLUSTR-ID                            11180000
111900           FROM DUAL                                              11190000
112000     END-EXEC.                                                    11200000
112100                                                                  11210000
112200     EVALUATE TRUE                                                11220000
112300         WHEN SQLCODE = ZEROS                                     11230000
112400             CONTINUE                                             11240000
112500         WHEN OTHER                                               11250000
112600             DISPLAY 'U9100-SELECT-NEXT-SEQ-NBR'                  11260000
112700             PERFORM U9999-ABEND-ROUTINE                          11270000
112800     END-EVALUATE.                                                11280000
112900                                                                  11290000
113000 U9100-EXIT.                                                      11300000
113100     EXIT.                                                        11310000
113200                                                                  11320000
113300                                                                  11330000
113400 U9200-INSERT-MERCH-LEVEL.                                        11340000
113500                                                                  11350000
113600     DISPLAY 'U9200-INSERT-MERCH-LEVEL'.                          11360000
113700                                                                  11370000
113800     EXEC SQL                                                     11380000
113900         INSERT INTO TITMCLT                                      11390000
114000             (ITEM_CLUSTR_ID,                                     11400000
114100              ITEM_CLUSTR_NAME,                                   11410000
114200              ITEM_CLUSTR_DESC,                                   11420000
114300              EFF_BEG_TMST,                                       11430000
114400              EFF_END_TMST,                                       11440000
114500              CLUSTR_TYP_CDE,                                     11450000
114600              HIER_TYP_CDE,                                       11460000
114700              HIER_CDE,                                           11470000
114800              ITEM_CLUSTR_CDE,                                    11480000
114900              MDSE_NM_CDE,                                        11490000
115000              PROD_SERV_CDE,                                      11500000
115100              CRE_BY_UID,                                         11510000
115200              CRE_TMST,                                           11520000
115300              LAST_UPD_BY_UID,                                    11530000
115400              LAST_UPD_TMST,                                      11540000
115500              ARCH_DTE,                                           11550000
115600              OWNER_ID,                                           11560000
115700              SKU)                                                11570000
115800          VALUES                                                  11580000
115900             (:ITMCLT-ITEM-CLUSTR-ID,                             11590000
116000              :ITMCLT-ITEM-CLUSTR-NAME,                           11600000
116100              :ITMCLT-ITEM-CLUSTR-DESC,                           11610000
116200              :ITMCLT-EFF-BEG-TMST,                               11620000
116300              :ITMCLT-EFF-END-TMST:WS-CLT-EFF-END-DTE-NULL,       11630000
116400              :ITMCLT-CLUSTR-TYP-CDE:WS-CLUSTR-TYP-CDE-NULL,      11640000
116500              :ITMCLT-HIER-TYP-CDE:WS-HIER-TYP-CDE-NULL,          11650000
116600              :ITMCLT-HIER-CDE:WS-HIER-CDE-NULL,                  11660000
116700              :ITMCLT-ITEM-CLUSTR-CDE:WS-ITEM-CLUSTR-CDE-NULL,    11670000
116800              :ITMCLT-MDSE-NM-CDE:WS-MDSE-NM-CDE-NULL,            11680000
116900              :ITMCLT-PROD-SERV-CDE:WS-PROD-SERV-CDE-NULL,        11690000
117000             'MAKUT145',                                          11700000
117100              SYSDATE,                                            11710000
117200             'MAKUT145',                                          11720000
117300              SYSDATE,                                            11730000
117400              :ITMCLT-ARCH-DTE:WS-ARCH-DTE-NULL,                  11740000
117500              :ITMCLT-OWNER-ID:WS-OWNER-ID-NULL,                  11750000
117600              :ITMCLT-SKU:WS-SKU-NULL)                            11760000
117700     END-EXEC.                                                    11770000
117800                                                                  11780000
117900     EVALUATE TRUE                                                11790000
118000         WHEN SQLCODE = ZEROS                                     11800000
118100           DISPLAY 'SUCCESSFUL INSERT OF NEW TITMCLT CLUSTER ID'  11810000
118200           DISPLAY 'ITEM-CLUSTR-ID:   ' ITMCLT-ITEM-CLUSTR-ID     11820000
118300           DISPLAY 'ITEM-CLUSTR-NAME: ' ITMCLT-ITEM-CLUSTR-NAME   11830000
118400           DISPLAY 'ITEM-CLUSTR-DESC: ' ITMCLT-ITEM-CLUSTR-DESC   11840000
118500           DISPLAY 'HIER-CDE:         ' ITMCLT-HIER-CDE           11850000
118600         WHEN OTHER                                               11860000
118700           DISPLAY '******************************************'   11870000
118800           DISPLAY 'U9200-INSERT-MERCH-LEVEL'                     11880000
118900           DISPLAY 'ERROR INSERTING NEW TITMCLT CLUSTER ID'       11890000
119000           DISPLAY 'ITEM-CLUSTR-ID:      ' ITMCLT-ITEM-CLUSTR-ID  11900000
119100           DISPLAY 'ITEM-CLUSTR-NAME:    ' ITMCLT-ITEM-CLUSTR-NAME11910000
119200           DISPLAY 'ITEM-CLUSTR-DESC:    ' ITMCLT-ITEM-CLUSTR-DESC11920000
119300           DISPLAY 'EFF-BEG-TMST:        ' ITMCLT-EFF-BEG-TMST    11930000
119400           DISPLAY 'EFF-END-TMST:        ' ITMCLT-EFF-END-TMST    11940000
119500           DISPLAY 'EFF-END-TMST-NULL:   ' ITMCLT-EFF-END-TMST    11950000
119600           DISPLAY 'OWNER-ID:            ' ITMCLT-OWNER-ID        11960000
119700           DISPLAY 'OWNER-ID-NULL:       ' WS-OWNER-ID-NULL       11970000
119800           DISPLAY '******************************************'   11980000
119900           PERFORM U9999-ABEND-ROUTINE                            11990000
120000     END-EVALUATE.                                                12000000
120100                                                                  12010000
120200 U9200-EXIT.                                                      12020000
120300     EXIT.                                                        12030000
120400                                                                  12040000
120500                                                                  12050000
120600 U9300-INSERT-PRNT-RELATION.                                      12060000
120700                                                                  12070000
120800     DISPLAY 'U9300-INSERT-PRNT-RELATION'.                        12080000
120900                                                                  12090000
121000     EXEC SQL                                                     12100000
121100         INSERT INTO TITMCLC                                      12110000
121200            (PRNT_ITM_CLUSTR_ID,                                  12120000
121300             CHLD_ITM_CLUSTR_ID,                                  12130000
121400             REL_TYP_CDE,                                         12140000
121500             EFF_BEG_TMST,                                        12150000
121600             EFF_END_TMST,                                        12160000
121700             CRE_BY_UID,                                          12170000
121800             CRE_TMST,                                            12180000
121900             LAST_UPD_BY_UID,                                     12190000
122000             LAST_UPD_TMST,                                       12200000
122100             CHLD_ITM_CLSTR_CDE,                                  12210000
122200             CHLD_ITM_UNT_QTY)                                    12220000
122300         VALUES                                                   12230000
122400           (:PRNT-ITM-CLUSTR-ID,                                  12240000
122500            :CHLD-ITM-CLUSTR-ID,                                  12250000
122600            :REL-TYP-CDE,                                         12260000
122700            :EFF-BEG-TMST,                                        12270000
122800            :EFF-END-TMST:WS-CLC-EFF-END-DTE-NULL,                12280000
122900            'MAKUT145',                                           12290000
123000            SYSDATE,                                              12300000
123100            'MAKUT145',                                           12310000
123200            SYSDATE,                                              12320000
123300            :CHLD-ITM-CLSTR-CDE:WS-CHLD-ITM-CLSTR-CDE-NULL,       12330000
123400            :CHLD-ITM-UNT-QTY:WS-CHLD-ITM-UNT-QTY-NULL)           12340000
123500     END-EXEC.                                                    12350000
123600                                                                  12360000
123700     EVALUATE TRUE                                                12370000
123800         WHEN SQLCODE = ZEROS                                     12380000
123900             DISPLAY 'SUCCESSFUL INSERT OF PRNT RELATIONSHIP'     12390000
124000             DISPLAY 'PRNT-ITM-CLUSTR-ID:  ' PRNT-ITM-CLUSTR-ID   12400000
124100             DISPLAY 'CHLD-ITM-CLUSTR-ID:  ' CHLD-ITM-CLUSTR-ID   12410000
124200             CONTINUE                                             12420000
124300         WHEN OTHER                                               12430000
124400             DISPLAY 'U9300-INSERT-PRNT-RELATION'                 12440000
124500             DISPLAY 'PRNT-ITM-CLUSTR-ID:  ' PRNT-ITM-CLUSTR-ID   12450000
124600             DISPLAY 'CHLD-ITM-CLUSTR-ID:  ' CHLD-ITM-CLUSTR-ID   12460000
124700             PERFORM U9999-ABEND-ROUTINE                          12470000
124800     END-EVALUATE.                                                12480000
124900                                                                  12490000
125000 U9300-EXIT.                                                      12500000
125100     EXIT.                                                        12510000
125200                                                                  12520000
125300                                                                  12530000
125400 U9400-UPDATE-DESCRIP.                                            12540000
125500                                                                  12550000
125600     DISPLAY 'U9400-UPDATE-DESCRIP'.                              12560000
125700                                                                  12570000
125800     EXEC SQL                                                     12580000
125900         UPDATE TITMCLT                                           12590000
126000            SET ITEM_CLUSTR_DESC = :ITMCLT-ITEM-CLUSTR-DESC,      12600000
126100                LAST_UPD_TMST    = SYSDATE,                       12610000
126200                LAST_UPD_BY_UID  = 'MAKUT145'                     12620000
126300          WHERE ITEM_CLUSTR_ID   = :ITMCLT-ITEM-CLUSTR-ID         12630000
126400            AND ((EFF_END_TMST IS NULL) OR                        12640000
126500                 (EFF_END_TMST > :WS-CURR-END-TMST))              12650000
126600     END-EXEC.                                                    12660000
126700                                                                  12670000
126800     EVALUATE TRUE                                                12680000
126900         WHEN SQLCODE = ZEROS                                     12690000
127000             CONTINUE                                             12700000
127100         WHEN OTHER                                               12710000
127200             DISPLAY 'U9400-UPDATE-DESCRIP'                       12720000
127300             DISPLAY 'ITEM-CLUSTR-ID:  ' ITMCLT-ITEM-CLUSTR-ID    12730000
127400             PERFORM U9999-ABEND-ROUTINE                          12740000
127500     END-EVALUATE.                                                12750000
127600                                                                  12760000
127700 U9400-EXIT.                                                      12770000
127800     EXIT.                                                        12780000
127900                                                                  12790000
128000                                                                  12800000
128100 U9500-EXPIRE-MERCH-LEVEL.                                        12810000
128200                                                                  12820000
128300     DISPLAY 'U9500-EXPIRE-MERCH-LEVEL'.                          12830000
128400                                                                  12840000
128500     EXEC SQL                                                     12850000
128600         UPDATE TITMCLT                                           12860000
128700            SET EFF_END_TMST     = :WS-CURRENT-TMST,              12870000
128800                LAST_UPD_TMST    = SYSDATE,                       12880000
128900                LAST_UPD_BY_UID  = 'MAKUT145'                     12890000
129000          WHERE ITEM_CLUSTR_ID   = :ITMCLT-ITEM-CLUSTR-ID         12900000
129100            AND ((EFF_END_TMST IS NULL) OR                        12910000
129200                 (EFF_END_TMST > :WS-CURR-END-TMST))              12920000
129300     END-EXEC.                                                    12930000
129400                                                                  12940000
129500     EVALUATE TRUE                                                12950000
129600         WHEN SQLCODE = ZEROS                                     12960000
129700             CONTINUE                                             12970000
129800         WHEN OTHER                                               12980000
129900             DISPLAY 'U9500-EXPIRE-MERCH-LEVEL'                   12990000
130000             DISPLAY 'ITEM-CLUSTR-ID:  ' ITMCLT-ITEM-CLUSTR-ID    13000000
130100             PERFORM U9999-ABEND-ROUTINE                          13010000
130200     END-EVALUATE.                                                13020000
130300                                                                  13030000
130400 U9500-EXIT.                                                      13040000
130500     EXIT.                                                        13050000
130600                                                                  13060000
130700                                                                  13070000
130800*                                                                 13080000
130900*  THE PURPOSE OF THIS PARAGRAPH IS SOLEY TO AVOID AN ABEND       13090000
131000*  SITUATION IN THE EVENT THAT WE HAVE BAD DATA I.E. AN           13100000
131100*  ACTIVE PARENT/CHILD RELATIONSHIP IS MISSING.                   13110000
131200*                                                                 13120000
131300 U9600-SELECT-PRNT-RELATION.                                      13130000
131400                                                                  13140000
131500     DISPLAY 'U9600-EXPIRE-PRNT-RELATION'.                        13150000
131600                                                                  13160000
131700     EXEC SQL                                                     13170000
131800         SELECT PRNT_ITM_CLUSTR_ID                                13180000
131900           INTO :PRNT-ITM-CLUSTR-ID                               13190000
132000           FROM TITMCLC                                           13200000
132100          WHERE CHLD_ITM_CLUSTR_ID = :CHLD-ITM-CLUSTR-ID          13210000
132200            AND REL_TYP_CDE = 'M'                                 13220000
132300            AND ((EFF_END_TMST IS NULL) OR                        13230000
132400                 (EFF_END_TMST > :WS-CURR-END-TMST))              13240000
132500     END-EXEC.                                                    13250000
132600                                                                  13260000
132700     EVALUATE TRUE                                                13270000
132800         WHEN SQLCODE = ZEROS                                     13280000
132900             SET TITMCLC-RCD-EXISTS TO TRUE                       13290000
133000         WHEN SQLCODE = +1403                                     13300000
133100             SET TITMCLC-RCD-DOES-NOT-EXIST TO TRUE               13310000
133200         WHEN OTHER                                               13320000
133300             DISPLAY 'U9600-SELECT-PRNT-RELATION'                 13330000
133400             DISPLAY 'CHLD-ITM-CLUSTR-ID:  ' CHLD-ITM-CLUSTR-ID   13340000
133500             PERFORM U9999-ABEND-ROUTINE                          13350000
133600     END-EVALUATE.                                                13360000
133700                                                                  13370000
133800 U9600-EXIT.                                                      13380000
133900     EXIT.                                                        13390000
134000                                                                  13400000
134100                                                                  13410000
134200 U9700-EXPIRE-PRNT-RELATION.                                      13420000
134300                                                                  13430000
134400     DISPLAY 'U9700-EXPIRE-PRNT-RELATION'.                        13440000
134500                                                                  13450000
134600     EXEC SQL                                                     13460000
134700         UPDATE TITMCLC                                           13470000
134800            SET EFF_END_TMST       = :WS-CURRENT-TMST,            13480000
134900                LAST_UPD_TMST      = SYSDATE,                     13490000
135000                LAST_UPD_BY_UID    = 'MAKUT145'                   13500000
135100          WHERE CHLD_ITM_CLUSTR_ID = :CHLD-ITM-CLUSTR-ID          13510000
135200            AND REL_TYP_CDE = 'M'                                 13520000
135300            AND ((EFF_END_TMST IS NULL) OR                        13530000
135400                 (EFF_END_TMST > :WS-CURR-END-TMST))              13540000
135500     END-EXEC.                                                    13550000
135600                                                                  13560000
135700     EVALUATE TRUE                                                13570000
135800         WHEN SQLCODE = ZEROS                                     13580000
135900             CONTINUE                                             13590000
136000         WHEN OTHER                                               13600000
136100             DISPLAY 'U9700-EXPIRE-PRNT-RELATION'                 13610000
136200             DISPLAY 'CHLD-ITM-CLUSTR-ID:  ' CHLD-ITM-CLUSTR-ID   13620000
136300             PERFORM U9999-ABEND-ROUTINE                          13630000
136400     END-EVALUATE.                                                13640000
136500                                                                  13650000
136600 U9700-EXIT.                                                      13660000
136700     EXIT.                                                        13670000
136800                                                                  13680000
136900                                                                  13690000
137000*                                                                 13700000
137100*   THIS EXPIRATION LOGIC WILL BE CALLED BUT THE EXPCLC CURSOR    13710000
137200*   SHOULD NEVER FIND ACTIVE RELATIONSHIPS TO EXPIRE.  THE        13720000
137300*   REASON FOR THIS IS THAT THE LOWER LEVEL (I.E. CHILD) SHOULD   13730000
137400*   BE EXPIRED BEFORE THE HIGHER LEVEL (I.E. THE PARENT IN THIS   13740000
137500*   CASE).  WHEN THE LOWER LEVEL (THIS MERCH LEVEL'S CHILD) WAS   13750000
137600*   EXPIRED, ITS TITMCLC PARENT/CHILD RELATIONSHIP SHOULD HAVE    13760000
137700*   BEEN EXPIRED ALSO.  SO IF THIS MERCH LEVEL IS BEING EXPIRED   13770000
137800*   NOW, IT SHOULD NOT HAVE ANY ACTIVE CHILD RELATIONSHIPS.       13780000
137900*                                                                 13790000
138000*   NOTE:  WHEN SKU'S ARE EXPIRED, PROGRAM MAKUT102 ALSO          13800000
138100*   EXPIRES THE SUBCLASS TO SKU (TITMCLC PARENT/CHILD)            13810000
138200*   RELATIONSHIP.                                                 13820000
138300*                                                                 13830000
138400*   KEEPING THIS CODE PROVIDES A SAFEGUARD SO THAT ACTIVE         13840000
138500*   TITMCLC PARENT/CHILD RELATIONSHIPS DO NOT EXIST WHEN          13850000
138600*   A PARENT TITMCLT RECORD IS EXPIRED.  ALSO, DUE TO PRIOR       13860000
138700*   PROCESSING ERRORS, THERE MAY BE RELATIONSHIPS THAT            13870000
138800*   SHOULD HAVE BEEN EXPIRED AND WEREN'T.                         13880000
138900*                                                                 13890000
139000*                                                                 13900000
139100 U9800-EXPIRE-CHLD-RELATION.                                      13910000
139200                                                                  13920000
139300     DISPLAY 'U9800-EXPIRE-CHLD-RELATION'.                        13930000
139400                                                                  13940000
139500     PERFORM U9710-OPEN-EXPCLC-CURSOR                             13950000
139600        THRU U9710-EXIT.                                          13960000
139700                                                                  13970000
139800     SET MORE-ROWS TO TRUE.                                       13980000
139900     PERFORM U9720-PROCESS-CHLD-RCDS                              13990000
140000        THRU U9720-EXIT                                           14000000
140100       UNTIL NO-MORE-ROWS.                                        14010000
140200                                                                  14020000
140300     PERFORM U9730-CLOSE-EXPCLC-CURSOR                            14030000
140400        THRU U9730-EXIT.                                          14040000
140500                                                                  14050000
140600 U9800-EXIT.                                                      14060000
140700     EXIT.                                                        14070000
140800                                                                  14080000
140900                                                                  14090000
141000 U9710-OPEN-EXPCLC-CURSOR.                                        14100000
141100                                                                  14110000
141200     EXEC SQL                                                     14120000
141300        OPEN EXPCLC                                               14130000
141400     END-EXEC.                                                    14140000
141500                                                                  14150000
141600     EVALUATE TRUE                                                14160000
141700         WHEN SQLCODE = ZEROS                                     14170000
141800             CONTINUE                                             14180000
141900         WHEN OTHER                                               14190000
142000             DISPLAY 'U9710-OPEN-EXPCLC-CURSOR'                   14200000
142100             PERFORM U9999-ABEND-ROUTINE                          14210000
142200     END-EVALUATE.                                                14220000
142300                                                                  14230000
142400 U9710-EXIT.                                                      14240000
142500     EXIT.                                                        14250000
142600                                                                  14260000
142700                                                                  14270000
142800 U9720-PROCESS-CHLD-RCDS.                                         14280000
142900                                                                  14290000
143000     PERFORM U9721-FETCH-EXPCLC-CURSOR                            14300000
143100        THRU U9721-EXIT.                                          14310000
143200                                                                  14320000
143300     IF NO-MORE-ROWS                                              14330000
143400         GO TO U9720-EXIT                                         14340000
143500     END-IF.                                                      14350000
143600                                                                  14360000
143700     PERFORM U9722-EXPIRE-EXPCLC-RCDS                             14370000
143800        THRU U9722-EXIT.                                          14380000
143900                                                                  14390000
144000 U9720-EXIT.                                                      14400000
144100     EXIT.                                                        14410000
144200                                                                  14420000
144300                                                                  14430000
144400 U9721-FETCH-EXPCLC-CURSOR.                                       14440000
144500                                                                  14450000
144600     DISPLAY 'U9721-FETCH-EXPCLC-CURSOR'.                         14460000
144700                                                                  14470000
144800     EXEC SQL                                                     14480000
144900         FETCH EXPCLC                                             14490000
145000          INTO :CHLD-ITM-CLUSTR-ID                                14500000
145100     END-EXEC.                                                    14510000
145200                                                                  14520000
145300     EVALUATE TRUE                                                14530000
145400         WHEN SQLCODE = ZEROS                                     14540000
145500             CONTINUE                                             14550000
145600         WHEN SQLCODE = +1403                                     14560000
145700             SET NO-MORE-ROWS TO TRUE                             14570000
145800         WHEN OTHER                                               14580000
145900             DISPLAY 'U9721-FETCH-EXPCLC-CURSOR'                  14590000
146000             DISPLAY 'PRNT-ITM-CLUSTR-ID:  ' PRNT-ITM-CLUSTR-ID   14600000
146100             PERFORM U9999-ABEND-ROUTINE                          14610000
146200     END-EVALUATE.                                                14620000
146300                                                                  14630000
146400 U9721-EXIT.                                                      14640000
146500     EXIT.                                                        14650000
146600                                                                  14660000
146700                                                                  14670000
146800 U9722-EXPIRE-EXPCLC-RCDS.                                        14680000
146900                                                                  14690000
147000     DISPLAY 'U9722-EXPIRE-EXPCLC-RCDS'.                          14700000
147100                                                                  14710000
147200     EXEC SQL                                                     14720000
147300        UPDATE TITMCLC                                            14730000
147400           SET EFF_END_TMST       = :WS-CURRENT-TMST,             14740000
147500               LAST_UPD_TMST      = SYSDATE,                      14750000
147600               LAST_UPD_BY_UID    = 'MAKUT145'                    14760000
147700         WHERE PRNT_ITM_CLUSTR_ID = :PRNT-ITM-CLUSTR-ID           14770000
147800           AND CHLD_ITM_CLUSTR_ID = :CHLD-ITM-CLUSTR-ID           14780000
147900           AND REL_TYP_CDE        = 'M'                           14790000
148000           AND ((EFF_END_TMST IS NULL) OR                         14800000
148100                (EFF_END_TMST > :WS-CURR-END-TMST))               14810000
148200     END-EXEC.                                                    14820000
148300                                                                  14830000
148400     EVALUATE TRUE                                                14840000
148500         WHEN SQLCODE = ZEROS                                     14850000
148600             DISPLAY 'EXPIRATION SUCCESSFUL'                      14860000
148700             DISPLAY 'PRNT-ITM-CLUSTR-ID:  ' PRNT-ITM-CLUSTR-ID   14870000
148800             DISPLAY 'CHLD-ITM-CLUSTR-ID:  ' CHLD-ITM-CLUSTR-ID   14880000
148900             CONTINUE                                             14890000
149000         WHEN OTHER                                               14900000
149100             DISPLAY 'U9722-EXPIRE-EXPCLC-RCDS'                   14910000
149200             DISPLAY 'PRNT-ITM-CLUSTR-ID:  ' PRNT-ITM-CLUSTR-ID   14920000
149300             DISPLAY 'CHLD-ITM-CLUSTR-ID:  ' CHLD-ITM-CLUSTR-ID   14930000
149400             PERFORM U9999-ABEND-ROUTINE                          14940000
149500     END-EVALUATE.                                                14950000
149600                                                                  14960000
149700 U9722-EXIT.                                                      14970000
149800     EXIT.                                                        14980000
149900                                                                  14990000
150000                                                                  15000000
150100 U9730-CLOSE-EXPCLC-CURSOR.                                       15010000
150200                                                                  15020000
150300     EXEC SQL                                                     15030000
150400        CLOSE EXPCLC                                              15040000
150500     END-EXEC.                                                    15050000
150600                                                                  15060000
150700     EVALUATE TRUE                                                15070000
150800         WHEN SQLCODE = ZEROS                                     15080000
150900             CONTINUE                                             15090000
151000         WHEN OTHER                                               15100000
151100             DISPLAY 'U9730-CLOSE-EXPCLC-CURSOR'                  15110000
151200             PERFORM U9999-ABEND-ROUTINE                          15120000
151300     END-EVALUATE.                                                15130000
151400                                                                  15140000
151500 U9730-EXIT.                                                      15150000
151600     EXIT.                                                        15160000
151700                                                                  15170000
151800                                                                  15180000
151900 U9900-CHECK-REALIGNMENT.                                         15190000
152000                                                                  15200000
152100     DISPLAY 'U9900-CHECK-REALIGNMENT'.                           15210000
152200                                                                  15220000
152300*  LOOK UP THE PRNT-ITM-CLUSTR-ID ON TITMCLC FOR THIS RCD         15230000
152400     MOVE WS-CLUSTR-ID TO CHLD-ITM-CLUSTR-ID.                     15240000
152500     PERFORM U9910-SELECT-PRNT-RELATION                           15250000
152600        THRU U9910-EXIT.                                          15260000
152700                                                                  15270000
152800     IF TITMCLC-RCD-EXISTS                                        15280000
152900         MOVE PRNT-ITM-CLUSTR-ID TO WS-PRNT-CLUSTR-ID             15290000
153000                                    ITMCLT-ITEM-CLUSTR-ID         15300000
153100                                                                  15310000
153200*  GET THE PRNT ITEM-CLUSTR-NAME SO IT CAN BE COMPARED WITH       15320000
153300*  THE PARENT INFO ON THE INCOMING RCD                            15330000
153400         PERFORM U9920-SELECT-MERCH-LEVEL-BY-ID                   15340000
153500            THRU U9920-EXIT                                       15350000
153600                                                                  15360000
153700         IF TITMCLT-RCD-EXISTS                                    15370000
153800             IF ((HM001-RMS-TBL-NAME = WS-GROUPS-TABLE            15380000
153900                  AND ITMCLT-ITEM-CLUSTR-NAME(1:2)                15390000
154000                                     = HM001-GRPS-DIVISION(3:2))  15400000
154100              OR (HM001-RMS-TBL-NAME = WS-DEPS-TABLE              15410000
154200                  AND ITMCLT-ITEM-CLUSTR-NAME(1:2)                15420000
154300                                     = HM001-DEPS-GROUP-NO(3:2))) 15430000
154400                 GO TO U9900-EXIT                                 15440000
154500             ELSE                                                 15450000
154600*  DO THE EXPIRATION OF THE OLD PRNT/CHLD RELATIONSHIP AFTER THE  15460000
154700*  SUCCESSFUL INSERTION OF THE NEW PRNT/CHLD RELATIONSHIP         15470000
154800                 SET EXPIRE-RELATIONSHIP TO TRUE                  15480000
154900             END-IF                                               15490000
155000         ELSE                                                     15500000
155100             SET EXPIRE-RELATIONSHIP TO TRUE                      15510000
155200         END-IF                                                   15520000
155300     ELSE                                                         15530000
155400         SET DO-NOT-EXPIRE-RELATIONSHIP TO TRUE                   15540000
155500     END-IF.                                                      15550000
155600                                                                  15560000
155700*  DO THE SET UP TO LOOK UP THE NEW PRNT ON TITMCLT               15570000
155800     IF HM001-RMS-TBL-NAME = WS-GROUPS-TABLE                      15580000
155900         MOVE WS-GMA              TO ITMCLT-HIER-CDE              15590000
156000         MOVE HM001-GRPS-DIVISION TO WS-WORK-GMA                  15600000
156100         MOVE WS-WORK-GMA-3-4     TO WS-ITEM-CLUSTR-GMA           15610000
156200         MOVE WS-ITEM-CLUSTR-NAME-GMA                             15620000
156300                                  TO ITMCLT-ITEM-CLUSTR-NAME      15630000
156400     ELSE                                                         15640000
156500         MOVE WS-DMA              TO ITMCLT-HIER-CDE              15650000
156600         MOVE HM001-DEPS-GROUP-NO TO WS-WORK-DMA                  15660000
156700         MOVE WS-WORK-DMA-3-4     TO WS-ITEM-CLUSTR-DMA           15670000
156800         MOVE WS-ITEM-CLUSTR-NAME-DMA                             15680000
156900                                  TO ITMCLT-ITEM-CLUSTR-NAME      15690000
157000     END-IF.                                                      15700000
157100                                                                  15710000
157200     PERFORM U9000-SELECT-MERCH-LEVEL                             15720000
157300        THRU U9000-EXIT.                                          15730000
157400                                                                  15740000
157500     IF TITMCLT-RCD-EXISTS                                        15750000
157600         MOVE ITMCLT-ITEM-CLUSTR-ID                               15760000
157700                           TO WS-NEW-PRNT-CLUSTR-ID               15770000
157800                              PRNT-ITM-CLUSTR-ID                  15780000
157900         MOVE WS-CLUSTR-ID TO CHLD-ITM-CLUSTR-ID                  15790000
158000         MOVE -1           TO WS-CLC-EFF-END-DTE-NULL             15800000
158100                                                                  15810000
158200         PERFORM U9930-SELECT-PRNTCHLD-RELATION                   15820000
158300            THRU U9930-EXIT                                       15830000
158400                                                                  15840000
158500         IF TITMCLC-RCD-DOES-NOT-EXIST                            15850000
158600             PERFORM U9300-INSERT-PRNT-RELATION                   15860000
158700                THRU U9300-EXIT                                   15870000
158800         ELSE                                                     15880000
158900                                                                  15890000
159000* THE IF BELOW WAS ADDED BECAUSE USERS WERE CREATING THE SAME     15900000
159100* GMA/DMA OR DMA/DPT RELATIONSHIPS MORE THAN ONCE.  TITMCLC       15910000
159200* HAS A CONSTRAINT THAT ALLOWS ONLY 1 RECORD TO HAVE A SPECIFIC   15920000
159300* PRNT AND CHLD CLUSTER ID PAIR.  WHEN USERS ARE TRYING TO        15930000
159400* RECREATE A RELATIONSHIP THAT HAS ALREADY BEEN CREATED, WE NEED  15940000
159500* TO UNEXPIRE THE OLD RELATIONSHIP.                               15950000
159600                                                                  15960000
159700             IF TITMCLC-RCD-EXISTS                                15970000
159800               AND WS-CLC-EFF-END-DTE-NULL = 0                    15980000
159900                 MOVE SPACES TO EFF-END-TMST                      15990000
160000                 MOVE -1 TO WS-CLC-EFF-END-DTE-NULL               16000000
160100                 PERFORM U9950-UPDATE-PRNT-RELATION               16010000
160200                    THRU U9950-EXIT                               16020000
160300             END-IF                                               16030000
160400         END-IF                                                   16040000
160500     ELSE                                                         16050000
160600         MOVE WS-COULD-NOT-REALIGN TO WS-ERROR-MSG                16060000
160700         IF HM001-RMS-TBL-NAME = WS-GROUPS-TABLE                  16070000
160800             MOVE WS-ITEM-CLUSTR-NAME-GMA TO WS-ERROR-DATA1       16080000
160900             MOVE WS-ITEM-CLUSTR-NAME-DMA TO WS-ERROR-DATA2       16090000
161000         ELSE                                                     16100000
161100             MOVE WS-ITEM-CLUSTR-NAME-DMA TO WS-ERROR-DATA1       16110000
161200             MOVE WS-ITEM-CLUSTR-NAME-DPT TO WS-ERROR-DATA2       16120000
161300         END-IF                                                   16130000
161400         PERFORM U8000-WRITE-ERROR-RECORD                         16140000
161500            THRU U8000-EXIT                                       16150000
161600                                                                  16160000
161700*  IF THE INSERTION FAILED, BYPASS THE EXPIRATION PROCESS.        16170000
161800*  IT'S BETTER FOR THE CURRENT RCD TO HAVE AN OUTDATED PRNT/CHLD  16180000
161900*  RELATIONSHIP RATHER THAN NONE AT ALL.                          16190000
162000                                                                  16200000
162100         GO TO U9900-EXIT                                         16210000
162200     END-IF.                                                      16220000
162300                                                                  16230000
162400     IF EXPIRE-RELATIONSHIP                                       16240000
162500         MOVE WS-PRNT-CLUSTR-ID    TO PRNT-ITM-CLUSTR-ID          16250000
162600         MOVE WS-CLUSTR-ID         TO CHLD-ITM-CLUSTR-ID          16260000
162700         PERFORM U9940-EXPIRE-PRNT-RELATION                       16270000
162800            THRU U9940-EXIT                                       16280000
162900     END-IF.                                                      16290000
163000                                                                  16300000
163100 U9900-EXIT.                                                      16310000
163200     EXIT.                                                        16320000
163300                                                                  16330000
163400                                                                  16340000
163500 U9910-SELECT-PRNT-RELATION.                                      16350000
163600                                                                  16360000
163700     DISPLAY 'U9910-SELECT-PRNT-RELATION'.                        16370000
163800                                                                  16380000
163900     SET TITMCLC-RCD-DOES-NOT-EXIST TO TRUE.                      16390000
164000                                                                  16400000
164100     EXEC SQL                                                     16410000
164200       SELECT PRNT_ITM_CLUSTR_ID                                  16420000
164300         INTO :PRNT-ITM-CLUSTR-ID                                 16430000
164400         FROM TITMCLC A,                                          16440000
164500              TITMCLT B                                           16450000
164600        WHERE A.CHLD_ITM_CLUSTR_ID = :CHLD-ITM-CLUSTR-ID          16460000
164700          AND A.REL_TYP_CDE = 'M'                                 16470000
164800          AND ((A.EFF_END_TMST IS NULL) OR                        16480000
164900               (A.EFF_END_TMST > :WS-CURR-END-TMST))              16490000
165000          AND A.PRNT_ITM_CLUSTR_ID = B.ITEM_CLUSTR_ID             16500000
165100          AND B.HIER_CDE IN ('GMA', 'DMA')                        16510000
165200     END-EXEC.                                                    16520000
165300                                                                  16530000
165400     EVALUATE TRUE                                                16540000
165500         WHEN SQLCODE = ZEROS                                     16550000
165600             DISPLAY 'PRNT RELATIONSHIP FOUND'                    16560000
165700             DISPLAY 'CHLD-ITM-CLUSTR-ID:  ' CHLD-ITM-CLUSTR-ID   16570000
165800             SET TITMCLC-RCD-EXISTS TO TRUE                       16580000
165900         WHEN SQLCODE = +1403                                     16590000
166000             DISPLAY 'PRNT RELATIONSHIP NOT FOUND'                16600000
166100             DISPLAY 'CHLD-ITM-CLUSTR-ID:  ' CHLD-ITM-CLUSTR-ID   16610000
166200             SET TITMCLC-RCD-DOES-NOT-EXIST TO TRUE               16620000
166300         WHEN OTHER                                               16630000
166400             DISPLAY 'U9910-SELECT-PRNT-RELATION'                 16640000
166500             DISPLAY 'CHLD-ITM-CLUSTR-ID:  ' CHLD-ITM-CLUSTR-ID   16650000
166600             PERFORM U9999-ABEND-ROUTINE                          16660000
166700     END-EVALUATE.                                                16670000
166800                                                                  16680000
166900 U9910-EXIT.                                                      16690000
167000     EXIT.                                                        16700000
167100                                                                  16710000
167200                                                                  16720000
167300 U9920-SELECT-MERCH-LEVEL-BY-ID.                                  16730000
167400                                                                  16740000
167500     DISPLAY 'U9920-SELECT-MERCH-LEVEL-BY-ID'.                    16750000
167600                                                                  16760000
167700     SET TITMCLT-RCD-DOES-NOT-EXIST TO TRUE.                      16770000
167800                                                                  16780000
167900     EXEC SQL                                                     16790000
168000       SELECT ITEM_CLUSTR_NAME                                    16800000
168100         INTO :ITMCLT-ITEM-CLUSTR-NAME                            16810000
168200         FROM TITMCLT                                             16820000
168300        WHERE ITEM_CLUSTR_ID = :ITMCLT-ITEM-CLUSTR-ID             16830000
168400          AND ((EFF_END_TMST IS NULL) OR                          16840000
168500               (EFF_END_TMST > :WS-CURR-END-TMST))                16850000
168600     END-EXEC.                                                    16860000
168700                                                                  16870000
168800     EVALUATE TRUE                                                16880000
168900         WHEN SQLCODE = ZEROS                                     16890000
169000             DISPLAY 'CLUSTER NAME FOUND'                         16900000
169100             DISPLAY 'ITMCLT-ITEM-CLUSTR-ID: '                    16910000
169200                                  ITMCLT-ITEM-CLUSTR-ID           16920000
169300             SET TITMCLT-RCD-EXISTS         TO TRUE               16930000
169400         WHEN SQLCODE = +1403                                     16940000
169500             DISPLAY 'CLUSTER NAME NOT FOUND'                     16950000
169600             DISPLAY 'ITMCLT-ITEM-CLUSTR-ID: '                    16960000
169700                                  ITMCLT-ITEM-CLUSTR-ID           16970000
169800             SET TITMCLT-RCD-DOES-NOT-EXIST TO TRUE               16980000
169900         WHEN OTHER                                               16990000
170000             DISPLAY 'U9920-SELECT-MERCH-LEVEL-BY-ID'             17000000
170100             DISPLAY 'ITEM-CLUSTR-ID:  ' ITMCLT-ITEM-CLUSTR-ID    17010000
170200             PERFORM U9999-ABEND-ROUTINE                          17020000
170300     END-EVALUATE.                                                17030000
170400                                                                  17040000
170500 U9920-EXIT.                                                      17050000
170600     EXIT.                                                        17060000
170700                                                                  17070000
170800                                                                  17080000
170900 U9930-SELECT-PRNTCHLD-RELATION.                                  17090000
171000                                                                  17100000
171100     DISPLAY 'U9930-SELECT-PRNTCHLD-RELATION'.                    17110000
171200                                                                  17120000
171300     SET TITMCLC-RCD-DOES-NOT-EXIST TO TRUE.                      17130000
171400                                                                  17140000
171500     EXEC SQL                                                     17150000
171600       SELECT EFF_END_TMST                                        17160000
171700         INTO :EFF-END-TMST:WS-CLC-EFF-END-DTE-NULL               17170000
171800         FROM TITMCLC                                             17180000
171900        WHERE PRNT_ITM_CLUSTR_ID = :PRNT-ITM-CLUSTR-ID            17190000
172000          AND CHLD_ITM_CLUSTR_ID = :CHLD-ITM-CLUSTR-ID            17200000
172100          AND REL_TYP_CDE = 'M'                                   17210000
172200     END-EXEC.                                                    17220000
172300                                                                  17230000
172400     EVALUATE TRUE                                                17240000
172500         WHEN SQLCODE = ZEROS                                     17250000
172600             DISPLAY 'PRNT CHLD RELATIONSHIP FOUND'               17260000
172700             DISPLAY 'PRNT-ITM-CLUSTR-ID:  ' PRNT-ITM-CLUSTR-ID   17270000
172800             DISPLAY 'CHLD-ITM-CLUSTR-ID:  ' CHLD-ITM-CLUSTR-ID   17280000
172900             SET TITMCLC-RCD-EXISTS         TO TRUE               17290000
173000         WHEN SQLCODE = +1403                                     17300000
173100             DISPLAY 'PRNT CHLD RELATIONSHIP NOT FOUND'           17310000
173200             DISPLAY 'PRNT-ITM-CLUSTR-ID:  ' PRNT-ITM-CLUSTR-ID   17320000
173300             DISPLAY 'CHLD-ITM-CLUSTR-ID:  ' CHLD-ITM-CLUSTR-ID   17330000
173400             SET TITMCLC-RCD-DOES-NOT-EXIST TO TRUE               17340000
173500         WHEN OTHER                                               17350000
173600             DISPLAY 'U9930-SELECT-PRNTCHLD-RELATION'             17360000
173700             DISPLAY 'PRNT-ITM-CLUSTR-ID:  ' PRNT-ITM-CLUSTR-ID   17370000
173800             DISPLAY 'CHLD-ITM-CLUSTR-ID:  ' CHLD-ITM-CLUSTR-ID   17380000
173900             PERFORM U9999-ABEND-ROUTINE                          17390000
174000     END-EVALUATE.                                                17400000
174100                                                                  17410000
174200 U9930-EXIT.                                                      17420000
174300     EXIT.                                                        17430000
174400                                                                  17440000
174500                                                                  17450000
174600 U9940-EXPIRE-PRNT-RELATION.                                      17460000
174700                                                                  17470000
174800     DISPLAY 'U9940-EXPIRE-PRNT-RELATION'.                        17480000
174900                                                                  17490000
175000     EXEC SQL                                                     17500000
175100         UPDATE TITMCLC                                           17510000
175200            SET EFF_END_TMST       = :WS-CURRENT-TMST,            17520000
175300                LAST_UPD_TMST      = SYSDATE,                     17530000
175400                LAST_UPD_BY_UID    = 'MAKUT145'                   17540000
175500          WHERE PRNT_ITM_CLUSTR_ID = :PRNT-ITM-CLUSTR-ID          17550000
175600            AND CHLD_ITM_CLUSTR_ID = :CHLD-ITM-CLUSTR-ID          17560000
175700            AND REL_TYP_CDE        = 'M'                          17570000
175800            AND ((EFF_END_TMST IS NULL) OR                        17580000
175900                 (EFF_END_TMST > :WS-CURR-END-TMST))              17590000
176000     END-EXEC.                                                    17600000
176100                                                                  17610000
176200     EVALUATE TRUE                                                17620000
176300         WHEN SQLCODE = ZEROS                                     17630000
176400             CONTINUE                                             17640000
176500         WHEN OTHER                                               17650000
176600             DISPLAY 'U9940-EXPIRE-PRNT-RELATION'                 17660000
176700             DISPLAY 'PRNT-ITM-CLUSTR-ID:  ' PRNT-ITM-CLUSTR-ID   17670000
176800             DISPLAY 'CHLD-ITM-CLUSTR-ID:  ' CHLD-ITM-CLUSTR-ID   17680000
176900             PERFORM U9999-ABEND-ROUTINE                          17690000
177000     END-EVALUATE.                                                17700000
177100                                                                  17710000
177200 U9940-EXIT.                                                      17720000
177300     EXIT.                                                        17730000
177400                                                                  17740000
177500                                                                  17750000
177600 U9950-UPDATE-PRNT-RELATION.                                      17760000
177700                                                                  17770000
177800     DISPLAY 'U9950-UPDATE-PRNT-RELATION'.                        17780000
177900                                                                  17790000
178000     EXEC SQL                                                     17800000
178100         UPDATE TITMCLC                                           17810000
178200            SET EFF_END_TMST       =                              17820000
178300                     :EFF-END-TMST:WS-CLC-EFF-END-DTE-NULL,       17830000
178400                LAST_UPD_TMST      = SYSDATE,                     17840000
178500                LAST_UPD_BY_UID    = 'MAKUT145'                   17850000
178600          WHERE PRNT_ITM_CLUSTR_ID = :PRNT-ITM-CLUSTR-ID          17860000
178700            AND CHLD_ITM_CLUSTR_ID = :CHLD-ITM-CLUSTR-ID          17870000
178800            AND REL_TYP_CDE = 'M'                                 17880000
178900     END-EXEC.                                                    17890000
179000                                                                  17900000
179100     EVALUATE TRUE                                                17910000
179200         WHEN SQLCODE = ZEROS                                     17920000
179300             CONTINUE                                             17930000
179400         WHEN OTHER                                               17940000
179500             DISPLAY 'U9950-UPDATE-PRNT-RELATION'                 17950000
179600             DISPLAY 'PRNT-ITM-CLUSTR-ID:  ' PRNT-ITM-CLUSTR-ID   17960000
179700             DISPLAY 'CHLD-ITM-CLUSTR-ID:  ' CHLD-ITM-CLUSTR-ID   17970000
179800             PERFORM U9999-ABEND-ROUTINE                          17980000
179900     END-EVALUATE.                                                17990000
180000                                                                  18000000
180100 U9950-EXIT.                                                      18010000
180200     EXIT.                                                        18020000
180300                                                                  18030000
180400                                                                  18040000
180500 U9999-ABEND-ROUTINE.                                             18050000
180600                                                                  18060000
180700     MOVE SQLCODE    TO SQLCODE2.                                 18070000
180800     MOVE SQLERRD(3) TO SQLERRD3.                                 18080000
180900     DISPLAY '** ABEND **       ** = SQLERROR'.                   18090000
181000     DISPLAY '** PROGRAM        ** = MAKUT145'.                   18100000
181100     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  18110000
181200     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  18120000
181300     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   18130000
181400     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  18140000
181500     DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5)                 18150000
181600                                                                  18160000
181700     MOVE SPACES TO WS-MSG-TEXT.                                  18170000
181800                                                                  18180000
181900*    GET FULL TEXT OF ERROR MESSAGE                               18190000
182000      CALL 'SQLGLM' USING WS-MSG-TEXT,                            18200000
182100                          WS-MAX-SIZE,                            18210000
182200                          WS-MSG-LENGTH.                          18220000
182300      DISPLAY 'MESSAGE TEXT      ** = ' WS-MSG-TEXT.              18230000
182400                                                                  18240000
182500      EXEC SQL                                                    18250000
182600          ROLLBACK WORK RELEASE                                   18260000
182700      END-EXEC.                                                   18270000
182800                                                                  18280000
182900** A SQLCODE OF -2068 IS AN ORACLE DATABASE DISCONNECT ERR        18290000
183000      IF SQLCODE = -2068                                          18300000
183100          MOVE +4016 TO WS-ABEND-CODE                             18310000
183200      ELSE                                                        18320000
183300          MOVE +4013 TO WS-ABEND-CODE                             18330000
183400      END-IF.                                                     18340000
183500                                                                  18350000
183600      CALL 'ILBOABN0' USING WS-ABEND-CODE.                        18360000
183700                                                                  18370000
