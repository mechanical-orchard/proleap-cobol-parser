000100 IDENTIFICATION DIVISION.                                         00010000
000200******************************************************************00070000
000300 PROGRAM-ID.    PEKUT002.                                         00020000
000400 AUTHOR.        LIHUA LIANG.                                      00030000
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000600 DATE-WRITTEN.  MARCH 2006.                                       00050000
000700 DATE-COMPILED.                                                   00060000
000800******************************************************************00070000
000900* THIS IS THE MARKDOWN FORECASTING PROGRAM. IT READS IN TWO       00080000
001000* CONTROL CARDS, (1) RUN DATE AND (2) NUMBER OF DAYS TO ADVANCE.  00080000
001300*                                                                 00100000
001400* IF ONLY MARK1 DATE EXIST IN THE PET_CLR_MKDN_EVNT TALBE, NO     00100000
001500* NEED TO CALCULATE DATE FOR OUTPUT.                              00100000
001600*                                                                 00100000
001700* IF MARK2/FINAL DATE EXIST IN THE PET_CLR_MKDN_EVNT TALBE, AND   00100000
001800* IT FALLS ON THE WEEK OF THE RUN DATE + THE NUMBER OF DAYS TO    00100000
001900* ADVANCE, THE PROGRAM WILL RETRIEVE THE MARK1 DATE AND WRITE     00100000
002000* THE MARK1 DATE TO ONE OF THE EIGHT OUPTPUT FILES. THE EIGHTH    00100000
002000* OUTPUT FILE IS FOR HOLDING THE POTENTIAL EXTRA DATES. UNLIKE    00100000
002000* THE OTHER 7 OUTPUT FILES, THE EIGHTH OUTPUT FILE MIGHT HAVE     00100000
002000* MORE THAN ONE DATE.                                             00100000
002100*                                                                 00110000
002200* ORACLE TABLE:                                                   00110000
002300* PET_CLR_MKDN_EVNT.                                              00120000
002400******************************************************************00240000
072308*DATE: 08/24/2008 MADE BY:J.HELING  COLUMN REMOVED FROM TABLE             
072308*                                    PET_CLR_MKDN_EVNT.                   
001400*----------------------------------------------------------               
001500* HISTORY LOG:                                                            
001600*----------------------------------------------------------               
001700* DATE:                                                                   
001800* WR/IR#:                                                                 
001900* PROGRAMMER:                                                             
002000* DESCRIPTION:                                                            
002100*                                                                         
216764* DATE: 01/31/2019                                                        
216764* WR/IR#: CHG0216764                                                      
216764* PROGRAMMER: COGNIZANT                                                   
216764* DESCRIPTION: ORACLE LOGON STANDARDS                                     
216764*              PROGRAM CHANGE                                             
002200*----------------------------------------------------------               
      ******************************************************************        
002500 ENVIRONMENT DIVISION.                                            00250000
002600******************************************************************00240000
002700                                                                  00310000
002800 CONFIGURATION SECTION.                                           00260000
002900                                                                  00310000
003000 SOURCE-COMPUTER. IBM-3090.                                       00270000
003100                                                                  00310000
003200 OBJECT-COMPUTER. IBM-3090.                                       00280000
003300                                                                  00310000
003400 INPUT-OUTPUT SECTION.                                            00290000
003500                                                                  00310000
003600 FILE-CONTROL.                                                    00300000
003700                                                                  00310000
003800     SELECT DATE-FILE                                             00320000
003900         ASSIGN TO INP01.                                         00330000
003200                                                                          
004100     SELECT DATE-ADVANCE-FILE                                     00320000
004200         ASSIGN TO INP02.                                         00330000
004000                                                                  00340000
216764     SELECT ORACLE-LOGON-FILE                                             
216764         ASSIGN TO ORALOGON.                                              
004300                                                                  00340000
004400     SELECT OUT-DATE-FILE1                                        00320000
004500         ASSIGN TO OUT01.                                         00330000
004600                                                                  00340000
004700     SELECT OUT-DATE-FILE2                                        00320000
004800         ASSIGN TO OUT02.                                         00330000
004900                                                                  00340000
005000     SELECT OUT-DATE-FILE3                                        00320000
005100         ASSIGN TO OUT03.                                         00330000
005200                                                                  00340000
005300     SELECT OUT-DATE-FILE4                                        00320000
005400         ASSIGN TO OUT04.                                         00330000
005500                                                                  00340000
005600     SELECT OUT-DATE-FILE5                                        00320000
005700         ASSIGN TO OUT05.                                         00330000
005800                                                                  00340000
005900     SELECT OUT-DATE-FILE6                                        00320000
006000         ASSIGN TO OUT06.                                         00330000
006100                                                                  00340000
006200     SELECT OUT-DATE-FILE7                                        00320000
006300         ASSIGN TO OUT07.                                         00330000
006400                                                                  00340000
006500     SELECT OUT-EXCEED-FILE                                       00320000
006600         ASSIGN TO OUT08.                                         00330000
006700                                                                  00340000
006800******************************************************************00240000
006900 DATA DIVISION.                                                   00350000
007000******************************************************************00240000
007100 FILE SECTION.                                                    00360000
007200                                                                  00370000
007300 FD  DATE-FILE                                                    00380000
007400     RECORDING MODE F                                             00390000
007500     LABEL RECORDS ARE STANDARD                                   00410000
007600     BLOCK CONTAINS 0 RECORDS.                                    00400000
007700 01  DATE-RECORD                      PIC  X(80).                 00430000
007800                                                                  00440000
007900 FD  DATE-ADVANCE-FILE                                            00380000
008000     RECORDING MODE F                                             00390000
008100     LABEL RECORDS ARE STANDARD                                   00410000
008200     BLOCK CONTAINS 0 RECORDS.                                    00400000
008300 01  DATE-ADVANCE-RECORD              PIC  X(80).                 00430000
008400                                                                  00440000
216764 FD  ORACLE-LOGON-FILE                                                    
216764     RECORDING MODE IS F                                                  
216764     LABEL RECORDS ARE STANDARD                                           
216764     BLOCK CONTAINS 0 RECORDS                                             
216764     RECORD CONTAINS 80 CHARACTERS                                        
216764     DATA RECORDS IS OL-ORACLE-LOGON-RECORD.                              
216764 01  OL-ORACLE-LOGON-RECORD          PIC X(80).                           
216764                                                                          
008500 FD  OUT-DATE-FILE1                                               00380000
008600     RECORDING MODE F                                             00390000
008700     LABEL RECORDS ARE STANDARD                                   00410000
008800     BLOCK CONTAINS 0 RECORDS.                                    00400000
008900 01  OUT-DATE-RECORD1                 PIC  X(80).                 00430000
009000                                                                  00440000
009100 FD  OUT-DATE-FILE2                                               00380000
009200     RECORDING MODE F                                             00390000
009300     LABEL RECORDS ARE STANDARD                                   00410000
009400     BLOCK CONTAINS 0 RECORDS.                                    00400000
009500 01  OUT-DATE-RECORD2                 PIC  X(80).                 00430000
009600                                                                  00440000
009700 FD  OUT-DATE-FILE3                                               00380000
009800     RECORDING MODE F                                             00390000
009900     LABEL RECORDS ARE STANDARD                                   00410000
010000     BLOCK CONTAINS 0 RECORDS.                                    00400000
010100 01  OUT-DATE-RECORD3                 PIC  X(80).                 00430000
010200                                                                  00440000
010300 FD  OUT-DATE-FILE4                                               00380000
010400     RECORDING MODE F                                             00390000
010500     LABEL RECORDS ARE STANDARD                                   00410000
010600     BLOCK CONTAINS 0 RECORDS.                                    00400000
010700 01  OUT-DATE-RECORD4                 PIC  X(80).                 00430000
010800                                                                  00440000
010900 FD  OUT-DATE-FILE5                                               00380000
011000     RECORDING MODE F                                             00390000
011100     LABEL RECORDS ARE STANDARD                                   00410000
011200     BLOCK CONTAINS 0 RECORDS.                                    00400000
011300 01  OUT-DATE-RECORD5                 PIC  X(80).                 00430000
011400                                                                  00440000
011500 FD  OUT-DATE-FILE6                                               00380000
011600     RECORDING MODE F                                             00390000
011700     LABEL RECORDS ARE STANDARD                                   00410000
011800     BLOCK CONTAINS 0 RECORDS.                                    00400000
011900 01  OUT-DATE-RECORD6                 PIC  X(80).                 00430000
012000                                                                  00440000
012100 FD  OUT-DATE-FILE7                                               00380000
012200     RECORDING MODE F                                             00390000
012300     LABEL RECORDS ARE STANDARD                                   00410000
012400     BLOCK CONTAINS 0 RECORDS.                                    00400000
012500 01  OUT-DATE-RECORD7                 PIC  X(80).                 00430000
012600                                                                  00440000
012700 FD  OUT-EXCEED-FILE                                              00380000
012800     RECORDING MODE F                                             00390000
012900     LABEL RECORDS ARE STANDARD                                   00410000
013000     BLOCK CONTAINS 0 RECORDS.                                    00400000
013100 01  OUT-EXCEED-RECORD                PIC  X(80).                 00430000
013200                                                                  00440000
013300****************************************************************  00480000
013400 WORKING-STORAGE SECTION.                                         00450000
013500****************************************************************  00950000
013600**PROGRAM VARIABLES.                                              00940000
013700****************************************************************  00950000
013800 01  PV-PROGRAM-VARIABLES.                                        00800000
013900     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACE.     01020000
014000     05  PV-OPERATION-MSG-1           PIC  X(40) VALUE SPACE.     01030000
014100     05  PV-OPERATION-MSG-2           PIC  X(40) VALUE SPACE.     01040000
014200     05  PV-OPERATION-MSG             PIC  X(30) VALUE SPACE.     01050000
014500     05  PV-MARK1-DATE                PIC  X(10) VALUE SPACE.     00490000
014600     05  PV-NBR                       PIC  9(04) VALUE ZERO.      00490000
014600     05  PV-COUNT                     PIC  9(01) VALUE ZERO.      00490000
216764     05  PV-ORACLE-USERID-LEN         PIC  S9(4) VALUE ZEROS              
216764                                                   COMP SYNC.             
216764     05  PV-ORACLE-PASSWORD-LEN       PIC  S9(4) VALUE ZEROS              
216764                                                  COMP SYNC.              
014700                                                                  00490000
014800 01  PV-SELECT-VARIABLES.                                         00490000
014900     05  PV-CLR-MKDN-CDE              PIC  X(01) VALUE SPACE.     00490000
015200                                                                  00490000
015300****************************************************************  00950000
015400**PROGRAM SWITCHES.                                               00940000
015500****************************************************************  00950000
015600 01  PS-PROGRAM-SWITCHES.                                         00490000
015700     05  PS-END-OF-DATE-FILE-SW       PIC  X(01) VALUE 'N'.       00500000
015800         88 PS-END-OF-DATE-FILE-N                VALUE 'N'.       00510000
015900         88 PS-END-OF-DATE-FILE-Y                VALUE 'Y'.       00520000
016000     05  PS-END-OF-FILE-SW            PIC  X(01) VALUE 'N'.       00500000
016100         88 PS-END-OF-FILE-N                     VALUE 'N'.       00510000
016200         88 PS-END-OF-FILE-Y                     VALUE 'Y'.       00520000
016300     05  PS-END-OF-CSR-SW             PIC  X(01) VALUE 'N'.       00500000
016400         88 PS-END-OF-CSR-N                      VALUE 'N'.       00510000
016500         88 PS-END-OF-CSR-Y                      VALUE 'Y'.       00520000
216764     05  PS-END-OF-LOGON-FILE-SW      PIC  X(01) VALUE 'N'.               
216764         88 PS-END-OF-LOGON-FILE                 VALUE 'Y'.               
216764     05  PS-ORA-SRC-CTL-DONE-SW       PIC  X(01) VALUE 'N'.               
216764         88  PS-ORA-SRC-EMPTY                    VALUE 'Y'.               
016600                                                                  00610000
016700****************************************************************  00950000
016800**PROGRAM CONSTANTS.                                              00940000
016900****************************************************************  00950000
017000 01  PC-PROGRAM-CONSTANTS.                                        00670000
017100     05  PC-CURRENT-PROGRAM-NAME      PIC  X(08) VALUE 'PEKUT002'.00680000
017200     05  PC-MAX                       PIC  9(02) VALUE 25.        00680000
216764     05  PC-AUTO-LOGON                PIC  X(1)  VALUE '/'.               
216764     05  PC-ORACLE-PROD-ID-LGTH       PIC  9(02) VALUE 1.                 
017300                                                                  00610000
017400****************************************************************  00950000
017500**TABLE TO HOLD DATE COMBINATIONS THAT WILL BE WRITTEN TO FILE.   00940000
017600**TO PREVENT DUPLICATE DATE COMBINATION BEING WRITTEN TO FILE.    00940000
017700****************************************************************  00950000
017800 01  TB-HOLD-DATE-TBL.                                            00620000
017900     05  TB-HOLD-DATE                 OCCURS 25 TIMES             00620000
018000                                      INDEXED BY TB-IDX.          00620000
018200         10  TB-MARK1-DATE            PIC  X(10) VALUE SPACE.     00630000
018300****************************************************************  00930000
018400**ABEND INFORMATION                                               00940000
018500****************************************************************  00950000
018600 01  AC-ABEND-CODE                    PIC S9(04) VALUE ZERO       00970000
018700                                                 COMP SYNC.       00980000
018800     88  AC-TABLE-ERROR                          VALUE +4004.     00990000
018900     88  AC-DB2-ERROR                            VALUE +4013.     01000000
019000     88  AC-CONTROL-CARD-ERROR                   VALUE +4003.     01000000
019100     88  AC-CALENDAR-ROUTINE-ERROR               VALUE +4019.     01000000
020800     88  ABEND-4013-DB-ERROR                     VALUE +4013.             
019200                                                                  00930000
019300****************************************************************  00930000
019400**CONTROL CARD LAYOUTS                                            00940000
019500****************************************************************  00950000
019600 01  CC-DATE-CARD.                                                00970000
019700     05  CC-CONTROL-DATE              PIC  X(10) VALUE SPACE.     00980000
019800     05  FILLER                       PIC  X(70) VALUE SPACE.     00990000
019900                                                                  01000000
020000 01  CC-DATE-ADVANCE-CARD.                                        00970000
020100     05  CC-NBR-OF-DAYS               PIC  9(02) VALUE ZERO.      00980000
020200     05  FILLER                       PIC  X(78) VALUE SPACE.     00990000
020300                                                                  01000000
020400****************************************************************  00930000
020500* OUTPUT LAYOUT                                                   00940000
020600****************************************************************  00950000
020700 01  OUTPUT-RECORD.                                               00970000
021000     05  OUTPUT-MARK1-DATE            PIC  X(10) VALUE SPACE.     00990000
021100                                                                  01000000
021200***************************************************************** 01060000
021300*  ABEND ROUTINE INFORMATION                                      01090000
021400***************************************************************** 01080000
021500     COPY DPWS900.                                                01100000
021600***************************************************************** 01080000
021700*  ABEND ROUTINE INFORMATION                                      01110000
021800***************************************************************** 01080000
021900     COPY DPWS004.                                                01120000
022000******************************************************************01110000
022100*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)             01120000
022200******************************************************************01110000
022300     COPY DPWS500.                                                01120000
022400****************************************************************  01150000
022500**ORACLE DECLARE SECTION                                          01160000
022600****************************************************************  01170000
022700     EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     01180000
022800 01  USERNAME                         PIC  X(10) VARYING.         01190000
022900 01  PASSWD                           PIC  X(10) VARYING.         01200000
023000 01  PV-ORACLE-ID                     PIC  X(01) VALUE '/'.       01210000
023100 01  PV-ADVANCE-TO-DATE               PIC  X(10) VALUE SPACE.     01050000
023200 01  PV-1STDAY-ADVANCE-TO-WK          PIC  X(10) VALUE SPACE.     01050000
023200 01  PV-LSTDAY-ADVANCE-TO-WK          PIC  X(10) VALUE SPACE.     01050000
023300 01  PV-CLR-EVNT-ID                   PIC  9(10) VALUE ZERO.      00490000
015000 01  PV-CLR-FRST-EFF-DTE              PIC  X(10) VALUE SPACE.     00490000
015100 01  PV-CLR-LAST-EFF-DTE              PIC  X(10) VALUE SPACE.     00490000
072803*01  PV-MKDN-OPTMZN-GP-CDE            PIC  X(01) VALUE SPACE.     00490000
216764******************************************************************        
216764*      ORACLE CONNECTION VARIABLES                                        
216764******************************************************************        
216764 01  CC-ORACLE-CONNECTION.                                                
216764     05  CC-ORACLE-USERID             PIC X(40).                          
216764         88 CC-AUTO-LOGON                            VALUE '/'.           
216764     05  CC-ORACLE-PASSWORD           PIC X(40).                          
023400****************************************************************  01220000
023500**ORACLE TABLE INCLUSIONS                                         01230000
023600****************************************************************  01240000
023700     EXEC SQL END DECLARE SECTION END-EXEC.                       01450000
023800     EXEC SQL INCLUDE SQLCACOB END-EXEC.                          01460000
023900                                                                  01470000
024000****************************************************************  01240000
024100 PROCEDURE DIVISION.                                              01480000
024200******************************************************************01490000
024300 0000-MAINLINE.                                                   01500000
024400                                                                  01510000
024500     PERFORM 1000-HOUSEKEEPING.                                   01520000
024600*                                                                 01510000
024700*    PERFORM 1600-ORACLE-SETUP.                                   01660000
024600                                                                  01510000
025000     PERFORM 2000-DECLARE-CURSOR.                                 01530000
025100                                                                  01510000
025200     PERFORM 2200-OPEN-CURSOR.                                    01530000
025300                                                                  01510000
025400     PERFORM 3000-FETCH-CURSOR                                    01530000
025500             UNTIL PS-END-OF-CSR-Y.                               01540000
025600                                                                  01510000
025700     PERFORM 3200-CLOSE-CURSOR.                                   01530000
025800                                                                  01510000
025900     PERFORM 6000-WRITE-DATE-TO-FILE.                             01530000
026000                                                                  01510000
026100     PERFORM 9000-END-OF-JOB.                                     01550000
026200                                                                  01510000
026300     STOP RUN.                                                    01560000
026400                                                                  01570000
026500****************************************************************  01590000
026600 1000-HOUSEKEEPING.                                               01620000
026700*     OPEN FILES, READ IN AND VALIDATE CONTROL DATE.              01600000
026800****************************************************************  01610000
026900                                                                  01650000
216764     OPEN INPUT ORACLE-LOGON-FILE.                                01680000
216764                                                                          
216764     DISPLAY 'ORACLE FILE READ'.                                          
216764     PERFORM 8000-READ-ORACLE-LOGON.                                      
216764                                                                          
216764     DISPLAY 'ORACLE FILE CLOSE'.                                         
216764     CLOSE ORACLE-LOGON-FILE.                                             
216764                                                                          
216764     IF ((PS-END-OF-LOGON-FILE)                                           
216764              OR (CC-ORACLE-CONNECTION = SPACES))                         
216764           DISPLAY '** ABEND **'                                          
216764           DISPLAY PC-CURRENT-PROGRAM-NAME                                
216764           ' - ORACLE LOGON CONTROL CARD NOT PROVIDED'                    
216764           SET PS-ORA-SRC-EMPTY TO TRUE                                   
216764           CALL 'ILBOABN0' USING AC-ABEND-CODE                            
216764     END-IF.                                                              
216764                                                                          
216764     IF CC-AUTO-LOGON                                                     
216764             DISPLAY PC-CURRENT-PROGRAM-NAME                              
216764             'AUTO LOGON TO ORACLE'                                       
216764             EXEC SQL                                                     
216764               CONNECT  :PC-AUTO-LOGON                                    
216764             END-EXEC                                                     
216764       ELSE                                                               
216764         INITIALIZE PV-ORACLE-USERID-LEN                                  
216764                    PV-ORACLE-PASSWORD-LEN                                
216764           INSPECT    CC-ORACLE-USERID                                    
216764             TALLYING   PV-ORACLE-USERID-LEN                              
216764             FOR CHARACTERS BEFORE INITIAL SPACE                          
216764           INSPECT    CC-ORACLE-PASSWORD                                  
216764             TALLYING   PV-ORACLE-PASSWORD-LEN                            
216764             FOR CHARACTERS BEFORE INITIAL SPACE                          
216764         MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO                
216764                    USERNAME-ARR                                          
216764         MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                        
216764         MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO            
216764                      PASSWD-ARR                                          
216764         MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                        
216764           DISPLAY PC-CURRENT-PROGRAM-NAME                                
216764           ' - LOGON TO ORACLE AS USER ' USERNAME-ARR                     
216764            EXEC SQL                                                      
216764                 CONNECT :USERNAME IDENTIFIED BY :PASSWD                  
216764            END-EXEC                                                      
216764         INITIALIZE CC-ORACLE-PASSWORD                                    
216764                    PASSWD                                                
216764     END-IF.                                                              
216764                                                                          
216764         IF SQLCODE NOT = 0                                               
216764               DISPLAY '** CONNECTING TO ORACLE BY USERID **'             
216764               DISPLAY 'TRIED TO CONNECT TO ORACLE UNDER: '               
216764                                  PASSWD                                  
216764            SET AC-DB2-ERROR  TO TRUE                                     
216764               PERFORM 9000-ABEND                                         
216764         END-IF.                                                          
264300     OPEN INPUT DATE-FILE                                                 
027100     OPEN INPUT DATE-ADVANCE-FILE                                 01680000
027200         OUTPUT OUT-DATE-FILE1                                    01680000
027300                OUT-DATE-FILE2                                    01680000
027400                OUT-DATE-FILE3                                    01680000
027500                OUT-DATE-FILE4                                    01680000
027600                OUT-DATE-FILE5                                    01680000
027700                OUT-DATE-FILE6                                    01680000
027800                OUT-DATE-FILE7                                    01680000
027900                OUT-EXCEED-FILE.                                  01680000
028000                                                                  01680000
028100     SET TB-IDX                       TO 1.                       01680000
028100     MOVE 1                           TO PV-COUNT.                01680000
028200                                                                  01770000
028300     PERFORM 1200-READ-INPUT-FILES.                               26100000
028400                                                                  01770000
028500     DISPLAY PC-CURRENT-PROGRAM-NAME                              26110000
028600             ' - CONTROL DATE = (' CC-CONTROL-DATE ')'            26110000
028700             ' - ADVANCE DAYS = (' CC-NBR-OF-DAYS ')'.            26110000
028800                                                                  26110000
028900     PERFORM 1400-GET-DATE.                                       01530000
029000                                                                  01770000
029100     MOVE DPG55-DB2-ISO-DATE-FMT      TO PV-ADVANCE-TO-DATE.      07270000
029200     MOVE DPG55-1ST-WKDY-DB2ISO-FMT   TO PV-1STDAY-ADVANCE-TO-WK. 07270000
029200     MOVE DPG55-LAST-WKDY-DB2ISO-FMT  TO PV-LSTDAY-ADVANCE-TO-WK. 07270000
029300                                                                  07310000
                                                                                
029400****************************************************************  26070000
029500 1200-READ-INPUT-FILES.                                           26100000
029600*     READ AND PROCESS INPUT FILES.                               26080000
029700****************************************************************  26090000
029800                                                                  26110000
029900     READ DATE-FILE INTO CC-DATE-CARD                             26120000
030000        AT END                                                    26130000
030100           SET PS-END-OF-DATE-FILE-Y  TO TRUE                     26140000
030200     END-READ.                                                    26150000
030300                                                                  26160000
030400     IF PS-END-OF-DATE-FILE-Y                                     26170000
030500        MOVE '1200-READ-INPUT-FILES' TO PV-PARAGRAPH-NAME         26180000
030600        MOVE 'NO DATE IN FILE'       TO PV-OPERATION-MSG-1        26180000
030700        SET AC-CONTROL-CARD-ERROR    TO TRUE                      26180000
030800        PERFORM 9000-ABEND                                        26180000
030900     END-IF.                                                      26190000
031000                                                                  26200000
031100     READ DATE-ADVANCE-FILE INTO CC-DATE-ADVANCE-CARD             26120000
031200        AT END                                                    26130000
031300           SET PS-END-OF-FILE-Y      TO TRUE                      26140000
031400     END-READ.                                                    26150000
031500                                                                  26160000
031600     IF PS-END-OF-FILE-Y                                          26170000
031700        MOVE '1200-READ-INPUT-FILES' TO PV-PARAGRAPH-NAME         26180000
031800        MOVE 'NO DATE COUNT IN FILE' TO PV-OPERATION-MSG-1        26180000
031900        SET AC-CONTROL-CARD-ERROR    TO TRUE                      26180000
032000        PERFORM 9000-ABEND                                        26180000
032100     END-IF.                                                      26190000
032200                                                                  26200000
032300******************************************************************07020000
032400 1400-GET-DATE.                                                   07030000
032500*     VALIDATE THE INPUT DATE AND CALCULATE THE FUTURE DATE USING 07030000
032600*     THE KOHL'S DATE ROUTINE.                                    07030000
032700******************************************************************07040000
032800                                                                  07050000
032900     SET  DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                    07060000
033000     SET  DPG51-INCREMENT-DATE        TO TRUE.                    07070000
033100     SET  DPG52-LK-DTE-ISO-FMT        TO TRUE                     07080000
033200     MOVE CC-CONTROL-DATE             TO DPG52-LK-DATE-INPUT.     07090000
033300     MOVE CC-NBR-OF-DAYS              TO DPG51-INCR-DECR-DAYS-9.  07100000
033400                                                                  07110000
033500     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    07120000
033600                                             DPG54 DPG55 DPG56.   07130000
033700                                                                  07140000
033800     EVALUATE TRUE                                                07150000
033900        WHEN DPG54-SEVERE-ERROR                                   07160000
034000           MOVE '1400-GET-DATE'       TO PV-PARAGRAPH-NAME        07170000
034100           MOVE 'DATE ERROR'          TO PV-OPERATION-MSG-1       07190000
034200           SET AC-CALENDAR-ROUTINE-ERROR                          07210000
034300                                      TO TRUE                     07220000
034400           MOVE DPG54-ERROR-MESSAGE   TO PV-OPERATION-MSG-2       07230000
034500           PERFORM 9000-ABEND                                     07240000
034600     END-EVALUATE.                                                07250000
034700                                                                  07260000
034800******************************************************************        
034900*1600-ORACLE-SETUP.                                                       
035000* LOGON TO ORACLE                                                         
035100******************************************************************        
035200*                                                                         
035400*    MOVE 'READONLY' TO USERNAME-ARR.                                     
035500*    MOVE 8          TO USERNAME-LEN.                                     
035600*    MOVE 'READONLY' TO PASSWD-ARR.                                       
035700*    MOVE 8          TO PASSWD-LEN.                                       
035800*    EXEC SQL                                                             
035900*     CONNECT :USERNAME IDENTIFIED BY :PASSWD                             
036000*    END-EXEC.                                                            
036100*                                                                         
036800*    IF  SQLCODE = 0                                                      
036900*        DISPLAY 'CONNECTED TO ORACLE AS USER: ' PV-ORACLE-ID             
037100*    ELSE                                                                 
037400*        MOVE '1600-ORACLE-SETUP' TO PV-PARAGRAPH-NAME                    
037600*        MOVE SQLCODE             TO PV-NBR                               
037600*        STRING 'ORACLE LOGON FAILED - SQLCODE= '                         
037700*                PV-NBR DELIMITED BY SIZE INTO                            
037800*                PV-OPERATION-MSG                                         
037900*        END-STRING                                                       
038100*        PERFORM 9000-ABEND                                               
038300*    END-IF.                                                              
038400                                                                          
038500****************************************************************  01790000
038600 2000-DECLARE-CURSOR.                                             01820000
038700*     DECLARE CURSOR. THE CURSOR EXCLUDES MARK1 SINCE NO QUERY    01800000
038800*     WILL BE RUN FOR IT. IT INCLUDES MARK2/FINAL ONLY IF ITS     01800000
038900*     CLR_LAST_EF_DTE FALLS BETWEEN THE FIRST DAY OF THE          01800000
039000*     CALCULATED WEEK (PV-1STDAY-ADVANCE-TO-WK) AND THE LAST DAY  01800000
039100*     OF THE CALCULATED DATE (PV-LSTDAY-ADVANCE-TO-DATE).         01800000
039300****************************************************************  01810000
039400                                                                  01850000
039500     EXEC SQL                                                     01860000
039600        DECLARE MARKDOWN CURSOR FOR                               01870000
039700         SELECT CLR_EVNT_ID                                       01880000
039800               ,CLR_MKDN_CDE                                      01890000
072308*              ,MKDN_OPTMZN_GP_CDE                                01890000
040100           FROM PET_CLR_MKDN_EVNT                                 01910000
040200          WHERE ACTV_IND         = 'Y'                            01910000
040300            AND CLR_MKDN_CDE    IN ('2', 'F')                     01920000
040800            AND CLR_LAST_EFF_DTE BETWEEN                          01920000
040400                TO_DATE(:PV-1STDAY-ADVANCE-TO-WK,'YYYY-MM-DD')    01920000
040500            AND TO_DATE(:PV-LSTDAY-ADVANCE-TO-WK,'YYYY-MM-DD')    01920000
041000     END-EXEC.                                                    02000000
041100                                                                  02010000
041200     EVALUATE TRUE                                                25920000
041300        WHEN SQLCODE NOT EQUAL ZERO                               25930000
041400           MOVE '2000-DECLARE-CURSOR' TO PV-PARAGRAPH-NAME        25980000
041500           MOVE 'CURSOR DECLARE ERROR' TO PV-OPERATION-MSG        25990000
041600           PERFORM 9999-SQL-ABEND                                 26020000
041700     END-EVALUATE.                                                26030000
041800                                                                  25920000
041900****************************************************************  01790000
042000 2200-OPEN-CURSOR.                                                01820000
042100*     OPEN CURSOR.                                                01800000
042200****************************************************************  01810000
042300                                                                  01850000
042400     EXEC SQL                                                     02020000
042500        OPEN MARKDOWN                                                   00
042600     END-EXEC.                                                    02020000
042700                                                                  25920000
042800     EVALUATE TRUE                                                25920000
042900        WHEN SQLCODE NOT EQUAL ZERO                               25930000
043000           MOVE '2200-OPEN-CURSOR'    TO PV-PARAGRAPH-NAME        25980000
043100           MOVE 'CURSOR OPEN ERROR'   TO PV-OPERATION-MSG         25990000
043200           PERFORM 9999-SQL-ABEND                                 26020000
043300     END-EVALUATE.                                                26030000
043400                                                                  25920000
043500****************************************************************  01790000
043600 3000-FETCH-CURSOR.                                               01820000
043700**    FETCH MARKDOWN CURSOR.                                      01800000
043800****************************************************************  01810000
043900                                                                  01850000
045700     MOVE SPACES                      TO PV-CLR-LAST-EFF-DTE      26030000
045800                                         PV-CLR-FRST-EFF-DTE.     26030000
045900                                                                  25920000
044000     EXEC SQL                                                     02020000
044100        FETCH MARKDOWN                                            02030000
044200         INTO :PV-CLR-EVNT-ID                                     02030000
044300             ,:PV-CLR-MKDN-CDE                                    01890000
072308*            ,:PV-MKDN-OPTMZN-GP-CDE                              01890000
044600     END-EXEC.                                                    02020000
044700                                                                  25920000
044800     EVALUATE TRUE                                                25920000
044900        WHEN SQLCODE EQUAL ZERO                                   25930000
046000           PERFORM 4000-GET-EVENT-MARK1-DATE                      26030000
046100           PERFORM 5000-EVALUATE-DATE                             26030000
044900        WHEN SQLCODE = +1403                                      25930000
045000           SET PS-END-OF-CSR-Y        TO TRUE                     25930000
045100        WHEN OTHER                                                25930000
045200           MOVE '3000-FETCH-CURSOR'   TO PV-PARAGRAPH-NAME        25980000
045300           MOVE 'CURSOR FETCH ERROR'  TO PV-OPERATION-MSG         25990000
045400           PERFORM 9999-SQL-ABEND                                 26020000
045500     END-EVALUATE.                                                26030000
045600                                                                  25920000
043500****************************************************************  01790000
043600 3200-CLOSE-CURSOR.                                               01820000
043700**    CLOSE MARKDOWN CURSOR.                                      01800000
043800****************************************************************  01810000
043900                                                                  01850000
044000     EXEC SQL                                                     02020000
044100        CLOSE MARKDOWN                                            02030000
044600     END-EXEC.                                                    02020000
044700                                                                  25920000
044800     EVALUATE TRUE                                                25920000
044900        WHEN SQLCODE EQUAL ZERO                                   25930000
045000           CONTINUE                                               25930000
045100        WHEN OTHER                                                25930000
045200           MOVE '3200-CLOSE-CURSOR'   TO PV-PARAGRAPH-NAME        25980000
045300           MOVE 'CURSOR FETCH ERROR'  TO PV-OPERATION-MSG         25990000
045400           PERFORM 9999-SQL-ABEND                                 26020000
045500     END-EVALUATE.                                                26030000
045600                                                                  25920000
046300****************************************************************  02160000
046400 4000-GET-EVENT-MARK1-DATE.                                       02190000
046500*     RETREIVE THE MARK1 DATE(S) FOR THE EVENT RETURNED.          02170000
046600*     THE ACTV_IND HAS TO BE 'Y' FOR MARK1.                       02170000
046800****************************************************************  02180000
046900                                                                  02200000
047000     EXEC SQL                                                     02210000
047100        SELECT CLR_FRST_EFF_DTE                                   02210000
047200              ,CLR_LAST_EFF_DTE                                   01910000
047400          INTO PV-CLR-FRST-EFF-DTE                                01900000
047500              ,PV-CLR-LAST-EFF-DTE                                01910000
047300          FROM PET_CLR_MKDN_EVNT                                  01910000
047600         WHERE CLR_MKDN_CDE       = '1'                           01910000
047700           AND CLR_EVNT_ID        = :PV-CLR-EVNT-ID               01880000
072308*          AND MKDN_OPTMZN_GP_CDE = :PV-MKDN-OPTMZN-GP-CDE        01890000
039800           AND ACTV_IND           = 'Y'                           01890000
047800     END-EXEC.                                                    02000000
047900                                                                  02220000
048000     EVALUATE TRUE                                                25920000
048100        WHEN SQLCODE EQUAL ZERO                                   25930000
046700*     HAVE CONFIRMED THAT MARK1 WOULD ALWAYS EXIST AND EXIST ONLY 02170000
046700*     ONCE PER EVENT, JUST IN CASE                                02170000
048200        WHEN SQLCODE EQUAL +1403                                  25930000
048200        WHEN SQLCODE EQUAL 2112                                   25930000
048300           CONTINUE                                               25930000
048400        WHEN OTHER                                                25930000
048500           MOVE '4000-GET-EVENT-MARK1-DATE'                       25980000
048600                                      TO PV-PARAGRAPH-NAME        25980000
048700           MOVE 'CURSOR FETCH ERROR'  TO PV-OPERATION-MSG         25990000
048800           PERFORM 9999-SQL-ABEND                                 26020000
048900     END-EVALUATE.                                                26030000
049000                                                                  02220000
049100****************************************************************  02160000
049200 5000-EVALUATE-DATE.                                              02190000
049300*     EVALUATE THE COMBINATION OF THE FRST-EFF-DTE AND THE        02170000
049400*     LAST-EFF-DTE.                                               02170000
049500****************************************************************  02180000
049600                                                                  02200000
049700*** IF MARK1 IS A ONE DAY EVENT                                   02210000
049900     IF PV-CLR-FRST-EFF-DTE        EQUAL PV-CLR-LAST-EFF-DTE      02210000
050200        MOVE PV-CLR-FRST-EFF-DTE      TO PV-MARK1-DATE            02210000
050300        PERFORM 5200-SEARCH-EXIST-DATE                            02210000
050400     END-IF.                                                      02210000
050500                                                                  02220000
052600*** IF MARK1 IS A MULTIPLE DAY EVENT                              02210000
052700     IF PV-CLR-FRST-EFF-DTE            < PV-CLR-LAST-EFF-DTE      02210000
053700        MOVE PV-CLR-FRST-EFF-DTE      TO CC-CONTROL-DATE          02210000
053700                                         PV-MARK1-DATE            02210000
053200        MOVE 1                        TO CC-NBR-OF-DAYS           02210000
053800        PERFORM 5600-GET-MARK1-DATE                               02210000
053900           UNTIL CC-CONTROL-DATE       = PV-CLR-LAST-EFF-DTE      02210000
054000     END-IF.                                                      02210000
054100                                                                  02220000
054200****************************************************************  02160000
054300 5200-SEARCH-EXIST-DATE.                                          02190000
054400*     SEARCH THE INTERNAL STORAGE. IF DATE EXIST, CONTINUE.       02170000
054500*     OTHERWISE, WRITE TO FILE AND ADD TO INTERNAL                02170000
054600*     STORAGE.                                                    02170000
054700****************************************************************  02180000
054800                                                                  02200000
054800     SET TB-IDX                      TO 1.                        02200000
054800                                                                  02200000
054900     SEARCH TB-HOLD-DATE                                          02210000
055000        AT END                                                    02210000
055100*** IF THE DATE COMBINATION NOT ALREADY EXIST                     02210000
055100           SET TB-IDX                TO PV-COUNT                  02210000
055300           MOVE PV-MARK1-DATE        TO TB-MARK1-DATE (TB-IDX)    01910000
055400           ADD 1                     TO PV-COUNT                  01910000
055500        WHEN PV-MARK1-DATE            = TB-MARK1-DATE (TB-IDX)    02210000
055700*** IF THE DATE COMBINATION ALREADY EXIST                         02210000
055800             CONTINUE                                             02210000
055900     END-SEARCH.                                                  01910000
056000                                                                  01910000
057100******************************************************************07020000
057200 5600-GET-MARK1-DATE.                                             07030000
057300*     GET THE DATES FOR THE EVENT USING THE KOHL'S DATE ROUTINE.  07030000
057400******************************************************************07040000
057500                                                                  07050000
050300     PERFORM 5200-SEARCH-EXIST-DATE.                              02210000
057600     PERFORM 1400-GET-DATE.                                       07060000
057500                                                                  07050000
057700     MOVE DPG55-DB2-ISO-DATE-FMT      TO CC-CONTROL-DATE          07270000
057800                                         PV-MARK1-DATE.           07270000
057900     PERFORM 5200-SEARCH-EXIST-DATE.                              07270000
058000                                                                  07310000
058100******************************************************************07020000
058200 6000-WRITE-DATE-TO-FILE.                                         07030000
058300*     WRITE DATES TO FILE.                                        07030000
058400******************************************************************07040000
058500                                                                  07050000
058600     IF TB-HOLD-DATE (1)           > SPACE                        07060000
058700        MOVE TB-MARK1-DATE (1)    TO OUTPUT-MARK1-DATE            07060000
058800        WRITE OUT-DATE-RECORD1  FROM OUTPUT-RECORD                07060000
058900        MOVE SPACES               TO OUTPUT-MARK1-DATE            07060000
058600     END-IF.                                                      07060000
059000                                                                  07060000
058600     IF TB-HOLD-DATE (2)           > SPACE                        07060000
058700        MOVE TB-MARK1-DATE (2)    TO OUTPUT-MARK1-DATE            07060000
058800        WRITE OUT-DATE-RECORD2  FROM OUTPUT-RECORD                07060000
058900        MOVE SPACES               TO OUTPUT-MARK1-DATE            07060000
058600     END-IF.                                                      07060000
059000                                                                  07060000
058600     IF TB-HOLD-DATE (3)           > SPACE                        07060000
058700        MOVE TB-MARK1-DATE (3)    TO OUTPUT-MARK1-DATE            07060000
058800        WRITE OUT-DATE-RECORD3  FROM OUTPUT-RECORD                07060000
058900        MOVE SPACES               TO OUTPUT-MARK1-DATE            07060000
058600     END-IF.                                                      07060000
059000                                                                  07060000
058600     IF TB-HOLD-DATE (4)           > SPACE                        07060000
058700        MOVE TB-MARK1-DATE (4)    TO OUTPUT-MARK1-DATE            07060000
058800        WRITE OUT-DATE-RECORD4  FROM OUTPUT-RECORD                07060000
058900        MOVE SPACES               TO OUTPUT-MARK1-DATE            07060000
058600     END-IF.                                                      07060000
059000                                                                  07060000
058600     IF TB-HOLD-DATE (5)           > SPACE                        07060000
058700        MOVE TB-MARK1-DATE (5)    TO OUTPUT-MARK1-DATE            07060000
058800        WRITE OUT-DATE-RECORD5  FROM OUTPUT-RECORD                07060000
058900        MOVE SPACES               TO OUTPUT-MARK1-DATE            07060000
058600     END-IF.                                                      07060000
059000                                                                  07060000
058600     IF TB-HOLD-DATE (6)           > SPACE                        07060000
058700        MOVE TB-MARK1-DATE (6)    TO OUTPUT-MARK1-DATE            07060000
058800        WRITE OUT-DATE-RECORD6  FROM OUTPUT-RECORD                07060000
058900        MOVE SPACES               TO OUTPUT-MARK1-DATE            07060000
058600     END-IF.                                                      07060000
059000                                                                  07060000
058600     IF TB-HOLD-DATE (7)           > SPACE                        07060000
058700        MOVE TB-MARK1-DATE (7)    TO OUTPUT-MARK1-DATE            07060000
058800        WRITE OUT-DATE-RECORD7  FROM OUTPUT-RECORD                07060000
058900        MOVE SPACES               TO OUTPUT-MARK1-DATE            07060000
058600     END-IF.                                                      07060000
059000                                                                  07060000
062100     PERFORM                                                      07060000
062200        VARYING TB-IDX                                            07270000
062300        FROM 8 BY 1                                               07270000
062400        UNTIL TB-IDX > PC-MAX OR                                  07270000
062400              TB-HOLD-DATE(TB-IDX) = SPACE                        07270000
062600           MOVE TB-MARK1-DATE (TB-IDX)  TO OUTPUT-MARK1-DATE      07060000
062700           WRITE OUT-EXCEED-RECORD    FROM OUTPUT-RECORD          07060000
062800           MOVE SPACES                  TO OUTPUT-MARK1-DATE      07060000
062900     END-PERFORM.                                                 07060000
063000                                                                  07310000
216764****************************************************************          
216764* LOGON TO ORACLE                                                         
216764****************************************************************          
216764 8000-READ-ORACLE-LOGON.                                                  
216764                                                                          
216764     READ ORACLE-LOGON-FILE                                               
216764         INTO CC-ORACLE-CONNECTION                                        
216764         AT END                                                           
216764             SET PS-END-OF-LOGON-FILE TO TRUE                             
216764     END-READ.                                                            
216764                                                                          
063300****************************************************************  26340000
063400 9000-END-OF-JOB.                                                 26370000
063500*     CLOSE FILES.                                                26350000
063600****************************************************************  26360000
063700                                                                  26380000
063800     CLOSE DATE-FILE                                              26420000
063900           DATE-ADVANCE-FILE                                      00320000
064000           OUT-DATE-FILE1                                         00320000
064100           OUT-DATE-FILE2                                         00320000
064200           OUT-DATE-FILE3                                         00320000
064300           OUT-DATE-FILE4                                         00320000
064400           OUT-DATE-FILE5                                         00320000
064500           OUT-DATE-FILE6                                         00320000
064600           OUT-DATE-FILE7                                         00320000
064700           OUT-EXCEED-FILE.                                       00320000
064800                                                                  26430000
064900****************************************************************  26340000
065000 9000-ABEND.                                                      26370000
065100*     NON-DATABASE ABEND.                                         26350000
065200****************************************************************  26360000
065300                                                                  26380000
065400     DISPLAY '** ABEND     **'.                                   26640000
065500     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        26650000
065600     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              26660000
065700     DISPLAY '** OPERATION ** = ' PV-OPERATION-MSG.               26670000
065800                                                                  26730000
065900     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         26740000
066000                                                                  26430000
066100******************************************************************26590000
066400 9999-SQL-ABEND.                                                  26620000
066200*     SQL ABEND PARAGRAPH.                                        26600000
066300******************************************************************26610000
066500                                                                  26630000
066600     DISPLAY '** ABEND     **'.                                   26640000
066700     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        26650000
066800     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              26660000
066900     DISPLAY '** OPERATION ** = ' PV-OPERATION-MSG.               26670000
067000******************************************************************26680000
067100* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     26690000
067200* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      26700000
067300******************************************************************26710000
067400     COPY DPPD004.                                                26720000
067500     SET AC-DB2-ERROR TO TRUE.                                    26730000
067600     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         26740000
