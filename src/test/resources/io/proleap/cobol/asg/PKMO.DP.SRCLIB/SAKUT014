000100*---------------------------------------------------------        00010099
000200 IDENTIFICATION DIVISION.                                         00020000
000300*----------------------------------------------------------       00030034
000400 PROGRAM-ID.    SAKUT014.                                         00040099
000500 AUTHOR.        SCOTT BARTELT                                     00050000
000600 DATE-WRITTEN.  DECEMBER, 2001.                                   00060099
000700                                                                  00070000
000800*----------------------------------------------------------       00080000
000900* THIS PROGRAM PROCESSES EVEN EXCHANGE MARKDOWNS.                 00090001
001300*----------------------------------------------------------       00130000
001400*----------------------------------------------------------       00140000
001410* HISTORY LOG:                                                    00141000
001420*                                                                 00142000
001500* DATE: 06/03/02                                                  00150099
001600* WR/IR#: IR#471799                                               00160099
001700* PROGRAMMER: SCOTT BARTELT                                       00170099
001800* DESCRIPTION: ADDED 'WITH UR' PARAMETER TO CURSORS TO            00180099
001900* PREVENT DB2 CONTENTION.                                         00190099
001420*                                                                 00200099
003194*----------------------------------------------------------       00201099
021811* DATE: 02/18/11                                                  00210099
021811* WR/IR#: WR#39586                                                00220099
021811* PROGRAMMER: CHERI PARMLEY                                       00230099
021811* DESCRIPTION: ADDED 2 FIELDS TO THE END OF OUTPUT FILE FOR DATA  00240099
021811*              WAREHOUSE (STRT-TM AND CORR-SEQ-NBR)               00241099
003194*----------------------------------------------------------       00319400
031511* DATE: 03/15/11                                                  00319599
031511* WR/IR#: WR#39586                                                00319699
031511* PROGRAMMER: CHERI PARMLEY                                       00319799
031511* DESCRIPTION: ADDED 4 DIGIT YEAR TO THE END OF SAWS039           00319899
031511*              COPYBOOK.                                          00319999
003194*----------------------------------------------------------       00320099
003195 ENVIRONMENT DIVISION.                                            00320100
003196*----------------------------------------------------------       00320200
003197 CONFIGURATION SECTION.                                           00320300
003198 SOURCE-COMPUTER. IBM-3090.                                       00320400
003199 OBJECT-COMPUTER. IBM-3090.                                       00320500
003200                                                                  00321000
003300 INPUT-OUTPUT SECTION.                                            00330000
003400                                                                  00340000
003500 FILE-CONTROL.                                                    00350000
003600                                                                  00360000
004001     SELECT POS-DATE-FILE                                         00400164
004002       FILE STATUS IS SC-POS-DATE-FILE-STATUS                     00400264
004003       ASSIGN TO INP01.                                           00400399
004010                                                                  00401064
004100     SELECT POS-EVEN-EXCHG-FILE                                   00410099
004200       FILE STATUS IS SC-POS-EV-EX-FILE-STATUS                    00420099
004300       ASSIGN TO OUT01.                                           00430011
004900                                                                  00490000
005000*----------------------------------------------------------       00500000
005100 DATA DIVISION.                                                   00510000
005200*----------------------------------------------------------       00520000
005300 FILE SECTION.                                                    00530000
008300                                                                  00830000
008301 FD  POS-DATE-FILE                                                00830164
008302     RECORDING MODE IS F                                          00830264
008303     LABEL RECORDS ARE STANDARD                                   00830364
008304     RECORD CONTAINS 80 CHARACTERS                                00830464
008305     DATA RECORD IS POS-DATE-RECORD.                              00830564
008306 01  POS-DATE-RECORD                        PIC  X(080).          00830664
008307                                                                  00830764
008308 FD  POS-EVEN-EXCHG-FILE                                          00830899
008309     RECORDING MODE IS F                                          00830900
008310     BLOCK CONTAINS 0 RECORDS                                     00831011
008311     LABEL RECORDS ARE STANDARD.                                  00831111
008312 01  POS-EVEN-EXCHG-RECORD                  PIC  X(115).          00831299
008313                                                                  00831311
008320*----------------------------------------------------------       00832000
008400 WORKING-STORAGE SECTION.                                         00840000
008401*----------------------------------------------------------       00840111
008403 01  ABEND-CODE                             PIC S9(004)           00840312
008404                                             VALUE +0             00840412
008405                                             COMP.                00840512
008407                                                                  00840711
008408*---------------------------------------------                    00840864
008410* RECORD LAYOUT FOR INPUT DATE CARD                               00841064
008411* (POS DATE)                                                      00841164
008412*---------------------------------------------                    00841264
008414 01  CC-POS-DATE-CARD.                                            00841464
008415   05  CC-POS-DATE-CARD-DISPLAY.                                  00841564
008416     10  CC-CONTROL-NAME                    PIC  X(014)           00841664
008417                                             VALUE SPACES.        00841764
008418       88  CC-VALID-CONTROL-NAME                                  00841864
008419             VALUE 'P.O.S. DATE = '.                              00841964
008420     10  CC-POS-DATE-MMDDYY                 PIC  9(006)           00842064
008421                                             VALUE ZEROES.        00842164
008422     10  FILLER                                                   00842264
008423        REDEFINES CC-POS-DATE-MMDDYY.                             00842364
008424       15  CC-POS-DATE-MM                   PIC  9(002).          00842464
008425       15  CC-POS-DATE-DD                   PIC  9(002).          00842564
008426       15  CC-POS-DATE-YY                   PIC  9(002).          00842664
008427   05  FILLER                               PIC  X(060)           00842764
008428                                             VALUE SPACES.        00842864
008429                                                                  00842964
008430*---------------------------------------------                    00843012
008431* SC- FILE STATUSES                                               00843199
008432*---------------------------------------------                    00843212
008433 01  SC-FILE-STATUS-CODES.                                        00843311
008461   05  SC-POS-DATE-FILE-STATUS              PIC  X(002)           00846164
008462                                             VALUE SPACES.        00846264
008463     88  SC-POS-DATE-STATUS-OK               VALUE '00'.          00846364
008470   05  SC-POS-EV-EX-FILE-STATUS             PIC  X(002)           00847099
008480                                             VALUE SPACES.        00848012
008490     88  SC-POS-EV-EX-FILE-OK                VALUE '00'.          00849099
008500                                                                  00850011
008510*---------------------------------------------                    00851017
008520* PC- PROGRAM CONSTANTS                                           00852017
008530*---------------------------------------------                    00853017
008540 01  PC-PROGRAM-CONSTANTS.                                        00854017
008609   05  PC-MORE-THAN-MAX-RETRY               PIC S9(004)           00860927
008610                                             VALUE +11            00861027
008611                                             COMP SYNC.           00861127
008613   05  PC-MAX-RETRY                         PIC S9(004)           00861327
008614                                             VALUE +10            00861427
008615                                             COMP SYNC.           00861527
008618   05  PC-PROGRAM-NAME                      PIC  X(008)           00861828
008619        VALUE 'SAKUT014'.                                         00861999
008620                                                                  00862017
008630*---------------------------------------------                    00863012
008700* PS- PROGRAM SWITCHES                                            00870011
008710*---------------------------------------------                    00871012
008900 01  PS-PROGRAM-SWITCHES.                                         00890011
009402   05  PS-EOF-EVEN-EXCHG-CSR-SW             PIC  X(001).          00940237
009403     88  PS-NOT-EOF-EVEN-EXCHG-CSR           VALUE 'N'.           00940337
009404     88  PS-EOF-EVEN-EXCHG-CSR               VALUE 'Y'.           00940437
009405   05  PS-CURSOR-BEING-PROCESSED-SW         PIC  X(001).          00940599
009406     88  PS-ON-TIME-TRANS-PROCESSING         VALUE 'T'.           00940699
009407     88  PS-LATE-TRANS-PROCESSING            VALUE 'L'.           00940799
009414                                                                  00941499
009415*---------------------------------------------                    00941599
009416* PV- PROGRAM VARIABLES                                           00941699
009417*---------------------------------------------                    00941799
009418 01  PV-PROGRAM-VARIABLES.                                        00941899
009419   05  PV-PARAGRAPH-NAME                    PIC  X(030)           00941999
009420                                             VALUE SPACES.        00942099
009421   05  PV-DB2-OPERATION-ATTEMPTED           PIC  X(030)           00942199
009422                                             VALUE SPACES.        00942299
009423   05  PV-CURRENT-FISCAL-PRD-YYPP.                                00942399
009424     10  PV-CURRENT-FISCAL-PRD-YEAR         PIC  9(002).          00942499
009425     10  PV-CURRENT-FISCAL-PRD-NBR          PIC  9(002).          00942599
009426   05  PV-RETURN-ITEM-COUNT                 PIC S9(005)           00942699
009427                                             VALUE ZEROES.        00942799
009428   05  PV-SALE-ITEM-COUNT                   PIC S9(005)           00942899
009429                                             VALUE ZEROES.        00942999
009430   05  PV-UNIT-CUST-CHARGED-AMT             PIC S9(005)V99        00943099
009431                                             VALUE ZEROES         00943199
009432                                             COMP-3.              00943299
009433   05  PV-UNIT-NET-AMT-CHARGED              PIC S9(005)V99        00943399
009434                                             VALUE ZEROES         00943499
009435                                             COMP-3.              00943599
009436   05  PV-STATUS-CODE                       PIC S9(003)           00943699
009437                                             VALUE ZEROES         00943799
009438                                             COMP-3.              00943899
009439   05  PV-UNIT-RETAIL-AMT                   PIC S9(005)V99        00943999
009440                                             VALUE ZEROES         00944099
009441                                             COMP-3.              00944199
009442   05  PV-UNIT-OWNED-RETAIL-AMT             PIC S9(005)V99        00944299
009443                                             VALUE ZEROES         00944399
009444                                             COMP-3.              00944499
009445   05  PV-RETRY-COUNT                       PIC S9(004)           00944599
009446                                             VALUE ZEROES         00944699
009447                                             COMP SYNC.           00944799
009448   05  PV-POS-DATE-ISO-FMT.                                       00944899
009449     10  PV-POS-DATE-ISO-CC                 PIC  9(002).          00944999
009450     10  PV-POS-DATE-ISO-YY                 PIC  9(002).          00945099
009451     10  FILLER                             PIC  X(001).          00945199
009452     10  PV-POS-DATE-ISO-MM                 PIC  9(002).          00945299
009453     10  FILLER                             PIC  X(001).          00945399
009454     10  PV-POS-DATE-ISO-DD                 PIC  9(002).          00945499
009455   05  PV-POS-DATE-ISO-FMT-HOLD             PIC  X(010).          00945599
009456   05  PV-EPITM-STR-NBR-HOLD                PIC S9(004)           00945699
009457                                             COMP.                00945799
009458   05  PV-EPITM-RGST-ID-HOLD                PIC S9(004)           00945899
009459                                             COMP.                00945999
009460   05  PV-EPITM-TRN-NBR-HOLD                PIC S9(004)           00946099
009461                                             COMP.                00946199
009462   05  PV-POS-DATE-GREG-FMT.                                      00946299
009463     10  PV-POS-DATE-GREG-YY                PIC  X(002).          00946399
009464     10  PV-POS-DATE-GREG-MM                PIC  X(002).          00946499
009465     10  PV-POS-DATE-GREG-DD                PIC  X(002).          00946599
009466   05  PV-POS-DATE-GREG-FMT-NUM                                   00946699
009467      REDEFINES PV-POS-DATE-GREG-FMT        PIC  9(006).          00946799
009468   05  PV-POS-DATE-YMD                      PIC S9(007)           00946899
009469                                             VALUE ZEROES.        00946999
009470   05  PV-SKU-NBR-UNSIGNED                  PIC  9(008) COMP-3    00947099
009471                                             VALUE ZEROES.        00947199
009480   05  PV-SKU-NBR-UNPACKED                  PIC  9(008)           00948099
009505                                             VALUE ZEROES.        00950599
009506   05  PV-MAJ-CL-UNSIGNED                   PIC  9(004) COMP-3    00950699
009507                                             VALUE ZEROES.        00950799
009508   05  PV-MAJ-CL-UNPACKED                   PIC  9(004)           00950899
009509                                             VALUE ZEROES.        00950999
009510                                                                  00951099
009511*---------------------------------------------                    00951199
009512* WORKING STORAGE FOR DPKUT500 INTERFACE                          00951299
009513*---------------------------------------------                    00951399
009514     COPY DPWS500.                                                00951499
009520                                                                  00952073
009521*---------------------------------------------                    00952173
009522* VARIABLES REQUIRED FOR THE FORMAT SQLCA                         00952273
009523* ROUTINE DPPD004                                                 00952373
009524*---------------------------------------------                    00952473
009525     COPY DPWS004.                                                00952573
009526                                                                  00952673
009533*---------------------------------------------                    00953373
009534* EVEN EXCHANGE EXTRACTION RECORD LAYOUT                          00953473
009535*---------------------------------------------                    00953573
009536     COPY SAWS039.                                                00953699
009610                                                                  00961073
009611*---------------------------------------------                    00961199
009612* TEPDKEY TABLE - PROCESSING DAY KEY TABLE                        00961299
009613*---------------------------------------------                    00961399
009614     EXEC SQL                                                     00961499
009615         INCLUDE TEPDKEY                                          00961599
009616     END-EXEC.                                                    00961699
009617                                                                  00961799
009618*---------------------------------------------                    00961874
009619* TEPPART TABLE - COSA PARTITION CONTROL TABLE                    00961974
009620*---------------------------------------------                    00962074
009621     EXEC SQL                                                     00962174
009622         INCLUDE TEPPART                                          00962274
009623     END-EXEC.                                                    00962374
009630                                                                  00963074
009638*---------------------------------------------                    00963873
009639* TEPTRN TABLE - COSA TRANSACTION TABLE                           00963973
009640*---------------------------------------------                    00964073
009641     EXEC SQL                                                     00964173
009642         INCLUDE TEPTRN                                           00964273
009643     END-EXEC.                                                    00964373
009644                                                                  00964473
009645*---------------------------------------------                    00964573
009646* TEPITM TABLE - COSA ITEM TABLE                                  00964673
009647*---------------------------------------------                    00964773
009648     EXEC SQL                                                     00964873
009649         INCLUDE TEPITM                                           00964973
009650     END-EXEC.                                                    00965073
009651                                                                  00965173
009652*---------------------------------------------                    00965299
009653* TEPIGP TABLE - COSA ITEM GROUP PRICING TABLE                    00965399
009654*---------------------------------------------                    00965499
009655     EXEC SQL                                                     00965599
009656          INCLUDE TEPIGP                                          00965699
009657     END-EXEC.                                                    00965799
009658                                                                  00965899
009659*---------------------------------------------                    00965973
009660* CURSOR TO PICK UP EVEN EXCHANGE RECORDS                         00966073
009661* ON NORMAL TRANSACTIONS                                          00966199
009662*---------------------------------------------                    00966273
009663     EXEC SQL                                                     00966373
009664       DECLARE EVEN-EXCHG-CSR CURSOR FOR                          00966473
009665         SELECT I.PARTN_NBR                                       00966599
009666               ,I.STR_NBR                                         00966699
009667               ,I.RGST_ID                                         00966777
009668               ,I.TRN_NBR                                         00966877
009669               ,I.STRT_TM                                         00966999
009670               ,I.LIV_RSLU_CDE                                    00967077
009671               ,I.DEPT_NBR                                        00967177
009672               ,I.SUB_CL_NBR                                      00967277
009675               ,I.SLD_QTY                                         00967573
009676               ,I.NET_CHRGD_AMT                                   00967673
009677               ,I.SAL_TYP_CDE                                     00967773
009678               ,I.SAL_RET_CDE                                     00967899
009679               ,I.ITM_STAT_CDE                                    00967999
009680               ,I.CUST_CHRGD_AMT                                  00968073
009681               ,I.REG_RTL_AMT                                     00968199
009682               ,I.OWND_UNT_RTL_AMT                                00968299
009683               ,I.LNE_ITM_SEQ_NBR                                 00968373
009684               ,I.MAJ_CL_NBR                                      00968499
009685               ,I.SKU_NBR                                         00968599
009686               ,T.SLS_DTE                                         00968673
009687               ,T.QUAL_CDE                                        00968773
021811               ,I.SLS_CORR_SEQ_NBR                                00968899
009688         FROM   TEPPART P                                         00968999
009689               ,TEPITM  I                                         00969099
009690               ,TEPTRN  T                                         00969199
009691         WHERE  P.SLS_DTE          = :EPPART-SLS-DTE              00969299
009692          AND   P.PARTN_NBR        = I.PARTN_NBR                  00969399
009693          AND   I.PARTN_NBR        = T.PARTN_NBR                  00969499
009694          AND   I.STR_NBR          = T.STR_NBR                    00969599
009695          AND   I.RGST_ID          = T.RGST_ID                    00969699
009696          AND   I.TRN_NBR          = T.TRN_NBR                    00969799
009697          AND   I.STRT_TM          = T.STRT_TM                    00969899
009698          AND   I.SLS_CORR_SEQ_NBR = 0                            00969999
009699          AND   I.SLS_CORR_SEQ_NBR = T.SLS_CORR_SEQ_NBR           00970099
009700          AND   T.TRN_TYP_CDE     IN ('21')                       00970199
009701          AND   I.LIV_RSLU_CDE    <> 'R'                          00970299
009702          AND   I.LIV_RSLU_CDE    <> 'V'                          00970399
009703          AND   T.VOID_ABRT_CDE    = 'N'                          00970499
021811          AND   P.DB_STRUC_CDE     = 'O'                          00970599
009706         ORDER BY T.SLS_DTE, I.STR_NBR, I.RGST_ID, I.TRN_NBR,     00970699
009707                  I.LNE_ITM_SEQ_NBR                               00970799
009708         FOR FETCH ONLY                                           00970899
009709         WITH UR                                                  00970999
009710     END-EXEC.                                                    00971099
009711                                                                  00971199
009712*---------------------------------------------                    00971299
009713* CURSOR TO PICK UP EVEN EXCHANGE RECORDS                         00971399
009714* ON LATE TRANSACTIONS AND SALES CORRECTIONS                      00971499
009715*---------------------------------------------                    00971599
009716     EXEC SQL                                                     00971699
009717       DECLARE EVEN-EXCHG-LT-CSR CURSOR FOR                       00971799
009718         SELECT I.PARTN_NBR                                       00971899
009719               ,I.STR_NBR                                         00971999
009720               ,I.RGST_ID                                         00972099
009721               ,I.TRN_NBR                                         00972199
009722               ,I.STRT_TM                                         00972299
009723               ,I.LIV_RSLU_CDE                                    00972399
009724               ,I.DEPT_NBR                                        00972499
009725               ,I.SUB_CL_NBR                                      00972599
009727               ,I.SLD_QTY                                         00972799
009728               ,I.NET_CHRGD_AMT                                   00972899
009729               ,I.SAL_TYP_CDE                                     00972999
009730               ,I.SAL_RET_CDE                                     00973099
009731               ,I.ITM_STAT_CDE                                    00973199
009732               ,I.CUST_CHRGD_AMT                                  00973299
009733               ,I.REG_RTL_AMT                                     00973399
009734               ,I.OWND_UNT_RTL_AMT                                00973499
009735               ,I.LNE_ITM_SEQ_NBR                                 00973599
009736               ,I.MAJ_CL_NBR                                      00973699
009737               ,I.SKU_NBR                                         00973799
009738               ,T.SLS_DTE                                         00973899
009739               ,T.QUAL_CDE                                        00973999
021811               ,I.SLS_CORR_SEQ_NBR                                00974099
009740         FROM   TEPDKEY D                                         00974199
009741               ,TEPPART C                                         00974299
009742               ,TEPITM  I                                         00974399
009743               ,TEPTRN  T                                         00974499
009744         WHERE  D.PRCG_DTE         = :EPDKEY-PRCG-DTE             00974599
009745          AND   D.SLS_DTE          = C.SLS_DTE                    00974699
009746          AND   C.PARTN_NBR        = I.PARTN_NBR                  00974799
009747          AND   C.PARTN_NBR        = T.PARTN_NBR                  00974899
009748          AND   D.STR_NBR          = I.STR_NBR                    00974999
009749          AND   D.STR_NBR          = T.STR_NBR                    00975099
009750          AND   D.RGST_ID          = I.RGST_ID                    00975199
009751          AND   D.RGST_ID          = T.RGST_ID                    00975299
009752          AND   D.TRN_NBR          = I.TRN_NBR                    00975399
009753          AND   D.TRN_NBR          = T.TRN_NBR                    00975499
009754          AND   D.STRT_TM          = I.STRT_TM                    00975599
009755          AND   D.STRT_TM          = T.STRT_TM                    00975699
009756          AND   D.SLS_CORR_SEQ_NBR = I.SLS_CORR_SEQ_NBR           00975799
009757          AND   D.SLS_CORR_SEQ_NBR = T.SLS_CORR_SEQ_NBR           00975899
009758          AND   T.TRN_TYP_CDE     IN ('21')                       00975999
009759          AND   I.LIV_RSLU_CDE    <> 'R'                          00976099
009760          AND   I.LIV_RSLU_CDE    <> 'V'                          00976199
009761          AND   T.VOID_ABRT_CDE    = 'N'                          00976299
021811          AND   C.DB_STRUC_CDE     = 'O'                          00976399
009762         ORDER BY T.SLS_DTE, I.STR_NBR, I.RGST_ID, I.TRN_NBR,     00976499
009763                  I.LNE_ITM_SEQ_NBR                               00976599
009764         FOR FETCH ONLY                                           00976699
009765         WITH UR                                                  00976799
009766     END-EXEC.                                                    00976899
009767                                                                  00976999
009768*---------------------------------------------                    00977099
009769* STANDARD LAYOUT FOR THE SQL COMMUNCATIONS                       00977199
009770* AREA                                                            00977299
009780*---------------------------------------------                    00978099
009900     EXEC SQL                                                     00990011
010000         INCLUDE SQLCA                                            01000011
010100     END-EXEC.                                                    01010011
010200                                                                  01020011
042900*----------------------------------------------------------       04290000
043000 PROCEDURE DIVISION.                                              04300000
043100*----------------------------------------------------------       04310000
043200 0000-MAINLINE.                                                   04320000
043300                                                                  04330000
043301     PERFORM 1000-INITIALIZE.                                     04330111
043302                                                                  04330200
043303     PERFORM 2000-PROCESS-DAYS-INFO.                              04330399
044000                                                                  04400000
044001     PERFORM 9999-CLEAN-UP.                                       04400130
044020                                                                  04402030
044100     GOBACK.                                                      04410000
044200                                                                  04420000
044300*0000-EXIT.                                                       04430000
044400 EJECT                                                            04440000
044401                                                                  04440111
044402*----------------------------------------------------------       04440200
044403* 1000-INITIALIZE.                                                04440300
044406*----------------------------------------------------------       04440600
044407 1000-INITIALIZE.                                                 04440700
044408                                                                  04440800
044413     OPEN INPUT  POS-DATE-FILE                                    04441399
044415          OUTPUT POS-EVEN-EXCHG-FILE.                             04441599
044417                                                                  04441799
044418     SET PS-NOT-EOF-EVEN-EXCHG-CSR TO TRUE.                       04441899
044419                                                                  04441973
044421     READ POS-DATE-FILE                                           04442199
044422       INTO CC-POS-DATE-CARD                                      04442299
044423         AT END                                                   04442399
044424           DISPLAY ' '                                            04442499
044425           DISPLAY '** ABEND     **'                              04442599
044426           DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME          04442699
044427           DISPLAY '** PARAGRAPH **'                              04442799
044428            '= 1000-INITIALIZE'                                   04442899
044429           DISPLAY '** CONTROL CARD DATE RECORD IS MISSING'       04442999
044430           MOVE +4003 TO ABEND-CODE                               04443099
044431           CALL 'ILBOABN0' USING ABEND-CODE                       04443199
044432     END-READ.                                                    04443299
044433                                                                  04443399
044434*** FORMAT POS CONTROL CARD DATE INFORMATION                      04443499
044436     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         04443699
044437                                                                  04443799
044438     SET DPG51-FISCAL-454-CALENDAR TO TRUE.                       04443899
044439     SET DPG52-LK-DTE-GREG         TO TRUE.                       04443999
044440                                                                  04444099
044450     MOVE CC-POS-DATE-MMDDYY TO DPG52-LK-DATE-INPUT.              04445099
044460                                                                  04446099
044461     CALL DP500-KOHLS-CALENDAR-ROUTINE                            04446199
044462       USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                 04446299
044463                                                                  04446399
044464     EVALUATE TRUE                                                04446499
044465       WHEN DPG54-NO-ERROR                                        04446599
044466         CONTINUE                                                 04446699
044467       WHEN OTHER                                                 04446799
044468         DISPLAY ' '                                              04446899
044469         DISPLAY '** ABEND     **'                                04446999
044470         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            04447099
044471         DISPLAY '** PARAGRAPH **'                                04447199
044472          '= 1000-INITIALIZE'                                     04447299
044473         DISPLAY '** ERROR MESSAGE = ' DPG54-ERROR-MESSAGE        04447399
044474         MOVE +4019 TO ABEND-CODE                                 04447499
044475         CALL 'ILBOABN0' USING ABEND-CODE                         04447599
044476     END-EVALUATE.                                                04447699
044477                                                                  04447799
044480     MOVE DPG55-DB2-ISO-DATE-FMT TO EPPART-SLS-DTE                04448099
044481                                    EPDKEY-PRCG-DTE.              04448199
044482                                                                  04448299
044483     DISPLAY ' '                                                  04448399
044484     DISPLAY 'PROCESSING SALES DATE OF:'                          04448499
044485      EPPART-SLS-DTE.                                             04448599
044486                                                                  04448699
044487*1000-EXIT.                                                       04448799
044488 EJECT                                                            04448899
044490                                                                  04449000
044645*----------------------------------------------------------       04464573
044646* 2000-PROCESS-DAYS-INFO.                                         04464699
044648*----------------------------------------------------------       04464873
044649 2000-PROCESS-DAYS-INFO.                                          04464999
044651                                                                  04465173
044652*** PERFORM PROCEDURES TO PROCESS TRANSACTIONS WHICH ARE          04465299
044653*** ON TIME                                                       04465399
044656     SET PS-ON-TIME-TRANS-PROCESSING TO TRUE.                     04465699
044657                                                                  04465799
044658     PERFORM 6010-OPEN-EVEN-EXCHG-CSR.                            04465899
044659                                                                  04465973
044660     SET PS-NOT-EOF-EVEN-EXCHG-CSR TO TRUE.                       04466099
044661                                                                  04466194
044662     PERFORM 6020-FETCH-EVEN-EXCHG-CSR.                           04466299
044663                                                                  04466373
044664     PERFORM 3100-PROCESS-SALES-RECORDS                           04466499
044665       UNTIL PS-EOF-EVEN-EXCHG-CSR.                               04466599
044666                                                                  04466673
044667     PERFORM 6030-CLOSE-EVEN-EXCHG-CSR.                           04466799
044668                                                                  04466878
044669*** PERFORM PROCEDURES TO PROCESS LATE TRANSACTIONS AND           04466999
044670*** SALES CORRECTIONS                                             04467099
044672     SET PS-LATE-TRANS-PROCESSING TO TRUE.                        04467299
044673                                                                  04467399
044674     PERFORM 6050-OPEN-EVEN-EXCHG-LATE-CSR.                       04467499
044675                                                                  04467599
044676     SET PS-NOT-EOF-EVEN-EXCHG-CSR TO TRUE.                       04467699
044677                                                                  04467799
044678     PERFORM 6060-FETCH-EVEN-EXCHG-LT-CSR.                        04467899
044680                                                                  04468099
044681     PERFORM 3100-PROCESS-SALES-RECORDS                           04468199
044682       UNTIL PS-EOF-EVEN-EXCHG-CSR.                               04468299
044683                                                                  04468399
044684     PERFORM 6070-CLOSE-EVEN-EXCHG-LT-CSR.                        04468499
044685                                                                  04468599
044686*2000-EXIT.                                                       04468673
044687 EJECT                                                            04468773
044688                                                                  04468873
044689*----------------------------------------------------------       04468973
044690* 3100-PROCESS-SALES-RECORDS.                                     04469099
044691*----------------------------------------------------------       04469173
044692 3100-PROCESS-SALES-RECORDS.                                      04469299
044693                                                                  04469373
044694     IF PS-NOT-EOF-EVEN-EXCHG-CSR                                 04469473
044695                                                                  04469573
044696       MOVE EPTRN-SLS-DTE       TO PV-POS-DATE-ISO-FMT            04469699
044697       MOVE PV-POS-DATE-ISO-YY  TO PV-POS-DATE-GREG-YY            04469799
044698       MOVE PV-POS-DATE-ISO-MM  TO PV-POS-DATE-GREG-MM            04469899
044699       MOVE PV-POS-DATE-ISO-DD  TO PV-POS-DATE-GREG-DD            04469999
044700       MOVE PV-POS-DATE-GREG-FMT-NUM                              04470073
044701        TO PV-POS-DATE-YMD                                        04470199
044702                                                                  04470273
044703       IF EPTRN-SLS-DTE NOT = PV-POS-DATE-ISO-FMT-HOLD            04470399
044704         PERFORM 6040-RETRIEVE-FISCAL-DATE-INFO                   04470499
044705       END-IF                                                     04470599
044706                                                                  04470699
044707       MOVE EPTRN-SLS-DTE TO PV-POS-DATE-ISO-FMT-HOLD             04470799
044708       MOVE EPITM-STR-NBR TO PV-EPITM-STR-NBR-HOLD                04470899
044709       MOVE EPITM-RGST-ID TO PV-EPITM-RGST-ID-HOLD                04470999
044710       MOVE EPITM-TRN-NBR TO PV-EPITM-TRN-NBR-HOLD                04471099
044711                                                                  04471173
044712       MOVE ZEROES TO PV-RETURN-ITEM-COUNT                        04471273
044713                      PV-SALE-ITEM-COUNT                          04471373
044730                                                                  04473073
044740       PERFORM                                                    04474073
044741         UNTIL PS-EOF-EVEN-EXCHG-CSR                              04474173
044742           OR EPTRN-SLS-DTE NOT = PV-POS-DATE-ISO-FMT-HOLD        04474299
044743           OR EPITM-STR-NBR NOT = PV-EPITM-STR-NBR-HOLD           04474399
044744           OR EPITM-RGST-ID NOT = PV-EPITM-RGST-ID-HOLD           04474499
044745           OR EPITM-TRN-NBR NOT = PV-EPITM-TRN-NBR-HOLD           04474599
044748                                                                  04474873
044749             PERFORM 5000-CREATE-RECORD                           04474999
044750                                                                  04475073
044751             IF PS-ON-TIME-TRANS-PROCESSING                       04475199
044754               PERFORM 8010-WRITE-OUT01-RECORD                    04475499
044755               PERFORM 6080-RESET-SALES-AND-RETURN                04475599
044759               PERFORM 6020-FETCH-EVEN-EXCHG-CSR                  04475999
044760             ELSE                                                 04476099
044763               PERFORM 8010-WRITE-OUT01-RECORD                    04476399
044765               PERFORM 6080-RESET-SALES-AND-RETURN                04476599
044768               PERFORM 6060-FETCH-EVEN-EXCHG-LT-CSR               04476899
044769             END-IF                                               04476999
044770       END-PERFORM                                                04477060
044780                                                                  04478099
044800     END-IF.                                                      04480052
049902                                                                  04990200
049905*3100-EXIT.                                                       04990599
049906 EJECT                                                            04990600
049907                                                                  04990700
049946*----------------------------------------------------------       04994600
049947* 5000-CREATE-RECORD.                                             04994799
049948*----------------------------------------------------------       04994800
049949 5000-CREATE-RECORD.                                              04994999
049950                                                                  04995000
049951     MOVE PV-CURRENT-FISCAL-PRD-NBR                               04995199
049952      TO SA039-KOHLS-ACCT-MONTH.                                  04995299
049953                                                                  04995399
049954     MOVE PV-POS-DATE-YMD TO SA039-POS-DATE-YMD.                  04995499
031511     MOVE PV-POS-DATE-ISO-CC TO SA039-PC-DTE-YEAR(1:2).           04995599
031511     MOVE PV-POS-DATE-ISO-YY TO SA039-PC-DTE-YEAR(3:2).           04995699
049955     MOVE EPITM-STR-NBR   TO SA039-STORE-NUMBER.                  04995799
049956     MOVE EPITM-RGST-ID   TO SA039-TERMINAL-NUMBER.               04995899
049957     MOVE EPITM-TRN-NBR   TO SA039-TRANSACTION-NUMBER.            04995999
021811     MOVE EPITM-STRT-TM   TO SA039-STRT-TM.                       04996099
021811     MOVE EPITM-SLS-CORR-SEQ-NBR TO SA039-SLS-CORR-SEQ-NBR.       04996199
049958                                                                  04996399
049959     IF EPITM-SLD-QTY = ZERO                                      04996499
049960       MOVE 1 TO EPITM-SLD-QTY                                    04996599
049961     END-IF.                                                      04996699
049962                                                                  04996799
049963     COMPUTE PV-UNIT-CUST-CHARGED-AMT =                           04996899
049964               (EPITM-CUST-CHRGD-AMT /                            04996999
049965                  EPITM-SLD-QTY).                                 04997099
049966     IF PV-UNIT-CUST-CHARGED-AMT < ZERO                           04997199
049967       COMPUTE PV-UNIT-CUST-CHARGED-AMT =                         04997299
049968                 (PV-UNIT-CUST-CHARGED-AMT * (-1))                04997399
049969     END-IF.                                                      04997499
049970                                                                  04997599
049971     COMPUTE PV-UNIT-NET-AMT-CHARGED =                            04997699
049972               (EPITM-NET-CHRGD-AMT / EPITM-SLD-QTY).             04997799
049973                                                                  04997899
049974     IF PV-UNIT-NET-AMT-CHARGED < 0                               04997999
049975       COMPUTE PV-UNIT-NET-AMT-CHARGED =                          04998099
049976                 (PV-UNIT-NET-AMT-CHARGED * (-1))                 04998199
049977     END-IF.                                                      04998299
049980                                                                  04999099
050901     MOVE EPITM-ITM-STAT-CDE TO PV-STATUS-CODE.                   05090199
050902     MOVE EPITM-REG-RTL-AMT  TO PV-UNIT-RETAIL-AMT.               05090299
050903                                                                  05090399
050904     PERFORM 6090-CALC-OWND-UNT-RTL-AMT.                          05090499
050907                                                                  05090799
050908     IF EPITM-SAL-RET-CDE = 'R'                                   05090899
050909      OR EPITM-SAL-RET-CDE = 'A'                                  05090999
051100       COMPUTE PV-RETURN-ITEM-COUNT = PV-RETURN-ITEM-COUNT + 1    05110011
051110                                                                  05111013
051200       MOVE PV-RETURN-ITEM-COUNT   TO SA039-ITEM-SEQUENCE         05120099
051300       MOVE EPITM-DEPT-NBR         TO SA039-RI-DEPT-NBR           05130099
051400       MOVE EPITM-SUB-CL-NBR       TO SA039-RI-CLASS-NBR          05140099
051401                                                                  05140199
051500       MOVE EPITM-MAJ-CL-NBR       TO PV-MAJ-CL-UNSIGNED          05150099
051501       MOVE PV-MAJ-CL-UNSIGNED     TO PV-MAJ-CL-UNPACKED          05150199
051502       MOVE PV-MAJ-CL-UNPACKED     TO SA039-RI-MAJ-CLASS          05150299
051503                                                                  05150399
051510       MOVE EPITM-SKU-NBR          TO PV-SKU-NBR-UNSIGNED         05151099
051520       MOVE PV-SKU-NBR-UNSIGNED    TO PV-SKU-NBR-UNPACKED         05152099
051530       MOVE PV-SKU-NBR-UNPACKED    TO SA039-RI-SKU                05153099
051540                                                                  05154099
051600       MOVE PV-STATUS-CODE         TO SA039-RI-STATUS-CODE        05160099
051700       MOVE EPITM-SLD-QTY          TO SA039-RI-UNIT-QTY           05170099
051710                                                                  05171013
051800       COMPUTE SA039-RI-UNIT-CUST-CHARGED-AMT =                   05180099
051900                 PV-UNIT-CUST-CHARGED-AMT * -1                    05190011
052000       COMPUTE SA039-RI-UNIT-NET-AMT-CHARGED =                    05200099
052100                 PV-UNIT-NET-AMT-CHARGED * -1                     05210011
052200       COMPUTE SA039-RI-UNIT-RETAIL-AMT =                         05220099
052300                 PV-UNIT-RETAIL-AMT * -1                          05230011
052400       COMPUTE SA039-RI-UNIT-OWNED-RETAIL-AMT =                   05240099
052500                 PV-UNIT-OWNED-RETAIL-AMT * -1                    05250011
052510                                                                  05251013
053300     ELSE                                                         05330011
053400       COMPUTE PV-SALE-ITEM-COUNT = PV-SALE-ITEM-COUNT + 1        05340011
053410                                                                  05341013
053500       MOVE PV-SALE-ITEM-COUNT     TO SA039-ITEM-SEQUENCE         05350099
053600       MOVE EPITM-DEPT-NBR         TO SA039-SI-DEPT-NBR           05360099
053700       MOVE EPITM-SUB-CL-NBR       TO SA039-SI-CLASS-NBR          05370099
053701                                                                  05370199
053710       MOVE EPITM-MAJ-CL-NBR       TO PV-MAJ-CL-UNSIGNED          05371099
053720       MOVE PV-MAJ-CL-UNSIGNED     TO PV-MAJ-CL-UNPACKED          05372099
053730       MOVE PV-MAJ-CL-UNPACKED     TO SA039-SI-MAJ-CLASS          05373099
053740                                                                  05374099
053750       MOVE EPITM-SKU-NBR          TO PV-SKU-NBR-UNSIGNED         05375099
053760       MOVE PV-SKU-NBR-UNSIGNED    TO PV-SKU-NBR-UNPACKED         05376099
053770       MOVE PV-SKU-NBR-UNPACKED    TO SA039-SI-SKU                05377099
053800                                                                  05380099
053900       MOVE PV-STATUS-CODE         TO SA039-SI-STATUS-CODE        05390099
054000       MOVE EPITM-SLD-QTY          TO SA039-SI-UNIT-QTY           05400099
054100       MOVE PV-UNIT-CUST-CHARGED-AMT                              05410011
054200        TO SA039-SI-UNIT-CUST-CHARGED-AMT                         05420099
054300       MOVE PV-UNIT-NET-AMT-CHARGED                               05430011
054400        TO SA039-SI-UNIT-NET-AMT-CHARGED                          05440099
054500       MOVE PV-UNIT-RETAIL-AMT TO SA039-SI-UNIT-RETAIL-AMT        05450099
054600       MOVE PV-UNIT-OWNED-RETAIL-AMT                              05460011
054700        TO SA039-SI-UNIT-OWNED-RETAIL-AMT                         05470099
054710                                                                  05471099
055401     END-IF.                                                      05540127
055402                                                                  05540211
055403*5000-EXIT.                                                       05540399
055404 EJECT                                                            05540411
055405                                                                  05540500
055436*----------------------------------------------------------       05543630
055437* 6010-OPEN-EVEN-EXCHG-CSR.                                       05543799
055438*----------------------------------------------------------       05543830
055439 6010-OPEN-EVEN-EXCHG-CSR.                                        05543999
055440                                                                  05544030
055443     EXEC SQL                                                     05544349
055444       OPEN EVEN-EXCHG-CSR                                        05544449
055445     END-EXEC                                                     05544549
055446                                                                  05544630
055447     EVALUATE TRUE                                                05544730
055448       WHEN SQLCODE NOT = +0                                      05544830
055449         MOVE '6010-OPEN-EVEN-EXCHG-CSR'                          05544999
055450           TO PV-PARAGRAPH-NAME                                   05545030
055451         MOVE 'OPEN EVEN-EXCHG-CSR'                               05545130
055452           TO PV-DB2-OPERATION-ATTEMPTED                          05545230
055453         PERFORM 9100-SQL-ABEND                                   05545330
055460     END-EVALUATE.                                                05546030
055461                                                                  05546130
055462*6010-EXIT.                                                       05546299
055463 EJECT                                                            05546330
055464                                                                  05546430
055465*----------------------------------------------------------       05546530
055467* 6020-FETCH-EVEN-EXCHG-CSR.                                      05546799
055468*----------------------------------------------------------       05546830
055469 6020-FETCH-EVEN-EXCHG-CSR.                                       05546999
055476                                                                  05547630
055477     PERFORM VARYING PV-RETRY-COUNT FROM 1 BY 1                   05547730
055478       UNTIL PV-RETRY-COUNT > PC-MAX-RETRY                        05547830
055480         EXEC SQL                                                 05548030
055490           FETCH EVEN-EXCHG-CSR                                   05549030
055491             INTO :EPITM-PARTN-NBR                                05549199
055493                 ,:EPITM-STR-NBR                                  05549399
055494                 ,:EPITM-RGST-ID                                  05549436
055495                 ,:EPITM-TRN-NBR                                  05549536
055496                 ,:EPITM-STRT-TM                                  05549699
055497                 ,:EPITM-LIV-RSLU-CDE                             05549736
055498                 ,:EPITM-DEPT-NBR                                 05549836
055499                 ,:EPITM-SUB-CL-NBR                               05549936
055501                 ,:EPITM-SLD-QTY                                  05550136
055502                 ,:EPITM-NET-CHRGD-AMT                            05550236
055503                 ,:EPITM-SAL-TYP-CDE                              05550336
055504                 ,:EPITM-SAL-RET-CDE                              05550499
055505                 ,:EPITM-ITM-STAT-CDE                             05550599
055506                 ,:EPITM-CUST-CHRGD-AMT                           05550636
055507                 ,:EPITM-REG-RTL-AMT                              05550799
055508                 ,:EPITM-OWND-UNT-RTL-AMT                         05550899
055509                 ,:EPITM-LNE-ITM-SEQ-NBR                          05550977
055510                 ,:EPITM-MAJ-CL-NBR                               05551099
055511                 ,:EPITM-SKU-NBR                                  05551199
055512                 ,:EPTRN-SLS-DTE                                  05551236
055513                 ,:EPTRN-QUAL-CDE                                 05551336
021811                 ,:EPITM-SLS-CORR-SEQ-NBR                         05551499
055514         END-EXEC                                                 05551530
055515                                                                  05551630
055516         EVALUATE TRUE                                            05551730
055517           WHEN SQLCODE = -904                                    05551830
055518           WHEN SQLCODE = -911                                    05551930
055519           WHEN SQLCODE = -913                                    05552030
055520             CONTINUE                                             05552130
055521                                                                  05552230
055522           WHEN SQLCODE = +0                                      05552330
055523           WHEN SQLCODE = +100                                    05552430
055524             MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-COUNT        05552530
055525         END-EVALUATE                                             05552630
055526     END-PERFORM.                                                 05552730
055527                                                                  05552830
055528     EVALUATE TRUE                                                05552930
055529       WHEN SQLCODE = +0                                          05553030
055530         SET PS-NOT-EOF-EVEN-EXCHG-CSR TO TRUE                    05553137
055531       WHEN SQLCODE = +100                                        05553230
055532         SET PS-EOF-EVEN-EXCHG-CSR TO TRUE                        05553337
055533       WHEN OTHER                                                 05553430
055534         MOVE '6020-FETCH-EVEN-EXCHG-CSR'                         05553599
055535           TO PV-PARAGRAPH-NAME                                   05553630
055536         MOVE 'FETCH EVEN-EXCHG-CSR RECORD'                       05553730
055537           TO PV-DB2-OPERATION-ATTEMPTED                          05553830
055538         PERFORM 9100-SQL-ABEND                                   05553930
055539     END-EVALUATE.                                                05554030
055540                                                                  05554130
055541*6020-EXIT.                                                       05554299
055550 EJECT                                                            05555030
062705                                                                  06270500
062706*----------------------------------------------------------       06270673
062707* 6030-CLOSE-EVEN-EXCHG-CSR.                                      06270799
062708*----------------------------------------------------------       06270873
062709 6030-CLOSE-EVEN-EXCHG-CSR.                                       06270999
062710                                                                  06271073
062711     EXEC SQL                                                     06271173
062712       CLOSE EVEN-EXCHG-CSR                                       06271273
062713     END-EXEC                                                     06271373
062714     EVALUATE TRUE                                                06271473
062715       WHEN SQLCODE NOT = +0                                      06271573
062716         MOVE '6030-CLOSE-EVEN-EXCHG-CSR'                         06271699
062718           TO PV-PARAGRAPH-NAME                                   06271873
062719         MOVE 'CLOSE EVEN-EXCHG-CSR'                              06271973
062720           TO PV-DB2-OPERATION-ATTEMPTED                          06272073
062721         PERFORM 9100-SQL-ABEND                                   06272173
062722     END-EVALUATE.                                                06272273
062723                                                                  06272373
062724*6030-EXIT.                                                       06272499
062725 EJECT                                                            06272573
062726                                                                  06272673
062727*----------------------------------------------------------       06272799
062728* 6040-RETRIEVE-FISCAL-DATE-INFO.                                 06272899
062729*----------------------------------------------------------       06272999
062730 6040-RETRIEVE-FISCAL-DATE-INFO.                                  06273099
062740                                                                  06274099
062750*** GET FISCAL DATE INFORMATION BASED OFF OF THE TRANSACTION      06275099
062760*** DATE                                                          06276099
062761     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         06276199
062762                                                                  06276299
062763     SET DPG51-FISCAL-454-CALENDAR TO TRUE.                       06276399
062764     SET DPG52-LK-DTE-ISO-FMT      TO TRUE.                       06276499
062765                                                                  06276599
062766     MOVE EPTRN-SLS-DTE TO DPG52-LK-DATE-INPUT.                   06276699
062767                                                                  06276799
062768     CALL DP500-KOHLS-CALENDAR-ROUTINE                            06276899
062769       USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                 06276999
062770                                                                  06277099
062771     EVALUATE TRUE                                                06277199
062772       WHEN DPG54-NO-ERROR                                        06277299
062773         CONTINUE                                                 06277399
062774       WHEN OTHER                                                 06277499
062775         DISPLAY ' '                                              06277599
062776         DISPLAY '** ABEND     **'                                06277699
062777         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            06277799
062778         DISPLAY '** PARAGRAPH **'                                06277899
062779          '= 6040-RETRIEVE-FISCAL-DATE-INFO'                      06277999
062781         DISPLAY '** ERROR MESSAGE = ' DPG54-ERROR-MESSAGE        06278199
062782         MOVE +4019 TO ABEND-CODE                                 06278299
062783         CALL 'ILBOABN0' USING ABEND-CODE                         06278399
062784     END-EVALUATE.                                                06278499
062785                                                                  06278599
062786     MOVE DPG56-FISCAL-YEAR-NBR   TO PV-CURRENT-FISCAL-PRD-YEAR.  06278699
062787     MOVE DPG56-FISCAL-PERIOD-NBR TO PV-CURRENT-FISCAL-PRD-NBR.   06278799
062788                                                                  06278899
062789*6040-EXIT.                                                       06278999
062790 EJECT                                                            06279099
062800                                                                  06280074
062910*----------------------------------------------------------       06291099
062911* 6050-OPEN-EVEN-EXCHG-LATE-CSR.                                  06291199
062930*----------------------------------------------------------       06293099
062931 6050-OPEN-EVEN-EXCHG-LATE-CSR.                                   06293199
062950                                                                  06295099
062980     EXEC SQL                                                     06298099
062981       OPEN EVEN-EXCHG-LT-CSR                                     06298199
062991     END-EXEC                                                     06299199
062992                                                                  06299299
062993     EVALUATE TRUE                                                06299399
062994       WHEN SQLCODE NOT = +0                                      06299499
062995         MOVE '6050-OPEN-EVEN-EXCHG-LATE-CSR'                     06299599
062997           TO PV-PARAGRAPH-NAME                                   06299799
062998         MOVE 'OPEN EVEN-EXCHG-LT-CSR'                            06299899
062999           TO PV-DB2-OPERATION-ATTEMPTED                          06299999
063000         PERFORM 9100-SQL-ABEND                                   06300099
063001     END-EVALUATE.                                                06300199
063010                                                                  06301099
063020*6050-EXIT.                                                       06302099
063030 EJECT                                                            06303099
063100                                                                  06310099
063200*----------------------------------------------------------       06320099
063300* 6060-FETCH-EVEN-EXCHG-LT-CSR.                                   06330099
063400*----------------------------------------------------------       06340099
063500 6060-FETCH-EVEN-EXCHG-LT-CSR.                                    06350099
063600                                                                  06360099
063700     PERFORM VARYING PV-RETRY-COUNT FROM 1 BY 1                   06370099
063800       UNTIL PV-RETRY-COUNT > PC-MAX-RETRY                        06380099
063900         EXEC SQL                                                 06390099
063910           FETCH EVEN-EXCHG-LT-CSR                                06391099
063920             INTO :EPITM-PARTN-NBR                                06392099
064100                 ,:EPITM-STR-NBR                                  06410099
064200                 ,:EPITM-RGST-ID                                  06420099
064300                 ,:EPITM-TRN-NBR                                  06430099
064310                 ,:EPITM-STRT-TM                                  06431099
064400                 ,:EPITM-LIV-RSLU-CDE                             06440099
064500                 ,:EPITM-DEPT-NBR                                 06450099
064600                 ,:EPITM-SUB-CL-NBR                               06460099
064800                 ,:EPITM-SLD-QTY                                  06480099
064900                 ,:EPITM-NET-CHRGD-AMT                            06490099
065000                 ,:EPITM-SAL-TYP-CDE                              06500099
065010                 ,:EPITM-SAL-RET-CDE                              06501099
065100                 ,:EPITM-ITM-STAT-CDE                             06510099
065200                 ,:EPITM-CUST-CHRGD-AMT                           06520099
065300                 ,:EPITM-REG-RTL-AMT                              06530099
065400                 ,:EPITM-OWND-UNT-RTL-AMT                         06540099
065500                 ,:EPITM-LNE-ITM-SEQ-NBR                          06550099
065510                 ,:EPITM-MAJ-CL-NBR                               06551099
065520                 ,:EPITM-SKU-NBR                                  06552099
065600                 ,:EPTRN-SLS-DTE                                  06560099
065700                 ,:EPTRN-QUAL-CDE                                 06570099
021811                 ,:EPITM-SLS-CORR-SEQ-NBR                         06571099
065800         END-EXEC                                                 06580099
065900                                                                  06590099
066000         EVALUATE TRUE                                            06600099
066100           WHEN SQLCODE = -904                                    06610099
066200           WHEN SQLCODE = -911                                    06620099
066300           WHEN SQLCODE = -913                                    06630099
066400             CONTINUE                                             06640099
066500                                                                  06650099
066600           WHEN SQLCODE = +0                                      06660099
066700           WHEN SQLCODE = +100                                    06670099
066800             MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-COUNT        06680099
066900         END-EVALUATE                                             06690099
067000     END-PERFORM.                                                 06700099
067100                                                                  06710099
067200     EVALUATE TRUE                                                06720099
067300       WHEN SQLCODE = +0                                          06730099
067400         SET PS-NOT-EOF-EVEN-EXCHG-CSR TO TRUE                    06740099
067500       WHEN SQLCODE = +100                                        06750099
067600         SET PS-EOF-EVEN-EXCHG-CSR TO TRUE                        06760099
067700       WHEN OTHER                                                 06770099
067720         MOVE '6060-FETCH-EVEN-EXCHG-LT-CSR'                      06772099
067900           TO PV-PARAGRAPH-NAME                                   06790099
068000         MOVE 'FETCH EVEN-EXCHG-LT-CSR RECORD'                    06800099
068100           TO PV-DB2-OPERATION-ATTEMPTED                          06810099
068200         PERFORM 9100-SQL-ABEND                                   06820099
068300     END-EVALUATE.                                                06830099
068400                                                                  06840099
068500*6060-EXIT.                                                       06850099
068600 EJECT                                                            06860099
068700                                                                  06870099
068800*----------------------------------------------------------       06880099
068900* 6070-CLOSE-EVEN-EXCHG-LT-CSR.                                   06890099
069000*----------------------------------------------------------       06900099
069100 6070-CLOSE-EVEN-EXCHG-LT-CSR.                                    06910099
069200                                                                  06920099
069300     EXEC SQL                                                     06930099
069400       CLOSE EVEN-EXCHG-LT-CSR                                    06940099
069500     END-EXEC                                                     06950099
069600     EVALUATE TRUE                                                06960099
069700       WHEN SQLCODE NOT = +0                                      06970099
069800         MOVE '6070-CLOSE-EVEN-EXCHG-LT-CSR'                      06980099
069900           TO PV-PARAGRAPH-NAME                                   06990099
070000         MOVE 'CLOSE EVEN-EXCHG-LT-CSR'                           07000099
070100           TO PV-DB2-OPERATION-ATTEMPTED                          07010099
070200         PERFORM 9100-SQL-ABEND                                   07020099
070300     END-EVALUATE.                                                07030099
070400                                                                  07040099
070500*6070-EXIT.                                                       07050099
070600 EJECT                                                            07060099
070700                                                                  07070099
070710*----------------------------------------------------------       07071099
070721* 6080-RESET-SALES-AND-RETURN.                                    07072199
070730*----------------------------------------------------------       07073099
070800 6080-RESET-SALES-AND-RETURN.                                     07080099
070810                                                                  07081099
070811     MOVE ZEROES TO SA039-SI-STATUS-CODE                          07081199
070812                    SA039-SI-UNIT-QTY                             07081299
070813                    SA039-SI-UNIT-CUST-CHARGED-AMT                07081399
070814                    SA039-SI-UNIT-NET-AMT-CHARGED                 07081499
070815                    SA039-SI-UNIT-RETAIL-AMT                      07081599
070816                    SA039-SI-UNIT-OWNED-RETAIL-AMT                07081699
070817                    SA039-RI-STATUS-CODE                          07081799
070818                    SA039-RI-UNIT-QTY                             07081899
070819                    SA039-RI-UNIT-CUST-CHARGED-AMT                07081999
070820                    SA039-RI-UNIT-NET-AMT-CHARGED                 07082099
070821                    SA039-RI-UNIT-RETAIL-AMT                      07082199
070822                    SA039-RI-UNIT-OWNED-RETAIL-AMT.               07082299
070823                                                                  07082399
070824     MOVE '00000000' TO SA039-SI-SKU                              07082499
070825                        SA039-RI-SKU.                             07082599
070826                                                                  07082699
070827     MOVE '00000'    TO SA039-SI-DEPT-CLASS                       07082799
070828                        SA039-RI-DEPT-CLASS.                      07082899
070829                                                                  07082999
070830     MOVE '0000'     TO SA039-SI-MAJ-CLASS                        07083099
070831                        SA039-RI-MAJ-CLASS.                       07083199
070840                                                                  07084099
070900*6080-EXIT.                                                       07090099
071000 EJECT                                                            07100099
071100                                                                  07110099
071110*----------------------------------------------------------       07111099
071121* 6090-CALC-OWND-UNT-RTL-AMT.                                     07112199
071130*----------------------------------------------------------       07113099
071200 6090-CALC-OWND-UNT-RTL-AMT.                                      07120099
071210                                                                  07121099
071211     PERFORM VARYING PV-RETRY-COUNT FROM 1 BY 1                   07121199
071212       UNTIL PV-RETRY-COUNT > PC-MAX-RETRY                        07121299
071213         EXEC SQL                                                 07121399
071214           SELECT GP_QTY                                          07121499
071215                 ,GP_AMT                                          07121599
071216            INTO :EPIGP-GP-QTY                                    07121699
071219                ,:EPIGP-GP-AMT                                    07121999
071220           FROM  TEPIGP                                           07122099
071221            WHERE PARTN_NBR        = :EPITM-PARTN-NBR             07122199
071223              AND STR_NBR          = :EPITM-STR-NBR               07122399
071224              AND RGST_ID          = :EPITM-RGST-ID               07122499
071225              AND TRN_NBR          = :EPITM-TRN-NBR               07122599
071226              AND STRT_TM          = :EPITM-STRT-TM               07122699
071227              AND SLS_CORR_SEQ_NBR = :EPITM-SLS-CORR-SEQ-NBR      07122799
071228              AND LNE_ITM_SEQ_NBR  = :EPITM-LNE-ITM-SEQ-NBR       07122899
071229           WITH UR                                                07122999
071230         END-EXEC                                                 07123099
071231                                                                  07123199
071232         EVALUATE TRUE                                            07123299
071233           WHEN SQLCODE = -904                                    07123399
071234           WHEN SQLCODE = -911                                    07123499
071235           WHEN SQLCODE = -913                                    07123599
071236             CONTINUE                                             07123699
071237                                                                  07123799
071238           WHEN SQLCODE = +0                                      07123899
071239           WHEN SQLCODE = +100                                    07123999
071240             MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-COUNT        07124099
071241         END-EVALUATE                                             07124199
071242     END-PERFORM.                                                 07124299
071243                                                                  07124399
071244     EVALUATE TRUE                                                07124499
071245       WHEN SQLCODE = +0                                          07124599
071246         COMPUTE PV-UNIT-OWNED-RETAIL-AMT =                       07124699
071247           EPIGP-GP-AMT / EPIGP-GP-QTY                            07124799
071251       WHEN SQLCODE = +100                                        07125199
071252         MOVE EPITM-OWND-UNT-RTL-AMT                              07125299
071253          TO PV-UNIT-OWNED-RETAIL-AMT                             07125399
071254       WHEN OTHER                                                 07125499
071255         MOVE '6090-CALC-OWND-UNT-RTL-AMT'                        07125599
071256           TO PV-PARAGRAPH-NAME                                   07125699
071257         MOVE 'RETRIEVE ANY GROUP PRICING'                        07125799
071258           TO PV-DB2-OPERATION-ATTEMPTED                          07125899
071259         PERFORM 9100-SQL-ABEND                                   07125999
071260     END-EVALUATE.                                                07126099
071270                                                                  07127099
071300*6090-EXIT.                                                       07130099
071400 EJECT                                                            07140099
071500                                                                  07150099
090336*----------------------------------------------------------       09033612
090337* 8010-WRITE-OUT01-RECORD.                                        09033759
090338*----------------------------------------------------------       09033812
090339 8010-WRITE-OUT01-RECORD.                                         09033959
090340                                                                  09034012
090341     WRITE POS-EVEN-EXCHG-RECORD                                  09034199
090342       FROM SA039-EVEN-EXCHNG-EXTR-RECORD.                        09034299
090343                                                                  09034312
090344*8010-EXIT.                                                       09034459
090345 EJECT                                                            09034512
090346                                                                  09034612
090358*----------------------------------------------------------       09035899
090359* 9100-SQL-ABEND.                                                 09035999
090360*   - PERFORMS ABEND PROCESSING FOR SQL ERRORS.                   09036099
090361*----------------------------------------------------------       09036199
090362 9100-SQL-ABEND.                                                  09036299
090363                                                                  09036399
090364     DISPLAY ' '.                                                 09036499
090370     DISPLAY '9100-SQL-ABEND'.                                    09037011
090380     DISPLAY '**  ABEND     **'.                                  09038011
090390     DISPLAY '**  PROGRAM   ** = ' PC-PROGRAM-NAME.               09039011
090400     DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.             09040011
090500     DISPLAY '**  OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.    09050011
090600                                                                  09060011
090700*** THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION         09070011
090800*** STATEMENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND         09080011
090900*** MODULE 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO       09090011
091000*** A READABLE FORMAT.                                            09100011
091100     COPY DPPD004.                                                09110011
091200                                                                  09120011
091300     MOVE +4013 TO ABEND-CODE.                                    09130011
091400     CALL 'ILBOABN0' USING ABEND-CODE.                            09140099
091500                                                                  09150011
091600*9100-EXIT.                                                       09160011
091700 EJECT                                                            09170011
091701                                                                  09170130
091710*----------------------------------------------------------       09171030
091720* 9999-CLEAN-UP.                                                  09172030
091730*----------------------------------------------------------       09173030
091740 9999-CLEAN-UP.                                                   09174030
091750                                                                  09175030
091761     CLOSE POS-DATE-FILE                                          09176199
091770           POS-EVEN-EXCHG-FILE.                                   09177099
091800                                                                  09180030
091900*9999-EXIT.                                                       09190030
092000 EJECT                                                            09200030
