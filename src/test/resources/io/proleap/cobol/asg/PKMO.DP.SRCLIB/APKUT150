000100*-----------------------*                                         00020001
000200 IDENTIFICATION DIVISION.                                         00030001
000300*-----------------------*                                         00040001
000400 PROGRAM-ID.    APKUT150.                                         00050001
000500 AUTHOR.        JEAN KURK.                                        00060001
000600 DATE-WRITTEN.  MARCH 2020.                                       00070001
000700                                                                  00080001
000800*---------------------------------------------------------------* 00090001
000900*                       COBOL 2 WITH SQL                        * 00100001
001000*                                                               * 00110001
001100*         PURGE ADJUSTMENT JOURNAL DATA OVER ONE YEAR OLD       * 00120001
001200*                                                               * 00130001
001300*  THE PURPOSE OF THIS PROGRAM IS TO PURGE OLD DATA FROM THE    * 00140001
001400*  ADJUSTMENT JOURNAL DATABASE. IT WILL CALCULATE THE POSTING   * 00150001
001500*  PERIOD TO BE PURGED BASED ON THE PERIOD WE ARE IN THE        * 00160001
001600*  PROCESS OF CLOSING.  THIS PERIOD/YEAR WILL BE OBTAINED FROM  * 00170001
001700*  THE TAPCNTL TABLE, AND THEN THE YEAR WILL BE ADJUSTED SO     * 00180001
001800*  THAT WE WILL PURGE THE SAME MONTH FROM THE PERVIOUS YEAR.    * 00190001
002600*                                                               * 00270001
002600*  A CASCADE DELETE WAS PREVIOUSLY DONE IN APKUP149, WHICH      * 00271001
002600*  CAUSED THE DB2 LOGS TO FILL UP.  THIS PROGRAM WAS ADDED TO   * 00272001
002600*  THE JOB, TO SELECT THE ROWS TO BE DELETED.  APKUP149 WILL    * 00273001
002600*  DELETE FROM EACH TABLE INDIVIDUALLY.                         * 00274001
002600*                                                               * 00275001
002700*---------------------------------------------------------------* 00280001
002800*                                                               * 00290001
002900* DB2 TABLES:                                                   * 00300002
003100*     ACCOUNTS PAYABLE CONTROL TABLE    (TAPCNTL)               * 00320002
003100*     ADJUSTMENT JOURNAL TABLE          (TADJRNL)               * 00321002
003200*                                                               * 00330001
003300*---------------------------------------------------------------* 00340001
005400 EJECT                                                            00620001
005500                                                                  00630001
005600 ENVIRONMENT DIVISION.                                            00640001
005700 CONFIGURATION SECTION.                                           00650001
005800 SOURCE-COMPUTER. IBM-3090.                                       00660001
005900 OBJECT-COMPUTER. IBM-3090.                                       00670001
006000                                                                  00680001
006100 INPUT-OUTPUT SECTION.                                            00690001
006200 FILE-CONTROL.                                                    00700001
           SELECT DELETE-FILE                                           00701002
               ASSIGN TO OUT01.                                         00702002
006300                                                                  00710001
006400 DATA DIVISION.                                                   00720001
006500 FILE SECTION.                                                    00730001
                                                                        00730102
010400 FD  DELETE-FILE                                                  00731002
010500     RECORDING MODE IS F.                                         00732002
010600                                                                  00733002
010700 01  DELETE-FILE-RECORD             PIC X(50).                    00734006
                                                                        00740002
006700 WORKING-STORAGE SECTION.                                         00750001
006800                                                                  00760001
006900 01  PV-PROGRAM-VARIABLES.                                        00770001
007000     05  PV-CURRENT-PARAGRAPH        PIC  X(35).                  00780001
007100                                                                  00790001
007200 01  PV-PROGRAM-SWITCHES.                                         00800001
014300     05  PS-END-OF-TADJRNL             PIC X(01)  VALUE 'N'.      00832002
014400         88  PS-END-OF-TADJRNL-YES                VALUE 'Y'.      00833002
014500         88  PS-END-OF-TADJRNL-NO                 VALUE 'N'.      00834002
007600                                                                  00840001
007700 01  PV-PROGRAM-COUNTERS.                                         00850001
007800     05  PV-ADJRNL-COUNT             PIC S9(06) COMP-3 VALUE +0.  00860005
007900     05  PRT-ADJRNL-COUNT            PIC  9(06) VALUE ZERO.       00870001
008000                                                                  00880001
008100 01  PV-PSTG-DELETE-DATE.                                         00890007
008200     05  PV-PSTG-DELETE-YEAR         PIC X(04).                   00900007
008300     05  PV-PSTG-DELETE-MONTH        PIC X(02).                   00910007
008400                                                                  00920001
008100 01  PV-PSTG-DATE.                                                00921007
008200     05  PV-PSTG-YEAR                PIC X(04).                   00922007
008300     05  PV-PSTG-PERIOD              PIC X(02).                   00923007
008400                                                                  00924007
008500 01  DATE-WORK-AREA.                                              00930001
008600     05  PV-CURRENT-DATE             PIC X(08).                   00940001
008700     05  FILLER REDEFINES PV-CURRENT-DATE.                        00950001
008800         10 PV-CURRENT-DATE-YEAR     PIC X(04).                   00960001
008900         10 PV-CURRENT-DATE-MM       PIC X(02).                   00970001
009000         10 PV-CURRENT-DATE-DD       PIC X(02).                   00980001
009100     05  PV-CURRENT-TIME             PIC X(06).                   00990001
009200     05  FILLER REDEFINES PV-CURRENT-TIME.                        01000001
009300         10 PV-CURRENT-TIME-HH       PIC X(02).                   01010001
009400         10 PV-CURRENT-TIME-MM       PIC X(02).                   01020001
009500         10 PV-CURRENT-TIME-SS       PIC X(02).                   01030001
009600     05  DISPLAY-CURRENT-DATE.                                    01040001
009700         10 DISPLAY-DATE-MM          PIC X(02).                   01050001
009800         10 FILLER                   PIC X(01)   VALUE '-'.       01060001
009900         10 DISPLAY-DATE-DD          PIC X(02).                   01070001
010000         10 FILLER                   PIC X(01)   VALUE '-'.       01080001
010100         10 DISPLAY-DATE-YEAR        PIC X(04).                   01090001
010200     05  DISPLAY-CURRENT-TIME.                                    01100001
010300         10 DISPLAY-TIME-HH          PIC X(02).                   01110001
010400         10 FILLER                   PIC X(01)   VALUE ':'.       01120001
010500         10 DISPLAY-TIME-MM          PIC X(02).                   01130001
010600         10 FILLER                   PIC X(01)   VALUE ':'.       01140001
010700         10 DISPLAY-TIME-SS          PIC X(02).                   01150001
010800                                                                  01160001
010900*--------------------------------------------------------------*  01170001
011000*    WORKING STORAGE FOR DATE ROUTINE                             01180001
011100*--------------------------------------------------------------*  01190001
011200     COPY DPWS500.                                                01200001
011300                                                                  01210001
011400*--------------------------------------------------------------*  01220002
011500*    TAPCNTL DCLGEN                                               01230002
011600*--------------------------------------------------------------*  01240002
011700     EXEC SQL                                                     01250002
011800         INCLUDE TAPCNTL                                          01260002
011900     END-EXEC.                                                    01270002
012000 EJECT                                                            01280002
012100                                                                  01290002
012200*--------------------------------------------------------------*  01300001
012300*    TADJRNL DCLGEN                                               01310001
012400*--------------------------------------------------------------*  01320001
012500     EXEC SQL                                                     01330001
012600         INCLUDE TADJRNL                                          01340001
012700     END-EXEC.                                                    01350001
012800 EJECT                                                            01360001
045300******************************************************************01361002
045400*  ADJ_DELETE - CURSOR TO SELECT ROWS TO BE DELETED               01362002
045500******************************************************************01363002
045600     EXEC SQL                                                     01364002
045700          DECLARE ADJ_DELETE CURSOR FOR                           01365002
045800          SELECT PSTG_FYR_NBR,                                    01366002
045900                 PSTG_FMN_NBR,                                    01367002
046000                 VND_NBR,                                         01368002
046100                 DOC_NBR,                                         01369002
046200                 DOC_DTE,                                         01369102
046300                 AP_TRN_CDE                                       01369202
047500            FROM TADJRNL                                          01370402
047700           WHERE PSTG_FYR_NBR = :PV-PSTG-DELETE-YEAR              01370607
047900             AND PSTG_FMN_NBR = :PV-PSTG-DELETE-MONTH             01370707
                 ORDER BY VND_NBR, DOC_NBR, DOC_DTE, AP_TRN_CDE         01371003
049000     END-EXEC.                                                    01371902
012900                                                                  01373001
013000*--------------------------------------------------------------*  01380001
013100*  COMMUNICATIONS AREA2 FOR DB2                                *  01390001
013200*--------------------------------------------------------------*  01400001
013300     COPY SQLCA2.                                                 01410001
013400*--------------------------------------------------------------*  01420001
013500*    SQL COMMUNICATIONS AREA DCLGEN                               01430001
013600*--------------------------------------------------------------*  01440001
013700     EXEC SQL                                                     01450001
013800         INCLUDE SQLCA                                            01460001
013900     END-EXEC.                                                    01470001
014000 EJECT                                                            01480001
014100                                                                  01490001
014200*---------------------------------------------------------------- 01500001
014300*  ABEND DATA AREAS                                               01510001
014400*---------------------------------------------------------------- 01520001
014500 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          01530001
014600                                             COMP SYNC.           01540001
014700     88  AC-DB2-ERROR                        VALUE +4013.         01550001
014800     88  AC-UNSUCCESSFUL-SELECT              VALUE +4015.         01560001
014900     88  AC-DATE-ERROR                       VALUE +4019.         01570001
015000                                                                  01580001
015100                                                                  01590001
015200 01  ABEND-AREAS.                                                 01600001
015300     05  AA-ABEND-LIT            PIC  X(40)  VALUE                01610001
015400             '*****       ABEND'.                                 01620001
015500     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                01630001
015600             '*****   PROGRAM: APKUT049'.                         01640001
015700     05  AA-PARAGRAPH-LIT.                                        01650001
015800         10  FILLER              PIC  X(17)  VALUE                01660001
015900             '***** PARAGRAPH: '.                                 01670001
016000         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        01680001
016100     05  AA-MESSAGE-LINE.                                         01690001
016200         10  FILLER              PIC  X(06)  VALUE '*****'.       01700001
016300         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        01710001
016400     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                01720001
016500             '*****    DB2 ERROR'.                                01730001
016600     05  AA-DB2-OPERATION-LIT.                                    01740001
016700         10  FILLER              PIC  X(17)  VALUE                01750001
016800             '***** OPERATION: '.                                 01760001
016900         10  AA-DB2-OPERATION.                                    01770001
017000             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        01780001
017100             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        01790001
017200     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        01800001
017300     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        01810001
017400     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        01820001
017500                                                                  01830001
010900*--------------------------------------------------------------*  01831002
011000*    FILE LAYOUT FOR OUTPUT RECORD                                01832011
011100*--------------------------------------------------------------*  01833002
011200     COPY APRD560.                                                01834004
011300                                                                  01835002
017600*---------------------------------------------------------------- 01840001
017700*  SQLCA FORMATTED MESSAGE AREA                                   01850001
017800*---------------------------------------------------------------- 01860001
017900     COPY DPWS004.                                                01870001
018000 EJECT                                                            01880001
018100**********************                                            01890001
018200 PROCEDURE DIVISION.                                              01900001
018300**********************                                            01910001
018400 A100-MAINLINE-ROUTINE.                                           01920001
018500                                                                  01930001
018600     PERFORM B100-INITIALIZE.                                     01940001
018700                                                                  01950001
018800     PERFORM B200-PROCESS-TADJRNL.                                01960001
018900                                                                  01970001
019000     PERFORM B300-END-OF-PROGRAM.                                 01980001
019100     GOBACK.                                                      01990001
019200                                                                  02000001
019300 EJECT                                                            02010001
019400*---------------------------------------------------------------- 02020001
019500*    INITIALIZATION PROCESSING.                                   02030001
019600*---------------------------------------------------------------- 02040001
019700 B100-INITIALIZE.                                                 02050001
019800                                                                  02060001
019900     DISPLAY ' '.                                                 02070001
020000     DISPLAY '*****************  APKUT150  *******************'.  02080002
020100     MOVE 'B100-INITIALIZE' TO PV-CURRENT-PARAGRAPH.              02090001
020200                                                                  02100001
020300     MOVE FUNCTION CURRENT-DATE (1:8)  TO PV-CURRENT-DATE.        02110001
020400     MOVE FUNCTION CURRENT-DATE (9:6)  TO PV-CURRENT-TIME.        02120001
020500     MOVE PV-CURRENT-DATE-YEAR  TO DISPLAY-DATE-YEAR.             02130001
020600     MOVE PV-CURRENT-DATE-MM    TO DISPLAY-DATE-MM.               02140001
020700     MOVE PV-CURRENT-DATE-DD    TO DISPLAY-DATE-DD.               02150001
020800     MOVE PV-CURRENT-TIME-HH    TO DISPLAY-TIME-HH.               02160001
020900     MOVE PV-CURRENT-TIME-MM    TO DISPLAY-TIME-MM.               02170001
021000     MOVE PV-CURRENT-TIME-SS    TO DISPLAY-TIME-SS.               02180001
021100                                                                  02190001
022400     DISPLAY 'RUN-DATE = ' DISPLAY-CURRENT-DATE                   02320001
022500          '   RUN-TIME = ' DISPLAY-CURRENT-TIME.                  02330001
022600                                                                  02340001
           OPEN OUTPUT DELETE-FILE.                                     02341005
022700 EJECT                                                            02350001
022800*---------------------------------------------------------------- 02360001
022900*  MAIN PROCESSING: SELECT THE PREVIOUS POSTING YEAR AND PERIOD.  02370001
023000*                   CALCULATE THE PERIOD AND YEAR NEEDED TO DELETE02380001
023100*                        ROWS FROM THE TADJRNL TABLE.             02390001
023200*                   DELETE ROWS FROM TADJRNL.                     02400001
023300*---------------------------------------------------------------- 02410001
023400 B200-PROCESS-TADJRNL.                                            02420001
023500     MOVE 'B100-PROCESS-TADJRNL' TO PV-CURRENT-PARAGRAPH.         02430001
023600                                                                  02440001
023700     PERFORM S100-SELECT-POSTING-DATE.                            02450001
023800     DISPLAY 'APCNTL PREV PSTG YR  ' APCNTL-PREV-PSTG-FYR-NBR     02460001
023900     DISPLAY 'APCNTL PREV PSTG MN  ' APCNTL-PREV-PSTG-FMN-NBR     02470001
024000                                                                  02480001
024100     IF APCNTL-PREV-PSTG-FYR-NBR NUMERIC                          02490001
024200        PERFORM C100-CALC-ADJRNL-DELETE-PRD                       02500001
024300     ELSE                                                         02510001
024400        MOVE PV-CURRENT-PARAGRAPH     TO AA-PARAGRAPH-NAME        02520001
024500        MOVE 'INVALID POSTING YEAR'   TO AA-MESSAGE               02530001
024600        PERFORM Z999-ABEND                                        02540001
024700     END-IF.                                                      02550001
024800                                                                  02560001
025200     PERFORM S300-SELECT-ROWS.                                    02600003
025700                                                                  02650001
025800 EJECT                                                            02660001
025900*---------------------------------------------------------------- 02670001
026000*  END OF PROGRAM - DISPLAYS COUNTERS AND CLOSES FILES.           02680001
026100*---------------------------------------------------------------- 02690001
026200 B300-END-OF-PROGRAM.                                             02700001
026300     MOVE 'B300-END-OF-PROGRAM ' TO PV-CURRENT-PARAGRAPH.         02710001
                                                                        02711005
           CLOSE DELETE-FILE.                                           02712005
                                                                        02713005
026400     DISPLAY ' '.                                                 02720001
027200     DISPLAY 'DELETE YEAR  ' PV-PSTG-DELETE-YEAR.                 02721010
027300     DISPLAY 'DELETE MONTH ' PV-PSTG-DELETE-MONTH.                02722010
026400     DISPLAY ' '.                                                 02723010
026500                                                                  02730001
026600     IF PV-ADJRNL-COUNT > 0                                       02740009
026700        MOVE PV-ADJRNL-COUNT TO PRT-ADJRNL-COUNT                  02750003
026800        DISPLAY 'TADJRNL ROWS TO BE DELETED = ' PRT-ADJRNL-COUNT  02760003
           ELSE                                                         02771003
025500        DISPLAY 'THERE ARE NO ROWS ON TADJRNL TO DELETE'          02773003
027000     END-IF.                                                      02780001
027100                                                                  02790001
027400     DISPLAY ' '.                                                 02820001
027500     DISPLAY '******************************************'.        02830001
027600     DISPLAY '***** PROGRAM APKUT150 ENDS NORMALLY *****'.        02840002
027700     DISPLAY '******************************************'.        02850001
027800                                                                  02860001
027900 EJECT                                                            02870001
028000*---------------------------------------------------------------- 02880001
028100* THIS ROUTINE CALCULATES THE FISCAL PERIOD AND YEAR (39 PERIODS  02890001
028200* PRIOR TO THE PREVIOUS FISCAL PERIOD ON TAPCNTL) THAT WILL BE    02900001
028300* USED TO DELETE ROWS FROM TADJRNL.                               02910001
028400*---------------------------------------------------------------- 02920001
028500 C100-CALC-ADJRNL-DELETE-PRD.                                     02930001
028600     MOVE 'C100-CALC-ADJRNL-DELETE-PRD' TO PV-CURRENT-PARAGRAPH.  02940001
028700                                                                  02950001
028800     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         02960001
028900     SET DPG51-FISCAL-454-CALENDAR                                02970001
029000         DPG51-DECREMENT-DATE                                     02980001
029100         DPG52-LK-DTE-FISC-PRD-CC  TO TRUE.                       02990001
029200     MOVE '039'                   TO DPG51-INCR-DECR-FISCAL-PRD-X.03000001
029300     MOVE APCNTL-PREV-PSTG-FYR-NBR TO PV-PSTG-YEAR.               03010001
029400     MOVE APCNTL-PREV-PSTG-FMN-NBR TO PV-PSTG-PERIOD.             03020001
029500     MOVE PV-PSTG-DATE             TO DPG52-LK-DATE-INPUT.        03030001
029600                                                                  03040001
029700******************************************************************03050001
029800*    CALLS THE DATE ROUTINE MODULE.                              *03060001
029900******************************************************************03070001
030000                                                                  03080001
030100     CALL DP500-KOHLS-CALENDAR-ROUTINE                            03090001
030200         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               03100001
030300                                                                  03110001
030400     IF DPG54-NO-ERROR                                            03120001
030500        MOVE DPG56-FISCAL-YEAR-CCYY-X  TO PV-PSTG-DELETE-YEAR     03130007
030600        MOVE DPG56-FISCAL-PERIOD-NBR-X TO PV-PSTG-DELETE-MONTH    03140007
030700     ELSE                                                         03150001
030800        MOVE PV-CURRENT-PARAGRAPH  TO AA-PARAGRAPH-NAME           03160001
030900        MOVE 'BAD DATE CONVERSION FOR PREVIOUS FISCAL PERIOD'     03170001
031000                                   TO AA-MESSAGE                  03180001
031100        SET AC-DATE-ERROR          TO TRUE                        03190001
031200        PERFORM Z999-ABEND                                        03200001
031300     END-IF.                                                      03210001
031400                                                                  03220001
031500 EJECT                                                            03230001
031600*---------------------------------------------------------------- 03240001
031700* SELECTS THE POSTING DATE FOR THE MONTH BEING CLOSED FROM        03250001
031800* THE APCNTL TABLE.                                               03260001
031900*---------------------------------------------------------------- 03270001
032000 S100-SELECT-POSTING-DATE.                                        03280001
032100     MOVE 'S100-SELECT-POSTING-DATE' TO PV-CURRENT-PARAGRAPH.     03290001
032200                                                                  03300001
032300     EXEC SQL                                                     03310001
032400         SELECT PREV_PSTG_FYR_NBR                                 03320001
032500              , PREV_PSTG_FMN_NBR                                 03330001
032600           INTO :APCNTL-PREV-PSTG-FYR-NBR                         03340001
032700              , :APCNTL-PREV-PSTG-FMN-NBR                         03350001
032800           FROM TAPCNTL                                           03360001
032900     END-EXEC.                                                    03370001
033000                                                                  03380001
033100     EVALUATE TRUE                                                03390001
033200         WHEN SQLCODE = ZERO                                      03400001
033300              CONTINUE                                            03410001
033400         WHEN OTHER                                               03420001
033500             SET AC-UNSUCCESSFUL-SELECT TO TRUE                   03430001
033600             MOVE PV-CURRENT-PARAGRAPH  TO AA-PARAGRAPH-NAME      03440001
033700             MOVE 'UNSUCCESSFUL SELECT' TO AA-DB2-OPERATION       03450001
033800             MOVE 'TAPCNTL'             TO AA-DB2-TABLE-1         03460001
033900             MOVE SPACES                TO AA-DB2-TABLE-2         03470001
034000             MOVE SPACES                TO AA-DB2-TABLE-3         03480001
034100             PERFORM Z998-DB2-ABEND                               03490001
034200     END-EVALUATE.                                                03500001
034300                                                                  03510001
034400 EJECT                                                            03520001
034500*---------------------------------------------------------------- 03841002
034600* PROCESS THE CURSOR TO CREATE A FILE OF THE ROWS TO BE DELETED   03842003
034700*---------------------------------------------------------------- 03843002
034800 S300-SELECT-ROWS.                                                03844002
032100     MOVE 'S300-SELECT-ROWS' TO PV-CURRENT-PARAGRAPH.             03845002
                                                                        03846002
064800     PERFORM T100-OPEN-CURSOR.                                    03850002
064900                                                                  03860002
065000     PERFORM T200-FETCH-CURSOR.                                   03870002
065100                                                                  03880002
065200     PERFORM T300-PROCESS-CURSOR                                  03890002
065300        UNTIL PS-END-OF-TADJRNL-YES.                              03900002
065400                                                                  03910002
065500     PERFORM T400-CLOSE-CURSOR.                                   03920002
065600                                                                  03930002
074800******************************************************************03940002
074900 T100-OPEN-CURSOR.                                                03950002
075000******************************************************************03960002
032100     MOVE 'T100-OPEN-CURSOR' TO PV-CURRENT-PARAGRAPH.             03961002
075100                                                                  03970002
075200     EXEC SQL                                                     03980002
075300          OPEN ADJ_DELETE                                         03990002
075400     END-EXEC.                                                    04000002
075500                                                                  04010002
075600     IF NOT SQLCODE = ZERO                                        04020002
036700          SET AC-DB2-ERROR TO TRUE                                04051002
036800          MOVE PV-CURRENT-PARAGRAPH  TO AA-PARAGRAPH-NAME         04052002
036900          MOVE 'UNSUCCESSFUL CSR OPEN ' TO AA-DB2-OPERATION       04053002
037000          MOVE 'TADJRNL'             TO AA-DB2-TABLE-1            04054002
037100          MOVE SPACES                TO AA-DB2-TABLE-2            04055002
037200          MOVE SPACES                TO AA-DB2-TABLE-3            04056002
037300          PERFORM Z998-DB2-ABEND                                  04057002
076000     END-IF.                                                      04060002
076100                                                                  04070002
076200******************************************************************04080002
076300 T200-FETCH-CURSOR.                                               04090002
076400******************************************************************04091002
032100     MOVE 'T200-FETCH-CURSOR' TO PV-CURRENT-PARAGRAPH.            04091102
076500                                                                  04092002
076600     EXEC SQL                                                     04093002
076700          FETCH ADJ_DELETE                                        04094002
076800           INTO :ADJRNL-PSTG-FYR-NBR,                             04095002
076900                :ADJRNL-PSTG-FMN-NBR,                             04096002
077000                :ADJRNL-VND-NBR,                                  04097002
077100                :ADJRNL-DOC-NBR,                                  04098002
078500                :ADJRNL-DOC-DTE,                                  04100302
078600                :ADJRNL-AP-TRN-CDE                                04100402
           END-EXEC.                                                    04100502
                                                                        04100602
078700     EVALUATE TRUE                                                04100702
078800        WHEN SQLCODE = ZERO                                       04100802
078900             CONTINUE                                             04100902
079000        WHEN SQLCODE = +100                                       04101005
079100             SET PS-END-OF-TADJRNL-YES       TO TRUE              04101102
079200        WHEN OTHER                                                04101202
036700          SET AC-DB2-ERROR TO TRUE                                04101302
036800          MOVE PV-CURRENT-PARAGRAPH  TO AA-PARAGRAPH-NAME         04101402
036900          MOVE 'UNSUCCESSFUL CSR FETCH ' TO AA-DB2-OPERATION      04101502
037000          MOVE 'TADJRNL'             TO AA-DB2-TABLE-1            04101602
037100          MOVE SPACES                TO AA-DB2-TABLE-2            04101702
037200          MOVE SPACES                TO AA-DB2-TABLE-3            04101802
037300          PERFORM Z998-DB2-ABEND                                  04101902
079600     END-EVALUATE.                                                04102102
079700                                                                  04102202
099000******************************************************************04102302
099100 T300-PROCESS-CURSOR.                                             04102402
099200******************************************************************04102502
032100     MOVE 'T300-PROCESS-CURSOR' TO PV-CURRENT-PARAGRAPH.          04102602
                                                                        04102702
           ADD 1 TO PV-ADJRNL-COUNT.                                    04102803
                                                                        04102903
           MOVE SPACES              TO AP560-TADJRNL-RECORD.            04103004
           MOVE ADJRNL-PSTG-FYR-NBR TO AP560-PSTG-FYR-NBR               04103104
           MOVE ADJRNL-PSTG-FMN-NBR TO AP560-PSTG-FMN-NBR               04103204
           MOVE ADJRNL-VND-NBR      TO AP560-VND-NBR                    04103304
           MOVE ADJRNL-DOC-NBR      TO AP560-DOC-NBR                    04103404
           MOVE ADJRNL-DOC-DTE      TO AP560-DOC-DTE                    04103504
           MOVE ADJRNL-AP-TRN-CDE   TO AP560-AP-TRN-CDE                 04103604
                                                                        04103702
           WRITE DELETE-FILE-RECORD                                     04103802
               FROM AP560-TADJRNL-RECORD.                               04103904
101000                                                                  04105402
101100     PERFORM T200-FETCH-CURSOR.                                   04105502
101200                                                                  04105602
097600******************************************************************04105702
097700 T400-CLOSE-CURSOR.                                               04105802
097800******************************************************************04105902
032100     MOVE 'T400-CLOSE-CURSOR' TO PV-CURRENT-PARAGRAPH.            04106002
097900                                                                  04106102
098000     EXEC SQL                                                     04106202
098100          CLOSE ADJ_DELETE                                        04106302
098200     END-EXEC.                                                    04106402
098300                                                                  04106502
098400     IF NOT SQLCODE = ZERO                                        04106602
036700          SET AC-DB2-ERROR TO TRUE                                04106702
036800          MOVE PV-CURRENT-PARAGRAPH  TO AA-PARAGRAPH-NAME         04106802
036900          MOVE 'UNSUCCESSFUL CSR CLOSE ' TO AA-DB2-OPERATION      04106902
037000          MOVE 'TADJRNL'             TO AA-DB2-TABLE-1            04107002
037100          MOVE SPACES                TO AA-DB2-TABLE-2            04107102
037200          MOVE SPACES                TO AA-DB2-TABLE-3            04107202
037300          PERFORM Z998-DB2-ABEND                                  04107302
098800     END-IF.                                                      04107402
098900                                                                  04107502
040200*---------------------------------------------------------------- 04108001
040300*    ABEND ROUTINE FOR DB2 ERRORS.                                04110001
040400*---------------------------------------------------------------- 04120001
040500 Z998-DB2-ABEND.                                                  04130001
040600                                                                  04140001
040700     DISPLAY AA-ABEND-LIT.                                        04150001
040800     DISPLAY AA-DB2-ERROR-LIT.                                    04160001
040900     DISPLAY AA-PROGRAM-LIT.                                      04170001
041000     DISPLAY AA-PARAGRAPH-LIT.                                    04180001
041100     DISPLAY AA-DB2-OPERATION-LIT.                                04190001
041200     DISPLAY AA-DB2-TABLE-1.                                      04200001
041300     DISPLAY AA-DB2-TABLE-2.                                      04210001
041400     DISPLAY AA-DB2-TABLE-3.                                      04220001
041500     SET AC-DB2-ERROR TO TRUE.                                    04230001
041600                                                                  04240001
041700     COPY DPPD004.                                                04250001
041800                                                                  04260001
041900     CALL 'ILBOABN0' USING ABEND-CODE.                            04270001
042000                                                                  04280001
042100*---------------------------------------------------------------  04290001
042200*     ABEND ROUTINE                                               04300001
042300*---------------------------------------------------------------  04310001
042400 Z999-ABEND.                                                      04320001
042500     DISPLAY AA-ABEND-LIT.                                        04330001
042600     DISPLAY AA-PROGRAM-LIT.                                      04340001
042700     DISPLAY AA-PARAGRAPH-LIT.                                    04350001
042800     DISPLAY AA-MESSAGE-LINE.                                     04360001
042900     CALL 'ILBOABN0' USING ABEND-CODE.                            04370001
043000                                                                  04380001
