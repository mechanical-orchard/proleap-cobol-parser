000100 TITLE 'LABOR SYSTEM - APPLY INDIRECT CODES'.                     00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300                                                                  00030000
000400 PROGRAM-ID.             DLKRF455.                                00040000
000500 AUTHOR.                 DENNIS STEFFEN.                          00050000
000600 INSTALLATION.           KOHLS.                                   00060000
000700 DATE-WRITTEN.           FEBRUARY 2004.                           00070000
000800 DATE-COMPILED.                                                   00080000
000900 ENVIRONMENT DIVISION.                                            00090000
001000 DATA DIVISION.                                                   00100000
001100                                                                  00110000
001200 WORKING-STORAGE SECTION.                                         00120000
001300*                                                                 00130000
001400 01  PC-PROGRAM-CONSTANTS.                                        00140000
001500     05  PC-TRANID                    PIC  X(04)  VALUE 'D455'.   00150000
001600     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'DLKRF455'. 00160000
001700                                                                  00170000
001800* ERROR MESSAGES                                                  00180000
001900     05  PC-UNRECOGNIZED-PF-KEY-MSG   PIC X(19) VALUE             00190000
002000         'UNRECOGNIZED PF KEY'.                                   00200000
002100     05  PC-ENTER-THROUGH-MENU-MSG    PIC X(19) VALUE             00210000
002200         'ENTER THROUGH MENU '.                                   00220000
002300     05  PC-TRANS-UNAVAILABLE-MSG     PIC X(19) VALUE             00230000
002400         'TRANS NOT AVAILABLE'.                                   00240000
002500     05  PC-INVALID-SELECTION-MSG     PIC X(19)  VALUE            00250000
002600         'INVALID SELECTION  '.                                   00260000
002700     05  PC-NON-NUMERIC-SELECTION-MSG PIC X(19)  VALUE            00270000
002800         'NUMERIC VALUE REQ. '.                                   00280000
002900                                                                  00290000
003000 01  PS-PROGRAM-SWITCHES.                                         00300000
003100     05  PS-ERROR-SW                  PIC  X(01)  VALUE 'N'.      00310000
003200         88  PS-ERRORS-YES                        VALUE 'Y'.      00320000
003300         88  PS-ERRORS-NO                         VALUE 'N'.      00330000
003400     05  PS-TEAM-CSR-SW               PIC X(01) VALUE 'N'.        00340000
003500         88  PS-END-TEAM-CSR-NO                 VALUE 'N'.        00350000
003600         88  PS-END-TEAM-CSR-YES                VALUE 'Y'.        00360000
003700     05  PS-SCREEN-FULL-SW            PIC X(01) VALUE 'N'.        00370000
003800         88  PS-SCREEN-FULL-YES                 VALUE 'Y'.        00380000
003900         88  PS-SCREEN-FULL-NO                  VALUE 'N'.        00390000
004000     05  PS-BROWSE-SW                 PIC X(01) VALUE 'F'.        00400000
004100         88  PS-BROWSE-FWD                      VALUE 'F'.        00410000
004200         88  PS-BROWSE-BKWD                     VALUE 'B'.        00420000
004300     05  PS-SEARCH-SW                 PIC X(01) VALUE 'N'.        00430000
004400         88  PS-NOT-FOUND                       VALUE 'N'.        00440000
004500         88  PS-IS-FOUND                        VALUE 'Y'.        00450000
004600     05  PS-PROCESS-METHOD-SW         PIC X(01) VALUE 'N'.        00460000
004700         88  PS-CONFIRM                         VALUE 'C'.        00470000
004800         88  PS-TEAM-PROMPT                     VALUE 'T'.        00480000
004900         88  PS-NO-FLAGS                        VALUE 'N'.        00490000
005000                                                                  00500000
005100 01  DN-NULL-INDICATORS.                                          00510000
005200     05  DN-KOHLS-NULL-IND            PIC S9(04)  VALUE ZERO      00520000
005300                                                     COMP SYNC.   00530000
005400     05  DN-TEMP-NULL-IND             PIC S9(04)  VALUE ZERO      00540000
005500                                                     COMP SYNC.   00550000
005600 01  PV-PROGRAM-VARIABLES.                                        00560000
005700                                                                  00570000
005800     05  PV-CODE-SUB                  PIC S9(03) COMP-3           00580000
005900                                               VALUE ZERO.        00590000
006000     05  PV-PAGE-SUB                  PIC S9(03) COMP-3           00600000
006100                                               VALUE ZERO.        00610000
006200     05  PV-LINE-SUB                  PIC S9(03) COMP-3           00620000
006300                                               VALUE ZERO.        00630000
006400     05  PV-TEAM-COUNT                PIC S9(05) COMP-3           00640000
006500                                               VALUE ZERO.        00650000
006600                                                                  00660000
006700     05  PV-DISP-NBR                  PIC 9(09) VALUE ZERO.       00670000
006800     05  PV-UNSTRING-COUNT            PIC S9(03) COMP-3.          00680000
006900     05  PV-POINTER                   PIC S9(03) COMP-3.          00690000
007000     05  PV-TALLY                     PIC S9(03) COMP-3.          00700000
007100     05  PV-TOT-QTY                   PIC S9(7) COMP-3.           00710000
007200                                                                  00720000
007300     05  PV-COMMAREA-LENGTH           PIC S9(04)  VALUE +0        00730000
007400                                                     COMP SYNC.   00740000
007500     05  PV-MESSAGE-AREA              PIC  X(19)  VALUE SPACE.    00750000
007600     05  PV-CICS-RESPONSE             PIC S9(09)  VALUE ZEROS     00760000
007700                                                     COMP SYNC.   00770000
007800     05  PV-TRANSFER-PROGRAM          PIC  X(08)  VALUE SPACE.    00780000
007900     05  PV-USERID                    PIC X(08) VALUE SPACES.     00790000
008000     05  PV-TEM-ASGMT-SEQ-NBR         PIC S9(09) COMP VALUE ZERO. 00800000
008100     05  PV-USER-TYPE                 PIC X(01) VALUE SPACES.     00810000
008200     05  PV-DUMMY-USERID              PIC X(08) VALUE SPACES.     00820000
008300     05  PV-TMST                      PIC X(26) VALUE SPACES.     00830000
008400     05  PV-LABOR-CURRENT-TIMESTAMP   PIC  X(26).                 00840000
008500     05  PV-HOLD-TIMESTAMP            PIC  X(26).                 00850000
008600     05  PV-DISPLAY-SQLCODE           PIC  9(04)  VALUE ZERO.     00860000
008700     05  PV-DISPLAY-ASGMT-NBR         PIC  9(09)  VALUE ZERO.     00870000
008800     05  PV-DISPLAY-TEM-ASGMT-NBR     PIC  9(09)  VALUE ZERO.     00880000
008900                                                                  00890000
009000 01  PV-LOG-MSG.                                                  00900000
009100     05  FILLER                       PIC X(12) VALUE             00910000
009200         ' D455 ERROR '.                                          00920000
009300     05  FILLER                       PIC X(06) VALUE             00930000
009400         'USER= '.                                                00940000
009500     05  PV-LOG-USER-ID               PIC X(08) VALUE SPACES.     00950000
009600     05  FILLER                       PIC X(10) VALUE             00960000
009700         ' SQLCODE= '.                                            00970000
009800     05  PV-SQLCODE                   PIC -9(03).                 00980000
009900     05  FILLER                       PIC X(06) VALUE             00990000
010000         ' ERR= '.                                                01000000
010100     05  PV-ERROR-NBR                 PIC 9(03) VALUE ZERO.       01010000
010200                                                                  01020000
010300* COMMAREA FOR DLKRF SCREENS                                      01030000
010400     COPY DLWS010.                                                01040000
010500* FULL SCREEN MESSAGES                                            01050000
010600     COPY DLWS012.                                                01060000
010700                                                                  01070000
010800* COMMAREA FOR XLKUT067                                           01080000
010900     COPY XLWS067.                                                01090000
011000                                                                  01100000
011100* COMMAREA FOR XLKUP003                                           01110000
011200     COPY XLWS072.                                                01120000
011300                                                                  01130000
011400* COMMAREA FOR DLKUT001                                           01140000
011500     COPY DLWS003.                                                01150000
011600                                                                  01160000
011700* COMMAREA FOR DLKUP002                                           01170000
011800     COPY DLWS005.                                                01180000
011900                                                                  01190000
012000* COMMAREA FOR DLKUP003                                           01200000
012100     COPY DLWS007.                                                01210000
012200                                                                  01220000
012300*    DLKCS410 COMMAREA                                            01230000
012400*    COPY DLWS016.                                                01240000
012500                                                                  01250000
012600*  MAP LAYOUT                                                     01260000
012700     COPY DLKM455.                                                01270000
012800 01  PV-CODES-TABLE.                                              01280000
012900     05  PV-CODE OCCURS 3 TIMES.                                  01290000
013000         10  PV-CODE-NBR              PIC 9(01).                  01300000
013100         10  PV-CODE-DESC             PIC X(015).                 01310000
013200                                                                  01320000
013300* HELP SCREEN COMMAREA                                            01330000
013400     COPY PCWS192.                                                01340000
013500* HELP SCREEN WORK AREA                                           01350000
013600     COPY PCWS188.                                                01360000
013700                                                                  01370000
013800*  NUMERIC EDITS                                                  01380000
013900     COPY DPWS010I.                                               01390000
014000*                                                                 01400000
014100*  KOHL'S STANDARD ATTRIBUTES                                     01410000
014200     COPY DPWS015.                                                01420000
014300                                                                  01430000
014400*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      01440000
014500     COPY DFHAID.                                                 01450000
014600                                                                  01460000
014700*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               01470000
014800     COPY DPWS013.                                                01480000
014900                                                                  01490000
015000*    DLT_TEM_ASGMT                                                01500000
015100     EXEC SQL                                                     01510000
015200         INCLUDE DLT00003                                         01520000
015300     END-EXEC                                                     01530000
015400                                                                  01540000
015500     EXEC SQL                                                     01550000
015600         INCLUDE TKRPRPM                                          01560000
015700     END-EXEC                                                     01570000
015800                                                                  01580000
015900*    USED FOR INITIAL SCREEN AND SCROLLING FORWARDS               01590000
016000     EXEC SQL                                                     01600000
016100         DECLARE TEAM-CSR CURSOR WITH HOLD FOR                    01610000
016200         SELECT                                                   01620000
016300             KOHLS_USR_ID                                         01630000
016400        ,    TMP_USR_ID                                           01640000
016500        ,    TEM_ASGMT_SEQ_NBR                                    01650000
016600         FROM                                                     01660000
016700             DLT_TEM_ASGMT                                        01670000
016800         WHERE                                                    01680000
016900             ASGMT_STRT_DTE     = :DL010-ASGMT-STRT-DTE           01690000
017000         AND ASGMT_NBR_TXT      = :DL010-ASGMT-NBR-TXT            01700000
017100         AND ASGMT_NBR_SEQ_NBR  = :DL010-ASGMT-NBR-SEQ-NBR        01710000
017200         AND LVE_RSN_CDE        = 'N'                             01720000
017300         WITH UR                                                  01730000
017400     END-EXEC                                                     01740000
017500                                                                  01750000
017600     EXEC SQL                                                     01760000
017700         INCLUDE SQLCA                                            01770000
017800     END-EXEC.                                                    01780000
017900                                                                  01790000
018000 LINKAGE SECTION.                                                 01800000
018100 01  DFHCOMMAREA.                                                 01810000
018200     05  FILLER                         OCCURS  1 TO 4072 TIMES   01820000
018300                                      DEPENDING ON EIBCALEN.      01830000
018400         10  FILLER                   PIC X.                      01840000
018500/                                                                 01850000
018600 PROCEDURE DIVISION.                                              01860000
018700 0000-PROGRAM-MAINLINE.                                           01870000
018800                                                                  01880000
018900     INITIALIZE DL010-COMMAREA                                    01890000
019000     MOVE DFHCOMMAREA                 TO DL010-COMMAREA           01900000
019100                                                                  01910000
019200     EVALUATE TRUE                                                01920000
019300         WHEN EIBCALEN = ZERO                                     01930000
019400             MOVE PC-ENTER-THROUGH-MENU-MSG                       01940000
019500                                      TO PV-MESSAGE-AREA          01950000
019600             PERFORM 8110-RETURN                                  01960000
019700                                                                  01970000
019800         WHEN EIBTRNID = 'Z278'                                   01980000
019900             MOVE DFHCOMMAREA         TO PC192-COMMAREA           01990000
020000             MOVE PC192-HOST-SAVE-AREA                            02000000
020100                                      TO DL010-COMMAREA           02010000
020200             SET DL010-PROCESS-SCREEN TO TRUE                     02020000
020300             MOVE PC192-HOST-SAVE-MAP TO DL455AO                  02030000
020400             PERFORM 8000-SEND-MAP                                02040000
020500             PERFORM 8100-RETURN-TRANID                           02050000
020600                                                                  02060000
020700         WHEN DL010-INITIALIZE-SCREEN                             02070000
020800         WHEN EIBAID = DFHCLEAR                                   02080000
020900             SET DL010-PROCESS-SCREEN TO TRUE                     02090000
021000             SET DL010-FORCE-F3-NO    TO TRUE                     02100000
021100             PERFORM 1000-INITIALIZE                              02110000
021200                                                                  02120000
021300             PERFORM 8000-SEND-MAP                                02130000
021400             PERFORM 8100-RETURN-TRANID                           02140000
021500                                                                  02150000
021600         WHEN DL010-FORCE-F3                                      02160000
021700             IF EIBAID = DFHPF3                                   02170000
021800                 PERFORM 8020-RECEIVE-MAP                         02180000
021900                 SET DL010-INITIALIZE-SCREEN                      02190000
022000                                      TO TRUE                     02200000
022100                 MOVE DL010-LAST-PROGRAM  TO PV-TRANSFER-PROGRAM  02210000
022200                 PERFORM 8200-XCTL                                02220000
022300             END-IF                                               02230000
022400             IF EIBAID = DFHPF1                                   02240000
022500                 PERFORM 8020-RECEIVE-MAP                         02250000
022600                 MOVE DL455AO             TO PC192-HOST-SAVE-MAP  02260000
022700                 PERFORM 1200-HELP-SCREEN                         02270000
022800             ELSE                                                 02280000
022900                 PERFORM 8020-RECEIVE-MAP                         02290000
023000                 MOVE 'MUST USE F3 - CONT'                        02300000
023100                                         TO AMSGLNO               02310000
023200                 MOVE DL010-CODE-DESC                             02320000
023300                                 (DL010-PAGE-SUB, DL010-LINE-SUB) 02330000
023400                                         TO ACODEO                02340000
023500                 MOVE DL010-KEYED-USERID TO AUSERO                02350000
023600                 MOVE PC-TRANID          TO DL010-TRAN-ID         02360000
023700                 PERFORM 8000-SEND-MAP                            02370000
023800                 PERFORM 8100-RETURN-TRANID                       02380000
023900             END-IF                                               02390000
024000                                                                  02400000
024100         WHEN EIBAID = DFHPF2                                     02410000
024200             IF DL010-WAIT-FOR-CONFIRM                            02420000
024300                 PERFORM 8020-RECEIVE-MAP                         02430000
024400                 IF DL010-INDIRECT-ALL                            02440000
024500                     PERFORM 3000-PROCESS-ALL-MEMBERS             02450000
024600                 ELSE                                             02460000
024700                     PERFORM 1500-EDIT-SELECTION                  02470000
024800                     PERFORM 4000-PROCESS-ONE-MEMBER              02480000
024900                 END-IF                                           02490000
025000                 IF PS-ERRORS-NO                                  02500000
025100                                                                  02510000
025200                     PERFORM 7100-COUNT-TEAM-MEMBERS              02520000
025300                     MOVE PV-TEAM-COUNT  TO ATMCNTO               02530000
025400                                                                  02540000
025500                     SET DL010-UPDATE-CONFIRMED                   02550000
025600                                      TO TRUE                     02560000
025700                     MOVE 'SUCCESSFUL'                            02570000
025800                                      TO AMSGLNO                  02580000
025900                     SET DL010-FORCE-F3 TO TRUE                   02590000
026000                     PERFORM 8000-SEND-MAP                        02600000
026100                     PERFORM 8100-RETURN-TRANID                   02610000
026200                 ELSE                                             02620000
026300                     PERFORM 8000-SEND-MAP                        02630000
026400                     PERFORM 8100-RETURN-TRANID                   02640000
026500             ELSE                                                 02650000
026600                 PERFORM 8020-RECEIVE-MAP                         02660000
026700                 MOVE PC-UNRECOGNIZED-PF-KEY-MSG                  02670000
026800                                      TO AMSGLNO                  02680000
026900                 PERFORM 8000-SEND-MAP                            02690000
027000                 PERFORM 8100-RETURN-TRANID                       02700000
027100             END-IF                                               02710000
027200                                                                  02720000
027300         WHEN EIBAID = DFHPF3                                     02730000
027400             SET DL010-INITIALIZE-SCREEN                          02740000
027500                                      TO TRUE                     02750000
027600             MOVE DL010-LAST-PROGRAM  TO PV-TRANSFER-PROGRAM      02760000
027700             PERFORM 8200-XCTL                                    02770000
027800                                                                  02780000
027900         WHEN EIBAID = DFHPF4                                     02790000
028000*            PROCESS ALL TEAM MEMBERS                             02800000
028100                                                                  02810000
028200             PERFORM 8020-RECEIVE-MAP                             02820000
028300             IF DL010-CONFIRM-SW                                  02830000
028400                        (DL010-PAGE-SUB, DL010-LINE-SUB) = 'Y'    02840000
028500                 SET DL010-WAIT-FOR-CONFIRM                       02850000
028600                     DL010-INDIRECT-ALL                           02860000
028700                                      TO TRUE                     02870000
028800                 MOVE '    F2-CONFIRM     '                       02880000
028900                                      TO AMSGLNO                  02890000
029000             ELSE                                                 02900000
029100                 PERFORM 3000-PROCESS-ALL-MEMBERS                 02910000
029200                                                                  02920000
029300                 IF PS-ERRORS-NO                                  02930000
029400                     PERFORM 7100-COUNT-TEAM-MEMBERS              02940000
029500                     MOVE PV-TEAM-COUNT   TO ATMCNTO              02950000
029600                                                                  02960000
029700                     MOVE 'SUCCESSFUL'                            02970000
029800                                      TO AMSGLNO                  02980000
029900                     SET DL010-FORCE-F3 TO TRUE                   02990000
030000                 END-IF                                           03000000
030100             END-IF                                               03010000
030200                                                                  03020000
030300             PERFORM 8000-SEND-MAP                                03030000
030400             PERFORM 8100-RETURN-TRANID                           03040000
030500                                                                  03050000
030600         WHEN EIBAID = DFHPF5                                     03060000
030700*            PROCESS ONE TEAM MEMBER                              03070000
030800                                                                  03080000
030900             PERFORM 8020-RECEIVE-MAP                             03090000
031000             IF DL010-CONFIRM-SW                                  03100000
031100                        (DL010-PAGE-SUB, DL010-LINE-SUB) = 'Y'    03110000
031200                 SET DL010-WAIT-FOR-CONFIRM                       03120000
031300                     DL010-INDIRECT-ONE                           03130000
031400                                      TO TRUE                     03140000
031500                 MOVE '    F2-CONFIRM     '                       03150000
031600                                      TO AMSGLNO                  03160000
031700             ELSE                                                 03170000
031800                 PERFORM 1500-EDIT-SELECTION                      03180000
031900                 IF PS-ERRORS-NO                                  03190000
032000                     PERFORM 4000-PROCESS-ONE-MEMBER              03200000
032100                     IF PS-ERRORS-NO                              03210000
032200                         MOVE 'SUCCESSFUL'                        03220000
032300                                          TO AMSGLNO              03230000
032400                         SET DL010-FORCE-F3 TO TRUE               03240000
032500                     END-IF                                       03250000
032600                 END-IF                                           03260000
032700             END-IF                                               03270000
032800                                                                  03280000
032900             PERFORM 8000-SEND-MAP                                03290000
033000             PERFORM 8100-RETURN-TRANID                           03300000
033100                                                                  03310000
033200         WHEN EIBAID = DFHENTER                                   03320000
033300*                                                                 03330000
033400             PERFORM 8020-RECEIVE-MAP                             03340000
033500             PERFORM 1500-EDIT-SELECTION                          03350000
033600             IF PS-ERRORS-NO                                      03360000
033700                 PERFORM 8000-SEND-MAP                            03370000
033800                 PERFORM 8100-RETURN-TRANID                       03380000
033900                                                                  03390000
034000             ELSE                                                 03400000
034100                 PERFORM 8010-SEND-DATA-ONLY                      03410000
034200                 PERFORM 8100-RETURN-TRANID                       03420000
034300             END-IF                                               03430000
034400                                                                  03440000
034500         WHEN EIBAID = DFHPF1                                     03450000
034600             PERFORM 8020-RECEIVE-MAP                             03460000
034700             MOVE DL455AO             TO PC192-HOST-SAVE-MAP      03470000
034800             PERFORM 1200-HELP-SCREEN                             03480000
034900                                                                  03490000
035000         WHEN OTHER                                               03500000
035100             PERFORM 8020-RECEIVE-MAP                             03510000
035200             MOVE PC-UNRECOGNIZED-PF-KEY-MSG                      03520000
035300                                      TO AMSGLNO                  03530000
035400             PERFORM 8000-SEND-MAP                                03540000
035500             PERFORM 8100-RETURN-TRANID                           03550000
035600     END-EVALUATE.                                                03560000
035700                                                                  03570000
035800     GOBACK.                                                      03580000
035900                                                                  03590000
036000 1000-INITIALIZE.                                                 03600000
036100                                                                  03610000
036200     MOVE DL010-CODE-DESC (DL010-PAGE-SUB, DL010-LINE-SUB)        03620000
036300                                      TO ACODEO                   03630000
036400     MOVE DL010-KEYED-USERID          TO AUSERO                   03640000
036500                                                                  03650000
036600     MOVE PC-TRANID                   TO DL010-TRAN-ID            03660000
036700                                                                  03670000
036800     PERFORM 7100-COUNT-TEAM-MEMBERS.                             03680000
036900     MOVE PV-TEAM-COUNT               TO ATMCNTO.                 03690000
037000                                                                  03700000
037100 1200-HELP-SCREEN.                                                03710000
037200     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      03720000
037300     MOVE 'DLKRF455'                  TO PC192-PROGRAM-NAME       03730000
037400     COPY PCPD188.                                                03740000
037500     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      03750000
037600     MOVE DL010-COMMAREA              TO PC192-HOST-SAVE-AREA     03760000
037700     PERFORM 8220-XCTL-TO-HELP.                                   03770000
037800                                                                  03780000
037900 1500-EDIT-SELECTION.                                             03790000
038000     MOVE SPACES                      TO AMSGLNO                  03800000
038100     PERFORM 1501-EDIT-USER.                                      03810000
038200                                                                  03820000
038300 1501-EDIT-USER.                                                  03830000
038400     IF AUSERL > ZERO                                             03840000
038500         MOVE AUSERI                  TO DL010-KEYED-USERID       03850000
038600     ELSE                                                         03860000
038700         MOVE SPACES                  TO DL010-KEYED-USERID       03870000
038800         SET PS-ERRORS-YES            TO TRUE                     03880000
038900     END-IF.                                                      03890000
039000                                                                  03900000
039100     IF PS-ERRORS-NO                                              03910000
039200         PERFORM 8600-CALL-XLKUT067                               03920000
039300         EVALUATE TRUE                                            03930000
039400         WHEN XL067-SUCCESSFUL AND NOT XL067-USER-NOT-FOUND       03940000
039500             PERFORM 7050-DUMMY-USERID                            03950000
039600             IF DL010-KEYED-USERID = PV-DUMMY-USERID              03960000
039700                 SET PS-ERRORS-YES    TO TRUE                     03970000
039800                 MOVE 'INVALID ENTRY' TO AMSGLNO                  03980000
039900                 MOVE -1              TO AUSERL                   03990000
040000             END-IF                                               04000000
040100                                                                  04010000
040200         WHEN XL067-USER-NOT-FOUND                                04020000
040300             SET PS-ERRORS-YES        TO TRUE                     04030000
040400             MOVE 'INVALID ENTRY'     TO AMSGLNO                  04040000
040500             MOVE -1                  TO AUSERL                   04050000
040600             PERFORM 8010-SEND-DATA-ONLY                          04060000
040700             PERFORM 8100-RETURN-TRANID                           04070000
040800                                                                  04080000
040900         END-EVALUATE                                             04090000
041000     END-IF.                                                      04100000
041100                                                                  04110000
041200 3000-PROCESS-ALL-MEMBERS.                                        04120000
041300     PERFORM 7000-OPEN-TEAM-CSR                                   04130000
041400     PERFORM 7010-FETCH-TEAM-CSR                                  04140000
041500                                                                  04150000
041600     PERFORM UNTIL PS-END-TEAM-CSR-YES                            04160000
041700                 OR PS-ERRORS-YES                                 04170000
041800         IF DN-TEMP-NULL-IND = -1                                 04180000
041900             MOVE 'K'                 TO PV-USER-TYPE             04190000
042000             MOVE DLT00003-KOHLS-USR-ID                           04200000
042100                                      TO PV-USERID                04210000
042200         ELSE                                                     04220000
042300             MOVE 'T'                 TO PV-USER-TYPE             04230000
042400             MOVE DLT00003-TMP-USR-ID TO PV-USERID                04240000
042500         END-IF                                                   04250000
042600                                                                  04260000
042700         PERFORM 5000-PUNCH-OUT                                   04270000
042800                                                                  04280000
042900         PERFORM 7010-FETCH-TEAM-CSR                              04290000
043000     END-PERFORM.                                                 04300000
043010                                                                  04301001
043020     PERFORM 7020-CLOSE-TEAM-CSR.                                 04302001
043100                                                                  04310000
043200 4000-PROCESS-ONE-MEMBER.                                         04320000
043300                                                                  04330000
043400     MOVE DL010-KEYED-USERID          TO PV-USERID                04340000
043500     IF XL067-USER-IS-KOHLS                                       04350000
043600         MOVE 'K'                     TO PV-USER-TYPE             04360000
043700     ELSE                                                         04370000
043800         MOVE 'T'                     TO PV-USER-TYPE             04380000
043900     END-IF                                                       04390000
044000                                                                  04400000
044100     MOVE DL010-TEM-ASGMT-SEQ-NBR     TO PV-TEM-ASGMT-SEQ-NBR     04410000
044200     PERFORM 5000-PUNCH-OUT.                                      04420000
044300                                                                  04430000
044400 5000-PUNCH-OUT.                                                  04440000
044500                                                                  04450000
044600     INITIALIZE DL005-ASGMT-COMMAREA                              04460000
044700     SET DL005-BY-ASGMT-NBR                                       04470000
044800         DL005-END-FROM-ASGMT                                     04480000
044900         DL005-DO-NOT-COMMIT-UPDATE   TO TRUE                     04490000
045000                                                                  04500000
045100     MOVE DL010-ASGMT-STRT-DTE        TO DL005-KEY-START-DTE      04510000
045200     MOVE DL010-ASGMT-NBR-TXT         TO DL005-KEY-NBR-TXT        04520000
045300     MOVE DL010-ASGMT-NBR-SEQ-NBR     TO DL005-KEY-NBR-SEQ-NBR    04530000
045400     MOVE PV-TEM-ASGMT-SEQ-NBR        TO                          04540000
045500                                     DL005-KEY-TEM-ASGMT-SEQ-NBR  04550000
045600*    MOVE DL010-KEYED-USERID          TO DL005-KEY-USER-ID        04560000
045700     MOVE PV-USERID                   TO DL005-KEY-USER-ID        04570000
045800     MOVE DL010-USERID                TO DL005-KEY-ADD-BY-USER-ID 04580000
045900     MOVE PV-USER-TYPE                TO DL005-KEY-USR-TYPE-CDE   04590000
046000                                                                  04600000
046100     MOVE 'DLKRF455'                  TO DL005-ORIG-CALLING-PGM-NM04610000
046200                                         DL005-KEY-LVE-PGM-NM     04620000
046300     IF DL010-CODE-DESC                                           04630000
046400               (DL010-PAGE-SUB, DL010-LINE-SUB) (1:5) =           04640000
046500                                 'ISTOP'                          04650000
046600         SET DL005-KEY-LVE-RSN-SSTOP  TO TRUE                     04660000
046700     ELSE                                                         04670000
046800         SET DL005-KEY-LVE-RSN-AMOVE  TO TRUE                     04680000
046900     END-IF                                                       04690000
047000                                                                  04700000
047100     PERFORM 8620-CALL-DLKUP002.                                  04710000
047200     PERFORM 8410-CALL-XLKUP033.                                  04720000
047300                                                                  04730000
047400 7000-OPEN-TEAM-CSR.                                              04740000
047500                                                                  04750000
047600     EXEC SQL                                                     04760000
047700         OPEN TEAM-CSR                                            04770000
047800     END-EXEC.                                                    04780000
047900                                                                  04790000
048000     EVALUATE TRUE                                                04800000
048100         WHEN SQLCODE = ZERO                                      04810000
048200             CONTINUE                                             04820000
048300         WHEN SQLCODE = -180                                      04830000
048400             SET PS-END-TEAM-CSR-YES                              04840000
048500                 PS-ERRORS-YES        TO TRUE                     04850000
048600         WHEN SQLCODE = -904                                      04860000
048700         WHEN SQLCODE = -913                                      04870000
048800         WHEN SQLCODE = -911                                      04880000
048900             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID           04890000
049000             MOVE SQLCODE             TO PV-SQLCODE               04900000
049100             MOVE 3                   TO PV-ERROR-NBR             04910000
049200                                         DL010-ERROR-NBR          04920000
049300             PERFORM 9903-WRITE-CICS-LOG                          04930000
049400             PERFORM 9000-SOFT-ABORT                              04940000
049500             PERFORM 8210-XCTL-ERROR-SCREEN                       04950000
049600         WHEN SQLWARN0 NOT = SPACES                               04960000
049700         WHEN SQLCODE NOT EQUAL ZERO                              04970000
049800             MOVE 4                   TO PV-ERROR-NBR             04980000
049900                                         DL010-ERROR-NBR          04990000
050000             PERFORM 9903-WRITE-CICS-LOG                          05000000
050100             MOVE '7000-OPEN-TEAM-CSR'                            05010000
050200                                      TO DL010-PARAGRAPH          05020000
050300             MOVE 'DLKRF455 - OPEN NAME CURSOR'                   05030000
050400                                      TO DL010-MESSAGE-TEXT(1)    05040000
050500             MOVE SQLCA               TO DL010-SQLCA              05050000
050600             MOVE 'DLT_TEM_ASGMT'     TO DL010-DB2-TABLE-NAME(1)  05060000
050700             SET DL010-ABEND          TO TRUE                     05070000
050800             MOVE 3                   TO DL010-PGM-MSG-NBR        05080000
050900             PERFORM 8210-XCTL-ERROR-SCREEN                       05090000
051000                                                                  05100000
051100     END-EVALUATE.                                                05110000
051200                                                                  05120000
051300 7010-FETCH-TEAM-CSR.                                             05130000
051400     EXEC SQL                                                     05140000
051500         FETCH TEAM-CSR                                           05150000
051600         INTO                                                     05160000
051700             :DLT00003-KOHLS-USR-ID:DN-KOHLS-NULL-IND             05170000
051800        ,    :DLT00003-TMP-USR-ID:DN-TEMP-NULL-IND                05180000
051900        ,    :PV-TEM-ASGMT-SEQ-NBR                                05190000
052000     END-EXEC.                                                    05200000
052100                                                                  05210000
052200     EVALUATE TRUE                                                05220000
052300         WHEN SQLCODE = ZERO                                      05230000
052400             CONTINUE                                             05240000
052500         WHEN SQLCODE = +100                                      05250000
052600         WHEN SQLCODE = -180                                      05260000
052700             SET PS-END-TEAM-CSR-YES  TO TRUE                     05270000
052800         WHEN SQLCODE = -904                                      05280000
052900         WHEN SQLCODE = -913                                      05290000
053000         WHEN SQLCODE = -911                                      05300000
053100             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID           05310000
053200             MOVE SQLCODE             TO PV-SQLCODE               05320000
053300             MOVE 5                   TO PV-ERROR-NBR             05330000
053400                                         DL010-ERROR-NBR          05340000
053500             PERFORM 9903-WRITE-CICS-LOG                          05350000
053600             PERFORM 9000-SOFT-ABORT                              05360000
053700             PERFORM 8210-XCTL-ERROR-SCREEN                       05370000
053800         WHEN SQLWARN0 NOT = SPACES                               05380000
053900         WHEN SQLCODE NOT EQUAL ZERO                              05390000
054000             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID           05400000
054100             MOVE 6                   TO PV-ERROR-NBR             05410000
054200                                         DL010-ERROR-NBR          05420000
054300             PERFORM 9903-WRITE-CICS-LOG                          05430000
054400             MOVE '7010-FETCH-TEAM-CSR'                           05440000
054500                                      TO DL010-PARAGRAPH          05450000
054600             MOVE 'DLKRF455 - FETCH NAME CURSOR'                  05460000
054700                                      TO DL010-MESSAGE-TEXT(1)    05470000
054800             MOVE SQLCA               TO DL010-SQLCA              05480000
054900             MOVE 'DLT_TEM_ASGMT'     TO DL010-DB2-TABLE-NAME(1)  05490000
055000             SET DL010-ABEND          TO TRUE                     05500000
055100             MOVE 3                   TO DL010-PGM-MSG-NBR        05510000
055200             PERFORM 8210-XCTL-ERROR-SCREEN                       05520000
055300                                                                  05530000
055400     END-EVALUATE.                                                05540000
055500                                                                  05550000
055600 7020-CLOSE-TEAM-CSR.                                             05560000
055700     EXEC SQL                                                     05570000
055800         CLOSE TEAM-CSR                                           05580000
055900     END-EXEC.                                                    05590000
056000                                                                  05600000
056100     EVALUATE TRUE                                                05610000
056200         WHEN SQLCODE = ZERO                                      05620000
056300             CONTINUE                                             05630000
056400         WHEN SQLCODE = -904                                      05640000
056500         WHEN SQLCODE = -913                                      05650000
056600         WHEN SQLCODE = -911                                      05660000
056700             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID           05670000
056800             MOVE SQLCODE             TO PV-SQLCODE               05680000
056900             MOVE 7                   TO PV-ERROR-NBR             05690000
057000                                         DL010-ERROR-NBR          05700000
057100             PERFORM 9903-WRITE-CICS-LOG                          05710000
057200             PERFORM 9000-SOFT-ABORT                              05720000
057300             PERFORM 8210-XCTL-ERROR-SCREEN                       05730000
057400         WHEN SQLWARN0 NOT = SPACES                               05740000
057500         WHEN SQLCODE NOT EQUAL ZERO                              05750000
057600             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID           05760000
057700             MOVE 8                   TO PV-ERROR-NBR             05770000
057800                                         DL010-ERROR-NBR          05780000
057900             PERFORM 9903-WRITE-CICS-LOG                          05790000
058000             MOVE '7020-CLOSE-TEAM-CSR'                           05800000
058100                                      TO DL010-PARAGRAPH          05810000
058200             MOVE 'DLKRF455 - FETCH NAME CURSOR'                  05820000
058300                                      TO DL010-MESSAGE-TEXT(1)    05830000
058400             MOVE SQLCA               TO DL010-SQLCA              05840000
058500             MOVE 'DLT_TEM_ASGMT'     TO DL010-DB2-TABLE-NAME(1)  05850000
058600             SET DL010-ABEND          TO TRUE                     05860000
058700             MOVE 3                   TO DL010-PGM-MSG-NBR        05870000
058800             PERFORM 8210-XCTL-ERROR-SCREEN                       05880000
058900                                                                  05890000
059000             CONTINUE                                             05900000
059100     END-EVALUATE.                                                05910000
059200                                                                  05920000
059300 7050-DUMMY-USERID.                                               05930000
059400     EXEC SQL                                                     05940000
059500         SELECT FUNC_TXT                                          05950000
059600         INTO :PV-DUMMY-USERID                                    05960000
059700         FROM                                                     05970000
059800             TKRPRPM                                              05980000
059900         WHERE                                                    05990000
060000             FUNC_TXT                 = :DL010-KEYED-USERID       06000000
060100             AND                                                  06010000
060200             INTFC_SYS_CDE            = 'DLX'                     06020000
060300             AND                                                  06030000
060400             SYS_PRC_FUNC_CDE         = 'DLPLDU'                  06040000
060500             AND                                                  06050000
060600             FUNC_PRC_STAT_CDE        = 'AC'                      06060000
060700             AND                                                  06070000
060800             CURRENT TIMESTAMP BETWEEN                            06080000
060900             FUNC_BEG_TMST AND FUNC_END_TMST                      06090000
061000     END-EXEC.                                                    06100000
061100                                                                  06110000
061200     EVALUATE TRUE                                                06120000
061300         WHEN SQLCODE = ZERO                                      06130000
061400             CONTINUE                                             06140000
061500         WHEN SQLCODE = +100                                      06150000
061600             MOVE SPACES                    TO PV-DUMMY-USERID    06160000
061700         WHEN SQLCODE = -904                                      06170000
061800         WHEN SQLCODE = -913                                      06180000
061900         WHEN SQLCODE = -911                                      06190000
062000             MOVE DL010-KEYED-USERID        TO PV-LOG-USER-ID     06200000
062100             MOVE SQLCODE                   TO PV-SQLCODE         06210000
062200             MOVE 7                         TO PV-ERROR-NBR       06220000
062300                                         DL010-ERROR-NBR          06230000
062400             PERFORM 9903-WRITE-CICS-LOG                          06240000
062500             PERFORM 9000-SOFT-ABORT                              06250000
062600             PERFORM 8210-XCTL-ERROR-SCREEN                       06260000
062700         WHEN SQLWARN0 NOT = SPACES                               06270000
062800         WHEN SQLCODE NOT EQUAL ZERO                              06280000
062900             MOVE 8                   TO PV-ERROR-NBR             06290000
063000                                         DL010-ERROR-NBR          06300000
063100             PERFORM 9903-WRITE-CICS-LOG                          06310000
063200             MOVE '7050-DUMMY-USERID' TO DL010-PARAGRAPH          06320000
063300             MOVE 'DLKRF455 - OPEN NAME CURSOR'                   06330000
063400                                      TO DL010-MESSAGE-TEXT(1)    06340000
063500             MOVE SQLCA               TO DL010-SQLCA              06350000
063600             MOVE 'DLT_TEM_ASGMT'     TO DL010-DB2-TABLE-NAME(1)  06360000
063700             SET DL010-ABEND          TO TRUE                     06370000
063800             MOVE 3                   TO DL010-PGM-MSG-NBR        06380000
063900             PERFORM 8210-XCTL-ERROR-SCREEN                       06390000
064000                                                                  06400000
064100     END-EVALUATE.                                                06410000
064200                                                                  06420000
064300 7100-COUNT-TEAM-MEMBERS.                                         06430000
064400     EXEC SQL                                                     06440000
064500         SELECT COUNT(*)                                          06450000
064600         INTO :PV-TEAM-COUNT                                      06460000
064700         FROM                                                     06470000
064800             DLT_TEM_ASGMT                                        06480000
064900         WHERE                                                    06490000
065000             ASGMT_STRT_DTE    = :DL010-ASGMT-STRT-DTE            06500000
065100         AND ASGMT_NBR_TXT     = :DL010-ASGMT-NBR-TXT             06510000
065200         AND ASGMT_NBR_SEQ_NBR = :DL010-ASGMT-NBR-SEQ-NBR         06520000
065300         AND LVE_RSN_CDE       = 'N'                              06530000
065400         WITH UR                                                  06540000
065500     END-EXEC.                                                    06550000
065600                                                                  06560000
065700     EVALUATE TRUE                                                06570000
065800         WHEN SQLCODE = ZERO                                      06580000
065900             CONTINUE                                             06590000
066000         WHEN SQLCODE = +100                                      06600000
066100         WHEN SQLCODE = -305                                      06610000
066200             MOVE ZERO                TO PV-TEAM-COUNT            06620000
066300         WHEN SQLCODE = -904                                      06630000
066400         WHEN SQLCODE = -913                                      06640000
066500         WHEN SQLCODE = -911                                      06650000
066600             MOVE DL010-KEYED-USERID        TO PV-LOG-USER-ID     06660000
066700             MOVE SQLCODE                   TO PV-SQLCODE         06670000
066800             MOVE 7                         TO PV-ERROR-NBR       06680000
066900                                         DL010-ERROR-NBR          06690000
067000             PERFORM 9903-WRITE-CICS-LOG                          06700000
067100             PERFORM 9000-SOFT-ABORT                              06710000
067200             PERFORM 8210-XCTL-ERROR-SCREEN                       06720000
067300         WHEN SQLWARN0 NOT = SPACES                               06730000
067400         WHEN SQLCODE NOT EQUAL ZERO                              06740000
067500             MOVE 8                   TO PV-ERROR-NBR             06750000
067600                                         DL010-ERROR-NBR          06760000
067700             PERFORM 9903-WRITE-CICS-LOG                          06770000
067800             MOVE '7100-COUNT-TEAM-MEMBERS'                       06780000
067900                                      TO DL010-PARAGRAPH          06790000
068000             MOVE 'DLKRF455 - COUNT TEAM MEMBERS'                 06800000
068100                                      TO DL010-MESSAGE-TEXT(1)    06810000
068200             MOVE SQLCA               TO DL010-SQLCA              06820000
068300             MOVE 'DLT_TEM_ASGMT'     TO DL010-DB2-TABLE-NAME(1)  06830000
068400             SET DL010-ABEND          TO TRUE                     06840000
068500             MOVE 3                   TO DL010-PGM-MSG-NBR        06850000
068600             PERFORM 8210-XCTL-ERROR-SCREEN                       06860000
068700                                                                  06870000
068800     END-EVALUATE.                                                06880000
068900                                                                  06890000
069000                                                                  06900000
069100 8000-SEND-MAP.                                                   06910000
069200                                                                  06920000
069300     EXEC CICS                                                    06930000
069400         SEND MAP       ('DL455A')                                06940000
069500              MAPSET    ('DLKM455')                               06950000
069600              ERASE                                               06960000
069700              RESP      (PV-CICS-RESPONSE)                        06970000
069800     END-EXEC.                                                    06980000
069900                                                                  06990000
070000     EVALUATE TRUE                                                07000000
070100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07010000
070200             CONTINUE                                             07020000
070300         WHEN OTHER                                               07030000
070400             MOVE '8000-SEND-MAP'     TO DP013-PARAGRAPH          07040000
070500             MOVE 'DLKRF455 - UNABLE TO SEND MAP'                 07050000
070600                                      TO DP013-MESSAGE-TEXT (1)   07060000
070700             SET DP013-CICS-ABEND                                 07070000
070800                 DP013-ROLLBACK       TO TRUE                     07080000
070900             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               07090000
071000     END-EVALUATE.                                                07100000
071100                                                                  07110000
071200 8010-SEND-DATA-ONLY.                                             07120000
071300                                                                  07130000
071400     EXEC CICS                                                    07140000
071500         SEND MAP       ('DL455A')                                07150000
071600              MAPSET    ('DLKM455')                               07160000
071700              CURSOR                                              07170000
071800              DATAONLY                                            07180000
071900              RESP      (PV-CICS-RESPONSE)                        07190000
072000     END-EXEC.                                                    07200000
072100                                                                  07210000
072200     EVALUATE TRUE                                                07220000
072300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07230000
072400             CONTINUE                                             07240000
072500         WHEN OTHER                                               07250000
072600             MOVE '8010-SEND-DATA-ONLY'                           07260000
072700                                      TO DP013-PARAGRAPH          07270000
072800             MOVE 'DLKRF455 - UNABLE TO SEND DATA'                07280000
072900                                      TO DP013-MESSAGE-TEXT (1)   07290000
073000             SET DP013-CICS-ABEND                                 07300000
073100                 DP013-ROLLBACK       TO TRUE                     07310000
073200             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               07320000
073300     END-EVALUATE.                                                07330000
073400                                                                  07340000
073500 8020-RECEIVE-MAP.                                                07350000
073600                                                                  07360000
073700     EXEC CICS                                                    07370000
073800         RECEIVE MAP    ('DL455A')                                07380000
073900                 MAPSET ('DLKM455')                               07390000
074000                 RESP   (PV-CICS-RESPONSE)                        07400000
074100     END-EXEC.                                                    07410000
074200                                                                  07420000
074300     EVALUATE TRUE                                                07430000
074400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07440000
074500             CONTINUE                                             07450000
074600         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                07460000
074700             CONTINUE                                             07470000
074800         WHEN OTHER                                               07480000
074900            MOVE '8020-RECEIVE-MAP'      TO DP013-PARAGRAPH       07490000
075000            MOVE 'DLKRF455 - UNABLE TO RECEIVE MAP'               07500000
075100                                         TO DP013-MESSAGE-TEXT (1)07510000
075200            SET DP013-LOGIC-ABEND        TO TRUE                  07520000
075300            SET DP013-ROLLBACK           TO TRUE                  07530000
075400            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                07540000
075500     END-EVALUATE.                                                07550000
075600                                                                  07560000
075700 8100-RETURN-TRANID.                                              07570000
075800                                                                  07580000
075900     MOVE LENGTH OF DL010-COMMAREA    TO PV-COMMAREA-LENGTH       07590000
076000     EXEC CICS                                                    07600000
076100         RETURN TRANSID  (PC-TRANID)                              07610000
076200                COMMAREA (DL010-COMMAREA)                         07620000
076300                LENGTH   (PV-COMMAREA-LENGTH)                     07630000
076400                RESP     (PV-CICS-RESPONSE)                       07640000
076500     END-EXEC.                                                    07650000
076600                                                                  07660000
076700     EVALUATE TRUE                                                07670000
076800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07680000
076900             CONTINUE                                             07690000
077000         WHEN OTHER                                               07700000
077100             MOVE '8100-RETURN-TRANIND' TO DP013-PARAGRAPH        07710000
077200             MOVE 'DLKRF455 - UNABLE TO RETURN TO TRANID'         07720000
077300                 TO DP013-MESSAGE-TEXT (1)                        07730000
077400             SET DP013-CICS-ABEND       TO TRUE                   07740000
077500             SET DP013-ROLLBACK         TO TRUE                   07750000
077600             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               07760000
077700     END-EVALUATE.                                                07770000
077800                                                                  07780000
077900 8110-RETURN.                                                     07790000
078000                                                                  07800000
078100     EXEC CICS                                                    07810000
078200         SEND FROM (PV-MESSAGE-AREA)                              07820000
078300              LENGTH (19)                                         07830000
078400              ERASE                                               07840000
078500     END-EXEC.                                                    07850000
078600                                                                  07860000
078700     EXEC CICS                                                    07870000
078800         RETURN                                                   07880000
078900     END-EXEC.                                                    07890000
079000                                                                  07900000
079100 8200-XCTL.                                                       07910000
079200     SET DL010-INITIALIZE-SCREEN      TO TRUE.                    07920000
079300     MOVE PC-CURRENT-PROGRAM-NAME     TO DL010-LAST-PROGRAM       07930000
079400*                                        DL010-MENU-PROGRAM       07940000
079500     MOVE LENGTH OF DL010-COMMAREA    TO PV-COMMAREA-LENGTH       07950000
079600                                                                  07960000
079700     EXEC CICS                                                    07970000
079800         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    07980000
079900               COMMAREA  (DL010-COMMAREA)                         07990000
080000               LENGTH    (PV-COMMAREA-LENGTH)                     08000000
080100               RESP      (PV-CICS-RESPONSE)                       08010000
080200     END-EXEC.                                                    08020000
080300                                                                  08030000
080400     EVALUATE TRUE                                                08040000
080500         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 08050000
080600             CONTINUE                                             08060000
080700         WHEN OTHER                                               08070000
080800             MOVE '8200-XCTL'         TO DP013-PARAGRAPH          08080000
080900             MOVE 'DLKRF455 - UNABLE TO XCTL TO PROGRAM: '        08090000
081000                                      TO DP013-MESSAGE-TEXT (1)   08100000
081100             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   08110000
081200             SET DP013-CICS-ABEND                                 08120000
081300                 DP013-ROLLBACK       TO TRUE                     08130000
081400             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               08140000
081500             MOVE PC-TRANS-UNAVAILABLE-MSG                        08150000
081600                                      TO AMSGLNO                  08160000
081700             SET DL010-PROCESS-SCREEN TO TRUE                     08170000
081800*            MOVE DL010-MENU-PROGRAM  TO DL010-LAST-PROGRAM       08180000
081900             PERFORM 8000-SEND-MAP                                08190000
082000             PERFORM 8100-RETURN-TRANID                           08200000
082100     END-EVALUATE.                                                08210000
082200                                                                  08220000
082300 8210-XCTL-ERROR-SCREEN.                                          08230000
082400                                                                  08240000
082500     IF NOT DL010-ABEND                                           08250000
082600         SET DL010-INITIALIZE-SCREEN  TO TRUE                     08260000
082700     END-IF                                                       08270000
082800     MOVE DFHEIBLK                    TO DL010-DFHEIBLK.          08280000
082900     MOVE PC-CURRENT-PROGRAM-NAME     TO DL010-LAST-PROGRAM.      08290000
083000     MOVE LENGTH OF DL010-COMMAREA    TO PV-COMMAREA-LENGTH       08300000
083100     MOVE 'DLKRF456'                  TO PV-TRANSFER-PROGRAM      08310000
083200     IF DL010-PGM-MSG-NBR = ZERO                                  08320000
083300*        UNDEFINED ERROR                                          08330000
083400         MOVE 1                       TO DL010-PGM-MSG-NBR        08340000
083500     END-IF                                                       08350000
083600*                                                                 08360000
083700     EXEC CICS                                                    08370000
083800         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    08380000
083900               COMMAREA  (DL010-COMMAREA)                         08390000
084000               LENGTH    (PV-COMMAREA-LENGTH)                     08400000
084100               RESP      (PV-CICS-RESPONSE)                       08410000
084200     END-EXEC.                                                    08420000
084300                                                                  08430000
084400     EVALUATE TRUE                                                08440000
084500         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 08450000
084600             CONTINUE                                             08460000
084700         WHEN OTHER                                               08470000
084800             MOVE '8200-XCTL'                                     08480000
084900                                      TO DP013-PARAGRAPH          08490000
085000             MOVE 'DLKRF455 - UNABLE TO XCTL TO PROGRAM: '        08500000
085100                                      TO DP013-MESSAGE-TEXT (1)   08510000
085200             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   08520000
085300             SET DP013-CICS-ABEND                                 08530000
085400                 DP013-ROLLBACK       TO TRUE                     08540000
085500             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               08550000
085600             MOVE PC-TRANS-UNAVAILABLE-MSG                        08560000
085700                                      TO AMSGLNO                  08570000
085800             SET DL010-PROCESS-SCREEN TO TRUE                     08580000
085900             PERFORM 8000-SEND-MAP                                08590000
086000             PERFORM 8100-RETURN-TRANID                           08600000
086100     END-EVALUATE.                                                08610000
086200                                                                  08620000
086300*                                                                 08630000
086400 8220-XCTL-TO-HELP.                                               08640000
086500                                                                  08650000
086600     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH       08660000
086700                                                                  08670000
086800     EXEC CICS                                                    08680000
086900         XCTL                                                     08690000
087000             PROGRAM   (PV-TRANSFER-PROGRAM)                      08700000
087100             COMMAREA  (PC192-COMMAREA)                           08710000
087200             LENGTH    (PV-COMMAREA-LENGTH)                       08720000
087300             RESP      (PV-CICS-RESPONSE)                         08730000
087400     END-EXEC.                                                    08740000
087500                                                                  08750000
087600     EVALUATE TRUE                                                08760000
087700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 08770000
087800              CONTINUE                                            08780000
087900         WHEN OTHER                                               08790000
088000             MOVE '8220-XCTL-TO-HELP' TO DP013-PARAGRAPH          08800000
088100             MOVE 'DLKRF455 - UNABLE TO XCTL TO PROGRAM: '        08810000
088200                                      TO DP013-MESSAGE-TEXT (1)   08820000
088300             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   08830000
088400             SET DP013-CICS-ABEND                                 08840000
088500                 DP013-ROLLBACK       TO TRUE                     08850000
088600             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               08860000
088700             MOVE PC-TRANS-UNAVAILABLE-MSG                        08870000
088800                                      TO AMSGLNO                  08880000
088900             SET DL010-PROCESS-SCREEN TO TRUE                     08890000
089000             PERFORM 8000-SEND-MAP                                08900000
089100             PERFORM 8100-RETURN-TRANID                           08910000
089200     END-EVALUATE.                                                08920000
089300                                                                  08930000
093900 8410-CALL-XLKUP033.                                              09390000
094000                                                                  09400000
094100     INITIALIZE XL072-EAI-EXPORT-COMMAREA                         09410000
094200                                                                  09420000
094300     SET XL072-PC-APP-ID          TO TRUE.                        09430000
094400     MOVE 'DC LABOR'              TO XL072-EVNT-OBJ-TXT           09440000
094500     MOVE 'INDIRECT LABOR'        TO XL072-EVNT-OBJ-ACTN-TXT      09450000
094600     MOVE PV-USERID               TO XL072-CRE-BY-USR-ID.         09460000
094700     MOVE 'DLKRF455'              TO XL072-CRE-PGM-NM.            09470000
094800     MOVE DL010-OPER-UNT-ID       TO XL072-EVNT-KY-1-NBR.         09480000
094900     MOVE 'N/A'                   TO XL072-DTL-COPYBOOK-NM        09490000
095000                                                                  09500000
095100     MOVE DL010-INDIR-LBR-CDE(DL010-PAGE-SUB, DL010-LINE-SUB)     09510000
095200                                  TO XL072-EVNT-KY-1-TXT          09520000
095300*    SET XL072-DO-NOT-COMMIT-UPDATE TO TRUE.                      09530000
095400     SET XL072-COMMIT-UPDATE      TO TRUE.                        09540000
095500     MOVE 'DLKRF455'              TO XL072-ORIG-CALLING-PGM-NM.   09550000
095600                                                                  09560000
095700     EXEC SQL                                                     09570000
095800         SET :XL072-EVNT-KY-1-TMST = CURRENT TIMESTAMP            09580000
095810           , :PV-LABOR-CURRENT-TIMESTAMP =                        09581000
095820              CURRENT TIMESTAMP + 1 SECOND                        09582000
095830     END-EXEC                                                     09583000
095840                                                                  09584000
095850     CALL XL072-USER-PGM USING DFHEIBLK                           09585000
095860                               XL072-COMMAREA                     09586000
095870                               XL072-EAI-EXPORT-COMMAREA          09587000
095880                                                                  09588000
095890     IF XL072-EVNT-KY-1-TXT = 'IWORK'                             09589000
095900         MOVE 'IWORK2' TO XL072-EVNT-KY-1-TXT                     09590000
096000         MOVE XL072-EVNT-KY-1-TMST TO PV-HOLD-TIMESTAMP           09600000
096100         MOVE PV-LABOR-CURRENT-TIMESTAMP TO XL072-EVNT-KY-1-TMST  09610000
096200         CALL XL072-USER-PGM USING DFHEIBLK                       09620000
096300                               XL072-COMMAREA                     09630000
096400                               XL072-EAI-EXPORT-COMMAREA          09640000
096500     END-IF.                                                      09650000
096600     IF XL072-EVNT-KY-1-TXT = 'IPAWRK'                            09660000
096700         MOVE 'IPAWK2' TO XL072-EVNT-KY-1-TXT                     09670000
096800         MOVE XL072-EVNT-KY-1-TMST TO PV-HOLD-TIMESTAMP           09680000
096900         MOVE PV-LABOR-CURRENT-TIMESTAMP TO XL072-EVNT-KY-1-TMST  09690000
097000         CALL XL072-USER-PGM USING DFHEIBLK                       09700000
097100                               XL072-COMMAREA                     09710000
097200                               XL072-EAI-EXPORT-COMMAREA          09720000
097300     END-IF.                                                      09730000
097400                                                                  09740000
097500     EVALUATE TRUE                                                09750000
097600         WHEN XL072-SUCCESSFUL                                    09760000
097700             CONTINUE                                             09770000
097800         WHEN XL072-SQL-ERROR                                     09780000
097900             MOVE 3                   TO PV-ERROR-NBR             09790000
098000                                         DL010-ERROR-NBR          09800000
098100             MOVE DL010-USERID        TO PV-LOG-USER-ID           09810000
098200             MOVE XL072-EAI-DB-SQLCODE TO PV-SQLCODE              09820000
098300             PERFORM 9903-WRITE-CICS-LOG                          09830000
098400             MOVE '8410-CALL-XLKUP033'                            09840000
098500                                      TO DL010-PARAGRAPH          09850000
098600             MOVE 'DLKRF455 - END ASSIGNMENT'                     09860000
098700                                      TO DL010-MESSAGE-TEXT(1)    09870000
098800             MOVE XL072-SQL-ERROR-PARA                            09880000
098900                                      TO DL010-MESSAGE-TEXT(2)    09890000
099000             MOVE XL072-SQLCA         TO DL010-SQLCA              09900000
099100             SET DL010-ABEND          TO TRUE                     09910000
099200             MOVE 3                   TO DL010-PGM-MSG-NBR        09920000
099300             PERFORM 8210-XCTL-ERROR-SCREEN                       09930000
099400         WHEN XL072-INVALID-ACCESS                                09940000
099500             MOVE '8410-CALL-XLKUP033' TO DP013-PARAGRAPH         09950000
099600             MOVE 'DLKRF455 - DB2 ERROR IN PROGRAM: '             09960000
099700                                      TO DP013-MESSAGE-TEXT (1)   09970000
099800             MOVE 'XLKUP033'          TO DP013-MESSAGE-TEXT (2)   09980000
099900             SET DP013-CICS-ABEND                                 09990000
100000                 DP013-ROLLBACK       TO TRUE                     10000000
100100             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               10010000
100200             MOVE PC-TRANS-UNAVAILABLE-MSG                        10020000
100300                                      TO AMSGLNO                  10030000
100400             SET DL010-PROCESS-SCREEN TO TRUE                     10040000
100500             MOVE -1                  TO AUSERL                   10050000
100600             PERFORM 8000-SEND-MAP                                10060000
100700             PERFORM 8100-RETURN-TRANID                           10070000
100800         WHEN OTHER                                               10080000
100900             MOVE '8410-CALL-XLKUP033' TO DP013-PARAGRAPH         10090000
101000             MOVE 'DLKRF455 - UNDETERMINED ERROR IN PGM: '        10100000
101100                                      TO DP013-MESSAGE-TEXT (1)   10110000
101200             MOVE 'XLKUP033'          TO DP013-MESSAGE-TEXT (2)   10120000
101300             SET DP013-CICS-ABEND                                 10130000
101400                 DP013-ROLLBACK       TO TRUE                     10140000
101500             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               10150000
101600             MOVE PC-TRANS-UNAVAILABLE-MSG                        10160000
101700                                      TO AMSGLNO                  10170000
101800             SET DL010-PROCESS-SCREEN TO TRUE                     10180000
101900             MOVE -1                  TO AUSERL                   10190000
102000             PERFORM 8000-SEND-MAP                                10200000
102100             PERFORM 8100-RETURN-TRANID                           10210000
102200     END-EVALUATE.                                                10220000
102300                                                                  10230000
102400                                                                  10240000
102500 8600-CALL-XLKUT067.                                              10250000
102600                                                                  10260000
102700     INITIALIZE XL067-USER-COMMAREA.                              10270000
102800     SET XL067-BY-USER-ID                                         10280000
102900         XL067-SELECT-BOTH-USERS      TO TRUE.                    10290000
103000     MOVE DL010-KEYED-USERID          TO XL067-KEY-USER-ID        10300000
103100                                                                  10310000
103200     MOVE 'DLKRF455'                  TO XL067-ORIG-CALLING-PGM-NM10320000
103300                                                                  10330000
103400     CALL XL067-USER-PGM USING DFHEIBLK                           10340000
103500                               XL067-COMMAREA                     10350000
103600                               XL067-USER-COMMAREA                10360000
103700                                                                  10370000
103800     EVALUATE TRUE                                                10380000
103900         WHEN XL067-SUCCESSFUL                                    10390000
104000             CONTINUE                                             10400000
104100         WHEN XL067-SQL-ERROR                                     10410000
104200         WHEN XL067-INVALID-ACCESS                                10420000
104300             MOVE '8600-LINK-XLKUT067' TO DP013-PARAGRAPH         10430000
104400             MOVE 'DLKRF455 - DB2 ERROR IN PROGRAM: '             10440000
104500                                      TO DP013-MESSAGE-TEXT (1)   10450000
104600             MOVE 'XLKUT067'          TO DP013-MESSAGE-TEXT (2)   10460000
104700             SET DP013-CICS-ABEND                                 10470000
104800                 DP013-ROLLBACK       TO TRUE                     10480000
104900             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               10490000
105000             MOVE PC-TRANS-UNAVAILABLE-MSG                        10500000
105100                                      TO AMSGLNO                  10510000
105200             SET DL010-PROCESS-SCREEN TO TRUE                     10520000
105300             PERFORM 8000-SEND-MAP                                10530000
105400             PERFORM 8100-RETURN-TRANID                           10540000
105500         WHEN OTHER                                               10550000
105600             MOVE '8600-LINK-XLKUT067' TO DP013-PARAGRAPH         10560000
105700             MOVE 'DLKRF455 - UNDETERMINED ERROR IN PGM: '        10570000
105800                                      TO DP013-MESSAGE-TEXT (1)   10580000
105900             MOVE 'XLKUT067'          TO DP013-MESSAGE-TEXT (2)   10590000
106000             SET DP013-CICS-ABEND                                 10600000
106100                 DP013-ROLLBACK       TO TRUE                     10610000
106200             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               10620000
106300             MOVE PC-TRANS-UNAVAILABLE-MSG                        10630000
106400                                      TO AMSGLNO                  10640000
106500             SET DL010-PROCESS-SCREEN TO TRUE                     10650000
106600             PERFORM 8000-SEND-MAP                                10660000
106700             PERFORM 8100-RETURN-TRANID                           10670000
106800     END-EVALUATE.                                                10680000
106900                                                                  10690000
107000 8620-CALL-DLKUP002.                                              10700000
107100                                                                  10710000
107200     CALL DL005-USER-PGM USING DFHEIBLK                           10720000
107300                               DL005-COMMAREA                     10730000
107400                               DL005-ASGMT-COMMAREA               10740000
107500                                                                  10750000
107600     EVALUATE TRUE                                                10760000
107700         WHEN DL005-SUCCESSFUL                                    10770000
107800             CONTINUE                                             10780000
107900         WHEN DL005-ASGMT-NOT-ACTIVE                              10790000
108000**           MOVE 'INACTIVE ASSIGNMENT'                           10800000
108100**                                    TO AMSGLNO                  10810000
108200             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID           10820000
108300*DMH 11/14   SET DL010-ABEND          TO TRUE                     10830000
108400             MOVE 2                   TO PV-ERROR-NBR             10840000
108500             MOVE 8                   TO DL010-PGM-MSG-NBR        10850000
108600             PERFORM 9903-WRITE-CICS-LOG                          10860000
108700             PERFORM 8210-XCTL-ERROR-SCREEN                       10870000
108800         WHEN DL005-SQL-ERROR                                     10880000
108900             MOVE 3                   TO PV-ERROR-NBR             10890000
109000                                         DL010-ERROR-NBR          10900000
109100             MOVE DL010-USERID        TO PV-LOG-USER-ID           10910000
109200             MOVE DL005-ASGMT-SQLCODE TO PV-SQLCODE               10920000
109300             PERFORM 9903-WRITE-CICS-LOG                          10930000
109400             MOVE '3100-ADD-TO-ASSIGNMENT'                        10940000
109500                                      TO DL010-PARAGRAPH          10950000
109600             MOVE 'DLKRF455 - END ASSIGNMENT'                     10960000
109700                                      TO DL010-MESSAGE-TEXT(1)    10970000
109800             MOVE DL005-SQL-ERROR-PARA                            10980000
109900                                      TO DL010-MESSAGE-TEXT(2)    10990000
110000             MOVE DL005-SQLCA         TO DL010-SQLCA              11000000
110100             SET DL010-ABEND          TO TRUE                     11010000
110200             MOVE 3                   TO DL010-PGM-MSG-NBR        11020000
110300             PERFORM 8210-XCTL-ERROR-SCREEN                       11030000
110400         WHEN DL005-INVALID-ACCESS                                11040000
110500             MOVE '8610-CALL-DLKUT001' TO DP013-PARAGRAPH         11050000
110600             MOVE 'DLKRF455 - DB2 ERROR IN PROGRAM: '             11060000
110700                                      TO DP013-MESSAGE-TEXT (1)   11070000
110800             MOVE 'DLKUP002'          TO DP013-MESSAGE-TEXT (2)   11080000
110900             SET DP013-CICS-ABEND                                 11090000
111000                 DP013-ROLLBACK       TO TRUE                     11100000
111100             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               11110000
111200             MOVE PC-TRANS-UNAVAILABLE-MSG                        11120000
111300                                      TO AMSGLNO                  11130000
111400             SET DL010-PROCESS-SCREEN TO TRUE                     11140000
111500             MOVE -1                  TO AUSERL                   11150000
111600             PERFORM 8000-SEND-MAP                                11160000
111700             PERFORM 8100-RETURN-TRANID                           11170000
111800         WHEN OTHER                                               11180000
111900             MOVE '8620-CALL-DLKUP002' TO DP013-PARAGRAPH         11190000
112000             MOVE 'DLKRF455 - UNDETERMINED ERROR IN PGM: '        11200000
112100                                      TO DP013-MESSAGE-TEXT (1)   11210000
112200             MOVE DL005-ASGMT-SQLCODE TO PV-DISPLAY-SQLCODE       11220000
112300           MOVE DL005-KEY-NBR-SEQ-NBR TO PV-DISPLAY-ASGMT-NBR     11230000
112400           MOVE DL005-KEY-TEM-ASGMT-SEQ-NBR                       11240000
112500                                      TO PV-DISPLAY-TEM-ASGMT-NBR 11250000
112600             STRING 'DLKUP002 KEYS = ' DELIMITED BY SIZE          11260000
112700                DL005-KEYS             DELIMITED BY SIZE          11270000
112800                           INTO DP013-MESSAGE-TEXT(2)             11280000
112900***                 '* RETURN CODE = ' DELIMITED BY SIZE          11290000
113000***             DL005-RETURN-CODE      DELIMITED BY SIZE          11300000
113100***                 ' * SQL CODE = ' DELIMITED BY SIZE            11310000
113200***             PV-DISPLAY-SQLCODE  DELIMITED BY SIZE             11320000
113300***                        INTO DP013-MESSAGE-TEXT(2)             11330000
113400***          STRING '* SQL-ERR-PARA = ' DELIMITED BY SIZE         11340000
113500***             DL005-SQL-ERROR-PARA   DELIMITED BY SIZE          11350000
113600***                 ' * CALL-MOD-FAIL = ' DELIMITED BY SIZE       11360000
113700***             DL005-CALL-MOD-FAIL-NM DELIMITED BY SIZE          11370000
113800***                 ' * CALL-MOD-FAIL-ER-CD = ' DELIMITED BY SIZE 11380000
113900***             DL005-CALL-MOD-FAIL-ERR-CDE DELIMITED BY SIZE     11390000
114000***                        INTO DP013-MESSAGE-TEXT(3)             11400000
114100             STRING '* NBR-SEQ      = ' DELIMITED BY SIZE         11410000
114200          PV-DISPLAY-ASGMT-NBR     DELIMITED BY SIZE              11420000
114300                    ' * TEM-SEQ       = ' DELIMITED BY SIZE       11430000
114400          PV-DISPLAY-TEM-ASGMT-NBR     DELIMITED BY SIZE          11440000
114500                           INTO DP013-MESSAGE-TEXT(3)             11450000
114600             SET DP013-CICS-ABEND                                 11460000
114700                 DP013-ROLLBACK       TO TRUE                     11470000
114800             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               11480000
114900             MOVE PC-TRANS-UNAVAILABLE-MSG                        11490000
115000                                      TO AMSGLNO                  11500000
115100             SET DL010-PROCESS-SCREEN TO TRUE                     11510000
115200             MOVE -1                  TO AUSERL                   11520000
115300             PERFORM 8000-SEND-MAP                                11530000
115400             PERFORM 8100-RETURN-TRANID                           11540000
115500     END-EVALUATE.                                                11550000
115600                                                                  11560000
115700 9000-SOFT-ABORT.                                                 11570000
115800                                                                  11580000
115900     EXEC CICS                                                    11590000
116000         SYNCPOINT ROLLBACK                                       11600000
116100     END-EXEC.                                                    11610000
116200                                                                  11620000
116300     MOVE 2                           TO DL010-PGM-MSG-NBR        11630000
116400     MOVE SQLCODE                     TO DL010-SQLCODE            11640000
116500     MOVE SQLCA                       TO DL010-SQLCA              11650000
116600     MOVE 'D455'                      TO DL010-TRAN-ID            11660000
116700     PERFORM 8210-XCTL-ERROR-SCREEN.                              11670000
116800                                                                  11680000
116900                                                                  11690000
117000 9903-WRITE-CICS-LOG.                                             11700000
117100                                                                  11710000
117200     MOVE SQLCODE                     TO PV-SQLCODE               11720000
117300                                                                  11730000
117400     EXEC CICS                                                    11740000
117500         WRITEQ TD                                                11750000
117600             QUEUE  ('CSSL')                                      11760000
117700             FROM   (PV-LOG-MSG)                                  11770000
117800             RESP   (PV-CICS-RESPONSE)                            11780000
117900     END-EXEC.                                                    11790000
118000                                                                  11800000
118100 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  11810000
118200                                                                  11820000
118300     MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.           11830000
118400     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          11840000
118500     INITIALIZE DP013-SRC-TASK-NUMBER                             11850000
118600                DP013-STACK.                                      11860000
118700     SET DP013-LINK-RETURN            TO TRUE.                    11870000
118800                                                                  11880000
118900     EXEC CICS                                                    11890000
119000         LINK                                                     11900000
119100             PROGRAM   (DP013-NAME)                               11910000
119200             COMMAREA  (DP013-PARAMETERS)                         11920000
119300             LENGTH    (DP013-LENGTH)                             11930000
119400     END-EXEC.                                                    11940000
119500                                                                  11950000
119600*    ABEND PROCESSOR MODULE                                      *11960000
119700*    COPY DPPD014.                                                11970000
119800                                                                  11980000
