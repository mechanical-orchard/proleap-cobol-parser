000100******************************************************************00010003
000200 IDENTIFICATION DIVISION.                                         00020003
000300******************************************************************00030003
000400                                                                  00040003
000500 PROGRAM-ID.             CEKUT007.                                00050099
000600 AUTHOR.                 LYNN MCADAMS.                            00060003
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070003
000800 DATE-WRITTEN            DECEMBER, 1999.                          00080099
000900 DATE-COMPILED.                                                   00090003
001000                                                                  00100003
001100*----------------------------------------------------------------*00110003
001200* THIS PROGRAM CREATES AN EXTRACT FILE THAT WILL BE USED IN      *00120089
001300* GENERATING THE 'COMPLETED CENTRAL STOCK PULL ITEM REQUESTS'    *00130099
001400* REPORT AND THE 'RECAP OF CENTRAL STOCK BATCHES FOR MONTH-END'  *00140099
001500* REPORT.                                                        *00150099
001600*----------------------------------------------------------------*00160003
001700                                                                  00170003
001800******************************************************************00180003
001900 ENVIRONMENT DIVISION.                                            00190003
002000******************************************************************00200003
002100                                                                  00210003
002200 CONFIGURATION SECTION.                                           00220003
002300                                                                  00230003
002400 SOURCE-COMPUTER.        IBM-3090.                                00240003
002500 OBJECT-COMPUTER.        IBM-3090.                                00250003
002600                                                                  00260003
002700 INPUT-OUTPUT SECTION.                                            00270003
002800                                                                  00280003
002900 FILE-CONTROL.                                                    00290003
003000                                                                  00300003
003100      SELECT EXTRACT-FILE-IN        ASSIGN TO INP01.              00310088
003200      SELECT EXTRACT-FILE-OUT       ASSIGN TO OUT01.              00320088
003300                                                                  00330003
003400******************************************************************00340003
003500 DATA DIVISION.                                                   00350003
003600******************************************************************00360003
003700                                                                  00370003
003800 FILE SECTION.                                                    00380003
003900 FD  EXTRACT-FILE-IN                                              00390091
004000     LABEL RECORDS ARE STANDARD                                   00400003
004100     BLOCK CONTAINS 0 RECORDS                                     00410003
004200     RECORDING MODE IS F                                          00420003
004300     RECORD CONTAINS 100 CHARACTERS                               00430088
004400     DATA RECORD IS EXTRACT-IN-RECORD.                            00440088
004500                                                                  00450003
004600 01  EXTRACT-IN-RECORD               PIC X(100).                  00460088
004700                                                                  00470003
004800 FD  EXTRACT-FILE-OUT                                             00480088
004900     LABEL RECORDS ARE STANDARD                                   00490003
005000     BLOCK CONTAINS 0 RECORDS                                     00500003
005100     RECORDING MODE IS F                                          00510003
005200     RECORD CONTAINS 130 CHARACTERS                               00520099
005300     DATA RECORD IS EXTRACT-OUT-RECORD.                           00530088
005400                                                                  00540003
005500 01  EXTRACT-OUT-RECORD              PIC X(130).                  00550099
005600*------------------------------------------------------*          00560003
005700 WORKING-STORAGE SECTION.                                         00570003
005800*------------------------------------------------------*          00580003
005900 01 PC-PROGRAM-CONSTANTS.                                         00590099
006000    05  PC-PROGRAM-NAME              PIC X(08) VALUE 'CEKUT007'.  00600099
006100                                                                  00610099
006200 01 PC-PROGRAM-VARIABLES.                                         00620099
006300    05 PV-NULL-IND                   PIC S9(04)    VALUE ZERO     00630099
006400                                                   COMP SYNC.     00640099
006500    05 PV-ABEND-CODE                 PIC 9(04)     VALUE ZERO.    00650099
006600    05 PV-ABEND-PARA-NAME            PIC X(30)     VALUE SPACE.   00660099
006700    05 PV-DB2-OPERATION-MSG-1        PIC X(40)     VALUE SPACE.   00670099
006800    05 PV-DB2-TABLE-NAME             PIC X(12)     VALUE SPACE.   00680099
006900    05 PV-SQLCODE                    PIC Z(8)9-.                  00690099
006910    05 PV-TIMESTAMP                  PIC X(26).                   00691099
007000                                                                  00700099
007100 01 PV-FIELDS.                                                    00710099
007200    05  PV-UNIT-PRICE                PIC 9(05)V99  VALUE ZEROS.   00720099
007300    05  PV-DIST-UNITS                PIC 9(09)     VALUE ZEROS.   00730099
007400                                                                  00740099
007500 01 DK-DB-KEYS.                                                   00750099
007600    05  DK-MERCH-DEPT-NMBR           PIC X(03)     VALUE SPACE.   00760099
007700    05  DK-MERCH-CLASS-NMBR          PIC X(02)     VALUE SPACE.   00770099
007800*   05  DK-SEQ-NMBR                  PIC X(03)     VALUE SPACE.   00780099
007810    05  DK-SKU-NMBR                  PIC 9(08)     VALUE ZEROS.   00781099
007900    05  DK-SKU-DESC                  PIC X(25)     VALUE SPACE.   00790099
008000                                                                  00800099
008100 01 PS-PROGRAM-SWITCHES.                                          00810003
008200    05  PS-END-OF-FILE-SW            PIC X(01)     VALUE SPACE.   00820099
008300        88 PS-EOF                    VALUE 'Y'.                   00830099
008400        88 PS-NOT-EOF                VALUE 'N'.                   00840099
008500    05  PS-END-OF-TABLE-SW           PIC X(01)     VALUE SPACE.   00850099
008600        88 PS-EOT                    VALUE 'Y'.                   00860099
008700                                                                  00870025
008800 01 WS-CALC-FIELDS.                                               00880084
008900    05  WS-RECORDS-READ-QTY          PIC S9(07)    COMP-3         00890089
009000                                                   VALUE ZEROS.   00900003
009100    05  WS-RECORDS-WRITE-QTY         PIC S9(07)    COMP-3         00910089
009200                                                   VALUE ZEROS.   00920099
009300    05  WS-DIST-RETAIL-QTY           PIC 9(07)V99  VALUE ZEROS.   00930099
009400                                                                  00940099
009500*** INPUT FILE RECORD LAYOUT ****                                 00950006
009600     COPY CERD012.                                                00960088
009700                                                                  00970091
009800*** OUTPUT FILE RECORD LAYOUT ****                                00980091
009900     COPY CERD013.                                                00990099
010000                                                                  01000004
010100*** DB2 MESSAGE AREAS ****                                        01010099
010200     COPY DPWS004.                                                01020099
010300                                                                  01030099
010400     EXEC SQL                                                     01040099
010500          INCLUDE SQLCA                                           01050099
010600     END-EXEC.                                                    01060099
011120                                                                  01112099
011121     COPY XLWS001.                                                01112199
011122                                                                  01112299
011124* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *01112499
011200********************************************************          01120003
011300 PROCEDURE DIVISION.                                              01130003
011400********************************************************          01140003
011500 0000-MAIN.                                                       01150003
011510     EXEC SQL                                                     01151099
011520         SET :PV-TIMESTAMP = CURRENT TIMESTAMP                    01152099
011530     END-EXEC                                                     01153099
011600     PERFORM 1000-INITIALIZATION.                                 01160087
011700                                                                  01170003
011800     PERFORM 2000-PROCESS-FILES UNTIL PS-EOF.                     01180097
011900                                                                  01190003
012000     CLOSE EXTRACT-FILE-IN                                        01200088
012100           EXTRACT-FILE-OUT.                                      01210088
012200                                                                  01220003
012300     DISPLAY 'NUMBER OF RECORDS READ IS:     '                    01230003
012400         WS-RECORDS-READ-QTY.                                     01240003
012500     DISPLAY 'NUMBER OF RECORDS WRITTEN IS:  '                    01250003
012600         WS-RECORDS-WRITE-QTY.                                    01260003
012700                                                                  01270051
012800     STOP RUN.                                                    01280087
012900*                                                                 01290099
013000*                                                                 01300099
013100 1000-INITIALIZATION.                                             01310003
013200      OPEN INPUT  EXTRACT-FILE-IN                                 01320088
013300           OUTPUT EXTRACT-FILE-OUT.                               01330088
013400                                                                  01340003
013500*READ FIRST INPUT RECORD.                                         01350099
013600      PERFORM 8000-READ-INPUT-FILE.                               01360087
013700*                                                                 01370099
013800*                                                                 01380099
013900 2000-PROCESS-FILES.                                              01390096
014000      MOVE CE012-BTCH-PRC-DTE  TO CE013-BTCH-PRC-DTE.             01400099
014100      MOVE CE012-BATCH-NMBR    TO CE013-BATCH-NMBR.               01410099
014200      MOVE CE012-DC-STORE-NMBR TO CE013-DC-STORE-NMBR.            01420099
014300      MOVE CE012-DEPT          TO CE013-DEPT.                     01430099
014400      MOVE CE012-CLASS         TO CE013-CLASS.                    01440099
014500      MOVE CE012-SEQ           TO CE013-SEQ.                      01450099
014510      MOVE CE012-SKU-NBR       TO CE013-SKU-NBR.                  01451099
014600      MOVE CE012-FILLED-DATE-MMDDCCYY-MM                          01460099
014700                               TO CE013-FILLED-DATE-MMDDCCYY-MM.  01470099
014800      MOVE CE012-FILLED-DATE-MMDDCCYY-DD                          01480099
014900                               TO CE013-FILLED-DATE-MMDDCCYY-DD.  01490099
015000      MOVE CE012-FILLED-DATE-MMDDCCYY-CC                          01500099
015100                               TO CE013-FILLED-DATE-MMDDCCYY-CC.  01510099
015200      MOVE CE012-FILLED-DATE-MMDDCCYY-YY                          01520099
015300                               TO CE013-FILLED-DATE-MMDDCCYY-YY.  01530099
015400      MOVE CE012-PULL-NBR      TO CE013-PULL-NBR.                 01540099
015500      MOVE CE012-PULL-LNE-NBR  TO CE013-PULL-LNE-NBR.             01550099
015510      MOVE CE012-RECV-STORE-QTY TO CE013-TOTAL-QTY.               01551099
015700      MOVE CE012-UNIT-PRICE    TO CE013-UNIT-PRICE.               01570099
015800                                                                  01580099
015900      MOVE CE013-UNIT-PRICE    TO PV-UNIT-PRICE.                  01590099
016000                                                                  01600099
016100      ADD CE013-TOTAL-QTY      TO PV-DIST-UNITS.                  01610099
016200                                                                  01620099
016300      MULTIPLY PV-UNIT-PRICE BY PV-DIST-UNITS                     01630099
016400         GIVING WS-DIST-RETAIL-QTY.                               01640099
016500                                                                  01650099
016600      MOVE WS-DIST-RETAIL-QTY  TO CE013-DISTR-RETAIL.             01660099
016700                                                                  01670099
016800      PERFORM 2110-GET-XLV-SKU-ROW.                               01680099
016900                                                                  01690099
017000      PERFORM 3000-WRITE-HEADER-RECORD.                           01700099
017100                                                                  01710099
017200*READ NEXT INPUT RECORD.                                          01720099
017300      PERFORM 8000-READ-INPUT-FILE.                               01730099
017400*                                                                 01740099
017500*                                                                 01750099
017600 2110-GET-XLV-SKU-ROW.                                            01760099
017700      MOVE CE012-DEPT       TO DK-MERCH-DEPT-NMBR                 01770099
017800      MOVE CE012-CLASS      TO DK-MERCH-CLASS-NMBR                01780099
017820*                                                    WR # 230ZZ  *01782099
017821* THE CE012-SEQ IS CHANGED TO CE012-SKU AND SKU DESCRIPTION IS   *01782199
017822* ACCESSED FROM XLV_SKU INSTEAD OF TABLE TSK.                    *01782299
017823* LOGISTICS DOMAIN ITEM ACCESS MODULE XLUT001 IS USED.           *01782399
017824                                                                  01782499
017900*     MOVE CE012-SEQ        TO DK-SEQ-NMBR                        01790099
017910      MOVE CE012-SKU-NBR    TO DK-SKU-NMBR                        01791099
018000                                                                  01800099
020500*                                                                 02050099
020510     INITIALIZE XL001-ITEM-COMMAREA.                              02051099
020511                                                                  02051199
020520     SET XL001-BY-NUMERIC-SKU                                     02052099
020530         XL001-SELECT-SKU            TO TRUE.                     02053099
020531                                                                  02053199
020540      MOVE CE012-SKU-NBR             TO XL001-KEY-SKU.            02054099
020550                                                                  02055099
020560      CALL XL001-VSM-PGM USING XL001-ITEM-COMMAREA.               02056099
020570                                                                  02057099
020594     EVALUATE TRUE                                                02059499
020595          WHEN XL001-SKU-SQLCODE = ZERO                           02059599
020596              MOVE XL001-SKU-DESC      TO CE013-SKU-DESCRIPTION   02059699
020597                                                                  02059799
020598          WHEN XL001-SKU-SQLCODE = +100                           02059899
020599              SET PS-EOT TO TRUE                                  02059999
020600                                                                  02060099
020601          WHEN XL001-SKU-CONTENTION                               02060199
020602              MOVE '7010-SELECT-SKU-BY-SKU'                       02060299
020603                                       TO PV-ABEND-PARA-NAME      02060399
020604              MOVE 'SKU CONTENTION'                               02060499
020605                                       TO PV-DB2-OPERATION-MSG-1  02060599
020606              MOVE 'XLV_SKU'           TO PV-DB2-TABLE-NAME       02060699
020607              MOVE XL001-SKU-SQLCODE   TO PV-SQLCODE              02060799
020608              PERFORM 9998-SQL-ABEND                              02060899
020609                                                                  02060999
020617          WHEN OTHER                                              02061799
020618              MOVE '7010-SELECT-SKU-BY-SKU'                       02061899
020619                                       TO PV-ABEND-PARA-NAME      02061999
020620              MOVE 'INVALID SKU ACCESSS'                          02062099
020621                                       TO PV-DB2-OPERATION-MSG-1  02062199
020622              MOVE 'XLV_SKU '          TO PV-DB2-TABLE-NAME       02062299
020623              MOVE XL001-SKU-SQLCODE   TO PV-SQLCODE              02062399
020624              PERFORM 9998-SQL-ABEND                              02062499
020625      END-EVALUATE.                                               02062599
020626                                                                  02062699
020631*----------------------------------------------------------------*02063199
020632* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *02063299
020633*----------------------------------------------------------------*02063399
020640*                                                                 02064099
020700 3000-WRITE-HEADER-RECORD.                                        02070003
020800                                                                  02080003
020900      WRITE EXTRACT-OUT-RECORD          FROM                      02090088
021000                                 CE013-CENTRAL-STK-RPT-RECORD.    02100099
021100      ADD  +1                    TO WS-RECORDS-WRITE-QTY.         02110003
021200                                                                  02120003
021300      MOVE ZEROS TO PV-DIST-UNITS.                                02130099
021400*                                                                 02140099
021500*                                                                 02150099
021600 8000-READ-INPUT-FILE.                                            02160080
021700      INITIALIZE CE012-CENTRAL-STK-XFER-RECORD.                   02170089
021800      READ EXTRACT-FILE-IN       INTO                             02180088
021900                                  CE012-CENTRAL-STK-XFER-RECORD   02190089
022000         AT END                                                   02200080
022100            SET PS-EOF TO TRUE                                    02210080
022200         NOT AT END                                               02220080
022300           ADD  +1                    TO WS-RECORDS-READ-QTY      02230080
022400      END-READ.                                                   02240080
022500*                                                                 02250099
022600*                                                                 02260099
022700 9998-SQL-ABEND.                                                  02270099
022800*    MOVE SQLCODE     TO PV-SQLCODE.                              02280099
022900     DISPLAY '** ABEND           ** = SQLABEND'.                  02290099
023000     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          02300099
023100     DISPLAY '** PARAGRAPH       ** = ' PV-ABEND-PARA-NAME.       02310099
023200     DISPLAY '** TABLE AFFECTED  ** = ' PV-DB2-TABLE-NAME.        02320099
023300     DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.   02330099
023400     DISPLAY '** SQLCODE         ** = ' PV-SQLCODE.               02340099
023500*    COPY DPPD004.                                                02350099
023600     MOVE +4013                  TO PV-ABEND-CODE.                02360099
023700     CALL 'ILBOABN0'   USING PV-ABEND-CODE.                       02370099
