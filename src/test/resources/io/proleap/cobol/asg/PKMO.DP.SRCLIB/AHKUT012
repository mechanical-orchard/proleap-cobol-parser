000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    AHKUT012.                                         00020000
000300 AUTHOR.        CHERI MASTEL.                                     00030000
000400 INSTALLATION.  KOHLS.                                            00040000
000500 DATE-WRITTEN   AUG, 1997.                                        00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800******************************************************************00080026
000900*   AHKUT012.  "ARCHIVE HISTORY" PROJECT.  EXTRACT PROGRAM.      *00090026
001000*                                                                *00100026
001100*   PURPOSE:                                                     *00110026
001200*   THIS PROGRAM CREATES AN EXTRACT FILE FROM: TEXINVC.          *00120026
001300*   THIS EXTRACT FILE CONSISTS OF ROWS ELIGIBLE TO BE:           *00130026
001400*   1) LOADED TO THE "ARCHIVE/HISTORY" VERSIONS OF THE TABLES.   *00140026
001500*   2) DELETED FROM THE OPERATIONAL VERSIONS OF THE TABLES.      *00150026
001600*                                                                *00160026
001700*   PROCESSING OVERVIEW:                                         *00170026
001800*   THIS PROGRAM READS A "DRIVER" FILE. FOR EACH RECORD READ,    *00180026
001900*   1) INCREMENT COUNT OF RECORDS READ.                          *00190026
002000*   2) ATTEMPT TO FIND RELATED ROW(S) ON THE TABLE.              *00200026
002100*      2.A) IF NO MATCH(ES):                                     *00210026
002200*           2.A.1) PROCESSING CONTINUES                          *00220026
002300*           2.A.2) DO NOT PERFORM ERROR/REPORTING ROUTINES;      *00230026
002400*                  THIS SYSTEM DOES NOT CLEANSE DATA NOR REPORT  *00240026
002500*                  ON UNCLEAN DATA.  IT SIMPLY MIGRATES          *00250026
002600*                  CONDITIONS OCCURRING IN OPERATIONAL           *00260026
002700*                  TABLES OVER TO THE ARCHIVE/HISTORY TABLES.    *00270026
002800*      2.B) IF MATCH(ES):                                        *00280026
002900*           2.B.1) INCREMENT COUNT OF ROW(S) FOUND.              *00290026
003000*           2.B.2) WRITE THESE ROW(S) TO THE EXTRACT FILE.       *00300026
003100*           2.B.3) INCREMENT COUNT OF RECORDS WRITTEN.           *00310026
003200*           2.B.4) DO NOT REMOVE THE ROW(S) FROM THE TABLE       *00320026
003300*                  AT THIS TIME.  THEY WILL BE REMOVED IN OTHER  *00330026
003400*                  PROCESSING, AFTER HAVING BEEN LOADED TO THE   *00340026
003500*                  ARCHIVE/HISTORY TABLE.                        *00350026
003600*   3) EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT       *00360026
003700*      RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST     *00370026
003800*      WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.     *00380026
003810*----------------------------------------------------------------*00381029
003820*  CHANGE LOG:                                                   *00382029
003830* 06/19/07                                                       *00383032
003840*     MATCH BY DC PROJECT.                                       *00384029
003850*     INCREASED SIZE OF INPUT FILE FROM 186 TO 189.  THIS WAS    *00385029
003860*     NEEDED TO ALLOW FOR THE 2 NEW FIELDS IN THE AHRD001        *00386029
003870*     COPYBOOK: DC-NBR AND MTCH-LVL-CDE.                         *00387029
003880* MADE BY: MICHELE RINDFLEISCH                 WR# 32804         *00388031
003890*----------------------------------------------------------------*00389029
003900******************************************************************00390026
004000 ENVIRONMENT DIVISION.                                            00400000
004100 CONFIGURATION SECTION.                                           00410000
004200 SOURCE-COMPUTER.        IBM-3090.                                00420000
004300 OBJECT-COMPUTER.        IBM-3090.                                00430000
004400                                                                  00440000
004500 INPUT-OUTPUT SECTION.                                            00450000
004600 FILE-CONTROL.                                                    00460000
004700                                                                  00470000
004800     SELECT IN-DRIVER-FILE                ASSIGN TO IN01.         00480007
004900     SELECT OUT-EXTRACT-FILE              ASSIGN TO OUT01.        00490007
005000                                                                  00500000
005100******************************************************************00510000
005200 DATA DIVISION.                                                   00520000
005300 FILE SECTION.                                                    00530000
005400                                                                  00540000
005500 FD  IN-DRIVER-FILE                                               00550000
005600     RECORDING MODE IS F                                          00560000
005700     LABEL RECORDS ARE STANDARD                                   00570000
005800     BLOCK CONTAINS 0 RECORDS.                                    00580000
005900 01  IN-DRIVER-RECORD                PIC  X(189).                 00590029
006000                                                                  00600000
006100**** TEXINVC:                                                     00610000
006200 FD  OUT-EXTRACT-FILE                                             00620000
006300     RECORDING MODE IS F                                          00630000
006400     LABEL RECORDS ARE STANDARD                                   00640000
006500     BLOCK CONTAINS 0 RECORDS.                                    00650000
006600 01  OUT-EXTRACT-RECORD              PIC  X(062).                 00660027
006700                                                                  00670000
006800                                                                  00680000
006900                                                                  00690000
007000 WORKING-STORAGE SECTION.                                         00700000
007100                                                                  00710000
007200 01  PC-PROGRAM-CONSTANTS.                                        00720000
007300     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'AHKUT012'.  00730000
007400     05  PC-PGM-PROGRESS-DESC.                                    00740000
007500         10  PC-BEGINNING            PIC X(09) VALUE 'BEGINNING'. 00750000
007600         10  PC-CONTINUING           PIC X(10) VALUE              00760000
007700                                               'CONTINUING'.      00770000
007800         10  PC-ENDING               PIC X(06) VALUE 'ENDING'.    00780000
007900         10  PC-ABENDING             PIC X(08) VALUE 'ABENDING'.  00790000
008000     05  PC-ABEND-INFO.                                           00800000
008100         10  PC-ABEND                PIC X(11) VALUE              00810000
008200                                               '** ABEND **'.     00820000
008300         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00830000
008400                                               '- PARA       : '. 00840000
008500         10  PC-ABEND-MSG-DISPLAY-PARA                            00850000
008600                                     PIC X(15) VALUE              00860000
008700                                               '  CALLED PARA: '. 00870000
008800         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00880000
008900                                               '  FOR ABEND# : '. 00890000
009000         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00900000
009100                                               '- ERROR IS   : '. 00910000
009200         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00920000
009300         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              00930000
009400                                               '- ACTION     : '. 00940000
009500     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 100000.      00950018
009600                                                                  00960000
009700 01  PS-PROGRAM-SWITCHES.                                         00970000
009800     05  PS-IN-DRIVER-EOF-SW         PIC X(01) VALUE 'N'.         00980000
009900         88  PS-IN-DRIVER-EOF                  VALUE 'Y'.         00990000
010000         88  PS-IN-DRIVER-NOT-EOF              VALUE 'N'.         01000000
010100     05  PS-SELECT-HAS-DATA-SW       PIC X(01) VALUE 'N'.         01010027
010200         88  PS-SELECT-HAS-DATA                VALUE 'Y'.         01020027
010300         88  PS-SELECT-HAS-NO-DATA             VALUE 'N'.         01030027
010400                                                                  01040000
010500 01  PV-PROGRAM-VARIABLES.                                        01050000
010600     05  PV-PO-NBR                   PIC S9(9) VALUE 0.           01060027
010700     05  PV-PO-NBR-NUM               PIC  9(9) VALUE 0.           01070027
010800     05  PV-IN-DRIVER-RECS-READ-CNT  PIC  9(9) VALUE 0.           01080027
010900     05  PV-RECS-WITH-MATCHES-CNT    PIC  9(9) VALUE 0.           01090000
011000     05  PV-TABLE-ROW-SELECT-CNT     PIC  9(9) VALUE 0.           01100000
011100     05  PV-EXTRACT-WRITTEN-CNT      PIC  9(9) VALUE 0.           01110000
011200                                                                  01120000
011300     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACES.      01130000
011400     05  PV-DB2-OPERATION-MSG-1      PIC X(79) VALUE SPACES.      01140000
011500     05  PV-DB2-TABLE-NAME           PIC X(18) VALUE SPACES.      01150000
011600     05  PV-DISPLAY-NTH-MULTIPLE     PIC 9(9)  VALUE 0.           01160000
011700     05  PV-DISPLAY-NTH-REMAINDER    PIC 9(9)  VALUE 0.           01170000
011800     05  PV-SQLCODE                  PIC +999  VALUE ZERO.        01180008
011900                                                                  01190000
012000     05  PV-TMST                     PIC X(26) VALUE SPACES.      01200008
012100     05  PV-TIMESTAMP-DETAIL                                      01210008
012200         REDEFINES                                                01220008
012300         PV-TMST.                                                 01230008
012400         10  PV-TIMESTAMP-19.                                     01240008
012500             15  PV-TMS-DATE.                                     01250008
012600                 20  PV-TMS-YEAR.                                 01260008
012700                     25  PV-TMS-CC   PIC X(02).                   01270008
012800                     25  PV-TMS-YY   PIC X(02).                   01280008
012900                 20  FILLER          PIC X(01).                   01290008
013000                 20  PV-TMS-MONTH    PIC X(02).                   01300008
013100                 20  FILLER          PIC X(01).                   01310008
013200                 20  PV-TMS-DAY      PIC X(02).                   01320008
013300             15  FILLER              PIC X(01).                   01330008
013400             15  PV-TMS-HOUR         PIC X(02).                   01340008
013500             15  FILLER              PIC X(01).                   01350008
013600             15  PV-TMS-MINUTE       PIC X(02).                   01360008
013700             15  FILLER              PIC X(01).                   01370008
013800             15  PV-TMS-SECOND       PIC X(02).                   01380008
013900         10  FILLER                  PIC X(01).                   01390008
014000         10  PV-TMS-MSECOND          PIC X(06).                   01400008
014100                                                                  01410003
014200 01  DM-DISPLAY-MESSAGE.                                          01420014
014300     05  DM-01-10.                                                01430014
014400         10  DM-PROGRAM              PIC X(08) VALUE SPACE.       01440014
014500         10  FILLER                  PIC X(02) VALUE ': '.        01450014
014600     05  DM-11-80.                                                01460014
014700         10  FILLER                  PIC X(37) VALUE              01470014
014800                        'SELECT ROWS MATCHING TO DRIVER FILE, '.  01480015
014900         10  FILLER                  PIC X(30) VALUE              01490014
015000                        'CREATING TEXINVC EXTRACT FILE.'.         01500014
015100         10  FILLER                  PIC X(01) VALUE SPACE.       01510014
015200         10  FILLER                  PIC X(01) VALUE ALL '*'.     01520014
015300     05  DM-81-120.                                               01530014
015400         10  FILLER                  PIC X(40) VALUE ALL '*'.     01540014
015500                                                                  01550014
015600 01  DP-DISPLAY-PROGRESS-MSG.                                     01560000
015700     05  DP-PROGRAM                  PIC X(08) VALUE SPACE.       01570000
015800     05  FILLER                      PIC X(02) VALUE SPACE.       01580013
015900     05  DP-STATUS-DESCRIPTION       PIC X(10) VALUE SPACE.       01590001
016000     05  FILLER                      PIC X(04) VALUE ' AT '.      01600000
016100     05  DP-TIMESTAMP-19             PIC X(19) VALUE SPACE.       01610004
016200     05  FILLER                      PIC X(03) VALUE '.  '.       01620002
016300     05  FILLER                      PIC X(03) VALUE              01630005
016400                                         'IN:'.                   01640005
016500     05  DP-IN-CNT                   PIC ZZZ,ZZZ,ZZ9              01650011
016600                                               VALUE ZERO.        01660011
016700     05  FILLER                      PIC X(02) VALUE ', '.        01670002
016800     05  FILLER                      PIC X(14) VALUE              01680001
016900                                         'ROWS SELECTED:'.        01690001
017000     05  DP-ROWS-SELECTED-CNT        PIC ZZZ,ZZZ,ZZ9              01700011
017100                                               VALUE ZERO.        01710011
017200     05  FILLER                      PIC X(02) VALUE ', '.        01720000
017300     05  FILLER                      PIC X(04) VALUE              01730005
017400                                         'OUT:'.                  01740005
017500     05  DP-OUT-CNT                  PIC ZZZ,ZZZ,ZZ9              01750011
017600                                               VALUE ZERO.        01760011
017700     05  FILLER                      PIC X(01) VALUE '.'.         01770000
017800                                                                  01780000
017900 01  ABEND-CODE                      PIC S9(04)                   01790000
018000                                               VALUE ZEROES       01800000
018100                                               COMP SYNC.         01810000
018200                                                                  01820000
018300*---------------------------------------------------------------* 01830000
018400*  DB2 FORMATTED MESSAGE AREA                                     01840000
018500*---------------------------------------------------------------* 01850000
018600     COPY DPWS004.                                                01860008
018700                                                                  01870000
018800                                                                  01880000
018900*---------------------------------------------------------------* 01890000
019000*  AHRD001  - RECORD LAYOUT FOR DRIVER FILE, INPUT.             * 01900021
019100*---------------------------------------------------------------* 01910000
019200     COPY AHRD001.                                                01920021
019300                                                                  01930000
019400                                                                  01940000
019500*---------------------------------------------------------------* 01950000
019600*    DB2 AREA FOR TEXINVC                                       * 01960000
019700*---------------------------------------------------------------* 01970000
019800     EXEC SQL                                                     01980000
019900          INCLUDE TEXINVC                                         01990000
020000     END-EXEC.                                                    02000000
020100                                                                  02010000
020200*---------------------------------------------------------------* 02020000
020300*    DB2 AREA FOR COMMUNICATIONS                                * 02030000
020400*---------------------------------------------------------------* 02040000
020500     EXEC SQL                                                     02050000
020600          INCLUDE SQLCA                                           02060000
020700     END-EXEC.                                                    02070000
020800                                                                  02080000
020900                                                                  02090000
021000 PROCEDURE DIVISION.                                              02100000
021100********************                                              02110000
021200                                                                  02120000
021300 0000-PROGRAM-MAINLINE.                                           02130000
021400                                                                  02140000
021500     PERFORM 1000-INITIALIZE.                                     02150000
021600                                                                  02160000
021700     SET PS-IN-DRIVER-NOT-EOF TO TRUE.                            02170000
021800     PERFORM 2000-PROCESS-DRIVER-FILE                             02180000
021900         UNTIL PS-IN-DRIVER-EOF.                                  02190000
022000                                                                  02200000
022100     PERFORM 6000-EOJ-ROUTINE.                                    02210000
022200     STOP RUN.                                                    02220000
022300                                                                  02230000
022400                                                                  02240000
022500******************************************************************02250026
022600*   INITIALIZATIONS                                              *02260026
022700******************************************************************02270026
022800 1000-INITIALIZE.                                                 02280000
022900                                                                  02290000
023000     MOVE PC-CURRENT-PROGRAM-NAME TO DM-PROGRAM.                  02300014
023100     DISPLAY DM-DISPLAY-MESSAGE.                                  02310014
023200                                                                  02320014
023300     MOVE PC-BEGINNING              TO DP-STATUS-DESCRIPTION.     02330000
023400     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02340000
023500                                                                  02350000
023600     PERFORM 9000-OPEN-IN-DRIVER-FILE.                            02360000
023700     PERFORM 9700-OPEN-OUT-EXTRACT-FILE.                          02370000
023800                                                                  02380000
023900                                                                  02390000
024000******************************************************************02400026
024100*   1) GET NEXT RECORD FROM DRIVER FILE, AND                     *02410026
024200*      1A- POPULATE KEY (WHERE CLAUSE) FOR TABLE CURSOR          *02420026
024300*      1B- OPEN TABLE CURSOR                                     *02430026
024400*      1C- LOOP THRU TABLE CURSOR TO EXTRACT ALL                 *02440026
024500*          ROWS FOR THIS INPUT DRIVER RECORD                     *02450026
024600*      2) FOR EACH ROW,                                          *02460026
024700*         2A- INCREMENT COUNTS                                   *02470026
024800*         2B- WRITE EXTRACT RECORD                               *02480026
024900*      1D- CLOSE TABLE CURSOR                                    *02490026
025000******************************************************************02500026
025100 2000-PROCESS-DRIVER-FILE.                                        02510000
025200                                                                  02520000
025300     PERFORM 9050-READ-IN-DRIVER-FILE.                            02530000
025400     IF PS-IN-DRIVER-EOF                                          02540000
025500        CONTINUE                                                  02550027
025600     ELSE                                                         02560000
025700        PERFORM 2100-CHECK-PGM-PROGRESS                           02570027
025800        PERFORM 3000-EXTRACT-ROWS-FROM-TABLE                      02580027
025900     END-IF.                                                      02590008
026000                                                                  02600000
026100                                                                  02610000
026200******************************************************************02620026
026300*      EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT       *02630026
026400*      RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST     *02640026
026500*      WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.     *02650026
026600******************************************************************02660026
026700 2100-CHECK-PGM-PROGRESS.                                         02670000
026800     DIVIDE    PV-IN-DRIVER-RECS-READ-CNT                         02680000
026900         BY        PC-HOW-OFTEN-TO-DISPLAY                        02690016
027000         GIVING    PV-DISPLAY-NTH-MULTIPLE                        02700016
027100         REMAINDER PV-DISPLAY-NTH-REMAINDER.                      02710016
027200                                                                  02720000
027300     IF PV-DISPLAY-NTH-REMAINDER = ZERO                           02730000
027400         MOVE PC-CONTINUING         TO DP-STATUS-DESCRIPTION      02740000
027500         PERFORM 6200-DISPLAY-PGM-PROGRESS                        02750008
027600     END-IF.                                                      02760008
027700                                                                  02770000
027800                                                                  02780000
027900******************************************************************02790026
028000*   EXTRACT ROWS FROM TABLE, FOR THE CURRENT DRIVER RECORD       *02800026
028100******************************************************************02810026
028200 3000-EXTRACT-ROWS-FROM-TABLE.                                    02820000
028300     INITIALIZE DCLTEXINVC.                                       02830000
028400     PERFORM 9150-SELECT-EXINVC.                                  02840027
028500     IF PS-SELECT-HAS-DATA                                        02850027
028600        PERFORM 9750-WRITE-EXTRACT-RECORD                         02860027
028700        SET PS-SELECT-HAS-NO-DATA TO TRUE                         02870027
028800     END-IF.                                                      02880008
028900                                                                  02890000
029000                                                                  02900000
029100******************************************************************02910026
029200*   DISPLAY END OF RUN MESSAGE, CLOSE THE OUTPUT FILES           *02920026
029300******************************************************************02930026
029400 6000-EOJ-ROUTINE.                                                02940000
029500                                                                  02950000
029600     PERFORM 9090-CLOSE-IN-DRIVER-FILE.                           02960000
029700     PERFORM 9790-CLOSE-OUT-EXTRACT-FILE.                         02970000
029800                                                                  02980000
029900     MOVE PC-ENDING                 TO DP-STATUS-DESCRIPTION.     02990000
030000     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           03000000
030100                                                                  03010000
030200                                                                  03020000
030300******************************************************************03030026
030400*   DISPLAY PROGRAM PROGRESS.                                    *03040026
030500******************************************************************03050026
030600 6200-DISPLAY-PGM-PROGRESS.                                       03060000
030700                                                                  03070000
030800     EXEC SQL                                                     03080000
030900          SET :PV-TMST = CURRENT TIMESTAMP                        03090000
031000     END-EXEC.                                                    03100000
031100                                                                  03110000
031200     MOVE PC-CURRENT-PROGRAM-NAME   TO DP-PROGRAM.                03120000
031300     MOVE PV-TIMESTAMP-19           TO DP-TIMESTAMP-19.           03130004
031400     MOVE PV-IN-DRIVER-RECS-READ-CNT                              03140000
031500                                    TO DP-IN-CNT.                 03150000
031600     MOVE PV-TABLE-ROW-SELECT-CNT   TO DP-ROWS-SELECTED-CNT.      03160000
031700     MOVE PV-EXTRACT-WRITTEN-CNT    TO DP-OUT-CNT.                03170000
031800                                                                  03180000
031900     DISPLAY DP-DISPLAY-PROGRESS-MSG.                             03190000
032000                                                                  03200000
032100                                                                  03210000
032200******************************************************************03220026
032300*   FILE AND DB2 TABLE ACCESS PARAGRAPHS.                        *03230026
032400*   90XX- INPUT:  DRIVER FILE                                    *03240026
032500*   91XX- INPUT:  TABLE CURSOR                                   *03250026
032600*   97XX- OUTPUT: TABLE EXTRACT                                  *03260026
032700******************************************************************03270026
032800                                                                  03280000
032900******************************************************************03290026
033000*   OPEN  INPUT DRIVER FILE                                      *03300026
033100******************************************************************03310026
033200 9000-OPEN-IN-DRIVER-FILE.                                        03320000
033300     OPEN  INPUT  IN-DRIVER-FILE.                                 03330000
033400                                                                  03340000
033500                                                                  03350000
033600******************************************************************03360026
033700*   READ  INPUT DRIVER FILE OF ELIGIBLE DATA TO EXTRACT          *03370026
033800******************************************************************03380026
033900 9050-READ-IN-DRIVER-FILE.                                        03390000
034000     READ IN-DRIVER-FILE                                          03400000
034100          INTO AH001-DRIVER-RECORD-LAYOUT                         03410021
034200          AT END                                                  03420000
034300              SET PS-IN-DRIVER-EOF TO TRUE.                       03430000
034400                                                                  03440000
034500     IF PS-IN-DRIVER-EOF                                          03450000
034600         CONTINUE                                                 03460000
034700     ELSE                                                         03470000
034800         ADD +1 TO PV-IN-DRIVER-RECS-READ-CNT                     03480008
034900     END-IF.                                                      03490008
035000                                                                  03500000
035100                                                                  03510000
035200******************************************************************03520026
035300*   CLOSE INPUT DRIVER FILE                                      *03530026
035400******************************************************************03540026
035500 9090-CLOSE-IN-DRIVER-FILE.                                       03550000
035600     CLOSE IN-DRIVER-FILE.                                        03560000
035700                                                                  03570000
035800                                                                  03580000
035900******************************************************************03590026
036000*   SELECT TEXINVC ROW.                                          *03600027
036100******************************************************************03610026
036200 9150-SELECT-EXINVC.                                              03620027
036300     EXEC SQL                                                     03630000
036400           SELECT                                                 03640027
036500             PO_NBR                                               03650027
036600            ,INVC_ID                                              03660027
036700            ,IMPRT_ENTR_NBR                                       03670027
036800            ,IMPRT_BOL_ID                                         03680027
036900            ,PAYT_REQ_SEQ_NBR                                     03690027
037000           INTO                                                   03700027
037100             :EXINVC-PO-NBR                                       03710027
037200            ,:EXINVC-INVC-ID                                      03720027
037300            ,:EXINVC-IMPRT-ENTR-NBR                               03730027
037400            ,:EXINVC-IMPRT-BOL-ID                                 03740027
037500            ,:EXINVC-PAYT-REQ-SEQ-NBR                             03750027
037600           FROM TEXINVC                                           03760028
037700          WHERE PO_NBR  = :AH001-B-PO-NBR                         03770028
037800            AND INVC_ID = :AH001-B-INVC-ID                        03780028
037900           WITH  UR                                               03790028
038000     END-EXEC.                                                    03800027
038100                                                                  03810027
038200     EVALUATE TRUE                                                03820027
038300         WHEN SQLCODE = ZERO                                      03830027
038400              ADD +1                 TO PV-TABLE-ROW-SELECT-CNT   03840027
038500              SET PS-SELECT-HAS-DATA TO TRUE                      03850027
038600         WHEN SQLCODE = +100                                      03860027
038700              SET PS-SELECT-HAS-NO-DATA TO TRUE                   03870027
038800              MOVE AH001-B-PO-NBR TO PV-PO-NBR                    03880027
038900              MOVE PV-PO-NBR      TO PV-PO-NBR-NUM                03890027
039000              DISPLAY 'NO TEXINVC ROW FOUND FOR'                  03900027
039100              DISPLAY 'PO NBR : ' PV-PO-NBR-NUM                   03910027
039200              DISPLAY 'INVC ID: ' AH001-B-INVC-ID                 03920027
039300         WHEN SQLWARN0 NOT EQUAL SPACE                            03930027
039400         WHEN SQLCODE NOT EQUAL ZERO                              03940027
039500              MOVE '9150-SELECT-EXINVC'                           03950027
039600                                 TO PV-PARAGRAPH-NAME             03960027
039700              MOVE 'SELECT ROW ON TEXINVC'                        03970027
039800                                 TO PV-DB2-OPERATION-MSG-1        03980027
039900              MOVE 'TEXINVC'     TO PV-DB2-TABLE-NAME             03990027
040000              PERFORM 9999-DB2-ABEND                              04000027
040100     END-EVALUATE.                                                04010027
040200                                                                  04020027
040300                                                                  04030027
040400******************************************************************04040027
040500*   OPEN OUTPUT EXTRACT FILE                                     *04050027
040600******************************************************************04060027
040700 9700-OPEN-OUT-EXTRACT-FILE.                                      04070027
040800     OPEN OUTPUT OUT-EXTRACT-FILE.                                04080027
040900                                                                  04090027
041000                                                                  04100027
041100******************************************************************04110027
041200*   WRITE A RECORD TO THE TABLE EXTRACT FILE                     *04120027
041300******************************************************************04130027
041400 9750-WRITE-EXTRACT-RECORD.                                       04140027
041500     WRITE  OUT-EXTRACT-RECORD  FROM  DCLTEXINVC.                 04150027
041600     ADD +1 TO PV-EXTRACT-WRITTEN-CNT.                            04160027
041700                                                                  04170027
041800                                                                  04180027
041900******************************************************************04190027
042000*   CLOSE OUTPUT EXTRACT FILE                                    *04200027
042100******************************************************************04210027
042200 9790-CLOSE-OUT-EXTRACT-FILE.                                     04220027
042300     CLOSE OUT-EXTRACT-FILE.                                      04230027
042400                                                                  04240027
042500                                                                  04250027
042600******************************************************************04260027
042700*   DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT *04270027
042800*   AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN            *04280027
042900*   SQL ERROR OR WARNING CODE OCCURS.                            *04290027
043000******************************************************************04300027
043100 9999-DB2-ABEND.                                                  04310027
043200                                                                  04320027
043300     DISPLAY PC-CURRENT-PROGRAM-NAME                              04330027
043400             ' 9999-DB2-ABEND'.                                   04340027
043500     DISPLAY PC-CURRENT-PROGRAM-NAME                              04350027
043600             ' ** ABEND           **'.                            04360027
043700     DISPLAY PC-CURRENT-PROGRAM-NAME                              04370027
043800             ' ** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.       04380027
043900     DISPLAY PC-CURRENT-PROGRAM-NAME                              04390027
044000             ' ** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME.       04400027
044100     DISPLAY PC-CURRENT-PROGRAM-NAME                              04410027
044200             ' ** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.  04420027
044300                                                                  04430027
044400     DISPLAY PC-CURRENT-PROGRAM-NAME                              04440027
044500             ' ** SQLCODE         ** = ' SQLCODE.                 04450027
044600     MOVE SQLCODE TO PV-SQLCODE.                                  04460027
044700     DISPLAY PC-CURRENT-PROGRAM-NAME                              04470027
044800             ' ** PV-SQLCODE      ** = ' PV-SQLCODE '.'.          04480027
044900                                                                  04490027
045000     DISPLAY PC-CURRENT-PROGRAM-NAME                              04500027
045100             ' ** SQLWARN0        ** = ' SQLWARN0 '.'.            04510027
045200                                                                  04520027
045300                                                                  04530027
045400*----------------------------------------------------------------*04540027
045500* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *04550027
045600* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *04560027
045700* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *04570027
045800* FORMAT.                                                        *04580027
045900*----------------------------------------------------------------*04590027
046000     COPY DPPD004.                                                04600027
046100                                                                  04610027
046200     MOVE PC-ABENDING               TO DP-STATUS-DESCRIPTION.     04620027
046300     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           04630027
046400     PERFORM 9090-CLOSE-IN-DRIVER-FILE.                           04640027
046500     PERFORM 9790-CLOSE-OUT-EXTRACT-FILE.                         04650027
046600                                                                  04660027
046700*----------------------------------------------------------------*04670027
046800* CALL ABEND                                                     *04680027
046900*----------------------------------------------------------------*04690027
047000     MOVE +4013                  TO ABEND-CODE.                   04700027
047100     CALL 'ILBOABN0' USING ABEND-CODE.                            04710027
047200*                                                                 04720027
