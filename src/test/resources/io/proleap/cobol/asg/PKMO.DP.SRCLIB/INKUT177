       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.              INKUT177.                                       
       AUTHOR.                  JULIE SEIDLER.                                  
       INSTALLATION.            KOHLS DEPARTMENT STORES.                        
       DATE-WRITTEN.            01/29/99.                                       
       DATE-COMPILED.                                                           
      ******************************************************************        
      *          ADD HEADERS TO SHEET INVENTORY FILES                           
      *                                                                *        
      *  THE FILE COMING INTO THE PROGRAM WILL CONTAIN SEVERAL STORE.           
      *  SOME OF THOSE STORE NEED TO BE TAKEN OUT AND PROCESSED LATER.          
      *                                                                *        
      *  THIS PGM ADDS A HEADER RECORD TO EACH GROUP OF STORE DATA.             
      *  WILL CREATE FILES FOR STORES LISTED ON THE INPUT CONTROL CARD.*        
      *  TO PROCESS ALL STORES, THE CONTROL CARD WILL CONTAIN ***               
      *  IN THE STORE NUMBER FIELD.                                             
      *                                                                         
      *    MARIA KLAMIK 02/02/99 - ADDED INWS005 AS NEW INPUT COPYBOOK *        
      *       AND CHANGED INWS018 TO BE THE OUTPUT COPYBOOK WITH THE   *        
      *       NEW TIMESTAMP FIELDS.                                    *        
      *                                                                         
      *    JULIE SEIDLER 10/06/99 -                                             
      *       ADDED LOGIC TO OBTAIN SHEET INVENTORY DATA EITHER FROM   *        
      *       AN OUTSIDE TAPE OR FROM THE DB2 TABLE TINENTY.                    
      *                                                                         
      *       BEFORE DATA IS WRITTEN TO THE OUTPUT, THE SHEET-INV-STATUS        
      *       INDICATOR ON TINVPAR IS CHECKED AND THEN UPDATED.                 
      ******************************************************************        
      *    SCOTT JACKSON 03/20/2001                                             
      *                                                                         
      *    PARA Z400-UPDATE-TINVPAR-ROW DOES NOT REQUIRE ACT_INV_RECD_DT        
      *    TO BE '9999-09-09'. THIS DATE WILL BE SET IF CS/RV FILE WAS          
      *    PROCESSED. THIS WILL PREVENT DB2 ABENDS IF 'SHEETS' ARE ALSO         
      *    BEING PROCESSED FOR THE SAME LOCATIONS.                              
      ******************************************************************        
W05091*    ROD JANSSEN   05/25/2001                                             
W05091*    AUTOMATE SHEET PROCESSING.                                           
W21732******************************************************************INKUT104
W21732*    11/02   J.S.NAVIS RAJA,IGSI       WR# 21732                          
W21732*    DEPT/CLASS/SEQ ARE REPLACED WITH 8 DIGIT NON-INTELLIGENT SKU.        
      ******************************************************************        
25248 * 25248    10-06-2003  UPC CAPABILITIES                                   
25248 *                      -ROD JANSSEN                                       
25248 ******************************************************************        
RONNAM* 25248    11-14-2003  REMOVE LOGIC USED FOR TAPE PROCESSING              
RONNAM*                      -RONNA MCDONALD                                    
W28545* W28545  08-22-2005 ROD JANSSEN THE NEW TRANSFER PROCESS                 
RONNAM******************************************************************        
W29908* 29908    01-27-2006  INCREASE INTERNAL TABLES FROM 51 TO 999            
W29908* PM00844280           -RONNA MCDONALD                                    
W30692*W30692* 06-23-2006 ROD JANSSEN RTV SNAPSHOT ISSUE AND VOLUME             
P28545* W28545 03-24-2006 ROD JANSSEN CYCLE INVENTORY PRICE MODULE SETUP        
P28545*                               (TINCNTL/TINVPAR MODIFICATIONS)           
W29908******************************************************************        
W33304* 33304    06-19-2008  HILO CHANGES   -  ADDLN COND ON WHERE              
W33304* W33304               -PATTY JAEGER  - CODEWORKS                         
W33304******************************************************************        
SR3403******************************************************************        
SR3403* SR3403   03-30-2012  RECOMPILE   -  LARGE RETAIL PROJECT                
SR3403* SR3403               -ANUJ GUPTA                                        
SR3403******************************************************************        
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
RONNAM*    SELECT SHEET-INV-IN                                                  
RONNAM*        ASSIGN TO INP01.                                                 
RONNAM*                                                                         
RONNAM*    SELECT INPUT-SOURCE                                                  
RONNAM*        ASSIGN TO INP02.                                                 
RONNAM*                                                                         
           SELECT SHEET-PLUS-HDR-OUT                                            
               ASSIGN TO OUT01.                                                 
                                                                                
           SELECT STORE-CONTROL-CARD                                            
W05091         ASSIGN TO OUT02.                                                 
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
RONNAM*FD  SHEET-INV-IN                                                         
RONNAM*    RECORDING MODE IS F                                                  
RONNAM*    LABEL RECORDS ARE OMITTED                                            
RONNAM*    RECORD CONTAINS 48 CHARACTERS                                        
RONNAM*    DATA RECORD IS SHEET-INV-REC.                                        
RONNAM*01  SHEET-INV-REC         PIC X(048).                                    
                                                                                
RONNAM*FD  INPUT-SOURCE                                                         
RONNAM*    RECORDING MODE IS F                                                  
RONNAM*    LABEL RECORDS ARE OMITTED                                            
RONNAM*    RECORD CONTAINS 80 CHARACTERS                                        
RONNAM*    DATA RECORD IS STORE-CONTROL-CARD-REC.                               
RONNAM*01  INPUT-SOURCE-RECORD    PIC X(80).                                    
RONNAM*                                                                         
       FD  SHEET-PLUS-HDR-OUT                                                   
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE OMITTED                                            
           RECORD CONTAINS 58 CHARACTERS                                        
           DATA RECORD IS SHEET-PLUS-HDR-REC.                                   
       01  SHEET-PLUS-HDR-REC     PIC X(58).                                    
                                                                                
       FD  STORE-CONTROL-CARD                                                   
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE OMITTED                                            
           RECORD CONTAINS 80 CHARACTERS                                        
           DATA RECORD IS STORE-CONTROL-CARD-REC.                               
       01  STORE-CONTROL-CARD-REC PIC X(80).                                    
                                                                                
       EJECT                                                                    
       WORKING-STORAGE SECTION.                                                 
                                                                                
       01  PV-PROGRAM-VARIABLES.                                                
           05  PV-PARAGRAPH-NAME       PIC X(25)       VALUE SPACE.             
           05  PV-OPERATION-ATTEMPTED  PIC X(30)       VALUE SPACE.             
           05  PV-ABEND-MESSAGE        PIC X(50)       VALUE SPACE.             
           05  PV-STORE-REC-COUNT      PIC 9(6)        VALUE ZERO.              
           05  PV-TOTAL-REC-COUNT      PIC 9(6)        VALUE ZERO.              
           05  PV-CC-STORE-COUNT       PIC 9(4)        VALUE ZERO.              
           05  PV-LINE-NUMBER          PIC 9(04)      VALUE ZERO.               
           05  PV-STR-NBR              PIC S9(04) COMP VALUE ZERO.              
           05  PV-PREV-SHEET-NBR       PIC 9(09)  COMP VALUE ZERO.              
25248      05  PV-TINVPAR-STR-NBR      PIC 9(04).                               
25248      05  PV-TINVPAR-STR-NBR-CHAR REDEFINES                                
25248          PV-TINVPAR-STR-NBR      PIC X(04).                               
W05091***  05  PV-RUN-TYPE             PIC X(4)       VALUE SPACES.             
   |  ***      88  PV-TAPE-INPUT       VALUE 'TAPE'.                            
   |  ***      88  PV-DB2-INPUT        VALUE 'DB2 '.                            
RONNAM*    05  PV-INPUT-SOURCE.                                                 
RONNAM*        10  FILLER              PIC X(1)       VALUE SPACES.             
RONNAM*        10  PV-RUN-TYPE         PIC X(1)       VALUE SPACES.             
RONNAM*            88  PV-TAPE-INPUT   VALUE '0'.                               
RONNAM*            88  PV-DB2-INPUT    VALUE '1'.                               
RONNAM*            88  PV-VALID-SOURCE VALUE '0', '1'.                          
RONNAM*        10  PV-REST-OF-RECORD   PIC X(79)      VALUE SPACES.             
W21732     05  PV-TEMP-SKU             PIC 9(8).                                
25248      05  PV-TEMP-UPC             PIC 9(15).                               
25248******    10  PV-TEMP-UPC-P1      PIC 9(02).                               
25248******    10  PV-TEMP-UPC-P2      PIC 9(13).                               
                                                                                
       01  PC-PROGRAM-CONSTANTS.                                                
           05  PC-PROGRAM-NAME         PIC X(08)      VALUE 'INKUT177'.         
           05  PC-MAX-LINES            PIC 9(04)      VALUE 0025.               
           05  PC-MAX-CC-STORES        PIC 9(03)      VALUE 050.                
           05  PC-EMPTY-DATE           PIC X(10)     VALUE '9999-09-09'.        
           05  PC-HEADER-RECORD        PIC X(48)      VALUE                     
               'HEADER RECORD                                 '.                
                                                                                
       01  CC-CONTROL-CARD.                                                     
25248      05  CC-STORE-NBR            PIC 9(04)      VALUE ZEROS.              
           05  FILLER                  PIC X(01)      VALUE SPACES.             
           05  CC-DATA-SOURCE          PIC X(04).                               
               88  CC-VALID-SOURCE     VALUE 'DB2 ', 'TAPE', '    '.            
                                                                                
W29908 01  WS-STORE-TABLE-RDF.                                                  
W29908     05  WS-STORE-TAB OCCURS 999 TIMES                                    
                            INDEXED BY ST-INDEX.                                
W29908         10  WS-STORE-NMBR       PIC 9(04) VALUE ZERO.                    
P28545         10  WS-INV-ID           PIC S9(09) COMP VALUE ZERO.              
                                                                                
       01  SA-SAVE-AREA.                                                        
25248      05  SA-STORE-NBR            PIC 9(04)      VALUE ZERO.               
           05  SA-STORE-NBR-DB2        PIC S9(04) COMP VALUE ZERO.              
                                                                                
       01  PS-SWITCHES.                                                         
W05091     05  END-OF-INP-SOURCE-SW        PIC X       VALUE 'N'.               
W05091         88  END-OF-INP-SOURCE                   VALUE 'Y'.               
RONNAM*    05  END-OF-SHEET-INV-IN-SW      PIC X       VALUE 'N'.               
RONNAM*        88  END-OF-SHEET-INV                    VALUE 'Y'.               
           05  END-OF-TINENTY-CSR-SW       PIC X       VALUE 'N'.               
               88  END-OF-TINENTY-CSR                  VALUE 'Y'.               
               88  NOT-END-OF-TINENTY-CSR              VALUE 'N'.               
           05  END-OF-TINENTY-ALL-STR-CSR-SW PIC X     VALUE 'N'.               
               88  END-OF-TINENTY-ALL-STR-CSR          VALUE 'Y'.               
           05  END-OF-CONTROL-CARD-SW      PIC X       VALUE 'N'.               
               88  END-OF-STORE-CC                     VALUE 'Y'.               
           05  END-OF-STORE-TABLE-SW       PIC X       VALUE 'N'.               
               88  END-OF-STORE-TAB                    VALUE 'Y'.               
           05  PROCESS-ALL-STORES-SW       PIC X       VALUE 'N'.               
               88  PROCESS-ALL-STORES                  VALUE 'Y'.               
           05  FIRST-CC-READ-SW            PIC X       VALUE 'Y'.               
               88  FIRST-CC-READ                       VALUE 'Y'.               
               88  NOT-FIRST-CC-READ                   VALUE 'N'.               
           05  FIRST-FETCH-FOR-STR-SW      PIC X       VALUE 'Y'.               
               88  FIRST-FETCH-FOR-STORE               VALUE 'Y'.               
               88  NOT-FIRST-FETCH-FOR-STORE           VALUE 'N'.               
           05  MATCHING-STORE-SW           PIC X       VALUE 'N'.               
               88  STORE-MATCH                         VALUE 'Y'.               
               88  NO-STORE-MATCH                      VALUE 'N'.               
                                                                                
       01  ABEND-CODE                          PIC S9(04)  VALUE +4003          
                                                           COMP SYNC.           
                                                                                
RONNAM*****************************************************************         
RONNAM*  INVENTORY DATA FILE LAYOUT - INPUT                                     
RONNAM*****************************************************************         
RONNAM*    COPY INWS005.                                                        
                                                                                
      *****************************************************************         
      *  INVENTORY DATA FILE LAYOUT - OUTPUT                                    
      *****************************************************************         
25248      COPY INWS018.                                                        
                                                                                
      ****************************************************                      
      *  ERROR MESSAGE AREA FOR DB2                      *                      
      ****************************************************                      
           COPY DPWS004.                                                        
                                                                                
      ****************************************************                      
      *  DB2 TINENTY TABLE - INVENTORY ENTRY TABLE       *                      
      ****************************************************                      
           EXEC SQL                                                             
               INCLUDE TINENTY                                                  
           END-EXEC.                                                            
                                                                                
      ****************************************************                      
      *  DB2 TINVPAR TABLE - INVENTORY PARMS TABLE       *                      
      ****************************************************                      
           EXEC SQL                                                             
               INCLUDE TINVPAR                                                  
           END-EXEC.                                                            
                                                                                
P28545****************************************************                      
P28545*  DB2 TINCNTL TABLE - INVENTORY CONTROL TABLE     *                      
P28545****************************************************                      
P28545     EXEC SQL                                                             
P28545         INCLUDE TINCNTL                                                  
P28545     END-EXEC.                                                            
P28545                                                                          
      ****************************************************                      
      *  COMMUNICATION AREAS FOR DB2                     *                      
      ****************************************************                      
           EXEC SQL                                                             
               INCLUDE SQLCA                                                    
           END-EXEC.                                                            
                                                                                
      ****************************************************                      
      *  THIS CURSOR WILL DRIVE PROGRAM PROCESSING      **                      
      ****************************************************                      
           EXEC SQL                                                             
               DECLARE TINENTY_CSR CURSOR WITH HOLD FOR                         
                SELECT  STR_NBR                                                 
                       ,SHEET_TYP_CDE                                           
                       ,SHEET_NBR                                               
                       ,LNE_NBR                                                 
W21732                 ,SKU_NBR                                                 
25248                  ,UPC_NBR                                                 
                       ,INV_QTY                                                 
                       ,UNT_RTL_AMT                                             
                       ,EXTD_RTL_AMT                                            
                  FROM TINENTY                                                  
W21732           WHERE STR_NBR = :INENTY-STR-NBR                                
W28545             AND SHEET_TYP_CDE IN ('K','T','M')                           
                 ORDER BY SHEET_NBR                                             
                         ,LNE_NBR                                               
           END-EXEC.                                                            
                                                                                
      ****************************************************                      
      *  THIS CURSOR WILL DRIVE PROGRAM PROCESSING      **                      
      ****************************************************                      
           EXEC SQL                                                             
               DECLARE TINENTY_ALL_STR CURSOR WITH HOLD FOR                     
                SELECT  STR_NBR                                                 
                       ,SHEET_TYP_CDE                                           
                       ,SHEET_NBR                                               
                       ,LNE_NBR                                                 
W21732                 ,SKU_NBR                                                 
25248                  ,UPC_NBR                                                 
                       ,INV_QTY                                                 
                       ,UNT_RTL_AMT                                             
                       ,EXTD_RTL_AMT                                            
                 FROM TINENTY                                                   
W28545           WHERE SHEET_TYP_CDE IN ('K','T','M')                           
                 ORDER BY STR_NBR                                               
                         ,SHEET_NBR                                             
                         ,LNE_NBR                                               
           END-EXEC.                                                            
                                                                                
W05091*********************************************************                 
  |   * TINVPAR ON-LINE SHEETS NOT PROCESSED                            INKCS046
  |   *********************************************************                 
  |        EXEC SQL                                                     INKCS046
W05091       DECLARE ONLINE-SHEETS-CSR CURSOR FOR                       INKCS046
25248          SELECT LOC_NBR                                           INKCS046
W05091               ,ACTL_FIN_BK_DTE                                   INKCS046
W05091               ,SHEET_INV_CPLD_IND                                INKCS046
P28545               ,A.INV_ID                                                  
P28545         FROM TINVPAR A,                                          INKCS046
P28545              TINCNTL B                                                   
P28545         WHERE B.ACTV_IND = 'Y'                                           
P28545           AND A.INV_ID = B.INV_ID                                        
W33304           AND A.LOC_INV_STAT_CDE = 'IN'                                  
P28545           AND ACTL_FIN_BK_DTE = '9999-09-09'                     INKCS046
W05091           AND SHEET_INV_CPLD_IND = 'S'                           INKCS046
25248          ORDER BY LOC_NBR                                         INKCS046
P28545         WITH UR                                                          
W05091     END-EXEC.                                                    INKCS046
W05091                                                                  INKCS046
       PROCEDURE DIVISION.                                                      
                                                                                
       A100-MAIN-MODULE.                                                        
      ******************************************************************        
      *  MAIN RPOCESSING.                                                       
      ******************************************************************        
                                                                                
           PERFORM B100-HOUSEKEEPING.                                           
                                                                                
           SET ST-INDEX TO 1                                                    
RONNAM*    IF PV-TAPE-INPUT                                                     
RONNAM*        PERFORM C100-PROCESS-TAPE                                        
RONNAM*    ELSE                                                                 
               PERFORM D100-PROCESS-DB2                                         
                   UNTIL END-OF-STORE-TAB                                       
                      OR END-OF-TINENTY-ALL-STR-CSR.                            
RONNAM*               OR END-OF-TINENTY-ALL-STR-CSR                             
RONNAM*    END-IF.                                                              
                                                                                
           PERFORM B300-EOJ.                                                    
                                                                                
           STOP RUN.                                                            
      *                                                                         
      ******************************************************************        
      * B100-HOUSEKEEPING.                                                      
      ******************************************************************        
       B100-HOUSEKEEPING.                                                       
                                                                                
RONNAM*    OPEN INPUT SHEET-INV-IN                                              
RONNAM*         INPUT INPUT-SOURCE                                              
RONNAM     OPEN                                                                 
W05091          OUTPUT STORE-CONTROL-CARD                                       
                OUTPUT SHEET-PLUS-HDR-OUT.                                      
                                                                                
W05091*** DETERMINE WHERE THE SOURCE OF SHEETS ARE COMING FROM....              
RONNAM*    PERFORM Z500-READ-INPUT-SOURCE.                                      
  |                                                                             
  |   *** LOAD THE SELECTED SHEETS FROM THE DATABASES..                         
W05091     PERFORM Z200-OPEN-CURSOR.                                            
           PERFORM B110-LOAD-WS-STORE-TABLE                                     
               UNTIL END-OF-STORE-CC.                                           
W05091     PERFORM Z300-CLOSE-CURSOR.                                           
W05091                                                                          
      ******************************************************************        
      *                                                                         
      ******************************************************************        
       B110-LOAD-WS-STORE-TABLE.                                                
                                                                                
           PERFORM Z110-READ-STORE-CC.                                          
                                                                                
           IF FIRST-CC-READ                                                     
               IF END-OF-STORE-CC                                               
                   DISPLAY '* * * * * * * * * * * * * * *'                      
                   DISPLAY '**  '                                               
                   DISPLAY '** NO STORES TO PROCESS'                            
                   DISPLAY '**  '                                               
                   DISPLAY '* * * * * * * * * * * * * * *'                      
W05091             MOVE 4052         TO RETURN-CODE                             
W05091********     MOVE 'B110-LOAD-WS-STORE-TABLE' TO PV-PARAGRAPH-NAME         
W05091********     PERFORM 9999-ABEND                                           
               END-IF                                                           
           END-IF.                                                              
                                                                                
      * * * * * * * * * * * * * * * * * * * * * * * * * * * *                   
      * ALL STORES WILL BE PROCESSED WHEN THE INPUT CONTROL CARD                
      * STORE NUMBER EQUALS "***"                                               
      * * * * * * * * * * * * * * * * * * * * * * * * * * * *                   
           IF END-OF-STORE-CC                                                   
               CONTINUE                                                         
           ELSE                                                                 
               ADD 1 TO PV-CC-STORE-COUNT                                       
W05091***      IF PV-CC-STORE-COUNT > PC-MAX-CC-STORES                          
   |  ***          DISPLAY '* * * * * * * * * * * * * * *'                      
   |  ***          DISPLAY '** INPUT STORE CONTROL CARD HAS MORE THAN '         
   |  ***                   PC-MAX-CC-STORES ' STORES'                          
   |  ***          DISPLAY '** CHANGE CONTROL CARD OR CHANGE PROGRAM '          
   |  ***          DISPLAY '* * * * * * * * * * * * * * *'                      
   |  ***          MOVE 'B110-LOAD-WS-STORE-TABLE' TO PV-PARAGRAPH-NAME         
   |  ***          PERFORM 9999-ABEND                                           
   |  ***      END-IF                                                           
   |           IF FIRST-CC-READ                                                 
   |               SET NOT-FIRST-CC-READ TO TRUE                                
RONNAM*          IF PV-RUN-TYPE IS EQUAL TO '0'                                 
RONNAM*            DISPLAY '*******************'                                
RONNAM*            DISPLAY '* INVENTORY INPUT WILL BE OBTAINED FROM '           
RONNAM*                PV-RUN-TYPE, ' TAPE'                                     
RONNAM*            DISPLAY '*******************'                                
RONNAM*          ELSE                                                           
RONNAM*            DISPLAY '*******************'                                
RONNAM*            DISPLAY '* INVENTORY INPUT WILL BE OBTAINED FROM '           
RONNAM*                PV-RUN-TYPE, ' DB2'                                      
RONNAM*            DISPLAY '*******************'                                
RONNAM*          END-IF                                                         
   |           END-IF                                                           
   |  ***      IF CC-STORE-NBR EQUAL '***'                                      
   |  ***          SET PROCESS-ALL-STORES TO TRUE                               
   |  ***          DISPLAY '* * * * * * * * * * * * * * *'                      
   |  ***          DISPLAY '*  PROCESSING ALL STORES    *'                      
   |  ***          DISPLAY '* * * * * * * * * * * * * * *'                      
   |  ***      ELSE                                                             
W05091             MOVE INVPAR-LOC-NBR TO WS-STORE-NMBR(ST-INDEX)               
P28545             MOVE INVPAR-INV-ID  TO WS-INV-ID (ST-INDEX)                  
W05091             DISPLAY 'STORE  '  WS-STORE-NMBR(ST-INDEX),                  
P28545                     ' INV_ID '  WS-INV-ID (ST-INDEX),                    
W05091                     ' WILL BE PROCESSED '                                
                   SET ST-INDEX UP BY 1                                         
                                                                                
      * * * * * * * * * * * * * * * * * * * * * * * * * * * *                   
      * VALIDATE THE INPUT SOURCE CODE ON THE INPUT CONTROL CARD                
      * THE INPUT SOURCE CODE MUST BE THE SAME ON ALL STORE RECORDS             
      * * * * * * * * * * * * * * * * * * * * * * * * * * * *                   
W05091***      IF (CC-VALID-SOURCE)                                             
  |   ***        AND (CC-DATA-SOURCE = PV-RUN-TYPE)                             
  |   ***          CONTINUE                                                     
  |   ***      ELSE                                                             
RONNAM*        IF (NOT PV-VALID-SOURCE)                                         
RONNAM*            DISPLAY '* * * * * * * * * * * * * * *'                      
RONNAM*            DISPLAY '** INVALID INPUT SOURCE CODE ON CNTL CARD'          
RONNAM*            DISPLAY '** ' PV-RUN-TYPE                                    
RONNAM*            DISPLAY '* * * * * * * * * * * * * * *'                      
RONNAM*            MOVE 'B110-LOAD-WS-STORE-TABLE' TO PV-PARAGRAPH-NAME         
RONNAM*            PERFORM 9999-ABEND                                           
RONNAM*        END-IF                                                           
           END-IF.                                                              
                                                                                
W05091*** BUILD THE CONTROL CARD FOR INK307.....                                
  |                                                                             
  |        IF END-OF-STORE-CC                                                   
  |            CONTINUE                                                         
  |        ELSE                                                                 
  |            MOVE SPACES           TO CC-CONTROL-CARD                         
  |            MOVE INVPAR-LOC-NBR TO CC-STORE-NBR                              
  |            WRITE STORE-CONTROL-CARD-REC FROM CC-CONTROL-CARD                
  |        END-IF.                                                              
W05091                                                                          
       B300-EOJ.                                                                
      ******************************************************************        
      *    CLOSE THE FILES.                                                     
      ******************************************************************        
                                                                                
           DISPLAY '**  TOTAL REC COUNT  '                                      
               PV-TOTAL-REC-COUNT.                                              
                                                                                
           IF PV-TOTAL-REC-COUNT = ZERO                                         
               DISPLAY '* * * * * * * * * * * * * * *'                          
               DISPLAY '** NO RECORDS WRITTEN OUT.  *'                          
               DISPLAY '* * * * * * * * * * * * * * *'                          
W05091         MOVE 4052         TO RETURN-CODE                                 
W05091*****    MOVE 'B300-EOJ' TO PV-PARAGRAPH-NAME                             
W05091*****    PERFORM 9999-ABEND                                               
           END-IF.                                                              
                                                                                
RONNAM*    CLOSE SHEET-INV-IN                                                   
RONNAM*          INPUT-SOURCE                                                   
RONNAM     CLOSE                                                                
                 STORE-CONTROL-CARD                                             
                 SHEET-PLUS-HDR-OUT.                                            
                                                                                
      ******************************************************************        
      *                                                                         
      ******************************************************************        
RONNAM*C100-PROCESS-TAPE.                                                       
RONNAM*    PERFORM Z100-READ-SHEET-INV.                                         
RONNAM*                                                                         
RONNAM*    IF END-OF-SHEET-INV                                                  
RONNAM*        DISPLAY  'INPUT SHEET INVENTORY FILE IS EMPTY'                   
RONNAM*        DISPLAY  'INPUT SHEET INVENTORY FILE IS EMPTY'                   
RONNAM*        DISPLAY  'INPUT SHEET INVENTORY FILE IS EMPTY'                   
RONNAM*    END-IF.                                                              
RONNAM*                                                                         
RONNAM*    PERFORM C200-PROCESS-INPUT                                           
RONNAM*        UNTIL END-OF-SHEET-INV.                                          
                                                                                
                                                                                
                                                                                
      ******************************************************************        
      *  THIS ROUTINE WILL READ THE INPUT SHEET FILE AND DETERMINE              
      *  IF THE STORE NEEDS TO BE SELECTED. IF THE STORE WAS                    
      *  IN THE INPUT CONTROL CARD TABLE, THE STORE RECORDS WILL BE             
      *  WRITTEN TO THE OUTPUT FILE                                             
      ******************************************************************        
RONNAM*C200-PROCESS-INPUT.                                                      
RONNAM*                                                                         
RONNAM*    IF (NOT PROCESS-ALL-STORES)                                          
RONNAM*        SET ST-INDEX TO 1                                                
RONNAM*        SEARCH WS-STORE-TAB                                              
RONNAM*            VARYING ST-INDEX                                             
RONNAM*            WHEN WS-STORE-NMBR (ST-INDEX) = IN005-STORE-NUMBER           
RONNAM*                SET STORE-MATCH TO TRUE                                  
RONNAM*            WHEN WS-STORE-NMBR (ST-INDEX) = ZEROES                       
RONNAM*                SET NO-STORE-MATCH TO TRUE                               
RONNAM*    END-IF.                                                              
RONNAM*                                                                         
RONNAM*    MOVE +0 TO PV-STORE-REC-COUNT.                                       
RONNAM*                                                                         
RONNAM*    IF STORE-MATCH OR PROCESS-ALL-STORES                                 
      *        WHEN THE HEADER IS WRITTEN, TINVPAR IS ALSO UPDATED              
      *                                                                         
RONNAM*        PERFORM Z903-WRITE-HEADER-REC                                    
RONNAM*        PERFORM Z900-WRITE-OUTPUT-REC                                    
RONNAM*    END-IF.                                                              
                                                                                
RONNAM*    MOVE IN005-STORE-NUMBER TO SA-STORE-NBR.                             
RONNAM*                                                                         
RONNAM*    PERFORM Z100-READ-SHEET-INV                                          
RONNAM*        UNTIL IN005-STORE-NUMBER NOT = SA-STORE-NBR                      
RONNAM*          OR END-OF-SHEET-INV.                                           
RONNAM*                                                                         
RONNAM*    IF STORE-MATCH OR PROCESS-ALL-STORES                                 
RONNAM*        DISPLAY 'STR ' SA-STORE-NBR ' OUTPUT REC COUNT '                 
RONNAM*                  PV-STORE-REC-COUNT                                     
RONNAM*        COMPUTE PV-TOTAL-REC-COUNT =                                     
RONNAM*            PV-TOTAL-REC-COUNT + PV-STORE-REC-COUNT                      
RONNAM*    END-IF.                                                              
                                                                                
      ******************************************************************        
      * THIS ROUTINE WILL READ EACH STORE IN THE WS-CONTROL-CARD-STORE-         
      * TABLE. FOR EACH STORE, A CURSOR WILL BE OPENED TO OBTAIN ALL            
      * THE STORE'S ROW ON TINENTY TABLE.                                       
      ******************************************************************        
       D100-PROCESS-DB2.                                                        
                                                                                
           IF PROCESS-ALL-STORES                                                
               PERFORM D220-OPEN-TINENTY-ALL-STR-CSR                            
               PERFORM D222-FETCH-TINENTY-ALL-STR-CSR                           
                   UNTIL END-OF-TINENTY-ALL-STR-CSR                             
               PERFORM D223-CLOSE-TINENTY-ALL-STR-CSR                           
           ELSE                                                                 
               IF WS-STORE-NMBR(ST-INDEX) = ZERO                                
                   SET END-OF-STORE-TAB TO TRUE                                 
                   COMPUTE PV-TOTAL-REC-COUNT =                                 
                       PV-TOTAL-REC-COUNT + PV-STORE-REC-COUNT                  
               ELSE                                                             
                   MOVE WS-STORE-NMBR(ST-INDEX) TO PV-STR-NBR                   
                   COMPUTE PV-TOTAL-REC-COUNT =                                 
                       PV-TOTAL-REC-COUNT + PV-STORE-REC-COUNT                  
                   MOVE +0 TO PV-STORE-REC-COUNT                                
                   MOVE ZERO TO PV-LINE-NUMBER                                  
                   PERFORM D210-OPEN-TINENTY-CURSOR                             
                   PERFORM D211-FETCH-TINENTY-CURSOR                            
                       UNTIL END-OF-TINENTY-CSR                                 
                   PERFORM D212-CLOSE-TINENTY-CURSOR                            
                   SET NOT-END-OF-TINENTY-CSR TO TRUE                           
                   SET FIRST-FETCH-FOR-STORE TO TRUE                            
                   DISPLAY 'STR ' PV-STR-NBR ' OUTPUT REC COUNT '               
                       PV-STORE-REC-COUNT                                       
               END-IF                                                           
               SET ST-INDEX UP BY 1                                             
           END-IF.                                                              
                                                                                
      ******************************************************************        
      *    OPEN CURSOR                                                          
      ******************************************************************        
       D210-OPEN-TINENTY-CURSOR.                                                
                                                                                
W21732     MOVE  PV-STR-NBR     TO   INENTY-STR-NBR.                            
                                                                                
           EXEC SQL                                                             
               OPEN TINENTY_CSR                                                 
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
               WHEN 0                                                           
                    CONTINUE                                                    
               WHEN OTHER                                                       
                  MOVE 'D210-OPEN-TINENTY-CURSOR' TO PV-PARAGRAPH-NAME          
                  MOVE 'OPEN TINENTY'         TO PV-OPERATION-ATTEMPTED         
                  PERFORM 9999-SQL-ABEND                                        
           END-EVALUATE.                                                        
                                                                                
                                                                                
      ******************************************************************        
      *    FETCH CURSOR                                                         
      ******************************************************************        
       D211-FETCH-TINENTY-CURSOR.                                               
                                                                                
           EXEC SQL                                                             
                  FETCH TINENTY_CSR                                             
                   INTO :INENTY-STR-NBR                                         
                       ,:INENTY-SHEET-TYP-CDE                                   
                       ,:INENTY-SHEET-NBR                                       
                       ,:INENTY-LNE-NBR                                         
W21732                 ,:INENTY-SKU-NBR                                         
25248                  ,:INENTY-UPC-NBR                                         
                       ,:INENTY-INV-QTY                                         
                       ,:INENTY-UNT-RTL-AMT                                     
                       ,:INENTY-EXTD-RTL-AMT                                    
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = +0                                                
                   IF FIRST-FETCH-FOR-STORE                                     
      ******          WHEN THE HEADER IS WRITTEN, TINVPAR IS ALSO               
      ******          UPDATE                                                    
                       PERFORM Z903-WRITE-HEADER-REC                            
                       SET NOT-FIRST-FETCH-FOR-STORE TO TRUE                    
                   END-IF                                                       
                   PERFORM Z900-WRITE-OUTPUT-REC                                
               WHEN SQLCODE = +100                                              
                   SET END-OF-TINENTY-CSR TO TRUE                               
               WHEN OTHER                                                       
                  DISPLAY '*****'                                               
                  DISPLAY 'PV-STR-NBR = ' PV-STR-NBR                            
                  DISPLAY '*****'                                               
                  MOVE 'D211-FETCH-TINENTY-CURSOR' TO PV-PARAGRAPH-NAME         
                  MOVE 'FETCH TINENTY'        TO PV-OPERATION-ATTEMPTED         
                  PERFORM 9999-SQL-ABEND                                        
             END-EVALUATE.                                                      
                                                                                
                                                                                
      ******************************************************************        
      *    CLOSE CURSOR                                                         
      ******************************************************************        
       D212-CLOSE-TINENTY-CURSOR.                                               
                                                                                
           EXEC SQL                                                             
               CLOSE TINENTY_CSR                                                
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
               WHEN 0                                                           
                   CONTINUE                                                     
               WHEN OTHER                                                       
                   MOVE 'D212-CLOSE-TINENTY-CURSOR'                             
                       TO PV-OPERATION-ATTEMPTED                                
                   MOVE  'CLOSE TINENTY' TO PV-PARAGRAPH-NAME                   
                   PERFORM 9999-SQL-ABEND                                       
           END-EVALUATE.                                                        
                                                                                
                                                                                
      ******************************************************************        
      *    OPEN CURSOR                                                          
      ******************************************************************        
       D220-OPEN-TINENTY-ALL-STR-CSR.                                           
                                                                                
           EXEC SQL                                                             
               OPEN TINENTY_ALL_STR                                             
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
               WHEN 0                                                           
                    CONTINUE                                                    
               WHEN OTHER                                                       
                  MOVE 'D220-OPEN-TINENTY-ALL-STR-CSR'                          
                      TO PV-PARAGRAPH-NAME                                      
                  MOVE 'OPEN TINENTY'         TO PV-OPERATION-ATTEMPTED         
                  PERFORM 9999-SQL-ABEND                                        
           END-EVALUATE.                                                        
                                                                                
                                                                                
                                                                                
      ******************************************************************        
      *    FETCH CURSOR                                                         
      ******************************************************************        
       D222-FETCH-TINENTY-ALL-STR-CSR.                                          
                                                                                
           EXEC SQL                                                             
                  FETCH TINENTY_ALL_STR                                         
                   INTO :INENTY-STR-NBR                                         
                       ,:INENTY-SHEET-TYP-CDE                                   
                       ,:INENTY-SHEET-NBR                                       
                       ,:INENTY-LNE-NBR                                         
W21732                 ,:INENTY-SKU-NBR                                         
25248                  ,:INENTY-UPC-NBR                                         
                       ,:INENTY-INV-QTY                                         
                       ,:INENTY-UNT-RTL-AMT                                     
                       ,:INENTY-EXTD-RTL-AMT                                    
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = +0                                                
                   IF SA-STORE-NBR-DB2 = INENTY-STR-NBR                         
                       PERFORM Z900-WRITE-OUTPUT-REC                            
                   ELSE                                                         
                       DISPLAY 'STR ' SA-STORE-NBR-DB2                          
                               ' OUTPUT REC COUNT '  PV-STORE-REC-COUNT         
                       COMPUTE PV-TOTAL-REC-COUNT =                             
                           PV-TOTAL-REC-COUNT + PV-STORE-REC-COUNT              
                       MOVE +0 TO PV-STORE-REC-COUNT                            
                       MOVE ZERO TO PV-LINE-NUMBER                              
      ******           WHEN THE HEADER IS WRITTEN, TINVPAR IS ALSO              
      ******           UPDATE                                                   
                       PERFORM Z903-WRITE-HEADER-REC                            
                       PERFORM Z900-WRITE-OUTPUT-REC                            
                       MOVE INENTY-STR-NBR TO SA-STORE-NBR-DB2                  
                   END-IF                                                       
               WHEN SQLCODE = +100                                              
                   SET END-OF-TINENTY-ALL-STR-CSR TO TRUE                       
                   DISPLAY 'STR ' SA-STORE-NBR-DB2                              
                               ' OUTPUT REC COUNT '  PV-STORE-REC-COUNT         
                   COMPUTE PV-TOTAL-REC-COUNT =                                 
                       PV-TOTAL-REC-COUNT + PV-STORE-REC-COUNT                  
               WHEN OTHER                                                       
                  DISPLAY '*****'                                               
                  DISPLAY 'SA-STORE-NBR-DB2 = ' SA-STORE-NBR-DB2                
                  DISPLAY '*****'                                               
                  MOVE 'D222-FETCH-TINENTY-ALL-STR-CSR'                         
                      TO PV-PARAGRAPH-NAME                                      
                  MOVE 'FETCH TINENTY'        TO PV-OPERATION-ATTEMPTED         
                  PERFORM 9999-SQL-ABEND                                        
             END-EVALUATE.                                                      
                                                                                
                                                                                
      ******************************************************************        
      *    CLOSE CURSOR                                                         
      ******************************************************************        
       D223-CLOSE-TINENTY-ALL-STR-CSR.                                          
                                                                                
           EXEC SQL                                                             
               CLOSE TINENTY_ALL_STR                                            
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
               WHEN 0                                                           
                   CONTINUE                                                     
               WHEN OTHER                                                       
                   MOVE 'D223-CLOSE-TINENTY-ALL-STR-CSR'                        
                       TO PV-OPERATION-ATTEMPTED                                
                   MOVE  'CLOSE TINENTY' TO PV-PARAGRAPH-NAME                   
                   PERFORM 9999-SQL-ABEND                                       
           END-EVALUATE.                                                        
                                                                                
RONNAM******************************************************************        
RONNAM*    READ SHEET-INVENTORY FILE                                            
RONNAM******************************************************************        
RONNAM*                                                                         
RONNAM*Z100-READ-SHEET-INV.                                                     
RONNAM*    READ SHEET-INV-IN                                                    
RONNAM*        INTO IN005-INVENTORY-COUNT-RECORD                                
RONNAM*        AT END SET END-OF-SHEET-INV TO TRUE.                             
RONNAM*                                                                         
RONNAM*    IF END-OF-SHEET-INV                                                  
RONNAM*        CONTINUE                                                         
RONNAM*    ELSE                                                                 
RONNAM*        IF SA-STORE-NBR = IN005-STORE-NUMBER                             
RONNAM*            PERFORM Z900-WRITE-OUTPUT-REC                                
RONNAM*        END-IF                                                           
RONNAM*    END-IF.                                                              
                                                                                
      ******************************************************************        
      *    READ STORE-CONTROL CARD                                              
      ******************************************************************        
                                                                                
       Z110-READ-STORE-CC.                                                      
W05091                                                                          
   |       EXEC SQL                                                             
   |           FETCH ONLINE-SHEETS-CSR                                          
   |           INTO :INVPAR-LOC-NBR                                             
   |               ,:INVPAR-ACTL-FIN-BK-DTE                                     
W05091             ,:INVPAR-SHEET-INV-CPLD-IND                                  
P28545             ,:INVPAR-INV-ID                                              
W05091     END-EXEC.                                                            
   |                                                                            
   |       EVALUATE TRUE                                                        
   |         WHEN SQLCODE IS EQUAL TO ZERO                                      
   |           CONTINUE                                                         
   |         WHEN SQLCODE IS EQUAL TO +100                                      
   |           SET END-OF-STORE-CC TO TRUE                                      
   |         WHEN SQLWARN IS NOT EQUAL TO SPACES                                
   |         WHEN SQLCODE IS NOT EQUAL TO ZERO                                  
   |           MOVE 'Z110-READ-STORE-CC' TO PV-PARAGRAPH-NAME                   
   |           MOVE 'READ TINVPAR'     TO PV-OPERATION-ATTEMPTED                
   |           PERFORM 9999-SQL-ABEND                                           
   |       END-EVALUATE.                                                        
   |                                                                            
   |  *    READ STORE-CONTROL-CARD                                              
   |  *        INTO CC-CONTROL-CARD                                             
  |   *        AT END SET END-OF-STORE-CC TO TRUE.                              
  |                                                                             
  |   ******************************************************************        
  |   * Z200-OPEN THE TINVPAR CURSOR.                                           
  |   ******************************************************************        
  |    Z200-OPEN-CURSOR.                                                        
  |                                                                             
  |        EXEC SQL                                                             
  |            OPEN ONLINE-SHEETS-CSR                                           
  |        END-EXEC.                                                            
  |                                                                             
  |        EVALUATE TRUE                                                        
  |          WHEN SQLCODE IS EQUAL TO ZERO                                      
  |            CONTINUE                                                         
  |          WHEN SQLWARN IS NOT EQUAL TO SPACES                                
  |          WHEN SQLCODE IS NOT EQUAL TO ZERO                                  
  |            MOVE 'Z200-OPEN-CURSOR' TO PV-PARAGRAPH-NAME                     
  |            MOVE 'OPEN TINVPAR'     TO PV-OPERATION-ATTEMPTED                
  |            PERFORM 9999-SQL-ABEND                                           
  |        END-EVALUATE.                                                        
  |                                                                             
  |   ******************************************************************        
  |   * Z300-CLOSE THE STORE TABLE CURSOR.                                      
  |   ******************************************************************        
  |    Z300-CLOSE-CURSOR.                                                       
  |                                                                             
  |        EXEC SQL                                                             
  |            CLOSE ONLINE-SHEETS-CSR                                          
  |        END-EXEC.                                                            
  |                                                                             
  |        EVALUATE TRUE                                                        
  |          WHEN SQLCODE IS EQUAL TO ZERO                                      
  |            CONTINUE                                                         
  |          WHEN SQLWARN IS NOT EQUAL TO SPACES                                
  |          WHEN SQLCODE IS NOT EQUAL TO ZERO                                  
  |            MOVE 'Z200-OPEN-CURSOR' TO PV-PARAGRAPH-NAME                     
  |            MOVE 'OPEN TINVPAR'     TO PV-OPERATION-ATTEMPTED                
  |            PERFORM 9999-SQL-ABEND                                           
  |        END-EVALUATE.                                                        
W05091                                                                          
      ******************************************************************        
      *  SHEETS FOR SCANNING STORES WILL HAVE THE ACTL RECV DATE SET            
      *  SHEETS FOR DC WILL HAVE THE ACTL RECV DATE STILL SET TO DEFAULT        
      ******************************************************************        
       Z400-UPDATE-TINVPAR-ROW.                                                 
                                                                                
           EXEC SQL                                                             
           UPDATE TINVPAR                                                       
               SET SHEET_INV_CPLD_IND = 'Y'                                     
25248          WHERE (LOC_NBR = :INVPAR-LOC-NBR) AND                            
P28545               (INV_ID = :INVPAR-INV-ID)   AND                            
                     (ACTL_FIN_BK_DTE = :PC-EMPTY-DATE) AND                     
W05091               (SHEET_INV_CPLD_IND = 'S')                                 
  |   ***            (SHEET_INV_CPLD_IND = 'N') AND                             
  |   ***            ((ACTL_INV_RECD_DTE <> :PC-EMPTY-DATE  AND                 
  |   ***              SCAN_INV_IND = 'Y') OR                                   
  |   ***             (ACTL_INV_RECD_DTE = :PC-EMPTY-DATE  AND                  
W05091***             (SCHD_PHY_CNT_IND= 'Y' AND SCAN_INV_IND = 'N'))           
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = 0                                                 
                   CONTINUE                                                     
               WHEN SQLWARN0 NOT = SPACES                                       
               WHEN SQLCODE < 0                                                 
               WHEN SQLCODE > 0                                                 
25248              MOVE INVPAR-LOC-NBR TO PV-TINVPAR-STR-NBR                    
                   DISPLAY 'INVALID STORE => ' PV-TINVPAR-STR-NBR-CHAR          
                   MOVE 'Z400-UPDATE-TINVPAR-ROW       '                        
                       TO PV-PARAGRAPH-NAME                                     
                   MOVE 'UPDATING TINVPAR TABLE'                                
                       TO PV-OPERATION-ATTEMPTED                                
                   PERFORM 9999-SQL-ABEND                                       
           END-EVALUATE.                                                        
                                                                                
W05091******************************************************************        
  |   * Z500-READ-INPUT-SOURCE.                                                 
  |   ******************************************************************        
RONNAM*Z500-READ-INPUT-SOURCE.                                                  
RONNAM*                                                                         
RONNAM*    READ INPUT-SOURCE NEXT                                               
RONNAM*      INTO PV-INPUT-SOURCE                                               
RONNAM*        AT END SET END-OF-INP-SOURCE TO TRUE.                            
RONNAM*                                                                         
      ******************************************************************        
      *    WRITE SINGLE OUTPUT RECORD                                           
      ******************************************************************        
                                                                                
       Z900-WRITE-OUTPUT-REC.                                                   
                                                                                
RONNAM*    IF PV-TAPE-INPUT                                                     
RONNAM*        IF STORE-MATCH OR PROCESS-ALL-STORES                             
RONNAM*            INITIALIZE IN018-INVENTORY-COUNT-RECORD                      
RONNAM*            MOVE IN005-INVENTORY-COUNT-RECORD                            
RONNAM*              TO IN018-INVENTORY-COUNT-RECORD                            
RONNAM*            MOVE ZEROS TO IN018-SCAN-DTE                                 
RONNAM*                          IN018-SCAN-TIMESTAMP                           
RONNAM*            WRITE SHEET-PLUS-HDR-REC                                     
RONNAM*                FROM IN018-INVENTORY-COUNT-RECORD                        
RONNAM*            ADD +1 TO PV-STORE-REC-COUNT                                 
RONNAM*         END-IF                                                          
RONNAM*    END-IF.                                                              
                                                                                
RONNAM*    IF PV-DB2-INPUT                                                      
               INITIALIZE IN018-INVENTORY-COUNT-RECORD.                         
               MOVE INENTY-STR-NBR      TO IN018-STORE-NUMBER.                  
               MOVE INENTY-SHEET-NBR    TO IN018-AREA-NUMBER.                   
               PERFORM Z902-CALC-LINE-NBR.                                      
               MOVE PV-LINE-NUMBER      TO IN018-LINE-NUMBER.                   
W21732         MOVE INENTY-SKU-NBR      TO PV-TEMP-SKU.                         
W21732         MOVE PV-TEMP-SKU         TO IN018-SKU.                           
               MOVE INENTY-INV-QTY      TO IN018-QUANTITY.                      
               MOVE INENTY-UNT-RTL-AMT  TO IN018-PRICE.                         
25248          MOVE INENTY-UPC-NBR      TO PV-TEMP-UPC.                         
25248          MOVE PV-TEMP-UPC (3:13)  TO IN018-UPC-CODE.                      
25248 ******   MOVE ZEROES              TO IN018-UPC-CODE                       
               MOVE SPACES              TO IN018-INVALID-INDICATOR.             
               MOVE SPACES              TO IN018-BLANK-SHEET-INDICATOR.         
               MOVE ZEROS               TO IN018-SCAN-DTE.                      
               MOVE ZEROS               TO IN018-SCAN-TIMESTAMP.                
               WRITE SHEET-PLUS-HDR-REC                                         
                   FROM IN018-INVENTORY-COUNT-RECORD.                           
               ADD +1 TO PV-STORE-REC-COUNT.                                    
RONNAM*    END-IF.                                                              
                                                                                
      ******************************************************************        
      *   LINE NUMBER ON A SHEET MUST BE SEQUENTIAL NUMBERED.                   
      *   NOTE: ITEM NUMBERS ON THE TINENTY TABLE MAY NOT BE IN                 
      *         SEQUENCE.  THIS IS DUE TO ON-LINE ADDS AND DELETES OF           
      *         OF LINES ON A SHEET.                                            
      ******************************************************************        
                                                                                
       Z902-CALC-LINE-NBR.                                                      
                                                                                
           IF INENTY-SHEET-NBR = PV-PREV-SHEET-NBR                              
               ADD 1 TO PV-LINE-NUMBER                                          
           ELSE                                                                 
               MOVE 1 TO PV-LINE-NUMBER                                         
               MOVE INENTY-SHEET-NBR TO PV-PREV-SHEET-NBR                       
           END-IF.                                                              
                                                                                
W30692*    IF PV-LINE-NUMBER > PC-MAX-LINES                                     
W30692*        DISPLAY '**************************************'                 
W30692*        DISPLAY '   ENCOUNTERED MORE THAN ' PC-MAX-LINES                 
W30692*                ' LINES ON A SHEET'                                      
W30692*        DISPLAY '   STR: ' INENTY-STR-NBR                                
W30692*        DISPLAY '***************************************'                
W30692*        MOVE 'Z902-CALC-LINE-NBR' TO PV-PARAGRAPH-NAME                   
W30692*        PERFORM 9999-ABEND                                               
W30692*    END-IF.                                                              
W30692*                                                                         
      ******************************************************************        
      *    WRITE HEADER RECORD AND TINVPAR WILL GET UPDATED                     
      ******************************************************************        
                                                                                
       Z903-WRITE-HEADER-REC.                                                   
                                                                                
RONNAM*    IF PV-TAPE-INPUT                                                     
RONNAM*        IF STORE-MATCH OR PROCESS-ALL-STORES                             
RONNAM*            MOVE IN005-STORE-NUMBER TO INVPAR-LOC-NBR                    
RONNAM*            PERFORM Z400-UPDATE-TINVPAR-ROW                              
RONNAM*            MOVE PC-HEADER-RECORD                                        
RONNAM*                TO IN018-INVENTORY-HEADER-RECORD                         
RONNAM*            MOVE INVPAR-LOC-NBR TO IN018-HDR-STORE                       
RONNAM*            WRITE SHEET-PLUS-HDR-REC                                     
RONNAM*                FROM IN018-INVENTORY-HEADER-RECORD                       
RONNAM*        END-IF                                                           
RONNAM*    END-IF.                                                              
                                                                                
RONNAM*    IF PV-DB2-INPUT                                                      
25248          MOVE INENTY-STR-NBR TO INVPAR-LOC-NBR.                           
P28545         MOVE WS-INV-ID (ST-INDEX) TO INVPAR-INV-ID.                      
               PERFORM Z400-UPDATE-TINVPAR-ROW.                                 
               MOVE PC-HEADER-RECORD                                            
                   TO IN018-INVENTORY-HEADER-RECORD.                            
25248          MOVE INVPAR-LOC-NBR          TO IN018-HDR-STORE.                 
               WRITE SHEET-PLUS-HDR-REC                                         
                       FROM IN018-INVENTORY-HEADER-RECORD.                      
RONNAM*    END-IF.                                                              
                                                                                
      ******************************************************************        
      *  THIS ROUTINE FORCES AN ABEND DUE TO A NON-DB2 RELATED PROBLEM.         
      ******************************************************************        
       9999-ABEND.                                                              
                                                                                
           MOVE +4003 TO ABEND-CODE.                                            
           DISPLAY '**  ABEND     **'.                                          
           DISPLAY '**  PROGRAM   **  = ' PC-PROGRAM-NAME.                      
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.                    
           DISPLAY '**  ' PV-ABEND-MESSAGE.                                     
           CALL 'ILBOABN0'  USING ABEND-CODE.                                   
                                                                                
      ******************************************************************        
      *  THIS ROUTINE FORCES AN ABEND DUE TO A DB2 RELATED PROBLEM.             
      ******************************************************************        
       9999-SQL-ABEND.                                                          
                                                                                
           MOVE +4013                 TO ABEND-CODE.                            
           DISPLAY '**  ABEND     **'.                                          
           DISPLAY '**  PROGRAM   ** => ' PC-PROGRAM-NAME.                      
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.                    
           DISPLAY '**  OPERATION **  = ' PV-OPERATION-ATTEMPTED.               
                                                                                
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE                 
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.                
                                                                                
           COPY DPPD004.                                                        
           CALL 'ILBOABN0'  USING ABEND-CODE.                                   
