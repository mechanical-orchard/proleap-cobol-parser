000100***************************************************************** 00010006
000200 IDENTIFICATION DIVISION.                                         00020006
000300***************************************************************** 00030006
000400                                                                  00040006
000500 PROGRAM-ID.             MRKUT104.                                00050006
000600 AUTHOR.                 LYNN CHRISTIANSEN.                       00060006
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070006
000800 DATE-WRITTEN            03-12-01.                                00080006
000900 DATE-COMPILED.                                                   00090006
001000                                                                  00100006
001100***************************************************************** 00110006
001200*          CREATE TRANSFER RECORD INPUT                         * 00120006
001300*                                                               * 00130006
001400*  THIS PROGRAM IS A VERSION OF MRKUT014, FOR E-COMMERCE.       * 00140006
001500*                                                               * 00150006
001600*  THIS PROGRAM WILL JOIN THE TSK, TMRITEM, TMRITST, AND        * 00160006
001700*  TMRISFE TABLE AND CREATE AN EXTRACT FILE WHICH WILL BE       * 00170006
001800*  SORTED EXTERNALLY.  IT WILL ONLY SELECT E-COMMERCE STORES.   * 00180006
001900*                                                               * 00190006
002000***************************************************************** 00200006
002100*  CHANGE MADE:                                                 * 00210006
002200*                                                               * 00220006
002300***************************************************************** 00230006
002400* CHANGED 09/19/95 BY HOWARD MENDELSON                            00240006
002500*   WR# 2784                                                      00250006
002600*            MODIFIED MRRD017 TO REDUCE OUTPUT FILE LENGTH TO     00260006
002700*            1200 BYTES.  ADDED CODE TO LOAD DATA FROM THE        00270006
002800*            ITEM HISTORY TABLE.                                  00280006
002900* CHANGED 12/07/93 BY DAVID PHELPS                                00290006
003000*   WR# XXXXXXXXXXXX                                              00300006
003100*            FOR THE REFERENCE NUMBER REFORMAT THE INAME LAYOUT   00310006
003200*            IS CHANGED TO INCLUDE THE GROUP-CODE AND THE         00320006
003300*            STORE-ID-CODE.                                       00330006
003400*                                                                 00340006
003500* CHANGED 05/21/96 BY CHRISTINE FOLEY                             00350006
003600*   WR# XXXXXXXXXXXX                                              00360006
003700*            PARAGRAPH: F000-FORMAT-TRAN-INPUT                    00370006
003800*            THE PERCENT VALUES WERE CHANGED IN WORKING           00380006
003900*            STORAGE TO REFLECT CHANGES IN THE UPGRADE TO 1.1.6.  00390006
004000*                                                                 00400006
004100* CHANGED 06/14/96 BY HOWARD MENDELSON  --  G&R                   00410006
004200*   WR# 3303                                                      00420006
004300*            ADDED LOGIC TO SELECT BIWEEKLY REVIEW TIME ORDERS    00430006
004400*            RT = 14 , RT-DAY 1 THRU 14.                          00440006
004500*                                                                 00450006
004600* CHANGED 01/08/97 BY CHRISTINE FOLEY                             00460006
004700*   WR# 5017                                                      00470006
004800*            PARAGRAPH: F000-FORMAT-TRAN-INPUT                    00480006
004900*            ADDED LOGIC TO EVALUATE UCYCLE BEFORE DETERMINING    00490006
005000*            VOLUME SENSITIVE VARIABLES.  IF UCYCLE 5 THE DD      00500006
005100*            NEEDS TO BE DIVIDED BY 4(WEEKS) BEFORE EVALUATING.   00510006
005200*                                                                 00520006
005300* CHANGED 11/09/98 BY LINDA FRIESS                                00530006
005400*   WR# 3801                                                      00540006
005500*            PARAGRAPH: F000-FORMAT-TRAN-INPUT                    00550006
005600*            CHANGED TO GET VALUES FROM THE DD MATRIX RECORD OF   00560006
005700*            THE CONTROL FILE, INSTEAD OF USING CONSTANTS.  ADDED 00570006
005800*            CADL, DAMP, MINSMK, MAXSMK & LOMADP FIELDS TO OUTPUT 00580006
005900*            RECORD.                                              00590006
006000* CHANGED 05/13/99 BY ANNE KINTOPF                                00600006
006100*   PIT# 309322                                                   00610006
006200*            CHANGE PROGRAM TO MOVE TMRISHS ROWS TO CORRECT FIELDS00620006
006300*            BY USING DATA LOGIC.                                 00630006
006400*                                                                 00640006
006500* CHANGED 01/03/2001 BY LINDA FRIESS                              00650006
006600*   WR# 9998                                                      00660006
006700*            MODIFIED MR_ITEM_CSR TO ELIMINATE UNIONS, FOR        00670006
006800*            EFFICIENCY.  ADDED SEARCH OF INTERNAL TABLE TO       00680006
006900*            PARAGRAPH F000-FORMAT-TRAN-INPUT TO GET WEEK NUMBER  00690006
007000*            CORRESPONDING TO SEQUENCE NUMBER.                    00700006
007100*                                                                 00710006
007200* CHANGED 03/12/2001 BY LINDA FRIESS                              00720006
007300*   WR# 21599                                                     00730006
007400*            CREATED NEW VERSION OF MRKUT014 TO INCLUDE ONLY      00740006
007500*            E-COMMERCE STORES IN MR_ITEM_CSR; ADDED TSTR000      00750006
007600*            TABLE AND REPLACED CHECK OF RT/RT DAY WITH CHECK     00760006
007700*            OF FT CODE.                                          00770006
007800*                                                                 00780006
007810* CHANGED 09/04/2002 BY IBM GLOBAL SERVICES INDIA                 00790006
007820*   WR# 21601 (NI-SKU PROJECT)                                    00800006
007830*            DEPARTMENT, CLASS AND 8-DIGIT SKU ARE FETCHED        00810006
007840*            FROM TSKXREF AND IS WRITTEN INTO OUTPUT OF           00820006
007850*            THE PROGRAM.                                         00830006
007860*                                                                 00840006
007870* CHANGED 11/05/2002 BY DON TOMLINSON                             00850006
007880*   PIT:505764(NI-SKU PROJECT)                                    00860006
007890*            INAME SKU DESC BUILD WAS REMOVED DURING PROJECT.     00870006
007891*            FIELD MOVE IS BEING PUT BACK IN PROGRAM.             00880006
007860*                                                                 00890006
007870* CHANGED 06/02/2004 BY BOB FORD                                  00900006
007880*   WR# 26363 (STORE EXPANSION PROJECT)                           00910006
007890*            MODIFIED TO HANDLE 5-DIGIT STORE NUMBER.  TMRITST    00920006
007891*            DB CHANGE NOT COMPLETE YET, SO CHANGE TO REMOVE      00930006
007860*            TMRITST/ADD XMT_LOC TO MR_ITEM_CSR COULD NOT BE      00940006
007860*            MADE.                                                00950006
007870* CHANGED 06/14/2004 BY BOB FORD                                  00960006
007880*   WR# 26363 (STORE EXPANSION PROJECT)                           00970006
007890*            REPLACED TSTR000 WITH XMT_LOC                        00980006
007860*                                                                 00990006
007870* CHANGED 02/17/2006 BY LINDA FRIESS                              01000006
007880*  PITS# 849440 CHANGED PARA. I100 TO ONLY DECREMENT DATE 1 WEEK  01010006
007890*            INSTEAD OF 2, TO INCLUDE MOST RECENT TMRISHS WEEK    01020006
3372A *                                                                 01030006
3372A * CHANGED 06/18/2012 BY KUSHAL BOTHRA                             01040006
3372A *  WR#   3372A  CHANGED PARA. F000 TO GET-INNR-OUTR FROM THE NEW  01050006
3372A *            DB2 INNER/OUTER TABLE USING THE SKU                  01060006
007860*                                                                 01070006
007892***************************************************************** 01080006
007893 ENVIRONMENT DIVISION.                                            01090006
007894***************************************************************** 01100006
007895                                                                  01110006
007896 CONFIGURATION SECTION.                                           01120006
007897                                                                  01130006
007898 SOURCE-COMPUTER.        IBM-3090.                                01140006
007899 OBJECT-COMPUTER.        IBM-3090.                                01150006
007900                                                                  01160006
008000 INPUT-OUTPUT SECTION.                                            01170006
008100                                                                  01180006
008200 FILE-CONTROL.                                                    01190006
008300*                                                                 01200006
008400     SELECT IC-CONTROL-FILE       ASSIGN       TO INP01           01210006
008500                                  ORGANIZATION IS INDEXED         01220006
008600                                  ACCESS       IS RANDOM          01230006
008700                                  RECORD KEY   IS ICCTL-KEY       01240006
008800                                  FILE STATUS  IS PV-VSAM-STATUS. 01250006
008900     SELECT IC-PARM-FILE          ASSIGN       TO INP02.          01260006
009000     SELECT TRANSFER-RECORD       ASSIGN TO OUT01.                01270006
009100*                                                                 01280006
009200***************************************************************** 01290006
009300 DATA DIVISION.                                                   01300006
009400***************************************************************** 01310006
009500*                                                                 01320006
009600 FILE SECTION.                                                    01330006
009700*                                                                 01340006
009800 FD  IC-CONTROL-FILE.                                             01350006
009900 01  IC-CONTROL-REC.                                              01360006
010000     05  ICCTL-KEY                   PIC  X(21).                  01370006
010100     05  FILLER                      PIC  X(379).                 01380006
010200*                                                                 01390006
010300 FD  IC-PARM-FILE                                                 01400006
010400     RECORDING MODE IS F.                                         01410006
010500 01  IC-PARM-REC.                                                 01420006
010600     05  FILLER                      PIC  X(80).                  01430006
010700*                                                                 01440006
010800 FD  TRANSFER-RECORD                                              01450006
010900     RECORDING MODE IS F                                          01460006
011000     LABEL RECORDS ARE STANDARD                                   01470006
011100     RECORD CONTAINS 1143 CHARACTERS                              01480006
011200     BLOCK CONTAINS 0  RECORDS.                                   01490006
011300 01  TRANSFER-REC                    PIC  X(1143).                01500006
011400*                                                                 01510006
011500 WORKING-STORAGE SECTION.                                         01520006
011600*                                                                 01530006
011700 01  FILLER.                                                      01540006
011800     05  FILLER                      PIC  X(36)    VALUE          01550006
011900         ' ***** WORKING STORAGE PGM=MRKUT104 '.                  01560006
012000     05  FILLER                      PIC  X(10)    VALUE          01570006
012100         ' LOCATION='.                                            01580006
012200     05  PGM-LOCATION                PIC  X(04)    VALUE SPACE.   01590006
012300     05  FILLER                      PIC  X(06)    VALUE          01600006
012400         ' *****'.                                                01610006
012500 EJECT                                                            01620006
012600 01  PROGRAM-SWITCHES.                                            01630006
012700     05  PS-EOC-ITEM-CSR             PIC  X(01)    VALUE 'N'.     01640006
012800         88  EOC-ITEM-CSR                          VALUE 'Y'.     01650006
012900     05  PS-ROW-FOUND-SWITCH         PIC  X(01)    VALUE 'Y'.     01660006
013000         88  PS-ROW-FOUND                          VALUE 'Y'.     01670006
013100         88  PS-ROW-NOT-FOUND                      VALUE 'N'.     01680006
013200*                                                                 01690006
013300/                                                                 01700006
013400 01  PC-CONSTANTS.                                                01710006
013500     05  PC-PLUS-1                   PIC S9(04)    VALUE +1       01720006
013600                                                   COMP SYNC.     01730006
013700     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     01740006
013800                                                   COMP SYNC.     01750006
013900     05  PC-1                        PIC S9(03)    VALUE +1       01760006
014000                                                   COMP-3.        01770006
014100     05  PC-2                        PIC S9(01)V   VALUE +2       01780006
014200                                                   COMP-3.        01790006
014300     05  PC-3                        PIC S9(03)    VALUE +3       01800006
014400                                                   COMP-3.        01810006
014500     05  PC-4                        PIC S9(03)    VALUE +4       01820006
014600                                                   COMP-3.        01830006
014700     05  PC-5                        PIC S9(01)V   VALUE +5       01840006
014800                                                   COMP-3.        01850006
014900     05  PC-5A                       PIC  X(01)    VALUE '5'.     01860006
015000     05  PC-7                        PIC S9(03)    VALUE +7       01870006
015100                                                   COMP-3.        01880006
015200     05  PC-10                       PIC S9(03)    VALUE +10      01890006
015300                                                   COMP-3.        01900006
015400     05  PC-11                       PIC S9(03)    VALUE +11      01910006
015500                                                   COMP-3.        01920006
015600     05  PC-13                       PIC S9(03)    VALUE +13      01930006
015700                                                   COMP-3.        01940006
015800     05  PC-14                       PIC S9(03)    VALUE +14      01950006
015900                                                   COMP-3.        01960006
016000     05  PC-52                       PIC S9(03)    VALUE +52      01970006
016100                                                   COMP-3.        01980006
016200     05  PC-100                      PIC S9(03)    VALUE +100     01990006
016300                                                   COMP-3.        02000006
016200     05  PC-200                      PIC S9(03)    VALUE +200     02010006
016300                                                   COMP-3.        02020006
016400     05  PC-20A                      PIC  X        VALUE  '2'.    02030006
016500     05  PC-30A                      PIC  X        VALUE  '3'.    02040006
016600     05  PC-50A                      PIC  X        VALUE  '5'.    02050006
016700     05  PC-50P                      PIC  V9       VALUE  .5.     02060006
016800     05  PC-1P                       PIC  S99V     VALUE +1       02070006
016900                                                   COMP-3.        02080006
017000     05  PC-2P                       PIC  S99V     VALUE +2       02090006
017100                                                   COMP-3.        02100006
017200     05  PC-3P                       PIC  S99V     VALUE +3       02110006
017300                                                   COMP-3.        02120006
017400     05  PC-4P                       PIC  S99V     VALUE +4       02130006
017500                                                   COMP-3.        02140006
017600     05  PC-B                        PIC  X(01)    VALUE 'B'.     02150006
017700     05  PC-C                        PIC  X(01)    VALUE 'C'.     02160006
017800     05  PC-D                        PIC  X(01)    VALUE 'D'.     02170006
017900     05  PC-E                        PIC  X(01)    VALUE 'E'.     02180006
018000     05  PC-F                        PIC  X(01)    VALUE 'F'.     02190006
018000     05  PC-N                        PIC  X(01)    VALUE 'N'.     02200006
018100     05  PC-S                        PIC  X(01)    VALUE 'S'.     02210006
018200     05  PC-Y                        PIC  X(01)    VALUE 'Y'.     02220006
018300     05  PC-Z                        PIC  X(01)    VALUE 'Z'.     02230006
018400     05  PC-RCD-TYPE                 PIC  X(03)    VALUE 'SYS'.   02240006
018500     05  PC-DDM                      PIC  X(03)    VALUE 'DDM'.   02250006
018600     05  PC-STORE-NAME               PIC  X(05)    VALUE          02260006
018700                                                   ' STR:'.       02270006
018800     05  PC-PGM-DPKUT500             PIC  X(08)    VALUE          02280006
018900                                                   'DPKUT500'.    02290006
019000 EJECT                                                            02300006
019100*                                                                 02310006
019200 01  PV-ACCUMULATOR-FIELDS.                                       02320006
019300     05  PV-SYSTEM-INPUT-CNT         PIC S9(03)    VALUE ZERO     02330006
019400                                                   COMP-3.        02340006
019500     05  PV-SYSTEM-OUTPUT-CNT        PIC S9(04)    VALUE ZERO     02350006
019600                                                   COMP-3.        02360006
019700     05  PV-TNOW-ADD-DAY             PIC S9(04)    VALUE ZERO     02370006
019800                                                   COMP-3.        02380006
019900*                                                                 02390006
020000 01  PV-DATE-FIELDS.                                              02400006
020100     05  PV-DATE.                                                 02410006
020200         10  PV-YEAR                     PIC 9(4) VALUE ZEROES.   02420006
020300         10  PV-MO                       PIC 9(2) VALUE ZEROES.   02430006
020400         10  PV-DY                       PIC 9(2) VALUE ZEROES.   02440006
020500     05  PV-CURR-WEEK-YEAR.                                       02450006
020600         10  PV-CURR-CCYY                PIC  9(04).              02460006
020700         10  PV-CURR-WEEK                PIC  9(02).              02470006
020800     05  PV-WEEK-YEAR.                                            02480006
020900         10  PV-CCYY                     PIC  9(04).              02490006
021000         10  PV-WEEK                     PIC  9(02).              02500006
021100*                                                                 02510006
021200 01  CD-CPU-DATE                      PIC X(10).                  02520006
021300 01  FILLER REDEFINES CD-CPU-DATE.                                02530006
021400     05  CD-CPU-YEAR                  PIC 9(04).                  02540006
021500     05  FILLER REDEFINES CD-CPU-YEAR.                            02550006
021600         10  CD-CPU-CC                PIC 9(02).                  02560006
021700         10  CD-CPU-YR                PIC 9(02).                  02570006
021800     05  FILLER                       PIC X(01).                  02580006
021900     05  CD-CPU-MO                    PIC 9(02).                  02590006
022000     05  FILLER                       PIC X(01).                  02600006
022100     05  CD-CPU-DY                    PIC 9(02).                  02610006
022200*                                                                 02620006
022300 01  PV-MISC-FIELDS.                                              02630006
022400     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     02640006
022500                                                   COMP SYNC.     02650006
022600     05  PV-VSAM-STATUS              PIC  X(02) VALUE SPACE.      02660006
022700         88  PV-VSAM-SUCCESSFUL                 VALUE '00'.       02670006
022800         88  PV-VSAM-NOT-FOUND                  VALUE '23'.       02680006
022900     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  02690006
023000                                                                  02700006
023100                                                                  02710006
023200     05  PV-INAME.                                                02720006
023300         10  PV-INAME-SKU            PIC  9(08)    VALUE 0.       02730006
023400         10  FILLER                  PIC  X(02)    VALUE SPACES.  02740006
023500         10  PV-INAME-STORE-HEADING  PIC  X(05)    VALUE SPACES.  02750006
023600         10  PV-INAME-STORE          PIC   9(5)    VALUE ZEROES.  02760006
023700         10  FILLER                  PIC  X(01)    VALUE '/'.     02770006
023800         10  PV-INAME-SKU-DESC       PIC  X(25)    VALUE SPACES.  02780006
023900         10  PV-INAME-GROUP-CODE     PIC  X(03)    VALUE SPACES.  02790006
024000         10  PV-INAME-STORE-CODE     PIC  X(01)    VALUE SPACES.  02800006
024100     05  PV-SKU.                                                  02810006
024200         10  PV-SKU-STYLE            PIC  X(15)    VALUE SPACES.  02820006
024300         10  FILLER                  PIC  X(01)    VALUE '/'.     02830006
024400         10  PV-SKU-SIZE             PIC  X(05)    VALUE SPACES.  02840006
024500         10  FILLER                  PIC  X(01)    VALUE '/'.     02850006
024600         10  PV-SKU-COLOR            PIC  X(04)    VALUE SPACES.  02860006
024700         10  FILLER                  PIC  X(01)    VALUE ' '.     02870006
024800         10  PV-SKU-VEND-NBR         PIC  X(03)    VALUE SPACES.  02880006
024900     05  PV-HOLD-WEEK                PIC  9(02)    VALUE ZERO.    02890006
025000     05  PV-MRISHS-SUB               PIC  9(02)    VALUE ZERO.    02900006
025100     05  PV-HIST-SUB                 PIC  9(02)    VALUE ZERO.    02910006
025200     05  PV-TEMP-DD-FCTR             PIC  9(6)V9(1) COMP-3        02920006
025300                                                   VALUE ZERO.    02930006
025400     05  PV-TNOW-WN-NOSIGN           PIC  9(02)    VALUE ZERO.    02940006
025500     05  PV-TNOW-WN-SPLIT.                                        02950006
025600         10  PV-TNOW-WN-DIGIT1       PIC  9(01)    VALUE ZERO.    02960006
025700         10  PV-TNOW-WN-DIGIT2       PIC  9(01)    VALUE ZERO.    02970006
025800             88  PV-ODD                   VALUE 1, 3, 5, 7, 9.    02980006
025900     05  PV-TNOW-WN                  PIC  S99      COMP-3.        02990006
026000     05  PV-TNOW-DN                  PIC  S9       COMP-3.        03000006
026100     05  PV-F2                           PIC  X(02)    VALUE 'F2'.03010006
026200 EJECT                                                            03020006
026300*---------------------------------------------------------------* 03030006
026400*   COPYBOOK FOR DATE MODULE                                      03040006
026500*---------------------------------------------------------------* 03050006
026600     COPY DPWS500.                                                03060006
026700*                                                                 03070006
026800     COPY MRRD001I.                                               03080006
026900*                                                                 03090006
027000 EJECT                                                            03100006
027100 01 PV-OUTPUT.                                                    03110006
027200     COPY MRRD017.                                                03120006
027300 EJECT                                                            03130006
027400*                                                                 03140006
027500 01  SYSTEM-RECORD                   PIC X(400).                  03150006
027600 01  FILLER REDEFINES SYSTEM-RECORD.                              03160006
027700     COPY ICI005C.                                                03170006
027800*                                                                 03180006
027900 01  FILLER REDEFINES SYSTEM-RECORD.                              03190006
028000     COPY ICI028C.                                                03200006
028100*                                                                 03210006
028200     COPY ISWS006.                                                03220006
028300*                                                                 03230006
028400*---------------------------------------------------------------* 03240006
028500*   DATE TABLE                                                    03250006
028600*---------------------------------------------------------------* 03260006
028700 01  PT-PROGRAM-TABLES.                                           03270006
028800     05  PT-WEEKS-TABLE.                                          03280006
028900         10 PT-WEEK                   PIC  X(2)                   03290006
029000                                      OCCURS 13 TIMES.            03300006
029100         10 PT-YEAR                   PIC  X(4)                   03310006
029200                                      OCCURS 13 TIMES.            03320006
029300*                                                                 03330006
029400*---------------------------------------------------------------* 03340006
029500*   FORECAST LOOKUP TABLE TO CROSS-REFERENCE WEEK AND SEQ NBR     03350006
029600*---------------------------------------------------------------* 03360006
029700 01  FL-FORECAST-LOOKUP-TABLE.                                    03370006
029800     05  FL-FORECAST-LOOKUP-ENTRIES OCCURS 4 TIMES                03380006
029900                                    INDEXED BY FL-INDEX.          03390006
030000         10  FL-WEEK-NBR              PIC S99V  COMP-3.           03400006
030100         10  FL-SEQ-NBR               PIC S99V  COMP-3.           03410006
030200*                                                                 03420006
030300 EJECT                                                            03430006
030400     EXEC SQL                                                     03440006
030500         INCLUDE TMRITST                                          03450006
030600     END-EXEC.                                                    03460006
030700 EJECT                                                            03470006
030800     EXEC SQL                                                     03480006
030900         INCLUDE TMRITEM                                          03490006
031000     END-EXEC.                                                    03500006
031100 EJECT                                                            03510006
031200     EXEC SQL                                                     03520006
031300         INCLUDE TMRISFE                                          03530006
031400     END-EXEC.                                                    03540006
031500 EJECT                                                            03550006
031600     EXEC SQL                                                     03560006
031700         INCLUDE TMRISFL                                          03570006
031800     END-EXEC.                                                    03580006
031900 EJECT                                                            03590006
032000     EXEC SQL                                                     03600006
032100         INCLUDE TMRISHS                                          03610006
032200     END-EXEC.                                                    03620006
032300 EJECT                                                            03630006
032400     EXEC SQL                                                     03640006
032500         INCLUDE TSK                                              03650006
032600     END-EXEC.                                                    03660006
032700 EJECT                                                            03670006
032800     EXEC SQL                                                     03680006
032900         INCLUDE XMT00001                                         03690006
033000     END-EXEC.                                                    03700006
033100 EJECT                                                            03710006
033500*                                                                 03720006
033200     EXEC SQL                                                     03730006
033300         INCLUDE TSKXREF                                          03740006
033400     END-EXEC.                                                    03750006
033500*                                                                 03760006
033600* DB2 COMMUNICATION AREA                                          03770006
033700*                                                                 03780006
033800     EXEC SQL                                                     03790006
033900         INCLUDE SQLCA                                            03800006
034000     END-EXEC.                                                    03810006
034100 EJECT                                                            03820006
034200* DB2 COMMUNICATION AREA2                                         03830006
034300*                                                                 03840006
034400     COPY SQLCA2.                                                 03850006
034500 EJECT                                                            03860006
034600*                                                                 03870006
034700* CURSOR FOR JOIN OF TSK, TMRITEM, TMRITST, AND TMRISFE           03880006
034800*                                                                 03890006
034900* ADD THE TMRITEM-ORD-GROUP-SW  @@@                               03900006
035000*                                                                 03910006
035100     EXEC SQL                                                     03920006
035200       DECLARE MR_ITEM_CSR  CURSOR FOR                            03930006
3372A        WITH DATA_1 AS(                                            03940006
035300       SELECT A.ITEM_NBR,                                         03950006
035400              A.UCYCLE_CDE,                                       03960006
035500              A.TSL_NBR,                                          03970006
035600              A.BYPDDU_CDE,                                       03980006
035700              A.BYPSCL_NBR,                                       03990006
035800              A.FRCDDU_CDE,                                       04000006
035900              A.BYPZSL_CDE,                                       04010006
036000              A.BYPTFP_CDE,                                       04020006
036100              A.BYPZOH_CDE,                                       04030006
036200              A.BYPBEF_CDE,                                       04040006
036300              A.BYPAFT_CDE,                                       04050006
036400              A.LUMPSW_CDE,                                       04060006
036500              A.MINBI_FCTR,                                       04070006
036600              A.DDFTSW_CDE,                                       04080006
036700              A.RT_NBR,                                           04090006
036800              A.RTF_FCTR,                                         04100006
036900              A.ZOPSW_CDE,                                        04110006
037000              A.OUTLSW_CDE,                                       04120006
037100              A.ZSSTOCK_CDE,                                      04130006
037200              A.PACKSW_CDE,                                       04140006
037300              A.DSER_CDE,                                         04150006
037400              A.LT_QTY,                                           04160006
037500              A.IMIN_QTY,                                         04170006
037600              A.IMAX_QTY,                                         04180006
037700              A.SSADJ_PCT,                                        04190006
037800              A.RT_DAY_NBR,                                       04200006
037900              A.DDUPRM_SW,                                        04210006
038000              A.ORD_GROUP_SW,                                     04220006
038100              X.DEPT,                                             04230006
038200              X.CLASS,                                            04240006
038300              X.SUBCLASS,                                         04250006
038400              X.SKU,                                              04260006
038500              B.MERCH_DIV_CODE,                                   04270006
038600              B.DMM_NMBR,                                         04280006
038700              B.VENDOR_NMBR,                                      04290006
038800              B.VNDR_IN_HSE_NMBR,                                 04300006
038900              B.VENDOR_STYLE_CODE,                                04310006
039000              B.GROUP_CODE,                                       04320006
039100              B.SKU_DESC,                                         04330006
039200              B.SIZE_DESC,                                        04340006
039300              B.COLOR_DESC,                                       04350006
039400              B.COST_UNIT_MSRMNT,                                 04360006
039500              B.RTL_UNIT_MSRMNT,                                  04370006
039600              B.UNIT_COST_AMT,                                    04380006
039700              B.GP_RTL_AMT,                                       04390006
039800              B.CUR_UNIT_RTL_AMT,                                 04400006
039900              B.VNDR_INNR_PACK_QTY,                               04410006
040000              B.GP_QTY,                                           04420006
040100              C.STR_NBR,                                          04430006
040200              C.MINDD_QTY,                                        04440006
040300              C.PTAG_ID,                                          04450006
040400              C.ON_ORDER_QTY,                                     04460006
040500              C.COMSTK_QTY,                                       04470006
040600              C.SPOQSW_CDE,                                       04480006
040700              C.SPOQ_QTY,                                         04490006
040800              C.FT_CDE,                                           04500006
040900              C.OSTRAT_QTY,                                       04510006
041000              C.CSTOCK_QTY,                                       04520006
041100              C.MINOUTL_QTY,                                      04530006
041200              C.MAXOUTL_QTY,                                      04540006
041300              C.MAXOQP_PCT,                                       04550006
041400              C.FOQ_QTY,                                          04560006
041500              C.TMIN_QTY,                                         04570006
041600              C.USERMIN_QTY,                                      04580006
041700              C.USERMAX_QTY,                                      04590006
041800              C.DD_FCTR,                                          04600006
041900              C.DDI_FCTR,                                         04610006
042000              C.LPP_QTY,                                          04620006
042100              C.MADSS_QTY,                                        04630006
042200              C.FWMAD_QTY,                                        04640006
042300              C.TRNDP_PCT,                                        04650006
042400              C.MSDTS_QTY,                                        04660006
042500              C.MADTS_QTY,                                        04670006
042600              C.LTVFACT_FCTR,                                     04680006
042700              C.PCTZ_PCT,                                         04690006
042800              C.MADSTAT_CDE,                                      04700006
042900              C.DFLREG_CDE,                                       04710006
043000              C.TSREG_CDE,                                        04720006
043100              C.DIREG_CDE,                                        04730006
043200              C.BYPREG_CDE,                                       04740006
043300              C.LDD_FCTR,                                         04750006
043400              C.LDDI_FCTR,                                        04760006
043500              C.LFWMAD_QTY,                                       04770006
043600              C.OUTSTAT_CDE,                                      04780006
043700              C.LRTFCST_NBR,                                      04790006
043800              C.ORDSTAT_CDE,                                      04800006
043900              C.CSTKMINT1_PCT,                                    04810006
044000              C.CSTKMINT2_PCT,                                    04820006
044100              C.CSTKMINT3_PCT,                                    04830006
044200              C.CSTKMINT4_PCT,                                    04840006
044300              C.CSTKMINT5_PCT,                                    04850006
044400              C.CSTKMINT6_PCT,                                    04860006
044500              C.CSTKMAXT1_PCT,                                    04870006
044600              C.CSTKMAXT2_PCT,                                    04880006
044700              C.CSTKMAXT3_PCT,                                    04890006
044800              C.CSTKMAXT4_PCT,                                    04900006
044900              C.CSTKMAXT5_PCT,                                    04910006
045000              C.CSTKMAXT6_PCT,                                    04920006
045100              C.FTJOPF_CDE,                                       04930006
045200              D.SEQ_NBR,                                          04940006
045300              D.LFWM_QTY,                                         04950006
045400              D.FWM_QTY                                           04960006
045500         FROM TMRITEM A,                                          04970006
045600              TSK B,                                              04980006
045700              TMRITST C,                                          04990006
045800              TMRISFE D,                                          05000006
045900              TSKXREF X                                           05010006
046000        WHERE A.ITEM_NBR  = B.ITEM_NMBR                           05020006
046100          AND B.ITEM_NMBR = C.ITEM_NBR                            05030006
046200          AND C.ITEM_NBR  = D.ITEM_NBR                            05040006
046300          AND D.ITEM_NBR  = X.ITM_NBR                             05050006
046400          AND C.STR_NBR   = D.STR_NBR                             05060006
046500          AND C.FT_CDE <> 'X'                                     05070006
046600          AND C.STR_NBR IN (                                      05080006
046700                    SELECT LOC_NBR                                05090006
046800                      FROM XMT_LOC                                05100006
046900                     WHERE E_BUS_IND = 'Y'                        05110006
047000*                      AND LOC_TYP_CDE = 'DS')                    05120006
3372A                        AND LOC_TYP_CDE = 'DS'))                   05130006
3372A        SELECT DATA_1.ITEM_NBR,                                    05140006
3372A               DATA_1.UCYCLE_CDE,                                  05150006
3372A               DATA_1.TSL_NBR,                                     05160006
3372A               DATA_1.BYPDDU_CDE,                                  05170006
3372A               DATA_1.BYPSCL_NBR,                                  05180006
3372A               DATA_1.FRCDDU_CDE,                                  05190006
3372A               DATA_1.BYPZSL_CDE,                                  05200006
3372A               DATA_1.BYPTFP_CDE,                                  05210006
3372A               DATA_1.BYPZOH_CDE,                                  05220006
3372A               DATA_1.BYPBEF_CDE,                                  05230006
3372A               DATA_1.BYPAFT_CDE,                                  05240006
3372A               DATA_1.LUMPSW_CDE,                                  05250006
3372A               DATA_1.MINBI_FCTR,                                  05260006
3372A               DATA_1.DDFTSW_CDE,                                  05270006
3372A               DATA_1.RT_NBR,                                      05280006
3372A               DATA_1.RTF_FCTR,                                    05290006
3372A               DATA_1.ZOPSW_CDE,                                   05300006
3372A               DATA_1.OUTLSW_CDE,                                  05310006
3372A               DATA_1.ZSSTOCK_CDE,                                 05320006
3372A               DATA_1.PACKSW_CDE,                                  05330006
3372A               DATA_1.DSER_CDE,                                    05340006
3372A               DATA_1.LT_QTY,                                      05350006
3372A               DATA_1.IMIN_QTY,                                    05360006
3372A               DATA_1.IMAX_QTY,                                    05370006
3372A               DATA_1.SSADJ_PCT,                                   05380006
3372A               DATA_1.RT_DAY_NBR,                                  05390006
3372A               DATA_1.DDUPRM_SW,                                   05400006
3372A               DATA_1.ORD_GROUP_SW,                                05410006
3372A               DATA_1.DEPT,                                        05420006
3372A               DATA_1.CLASS,                                       05430006
3372A               DATA_1.SUBCLASS,                                    05440006
3372A               DATA_1.SKU,                                         05450006
3372A               DATA_1.MERCH_DIV_CODE,                              05460006
3372A               DATA_1.DMM_NMBR,                                    05470006
3372A               DATA_1.VENDOR_NMBR,                                 05480006
3372A               DATA_1.VNDR_IN_HSE_NMBR,                            05490006
3372A               DATA_1.VENDOR_STYLE_CODE,                           05500006
3372A               DATA_1.GROUP_CODE,                                  05510006
3372A               DATA_1.SKU_DESC,                                    05520006
3372A               DATA_1.SIZE_DESC,                                   05530006
3372A               DATA_1.COLOR_DESC,                                  05540006
3372A               DATA_1.COST_UNIT_MSRMNT,                            05550006
3372A               DATA_1.RTL_UNIT_MSRMNT,                             05560006
3372A               DATA_1.UNIT_COST_AMT,                               05570006
3372A               DATA_1.GP_RTL_AMT,                                  05580006
3372A               DATA_1.CUR_UNIT_RTL_AMT,                            05590006
3372A               COALESCE(Y.INNR_PK_QTY,DATA_1.VNDR_INNR_PACK_QTY),  05600006
3372A               DATA_1.GP_QTY,                                      05610006
3372A               DATA_1.STR_NBR,                                     05620006
3372A               DATA_1.MINDD_QTY,                                   05630006
3372A               DATA_1.PTAG_ID,                                     05640006
3372A               DATA_1.ON_ORDER_QTY,                                05650006
3372A               DATA_1.COMSTK_QTY,                                  05660006
3372A               DATA_1.SPOQSW_CDE,                                  05670006
3372A               DATA_1.SPOQ_QTY,                                    05680006
3372A               DATA_1.FT_CDE,                                      05690006
3372A               DATA_1.OSTRAT_QTY,                                  05700006
3372A               DATA_1.CSTOCK_QTY,                                  05710006
3372A               DATA_1.MINOUTL_QTY,                                 05720006
3372A               DATA_1.MAXOUTL_QTY,                                 05730006
3372A               DATA_1.MAXOQP_PCT,                                  05740006
3372A               DATA_1.FOQ_QTY,                                     05750006
3372A               DATA_1.TMIN_QTY,                                    05760006
3372A               DATA_1.USERMIN_QTY,                                 05770006
3372A               DATA_1.USERMAX_QTY,                                 05780006
3372A               DATA_1.DD_FCTR,                                     05790006
3372A               DATA_1.DDI_FCTR,                                    05800006
3372A               DATA_1.LPP_QTY,                                     05810006
3372A               DATA_1.MADSS_QTY,                                   05820006
3372A               DATA_1.FWMAD_QTY,                                   05830006
3372A               DATA_1.TRNDP_PCT,                                   05840006
3372A               DATA_1.MSDTS_QTY,                                   05850006
3372A               DATA_1.MADTS_QTY,                                   05860006
3372A               DATA_1.LTVFACT_FCTR,                                05870006
3372A               DATA_1.PCTZ_PCT,                                    05880006
3372A               DATA_1.MADSTAT_CDE,                                 05890006
3372A               DATA_1.DFLREG_CDE,                                  05900006
3372A               DATA_1.TSREG_CDE,                                   05910006
3372A               DATA_1.DIREG_CDE,                                   05920006
3372A               DATA_1.BYPREG_CDE,                                  05930006
3372A               DATA_1.LDD_FCTR,                                    05940006
3372A               DATA_1.LDDI_FCTR,                                   05950006
3372A               DATA_1.LFWMAD_QTY,                                  05960006
3372A               DATA_1.OUTSTAT_CDE,                                 05970006
3372A               DATA_1.LRTFCST_NBR,                                 05980006
3372A               DATA_1.ORDSTAT_CDE,                                 05990006
3372A               DATA_1.CSTKMINT1_PCT,                               06000006
3372A               DATA_1.CSTKMINT2_PCT,                               06010006
3372A               DATA_1.CSTKMINT3_PCT,                               06020006
3372A               DATA_1.CSTKMINT4_PCT,                               06030006
3372A               DATA_1.CSTKMINT5_PCT,                               06040006
3372A               DATA_1.CSTKMINT6_PCT,                               06050006
3372A               DATA_1.CSTKMAXT1_PCT,                               06060006
3372A               DATA_1.CSTKMAXT2_PCT,                               06070006
3372A               DATA_1.CSTKMAXT3_PCT,                               06080006
3372A               DATA_1.CSTKMAXT4_PCT,                               06090006
3372A               DATA_1.CSTKMAXT5_PCT,                               06100006
3372A               DATA_1.CSTKMAXT6_PCT,                               06110006
3372A               DATA_1.FTJOPF_CDE,                                  06120006
3372A               DATA_1.SEQ_NBR,                                     06130006
3372A               DATA_1.LFWM_QTY,                                    06140006
3372A               DATA_1.FWM_QTY                                      06150006
3372A               FROM DATA_1                                         06160006
3372A               LEFT OUTER JOIN MRTW_SKU_PKGNG_OVRRID Y             06170006
3372A               ON (DATA_1.SKU=Y.SKU_NBR)                           06180006
3372A               AND Y.DISTRB_TYP_CDE = 'E'                          06190006
047100     END-EXEC.                                                    06200006
047200*                                                                 06210006
047300* CURSOR FOR TMRISHS                                              06220006
047400*                                                                 06230006
047500     EXEC SQL                                                     06240006
047600         DECLARE ITEM_HIST_CSR CURSOR FOR                         06250006
047700          SELECT                                                  06260006
047800                 YR_NBR                                           06270006
047900               , WK_NBR                                           06280006
048000               , ITM_REV_ID                                       06290006
048100               , SLS_HIST_QTY                                     06300006
048200               , OH_HIST_QTY                                      06310006
048300               , MAD_HIST_QTY                                     06320006
048400               , DSD_HIST_QTY                                     06330006
048500           FROM                                                   06340006
048600                 TMRISHS                                          06350006
048700          WHERE  ITM_NBR = :MRISHS-ITM-NBR                        06360006
048800            AND  STR_NBR = :MRISHS-STR-NBR                        06370006
048900       ORDER BY  YR_NBR     DESC                                  06380006
049000               , WK_NBR     DESC                                  06390006
049100               , ITM_REV_ID DESC                                  06400006
049200     END-EXEC.                                                    06410006
049300*                                                                 06420006
049400*                                                                 06430006
049500*                                                                 06440006
049600***************************************************************** 06450006
049700*PROCEDURE DIVISION.                                              06460006
049800***************************************************************** 06470006
049900 PROCEDURE DIVISION.                                              06480006
050000*                                                                 06490006
050100*                                                                 06500006
050200 A000-MAINLINE-PROCESSING.                                        06510006
050300*                                                                 06520006
050400     DISPLAY 'TEST VERSION FROM TKMA949.Z.PGMSRC'                 06530006
050400     PERFORM A100-INITIALIZATION.                                 06540006
050500*                                                                 06550006
050600     PERFORM B000-PROCESS-SYSTEM-RECORD                           06560006
050700             UNTIL EOC-ITEM-CSR.                                  06570006
050800*                                                                 06580006
050900     PERFORM Y100-END-ROUTINE.                                    06590006
051000*                                                                 06600006
051100     GOBACK.                                                      06610006
051200*                                                                 06620006
051300 EJECT                                                            06630006
051400******************************************************************06640006
051500** OPEN THE SYSTEM FILE AND ACCEPT CONTROL CARDS.                 06650006
051600** CALL CALENDAR ROUTINES TO RETRIEVE VALUES NEEDED IN PROGRAM    06660006
051700******************************************************************06670006
051800 A100-INITIALIZATION.                                             06680006
051900*                                                                 06690006
052000*                                                                 06700006
052100     OPEN  INPUT IC-CONTROL-FILE                                  06710006
052200                 IC-PARM-FILE                                     06720006
052300          OUTPUT TRANSFER-RECORD.                                 06730006
052400*                                                                 06740006
052500     IF  PV-VSAM-SUCCESSFUL                                       06750006
052600        CONTINUE                                                  06760006
052700     ELSE                                                         06770006
052800        IF PV-VSAM-NOT-FOUND                                      06780006
052900           DISPLAY '** ABEND **'                                  06790006
053000           DISPLAY '** PROGRAM    = MRKUT104'                     06800006
053100           DISPLAY '** PARAGRAPH  = A100-INITIALIZATION   '       06810006
053200           DISPLAY '** MESSAGE    = '                             06820006
053300                   'RECORD NOT FOUND,STATUS: ' PV-VSAM-STATUS     06830006
053400           MOVE +4008           TO PV-ABEND-CODE                  06840006
053500           CALL 'ILBOABN0'      USING PV-ABEND-CODE               06850006
053600        ELSE                                                      06860006
053700           DISPLAY '** ABEND **'                                  06870006
053800           DISPLAY '** PROGRAM    = MRKUT104'                     06880006
053900           DISPLAY '** PARAGRAPH  = A100-INITIALIZATION   '       06890006
054000           DISPLAY '** MESSAGE    = '                             06900006
054100                   'BAD VSAM READ, STATUS = ' PV-VSAM-STATUS      06910006
054200           MOVE +4005           TO PV-ABEND-CODE                  06920006
054300           CALL 'ILBOABN0'      USING PV-ABEND-CODE               06930006
054400        END-IF                                                    06940006
054500     END-IF.                                                      06950006
054600     INITIALIZE PV-OUTPUT.                                        06960006
054700*                                                                 06970006
054800*    ACCEPT PARAMETER-INPUT-RECORD.                               06980006
054900*                                                                 06990006
055000     PERFORM R100-READ-PARM-FILE.                                 07000006
055100*                                                                 07010006
055200     MOVE MR001I-S-SYS-ID   TO  S-SYS-ID.                         07020006
055300     MOVE PC-RCD-TYPE       TO  S-RCD-TYPE.                       07030006
055400     MOVE LOW-VALUES        TO  S-RCD-ID.                         07040006
055500     MOVE S-KEY             TO  ICCTL-KEY.                        07050006
055600     PERFORM R000-READ-CONTROL-FILE.                              07060006
055700*                                                                 07070006
055800     DISPLAY ' MR001I-S-RUN-CYCLE: ' MR001I-S-RUN-CYCLE           07080006
055900*                                                                 07090006
056000     IF MR001I-S-RUN-CYCLE = PC-B                                 07100006
056100         MOVE PC-4          TO MRITEM-RT-NBR                      07110006
056200         MOVE ZERO          TO MRITEM-RT-DAY-NBR                  07120006
056300     END-IF.                                                      07130006
056400*                                                                 07140006
056500     IF MR001I-S-RUN-CYCLE = PC-S                                 07150006
056600         MOVE PC-4          TO MRITEM-RT-NBR                      07160006
056700         MOVE PC-100        TO MRITEM-RT-DAY-NBR                  07170006
056800     END-IF.                                                      07180006
056900*                                                                 07190006
057000     IF MR001I-S-RUN-CYCLE = PC-D                                 07200006
057100         MOVE PC-7          TO MRITEM-RT-NBR                      07210006
057200         MOVE S-TNOW-DN     TO MRITEM-RT-DAY-NBR                  07220006
057300     END-IF.                                                      07230006
057400*                                                                 07240006
057500*  FOR THE 1B ONCE A WEEK SYSTEM     S.M 1/2000                   07250006
057600     MOVE ZERO TO PV-TNOW-ADD-DAY.                                07260006
057700     IF MR001I-S-RUN-CYCLE = PC-E                                 07270006
057800         MOVE PC-7          TO MRITEM-RT-NBR                      07280006
057900         ADD  PC-100        TO S-TNOW-DN                          07290006
058000            GIVING PV-TNOW-ADD-DAY                                07300006
058100         MOVE PV-TNOW-ADD-DAY TO MRITEM-RT-DAY-NBR                07310006
058200     END-IF.                                                      07320006
058300*                                                                 07330006
057500*  FOR THE 1C ONCE A WEEK SYSTEM     R.S 10/2007                  07340006
057700     IF MR001I-S-RUN-CYCLE = PC-F                                 07350006
057800         MOVE PC-7          TO MRITEM-RT-NBR                      07360006
057900         ADD  PC-200        TO S-TNOW-DN                          07370006
058000            GIVING PV-TNOW-ADD-DAY                                07380006
058100         MOVE PV-TNOW-ADD-DAY TO MRITEM-RT-DAY-NBR                07390006
058200     END-IF.                                                      07400006
058300*                                                                 07410006
058400*                                                                 07420006
058500     IF MR001I-S-RUN-CYCLE = PC-Z                                 07430006
058600         MOVE ZERO          TO MRITEM-RT-NBR                      07440006
058700         MOVE ZERO          TO MRITEM-RT-DAY-NBR                  07450006
058800     END-IF.                                                      07460006
058900*                                                                 07470006
059000     IF MR001I-S-RUN-CYCLE = PC-C                                 07480006
059100         MOVE S-TNOW-WN     TO PV-TNOW-WN-NOSIGN                  07490006
059200         MOVE PV-TNOW-WN-NOSIGN                                   07500006
059300                            TO PV-TNOW-WN-SPLIT                   07510006
059400         IF PV-ODD                                                07520006
059500             MOVE PC-14     TO MRITEM-RT-NBR                      07530006
059600             MOVE S-TNOW-DN TO MRITEM-RT-DAY-NBR                  07540006
059700         ELSE                                                     07550006
059800             MOVE PC-14     TO MRITEM-RT-NBR                      07560006
059900             COMPUTE MRITEM-RT-DAY-NBR = S-TNOW-DN + PC-7         07570006
060000         END-IF                                                   07580006
060100     END-IF.                                                      07590006
060200*                                                                 07600006
060300     DISPLAY 'S-TNOW-WN: '    S-TNOW-WN.                          07610006
060400     DISPLAY 'S-TNOW-DN: '    S-TNOW-DN.                          07620006
060500     DISPLAY 'A.RT_NBR: '     MRITEM-RT-NBR.                      07630006
060600     DISPLAY 'A.RT_DAY_NBR: ' MRITEM-RT-DAY-NBR.                  07640006
060700     DISPLAY 'A.RT_DAY_NBR:+100 ' PV-TNOW-ADD-DAY.                07650006
060800*                                                                 07660006
060900     MOVE S-TNOW-WN  TO PV-TNOW-WN.                               07670006
061000     MOVE S-TNOW-DN  TO PV-TNOW-DN.                               07680006
061100*                                                                 07690006
061200     MOVE MR001I-S-SYS-ID   TO  D-SYS-ID.                         07700006
061300     MOVE PC-DDM            TO  D-RCD-TYPE.                       07710006
061400     MOVE LOW-VALUES        TO  D-RCD-ID.                         07720006
061500     MOVE D-KEY             TO  ICCTL-KEY.                        07730006
061600     PERFORM R000-READ-CONTROL-FILE.                              07740006
061700*                                                                 07750006
061800     MOVE PC-1 TO FL-WEEK-NBR (1).                                07760006
061900     MOVE PC-2 TO FL-WEEK-NBR (2).                                07770006
062000     MOVE PC-3 TO FL-WEEK-NBR (3).                                07780006
062100     MOVE PC-4 TO FL-WEEK-NBR (4).                                07790006
062200*                                                                 07800006
062300     PERFORM S200-SELECT-SEQ-NBR1.                                07810006
062400     PERFORM S300-SELECT-SEQ-NBR2.                                07820006
062500     PERFORM S400-SELECT-SEQ-NBR3.                                07830006
062600     PERFORM S500-SELECT-SEQ-NBR4.                                07840006
062700*                                                                 07850006
062800     PERFORM I100-SET-WEEK-TABLE.                                 07860006
062900*                                                                 07870006
063000     MOVE PC-N TO PS-EOC-ITEM-CSR.                                07880006
063100     PERFORM S100-OPEN-ITEM-CSR.                                  07890006
063200                                                                  07900006
063300*                                                                 07910006
063400 EJECT                                                            07920006
063500******************************************************************07930006
063600*                                                                *07940006
063700******************************************************************07950006
063800 B000-PROCESS-SYSTEM-RECORD.                                      07960006
063900*                                                                 07970006
064000*    DISPLAY 'B000-PROCESS-SYSTEM-RECORD'.                        07980006
064100*                                                                 07990006
064200     PERFORM T300-FETCH-ITEM-CURSOR.                              08000006
064300*                                                                 08010006
064400     IF EOC-ITEM-CSR                                              08020006
064500       CONTINUE                                                   08030006
064600     ELSE                                                         08040006
064700       PERFORM C000-FORMAT-TRANSFER-REC                           08050006
064800           UNTIL EOC-ITEM-CSR                                     08060006
064900     END-IF.                                                      08070006
065000*                                                                 08080006
065100*                                                                 08090006
065200 EJECT                                                            08100006
065300******************************************************************08110006
065400*                                                                *08120006
065500******************************************************************08130006
065600 C000-FORMAT-TRANSFER-REC.                                        08140006
065700*                                                                 08150006
065800*    DISPLAY 'C000-FORMAT-TRANSFER-REC'.                          08160006
065900*                                                                 08170006
066000*                                                                 08180006
066100     PERFORM F000-FORMAT-TRAN-INPUT.                              08190006
066200*                                                                 08200006
066300     PERFORM G000-FORMAT-ROD-USER-AREA.                           08210006
066400*                                                                 08220006
066500     PERFORM H000-FORMAT-ROH-USER-AREA.                           08230006
066600*                                                                 08240006
066700     PERFORM W000-WRITE-OUTPUT.                                   08250006
066800*                                                                 08260006
066900     PERFORM T300-FETCH-ITEM-CURSOR.                              08270006
067000*                                                                 08280006
067100******************************************************************08290006
067200*  MOVE VALUES INTO THE TRANSFER-RECORD LAYOUT FOR OUTPUT         08300006
067300******************************************************************08310006
067400 F000-FORMAT-TRAN-INPUT.                                          08320006
067500*                                                                 08330006
067600*    DISPLAY 'F000-FORMAT-TRAN-INPUT'.                            08340006
067700*                                                                 08350006
067800*    FORMAT/MOVE ADDITIONAL FIELDS.                               08360006
067900*                                                                 08370006
068000     MOVE SKXREF-DEPT                 TO NI-DEPT-9-3.             08380006
068100     MOVE NI-DEPT-9-3                 TO MR017-DEPT-NBR.          08390006
068110     MOVE SKXREF-SUBCLASS             TO NI-SUB-CLASS-9-2.        08400006
068120     MOVE NI-SUB-CLASS-9-2            TO MR017-CLASS-NBR.         08410006
068130     MOVE TSK-VNDR-IN-HSE-NMBR        TO MR017-VEND-NBR.          08420006
068140     MOVE SKXREF-SKU                  TO MR017-SKU-NBR.           08430006
068150     MOVE MRITEM-ITEM-NBR             TO MR017-ITEM-NBR.          08440006
113900     MOVE MRITST-STR-NBR              TO MR017-STR-NBR            08450006
068170     MOVE MRISFE-SEQ-NBR              TO MR017-FE-SEQ-NBR.        08460006
068180     MOVE MRISFE-LFWM-QTY             TO MR017-LFWM-QTY.          08470006
068190     MOVE MRISFE-FWM-QTY              TO MR017-FWM-QTY.           08480006
068200                                                                  08490006
068300     SET FL-INDEX TO 1.                                           08500006
068400     SEARCH FL-FORECAST-LOOKUP-ENTRIES                            08510006
068500        WHEN FL-SEQ-NBR (FL-INDEX) = MRISFE-SEQ-NBR               08520006
068600           MOVE FL-WEEK-NBR (FL-INDEX) TO MR017-WEEK-NBR          08530006
068700     END-SEARCH.                                                  08540006
068800*                                                                 08550006
068900*  ADD LOGIC TO EVALUATE FOR UCYCLE 5                             08560006
069000     IF MRITEM-UCYCLE-CDE = PC-5A                                 08570006
069100        IF MRITST-DD-FCTR = 0                                     08580006
069200           MOVE MRITST-DD-FCTR TO PV-TEMP-DD-FCTR                 08590006
069300        ELSE                                                      08600006
069400           COMPUTE PV-TEMP-DD-FCTR =                              08610006
069500               MRITST-DD-FCTR / PC-4                              08620006
069600        END-IF                                                    08630006
069700     ELSE                                                         08640006
069800        MOVE MRITST-DD-FCTR TO PV-TEMP-DD-FCTR                    08650006
069900     END-IF.                                                      08660006
070000*  ADD LOGIC END                                                  08670006
070100                                                                  08680006
070200     EVALUATE TRUE                                                08690006
070300       WHEN PV-TEMP-DD-FCTR <= D-MAXDD-1                          08700006
070400           MOVE D-CADL-1              TO MR017-CADL               08710006
070500           MOVE D-IDFL-1              TO MR017-IDFL               08720006
070600           MOVE D-HIDFL-1             TO MR017-HIDFL              08730006
070700           MOVE D-LODFL-1             TO MR017-LODFL              08740006
070800           MOVE D-NDFL-1              TO MR017-NDFL               08750006
070900           MOVE D-DAMP-1              TO MR017-DAMP               08760006
071000           MOVE D-MINSMK-1            TO MR017-MINSMK             08770006
071100           MOVE D-MAXSMK-1            TO MR017-MAXSMK             08780006
071200           MOVE D-HIPCT-1             TO MR017-HIPCT              08790006
071300           MOVE D-LOPCT-1             TO MR017-LOPCT              08800006
071400           MOVE D-HIMADP-1            TO MR017-HIMADP             08810006
071500           MOVE D-LOMADP-1            TO MR017-LOMADP             08820006
071600           MOVE D-TSL-1               TO MR017-TSL                08830006
071700           MOVE D-BYPZSL-1            TO MR017-BYPZSL             08840006
071800       WHEN PV-TEMP-DD-FCTR <= D-MAXDD-2                          08850006
071900           MOVE D-CADL-2              TO MR017-CADL               08860006
072000           MOVE D-IDFL-2              TO MR017-IDFL               08870006
072100           MOVE D-HIDFL-2             TO MR017-HIDFL              08880006
072200           MOVE D-LODFL-2             TO MR017-LODFL              08890006
072300           MOVE D-NDFL-2              TO MR017-NDFL               08900006
072400           MOVE D-DAMP-2              TO MR017-DAMP               08910006
072500           MOVE D-MINSMK-2            TO MR017-MINSMK             08920006
072600           MOVE D-MAXSMK-2            TO MR017-MAXSMK             08930006
072700           MOVE D-HIPCT-2             TO MR017-HIPCT              08940006
072800           MOVE D-LOPCT-2             TO MR017-LOPCT              08950006
072900           MOVE D-HIMADP-2            TO MR017-HIMADP             08960006
073000           MOVE D-LOMADP-2            TO MR017-LOMADP             08970006
073100           MOVE D-TSL-2               TO MR017-TSL                08980006
073200           MOVE D-BYPZSL-2            TO MR017-BYPZSL             08990006
073300       WHEN PV-TEMP-DD-FCTR <= D-MAXDD-3                          09000006
073400           MOVE D-CADL-3              TO MR017-CADL               09010006
073500           MOVE D-IDFL-3              TO MR017-IDFL               09020006
073600           MOVE D-HIDFL-3             TO MR017-HIDFL              09030006
073700           MOVE D-LODFL-3             TO MR017-LODFL              09040006
073800           MOVE D-NDFL-3              TO MR017-NDFL               09050006
073900           MOVE D-DAMP-3              TO MR017-DAMP               09060006
074000           MOVE D-MINSMK-3            TO MR017-MINSMK             09070006
074100           MOVE D-MAXSMK-3            TO MR017-MAXSMK             09080006
074200           MOVE D-HIPCT-3             TO MR017-HIPCT              09090006
074300           MOVE D-LOPCT-3             TO MR017-LOPCT              09100006
074400           MOVE D-HIMADP-3            TO MR017-HIMADP             09110006
074500           MOVE D-LOMADP-3            TO MR017-LOMADP             09120006
074600           MOVE D-TSL-3               TO MR017-TSL                09130006
074700           MOVE D-BYPZSL-3            TO MR017-BYPZSL             09140006
074800     END-EVALUATE.                                                09150006
074900                                                                  09160006
075000***********************************                               09170006
075100**     WHEN PV-TEMP-DD-FCTR < PC-1                                09180006
075200**         MOVE PC-3                  TO MR017-IDFL               09190006
075300**         MOVE PC-5                  TO MR017-HIDFL              09200006
075400**         MOVE PC-2                  TO MR017-LODFL              09210006
075500**         MOVE PC-3                  TO MR017-NDFL               09220006
075600**         MOVE PC-30A                TO MR017-HIPCT              09230006
075700**         MOVE PC-20A                TO MR017-LOPCT              09240006
075800**         MOVE ZEROES                TO MR017-HIMADP             09250006
075900**     WHEN PV-TEMP-DD-FCTR >= PC-1 AND < PC-11                   09260006
076000**         MOVE PC-3                  TO MR017-IDFL               09270006
076100**         MOVE PC-3                  TO MR017-HIDFL              09280006
076200**         MOVE PC-2                  TO MR017-LODFL              09290006
076300**         MOVE PC-3                  TO MR017-NDFL               09300006
076400**         MOVE PC-30A                TO MR017-HIPCT              09310006
076500**         MOVE PC-20A                TO MR017-LOPCT              09320006
076600**         MOVE PC-50P                TO MR017-HIMADP             09330006
076700**     WHEN PV-TEMP-DD-FCTR > PC-10                               09340006
076800**         MOVE PC-3                  TO MR017-IDFL               09350006
076900**         MOVE PC-2                  TO MR017-HIDFL              09360006
077000**         MOVE PC-2                  TO MR017-LODFL              09370006
077100**         MOVE PC-3                  TO MR017-NDFL               09380006
077200**         MOVE PC-30A                TO MR017-HIPCT              09390006
077300**         MOVE PC-30A                TO MR017-LOPCT              09400006
077400**         MOVE PC-50P                TO MR017-HIMADP             09410006
077500***********************************                               09420006
077600*                                                                 09430006
077700     MOVE MRITEM-UCYCLE-CDE           TO MR017-UCYCLE.            09440006
077800     MOVE PV-TNOW-WN                  TO MR017-WN.                09450006
077900     MOVE PV-TNOW-DN                  TO MR017-DN.                09460006
078000**   MOVE MRITEM-TSL-NBR              TO MR017-TSL.               09470006
078100     MOVE MRITEM-BYPDDU-CDE           TO MR017-BYPDDU.            09480006
078200     MOVE MRITEM-BYPSCL-NBR           TO MR017-BYPSCL.            09490006
078300     MOVE MRITEM-FRCDDU-CDE           TO MR017-FRCDDU.            09500006
078400**   MOVE MRITEM-BYPZSL-CDE           TO MR017-BYPZSL.            09510006
078500     MOVE MRITEM-BYPTFP-CDE           TO MR017-BYPTFP.            09520006
078600     MOVE MRITEM-BYPZOH-CDE           TO MR017-BYPZOH.            09530006
078700     MOVE MRITEM-BYPBEF-CDE           TO MR017-BYPBEF.            09540006
078800     MOVE MRITEM-BYPAFT-CDE           TO MR017-BYPAFT.            09550006
078900     MOVE MRITEM-LUMPSW-CDE           TO MR017-LUMPSW.            09560006
079000     MOVE MRITEM-MINBI-FCTR           TO MR017-MINBI.             09570006
079100     MOVE MRITEM-DDFTSW-CDE           TO MR017-DDFTSW.            09580006
079200     MOVE MRITST-MINDD-QTY            TO MR017-MINDD.             09590006
079300     MOVE MRITEM-RT-NBR               TO MR017-RT.                09600006
079400     MOVE MRITEM-RTF-FCTR             TO MR017-RTF.               09610006
079500     MOVE MRITEM-ZOPSW-CDE            TO MR017-ZOPSW.             09620006
079600     MOVE MRITEM-OUTLSW-CDE           TO MR017-OUTLSW.            09630006
079700     MOVE MRITEM-ZSSTOCK-CDE          TO MR017-ZSSTOCK.           09640006
079800     MOVE MRITEM-PACKSW-CDE           TO MR017-PACKSW.            09650006
079900     MOVE MRITEM-DSER-CDE             TO MR017-DSER.              09660006
080000     MOVE MRITEM-DDUPRM-SW            TO MR017-DDUPRM.            09670006
080100     MOVE MRITST-PTAG-ID              TO MR017-PTAG.              09680006
080200     MOVE MRITEM-LT-QTY               TO MR017-LT.                09690006
080300     MOVE TSK-UNIT-COST-AMT           TO MR017-ICOST.             09700006
080400     MOVE MRITST-ON-ORDER-QTY         TO MR017-OO.                09710006
080500     MOVE MRITST-COMSTK-QTY           TO MR017-COMSTK.            09720006
080600     MOVE MRITST-SPOQSW-CDE           TO MR017-SPOQSW.            09730006
080700     MOVE MRITST-SPOQ-QTY             TO MR017-SPOQ.              09740006
080800*                                                                 09750006
080900     MOVE TSK-SKU-DESC                TO PV-INAME-SKU-DESC.       09760006
081000     MOVE SKXREF-SKU                  TO PV-INAME-SKU.            09770006
081100     MOVE MRITST-STR-NBR              TO PV-INAME-STORE.          09780006
081200*                                                                 09790006
081300     IF MRITEM-ORD-GROUP-SW = 'Y'                                 09800006
081400        MOVE TSK-GROUP-CODE TO PV-INAME-GROUP-CODE                09810006
081500     ELSE                                                         09820006
081600        MOVE SPACES TO PV-INAME-GROUP-CODE                        09830006
081700     END-IF                                                       09840006
081800                                                                  09850006
081900     IF PV-INAME-STORE = ZERO                                     09860006
082000        MOVE 'C'                      TO PV-INAME-STORE-CODE      09870006
082100        MOVE SPACES                   TO PV-INAME-STORE-HEADING   09880006
082300     ELSE                                                         09890006
082400        MOVE 'S'                      TO PV-INAME-STORE-CODE      09900006
082500        MOVE PC-STORE-NAME            TO PV-INAME-STORE-HEADING   09910006
082600     END-IF.                                                      09920006
082700                                                                  09930006
082800     MOVE PV-INAME                    TO MR017-INAME.             09940006
082900*                                                                 09950006
083000     MOVE TSK-VENDOR-STYLE-CODE       TO PV-SKU-STYLE.            09960006
083100     MOVE TSK-SIZE-DESC               TO PV-SKU-SIZE.             09970006
083200     MOVE TSK-COLOR-DESC              TO PV-SKU-COLOR.            09980006
083300     MOVE TSK-VNDR-IN-HSE-NMBR        TO PV-SKU-VEND-NBR.         09990006
083400     MOVE PV-SKU                      TO MR017-SKU.               10000006
083500*                                                                 10010006
083600*    MOVE TUPCSKU-UPC-NBR             TO MR017-UPC.               10020006
083700     MOVE MRITST-FT-CDE               TO MR017-FT.                10030006
083800     MOVE MRITST-OSTRAT-QTY           TO MR017-OSTRAT.            10040006
083900     MOVE TSK-VNDR-INNR-PACK-QTY      TO MR017-PACKSZ.            10050006
084000     MOVE MRITEM-IMIN-QTY             TO MR017-IMIN.              10060006
084100     MOVE MRITEM-IMAX-QTY             TO MR017-IMAX.              10070006
084200     MOVE MRITST-CSTOCK-QTY           TO MR017-CSTOCK.            10080006
084300     MOVE MRITEM-SSADJ-PCT            TO MR017-SSADJ.             10090006
084400     MOVE MRITST-MINOUTL-QTY          TO MR017-MINOUTL.           10100006
084500     MOVE MRITST-MAXOUTL-QTY          TO MR017-MAXOUTL.           10110006
084600     MOVE MRITST-MAXOQP-PCT           TO MR017-MAXOQP.            10120006
084700     MOVE MRITST-FOQ-QTY              TO MR017-FOQ.               10130006
084800     MOVE MRITST-TMIN-QTY             TO MR017-TMIN.              10140006
084900     MOVE MRITST-USERMIN-QTY          TO MR017-USERMIN.           10150006
085000     MOVE MRITST-USERMAX-QTY          TO MR017-USERMAX.           10160006
085100     MOVE MRITST-DD-FCTR              TO MR017-DD.                10170006
085200     MOVE MRITST-DDI-FCTR             TO MR017-DDI.               10180006
085300     MOVE MRITST-LPP-QTY              TO MR017-LPP.               10190006
085400     MOVE MRITST-MADSS-QTY            TO MR017-MADSS.             10200006
085500     MOVE MRITST-FWMAD-QTY            TO MR017-FWMAD.             10210006
085600     MOVE MRITST-TRNDP-PCT            TO MR017-TRNDP.             10220006
085700     MOVE MRITST-MSDTS-QTY            TO MR017-MSDTS.             10230006
085800     MOVE MRITST-MADTS-QTY            TO MR017-MADTS.             10240006
085900     MOVE MRITST-LTVFACT-FCTR         TO MR017-LTVFACT.           10250006
086000     MOVE MRITST-PCTZ-PCT             TO MR017-PCTZ.              10260006
086100     MOVE MRITST-MADSTAT-CDE          TO MR017-MADSTAT.           10270006
086200     MOVE MRITST-DFLREG-CDE           TO MR017-DFLREG.            10280006
086300     MOVE MRITST-TSREG-CDE            TO MR017-TSREG.             10290006
086400     MOVE MRITST-DIREG-CDE            TO MR017-DIREG.             10300006
086500     MOVE MRITST-BYPREG-CDE           TO MR017-BYPREG.            10310006
086600     MOVE MRITST-LDD-FCTR             TO MR017-LDD.               10320006
086700     MOVE MRITST-LDDI-FCTR            TO MR017-LDDI.              10330006
086800     MOVE MRITST-LFWMAD-QTY           TO MR017-LMADSS.            10340006
086900     MOVE MRITST-OUTSTAT-CDE          TO MR017-OUTSTAT.           10350006
087000     MOVE MRITST-LRTFCST-NBR          TO MR017-LRTFCST.           10360006
087100     MOVE MRITST-ORDSTAT-CDE          TO MR017-ORDSTAT.           10370006
087200*                                                                 10380006
087300     MOVE MRITST-CSTKMINT1-PCT        TO MR017-CSTKMINT (1).      10390006
087400     MOVE MRITST-CSTKMINT2-PCT        TO MR017-CSTKMINT (2).      10400006
087500     MOVE MRITST-CSTKMINT3-PCT        TO MR017-CSTKMINT (3).      10410006
087600     MOVE MRITST-CSTKMINT4-PCT        TO MR017-CSTKMINT (4).      10420006
087700     MOVE MRITST-CSTKMINT5-PCT        TO MR017-CSTKMINT (5).      10430006
087800     MOVE MRITST-CSTKMINT6-PCT        TO MR017-CSTKMINT (6).      10440006
087900*                                                                 10450006
088000     MOVE MRITST-CSTKMAXT1-PCT        TO MR017-CSTKMAXT (1).      10460006
088100     MOVE MRITST-CSTKMAXT2-PCT        TO MR017-CSTKMAXT (2).      10470006
088200     MOVE MRITST-CSTKMAXT3-PCT        TO MR017-CSTKMAXT (3).      10480006
088300     MOVE MRITST-CSTKMAXT4-PCT        TO MR017-CSTKMAXT (4).      10490006
088400     MOVE MRITST-CSTKMAXT5-PCT        TO MR017-CSTKMAXT (5).      10500006
088500     MOVE MRITST-CSTKMAXT6-PCT        TO MR017-CSTKMAXT (6).      10510006
088600*                                                                 10520006
088700     MOVE MRITST-FTJOPF-CDE           TO MR017-FTJOPF.            10530006
088800*                                                                 10540006
088900     PERFORM F100-FORMAT-HIST-DATA.                               10550006
089000*                                                                 10560006
089100******************************************************************10570006
089200*   MOVE APPROPRIATE FIELDS TO THE DETAIL HIST AREA FOR OUTPUT    10580006
089300******************************************************************10590006
089400 F100-FORMAT-HIST-DATA.                                           10600006
089500*                                                                 10610006
089600*    DISPLAY 'F100-FORMAT-HIST-DATA'.                             10620006
089700*                                                                 10630006
089800     MOVE MRITEM-ITEM-NBR             TO MRISHS-ITM-NBR.          10640006
089900     MOVE MRITST-STR-NBR              TO MRISHS-STR-NBR.          10650006
090000     MOVE PC-1                        TO PV-HIST-SUB.             10660006
090100     MOVE PC-1                        TO PV-MRISHS-SUB.           10670006
090200*                                                                 10680006
090300     PERFORM S600-OPEN-ITEM-HIST-CURSOR.                          10690006
090400     PERFORM S700-FETCH-ITEM-HIST-CURSOR.                         10700006
090500     MOVE 53            TO PV-HOLD-WEEK.                          10710006
090600*                                                                 10720006
090700     PERFORM F200-LOAD-REPL-HIST                                  10730006
090800             UNTIL PV-HIST-SUB GREATER THAN PC-13.                10740006
090900*                                                                 10750006
091000     PERFORM S800-CLOSE-ITEM-HIST-CURSOR.                         10760006
091100*                                                                 10770006
091200******************************************************************10780006
091300*   LOAD HISTORY OCCURANCES                                       10790006
091400******************************************************************10800006
091500 F200-LOAD-REPL-HIST .                                            10810006
091600*                                                                 10820006
091700*    DISPLAY 'F200-LOAD-REPL-HIST'.                               10830006
091800*                                                                 10840006
091900     IF PS-ROW-NOT-FOUND                                          10850006
092000         MOVE ZEROES           TO  MR017-HISTBPN(PV-HIST-SUB)     10860006
092100         MOVE ZEROES           TO  MR017-HISTCPS(PV-HIST-SUB)     10870006
092200         MOVE ZEROES           TO  MR017-HISTMAD(PV-HIST-SUB)     10880006
092300         MOVE ZEROES           TO  MR017-HISTOH(PV-HIST-SUB)      10890006
092400         MOVE ZEROES           TO  MR017-HISTDD(PV-HIST-SUB)      10900006
092500         ADD PC-1              TO  PV-HIST-SUB                    10910006
092600         ADD PC-1              TO  PV-MRISHS-SUB                  10920006
092700     ELSE                                                         10930006
092800         IF MRISHS-WK-NBR = PV-HOLD-WEEK                          10940006
092900             CONTINUE                                             10950006
093000         ELSE                                                     10960006
093100             IF MRISHS-YR-NBR > PT-YEAR(PV-MRISHS-SUB)            10970006
093200                OR (MRISHS-WK-NBR > PT-WEEK(PV-MRISHS-SUB)        10980006
093300                AND  MRISHS-YR-NBR = PT-YEAR(PV-MRISHS-SUB))      10990006
093400                 CONTINUE                                         11000006
093500             ELSE                                                 11010006
093600                 PERFORM F250-SET-CORRECT-WEEK                    11020006
093700                     UNTIL(PT-YEAR(PV-MRISHS-SUB) = MRISHS-YR-NBR 11030006
093800                     AND PT-WEEK(PV-MRISHS-SUB) = MRISHS-WK-NBR)  11040006
093900                     OR PV-HIST-SUB GREATER THAN PC-13            11050006
094000                 IF PV-HIST-SUB GREATER THAN PC-13                11060006
094100                     CONTINUE                                     11070006
094200                 ELSE                                             11080006
094300                     MOVE MRISHS-WK-NBR TO                        11090006
094400                                     MR017-HISTBPN(PV-HIST-SUB)   11100006
094500                     MOVE MRISHS-SLS-HIST-QTY                     11110006
094600                                    TO MR017-HISTCPS(PV-HIST-SUB) 11120006
094700                     MOVE MRISHS-MAD-HIST-QTY                     11130006
094800                                    TO MR017-HISTMAD(PV-HIST-SUB) 11140006
094900                     MOVE MRISHS-OH-HIST-QTY                      11150006
095000                                    TO MR017-HISTOH(PV-HIST-SUB)  11160006
095100                     MOVE MRISHS-DSD-HIST-QTY                     11170006
095200                                    TO MR017-HISTDD(PV-HIST-SUB)  11180006
095300                     MOVE MRISHS-WK-NBR TO PV-HOLD-WEEK           11190006
095400                     ADD PC-1              TO  PV-HIST-SUB        11200006
095500                     ADD PC-1              TO  PV-MRISHS-SUB      11210006
095600                 END-IF                                           11220006
095700             END-IF                                               11230006
095800         END-IF                                                   11240006
095900     END-IF.                                                      11250006
096000*                                                                 11260006
096100     PERFORM S700-FETCH-ITEM-HIST-CURSOR.                         11270006
096200*                                                                 11280006
096300******************************************************************11290006
096400*   MOVE APPROPRIATE FIELDS TO THE DETAIL USER AREA FOR OUTPUT    11300006
096500******************************************************************11310006
096600 F250-SET-CORRECT-WEEK.                                           11320006
096700*                                                                 11330006
096800*    DISPLAY 'F250-SET-CORRECT-WEEK'.                             11340006
096900*                                                                 11350006
097000     MOVE ZEROES           TO  MR017-HISTBPN(PV-HIST-SUB)         11360006
097100     MOVE ZEROES           TO  MR017-HISTCPS(PV-HIST-SUB)         11370006
097200     MOVE ZEROES           TO  MR017-HISTMAD(PV-HIST-SUB)         11380006
097300     MOVE ZEROES           TO  MR017-HISTOH(PV-HIST-SUB)          11390006
097400     MOVE ZEROES           TO  MR017-HISTDD(PV-HIST-SUB)          11400006
097500                                                                  11410006
097600     ADD PC-1                  TO  PV-HIST-SUB.                   11420006
097700     ADD PC-1                  TO  PV-MRISHS-SUB.                 11430006
097800*                                                                 11440006
097900******************************************************************11450006
098000*   MOVE APPROPRIATE FIELDS TO THE DETAIL USER AREA FOR OUTPUT    11460006
098100******************************************************************11470006
098200 G000-FORMAT-ROD-USER-AREA.                                       11480006
098300*                                                                 11490006
098400*    DISPLAY 'G000-FORMAT-ROD-USER-AREA'.                         11500006
098500*                                                                 11510006
098600     MOVE TSK-COST-UNIT-MSRMNT        TO MR017-COST-UNIT-MSMT.    11520006
098700     MOVE TSK-RTL-UNIT-MSRMNT         TO MR017-RTL-UNIT-MSMT.     11530006
098800     MOVE TSK-GP-RTL-AMT              TO MR017-GR-RTL-AMT.        11540006
098900     MOVE TSK-CUR-UNIT-RTL-AMT        TO MR017-CUR-UNIT-RTL-AMT.  11550006
099000     MOVE TSK-GP-QTY                  TO MR017-GR-QTY.            11560006
099100     MOVE TSK-MERCH-DIV-CODE          TO MR017-MERCH-DIV-CODE.    11570006
099200     MOVE TSK-DMM-NMBR                TO MR017-DMM-NBR.           11580006
099300     MOVE SPACES                      TO MR017-ROD-SEQ-NBR.       11590006
099400*                                                                 11600006
099500******************************************************************11610006
099600*   MOVE APPROPRIATE FIELDS TO THE HEADER USER AREA FOR OUTPUT    11620006
099700******************************************************************11630006
099800 H000-FORMAT-ROH-USER-AREA.                                       11640006
099900*                                                                 11650006
100000*    DISPLAY 'H000-FORMAT-ROH-USER-AREA'.                         11660006
100100*                                                                 11670006
100200     MOVE PV-TNOW-WN   TO MR017-H-WN.                             11680006
100300     MOVE PV-TNOW-DN   TO MR017-H-DN.                             11690006
100400*                                                                 11700006
100500*                                                                 11710006
100600******************************************************************11720006
100700*   SETS UP THE WEEKS IN THE WEEK TABLE                           11730006
100800******************************************************************11740006
100900 I100-SET-WEEK-TABLE.                                             11750006
101000*                                                                 11760006
101100*    DISPLAY 'I100-SET-WEEK-TABLE'.                               11770006
101200*                                                                 11780006
101300     ACCEPT CD-CPU-DATE.                                          11790006
101400*                                                                 11800006
101500     MOVE CD-CPU-YEAR            TO PV-YEAR.                      11810006
101600     MOVE CD-CPU-MO              TO PV-MO.                        11820006
101700     MOVE CD-CPU-DY              TO PV-DY.                        11830006
101800                                                                  11840006
101900     MOVE PV-DATE               TO DPG52-LK-DATE-INPUT.           11850006
102000                                                                  11860006
102100     MOVE SPACES                TO DPG51-INCREMENT-DECREMENT-FLAG.11870006
102200     MOVE PV-F2                 TO DPG51-CALENDAR-TYPE.           11880006
102300     SET DPG52-LK-DTE-ISO       TO TRUE.                          11890006
102400                                                                  11900006
102500     PERFORM I200-CALENDAR-ROUTINE.                               11910006
102600     MOVE DPG56-FISCAL-YEAR-CCYY   TO PV-CURR-CCYY.               11920006
102700     MOVE DPG56-FISCAL-WEEK-NBR    TO PV-CURR-WEEK.               11930006
102800                                                                  11940006
102900     MOVE SPACES                   TO DPG52-LK-DATE-INPUT.        11950006
103000     MOVE PV-CURR-WEEK-YEAR        TO DPG52-LK-DATE-INPUT.        11960006
103100     SET DPG52-LK-DTE-FISC-WEEK-CC TO TRUE.                       11970006
103200     MOVE 1                     TO DPG51-INCR-DECR-FISCAL-WEEK-9. 11980006
103300     SET DPG51-DECREMENT-DATE      TO TRUE.                       11990006
103400                                                                  12000006
103500     PERFORM I200-CALENDAR-ROUTINE.                               12010006
103600     MOVE DPG56-FISCAL-YEAR-CCYY   TO PV-CCYY.                    12020006
103700     MOVE DPG56-FISCAL-WEEK-NBR    TO PV-WEEK.                    12030006
103800                                                                  12040006
103900     IF PV-WEEK = 53                                              12050006
104000         MOVE PC-52          TO   PV-WEEK                         12060006
104100     END-IF                                                       12070006
104200                                                                  12080006
104300     PERFORM I300-CALCULATE-WEEK                                  12090006
104400             VARYING PV-MRISHS-SUB FROM 1 BY 1                    12100006
104500             UNTIL PV-MRISHS-SUB GREATER THAN PC-13.              12110006
104600                                                                  12120006
104700******************************************************************12130006
104800*                                                                 12140006
104900******************************************************************12150006
105000 I200-CALENDAR-ROUTINE.                                           12160006
105100*                                                                 12170006
105200     CALL PC-PGM-DPKUT500 USING DPG51 DPG52                       12180006
105300                                DPG53 DPG54                       12190006
105400                                DPG55 DPG56.                      12200006
105500     EVALUATE TRUE                                                12210006
105600     WHEN DPG54-SEVERE-ERROR                                      12220006
105700         DISPLAY 'SEVERE ERROR IN CALENDAR ROUTINE'               12230006
105800         DISPLAY DPG54-ERROR-MESSAGE                              12240006
105900         DISPLAY 'INPUT DATE: '  DPG52-LK-DATE-INPUT              12250006
106000         CALL 'ILBOABN0'        USING PV-ABEND-CODE               12260006
106100     WHEN DPG54-WARNING-ERROR                                     12270006
106200         DISPLAY 'WARNING ERROR IN CALENDAR ROUTINE'              12280006
106300         DISPLAY DPG54-ERROR-MESSAGE                              12290006
106400     WHEN DPG54-NO-ERROR                                          12300006
106500         CONTINUE                                                 12310006
106600     END-EVALUATE.                                                12320006
106700*                                                                 12330006
106800******************************************************************12340006
106900*                                                                 12350006
107000******************************************************************12360006
107100 I300-CALCULATE-WEEK.                                             12370006
107200                                                                  12380006
107300     MOVE PV-WEEK                TO PT-WEEK(PV-MRISHS-SUB).       12390006
107400     MOVE PV-CCYY                TO PT-YEAR(PV-MRISHS-SUB).       12400006
107500                                                                  12410006
107600     IF PV-WEEK  > 1                                              12420006
107700         SUBTRACT 1              FROM PV-WEEK                     12430006
107800     ELSE                                                         12440006
107900         IF PV-WEEK = 1                                           12450006
108000             MOVE PC-52          TO   PV-WEEK                     12460006
108100             SUBTRACT 1          FROM PV-CCYY                     12470006
108200         END-IF                                                   12480006
108300     END-IF.                                                      12490006
108400*                                                                 12500006
108500******************************************************************12510006
108600* THIS SECTION READS THE VSAM SYSTEM RECORD                      *12520006
108700******************************************************************12530006
108800 R000-READ-CONTROL-FILE.                                          12540006
108900*                                                                 12550006
109000*    DISPLAY 'R000-READ-CONTROL-FILE'.                            12560006
109100*                                                                 12570006
109200     READ IC-CONTROL-FILE INTO  SYSTEM-RECORD                     12580006
109300                                KEY IS ICCTL-KEY.                 12590006
109400     IF  PV-VSAM-SUCCESSFUL                                       12600006
109500        CONTINUE                                                  12610006
109600     ELSE                                                         12620006
109700        IF PV-VSAM-NOT-FOUND                                      12630006
109800           DISPLAY 'KEY: ' ICCTL-KEY                              12640006
109900           DISPLAY '** ABEND **'                                  12650006
110000           DISPLAY '** PROGRAM    = MRKUT104'                     12660006
110100           DISPLAY '** PARAGRAPH  = R000-READ-CONTROL-FILE'       12670006
110200           DISPLAY '** MESSAGE    = '                             12680006
110300                   'RECORD NOT FOUND,STATUS: ' PV-VSAM-STATUS     12690006
110400           MOVE +4008           TO PV-ABEND-CODE                  12700006
110500           CALL 'ILBOABN0'      USING PV-ABEND-CODE               12710006
110600        ELSE                                                      12720006
110700           DISPLAY '** ABEND **'                                  12730006
110800           DISPLAY '** PROGRAM    = MRKUT104'                     12740006
110900           DISPLAY '** PARAGRAPH  = R000-READ-CONTROL-FILE'       12750006
111000           DISPLAY '** MESSAGE    = '                             12760006
111100                   'BAD VSAM READ, STATUS = ' PV-VSAM-STATUS      12770006
111200           MOVE +4005           TO PV-ABEND-CODE                  12780006
111300           CALL 'ILBOABN0'      USING PV-ABEND-CODE               12790006
111400        END-IF                                                    12800006
111500     END-IF.                                                      12810006
111600*                                                                 12820006
111700     ADD PC-PLUS-1 TO PV-SYSTEM-INPUT-CNT.                        12830006
111800*                                                                 12840006
111900******************************************************************12850006
112000* THIS SECTION READS THE VSAM SYSTEM RECORD                      *12860006
112100******************************************************************12870006
112200 R100-READ-PARM-FILE.                                             12880006
112300*                                                                 12890006
112400*    DISPLAY 'R100-READ-PARM-FILE'.                               12900006
112500*                                                                 12910006
112600     READ IC-PARM-FILE INTO  PARAMETER-INPUT-RECORD.              12920006
112700*                                                                 12930006
112800*                                                                 12940006
112900 EJECT                                                            12950006
113000******************************************************************12960006
113100* THIS PARAGRAPH OPENS THE ITEM CURSOR FOR A RUN TYPE OF 3 ON THE 12970006
113200* CONTROL FILE (SALES REVISION RUN)                               12980006
113300******************************************************************12990006
113400 S100-OPEN-ITEM-CSR.                                              13000006
113500*                                                                 13010006
113600     MOVE 'S100'                   TO PGM-LOCATION.               13020006
113700     MOVE 'S100-OPEN-ITEM-CSR'     TO PV-ABEND-PARAGRAPH.         13030006
113800*    DISPLAY 'S100-OPEN-ITEM-CSR'.                                13040006
113900*                                                                 13050006
114000     EXEC SQL                                                     13060006
114100         OPEN MR_ITEM_CSR                                         13070006
114200     END-EXEC.                                                    13080006
114300*                                                                 13090006
114400     EVALUATE TRUE                                                13100006
114500       WHEN SQLCODE         = ZERO                                13110006
114600       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    13120006
114700         CONTINUE                                                 13130006
114800       WHEN OTHER                                                 13140006
114900         DISPLAY PV-ABEND-PARAGRAPH                               13150006
115000         PERFORM Z999-SQL-ERROR                                   13160006
115100     END-EVALUATE.                                                13170006
115200*                                                                 13180006
115300 EJECT                                                            13190006
115400*                                                                 13200006
115500******************************************************************13210006
115600*  OBTAIN SEQUENCE NUMBER FOR WEEK 1                             *13220006
115700******************************************************************13230006
115800 S200-SELECT-SEQ-NBR1.                                            13240006
115900*                                                                 13250006
116000     MOVE 'S200'                   TO PGM-LOCATION.               13260006
116100     MOVE 'S200-SELECT-SEQ-NBR1'   TO PV-ABEND-PARAGRAPH.         13270006
116200     MOVE  PC-1P                   TO MRISFL-WEEK-NBR             13280006
116300*                                                                 13290006
116400     EXEC SQL                                                     13300006
116500         SELECT   SEQ_NBR                                         13310006
116600           INTO   :MRISFL-SEQ-NBR                                 13320006
116700           FROM   TMRISFL                                         13330006
116800          WHERE   WEEK_NBR     = :MRISFL-WEEK-NBR                 13340006
116900     END-EXEC.                                                    13350006
117000*                                                                 13360006
117100     EVALUATE TRUE                                                13370006
117200       WHEN SQLCODE         = ZERO                                13380006
117300         MOVE MRISFL-SEQ-NBR TO FL-SEQ-NBR (1)                    13390006
117400       WHEN OTHER                                                 13400006
117500         DISPLAY PV-ABEND-PARAGRAPH                               13410006
117600         PERFORM Z999-SQL-ERROR                                   13420006
117700     END-EVALUATE.                                                13430006
117800*                                                                 13440006
117900******************************************************************13450006
118000*  OBTAIN SEQUENCE NUMBER FOR WEEK 2                             *13460006
118100******************************************************************13470006
118200 S300-SELECT-SEQ-NBR2.                                            13480006
118300*                                                                 13490006
118400     MOVE 'S300'                   TO PGM-LOCATION.               13500006
118500     MOVE 'S300-SELECT-SEQ-NBR1'   TO PV-ABEND-PARAGRAPH.         13510006
118600     MOVE  PC-2P TO  MRISFL-WEEK-NBR                              13520006
118700*                                                                 13530006
118800     EXEC SQL                                                     13540006
118900         SELECT   SEQ_NBR                                         13550006
119000           INTO   :MRISFL-SEQ-NBR                                 13560006
119100           FROM   TMRISFL                                         13570006
119200          WHERE   WEEK_NBR     = :MRISFL-WEEK-NBR                 13580006
119300     END-EXEC.                                                    13590006
119400*                                                                 13600006
119500     EVALUATE TRUE                                                13610006
119600       WHEN SQLCODE         = ZERO                                13620006
119700         MOVE MRISFL-SEQ-NBR TO FL-SEQ-NBR (2)                    13630006
119800       WHEN OTHER                                                 13640006
119900         DISPLAY PV-ABEND-PARAGRAPH                               13650006
120000         PERFORM Z999-SQL-ERROR                                   13660006
120100     END-EVALUATE.                                                13670006
120200*                                                                 13680006
120300******************************************************************13690006
120400*  OBTAIN SEQUENCE NUMBER FOR WEEK 3                             *13700006
120500******************************************************************13710006
120600 S400-SELECT-SEQ-NBR3.                                            13720006
120700*                                                                 13730006
120800     MOVE 'S400'                   TO PGM-LOCATION.               13740006
120900     MOVE 'S400-SELECT-SEQ-NBR1'   TO PV-ABEND-PARAGRAPH.         13750006
121000     MOVE  PC-3P                   TO MRISFL-WEEK-NBR             13760006
121100*                                                                 13770006
121200     EXEC SQL                                                     13780006
121300         SELECT   SEQ_NBR                                         13790006
121400           INTO   :MRISFL-SEQ-NBR                                 13800006
121500           FROM   TMRISFL                                         13810006
121600          WHERE   WEEK_NBR     = :MRISFL-WEEK-NBR                 13820006
121700     END-EXEC.                                                    13830006
121800*                                                                 13840006
121900     EVALUATE TRUE                                                13850006
122000       WHEN SQLCODE         = ZERO                                13860006
122100         MOVE MRISFL-SEQ-NBR TO FL-SEQ-NBR (3)                    13870006
122200       WHEN OTHER                                                 13880006
122300         DISPLAY PV-ABEND-PARAGRAPH                               13890006
122400         PERFORM Z999-SQL-ERROR                                   13900006
122500     END-EVALUATE.                                                13910006
122600*                                                                 13920006
122700******************************************************************13930006
122800*  OBTAIN SEQUENCE NUMBER FOR WEEK 4                             *13940006
122900******************************************************************13950006
123000 S500-SELECT-SEQ-NBR4.                                            13960006
123100*                                                                 13970006
123200     MOVE 'S500'                   TO PGM-LOCATION.               13980006
123300     MOVE 'S500-SELECT-SEQ-NBR1'   TO PV-ABEND-PARAGRAPH.         13990006
123400     MOVE  PC-4P                   TO MRISFL-WEEK-NBR             14000006
123500*                                                                 14010006
123600     EXEC SQL                                                     14020006
123700         SELECT   SEQ_NBR                                         14030006
123800           INTO   :MRISFL-SEQ-NBR                                 14040006
123900           FROM   TMRISFL                                         14050006
124000          WHERE   WEEK_NBR     = :MRISFL-WEEK-NBR                 14060006
124100     END-EXEC.                                                    14070006
124200*                                                                 14080006
124300     EVALUATE TRUE                                                14090006
124400       WHEN SQLCODE         = ZERO                                14100006
124500         MOVE MRISFL-SEQ-NBR TO FL-SEQ-NBR (4)                    14110006
124600       WHEN OTHER                                                 14120006
124700         DISPLAY PV-ABEND-PARAGRAPH                               14130006
124800         PERFORM Z999-SQL-ERROR                                   14140006
124900     END-EVALUATE.                                                14150006
125000*                                                                 14160006
125100******************************************************************14170006
125200*  OPEN ITEM HISTORY CURSOR                                      *14180006
125300******************************************************************14190006
125400 S600-OPEN-ITEM-HIST-CURSOR.                                      14200006
125500*                                                                 14210006
125600*    DISPLAY 'S600-OPEN-ITEM-HIST-CURSOR'.                        14220006
125700*                                                                 14230006
125800     MOVE 'S600'                   TO PGM-LOCATION.               14240006
125900     MOVE 'S600-OPEN-ITEM-HIST-CURSOR'                            14250006
126000                                   TO PGM-LOCATION.               14260006
126100*                                                                 14270006
126200                                                                  14280006
126300     EXEC SQL                                                     14290006
126400       OPEN ITEM_HIST_CSR                                         14300006
126500     END-EXEC.                                                    14310006
126600                                                                  14320006
126700     EVALUATE TRUE                                                14330006
126800         WHEN SQLCODE EQUAL ZERO                                  14340006
126900         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      14350006
127000             CONTINUE                                             14360006
127100         WHEN OTHER                                               14370006
127200              DISPLAY PV-ABEND-PARAGRAPH                          14380006
127300              PERFORM Z999-SQL-ERROR                              14390006
127400     END-EVALUATE.                                                14400006
127500*                                                                 14410006
127600******************************************************************14420006
127700*  FETCH ITEM HISTORY CURSOR                                     *14430006
127800******************************************************************14440006
127900 S700-FETCH-ITEM-HIST-CURSOR.                                     14450006
128000*                                                                 14460006
128100*    DISPLAY 'S700-FETCH-ITEM-HIST-CURSOR'.                       14470006
128200*                                                                 14480006
128300     MOVE 'S700'                   TO PGM-LOCATION.               14490006
128400     MOVE 'S700-FETCH-ITEM-HIST-CURSOR'                           14500006
128500                                   TO PGM-LOCATION.               14510006
128600*                                                                 14520006
128700                                                                  14530006
128800     EXEC SQL                                                     14540006
128900       FETCH ITEM_HIST_CSR                                        14550006
129000        INTO                                                      14560006
129100             :MRISHS-YR-NBR                                       14570006
129200           , :MRISHS-WK-NBR                                       14580006
129300           , :MRISHS-ITM-REV-ID                                   14590006
129400           , :MRISHS-SLS-HIST-QTY                                 14600006
129500           , :MRISHS-OH-HIST-QTY                                  14610006
129600           , :MRISHS-MAD-HIST-QTY                                 14620006
129700           , :MRISHS-DSD-HIST-QTY                                 14630006
129800     END-EXEC.                                                    14640006
129900                                                                  14650006
130000     EVALUATE TRUE                                                14660006
130100         WHEN SQLCODE EQUAL ZERO                                  14670006
130200              SET PS-ROW-FOUND     TO  TRUE                       14680006
130300         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      14690006
130400              SET PS-ROW-NOT-FOUND TO TRUE                        14700006
130500         WHEN SQLWARN0 NOT EQUAL   TO SPACE                       14710006
130600         WHEN SQLCODE  NOT EQUAL   TO ZERO                        14720006
130700              PERFORM Z999-SQL-ERROR                              14730006
130800     END-EVALUATE.                                                14740006
130900*                                                                 14750006
131000*                                                                 14760006
131100******************************************************************14770006
131200*  CLOSE ITEM HISTORY CURSOR                                     *14780006
131300******************************************************************14790006
131400 S800-CLOSE-ITEM-HIST-CURSOR.                                     14800006
131500*                                                                 14810006
131600*    DISPLAY 'S800-CLOSE-ITEM-HIST-CURSOR'.                       14820006
131700*                                                                 14830006
131800     MOVE 'S800'               TO PGM-LOCATION.                   14840006
131900     MOVE 'S800-CLOSE-ITEM-HIST-CURSOR'                           14850006
132000                               TO PV-ABEND-PARAGRAPH.             14860006
132100*                                                                 14870006
132200     EXEC SQL                                                     14880006
132300         CLOSE ITEM_HIST_CSR                                      14890006
132400     END-EXEC.                                                    14900006
132500*                                                                 14910006
132600     EVALUATE TRUE                                                14920006
132700         WHEN SQLCODE EQUAL ZERO                                  14930006
132800         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      14940006
132900             CONTINUE                                             14950006
133000         WHEN OTHER                                               14960006
133100             DISPLAY PV-ABEND-PARAGRAPH                           14970006
133200             PERFORM Z999-SQL-ERROR                               14980006
133300     END-EVALUATE.                                                14990006
133400*                                                                 15000006
133500******************************************************************15010006
133600* THIS PARAGRAPH FETCHES THE ITEM CURSOR FOR RUN TYPE OF 3       *15020006
133700*               (SALES REVISION RUN)                             *15030006
133800******************************************************************15040006
133900 T300-FETCH-ITEM-CURSOR.                                          15050006
134000*                                                                 15060006
134100*    DISPLAY 'T300-FETCH-ITEM-CURSOR'.                            15070006
134200*                                                                 15080006
134300     MOVE 'T300'                   TO PGM-LOCATION.               15090006
134400     MOVE 'T300-FETCH-ITEM-CURSOR'                                15100006
134500                                   TO PV-ABEND-PARAGRAPH.         15110006
134600*                                                                 15120006
134700     EXEC SQL                                                     15130006
134800       FETCH MR_ITEM_CSR                                          15140006
134900        INTO                                                      15150006
135000              :MRITEM-ITEM-NBR,                                   15160006
135100              :MRITEM-UCYCLE-CDE,                                 15170006
135200              :MRITEM-TSL-NBR,                                    15180006
135300              :MRITEM-BYPDDU-CDE,                                 15190006
135400              :MRITEM-BYPSCL-NBR,                                 15200006
135500              :MRITEM-FRCDDU-CDE,                                 15210006
135600              :MRITEM-BYPZSL-CDE,                                 15220006
135700              :MRITEM-BYPTFP-CDE,                                 15230006
135800              :MRITEM-BYPZOH-CDE,                                 15240006
135900              :MRITEM-BYPBEF-CDE,                                 15250006
136000              :MRITEM-BYPAFT-CDE,                                 15260006
136100              :MRITEM-LUMPSW-CDE,                                 15270006
136200              :MRITEM-MINBI-FCTR,                                 15280006
136300              :MRITEM-DDFTSW-CDE,                                 15290006
136400              :MRITEM-RT-NBR,                                     15300006
136500              :MRITEM-RTF-FCTR,                                   15310006
136600              :MRITEM-ZOPSW-CDE,                                  15320006
136700              :MRITEM-OUTLSW-CDE,                                 15330006
136800              :MRITEM-ZSSTOCK-CDE,                                15340006
136900              :MRITEM-PACKSW-CDE,                                 15350006
137000              :MRITEM-DSER-CDE,                                   15360006
137100              :MRITEM-LT-QTY,                                     15370006
137200              :MRITEM-IMIN-QTY,                                   15380006
137300              :MRITEM-IMAX-QTY,                                   15390006
137400              :MRITEM-SSADJ-PCT,                                  15400006
137500              :MRITEM-RT-DAY-NBR,                                 15410006
137600              :MRITEM-DDUPRM-SW,                                  15420006
137700              :MRITEM-ORD-GROUP-SW,                               15430006
137800              :SKXREF-DEPT,                                       15440006
137900              :SKXREF-CLASS,                                      15450006
138000              :SKXREF-SUBCLASS,                                   15460006
138100              :SKXREF-SKU,                                        15470006
138200              :TSK-MERCH-DIV-CODE,                                15480006
138300              :TSK-DMM-NMBR,                                      15490006
138400              :TSK-VENDOR-NMBR,                                   15500006
138500              :TSK-VNDR-IN-HSE-NMBR,                              15510006
138600              :TSK-VENDOR-STYLE-CODE,                             15520006
138700              :TSK-GROUP-CODE,                                    15530006
138800              :TSK-SKU-DESC,                                      15540006
138900              :TSK-SIZE-DESC,                                     15550006
139000              :TSK-COLOR-DESC,                                    15560006
139100              :TSK-COST-UNIT-MSRMNT,                              15570006
139200              :TSK-RTL-UNIT-MSRMNT,                               15580006
139300              :TSK-UNIT-COST-AMT,                                 15590006
139400              :TSK-GP-RTL-AMT,                                    15600006
139500              :TSK-CUR-UNIT-RTL-AMT,                              15610006
139600              :TSK-VNDR-INNR-PACK-QTY,                            15620006
139700              :TSK-GP-QTY,                                        15630006
139800              :MRITST-STR-NBR,                                    15640006
139900              :MRITST-MINDD-QTY,                                  15650006
140000              :MRITST-PTAG-ID,                                    15660006
140100              :MRITST-ON-ORDER-QTY,                               15670006
140200              :MRITST-COMSTK-QTY,                                 15680006
140300              :MRITST-SPOQSW-CDE,                                 15690006
140400              :MRITST-SPOQ-QTY,                                   15700006
140500              :MRITST-FT-CDE,                                     15710006
140600              :MRITST-OSTRAT-QTY,                                 15720006
140700              :MRITST-CSTOCK-QTY,                                 15730006
140800              :MRITST-MINOUTL-QTY,                                15740006
140900              :MRITST-MAXOUTL-QTY,                                15750006
141000              :MRITST-MAXOQP-PCT,                                 15760006
141100              :MRITST-FOQ-QTY,                                    15770006
141200              :MRITST-TMIN-QTY,                                   15780006
141300              :MRITST-USERMIN-QTY,                                15790006
141400              :MRITST-USERMAX-QTY,                                15800006
141500              :MRITST-DD-FCTR,                                    15810006
141600              :MRITST-DDI-FCTR,                                   15820006
141700              :MRITST-LPP-QTY,                                    15830006
141800              :MRITST-MADSS-QTY,                                  15840006
141900              :MRITST-FWMAD-QTY,                                  15850006
142000              :MRITST-TRNDP-PCT,                                  15860006
142100              :MRITST-MSDTS-QTY,                                  15870006
142200              :MRITST-MADTS-QTY,                                  15880006
142300              :MRITST-LTVFACT-FCTR,                               15890006
142400              :MRITST-PCTZ-PCT,                                   15900006
142500              :MRITST-MADSTAT-CDE,                                15910006
142600              :MRITST-DFLREG-CDE,                                 15920006
142700              :MRITST-TSREG-CDE,                                  15930006
142800              :MRITST-DIREG-CDE,                                  15940006
142900              :MRITST-BYPREG-CDE,                                 15950006
143000              :MRITST-LDD-FCTR,                                   15960006
143100              :MRITST-LDDI-FCTR,                                  15970006
143200              :MRITST-LFWMAD-QTY,                                 15980006
143300              :MRITST-OUTSTAT-CDE,                                15990006
143400              :MRITST-LRTFCST-NBR,                                16000006
143500              :MRITST-ORDSTAT-CDE,                                16010006
143600              :MRITST-CSTKMINT1-PCT,                              16020006
143700              :MRITST-CSTKMINT2-PCT,                              16030006
143800              :MRITST-CSTKMINT3-PCT,                              16040006
143900              :MRITST-CSTKMINT4-PCT,                              16050006
144000              :MRITST-CSTKMINT5-PCT,                              16060006
144100              :MRITST-CSTKMINT6-PCT,                              16070006
144200              :MRITST-CSTKMAXT1-PCT,                              16080006
144300              :MRITST-CSTKMAXT2-PCT,                              16090006
144400              :MRITST-CSTKMAXT3-PCT,                              16100006
144500              :MRITST-CSTKMAXT4-PCT,                              16110006
144600              :MRITST-CSTKMAXT5-PCT,                              16120006
144700              :MRITST-CSTKMAXT6-PCT,                              16130006
144800              :MRITST-FTJOPF-CDE,                                 16140006
144900              :MRISFE-SEQ-NBR,                                    16150006
145000              :MRISFE-LFWM-QTY,                                   16160006
145100              :MRISFE-FWM-QTY                                     16170006
145200     END-EXEC.                                                    16180006
145300*                                                                 16190006
145400     EVALUATE TRUE                                                16200006
145500       WHEN SQLCODE         = ZERO                                16210006
145600         CONTINUE                                                 16220006
145700       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    16230006
145800         PERFORM U000-CLOSE-ITEM-CSR                              16240006
145900         MOVE PC-Y TO PS-EOC-ITEM-CSR                             16250006
146000       WHEN OTHER                                                 16260006
146100         DISPLAY PV-ABEND-PARAGRAPH                               16270006
146200         PERFORM Z999-SQL-ERROR                                   16280006
146300     END-EVALUATE.                                                16290006
146400*                                                                 16300006
146500 EJECT                                                            16310006
146600*                                                                 16320006
146700 EJECT                                                            16330006
146800******************************************************************16340006
146900*                                                                *16350006
147000******************************************************************16360006
147100 U000-CLOSE-ITEM-CSR.                                             16370006
147200*                                                                 16380006
147300     MOVE 'U000'                   TO PGM-LOCATION.               16390006
147400     MOVE 'U000-CLOSE-ITEM-CSR'                                   16400006
147500                                   TO PV-ABEND-PARAGRAPH.         16410006
147600*                                                                 16420006
147700     EXEC SQL                                                     16430006
147800         CLOSE MR_ITEM_CSR                                        16440006
147900     END-EXEC.                                                    16450006
148000*                                                                 16460006
148100     EVALUATE TRUE                                                16470006
148200       WHEN SQLCODE         = ZERO                                16480006
148300       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    16490006
148400         CONTINUE                                                 16500006
148500       WHEN OTHER                                                 16510006
148600         DISPLAY PV-ABEND-PARAGRAPH                               16520006
148700         PERFORM Z999-SQL-ERROR                                   16530006
148800     END-EVALUATE.                                                16540006
148900*                                                                 16550006
149000 EJECT                                                            16560006
149100******************************************************************16570006
149200*                                                                *16580006
149300******************************************************************16590006
149400 W000-WRITE-OUTPUT.                                               16600006
149500*                                                                 16610006
149600     MOVE 'W000'                  TO PGM-LOCATION.                16620006
149700     MOVE 'W000-WRITE-SYSTEM-RECORD   '                           16630006
149800                                  TO PV-ABEND-PARAGRAPH.          16640006
149900*                                                                 16650006
150000     WRITE TRANSFER-REC           FROM PV-OUTPUT.                 16660006
150100*                                                                 16670006
150200     IF (PV-VSAM-SUCCESSFUL                                       16680006
150300     OR  PV-VSAM-NOT-FOUND)                                       16690006
150400        CONTINUE                                                  16700006
150500     ELSE                                                         16710006
150600        DISPLAY '** ABEND **'                                     16720006
150700        DISPLAY '** PROGRAM    = MRKUT104'                        16730006
150800        DISPLAY '** PARAGRAPH  = W000-WRITE-SYSTEM-RECORD'        16740006
150900        DISPLAY '** MESSAGE    = '                                16750006
151000                'BAD VSAM WRITE,STATUS = ' PV-VSAM-STATUS         16760006
151100        MOVE +4005              TO PV-ABEND-CODE                  16770006
151200        CALL 'ILBOABN0'         USING PV-ABEND-CODE               16780006
151300     END-IF.                                                      16790006
151400*                                                                 16800006
151500     ADD PC-PLUS-1 TO PV-SYSTEM-OUTPUT-CNT.                       16810006
151600*                                                                 16820006
151700 EJECT                                                            16830006
151800******************************************************************16840006
151900*   CLOSES FILES AND DISPLAYS MESSAGES.                          *16850006
152000******************************************************************16860006
152100 Y100-END-ROUTINE.                                                16870006
152200*                                                                 16880006
152300     CLOSE  IC-CONTROL-FILE                                       16890006
152400            IC-PARM-FILE                                          16900006
152500            TRANSFER-RECORD.                                      16910006
152600*                                                                 16920006
152700 EJECT                                                            16930006
152800******************************************************************16940006
152900*     SQL WARNING OR ERROR PROCESSING                            *16950006
153000*                                                                *16960006
153100******************************************************************16970006
153200                                                                  16980006
153300 Z998-SQL-WARNING.                                                16990006
153400*-----------------                                                17000006
153500                                                                  17010006
153600     MOVE SQLCODE    TO SQLCODE2.                                 17020006
153700     MOVE SQLERRD(3) TO SQLERRD3.                                 17030006
153800     DISPLAY '** ABEND **       ** = SQLWARNING'.                 17040006
153900     DISPLAY '** PROGRAM        ** = MRKUT104'.                   17050006
154000     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  17060006
154100     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  17070006
154200     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                  17080006
154300     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                  17090006
154400     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                  17100006
154500     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                  17110006
154600     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                  17120006
154700     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                  17130006
154800     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                  17140006
154900     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                  17150006
155000     EXEC SQL                                                     17160006
155100         COMMIT                                                   17170006
155200     END-EXEC.                                                    17180006
155300     MOVE +4013 TO PV-ABEND-CODE.                                 17190006
155400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         17200006
155500*                                                                 17210006
155600 Z999-SQL-ERROR.                                                  17220006
155700*---------------                                                  17230006
155800                                                                  17240006
155900     MOVE SQLCODE    TO SQLCODE2.                                 17250006
156000     MOVE SQLERRD(3) TO SQLERRD3.                                 17260006
156100     DISPLAY '** ABEND **       ** = SQLERROR'.                   17270006
156200     DISPLAY '** PROGRAM        ** = MRKUT104'.                   17280006
156300     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  17290006
156400     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  17300006
156500     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   17310006
156600     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  17320006
156700     MOVE +4013 TO PV-ABEND-CODE.                                 17330006
156800     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         17340006
156900*                                                                 17350006
157000******************************************************************17360006
157100******************END OF PROGRAM   *******************************17370006
157200******************************************************************17380006
