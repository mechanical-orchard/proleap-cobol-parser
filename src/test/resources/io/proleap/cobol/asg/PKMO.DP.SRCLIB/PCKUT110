000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             PCKUT110.                                00050000
000600 AUTHOR.                 DENISE HAHN.                             00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            JUNE, 2014.                              00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100*----------------------------------------------------------------*00110000
001200* THIS PROGRAM WILL TAKE IN A PO DETAIL FILE FROM ENROUTE AND    *00120000
001300* ARRIVED TRAILERS. THE FILE WILL BE SORTED IN TRIP/PO/RCVR/LINE *00130000
001400* ORDER.  THE PROGRAM WILL THEN DETERMINE:                       *00140000
001500* PROGRAM WILL THEN DETERMINE:                                   *00150000
001600*           HAZMAT CARTONS & UNIT QUANTITY                       *00160000
001700*           CONTROLLED FLOW CARTONS AND UNIT QUANTITY            *00170000
001800*                                                                *00180000
001900* THE INPUT AND OUTPUT FILE LAYOUTS ARE PCRD068.                 *00190000
002000* WR-42429                                                       *00200000
002100*----------------------------------------------------------------*00210000
002200***************************************************************** 00220000
002300                                                                  00230000
002400***************************************************************** 00240000
002500 ENVIRONMENT DIVISION.                                            00250000
002600***************************************************************** 00260000
002700 INPUT-OUTPUT SECTION.                                            00270000
002800                                                                  00280000
002900 FILE-CONTROL.                                                    00290000
003000                                                                  00300000
003100     SELECT INPUT-FILE ASSIGN TO INP01.                           00310000
003200                                                                  00320000
003300     SELECT OUTPUT-FILE ASSIGN TO OUT01.                          00330000
003400                                                                  00340000
003500                                                                  00350000
003600***************************************************************** 00360000
003700 DATA DIVISION.                                                   00370000
003800***************************************************************** 00380000
003900 FILE SECTION.                                                    00390000
004000*                                                                 00400000
004100*                                                                 00410000
004200 FD  INPUT-FILE                                                   00420000
004300     RECORDING MODE IS F                                          00430000
004400     LABEL RECORDS ARE STANDARD                                   00440000
004500     BLOCK CONTAINS 0 RECORDS.                                    00450000
004600 01  INPUT-RECORD                PIC X(400).                      00460000
004700                                                                  00470000
004800 FD  OUTPUT-FILE                                                  00480000
004900     RECORDING MODE IS F                                          00490000
005000     LABEL RECORDS ARE STANDARD                                   00500000
005100     BLOCK CONTAINS 0 RECORDS.                                    00510000
005200 01  OUTPUT-RECORD               PIC X(400).                      00520000
005300                                                                  00530000
005400*                                                                 00540000
005500*                                                                 00550000
005600***************************************************************** 00560000
005700 WORKING-STORAGE SECTION.                                         00570000
005800                                                                  00580000
005900 01  PS-PROGRAM-SWITCHES.                                         00590000
006000     05  PS-END-OF-INPUT-FILE-SW      PIC X(01)  VALUE 'N'.       00600000
006100         88  PS-END-OF-INPUT-FILE                VALUE 'Y'.       00610000
006200         88  PS-NOT-END-OF-INPUT-FILE            VALUE 'N'.       00620000
006210     05  PS-HAZARDOUS-SW              PIC X(01)  VALUE 'N'.       00621002
006220         88  PS-HAZARDOUS-YES                    VALUE 'Y'.       00622002
006230         88  PS-HAZARDOUS-NO                     VALUE 'N'.       00623002
006240     05  PS-CNTL-FLOW-SW              PIC X(01)  VALUE 'N'.       00624002
006250         88  PS-CNTL-FLOW-YES                    VALUE 'Y'.       00625002
006260         88  PS-CNTL-FLOW-NO                     VALUE 'N'.       00626002
006300                                                                  00630000
006400                                                                  00640000
006500*                                                                 00650000
006600 01  ABEND-CODE                       PIC S9(04) VALUE ZERO       00660000
006700                                                 COMP SYNC.       00670000
006800     88  ABEND-4013-DB2-ERROR                    VALUE +4013.     00680000
006900                                                                  00690000
007000 01  PV-PROGRAM-VARIABLES.                                        00700000
007100     05  PV-HAZ-SKU-NBR               PIC  9(08) VALUE ZERO.      00710002
007110                                                                  00711002
007200     05  PV-READ-COUNT                PIC S9(09) VALUE ZERO       00720002
007300                                                  COMP SYNC.      00730002
007301     05  PV-HAZ-COUNT                 PIC S9(09) VALUE ZERO       00730102
007302                                                  COMP SYNC.      00730202
007310     05  PV-CNTL-FLOW-COUNT           PIC S9(09) VALUE ZERO       00731002
007320                                                  COMP SYNC.      00732002
007400     05  PV-WRITE-OUTPUT-COUNT        PIC S9(09) VALUE ZERO       00740002
007500                                                  COMP SYNC.      00750002
008200     05  PV-DISPLAY-COUNT             PIC ZZZ,ZZZ,ZZ9.            00820002
008400                                                                  00840000
008500     05  PV-DISPLAY-TRIP-ID           PIC Z(8)9.                  00850000
008600     05  PV-DISPLAY-PO-NBR            PIC Z(8)9.                  00860000
008700     05  PV-DISPLAY-PO-LNE-NBR        PIC Z(8)9.                  00870000
008800     05  PV-DISPLAY-RCVR-SEQ-NBR      PIC 9999.                   00880000
008900     05  PV-DISPLAY-PACK-ID           PIC Z(8)9.                  00890000
009000     05  PV-DISPLAY-OPER-UNT-ID       PIC 9999.                   00900000
009100                                                                  00910000
009200     05  PV-PREV-PO-NBR              PIC S9(09)    VALUE ZERO.    00920000
009300     05  PV-PREV-REC-SEQ-NBR         PIC S9(04)    VALUE ZERO.    00930000
009400                                                                  00940000
009800     05  PV-DB2-CURRENT-TIMESTAMP     PIC X(26)  VALUE SPACES.    00980000
009900     05  PV-DB2-FUNCTION              PIC X(30)  VALUE SPACES.    00990000
010000     05  PV-DB2-TABLE-NAME1           PIC X(15)  VALUE SPACES.    01000000
010100     05  PV-DB2-TABLE-NAME2           PIC X(15)  VALUE SPACES.    01010000
010200     05  PV-DB2-TABLE-NAME3           PIC X(15)  VALUE SPACES.    01020000
010300                                                                  01030000
010400                                                                  01040000
010500 01  PV-SAVE-FIELDS.                                              01050000
010600     05  PV-SAVE-TRIP-ID             PIC  S9(9) COMP.             01060000
010700     05  PV-SAVE-PO-NBR              PIC  S9(9) COMP.             01070000
010800     05  PV-SAVE-REC-SEQ-NBR         PIC  S9(9) COMP.             01080000
010900                                                                  01090000
012400                                                                  01240000
012500 01 PC-PROGRAM-CONSTANTS.                                         01250000
012600     05 PC-PROGRAM-NAME              PIC X(08)  VALUE 'PCKUT110'. 01260000
012700                                                                  01270000
012800 01  PV-ABEND-FIELDS.                                             01280000
012900     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         01290000
013000                                                 COMP SYNC.       01300000
013100     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'PCKUT100'.01310000
013200     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01320000
013300     05  PV-ABEND-OPERATION           PIC  X(51) VALUE SPACES.    01330000
013400     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACES.    01340000
013500     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30) VALUE SPACES.    01350000
013600     05  PV-DISPLAY-SQLCODE           PIC  999-  VALUE ZEROES.    01360004
013700     05  PV-SQL-RETURN-CD             PIC  999-.                  01370000
013800     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01380000
013900     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01390000
014000     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01400000
014100     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01410000
014200                                                                  01420000
014300                                                                  01430000
014400******************************************************************01440000
014500*  USED FOR DB2 ERROR MESSAGE BUILDING                            01450000
014600******************************************************************01460000
014700     COPY DPWS004.                                                01470000
014800                                                                  01480000
014900*----------------------------------------------------------------*01490000
015000*    ABEND PROCESSING COPYBOOK.                                  *01500000
015100*----------------------------------------------------------------*01510000
015200                                                                  01520000
015300     COPY DPWS013.                                                01530000
015400                                                                  01540000
015500******************************************************************01550000
015600*  WST_INTGRTN_TYP                                                01560006
015700******************************************************************01570000
015800     EXEC SQL                                                     01580000
015900          INCLUDE WST00008                                        01590006
016000     END-EXEC.                                                    01600000
016100                                                                  01610000
016101******************************************************************01610106
016102*  WST_ATTR_DEFN                                                  01610206
016103******************************************************************01610306
016104     EXEC SQL                                                     01610406
016105          INCLUDE WST00009                                        01610506
016106     END-EXEC.                                                    01610606
016107                                                                  01610706
016110******************************************************************01611006
016120*  WST_ATTR_ELEM                                                  01612006
016130******************************************************************01613006
016140     EXEC SQL                                                     01614006
016150          INCLUDE WST00010                                        01615006
016160     END-EXEC.                                                    01616006
016170                                                                  01617006
016200******************************************************************01620000
016300*  XLT_HAZDS_MTRL_SKU                                             01630000
016400******************************************************************01640000
016500     EXEC SQL                                                     01650000
016600          INCLUDE XLT00042                                        01660000
016700     END-EXEC.                                                    01670000
016800                                                                  01680000
016810******************************************************************01681002
016820*  TTRBNTF - TROUBLE NOTITY                                       01682002
016830******************************************************************01683002
016840     EXEC SQL                                                     01684002
016850          INCLUDE TTRBNTF                                         01685002
016860     END-EXEC.                                                    01686002
016870                                                                  01687002
016880******************************************************************01688009
016890*  TRECITM - RECEIVER ITEM                                        01689009
016891******************************************************************01689109
016892     EXEC SQL                                                     01689209
016893          INCLUDE TRECITM                                         01689309
016894     END-EXEC.                                                    01689409
016895                                                                  01689509
016896******************************************************************01689609
016897*  XLT_SKU                                                        01689709
016898******************************************************************01689809
016899     EXEC SQL                                                     01689909
016900          INCLUDE XLT00003                                        01690009
016901     END-EXEC.                                                    01690109
016902                                                                  01690209
016910******************************************************************01691000
017000*   DB2 SQL COMMUNICATION AREA                                    01700000
017100******************************************************************01710000
017200     EXEC SQL                                                     01720000
017300          INCLUDE SQLCA                                           01730000
017400     END-EXEC.                                                    01740000
017500*                                                                 01750000
017600*DB2 AREA FOR COMMUNICATIONS AREA2                                01760000
017700     COPY SQLCA2.                                                 01770000
017800                                                                  01780000
018300***********************************************************       01830000
018400*  RECORD LAYOUT FOR AN EXTRACT FILE CONTAINING THE               01840000
018500*  PO/RCVR/LINE INFORMATION FOR A TRAILER                         01850000
018600***********************************************************       01860000
018700*OUTPUT FILE LAYOUT                                               01870000
018800     COPY PCRD068.                                                01880000
018900                                                                  01890000
019000 EJECT                                                            01900000
019100                                                                  01910000
019200***********************************************************       01920000
019300 PROCEDURE DIVISION.                                              01930000
019400***********************************************************       01940000
019500     DISPLAY '***BEGINNING PCKUT110***'.                          01950000
019600                                                                  01960000
019700     PERFORM 1000-INITIALIZE.                                     01970000
019800                                                                  01980000
019900     PERFORM 2000-PROCESS-RECORDS                                 01990002
020000         UNTIL PS-END-OF-INPUT-FILE.                              02000000
020100                                                                  02010000
021700     PERFORM 8000-WRITE-TO-DTL-FILE.                              02170000
021900                                                                  02190000
022100     PERFORM 9000-CLOSE-FILES.                                    02210000
022200                                                                  02220000
022300     GOBACK.                                                      02230000
022400                                                                  02240000
022500                                                                  02250000
022600******************************************************************02260000
022700*                                                                *02270002
022710******************************************************************02271002
022800 1000-INITIALIZE.                                                 02280000
022900                                                                  02290002
023000     OPEN INPUT  INPUT-FILE                                       02300000
023100          OUTPUT OUTPUT-FILE.                                     02310000
023200                                                                  02320000
023300     INITIALIZE PC068-RECORD-LAYOUT.                              02330000
024000                                                                  02400002
024100     PERFORM 7000-READ-INPUT-FILE.                                02410000
024300                                                                  02430000
024400     IF PS-END-OF-INPUT-FILE                                      02440000
024500         DISPLAY '** FILE IS EMPTY **'                            02450000
025500     END-IF.                                                      02550000
025600                                                                  02560000
025700                                                                  02570000
025800***************************************************************** 02580000
025810*                                                                 02581002
025820***************************************************************** 02582002
025900 2000-PROCESS-RECORDS.                                            02590002
026000                                                                  02600002
026100     PERFORM 3000-CHECK-IF-ITEM-HAZDS.                            02610002
026200                                                                  02620002
026201     IF  PC068-PO-NBR       =  PV-PREV-PO-NBR      AND            02620102
026202         PC068-REC-SEQ-NBR  =  PV-PREV-REC-SEQ-NBR                02620202
026203         CONTINUE                                                 02620302
026204     ELSE                                                         02620402
026205         SET PS-CNTL-FLOW-NO  TO  TRUE                            02620502
026210         PERFORM 4000-CHECK-CNTL-FLOW                             02621002
026211     END-IF.                                                      02621102
026212                                                                  02621202
026220     IF  PS-CNTL-FLOW-YES                                         02622002
026221         ADD   1                    TO  PV-CNTL-FLOW-COUNT        02622102
026223         MOVE  PC068-TOT-CTN-CNT    TO  PC068-CNTL-FLOW-CTN-CNT   02622307
026260         MOVE  PC068-UNIT-CNT       TO  PC068-CNTL-FLOW-UNT-CNT   02626002
026270         SET   PC068-CNTL-FLOW-YES  TO  TRUE                      02627002
026280     ELSE                                                         02628002
026281         MOVE  ZEROES               TO  PC068-CNTL-FLOW-CTN-CNT   02628102
026282                                        PC068-CNTL-FLOW-UNT-CNT   02628202
026283         SET   PC068-CNTL-FLOW-YES  TO  TRUE                      02628302
026290     END-IF.                                                      02629002
026300                                                                  02630002
026400     MOVE PC068-PO-NBR              TO  PV-PREV-PO-NBR.           02640002
026500     MOVE PC068-REC-SEQ-NBR         TO  PV-PREV-REC-SEQ-NBR.      02650002
026600                                                                  02660002
029900     PERFORM 8000-WRITE-TO-DTL-FILE.                              02990002
030000                                                                  03000000
030800     PERFORM 7000-READ-INPUT-FILE.                                03080000
030900                                                                  03090000
040800                                                                  04080002
040900***************************************************************** 04090002
041000*                                                               * 04100002
041100***************************************************************** 04110002
041200 3000-CHECK-IF-ITEM-HAZDS.                                        04120008
041201                                                                  04120108
041202     IF  PC068-PBS-ORDER                                          04120208
041203         PERFORM 3020-CHECK-HAZDS-PBS                             04120308
041204     ELSE                                                         04120408
041205         IF  PC068-MULTI-PREPK  OR                                04120510
041206             PC068-INNER-PREPK                                    04120610
041207             PERFORM 3030-CHECK-HAZDS-PREPACK                     04120710
041208         ELSE                                                     04120810
041209             PERFORM 3010-CHECK-HAZDS-NON-PBS                     04120910
041210         END-IF                                                   04121010
041211     END-IF.                                                      04121110
041212                                                                  04121210
041213                                                                  04121310
041214***************************************************************** 04121410
041215*                                                               * 04121510
041216***************************************************************** 04121610
041217 3010-CHECK-HAZDS-NON-PBS.                                        04121710
041220                                                                  04122008
041300     MOVE PC068-SKU-NUMBER  TO  PV-HAZ-SKU-NBR.                   04130002
041400     MOVE PV-HAZ-SKU-NBR    TO  XLT00042-SKU-NBR.                 04140008
041500                                                                  04150002
041600     EXEC SQL                                                     04160002
041700          SELECT  F.HAZDS_IND                                     04170006
042000            INTO :PS-HAZARDOUS-SW                                 04200002
042100            FROM                                                  04210002
042200                  WST_INTGRTN_TYP    A                            04220002
042300               ,  WST_ATTR_DEFN      B                            04230002
042400               ,  WST_ATTR_ELEM      C                            04240002
042500               ,  WST_ATTR_ELEM      D                            04250002
042600               ,  WST_ATTR_ELEM      E                            04260002
042700               ,  XLT_HAZDS_MTRL_SKU F                            04270002
042800           WHERE                                                  04280002
042900                  A.INTGRTN_TYP_CDE     = 'HZLBLAPP'              04290002
043000             AND  A.INTGRTN_TYP_CDE     = B.INTGRTN_TYP_CDE       04300002
043100             AND  B.ATTR_DEFN_SEQ_NBR   = 1                       04310002
043200             AND  B.INTGRTN_TYP_CDE     = C.INTGRTN_TYP_CDE       04320002
043300             AND  C.ATTR_DEFN_SEQ_NBR   = 1                       04330002
043400             AND  B.INTGRTN_TYP_CDE     = D.INTGRTN_TYP_CDE       04340002
043500             AND  D.ATTR_DEFN_SEQ_NBR   = 2                       04350002
043600             AND  B.INTGRTN_TYP_CDE     = E.INTGRTN_TYP_CDE       04360002
043700             AND  E.ATTR_DEFN_SEQ_NBR   = 3                       04370002
043800             AND  C.ATTR_ELEM_SEQ_NBR   = D.ATTR_ELEM_SEQ_NBR     04380002
043900             AND  C.ATTR_ELEM_SEQ_NBR   = E.ATTR_ELEM_SEQ_NBR     04390002
044000             AND  C.ATTR_ELEM_TXT       = F.SYS_TRLG_CDE          04400002
044100             AND (D.ATTR_ELEM_TXT       = 'PACKTOLIGHT'  OR       04410002
044200                  D.ATTR_ELEM_TXT       = 'MASTERCHILD')          04420002
044300             AND  F.HAZDS_IND           = 'Y'                     04430009
044400             AND  F.SKU_NBR             = :XLT00042-SKU-NBR       04440009
044520           FETCH FIRST 1 ROW ONLY                                 04452002
044530            WITH UR                                               04453002
044600     END-EXEC.                                                    04460002
044700                                                                  04470002
044800     EVALUATE TRUE                                                04480002
044900         WHEN SQLCODE = +0                                        04490002
044901         WHEN SQLCODE = -811                                      04490102
044910              MOVE  PS-HAZARDOUS-SW                               04491002
044920                TO  PC068-HAZ-SW                                  04492002
044930                                                                  04493002
045000              IF  PS-HAZARDOUS-YES                                04500002
045100                  ADD  1   TO  PV-HAZ-COUNT                       04510002
045101                                                                  04510102
045110                  MOVE  PC068-TOT-CTN-CNT                         04511007
045111                    TO  PC068-HAZ-CTN-CNT                         04511107
045220                                                                  04522002
045310                  MOVE  PC068-UNIT-CNT                            04531002
045400                    TO  PC068-HAZ-UNT-CNT                         04540002
045500              ELSE                                                04550002
045600                  SET   PC068-HAZDS-NO  TO  TRUE                  04560002
045700                  MOVE  ZEROES          TO  PC068-HAZ-CTN-CNT     04570002
045820                                            PC068-HAZ-UNT-CNT     04582002
045830              END-IF                                              04583002
045840                                                                  04584002
045900         WHEN SQLCODE = +100                                      04590002
045910              SET  PC068-HAZDS-NO       TO  TRUE                  04591002
045911              MOVE  ZEROES              TO  PC068-HAZ-CTN-CNT     04591102
045920                                            PC068-HAZ-UNT-CNT     04592002
045930         WHEN SQLWARN0 NOT = SPACES                               04593002
045940         WHEN SQLCODE NOT = ZERO                                  04594002
045950              SET  PC068-HAZDS-NO      TO TRUE                    04595002
045960              MOVE ZEROES              TO PC068-HAZ-CTN-CNT       04596002
045970                                          PC068-HAZ-UNT-CNT       04597002
045971              MOVE PC068-TRIP-ID       TO PV-DISPLAY-TRIP-ID      04597102
045972              MOVE PC068-OPER-UNT-ID   TO PV-DISPLAY-OPER-UNT-ID  04597202
045973              MOVE PC068-PO-NBR        TO PV-DISPLAY-PO-NBR       04597303
045974              MOVE PC068-REC-SEQ-NBR   TO PV-DISPLAY-PO-LNE-NBR   04597403
045975              MOVE PC068-PO-LNE-NBR    TO PV-DISPLAY-RCVR-SEQ-NBR 04597503
045976              MOVE PC068-PACK-ID       TO PV-DISPLAY-PACK-ID      04597603
045980                                                                  04598002
045990              MOVE 'CHECK IF HAZARDOUS-NON PBS     '              04599009
046000                                    TO PV-DB2-OPERATION-MESSAGE-1 04600002
046100              MOVE 'XLT_HAZDS'      TO PV-DB2-TABLE-NAME1         04610002
046110              MOVE '3010-CHECK-HAZDS-NON-PBS    '                 04611009
046120                                          TO PV-PARAGRAPH-NAME    04612002
046200              PERFORM Z999A-SQL-ABEND                             04620002
049700     END-EVALUATE.                                                04970002
049800                                                                  04980002
049900                                                                  04990002
049910***************************************************************** 04991008
049920*                                                               * 04992008
049930***************************************************************** 04993008
049940 3020-CHECK-HAZDS-PBS.                                            04994008
049941                                                                  04994109
049942     MOVE  PC068-PO-NBR       TO  RECITM-ORD-NBR.                 04994209
049943     MOVE  PC068-REC-SEQ-NBR  TO  RECITM-REC-SEQ-NBR.             04994309
049944                                                                  04994409
049945     EXEC SQL                                                     04994509
049946          SELECT  F.HAZDS_IND                                     04994609
049947            INTO :PS-HAZARDOUS-SW                                 04994709
049948            FROM                                                  04994809
049949                  WST_INTGRTN_TYP    A                            04994909
049950               ,  WST_ATTR_DEFN      B                            04995009
049951               ,  WST_ATTR_ELEM      C                            04995109
049952               ,  WST_ATTR_ELEM      D                            04995209
049953               ,  WST_ATTR_ELEM      E                            04995309
049954               ,  XLT_HAZDS_MTRL_SKU F                            04995409
049955           WHERE                                                  04995509
049956                  A.INTGRTN_TYP_CDE     = 'HZLBLAPP'              04995609
049957             AND  A.INTGRTN_TYP_CDE     = B.INTGRTN_TYP_CDE       04995709
049958             AND  B.ATTR_DEFN_SEQ_NBR   = 1                       04995809
049959             AND  B.INTGRTN_TYP_CDE     = C.INTGRTN_TYP_CDE       04995909
049960             AND  C.ATTR_DEFN_SEQ_NBR   = 1                       04996009
049961             AND  B.INTGRTN_TYP_CDE     = D.INTGRTN_TYP_CDE       04996109
049962             AND  D.ATTR_DEFN_SEQ_NBR   = 2                       04996209
049963             AND  B.INTGRTN_TYP_CDE     = E.INTGRTN_TYP_CDE       04996309
049964             AND  E.ATTR_DEFN_SEQ_NBR   = 3                       04996409
049965             AND  C.ATTR_ELEM_SEQ_NBR   = D.ATTR_ELEM_SEQ_NBR     04996509
049966             AND  C.ATTR_ELEM_SEQ_NBR   = E.ATTR_ELEM_SEQ_NBR     04996609
049967             AND  C.ATTR_ELEM_TXT       = F.SYS_TRLG_CDE          04996709
049968             AND (D.ATTR_ELEM_TXT       = 'PACKTOLIGHT'  OR       04996809
049969                  D.ATTR_ELEM_TXT       = 'MASTERCHILD')          04996909
049970             AND  F.HAZDS_IND           = 'Y'                     04997009
049971             AND  F.SKU_NBR IN                                    04997109
049972                 (SELECT DISTINCT(H.SKU_NBR)                      04997209
049974                    FROM TRECITM G                                04997409
049975                       , XLT_SKU H                                04997509
049976                   WHERE G.ORD_NBR        = :RECITM-ORD-NBR       04997609
049977                     AND G.REC_SEQ_NBR    = :RECITM-REC-SEQ-NBR   04997709
049978                     AND G.VER_STATUS_CDE = 'A'                   04997809
049979                     AND G.ITM_NBR        =  H.ITM_NBR)           04997909
049980           FETCH FIRST 1 ROW ONLY                                 04998009
049981            WITH UR                                               04998109
049982     END-EXEC.                                                    04998209
049983                                                                  04998309
049984     EVALUATE TRUE                                                04998409
049985         WHEN SQLCODE = +0                                        04998509
049986         WHEN SQLCODE = -811                                      04998609
049987              MOVE  PS-HAZARDOUS-SW                               04998709
049988                TO  PC068-HAZ-SW                                  04998809
049989                                                                  04998909
049990              IF  PS-HAZARDOUS-YES                                04999009
049991                  ADD  1   TO  PV-HAZ-COUNT                       04999109
049992                                                                  04999209
049993                  MOVE  PC068-TOT-CTN-CNT                         04999309
049994                    TO  PC068-HAZ-CTN-CNT                         04999409
049995                                                                  04999509
049996                  MOVE  PC068-UNIT-CNT                            04999609
049997                    TO  PC068-HAZ-UNT-CNT                         04999709
049998              ELSE                                                04999809
049999                  SET   PC068-HAZDS-NO  TO  TRUE                  04999909
050000                  MOVE  ZEROES          TO  PC068-HAZ-CTN-CNT     05000009
050001                                            PC068-HAZ-UNT-CNT     05000109
050002              END-IF                                              05000209
050003                                                                  05000309
050004         WHEN SQLCODE = +100                                      05000409
050005              SET  PC068-HAZDS-NO       TO  TRUE                  05000509
050006              MOVE  ZEROES              TO  PC068-HAZ-CTN-CNT     05000609
050007                                            PC068-HAZ-UNT-CNT     05000709
050008         WHEN SQLWARN0 NOT = SPACES                               05000809
050009         WHEN SQLCODE NOT = ZERO                                  05000909
050010              SET  PC068-HAZDS-NO      TO TRUE                    05001009
050011              MOVE ZEROES              TO PC068-HAZ-CTN-CNT       05001109
050012                                          PC068-HAZ-UNT-CNT       05001209
050013              MOVE PC068-TRIP-ID       TO PV-DISPLAY-TRIP-ID      05001309
050014              MOVE PC068-OPER-UNT-ID   TO PV-DISPLAY-OPER-UNT-ID  05001409
050015              MOVE PC068-PO-NBR        TO PV-DISPLAY-PO-NBR       05001509
050016              MOVE PC068-REC-SEQ-NBR   TO PV-DISPLAY-PO-LNE-NBR   05001609
050017              MOVE PC068-PO-LNE-NBR    TO PV-DISPLAY-RCVR-SEQ-NBR 05001709
050018              MOVE PC068-PACK-ID       TO PV-DISPLAY-PACK-ID      05001809
050019                                                                  05001909
050020              MOVE 'CHECK IF HAZARDOUS - PBS       '              05002009
050021                                    TO PV-DB2-OPERATION-MESSAGE-1 05002109
050022              MOVE 'XLT_HAZDS'      TO PV-DB2-TABLE-NAME1         05002209
050023              MOVE '3020-CHECK-HAZDS-PBS        '                 05002309
050024                                          TO PV-PARAGRAPH-NAME    05002409
050025              PERFORM Z999A-SQL-ABEND                             05002509
050026     END-EVALUATE.                                                05002609
050027                                                                  05002709
050028                                                                  05002809
050029***************************************************************** 05002910
050030*                                                               * 05003010
050040***************************************************************** 05004010
050050 3030-CHECK-HAZDS-PREPACK.                                        05005010
050051                                                                  05005110
050052     MOVE  PC068-PO-NBR       TO  RECITM-ORD-NBR.                 05005210
050053     MOVE  PC068-REC-SEQ-NBR  TO  RECITM-REC-SEQ-NBR.             05005310
050054     MOVE  PC068-PACK-ID      TO  RECITM-PREPK-ID.                05005410
050055                                                                  05005510
050056     EXEC SQL                                                     05005610
050057          SELECT  F.HAZDS_IND                                     05005710
050058            INTO :PS-HAZARDOUS-SW                                 05005810
050059            FROM                                                  05005910
050060                  WST_INTGRTN_TYP    A                            05006010
050061               ,  WST_ATTR_DEFN      B                            05006110
050062               ,  WST_ATTR_ELEM      C                            05006210
050063               ,  WST_ATTR_ELEM      D                            05006310
050064               ,  WST_ATTR_ELEM      E                            05006410
050065               ,  XLT_HAZDS_MTRL_SKU F                            05006510
050066           WHERE                                                  05006610
050067                  A.INTGRTN_TYP_CDE     = 'HZLBLAPP'              05006710
050068             AND  A.INTGRTN_TYP_CDE     = B.INTGRTN_TYP_CDE       05006810
050069             AND  B.ATTR_DEFN_SEQ_NBR   = 1                       05006910
050070             AND  B.INTGRTN_TYP_CDE     = C.INTGRTN_TYP_CDE       05007010
050071             AND  C.ATTR_DEFN_SEQ_NBR   = 1                       05007110
050072             AND  B.INTGRTN_TYP_CDE     = D.INTGRTN_TYP_CDE       05007210
050073             AND  D.ATTR_DEFN_SEQ_NBR   = 2                       05007310
050074             AND  B.INTGRTN_TYP_CDE     = E.INTGRTN_TYP_CDE       05007410
050075             AND  E.ATTR_DEFN_SEQ_NBR   = 3                       05007510
050076             AND  C.ATTR_ELEM_SEQ_NBR   = D.ATTR_ELEM_SEQ_NBR     05007610
050077             AND  C.ATTR_ELEM_SEQ_NBR   = E.ATTR_ELEM_SEQ_NBR     05007710
050078             AND  C.ATTR_ELEM_TXT       = F.SYS_TRLG_CDE          05007810
050079             AND (D.ATTR_ELEM_TXT       = 'PACKTOLIGHT'  OR       05007910
050080                  D.ATTR_ELEM_TXT       = 'MASTERCHILD')          05008010
050081             AND  F.HAZDS_IND           = 'Y'                     05008110
050082             AND  F.SKU_NBR IN                                    05008210
050083                 (SELECT DISTINCT(H.SKU_NBR)                      05008310
050084                    FROM TRECITM G                                05008410
050085                       , XLT_SKU H                                05008510
050086                   WHERE G.ORD_NBR        = :RECITM-ORD-NBR       05008610
050087                     AND G.REC_SEQ_NBR    = :RECITM-REC-SEQ-NBR   05008710
050088                     AND G.PREPK_ID       = :RECITM-PREPK-ID      05008810
050089                     AND G.VER_STATUS_CDE = 'A'                   05008910
050090                     AND G.ITM_NBR        =  H.ITM_NBR)           05009010
050091           FETCH FIRST 1 ROW ONLY                                 05009110
050092            WITH UR                                               05009210
050093     END-EXEC.                                                    05009310
050094                                                                  05009410
050095     EVALUATE TRUE                                                05009510
050096         WHEN SQLCODE = +0                                        05009610
050097         WHEN SQLCODE = -811                                      05009710
050098              MOVE  PS-HAZARDOUS-SW                               05009810
050099                TO  PC068-HAZ-SW                                  05009910
050100                                                                  05010010
050101              IF  PS-HAZARDOUS-YES                                05010110
050102                  ADD  1   TO  PV-HAZ-COUNT                       05010210
050103                                                                  05010310
050104                  MOVE  PC068-TOT-CTN-CNT                         05010410
050105                    TO  PC068-HAZ-CTN-CNT                         05010510
050106                                                                  05010610
050107                  MOVE  PC068-UNIT-CNT                            05010710
050108                    TO  PC068-HAZ-UNT-CNT                         05010810
050109              ELSE                                                05010910
050110                  SET   PC068-HAZDS-NO  TO  TRUE                  05011010
050111                  MOVE  ZEROES          TO  PC068-HAZ-CTN-CNT     05011110
050112                                            PC068-HAZ-UNT-CNT     05011210
050113              END-IF                                              05011310
050114                                                                  05011410
050115         WHEN SQLCODE = +100                                      05011510
050116              SET  PC068-HAZDS-NO       TO  TRUE                  05011610
050117              MOVE  ZEROES              TO  PC068-HAZ-CTN-CNT     05011710
050118                                            PC068-HAZ-UNT-CNT     05011810
050119         WHEN SQLWARN0 NOT = SPACES                               05011910
050120         WHEN SQLCODE NOT = ZERO                                  05012010
050121              SET  PC068-HAZDS-NO      TO TRUE                    05012110
050122              MOVE ZEROES              TO PC068-HAZ-CTN-CNT       05012210
050123                                          PC068-HAZ-UNT-CNT       05012310
050124              MOVE PC068-TRIP-ID       TO PV-DISPLAY-TRIP-ID      05012410
050125              MOVE PC068-OPER-UNT-ID   TO PV-DISPLAY-OPER-UNT-ID  05012510
050126              MOVE PC068-PO-NBR        TO PV-DISPLAY-PO-NBR       05012610
050127              MOVE PC068-REC-SEQ-NBR   TO PV-DISPLAY-PO-LNE-NBR   05012710
050128              MOVE PC068-PO-LNE-NBR    TO PV-DISPLAY-RCVR-SEQ-NBR 05012810
050129              MOVE PC068-PACK-ID       TO PV-DISPLAY-PACK-ID      05012910
050130                                                                  05013010
050131              MOVE 'CHECK IF HAZARDOUS - PBS       '              05013110
050132                                    TO PV-DB2-OPERATION-MESSAGE-1 05013210
050133              MOVE 'XLT_HAZDS'      TO PV-DB2-TABLE-NAME1         05013310
050134              MOVE '3020-CHECK-HAZDS-PBS        '                 05013410
050135                                          TO PV-PARAGRAPH-NAME    05013510
050136              PERFORM Z999A-SQL-ABEND                             05013610
050137     END-EVALUATE.                                                05013710
050138                                                                  05013810
050139                                                                  05013910
050140***************************************************************** 05014010
050150*                                                               * 05015010
050200***************************************************************** 05020002
050300 4000-CHECK-CNTL-FLOW.                                            05030002
050400                                                                  05040002
050500     MOVE PC068-PO-NBR       TO  TRBNTF-PO-NBR.                   05050002
050510     MOVE PC068-REC-SEQ-NBR  TO  TRBNTF-REC-SEQ-NBR.              05051002
050600                                                                  05060002
050700     EXEC SQL                                                     05070002
050800          SELECT E.RESOLVED_IND                                   05080002
050900            INTO :TRBNTF-RESOLVED-IND                             05090002
051000            FROM WST_INTGRTN_TYP A                                05100002
051100               , WST_ATTR_DEFN   B                                05110002
051200               , WST_ATTR_ELEM   C                                05120002
051300               , WST_ATTR_ELEM   D                                05130002
051400               , TTRBNTF E                                        05140002
051500         WHERE A.INTGRTN_TYP_CDE    =  'CNTLFLOW'                 05150002
051600            AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE           05160002
051700            AND B.ATTR_DEFN_SEQ_NBR = 1                           05170002
051800            AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE           05180002
051900            AND C.ATTR_DEFN_SEQ_NBR = 1                           05190002
052000            AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE           05200002
052100            AND D.ATTR_DEFN_SEQ_NBR = 2                           05210002
052200            AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR         05220002
052300            AND D.ATTR_ELEM_NBR     = E.TRBL_RSN_CDE              05230002
052400            AND E.ACKNOWLG_TMST     > CURRENT TIMESTAMP           05240002
052500            AND E.PO_NBR            = :TRBNTF-PO-NBR              05250002
052600            AND E.REC_SEQ_NBR       = :TRBNTF-REC-SEQ-NBR         05260002
053300           FETCH FIRST 1 ROW ONLY                                 05330002
053400            WITH UR                                               05340002
053500     END-EXEC.                                                    05350002
053600                                                                  05360002
053700     EVALUATE TRUE                                                05370002
053800         WHEN SQLCODE = +0                                        05380002
053900         WHEN SQLCODE = -811                                      05390002
054000              SET  PS-CNTL-FLOW-YES    TO TRUE                    05400002
055400                                                                  05540002
055500         WHEN SQLCODE = +100                                      05550002
055600              SET  PS-CNTL-FLOW-NO     TO TRUE                    05560002
055700                                                                  05570002
055900         WHEN SQLWARN0 NOT = SPACES                               05590002
056000         WHEN SQLCODE NOT = ZERO                                  05600002
056010              SET  PS-CNTL-FLOW-NO     TO TRUE                    05601002
056200              MOVE ZEROES              TO PC068-HAZ-CTN-CNT       05620002
056300                                          PC068-HAZ-UNT-CNT       05630002
056400              MOVE PC068-TRIP-ID       TO PV-DISPLAY-TRIP-ID      05640002
056500              MOVE PC068-OPER-UNT-ID   TO PV-DISPLAY-OPER-UNT-ID  05650002
056600              MOVE PC068-PO-NBR        TO PV-DISPLAY-PO-NBR       05660003
056700              MOVE PC068-REC-SEQ-NBR   TO PV-DISPLAY-PO-LNE-NBR   05670003
056800              MOVE PC068-PO-LNE-NBR    TO PV-DISPLAY-RCVR-SEQ-NBR 05680003
056900              MOVE PC068-PACK-ID       TO PV-DISPLAY-PACK-ID      05690003
057000                                                                  05700002
057100              MOVE 'CHECK IF CONTROLLED FLOW       '              05710002
057200                                    TO PV-DB2-OPERATION-MESSAGE-1 05720002
057300              MOVE 'XLT_HAZDS'      TO PV-DB2-TABLE-NAME1         05730002
057400              MOVE '4000-CHECK-CNTL-FLOW        '                 05740002
057500                                          TO PV-PARAGRAPH-NAME    05750002
057600              PERFORM Z999A-SQL-ABEND                             05760002
057700     END-EVALUATE.                                                05770002
057800                                                                  05780002
057900                                                                  05790002
095410***************************************************************** 09541002
095411*                                                               * 09541102
095420***************************************************************** 09542002
095500 7000-READ-INPUT-FILE.                                            09550000
095600                                                                  09560002
095700      READ INPUT-FILE INTO PC068-RECORD-LAYOUT                    09570002
095800        AT END                                                    09580000
095900           SET PS-END-OF-INPUT-FILE TO TRUE                       09590000
096000        NOT AT END                                                09600000
096100           ADD +1 TO PV-READ-COUNT                                09610000
096300           MOVE ZEROES TO PC068-CNTL-FLOW-CTN-CNT                 09630002
096400                          PC068-CNTL-FLOW-UNT-CNT                 09640002
096500                          PC068-HAZ-CTN-CNT                       09650002
096600                          PC068-HAZ-UNT-CNT                       09660002
096700           SET  PC068-CNTL-FLOW-NO                                09670002
096800                PC068-HAZDS-NO       TO  TRUE                     09680002
097500      END-READ.                                                   09750000
097510                                                                  09751002
097520                                                                  09752002
097600***************************************************************** 09760000
097610*                                                               * 09761002
097700***************************************************************** 09770000
097800 8000-WRITE-TO-DTL-FILE.                                          09780000
097900                                                                  09790002
098000     WRITE OUTPUT-RECORD                                          09800000
098100       FROM PC068-RECORD-LAYOUT.                                  09810000
098200                                                                  09820000
098300     ADD +1 TO PV-WRITE-OUTPUT-COUNT.                             09830002
098400                                                                  09840000
098500***************************************************************** 09850001
098600*                                                               * 09860001
098700***************************************************************** 09870001
101800 9000-CLOSE-FILES.                                                10180000
101900                                                                  10190000
102000     DISPLAY ' '.                                                 10200000
102100     DISPLAY '**************************************************'.10210000
102200     DISPLAY 'PROGRAM.................'   PC-PROGRAM-NAME.        10220000
102300     DISPLAY ' '.                                                 10230000
102400     MOVE PV-READ-COUNT              TO PV-DISPLAY-COUNT.         10240002
102500     DISPLAY 'TOT RECS READ       : '   PV-DISPLAY-COUNT.         10250002
102600     DISPLAY ' '.                                                 10260000
102700     DISPLAY 'RETURN CODE        = ' RETURN-CODE                  10270000
102710     DISPLAY ' '.                                                 10271002
102900     MOVE PV-WRITE-OUTPUT-COUNT       TO PV-DISPLAY-COUNT.        10290002
103000     DISPLAY 'TOT RECS READ:         '   PV-DISPLAY-COUNT.        10300002
103010     DISPLAY ' '.                                                 10301002
103020     MOVE PV-HAZ-COUNT                TO PV-DISPLAY-COUNT.        10302002
103030     DISPLAY 'TOT HAZARDOUS:         '   PV-DISPLAY-COUNT.        10303002
103040     DISPLAY ' '.                                                 10304002
103050     MOVE PV-CNTL-FLOW-COUNT          TO PV-DISPLAY-COUNT.        10305004
103060     DISPLAY 'TOT CONTROLLED FLOW:   '   PV-DISPLAY-COUNT.        10306002
103100                                                                  10310000
103200                                                                  10320000
103300     CLOSE INPUT-FILE                                             10330000
103400           OUTPUT-FILE.                                           10340000
103500                                                                  10350000
105400***************************************************************** 10540000
105500 Z999A-SQL-ABEND.                                                 10550000
105600***************************************************************** 10560000
105700     MOVE SQLCODE             TO PV-DISPLAY-SQLCODE.              10570005
105701                                                                  10570102
105710     DISPLAY '** ABEND **:       SQLERROR'.                       10571002
105720     DISPLAY '** PROGRAM:      ' PC-PROGRAM-NAME.                 10572002
105721     DISPLAY '** '                                                10572102
105730     DISPLAY '** TRIP ID:      ' PV-DISPLAY-TRIP-ID.              10573005
105740     DISPLAY '** OPER UNT ID:  ' PV-DISPLAY-OPER-UNT-ID.          10574005
105750     DISPLAY '** PO NBR:       ' PV-DISPLAY-PO-NBR.               10575005
105760     DISPLAY '** RCVR SEQ NBR: ' PV-DISPLAY-PO-LNE-NBR.           10576005
105770     DISPLAY '** LINE NUMBER:  ' PV-DISPLAY-RCVR-SEQ-NBR.         10577005
105780     DISPLAY '** PACK ID:      ' PV-DISPLAY-PACK-ID.              10578005
105790     DISPLAY '** SKU:          ' PC068-SKU-NUMBER.                10579005
105791     DISPLAY '** '                                                10579102
105792     DISPLAY '** PARAGRAPH:    ' PV-PARAGRAPH-NAME.               10579202
105793     DISPLAY '** DB2 TABLE:    ' PV-DB2-TABLE-NAME1.              10579305
105794     DISPLAY '** SQLCODE:      ' PV-DISPLAY-SQLCODE.              10579405
106800                                                                  10680000
106900     MOVE +4013                  TO PV-ABEND-CODE.                10690000
