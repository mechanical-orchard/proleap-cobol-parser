000100 IDENTIFICATION DIVISION.                                         00010000
000200 TITLE 'CONVERT RDM INVENTORY BALANCE TO CE FORMAT'.              00020000
000300 PROGRAM-ID.      WSKUT016.                                       00030000
000400 AUTHOR.          DENNIS STEFFEN.                                 00040000
000500 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00050000
000600 DATE-WRITTEN.    JULY 2000.                                      00060000
000700 DATE-COMPILED.                                                   00070000
000800***************************************************************** 00080000
000900* THIS PROGRAM CONVERTS THE INVENTORY BALANCE UPLOAD FILE INTO    00090000
001000* THE CE018 FORMAT.  THIS IS INPUT TO CENTRAL STOCK INVENTORY     00100000
001100* REPORTS CEKRP005 AND CEKRP012 IN PROC CEK0201.  IT IS ALSO      00110000
      * INPUT INTO THE E-COMM CENTRAL STOCK REPORT WFKRP005 IN PROC     00120000
      * WSK1101.                                                        00130000
000800***************************************************************** 00140000
001200* 2010-12-07 CHRISTINE TWIEHAUS ADDED OPERCO_NBR = '03'           00150000
001200*            TO QUERRY AGAINST TMDSEAR TO MAKE RUN FASTER         00160000
000800***************************************************************** 00170000
196385* 2017-11-01 JIM HUNTER ADDING LOGIC TO TREAT ALL QTYS FROM       00180000
196385*            EFC5 (839) AS POSITIVE UNTIL EFC5 IS CHANGED TO      00190000
196385*            SET THE INVN-ADJMT-TYPE FIELD ON THE                 00200000
196385*            WST_PIX_TRAN_HIST TABLE TO AN 'A' WHEN THE QTY IS    00210000
196385*            POSITIVE AS THE OTHER EFC'S DO.  CHG0196385          00220000
000800***************************************************************** 00221000
196385* 2020-05-20 JEAN KURK  RENAME FROM WMKUT016 TO WSKUT016          00222000
196385***************************************************************** 00230000
263627* CHANGED 11/05/2021    BY JIM HUNTER      WR: CHG0263627         00232001
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00233001
263627* MAKING THE CALL DYNAMIC VS STATIC.                              00234001
263627***************************************************************** 00235001
001300 ENVIRONMENT DIVISION.                                            00240000
001400 CONFIGURATION SECTION.                                           00250000
001500 SOURCE-COMPUTER. IBM-3090.                                       00260000
001600 OBJECT-COMPUTER. IBM-3090.                                       00270000
001700 INPUT-OUTPUT SECTION.                                            00280000
001800 FILE-CONTROL.                                                    00290000
001900     SELECT INV-BALANCE-FILE ASSIGN TO UT-S-INP01.                00300000
002000     SELECT CE018-FILE       ASSIGN TO UT-S-OUT01.                00310000
002100                                                                  00320000
002200 DATA DIVISION.                                                   00330000
002300 FILE SECTION.                                                    00340000
002400                                                                  00350000
002500 FD  INV-BALANCE-FILE                                             00360000
002600     RECORDING MODE IS F                                          00370000
002700     LABEL RECORDS ARE STANDARD                                   00380000
002800     RECORD CONTAINS 128                                          00390000
002900     BLOCK CONTAINS 0 RECORDS                                     00400000
003000     DATA RECORD IS INV-BALANCE-RECORD.                           00410000
003100 01  INV-BALANCE-RECORD               PIC X(128).                 00420000
003200                                                                  00430000
003300 FD  CE018-FILE                                                   00440000
003400     RECORDING MODE IS F                                          00450000
003500     LABEL RECORDS ARE STANDARD                                   00460000
003600     RECORD CONTAINS 175                                          00470000
003700     BLOCK CONTAINS 0 RECORDS                                     00480000
003800     DATA RECORD IS SKU-RECORD.                                   00490000
003900 01  SKU-RECORD                       PIC X(175).                 00500000
004000                                                                  00510000
004100 WORKING-STORAGE SECTION.                                         00520000
004200*                                                                 00530000
004300 01  DK-DB2-KEY-FIELDS.                                           00540000
004400     05  DK-CNSTK-LOC-ID              PIC S9(4) COMP.             00550000
004500*                                                                 00560000
004600 01  PV-PROGRAM-VARIABLES.                                        00570000
004700     05  PV-READ-COUNT                PIC S9(07) COMP-3           00580000
004800                                          VALUE ZERO.             00590000
004900     05  PV-WRITE-COUNT               PIC S9(07) COMP-3           00600000
005000                                          VALUE ZERO.             00610000
005100     05  PV-AVAIL-UNITS               PIC S9(09) COMP-3           00620000
005200                                          VALUE ZERO.             00630000
005300     05  PV-RECVD-UNITS               PIC S9(09) COMP-3           00640000
005400                                          VALUE ZERO.             00650000
005500     05  PV-DISTRIB-UNITS             PIC S9(09) COMP-3           00660000
005600                                          VALUE ZERO.             00670000
005700     05  PV-TOTAL-UNITS               PIC S9(09) COMP-3           00680000
005800                                          VALUE ZERO.             00690000
005900     05  PV-SYSTEM-DATE              PIC  9(06)    VALUE ZERO.    00700000
006000     05  PV-DISP-NBR                  PIC Z,ZZZ,ZZ9.              00710000
006100     05  PV-RETRY-COUNT               PIC S9(04)  VALUE +0        00720000
006200                                                  COMP SYNC.      00730000
006300     05  PC-MAX-RETRIES               PIC S9(04) VALUE +3         00740000
006400                                                 COMP SYNC.       00750000
006500     05  PV-ERROR-MESSAGE-1           PIC  X(60)  VALUE SPACES.   00760000
006600     05  PV-ERROR-MESSAGE-2           PIC  X(60)  VALUE SPACES.   00770000
006700     05  PV-ITEM-MSG.                                             00780000
006800         10  PV-ITEM-MSG-DESC         PIC  X(11)  VALUE           00790000
006900                     'ITEM NBR = '.                               00800000
007000         10  PV-ITEM-NUMBER           PIC  9(15).                 00810000
007100     05  PV-LOC-MSG.                                              00820000
007200         10  PV-LOC-MSG-DESC          PIC  X(12)  VALUE           00830000
007300                     'LOCATION = '.                               00840000
007400         10  PV-LOC-NUMBER            PIC  9(04).                 00850000
007500     05  PV-HOLD-DEPT                 PIC 9(4).                   00860000
007600     05  PV-SUB-CLASS-READ            PIC X(3).                   00870000
007700     05  PV-SUB-CLASS.                                            00880000
007800         10  PV-SUB-CLASS-1           PIC X(1) VALUE '0'.         00890000
007900         10  PV-SUB-CLASS-2-3         PIC 9(2).                   00900000
008000                                                                  00910000
008100     05  PV-HOLD-SIZE-CDE             PIC 9(9).                   00920000
008200     05  PV-SIZE-CDE.                                             00930000
008300         10  FILLER                   PIC 9(4).                   00940000
008400         10  PV-SIZE-CDE-5-9          PIC 9(5).                   00950000
008500                                                                  00960000
008600                                                                  00970000
008700 01  PV-ABEND-FIELDS.                                             00980000
008800     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'WSKUT016'.00990000
008900     05  PV-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    01000000
009000     05  PV-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    01010000
009100     05  PV-ABEND-STRUCTURE-1         PIC X(8)   VALUE SPACES.    01020000
009200     05  PV-ABEND-STRUCTURE-2         PIC X(8)   VALUE SPACES.    01030000
009300     05  PV-ABEND-STRUCTURE-3         PIC X(8)   VALUE SPACES.    01040000
009400     05  PV-ABEND-STATUS              PIC XX     VALUE SPACES.    01050000
009500     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01060000
009600     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01070000
009700     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01080000
009800     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01090000
009900     05  PV-SQLCODE                   PIC 9(9)   VALUE ZERO.      01100000
010000     05  PV-FIELD-VALUE               PIC X(80)  VALUE SPACES.    01110000
010100     05  PV-ABEND-PULL-SKU            PIC X(08)  VALUE SPACES.    01120000
010200                                                                  01130000
010300 01  PV-ABEND-CODE                    PIC S9(04)     VALUE +0     01140000
010400                                                     COMP SYNC.   01150000
010500     88  ABEND-4001-CTRL-CARD-ERROR                  VALUE +4001. 01160000
010600     88  ABEND-4002-INPUT-DATE-ERROR                 VALUE +4002. 01170000
010700     88  ABEND-4003-START-DATE-ERROR                 VALUE +4003. 01180000
010800     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 01190000
010900*                                                                 01200000
011000 01  PC-PROGRAM-CONSTANTS.                                        01210000
011100     05  PC-PGMNAME                   PIC X(08) VALUE             01220000
011200                                                  'WSKUT016'.     01230000
011300     05  PC-MPS-PROGRAM-NAME         PIC  X(08) VALUE             01240000
011400                                                  'DPKUT039'.     01250000
011500     05  PC-CURRENT-OPERATING-COMPANY                             01260000
011600                                     PIC  X(02) VALUE '03'.       01270000
011700     05  PC-SYSTEM-CODE              PIC  X(02) VALUE 'MP'.       01280000
011800*                                                                 01290000
011900 01  PS-PROGRAM-SWITCHES.                                         01300000
012000     05  PS-EOF-INV-BALANCE-SWITCH    PIC X       VALUE 'N'.      01310000
012100         88  PS-EOF-INV-BALANCE-FILE              VALUE 'Y'.      01320000
012200     05  PS-RECORD-FOUND-SW           PIC X       VALUE 'N'.      01330000
012300         88  PS-NO-RECORD-FOUND                   VALUE 'N'.      01340000
012400         88  PS-RECORD-FOUND                      VALUE 'Y'.      01350000
012500                                                                  01360000
012600/                                                                 01370000
012700*  RMS INVENTORY BALANCE UPLOAD FILE                              01380000
012800     COPY CERD022.                                                01390000
012900/                                                                 01400000
013000*  CENTRAL STOCK SKU RECORD                                       01410000
013100     COPY CERD018.                                                01420000
013200/                                                                 01430000
013300     COPY DPWS010I.                                               01440000
013400/                                                                 01450000
013500*  USED FOR DB2 ERROR MESSAGE BUILDING                            01460000
013600     COPY DPWS004.                                                01470000
013700                                                                  01480000
013800*  USED FOR DB2 ITEM DOMAIN                                       01490000
013900     COPY XLWS001.                                                01500000
014000                                                                  01510000
014100*   DB2 SQL COMMUNICATION AREA                                    01520000
014200     EXEC SQL                                                     01530000
014300          INCLUDE SQLCA                                           01540000
014400     END-EXEC.                                                    01550000
014500                                                                  01560000
014600     EXEC SQL                                                     01570000
014700         INCLUDE  TMDSEAR                                         01580000
014800     END-EXEC.                                                    01590000
014900                                                                  01600000
015000     EXEC SQL                                                     01610000
015100          INCLUDE TCEPLIT                                         01620000
015200     END-EXEC.                                                    01630000
015300/                                                                 01640000
015400     EXEC SQL                                                     01650000
015500          INCLUDE TCEPLST                                         01660000
015600     END-EXEC.                                                    01670000
015700/                                                                 01680000
015800     EXEC SQL                                                     01690000
015900          INCLUDE TCEPLRQ                                         01700000
016000     END-EXEC.                                                    01710000
016100/                                                                 01720000
018100 PROCEDURE DIVISION.                                              01730000
018200                                                                  01740000
018300 0000-PROGRAM-MAINLINE.                                           01750000
018400                                                                  01760000
018500     PERFORM 1000-INITIALIZATION.                                 01770000
018600                                                                  01780000
018700     PERFORM 2000-PROCESS-INV-BALANCE                             01790000
018800         UNTIL PS-EOF-INV-BALANCE-FILE                            01800000
018900                                                                  01810000
019000     PERFORM 9000-END-ROUTINE.                                    01820000
019100                                                                  01830000
019200     GOBACK.                                                      01840000
019300/                                                                 01850000
019400 1000-INITIALIZATION.                                             01860000
019500                                                                  01870000
019600     OPEN INPUT INV-BALANCE-FILE                                  01880000
019700          OUTPUT CE018-FILE.                                      01890000
019800                                                                  01900000
019900     PERFORM 8000-READ-INV-BALANCE-FILE.                          01910000
020000                                                                  01920000
020100 2000-PROCESS-INV-BALANCE.                                        01930000
020200                                                                  01940000
020300     IF  CE022-ITEM-NBR NOT = 'UNKNOWNITEM'                       01950000
020300         PERFORM 7220-CALL-XLKUT-DOMAIN-PGM                       01960000
020400         PERFORM 7250-SELECT-DATE                                 01970000
020500         PERFORM 7500-SELECT-BYR                                  01980000
020600                                                                  01990000
020700         PERFORM 8200-EDIT-AVAIL-UNITS                            02000000
020800         PERFORM 8210-EDIT-RECVD-UNITS                            02010000
020900         PERFORM 8220-EDIT-DISTRIB-UNITS                          02020000
021000         PERFORM 8230-EDIT-TOTAL-UNITS                            02030000
021100                                                                  02040000
021200         PERFORM 2100-MOVE-FIELDS                                 02050000
021300                                                                  02060000
021400         PERFORM 8100-WRITE-SKU-RECORD                            02070000
020300     END-IF.                                                      02080000
021500                                                                  02090000
021600     PERFORM 8000-READ-INV-BALANCE-FILE.                          02100000
021700                                                                  02110000
021800 2100-MOVE-FIELDS.                                                02120000
021900                                                                  02130000
022000     INITIALIZE CE018-SKU-RECORD.                                 02140000
022100                                                                  02150000
022200     MOVE XL001-ITM-NBR               TO CE018-ITEM-NMBR.         02160000
022300     MOVE CE022-LOCATION              TO CE018-CENTRAL-STOCK-LOC. 02170000
022400     MOVE XL001-DEPT-NBR              TO PV-HOLD-DEPT.            02180000
022500     MOVE PV-HOLD-DEPT                TO CE018-DEPT.              02190000
022600     MOVE XL001-SKU-NBR               TO CE018-SKU.               02200000
022700     MOVE XL001-SKU-DESC              TO CE018-SKU-DESC.          02210000
022800     MOVE XL001-VS-NBR                TO CE018-VENDOR-STYLE-CODE. 02220000
022900**   MOVE XL001-KOHLS-SIZE-CDE        TO PV-HOLD-SIZE-CDE.        02230000
023000**   MOVE PV-HOLD-SIZE-CDE            TO PV-SIZE-CDE.             02240000
023100**   MOVE PV-SIZE-CDE-5-9             TO CE018-SIZE-DESC.         02250000
023200     MOVE XL001-SIZE-DESC             TO CE018-SIZE-DESC.         02260000
023300     MOVE XL001-SHRT-CLOR-DESC        TO CE018-COLOR-DESC.        02270000
023400     MOVE XL001-UNT-RTL-AMT           TO CE018-CUR-UNIT-RTL-AMT.  02280000
023500     MOVE MDSEAR-BYR-NBR              TO CE018-BUYER.             02290000
023600                                                                  02300000
023700     IF PS-RECORD-FOUND                                           02310000
023800         MOVE CEPLST-CRE-TMST(6:2)        TO CE018-PULL-MM        02320000
023900         MOVE CEPLST-CRE-TMST(9:2)        TO CE018-PULL-DD        02330000
024000         MOVE CEPLST-CRE-TMST(3:2)        TO CE018-PULL-YY        02340000
024100     ELSE                                                         02350000
024200         MOVE '00'                        TO CE018-PULL-MM        02360000
024300         MOVE '00'                        TO CE018-PULL-DD        02370000
024400         MOVE '00'                        TO CE018-PULL-YY        02380000
024500     END-IF.                                                      02390000
024600     MOVE PV-AVAIL-UNITS              TO CE018-AVAIL-UNITS.       02400000
024700     MOVE PV-RECVD-UNITS              TO CE018-RECEIVED-UNITS.    02410000
024800     MOVE PV-DISTRIB-UNITS            TO CE018-DISTRIBUTED-UNITS. 02420000
024900     MOVE PV-TOTAL-UNITS              TO CE018-TOTAL-UNITS.       02430000
024910     MOVE ZEROS                       TO CE018-STORE-EXP-UNITS.   02440000
025000                                                                  02450000
025100 7220-CALL-XLKUT-DOMAIN-PGM.                                      02460000
025200     INITIALIZE XL001-ITEM-COMMAREA.                              02470000
025300     MOVE '7220-SELECT-SKU-BY-SKU'  TO PV-ABEND-PARAGRAPH.        02480000
025400                                                                  02490000
025500     MOVE CE022-ITEM-NBR(1:8)         TO XL001-KEY-SKU.           02500000
025600                                                                  02510000
025700     SET  XL001-BY-NUMERIC-SKU                                    02520000
025800          XL001-SELECT-SKU                                        02530000
025900          XL001-SELECT-SKU-STR                                    02540000
026000          XL001-SELECT-VND-STYL     TO TRUE.                      02550000
026100                                                                  02560000
026200     CALL XL001-VSM-PGM USING  XL001-ITEM-COMMAREA.               02570000
026300                                                                  02580000
026400     EVALUATE TRUE                                                02590000
026500       WHEN XL001-SKU-SQLCODE = +0                                02600000
026600                                                                  02610000
026700           PERFORM 7230-SELECT-VND-STYL                           02620000
026800                                                                  02630000
026900       WHEN XL001-SKU-SQLCODE = +100                              02640000
027000           MOVE '*** UNKNOWN ***' TO XL001-SKU-DESC               02650000
027100                                                                  02660000
027200       WHEN XL001-SKU-CONTENTION                                  02670000
027300           MOVE '7220-SELECT-SKU-BY-SKU'  TO PV-ABEND-PARAGRAPH   02680000
027400           MOVE 'CONTENTION ABEND ON ROW FROM XLV_SKU'            02690000
027500                                           TO PV-ABEND-OPERATION  02700000
027600           MOVE CE022-ITEM-NBR(1:8)       TO PV-ABEND-PULL-SKU    02710000
027700           STRING 'SELECT XLKUT001 USING ITEM# - '                02720000
027800                                        PV-ABEND-PULL-SKU         02730000
027900             DELIMITED BY SIZE                                    02740000
028000             INTO PV-DB2-OPERATION-MESSAGE-1                      02750000
028100           MOVE XL001-SKU-SQLCODE TO PV-SQLCODE                   02760000
028200           STRING 'SQLCODE = ' PV-SQLCODE                         02770000
028300             DELIMITED BY SIZE                                    02780000
028400             INTO PV-DB2-OPERATION-MESSAGE-2                      02790000
028500           PERFORM 9900-DB2-ABEND                                 02800000
028600                                                                  02810000
028700       WHEN OTHER                                                 02820000
028800           MOVE '7220-SELECT-SKU-BY-SKU'  TO PV-ABEND-PARAGRAPH   02830000
028900           MOVE 'OTHER ABEND ON ROW FROM XLV_SKU'                 02840000
029000                                           TO PV-ABEND-OPERATION  02850000
029100           MOVE CE022-ITEM-NBR(1:8)       TO PV-ABEND-PULL-SKU    02860000
029200           STRING 'SELECT XLKUT001 USING ITEM# - '                02870000
029300                                        PV-ABEND-PULL-SKU         02880000
029400             DELIMITED BY SIZE                                    02890000
029500             INTO PV-DB2-OPERATION-MESSAGE-1                      02900000
029600           MOVE XL001-SKU-SQLCODE TO PV-SQLCODE                   02910000
029700           STRING 'SQLCODE = ' PV-SQLCODE                         02920000
029800             DELIMITED BY SIZE                                    02930000
029900             INTO PV-DB2-OPERATION-MESSAGE-2                      02940000
030000           PERFORM 9900-DB2-ABEND                                 02950000
030100     END-EVALUATE.                                                02960000
030200                                                                  02970000
030300 7230-SELECT-VND-STYL.                                            02980000
030400                                                                  02990000
030500     MOVE '7230-SELECT-VND-STYL'          TO PV-ABEND-PARAGRAPH.  03000000
030600                                                                  03010000
030700     EVALUATE TRUE                                                03020000
030800       WHEN XL001-VND-STYL-SQLCODE = +0                           03030000
030900                                                                  03040000
031000           PERFORM 7240-SELECT-SKU-STR                            03050000
031100                                                                  03060000
031200       WHEN XL001-VND-STYL-SQLCODE = +100                         03070000
031300           MOVE SPACES                    TO XL001-DEPT-NBR-3CH   03080000
031400                                             XL001-MAJ-CL-NBR-2CH 03090000
031500                                             XL001-SUB-CL-NBR-2CH 03100000
031600                                                                  03110000
031700       WHEN XL001-VND-STYL-CONTENTION                             03120000
031800           MOVE '7230-SELECT-VND-STYL'    TO PV-ABEND-PARAGRAPH   03130000
031900           MOVE 'SELECT ROW FROM XLV_VND_STYL'                    03140000
032000                                          TO PV-ABEND-OPERATION   03150000
032100           MOVE CE022-ITEM-NBR(1:8)       TO PV-ABEND-PULL-SKU    03160000
032200           STRING 'SELECT XLKUT001 USING ITEM# - '                03170000
032300                                        PV-ABEND-PULL-SKU         03180000
032400             DELIMITED BY SIZE                                    03190000
032500             INTO PV-DB2-OPERATION-MESSAGE-1                      03200000
032600           MOVE XL001-VND-STYL-SQLCODE TO PV-SQLCODE              03210000
032700           STRING 'SQLCODE = ' PV-SQLCODE                         03220000
032800             DELIMITED BY SIZE                                    03230000
032900             INTO PV-DB2-OPERATION-MESSAGE-2                      03240000
033000           PERFORM 9900-DB2-ABEND                                 03250000
033100                                                                  03260000
033200       WHEN OTHER                                                 03270000
033300           MOVE '7230-SELECT-VND-STYL'    TO PV-ABEND-PARAGRAPH   03280000
033400           MOVE 'SELECT ROW FROM XLV_VND_STYL'                    03290000
033500                                          TO PV-ABEND-OPERATION   03300000
033600           MOVE CE022-ITEM-NBR(1:8)       TO PV-ABEND-PULL-SKU    03310000
033700           STRING 'SELECT XLKUT001 USING ITEM# - '                03320000
033800                                        PV-ABEND-PULL-SKU         03330000
033900             DELIMITED BY SIZE                                    03340000
034000             INTO PV-DB2-OPERATION-MESSAGE-1                      03350000
034100           MOVE XL001-VND-STYL-SQLCODE TO PV-SQLCODE              03360000
034200           STRING 'SQLCODE = ' PV-SQLCODE                         03370000
034300             DELIMITED BY SIZE                                    03380000
034400             INTO PV-DB2-OPERATION-MESSAGE-2                      03390000
034500           PERFORM 9900-DB2-ABEND                                 03400000
034600     END-EVALUATE.                                                03410000
034700                                                                  03420000
034800 7240-SELECT-SKU-STR.                                             03430000
034900                                                                  03440000
035000     MOVE '7240-SELECT-SKU-STR '          TO PV-ABEND-PARAGRAPH.  03450000
035100                                                                  03460000
035200     EVALUATE TRUE                                                03470000
035300       WHEN XL001-SKU-STR-SQLCODE = +0                            03480000
035400                                                                  03490000
035500           CONTINUE                                               03500000
035600                                                                  03510000
035700       WHEN XL001-SKU-STR-SQLCODE = +100                          03520000
035800           MOVE 0                         TO XL001-UNT-RTL-AMT    03530000
035900                                                                  03540000
036000       WHEN XL001-SKU-STR-CONTENTION                              03550000
036100           MOVE '7240-SELECT-SKU-STR'     TO PV-ABEND-PARAGRAPH   03560000
036200           MOVE 'SELECT ROW FROM XLV_SKU_STR'                     03570000
036300                                          TO PV-ABEND-OPERATION   03580000
036400           MOVE CE022-ITEM-NBR(1:8)       TO PV-ABEND-PULL-SKU    03590000
036500           STRING 'SELECT XLKUT001 USING ITEM# - '                03600000
036600                                        PV-ABEND-PULL-SKU         03610000
036700             DELIMITED BY SIZE                                    03620000
036800             INTO PV-DB2-OPERATION-MESSAGE-1                      03630000
036900           MOVE XL001-SKU-STR-SQLCODE TO PV-SQLCODE               03640000
037000           STRING 'SQLCODE = ' PV-SQLCODE                         03650000
037100             DELIMITED BY SIZE                                    03660000
037200             INTO PV-DB2-OPERATION-MESSAGE-2                      03670000
037300           PERFORM 9900-DB2-ABEND                                 03680000
037400                                                                  03690000
037500       WHEN OTHER                                                 03700000
037600           MOVE '7240-SELECT-SKU-STR'     TO PV-ABEND-PARAGRAPH   03710000
037700           MOVE 'SELECT ROW FROM XLV_SKU_STR'                     03720000
037800                                          TO PV-ABEND-OPERATION   03730000
037900           MOVE CE022-ITEM-NBR(1:8)       TO PV-ABEND-PULL-SKU    03740000
038000           STRING 'SELECT XLKUT001 USING ITEM# - '                03750000
038100                                        PV-ABEND-PULL-SKU         03760000
038200             DELIMITED BY SIZE                                    03770000
038300             INTO PV-DB2-OPERATION-MESSAGE-1                      03780000
038400           MOVE XL001-SKU-STR-SQLCODE TO PV-SQLCODE               03790000
038500           STRING 'SQLCODE = ' PV-SQLCODE                         03800000
038600             DELIMITED BY SIZE                                    03810000
038700             INTO PV-DB2-OPERATION-MESSAGE-2                      03820000
038800           PERFORM 9900-DB2-ABEND                                 03830000
038900     END-EVALUATE.                                                03840000
039000                                                                  03850000
039100 7250-SELECT-DATE.                                                03860000
      * PKE 5510 - MARJ HOEFS 10/22/2010 - REPLACED DATE_CSR WITH       03870000
      * SELECT MAX WITH UR TO REDUCE LOCKS ON THE CENTRAL STOCK TBLS.   03880000
039200     MOVE CE022-LOCATION              TO DK-CNSTK-LOC-ID.         03890000
041800     INITIALIZE DCLTCEPLST.                                       03900000
041900                                                                  03910000
042000     PERFORM                                                      03920000
042100         WITH TEST AFTER                                          03930000
042200         VARYING PV-RETRY-COUNT                                   03940000
042300         FROM 1 BY 1                                              03950000
042400         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 03960000
042500            OR  (SQLCODE = +0 OR SQLCODE = +100)                  03970000
042500            OR  (SQLCODE = -811 OR SQLCODE = -305))               03980000
042600                                                                  03990000
042700         EXEC SQL                                                 04000000
                  SELECT                                                04010000
                      MAX(C.CRE_TMST)                                   04020000
                  INTO   :CEPLST-CRE-TMST                               04030000
                  FROM TCEPLIT A                                        04040000
                     , TCEPLRQ B                                        04050000
                     , TCEPLST C                                        04060000
                  WHERE                                                 04070000
                      A.ITM_NBR          = :XL001-ITM-NBR               04080000
                  AND B.CNSTK_REQ_PL_NBR = A.CNSTK_REQ_PL_NBR           04090000
                  AND B.CNSTK_LOC_ID     = :DK-CNSTK-LOC-ID             04100000
                  AND B.STAT_CDE         IN ('NW', 'IP', 'PD')          04110000
                  AND A.CNSTK_REQ_PL_NBR = C.CNSTK_REQ_PL_NBR           04120000
                  AND A.PL_LNE_NBR       = C.PL_LNE_NBR                 04130000
                  AND A.STAT_CDE         IN ('NW', 'IP', 'PD')          04140000
                  AND C.STAT_CDE         = 'NW'                         04150000
                  WITH UR                                               04160000
043000         END-EXEC                                                 04170000
043100                                                                  04180000
043200         EVALUATE TRUE                                            04190000
043300             WHEN SQLCODE = +0                                    04200000
043300             WHEN SQLCODE = -811                                  04210000
043500                  SET PS-RECORD-FOUND    TO TRUE                  04220000
043600             WHEN SQLCODE = +100                                  04230000
                   WHEN SQLCODE = -305                                  04240000
043700                  SET PS-NO-RECORD-FOUND TO TRUE                  04250000
043800             WHEN SQLWARN0 NOT = SPACE                            04260000
043900             WHEN SQLCODE  NOT = +0                               04270000
044000                  MOVE '7250-SELECT-DATE      '                   04280000
044100                                       TO PV-ABEND-PARAGRAPH      04290000
044200                  MOVE 'SELECT MAX DATE  '                        04300000
044300                                       TO PV-ABEND-OPERATION      04310000
044400                  MOVE 'TCEPLIT'   TO PV-ABEND-STRUCTURE-1        04320000
044500                  MOVE 'TCEPLST'   TO PV-ABEND-STRUCTURE-2        04330000
044600                  MOVE 'TCEPLRQ'   TO PV-ABEND-STRUCTURE-3        04340000
044700                  MOVE XL001-ITM-NBR TO PV-ITEM-NUMBER            04350000
044800                  MOVE PV-ITEM-MSG TO PV-DB2-OPERATION-MESSAGE-1  04360000
044900                  MOVE DK-CNSTK-LOC-ID  TO PV-LOC-NUMBER          04370000
045000                  MOVE PV-LOC-MSG  TO PV-DB2-OPERATION-MESSAGE-2  04380000
045100                  PERFORM 9900-DB2-ABEND                          04390000
045200         END-EVALUATE                                             04400000
045300                                                                  04410000
045400         IF  PV-RETRY-COUNT > PC-MAX-RETRIES                      04420000
045500             MOVE '7250-SELECT-DATE      '                        04430000
045600                                     TO PV-ABEND-PARAGRAPH        04440000
045700             MOVE 'MAX RETRIES EXCEEDED'                          04450000
045800                                     TO PV-ABEND-OPERATION        04460000
045900             PERFORM 9900-DB2-ABEND                               04470000
046000         END-IF                                                   04480000
046100     END-PERFORM.                                                 04490000
046200                                                                  04500000
048400 7500-SELECT-BYR.                                                 04510000
048500     MOVE XL001-SUB-CL-NBR-2CH  TO PV-SUB-CLASS-2-3.              04520000
048600     MOVE PV-SUB-CLASS         TO PV-SUB-CLASS-READ.              04530000
048700                                                                  04540000
048800     EXEC SQL                                                     04550000
048900         SELECT BYR_NBR                                           04560000
049000           INTO                                                   04570000
049100                :MDSEAR-BYR-NBR                                   04580000
049200           FROM TMDSEAR                                           04590000
049300          WHERE DEPT_NBR   = :XL001-DEPT-NBR-3CH                  04600000
049400            AND MAJ_CL_NBR = :XL001-MAJ-CL-NBR-2CH                04610000
049500            AND SUB_CL_NBR = :PV-SUB-CLASS-READ                   04620000
049600            AND MDSELV_CDE = 'SCL'                                04630000
                  AND OPERCO_NBR = '03'                                 04640000
049700     END-EXEC.                                                    04650000
049800                                                                  04660000
049900     EVALUATE TRUE                                                04670000
050000         WHEN SQLCODE = ZERO                                      04680000
050100         WHEN SQLCODE = -811                                      04690000
050200              CONTINUE                                            04700000
050300         WHEN SQLCODE = +100                                      04710000
050400              MOVE 0               TO MDSEAR-BYR-NBR              04720000
050500         WHEN OTHER                                               04730000
050600              MOVE '7500-SELECT-BYR'                              04740000
050700                             TO PV-ABEND-PARAGRAPH                04750000
050800              MOVE 'READ BYR'                                     04760000
050900                             TO PV-ABEND-OPERATION                04770000
051000              MOVE 'TMDSEAR'   TO PV-ABEND-STRUCTURE-1            04780000
051100             STRING 'DEPT= ' XL001-DEPT-NBR-3CH                   04790000
051200                    ' MAJCLASS= ' XL001-MAJ-CL-NBR-2CH            04800000
051300                    ' SUBCLASS= ' PV-SUB-CLASS-READ               04810000
051400                    ' CODE= SCL'                                  04820000
051500                           DELIMITED BY SIZE                      04830000
051600                                      INTO PV-FIELD-VALUE         04840000
051700              PERFORM 9900-DB2-ABEND                              04850000
051800     END-EVALUATE.                                                04860000
051900                                                                  04870000
052000 8000-READ-INV-BALANCE-FILE.                                      04880000
052100     READ INV-BALANCE-FILE                                        04890000
052200         INTO CE022-INV-BAL-UPLOAD-RECORD                         04900000
052300     AT END                                                       04910000
052400         SET PS-EOF-INV-BALANCE-FILE  TO TRUE                     04920000
052500     NOT AT END                                                   04930000
052600             ADD 1                 TO PV-READ-COUNT               04940000
052700     END-READ.                                                    04950000
052800                                                                  04960000
052900 8100-WRITE-SKU-RECORD.                                           04970000
053000     WRITE SKU-RECORD FROM CE018-SKU-RECORD                       04980000
053100     ADD 1                            TO PV-WRITE-COUNT.          04990000
053200 8200-EDIT-AVAIL-UNITS.                                           05000000
053300     MOVE ZERO                        TO PV-AVAIL-UNITS           05010000
053400     MOVE CE022-AVAIL-UNITS           TO DP010I-UNEDITED-FIELD    05020000
053500     MOVE LENGTH OF CE022-AVAIL-UNITS TO DP010I-MAXIMUM-DIGITS    05030000
053600     MOVE ZERO                        TO DP010I-MAXIMUM-DECIMALS  05040000
053700     SET DP010I-NEGATIVE-ALLOWED      TO TRUE                     05050000
263627     CALL DP010I-NUMERIC-EDIT-ROUTINE                             05061001
263627          USING DP010I-NUMERIC-EDIT-AREA                          05062001
053900                                                                  05070000
054000     IF DP010I-ERROR-DETECTED                                     05080000
054100         CONTINUE                                                 05090000
054200     ELSE                                                         05100000
054300         MOVE DP010I-NUMERIC-FIELD    TO PV-AVAIL-UNITS           05110000
054301* RPK 06/06/07 - BEGIN                                            05120000
054302*        FOLLOWING LOGIC ADDED BECAUSE OF WMOS                    05130000
054303*        SEE PROGRAM DOC FOR MORE INFORMATION                     05140000
054310         IF  CE022-AVAIL-UNT-SIGN-NEG                             05150000
596385         AND (CE022-LOCATION NOT = 839)                           05160000
054320             MULTIPLY -1 BY PV-AVAIL-UNITS                        05170000
054330         END-IF                                                   05180000
054340* RPK 06/06/07 - END                                              05190000
054400     END-IF.                                                      05200000
054500                                                                  05210000
054600 8210-EDIT-RECVD-UNITS.                                           05220000
054700     MOVE ZERO                        TO PV-RECVD-UNITS           05230000
054800     MOVE CE022-RECVD-UNITS           TO DP010I-UNEDITED-FIELD    05240000
054900     MOVE LENGTH OF CE022-RECVD-UNITS TO DP010I-MAXIMUM-DIGITS    05250000
055000     MOVE ZERO                        TO DP010I-MAXIMUM-DECIMALS  05260000
055100     SET DP010I-NEGATIVE-NOT-ALLOWED  TO TRUE                     05270000
263627     CALL DP010I-NUMERIC-EDIT-ROUTINE                             05281001
263627          USING DP010I-NUMERIC-EDIT-AREA                          05282001
055300                                                                  05290000
055400     IF DP010I-ERROR-DETECTED                                     05300000
055500         CONTINUE                                                 05310000
055600     ELSE                                                         05320000
055700         MOVE DP010I-NUMERIC-FIELD    TO PV-RECVD-UNITS           05330000
055701* RPK 06/06/07 - BEGIN                                            05340000
055702*        FOLLOWING LOGIC ADDED BECAUSE OF WMOS                    05350000
055703*        SEE PROGRAM DOC FOR MORE INFORMATION                     05360000
055710         IF  CE022-RECVD-UNT-SIGN-NEG                             05370000
196385         AND (CE022-LOCATION NOT = 839)                           05380000
055720             MULTIPLY -1 BY PV-RECVD-UNITS                        05390000
055730         END-IF                                                   05400000
055740* RPK 06/06/07 - END                                              05410000
055800     END-IF.                                                      05420000
055900                                                                  05430000
056000 8220-EDIT-DISTRIB-UNITS.                                         05440000
056100     MOVE ZERO                        TO PV-DISTRIB-UNITS         05450000
056200     MOVE CE022-DISTRIB-UNITS         TO DP010I-UNEDITED-FIELD    05460000
056300     MOVE LENGTH OF CE022-DISTRIB-UNITS TO DP010I-MAXIMUM-DIGITS  05470000
056400     MOVE ZERO                        TO DP010I-MAXIMUM-DECIMALS  05480000
056500     SET DP010I-NEGATIVE-NOT-ALLOWED  TO TRUE                     05490000
263627     CALL DP010I-NUMERIC-EDIT-ROUTINE                             05501001
263627          USING DP010I-NUMERIC-EDIT-AREA                          05502001
056700                                                                  05510000
056800     IF DP010I-ERROR-DETECTED                                     05520000
056900         CONTINUE                                                 05530000
057000     ELSE                                                         05540000
057100         MOVE DP010I-NUMERIC-FIELD    TO PV-DISTRIB-UNITS         05550000
057101* RPK 06/06/07 - BEGIN                                            05560000
057102*        FOLLOWING LOGIC ADDED BECAUSE OF WMOS                    05570000
057103*        SEE PROGRAM DOC FOR MORE INFORMATION                     05580000
057110         IF  CE022-DISTRIB-UNT-SIGN-NEG                           05590000
196385         AND (CE022-LOCATION NOT = 839)                           05600000
057120             MULTIPLY -1 BY PV-DISTRIB-UNITS                      05610000
057130         END-IF                                                   05620000
057140* RPK 06/06/07 - END                                              05630000
057200     END-IF.                                                      05640000
057300                                                                  05650000
057400 8230-EDIT-TOTAL-UNITS.                                           05660000
057500     MOVE ZERO                        TO PV-TOTAL-UNITS           05670000
057600     MOVE CE022-TOTAL-UNITS           TO DP010I-UNEDITED-FIELD    05680000
057700     MOVE LENGTH OF CE022-TOTAL-UNITS TO DP010I-MAXIMUM-DIGITS    05690000
057800     MOVE ZERO                        TO DP010I-MAXIMUM-DECIMALS  05700000
057900     SET DP010I-NEGATIVE-NOT-ALLOWED  TO TRUE                     05710000
263627     CALL DP010I-NUMERIC-EDIT-ROUTINE                             05721001
263627          USING DP010I-NUMERIC-EDIT-AREA                          05722001
058100                                                                  05730000
058200     IF DP010I-ERROR-DETECTED                                     05740000
058300         CONTINUE                                                 05750000
058400     ELSE                                                         05760000
058500         MOVE DP010I-NUMERIC-FIELD    TO PV-TOTAL-UNITS           05770000
058501* RPK 06/06/07 - BEGIN                                            05780000
058502*        FOLLOWING LOGIC ADDED BECAUSE OF WMOS                    05790000
058503*        SEE PROGRAM DOC FOR MORE INFORMATION                     05800000
058510         IF  CE022-TOTAL-UNT-SIGN-NEG                             05810000
196385         AND (CE022-LOCATION NOT = 839)                           05820000
058520             MULTIPLY -1 BY PV-TOTAL-UNITS                        05830000
058530         END-IF                                                   05840000
058540* RPK 06/06/07 - END                                              05850000
058600     END-IF.                                                      05860000
058700/                                                                 05870000
058800 9000-END-ROUTINE.                                                05880000
058900                                                                  05890000
059000     CLOSE INV-BALANCE-FILE                                       05900000
059100           CE018-FILE                                             05910000
059200                                                                  05920000
059300     DISPLAY SPACES                                               05930000
059400     MOVE PV-READ-COUNT               TO PV-DISP-NBR              05940000
059500     DISPLAY 'INV BALANCE READ      = ' PV-DISP-NBR.              05950000
059600     MOVE PV-WRITE-COUNT              TO PV-DISP-NBR              05960000
059700     DISPLAY 'CE018 RECORDS WRITTEN = ' PV-DISP-NBR.              05970000
059800/                                                                 05980000
059900 9900-DB2-ABEND.                                                  05990000
060000                                                                  06000000
060100     MOVE SQLCODE TO PV-SQLCODE.                                  06010000
060200     DISPLAY '*** DB2 ERROR '.                                    06020000
060300     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       06030000
060400     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 06040000
060500     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               06050000
060600     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               06060000
060700     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       06070000
060800     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       06080000
060900     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       06090000
061000     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             06100000
061100     DISPLAY '* FIELD VALUE * = ' PV-FIELD-VALUE.                 06110000
061200                                                                  06120000
061300     IF PV-ABEND-STRUCTURE-2 > SPACES                             06130000
061400         DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2          06140000
061500     END-IF.                                                      06150000
061600                                                                  06160000
061700                                                                  06170000
061800     COPY DPPD004.                                                06180000
061900                                                                  06190000
062000     IF SQLCODE NOT = -911                                        06200000
062100         EXEC SQL                                                 06210000
062200              ROLLBACK                                            06220000
062300         END-EXEC                                                 06230000
062400     END-IF.                                                      06240000
062500                                                                  06250000
062600     MOVE +4013                  TO PV-ABEND-CODE.                06260000
062700     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         06270000
062800                                                                  06280000
