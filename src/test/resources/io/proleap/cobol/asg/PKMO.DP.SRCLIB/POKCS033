000100*-----------------------*                                         00010013
000200 IDENTIFICATION DIVISION.                                         00020013
000300*-----------------------*                                         00030013
000400 PROGRAM-ID.    POKCS033.                                         00040013
000500 AUTHOR.        DOUG NOLTNER - STRATAGEM.                         00050013
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060013
000700 DATE-WRITTEN.  09/93.                                            00070013
000800 DATE-COMPILED.                                                   00080013
000900*----------------------------------------------------------------*00090013
001000*    W033 - IMPORT PURCHASE INFO                                 *00100013
001100*                                                                *00110013
001200*    THIS PROGRAM ALLOWS THE USER TO VIEW IMPORT INFORMATION     *00120013
001300*    FOR A PURCHASE ORDER IN INQUIRY ONLY.                       *00130013
001400*----------------------------------------------------------------*00140013
W24803* 04/29/03 - LAXMAN BOLINENI, IGSI       WR 24803                *        
W24803*          - REPLACED ALL THE COPYBOOKS TSK, TUPCSKU, TUPC       *        
W24803*            TMDARVS, TVSCHVL WITH XLT00003, XLT00004 AND        *        
W24803*            XLT00006.                                           *        
W24803*          - ALL THE REFERENCES OF TABLES TSK, TUPCSKU, TUPC,    *        
W24803*            TMDARVS, TVSCHVL ARE REPLACED WITH XLT_SKU, XLT_UPC,*        
W24803*            AND XLT_VND_STYL TABLES.                            *        
W24803*          - ALL THE REFERENCES OF 3-DIGIT SEQUENCE NUMBER AND   *        
W24803*            2-DIGIT CLASS ARE REMOVED AND A 8-DIGIT SKU WAS     *        
W24803*            ADDED WHERE EVER REQUIRED.                          *        
W24803*          - SIMILAR KIND OF CHANGES ARE MADE IN THE COPYBOOKS   *        
W24803*            POWS017 AND POWS072.                                *        
W24803*          - THE PROGRAM WAS RECOMPILED TO BRING THE NEW VERSION *        
W24803*            OF COPYBOOKS POWS017 AND POWS072.                   *        
W24803*----------------------------------------------------------------*        
C98147* 11/07/14 - JOHN SELWITSCHKA              - CHG0098147                   
C98147*       RECOMPILED PROGRAM TO BRING IN NEW MAP WITH 8-DIGIT PO            
C98147*----------------------------------------------------------------*        
CICS  *  CHANGED 11/11/2022    BY BARB SCHULTZ    WR: CHG0278485       *00150013
CICS  *                                                                *00150013
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL    *00150013
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.     *00150013
CICS  *----------------------------------------------------------------*        
001500                                                                  00150013
001500                                                                  00150013
001600                                                                  00160013
001700 ENVIRONMENT DIVISION.                                            00170013
001800 DATA DIVISION.                                                   00180013
001900 WORKING-STORAGE SECTION.                                         00190013
002000                                                                  00200013
002100 01  DK-DB2-KEYS.                                                 00210013
002200     05  DK-PO-NBR                PIC S9(09) VALUE +0 COMP.       00220013
002300                                                                  00230013
002400 01  PC-PROGRAM-CONSTANTS.                                        00240013
002500     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'POKCS033'.  00250013
002600     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'PO033A  '.  00260013
002700     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'POKM033 '.  00270013
002800     05  PC-APPL-MAP              PIC S9(04)  VALUE  +1           00280013
002900                                              COMP.               00290013
003000     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00300013
003100                                              COMP.               00310013
003200     05  PC-INIT-DATE             PIC  X(10)  VALUE '0001-01-01'. 00320013
003300     05  PC-TSYMSG-NUMBERS.                                       00330013
003400         10  PC-TSYMSG-00083      PIC  9(05)  VALUE  00083.       00340013
003500         10  PC-TSYMSG-00521      PIC  9(05)  VALUE  00521.       00350013
003600     05  PC-Y                     PIC  X(01)  VALUE 'Y'.          00360013
003700*                                                                 00370013
003800 01  PS-PROGRAM-SWITCHES.                                         00380013
003900     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         00390013
004000         88  PS-ERROR                         VALUE  'Y'.         00400013
004100         88  PS-NO-ERROR                      VALUE  'N'.         00410013
004200*                                                                 00420013
004300 01  PV-PROGRAM-VARIABLES.                                        00430013
004400     05  PV-COUNT                     PIC  S9(9) COMP.            00440013
004500     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            00450013
004600                                              COMP SYNC.          00460013
004700     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            00470013
004800                                              COMP SYNC.          00480013
004900     05  PV-CNTRY-CDE             PIC  X(03)  VALUE SPACES.       00490013
005000     05  PV-QTA-CTG               PIC  X(05)  VALUE SPACES.       00500013
005100     05  PV-DATE-BREAK.                                           00510013
005200         10  FILLER               PIC  X(02).                     00520013
005300         10  PV-DB-YY             PIC  X(02).                     00530013
005400         10  FILLER               PIC  X(01).                     00540013
005500         10  PV-DB-MM             PIC  X(02).                     00550013
005600         10  FILLER               PIC  X(01).                     00560013
005700         10  PV-DB-DD             PIC  X(02).                     00570013
005800     05  PV-DATE-DISPLAY.                                         00580013
005900         10  PV-DD-MM             PIC  X(02).                     00590013
006000         10  FILLER               PIC  X(01) VALUE '/'.           00600013
006100         10  PV-DD-DD             PIC  X(02).                     00610013
006200         10  FILLER               PIC  X(01) VALUE '/'.           00620013
006300         10  PV-DD-YY             PIC  X(02).                     00630013
006400     05  PV-PO-LNE-NBR                PIC  S9(9) COMP.            00640013
006500     05  PV-PO-LINE-NBR-NULL          PIC S9(04) VALUE +0         00650013
006600                                                 COMP.            00660013
W24803     05  PV-ITEM-NBR                  PIC  9(15).                         
W24803     05  PV-TKT-TYP-DESC              PIC  X(20).                         
W24803*                                                                         
006900     COPY POWS72A.                                                00690013
007000                                                                  00700013
007100     EJECT                                                        00710013
007200*----------------------------------------------------------------*00720013
007300*    MAP LAYOUT                                                  *00730013
007400*----------------------------------------------------------------*00740013
007500                                                                  00750013
007600     COPY POKM033.                                                00760013
007700                                                                  00770013
007800 EJECT                                                            00780013
007900*----------------------------------------------------------------*00790013
008000*    ATTRIBUTE SETTINGS COPYBOOK.                                *00800013
008100*----------------------------------------------------------------*00810013
008200                                                                  00820013
008300     COPY DPWS015.                                                00830013
008400                                                                  00840013
008500*----------------------------------------------------------------*00850013
008600*    FUNCTION KEYS COPYBOOK                                      *00860013
008700*----------------------------------------------------------------*00870013
008800                                                                  00880013
008900     COPY DPWS016.                                                00890013
009000                                                                  00900013
009100 EJECT                                                            00910013
009200**--------------------------------------------------------------**00920013
009300** NUMERIC EDIT LAYOUT (DPKUT100)                               **00930013
009400**--------------------------------------------------------------**00940013
009500     COPY DPWS010I.                                               00950013
009600 EJECT                                                            00960013
009700**--------------------------------------------------------------**00970013
CICS  * PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.             **00980013
009900**--------------------------------------------------------------**00990013
010000     COPY DPWS030.                                                01000013
CICS       COPY DPWS930.                                                01000013
010100 EJECT                                                            01010013
010200**--------------------------------------------------------------**01020013
010300*    STANDARD COMMAREA.                                           01030013
010400**--------------------------------------------------------------**01040013
010500                                                                  01050013
010600     COPY DPWS020.                                                01060013
010700     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01070013
010800                                                                  01080013
010900***************************************************************** 01090013
011000*    INTER-APPLICATION COMMAREA.                                  01100013
011100***************************************************************** 01110013
011200                                                                  01120013
011300         10  INTER-APPL-COMM-AREA PIC X(200).                     01130013
011400     COPY POWS011.                                                01140013
011500             15  PO-PROD-CNTRY-CDE        PIC X(03).                      
011600     COPY POWS017.                                                01150013
011700***************************************************************** 01160013
011800*    SPECIFIC COMMMAREA FOR POKCS033.                             01170013
011900***************************************************************** 01180013
012000         10  ASC-SPECIFIC-COMMAREA.                               01190013
012100             15  ASC-PO-NBR                PIC S9(09)  COMP.      01200013
012200             15  ASC-DPT-NBR               PIC  X(03).            01210013
012300             15  ASC-ENT-NAME-DESC         PIC  X(30).            01220013
012400             15  ASC-IMPRT-AGNT-PO-NBR     PIC  X(08).            01230013
012500             15  ASC-IMPRT-AGNT-PO-NBR-N   REDEFINES              01240013
012600                 ASC-IMPRT-AGNT-PO-NBR     PIC  9(08).            01250013
012700             15  ASC-OFFICE-OF-PLACEMENT   PIC  X(03).            01260013
012800             15  ASC-OFFICE-OF-PLCMNT-DESC PIC  X(30).            01270013
012900             15  ASC-PARENT                PIC  X(35).            01280013
013000             15  ASC-FACTORY-NAME          PIC  X(35).            01290013
013100             15  ASC-COUNTRY-OF-PRODUCTION PIC  X(03).            01300013
013200             15  ASC-COUNTRY-OF-PROD-DESC  PIC  X(30).            01310013
013300             15  ASC-QTA-CTG               PIC  X(05).            01320013
013400             15  ASC-QTA-CTG-DESC          PIC  X(40).            01330013
013500             15  ASC-FREE-ON-BOARD-CODE    PIC  X(03).            01340013
013600             15  ASC-FREE-ON-BOARD-CITY    PIC  X(30).            01350013
013700             15  ASC-FREE-ON-BOARD-COUNTRY PIC  X(03).            01360013
013800             15  ASC-PORT-OF-ENTRY-CODE    PIC  X(03).            01370013
013900             15  ASC-PORT-OF-ENTRY-CITY    PIC  X(30).            01380013
014000             15  ASC-PORT-OF-ENTRY-STATE   PIC  X(02).            01390013
014100             15  ASC-UNITS-PER-CUBIC-METERS                       01400013
014200                                           PIC  9(06).            01410013
014300             15  ASC-UNITS-PER-CUBIC-METERS-X REDEFINES           01420013
014400                 ASC-UNITS-PER-CUBIC-METERS                       01430013
014500                                           PIC  X(06).            01440013
014600             15  ASC-HANG-TAG-ID           PIC  X(09).            01450013
014700             15  ASC-HANG-TAG-DESC         PIC  X(20).            01460013
014800             15  ASC-LAST-FCTRY-DTE        PIC  X(08).            01470013
014900             15  ASC-LAST-FCTRY-DTE-ISO    PIC  X(10).            01480013
015000             15  ASC-STRT-FCTRY-DTE        PIC  X(08).            01490013
015100             15  ASC-STRT-FCTRY-DTE-ISO    PIC  X(10).            01500013
015200             15  ASC-TRIP-STRT-DTE         PIC  X(08).            01510013
015300             15  ASC-TRIP-STRT-DTE-ISO     PIC  X(10).            01520013
015400             15  ASC-ELC-DTE               PIC  X(08).            01530013
015500             15  ASC-ELC-DTE-ISO           PIC  X(10).            01540013
W24803         10  FILLER                        PIC  X(2461).                  
015600     EJECT                                                        01550013
015700*----------------------------------------------------------------*01560013
015800*    ABEND PROCESSING COPYBOOK.                                  *01570013
015900*----------------------------------------------------------------*01580013
016000                                                                  01590013
016100     COPY DPWS013.                                                01600013
016200                                                                  01610013
016300 EJECT                                                            01620013
016400                                                                  01630013
016500*----------------------------------------------------------------*01640013
016600*    DPWS038 IS THE COPYBOOK WORKAREA FOR DPPD030.               *01650013
016700*----------------------------------------------------------------*01660013
016800*    COPY DPWS038.                                                01670013
016900*EJECT                                                            01680013
017000                                                                  01690013
017100*----------------------------------------------------------------*01700013
017200*    DB2 AREA FOR QOUTA CATEGORY CODE                            *01710013
017300*----------------------------------------------------------------*01720013
017400     EXEC SQL                                                     01730013
017500          INCLUDE TQTACTG                                         01740013
017600     END-EXEC.                                                    01750013
017700*----------------------------------------------------------------*01760013
017800*    DB2 AREA FOR PURCHASE ORDER                                 *01770013
017900*----------------------------------------------------------------*01780013
018000     EXEC SQL                                                     01790013
018100          INCLUDE TPURCHS                                         01800013
018200     END-EXEC.                                                    01810013
018300*----------------------------------------------------------------*01820013
018400*    DB2 AREA FOR TRIP START DATE AND ELC LOAD DATE              *01830013
018500*----------------------------------------------------------------*01840013
018600     EXEC SQL                                                     01850013
018700          INCLUDE TELCPO                                          01860013
018800     END-EXEC.                                                    01870013
018900*----------------------------------------------------------------*01880013
019000*    DB2 AREA FOR ENTERPRISE NAME                                *01890013
019100*----------------------------------------------------------------*01900013
019200     EXEC SQL                                                     01910013
019300          INCLUDE TENTNME                                         01920013
019400     END-EXEC.                                                    01930013
019500*----------------------------------------------------------------*01940013
019600*    DB2 AREA FOR PLANNED SHIPMENTS                              *01950013
019700*----------------------------------------------------------------*01960013
019800     EXEC SQL                                                     01970013
019900          INCLUDE TPLNSHP                                         01980013
020000     END-EXEC.                                                    01990013
020100*----------------------------------------------------------------*02000013
020200*    DB2 AREA FOR THE COUNTRY TABLE                              *02010013
020300*----------------------------------------------------------------*02020013
020400     EXEC SQL                                                     02030013
020500          INCLUDE TCNTRY                                          02040013
020600     END-EXEC.                                                    02050013
020700*----------------------------------------------------------------*02060013
020800*    DB2 AREA FOR THE PORT OF ENTRY TABLE                        *02070013
020900*----------------------------------------------------------------*02080013
021000     EXEC SQL                                                     02090013
021100          INCLUDE TIMPOE                                          02100013
021200     END-EXEC.                                                    02110013
021300*----------------------------------------------------------------*02120013
021400*    DB2 AREA FOR THE FREE ON BOARD TABLE                        *02130013
021500*----------------------------------------------------------------*02140013
021600     EXEC SQL                                                     02150013
021700          INCLUDE TIMFOB                                          02160013
021800     END-EXEC.                                                    02170013
021900     EXEC SQL                                                     02180013
W24803          INCLUDE XLT00003                                                
022100     END-EXEC.                                                    02200013
022200     EXEC SQL                                                     02210013
W24803          INCLUDE XLT00004                                                
022400     END-EXEC.                                                    02230013
022500     EXEC SQL                                                     02240013
W24803          INCLUDE XLT00006                                                
022700     END-EXEC.                                                    02260013
022800     EXEC SQL                                                     02270013
022900          INCLUDE TPURITM                                         02280013
023000     END-EXEC.                                                    02290013
023100     EXEC SQL                                                     02300013
023200          INCLUDE TVNDSTL                                         02310013
023300     END-EXEC.                                                    02320013
023400     EXEC SQL                                                     02330013
023500          INCLUDE TMDSEAR                                         02340013
023600     END-EXEC.                                                    02350013
024300     EXEC SQL                                                     02420013
024400          INCLUDE TTKTFMT                                         02430013
024500     END-EXEC.                                                    02440013
024600*----------------------------------------------------------------*02450013
024700*    DB2 AREA FOR COMMUNICATIONS                                 *02460013
024800*----------------------------------------------------------------*02470013
024900     EXEC SQL                                                     02480013
025000          INCLUDE SQLCA                                           02490013
025100     END-EXEC.                                                    02500013
025200                                                                  02510013
025300     EXEC SQL                                                     02520013
025400       DECLARE LINES-CSR CURSOR                                   02530013
W24803          FOR SELECT  ITM_NBR                                             
025800         ,PO_LNE_NBR                                              02570013
025900       FROM TPURITM                                               02580013
W24803       WHERE PO_NBR = :PURITM-PO-NBR                                      
026100          AND VER_STATUS_CDE = 'A'                                02600013
026200          AND NOT STATUS_CDE IN ('CA','CB')                       02610013
026300          ORDER BY PO_LNE_NBR                                     02620013
026400          FOR FETCH ONLY                                          02630013
026500     END-EXEC.                                                    02640013
026600                                                                  02650013
026700 EJECT                                                            02660013
026800*---------------------------------------------------------------* 02670013
026900*    CURSOR DECLARATION FOR SELECTING POE CODE CITY AND STATE   * 02680013
027000*---------------------------------------------------------------* 02690013
027100                                                                  02700013
027200     EXEC SQL                                                     02710013
027300          DECLARE  POE-CSR CURSOR                                 02720013
027400              FOR  SELECT DISTINCT                                02730013
027500                   A.POE_CTY_NM,                                  02740013
027600                   A.POE_ST_CDE,                                  02750013
027700                   A.STAT_CDE                                     02760013
027800             FROM  TIMPOE  A                                      02770013
027900            WHERE  A.POE_CDE           = :ASC-PORT-OF-ENTRY-CODE  02780013
028000              AND  A.PO_ASGMT_ALWD_IND = :PC-Y                    02790013
028100     END-EXEC.                                                    02800013
028200                                                                  02810013
028300 EJECT                                                            02820013
028400*---------------------------------------------------------------* 02830013
028500*    CURSOR DECLARATION FOR SELECTING QTA-CTG DESCRIPTION.      * 02840013
028600*---------------------------------------------------------------* 02850013
028700                                                                  02860013
028800         EXEC SQL                                                 02870013
028900          DECLARE  QTA-CSR CURSOR                                 02880013
029000              FOR SELECT QTA_CTG_DESC                             02890013
029100              FROM  TQTACTG                                       02900013
029200              WHERE  QTA_CTG_CDE    = :PV-QTA-CTG                 02910013
029300                AND  STAT_CDE       = 'A'                         02920013
029400         END-EXEC.                                                02930013
029500 EJECT                                                            02940013
029600 LINKAGE SECTION.                                                 02950013
029700                                                                  02960013
029800 01  DFHCOMMAREA.                                                 02970013
029900     05  FILLER                         OCCURS  1 TO 4072 TIMES   02980013
030000                                        DEPENDING ON EIBCALEN.    02990013
030100         10  FILLER                     PIC X.                    03000013
030200                                                                  03010013
030300                                                                  03020013
030400 PROCEDURE DIVISION.                                              03030013
030500***************************************************************** 03040013
030600** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 03050013
030700** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 03060013
030800** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 03070013
030900**                                                             ** 03080013
031000** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 03090013
031100** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 03100013
031200***************************************************************** 03110013
031300 0000-MAIN-MODULE.                                                03120013
031400     INITIALIZE DP030-CICS-API-FIELDS.                            03130013
031500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03140013
031600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03150013
031700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03160013
031800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03170013
031900     MOVE LENGTH OF PO033AI        TO DP030-MAP-LENGTH (1).       03180013
032000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03190013
032100     PERFORM 0001-CALL-CICS-ARCH-API.                             03200013
032200*                                                                 03210013
032300*    PERFORM DP038-0000-SET-DB2-PKG.                              03220013
032400*                                                                 03230013
032500     PERFORM 1000-CONTROL-PROCESSING                              03240013
032600*                                                                 03250013
032700     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03260013
032800     PERFORM 0001-CALL-CICS-ARCH-API.                             03270013
032900                                                                  03280013
033000 0001-CALL-CICS-ARCH-API.                                         03290013
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03300013
033200                                    DFHCOMMAREA                   03310013
033300                                    DP030-CICS-API-FIELDS         03320013
033400                                    DP020-STANDARD-COMMAREA       03330013
033500                                    PO033AI.                      03340013
033600*                                                                 03350013
033700     IF  DP030-RC-CALL-SUCCESSFUL                                 03360013
033800         CONTINUE                                                 03370013
033900     ELSE                                                         03380013
034000         SET DP013-NO-ROLLBACK                                    03390013
034100             DP013-XCTL-DISPLAY-RESTART                           03400013
034200             DP013-CICS-ABEND      TO TRUE                        03410013
CICS           MOVE '0001-CALL-CICS-ARCH-API'                           03420013
034400                                   TO DP013-PARAGRAPH             03430013
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03440013
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03450013
034700         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      03460013
034800         PERFORM DP013-0000-PROCESS-ABEND                         03470013
034900     END-IF.                                                      03480013
035000 EJECT                                                            03490013
035100*----------------------------------------------------------------*03500013
035200*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03510013
035300*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *03520013
035400*----------------------------------------------------------------*03530013
035500                                                                  03540013
035600 1000-CONTROL-PROCESSING.                                         03550013
035700                                                                  03560013
035800     EVALUATE TRUE                                                03570013
035900         WHEN DP020-NEXT-ACT-INITIAL                              03580013
036000             PERFORM 1100-FIND-OBJECT-KEYS                        03590013
036100             IF  PS-ERROR                                         03600013
036200                 CONTINUE                                         03610013
036300             ELSE                                                 03620013
036400                 PERFORM 4000-BUILD-INITIAL-PANEL                 03630013
036500             END-IF                                               03640013
036600                                                                  03650013
036700         WHEN DP020-NEXT-ACT-READ-MAP                             03660013
036800             PERFORM 2000-PROCESS-PANEL                           03670013
036900                                                                  03680013
037000         WHEN DP020-NEXT-ACT-RETURN                               03690000
037100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03700000
037200                                                                  03710000
037300         WHEN OTHER                                               03720013
037400             SET DP013-LOGIC-ABEND TO TRUE                        03730013
037500             SET DP013-NO-ROLLBACK TO TRUE                        03740013
037600             MOVE '1000-CONTROL-PROCESSING'                       03750013
037700                                   TO DP013-PARAGRAPH             03760013
037800             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   03770013
037900                                   TO DP013-MESSAGE-TEXT(1)       03780013
038000             MOVE DP020-NEXT-APPL-ACTIVITY                        03790013
038100                                   TO DP013-MESSAGE-TEXT(2)       03800013
038200             PERFORM DP013-0000-PROCESS-ABEND                     03810013
038300     END-EVALUATE.                                                03820013
038400******************************************************************03830013
038500** DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE   **03840013
038600** INTER-APPLICATION FORMAT CODE.                               **03850013
038700******************************************************************03860013
038800 1100-FIND-OBJECT-KEYS.                                           03870013
038900     INITIALIZE ASC-SPECIFIC-COMMAREA.                            03880013
039000     IF  DP020-NAV-KEY-DATA > SPACE                               03890013
039100         MOVE DP020-NAV-KEY-DATA   TO ASC-PO-NBR                  03900013
039200     ELSE                                                         03910013
039300         MOVE PO017-PO-NBR         TO ASC-PO-NBR.                 03920013
039400 EJECT                                                            03930013
039500*----------------------------------------------------------------*03940013
039600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *03950013
039700* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *03960013
039800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *03970013
039900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *03980013
040000* FUNCTION KEYS CAN GET THIS FAR.                                *03990013
040100*----------------------------------------------------------------*04000013
040200                                                                  04010013
040300 2000-PROCESS-PANEL.                                              04020013
040400                                                                  04030013
040500     EVALUATE TRUE                                                04040013
040600                                                                  04050013
040700         WHEN DP020-SRC-AID = DP016-CLEAR                         04060013
040800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04070013
040900                                                                  04080013
041000         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     04090013
041100             SET DP030-DONT-ERASE                                 04100013
041200                 DP030-SEND-DATAONLY (PC-APPL-MAP)                04110013
041300                                   TO TRUE                        04120013
041400             PERFORM 4000-BUILD-INITIAL-PANEL                     04130013
041500                                                                  04140013
041600         WHEN OTHER                                               04330013
041700             PERFORM 2100-CHECK-FUNCTION-KEY                      04340013
041800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04350013
041900     END-EVALUATE.                                                04360013
042000*----------------------------------------------------------------*04370013
042100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *04380013
042200* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *04390013
042300* FROM THE CICS ARCHITECTURE API.                                *04400013
042400*----------------------------------------------------------------*04410013
042500                                                                  04420013
042600 2100-CHECK-FUNCTION-KEY.                                         04430013
042700     EVALUATE TRUE                                                04440013
042800         WHEN DP020-SRC-AID = DP016-ENTER                         04450013
042900             CONTINUE                                             04460013
043000                                                                          
043100         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              04470013
043200             MOVE ASC-PO-NBR       TO PO011-PO-NBR                04480013
043300             MOVE ASC-DPT-NBR      TO PO011-DEPT-NBR              04490013
043400             MOVE ASC-ENT-NAME-DESC                               04500013
043500                                   TO PO011-VENDOR-NAME           04510013
043600             SET DP030-CONTINUE-GO TO TRUE                        04520013
043700                                                                          
043800         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              04150013
043900                  MOVE PV-CNTRY-CDE  TO                           04180013
044000                          PO-PROD-CNTRY-CDE                       04190013
044100                          ASC-COUNTRY-OF-PRODUCTION               04200013
044200                                                                  04320013
044300         WHEN OTHER                                               04530013
044400             SET DP013-NO-ROLLBACK                                04540013
044500                 DP013-XCTL-DISPLAY-RESTART                       04550013
044600                 DP013-CICS-ABEND  TO TRUE                        04560013
044700             MOVE '2100-CHECK-FUNCTION-KEY'                       04570013
044800                                   TO DP013-PARAGRAPH             04580013
044900             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      04590013
045000                                   TO DP013-MESSAGE-TEXT (1)      04600013
045100             PERFORM DP013-0000-PROCESS-ABEND                     04610013
045200     END-EVALUATE.                                                04620013
045300*----------------------------------------------------------------*05710013
045400*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *05720013
045500*    ENTRY.                                                      *05730013
045600*----------------------------------------------------------------*05740013
045700                                                                  05750013
045800 4000-BUILD-INITIAL-PANEL.                                        05760013
045900     PERFORM 4100-GET-IMPORT.                                     05770013
046000     IF SQLCODE = +100                                            05780013
046100         SET DP020-NEXT-ACT-APPL-ERROR                            05790013
046200                                   TO TRUE                        05800013
046300         MOVE PC-TSYMSG-00083      TO DP020-MSG-NUMBER            05810013
046400         SET DP020-MSG-INFORMATIONAL                              05820013
046500                                   TO TRUE                        05830013
046600     ELSE                                                         05840013
046700         IF PURCHS-PO-TYP-CDE = ('IM' OR 'IE' OR 'IF')            05850013
046800             IF PURCHS-TKT-FMT-NBR > SPACES                       05860013
046900               MOVE PURCHS-TKT-FMT-NBR TO ASC-HANG-TAG-ID         05870013
047000               MOVE PURCHS-TKT-FMT-DESC TO ASC-HANG-TAG-DESC      05880013
047100             ELSE                                                 05890013
047200                MOVE ASC-PO-NBR TO DK-PO-NBR                      05900013
047300                MOVE PURCHS-DEPT-NBR TO PV-POWS72A-DEPT           05910013
047400                MOVE 0 TO PV-COUNT                                05920013
047500                PERFORM POWS072-VERIFY-HANG-TAGS                  05930013
047600                IF PV-COUNT > 1                                   05940013
047700                  MOVE 'MULTIPLE'                                 05950013
047800                         TO   ASC-HANG-TAG-DESC                   05960013
047900                              ASC-HANG-TAG-ID                     05970013
048000                ELSE                                              05980013
048100                  PERFORM 4010-OPEN-CURSOR                        05990013
048200                  PERFORM 4310-FETCH                              06000013
048300                  PERFORM 4020-CLOSE-CURSOR                       06010013
048400* GET HANG TAG OF THE FIRST NON CANCELLED SKU ON THE ORDER        06020013
048500                  IF NOT PV-EXEMPT-DEPT                           06030013
048600                       PERFORM 4200-GET-HANG-TAG                  06040013
048700                  END-IF                                          06050013
048800                END-IF                                            06060013
048900             END-IF                                               06070013
049000             PERFORM 4300-GET-ELC-TMST                            06080013
049100             MOVE ELCPO-TRIP-STRT-DTE  TO ASC-TRIP-STRT-DTE-ISO   06090013
049200             MOVE ELCPO-CRE-TMST(1:10) TO ASC-ELC-DTE-ISO         06100013
049300             MOVE PURCHS-DEPT-NBR  TO ASC-DPT-NBR                 06110013
049400             MOVE PURCHS-IMPRT-AGNT-PO-NBR                        06120013
049500                                   TO ASC-IMPRT-AGNT-PO-NBR-N     06130013
049600             MOVE PURCHS-PLCMNT-CNTRY-CDE                         06140013
049700                                   TO ASC-OFFICE-OF-PLACEMENT     06150013
049800                                      PV-CNTRY-CDE                06160013
049900             IF PV-CNTRY-CDE > SPACES                             06170013
050000                 PERFORM 4500-SELECT-COUNTRY                      06180013
050100                 MOVE CNTRY-CNTRY-NM  TO ASC-OFFICE-OF-PLCMNT-DESC06190013
050200             ELSE                                                 06200013
050300                 MOVE PURCHS-IMPRT-ORD-OFF-NAME                   06210013
050400                                      TO ASC-OFFICE-OF-PLCMNT-DESC06220013
050500             END-IF                                               06230013
050600             MOVE PURCHS-IMPRT-VEND-NAME                          06240013
050700                                   TO ASC-PARENT                  06250013
050800             MOVE PURCHS-IMPRT-FCTRY-NAME                         06260013
050900                                   TO ASC-FACTORY-NAME            06270013
051000             MOVE PURCHS-PROD-CNTRY-CDE                           06280013
051100                                   TO ASC-COUNTRY-OF-PRODUCTION   06290013
051200                                      PV-CNTRY-CDE                06300013
051300             IF PV-CNTRY-CDE > SPACES                             06310013
051400                 PERFORM 4500-SELECT-COUNTRY                      06320013
051500                 MOVE CNTRY-CNTRY-NM   TO ASC-COUNTRY-OF-PROD-DESC06330013
051600             ELSE                                                 06340013
051700                 MOVE PURCHS-IMPRT-CNTRY-NAME                     06350013
051800                                       TO ASC-COUNTRY-OF-PROD-DESC06360013
051900             END-IF                                               06370013
052000                                                                  06380013
052100             MOVE PURCHS-QTA-CTG-CDE                              06390013
052200                                   TO ASC-QTA-CTG                 06400013
052300                                      PV-QTA-CTG                  06410013
052400             IF PV-QTA-CTG > SPACES                               06420013
052500                 PERFORM 4810-SELECT-QUOTA-CATEGORY               06430013
052600                 MOVE QTACTG-QTA-CTG-DESC TO ASC-QTA-CTG-DESC     06440013
052700             END-IF                                               06450013
052800                                                                  06460013
052900             MOVE PLNSHP-FOB-CDE   TO ASC-FREE-ON-BOARD-CODE      06470013
053000             IF ASC-FREE-ON-BOARD-CODE > SPACES                   06480013
053100                 PERFORM 4600-SELECT-FOB                          06490013
053200                 MOVE IMFOB-FOB-CTY-NM TO ASC-FREE-ON-BOARD-CITY  06500013
053300                 MOVE IMFOB-FOB-CNTRY-CDE                         06510013
053400                                   TO ASC-FREE-ON-BOARD-COUNTRY   06520013
053500             ELSE                                                 06530013
053600                 MOVE PLNSHP-FOB-POINT-TXT                        06540013
053700                                       TO ASC-FREE-ON-BOARD-CITY  06550013
053800                 MOVE SPACES       TO ASC-FREE-ON-BOARD-COUNTRY   06560013
053900             END-IF                                               06570013
054000             MOVE PLNSHP-POE-CDE   TO ASC-PORT-OF-ENTRY-CODE      06580013
054100             IF ASC-PORT-OF-ENTRY-CODE > SPACES                   06590013
054200                 PERFORM 4700-OPEN-POE-CURSOR                     06600013
054300                 PERFORM 4720-FETCH-POE-CURSOR                    06610013
054400                 PERFORM 4710-CLOSE-POE-CURSOR                    06620013
054500                 MOVE IMPOE-POE-CTY-NM TO ASC-PORT-OF-ENTRY-CITY  06630013
054600                 MOVE IMPOE-POE-ST-CDE TO ASC-PORT-OF-ENTRY-STATE 06640013
054700             ELSE                                                 06650013
054800                 MOVE PLNSHP-PORT-ENTR-DESC                       06660013
054900                                       TO ASC-PORT-OF-ENTRY-CITY  06670013
055000                 MOVE IMPOE-POE-ST-CDE TO ASC-PORT-OF-ENTRY-STATE 06680013
055100             END-IF                                               06690013
055200             MOVE PURCHS-UNT-PER-CBMT-QTY                         06700013
055300                                   TO ASC-UNITS-PER-CUBIC-METERS  06710013
055400             MOVE ENTNME-ENT-NAME-DESC                            06720013
055500                                   TO ASC-ENT-NAME-DESC           06730013
055600             MOVE PLNSHP-STRT-FCTRY-DTE                           06740013
055700                                   TO ASC-STRT-FCTRY-DTE-ISO      06750013
055800             MOVE PLNSHP-LAST-FCTRY-DTE                           06760013
055900                                   TO ASC-LAST-FCTRY-DTE-ISO      06770013
056000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06780013
056100         ELSE                                                     06790013
056200             SET DP020-NEXT-ACT-APPL-ERROR                        06800013
056300                                   TO TRUE                        06810013
056400*            --- PURCHASE ORDER TYPE MUST BE IMPORT ---           06820013
056500             MOVE PC-TSYMSG-00521  TO DP020-MSG-NUMBER            06830013
056600             SET DP020-MSG-INFORMATIONAL                          06840013
056700                                   TO TRUE                        06850013
056800         END-IF                                                   06860013
056900     END-IF.                                                      06870013
057000                                                                  06880013
057100*----------------------------------------------------------------*06890013
057200* OPEN THE LINES-CSR CURSOR.                                     *06900013
057300*----------------------------------------------------------------*06910013
057400                                                                  06920013
057500 4010-OPEN-CURSOR.                                                06930013
W24803     MOVE ASC-PO-NBR TO PURITM-PO-NBR                                     
057600     PERFORM                                                      06940013
057700         WITH TEST AFTER                                          06950013
057800         VARYING PV-RETRY-COUNTER                                 06960013
057900         FROM 1 BY 1                                              06970013
058000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06980013
058100                   OR (SQLCODE = ZERO))                           06990013
058200                                                                  07000013
058300              EXEC SQL                                            07010013
058400                 OPEN LINES-CSR                                   07020013
058500              END-EXEC                                            07030013
058600                                                                  07040013
058700         EVALUATE TRUE                                            07050013
058800             WHEN SQLCODE = ZERO                                  07060013
058900             WHEN SQLCODE = -904                                  07070013
059000             WHEN SQLCODE = -913                                  07080013
059100                 CONTINUE                                         07090013
059200             WHEN SQLWARN0 NOT = SPACES                           07100013
059300             WHEN SQLCODE < ZERO                                  07110013
059400             WHEN SQLCODE > ZERO                                  07120013
059500                 MOVE '4010-OPEN-CURSOR'                          07130013
059600                                   TO DP013-PARAGRAPH             07140013
059700                 MOVE 'OPEN LINES-CSR CURSOR - '                  07150013
059800                                   TO DP013-MESSAGE-TEXT (1)      07160013
059900                 MOVE SQLCA        TO DP013-SQLCA                 07170013
060000                 MOVE 'TPURITM '   TO DP013-DB2-TABLE-NAME (1)    07180013
060100                 SET DP013-DB2-ABEND                              07190013
060200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           07200013
060300                 PERFORM DP013-0000-PROCESS-ABEND                 07210013
060400         END-EVALUATE                                             07220013
060500     END-PERFORM.                                                 07230013
060600*                                                                 07240013
060700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07250013
060800         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             07260013
060900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   07270013
061000                                   TO DP013-MESSAGE-TEXT (1)      07280013
061100         MOVE SQLCA                TO DP013-SQLCA                 07290013
061200         MOVE 'TPURITM '           TO DP013-DB2-TABLE-NAME (1)    07300013
061300         SET DP013-DB2-ABEND                                      07310013
061400             DP013-XCTL-DISPLAY-RESTART                           07320013
061500                                   TO TRUE                        07330013
061600         PERFORM DP013-0000-PROCESS-ABEND                         07340013
061700     END-IF.                                                      07350013
061800                                                                  07360013
061900 EJECT                                                            07370013
062000*----------------------------------------------------------------*07380013
062100* CLOSE THE LINES-CSR CURSOR.                                    *07390013
062200*----------------------------------------------------------------*07400013
062300                                                                  07410013
062400 4020-CLOSE-CURSOR.                                               07420013
062500*                                                                 07430013
062600     EXEC SQL                                                     07440013
062700         CLOSE LINES-CSR                                          07450013
062800     END-EXEC                                                     07460013
062900                                                                  07470013
063000     EVALUATE TRUE                                                07480013
063100         WHEN SQLCODE = ZERO                                      07490013
063200             CONTINUE                                             07500013
063300         WHEN SQLWARN0 NOT = SPACES                               07510013
063400         WHEN SQLCODE < ZERO                                      07520013
063500         WHEN SQLCODE > ZERO                                      07530013
063600             MOVE '4020-CLOSE-CURSOR'                             07540013
063700                               TO DP013-PARAGRAPH                 07550013
063800             MOVE 'CLOSE LINES-CSR CURSOR '                       07560013
063900                               TO DP013-MESSAGE-TEXT (1)          07570013
064000             MOVE SQLCA        TO DP013-SQLCA                     07580013
064100             MOVE 'PURITM  '   TO DP013-DB2-TABLE-NAME (1)        07590013
064200             SET DP013-DB2-ABEND                                  07600013
064300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               07610013
064400             PERFORM DP013-0000-PROCESS-ABEND                     07620013
064500     END-EVALUATE.                                                07630013
064600  EJECT                                                           07640013
064700                                                                  07650013
064800*----------------------------------------------------------------*07660013
064900* GET IMPORT SCREEN FIELDS                                       *07670013
065000*----------------------------------------------------------------*07680013
065100                                                                  07690013
065200 4100-GET-IMPORT.                                                 07700013
065300     PERFORM                                                      07710013
065400         WITH TEST AFTER                                          07720013
065500         VARYING PV-RETRY-COUNTER                                 07730013
065600         FROM 1 BY 1                                              07740013
065700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07750013
065800             OR (SQLCODE = ZERO)                                  07760013
065900             OR (SQLCODE = +100))                                 07770013
066000             EXEC SQL                                             07780013
066100                 SELECT A.DEPT_NBR,                               07790013
066200                        A.PO_TYP_CDE,                             07800013
066300                        A.IMPRT_ORD_OFF_NAME,                     07810013
066400                        A.IMPRT_AGNT_PO_NBR,                      07820013
066500                        A.IMPRT_VEND_NAME,                        07830013
066600                        A.IMPRT_FCTRY_NAME,                       07840013
066700                        A.IMPRT_CNTRY_NAME,                       07850013
066800                        A.PLCMNT_CNTRY_CDE,                       07860013
066900                        A.PROD_CNTRY_CDE,                         07870013
067000                        A.QTA_CTG_CDE,                            07880013
067100                        A.UNT_PER_CBMT_QTY,                       07890013
067200                        B.ENT_NAME_DESC,                          07900013
067300                        C.FOB_POINT_TXT,                          07910013
067400                        C.PORT_ENTR_DESC,                         07920013
067500                        C.STRT_FCTRY_DTE,                         07930013
067600                        C.LAST_FCTRY_DTE,                         07940013
067700                        C.FOB_CDE,                                07950013
067800                        C.POE_CDE                                 07960013
067900                       ,A.TKT_FMT_NBR                             07970013
068000                       ,A.TKT_FMT_DESC                            07980013
068100                 INTO :PURCHS-DEPT-NBR,                           07990013
068200                      :PURCHS-PO-TYP-CDE,                         08000013
068300                      :PURCHS-IMPRT-ORD-OFF-NAME,                 08010013
068400                      :PURCHS-IMPRT-AGNT-PO-NBR,                  08020013
068500                      :PURCHS-IMPRT-VEND-NAME,                    08030013
068600                      :PURCHS-IMPRT-FCTRY-NAME,                   08040013
068700                      :PURCHS-IMPRT-CNTRY-NAME,                   08050013
068800                      :PURCHS-PLCMNT-CNTRY-CDE,                   08060013
068900                      :PURCHS-PROD-CNTRY-CDE,                     08070013
069000                      :PURCHS-QTA-CTG-CDE,                        08080013
069100                      :PURCHS-UNT-PER-CBMT-QTY,                   08090013
069200                      :ENTNME-ENT-NAME-DESC,                      08100013
069300                      :PLNSHP-FOB-POINT-TXT,                      08110013
069400                      :PLNSHP-PORT-ENTR-DESC,                     08120013
069500                      :PLNSHP-STRT-FCTRY-DTE,                     08130013
069600                      :PLNSHP-LAST-FCTRY-DTE,                     08140013
069700                      :PLNSHP-FOB-CDE,                            08150013
069800                      :PLNSHP-POE-CDE                             08160013
069900                      ,:PURCHS-TKT-FMT-NBR                        08170013
070000                      ,:PURCHS-TKT-FMT-DESC                       08180013
070100                 FROM TPURCHS A,                                  08190013
070200                      TENTNME B,                                  08200013
070300                      TPLNSHP C                                   08210013
070400                 WHERE A.PO_NBR = :ASC-PO-NBR                     08220013
070500                   AND A.VER_STATUS_CDE = 'A'                     08230013
070600                   AND B.ENT_ID = A.ENT_ID                        08240013
070700                   AND B.TYPE_CDE = '01'                          08250013
070800                   AND C.PO_NBR = A.PO_NBR                        08260013
070900                   AND C.VER_STATUS_CDE = A.VER_STATUS_CDE        08270013
071000             END-EXEC                                             08280013
071100         EVALUATE TRUE                                            08290013
071200             WHEN SQLCODE = ZERO                                  08300013
071300             WHEN SQLCODE = +100                                  08310013
071400             WHEN SQLCODE = -904                                  08320013
071500             WHEN SQLCODE = -913                                  08330013
071600                 CONTINUE                                         08340013
071700             WHEN SQLWARN0 NOT = SPACES                           08350013
071800             WHEN SQLCODE < ZERO                                  08360013
071900             WHEN SQLCODE > ZERO                                  08370013
072000                 MOVE '4100-GET-IMPORT'                           08380013
072100                                   TO DP013-PARAGRAPH             08390013
072200                 MOVE 'SQL ERROR SELECTING PO'                    08400013
072300                                   TO DP013-MESSAGE-TEXT (1)      08410013
072400                 MOVE SQLCA        TO DP013-SQLCA                 08420013
072500                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)    08430013
072600                 SET DP013-DB2-ABEND                              08440013
072700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           08450013
072800                 PERFORM DP013-0000-PROCESS-ABEND                 08460013
072900         END-EVALUATE                                             08470013
073000     END-PERFORM.                                                 08480013
073100*                                                                 08490013
073200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08500013
073300         MOVE '4100-GET-IMPORT'    TO DP013-PARAGRAPH             08510013
073400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  08520013
073500                                   TO DP013-MESSAGE-TEXT (1)      08530013
073600         MOVE SQLCA                TO DP013-SQLCA                 08540013
073700         MOVE 'TPURCHS '           TO DP013-DB2-TABLE-NAME (1)    08550013
073800         SET DP013-DB2-ABEND                                      08560013
073900             DP013-XCTL-DISPLAY-RESTART                           08570013
074000                                   TO TRUE                        08580013
074100         PERFORM DP013-0000-PROCESS-ABEND                         08590013
074200     END-IF.                                                      08600013
074300                                                                  08610013
074400*----------------------------------------------------------------*08620013
074500*    GET THE HANG TAG # AND DESCRIPTION                          *08630013
074600*----------------------------------------------------------------*08640013
074700 4200-GET-HANG-TAG.                                               08650013
074800                                                                  08660013
W24803     MOVE PURITM-ITM-NBR TO XLT00003-ITM-NBR                              
074900     PERFORM                                                      08670013
075000         WITH TEST AFTER                                          08680013
075100         VARYING PV-RETRY-COUNTER                                 08690013
075200         FROM 1 BY 1                                              08700013
075300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08710013
075400             OR (SQLCODE = ZERO)                                  08720013
075500             OR (SQLCODE = +100))                                 08730013
075600             EXEC SQL                                             08740013
075700                 SELECT DISTINCT                                  08750013
075800                        F.TKT_FMT_NBR                             08760013
075900                       ,F.TKT_FMT_DESC                            08770013
076000                 INTO  :TKTFMT-TKT-FMT-NBR                        08780013
076100                      ,:TKTFMT-TKT-FMT-DESC                       08790013
W24803                 FROM XLT_SKU A,                                          
W24803                      XLT_UPC B,                                          
W24803                      XLT_VND_STYL C,                                     
076700                      TTKTFMT F                                   08850013
W24803                 WHERE A.ITM_NBR = :XLT00003-ITM-NBR                      
W24803                   AND NOT A.SKU_STAT_CDE = '98'                          
W24803                   AND A.INTR_UPC_ID = B.INTR_UPC_ID                      
W24803                   AND B.UPC_TYP_CDE = 'I'                                
W24803                   AND A.STYL_ID = C.STYL_ID                              
W24803                   AND C.TKT_TYP_DESC = F.TKT_FMT_DESC                    
078100             END-EXEC                                             08990013
078200         EVALUATE TRUE                                            09000013
078300             WHEN SQLCODE = ZERO                                  09010013
078400               MOVE TKTFMT-TKT-FMT-NBR  TO ASC-HANG-TAG-ID        09020013
078500               MOVE TKTFMT-TKT-FMT-DESC TO ASC-HANG-TAG-DESC      09030013
078600             WHEN SQLCODE = -904                                  09040013
078700             WHEN SQLCODE = -913                                  09050013
078800                 CONTINUE                                         09060013
078900             WHEN SQLCODE = +100                                  09070013
079000               MOVE SPACES TO ASC-HANG-TAG-ID ASC-HANG-TAG-DESC   09080013
079100             WHEN SQLWARN0 NOT = SPACES                           09090013
079200             WHEN SQLCODE < ZERO                                  09100013
079300             WHEN SQLCODE > ZERO                                  09110013
079400                 MOVE '4200-GET-HANG-TAG'                         09120013
079500                                   TO DP013-PARAGRAPH             09130013
079600                 MOVE 'SQL ERROR SELECTING HANG TAG'              09140013
079700                                   TO DP013-MESSAGE-TEXT (1)      09150013
079800                 MOVE SQLCA        TO DP013-SQLCA                 09160013
079900                 MOVE 'TTKTFMT '   TO DP013-DB2-TABLE-NAME (1)    09170013
080000                 SET DP013-DB2-ABEND                              09180013
080100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09190013
080200                 PERFORM DP013-0000-PROCESS-ABEND                 09200013
080300         END-EVALUATE                                             09210013
080400     END-PERFORM.                                                 09220013
080500*                                                                 09230013
080600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09240013
080700         MOVE '4200-GET-HANG-TAG'  TO DP013-PARAGRAPH             09250013
080800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT HGTG'09260013
080900                                   TO DP013-MESSAGE-TEXT (1)      09270013
081000         MOVE SQLCA                TO DP013-SQLCA                 09280013
081100         MOVE 'TTKTFMT '           TO DP013-DB2-TABLE-NAME (1)    09290013
081200         SET DP013-DB2-ABEND                                      09300013
081300             DP013-XCTL-DISPLAY-RESTART                           09310013
081400                                   TO TRUE                        09320013
081500         PERFORM DP013-0000-PROCESS-ABEND                         09330013
081600     END-IF.                                                      09340013
081700                                                                  09350013
081800 4300-GET-ELC-TMST.                                               09360013
081900                                                                  09370013
082000     EXEC SQL                                                     09380013
082100        SELECT TRIP_STRT_DTE                                      09390013
082200              ,CRE_TMST                                           09400013
082300        INTO  :ELCPO-TRIP-STRT-DTE                                09410013
082400             ,:ELCPO-CRE-TMST                                     09420013
082500        FROM TELCPO                                               09430013
082600        WHERE PO_NBR = :DK-PO-NBR                                 09440013
082700     END-EXEC.                                                    09450013
082800     EVALUATE TRUE                                                09460013
082900        WHEN SQLCODE = ZERO                                       09470013
083000            CONTINUE                                              09480013
083100        WHEN SQLCODE = +100                                       09490013
083200            MOVE SPACES   TO ELCPO-TRIP-STRT-DTE                  09500013
083300                             ELCPO-CRE-TMST                       09510013
083400        WHEN OTHER                                                09520013
083500        MOVE '4300-GET-ELC-TMST'                                  09530013
083600                          TO DP013-PARAGRAPH                      09540013
083700        MOVE 'SQL ERROR SELECTING TRIP START AND ELC LOAD DATES'  09550013
083800                          TO DP013-MESSAGE-TEXT (1)               09560013
083900        MOVE SQLCA        TO DP013-SQLCA                          09570013
084000        MOVE 'TELCPO'     TO DP013-DB2-TABLE-NAME (1)             09580013
084100        SET DP013-DB2-ABEND                                       09590013
084200            DP013-XCTL-DISPLAY-RESTART TO TRUE                    09600013
084300        PERFORM DP013-0000-PROCESS-ABEND                          09610013
084400     END-EVALUATE.                                                09620013
084500                                                                  09630013
084600 EJECT                                                            09640013
084700                                                                  09650013
084800*----------------------------------------------------------------*09660013
084900*    FETCH THE LINES-CSR CURSOR.                                 *09670013
085000*----------------------------------------------------------------*09680013
085100                                                                  09690013
085200 4310-FETCH.                                                      09700013
085300     EXEC SQL                                                     09710013
085400        FETCH LINES-CSR                                           09720013
W24803          INTO  :PURITM-ITM-NBR                                           
085700               ,:PURITM-PO-LNE-NBR                                09750013
085800         END-EXEC.                                                09760013
085900     EVALUATE TRUE                                                09770013
086000         WHEN SQLCODE = ZERO                                      09780013
086100           CONTINUE                                               09790013
086200         WHEN SQLCODE = +100                                      09800013
W24803             INITIALIZE  PURITM-ITM-NBR PURITM-PO-LNE-NBR                 
086400         WHEN SQLWARN0 NOT = SPACE                                09820013
086500         WHEN SQLCODE NOT = ZERO                                  09830013
086600              MOVE '4310-FETCH-CURSOR'                            09840013
086700                               TO DP013-PARAGRAPH                 09850013
086800              MOVE 'FETCH LINES-CSR CURSOR'                       09860013
086900                               TO DP013-MESSAGE-TEXT (1)          09870013
087000              MOVE SQLCA       TO DP013-SQLCA                     09880013
087100              SET DP013-DB2-ABEND                                 09890013
087200                               TO TRUE                            09900013
087300              PERFORM DP013-0000-PROCESS-ABEND                    09910013
087400     END-EVALUATE.                                                09920013
087500  EJECT                                                           09930013
087600                                                                  09940013
087700*----------------------------------------------------------------*09950013
087800*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *09960013
087900*----------------------------------------------------------------*09970013
088000                                                                  09980013
088100 4400-MOVE-COMMAREA-TO-SCREEN.                                    09990013
088200     MOVE ASC-PO-NBR               TO APONUMO.                    10000013
088300     MOVE ASC-DPT-NBR              TO ADEPTO.                     10010013
088400     MOVE ASC-ENT-NAME-DESC        TO AVENDNMO.                   10020013
088500     MOVE ASC-OFFICE-OF-PLCMNT-DESC TO AOFPLACO.                  10030013
088600     MOVE ASC-PARENT               TO APARENTO.                   10040013
088700     MOVE ASC-FACTORY-NAME         TO AFACTNMO.                   10050013
088800     MOVE ASC-COUNTRY-OF-PROD-DESC TO ACOUNPRO.                   10060013
088900     MOVE ASC-QTA-CTG-DESC         TO AQTADSCO.                   10070013
089000     MOVE ASC-QTA-CTG              TO AQTACTGO.                   10080013
089100     MOVE ASC-FREE-ON-BOARD-CITY   TO AFOBO.                      10090013
089200     MOVE ASC-FREE-ON-BOARD-COUNTRY                               10100013
089300                                   TO AFOBCTYO.                   10110013
089400     MOVE ASC-PORT-OF-ENTRY-CITY   TO APORENTO.                   10120013
089500     MOVE ASC-PORT-OF-ENTRY-STATE  TO APENTSTO.                   10130013
089600     MOVE ASC-UNITS-PER-CUBIC-METERS                              10140013
089700                                   TO AUNTCBMO.                   10150013
089800     MOVE ASC-HANG-TAG-ID          TO ATAGIDO.                    10160013
089900     MOVE ASC-HANG-TAG-DESC        TO ATAGNBRO.                   10170013
090000     IF ASC-LAST-FCTRY-DTE-ISO = PC-INIT-DATE                     10180013
090100         MOVE SPACES               TO ASC-LAST-FCTRY-DTE          10190013
090200     ELSE                                                         10200013
090300         MOVE ASC-LAST-FCTRY-DTE-ISO                              10210013
090400                                   TO PV-DATE-BREAK               10220013
090500         MOVE PV-DB-MM             TO PV-DD-MM                    10230013
090600         MOVE PV-DB-DD             TO PV-DD-DD                    10240013
090700         MOVE PV-DB-YY             TO PV-DD-YY                    10250013
090800         MOVE PV-DATE-DISPLAY      TO ASC-LAST-FCTRY-DTE          10260013
090900     END-IF.                                                      10270013
091000     MOVE ASC-LAST-FCTRY-DTE       TO ALASEXTO.                   10280013
091100     IF ASC-STRT-FCTRY-DTE-ISO = PC-INIT-DATE                     10290013
091200         MOVE SPACES               TO ASC-STRT-FCTRY-DTE          10300013
091300     ELSE                                                         10310013
091400         MOVE ASC-STRT-FCTRY-DTE-ISO                              10320013
091500                                   TO PV-DATE-BREAK               10330013
091600         MOVE PV-DB-MM             TO PV-DD-MM                    10340013
091700         MOVE PV-DB-DD             TO PV-DD-DD                    10350013
091800         MOVE PV-DB-YY             TO PV-DD-YY                    10360013
091900         MOVE PV-DATE-DISPLAY      TO ASC-STRT-FCTRY-DTE          10370013
092000     END-IF.                                                      10380013
092100     MOVE ASC-STRT-FCTRY-DTE       TO ASTEXTO.                    10390013
092200     IF ASC-TRIP-STRT-DTE-ISO = SPACES OR PC-INIT-DATE            10400013
092300         MOVE SPACES               TO ASC-TRIP-STRT-DTE           10410013
092400     ELSE                                                         10420013
092500         MOVE ASC-TRIP-STRT-DTE-ISO                               10430013
092600                                   TO PV-DATE-BREAK               10440013
092700         MOVE PV-DB-MM             TO PV-DD-MM                    10450013
092800         MOVE PV-DB-DD             TO PV-DD-DD                    10460013
092900         MOVE PV-DB-YY             TO PV-DD-YY                    10470013
093000         MOVE PV-DATE-DISPLAY      TO ASC-TRIP-STRT-DTE           10480013
093100     END-IF.                                                      10490013
093200     MOVE ASC-TRIP-STRT-DTE        TO ATRPSTTO.                   10500013
093300     IF ASC-ELC-DTE-ISO = SPACES OR PC-INIT-DATE                  10510013
093400         MOVE SPACES               TO ASC-ELC-DTE                 10520013
093500     ELSE                                                         10530013
093600         MOVE ASC-ELC-DTE-ISO                                     10540013
093700                                   TO PV-DATE-BREAK               10550013
093800         MOVE PV-DB-MM             TO PV-DD-MM                    10560013
093900         MOVE PV-DB-DD             TO PV-DD-DD                    10570013
094000         MOVE PV-DB-YY             TO PV-DD-YY                    10580013
094100         MOVE PV-DATE-DISPLAY      TO ASC-ELC-DTE                 10590013
094200     END-IF.                                                      10600013
094300     MOVE ASC-ELC-DTE              TO AELCLOTO.                   10610013
094400                                                                  10620013
094500                                                                  10630013
094600*----------------------------------------------------------------*10640013
094700* SELECT COUNTRY FROM COUNTRY CODE TABLE FOR COUNTRY OF PRODUC-  *10650013
094800* TION OR OFFICE OF PLACEMENT ON INITIAL SCREEN.                 *10660013
094900*----------------------------------------------------------------*10670013
095000                                                                  10680013
095100 4500-SELECT-COUNTRY.                                             10690013
095200                                                                  10700013
095300     EXEC SQL                                                     10710013
095400         SELECT A.CNTRY_NM                                        10720013
095500            INTO :CNTRY-CNTRY-NM                                  10730013
095600             FROM TCNTRY A                                        10740013
095700             WHERE A.CNTRY_CDE = :PV-CNTRY-CDE                    10750013
095800     END-EXEC                                                     10760013
095900                                                                  10770013
096000         EVALUATE TRUE                                            10780013
096100             WHEN SQLCODE = ZERO                                  10790013
096200                 CONTINUE                                         10800013
096300             WHEN SQLCODE = +100                                  10810013
096400                 MOVE SPACES TO CNTRY-CNTRY-NM                    10820013
096500             WHEN OTHER                                           10830013
096600                 MOVE '4500-SELECT-COUNTRY'                       10840013
096700                                   TO DP013-PARAGRAPH             10850013
096800                 MOVE 'SQL ERROR SELECTING COUNTRY NAME'          10860013
096900                                   TO DP013-MESSAGE-TEXT (1)      10870013
097000                 MOVE SQLCA        TO DP013-SQLCA                 10880013
097100                 MOVE 'TCNTRY  '   TO DP013-DB2-TABLE-NAME (1)    10890013
097200                 SET DP013-DB2-ABEND                              10900013
097300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           10910013
097400                 PERFORM DP013-0000-PROCESS-ABEND                 10920013
097500         END-EVALUATE.                                            10930013
097600                                                                  10940013
097700*----------------------------------------------------------------*10950013
097800* SELECT FOB CITY NAME FROM TIMFOB TABLE .                       *10960013
097900*----------------------------------------------------------------*10970013
098000                                                                  10980013
098100 4600-SELECT-FOB.                                                 10990013
098200                                                                  11000013
098300     EXEC SQL                                                     11010013
098400         SELECT A.FOB_CTY_NM                                      11020013
098500              , A.FOB_CNTRY_CDE                                   11030013
098600            INTO :IMFOB-FOB-CTY-NM                                11040013
098700                ,:IMFOB-FOB-CNTRY-CDE                             11050013
098800             FROM TIMFOB A                                        11060013
098900             WHERE A.FOB_CDE = :ASC-FREE-ON-BOARD-CODE            11070013
099000     END-EXEC                                                     11080013
099100                                                                  11090013
099200         EVALUATE TRUE                                            11100013
099300             WHEN SQLCODE = ZERO                                  11110013
099400                 CONTINUE                                         11120013
099500             WHEN SQLCODE = +100                                  11130013
099600                 MOVE SPACES TO IMFOB-FOB-CTY-NM                  11140013
099700             WHEN OTHER                                           11150013
099800                 MOVE '4600-SELECT-FOB'                           11160013
099900                                   TO DP013-PARAGRAPH             11170013
100000                 MOVE 'SQL ERROR SELECTING FOB FOB CODE'          11180013
100100                                   TO DP013-MESSAGE-TEXT (1)      11190013
100200                 MOVE SQLCA        TO DP013-SQLCA                 11200013
100300                 MOVE 'TIMFOB  '   TO DP013-DB2-TABLE-NAME (1)    11210013
100400                 SET DP013-DB2-ABEND                              11220013
100500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           11230013
100600                 PERFORM DP013-0000-PROCESS-ABEND                 11240013
100700         END-EVALUATE.                                            11250013
100800                                                                  11260013
100900 EJECT                                                            11270013
101000*----------------------------------------------------------------*11280013
101100*   OPEN THE POE CODE CURSOR                                     *11290013
101200*----------------------------------------------------------------*11300013
101300 4700-OPEN-POE-CURSOR.                                            11310013
101400                                                                  11320013
101500     PERFORM                                                      11330013
101600         WITH TEST AFTER                                          11340013
101700         VARYING PV-RETRY-COUNTER                                 11350013
101800         FROM 1 BY 1                                              11360013
101900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11370013
102000                   OR (SQLCODE = ZERO))                           11380013
102100                                                                  11390013
102200         MOVE 'CURSOR:  POE-CSR'     TO DP013-MESSAGE-TEXT (2)    11400013
102300                                                                  11410013
102400         EXEC SQL                                                 11420013
102500              OPEN POE-CSR                                        11430013
102600         END-EXEC                                                 11440013
102700                                                                  11450013
102800         EVALUATE TRUE                                            11460013
102900             WHEN SQLCODE = ZERO                                  11470013
103000             WHEN SQLCODE = -904                                  11480013
103100             WHEN SQLCODE = -913                                  11490013
103200                 CONTINUE                                         11500013
103300             WHEN SQLWARN0 NOT = SPACES                           11510013
103400             WHEN SQLCODE < ZERO                                  11520013
103500             WHEN SQLCODE > ZERO                                  11530013
103600                 MOVE '4700-OPEN-POE-CURSOR'                      11540013
103700                                   TO DP013-PARAGRAPH             11550013
103800                 MOVE 'OPEN POE CURSOR - '                        11560013
103900                                   TO DP013-MESSAGE-TEXT (1)      11570013
104000                 MOVE SQLCA        TO DP013-SQLCA                 11580013
104100                 MOVE 'TIMPOE  '   TO DP013-DB2-TABLE-NAME (1)    11590013
104200                 SET DP013-DB2-ABEND                              11600013
104300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           11610013
104400                 PERFORM DP013-0000-PROCESS-ABEND                 11620013
104500         END-EVALUATE                                             11630013
104600     END-PERFORM.                                                 11640013
104700*                                                                 11650013
104800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11660013
104900         MOVE '4700-OPEN-POE-CURSOR' TO DP013-PARAGRAPH           11670013
105000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   11680013
105100                                   TO DP013-MESSAGE-TEXT (1)      11690013
105200         MOVE SQLCA                TO DP013-SQLCA                 11700013
105300         MOVE 'TIMPOE  '           TO DP013-DB2-TABLE-NAME (1)    11710013
105400         SET DP013-DB2-ABEND                                      11720013
105500             DP013-XCTL-DISPLAY-RESTART                           11730013
105600                                   TO TRUE                        11740013
105700         PERFORM DP013-0000-PROCESS-ABEND                         11750013
105800     END-IF.                                                      11760013
105900                                                                  11770013
106000 EJECT                                                            11780013
106100*----------------------------------------------------------------*11790013
106200*   CLOSE THE POE CODE CURSOR                                    *11800013
106300*----------------------------------------------------------------*11810013
106400 4710-CLOSE-POE-CURSOR.                                           11820013
106500                                                                  11830013
106600     EXEC SQL                                                     11840013
106700          CLOSE POE-CSR                                           11850013
106800     END-EXEC.                                                    11860013
106900                                                                  11870013
107000     EVALUATE TRUE                                                11880013
107100         WHEN SQLCODE = ZERO                                      11890013
107200             CONTINUE                                             11900013
107300         WHEN SQLWARN0 NOT = SPACES                               11910013
107400         WHEN SQLCODE < ZERO                                      11920013
107500         WHEN SQLCODE > ZERO                                      11930013
107600             MOVE '4710-CLOSE-POE-CURSOR'                         11940013
107700                               TO DP013-PARAGRAPH                 11950013
107800             MOVE 'CLOSE POE CURSOR '                             11960013
107900                               TO DP013-MESSAGE-TEXT (1)          11970013
108000             MOVE SQLCA        TO DP013-SQLCA                     11980013
108100             MOVE 'TIMPOE  '   TO DP013-DB2-TABLE-NAME (1)        11990013
108200             SET DP013-DB2-ABEND                                  12000013
108300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               12010013
108400             PERFORM DP013-0000-PROCESS-ABEND                     12020013
108500     END-EVALUATE.                                                12030013
108600                                                                  12040013
108700 EJECT                                                            12050013
108800*----------------------------------------------------------------*12060013
108900*    FETCH THE POE CODE CURSOR                                   *12070013
109000*----------------------------------------------------------------*12080013
109100 4720-FETCH-POE-CURSOR.                                           12090013
109200                                                                  12100013
109300     EXEC SQL                                                     12110013
109400          FETCH POE-CSR                                           12120013
109500          INTO  :IMPOE-POE-CTY-NM,                                12130013
109600                :IMPOE-POE-ST-CDE                                 12140013
109700     END-EXEC.                                                    12150013
109800                                                                  12160013
109900     EVALUATE TRUE                                                12170013
110000         WHEN SQLCODE = ZERO                                      12180013
110100         WHEN SQLCODE = -811                                      12190013
110200              CONTINUE                                            12200013
110300         WHEN SQLCODE = +100                                      12210013
110400             MOVE SPACES TO IMPOE-POE-CTY-NM                      12220013
110500                            IMPOE-POE-ST-CDE                      12230013
110600         WHEN SQLWARN0 NOT = SPACE                                12240013
110700         WHEN SQLCODE NOT = ZERO                                  12250013
110800              MOVE '4720-FETCH-POE-CURSOR'                        12260013
110900                               TO DP013-PARAGRAPH                 12270013
111000              MOVE 'FETCH POE CURSOR'                             12280013
111100                               TO DP013-MESSAGE-TEXT (1)          12290013
111200              MOVE SQLCA       TO DP013-SQLCA                     12300013
111300              SET DP013-DB2-ABEND                                 12310013
111400                               TO TRUE                            12320013
111500              PERFORM DP013-0000-PROCESS-ABEND                    12330013
111600     END-EVALUATE.                                                12340013
111700                                                                  12350013
111800 EJECT                                                            12360013
111900*-----------------------------------------------------------------12370013
112000 4810-SELECT-QUOTA-CATEGORY.                                      12380013
112100                                                                  12390013
112200     MOVE ASC-PO-NBR TO DK-PO-NBR.                                12400013
112300     PERFORM 4811-OPEN-QTA-CURSOR.                                12410013
112400     PERFORM 4812-FETCH-QTA-CURSOR.                               12420013
112500     PERFORM 4813-CLOSE-QTA-CURSOR.                               12430013
112600*----------------------------------------------------------------*12440013
112700*   OPEN THE QTA CURSOR                                          *12450013
112800*----------------------------------------------------------------*12460013
112900 4811-OPEN-QTA-CURSOR.                                            12470013
113000                                                                  12480013
113100     PERFORM                                                      12490013
113200         WITH TEST AFTER                                          12500013
113300         VARYING PV-RETRY-COUNTER                                 12510013
113400         FROM 1 BY 1                                              12520013
113500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12530013
113600                   OR (SQLCODE = ZERO))                           12540013
113700                                                                  12550013
113800         MOVE 'CURSOR:  QTA-CSR'     TO DP013-MESSAGE-TEXT (2)    12560013
113900                                                                  12570013
114000         EXEC SQL                                                 12580013
114100              OPEN QTA-CSR                                        12590013
114200         END-EXEC                                                 12600013
114300                                                                  12610013
114400         EVALUATE TRUE                                            12620013
114500             WHEN SQLCODE = ZERO                                  12630013
114600             WHEN SQLCODE = -904                                  12640013
114700             WHEN SQLCODE = -913                                  12650013
114800                 CONTINUE                                         12660013
114900             WHEN SQLWARN0 NOT = SPACES                           12670013
115000             WHEN SQLCODE < ZERO                                  12680013
115100             WHEN SQLCODE > ZERO                                  12690013
115200                 MOVE '4811-OPEN-QTA-CURSOR'                      12700013
115300                                   TO DP013-PARAGRAPH             12710013
115400                 MOVE 'OPEN QTA CURSOR - '                        12720013
115500                                   TO DP013-MESSAGE-TEXT (1)      12730013
115600                 MOVE SQLCA        TO DP013-SQLCA                 12740013
115700                 MOVE 'TQTACTG '   TO DP013-DB2-TABLE-NAME (1)    12750013
115800                 SET DP013-DB2-ABEND                              12760013
115900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           12770013
116000                 PERFORM DP013-0000-PROCESS-ABEND                 12780013
116100         END-EVALUATE                                             12790013
116200     END-PERFORM.                                                 12800013
116300*                                                                 12810013
116400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        12820013
116500         MOVE '4811-OPEN-QTA-CURSOR' TO DP013-PARAGRAPH           12830013
116600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   12840013
116700                                   TO DP013-MESSAGE-TEXT (1)      12850013
116800         MOVE SQLCA                TO DP013-SQLCA                 12860013
116900         MOVE 'TQTACTG '           TO DP013-DB2-TABLE-NAME (1)    12870013
117000         SET DP013-DB2-ABEND                                      12880013
117100             DP013-XCTL-DISPLAY-RESTART                           12890013
117200                                   TO TRUE                        12900013
117300         PERFORM DP013-0000-PROCESS-ABEND                         12910013
117400     END-IF.                                                      12920013
117500                                                                  12930013
117600 EJECT                                                            12940013
117700*----------------------------------------------------------------*12950013
117800*    FETCH THE QTA CURSOR                                        *12960013
117900*----------------------------------------------------------------*12970013
118000 4812-FETCH-QTA-CURSOR.                                           12980013
118100                                                                  12990013
118200     EXEC SQL                                                     13000013
118300          FETCH QTA-CSR                                           13010013
118400          INTO  :QTACTG-QTA-CTG-DESC                              13020013
118500     END-EXEC.                                                    13030013
118600                                                                  13040013
118700     EVALUATE TRUE                                                13050013
118800          WHEN SQLCODE = +0                                       13060013
118900                MOVE QTACTG-QTA-CTG-DESC                          13070013
119000                  TO ASC-QTA-CTG-DESC                             13080013
119100                     AQTADSCO                                     13090013
119200          WHEN SQLCODE = -904                                     13100013
119300          WHEN SQLCODE = -913                                     13110013
119400                CONTINUE                                          13120013
119500                                                                  13130013
119600             WHEN SQLWARN0 NOT = SPACES                           13140013
119700             WHEN SQLCODE < +0                                    13150013
119800             WHEN SQLCODE > +0                                    13160013
119900                  MOVE '4812-FETCH-QTA-CURSOR'                    13170013
120000                                  TO DP013-PARAGRAPH              13180013
120100                  MOVE 'UNSUCCESSFUL SELECT ON TQTACTG TABLE'     13190013
120200                                  TO DP013-MESSAGE-TEXT (1)       13200013
120300                  MOVE SQLCA      TO DP013-SQLCA                  13210013
120400                  MOVE 'TQTACTG ' TO DP013-DB2-TABLE-NAME (1)     13220013
120500                  SET DP013-DB2-ABEND                             13230013
120600                      DP013-XCTL-DISPLAY-RESTART                  13240013
120700                                  TO TRUE                         13250013
120800                  PERFORM DP013-0000-PROCESS-ABEND                13260013
120900     END-EVALUATE.                                                13270013
121000                                                                  13280013
121100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13290013
121200         MOVE '4812-FETCH-QTA-CURSOR'                             13300013
121300                                  TO DP013-PARAGRAPH              13310013
121400         MOVE 'MAX RETRIES EXCEEDED ON SELECT ON TQTACTG TABLE'   13320013
121500                                  TO DP013-MESSAGE-TEXT (1)       13330013
121600         MOVE SQLCA               TO DP013-SQLCA                  13340013
121700         MOVE 'TQTACTG '          TO DP013-DB2-TABLE-NAME (1)     13350013
121800         SET DP013-DB2-ABEND                                      13360013
121900             DP013-XCTL-DISPLAY-RESTART                           13370013
122000                                  TO TRUE                         13380013
122100         PERFORM DP013-0000-PROCESS-ABEND                         13390013
122200     END-IF.                                                      13400013
122300*----------------------------------------------------------------*13410013
122400*   CLOSE THE QTA CURSOR                                         *13420013
122500*----------------------------------------------------------------*13430013
122600 4813-CLOSE-QTA-CURSOR.                                           13440013
122700                                                                  13450013
122800     EXEC SQL                                                     13460013
122900          CLOSE QTA-CSR                                           13470013
123000     END-EXEC.                                                    13480013
123100                                                                  13490013
123200     EVALUATE TRUE                                                13500013
123300         WHEN SQLCODE = ZERO                                      13510013
123400             CONTINUE                                             13520013
123500         WHEN SQLWARN0 NOT = SPACES                               13530013
123600         WHEN SQLCODE < ZERO                                      13540013
123700         WHEN SQLCODE > ZERO                                      13550013
123800             MOVE '4813-CLOSE-QTA-CURSOR'                         13560013
123900                               TO DP013-PARAGRAPH                 13570013
124000             MOVE 'CLOSE QTA CURSOR '                             13580013
124100                               TO DP013-MESSAGE-TEXT (1)          13590013
124200             MOVE SQLCA        TO DP013-SQLCA                     13600013
124300             MOVE 'TQTACTG '   TO DP013-DB2-TABLE-NAME (1)        13610013
124400             SET DP013-DB2-ABEND                                  13620013
124500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               13630013
124600             PERFORM DP013-0000-PROCESS-ABEND                     13640013
124700     END-EVALUATE.                                                13650013
124800                                                                  13660013
124900 EJECT                                                            13670013
125000*----------------------------------------------------------------*13680013
125100*    DPPD038 IS THE COPYBOOK TO SELECTIVELY ACCESS               *13690013
125200*    ARCHIVE HISTORY DB2 TBLS -OR- REGULAR UPDATEABLE DB2 TBLS.  *13700013
125300*    PARA: DP038-0000-SET-DB2-PKG.                               *13710013
125400*----------------------------------------------------------------*13720013
125500*    COPY DPPD038.                                                13730013
125600*EJECT                                                            13740013
125700                                                                  13750013
125800******************************************************************13760013
125900*    SQL FOR VERIFYING THAT ALL HANG TAGS ARE THE SAME ON A PO    13770013
126000******************************************************************13780013
126100     COPY POWS072.                                                13790013
126200*----------------------------------------------------------------*13800013
126300*    ABEND PROCESSOR MODULE                                      *13810013
126400*----------------------------------------------------------------*13820013
126500                                                                  13830013
126600     COPY DPPD013.                                                13840013
