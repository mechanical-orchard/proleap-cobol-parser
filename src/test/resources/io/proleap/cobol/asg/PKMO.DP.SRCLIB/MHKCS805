      ******************************************************************        
       IDENTIFICATION DIVISION.                                                 
      ******************************************************************        
                                                                                
       PROGRAM-ID.                MHKCS805.                                     
       AUTHOR.                    KRISTIN PETERSON.                             
       INSTALLATION.              KOHLS DEPARTMENT STORES.                      
       DATE-WRITTEN.              08-04-2004.                                   
       DATE-COMPILED.                                                           
                                                                                
      ******************************************************************        
      *               CICS PROGRAM - MHKCS805 - F805                   *        
      *                                                                *        
      *        MERCHANDISE INQUIRY - UPC TO SKU INQUIRY SCREEN         *        
      *                                                                *        
      *  THIS PROGRAM GENERATES A LIST OF UPC NUMBERS ASSOCIATED WITH  *        
      *  A SPECIFIC SKU.  THIS SCREEN MAY BE ACCESSED FROM THE SKU     *        
      *  LIST CRITERIA SCREEN (F801).                                  *        
      *                                                                *        
      *  THIS PROGRAM DOES NOT FOLLOW ARCHITECTURAL STANDARDS.  THE    *        
      *  SCREEN IS DEFINED AS A DETAIL SCREEN, BUT IT FUNCTIONS AS A   *        
      *  LIST SCREEN.                                                  *        
      *                                                                *        
      ******************************************************************        
      *  MAINTENANCE                                                   *        
      ******************************************************************        
      *  08/04/2004 - KRISTIN PETERSON  (WR# 26354)                    *        
      *    INITIAL INSTALLATION.  NOTE THAT THIS IS A REVISED VERSION  *        
      *    OF PROGRAM FSKCS049.                                        *        
      ******************************************************************        
CICS  * CHANGED 10/28/2022    BY JIM HUNTER      WR: CHG0277420                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  ******************************************************************        
                                                                                
      ******************************************************************        
       ENVIRONMENT DIVISION.                                                    
      ******************************************************************        
                                                                                
      ******************************************************************        
       DATA DIVISION.                                                           
      ******************************************************************        
                                                                                
       WORKING-STORAGE SECTION.                                                 
                                                                                
       01  WS-DATE                     PIC X(08)   VALUE SPACES.                
                                                                                
      ******************************************************************        
      *  DSECT CREATED BY MAP MHKM805                                           
      ******************************************************************        
           COPY MHKM805.                                                        
                                                                                
      ******************************************************************        
      *  PROGRAM REDEFINITION OF GENERATED MAP MHKM805.                         
      ******************************************************************        
      *                                                                         
       01  PROGRAM-MAPA REDEFINES  MH805AI.                                     
           05  PM-AHEADING-AREA        PIC X(132).                              
           05  PM-ATABLE-FILLER        PIC X(1524).                             
           05  PM-AUPC-TABLE REDEFINES PM-ATABLE-FILLER                         
                             OCCURS  12 TIMES                                   
                             INDEXED BY PM-AUPC-INDEX.                          
               10  PM-AUPC-SYS-FIELDS.                                          
                   15  PM-AUPC-SYS-FIELD-ATTR-INPUT.                            
                       20  PM-AUPC-SYS-L                                        
                                       PIC S9(4) COMP.                          
                       20  PM-AUPC-SYS-F                                        
                                       PIC X.                                   
                       20  PM-AUPC-SYS-A REDEFINES PM-AUPC-SYS-F                
                                       PIC X.                                   
                       20  FILLER      PIC X(2).                                
                   15  PM-AUPC-SYS-FIELD-ATTR-OUTPUT REDEFINES                  
                                       PM-AUPC-SYS-FIELD-ATTR-INPUT.            
                       20  FILLER      PIC X(3).                                
                       20  PM-AUPC-SYS-C                                        
                                       PIC X.                                   
                       20  PM-AUPC-SYS-H                                        
                                       PIC X.                                   
                   15  PM-AUPC-SYSTEM  PIC X(2).                                
               10  PM-AUPC-VND-FIELDS.                                          
                   15  PM-AUPC-VND-FIELD-ATTR-INPUT.                            
                       20  PM-AUPC-VND-L                                        
                                       PIC S9(4) COMP.                          
                       20  PM-AUPC-VND-F                                        
                                       PIC X.                                   
                       20  PM-AUPC-VND-A REDEFINES PM-AUPC-VND-F                
                                       PIC X.                                   
                       20  FILLER      PIC X(2).                                
                   15  PM-AUPC-VND-FIELD-ATTR-OUTPUT REDEFINES                  
                                       PM-AUPC-VND-FIELD-ATTR-INPUT.            
                       20  FILLER      PIC X(3).                                
                       20  PM-AUPC-VND-C                                        
                                       PIC X.                                   
                       20  PM-AUPC-VND-H                                        
                                       PIC X.                                   
                   15  PM-AUPC-VENDOR  PIC X(5).                                
               10  PM-AUPC-ITM-FIELDS.                                          
                   15  PM-AUPC-ITM-FIELD-ATTR-INPUT.                            
                       20  PM-AUPC-ITM-L                                        
                                       PIC S9(4) COMP.                          
                       20  PM-AUPC-ITM-F                                        
                                       PIC X.                                   
                       20  PM-AUPC-ITM-A REDEFINES PM-AUPC-ITM-F                
                                       PIC X.                                   
                       20  FILLER      PIC X(2).                                
                   15  PM-AUPC-ITM-FIELD-ATTR-OUTPUT REDEFINES                  
                                       PM-AUPC-ITM-FIELD-ATTR-INPUT.            
                       20  FILLER      PIC X(3).                                
                       20  PM-AUPC-ITM-C                                        
                                       PIC X.                                   
                       20  PM-AUPC-ITM-H                                        
                                       PIC X.                                   
                   15  PM-AUPC-ITEM    PIC X(5).                                
               10  PM-AUPC-CHK-FIELDS.                                          
                   15  PM-AUPC-CHK-FIELD-ATTR-INPUT.                            
                       20  PM-AUPC-CHK-L                                        
                                       PIC S9(4) COMP.                          
                       20  PM-AUPC-CHK-F                                        
                                       PIC X.                                   
                       20  PM-AUPC-CHK-A REDEFINES PM-AUPC-CHK-F                
                                       PIC X.                                   
                       20  FILLER      PIC X(2).                                
                   15  PM-AUPC-CHK-FIELD-ATTR-OUTPUT REDEFINES                  
                                       PM-AUPC-CHK-FIELD-ATTR-INPUT.            
                       20  FILLER      PIC X(3).                                
                       20  PM-AUPC-CHK-C                                        
                                       PIC X.                                   
                       20  PM-AUPC-CHK-H                                        
                                       PIC X.                                   
                   15  PM-AUPC-CHK-DIG PIC X(1).                                
               10  PM-AEDI-IND-FIELDS.                                          
                   15  PM-AEDI-IND-FIELD-ATTR-INPUT.                            
                       20  PM-AEDI-IND-L                                        
                                       PIC S9(4) COMP.                          
                       20  PM-AEDI-IND-F                                        
                                       PIC X.                                   
                       20  PM-AEDI-IND-A REDEFINES PM-AEDI-IND-F                
                                       PIC X.                                   
                       20  FILLER      PIC X(2).                                
                   15  PM-AEDI-IND-FIELD-ATTR-OUTPUT REDEFINES                  
                                       PM-AEDI-IND-FIELD-ATTR-INPUT.            
                       20  FILLER      PIC X(3).                                
                       20  PM-AEDI-IND-C                                        
                                       PIC X.                                   
                       20  PM-AEDI-IND-H                                        
                                       PIC X.                                   
                   15  PM-AEDI-IND      PIC X(1).                               
               10  PM-APOS-IND-FIELDS.                                          
                   15  PM-APOS-IND-FIELD-ATTR-INPUT.                            
                       20  PM-APOS-IND-L                                        
                                       PIC S9(4) COMP.                          
                       20  PM-APOS-IND-F                                        
                                       PIC X.                                   
                       20  PM-APOS-IND-A REDEFINES PM-APOS-IND-F                
                                       PIC X.                                   
                       20  FILLER      PIC X(2).                                
                   15  PM-APOS-IND-FIELD-ATTR-OUTPUT REDEFINES                  
                                       PM-APOS-IND-FIELD-ATTR-INPUT.            
                       20  FILLER      PIC X(3).                                
                       20  PM-APOS-IND-C                                        
                                       PIC X.                                   
                       20  PM-APOS-IND-H                                        
                                       PIC X.                                   
                   15  PM-APOS-IND     PIC X(1).                                
               10  PM-ACREATED-FIELDS.                                          
                   15  PM-ACREATED-FIELD-ATTR-INPUT.                            
                       20  PM-ACREATED-L                                        
                                       PIC S9(4) COMP.                          
                       20  PM-ACREATED-F                                        
                                       PIC X.                                   
                       20  PM-ACREATED-A REDEFINES PM-ACREATED-F                
                                       PIC X.                                   
                       20  FILLER      PIC X(2).                                
                   15  PM-ACREATED-FIELD-ATTR-OUTPUT REDEFINES                  
                                       PM-ACREATED-FIELD-ATTR-INPUT.            
                       20  FILLER      PIC X(3).                                
                       20  PM-ACREATED-C                                        
                                       PIC X.                                   
                       20  PM-ACREATED-H                                        
                                       PIC X.                                   
                   15  PM-ACREATE-DATE  PIC X(10).                              
               10  PM-AUPC-CNRF-FIELDS.                                         
                   15  PM-AUPC-CNRF-FIELD-ATTR-INPUT.                           
                       20  PM-AUPC-CNRF-L                                       
                                       PIC S9(4) COMP.                          
                       20  PM-AUPC-CNRF-F                                       
                                       PIC X.                                   
                       20  PM-AUPC-CNRF-A REDEFINES PM-AUPC-CNRF-F              
                                       PIC X.                                   
                       20  FILLER      PIC X(2).                                
                   15  PM-AUPC-CNRF-FIELD-ATTR-OUTPUT REDEFINES                 
                                       PM-AUPC-CNRF-FIELD-ATTR-INPUT.           
                       20  FILLER      PIC X(3).                                
                       20  PM-AUPC-CNRF-C                                       
                                       PIC X.                                   
                       20  PM-AUPC-CNRF-H                                       
                                       PIC X.                                   
                   15  PM-AUPC-CNRF    PIC X(03).                               
               10  PM-AUPC-CDSC-FIELDS.                                         
                   15  PM-AUPC-CDSC-FIELD-ATTR-INPUT.                           
                       20  PM-AUPC-CDSC-L                                       
                                       PIC S9(4) COMP.                          
                       20  PM-AUPC-CDSC-F                                       
                                       PIC X.                                   
                       20  PM-AUPC-CDSC-A REDEFINES PM-AUPC-CDSC-F              
                                       PIC X.                                   
                       20  FILLER      PIC X(2).                                
                   15  PM-AUPC-CDSC-FIELD-ATTR-OUTPUT REDEFINES                 
                                       PM-AUPC-CDSC-FIELD-ATTR-INPUT.           
                       20  FILLER      PIC X(3).                                
                       20  PM-AUPC-CDSC-C                                       
                                       PIC X.                                   
                       20  PM-AUPC-CDSC-H                                       
                                       PIC X.                                   
                   15  PM-AUPC-CDSC    PIC X(10).                               
               10  PM-AUPC-SNRF-FIELDS.                                         
                   15  PM-AUPC-SNRF-FIELD-ATTR-INPUT.                           
                       20  PM-AUPC-SNRF-L                                       
                                       PIC S9(4) COMP.                          
                       20  PM-AUPC-SNRF-F                                       
                                       PIC X.                                   
                       20  PM-AUPC-SNRF-A REDEFINES PM-AUPC-SNRF-F              
                                       PIC X.                                   
                       20  FILLER      PIC X(2).                                
                   15  PM-AUPC-SNRF-FIELD-ATTR-OUTPUT REDEFINES                 
                                       PM-AUPC-SNRF-FIELD-ATTR-INPUT.           
                       20  FILLER      PIC X(3).                                
                       20  PM-AUPC-SNRF-C                                       
                                       PIC X.                                   
                       20  PM-AUPC-SNRF-H                                       
                                       PIC X.                                   
                   15  PM-AUPC-SNRF    PIC X(05).                               
               10  PM-AUPC-SDSC-FIELDS.                                         
                   15  PM-AUPC-SDSC-FIELD-ATTR-INPUT.                           
                       20  PM-AUPC-SDSC-L                                       
                                       PIC S9(4) COMP.                          
                       20  PM-AUPC-SDSC-F                                       
                                       PIC X.                                   
                       20  PM-AUPC-SDSC-A REDEFINES PM-AUPC-SDSC-F              
                                       PIC X.                                   
                       20  FILLER      PIC X(2).                                
                   15  PM-AUPC-SDSC-FIELD-ATTR-OUTPUT REDEFINES                 
                                       PM-AUPC-SDSC-FIELD-ATTR-INPUT.           
                       20  FILLER      PIC X(3).                                
                       20  PM-AUPC-SDSC-C                                       
                                       PIC X.                                   
                       20  PM-AUPC-SDSC-H                                       
                                       PIC X.                                   
                   15  PM-AUPC-SDSC    PIC X(10).                               
               10  PM-AUPC-SRCE-FIELDS.                                         
                   15  PM-AUPC-SRCE-FIELD-ATTR-INPUT.                           
                       20  PM-AUPC-SRCE-L                                       
                                       PIC S9(4) COMP.                          
                       20  PM-AUPC-SRCE-F                                       
                                       PIC X.                                   
                       20  PM-AUPC-SRCE-A REDEFINES PM-AUPC-SRCE-F              
                                       PIC X.                                   
                       20  FILLER      PIC X(2).                                
                   15  PM-AUPC-SRCE-FIELD-ATTR-OUTPUT REDEFINES                 
                                       PM-AUPC-SRCE-FIELD-ATTR-INPUT.           
                       20  FILLER      PIC X(3).                                
                       20  PM-AUPC-SRCE-C                                       
                                       PIC X.                                   
                       20  PM-AUPC-SRCE-H                                       
                                       PIC X.                                   
                   15  PM-AUPC-SRCE    PIC X(08).                               
               10  PM-AUPC-CERT-FIELDS.                                         
                   15  PM-AUPC-CERT-FIELD-ATTR-INPUT.                           
                       20  PM-AUPC-CERT-L                                       
                                       PIC S9(4) COMP.                          
                       20  PM-AUPC-CERT-F                                       
                                       PIC X.                                   
                       20  PM-AUPC-CERT-A REDEFINES PM-AUPC-CERT-F              
                                       PIC X.                                   
                       20  FILLER      PIC X(2).                                
                   15  PM-AUPC-CERT-FIELD-ATTR-OUTPUT REDEFINES                 
                                       PM-AUPC-CERT-FIELD-ATTR-INPUT.           
                       20  FILLER      PIC X(3).                                
                       20  PM-AUPC-CERT-C                                       
                                       PIC X.                                   
                       20  PM-AUPC-CERT-H                                       
                                       PIC X.                                   
                   15  PM-AUPC-CERT-REQ PIC X(1).                               
           05  FILLER                  PIC X(1).                                
                                                                                
                                                                                
       01  MD-MAP-DATA-AREA            PIC X(3300).                             
                                                                                
       01  PC-PROGRAM-CONSTANTS.                                                
           05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'MHKCS805'.          
           05  PC-NEW-MAP-NAME          PIC  X(08)  VALUE  'MH805A  '.          
           05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'MHKM805 '.          
           05  PC-MAXIMUM-RETRY-COUNT  PIC S9(4)    VALUE +2                    
                                       COMP.                                    
           05  PC-UPCS-PER-PAGE        PIC S9(4)    VALUE +12                   
                                       COMP.                                    
           05  PC-EXTERNAL-UPC-HIGH    PIC S9(15)                               
                                              VALUE 999999999999999             
                                              COMP-3.                           
           05  PC-EXTERNAL-UPC-LOW     PIC S9(15)                               
                                              VALUE 000000000000000             
                                              COMP-3.                           
           05  PC-INTERNAL-HIGHEST     PIC S9(15)                               
                                              VALUE 000499999999999             
                                              COMP-3.                           
           05  PC-INTERNAL-LOWEST      PIC S9(15)                               
                                              VALUE 000400000000000             
                                              COMP-3.                           
           05  PC-INTERNAL-UPC-HIGH    PIC S9(15)                               
                                              VALUE 000500000000000             
                                              COMP-3.                           
           05  PC-INTERNAL-UPC-LOW     PIC S9(15)                               
                                              VALUE 000399999999999             
                                              COMP-3.                           
           05  PC-LOW-VALUES           PIC X(3)     VALUE LOW-VALUES.           
           05  PC-NO-VENDOR            PIC X(16)    VALUE                       
             'VENDOR NOT FOUND'.                                                
           05  PC-STATUS-98            PIC S9(3)    VALUE 98.                   
           05  PC-VENDOR-PROFILE-NAME  PIC X(8)     VALUE 'MPVNDPFL'.           
           05  PC-YES                  PIC X(1)     VALUE 'Y'.                  
           05  PC-C                    PIC X(1)     VALUE 'C'.                  
           05  PC-DC-GENR              PIC X(08)    VALUE 'DC GENR'.            
           05  PC-I                    PIC X(1)     VALUE 'I'.                  
           05  PC-INTERNL              PIC X(08)    VALUE 'INTERNL'.            
           05  PC-K                    PIC X(1)     VALUE 'K'.                  
           05  PC-CONVRTD              PIC X(08)    VALUE 'CONVRTD'.            
           05  PC-R                    PIC X(1)     VALUE 'R'.                  
           05  PC-RENUMBR              PIC X(08)    VALUE 'RENUMBR'.            
           05  PC-U                    PIC X(1)     VALUE 'U'.                  
           05  PC-USER                 PIC X(08)    VALUE 'USER   '.            
           05  PC-V                    PIC X(01)    VALUE 'V'.                  
           05  PC-CATALOG              PIC X(08)    VALUE 'CATALOG'.            
           05  PC-MIN-NRF-RANGE-CDE    PIC S9(9)    VALUE 98000                 
                                                    COMP.                       
           05  PC-ERR-MSG-1            PIC X(35)    VALUE                       
             'OPEN THE CURSOR FOR UPC/SKU TABLE'.                               
           05  PC-ERR-MSG-2            PIC X(27)    VALUE                       
             'SELECT FROM SKU TABLE (TSK)'.                                     
           05  PC-ERR-MSG-3            PIC X(36)    VALUE                       
             'CLOSE THE CURSOR FOR UPC/SKU TABLE'.                              
           05  PC-ERR-MSG-4            PIC X(40)    VALUE                       
             'FETCH FROM UPC/SKU TABLE - INTERNAL UPCS'.                        
           05  PC-ERR-MSG-5            PIC X(40)    VALUE                       
             'FETCH FROM UPC/SKU TABLE - EXTERNAL UPCS'.                        
           05  PC-ERR-MSG-6            PIC X(35)    VALUE                       
             'OPEN THE CURSOR FOR TDSZRNM TABLE'.                               
           05  PC-ERR-MSG-7            PIC X(24)    VALUE                       
             'FETCH FROM TDSZRNM TABLE'.                                        
           05  PC-ERR-MSG-8            PIC X(36)    VALUE                       
             'CLOSE THE CURSOR FOR TDSZRNM TABLE'.                              
           05  PC-UPC-NEW-LINE-MSG     PIC X(10)    VALUE 'NEW LINE  '.         
           05  PC-TSYMSG-NUMBERS.                                               
               10  PC-TSYMSG-00073     PIC  9(05) VALUE 00073.                  
               10  PC-TSYMSG-00420     PIC  9(05) VALUE 00420.                  
               10  PC-TSYMSG-00421     PIC  9(05) VALUE 00421.                  
               10  PC-TSYMSG-00438     PIC  9(05) VALUE 00438.                  
               10  PC-TSYMSG-00440     PIC  9(05) VALUE 00440.                  
                                                                                
       01  PS-PROGRAM-SWITCHES.                                                 
           05  PS-END-OF-UPC-TABLE-IND PIC X(1)     VALUE 'N'.                  
               88  PS-NOT-END-OF-UPC-TABLE          VALUE 'N'.                  
               88  PS-END-OF-UPC-TABLE              VALUE 'Y'.                  
           05  PS-END-OF-SIZE-CODES-IND PIC X(1)    VALUE 'N'.                  
               88  PS-NOT-END-OF-SIZE-CODES         VALUE 'N'.                  
               88  PS-END-OF-SIZE-CODES             VALUE 'Y'.                  
           05  PS-SKU-FOUND-IND        PIC X(1)     VALUE 'N'.                  
               88  PS-NO-SKU-FOUND                  VALUE 'N'.                  
               88  PS-SKU-FOUND                     VALUE 'Y'.                  
           05  PS-UPCS-FOUND-IND       PIC X(1)     VALUE 'N'.                  
               88  PS-NO-UPCS-FOUND                 VALUE 'Y'.                  
               88  PS-DID-FIND-UPCS                 VALUE 'Y'.                  
           05  PS-EXT-UPCS-FOUND-IND   PIC X(1)     VALUE 'Y'.                  
               88  PS-EXT-UPCS-FOUND                VALUE 'N'.                  
               88  PS-NO-EXT-UPCS-FOUND             VALUE 'Y'.                  
           05  PS-VENDOR-FOUND-IND     PIC X(1)     VALUE 'N'.                  
               88  PS-VENDOR-NAME-NOT-FOUND         VALUE 'N'.                  
               88  PS-VENDOR-NAME-FOUND             VALUE 'Y'.                  
           05  PS-SIZE-DESC-FOUND-SW   PIC X(01)    VALUE 'N'.                  
               88  PS-SIZE-DESC-FOUND               VALUE 'Y'.                  
               88  PS-SIZE-DESC-NOT-FOUND           VALUE 'N'.                  
           05  PS-UPC-INFO-FOUND-SW    PIC X(01)    VALUE 'N'.                  
               88  PS-UPC-INFO-FOUND                VALUE 'Y'.                  
               88  PS-UPC-INFO-NOT-FOUND            VALUE 'N'.                  
           05  PS-TCOLOR-FOUND-SW      PIC X(01)    VALUE 'N'.                  
               88  PS-TCOLOR-FOUND                  VALUE 'Y'.                  
               88  PS-TCOLOR-NOT-FOUND              VALUE 'N'.                  
           05  PS-TUPCPLS-ROW-FOWND-SW PIC X(01)    VALUE 'N'.                  
               88  PS-TUPCPLS-ROW-FOUND             VALUE 'Y'.                  
               88  PS-TUPCPLS-ROW-NOT-FOUND         VALUE 'N'.                  
                                                                                
       01  PV-PROGRAM-VARIABLES.                                                
           05  PV-CICS-RESPONSE        PIC S9(9)    VALUE ZERO                  
                                                    COMP.                       
           05  PV-SAVE-CA-UPC-INDEX    PIC S9(4)    VALUE ZERO                  
                                                    COMP.                       
           05  PV-RETRY-COUNT          PIC S9(4)    VALUE ZERO                  
                                                    COMP.                       
           05  PV-DB2-ITEM-NMBR        PIC S9(15)   COMP-3                      
                                                    VALUE ZERO.                 
           05  PV-DB2-SIZE-CDE         PIC S9(9)    COMP                        
                                                    VALUE ZERO.                 
           05  PV-HOLD-CNRF            PIC X(3)     VALUE SPACES.               
           05  PV-HOLD-CDSC            PIC X(10)    VALUE SPACES.               
           05  PV-LEAVE-SYSTEM-MESSAGE PIC X(160)   VALUE SPACES.               
           05  PV-MAX-PAGE-NUMBER      PIC S9(5)    VALUE ZERO                  
                                                    COMP-3.                     
           05  PV-THIS-LINE-NUM        PIC S9(5)    VALUE ZERO                  
                                                    COMP-3.                     
           05  PV-UPC-NUMBER           PIC 9(15).                               
           05  FILLER REDEFINES PV-UPC-NUMBER.                                  
               10  FILLER              PIC 9(2).                                
               10  PV-UPC-FIRST        PIC 9(2).                                
               10  PV-UPC-SECOND       PIC 9(5).                                
               10  PV-UPC-THIRD        PIC 9(5).                                
               10  PV-UPC-FOURTH       PIC 9(1).                                
           05  PV-XREF-CRE-DTE-CCYYMMDD.                                        
               10  PV-XREF-CCYYMMDD-CC PIC X(2)     VALUE SPACES.               
               10  PV-XREF-CCYYMMDD-YY PIC X(2)     VALUE SPACES.               
               10  PV-XREF-CCYYMMDD-H1 PIC X(1)     VALUE SPACES.               
               10  PV-XREF-CCYYMMDD-MM PIC X(2)     VALUE SPACES.               
               10  PV-XREF-CCYYMMDD-H2 PIC X(1)     VALUE SPACES.               
               10  PV-XREF-CCYYMMDD-DD PIC X(2)     VALUE SPACES.               
           05  PV-XREF-CRE-DTE-MMDDCCYY.                                        
               10  PV-XREF-MMDDCCYY-MM PIC X(2)     VALUE SPACES.               
               10  FILLER              PIC X(1)     VALUE '/'.                  
               10  PV-XREF-MMDDCCYY-DD PIC X(2)     VALUE SPACES.               
               10  FILLER              PIC X(1)     VALUE '/'.                  
               10  PV-XREF-MMDDCCYY-CC PIC X(2)     VALUE SPACES.               
               10  PV-XREF-MMDDCCYY-YY PIC X(2)     VALUE SPACES.               
           05  PV-DEPT-NUMBER                  PIC X(03).                       
           05  PV-ENT-ID                       PIC S9(9)  VALUE +0              
                                                          COMP.                 
           05  PV-STORE-NUMBER                 PIC S9(04) VALUE ZERO            
                                                          COMP SYNC.            
       01  SE-SYSTEM-ERROR-MESSAGE.                                             
           05  FILLER                  PIC X(43)    VALUE                       
               'A SYSTEM ERROR HAS OCCURRED - CONTACT DP - '.                   
           05  FILLER                  PIC X(33)    VALUE                       
               'PROGRAM MHKCS805       EIBRESP = '.                             
           05  SE-CICS-RESPONSE        PIC 9(4)     VALUE ZERO.                 
           05  FILLER                  PIC X(5)     VALUE SPACES.               
           05  FILLER                  PIC X(14)    VALUE                       
               'ATTEMPTING TO '.                                                
           05  SE-ATTEMPTED-ACTION     PIC X(61)    VALUE SPACES.               
                                                                                
       01  ST-SYSTEM-TIME-AREA.                                                 
           05  ST-ABSTIME              PIC S9(18)   VALUE ZERO                  
                                       COMP SYNC.                               
           05  ST-TIME-EDIT.                                                    
               10  ST-TIME-HHMM        PIC X(5).                                
               10  FILLER              PIC X(3).                                
           05  ST-TIME-HHMMSS.                                                  
               10  ST-TIME-HH          PIC X(2).                                
               10  FILLER              PIC X(1).                                
               10  ST-TIME-MM          PIC X(2).                                
               10  FILLER              PIC X(1).                                
               10  ST-TIME-SS          PIC X(2).                                
                                                                                
       01  TS-TEMPORARY-STORAGE-AREA.                                           
      **** TS-QUEUE-RECORD-LENGTH SHOULD EQUAL THE LENGTH OF                    
      **** TS-QUEUE-RECORD-LAYOUT                                               
           05  TS-QUEUE-RECORD-LENGTH                                           
                                       PIC S9(4)    VALUE +62                   
                                       COMP SYNC.                               
           05  TS-QUEUE-RECORD-NUM     PIC S9(4)    VALUE +1                    
                                       COMP.                                    
           05  TS-QUEUE-NAME.                                                   
               10  TS-TERMINAL-ID      PIC  X(04)   VALUE SPACES.               
               10  TS-TRANSACTION-ID   PIC S9(05)   COMP-3.                     
               10  TS-TERM-SEQ         PIC  9(01)   VALUE 4.                    
           05  TS-QUEUE-RECORD-LAYOUT.                                          
               10  TS-SELECT-IND       PIC X(1)     VALUE SPACE.                
                   88  TS-UPC-SELECTED              VALUE 'S'.                  
                   88  TS-UPC-NOT-SELECTED          VALUE ' '.                  
               10  TS-UPC-TYPE-IND     PIC X(1)     VALUE SPACE.                
                   88  TS-EXISTING-UPC              VALUE 'E'.                  
                   88  TS-ADD-UPC                   VALUE 'A'.                  
                   88  TS-UPDATE-UPC                VALUE 'U'.                  
                   88  TS-DELETE-UPC                VALUE 'D'.                  
                   88  TS-NEW-LINE                  VALUE 'L'.                  
                   88  TS-REALIGN-UPC               VALUE 'R'.                  
               10  TS-ERROR-IND        PIC X(2)     VALUE SPACE.                
                   88  TS-NO-ERROR                  VALUE '  '.                 
                   88  TS-ADD-EXISTS                VALUE '01'.                 
                   88  TS-ADD-NOT-NEW               VALUE '02'.                 
                   88  TS-UPDATE-NOT-EXIST          VALUE '03'.                 
                   88  TS-DELETE-NOT-EXIST          VALUE '04'.                 
                   88  TS-DELETE-INTERNAL           VALUE '05'.                 
                   88  TS-REALIGN-INTERNAL          VALUE '06'.                 
                   88  TS-REALIGN-NOT-EXIST         VALUE '07'.                 
               10  TS-UPC-INFO.                                                 
                   15 TS-UPC-NBR                                                
                                       PIC S9(15)   COMP-3                      
                                                    VALUE ZEROES.               
                   15 TS-EDI-ORD-IND                                            
                                       PIC X(1)     VALUE SPACE.                
                   15 TS-PLU-DWNLD-IND                                          
                                       PIC X(1)     VALUE SPACE.                
                   15 TS-XREF-CRE-DTE                                           
                                       PIC X(10)    VALUE SPACES.               
                   15 TS-ORIG-EDI-ORD-IND                                       
                                       PIC X(1)     VALUE SPACE.                
                   15 TS-CERT-REQ-IND                                           
                                       PIC X(1)     VALUE SPACE.                
                   15 TS-CNRF          PIC X(03)    VALUE SPACE.                
                   15 TS-CDSC          PIC X(10)    VALUE SPACE.                
                   15 TS-SNRF          PIC X(05)    VALUE SPACE.                
                   15 TS-SDSC          PIC X(10)    VALUE SPACE.                
                   15 TS-SRCE          PIC X(08)    VALUE SPACE.                
                                                                                
      ******************************************************************        
      *  ABEND PROCESSING COPYBOOK.                                             
      ******************************************************************        
           COPY DPWS013.                                                        
                                                                                
      ******************************************************************        
      *  NIS WORK AREAS COPYBOOK.                                               
      ******************************************************************        
           COPY ISWS006.                                                        
       05 NI-SKU-C3             PIC S9(8)V COMP-3.                              
                                                                                
      ******************************************************************        
      *  ATTRIBUTE SETTINGS COPYBOOK.                                  *        
      ******************************************************************        
                                                                                
           COPY DPWS015.                                                        
                                                                                
      ******************************************************************        
      *  ATTRIBUTE SETTINGS COPYBOOK.                                  *        
      ******************************************************************        
           COPY DPWS016.                                                        
                                                                                
      ******************************************************************        
      *    STANDARD COMMAREA.                                                   
      ******************************************************************        
           COPY DPWS030.                                                        
CICS       COPY DPWS930.                                                        
                                                                                
      ******************************************************************        
      *    STANDARD COMMAREA.                                                   
      ******************************************************************        
           COPY DPWS020.                                                        
                                                                                
      ******************************************************************        
      *  MDSE INQUIRY COMMAREA                                                  
      ******************************************************************        
           COPY MHWS000.                                                        
      ******************************************************************        
      *    SPECIFIC COMMMAREA FOR MHKCS805.                                     
      ******************************************************************        
           10  CA-COMM-AREA.                                                    
               15  CA-COMMON-DATA.                                              
                   20  CA-UPC-LINES-IND                                         
                                           PIC X(1).                            
                       88  CA-DONT-HAVE-UPC-LINES      VALUE ' '.               
                       88  CA-HAVE-UPC-LINES           VALUE 'Y'.               
                   20  CA-UPCS-ON-PAGE     PIC 9(3)    COMP-3.                  
                   20  CA-NUM-OF-TS-RECORDS                                     
                                           PIC 9(5)    COMP-3.                  
                   20  CA-SCREEN-PAGE      PIC 9(3)    COMP-3.                  
                   20  CA-VENDOR-STYLE     PIC X(20).                           
                   20  CA-DESCRIPTION      PIC X(25).                           
                   20  CA-VENDOR-NAME      PIC X(25).                           
                   20  CA-SKU-STORE-KEY.                                        
                       25  CA-SKU-KEY          PIC X(8).                        
                       25  CA-STORE-KEY        PIC X(5).                        
               15  CA-SHARED-COMM-DATA.                                         
                   20  CA-TODAYS-DATE.                                          
                       25  CA-THIS-MONTH   PIC X(2).                            
                       25  FILLER          PIC X(1).                            
                       25  CA-THIS-DAY     PIC X(2).                            
                       25  FILLER          PIC X(1).                            
                       25  CA-THIS-YEAR    PIC X(2).                            
                   20  CA-OLD-ITEM-NUMBER  PIC S9(15)  COMP-3.                  
               15  CA-UPC-AREA1.                                                
                   20  CA-UPC-AREA  OCCURS 12 TIMES                             
                                    INDEXED BY CA-UPC-INDEX.                    
                       25  CA-UPC-SYSTEM   PIC X(2).                            
                       25  CA-UPC-SYSTEM-9 REDEFINES CA-UPC-SYSTEM              
                                           PIC 9(2).                            
                       25  CA-UPC-VENDOR   PIC X(5).                            
                       25  CA-UPC-VENDOR-9 REDEFINES CA-UPC-VENDOR              
                                           PIC 9(5).                            
                       25  CA-UPC-ITEM     PIC X(5).                            
                       25  CA-UPC-ITEM-9 REDEFINES CA-UPC-ITEM                  
                                           PIC 9(5).                            
                       25  CA-UPC-CHK-DIG  PIC X(1).                            
                       25  CA-UPC-CHK-DIG-9 REDEFINES CA-UPC-CHK-DIG            
                                           PIC 9(1).                            
                       25  CA-EDI-IND      PIC X(1).                            
                       25  CA-POS-IND      PIC X(1).                            
                       25  CA-CREATE-DATE  PIC X(10).                           
                       25  CA-CNRF         PIC X(03).                           
                       25  CA-CDSC         PIC X(10).                           
                       25  CA-SNRF         PIC X(05).                           
                       25  CA-SDSC         PIC X(10).                           
                       25  CA-SRCE         PIC X(08).                           
                       25  CA-UPC-CERT-REQ                                      
                                           PIC X(01).                           
                                                                                
      **********************************************************                
      *  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE                    
      **********************************************************                
           COPY DPWS010I.                                                       
                                                                                
      **********************************************************                
      *  STANDARD ATTENTION IDENTIFIER LIST                                     
      **********************************************************                
           COPY DFHAID.                                                         
                                                                                
      **********************************************************                
      *  COMMAREA AND WORKING-STORAGE VARIABLES REQUIRED FOR THE                
      *  SECURITY SUBROUTINE (CICSAUTH).                                        
      **********************************************************                
           COPY DPWS008.                                                        
                                                                                
      ******************************************************************        
      *    TSK IS THE DCLGEN MEMBER FOR THE SKU TABLE                           
      ******************************************************************        
                                                                                
           EXEC SQL                                                             
               INCLUDE TSK                                                      
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *    TSKXREF IS THE DCLGEN MEMBER FOR THE CROSS REFERENCE TABLE           
      ******************************************************************        
                                                                                
           EXEC SQL                                                             
               INCLUDE TSKXREF                                                  
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *    TUPCSKU IS THE DCLGEN MEMBER FOR THE UPC/SKU TABLE                   
      ******************************************************************        
                                                                                
           EXEC SQL                                                             
               INCLUDE TUPCSKU                                                  
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  SQL AND COBOL DECLARATIONS FOR THE NRF SIZE TABLE (TSIZE)              
      ******************************************************************        
                                                                                
           EXEC SQL                                                             
               INCLUDE TSIZE                                                    
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  SQL AND COBOL DECLARATIONS FOR THE SIZE RANGE     (TDSZRNM)            
      *  MEMBERSHIP TABLE                                                       
      ******************************************************************        
                                                                                
           EXEC SQL                                                             
               INCLUDE TDSZRNM                                                  
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  SQL AND COBOL DECLARATIONS FOR THE UPC TABLE      (TUPC)               
      ******************************************************************        
                                                                                
           EXEC SQL                                                             
               INCLUDE TUPC                                                     
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  SQL AND COBOL DECLARATIONS FOR THE COLOR TABLE    (TCOLOR)             
      ******************************************************************        
                                                                                
           EXEC SQL                                                             
               INCLUDE TCOLOR                                                   
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *    VENDOR TABLE XMT_VND                                                 
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE XMT00000                                                 
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *    SQLCA IS THE DB2 COMMUNICATIONS AREA                                 
      ******************************************************************        
                                                                                
           EXEC SQL                                                             
               INCLUDE SQLCA                                                    
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *    DECLARE THE CURSOR FOR THE UPC/SKU TABLE - INTERNAL UPCS             
      ******************************************************************        
                                                                                
           EXEC SQL                                                             
                DECLARE INTRNUPC CURSOR FOR                                     
                SELECT UPC_NBR,                                                 
                       EDI_ORD_IND,                                             
                       PLU_DWNLD_IND,                                           
                       XREF_CRE_DTE,                                            
                       CERT_IND                                                 
                FROM TUPCSKU                                                    
                WHERE ((TUPCSKU.ITEM_NBR = :PV-DB2-ITEM-NMBR)                   
                        AND                                                     
                       (UPC_NBR BETWEEN :PC-INTERNAL-LOWEST                     
                                    AND :PC-INTERNAL-HIGHEST))                  
                ORDER BY UPC_NBR                                                
                WITH UR                                                         
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *    DECLARE THE CURSOR FOR THE UPC/SKU TABLE - EXTERNAL UPCS             
      ******************************************************************        
                                                                                
           EXEC SQL                                                             
                DECLARE UPCSKU CURSOR FOR                                       
                SELECT UPC_NBR,                                                 
                       EDI_ORD_IND,                                             
                       PLU_DWNLD_IND,                                           
                       XREF_CRE_DTE,                                            
                       CERT_IND                                                 
                FROM TUPCSKU                                                    
                WHERE ((TUPCSKU.ITEM_NBR = :PV-DB2-ITEM-NMBR)                   
                                        AND                                     
                      ((UPC_NBR BETWEEN :PC-EXTERNAL-UPC-LOW                    
                                                  AND                           
                                        :PC-INTERNAL-UPC-LOW)                   
                                    OR                                          
                       (UPC_NBR BETWEEN :PC-INTERNAL-UPC-HIGH                   
                                                  AND                           
                                        :PC-EXTERNAL-UPC-HIGH)))                
                ORDER BY UPC_NBR                                                
                WITH UR                                                         
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *    DECLARE THE CURSOR FOR THE SIZE RANGE MEMBERS                        
      ******************************************************************        
                                                                                
           EXEC SQL                                                             
                DECLARE SIZERNG CURSOR FOR                                      
                  SELECT KOHLS_CHLD_SZ_CDE                                      
                    FROM TDSZRNM                                                
                   WHERE KOHLS_PRNT_SZ_CDE = :PV-DB2-SIZE-CDE                   
                ORDER BY KOHLS_CHLD_SZ_CDE                                      
                WITH UR                                                         
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
       LINKAGE SECTION.                                                         
      ******************************************************************        
                                                                                
       01  DFHCOMMAREA.                                                         
           05  FILLER                         OCCURS  1 TO 4072 TIMES           
                                              DEPENDING ON EIBCALEN.            
               10  FILLER                     PIC X.                            
                                                                                
                                                                                
      ******************************************************************        
       PROCEDURE DIVISION.                                                      
      ******************************************************************        
                                                                                
       0000-MAIN-MODULE.                                                        
           MOVE '*0000-MAINLINE.              *' TO DP013-PARAGRAPH.            
           INITIALIZE DP030-CICS-API-FIELDS.                                    
           MOVE +1                       TO DP030-NUMBER-OF-MAPS.               
           MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.                  
           MOVE PC-NEW-MAP-NAME          TO DP030-MAP-NAME (1)                  
           SET DP030-RECEIVE-APPL-MAP    TO TRUE.                               
           MOVE LENGTH OF MH805AI      TO DP030-MAP-LENGTH (1)                  
           MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).             
           PERFORM 0001-CALL-CICS-ARCH-API.                                     
                                                                                
           PERFORM 1000-CONTROL-PROCESSING.                                     
                                                                                
      *    SET CURSOR TO COMMAND FILE                                           
           SET DP030-SET-CURSOR-TRAILER  TO TRUE.                               
                                                                                
           MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).             
           PERFORM 0001-CALL-CICS-ARCH-API.                                     
                                                                                
       0001-CALL-CICS-ARCH-API.                                                 
           MOVE '*0001-CALL-CICS-ARCH-API     *' TO DP013-PARAGRAPH.            
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
                                          DFHCOMMAREA                           
                                          DP030-CICS-API-FIELDS                 
                                          DP020-STANDARD-COMMAREA               
                                          MH805AI.                              
                                                                                
           IF  DP030-RC-CALL-SUCCESSFUL                                         
               CONTINUE                                                         
           ELSE                                                                 
               SET DP013-NO-ROLLBACK     TO TRUE                                
               SET DP013-XCTL-DISPLAY-RESTART TO TRUE                           
               SET DP013-CICS-ABEND      TO TRUE                                
               MOVE 'BEFORE 0000-MAIN-MODULE'                                   
                                         TO DP013-PARAGRAPH                     
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
               MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)              
               PERFORM DP013-0000-PROCESS-ABEND                                 
           END-IF.                                                              
       EJECT                                                                    
      *----------------------------------------------------------------*        
      *    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *        
      *    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *        
      *----------------------------------------------------------------*        
                                                                                
       1000-CONTROL-PROCESSING.                                                 
           MOVE '*1000-CONTROL-PROCESSING     *' TO DP013-PARAGRAPH.            
                                                                                
           EVALUATE TRUE                                                        
               WHEN DP020-NEXT-ACT-INITIAL                                      
                   PERFORM 1050-INITIALIZE                                      
               WHEN DP020-NEXT-ACT-READ-MAP                                     
                   PERFORM 1010-PROCESS-PFKEYS                                  
               WHEN DP020-NEXT-ACT-RETURN                                       
                   PERFORM 4000-EXIT-CHECK                                      
                                                                                
               WHEN OTHER                                                       
                   SET DP013-LOGIC-ABEND TO TRUE                                
                   SET DP013-NO-ROLLBACK TO TRUE                                
                   MOVE '1000-CONTROL-PROCESSING'                               
                                         TO DP013-PARAGRAPH                     
                   MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'           
                                         TO DP013-MESSAGE-TEXT(1)               
                   MOVE DP020-NEXT-APPL-ACTIVITY                                
                                         TO DP013-MESSAGE-TEXT(2)               
                   PERFORM DP013-0000-PROCESS-ABEND                             
           END-EVALUATE.                                                        
                                                                                
           PERFORM 8100-INIT-INQUIRY-ATTR.                                      
           PERFORM 8150-HEADER-ATTR.                                            
                                                                                
      ******************************************************************        
       1010-PROCESS-PFKEYS.                                                     
      ******************************************************************        
           MOVE '*1010-PROCESS-PFKEYS         *' TO DP013-PARAGRAPH.            
                                                                                
      * DETERMINE WHICH MAJOR PATH THE PROGRAM SHOULD FOLLOW DEPENDING          
      * UPON THE PFKEY HIT, USER AUTHORITY, AND PROGRAM INITIALIZATION          
      * STATUS.                                                                 
                                                                                
           EVALUATE TRUE                                                        
      * REFRESH                                                                 
               WHEN DP020-FK-REFRESH (DP020-SRC-AID)                            
                   PERFORM 1050-INITIALIZE                                      
      * ENTER KEY                                                               
               WHEN DP020-SRC-AID = DP016-ENTER                                 
                   PERFORM 1050-INITIALIZE                                      
      * FIRST PAGE                                                              
               WHEN DP020-FK-FIRST-PAGE (DP020-SRC-AID)                         
      * PREVIOUS PAGE                                                           
               WHEN DP020-FK-PREV-PAGE (DP020-SRC-AID)                          
      * NEXT PAGE                                                               
               WHEN DP020-FK-NEXT-PAGE (DP020-SRC-AID)                          
                   PERFORM 2000-PROCESS-SCREEN                                  
      * RE-ALIGN                                                                
      *        WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                         
      *            PERFORM 2000-PROCESS-SCREEN                                  
               WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                         
                   CONTINUE                                                     
               WHEN OTHER                                                       
                   PERFORM 6000-INVALID-PFKEY                                   
           END-EVALUATE.                                                        
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  INITIALIZE SCREEN FIELDS AND THE COMMAREA FOR PROCESSING.     *        
      *  SEND THE MAP AND THE INITIAL DATA.                            *        
      ******************************************************************        
                                                                                
       1050-INITIALIZE.                                                         
           MOVE '*1050-INITIALIZE             *' TO DP013-PARAGRAPH.            
                                                                                
           INITIALIZE  CA-COMM-AREA.                                            
                                                                                
           IF MH000-SKU-NUMBER-X NOT NUMERIC                                    
               MOVE SPACES     TO  MH000-SKU-NUMBER-X                           
                                   MH000-SKU-DESCRIPTION                        
           END-IF.                                                              
                                                                                
      * THIS WILL GET THE DATA FOR THE SKU NUMBER PASSED (IF POSS-              
      * IBLE) AND PUT DATA OUT TO THE SCREEN FOR THE FIRST TIME.                
           PERFORM 1100-FILL-INITIAL-SCREEN.                                    
                                                                                
                                                                                
      ******************************************************************        
      * INITIALIZE THE SCREEN                                                   
      ******************************************************************        
       1100-FILL-INITIAL-SCREEN.                                                
                                                                                
      * WE NEED TO GET THE SKU ROW (TSK) FOR THE SKU AND FILL IN                
      * THAT INFO ON THE SCREEN. SKUS WITH STATUS CODE '98' ARE NOT             
      * AVAILABLE FOR PROCESSING ON THIS SCREEN.                                
           IF MH000-SKU-NUMBER-9  NUMERIC                                       
               MOVE MH000-SKU-NUMBER-9   TO NI-SKU-C3                           
               SET PS-NO-SKU-FOUND TO TRUE                                      
               PERFORM 7000-SELECT-TSK                                          
               IF PS-SKU-FOUND                                                  
                   IF TSK-STATUS-CODE NOT = PC-STATUS-98                        
                      MOVE TSK-SIZE-CDE  TO SIZE-NRF-SIZE-CDE                   
                      PERFORM 7010-GET-SIZE-DESC                                
                      PERFORM 1110-INITIALIZE-NEW-MAP                           
                   ELSE                                                         
                      SET PS-NO-SKU-FOUND         TO TRUE                       
                      MOVE PC-TSYMSG-00440        TO DP020-MSG-NUMBER           
                      SET DP020-MSG-INFORMATIONAL TO TRUE                       
                   END-IF                                                       
               ELSE                                                             
                  SET PS-NO-SKU-FOUND         TO TRUE                           
                  MOVE PC-TSYMSG-00073        TO DP020-MSG-NUMBER               
                  SET DP020-MSG-INFORMATIONAL TO TRUE                           
               END-IF                                                           
           END-IF.                                                              
                                                                                
                                                                                
      * IF THE SKU NUMBER ENTERED WAS OK, THEN WE HAVE TO GET THE               
      * VENDOR NAME FOR SCREEN DISPLAY, FIND OUT IF THE VENDOR IS               
      * EDI, AND GET THE UPCS ALREADY ON THE TUPCSKU TABLE AND DIS-             
      * PLAY THEM ON THE INITIAL OUTPUT SCREEN.                                 
           IF PS-SKU-FOUND                                                      
               PERFORM 1200-GET-VENDOR-NAME                                     
               PERFORM 9950-DELETE-TS-QUEUE                                     
               PERFORM 1800-BUILD-TS-QUEUE                                      
               IF PS-DID-FIND-UPCS                                              
                   COMPUTE TS-QUEUE-RECORD-NUM =                                
                      (((CA-SCREEN-PAGE - 1) *                                  
                            PC-UPCS-PER-PAGE) + 1)                              
                   MOVE TS-QUEUE-RECORD-NUM TO PV-THIS-LINE-NUM                 
                   MOVE ZERO TO CA-UPCS-ON-PAGE                                 
                   PERFORM 8400-FILL-OUTPUT-MAP                                 
               END-IF                                                           
           END-IF.                                                              
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  INITIALIZE THE NEW SCREEN INFORMATION FOR SKU DEPARTMENTS THAT         
      *  HAVE BEEN CONVERTED TO VSM.                                            
      ******************************************************************        
                                                                                
       1110-INITIALIZE-NEW-MAP.                                                 
                                                                                
                                                                                
           MOVE PC-LOW-VALUES TO PM-AHEADING-AREA                               
                                 PM-ATABLE-FILLER                               
                                                                                
           SET DP030-ERASE                                                      
               DP030-SEND-MAP-AND-DATA (1) TO TRUE.                             
                                                                                
           MOVE NI-DEPT-X-3             TO MH000-DEPT-NUMBER-X                  
                                           ADEPTO.                              
           MOVE NI-CLASS-X-2            TO MH000-MCL-NUMBER-X                   
                                           AMJCLSO.                             
           MOVE NI-SUB-CLASS-X-2        TO MH000-SCL-NUMBER-X                   
                                           ASBCLSO.                             
           MOVE NI-SKU                  TO MH000-SKU-NUMBER-X                   
                                           ASKUO.                               
           MOVE TSK-ITEM-NMBR           TO CA-OLD-ITEM-NUMBER.                  
           MOVE TSK-SKU-DESC            TO CA-DESCRIPTION                       
                                           ADESCO.                              
                                                                                
           IF TSK-LONG-VENDOR-STYLE = SPACES                                    
              MOVE TSK-VENDOR-STYLE-CODE TO CA-VENDOR-STYLE                     
                                            AVDRSTYO                            
           ELSE                                                                 
              MOVE TSK-LONG-VENDOR-STYLE TO CA-VENDOR-STYLE                     
                                            AVDRSTYO                            
           END-IF.                                                              
                                                                                
      ******************************************************************        
      *  FIND THE VENDOR NAME FOR THE NUMERIC VENDOR NUMBER ENTERED             
      *  ON THE SCREEN.                                                         
      ******************************************************************        
                                                                                
       1200-GET-VENDOR-NAME.                                                    
           MOVE '*1200-GET-VENDOR-NAME        *' TO DP013-PARAGRAPH.            
                                                                                
           SET PS-VENDOR-NAME-NOT-FOUND TO TRUE.                                
                                                                                
           PERFORM 1300-SELECT-VENDOR.                                          
                                                                                
                                                                                
           IF PS-VENDOR-NAME-FOUND                                              
              MOVE XMT00000-PRIM-VND-NM TO AVENDORO                             
                                           CA-VENDOR-NAME                       
           ELSE                                                                 
              MOVE PC-NO-VENDOR TO AVENDORO                                     
                                   CA-VENDOR-NAME                               
           END-IF.                                                              
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  GET THE VENDOR NAME FROM VENDOR TABLE XMT_VND.  IF ANY ERRORS *        
      *  ARE DETECTED, AN ERROR MESSAGE WILL BE FORMATTED AND SENT TO  *        
      *  THE SCREEN AND CONTROL WILL BE RETURNED TO NATIVE CICS.       *        
      ******************************************************************        
                                                                                
       1300-SELECT-VENDOR.                                                      
                                                                                
           MOVE '*1300-SELECT-VENDOR          *' TO DP013-PARAGRAPH.            
                                                                                
           INITIALIZE PV-RETRY-COUNT.                                           
           MOVE TSK-ENT-ID TO PV-ENT-ID.                                        
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               UNTIL SQLCODE = ZERO                                             
                  OR SQLCODE = +100                                             
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                    
                                                                                
               EXEC SQL                                                         
                    SELECT PRIM_VND_NM                                          
                      INTO :XMT00000-PRIM-VND-NM                                
                      FROM XMT_VND                                              
                     WHERE ENT_ID = :PV-ENT-ID                                  
                     WITH UR                                                    
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = ZERO                                          
                        CONTINUE                                                
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                        ADD +1 TO PV-RETRY-COUNT                                
                   WHEN SQLCODE < ZERO                                          
                   WHEN ((SQLCODE > ZERO) AND (SQLCODE NOT = +100))             
                   WHEN SQLWARN0 NOT = SPACES                                   
                       MOVE 'SELECT VENDOR NAME FROM TABLE XMT_VND'             
                                          TO DP013-MESSAGE-TEXT(1)              
                       PERFORM 9850-DB2-ERROR                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   SET PS-VENDOR-NAME-FOUND TO TRUE                             
               WHEN SQLCODE = -911                                              
               WHEN SQLCODE = -913                                              
                   MOVE 'SELECT VENDOR NAME FROM TABLE XMT_VND'                 
                                          TO DP013-MESSAGE-TEXT(1)              
                   PERFORM 9850-DB2-ERROR                                       
               WHEN SQLCODE = +100                                              
                   SET PS-VENDOR-NAME-NOT-FOUND TO TRUE                         
           END-EVALUATE.                                                        
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  BUILD THE INITIAL TEMP STORAGE QUEUE FROM THE ROWS ON THE              
      *  UPC/SKU (TUPCSKU) TABLE FOR THE CURRENT SKU. TWO CURSORS               
      *  ARE USED TO GET THE UPC ROWS - THE FIRST CURSOR GETS ONLY THE          
      *  INTERNAL UPCS (THOSE STARTING WITH '04') - THE SECOND CURSOR           
      *  GETS ALL THE REST OF THE UPCS FOR THIS SKU. THIS IS DONE SO            
      *  THAT THE INTERNAL UPCS WILL ALWAYS APPEAR FIRST ON THE SCREEN.         
      ******************************************************************        
                                                                                
       1800-BUILD-TS-QUEUE.                                                     
           MOVE '*1800-BUILD-TS-QUEUE         *' TO DP013-PARAGRAPH.            
                                                                                
           MOVE CA-OLD-ITEM-NUMBER TO PV-DB2-ITEM-NMBR.                         
                                                                                
           EXEC SQL                                                             
               OPEN INTRNUPC                                                    
           END-EXEC.                                                            
                                                                                
           IF SQLCODE = ZERO                                                    
               CONTINUE                                                         
           ELSE                                                                 
               MOVE PC-ERR-MSG-1 TO DP013-MESSAGE-TEXT(1)                       
               PERFORM 9850-DB2-ERROR                                           
           END-IF.                                                              
                                                                                
           SET PS-NO-UPCS-FOUND TO TRUE.                                        
           SET CA-DONT-HAVE-UPC-LINES TO TRUE.                                  
           SET PS-NOT-END-OF-UPC-TABLE TO TRUE.                                 
                                                                                
           PERFORM 1850-INTERNAL-UPC-TABLE                                      
               UNTIL PS-END-OF-UPC-TABLE.                                       
                                                                                
           EXEC SQL                                                             
               CLOSE INTRNUPC                                                   
           END-EXEC.                                                            
                                                                                
           IF SQLCODE = ZERO                                                    
               CONTINUE                                                         
           ELSE                                                                 
               MOVE PC-ERR-MSG-3 TO DP013-MESSAGE-TEXT(1)                       
               PERFORM 9950-DELETE-TS-QUEUE                                     
               PERFORM 9850-DB2-ERROR                                           
           END-IF.                                                              
                                                                                
           EXEC SQL                                                             
               OPEN UPCSKU                                                      
           END-EXEC.                                                            
                                                                                
           IF SQLCODE = ZERO                                                    
               CONTINUE                                                         
           ELSE                                                                 
               MOVE PC-ERR-MSG-1 TO DP013-MESSAGE-TEXT(1)                       
               PERFORM 9850-DB2-ERROR                                           
           END-IF.                                                              
                                                                                
           SET PS-NOT-END-OF-UPC-TABLE TO TRUE.                                 
           SET PS-NO-EXT-UPCS-FOUND TO TRUE.                                    
                                                                                
           PERFORM 1900-EXTERNAL-UPC-TABLE                                      
               UNTIL PS-END-OF-UPC-TABLE.                                       
                                                                                
           EXEC SQL                                                             
               CLOSE UPCSKU                                                     
           END-EXEC.                                                            
                                                                                
           IF SQLCODE = ZERO                                                    
               CONTINUE                                                         
           ELSE                                                                 
               MOVE PC-ERR-MSG-3 TO DP013-MESSAGE-TEXT(1)                       
               PERFORM 9950-DELETE-TS-QUEUE                                     
               PERFORM 9850-DB2-ERROR                                           
           END-IF.                                                              
                                                                                
           MOVE SIZE-KOHLS-SIZE-CDE  TO PV-DB2-SIZE-CDE.                        
                                                                                
      *** IF WE HAVE AN INTERNAL UPC WITHOUT ANY VENDOR UPC'S AND               
      *** THE SKU STRATEGY INVOLVES A SIZE RANGE (CODE >= 98000)                
      *** AND THE DEPARTMENT HAS CONVERTED TO VENDOR STYLE MANAGEMENT,          
      *** ALL OF THE SIZE INFORMATION THAT MAKE UP THE SIZE RANGE               
      *** SHOULD BE DISPLAYED BELOW THE INTERNAL UPC.                           
                                                                                
           IF ( PS-DID-FIND-UPCS )     AND                                      
              ( PS-UPC-INFO-FOUND )    AND                                      
              ( PS-NO-EXT-UPCS-FOUND ) AND                                      
              ( PV-DB2-SIZE-CDE >= PC-MIN-NRF-RANGE-CDE )                       
               EXEC SQL                                                         
                   OPEN SIZERNG                                                 
               END-EXEC                                                         
                                                                                
               IF SQLCODE = ZERO                                                
                   CONTINUE                                                     
               ELSE                                                             
                   MOVE PC-ERR-MSG-6 TO DP013-MESSAGE-TEXT(1)                   
                   PERFORM 9850-DB2-ERROR                                       
               END-IF                                                           
                                                                                
               SET PS-NOT-END-OF-SIZE-CODES TO TRUE                             
                                                                                
               PERFORM 1950-GET-SIZE-CODES                                      
                   UNTIL PS-END-OF-SIZE-CODES                                   
                                                                                
               EXEC SQL                                                         
                   CLOSE SIZERNG                                                
               END-EXEC                                                         
                                                                                
               IF SQLCODE = ZERO                                                
                   CONTINUE                                                     
               ELSE                                                             
                   MOVE PC-ERR-MSG-8 TO DP013-MESSAGE-TEXT(1)                   
                   PERFORM 9950-DELETE-TS-QUEUE                                 
                   PERFORM 9850-DB2-ERROR                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF PS-DID-FIND-UPCS                                                  
               SET CA-HAVE-UPC-LINES TO TRUE                                    
               MOVE +1 TO CA-SCREEN-PAGE                                        
           END-IF.                                                              
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  SELECT ALL THE INTERNAL UPC ROWS FROM THE UPC/SKU AND WRITE            
      *  THEM OUT TO A TEMP STORAGE QUEUE                                       
      ******************************************************************        
                                                                                
       1850-INTERNAL-UPC-TABLE.                                                 
           MOVE '*1850-INTERNAL-UPC-TABLE     *' TO DP013-PARAGRAPH.            
                                                                                
           INITIALIZE PV-RETRY-COUNT.                                           
                                                                                
           PERFORM WITH TEST AFTER                                              
                   UNTIL ((SQLCODE = ZERO)                                      
                                OR                                              
                          (SQLCODE = +100)                                      
                                OR                                              
                          (PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT))            
               EXEC SQL                                                         
                   FETCH INTRNUPC                                               
                   INTO :TUPCSKU-UPC-NBR,                                       
                        :TUPCSKU-EDI-ORD-IND,                                   
                        :TUPCSKU-PLU-DWNLD-IND,                                 
                        :TUPCSKU-XREF-CRE-DTE,                                  
                        :TUPCSKU-CERT-IND                                       
               END-EXEC                                                         
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       ADD +1 TO PV-RETRY-COUNT                                 
                   WHEN SQLCODE = ZERO                                          
                       SET PS-DID-FIND-UPCS TO TRUE                             
                   WHEN SQLCODE = +100                                          
                       SET PS-END-OF-UPC-TABLE TO TRUE                          
                   WHEN SQLCODE < ZERO                                          
                   WHEN ((SQLCODE > ZERO) AND (SQLCODE NOT = +100))             
                   WHEN SQLWARN0 NOT = SPACES                                   
                       MOVE PC-ERR-MSG-4 TO DP013-MESSAGE-TEXT(1)               
                       PERFORM 9950-DELETE-TS-QUEUE                             
                       PERFORM 9850-DB2-ERROR                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF ((SQLCODE = -911)                                                 
                     OR                                                         
               (SQLCODE = -913))                                                
               MOVE 'SELECTING INTERNAL UPCS FROM THE UPC                       
      -             'TABLE (INTRNUPC)' TO DP013-MESSAGE-TEXT(1)                 
               PERFORM 9850-DB2-ERROR                                           
           END-IF.                                                              
                                                                                
                                                                                
      * FILL IN TEMP STORAGE RECORD AND WRITE OUT TO TEMP STORAGE               
           IF PS-END-OF-UPC-TABLE                                               
               CONTINUE                                                         
           ELSE                                                                 
               PERFORM 1910-FORMAT-TS-RECORD                                    
           END-IF.                                                              
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  SELECT ALL THE EXTERNAL UPC ROWS FROM THE UPC/SKU AND WRITE            
      *  THEM OUT TO A TEMP STORAGE QUEUE                                       
      ******************************************************************        
                                                                                
       1900-EXTERNAL-UPC-TABLE.                                                 
           MOVE '*1900-EXTERNAL-UPC-TABLE     *' TO DP013-PARAGRAPH.            
                                                                                
           INITIALIZE PV-RETRY-COUNT.                                           
                                                                                
           PERFORM WITH TEST AFTER                                              
                   UNTIL ((SQLCODE = ZERO)                                      
                                OR                                              
                          (SQLCODE = +100)                                      
                                OR                                              
                          (PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT))            
               EXEC SQL                                                         
                   FETCH UPCSKU                                                 
                   INTO :TUPCSKU-UPC-NBR,                                       
                        :TUPCSKU-EDI-ORD-IND,                                   
                        :TUPCSKU-PLU-DWNLD-IND,                                 
                        :TUPCSKU-XREF-CRE-DTE,                                  
                        :TUPCSKU-CERT-IND                                       
               END-EXEC                                                         
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       ADD +1 TO PV-RETRY-COUNT                                 
                   WHEN SQLCODE = ZERO                                          
                       SET PS-DID-FIND-UPCS    TO TRUE                          
                       SET PS-EXT-UPCS-FOUND   TO TRUE                          
                   WHEN SQLCODE = +100                                          
                       SET PS-END-OF-UPC-TABLE TO TRUE                          
                   WHEN SQLCODE < ZERO                                          
                   WHEN ((SQLCODE > ZERO) AND (SQLCODE NOT = +100))             
                   WHEN SQLWARN0 NOT = SPACES                                   
                       MOVE PC-ERR-MSG-5 TO DP013-MESSAGE-TEXT(1)               
                       PERFORM 9950-DELETE-TS-QUEUE                             
                       PERFORM 9850-DB2-ERROR                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF ((SQLCODE = -911)                                                 
                     OR                                                         
               (SQLCODE = -913))                                                
               MOVE 'SELECTING EXTERNAL UPCS FROM THE UPC                       
      -             'TABLE (UPCSKU)' TO DP013-MESSAGE-TEXT(1)                   
               PERFORM 9850-DB2-ERROR                                           
           END-IF.                                                              
                                                                                
      * FILL IN TEMP STORAGE RECORD AND WRITE OUT TO TEMP STORAGE               
           IF PS-END-OF-UPC-TABLE                                               
               CONTINUE                                                         
           ELSE                                                                 
               PERFORM 1910-FORMAT-TS-RECORD                                    
           END-IF.                                                              
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  FORMAT A TEMP STORAGE RECORDS FROM THE CURRENT UPCSKU ROW.             
      ******************************************************************        
                                                                                
       1910-FORMAT-TS-RECORD.                                                   
           MOVE '*1910-FORMAT-TS-RECORD       *' TO DP013-PARAGRAPH.            
                                                                                
           INITIALIZE TS-QUEUE-RECORD-LAYOUT.                                   
           SET TS-EXISTING-UPC         TO TRUE.                                 
           MOVE TUPCSKU-UPC-NBR        TO TS-UPC-NBR.                           
           MOVE TUPCSKU-EDI-ORD-IND    TO TS-EDI-ORD-IND                        
                                          TS-ORIG-EDI-ORD-IND.                  
           MOVE TUPCSKU-PLU-DWNLD-IND  TO TS-PLU-DWNLD-IND.                     
           MOVE TUPCSKU-XREF-CRE-DTE   TO PV-XREF-CRE-DTE-CCYYMMDD.             
           PERFORM 8350-CONVERT-DATES.                                          
           MOVE PV-XREF-CRE-DTE-MMDDCCYY TO TS-XREF-CRE-DTE.                    
                                                                                
           MOVE TUPCSKU-CERT-IND       TO TS-CERT-REQ-IND.                      
                                                                                
           PERFORM 1920-GET-ADDITIONAL-UPC-INFO                                 
                                                                                
           PERFORM 9600-WRITE-TS-QUEUE.                                         
                                                                                
           ADD +1                TO CA-NUM-OF-TS-RECORDS.                       
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  SELECT ALL THE INTERNAL UPC ROWS FROM THE UPC/SKU AND WRITE            
      *  THEM OUT TO A TEMP STORAGE QUEUE                                       
      ******************************************************************        
                                                                                
       1920-GET-ADDITIONAL-UPC-INFO.                                            
                                                                                
           MOVE SPACES                    TO TS-CNRF                            
                                             TS-SRCE                            
                                             TS-CDSC                            
                                             TS-SNRF                            
                                             TS-SDSC.                           
                                                                                
           MOVE TUPCSKU-UPC-NBR        TO UPC-UPC-NBR.                          
           PERFORM 1930-GET-COLOR-SIZE-UPC-INFO.                                
                                                                                
           IF PS-UPC-INFO-FOUND                                                 
                 MOVE UPC-NRF-CLOR-CDE          TO TS-CNRF                      
                 MOVE UPC-UPC-TYP-CDE           TO TS-SRCE                      
                                                                                
                 IF UPC-CSTM-CLOR-DESC > SPACES                                 
                     MOVE UPC-CSTM-CLOR-DESC    TO TS-CDSC                      
                 ELSE                                                           
                    MOVE UPC-NRF-CLOR-CDE       TO COLOR-NRF-CLOR-CDE           
                    PERFORM 1940-GET-TCOLOR-DESC                                
                    IF PS-TCOLOR-FOUND                                          
                       MOVE COLOR-NRF-CLOR-DESC TO TS-CDSC                      
                    ELSE                                                        
                       MOVE SPACES              TO TS-CDSC                      
                    END-IF                                                      
                 END-IF                                                         
                                                                                
                 MOVE UPC-KOHLS-SIZE-CDE        TO SIZE-KOHLS-SIZE-CDE          
                 PERFORM 7040-GET-SIZE-DESC                                     
                                                                                
                 IF PS-SIZE-DESC-FOUND                                          
                    MOVE SIZE-NRF-SIZE-CDE      TO TS-SNRF                      
                    MOVE SIZE-KOHLS-DESC        TO TS-SDSC                      
                 ELSE                                                           
                    MOVE SPACES                 TO TS-SNRF                      
                                                   TS-SDSC                      
                 END-IF                                                         
              END-IF.                                                           
                                                                                
      ******************************************************************        
      *  SELECT ALL THE INTERNAL UPC ROWS FROM THE UPC/SKU AND WRITE            
      *  THEM OUT TO A TEMP STORAGE QUEUE                                       
      ******************************************************************        
                                                                                
       1930-GET-COLOR-SIZE-UPC-INFO.                                            
           MOVE '*1930-GET-COLOR-SIZE-UPC-INFO*' TO DP013-PARAGRAPH.            
                                                                                
           INITIALIZE PV-RETRY-COUNT.                                           
                                                                                
           PERFORM WITH TEST AFTER                                              
                   UNTIL ((SQLCODE = ZERO)                                      
                                OR                                              
                          (SQLCODE = +100)                                      
                                OR                                              
                          (PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT))            
               EXEC SQL                                                         
                   SELECT NRF_CLOR_CDE                                          
                        , CSTM_CLOR_DESC                                        
                        , KOHLS_SIZE_CDE                                        
                        , UPC_TYP_CDE                                           
                    INTO :UPC-NRF-CLOR-CDE                                      
                        ,:UPC-CSTM-CLOR-DESC                                    
                        ,:UPC-KOHLS-SIZE-CDE                                    
                        ,:UPC-UPC-TYP-CDE                                       
                   FROM TUPC                                                    
                   WHERE UPC_NBR      = :UPC-UPC-NBR                            
                     AND (EFF_END_DTE IS NULL OR                                
                          EFF_END_DTE > CURRENT DATE)                           
                 WITH UR                                                        
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       ADD +1 TO PV-RETRY-COUNT                                 
                   WHEN SQLCODE = ZERO                                          
                       SET PS-UPC-INFO-FOUND TO TRUE                            
                   WHEN SQLCODE = +100                                          
                       SET PS-UPC-INFO-NOT-FOUND TO TRUE                        
                   WHEN SQLCODE  NOT = ZERO                                     
                   WHEN SQLWARN0 NOT = SPACES                                   
                       MOVE PC-ERR-MSG-4 TO DP013-MESSAGE-TEXT(1)               
                       PERFORM 9950-DELETE-TS-QUEUE                             
                       PERFORM 9850-DB2-ERROR                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF ((SQLCODE = -911)                                                 
                     OR                                                         
               (SQLCODE = -913))                                                
               MOVE 'SELECTING ADDITIONAL UPC COLOR AND SIZE INFO               
      -             'TABLE (TUPC)' TO DP013-MESSAGE-TEXT(1)                     
               PERFORM 9850-DB2-ERROR                                           
           END-IF.                                                              
                                                                                
           EJECT                                                                
      ******************************************************************        
      *  SELECT ALL THE INTERNAL UPC ROWS FROM THE UPC/SKU AND WRITE            
      *  THEM OUT TO A TEMP STORAGE QUEUE                                       
      ******************************************************************        
                                                                                
       1940-GET-TCOLOR-DESC.                                                    
           MOVE '*1940-GET-COLOR-DESC         *' TO DP013-PARAGRAPH.            
                                                                                
           INITIALIZE PV-RETRY-COUNT.                                           
                                                                                
           PERFORM WITH TEST AFTER                                              
                   UNTIL ((SQLCODE = ZERO)                                      
                                OR                                              
                          (SQLCODE = +100)                                      
                                OR                                              
                          (PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT))            
               EXEC SQL                                                         
                  SELECT NRF_CLOR_DESC                                          
                    INTO :COLOR-NRF-CLOR-DESC                                   
                    FROM TCOLOR                                                 
                   WHERE NRF_CLOR_CDE  = :COLOR-NRF-CLOR-CDE                    
                    WITH UR                                                     
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       ADD +1 TO PV-RETRY-COUNT                                 
                   WHEN SQLCODE = ZERO                                          
                       SET PS-TCOLOR-FOUND TO TRUE                              
                   WHEN SQLCODE = +100                                          
                       SET PS-TCOLOR-NOT-FOUND TO TRUE                          
                   WHEN SQLCODE  NOT = ZERO                                     
                   WHEN SQLWARN0 NOT = SPACES                                   
                       MOVE PC-ERR-MSG-4 TO DP013-MESSAGE-TEXT(1)               
                       PERFORM 9950-DELETE-TS-QUEUE                             
                       PERFORM 9850-DB2-ERROR                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF ((SQLCODE = -911)                                                 
                     OR                                                         
               (SQLCODE = -913))                                                
               MOVE 'SELECTING TCOLOR DESCRIPTION                               
      -             'TABLE (TCOLOR)' TO DP013-MESSAGE-TEXT(1)                   
               PERFORM 9850-DB2-ERROR                                           
           END-IF.                                                              
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  SELECT ALL THE SIZE CODES WITHIN A SIZE RANGE, RETRIEVE THE            
      *  CORRESPONDING SIZE DESCRIPTION AND WRITE THEM OUT TO A TEMP            
      *  STORAGE QUEUE                                                          
      ******************************************************************        
                                                                                
       1950-GET-SIZE-CODES.                                                     
           MOVE '*1950-GET-SIZE-CODES         *' TO DP013-PARAGRAPH.            
                                                                                
           INITIALIZE PV-RETRY-COUNT.                                           
                                                                                
           PERFORM WITH TEST AFTER                                              
                   UNTIL ((SQLCODE = ZERO)                                      
                                OR                                              
                          (SQLCODE = +100)                                      
                                OR                                              
                          (PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT))            
               EXEC SQL                                                         
                   FETCH SIZERNG                                                
                   INTO :DSZRNM-KOHLS-CHLD-SZ-CDE                               
               END-EXEC                                                         
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       ADD +1 TO PV-RETRY-COUNT                                 
                   WHEN SQLCODE = ZERO                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = +100                                          
                       SET PS-END-OF-SIZE-CODES TO TRUE                         
                   WHEN SQLCODE < ZERO                                          
                   WHEN ((SQLCODE > ZERO) AND (SQLCODE NOT = +100))             
                   WHEN SQLWARN0 NOT = SPACES                                   
                       MOVE PC-ERR-MSG-7 TO DP013-MESSAGE-TEXT(1)               
                       PERFORM 9950-DELETE-TS-QUEUE                             
                       PERFORM 9850-DB2-ERROR                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF ((SQLCODE = -911)                                                 
                     OR                                                         
               (SQLCODE = -913))                                                
               MOVE 'SELECTING SIZE CODES FROM TDSZRNM'                         
                                        TO DP013-MESSAGE-TEXT(1)                
               PERFORM 9850-DB2-ERROR                                           
           END-IF.                                                              
                                                                                
      * FILL IN TEMP STORAGE RECORD AND WRITE OUT TO TEMP STORAGE               
           IF PS-END-OF-SIZE-CODES                                              
               CONTINUE                                                         
           ELSE                                                                 
               PERFORM 1960-FORMAT-SIZE-TS-RECORD                               
           END-IF.                                                              
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  FORMAT A TEMP STORAGE RECORDS FROM THE CURRENT TDSZRNM ROW.            
      *  THESE RECORDS WILL CONTAIN THE INDIVIDUAL SIZES INCLUDED IN            
      *  THE SIZE RANGE FOUND ON THE TDSZRNM TABLE AND THE COLOR                
      *  INFORMATION FROM THE ORIGINAL INTERNAL UPC RECORD.                     
      ******************************************************************        
                                                                                
       1960-FORMAT-SIZE-TS-RECORD.                                              
           MOVE '*1960-FORMAT-SIZE-TS-RECORD  *' TO DP013-PARAGRAPH.            
                                                                                
           MOVE TS-CNRF                   TO PV-HOLD-CNRF.                      
           MOVE TS-CDSC                   TO PV-HOLD-CDSC.                      
                                                                                
           INITIALIZE TS-QUEUE-RECORD-LAYOUT.                                   
                                                                                
           MOVE PV-HOLD-CNRF              TO TS-CNRF.                           
           MOVE PV-HOLD-CDSC              TO TS-CDSC.                           
                                                                                
           MOVE SPACES                    TO TS-SNRF                            
                                             TS-SDSC.                           
                                                                                
           MOVE DSZRNM-KOHLS-CHLD-SZ-CDE  TO SIZE-KOHLS-SIZE-CDE.               
           PERFORM 7040-GET-SIZE-DESC.                                          
                                                                                
           IF PS-SIZE-DESC-FOUND                                                
              MOVE SIZE-NRF-SIZE-CDE      TO TS-SNRF                            
              MOVE SIZE-KOHLS-DESC        TO TS-SDSC                            
           ELSE                                                                 
              MOVE SPACES                 TO TS-SNRF                            
                                             TS-SDSC                            
           END-IF.                                                              
                                                                                
           PERFORM 9600-WRITE-TS-QUEUE.                                         
                                                                                
           ADD +1                TO CA-NUM-OF-TS-RECORDS.                       
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  PROCESS INFORMATION ENTERED ON THE SCREEN. RECEIVE THE MAP             
      *  AND FILL THE COMMAREA FIELDS FROM THE MAP FIELDS. UPDATE THE           
      *  SCREEN HEADER IN PREPARATION FOR EVENTUAL SENDING BACK OUT TO          
      *  TERMINAL. RESET THE ATTRIBUTES FOR THE PROGRAM KEY FIELDS BACK         
      *  TO THE DEFAULTS. EDIT THE SCREEN FIELDS.                               
      ******************************************************************        
                                                                                
       2000-PROCESS-SCREEN.                                                     
           MOVE '*2000-PROCESS-SCREEN         *' TO DP013-PARAGRAPH.            
                                                                                
           PERFORM 2100-FILL-COMMAREA.                                          
                                                                                
           PERFORM 8000-UPDATE-SCREEN-HEADER.                                   
                                                                                
           IF CA-HAVE-UPC-LINES                                                 
              EVALUATE TRUE                                                     
                  WHEN DP020-FK-FIRST-PAGE (DP020-SRC-AID)                      
                  WHEN DP020-FK-PREV-PAGE (DP020-SRC-AID)                       
                  WHEN DP020-FK-NEXT-PAGE (DP020-SRC-AID)                       
                      CONTINUE                                                  
                  WHEN OTHER                                                    
                      PERFORM 3000-SPECIFIC-PAGE                                
              END-EVALUATE                                                      
           END-IF.                                                              
                                                                                
      * THE USER HAS REQUESTED TO SEE PAGE 1                                    
           IF DP020-FK-FIRST-PAGE (DP020-SRC-AID) AND                           
              CA-HAVE-UPC-LINES                                                 
              MOVE +1 TO CA-SCREEN-PAGE                                         
              PERFORM 3000-SPECIFIC-PAGE                                        
           END-IF.                                                              
                                                                                
      * THE USER HAS REQUESTED TO SEE THE PREVIOUS PAGE                         
           IF DP020-FK-PREV-PAGE (DP020-SRC-AID) AND                            
              CA-HAVE-UPC-LINES                                                 
              PERFORM 3100-PF7-PAGE-BACK                                        
           END-IF.                                                              
                                                                                
      * THE USER HAS REQUESTED TO SEE THE NEXT PAGE                             
           IF DP020-FK-NEXT-PAGE (DP020-SRC-AID) AND                            
              CA-HAVE-UPC-LINES                                                 
              PERFORM 3200-PF8-PAGE-FORWARD                                     
           END-IF.                                                              
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  MOVE MAP FIELDS TO THE COMMUNICATIONS AREA.                   *        
      ******************************************************************        
                                                                                
       2100-FILL-COMMAREA.                                                      
           MOVE '*2100-FILL-COMMAREA          *' TO DP013-PARAGRAPH.            
                                                                                
      * MOVE UPC LINES FROM SCREEN. THE UPC LINE FIELDS WHICH ARE               
      * USER ENTERABLE FIELDS ARE MOVED FROM THE MAP REDEFINITION AREA          
      * TO THE COMMAREA UPC FIELDS.                                             
           IF CA-HAVE-UPC-LINES                                                 
              PERFORM                                                           
                VARYING PM-AUPC-INDEX FROM 1 BY +1                              
                    UNTIL PM-AUPC-INDEX GREATER THAN PC-UPCS-PER-PAGE           
                SET CA-UPC-INDEX TO PM-AUPC-INDEX                               
                                                                                
                MOVE CA-UPC-SYSTEM    (CA-UPC-INDEX) TO                         
                     PM-AUPC-SYSTEM   (PM-AUPC-INDEX)                           
                MOVE CA-UPC-VENDOR    (CA-UPC-INDEX) TO                         
                     PM-AUPC-VENDOR   (PM-AUPC-INDEX)                           
                MOVE CA-UPC-ITEM      (CA-UPC-INDEX) TO                         
                     PM-AUPC-ITEM     (PM-AUPC-INDEX)                           
                MOVE CA-UPC-CHK-DIG   (CA-UPC-INDEX) TO                         
                     PM-AUPC-CHK-DIG  (PM-AUPC-INDEX)                           
                MOVE CA-EDI-IND       (CA-UPC-INDEX) TO                         
                     PM-AEDI-IND      (PM-AUPC-INDEX)                           
                MOVE CA-POS-IND       (CA-UPC-INDEX) TO                         
                     PM-APOS-IND      (PM-AUPC-INDEX)                           
                MOVE CA-CNRF          (CA-UPC-INDEX) TO                         
                     PM-AUPC-CNRF     (PM-AUPC-INDEX)                           
                MOVE CA-CDSC          (CA-UPC-INDEX) TO                         
                     PM-AUPC-CDSC     (PM-AUPC-INDEX)                           
                MOVE CA-SNRF          (CA-UPC-INDEX) TO                         
                     PM-AUPC-SNRF     (PM-AUPC-INDEX)                           
                MOVE CA-SDSC          (CA-UPC-INDEX) TO                         
                     PM-AUPC-SDSC     (PM-AUPC-INDEX)                           
                MOVE CA-SRCE          (CA-UPC-INDEX) TO                         
                     PM-AUPC-SRCE     (PM-AUPC-INDEX)                           
                                                                                
              END-PERFORM                                                       
           END-IF.                                                              
                                                                                
           EJECT                                                                
                                                                                
                                                                                
      ******************************************************************        
      *  SEND THE FIRST PAGE'S OUTPUT BACK TO THE SCREEN.                       
      *  AFTER THE LINES ON THE PAGE ARE SENT OUT, ANY POSSIBLE                 
      *  REMAINING BLANK LINES HAVE TO BE RE-INITIALIZED TO EMPTY.              
      ******************************************************************        
                                                                                
       3000-SPECIFIC-PAGE.                                                      
           MOVE '*3000-SPECIFIC-PAGE          *' TO DP013-PARAGRAPH.            
                                                                                
           COMPUTE TS-QUEUE-RECORD-NUM =                                        
              (((CA-SCREEN-PAGE - 1) *                                          
                    PC-UPCS-PER-PAGE) + 1).                                     
           MOVE TS-QUEUE-RECORD-NUM TO PV-THIS-LINE-NUM.                        
           MOVE ZERO TO CA-UPCS-ON-PAGE.                                        
           PERFORM 8400-FILL-OUTPUT-MAP.                                        
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  SEND THE PREVIOUS PAGE'S OUTPUT BACK TO THE SCREEN.                    
      ******************************************************************        
                                                                                
       3100-PF7-PAGE-BACK.                                                      
           MOVE '*3100-PF7-PAGE-BACK          *' TO DP013-PARAGRAPH.            
                                                                                
           IF CA-SCREEN-PAGE > 1                                                
               MOVE ZERO TO CA-UPCS-ON-PAGE                                     
               COMPUTE TS-QUEUE-RECORD-NUM =                                    
                  (((CA-SCREEN-PAGE - 2) * PC-UPCS-PER-PAGE) + 1)               
               MOVE TS-QUEUE-RECORD-NUM TO PV-THIS-LINE-NUM                     
               PERFORM 8400-FILL-OUTPUT-MAP                                     
               SUBTRACT 1 FROM CA-SCREEN-PAGE                                   
           ELSE                                                                 
               MOVE +1 TO CA-SCREEN-PAGE                                        
               PERFORM 3000-SPECIFIC-PAGE                                       
               MOVE 420 TO DP020-MSG-NUMBER                                     
               MOVE PC-TSYMSG-00420 TO DP020-MSG-NUMBER                         
               SET DP020-MSG-INFORMATIONAL TO TRUE                              
           END-IF.                                                              
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  SEND THE NEXT PAGE'S OUTPUT BACK TO THE SCREEN.                        
      *  IF THE USER HAS UPDATE AUTHORITY AND THE CURRENT PAGE IS               
      *  TOTALLY FULL, THEN SEND OUT ONE BLANK PAGE TO ALLOW FOR ENTRY          
      *  OF MORE NEW UPC LINES.                                                 
      ******************************************************************        
                                                                                
       3200-PF8-PAGE-FORWARD.                                                   
           MOVE '*3200-PF8-PAGE-FORWARD       *' TO DP013-PARAGRAPH.            
                                                                                
           PERFORM                                                              
               VARYING PM-AUPC-INDEX FROM 1 BY 1                                
                   UNTIL PM-AUPC-INDEX > PC-UPCS-PER-PAGE                       
               MOVE SPACES TO PM-AUPC-TABLE (PM-AUPC-INDEX)                     
           END-PERFORM.                                                         
                                                                                
           COMPUTE PV-MAX-PAGE-NUMBER =                                         
                   ((CA-NUM-OF-TS-RECORDS + PC-UPCS-PER-PAGE - 1)/              
                                PC-UPCS-PER-PAGE).                              
                                                                                
           IF PV-MAX-PAGE-NUMBER > CA-SCREEN-PAGE                               
               MOVE ZERO TO CA-UPCS-ON-PAGE                                     
               COMPUTE TS-QUEUE-RECORD-NUM =                                    
                  ((CA-SCREEN-PAGE * PC-UPCS-PER-PAGE) + 1)                     
               MOVE TS-QUEUE-RECORD-NUM TO PV-THIS-LINE-NUM                     
               PERFORM 8400-FILL-OUTPUT-MAP                                     
               ADD 1 TO CA-SCREEN-PAGE                                          
           ELSE                                                                 
               IF CA-NUM-OF-TS-RECORDS =                                        
                             (CA-SCREEN-PAGE * PC-UPCS-PER-PAGE)                
                   MOVE ZERO TO CA-UPCS-ON-PAGE                                 
                   PERFORM 8500-CLEAR-UPC-LINES-ON-PAGE                         
                   ADD 1 TO CA-SCREEN-PAGE                                      
               ELSE                                                             
                   PERFORM 3000-SPECIFIC-PAGE                                   
                   MOVE PC-TSYMSG-00421 TO DP020-MSG-NUMBER                     
                   SET DP020-MSG-INFORMATIONAL TO TRUE                          
               END-IF                                                           
           END-IF.                                                              
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  UPON RETURNING FROM ANOTHER MNEMONIC, INITIALIZE FIELDS ON THE         
      *  SCREEN.                                                                
      ******************************************************************        
                                                                                
       4000-EXIT-CHECK.                                                         
           MOVE '*4000-EXIT-CHECK             *' TO DP013-PARAGRAPH.            
                                                                                
           EVALUATE TRUE                                                        
               WHEN  DP020-INT-APPL-FORMAT-IND = SPACES                         
                   PERFORM 1050-INITIALIZE                                      
           END-EVALUATE.                                                        
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  IN THE CASE THAT THE CLEAR KEY IS PRESSED, RE-SEND THE MAP    *        
      *  AND DATA FROM THE LAST PASS THROUGH THE PROGRAM.              *        
      ******************************************************************        
                                                                                
       6000-INVALID-PFKEY.                                                      
           MOVE '*6000-INVALID-PFKEY          *' TO DP013-PARAGRAPH.            
                                                                                
           PERFORM 8000-UPDATE-SCREEN-HEADER.                                   
                                                                                
           PERFORM 6010-REFILL-NEW-SCREEN                                       
                                                                                
           MOVE PC-TSYMSG-00438 TO DP020-MSG-NUMBER.                            
           SET DP020-MSG-INFORMATIONAL TO TRUE.                                 
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  IF THE USERS ENTER AN INVALID KEY, REFILL THE MAP FIELDS WITH          
      *  THE PREVIOUS COMMAREA DATA.                                            
      ******************************************************************        
                                                                                
       6010-REFILL-NEW-SCREEN.                                                  
           MOVE '*6010-REFILL-NEW-SCREEN      *' TO DP013-PARAGRAPH.            
                                                                                
           MOVE MH000-DEPT-NUMBER-9   TO ADEPTO.                                
           MOVE MH000-MCL-NUMBER-9    TO AMJCLSO.                               
           MOVE MH000-SCL-NUMBER-9    TO ASBCLSO.                               
           MOVE MH000-SKU-NUMBER-9    TO ASKUO.                                 
                                                                                
           MOVE CA-VENDOR-STYLE    TO AVDRSTYO.                                 
           MOVE CA-DESCRIPTION     TO ADESCO.                                   
           MOVE CA-VENDOR-NAME     TO AVENDORO.                                 
                                                                                
           PERFORM                                                              
               VARYING CA-UPC-INDEX FROM 1 BY 1                                 
                   UNTIL CA-UPC-INDEX > CA-UPCS-ON-PAGE                         
                       SET PM-AUPC-INDEX TO CA-UPC-INDEX                        
                       MOVE CA-UPC-SYSTEM (CA-UPC-INDEX) TO                     
                                   PM-AUPC-SYSTEM (PM-AUPC-INDEX)               
                       MOVE CA-UPC-VENDOR (CA-UPC-INDEX) TO                     
                                   PM-AUPC-VENDOR (PM-AUPC-INDEX)               
                       MOVE CA-UPC-ITEM (CA-UPC-INDEX) TO                       
                                   PM-AUPC-ITEM (PM-AUPC-INDEX)                 
                       MOVE CA-UPC-CHK-DIG (CA-UPC-INDEX) TO                    
                                   PM-AUPC-CHK-DIG (PM-AUPC-INDEX)              
                                                                                
                       MOVE CA-EDI-IND (CA-UPC-INDEX) TO                        
                                   PM-AEDI-IND (PM-AUPC-INDEX)                  
                       MOVE CA-POS-IND (CA-UPC-INDEX) TO                        
                                   PM-APOS-IND (PM-AUPC-INDEX)                  
                       MOVE CA-CREATE-DATE (CA-UPC-INDEX) TO                    
                                   PM-ACREATE-DATE (PM-AUPC-INDEX)              
                       MOVE CA-CNRF        (CA-UPC-INDEX) TO                    
                                   PM-AUPC-CNRF    (PM-AUPC-INDEX)              
                       MOVE CA-CDSC        (CA-UPC-INDEX) TO                    
                                   PM-AUPC-CDSC    (PM-AUPC-INDEX)              
                       MOVE CA-SNRF        (CA-UPC-INDEX) TO                    
                                   PM-AUPC-SNRF    (PM-AUPC-INDEX)              
                       MOVE CA-SDSC        (CA-UPC-INDEX) TO                    
                                   PM-AUPC-SDSC    (PM-AUPC-INDEX)              
                       MOVE CA-SRCE        (CA-UPC-INDEX) TO                    
                                   PM-AUPC-SRCE    (PM-AUPC-INDEX)              
           END-PERFORM.                                                         
                                                                                
           EJECT                                                                
      ******************************************************************        
      *  IF THE USERS ENTER AN INVALID KEY, REFILL THE MAP FIELDS WITH          
      *  THE PREVIOUS COMMAREA DATA.                                            
      ******************************************************************        
                                                                                
      ******************************************************************        
      *  READ THE SKU TABLE TO VERIFY THE SKU NUMBER REQUESTED.                 
      ******************************************************************        
                                                                                
       7000-SELECT-TSK.                                                         
           MOVE '*7000-SELECT-TSK             *' TO DP013-PARAGRAPH.            
                                                                                
           INITIALIZE PV-RETRY-COUNT.                                           
                                                                                
           PERFORM WITH TEST AFTER                                              
                   UNTIL ((SQLCODE = ZERO)                                      
                                OR                                              
                          (SQLCODE = +100)                                      
                                OR                                              
                          (PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT))            
               EXEC SQL                                                         
                   SELECT DEPT,                                                 
                          CLASS,                                                
                          SUBCLASS,                                             
                          SKU,                                                  
                          VENDOR_STYLE_CODE,                                    
                          STATUS_CODE,                                          
                          SKU_DESC,                                             
                          SIZE_DESC,                                            
                          COLOR_DESC,                                           
                          ENT_ID,                                               
                          ITEM_NMBR,                                            
                          LONG_VENDOR_STYLE,                                    
                          LONG_SIZE_DESC,                                       
                          LONG_COLOR_DESC,                                      
                          SIZE_CDE                                              
                   INTO :SKXREF-DEPT,                                           
                          :SKXREF-CLASS,                                        
                          :SKXREF-SUBCLASS,                                     
                          :SKXREF-SKU,                                          
                          :TSK-VENDOR-STYLE-CODE,                               
                          :TSK-STATUS-CODE,                                     
                          :TSK-SKU-DESC,                                        
                          :TSK-SIZE-DESC,                                       
                          :TSK-COLOR-DESC,                                      
                          :TSK-ENT-ID,                                          
                          :TSK-ITEM-NMBR,                                       
                          :TSK-LONG-VENDOR-STYLE,                               
                          :TSK-LONG-SIZE-DESC,                                  
                          :TSK-LONG-COLOR-DESC,                                 
                          :TSK-SIZE-CDE                                         
                   FROM TSK T                                                   
                   JOIN TSKXREF X                                               
                     ON T.ITEM_NMBR = X.ITM_NBR                                 
                  WHERE SKU  = :NI-SKU-C3                                       
                    AND SKU_STAT_CDE ^= '00'                                    
                   WITH UR                                                      
               END-EXEC                                                         
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       ADD +1 TO PV-RETRY-COUNT                                 
                   WHEN SQLCODE = ZERO                                          
                       SET PS-SKU-FOUND TO TRUE                                 
                       MOVE SKXREF-DEPT     TO NI-DEPT-9-3                      
                       MOVE SKXREF-CLASS    TO NI-CLASS-9-2                     
                       MOVE SKXREF-SUBCLASS TO NI-SUB-CLASS-9-2                 
                       MOVE SKXREF-SKU      TO NI-SKU-9                         
                   WHEN SQLCODE = +100                                          
                       CONTINUE                                                 
                   WHEN SQLCODE < ZERO                                          
                   WHEN ((SQLCODE > ZERO) AND (SQLCODE NOT = +100))             
                   WHEN SQLWARN0 NOT = SPACES                                   
                       MOVE PC-ERR-MSG-2 TO DP013-MESSAGE-TEXT(1)               
                       PERFORM 9950-DELETE-TS-QUEUE                             
                       PERFORM 9850-DB2-ERROR                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF ((SQLCODE = -911)                                                 
                     OR                                                         
               (SQLCODE = -913))                                                
               MOVE 'SELECTING SKUS FROM THE SKU                                
      -             'TABLE (TSK)' TO DP013-MESSAGE-TEXT(1)                      
               PERFORM 9850-DB2-ERROR                                           
           END-IF.                                                              
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  GET THE KOHL'S SIZE DESCRIPTION FOR A SPECIFIC SKU SIZE CODE. *        
      *  SELECT THE REQUIRED SIZE DESC INFORMATION FROM THE DB2 TSIZE  *        
      *  TABLE USING THE SKU TABLE (TSK) SIZE_CDE.                     *        
      *  IF A RESOURCE IS NOT AVAILABLE, OR A DEADLOCK OCCURS, THE     *        
      *  SELECT WILL BE RETRIED UP TO A SET NUMBER OF TIMES.  IF NO    *        
      *  DESCRIPTION IS FOUND FOR THE SKU SIZE CODE WHERE THE          *        
      *  EFF-END-DTE FIELD IS GREATER THAN THE CURRENT DATE, THE MOST  *        
      *  CURRENT EXPIRED DESCRIPTION WILL BE SELECTED (PARA 5114-)     *        
      ******************************************************************        
                                                                                
       7010-GET-SIZE-DESC.                                                      
           MOVE '*7010-GET-SIZE-DESC          *' TO DP013-PARAGRAPH.            
                                                                                
           INITIALIZE PV-RETRY-COUNT.                                           
           PERFORM 7015-SELECT-VALID-SIZE-DESC                                  
               WITH TEST AFTER                                                  
               UNTIL ((SQLCODE = ZERO)                                          
                   OR (SQLCODE = +100)                                          
                   OR (PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT)).               
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = 0                                                 
                   SET PS-SIZE-DESC-FOUND TO TRUE                               
               WHEN SQLCODE = +100                                              
                   PERFORM 7020-GET-MOST-CURR-SIZE-DESC                         
               WHEN SQLCODE = -911                                              
               WHEN SQLCODE = -913                                              
                   MOVE 'SELECT A DESC FROM THE SIZE TABLE (TSIZE)' TO          
                             DP013-MESSAGE-TEXT(1)                              
                   PERFORM 9850-DB2-ERROR                                       
               WHEN OTHER                                                       
                   SET PS-SIZE-DESC-NOT-FOUND TO TRUE                           
           END-EVALUATE.                                                        
                                                                                
      *7010-EXIT.                                                               
                                                                                
      ******************************************************************        
      *  SELECT INFORMATION FROM THE SIZETABLE FOR THE CURRENT SKU.    *        
      *  IF THE RESOURCE IS NOT AVAILABLE, OR A DEADLOCK OCCURS, THE   *        
      *  SELECT WILL BE RETRIED.  IF ANY OTHER ERRORS ARE DETECTED,    *        
      *  AN ERROR MESSAGE WILL BE FORMATTED AND SENT TO THE SCREEN,    *        
      *  AND CONTROL WILL BE RETURNED TO NATIVE CICS.                  *        
      ******************************************************************        
                                                                                
       7015-SELECT-VALID-SIZE-DESC.                                             
           MOVE '*7015-SELECT-VALID-SIZE-DESC *' TO DP013-PARAGRAPH.            
           EXEC SQL                                                             
               SELECT KOHLS_DESC                                                
                     ,NRF_SIZE_CDE                                              
                INTO :SIZE-KOHLS-DESC                                           
                    ,:SIZE-NRF-SIZE-CDE                                         
                FROM TSIZE                                                      
                WHERE  NRF_SIZE_CDE  = :SIZE-NRF-SIZE-CDE AND                   
                      (EFF_END_DTE IS NULL                OR                    
                       EFF_END_DTE > CURRENT DATE)                              
                WITH UR                                                         
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = 0                                                 
               WHEN SQLCODE = +100                                              
                   CONTINUE                                                     
               WHEN SQLCODE = -911                                              
               WHEN SQLCODE = -913                                              
                   ADD 1 TO PV-RETRY-COUNT                                      
               WHEN SQLWARN0 NOT = SPACES                                       
               WHEN SQLCODE  NOT = ZERO                                         
                   MOVE 'SELECT A SIZE DESC FORM SIZE TABLE (TSIZE)' TO         
                            DP013-MESSAGE-TEXT(1)                               
                   PERFORM 9850-DB2-ERROR                                       
           END-EVALUATE.                                                        
      *7015-EXIT.                                                               
                                                                                
      ******************************************************************        
      *  GET THE KOHL'S SIZE DESCRIPTION FOR A SPECIFIC SKU SIZE CODE. *        
      *  SELECT THE REQUIRED SIZE DESC INFORMATION FROM THE DB2 TSIZE  *        
      *  TABLE USING THE SKU TABLE (TSK) SIZE_CDE.  THE MOST CURRENT   *        
      *  EXPIRED DESCRIPTION WILL BE SELECTED AND DISPLAYED SINCE NO   *        
      *  VALID DESCRIPTION WAS FOUND IN PARAGRAPH 5112-.               *        
      *  IF A RESOURCE IS NOT AVAILABLE, OR A DEADLOCK OCCURS, THE     *        
      *  SELECT WILL BE RETRIED UP TO A SET NUMBER OF TIMES.  IF NO    *        
      *  DESCRIPTION IS FOUND FOR THE SKU SIZE CODE, THE SKU TABLE     *        
      *  SIZE DESCRIPTION WILL BE DISPLAYED.                           *        
      ******************************************************************        
                                                                                
       7020-GET-MOST-CURR-SIZE-DESC.                                            
           MOVE '*7020-GET-MOST-CURR-SIZE-DESC*' TO DP013-PARAGRAPH.            
                                                                                
           INITIALIZE PV-RETRY-COUNT.                                           
           PERFORM 7025-SELECT-OUTDATED-SIZE-DESC                               
               WITH TEST AFTER                                                  
               UNTIL ((SQLCODE = ZERO)                                          
                   OR (SQLCODE = +100)                                          
                   OR (SQLCODE = -811)                                          
                   OR (PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT)).               
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = +100                                              
                   SET PS-SIZE-DESC-NOT-FOUND TO TRUE                           
               WHEN SQLCODE = -911                                              
               WHEN SQLCODE = -913                                              
                   MOVE 'SELECT MOST CURR DESC FROM SIZE TBL (TSIZE)' TO        
                             DP013-MESSAGE-TEXT(1)                              
                   PERFORM 9850-DB2-ERROR                                       
               WHEN OTHER                                                       
                   SET PS-SIZE-DESC-FOUND TO TRUE                               
           END-EVALUATE.                                                        
                                                                                
      *7020-EXIT.                                                               
                                                                                
      ******************************************************************        
      *  SELECT INFORMATION FROM THE SIZETABLE FOR THE CURRENT SKU.    *        
      *  IF THE RESOURCE IS NOT AVAILABLE, OR A DEADLOCK OCCURS, THE   *        
      *  SELECT WILL BE RETRIED.  IF ANY OTHER ERRORS ARE DETECTED,    *        
      *  AN ERROR MESSAGE WILL BE FORMATTED AND SENT TO THE SCREEN,    *        
      *  AND CONTROL WILL BE RETURNED TO NATIVE CICS.                  *        
      ******************************************************************        
                                                                                
       7025-SELECT-OUTDATED-SIZE-DESC.                                          
           MOVE '*7025-SELECT-OUTDATED-SIZE-DES' TO DP013-PARAGRAPH.            
           EXEC SQL                                                             
               SELECT KOHLS_DESC                                                
                   INTO :SIZE-KOHLS-DESC                                        
                   FROM TSIZE                                                   
                   WHERE NRF_SIZE_CDE = :SIZE-NRF-SIZE-CDE AND                  
                         EFF_END_DTE  =                                         
                         ( SELECT MAX (EFF_END_DTE)                             
                           FROM   TSIZE                                         
                           WHERE  NRF_SIZE_CDE = :SIZE-NRF-SIZE-CDE)            
                   WITH UR                                                      
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = 0                                                 
               WHEN SQLCODE = +100                                              
                   CONTINUE                                                     
               WHEN SQLCODE = -911                                              
               WHEN SQLCODE = -913                                              
                   ADD 1 TO PV-RETRY-COUNT                                      
               WHEN SQLWARN0 NOT = SPACES                                       
               WHEN SQLCODE  NOT = ZERO                                         
                   MOVE 'SELECT OUTDATED DESC FROM SIZE TABLE(TSIZE)' TO        
                            DP013-MESSAGE-TEXT(1)                               
                   PERFORM 9850-DB2-ERROR                                       
           END-EVALUATE.                                                        
                                                                                
      *7025-EXIT.                                                               
                                                                                
      ******************************************************************        
      *  GET THE KOHL'S SIZE DESCRIPTION FOR A SPECIFIC SKU SIZE CODE. *        
      *  SELECT THE REQUIRED SIZE DESC INFORMATION FROM THE DB2 TSIZE  *        
      *  TABLE USING THE SKU TABLE (TSK) SIZE_CDE.                     *        
      *  IF A RESOURCE IS NOT AVAILABLE, OR A DEADLOCK OCCURS, THE     *        
      *  SELECT WILL BE RETRIED UP TO A SET NUMBER OF TIMES.  IF NO    *        
      *  DESCRIPTION IS FOUND FOR THE SKU SIZE CODE WHERE THE          *        
      *  EFF-END-DTE FIELD IS GREATER THAN THE CURRENT DATE, THE MOST  *        
      *  CURRENT EXPIRED DESCRIPTION WILL BE SELECTED (PARA 5114-)     *        
      ******************************************************************        
                                                                                
       7040-GET-SIZE-DESC.                                                      
           MOVE '*7040-GET-SIZE-DESC          *' TO DP013-PARAGRAPH.            
                                                                                
           INITIALIZE PV-RETRY-COUNT.                                           
           PERFORM 7045-SELECT-VALID-SIZE-DESC                                  
               WITH TEST AFTER                                                  
               UNTIL ((SQLCODE = ZERO)                                          
                   OR (SQLCODE = +100)                                          
                   OR (PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT)).               
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = 0                                                 
                   SET PS-SIZE-DESC-FOUND TO TRUE                               
               WHEN SQLCODE = +100                                              
                   SET PS-SIZE-DESC-NOT-FOUND TO TRUE                           
               WHEN SQLCODE = -911                                              
               WHEN SQLCODE = -913                                              
                   MOVE 'SELECT A DESC FROM THE SIZE TABLE (TSIZE)' TO          
                             DP013-MESSAGE-TEXT(1)                              
                   PERFORM 9850-DB2-ERROR                                       
               WHEN OTHER                                                       
                   SET PS-SIZE-DESC-NOT-FOUND TO TRUE                           
           END-EVALUATE.                                                        
                                                                                
      *7040-EXIT.                                                               
                                                                                
      ******************************************************************        
      *  SELECT INFORMATION FROM THE SIZETABLE FOR THE CURRENT SKU.    *        
      *  IF THE RESOURCE IS NOT AVAILABLE, OR A DEADLOCK OCCURS, THE   *        
      *  SELECT WILL BE RETRIED.  IF ANY OTHER ERRORS ARE DETECTED,    *        
      *  AN ERROR MESSAGE WILL BE FORMATTED AND SENT TO THE SCREEN,    *        
      *  AND CONTROL WILL BE RETURNED TO NATIVE CICS.                  *        
      ******************************************************************        
                                                                                
       7045-SELECT-VALID-SIZE-DESC.                                             
           MOVE '*7045-SELECT-VALID-SIZE-DESC *' TO DP013-PARAGRAPH.            
           EXEC SQL                                                             
               SELECT KOHLS_DESC                                                
                     ,NRF_SIZE_CDE                                              
                INTO :SIZE-KOHLS-DESC                                           
                    ,:SIZE-NRF-SIZE-CDE                                         
                FROM TSIZE                                                      
                WHERE KOHLS_SIZE_CDE = :SIZE-KOHLS-SIZE-CDE AND                 
                      (EFF_END_DTE IS NULL                  OR                  
                       EFF_END_DTE > CURRENT DATE)                              
                WITH UR                                                         
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = 0                                                 
               WHEN SQLCODE = +100                                              
                   CONTINUE                                                     
               WHEN SQLCODE = -911                                              
               WHEN SQLCODE = -913                                              
                   ADD 1 TO PV-RETRY-COUNT                                      
               WHEN SQLWARN0 NOT = SPACES                                       
               WHEN SQLCODE  NOT = ZERO                                         
                   MOVE 'SELECT A SIZE DESC FORM SIZE TABLE (TSIZE)' TO         
                            DP013-MESSAGE-TEXT(1)                               
                   PERFORM 9850-DB2-ERROR                                       
           END-EVALUATE.                                                        
      *7045-EXIT.                                                               
                                                                                
      ******************************************************************        
      *  FILL IN THE SCREEN HEADER WITH THE DATE, TIME, PROGRAM NAME,  *        
      *  AND TERMINAL NUMBER.                                          *        
      ******************************************************************        
                                                                                
       8000-UPDATE-SCREEN-HEADER.                                               
           MOVE '*8000-UPDATE-SCREEN-HEADER   *' TO DP013-PARAGRAPH.            
                                                                                
           EXEC CICS                                                            
               ASKTIME                                                          
                   ABSTIME(ST-ABSTIME)                                          
           END-EXEC.                                                            
                                                                                
           EXEC CICS                                                            
               FORMATTIME                                                       
                   ABSTIME(ST-ABSTIME)                                          
                   MMDDYY(WS-DATE)                                              
                   DATESEP                                                      
                   TIME(ST-TIME-EDIT)                                           
                   TIMESEP                                                      
           END-EXEC.                                                            
                                                                                
           MOVE WS-DATE TO CA-TODAYS-DATE.                                      
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  SET THE FIELD ATTRIBUTES ON THE OUTPUT SCREEN TO NON-ENTERABLE         
      *  FOR THE INDIVIDUAL UPC LINES - USERS WITH ONLY INQUIRY ABILITY         
      *  CAN NOT ENTER ANYTHING ON THE SCREEN OTHER THAN THE KEY FIELD          
      *  ON THE BOTTOM.                                                         
      ******************************************************************        
      *                                                                         
       8100-INIT-INQUIRY-ATTR.                                                  
           MOVE '*8100-INIT-INQUIRY-ATTR      *' TO DP013-PARAGRAPH.            
                                                                                
      * UPC LINES                                                               
           PERFORM                                                              
               VARYING PM-AUPC-INDEX FROM 1 BY +1                               
                UNTIL PM-AUPC-INDEX GREATER THAN PC-UPCS-PER-PAGE               
                    MOVE DP015-BLUE TO                                          
                               PM-AUPC-SYS-C    (PM-AUPC-INDEX)                 
                               PM-AUPC-VND-C    (PM-AUPC-INDEX)                 
                               PM-AUPC-ITM-C    (PM-AUPC-INDEX)                 
                               PM-AUPC-CHK-C    (PM-AUPC-INDEX)                 
                               PM-AEDI-IND-C    (PM-AUPC-INDEX)                 
                               PM-APOS-IND-C    (PM-AUPC-INDEX)                 
                               PM-ACREATED-C    (PM-AUPC-INDEX)                 
                               PM-AUPC-CERT-C   (PM-AUPC-INDEX)                 
                               PM-AUPC-CNRF-C   (PM-AUPC-INDEX)                 
                               PM-AUPC-SNRF-C   (PM-AUPC-INDEX)                 
                               PM-AUPC-CDSC-C   (PM-AUPC-INDEX)                 
                               PM-AUPC-SDSC-C   (PM-AUPC-INDEX)                 
                               PM-AUPC-SRCE-C   (PM-AUPC-INDEX)                 
                    MOVE DP015-HL-OFF TO                                        
                               PM-AUPC-SYS-H    (PM-AUPC-INDEX)                 
                               PM-AUPC-VND-H    (PM-AUPC-INDEX)                 
                               PM-AUPC-ITM-H    (PM-AUPC-INDEX)                 
                               PM-AUPC-CHK-H    (PM-AUPC-INDEX)                 
                               PM-AEDI-IND-H    (PM-AUPC-INDEX)                 
                               PM-APOS-IND-H    (PM-AUPC-INDEX)                 
                               PM-ACREATED-H    (PM-AUPC-INDEX)                 
                               PM-AUPC-CERT-H   (PM-AUPC-INDEX)                 
                               PM-AUPC-CNRF-H   (PM-AUPC-INDEX)                 
                               PM-AUPC-SNRF-H   (PM-AUPC-INDEX)                 
                               PM-AUPC-CDSC-H   (PM-AUPC-INDEX)                 
                               PM-AUPC-SDSC-H   (PM-AUPC-INDEX)                 
                               PM-AUPC-SRCE-H   (PM-AUPC-INDEX)                 
                    MOVE DP015-PRO-NOR-OFF TO                                   
                               PM-AUPC-SYS-A    (PM-AUPC-INDEX)                 
                               PM-AUPC-VND-A    (PM-AUPC-INDEX)                 
                               PM-AUPC-ITM-A    (PM-AUPC-INDEX)                 
                               PM-AUPC-CHK-A    (PM-AUPC-INDEX)                 
                               PM-AEDI-IND-A    (PM-AUPC-INDEX)                 
                               PM-APOS-IND-A    (PM-AUPC-INDEX)                 
                               PM-ACREATED-A    (PM-AUPC-INDEX)                 
                               PM-AUPC-CERT-A   (PM-AUPC-INDEX)                 
                               PM-AUPC-CERT-A   (PM-AUPC-INDEX)                 
                               PM-AUPC-CNRF-A   (PM-AUPC-INDEX)                 
                               PM-AUPC-SNRF-A   (PM-AUPC-INDEX)                 
                               PM-AUPC-CDSC-A   (PM-AUPC-INDEX)                 
                               PM-AUPC-SDSC-A   (PM-AUPC-INDEX)                 
                               PM-AUPC-SRCE-A   (PM-AUPC-INDEX)                 
           END-PERFORM.                                                         
                                                                                
                                                                                
      ******************************************************************        
      *  SET THE FIELD ATTRIBUTES FOR THE NEVER ENTERABLE FIELDS ON THE         
      *  SCREEN.                                                                
      ******************************************************************        
                                                                                
       8150-HEADER-ATTR.                                                        
           MOVE '*8150-HEADER-ATTR            *' TO DP013-PARAGRAPH.            
                                                                                
           MOVE DP015-HL-OFF TO ADEPTH.                                         
           MOVE DP015-BLUE TO ADEPTC.                                           
           MOVE DP015-ASK-NOR-OFF TO ADEPTA.                                    
                                                                                
           MOVE DP015-HL-OFF TO AMJCLSH.                                        
           MOVE DP015-BLUE TO AMJCLSC.                                          
           MOVE DP015-ASK-NOR-OFF TO AMJCLSA.                                   
                                                                                
           MOVE DP015-HL-OFF TO ASBCLSH.                                        
           MOVE DP015-BLUE TO ASBCLSC.                                          
           MOVE DP015-ASK-NOR-OFF TO ASBCLSA.                                   
                                                                                
           MOVE DP015-HL-OFF TO ASKUH.                                          
           MOVE DP015-BLUE TO ASKUC.                                            
           MOVE DP015-ASK-NOR-OFF TO ASKUA.                                     
                                                                                
           MOVE DP015-HL-OFF TO AVDRSTYH.                                       
           MOVE DP015-BLUE TO AVDRSTYC.                                         
           MOVE DP015-ASK-NOR-OFF TO AVDRSTYA.                                  
                                                                                
           MOVE DP015-HL-OFF TO ADESCH.                                         
           MOVE DP015-BLUE TO ADESCC.                                           
           MOVE DP015-ASK-NOR-OFF TO ADESCA.                                    
                                                                                
           MOVE DP015-HL-OFF TO AVENDORH.                                       
           MOVE DP015-BLUE TO AVENDORC.                                         
           MOVE DP015-ASK-NOR-OFF TO AVENDORA.                                  
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  CHANGE DATE FORMATS FROM TABLE FORMAT TO SCREEN FORMAT.                
      ******************************************************************        
                                                                                
       8350-CONVERT-DATES.                                                      
           MOVE '*8350-CONVERT-DATES          *' TO DP013-PARAGRAPH.            
                                                                                
           MOVE PV-XREF-CCYYMMDD-CC TO PV-XREF-MMDDCCYY-CC.                     
           MOVE PV-XREF-CCYYMMDD-YY TO PV-XREF-MMDDCCYY-YY.                     
           MOVE PV-XREF-CCYYMMDD-MM TO PV-XREF-MMDDCCYY-MM.                     
           MOVE PV-XREF-CCYYMMDD-DD TO PV-XREF-MMDDCCYY-DD.                     
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  READ ALL THE TEMP STORAGE RECORDS NEEDED FOR THIS PAGE OF THE *        
      *  SCREEN OUTPUT AND FILL IN THE UPC LINES IN THE MAP AREA.   .  *        
      ******************************************************************        
                                                                                
       8400-FILL-OUTPUT-MAP.                                                    
                                                                                
           PERFORM 8410-FILL-NEW-MAP                                            
               VARYING PM-AUPC-INDEX FROM 1 BY 1                                
                   UNTIL (PM-AUPC-INDEX > PC-UPCS-PER-PAGE                      
                                     OR                                         
                         PV-THIS-LINE-NUM > CA-NUM-OF-TS-RECORDS)               
                                                                                
           IF CA-UPCS-ON-PAGE < PC-UPCS-PER-PAGE                                
              PERFORM 8500-CLEAR-UPC-LINES-ON-PAGE                              
           END-IF.                                                              
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  READ ALL THE TEMP STORAGE RECORDS NEEDED FOR THIS PAGE OF THE *        
      *  SCREEN OUTPUT AND FILL IN THE UPC LINES IN THE MAP AREA.   .  *        
      ******************************************************************        
                                                                                
       8410-FILL-NEW-MAP.                                                       
           MOVE '*8410-FILL-NEW-MAP           *' TO DP013-PARAGRAPH.            
                                                                                
           PERFORM 9500-READ-TS-QUEUE.                                          
                                                                                
           SET CA-UPC-INDEX    TO PM-AUPC-INDEX.                                
                                                                                
           MOVE TS-UPC-NBR       TO PV-UPC-NUMBER.                              
                                                                                
      ***  FOR THE CASE WHERE ONLY COLOR AND SIZE INFORMATION IS                
      ***  DISPLAYED DUE TO THE UPC HAVING A SIZE CODE >= 98000 (RANGE)         
      ***  THE UPC WILL BE EQUAL TO ZEROES AND SHOULD NOT BE DISPLAYED          
                                                                                
           IF PV-UPC-NUMBER NOT EQUAL ZEROES                                    
               MOVE PV-UPC-FIRST  TO PM-AUPC-SYSTEM   (PM-AUPC-INDEX)           
                                     CA-UPC-SYSTEM    (CA-UPC-INDEX)            
               MOVE PV-UPC-SECOND TO PM-AUPC-VENDOR   (PM-AUPC-INDEX)           
                                     CA-UPC-VENDOR    (CA-UPC-INDEX)            
               MOVE PV-UPC-THIRD  TO PM-AUPC-ITEM     (PM-AUPC-INDEX)           
                                     CA-UPC-ITEM      (CA-UPC-INDEX)            
               MOVE PV-UPC-FOURTH TO PM-AUPC-CHK-DIG  (PM-AUPC-INDEX)           
                                     CA-UPC-CHK-DIG   (CA-UPC-INDEX)            
           ELSE                                                                 
               MOVE SPACES       TO  PM-AUPC-SYSTEM   (PM-AUPC-INDEX)           
                                     CA-UPC-SYSTEM    (CA-UPC-INDEX)            
                                     PM-AUPC-VENDOR   (PM-AUPC-INDEX)           
                                     CA-UPC-VENDOR    (CA-UPC-INDEX)            
                                     PM-AUPC-ITEM     (PM-AUPC-INDEX)           
                                     CA-UPC-ITEM      (CA-UPC-INDEX)            
                                     PM-AUPC-CHK-DIG  (PM-AUPC-INDEX)           
                                     CA-UPC-CHK-DIG   (CA-UPC-INDEX)            
           END-IF.                                                              
           MOVE TS-EDI-ORD-IND   TO PM-AEDI-IND      (PM-AUPC-INDEX)            
                                    CA-EDI-IND       (CA-UPC-INDEX).            
           MOVE TS-PLU-DWNLD-IND TO PM-APOS-IND      (PM-AUPC-INDEX)            
                                    CA-POS-IND       (CA-UPC-INDEX).            
           MOVE TS-XREF-CRE-DTE  TO PM-ACREATE-DATE  (PM-AUPC-INDEX)            
                                    CA-CREATE-DATE   (CA-UPC-INDEX).            
           MOVE TS-CNRF          TO PM-AUPC-CNRF     (PM-AUPC-INDEX)            
                                    CA-CNRF          (CA-UPC-INDEX).            
           MOVE TS-CDSC          TO PM-AUPC-CDSC     (PM-AUPC-INDEX)            
                                    CA-CDSC          (CA-UPC-INDEX).            
           MOVE TS-SNRF          TO PM-AUPC-SNRF     (PM-AUPC-INDEX)            
                                    CA-SNRF          (CA-UPC-INDEX).            
           MOVE TS-SDSC          TO PM-AUPC-SDSC     (PM-AUPC-INDEX)            
                                    CA-SDSC          (CA-UPC-INDEX).            
                                                                                
           EVALUATE TRUE                                                        
               WHEN TS-SRCE = PC-C                                              
                    MOVE PC-DC-GENR TO PM-AUPC-SRCE  (PM-AUPC-INDEX)            
                                       CA-SRCE       (CA-UPC-INDEX)             
               WHEN TS-SRCE = PC-I                                              
                    MOVE PC-INTERNL TO PM-AUPC-SRCE  (PM-AUPC-INDEX)            
                                       CA-SRCE       (CA-UPC-INDEX)             
               WHEN TS-SRCE = PC-K                                              
                    MOVE PC-CONVRTD TO PM-AUPC-SRCE  (PM-AUPC-INDEX)            
                                       CA-SRCE       (CA-UPC-INDEX)             
               WHEN TS-SRCE = PC-R                                              
                    MOVE PC-RENUMBR TO PM-AUPC-SRCE  (PM-AUPC-INDEX)            
                                       CA-SRCE       (CA-UPC-INDEX)             
               WHEN TS-SRCE = PC-U                                              
                    MOVE PC-USER    TO PM-AUPC-SRCE  (PM-AUPC-INDEX)            
                                       CA-SRCE       (CA-UPC-INDEX)             
               WHEN TS-SRCE = PC-V                                              
                    MOVE PC-CATALOG TO PM-AUPC-SRCE  (PM-AUPC-INDEX)            
                                       CA-SRCE       (CA-UPC-INDEX)             
               WHEN OTHER                                                       
                    MOVE SPACE      TO PM-AUPC-SRCE  (PM-AUPC-INDEX)            
                                       CA-SRCE       (CA-UPC-INDEX)             
           END-EVALUATE.                                                        
                                                                                
           MOVE TS-CERT-REQ-IND  TO PM-AUPC-CERT-REQ (PM-AUPC-INDEX)            
                                    CA-UPC-CERT-REQ  (CA-UPC-INDEX).            
                                                                                
           ADD +1 TO PV-THIS-LINE-NUM                                           
                     CA-UPCS-ON-PAGE                                            
                     TS-QUEUE-RECORD-NUM.                                       
                                                                                
           EJECT                                                                
      ******************************************************************        
      *  CLEAR REMAINING LINES ON THE SCREEN                                    
      ******************************************************************        
                                                                                
       8500-CLEAR-UPC-LINES-ON-PAGE.                                            
                                                                                
           SET PM-AUPC-INDEX TO CA-UPCS-ON-PAGE                                 
           SET PM-AUPC-INDEX UP BY 1                                            
           PERFORM 8510-CLEAR-NEW-MAP-UPC-LINES                                 
               VARYING PM-AUPC-INDEX FROM PM-AUPC-INDEX BY 1                    
                 UNTIL PM-AUPC-INDEX > PC-UPCS-PER-PAGE.                        
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  CLEAR REMAINING LINES ON THE SCREEN                                    
      ******************************************************************        
                                                                                
       8510-CLEAR-NEW-MAP-UPC-LINES.                                            
           MOVE '*8510-CLEAR-NEW-MAP-UPC-LINES*' TO DP013-PARAGRAPH.            
                                                                                
           SET CA-UPC-INDEX TO PM-AUPC-INDEX.                                   
                                                                                
           INITIALIZE CA-UPC-AREA      (CA-UPC-INDEX).                          
           INITIALIZE PM-AUPC-SYSTEM   (PM-AUPC-INDEX)                          
                      PM-AUPC-VENDOR   (PM-AUPC-INDEX)                          
                      PM-AUPC-ITEM     (PM-AUPC-INDEX)                          
                      PM-AUPC-CHK-DIG  (PM-AUPC-INDEX)                          
                      PM-AEDI-IND      (PM-AUPC-INDEX)                          
                      PM-APOS-IND      (PM-AUPC-INDEX)                          
                      PM-AUPC-CNRF     (PM-AUPC-INDEX)                          
                      PM-AUPC-CDSC     (PM-AUPC-INDEX)                          
                      PM-AUPC-SNRF     (PM-AUPC-INDEX)                          
                      PM-AUPC-SDSC     (PM-AUPC-INDEX)                          
                      PM-AUPC-SRCE     (PM-AUPC-INDEX)                          
                      PM-ACREATE-DATE  (PM-AUPC-INDEX)                          
                      PM-AUPC-CERT-REQ (PM-AUPC-INDEX).                         
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  READ A REQUEST RECORD FROM THE TEMPORARY STORAGE QUEUE.  ON   *        
      *  ANY ERROR, DEQUEUE THE INTERNAL READER, DELETE THE TEMPORARY  *        
      *  STORAGE QUEUE (TO PREVENT OLD REQUEST INFORMATION FROM        *        
      *  ACCIDENTALLY APPEARING ON A FUTURE REQUEST), FORMAT AND       *        
      *  DISPLAY AN ERROR MESSAGE, AND RETURN TO NATIVE CICS.          *        
      ******************************************************************        
                                                                                
       9500-READ-TS-QUEUE.                                                      
           MOVE '*9500-READ-TS-QUEUE          *' TO DP013-PARAGRAPH.            
                                                                                
           MOVE DP020-SRC-TASK-NUMBER TO TS-TRANSACTION-ID.                     
           MOVE EIBTRMID              TO TS-TERMINAL-ID.                        
                                                                                
           EXEC CICS                                                            
               READQ TS                                                         
                   QUEUE(TS-QUEUE-NAME)                                         
                   INTO(TS-QUEUE-RECORD-LAYOUT)                                 
                   LENGTH(TS-QUEUE-RECORD-LENGTH)                               
                   ITEM (TS-QUEUE-RECORD-NUM)                                   
                   RESP(PV-CICS-RESPONSE)                                       
           END-EXEC.                                                            
                                                                                
           IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                            
              STRING 'READ TEMPORARY STORAGE QUEUE ' DELIMITED BY SIZE          
                     MH000-SEL-QUEUE-NAME            DELIMITED BY SIZE          
              INTO SE-ATTEMPTED-ACTION                                          
                                                                                
              MOVE PV-CICS-RESPONSE TO SE-CICS-RESPONSE                         
              MOVE SE-SYSTEM-ERROR-MESSAGE TO PV-LEAVE-SYSTEM-MESSAGE           
              PERFORM 9950-DELETE-TS-QUEUE                                      
           END-IF.                                                              
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  WRITE A REQUEST RECORD TO THE TEMPORARY STORAGE QUEUE.  ON    *        
      *  ANY ERROR, DELETE THE TEMPORARY STORAGE QUEUE.                         
      ******************************************************************        
                                                                                
       9600-WRITE-TS-QUEUE.                                                     
           MOVE '*9600-WRITE-TS-QUEUE         *' TO DP013-PARAGRAPH.            
                                                                                
           MOVE DP020-SRC-TASK-NUMBER TO TS-TRANSACTION-ID.                     
           MOVE EIBTRMID              TO TS-TERMINAL-ID.                        
           EXEC CICS                                                            
               WRITEQ TS                                                        
                   QUEUE(TS-QUEUE-NAME)                                         
                   FROM(TS-QUEUE-RECORD-LAYOUT)                                 
                   LENGTH(TS-QUEUE-RECORD-LENGTH)                               
                   RESP(PV-CICS-RESPONSE)                                       
           END-EXEC.                                                            
                                                                                
           IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                            
              STRING 'WRITE TO TEMPORARY STORAGE QUEUE '                        
                                           DELIMITED BY SIZE                    
                  MH000-SEL-QUEUE-NAME     DELIMITED BY SIZE                    
              INTO SE-ATTEMPTED-ACTION                                          
                                                                                
              MOVE PV-CICS-RESPONSE        TO SE-CICS-RESPONSE                  
              MOVE SE-SYSTEM-ERROR-MESSAGE TO PV-LEAVE-SYSTEM-MESSAGE           
              PERFORM 9950-DELETE-TS-QUEUE                                      
           END-IF.                                                              
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
      *  REWRITE A RECORD TO THE TEMPORARY STORAGE QUEUE.              *        
      ******************************************************************        
                                                                                
       9700-REWRITE-TS-QUEUE.                                                   
           MOVE '*9700-REWRITE-TS-QUEUE       *' TO DP013-PARAGRAPH.            
                                                                                
           EXEC CICS                                                            
               WRITEQ TS                                                        
                   QUEUE(TS-QUEUE-NAME)                                         
                   FROM(TS-QUEUE-RECORD-LAYOUT)                                 
                   ITEM(TS-QUEUE-RECORD-NUM)                                    
                   LENGTH(TS-QUEUE-RECORD-LENGTH)                               
                   RESP(PV-CICS-RESPONSE)                                       
                   REWRITE                                                      
           END-EXEC.                                                            
                                                                                
           IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                            
              STRING 'REWRITE TO TEMPORARY STORAGE QUEUE '                      
                                            DELIMITED BY SIZE                   
                  MH000-SEL-QUEUE-NAME      DELIMITED BY SIZE                   
              INTO SE-ATTEMPTED-ACTION                                          
                                                                                
              MOVE PV-CICS-RESPONSE        TO SE-CICS-RESPONSE                  
              MOVE SE-SYSTEM-ERROR-MESSAGE TO PV-LEAVE-SYSTEM-MESSAGE           
              PERFORM 9950-DELETE-TS-QUEUE                                      
           END-IF.                                                              
                                                                                
           EJECT                                                                
                                                                                
                                                                                
      ******************************************************************        
      *  ROLL BACK ALL RESOURCES, FOLLOWING A DB2 ERROR.  FORMAT       *        
      *  INFORMATION RELATIVE TO THE ERROR.                            *        
      ******************************************************************        
                                                                                
       9850-DB2-ERROR.                                                          
                                                                                
           MOVE SQLCA                TO DP013-SQLCA                             
                                                                                
           SET DP013-NO-ROLLBACK                                                
               DP013-XCTL-DISPLAY-RESTART                                       
               DP013-DB2-ABEND       TO TRUE.                                   
                                                                                
           PERFORM DP013-0000-PROCESS-ABEND.                                    
                                                                                
           EJECT                                                                
      ******************************************************************        
      *  DELETE THE TEMP STORAGE QUEUE                                          
      ******************************************************************        
                                                                                
       9950-DELETE-TS-QUEUE.                                                    
           MOVE '*9950-DELETE-TS-QUEUE        *' TO DP013-PARAGRAPH.            
                                                                                
           MOVE DP020-SRC-TASK-NUMBER TO TS-TRANSACTION-ID.                     
           MOVE EIBTRMID              TO TS-TERMINAL-ID.                        
                                                                                
           EXEC CICS                                                            
               DELETEQ TS                                                       
                   QUEUE(TS-QUEUE-NAME)                                         
                   RESP(PV-CICS-RESPONSE)                                       
           END-EXEC.                                                            
                                                                                
           IF ((PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)) AND                     
              (PV-CICS-RESPONSE NOT = DFHRESP(QIDERR)))                         
              STRING 'DELETE TEMPORARY STORAGE QUEUE '                          
                                             DELIMITED BY SIZE                  
                   MH000-SEL-QUEUE-NAME      DELIMITED BY SIZE                  
              INTO DP013-MESSAGE-TEXT(1)                                        
                                                                                
              PERFORM 9999-CICS-ERROR                                           
           END-IF.                                                              
                                                                                
           EJECT                                                                
                                                                                
      ******************************************************************        
       9951-DELETE-TS-QUEUE.                                                    
      ******************************************************************        
           MOVE '*9951-DELETE-TS-QUEUE        *' TO DP013-PARAGRAPH.            
                                                                                
           MOVE DP020-SRC-TASK-NUMBER TO TS-TRANSACTION-ID.                     
           MOVE EIBTRMID TO TS-TERMINAL-ID.                                     
           EXEC CICS                                                            
               DELETEQ TS                                                       
                   QUEUE(TS-QUEUE-NAME)                                         
                   RESP(PV-CICS-RESPONSE)                                       
           END-EXEC.                                                            
                                                                                
           IF ((PV-CICS-RESPONSE NOT = DFHRESP(NORMAL))                         
                   AND (PV-CICS-RESPONSE NOT = DFHRESP(QIDERR)))                
               STRING 'DELETE TEMPORARY STORAGE QUEUE '                         
                                                  DELIMITED BY SIZE             
                      MH000-SEL-QUEUE-NAME        DELIMITED BY SIZE             
                   INTO DP013-MESSAGE-TEXT(1)                                   
               PERFORM 9999-CICS-ERROR                                          
           END-IF.                                                              
                                                                                
           EJECT                                                                
       9999-CICS-ERROR.                                                         
                                                                                
           SET DP013-NO-ROLLBACK                                                
               DP013-XCTL-DISPLAY-RESTART                                       
               DP013-CICS-ABEND      TO TRUE                                    
                                                                                
           PERFORM DP013-0000-PROCESS-ABEND.                                    
                                                                                
           EJECT                                                                
                                                                                
           COPY DPPD013.                                                        
