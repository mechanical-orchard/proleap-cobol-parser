/*  REXX    */                                                          00860001
CURRPGM = 'SEKRX003 - '                                                 00920001
INP01_EOF = 'N'                                                         01020001
CALL READ_RACF_UNLOAD                                                   01030001
DO WHILE (INP01_EOF = 'N')                                              01040001
    PARSE PULL RACF_RCD                                                 01050001
    RECORD_TYPE = SUBSTR(RACF_RCD,1,4)                                  01060001
    SELECT                                                              01070001
            /* "USER BASIC DATA" - USER DEFINITION */                   01200001
        WHEN (RECORD_TYPE = '0200') THEN CALL USER_DEFN                 01210001
            /* "USER CONNECT DATA" - USER GROUP CONNECTION */           01211001
        WHEN (RECORD_TYPE = '0205') THEN CALL USER_CONN_DEFN            01212001
        OTHERWISE NOP                                                   01220001
    END                                                                 01230001
    CALL READ_RACF_UNLOAD                                               01240001
END                                                                     01250001
"EXECIO 0 DISKR INP01 (FINIS"                                           01260001
"EXECIO 0 DISKR OUT01 (FINIS"                                           01270001
"EXECIO 0 DISKR OUT02 (FINIS"                                           01280001
"EXECIO 0 DISKR OUT03 (FINIS"                                           01290002
RETURN                                                                  01320001
/*----------------------------------------------------------------*/    01330001
USER_DEFN:                                                              02200001
    USER_ID = SUBSTR(RACF_RCD,6,8)                                      02210001
    PROGRAMMER_NAME = SUBSTR(RACF_RCD,75,20)                            02220001
    USER_INST_DATA = SUBSTR(RACF_RCD,125,255)                           02230001
    NAME_POSITION = POS('NAME(',USER_INST_DATA)                         02240001
    IF (NAME_POSITION > 0) THEN DO                                      02250001
        NAME_POSITION = NAME_POSITION + 5                               02260001
        NAME_TEMP = SUBSTR(USER_INST_DATA,NAME_POSITION)                02270001
        END_POSITION = POS(')',NAME_TEMP)                               02280001
        IF (END_POSITION > 1) THEN DO                                   02290001
            END_POSITION = END_POSITION - 1                             02300001
            USER_NAME = LEFT(SUBSTR(NAME_TEMP,1,END_POSITION),40)       02310001
        END                                                             02320001
        ELSE                                                            02330001
            USER_NAME = LEFT('',40)                                     02340001
    END                                                                 02350001
    ELSE                                                                02360001
        USER_NAME = LEFT('',40)                                         02370001
    IF STRIP(USER_NAME) = '' THEN                                       02380001
        USER_NAME = PROGRAMMER_NAME                                     02390001
    CAT_POSITION = POS('CAT(',USER_INST_DATA)                           02400001
    IF (CAT_POSITION > 0) THEN DO                                       02410001
        CAT_POSITION = CAT_POSITION + 4                                 02420001
        CAT_TEMP = SUBSTR(USER_INST_DATA,CAT_POSITION)                  02430001
        END_POSITION = POS(')',CAT_TEMP)                                02440001
        IF (END_POSITION > 1) THEN DO                                   02450001
            END_POSITION = END_POSITION - 1                             02460001
            USER_CATAGORY = LEFT(SUBSTR(CAT_TEMP,1,END_POSITION),8)     02470001
        END                                                             02480001
        ELSE                                                            02490001
            USER_CATAGORY = LEFT('',8)                                  02500001
    END                                                                 02510001
    ELSE                                                                02520001
        USER_CATAGORY = LEFT('',8)                                      02530001
    EMPLID_POSITION = POS('EMPLID(',USER_INST_DATA)                     02540001
    IF (EMPLID_POSITION > 0) THEN DO                                    02550001
        EMPLID_POSITION = EMPLID_POSITION + 7                           02560001
        EMPLID_TEMP = SUBSTR(USER_INST_DATA,EMPLID_POSITION)            02570001
        END_POSITION = POS(')',EMPLID_TEMP)                             02580001
        IF (END_POSITION > 1) THEN DO                                   02590001
            END_POSITION = END_POSITION - 1                             02600001
            USER_EMPLID = LEFT(SUBSTR(EMPLID_TEMP,1,END_POSITION),7)    02610001
        END                                                             02620001
        ELSE                                                            02630001
            USER_EMPLID = LEFT('',7)                                    02640001
    END                                                                 02650001
    ELSE                                                                02660001
        USER_EMPLID = LEFT('',7)                                        02670001
    USER_SPECIAL = SUBSTR(RACF_RCD,40,3)                                02671001
    USER_OPERATIONS = SUBSTR(RACF_RCD,45,3)                             02672001
    USER_AUDITOR = SUBSTR(RACF_RCD,386,3)                               02673001
    IF ((USER_SPECIAL = 'YES') |,                                       02674001
            (USER_OPERATIONS = 'YES') |,                                02675001
            (USER_AUDITOR = 'YES')) THEN DO                             02676001
        USER_RCD = USER_ID || USER_NAME || USER_CATAGORY ||,            02680001
                  USER_EMPLID || USER_SPECIAL || USER_OPERATIONS ||,    02681001
                  USER_AUDITOR                                          02682001
        CALL WRITE_USER_FILE                                            02690001
    END                                                                 02691001
    USER_NAME_RCD = USER_ID || USER_NAME                                02692002
    CALL WRITE_USER_NAME_FILE                                           02693002
RETURN                                                                  02700001
/*----------------------------------------------------------------*/    02701001
USER_CONN_DEFN:                                                         02702001
    USER_ID = SUBSTR(RACF_RCD,6,8)                                      02703001
    USER_GROUP = SUBSTR(RACF_RCD,15,8)                                  02703101
    USER_SPECIAL = SUBSTR(RACF_RCD,84,3)                                02713101
    USER_OPERATIONS = SUBSTR(RACF_RCD,89,3)                             02713201
    USER_AUDITOR = SUBSTR(RACF_RCD,109,3)                               02713301
    IF ((USER_SPECIAL = 'YES') |,                                       02713401
            (USER_OPERATIONS = 'YES') |,                                02713501
            (USER_AUDITOR = 'YES')) THEN DO                             02713601
        USER_CONN_RCD = USER_ID || USER_GROUP || USER_SPECIAL ||,       02713701
                  USER_OPERATIONS || USER_AUDITOR                       02713801
        CALL WRITE_USER_CONN_FILE                                       02714001
    END                                                                 02714101
RETURN                                                                  02714201
/*----------------------------------------------------------------*/    02715001
READ_RACF_UNLOAD:                                                       02720001
    "EXECIO 1 DISKR INP01"              /* READ ONE RECORD        */    02730001
    IF RC = 2 THEN                                                      02740001
        INP01_EOF = 'Y'                                                 02750001
    RETURN                                                              02760001
/*----------------------------------------------------------------*/    03010001
WRITE_USER_FILE:                                                        03020001
  OUT01_RECORD = LEFT(USER_RCD,72)                                      03030001
  PUSH OUT01_RECORD                                                     03040001
  "EXECIO 1 DISKW OUT01"                                                03050001
RETURN                                                                  03060001
/*----------------------------------------------------------------*/    03061001
WRITE_USER_CONN_FILE:                                                   03062001
  OUT02_RECORD = LEFT(USER_CONN_RCD,25)                                 03063001
  PUSH OUT02_RECORD                                                     03064001
  "EXECIO 1 DISKW OUT02"                                                03065001
RETURN                                                                  03066001
/*----------------------------------------------------------------*/    03067002
WRITE_USER_NAME_FILE:                                                   03068002
  OUT03_RECORD = LEFT(USER_NAME_RCD,48)                                 03069003
  PUSH OUT03_RECORD                                                     03070002
  "EXECIO 1 DISKW OUT03"                                                03080002
RETURN                                                                  03090002
