000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             TMKUT009.                                00050000
000600 AUTHOR.                 TAMARA KOLTUN.                           00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            5-05-97.                                 00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100                                                                  00110000
001110******************************************************************00111000
001120* 03/15/2010 MICHAEL J. WATTS                                     00112001
001130*            MADE CHANGES FOR EFC2 PROJECT (WR38216)              00113001
001140*                                                                 00114001
001150*                                                                 00115001
001160*                                                                 00116001
001170*                                                                 00117001
001180*                                                                 00118001
001190******************************************************************00119000
001191                                                                  00119100
001192******************************************************************00119200
001193 ENVIRONMENT DIVISION.                                            00119300
001194******************************************************************00119400
001195                                                                  00119500
001196 CONFIGURATION SECTION.                                           00119600
001197                                                                  00119700
001198 SOURCE-COMPUTER.        IBM-3090.                                00119800
001199 OBJECT-COMPUTER.        IBM-3090.                                00119900
001200                                                                  00120000
001300 INPUT-OUTPUT SECTION.                                            00130000
001400                                                                  00140000
001500 FILE-CONTROL.                                                    00150000
001600                                                                  00160000
001700      SELECT EXTRACT-TRBL-FILE-IN   ASSIGN TO INP01.              00170000
001800      SELECT EXTRACT-TRBL-FILE-OUT  ASSIGN TO OUT01.              00180000
001900                                                                  00190000
002000******************************************************************00200000
002100 DATA DIVISION.                                                   00210000
002200******************************************************************00220000
002300                                                                  00230000
002400 FILE SECTION.                                                    00240000
002500 FD  EXTRACT-TRBL-FILE-IN                                         00250000
002600     LABEL RECORDS ARE STANDARD                                   00260000
002700     BLOCK CONTAINS 0 RECORDS                                     00270000
002800     RECORDING MODE IS F                                          00280000
002900     RECORD CONTAINS 400 CHARACTERS                               00290000
003000     DATA RECORD IS TE-TRBL-EXTRACT-IN-RECORD.                    00300000
003100                                                                  00310000
003200 01  TE-TRBL-EXTRACT-IN-RECORD       PIC X(400).                  00320000
003300                                                                  00330000
003400                                                                  00340000
003500 FD  EXTRACT-TRBL-FILE-OUT                                        00350000
003600     LABEL RECORDS ARE STANDARD                                   00360000
003700     BLOCK CONTAINS 0 RECORDS                                     00370000
003800     RECORDING MODE IS F                                          00380000
003900     RECORD CONTAINS 400 CHARACTERS                               00390000
004000     DATA RECORD IS TE-TRBL-OUT-EXTRACT-RECORD.                   00400000
004100                                                                  00410000
004200 01  TE-TRBL-EXTRACT-OUT-RECORD      PIC X(400).                  00420000
004300*------------------------------------------------------*          00430000
004400 WORKING-STORAGE SECTION.                                         00440000
004500*------------------------------------------------------*          00450000
004600 01 CC-CONTROL-CARD.                                              00460000
004700    05  CC-FUNCTION                  PIC X(23).                   00470000
004800        88  CC-EFC-OPER-UNT-OVERLAY            VALUE              00480000
004900        'EFC OPER UNT OVERLAY   '.                                00490000
005000        88  CC-EFC-OPER-UNT-NO-OVERLAY         VALUE              00500000
005100        'EFC OPER UNT NO OVERLAY'.                                00510000
005200    05  FILLER                       PIC X(57).                   00520000
005300 01 PC-PROGRAM-CONSTANTS.                                         00530000
005400    05 PC-PROGRAM-NAME               PIC X(08) VALUE 'TMKUT009'.  00540000
005500    05  PC-NOT-FOUND                 PIC X(15)     VALUE          00550000
005600                                            '** NOT FOUND **'.    00560000
005700 01 IND-INDICATORS.                                               00570000
005800    05 IND-ACTLITM                   PIC S9(04)    COMP.          00580000
005900    05 IND-EXPITM                    PIC S9(04)    COMP.          00590000
005910    05 IND-NULL1                     PIC S9(04)    COMP.          00591000
005920    05 IND-NULL2                     PIC S9(04)    COMP.          00592000
005930                                                                  00593000
005931 01 PV-PROGRAM-VARIABLES.                                         00593100
005932    05 PV-RCVR-EXPTED-ITM-QTY        PIC S9(09)    COMP VALUE +0. 00593200
005933    05 PV-RCVR-ACTL-ITM-QTY          PIC S9(09)    COMP VALUE +0. 00593300
005934    05 PV-RCVR-EXPTED-CART-CNT       PIC S9(09)    COMP VALUE +0. 00593400
005935    05 PV-RCVR-ACTL-CART-CNT         PIC S9(09)    COMP VALUE +0. 00593500
005936    05 PV-PACK-EXPTED-ITM-QTY        PIC S9(09)    COMP VALUE +0. 00593600
005937    05 PV-PACK-ACTL-ITM-QTY          PIC S9(09)    COMP VALUE +0. 00593700
005938    05 PV-PACK-EXPTED-CART-CNT       PIC S9(09)    COMP VALUE +0. 00593800
005939    05 PV-PACK-ACTL-CART-CNT         PIC S9(09)    COMP VALUE +0. 00593900
005940    05 PV-RCVR-OPER-UNT-ID           PIC S9(04)    COMP VALUE +0. 00594000
005950    05 PV-RCVR-FCLTY-ID              PIC S9(04)    COMP VALUE +0. 00595000
005960    05 PV-RCVR-PREPK-ID              PIC S9(04)    COMP VALUE +0. 00596000
005970    05 PV-PARA-NAME                  PIC X(30)     VALUE SPACE.   00597000
005980    05 PV-ABEND-CODE                 PIC 9(04)     VALUE 0.       00598000
005990    05 PV-ABEND-PARA-NAME            PIC X(30)     VALUE SPACE.   00599000
006000    05 PV-DB2-OPERATION-MSG-1        PIC X(40)     VALUE SPACE.   00600000
006100    05 PV-DB2-TABLE-NAME             PIC X(12)     VALUE SPACE.   00610000
006200    05 PV-SQLCODE                    PIC Z(8)9-.                  00620000
006300    05 PV-PARAGRAPH-NAME             PIC X(30)     VALUE SPACE.   00630000
006400    05 PV-START-EXTRACT              PIC X(10)     VALUE SPACE.   00640000
006500    05 PV-END-EXTRACT                PIC X(10)     VALUE SPACE.   00650000
006600    05 PV-TMST.                                                   00660000
006700       10 PV-TMST-YYYY               PIC X(04)     VALUE SPACE.   00670000
006800       10 FILLER                     PIC X(01)     VALUE SPACE.   00680000
006900       10 PV-TMST-MM                 PIC X(02)     VALUE SPACE.   00690000
007000       10 FILLER                     PIC X(01)     VALUE SPACE.   00700000
007100       10 PV-TMST-DD                 PIC X(02)     VALUE SPACE.   00710000
007200       10 FILLER                     PIC X(16)     VALUE SPACE.   00720000
007300    05 PV-START-CHECK-DATE.                                       00730000
007400       10 PV-START-CHECK-DATE-YYYY   PIC X(04)     VALUE SPACE.   00740000
007500       10 PV-START-CHECK-DATE-MM     PIC X(02)     VALUE SPACE.   00750000
007600       10 PV-START-CHECK-DATE-DD     PIC X(02)     VALUE SPACE.   00760000
007700    05 PV-END-CHECK-DATE.                                         00770000
007800       10 PV-END-CHECK-DATE-YYYY     PIC X(04)     VALUE SPACE.   00780000
007900       10 PV-END-CHECK-DATE-MM       PIC X(02)     VALUE SPACE.   00790000
008000       10 PV-END-CHECK-DATE-DD       PIC X(02)     VALUE SPACE.   00800000
008100    05 PV-CURR-PO-KEY.                                            00810000
008200       10 PV-PO-NBR                 PIC S9(9)     COMP            00820000
008300                                                   VALUE ZEROS.   00830000
008400       10 PV-REC-SEQ-NBR            PIC S9(9)     COMP            00840000
008500                                                   VALUE ZEROS.   00850000
008600* ADDED TABLE FOR (WR38216)                                       00860000
008700    05 PV-ECOMM-KEY                 PIC S9(4)     COMP.           00870000
008710    05 PV-ECOMM-DC OCCURS 50 TIMES INDEXED BY RV-IDX.             00871001
008720       10 PV-EFC-NBR                PIC S9(4)     COMP.           00872000
008730                                                                  00873000
008740 01 PV-SAVE-FIELDS.                                               00874000
008750    05 PV-PO-NBR-SAVE                PIC S9(9) COMP VALUE ZEROS.  00875000
008760    05 PV-PO-LNE-NBR-SAVE            PIC S9(9) COMP VALUE ZEROS.  00876000
008770    05 PV-REC-SEQ-NBR-SAVE           PIC S9(9) COMP VALUE ZEROS.  00877000
008780    05 PV-OPER-UNT-ID-SAVE           PIC S9(4) COMP VALUE ZEROS.  00878000
008790    05 PV-FCLTY-ID-SAVE              PIC S9(4) COMP VALUE ZEROS.  00879000
008800    05 PV-PREPK-ID-SAVE              PIC S9(4) COMP VALUE ZEROS.  00880000
008900    05 PV-RCVR-CART-CNT-SAVE         PIC S9(9) COMP VALUE ZEROS.  00890000
009000    05 PV-RCVR-ITEM-QTY-SAVE         PIC S9(9) COMP VALUE ZEROS.  00900000
009100    05 PV-RECEIPT-DATE-SAVE.                                      00910000
009200       10 PV-RECEIPT-YYYY-SAVE       PIC X(04)      VALUE SPACES. 00920000
009300       10 PV-RECEIPT-MM-SAVE         PIC X(02)      VALUE SPACES. 00930000
009400       10 PV-RECEIPT-DD-SAVE         PIC X(02)      VALUE SPACES. 00940000
009500    05 PV-LINE-CART-CNT-SAVE         PIC S9(9) COMP VALUE ZEROS.  00950000
009600    05 PV-LINE-ITEM-QTY-SAVE         PIC S9(9) COMP VALUE ZEROS.  00960000
009700    05 PV-PACK-ITEM-QTY-SAVE         PIC S9(9) COMP VALUE ZEROS.  00970000
009800    05 PV-RECITM-PREPK-ID-SAVE       PIC S9(4) COMP VALUE ZEROS.  00980000
009900                                                                  00990000
010000 01 PS-PROGRAM-SWITCHES.                                          01000000
010100    05 PS-END-OF-TABLE-SW            PIC X(01)     VALUE SPACE.   01010000
010200       88 PS-EOT                     VALUE 'Y'.                   01020000
010300    05 PS-FIRST-THRU-SW              PIC X(01)     VALUE 'F'.     01030000
010400       88 PS-FIRST-TIME-THRU         VALUE 'F'.                   01040000
010500       88 PS-NOT-FIRST-TIME-THRU     VALUE ' '.                   01050000
010600    05 PS-END-OF-FILE-SW             PIC X(01)     VALUE SPACE.   01060000
010700       88 PS-EOF                     VALUE 'Y'.                   01070000
010800       88 PS-NOT-EOF                 VALUE 'N'.                   01080000
010900    05 PS-TRECEIV-ROW-FND-SW         PIC X(01)     VALUE SPACE.   01090000
011000       88 PS-TRECEIV-ROW-FND         VALUE 'Y'.                   01100000
011100       88 PS-TRECEIV-ROW-NOT-FND     VALUE 'N'.                   01110000
011200    05 PS-TRECITM-ROW-FND-SW         PIC X(01)     VALUE SPACE.   01120000
011300       88 PS-TRECITM-ROW-FND         VALUE 'Y'.                   01130000
011400       88 PS-TRECITM-ROW-NOT-FND     VALUE 'N'.                   01140000
011500    05 PS-TRECITM-PKROW-FND-SW       PIC X(01)     VALUE SPACE.   01150000
011600       88 PS-TRECITM-PKROW-FND       VALUE 'Y'.                   01160000
011700       88 PS-TRECITM-PKROW-NOT-FND   VALUE 'N'.                   01170000
011800    05 PS-PACK-CURSOR-SW             PIC X(01)     VALUE SPACE.   01180000
011900       88 PS-PACK-CURSOR-NOT-DONE    VALUE 'N'.                   01190000
012000       88 PS-PACK-CURSOR-DONE        VALUE 'Y'.                   01200000
012100* ADDED SWITCHES FOR (WR38216)                                    01210000
012200    05 PS-ECOMM-CURSOR-SW            PIC X(01)     VALUE SPACE.   01220000
012201       88 PS-ECOMM-CURSOR-NOT-DONE   VALUE 'N'.                   01220100
012202       88 PS-ECOMM-CURSOR-DONE       VALUE 'Y'.                   01220200
012203    05 PS-RCVR-OPER-UNT-SW           PIC X(01)     VALUE 'F'.     01220300
012204       88 PS-RCVR-OPER-UNT-DC        VALUE 'T'.                   01220400
012205       88 PS-RCVR-OPER-UNT-NOT-DC    VALUE 'F'.                   01220500
012206    05 PS-TM001-OPER-UNT-SW          PIC X(01)     VALUE 'F'.     01220600
012207       88 PS-TM001-OPER-UNT-DC       VALUE 'T'.                   01220700
012208       88 PS-TM001-OPER-UNT-NOT-DC   VALUE 'F'.                   01220800
012209    05 PS-RECEIV-OPER-UNT-SW         PIC X(01)     VALUE 'F'.     01220900
012210       88 PS-RECEIV-OPER-UNT-DC      VALUE 'T'.                   01221000
012211       88 PS-RECEIV-OPER-UNT-NOT-DC  VALUE 'F'.                   01221100
012212                                                                  01221200
012213 01 WS-COMPUTED-FIELDS.                                           01221300
012214    05  WS-RECORDS-READ-QTY          PIC S9(7)     COMP-3         01221400
012215                                                   VALUE ZEROS.   01221500
012216    05  WS-RECORDS-WRITE-QTY         PIC S9(7)     COMP-3         01221600
012217                                                   VALUE ZEROS.   01221700
012218     COPY DPWS004.                                                01221800
012219                                                                  01221900
012220     COPY TMRD001.                                                01222000
012230*                                                                 01223000
012240     EXEC SQL                                                     01224000
012250          INCLUDE SQLCA                                           01225000
012260     END-EXEC.                                                    01226000
012270                                                                  01227000
012280     EXEC SQL                                                     01228000
012290          INCLUDE TRECEIV                                         01229000
012300     END-EXEC.                                                    01230000
012400                                                                  01240000
012500     EXEC SQL                                                     01250000
012600          INCLUDE TRECITM                                         01260000
012700     END-EXEC.                                                    01270000
012800                                                                  01280000
012900* ADDED FOR (WR38216)                                             01290000
013000     EXEC SQL                                                     01300000
013100          INCLUDE XLT00010                                        01310000
013200     END-EXEC.                                                    01320000
013300*                                                                 01330000
013400******************************************************************01340000
013500*  CURSOR FOR ECOMM DC NUMBERS.  (WR38216)                        01350000
013600******************************************************************01360000
013700     EXEC SQL                                                     01370000
013800         DECLARE ECOMM_CSR CURSOR FOR                             01380000
013810            SELECT LOC_NBR                                        01381000
013820            FROM XLT_LOC                                          01382000
013830            WHERE LOC_TYP_CDE      = 'DC'                         01383000
013840            AND   E_BUS_IND        = 'Y'                          01384000
013841            ORDER BY LOC_NBR                                      01384100
013842        END-EXEC.                                                 01384200
013843                                                                  01384300
013844*                                                                 01384400
013845******************************************************************01384500
013846*  CURSOR FOR DRIVING THE REPORT.                                 01384600
013847******************************************************************01384700
013848     EXEC SQL                                                     01384800
013849         DECLARE PACK_CURSOR CURSOR FOR                           01384900
013850            SELECT                                                01385000
013860                  B.PKSL_ITM_QTY                                  01386000
013870                 ,B.DTL_CK_ITM_QTY                                01387000
013880                 ,EXPTED_CART_CNT                                 01388000
013890                 ,ACTL_CART_CNT                                   01389000
013900            FROM TRECITM B                                        01390000
014000            WHERE B.ORD_NBR        = :TM001-PO-NBR                01400000
014100            AND   B.REC_SEQ_NBR    = :TM001-REC-SEQ-NBR           01410000
014200            AND   B.PREPK_ID       = :TM001-PREPK-ID              01420000
014300            AND   B.VER_STATUS_CDE = 'A'                          01430000
014400            WITH UR                                               01440000
014500        END-EXEC.                                                 01450000
014600                                                                  01460000
014700********************************************************          01470000
014800 PROCEDURE DIVISION.                                              01480000
014900********************************************************          01490000
015000 0000-MAIN.                                                       01500000
015100     PERFORM 1000-INITIALIZATION         THRU 1000-EXIT.          01510000
015200                                                                  01520000
015300     PERFORM 2000-PROCESS-INPUT-FILE     THRU 2000-EXIT           01530000
015400                            UNTIL PS-EOF.                         01540000
015410                                                                  01541000
015420     CLOSE EXTRACT-TRBL-FILE-IN                                   01542000
015430           EXTRACT-TRBL-FILE-OUT.                                 01543000
015440                                                                  01544000
015450     DISPLAY 'NUMBER OF RECORDS READ IS:     '                    01545000
015451         WS-RECORDS-READ-QTY.                                     01545100
015452     DISPLAY 'NUMBER OF RECORDS WRITTEN IS:  '                    01545200
015453         WS-RECORDS-WRITE-QTY.                                    01545300
015454 0000-EXIT.  STOP RUN.                                            01545400
015455                                                                  01545500
015456 1000-INITIALIZATION.                                             01545600
015457*********************************************************         01545700
015458* ADDED ECOMM CURSOR LOGIC TO END OF PARAGRAPH                    01545800
015459* TO BUILD THE PV-ECOMM-DC TABLE USED IN LOC VERIFICATION         01545900
015460* (WR38216)                                                       01546000
015470*********************************************************         01547000
015480                                                                  01548000
015490      ACCEPT CC-CONTROL-CARD FROM SYSIN.                          01549000
015500      OPEN INPUT  EXTRACT-TRBL-FILE-IN                            01550000
015600           OUTPUT EXTRACT-TRBL-FILE-OUT.                          01560000
015700                                                                  01570000
015800**** READING THE HEADER RECORD.                                   01580000
015900      READ EXTRACT-TRBL-FILE-IN  INTO                             01590000
016000                                  TM001-TROUBLE-EXT-RECORD        01600000
016100          AT END                                                  01610000
016200             SET PS-EOF TO TRUE                                   01620000
016300          NOT AT END                                              01630000
016400             ADD  +1                    TO WS-RECORDS-READ-QTY    01640000
016500      END-READ.                                                   01650000
016600                                                                  01660000
016700**** WRITE THE HEADER RECORD.                                     01670000
016800      WRITE TE-TRBL-EXTRACT-OUT-RECORD  FROM                      01680000
016900                                  TM001-TROUBLE-EXT-RECORD.       01690000
017000      ADD  +1                    TO WS-RECORDS-WRITE-QTY.         01700000
017100                                                                  01710000
017200      IF NOT PS-EOF                                               01720000
017300         SET PS-ECOMM-CURSOR-NOT-DONE TO TRUE                     01730000
017400         PERFORM 9000-OPEN-ECOMM-CURSOR                           01740000
017410         PERFORM 9001-FETCH-ECOMM-CURSOR                          01741000
017411            VARYING RV-IDX FROM 1 BY 1                            01741100
017412            UNTIL PS-ECOMM-CURSOR-DONE                            01741200
017413         PERFORM 9002-CLOSE-ECOMM-CURSOR                          01741300
017414      END-IF.                                                     01741400
017415                                                                  01741500
017416 1000-EXIT.  EXIT.                                                01741600
017417                                                                  01741700
017418 2000-PROCESS-INPUT-FILE.                                         01741800
017419      INITIALIZE TM001-TROUBLE-EXT-RECORD.                        01741900
017420      READ EXTRACT-TRBL-FILE-IN  INTO                             01742000
017430                                  TM001-TROUBLE-EXT-RECORD        01743000
017440         AT END                                                   01744000
017450            SET PS-EOF TO TRUE                                    01745000
017460         NOT AT END                                               01746000
017470           ADD  +1                    TO WS-RECORDS-READ-QTY      01747000
017480*          IF PS-FIRST-TIME-THRU                                  01748000
017490*             MOVE TM001-PO-NBR      TO PV-PO-NBR-SAVE            01749000
017500*             MOVE TM001-REC-SEQ-NBR TO PV-REC-SEQ-NBR-SAVE       01750000
017600*             MOVE TM001-PO-LNE-NBR  TO PV-PO-LNE-NBR-SAVE        01760000
017700*             MOVE TM001-OPER-UNT-ID TO PV-OPER-UNT-ID-SAVE       01770000
017800*             MOVE TM001-FCLTY-ID    TO PV-FCLTY-ID-SAVE          01780000
017900*             PERFORM 2100-UPDATE-INPUT-FILE THRU 2100-EXIT       01790000
018000*             SET PS-NOT-FIRST-TIME-THRU  TO TRUE                 01800000
018100*          ELSE                                                   01810000
018200              PERFORM 2100-UPDATE-INPUT-FILE THRU 2100-EXIT       01820000
018300*          END-IF                                                 01830000
018400                                                                  01840000
018500           IF TM001-PO-NBR      IS NOT = PV-PO-NBR-SAVE           01850000
018600              MOVE TM001-PO-NBR TO PV-PO-NBR-SAVE                 01860000
018700           END-IF                                                 01870000
018800           IF TM001-REC-SEQ-NBR IS NOT = PV-REC-SEQ-NBR-SAVE      01880000
018900              MOVE TM001-REC-SEQ-NBR TO PV-REC-SEQ-NBR-SAVE       01890000
019000           END-IF                                                 01900000
019100           IF TM001-PO-LNE-NBR  IS NOT = PV-PO-LNE-NBR-SAVE       01910000
019200              MOVE TM001-PO-LNE-NBR  TO PV-PO-LNE-NBR-SAVE        01920000
019300           END-IF                                                 01930000
019400           IF TM001-OPER-UNT-ID IS NOT = PV-OPER-UNT-ID-SAVE      01940000
019500              MOVE TM001-OPER-UNT-ID TO PV-OPER-UNT-ID-SAVE       01950000
019600           END-IF                                                 01960000
019700           IF TM001-FCLTY-ID    IS NOT = PV-FCLTY-ID-SAVE         01970000
019800              MOVE TM001-FCLTY-ID TO PV-FCLTY-ID-SAVE             01980000
019900           END-IF                                                 01990000
020000           IF TM001-PREPK-ID    IS NOT = PV-PREPK-ID-SAVE         02000000
020100              MOVE TM001-PREPK-ID TO PV-PREPK-ID-SAVE             02010000
020200           END-IF                                                 02020000
020300      END-READ.                                                   02030000
020400 2000-EXIT. EXIT.                                                 02040000
020500                                                                  02050000
020600 2100-UPDATE-INPUT-FILE.                                          02060000
020700***************************************************************   02070000
020800*** CHANGED LOGIC TO USE 3000- TO TEST THAT OPER UNT IS A DC      02080000
020900*** AND 3001- TO VERIFY THAT RECVER LOC IS NOT A DC               02090000
021000*** (WR38216)                                                     02100000
021100***************************************************************   02110000
021200        IF TM001-PO-LNE-NBR > 0 OR TM001-PREPK-ID > 0             02120000
021300           IF TM001-PO-NBR      IS NOT = PV-PO-NBR-SAVE      OR   02130000
021400              TM001-REC-SEQ-NBR IS NOT = PV-REC-SEQ-NBR-SAVE OR   02140000
021500              TM001-PREPK-ID    IS NOT = PV-PREPK-ID-SAVE    OR   02150000
021600              TM001-PO-LNE-NBR  IS NOT = PV-PO-LNE-NBR-SAVE  OR   02160000
021700              TM001-OPER-UNT-ID IS NOT = PV-OPER-UNT-ID-SAVE OR   02170000
021800              TM001-FCLTY-ID    IS NOT = PV-FCLTY-ID-SAVE         02180000
021900                 PERFORM 2120-ADD-TRECITM-INFO  THRU 2120-EXIT    02190000
022000           ELSE                                                   02200000
022100                 MOVE PV-LINE-CART-CNT-SAVE TO TM001-LINE-CART-CNT02210000
022200                 MOVE PV-LINE-ITEM-QTY-SAVE TO TM001-LINE-ITEM-QTY02220000
022300                 MOVE PV-PACK-ITEM-QTY-SAVE TO TM001-PACK-ITEM-QTY02230000
022400                 MOVE PV-RECITM-PREPK-ID-SAVE TO                  02240000
022500                                         TM001-RECITM-PREPK-ID    02250000
022600           END-IF                                                 02260000
022700      END-IF                                                      02270000
022800                                                                  02280000
022900      IF TM001-PO-NBR      IS NOT = PV-PO-NBR-SAVE OR             02290000
023000         TM001-REC-SEQ-NBR IS NOT = PV-REC-SEQ-NBR-SAVE           02300000
023100         PERFORM 2110-ADD-TRECEIV-INFO    THRU 2110-EXIT          02310000
023200      ELSE                                                        02320000
023300         MOVE PV-RCVR-CART-CNT-SAVE TO  TM001-RCVR-CART-CNT       02330000
023400         MOVE PV-RCVR-ITEM-QTY-SAVE TO  TM001-RCVR-ITEM-QTY       02340000
023500         MOVE PV-RECEIPT-DATE-SAVE  TO  TM001-RECEIPT-DATE        02350000
023600         IF TM001-PO-LNE-NBR = 0 AND TM001-PREPK-ID = 0           02360000
023610             MOVE PV-PACK-ITEM-QTY-SAVE TO TM001-PACK-ITEM-QTY    02361000
023620             MOVE PV-LINE-ITEM-QTY-SAVE TO TM001-LINE-ITEM-QTY    02362000
023630             MOVE PV-LINE-CART-CNT-SAVE TO TM001-LINE-CART-CNT    02363000
023640             MOVE ZEROS                 TO TM001-RECITM-PREPK-ID  02364000
023650          END-IF                                                  02365000
023660         IF  PV-RCVR-OPER-UNT-ID = 0                              02366000
023670             CONTINUE                                             02367000
023680         ELSE                                                     02368000
023690             MOVE PV-RCVR-FCLTY-ID    TO TM001-FCLTY-ID           02369000
023700* * *  SAVE THE EFC RECORDS FOR TMKRP017                          02370000
023800             PERFORM 3000-CHK-TM001-OPER-UNT-ID                   02380000
023900             PERFORM 3001-CHK-RCVR-OPER-UNT-ID                    02390000
024000             IF CC-EFC-OPER-UNT-NO-OVERLAY                        02400000
024100               AND PS-RCVR-OPER-UNT-NOT-DC                        02410000
024200               AND PS-TM001-OPER-UNT-DC                           02420000
024300                 WRITE TE-TRBL-EXTRACT-OUT-RECORD  FROM           02430000
024400                                  TM001-TROUBLE-EXT-RECORD        02440000
024500                 ADD  +1              TO WS-RECORDS-WRITE-QTY     02450000
024600             END-IF                                               02460000
024601             MOVE PV-RCVR-OPER-UNT-ID TO TM001-OPER-UNT-ID        02460100
024602         END-IF                                                   02460200
024603      END-IF                                                      02460300
024604                                                                  02460400
024605      WRITE TE-TRBL-EXTRACT-OUT-RECORD  FROM                      02460500
024606                                  TM001-TROUBLE-EXT-RECORD.       02460600
024607      ADD  +1                    TO WS-RECORDS-WRITE-QTY.         02460700
024608                                                                  02460800
024609 2100-EXIT.  EXIT.                                                02460900
024610                                                                  02461000
024620 2110-ADD-TRECEIV-INFO.                                           02462000
024630***************************************************************   02463000
024640*** CHANGED LOGIC TO USE 3000- TO TEST THAT OPER UNT IS A DC      02464000
024650*** AND 3001- TO VERIFY THAT RECVER LOC IS NOT A DC               02465000
024660*** (WR38216)                                                     02466000
024670***************************************************************   02467000
024680         PERFORM 2115-GET-TRECEIV-ROW     THRU 2115-EXIT          02468000
024690         EVALUATE TRUE                                            02469000
024700           WHEN PS-TRECEIV-ROW-FND                                02470000
024800                MOVE RECEIV-REC-TMST  TO PV-TMST                  02480000
024900                MOVE ZEROS          TO TM001-RECITM-PREPK-ID      02490000
025000                MOVE PV-TMST-YYYY   TO TM001-RECEIPT-YYYY         02500000
025100                                       PV-RECEIPT-YYYY-SAVE       02510000
025200                MOVE PV-TMST-MM     TO TM001-RECEIPT-MM           02520000
025300                                       PV-RECEIPT-MM-SAVE         02530000
025400                MOVE PV-TMST-DD     TO TM001-RECEIPT-DD           02540000
025500                                       PV-RECEIPT-DD-SAVE         02550000
025600                MOVE RECEIV-CURR-FCLTY-ID                         02560000
025700                                    TO TM001-FCLTY-ID             02570000
025800                                       PV-RCVR-FCLTY-ID           02580000
025900                                                                  02590000
026000                IF PV-RCVR-ACTL-CART-CNT > 0                      02600000
026010                    MOVE PV-RCVR-ACTL-CART-CNT    TO              02601000
026020                                     TM001-RCVR-CART-CNT          02602000
026030                                     PV-RCVR-CART-CNT-SAVE        02603000
026040                ELSE                                              02604000
026050                    MOVE PV-RCVR-EXPTED-CART-CNT TO               02605000
026060                                     TM001-RCVR-CART-CNT          02606000
026070                                     PV-RCVR-CART-CNT-SAVE        02607000
026080                END-IF                                            02608000
026090                IF PV-RCVR-ACTL-ITM-QTY > 0                       02609000
026100                    MOVE PV-RCVR-ACTL-ITM-QTY    TO               02610000
026200                                     TM001-RCVR-ITEM-QTY          02620000
026300                                     PV-RCVR-ITEM-QTY-SAVE        02630000
026400                ELSE                                              02640000
026500                    MOVE PV-RCVR-EXPTED-ITM-QTY  TO               02650000
026600                                     TM001-RCVR-ITEM-QTY          02660000
026700                                     PV-RCVR-ITEM-QTY-SAVE        02670000
026800                END-IF                                            02680000
026900                IF TM001-PO-LNE-NBR = 0                           02690000
027000                   MOVE TM001-RCVR-ITEM-QTY TO TM001-LINE-ITEM-QTY02700000
027100                                             PV-LINE-ITEM-QTY-SAVE02710000
027200                                                                  02720000
027300                   MOVE TM001-RCVR-CART-CNT TO TM001-LINE-CART-CNT02730000
027400                                             PV-LINE-CART-CNT-SAVE02740000
027500                END-IF                                            02750000
027600* * *  SAVE THE EFC RECORDS FOR TMKRP017                          02760000
027700                PERFORM 3000-CHK-TM001-OPER-UNT-ID                02770000
027800                PERFORM 3002-CHK-RECEIV-OPER-UNT-ID               02780000
027900                IF CC-EFC-OPER-UNT-NO-OVERLAY                     02790000
028000                  AND PS-RECEIV-OPER-UNT-NOT-DC                   02800000
028100                  AND PS-TM001-OPER-UNT-DC                        02810000
028200                    WRITE TE-TRBL-EXTRACT-OUT-RECORD  FROM        02820000
028300                            TM001-TROUBLE-EXT-RECORD              02830000
028400                    ADD  +1         TO WS-RECORDS-WRITE-QTY       02840000
028500                END-IF                                            02850000
028600                MOVE RECEIV-CURR-OPER-UNT-ID                      02860000
028700                                    TO TM001-OPER-UNT-ID          02870000
028800                                       PV-RCVR-OPER-UNT-ID        02880000
028900                                                                  02890000
029000           WHEN PS-TRECEIV-ROW-NOT-FND                            02900000
029100                MOVE ZEROS   TO TM001-RCVR-CART-CNT               02910000
029200                                PV-RCVR-CART-CNT-SAVE             02920000
029300                MOVE ZEROS   TO TM001-RCVR-ITEM-QTY               02930000
029301                                PV-RCVR-ITEM-QTY-SAVE             02930100
029302                MOVE SPACE   TO TM001-RECEIPT-YYYY                02930200
029303                                PV-RECEIPT-YYYY-SAVE              02930300
029304                MOVE SPACE   TO TM001-RECEIPT-MM                  02930400
029305                                PV-RECEIPT-MM-SAVE                02930500
029306                MOVE SPACE   TO TM001-RECEIPT-DD                  02930600
029307                                PV-RECEIPT-DD-SAVE                02930700
029308                MOVE ZEROS   TO PV-RCVR-OPER-UNT-ID               02930800
029309                                PV-RCVR-FCLTY-ID                  02930900
029310                IF TM001-PO-LNE-NBR = 0                           02931000
029320                   MOVE ZEROS TO TM001-LINE-ITEM-QTY              02932000
029330                                 PV-LINE-ITEM-QTY-SAVE            02933000
029340                   MOVE ZEROS TO TM001-LINE-CART-CNT              02934000
029350                                 PV-LINE-CART-CNT-SAVE            02935000
029360                END-IF                                            02936000
029370                IF TM001-PREPK-ID = 0                             02937000
029380                   MOVE ZEROS TO TM001-PACK-ITEM-QTY              02938000
029390                                 PV-PACK-ITEM-QTY-SAVE            02939000
029400                END-IF                                            02940000
029500                MOVE ZEROS          TO TM001-RECITM-PREPK-ID      02950000
029600           END-EVALUATE.                                          02960000
029700 2110-EXIT.  EXIT.                                                02970000
029800                                                                  02980000
029900 2115-GET-TRECEIV-ROW.                                            02990000
030000      EXEC SQL                                                    03000000
030100                SELECT                                            03010000
030200                      A.REC_TMST                                  03020000
030300                     ,A.EXPTED_CART_CNT                           03030000
030400                     ,A.ACTL_CART_CNT                             03040000
030500                     ,A.CURR_OPER_UNT_ID                          03050000
030600                     ,A.CURR_FCLTY_ID                             03060000
030700                 INTO  :RECEIV-REC-TMST                           03070000
030800                      ,:PV-RCVR-EXPTED-CART-CNT                   03080000
030900                      ,:PV-RCVR-ACTL-CART-CNT                     03090000
031000                      ,:RECEIV-CURR-OPER-UNT-ID                   03100000
031100                      ,:RECEIV-CURR-FCLTY-ID                      03110000
031200                FROM TRECEIV A                                    03120000
031300                WHERE A.ORD_NBR     = :TM001-PO-NBR               03130000
031400                  AND A.REC_SEQ_NBR = :TM001-REC-SEQ-NBR          03140000
031500                 WITH UR                                          03150000
031600       END-EXEC.                                                  03160000
031700                                                                  03170000
031800       EVALUATE TRUE                                              03180000
031900            WHEN SQLCODE = ZERO                                   03190000
032000                SET PS-TRECEIV-ROW-FND   TO TRUE                  03200000
032100            WHEN SQLCODE = +100                                   03210000
032200                MOVE SPACES              TO RECEIV-REC-TMST       03220000
032300                MOVE 0 TO PV-RCVR-EXPTED-CART-CNT                 03230000
032400                          PV-RCVR-ACTL-CART-CNT                   03240000
032500                SET  PS-TRECEIV-ROW-NOT-FND  TO TRUE              03250000
032600            WHEN OTHER                                            03260000
032700               MOVE '2115-GET-TRECEIV-ROW  ' TO PV-ABEND-PARA-NAME03270000
032800                MOVE 'SELECT TRECEIV ROW'                         03280000
032900                                         TO PV-DB2-OPERATION-MSG-103290000
033000                MOVE 'TRECEIV'           TO PV-DB2-TABLE-NAME     03300000
033100                PERFORM 9998-SQL-ABEND   THRU 9998-EXIT           03310000
033200      END-EVALUATE.                                               03320000
033300                                                                  03330000
033400      EXEC SQL                                                    03340000
033500                SELECT                                            03350000
033510                      SUM(B.PKSL_ITM_QTY)                         03351000
033520                     ,SUM(B.DTL_CK_ITM_QTY)                       03352000
033530                 INTO                                             03353000
033540                       :PV-RCVR-EXPTED-ITM-QTY                    03354000
033550                      ,:PV-RCVR-ACTL-ITM-QTY                      03355000
033560                FROM TRECITM B                                    03356000
033570                WHERE B.ORD_NBR     = :TM001-PO-NBR               03357000
033580                  AND B.REC_SEQ_NBR = :TM001-REC-SEQ-NBR          03358000
033590                  AND B.VER_STATUS_CDE = 'A'                      03359000
033600                 WITH UR                                          03360000
033601       END-EXEC.                                                  03360100
033602                                                                  03360200
033603       EVALUATE TRUE                                              03360300
033604            WHEN SQLCODE = ZERO                                   03360400
033605                SET PS-TRECEIV-ROW-FND       TO TRUE              03360500
033606            WHEN SQLCODE = +100                                   03360600
033607            WHEN SQLCODE = -305                                   03360700
033608*               IF THE TRECEIV ROW WAS FOUND, PUT 0 INTO THE      03360800
033609*               TRECITM VALUES AND LEAVE FLAG AS-IS               03360900
033610                IF PS-TRECEIV-ROW-FND                             03361000
033611                    MOVE 0 TO PV-RCVR-EXPTED-ITM-QTY              03361100
033612                              PV-RCVR-ACTL-ITM-QTY                03361200
033613                END-IF                                            03361300
033614            WHEN OTHER                                            03361400
033615               MOVE '2115-GET-TRECEIV-ROW  ' TO PV-ABEND-PARA-NAME03361500
033616                MOVE 'SELECT TRECITM ROWS'                        03361600
033617                                         TO PV-DB2-OPERATION-MSG-103361700
033618                MOVE 'TRECITM'           TO PV-DB2-TABLE-NAME     03361800
033619                PERFORM 9998-SQL-ABEND   THRU 9998-EXIT           03361900
033620        END-EVALUATE.                                             03362000
033621                                                                  03362100
033622 2115-EXIT.  EXIT.                                                03362200
033623                                                                  03362300
033624 2120-ADD-TRECITM-INFO.                                           03362400
033625            PERFORM 2125-GET-TRECITM   THRU 2125-EXIT             03362500
033626            EVALUATE TRUE                                         03362600
033627             WHEN PS-TRECITM-ROW-FND AND TM001-PREPK-ID = 0       03362700
033628                   IF RECITM-DTL-CK-ITM-QTY > 0                   03362800
033629                       MOVE RECITM-DTL-CK-ITM-QTY    TO           03362900
033630                                        TM001-LINE-ITEM-QTY       03363000
033640                                        PV-LINE-ITEM-QTY-SAVE     03364000
033650                       MOVE ZERO TO TM001-PACK-ITEM-QTY           03365000
033660                   ELSE                                           03366000
033670                       MOVE RECITM-PKSL-ITM-QTY      TO           03367000
033680                                        TM001-LINE-ITEM-QTY       03368000
033690                                        PV-LINE-ITEM-QTY-SAVE     03369000
033700                       MOVE ZERO TO TM001-PACK-ITEM-QTY           03370000
033800                   END-IF                                         03380000
033900                   IF RECITM-ACTL-CART-CNT > 0                    03390000
034000                       MOVE RECITM-ACTL-CART-CNT    TO            03400000
034100                                        TM001-LINE-CART-CNT       03410000
034200                                        PV-LINE-CART-CNT-SAVE     03420000
034300                   ELSE                                           03430000
034400                       MOVE RECITM-EXPTED-CART-CNT  TO            03440000
034500                                        TM001-LINE-CART-CNT       03450000
034600                                        PV-LINE-CART-CNT-SAVE     03460000
034700                   END-IF                                         03470000
034800                   MOVE RECITM-PREPK-ID TO TM001-RECITM-PREPK-ID  03480000
034900                   MOVE RECITM-PREPK-ID TO                        03490000
035000                                      PV-RECITM-PREPK-ID-SAVE     03500000
035100                                                                  03510000
035200              WHEN PS-TRECITM-ROW-NOT-FND AND TM001-PREPK-ID = 0  03520000
035300                   MOVE ZEROS   TO TM001-LINE-CART-CNT            03530000
035400                                   PV-LINE-CART-CNT-SAVE          03540000
035500                   MOVE ZEROS   TO TM001-LINE-ITEM-QTY            03550000
035600                                   PV-LINE-ITEM-QTY-SAVE          03560000
035700                   MOVE ZEROS   TO  PV-RECITM-PREPK-ID-SAVE       03570000
035800                                    TM001-RECITM-PREPK-ID         03580000
035900                                                                  03590000
036000              WHEN PS-TRECITM-PKROW-FND AND TM001-PREPK-ID > 0    03600000
036100                   IF PV-PACK-ACTL-ITM-QTY > 0                    03610000
036200                       MOVE PV-PACK-ACTL-ITM-QTY     TO           03620000
036300                                        TM001-PACK-ITEM-QTY       03630000
036400                                        PV-PACK-ITEM-QTY-SAVE     03640000
036500                       MOVE ZERO TO TM001-LINE-ITEM-QTY           03650000
036600                   ELSE                                           03660000
036700                       MOVE PV-PACK-EXPTED-ITM-QTY   TO           03670000
036710                                        TM001-PACK-ITEM-QTY       03671000
036720                                        PV-PACK-ITEM-QTY-SAVE     03672000
036721                       MOVE ZERO TO TM001-LINE-ITEM-QTY           03672100
036722                   END-IF                                         03672200
036723                   IF PV-PACK-ACTL-CART-CNT > 0                   03672300
036724                       MOVE PV-PACK-ACTL-CART-CNT   TO            03672400
036725                                        TM001-LINE-CART-CNT       03672500
036726                                        PV-LINE-CART-CNT-SAVE     03672600
036727                   ELSE                                           03672700
036728                       MOVE PV-PACK-EXPTED-CART-CNT   TO          03672800
036729                                        TM001-LINE-CART-CNT       03672900
036730                                        PV-LINE-CART-CNT-SAVE     03673000
036740                   END-IF                                         03674000
036750                   MOVE TM001-PREPK-ID TO TM001-RECITM-PREPK-ID   03675000
036760                   MOVE TM001-PREPK-ID TO                         03676000
036770                                      PV-RECITM-PREPK-ID-SAVE     03677000
036780                                                                  03678000
036790              WHEN PS-TRECITM-PKROW-NOT-FND AND TM001-PREPK-ID > 003679000
036800                   MOVE ZEROS   TO TM001-PACK-ITEM-QTY            03680000
036900                                   PV-PACK-ITEM-QTY-SAVE          03690000
037000                   MOVE ZEROS   TO TM001-LINE-CART-CNT            03700000
037100                                   PV-LINE-CART-CNT-SAVE          03710000
037200                   MOVE ZEROS   TO PV-RECITM-PREPK-ID-SAVE        03720000
037300                                   TM001-RECITM-PREPK-ID          03730000
037301                                                                  03730100
037302           END-EVALUATE.                                          03730200
037303 2120-EXIT.  EXIT.                                                03730300
037304                                                                  03730400
037305 2125-GET-TRECITM.                                                03730500
037306     IF TM001-PREPK-ID = 0                                        03730600
037307      EXEC SQL                                                    03730700
037308                SELECT                                            03730800
037309                      PKSL_ITM_QTY                                03730900
037310                     ,DTL_CK_ITM_QTY                              03731000
037320                     ,EXPTED_CART_CNT                             03732000
037330                     ,ACTL_CART_CNT                               03733000
037340                     ,PREPK_ID                                    03734000
037350                 INTO  :RECITM-PKSL-ITM-QTY                       03735000
037360                      ,:RECITM-DTL-CK-ITM-QTY                     03736000
037370                      ,:RECITM-EXPTED-CART-CNT                    03737000
037380                      ,:RECITM-ACTL-CART-CNT                      03738000
037390                      ,:RECITM-PREPK-ID                           03739000
037400                FROM TRECITM                                      03740000
037500                WHERE  ORD_NBR     = :TM001-PO-NBR                03750000
037600                   AND ORD_LNE_NBR = :TM001-PO-LNE-NBR            03760000
037700                   AND REC_SEQ_NBR = :TM001-REC-SEQ-NBR           03770000
037800                   AND OPER_UNT_ID = :TM001-OPER-UNT-ID           03780000
037900                   AND FCLTY_ID    = :TM001-FCLTY-ID              03790000
038000                   AND VER_STATUS_CDE = 'A'                       03800000
038100                 WITH UR                                          03810000
038200       END-EXEC                                                   03820000
038300                                                                  03830000
038400       EVALUATE TRUE                                              03840000
038500            WHEN SQLCODE = ZERO                                   03850000
038600                SET PS-TRECITM-ROW-FND       TO TRUE              03860000
038700            WHEN SQLCODE = +100                                   03870000
038800                SET  PS-TRECITM-ROW-NOT-FND  TO TRUE              03880000
038900            WHEN OTHER                                            03890000
039000               MOVE '2125-GET-TRECITM-ROW  ' TO PV-ABEND-PARA-NAME03900000
039100                MOVE 'SELECT TRECITM ROW'                         03910000
039200                                         TO PV-DB2-OPERATION-MSG-103920000
039300                MOVE 'TRECITM'           TO PV-DB2-TABLE-NAME     03930000
039400                PERFORM 9998-SQL-ABEND   THRU 9998-EXIT           03940000
039500        END-EVALUATE.                                             03950000
039600                                                                  03960000
039700     IF TM001-PREPK-ID > 0                                        03970000
039800        MOVE ZEROS TO PV-PACK-EXPTED-ITM-QTY                      03980000
039900        MOVE ZEROS TO PV-PACK-ACTL-ITM-QTY                        03990000
040000        MOVE ZEROS TO PV-PACK-EXPTED-CART-CNT                     04000000
040100        MOVE ZEROS TO PV-PACK-ACTL-CART-CNT                       04010000
040200        PERFORM 2126-OPEN-PACK-CURSOR                             04020000
040300        PERFORM 2127-FETCH-PACK-CURSOR                            04030000
040400           UNTIL PS-PACK-CURSOR-DONE                              04040000
040500        PERFORM 2128-CLOSE-PACK-CURSOR                            04050000
040600     END-IF.                                                      04060000
040700 2125-EXIT.   EXIT.                                               04070000
040800                                                                  04080000
040900 2127-FETCH-PACK-CURSOR.                                          04090000
041000                                                                  04100000
041100     EXEC SQL                                                     04110000
041200          FETCH PACK_CURSOR                                       04120000
041300            INTO  :RECITM-PKSL-ITM-QTY                            04130000
041400                 ,:RECITM-DTL-CK-ITM-QTY                          04140000
041500                 ,:RECITM-EXPTED-CART-CNT                         04150000
041600                 ,:RECITM-ACTL-CART-CNT                           04160000
041700     END-EXEC                                                     04170000
041800                                                                  04180000
041900     EVALUATE TRUE                                                04190000
042000         WHEN SQLCODE = ZERO                                      04200000
042100             SET PS-TRECITM-PKROW-FND      TO TRUE                04210000
042200             IF RECITM-DTL-CK-ITM-QTY = 0                         04220000
042300                MOVE RECITM-PKSL-ITM-QTY TO                       04230000
042400                     RECITM-DTL-CK-ITM-QTY                        04240000
042500             END-IF                                               04250000
042600             ADD  RECITM-PKSL-ITM-QTY TO                          04260000
042700                  PV-PACK-EXPTED-ITM-QTY                          04270000
042800             ADD  RECITM-DTL-CK-ITM-QTY TO                        04280000
042900                  PV-PACK-ACTL-ITM-QTY                            04290000
043000             ADD  RECITM-EXPTED-CART-CNT TO                       04300000
043100                  PV-PACK-EXPTED-CART-CNT                         04310000
043200             ADD  RECITM-ACTL-CART-CNT  TO                        04320000
043300                  PV-PACK-ACTL-CART-CNT                           04330000
043400         WHEN SQLCODE = +100                                      04340000
043500             SET PS-PACK-CURSOR-DONE     TO TRUE                  04350000
043600         WHEN SQLWARN0 NOT EQUAL SPACE                            04360000
043700         WHEN SQLCODE NOT EQUAL ZERO                              04370000
043800               MOVE '2127-FETCH-PACK-CURSOR' TO PV-ABEND-PARA-NAME04380000
043900                MOVE 'OPEN TRECITM CURSOR'                        04390000
044000                                         TO PV-DB2-OPERATION-MSG-104400000
044100                MOVE 'TRECITM'           TO PV-DB2-TABLE-NAME     04410000
044200                PERFORM 9998-SQL-ABEND   THRU 9998-EXIT           04420000
044300     END-EVALUATE.                                                04430000
044400                                                                  04440000
044500 2126-OPEN-PACK-CURSOR.                                           04450000
044600                                                                  04460000
044700     EXEC SQL                                                     04470000
044800          OPEN PACK_CURSOR                                        04480000
044900     END-EXEC                                                     04490000
045000                                                                  04500000
045100     EVALUATE TRUE                                                04510000
045200         WHEN SQLCODE = ZERO                                      04520000
045300             SET PS-PACK-CURSOR-NOT-DONE TO TRUE                  04530000
045400             SET PS-TRECITM-PKROW-NOT-FND TO TRUE                 04540000
045500         WHEN SQLWARN0 NOT EQUAL SPACE                            04550000
045600         WHEN SQLCODE NOT EQUAL ZERO                              04560000
045700               MOVE '2126-OPEN-PACK-CURSOR ' TO PV-ABEND-PARA-NAME04570000
045800                MOVE 'OPEN TRECITM CURSOR'                        04580000
045900                                         TO PV-DB2-OPERATION-MSG-104590000
046000                MOVE 'TRECITM'           TO PV-DB2-TABLE-NAME     04600000
046100                PERFORM 9998-SQL-ABEND   THRU 9998-EXIT           04610000
046200     END-EVALUATE.                                                04620000
046300                                                                  04630000
046400 2128-CLOSE-PACK-CURSOR.                                          04640000
046500                                                                  04650000
046600     EXEC SQL                                                     04660000
046700          CLOSE PACK_CURSOR                                       04670000
046800     END-EXEC                                                     04680000
046900                                                                  04690000
047000     EVALUATE TRUE                                                04700000
047100         WHEN SQLCODE = ZERO                                      04710000
047200              CONTINUE                                            04720000
047300         WHEN SQLWARN0 NOT EQUAL SPACE                            04730000
047400         WHEN SQLCODE NOT EQUAL ZERO                              04740000
047500               MOVE '2128-CLOSE-PACK-CURSOR' TO PV-ABEND-PARA-NAME04750000
047600                MOVE 'CLOSE TRECITM CURSOR'                       04760000
047700                                         TO PV-DB2-OPERATION-MSG-104770000
047800                MOVE 'TRECITM'           TO PV-DB2-TABLE-NAME     04780000
047900                PERFORM 9998-SQL-ABEND   THRU 9998-EXIT           04790000
048000     END-EVALUATE.                                                04800000
048100                                                                  04810000
048200 3000-CHK-TM001-OPER-UNT-ID.                                      04820000
048300*********************************************************         04830000
048310* SEARCH TABLE TO VERIFICATION CHECK IF LOC IS DC OR NOT          04831000
048311* (WR38216)                                                       04831100
048312*********************************************************         04831200
048313                                                                  04831300
048314      MOVE TM001-OPER-UNT-ID TO PV-ECOMM-KEY.                     04831400
048315      SET RV-IDX TO 1                                             04831500
048316      SEARCH PV-ECOMM-DC                                          04831600
048317         AT END                                                   04831700
048318            SET RV-IDX TO 1                                       04831800
048319            SET PS-TM001-OPER-UNT-NOT-DC TO TRUE                  04831900
048320         WHEN PV-EFC-NBR (RV-IDX) = PV-ECOMM-KEY                  04832000
048321            SET PS-TM001-OPER-UNT-DC TO TRUE                      04832100
048322      END-SEARCH.                                                 04832200
048323                                                                  04832300
048324 3001-CHK-RCVR-OPER-UNT-ID.                                       04832400
048325*********************************************************         04832500
048326* SEARCH TABLE TO VERIFICATION CHECK IF LOC IS DC OR NOT          04832600
048327* (WR38216)                                                       04832700
048328*********************************************************         04832800
048329                                                                  04832900
048330      MOVE PV-RCVR-OPER-UNT-ID TO PV-ECOMM-KEY.                   04833000
048331      SET RV-IDX TO 1                                             04833100
048332      SEARCH PV-ECOMM-DC                                          04833200
048333         AT END                                                   04833300
048334            SET RV-IDX TO 1                                       04833400
048335            SET PS-RCVR-OPER-UNT-NOT-DC TO TRUE                   04833500
048336         WHEN PV-EFC-NBR (RV-IDX) = PV-ECOMM-KEY                  04833600
048337            SET PS-RCVR-OPER-UNT-DC TO TRUE                       04833700
048338      END-SEARCH.                                                 04833800
048339                                                                  04833900
048340 3002-CHK-RECEIV-OPER-UNT-ID.                                     04834000
048341*********************************************************         04834100
048342* SEARCH TABLE TO VERIFICATION CHECK IF LOC IS DC OR NOT          04834200
048343* (WR38216)                                                       04834300
048344*********************************************************         04834400
048345                                                                  04834500
048346      MOVE RECEIV-CURR-OPER-UNT-ID TO PV-ECOMM-KEY.               04834600
048347      SET RV-IDX TO 1                                             04834700
048348      SEARCH PV-ECOMM-DC                                          04834800
048349         AT END                                                   04834900
048350            SET RV-IDX TO 1                                       04835000
048351            SET PS-RECEIV-OPER-UNT-NOT-DC TO TRUE                 04835100
048352         WHEN PV-EFC-NBR (RV-IDX) = PV-ECOMM-KEY                  04835200
048353            SET PS-RECEIV-OPER-UNT-DC TO TRUE                     04835300
048354      END-SEARCH.                                                 04835400
048355                                                                  04835500
048356 9000-OPEN-ECOMM-CURSOR.                                          04835600
048357*** OPENS CURSOR, ADDED FOR (WR38216)                             04835700
048358                                                                  04835800
048359     EXEC SQL                                                     04835900
048360          OPEN ECOMM_CSR                                          04836000
048361     END-EXEC                                                     04836100
048362                                                                  04836200
048363      EVALUATE TRUE                                               04836300
048364          WHEN SQLCODE = ZERO                                     04836400
048365             CONTINUE                                             04836500
048366          WHEN SQLWARN0 NOT EQUAL SPACE                           04836600
048367          WHEN SQLCODE NOT EQUAL ZERO                             04836700
048368             MOVE '9000-OPEN-ECOMM-CURSOR' TO PV-ABEND-PARA-NAME  04836800
048369             MOVE 'OPEN ECOMM CURSOR' TO PV-DB2-OPERATION-MSG-1   04836900
048370             MOVE 'XLT_LOC' TO PV-DB2-TABLE-NAME                  04837000
048371             PERFORM 9998-SQL-ABEND   THRU 9998-EXIT              04837100
048372      END-EVALUATE.                                               04837200
048373                                                                  04837300
048374 9001-FETCH-ECOMM-CURSOR.                                         04837400
048375*********************************************************         04837500
048376* BUILDS THE PV-ECOMM-DC TABLE USED IN LOC VERIFICATION           04837600
048377* (WR38216)                                                       04837700
048378*********************************************************         04837800
048379                                                                  04837900
048380     EXEC SQL                                                     04838000
048381        FETCH ECOMM_CSR                                           04838100
048382          INTO :XLT00010-LOC-NBR                                  04838200
048383     END-EXEC                                                     04838300
048384                                                                  04838400
048385     EVALUATE TRUE                                                04838500
048386        WHEN SQLCODE = ZERO                                       04838600
048387           MOVE XLT00010-LOC-NBR TO PV-EFC-NBR (RV-IDX)           04838700
048388        WHEN SQLCODE = +100                                       04838800
048389           SET PS-ECOMM-CURSOR-DONE TO TRUE                       04838900
048390        WHEN SQLWARN0 NOT EQUAL SPACE                             04839000
048391        WHEN SQLCODE NOT EQUAL ZERO                               04839100
048392           MOVE '9001-FETCH-ECOMM-CURSO' TO PV-ABEND-PARA-NAME    04839200
048393           MOVE 'OPEN TRECITM CURSOR' TO PV-DB2-OPERATION-MSG-1   04839300
048394           MOVE 'TRECITM'           TO PV-DB2-TABLE-NAME          04839400
048395           PERFORM 9998-SQL-ABEND   THRU 9998-EXIT                04839500
048396     END-EVALUATE.                                                04839600
048397                                                                  04839700
048398 9002-CLOSE-ECOMM-CURSOR.                                         04839800
048399*** CLOSES CURSOR, ADDED FOR (WR38216)                            04839900
048400                                                                  04840000
048401     EXEC SQL                                                     04840100
048402        CLOSE ECOMM_CSR                                           04840200
048403     END-EXEC                                                     04840300
048404                                                                  04840400
048405     EVALUATE TRUE                                                04840500
048406        WHEN SQLCODE = ZERO                                       04840600
048407           CONTINUE                                               04840700
048408        WHEN SQLWARN0 NOT EQUAL SPACE                             04840800
048409        WHEN SQLCODE NOT EQUAL ZERO                               04840900
048410           MOVE '9002-CLOSE-ECOMM-CURSOR' TO PV-ABEND-PARA-NAME   04841000
048411           MOVE 'CLOSE ECOMM CURSOR' TO PV-DB2-OPERATION-MSG-1    04841100
048412           MOVE 'XLT_LOC' TO PV-DB2-TABLE-NAME                    04841200
048413           PERFORM 9998-SQL-ABEND   THRU 9998-EXIT                04841300
048414     END-EVALUATE.                                                04841400
048415                                                                  04841500
048416 9998-SQL-ABEND.                                                  04841600
048417     MOVE SQLCODE     TO PV-SQLCODE.                              04841700
048418     DISPLAY '** ABEND           ** = SQLABEND'.                  04841800
048419     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          04841900
048420     DISPLAY '** PARAGRAPH       ** = ' PV-ABEND-PARA-NAME.       04842000
048421     DISPLAY '** TABLE AFFECTED  ** = ' PV-DB2-TABLE-NAME.        04842100
048422     DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.   04842200
048423     DISPLAY '** SQLCODE         ** = ' PV-SQLCODE.               04842300
048424     COPY DPPD004.                                                04842400
048425     MOVE +4013                  TO PV-ABEND-CODE.                04842500
048426     CALL 'ILBOABN0'   USING PV-ABEND-CODE.                       04842600
048427 9998-EXIT.  EXIT.                                                04842700
048428                                                                  04842800
