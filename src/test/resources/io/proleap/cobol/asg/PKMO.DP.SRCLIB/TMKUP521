000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    TMKUP521.                                         00020014
000300 AUTHOR.        THERESE RAMSEYER.                                 00030001
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  JANUARY 2005.                                     00050001
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800*    THIS PROGRAM IS A BATCH CLONE OF CICS PROGRAM TMKCS521.      00080001
000900*    IT CAN BE CALLED FROM TMKUP520 IN TMKUT500.                  00090042
001000*                                                                 00100012
001100*    THE INTENT OF THIS PROGRAM WAS TO RETAIN ALL OF THE ORIGINAL 00110072
001110*    FUNCTIONALITY OF THE CICS PROGRAM WHILE OPERATING IN BATCH   00111075
001120*    MODE TO PROCESS AUTO-ACKNOWLEDGE PO/RECEIVERS.               00112075
001130*                                                                 00113055
001140*    ONLY PARAGRAPHS 4100 & 4200 WERE ADDED IN THE MAINLINE       00114061
001150*    PROCESS LOGIC - THE 2000 PARAGRAPH WAS LEFT 'AS IS'.         00115061
001160*                                                                 00116055
001200******************************************************************00120000
001300 ENVIRONMENT DIVISION.                                            00130012
001400 CONFIGURATION SECTION.                                           00140012
001500 SOURCE-COMPUTER.  IBM-3090.                                      00150012
001600 OBJECT-COMPUTER.  IBM-3090.                                      00160012
001700 DATA DIVISION.                                                   00170012
001800****************************************************************  00180001
001900 WORKING-STORAGE SECTION.                                         00190000
002000****************************************************************  00200001
002100                                                                  00210000
002200 01  PC-PROGRAM-CONSTANTS.                                        00220000
002300     05  CURRENT-ABSTIME              PIC S9(15) VALUE +0         00230000
002400                                                 COMP-3.          00240000
002500     05  PC-MAX-RETRIES               PIC S9(4) VALUE +3          00250000
002600                                                COMP SYNC.        00260000
002700     05  PC-RAND-PGM                  PIC X(8) VALUE 'DPKUT902'.  00270000
002800     05  PC-CURRENT-PROGRAM-NAME      PIC X(8) VALUE 'TMKUP521'.  00280014
002900     05  PC-ACTIVE                    PIC X(01) VALUE 'A'.        00290000
003000     05  PC-ACKNOWLEDGED              PIC X(35)                   00300087
003100                 VALUE 'AUTO ACKNOWLEDGED AND AUTO REDISTRO'.     00310087
003110     05  PC-TIME-LAPSE-FAIL           PIC X(31)                   00311022
003120                     VALUE 'FAILED AFTER WAIT TIME EXCEEDED'.     00312022
003200     05  PC-D                         PIC X(01) VALUE 'D'.        00320000
003300     05  PC-N                         PIC X(01) VALUE 'N'.        00330000
003400     05  PC-Y                         PIC X(01) VALUE 'Y'.        00340000
003500     05  PC-I                         PIC X(01) VALUE 'I'.        00350000
003600     05  PC-R                         PIC X(01) VALUE 'R'.        00360000
003700     05  PC-A                         PIC X(01) VALUE 'A'.        00370000
003800     05  PC-T                         PIC X(01) VALUE 'T'.        00380000
003900     05  PC-P                         PIC X(01) VALUE 'P'.        00390000
004000     05  PC-1                         PIC S9(4) VALUE +1   COMP.  00400000
004100     05  PC-50                        PIC S9(4) VALUE +50  COMP.  00410000
004200     05  PC-90                        PIC S9(4) VALUE +90  COMP.  00420000
004300     05  PC-100                       PIC S9(4) VALUE +100 COMP.  00430000
004400     05  PC-150                       PIC S9(4) VALUE +150 COMP.  00440000
004500     05  PC-200                       PIC S9(4) VALUE +200 COMP.  00450000
004600     05  PC-222                       PIC S9(4) VALUE +222 COMP.  00460000
004700     05  PC-225                       PIC S9(4) VALUE +225 COMP.  00470000
004800     05  PC-250                       PIC S9(4) VALUE +250 COMP.  00480000
004900     05  PC-267                       PIC S9(4) VALUE +267 COMP.  00490000
005000     05  PC-502                       PIC S9(4) VALUE +502 COMP.  00500000
005100     05  PC-509                       PIC S9(4) VALUE +509 COMP.  00510000
005200     05  PC-60                        PIC S9(9) VALUE +60  COMP.  00520000
005300     05  PC-1440                      PIC S9(9) VALUE +1440 COMP. 00530000
005400     05  PC-2880                      PIC S9(9) VALUE +2880 COMP. 00540000
005500     05  PC-10080                     PIC S9(9) VALUE +10080 COMP.00550000
005600     05  PC-29-SECS                   PIC X(09) VALUE             00560000
005700         '29.999999'.                                             00570000
005800     05  PC-DEFAULT-TMST              PIC X(26) VALUE             00580000
005900         '9999-09-09-09.09.09.999999'.                            00590000
006000     05  PC-IN-TRBL-MIN-CNT           PIC S9(4) VALUE +59 COMP.   00600000
006100     05  PC-IN-TRBL-HOUR-CNT          PIC S9(4) VALUE +99 COMP.   00610000
006200     05  PC-PRE-RECEIVED              PIC X(18) VALUE             00620000
006300                                          '***PRE-RECEIVED***'.   00630000
006400     05  PC-RTV-MSG-1                 PIC X(28) VALUE             00640000
006500                               'RETURN MERCHANDISE TO VENDOR'.    00650000
006600     05  PC-RTV-MSG-2                 PIC X(21) VALUE             00660000
006700                               'ACCEPT EARLY SHIPMENT'.           00670000
006800     05  PC-RTV-MSG-3                 PIC X(21) VALUE             00680000
006900                               'ACCEPT LATE SHIPMENT '.           00690000
007000                                                                  00700000
007100 01  PS-PROGRAM-SWITCHES.                                         00710000
007200     05 PS-RSN-CURSOR-SW              PIC X(1)  VALUE SPACE.      00720001
007300         88 PS-RSN-CURSOR-COMPLETE              VALUE 'Y'.        00730001
007400         88 PS-RSN-CURSOR-INCOMPLETE            VALUE 'N'.        00740001
007500     05  PS-DO-NOT-USE-OPER-SW        PIC  X    VALUE 'N'.        00750000
007600         88  PS-DO-NOT-USE-OPER                 VALUE 'N'.        00760000
007700         88  PS-DO-USE-OPER                     VALUE 'Y'.        00770000
007800     05  PS-DONE-SW                   PIC  X    VALUE 'N'.        00780000
007900         88  PS-NOT-DONE                        VALUE 'N'.        00790000
008000         88  PS-DONE                            VALUE 'Y'.        00800000
008100     05  PS-RESOLVE-FOUND-SW          PIC  X    VALUE 'N'.        00810000
008200         88  PS-NO-RESOLVE-FOUND                VALUE 'N'.        00820000
008300         88  PS-RESOLVE-FOUND                   VALUE 'Y'.        00830000
008400     05  PS-MORE-TROUBLE-SW           PIC  X    VALUE 'N'.        00840000
008500         88  PS-NO-MORE-TROUBLE                 VALUE 'N'.        00850000
008600         88  PS-MORE-TROUBLE                    VALUE 'Y'.        00860000
008700     05  PS-RECORD-SW                 PIC  X    VALUE 'N'.        00870000
008800         88  PS-NO-MORE-RECORD                  VALUE 'N'.        00880000
008900         88  PS-MORE-RECORD                     VALUE 'Y'.        00890000
009000     05  PS-TWKORIN-CURSOR-SW         PIC X(01) VALUE 'N'.        00900000
009100         88  PS-EOF-TWKORIN-CSR                 VALUE 'Y'.        00910000
009200     05  PS-TWKORIN-ZERO-SW           PIC X(01) VALUE 'N'.        00920000
009300         88  PS-EOF-TWKORIN-ZERO                VALUE 'Y'.        00930000
009400     05  PS-PACK-LVL-UPD-SW           PIC  X    VALUE 'N'.        00940000
009500         88  PS-PACK-LVL-UPD-NOT-DONE           VALUE 'N'.        00950000
009600         88  PS-PACK-LVL-UPD-DONE               VALUE 'Y'.        00960000
009700                                                                  00970000
009800 01  PA-PROGRAM-ACCUMULATORS.                                     00980001
009900     05  PA-TOTAL-RECS-READ             PIC S9(09)   VALUE +0     00990001
010000                                                     COMP-3.      01000001
010100 01  DATE-TIME-VARIABLES.                                         01010000
010200     05  PV-CURRENT-DATE              PIC X(10) VALUE SPACES.     01020000
010210     05  PV-DISP-TM007-SQLCODE        PIC ZZZZZZZZ9-.             01021040
010300     05  PV-IN-TRBL-DATE              PIC X(10) VALUE SPACES.     01030000
010400     05  PV-CURRENT-TIME              PIC X(08) VALUE SPACES.     01040000
010500     05  PV-IN-TRBL-TIME              PIC X(08) VALUE SPACES.     01050000
010600     05  PV-DB2-DAYS                  PIC S9(9) VALUE +0 COMP.    01060000
010700     05  PV-DB2-HOURS                 PIC S9(9) VALUE +0 COMP.    01070000
010800     05  PV-DB2-MINUTES               PIC S9(9) VALUE +0 COMP.    01080000
010900                                                                  01090000
011000 01  PV-CICS-MSG-AREA.                                            01100000
011100     05  FILLER                       PIC X(10) VALUE             01110000
011200             'TMKUP521 -'.                                        01120014
011300     05  FILLER                       PIC X(08) VALUE             01130000
011400         ' FROM = '.                                              01140000
011500     05  PV-MSG-FROM-DATE             PIC X(10) VALUE SPACES.     01150000
011600     05  FILLER                       PIC X(01) VALUE SPACE.      01160000
011700     05  PV-MSG-FROM-TIME             PIC X(10) VALUE SPACES.     01170000
011800     05  FILLER                       PIC X(08) VALUE             01180000
011900         '   TO = '.                                              01190000
012000     05  PV-MSG-TO-DATE               PIC X(10) VALUE SPACES.     01200000
012100     05  FILLER                       PIC X(01) VALUE SPACE.      01210000
012200     05  PV-MSG-TO-TIME               PIC X(10) VALUE SPACES.     01220000
012300                                                                  01230000
012400 01  PV-CSSL-MSG.                                                 01240000
012500     05  PV-MARKER                    PIC X(01) VALUE SPACES.     01250000
012600     05  PV-CSSL-TEXT                 PIC X(079) VALUE SPACES.    01260000
012700                                                                  01270000
012800 01  PV-CSSL-SQLCODE.                                             01280000
012900     05  PV-MARKER2                   PIC X(01).                  01290000
013000     05  FILLER                       PIC X(11) VALUE             01300000
013100         ' SQLCODE = '.                                           01310000
013200     05  PV-DISP-SQLCODE              PIC 999-.                   01320000
013300                                                                  01330000
013400                                                                  01340000
013500 01  PV-DISP-FIELDS.                                              01350000
013600     05  PV-DISP-1                    PIC 9(9) VALUE ZEROES.      01360000
013700     05  PV-DISP-2                    PIC 9(9) VALUE ZEROES.      01370000
013800     05  PV-DISP-3                    PIC 9(9) VALUE ZEROES.      01380000
013900     05  PV-DISP-4                    PIC 9(9) VALUE ZEROES.      01390000
014000     05  PV-DISP-5                    PIC 9(9) VALUE ZEROES.      01400000
014100     05  PV-DISP-6                    PIC 9(9) VALUE ZEROES.      01410000
014200     05  PV-DISP-7                    PIC 9(9) VALUE ZEROES.      01420000
014300     05  PV-DISP-8                    PIC 9(9) VALUE ZEROES.      01430000
014400                                                                  01440000
014500 01  PV-PROGRAM-VARIABLES.                                        01450000
015000     05  PV-RETRY-COUNTER             PIC S9(04) VALUE ZERO       01500003
015100                                                  COMP SYNC.      01510003
015400     05  PV-PO-LNE-NBR                PIC S9(04)  VALUE +0 COMP.  01540003
015500                                                                  01550000
015600     05  PV-PRC-FCLTY-AREA-ID         PIC X(06) VALUE SPACES.     01560000
015700     05  PV-FREEFORM-TEXT.                                        01570000
015800         10  PV-FREEFORM-TEXT-1       PIC X(50) VALUE SPACES.     01580000
015900         10  PV-FREEFORM-TEXT-2       PIC X(50) VALUE SPACES.     01590000
016000         10  PV-FREEFORM-TEXT-3       PIC X(50) VALUE SPACES.     01600000
016100         10  PV-FREEFORM-TEXT-4       PIC X(50) VALUE SPACES.     01610000
016200         10  PV-FREEFORM-TEXT-5       PIC X(50) VALUE SPACES.     01620000
016300     05  PV-TEMP-TEXT                 PIC X(250).                 01630000
016400     05  PV-SAVE-TEXT                 PIC X(250).                 01640000
016500     05  PV-TEMP-UID                  PIC X(10).                  01650000
016600     05  PV-SHOW-QTY                  PIC Z(8)9.                  01660000
016700                                                                  01670000
016800     05  PV-OP.                                                   01680000
016900         10  PV-OP-N                  PIC 999.                    01690000
017000     05  PV-FCLTY.                                                01700000
017100         10  PV-FCLTY-N               PIC 9.                      01710000
017200     05  PV-PO.                                                   01720000
017300         10  PV-PO-N                  PIC 9(8).                   01730000
017400     05  PV-LINE.                                                 01740000
017500         10  PV-LINE-N                PIC 999.                    01750000
017600     05  PV-REC-SEQ-NBR.                                          01760000
017700         10  PV-REC-SEQ-NBR-N         PIC 999.                    01770000
017800     05  PV-TRECEIV-COUNT             PIC S9(09)  VALUE ZERO      01780000
017900                                              COMP-3.             01790000
018000     05  PV-DB2-COUNT                 PIC S9(09)  VALUE ZERO      01800000
018100                                              COMP-3.             01810000
018200     05  PV-NULL-IND                  PIC S9(4) VALUE ZERO        01820000
018300                                                COMP SYNC.        01830000
018400     05  PV-REASON-CHECKER            PIC S9(4) VALUE ZERO        01840000
018500                                                COMP SYNC.        01850000
018600         88  PV-VERIFIED-ADJUSTMENT   VALUES +600 THRU +625.      01860000
018700                                                                  01870000
018800                                                                  01880000
018900 01  PRV-PROGRAM-RETURN-VARIABLES.                                01890000
019000     05  PRV-00                       PIC X(42) VALUE             01900000
019100         '00PROGRAM CALL WAS SUCCESSFUL             '.            01910000
019200     05  PRV-48                       PIC X(42) VALUE             01920000
019300         '48INVALID LEVEL-IND4                      '.            01930000
019400     05  PRV-50                       PIC X(42) VALUE             01940000
019500         '50DUPLICATE TROUBLE NOTIFICATION          '.            01950000
019600     05  PRV-51                       PIC X(42) VALUE             01960000
019700         '51RECORD NOT FOUND - TTRBNTF UPDATE       '.            01970000
019800     05  PRV-5A                       PIC X(42) VALUE             01980000
019900         '5AINVALID TM500-PROCESS-IND               '.            01990015
020000     05  PRV-5C                       PIC X(42) VALUE             02000000
020100         '5CBAD LINK TO RANDOM NUMBER ROUTINE       '.            02010000
020200     05  PRV-5D                       PIC X(42) VALUE             02020000
020300         '5DDB2-ERROR - TTRBNTF SELECT              '.            02030000
020400     05  PRV-5E                       PIC X(42) VALUE             02040000
020500         '5EDB2-ERROR - TPURCHS SELECT              '.            02050000
020600     05  PRV-5F                       PIC X(42) VALUE             02060000
020700         '5FDB2-ERROR - TTRBNTF INSERT              '.            02070000
020800     05  PRV-5G                       PIC X(42) VALUE             02080000
020900         '5GDB2-ERROR - TRECEIV SELECT              '.            02090000
021000     05  PRV-5H                       PIC X(42) VALUE             02100000
021100         '5HDB2-ERROR - TRECEIV UPDATE              '.            02110000
021200     05  PRV-5I                       PIC X(42) VALUE             02120000
021300         '5IDB2-ERROR - TTRBNTF UPDATE              '.            02130000
021400     05  PRV-5J                       PIC X(42) VALUE             02140000
021500         '5JDB2-ERROR - TTRBDTL INSERT              '.            02150000
021600     05  PRV-5K                       PIC X(42) VALUE             02160000
021700         '5KDB2-ERROR - TTRBRSN SELECT              '.            02170000
021800     05  PRV-5L                       PIC X(42) VALUE             02180000
021900         '5LINVALID TM500-LEVEL-IND                 '.            02190015
022000     05  PRV-5M                       PIC X(42) VALUE             02200000
022100         '5MDB2-ERROR - TPURITM SELECT              '.            02210000
022200     05  PRV-5N                       PIC X(42) VALUE             02220000
022300         '5NDB2-ERROR - TRECITM UPDATE              '.            02230000
022400     05  PRV-5O                       PIC X(42) VALUE             02240000
022500         '5OTROUBLE RECORD ALREADY ACKNOWLEDGED     '.            02250000
022600     05  PRV-5P                       PIC X(42) VALUE             02260000
022700         '5PDB2-ERROR - WKORIN CURSOR OPEN          '.            02270000
022800     05  PRV-5Q                       PIC X(42) VALUE             02280000
022900         '5QDB2-ERROR - WKORIN CURSOR FETCH         '.            02290000
023000     05  PRV-5R                       PIC X(42) VALUE             02300000
023100         '5RDB2-ERROR - WKORIN CURSOR CLOSE         '.            02310000
023200     05  PRV-5S                       PIC X(42) VALUE             02320000
023300         '5SDB2-ERROR - WKORIN0 CURSOR OPEN         '.            02330000
023400     05  PRV-5T                       PIC X(42) VALUE             02340000
023500         '5TDB2-ERROR - WKORIN0 CURSOR FETCH        '.            02350000
023600     05  PRV-5U                       PIC X(42) VALUE             02360000
023700         '5UDB2-ERROR - WKORIN0 CURSOR CLOSE        '.            02370000
023800     05  PRV-5V                       PIC X(42) VALUE             02380000
023900         '5VINVALID TM500-LEVEL-IND                 '.            02390015
024000     05  PRV-5W                       PIC X(42) VALUE             02400000
024100         '5WDB2-ERROR - TTRBDTL SELECT              '.            02410000
024200*JPL                                                              02420000
024300     05  PRV-70                       PIC X(42) VALUE             02430000
024400         '70DB2-ERROR - RECITM-LINE-CSR OPEN        '.            02440000
024500     05  PRV-71                       PIC X(42) VALUE             02450000
024600         '71DB2-ERROR - RECITM-LINE-CSR FETCH       '.            02460000
024700     05  PRV-72                       PIC X(42) VALUE             02470000
024800         '72DB2-ERROR - RECITM-LINE-CSR CLOSE       '.            02480000
024900     05  PRV-73                       PIC X(42) VALUE             02490000
025000         '73DB2-ERROR - RECITM-LINE-CSR UPDATE      '.            02500000
025100                                                                  02510000
025200     05  PRV-74                       PIC X(42) VALUE             02520000
025300         '74DB2-ERROR - TRBRCN-READ-CRS OPEN        '.            02530000
025400     05  PRV-75                       PIC X(42) VALUE             02540000
025500         '75DB2-ERROR - TRBRCN-READ-CRS FETCH       '.            02550000
025600     05  PRV-76                       PIC X(42) VALUE             02560000
025700         '76DB2-ERROR - TRBRCN-READ-CRS CLOSE       '.            02570000
025800                                                                  02580000
025900     05  PRV-TM500-RETURN-MSG.                                    02590015
026000         10  PRV-PGM                  PIC X(3).                   02600000
026100         10  FILLER                   PIC X(1).                   02610000
026200         10  PRV-PARA                 PIC X(4).                   02620000
026300         10  FILLER                   PIC X(1).                   02630000
026400         10  PRV-TBL                  PIC X(7).                   02640000
026500         10  FILLER                   PIC X(1).                   02650000
026600         10  PRV-OP                   PIC X(3).                   02660000
026700         10  FILLER                   PIC X(1).                   02670000
026800         10  PRV-FCLTY                PIC X(1).                   02680000
026900         10  FILLER                   PIC X(1).                   02690000
027000         10  PRV-PO                   PIC X(8).                   02700000
027100         10  FILLER                   PIC X(1).                   02710000
027200         10  PRV-LINE                 PIC X(3).                   02720000
027300         10  FILLER                   PIC X(1).                   02730000
027400         10  PRV-REC-SEQ-NBR          PIC X(3).                   02740000
027500         10  FILLER                   PIC X(1).                   02750000
027600                                                                  02760000
027700*                                                                 02770016
027800     COPY TMWS500.                                                02780047
027900                                                                  02790003
027910*                                                                 02791049
027920     COPY TMRD007.                                                02792049
027930                                                                  02793049
028000*  RANDOM NUMBER AREA.                                            02800000
028100     COPY DPWS902.                                                02810000
028200                                                                  02820003
028300*  CORPORATE CALENDAR ROUTINE                                     02830000
028400     COPY DPWS500.                                                02840000
028500                                                                  02850003
028600*  COPY BOOK FOR DB2 FORMATTED MESSAGE AREA                       02860003
028700                                                                  02870003
028800     COPY DPWS004.                                                02880003
028900                                                                  02890003
029000******************************************************************02900000
029100*    DB2 SQL COMMUNICATION AREA                                   02910000
029200******************************************************************02920000
029300     EXEC SQL                                                     02930000
029400          INCLUDE SQLCA                                           02940000
029500     END-EXEC.                                                    02950000
029600                                                                  02960000
029700***************************************************************** 02970009
029800*      -TROUBLE REASON CODES TABLE  - PROGRAM ID LEVEL          * 02980009
029900***************************************************************** 02990009
030000     EXEC SQL                                                     03000000
030100          INCLUDE TTRBRCN                                         03010000
030200     END-EXEC.                                                    03020000
030300                                                                  03030000
030400******************************************************************03040000
030500*    DB2 DCLGEN FOR TROUBLE NOTIFICATION TABLE                    03050000
030600******************************************************************03060000
030700     EXEC SQL                                                     03070000
030800          INCLUDE TTRBNTF                                         03080000
030900     END-EXEC.                                                    03090000
031000                                                                  03100000
031100******************************************************************03110000
031200*    DB2 DCLGEN FOR TROUBLE DETAIL TABLE                          03120000
031300******************************************************************03130000
031400     EXEC SQL                                                     03140000
031500          INCLUDE TTRBDTL                                         03150000
031600     END-EXEC.                                                    03160000
031700                                                                  03170000
031800******************************************************************03180000
031900*    DB2 DCLGEN FOR TROUBLE REASON TABLE                          03190000
032000******************************************************************03200000
032100     EXEC SQL                                                     03210000
032200          INCLUDE TTRBRSN                                         03220000
032300     END-EXEC.                                                    03230000
032400                                                                  03240000
032500******************************************************************03250000
032600*    DB2 DCLGEN FOR RECEIVER TABLE                                03260000
032700******************************************************************03270000
032800     EXEC SQL                                                     03280000
032900          INCLUDE TRECEIV                                         03290000
033000     END-EXEC.                                                    03300000
033100                                                                  03310000
033200******************************************************************03320000
033300*    DB2 DCLGEN FOR RECEIPT ITEM TABLE                            03330000
033400******************************************************************03340000
033500     EXEC SQL                                                     03350000
033600          INCLUDE TRECITM                                         03360000
033700     END-EXEC.                                                    03370000
033800                                                                  03380000
033900******************************************************************03390000
034000*    DB2 DCLGEN FOR PURCHASE ORDER TABLE                          03400000
034100******************************************************************03410000
034200     EXEC SQL                                                     03420000
034300          INCLUDE TPURCHS                                         03430000
034400     END-EXEC.                                                    03440000
034500                                                                  03450000
034600******************************************************************03460000
034700*    DB2 DCLGEN FOR PURCHASE ITEM TABLE                           03470000
034800******************************************************************03480000
034900     EXEC SQL                                                     03490000
035000          INCLUDE TPURITM                                         03500000
035100     END-EXEC.                                                    03510000
035200/                                                                 03520000
035300******************************************************************03530000
035400*    DB2 DCLGEN FOR WORK ORDER IN PROCESS TABLE                   03540000
035500******************************************************************03550000
035600     EXEC SQL                                                     03560000
035700          INCLUDE TWKORIN                                         03570000
035800     END-EXEC.                                                    03580000
035900                                                                  03590000
036000******************************************************************03600000
036100*    DECLARE RECITM CURSOR W/HOLD (FOR FETCH/UPDATE)             *03610000
036200******************************************************************03620000
036300     EXEC SQL                                                     03630000
036400          DECLARE RECITM-LINE-CSR CURSOR WITH HOLD FOR            03640000
036500          SELECT A.ORD_LNE_NBR                                    03650000
036600               , B.VER_NBR                                        03660000
036700            FROM TRECITM A                                        03670000
036800               , TPURITM B                                        03680000
036900           WHERE A.ORD_NBR        = :TM500-PO-NBR                 03690015
037000             AND A.REC_SEQ_NBR    = :TM500-REC-SEQ-NBR            03700015
037100             AND A.OPER_UNT_ID    = :TM500-OPER-UNT-ID            03710015
037200             AND A.FCLTY_ID       = :TM500-FCLTY-ID               03720015
037300             AND A.PREPK_ID       = :TM500-PREPK-ID               03730015
037400             AND A.VER_STATUS_CDE = :PC-A                         03740000
037500             AND A.ORD_NBR        = B.PO_NBR                      03750000
037600             AND A.ORD_LNE_NBR    = B.APP_PO_LNE_NBR              03760000
037700             AND B.VER_STATUS_CDE = :PC-A                         03770000
037800     END-EXEC.                                                    03780000
037900*                                                                 03790000
038000******************************************************************03800000
038100*    DECLARE RECITM CURSOR W/HOLD AND NO OPER (FOR FETCH/UPDATE) *03810000
038200******************************************************************03820000
038300     EXEC SQL                                                     03830000
038400          DECLARE RECITM-LN-NOOP-CSR CURSOR WITH HOLD FOR         03840000
038500          SELECT A.ORD_LNE_NBR                                    03850000
038600               , B.VER_NBR                                        03860000
038700            FROM TRECITM A                                        03870000
038800               , TPURITM B                                        03880000
038900           WHERE A.ORD_NBR        = :TM500-PO-NBR                 03890015
039000             AND A.REC_SEQ_NBR    = :TM500-REC-SEQ-NBR            03900015
039100             AND A.PREPK_ID       = :TM500-PREPK-ID               03910015
039200             AND A.VER_STATUS_CDE = :PC-A                         03920000
039300             AND A.ORD_NBR        = B.PO_NBR                      03930000
039400             AND A.ORD_LNE_NBR    = B.APP_PO_LNE_NBR              03940000
039500             AND B.VER_STATUS_CDE = :PC-A                         03950000
039600     END-EXEC.                                                    03960000
039700*                                                                 03970000
039800******************************************************************03980000
039900*    DECLARE WKORIN CURSOR FOR A GIVEN LINE NUMBER               *03990000
040000******************************************************************04000000
040100     EXEC SQL                                                     04010000
040200          DECLARE TWKORIN-CSR CURSOR FOR                          04020000
040300          SELECT STRT_TMST                                        04030000
040400               , STOP_TMST                                        04040000
040500               , PRC_FCLTY_AREA_ID                                04050000
040600               , SCREEN_SEQ_NBR                                   04060000
040700            FROM TWKORIN                                          04070000
040800           WHERE ORD_NBR          = :TM500-PO-NBR                 04080015
040900             AND RCVR_SEQ_NBR     = :TM500-REC-SEQ-NBR            04090015
041000             AND ORD_LNE_NBR      = :PV-PO-LNE-NBR                04100000
041100             AND WORK_ORD_SEQ_NBR = 1                             04110000
041200             AND OPER_UNT_ID      = :TM500-OPER-UNT-ID            04120015
041300             AND FCLTY_ID         = :TM500-FCLTY-ID               04130015
041400             AND VER_STATUS_CDE   = :PC-A                         04140000
041500           ORDER BY SCREEN_SEQ_NBR                                04150000
041600     END-EXEC.                                                    04160000
041700*                                                                 04170000
041800******************************************************************04180000
041900*    DECLARE WKORIN0 CURSOR FOR LINE 0                           *04190000
042000******************************************************************04200000
042100     EXEC SQL                                                     04210000
042200          DECLARE WKORIN0-CSR CURSOR FOR                          04220000
042300          SELECT STRT_TMST                                        04230000
042400               , STOP_TMST                                        04240000
042500               , PRC_FCLTY_AREA_ID                                04250000
042600               , SCREEN_SEQ_NBR                                   04260000
042700            FROM TWKORIN                                          04270000
042800           WHERE ORD_NBR          = :TM500-PO-NBR                 04280015
042900             AND RCVR_SEQ_NBR     = :TM500-REC-SEQ-NBR            04290015
043000             AND ORD_LNE_NBR      = 0                             04300000
043100             AND WORK_ORD_SEQ_NBR = 1                             04310000
043200             AND OPER_UNT_ID      = :TM500-OPER-UNT-ID            04320015
043300             AND FCLTY_ID         = :TM500-FCLTY-ID               04330015
043400             AND VER_STATUS_CDE   = :PC-A                         04340000
043500           ORDER BY SCREEN_SEQ_NBR                                04350000
043600     END-EXEC.                                                    04360000
043700                                                                  04370000
043800     EXEC SQL                                                     04380018
043900          DECLARE TTRBRCN-READ-CRS CURSOR FOR                     04390018
044000             SELECT TRBL_RSN_CDE                                  04400018
044100             FROM   TTRBRCN                                       04410018
044200             WHERE  RPT_PGM_NM = 'TMKCS521'                       04420018
044300     END-EXEC.                                                    04430018
044400                                                                  04440001
044500 LINKAGE SECTION.                                                 04450015
044501                                                                  04450147
044510 01  TM500-COMMAREA              PIC X(600).                      04451047
044520 01  LINK-TM007-COMMAREA         PIC X(800).                      04452047
044700                                                                  04470012
044800******************************************************************04480012
044900 PROCEDURE DIVISION USING TM500-COMMAREA                          04490048
044910                          LINK-TM007-COMMAREA.                    04491048
045000******************************************************************04500001
045100 0000-MAINLINE.                                                   04510001
045200                                                                  04520028
045210     MOVE PC-CURRENT-PROGRAM-NAME TO TM007-CALLED-MODULE.         04521029
045211                                                                  04521147
045212     MOVE LINK-TM007-COMMAREA TO TM007-COMMUNICATIONS-AREA.       04521247
045213     MOVE TM500-COMMAREA TO TM500-FIELDS.                         04521347
045220                                                                  04522029
045300*    PERFORM 1000-PROCESS-REASON-CODES.                           04530065
045400                                                                  04540001
045410     IF PS-NOT-DONE                                               04541037
045810*****   THIS WAS ADDED TO ACKNOWLEDGE ONLY                        04581052
045900        IF TM007-ACKNL-ONLY                                       04590037
046000           PERFORM 4100-ACKNL-ONLY                                04600037
046010        ELSE                                                      04601052
046011*****      THIS WAS ADDED TO ACKNOWLEDGE AND FAIL                 04601152
046020           IF TM007-ACKNL-AND-FAIL                                04602052
046021              PERFORM 4200-ACKNL-AND-FAIL                         04602152
046022              IF TM007-CALL-SUCCESSFUL                            04602253
046023***** ALSO ADDED WERE EXEC'S OR 2500- & 3000- (FOR AUTO-ACK)      04602361
046024                 IF PS-NOT-DONE AND TM500-REC-SEQ-NBR > 0         04602453
046025                     PERFORM 2500-UPDATE-TRECEIV-TMST             04602553
046026                 END-IF                                           04602653
046028                 IF PS-NOT-DONE AND TM500-REC-SEQ-NBR > 0         04602853
046029                     PERFORM 3000-UPDATE-PO-VER-NBR               04602953
046030                 END-IF                                           04603053
046031              END-IF                                              04603153
046032                                                                  04603253
046033           ELSE                                                   04603353
046034*****         THIS IS THE PROCESSING THAT IS NORMALLY DONE        04603453
046035              PERFORM 2000-PROCESS                                04603553
046040           END-IF                                                 04604052
046100        END-IF                                                    04610037
046510     END-IF.                                                      04651037
046600                                                                  04660001
046700     MOVE TM500-FIELDS TO TM500-COMMAREA.                         04670047
046710     MOVE TM007-COMMUNICATIONS-AREA TO LINK-TM007-COMMAREA.       04671047
046720                                                                  04672047
046800     GOBACK.                                                      04680015
046900                                                                  04690001
047000******************************************************************04700001
047100***  THIS PARA READS THE TTRBRCN TABLE TO DETERMINE THE           04710010
047200***  TRBL-RSN-CDE'S THAT SHOULD NOT USE THE OPER-UNIT WHEN        04720010
047300***  ACCESSING THE TRECEIV AND TRECITM TABLES.  WHEN THE          04730010
047400***  PS-DO-NOT-USE-OPER IS SET, THE SQL EXECUTED AGAINST THESE    04740010
047500***  TABLES WILL NOT USE THE OPER-UNIT IN THE WHERE CLASUE.       04750010
047600******************************************************************04760001
047700 1000-PROCESS-REASON-CODES.                                       04770015
047800                                                                  04780001
047900     SET PS-DO-USE-OPER  TO TRUE.                                 04790000
048000     PERFORM 1500-OPEN-TTRBRCN-CRS.                               04800000
048100     PERFORM 1600-FETCH-TTRBRCN-CRS                               04810000
048200         UNTIL PS-DO-NOT-USE-OPER   OR                            04820000
048300               PS-RSN-CURSOR-COMPLETE OR                          04830000
048400               PS-DONE.                                           04840000
048500     PERFORM 1700-CLOSE-TTRBRCN-CRS.                              04850000
048600                                                                  04860000
048700******************************************************************04870001
048800**                                                              **04880001
048900******************************************************************04890001
049000 1500-OPEN-TTRBRCN-CRS.                                           04900000
049100                                                                  04910009
049200     MOVE '1500-OPEN-TTRBRCN-CRS'  TO TM007-RETURNED-PARA.        04920029
049400                                                                  04940000
049500        EXEC SQL                                                  04950000
049600             OPEN TTRBRCN-READ-CRS                                04960000
049700        END-EXEC.                                                 04970000
049800                                                                  04980000
049900        EVALUATE TRUE                                             04990000
050000                                                                  05000000
050100           WHEN SQLCODE = ZERO                                    05010000
050200                SET PS-RSN-CURSOR-INCOMPLETE TO TRUE              05020000
050300                                                                  05030000
050400           WHEN OTHER                                             05040000
050500                SET  PS-DONE TO TRUE                              05050000
050600                MOVE SQLCA   TO TM500-SQLCA                       05060015
050610                                TM007-SQLCA                       05061029
050700                MOVE SQLCODE TO TM500-SQLCODE                     05070015
050710                                TM007-SQLCODE                     05071029
050800                MOVE PRV-74  TO TM500-RETURN-DATA                 05080015
050900        END-EVALUATE.                                             05090000
051000                                                                  05100000
051100******************************************************************05110001
051200**                                                              **05120001
051300******************************************************************05130001
051400 1600-FETCH-TTRBRCN-CRS.                                          05140000
051500                                                                  05150009
051600     MOVE '1600-FETCH-TTRBRCN-CRS' TO TM007-RETURNED-PARA.        05160029
051800                                                                  05180000
051900        EXEC SQL                                                  05190000
052000          FETCH TTRBRCN-READ-CRS                                  05200000
052100           INTO  :TRBRCN-TRBL-RSN-CDE                             05210000
052200        END-EXEC.                                                 05220000
052300                                                                  05230000
052400       EVALUATE TRUE                                              05240000
052500           WHEN SQLCODE = ZERO                                    05250000
052600               IF TRBRCN-TRBL-RSN-CDE = TM500-TRBL-RSN-CDE        05260015
052700                   SET PS-DO-NOT-USE-OPER   TO TRUE               05270000
052800               END-IF                                             05280000
052900           WHEN SQLCODE = +100                                    05290000
053000               SET PS-RSN-CURSOR-COMPLETE TO TRUE                 05300000
053100                                                                  05310000
053200           WHEN OTHER                                             05320000
053300                SET  PS-DONE TO TRUE                              05330000
053400                MOVE SQLCA   TO TM500-SQLCA                       05340015
053500                MOVE SQLCODE TO TM500-SQLCODE                     05350015
053600                MOVE PRV-75  TO TM500-RETURN-DATA                 05360015
053700        END-EVALUATE.                                             05370000
053800                                                                  05380000
053900******************************************************************05390001
054000**                                                              **05400001
054100******************************************************************05410001
054200 1700-CLOSE-TTRBRCN-CRS.                                          05420000
054300                                                                  05430000
054400        MOVE '1700-CLOSE-TTRBRCN-CRS' TO TM007-RETURNED-PARA.     05440029
054600                                                                  05460009
054700        EXEC SQL                                                  05470000
054800            CLOSE TTRBRCN-READ-CRS                                05480000
054900        END-EXEC.                                                 05490000
055000                                                                  05500000
055100        EVALUATE TRUE                                             05510000
055200           WHEN SQLCODE = ZERO                                    05520000
055300                CONTINUE                                          05530000
055400                                                                  05540000
055500           WHEN OTHER                                             05550000
055600                SET  PS-DONE TO TRUE                              05560000
055700                MOVE SQLCA   TO TM500-SQLCA                       05570015
055800                MOVE SQLCODE TO TM500-SQLCODE                     05580015
055900                MOVE PRV-76  TO TM500-RETURN-DATA                 05590015
056000        END-EVALUATE.                                             05600000
056100                                                                  05610000
056200******************************************************************05620001
056300*                                                                 05630017
056400*                                                                 05640017
056500*                                                                 05650017
056600*                                                                 05660017
056700******************************************************************05670001
056800 2000-PROCESS.                                                    05680015
056900                                                                  05690000
057000     PERFORM 2100-PREPARE-TTRBNTF.                                05700000
057100                                                                  05710000
057200     EVALUATE TRUE                                                05720000
057300         WHEN TM500-CREATE-AUTO                                   05730015
057400         WHEN TM500-CREATE-MANUAL                                 05740015
057500         WHEN TM500-RESOLVE-AUTO AND TM500-CREATE                 05750015
057600             IF TM500-TRBL-RSN-CDE = PC-502 or PC-509             05760015
057700                  PERFORM 2001-COUNT-TROUBLE                      05770000
057800                  IF PV-DB2-COUNT = ZERO                          05780000
057900                     PERFORM 2200-PREPARE-FOR-INSERT              05790000
058000                  ELSE                                            05800000
058100                     SET PS-DONE TO TRUE                          05810000
058200             ELSE                                                 05820000
058300                  PERFORM 2200-PREPARE-FOR-INSERT                 05830000
058400              END-IF                                              05840000
058500                                                                  05850000
058600             IF PS-NOT-DONE AND TRBRSN-NOTIF-IND = PC-N           05860000
058700                 MOVE TRBNTF-TRBL-RSN-CDE                         05870000
058800                                 TO PV-REASON-CHECKER             05880000
058900                 IF PV-VERIFIED-ADJUSTMENT                        05890000
059000                     CONTINUE                                     05900000
059100                 ELSE                                             05910000
059200                     PERFORM 2002-CHECK-NOTIF                     05920000
059300                 END-IF                                           05930000
059400             END-IF                                               05940000
059500                                                                  05950000
059600              IF PS-NOT-DONE                                      05960000
059700                 IF TRBRSN-RESP-RES-IND = SPACES                  05970000
059800                    PERFORM 2300-INSERT-TTRBNTF                   05980000
059900                 ELSE                                             05990000
060000                    PERFORM 2400-INSERT-TTRBNTF                   06000000
060100                 END-IF                                           06010000
060200              END-IF                                              06020000
060300                                                                  06030000
060400              IF PS-NOT-DONE AND TM500-REC-SEQ-NBR > 0            06040015
060500                  PERFORM 2500-UPDATE-TRECEIV-TMST                06050000
060600              END-IF                                              06060000
060700                                                                  06070000
060800              IF PS-NOT-DONE AND TM500-REC-SEQ-NBR > 0            06080015
060900                  PERFORM 3000-UPDATE-PO-VER-NBR                  06090000
061000              END-IF                                              06100000
061100                                                                  06110000
061200         WHEN TM500-IN-PROCESS                                    06120015
061300         WHEN TM500-RESPOND                                       06130015
061400         WHEN TM500-RESOLVE-MANUAL                                06140015
061500         WHEN TM500-RESOLVE-SPECIFIC                              06150015
061600         WHEN TM500-RESOLVE-AUTO AND TM500-UPDATE                 06160015
061700         WHEN TM500-ACKNOWLEDGE                                   06170015
061800              PERFORM 2600-UPDATE-TTRBNTF                         06180000
061900                                                                  06190000
062000              IF PS-NOT-DONE AND TM500-REC-SEQ-NBR > 0            06200015
062100                  PERFORM 2700-DEFAULT-TRECEIV-TMST               06210000
062200              END-IF                                              06220000
062300                                                                  06230000
062400              IF PS-NOT-DONE AND TM500-REC-SEQ-NBR > 0            06240015
062500                  PERFORM 3000-UPDATE-PO-VER-NBR                  06250000
062600              END-IF                                              06260000
062700                                                                  06270000
062800         WHEN TM500-UPDATE-NOTIF                                  06280015
062900              PERFORM 2800-UPDATE-DEPT-NBR                        06290000
063000                                                                  06300000
063100         WHEN OTHER                                               06310000
063200              SET  PS-DONE TO TRUE                                06320000
063300              MOVE SPACES  TO TM500-SQLCA                         06330015
063310                                                                  06331029
063400              MOVE ZEROES  TO TM500-SQLCODE                       06340015
063500              MOVE PRV-5A  TO TM500-RETURN-DATA                   06350015
063600                                                                  06360000
063700     END-EVALUATE.                                                06370000
063800                                                                  06380000
063900     IF PS-NOT-DONE                                               06390000
064000         IF PV-TRECEIV-COUNT > ZERO                               06400000
064100             IF TM500-FREEFORM-TEXT > SPACES                      06410015
064200                 MOVE TM500-FREEFORM-TEXT                         06420015
064300                                  TO PV-SAVE-TEXT                 06430000
064400             END-IF                                               06440000
064500                                                                  06450000
064600             MOVE SPACES              TO TM500-FREEFORM-TEXT      06460015
064700             MOVE PC-PRE-RECEIVED TO TM500-FREEFORM-TEXT          06470015
064800             PERFORM 2900-INSERT-TROUBLE-DETAIL                   06480000
064900             MOVE SPACES              TO TM500-FREEFORM-TEXT      06490015
065000                                                                  06500000
065100             IF PV-SAVE-TEXT > SPACES                             06510000
065200                 MOVE PV-SAVE-TEXT        TO TM500-FREEFORM-TEXT  06520015
065300             END-IF                                               06530000
065400         END-IF                                                   06540000
065500     END-IF.                                                      06550000
065600                                                                  06560000
065700     IF PS-NOT-DONE                                               06570000
065800         IF TM500-ADD-DETAILS                                     06580015
065900             EVALUATE TM500-TRBL-RSN-CDE                          06590015
066000             WHEN PC-222                                          06600000
066100             WHEN PC-225                                          06610000
066200                 IF TM500-FREEFORM-TEXT > SPACES                  06620015
066300                     PERFORM 2900-INSERT-TROUBLE-DETAIL           06630000
066400                 END-IF                                           06640000
066500                 IF TM500-RESOLVED-IND = PC-N                     06650015
066600                     MOVE TM500-UNITS-TO-ALLOC                    06660015
066700                                      TO PV-SHOW-QTY              06670000
066800                     STRING 'UNITS RECEIVED: '                    06680000
066900                             PV-SHOW-QTY                          06690000
067000                             DELIMITED BY SIZE                    06700000
067100                                       INTO TM500-FREEFORM-TEXT   06710015
067200                     PERFORM 2900-INSERT-TROUBLE-DETAIL           06720000
067300                 END-IF                                           06730000
067400                                                                  06740000
067500             WHEN PC-502                                          06750000
067600                 EVALUATE TRUE                                    06760000
067700                 WHEN TM500-RTV-YES                               06770015
067800                     MOVE TM500-FREEFORM-TEXT                     06780015
067900                                      TO PV-SAVE-TEXT             06790000
068000                     MOVE SPACES      TO TM500-FREEFORM-TEXT      06800015
068100                     MOVE PC-RTV-MSG-1 TO TM500-FREEFORM-TEXT     06810015
068200                     PERFORM 2900-INSERT-TROUBLE-DETAIL           06820000
068300                     IF PV-SAVE-TEXT > SPACES                     06830000
068400                         MOVE PV-SAVE-TEXT TO TM500-FREEFORM-TEXT 06840015
068500                         PERFORM 2900-INSERT-TROUBLE-DETAIL       06850000
068600                     END-IF                                       06860000
068700                 WHEN TM500-RTV-NO                                06870015
068800                     MOVE TM500-FREEFORM-TEXT                     06880015
068900                                        TO PV-SAVE-TEXT           06890000
069000                     MOVE SPACES        TO TM500-FREEFORM-TEXT    06900015
069100                     MOVE PC-RTV-MSG-2  TO TM500-FREEFORM-TEXT    06910015
069200                     PERFORM 2900-INSERT-TROUBLE-DETAIL           06920000
069300                     IF PV-SAVE-TEXT > SPACES                     06930000
069400                        MOVE PV-SAVE-TEXT  TO TM500-FREEFORM-TEXT 06940015
069500                        PERFORM 2900-INSERT-TROUBLE-DETAIL        06950000
069600                     END-IF                                       06960000
069700                 WHEN OTHER                                       06970000
069800                     IF TM500-FREEFORM-TEXT > SPACES              06980015
069900                         PERFORM 2900-INSERT-TROUBLE-DETAIL       06990000
070000                     END-IF                                       07000000
070100                 END-EVALUATE                                     07010000
070200             WHEN PC-509                                          07020000
070300                 EVALUATE TRUE                                    07030000
070400                 WHEN TM500-RTV-YES                               07040015
070500                     MOVE TM500-FREEFORM-TEXT                     07050015
070600                                      TO PV-SAVE-TEXT             07060000
070700                     MOVE SPACES      TO TM500-FREEFORM-TEXT      07070015
070800                     MOVE PC-RTV-MSG-1 TO TM500-FREEFORM-TEXT     07080015
070900                     PERFORM 2900-INSERT-TROUBLE-DETAIL           07090000
071000                     IF PV-SAVE-TEXT > SPACES                     07100000
071100                         MOVE PV-SAVE-TEXT TO TM500-FREEFORM-TEXT 07110015
071200                         PERFORM 2900-INSERT-TROUBLE-DETAIL       07120000
071300                     END-IF                                       07130000
071400                 WHEN TM500-RTV-NO                                07140015
071500                     MOVE TM500-FREEFORM-TEXT                     07150015
071600                                        TO PV-SAVE-TEXT           07160000
071700                     MOVE SPACES        TO TM500-FREEFORM-TEXT    07170015
071800                     MOVE PC-RTV-MSG-3  TO TM500-FREEFORM-TEXT    07180015
071900                     PERFORM 2900-INSERT-TROUBLE-DETAIL           07190000
072000                     IF PV-SAVE-TEXT > SPACES                     07200000
072100                         MOVE PV-SAVE-TEXT TO TM500-FREEFORM-TEXT 07210015
072200                         PERFORM 2900-INSERT-TROUBLE-DETAIL       07220000
072300                     END-IF                                       07230000
072400                 WHEN OTHER                                       07240000
072500                     IF TM500-FREEFORM-TEXT > SPACES              07250015
072600                         PERFORM 2900-INSERT-TROUBLE-DETAIL       07260000
072700                     END-IF                                       07270000
072800                 END-EVALUATE                                     07280000
072900             WHEN OTHER                                           07290000
073000                     IF TM500-FREEFORM-TEXT > SPACES              07300015
073100                         PERFORM 2900-INSERT-TROUBLE-DETAIL       07310000
073200                     END-IF                                       07320000
073300             END-EVALUATE                                         07330000
073400                                                                  07340000
073500         END-IF                                                   07350000
073600     END-IF.                                                      07360000
073700                                                                  07370000
073800     IF PS-NOT-DONE                                               07380000
073900         IF TM500-RESOLVE-MANUAL            OR                    07390015
074000             (TM500-RESOLVE-AUTO AND TM500-UPDATE AND             07400015
074100              PS-RESOLVE-FOUND)             OR                    07410000
074200             (TM500-RESOLVE-SPECIFIC AND TM500-UPDATE AND         07420015
074300              PS-RESOLVE-FOUND)             OR                    07430000
074400             (TM500-CREATE-AUTO  AND                              07440015
074500              TRBRSN-RESP-RES-IND = SPACES) OR                    07450000
074600             (TM500-RESOLVE-AUTO AND TM500-CREATE AND             07460015
074700              TRBRSN-RESP-RES-IND = SPACES)                       07470000
074800             MOVE TM500-CRE-UID       TO PV-TEMP-UID              07480015
074900             MOVE SPACES              TO TM500-CRE-UID            07490015
075000             MOVE TM500-RESOLVED-UID  TO TM500-CRE-UID            07500015
075100             MOVE TM500-FREEFORM-TEXT TO PV-TEMP-TEXT             07510015
075200             MOVE SPACES              TO TM500-FREEFORM-TEXT      07520015
075300             MOVE 'RESOLVED'          TO TM500-FREEFORM-TEXT      07530015
075400             PERFORM 2900-INSERT-TROUBLE-DETAIL                   07540000
075500             MOVE SPACES              TO TM500-FREEFORM-TEXT      07550015
075600             MOVE PV-TEMP-TEXT        TO TM500-FREEFORM-TEXT      07560015
075700             MOVE SPACES              TO TM500-CRE-UID            07570015
075800             MOVE PV-TEMP-UID         TO TM500-CRE-UID            07580015
075900         END-IF                                                   07590000
076000     END-IF.                                                      07600000
076100                                                                  07610000
076200******************************************************************07620009
076300**                                                              **07630009
076400******************************************************************07640009
076500 2001-COUNT-TROUBLE.                                              07650000
076600                                                                  07660009
076700     MOVE '2001-COUNT-TROUBLE' TO TM007-RETURNED-PARA.            07670029
076900                                                                  07690009
077000     MOVE ZERO          TO PV-DB2-COUNT                           07700000
077100     PERFORM WITH TEST AFTER                                      07710000
077200         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    07720000
077300         UNTIL   SQLCODE = +0 OR                                  07730000
077400                 PS-DONE OR                                       07740000
077500                 PV-RETRY-COUNTER > PC-MAX-RETRIES                07750000
077600                                                                  07760000
077700         IF TM500-TRBL-RSN-CDE = PC-502                           07770015
077800            EXEC SQL                                              07780000
077900                 SELECT COUNT(*)                                  07790000
078000                   INTO :PV-DB2-COUNT :PV-NULL-IND                07800000
078100                   FROM TTRBNTF                                   07810000
078200              WHERE OPER_UNT_ID  = :TM500-OPER-UNT-ID             07820015
078300                AND FCLTY_ID     = :TM500-FCLTY-ID                07830015
078400                AND PO_NBR       = :TM500-PO-NBR                  07840015
078500                AND PO_LNE_NBR   = :TM500-PO-LNE-NBR              07850015
078600                AND REC_SEQ_NBR  = :TM500-REC-SEQ-NBR             07860015
078700                AND TRBL_RSN_CDE = :PC-502                        07870000
078800                AND RTV_IND = :PC-N                               07880000
078900                AND RESOLVED_IND IN (:PC-R, :PC-A)                07890000
079000            END-EXEC                                              07900000
079100         ELSE                                                     07910000
079200            EXEC SQL                                              07920000
079300                 SELECT COUNT(*)                                  07930000
079400                   INTO :PV-DB2-COUNT :PV-NULL-IND                07940000
079500                   FROM TTRBNTF                                   07950000
079600              WHERE OPER_UNT_ID  = :TM500-OPER-UNT-ID             07960015
079700                AND FCLTY_ID     = :TM500-FCLTY-ID                07970015
079800                AND PO_NBR       = :TM500-PO-NBR                  07980015
079900                AND PO_LNE_NBR   = :TM500-PO-LNE-NBR              07990015
080000                AND REC_SEQ_NBR  = :TM500-REC-SEQ-NBR             08000015
080100                AND TRBL_RSN_CDE = :PC-509                        08010000
080200                AND RTV_IND = :PC-N                               08020000
080300                AND RESOLVED_IND IN (:PC-R, :PC-A)                08030000
080400            END-EXEC                                              08040000
080500         END-IF                                                   08050000
080600                                                                  08060000
080700         EVALUATE TRUE                                            08070000
080800             WHEN SQLCODE = +0                                    08080000
080900             WHEN SQLCODE = +100                                  08090000
081000             WHEN SQLCODE = -904                                  08100000
081100             WHEN SQLCODE = -911                                  08110000
081200             WHEN SQLCODE = -913                                  08120000
081300                  CONTINUE                                        08130000
081400                                                                  08140000
081500             WHEN OTHER                                           08150000
081600                  SET  PS-DONE TO TRUE                            08160000
081700                  MOVE SQLCA   TO TM500-SQLCA                     08170015
081800                  MOVE SQLCODE TO TM500-SQLCODE                   08180015
081900                  MOVE PRV-48  TO TM500-RETURN-DATA               08190015
082000         END-EVALUATE                                             08200000
082100     END-PERFORM.                                                 08210000
082200                                                                  08220000
082300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         08230000
082400         SET PS-DONE  TO TRUE                                     08240000
082500         MOVE SQLCA   TO TM500-SQLCA                              08250015
082600         MOVE SQLCODE TO TM500-SQLCODE                            08260015
082700         MOVE PRV-48  TO TM500-RETURN-DATA                        08270015
082800     END-IF.                                                      08280000
082900                                                                  08290000
083000******************************************************************08300009
083100**                                                              **08310009
083200******************************************************************08320009
083300 2002-CHECK-NOTIF.                                                08330000
083400                                                                  08340009
083500     MOVE '2002-CHECK-NOTIF' TO TM007-RETURNED-PARA.              08350029
083700                                                                  08370000
083800     PERFORM WITH TEST AFTER                                      08380000
083900         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    08390000
084000         UNTIL   SQLCODE = +100 OR                                08400000
084100                 SQLCODE = +0 OR                                  08410000
084200                 SQLCODE = -811 OR                                08420000
084300                 PS-DONE OR                                       08430000
084400                 PV-RETRY-COUNTER > PC-MAX-RETRIES                08440000
084500                                                                  08450000
084600         EXEC SQL                                                 08460000
084700             SELECT NOTIF_NBR                                     08470000
084800                 INTO :TRBNTF-NOTIF-NBR                           08480000
084900                 FROM TTRBNTF                                     08490000
085000                 WHERE OPER_UNT_ID    = :TRBNTF-OPER-UNT-ID       08500000
085100                     AND FCLTY_ID     = :TRBNTF-FCLTY-ID          08510000
085200                     AND PO_NBR       = :TRBNTF-PO-NBR            08520000
085300                     AND PO_LNE_NBR   = :TRBNTF-PO-LNE-NBR        08530000
085400                     AND PREPK_ID     = :TRBNTF-PREPK-ID          08540000
085500                     AND REC_SEQ_NBR  = :TRBNTF-REC-SEQ-NBR       08550000
085600                     AND TRBL_RSN_CDE = :TRBNTF-TRBL-RSN-CDE      08560000
085700         END-EXEC                                                 08570000
085800                                                                  08580001
085900         EVALUATE SQLCODE                                         08590000
086000             WHEN ZERO                                            08600000
086100             WHEN -811                                            08610000
086200                 SET PS-DONE TO TRUE                              08620000
086300             WHEN +100                                            08630000
086400             WHEN -904                                            08640000
086500             WHEN -911                                            08650000
086600             WHEN -913                                            08660000
086700                 CONTINUE                                         08670000
086800             WHEN OTHER                                           08680000
086900              SET PS-DONE               TO TRUE                   08690056
086910              MOVE '21'                 TO TM500-RETURN-CODE      08691056
086920              MOVE SQLCODE              TO TM007-SQLCODE          08692056
086930                                           PV-DISP-TM007-SQLCODE  08693056
086940              MOVE SQLCA                TO TM007-SQLCA            08694056
087000              DISPLAY '**************************************'    08700056
087100              DISPLAY '**    UNSUCCESSFUL SELECT           **'    08710056
087200              DISPLAY '**************************************'    08720056
087300              DISPLAY '** ABEND                            **'    08730056
087400              DISPLAY '** PROGRAM = TMKUP521               **'    08740056
087500              DISPLAY '** PARAGRAPH = 2002-CHECK-NOTIF     **'    08750056
087600              DISPLAY '** DB2 OPER  = SELECT TTRBNTF       **'    08760056
087700              DISPLAY '** OPER_UNT_ID    = ' TRBNTF-OPER-UNT-ID   08770056
087800              DISPLAY '** FCLTY_ID       = ' TRBNTF-FCLTY-ID      08780056
087900              DISPLAY '** PO_NBR         = ' TRBNTF-PO-NBR        08790056
088000              DISPLAY '** PO_LNE_NBR     = ' TRBNTF-PO-LNE-NBR    08800056
088100              DISPLAY '** PREPK_ID       = ' TRBNTF-PREPK-ID      08810056
088200              DISPLAY '** REC_SEQ_NBR    = ' TRBNTF-REC-SEQ-NBR   08820056
088300              DISPLAY '** TRBL_RSN_CDE   = ' TRBNTF-TRBL-RSN-CDE  08830056
088310              DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE08831056
088320              DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA          08832056
088330              DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE    08833056
088400              DISPLAY '**************************************'    08840056
088600         END-EVALUATE                                             08860000
088700     END-PERFORM.                                                 08870000
088800                                                                  08880000
088900     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         08890000
089000         SET  PS-DONE              TO TRUE                        08900056
089010         MOVE '22'                 TO TM500-RETURN-CODE           08901056
089020         MOVE SQLCODE              TO TM007-SQLCODE               08902056
089030                                      PV-DISP-TM007-SQLCODE       08903056
089040         MOVE SQLCA                TO TM007-SQLCA                 08904056
089100         DISPLAY '**************************************'         08910008
089200         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         08920008
089300         DISPLAY '**************************************'         08930008
089400         DISPLAY '** ABEND                            **'         08940008
089500         DISPLAY '** PROGRAM = TMKUP521               **'         08950014
089600         DISPLAY '** PARAGRAPH = 2002-CHECK-NOTIF     **'         08960008
089700         DISPLAY '** DB2 OPER  = SELECT TTRBNTF       **'         08970008
089800         DISPLAY '** OPER_UNT_ID    = ' TRBNTF-OPER-UNT-ID        08980008
089900         DISPLAY '** FCLTY_ID       = ' TRBNTF-FCLTY-ID           08990008
090000         DISPLAY '** PO_NBR         = ' TRBNTF-PO-NBR             09000008
090100         DISPLAY '** PO_LNE_NBR     = ' TRBNTF-PO-LNE-NBR         09010008
090200         DISPLAY '** PREPK_ID       = ' TRBNTF-PREPK-ID           09020008
090300         DISPLAY '** REC_SEQ_NBR    = ' TRBNTF-REC-SEQ-NBR        09030008
090400         DISPLAY '** TRBL_RSN_CDE   = ' TRBNTF-TRBL-RSN-CDE       09040008
090410         DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE     09041056
090420         DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA               09042056
090430         DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE         09043056
090500         DISPLAY '**************************************'         09050008
090700     END-IF.                                                      09070000
090800                                                                  09080000
090900******************************************************************09090001
091000*    THIS PARAGRAPH PREPARES THE TTRBNTF FIELDS BEFORE INSERTING  09100001
091100*    THE RECORD.  IT CALLS PARAGRAPH 2110 2120 AND 2130 AS WELL   09110001
091200*    AS MOVE MOST OF THE COMM AREA DATA INTO TTRBNTF FIELDS.      09120001
091300******************************************************************09130001
091400 2100-PREPARE-TTRBNTF.                                            09140000
091500                                                                  09150000
091600     INITIALIZE DCLTTRBNTF.                                       09160000
091700                                                                  09170000
091800     MOVE TM500-NOTIF-NBR        TO TRBNTF-NOTIF-NBR.             09180015
091900     MOVE TM500-OPER-UNT-ID      TO TRBNTF-OPER-UNT-ID.           09190015
092000     MOVE TM500-FCLTY-ID         TO TRBNTF-FCLTY-ID.              09200015
092100     MOVE TM500-PO-NBR           TO TRBNTF-PO-NBR.                09210015
092200     MOVE TM500-PO-LNE-NBR       TO TRBNTF-PO-LNE-NBR.            09220015
092300     MOVE TM500-REC-SEQ-NBR      TO TRBNTF-REC-SEQ-NBR.           09230015
092400     MOVE TM500-TRBL-RSN-CDE     TO TRBNTF-TRBL-RSN-CDE.          09240015
092500     MOVE TM500-PREPK-ID         TO TRBNTF-PREPK-ID.              09250015
092600     MOVE PC-DEFAULT-TMST        TO TRBNTF-NOTIF-TMST.            09260000
092700     MOVE TM500-NOTIF-UID        TO TRBNTF-NOTIF-UID.             09270015
092800     MOVE PC-DEFAULT-TMST        TO TRBNTF-RESOLVED-TMST.         09280000
092900     MOVE PC-DEFAULT-TMST        TO TRBNTF-ACKNOWLG-TMST.         09290000
093000*    MOVE TM500-SHIPT-ID         TO TRBNTF-SHIPT-ID.              09300015
093100*    MOVE TM500-PKSL-SEQ-NBR     TO TRBNTF-PKSL-SEQ-NBR.          09310015
093200*    MOVE TM500-PKSL-LNE-NBR     TO TRBNTF-PKSL-LNE-NBR.          09320015
093300*    MOVE TM500-WORK-ORD-SEQ-NBR TO TRBNTF-WORK-ORD-SEQ-NBR.      09330015
093400*    MOVE TM500-WO-INSTR-SEQ-NBR TO TRBNTF-WO-INSTR-SEQ-NBR.      09340015
093500     MOVE TM500-OVER-SHORT-PCT   TO TRBNTF-OVER-SHT-PCT.          09350015
093600     MOVE TM500-DEPT-NBR         TO TRBNTF-DEPT-NBR.              09360015
093700     MOVE TM500-RTV-SW           TO TRBNTF-RTV-IND.               09370015
093800     MOVE TM500-PRORATE-IND      TO TRBNTF-PRORATE-IND.           09380015
093900                                                                  09390000
094000******************************************************************09400009
094100**                                                              **09410009
094200******************************************************************09420009
094300 2200-PREPARE-FOR-INSERT.                                         09430000
094400                                                                  09440000
094500     MOVE PC-N TO TRBNTF-RESOLVED-IND.                            09450000
094600                                                                  09460000
094700     PERFORM 2210-CHECK-FOR-DUP.                                  09470000
094800                                                                  09480000
094900     IF PS-NOT-DONE                                               09490000
095000         PERFORM 2220-GET-PO-DATA                                 09500000
095100         MOVE PURCHS-DEPT-NBR TO TRBNTF-DEPT-NBR                  09510000
095200         MOVE PURCHS-ENT-ID   TO TRBNTF-ENT-ID                    09520000
095300     END-IF.                                                      09530000
095400                                                                  09540000
095500     IF PS-NOT-DONE                                               09550000
095600         PERFORM 6000-GET-FCLTY-AREA-ID                           09560000
095700         MOVE WKORIN-PRC-FCLTY-AREA-ID TO TRBNTF-FCLTY-AREA-ID    09570000
095800     END-IF.                                                      09580000
095900                                                                  09590000
096000     IF PS-NOT-DONE                                               09600000
096100         PERFORM 2240-SELECT-RESP-RES-IND                         09610000
096200     END-IF.                                                      09620000
096300                                                                  09630000
096400     IF PS-NOT-DONE                                               09640000
096500         IF PS-DO-NOT-USE-OPER                                    09650000
096600             PERFORM 2250-SELECT-COUNT-TRCV-NO-OPER               09660000
096700         ELSE                                                     09670000
096800             PERFORM 2245-SELECT-COUNT-TRECEIV                    09680000
096900         END-IF                                                   09690000
097000     END-IF.                                                      09700000
097100     IF PS-NOT-DONE AND PV-TRECEIV-COUNT > ZERO                   09710000
097200         MOVE PC-P                    TO TRBNTF-CRE-IND           09720000
097300     END-IF.                                                      09730000
097400                                                                  09740000
097500     IF PS-NOT-DONE                                               09750000
097600         PERFORM 8000-GET-RANDOM-NBR                              09760020
097700         MOVE DP902-RANDOM-NUMBER       TO TM500-NOTIF-NBR        09770015
097800                                           TRBNTF-NOTIF-NBR       09780000
097900     END-IF.                                                      09790000
098000                                                                  09800009
098100******************************************************************09810009
098200**                                                              **09820009
098300******************************************************************09830009
098400 2210-CHECK-FOR-DUP.                                              09840000
098500                                                                  09850000
098600     MOVE '2210-CHECK-FOR-DUP'        TO TM007-RETURNED-PARA      09860029
098800                                                                  09880000
098900     PERFORM WITH TEST AFTER                                      09890000
099000         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    09900000
099100         UNTIL   SQLCODE = +100 OR                                09910000
099200                 SQLCODE = +0 OR                                  09920000
099300                 SQLCODE = -811 OR                                09930000
099400                 PS-DONE OR                                       09940000
099500                 PV-RETRY-COUNTER > PC-MAX-RETRIES                09950000
099600                                                                  09960000
099700         EXEC SQL                                                 09970000
099800              SELECT NOTIF_NBR                                    09980000
099900                INTO :TRBNTF-NOTIF-NBR                            09990000
100000                FROM TTRBNTF                                      10000000
100100               WHERE OPER_UNT_ID  = :TRBNTF-OPER-UNT-ID           10010000
100200                 AND FCLTY_ID     = :TRBNTF-FCLTY-ID              10020000
100300                 AND PO_NBR       = :TRBNTF-PO-NBR                10030000
100400                 AND PO_LNE_NBR   = :TRBNTF-PO-LNE-NBR            10040000
100500                 AND PREPK_ID     = :TRBNTF-PREPK-ID              10050000
100600                 AND REC_SEQ_NBR  = :TRBNTF-REC-SEQ-NBR           10060000
100700                 AND TRBL_RSN_CDE = :TRBNTF-TRBL-RSN-CDE          10070000
100800                 AND RESOLVED_IND IN (:PC-N, :PC-I)               10080000
100900         END-EXEC                                                 10090000
101000                                                                  10100000
101100         EVALUATE TRUE                                            10110000
101200             WHEN SQLCODE = +0                                    10120000
101300             WHEN SQLCODE = -811                                  10130000
101400                  SET  PS-DONE TO TRUE                            10140000
101500                  MOVE SQLCA   TO TM500-SQLCA                     10150015
101600                  MOVE SQLCODE TO TM500-SQLCODE                   10160015
101700                  MOVE PRV-50  TO TM500-RETURN-DATA               10170015
101800                                                                  10180000
101900             WHEN SQLCODE = +100                                  10190000
102000                  CONTINUE                                        10200000
102100                                                                  10210000
102200             WHEN SQLCODE = -904                                  10220000
102300             WHEN SQLCODE = -911                                  10230000
102400             WHEN SQLCODE = -913                                  10240000
102500                  CONTINUE                                        10250000
102600                                                                  10260000
102700             WHEN OTHER                                           10270000
102800              SET PS-DONE               TO TRUE                   10280056
102810              MOVE '23'                 TO TM500-RETURN-CODE      10281056
102820              MOVE SQLCODE              TO TM007-SQLCODE          10282056
102830                                           PV-DISP-TM007-SQLCODE  10283056
102840              MOVE SQLCA                TO TM007-SQLCA            10284056
102900              DISPLAY '**************************************'    10290056
103000              DISPLAY '**    UNSUCCESSFUL SELECT           **'    10300056
103100              DISPLAY '**************************************'    10310056
103200              DISPLAY '** ABEND                            **'    10320056
103300              DISPLAY '** PROGRAM = TMKUP521               **'    10330056
103400              DISPLAY '** PARAGRAPH = 2210-CHECK-FOR-DUP   **'    10340056
103500              DISPLAY '** DB2 OPER  = SELECT TTRBNTF       **'    10350056
103600              DISPLAY '** OPER_UNT_ID    = ' TRBNTF-OPER-UNT-ID   10360056
103700              DISPLAY '** FCLTY_ID       = ' TRBNTF-FCLTY-ID      10370056
103800              DISPLAY '** PO_NBR         = ' TRBNTF-PO-NBR        10380056
103900              DISPLAY '** PO_LNE_NBR     = ' TRBNTF-PO-LNE-NBR    10390056
104000              DISPLAY '** PREPK_ID       = ' TRBNTF-PREPK-ID      10400056
104100              DISPLAY '** REC_SEQ_NBR    = ' TRBNTF-REC-SEQ-NBR   10410056
104200              DISPLAY '** TRBL_RSN_CDE   = ' TRBNTF-TRBL-RSN-CDE  10420056
104210              DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE10421056
104220              DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA          10422056
104230              DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE    10423056
104300              DISPLAY '**************************************'    10430056
104500         END-EVALUATE                                             10450000
104600     END-PERFORM.                                                 10460000
104700                                                                  10470000
104800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         10480000
104900         SET  PS-DONE              TO TRUE                        10490058
104910         MOVE '24'                 TO TM500-RETURN-CODE           10491058
104920         MOVE SQLCODE              TO TM007-SQLCODE               10492058
104930                                      PV-DISP-TM007-SQLCODE       10493058
104940         MOVE SQLCA                TO TM007-SQLCA                 10494058
105000         DISPLAY '**************************************'         10500007
105100         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         10510007
105200         DISPLAY '**************************************'         10520007
105300         DISPLAY '** ABEND                            **'         10530007
105400         DISPLAY '** PROGRAM = TMKUP521               **'         10540014
105500         DISPLAY '** PARAGRAPH = 2210-CHECK-FOR-DUP   **'         10550007
105600         DISPLAY '** DB2 OPER  = SELECT TTRBNTF       **'         10560007
105700         DISPLAY '** OPER_UNT_ID    = ' TRBNTF-OPER-UNT-ID        10570007
105800         DISPLAY '** FCLTY_ID       = ' TRBNTF-FCLTY-ID           10580007
105900         DISPLAY '** PO_NBR         = ' TRBNTF-PO-NBR             10590007
106000         DISPLAY '** PO_LNE_NBR     = ' TRBNTF-PO-LNE-NBR         10600007
106100         DISPLAY '** PREPK_ID       = ' TRBNTF-PREPK-ID           10610007
106200         DISPLAY '** REC_SEQ_NBR    = ' TRBNTF-REC-SEQ-NBR        10620007
106300         DISPLAY '** TRBL_RSN_CDE   = ' TRBNTF-TRBL-RSN-CDE       10630007
106310         DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE     10631058
106320         DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA               10632058
106330         DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE         10633058
106400         DISPLAY '**************************************'         10640007
106600     END-IF.                                                      10660000
106700                                                                  10670000
106800******************************************************************10680000
106900*    THIS PARAGRAPH RETRIEVES DEPT-NBR AND ENT-ID FROM            10690000
107000*    TPURCHS TABLE.                                               10700000
107100******************************************************************10710000
107200 2220-GET-PO-DATA.                                                10720009
107300                                                                  10730000
107400     MOVE '2220-GET-PO-DATA'          TO TM007-RETURNED-PARA      10740029
107600                                                                  10760000
107700     PERFORM WITH TEST AFTER                                      10770000
107800         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    10780000
107900         UNTIL   SQLCODE = +0 OR                                  10790000
108000                 SQLCODE = +100 OR                                10800000
108100                 PS-DONE OR                                       10810000
108200                 PV-RETRY-COUNTER > PC-MAX-RETRIES                10820000
108300                                                                  10830000
108400         EXEC SQL                                                 10840000
108500              SELECT DEPT_NBR                                     10850000
108600                   , ENT_ID                                       10860000
108700                INTO :PURCHS-DEPT-NBR                             10870000
108800                   , :PURCHS-ENT-ID                               10880000
108900                FROM TPURCHS                                      10890000
109000               WHERE PO_NBR         = :TRBNTF-PO-NBR              10900000
109100                 AND VER_STATUS_CDE = :PC-ACTIVE                  10910000
109200         END-EXEC                                                 10920000
109300                                                                  10930000
109400         EVALUATE TRUE                                            10940000
109500             WHEN SQLCODE = +0                                    10950000
109600                  CONTINUE                                        10960000
109700                                                                  10970000
109800             WHEN SQLCODE = +100                                  10980000
109900                  MOVE '000'  TO PURCHS-DEPT-NBR                  10990000
110000                  MOVE ZEROES TO PURCHS-ENT-ID                    11000000
110100                                                                  11010000
110200             WHEN SQLCODE = -904                                  11020000
110300             WHEN SQLCODE = -911                                  11030000
110400             WHEN SQLCODE = -913                                  11040000
110500                  CONTINUE                                        11050000
110600                                                                  11060000
110700             WHEN OTHER                                           11070000
110800              SET  PS-DONE              TO TRUE                   11080058
110810              MOVE '25'                 TO TM500-RETURN-CODE      11081058
110820              MOVE SQLCODE              TO TM007-SQLCODE          11082058
110830                                           PV-DISP-TM007-SQLCODE  11083058
110840              MOVE SQLCA                TO TM007-SQLCA            11084058
110900              DISPLAY '**************************************'    11090058
111000              DISPLAY '**    UNSUCCESSFUL SELECT           **'    11100058
111100              DISPLAY '**************************************'    11110058
111200              DISPLAY '** ABEND                            **'    11120058
111300              DISPLAY '** PROGRAM = TMKUP521               **'    11130058
111400              DISPLAY '** PARAGRAPH = 2220-GET-PO-DATA     **'    11140058
111500              DISPLAY '** DB2 OPER  = SELECT TTRBNTF       **'    11150058
111600              DISPLAY '** PO_NBR         = ' TRBNTF-PO-NBR        11160058
111700              DISPLAY '** VER_STATUS_CDE = ' PC-ACTIVE            11170058
111710              DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE11171058
111720              DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA          11172058
111730              DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE    11173058
111800              DISPLAY '**************************************'    11180058
112000         END-EVALUATE                                             11200000
112100     END-PERFORM.                                                 11210000
112200                                                                  11220000
112300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         11230000
112400         SET PS-DONE               TO TRUE                        11240058
112410         MOVE '26'                 TO TM500-RETURN-CODE           11241058
112420         MOVE SQLCODE              TO TM007-SQLCODE               11242058
112430                                      PV-DISP-TM007-SQLCODE       11243058
112440         MOVE SQLCA                TO TM007-SQLCA                 11244058
112500         DISPLAY '**************************************'         11250007
112600         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         11260007
112700         DISPLAY '**************************************'         11270007
112800         DISPLAY '** ABEND                            **'         11280007
112900         DISPLAY '** PROGRAM = TMKUP521               **'         11290014
113000         DISPLAY '** PARAGRAPH = 2220-GET-PO-DATA     **'         11300007
113100         DISPLAY '** DB2 OPER  = SELECT TTRBNTF       **'         11310007
113200         DISPLAY '** PO_NBR         = ' TRBNTF-PO-NBR             11320007
113300         DISPLAY '** VER_STATUS_CDE = ' PC-ACTIVE                 11330007
113310         DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE     11331058
113320         DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA               11332058
113330         DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE         11333058
113400         DISPLAY '**************************************'         11340007
113600     END-IF.                                                      11360000
113700                                                                  11370000
113800******************************************************************11380000
113900**                                                              **11390009
114000******************************************************************11400009
114100 2240-SELECT-RESP-RES-IND.                                        11410009
114200                                                                  11420000
114300     MOVE '2240-SELECT-RESP-RES-IND'  TO TM007-RETURNED-PARA      11430029
114500                                                                  11450000
114600     PERFORM WITH TEST AFTER                                      11460000
114700         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    11470000
114800         UNTIL   SQLCODE = +0 OR                                  11480000
114900                 PS-DONE OR                                       11490000
115000                 PV-RETRY-COUNTER > PC-MAX-RETRIES                11500000
115100                                                                  11510000
115200         EXEC SQL                                                 11520000
115300              SELECT RESP_RES_IND                                 11530000
115400                  ,  NOTIF_IND                                    11540000
115500                  ,  RSLV_RSPNT_CDE                               11550000
115600                INTO :TRBRSN-RESP-RES-IND                         11560000
115700                  ,  :TRBRSN-NOTIF-IND                            11570000
115800                  ,  :TRBRSN-RSLV-RSPNT-CDE                       11580000
115900                FROM TTRBRSN                                      11590000
116000               WHERE TRBL_RSN_CDE = :TM500-TRBL-RSN-CDE           11600015
116100         END-EXEC                                                 11610000
116200                                                                  11620000
116300         EVALUATE TRUE                                            11630000
116400             WHEN SQLCODE = +0                                    11640000
116500                  CONTINUE                                        11650000
116600                                                                  11660000
116700             WHEN SQLCODE = -904                                  11670000
116800             WHEN SQLCODE = -911                                  11680000
116900             WHEN SQLCODE = -913                                  11690000
117000                  CONTINUE                                        11700000
117100                                                                  11710000
117200             WHEN OTHER                                           11720000
117300              SET  PS-DONE              TO TRUE                   11730059
117310              MOVE '27'                 TO TM500-RETURN-CODE      11731059
117320              MOVE SQLCODE              TO TM007-SQLCODE          11732059
117330                                           PV-DISP-TM007-SQLCODE  11733059
117340              MOVE SQLCA                TO TM007-SQLCA            11734059
117400              DISPLAY '**************************************'    11740059
117500              DISPLAY '**    UNSUCCESSFUL SELECT           **'    11750059
117600              DISPLAY '**************************************'    11760059
117700              DISPLAY '** ABEND                            **'    11770059
117800              DISPLAY '** PROGRAM = TMKUP521               **'    11780059
117900              DISPLAY '** PARAGRAPH = 2240-SELECT-RESP-RES-IND'   11790059
118000              DISPLAY '** DB2 OPER  = SELECT TTRBRSN       **'    11800059
118100              DISPLAY '** TRBL_RSN_CDE   = ' TM500-TRBL-RSN-CDE   11810059
118110              DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE11811059
118120              DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA          11812059
118130              DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE    11813059
118200              DISPLAY '**************************************'    11820059
118400         END-EVALUATE                                             11840000
118500     END-PERFORM.                                                 11850000
118600                                                                  11860000
118700     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         11870000
118800         SET PS-DONE              TO TRUE                         11880059
118810         MOVE '28'                TO TM500-RETURN-CODE            11881059
118820         MOVE SQLCODE             TO TM007-SQLCODE                11882059
118830                                     PV-DISP-TM007-SQLCODE        11883059
118840         MOVE SQLCA               TO TM007-SQLCA                  11884059
118900         DISPLAY '**************************************'         11890007
119000         DISPLAY '**   MAX DB2 RETRIES EXCEEDED       **'         11900007
119100         DISPLAY '**************************************'         11910007
119200         DISPLAY '** ABEND                            **'         11920007
119300         DISPLAY '** PROGRAM = TMKUP521               **'         11930014
119400         DISPLAY '** PARAGRAPH = 2240-SELECT-RESP-RES-IND'        11940007
119500         DISPLAY '** DB2 OPER  = SELECT TTRBRSN       **'         11950007
119600         DISPLAY '** TRBL_RSN_CDE   = ' TM500-TRBL-RSN-CDE        11960015
119610         DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE     11961059
119620         DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA               11962059
119630         DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE         11963059
119700         DISPLAY '**************************************'         11970007
119900     END-IF.                                                      11990000
120000                                                                  12000000
120100******************************************************************12010000
120200**                                                              **12020007
120300******************************************************************12030007
120400 2245-SELECT-COUNT-TRECEIV.                                       12040007
120500                                                                  12050000
120600     MOVE '2245-SELECT-COUNT-TRECEIV' TO TM007-RETURNED-PARA      12060029
120800                                                                  12080000
120900     MOVE ZERO          TO PV-TRECEIV-COUNT                       12090000
121000     PERFORM WITH TEST AFTER                                      12100000
121100         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    12110000
121200         UNTIL   SQLCODE = +0 OR                                  12120000
121300                 PS-DONE OR                                       12130000
121400                 PV-RETRY-COUNTER > PC-MAX-RETRIES                12140000
121500                                                                  12150000
121600         EXEC SQL                                                 12160000
121700              SELECT COUNT(*)                                     12170000
121800                INTO :PV-TRECEIV-COUNT :PV-NULL-IND               12180000
121900                FROM TRECEIV                                      12190000
122000               WHERE OPER_UNT_ID    = :TM500-OPER-UNT-ID          12200015
122100                 AND FCLTY_ID       = :TM500-FCLTY-ID             12210015
122200                 AND ORD_NBR        = :TM500-PO-NBR               12220015
122300                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          12230015
122400                 AND VER_STATUS_CDE = :PC-ACTIVE                  12240000
122500                 AND SYST_CRE_CDE   = :PC-P                       12250000
122600         END-EXEC                                                 12260000
122700                                                                  12270000
122800         EVALUATE TRUE                                            12280000
122900             WHEN SQLCODE = +0                                    12290000
123000             WHEN SQLCODE = +100                                  12300000
123100             WHEN SQLCODE = -904                                  12310000
123200             WHEN SQLCODE = -911                                  12320000
123300             WHEN SQLCODE = -913                                  12330000
123400                  CONTINUE                                        12340000
123500                                                                  12350000
123600             WHEN OTHER                                           12360000
123700              SET  PS-DONE             TO TRUE                    12370059
123710              MOVE '29'                TO TM500-RETURN-CODE       12371059
123720              MOVE SQLCODE             TO TM007-SQLCODE           12372059
123730                                          PV-DISP-TM007-SQLCODE   12373059
123740              MOVE SQLCA               TO TM007-SQLCA             12374059
123800              DISPLAY '**************************************'    12380059
123900              DISPLAY '**    UNSUCCESSFUL SELECT           **'    12390059
124000              DISPLAY '**************************************'    12400059
124100              DISPLAY '** ABEND                            **'    12410059
124200              DISPLAY '** PROGRAM = TMKUP521               **'    12420059
124300              DISPLAY '** PARAGRAPH = 2245-SELECT-COUNT-TRECEIV'  12430059
124400              DISPLAY '** DB2 OPER  = SELECT TRECEIV       **'    12440059
124500              DISPLAY '** OPER_UNT_ID    = ' TM500-OPER-UNT-ID    12450059
124600              DISPLAY '** FCLTY_ID       = ' TM500-FCLTY-ID       12460059
124700              DISPLAY '** ORD_NBR        = ' TM500-PO-NBR         12470059
124800              DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR    12480059
124900              DISPLAY '** VER_STATUS_CDE = ' PC-ACTIVE            12490059
125000              DISPLAY '** SYST_CRE_CDE   = ' PC-P                 12500059
125010              DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE12501059
125020              DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA          12502059
125030              DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE    12503059
125100              DISPLAY '**************************************'    12510059
125300         END-EVALUATE                                             12530000
125400     END-PERFORM.                                                 12540000
125500                                                                  12550000
125600     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         12560000
125700         SET PS-DONE              TO TRUE                         12570059
125710         MOVE '30'                TO TM500-RETURN-CODE            12571059
125720         MOVE SQLCODE             TO TM007-SQLCODE                12572059
125730                                     PV-DISP-TM007-SQLCODE        12573059
125740         MOVE SQLCA               TO TM007-SQLCA                  12574059
125800         DISPLAY '**************************************'         12580007
125900         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         12590007
126000         DISPLAY '**************************************'         12600007
126100         DISPLAY '** ABEND                            **'         12610007
126200         DISPLAY '** PROGRAM = TMKUP521               **'         12620014
126300         DISPLAY '** PARAGRAPH = 2245-SELECT-COUNT-TRECEIV'       12630007
126400         DISPLAY '** DB2 OPER  = SELECT TRECEIV       **'         12640007
126500         DISPLAY '** OPER_UNT_ID    = ' TM500-OPER-UNT-ID         12650015
126600         DISPLAY '** FCLTY_ID       = ' TM500-FCLTY-ID            12660015
126700         DISPLAY '** ORD_NBR        = ' TM500-PO-NBR              12670015
126800         DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR         12680015
126900         DISPLAY '** VER_STATUS_CDE = ' PC-ACTIVE                 12690007
127000         DISPLAY '** SYST_CRE_CDE   = ' PC-P                      12700007
127010         DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE     12701059
127020         DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA               12702059
127030         DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE         12703059
127100         DISPLAY '**************************************'         12710007
127300     END-IF.                                                      12730000
127400                                                                  12740000
127500******************************************************************12750000
127600**                                                              **12760007
127700******************************************************************12770007
127800 2250-SELECT-COUNT-TRCV-NO-OPER.                                  12780007
127900                                                                  12790000
128000     MOVE '2250-SELECT-COUNT-TRCV-NO-OPER' TO TM007-RETURNED-PARA 12800029
128200                                                                  12820000
128300     MOVE ZERO          TO PV-TRECEIV-COUNT                       12830000
128400     PERFORM WITH TEST AFTER                                      12840000
128500         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    12850000
128600         UNTIL   SQLCODE = +0 OR                                  12860000
128700                 PS-DONE OR                                       12870000
128800                 PV-RETRY-COUNTER > PC-MAX-RETRIES                12880000
128900                                                                  12890000
129000         EXEC SQL                                                 12900000
129100              SELECT COUNT(*)                                     12910000
129200                INTO :PV-TRECEIV-COUNT :PV-NULL-IND               12920000
129300                FROM TRECEIV                                      12930000
129400               WHERE ORD_NBR        = :TM500-PO-NBR               12940015
129500                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          12950015
129600                 AND VER_STATUS_CDE = :PC-ACTIVE                  12960000
129700                 AND SYST_CRE_CDE   = :PC-P                       12970000
129800         END-EXEC                                                 12980000
129900                                                                  12990000
130000         EVALUATE TRUE                                            13000000
130100             WHEN SQLCODE = +0                                    13010000
130200             WHEN SQLCODE = +100                                  13020000
130300             WHEN SQLCODE = -904                                  13030000
130400             WHEN SQLCODE = -911                                  13040000
130500             WHEN SQLCODE = -913                                  13050000
130600                  CONTINUE                                        13060000
130700                                                                  13070000
130800             WHEN OTHER                                           13080000
130900              SET  PS-DONE             TO TRUE                    13090059
130910              MOVE '31'                TO TM500-RETURN-CODE       13091059
130920              MOVE SQLCODE             TO TM007-SQLCODE           13092059
130930                                          PV-DISP-TM007-SQLCODE   13093059
130940              MOVE SQLCA               TO TM007-SQLCA             13094059
131000              DISPLAY '**************************************'    13100059
131100              DISPLAY '**    UNSUCCESSFUL SELECT           **'    13110059
131200              DISPLAY '**************************************'    13120059
131300              DISPLAY '** ABEND                            **'    13130059
131400              DISPLAY '** PROGRAM = TMKUP521               **'    13140059
131500              DISPLAY '** PARA = 2250-SELECT-COUNT-TRCV-NO-OPER'  13150059
131600              DISPLAY '** DB2 OPER  = SELECT TRECEIV       **'    13160059
131700              DISPLAY '** ORD_NBR        = ' TM500-PO-NBR         13170059
131800              DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR    13180059
131900              DISPLAY '** VER_STATUS_CDE = ' PC-ACTIVE            13190059
132000              DISPLAY '** SYST_CRE_CDE   = ' PC-P                 13200059
132010              DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE13201059
132020              DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA          13202059
132030              DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE    13203059
132100              DISPLAY '**************************************'    13210059
132300         END-EVALUATE                                             13230000
132400     END-PERFORM.                                                 13240000
132500                                                                  13250000
132600     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         13260000
132700         SET PS-DONE  TO TRUE                                     13270000
132710         MOVE '32'                TO TM500-RETURN-CODE            13271059
132720         MOVE SQLCODE             TO TM007-SQLCODE                13272059
132730                                     PV-DISP-TM007-SQLCODE        13273059
132740         MOVE SQLCA               TO TM007-SQLCA                  13274059
132800         DISPLAY '**************************************'         13280007
132900         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         13290007
133000         DISPLAY '**************************************'         13300007
133100         DISPLAY '** ABEND                            **'         13310007
133200         DISPLAY '** PROGRAM = TMKUP521               **'         13320014
133300         DISPLAY '** PARA = 2250-SELECT-COUNT-TRCV-NO-OPER'       13330007
133400         DISPLAY '** DB2 OPER  = SELECT TRECEIV       **'         13340007
133500         DISPLAY '** ORD_NBR        = ' TM500-PO-NBR              13350015
133600         DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR         13360015
133700         DISPLAY '** VER_STATUS_CDE = ' PC-ACTIVE                 13370007
133800         DISPLAY '** SYST_CRE_CDE   = ' PC-P                      13380007
133810         DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE     13381059
133820         DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA               13382059
133830         DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE         13383059
133900         DISPLAY '**************************************'         13390007
134100     END-IF.                                                      13410000
134200                                                                  13420009
134300******************************************************************13430000
134400*    THIS PARAGRAPH INSERTS A PRE-RESOLVED TTRBNTF RECORD.        13440000
134500*                                                                 13450000
134600*    IF A DUPLICATE KEY IS ENCOUNTERED, A NEW RANDOM NUMBER       13460000
134700*    WILL BE CALCULATED AND THE INSERT WILL BE RETRIED.           13470000
134800*    ON THE CHANCE THAT LIGHTNING STRIKES MORE THAN 3 TIMES       13480000
134900*    IN THE SAME SPOT (WE CAN'T FIND A UNIQUE 9 DIGIT KEY),       13490000
135000*    AN ERROR WILL BE PASSED BACK THROUGH THE COMMAREA TO THE     13500000
135100*    CALLING PROGRAM.                                             13510000
135200******************************************************************13520000
135300 2300-INSERT-TTRBNTF.                                             13530007
135400                                                                  13540000
135500     MOVE '2300-INSERT-TTRBNTF'       TO TM007-RETURNED-PARA      13550029
135700                                                                  13570000
135800     PERFORM WITH TEST AFTER                                      13580000
135900         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     13590000
136000         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES OR               13600000
136100         SQLCODE = ZERO OR PS-DONE                                13610000
136200         EXEC SQL                                                 13620000
136300              INSERT INTO TTRBNTF                                 13630000
136400                     (NOTIF_NBR                                   13640000
136500                   ,  OPER_UNT_ID                                 13650000
136600                   ,  FCLTY_ID                                    13660000
136700                   ,  DEPT_NBR                                    13670000
136800                   ,  ENT_ID                                      13680000
136900                   ,  PO_NBR                                      13690000
137000                   ,  PO_LNE_NBR                                  13700000
137100                   ,  REC_SEQ_NBR                                 13710000
137200                   ,  TRBL_RSN_CDE                                13720000
137300                   ,  NOTIF_TMST                                  13730000
137400                   ,  NOTIF_UID                                   13740000
137500                   ,  RESOLVED_IND                                13750000
137600                   ,  RESOLVED_TMST                               13760000
137700                   ,  RESOLVED_UID                                13770000
137800                   ,  ACKNOWLG_TMST                               13780000
137900                   ,  ACKNOWLG_UID                                13790000
138000                   ,  CNTCT_EXT                                   13800000
138100                   ,  FCLTY_AREA_ID                               13810000
138200                   ,  SHIPT_ID                                    13820000
138300                   ,  PKSL_SEQ_NBR                                13830000
138400                   ,  PKSL_LNE_NBR                                13840000
138500                   ,  WORK_ORD_SEQ_NBR                            13850000
138600                   ,  WO_INSTR_SEQ_NBR                            13860000
138700                   ,  OVER_SHT_PCT                                13870000
138800                   ,  LAST_DTL_CRE_TMST                           13880000
138900                   ,  CRE_IND                                     13890000
139000                   ,  PRORATE_IND                                 13900000
139100                   ,  RTV_IND                                     13910000
139200                   ,  RTV_RESPONSE_TMST                           13920000
139300                   ,  PREPK_ID)                                   13930000
139400              VALUES (:TRBNTF-NOTIF-NBR                           13940000
139500                   ,  :TRBNTF-OPER-UNT-ID                         13950000
139600                   ,  :TRBNTF-FCLTY-ID                            13960000
139700                   ,  :TRBNTF-DEPT-NBR                            13970000
139800                   ,  :TRBNTF-ENT-ID                              13980000
139900                   ,  :TRBNTF-PO-NBR                              13990000
140000                   ,  :TRBNTF-PO-LNE-NBR                          14000000
140100                   ,  :TRBNTF-REC-SEQ-NBR                         14010000
140200                   ,  :TRBNTF-TRBL-RSN-CDE                        14020000
140300                   ,  CURRENT TIMESTAMP                           14030000
140400                   ,  :TRBNTF-NOTIF-UID                           14040000
140500                   ,  :PC-R                                       14050000
140600                   ,  CURRENT TIMESTAMP                           14060000
140700                   ,  :TRBNTF-NOTIF-UID                           14070000
140800                   ,  :TRBNTF-ACKNOWLG-TMST                       14080000
140900                   ,  :TRBNTF-ACKNOWLG-UID                        14090000
141000                   ,  :TRBNTF-CNTCT-EXT                           14100000
141100                   ,  :TRBNTF-FCLTY-AREA-ID                       14110000
141200                   ,  :TRBNTF-SHIPT-ID                            14120000
141300                   ,  :TRBNTF-PKSL-SEQ-NBR                        14130000
141400                   ,  :TRBNTF-PKSL-LNE-NBR                        14140000
141500                   ,  :TRBNTF-WORK-ORD-SEQ-NBR                    14150000
141600                   ,  :TRBNTF-WO-INSTR-SEQ-NBR                    14160000
141700                   ,  :TRBNTF-OVER-SHT-PCT                        14170000
141800                   ,  :PC-DEFAULT-TMST                            14180000
141900                   ,  :TRBNTF-CRE-IND                             14190000
142000                   ,  :TRBNTF-PRORATE-IND                         14200000
142100                   ,  :TRBNTF-RTV-IND                             14210000
142200                   ,  :PC-DEFAULT-TMST                            14220000
142300                   ,  :TRBNTF-PREPK-ID)                           14230000
142400         END-EXEC                                                 14240000
142500                                                                  14250000
142600     EVALUATE TRUE                                                14260000
142700         WHEN SQLCODE = ZERO                                      14270000
142800             MOVE PC-R TO TM500-RESOLVED-IND                      14280015
142900         WHEN SQLCODE = -803                                      14290000
143000             PERFORM 8000-GET-RANDOM-NBR                          14300020
143100             MOVE DP902-RANDOM-NUMBER   TO TM500-NOTIF-NBR        14310015
143200                                           TRBNTF-NOTIF-NBR       14320000
143300         WHEN SQLCODE = -904                                      14330000
143400         WHEN SQLCODE = -911                                      14340000
143500         WHEN SQLCODE = -913                                      14350000
143600                  CONTINUE                                        14360000
143700         WHEN OTHER                                               14370000
143800              SET  PS-DONE             TO TRUE                    14380059
143810              MOVE '33'                TO TM500-RETURN-CODE       14381059
143820              MOVE SQLCODE             TO TM007-SQLCODE           14382059
143830                                          PV-DISP-TM007-SQLCODE   14383059
143840              MOVE SQLCA               TO TM007-SQLCA             14384059
143900              DISPLAY '**************************************'    14390059
144000              DISPLAY '**    UNSUCCESSFUL INSERT           **'    14400059
144100              DISPLAY '**************************************'    14410059
144200              DISPLAY '** ABEND                            **'    14420059
144300              DISPLAY '** PROGRAM = TMKUP521               **'    14430059
144400              DISPLAY '** PARAGRAPH = 2300-INSERT-TTRBNTF'        14440059
144500              DISPLAY '** DB2 OPER  = INSERT TTRBNTF       **'    14450059
144600              DISPLAY '** NOTIF_NBR      = ' TRBNTF-NOTIF-NBR     14460059
144700              DISPLAY '** OPER_UNT_ID    = ' TRBNTF-OPER-UNT-ID   14470059
144800              DISPLAY '** FCLTY_ID       = ' TRBNTF-FCLTY-ID      14480059
144900              DISPLAY '** DEPT_NBR       = ' TRBNTF-DEPT-NBR      14490059
145000              DISPLAY '** ENT_ID         = ' TRBNTF-ENT-ID        14500059
145100              DISPLAY '** PO_NBR         = ' TRBNTF-PO-NBR        14510059
145200              DISPLAY '** PO_LNE_NBR     = ' TRBNTF-PO-LNE-NBR    14520059
145300              DISPLAY '** REC_SEQ_NBR    = ' TRBNTF-REC-SEQ-NBR   14530059
145400              DISPLAY '** TRBL_RSN_CDE   = ' TRBNTF-TRBL-RSN-CDE  14540059
145410              DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE14541059
145420              DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA          14542059
145430              DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE    14543059
145500              DISPLAY '**************************************'    14550059
145700     END-EVALUATE                                                 14570000
145800     END-PERFORM.                                                 14580000
145900                                                                  14590000
146000     IF PV-RETRY-COUNTER > PC-MAX-RETRIES AND                     14600000
146100               SQLCODE NOT = ZERO                                 14610000
146200         SET  PS-DONE             TO TRUE                         14620059
146210         MOVE '34'                TO TM500-RETURN-CODE            14621059
146220         MOVE SQLCODE             TO TM007-SQLCODE                14622059
146230                                     PV-DISP-TM007-SQLCODE        14623059
146240         MOVE SQLCA               TO TM007-SQLCA                  14624059
146300         DISPLAY '**************************************'         14630007
146400         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         14640007
146500         DISPLAY '**************************************'         14650007
146600         DISPLAY '** ABEND                            **'         14660007
146700         DISPLAY '** PROGRAM = TMKUP521               **'         14670014
146800         DISPLAY '** PARAGRAPH = 2300-INSERT-TTRBNTF'             14680007
146900         DISPLAY '** DB2 OPER  = INSERT TTRBNTF       **'         14690007
147000         DISPLAY '** NOTIF_NBR      = ' TRBNTF-NOTIF-NBR          14700007
147100         DISPLAY '** OPER_UNT_ID    = ' TRBNTF-OPER-UNT-ID        14710007
147200         DISPLAY '** FCLTY_ID       = ' TRBNTF-FCLTY-ID           14720007
147300         DISPLAY '** DEPT_NBR       = ' TRBNTF-DEPT-NBR           14730007
147400         DISPLAY '** ENT_ID         = ' TRBNTF-ENT-ID             14740007
147500         DISPLAY '** PO_NBR         = ' TRBNTF-PO-NBR             14750007
147600         DISPLAY '** PO_LNE_NBR     = ' TRBNTF-PO-LNE-NBR         14760007
147700         DISPLAY '** REC_SEQ_NBR    = ' TRBNTF-REC-SEQ-NBR        14770007
147800         DISPLAY '** TRBL_RSN_CDE   = ' TRBNTF-TRBL-RSN-CDE       14780007
147810         DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE     14781059
147820         DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA               14782059
147830         DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE         14783059
147900         DISPLAY '**************************************'         14790007
148100     END-IF.                                                      14810000
148200                                                                  14820000
148300******************************************************************14830000
148400*    THIS PARAGRAPH INSERTS A TTRBNTF RECORD.                     14840000
148500*                                                                 14850000
148600*    IF A DUPLICATE KEY IS ENCOUNTERED, A NEW RANDOM NUMBER       14860000
148700*    WILL BE CALCULATED AND THE INSERT WILL BE RETRIED.           14870000
148800*    ON THE CHANCE THAT LIGHTNING STRIKES MORE THAN 3 TIMES       14880000
148900*    IN THE SAME SPOT (WE CAN'T FIND A UNIQUE 9 DIGIT KEY),       14890000
149000*    AN ERROR WILL BE PASSED BACK THROUGH THE COMMAREA TO THE     14900000
149100*    CALLING PROGRAM.                                             14910000
149200******************************************************************14920000
149300 2400-INSERT-TTRBNTF.                                             14930007
149400                                                                  14940000
149500     MOVE '2400-INSERT-TTRBNTF'       TO TM007-RETURNED-PARA      14950029
149700                                                                  14970000
149800     PERFORM WITH TEST AFTER                                      14980000
149900         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     14990000
150000         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES OR               15000000
150100         SQLCODE = ZERO OR PS-DONE                                15010000
150200                                                                  15020000
150300     EXEC SQL                                                     15030000
150400          INSERT INTO TTRBNTF                                     15040000
150500                 (NOTIF_NBR                                       15050000
150600               ,  OPER_UNT_ID                                     15060000
150700               ,  FCLTY_ID                                        15070000
150800               ,  DEPT_NBR                                        15080000
150900               ,  ENT_ID                                          15090000
151000               ,  PO_NBR                                          15100000
151100               ,  PO_LNE_NBR                                      15110000
151200               ,  REC_SEQ_NBR                                     15120000
151300               ,  TRBL_RSN_CDE                                    15130000
151400               ,  NOTIF_TMST                                      15140000
151500               ,  NOTIF_UID                                       15150000
151600               ,  RESOLVED_IND                                    15160000
151700               ,  RESOLVED_TMST                                   15170000
151800               ,  RESOLVED_UID                                    15180000
151900               ,  ACKNOWLG_TMST                                   15190000
152000               ,  ACKNOWLG_UID                                    15200000
152100               ,  CNTCT_EXT                                       15210000
152200               ,  FCLTY_AREA_ID                                   15220000
152300               ,  SHIPT_ID                                        15230000
152400               ,  PKSL_SEQ_NBR                                    15240000
152500               ,  PKSL_LNE_NBR                                    15250000
152600               ,  WORK_ORD_SEQ_NBR                                15260000
152700               ,  WO_INSTR_SEQ_NBR                                15270000
152800               ,  OVER_SHT_PCT                                    15280000
152900               ,  LAST_DTL_CRE_TMST                               15290000
153000               ,  CRE_IND                                         15300000
153100               ,  PRORATE_IND                                     15310000
153200               ,  RTV_IND                                         15320000
153300               ,  RTV_RESPONSE_TMST                               15330000
153400               ,  PREPK_ID)                                       15340000
153500          VALUES (:TRBNTF-NOTIF-NBR                               15350000
153600               ,  :TRBNTF-OPER-UNT-ID                             15360000
153700               ,  :TRBNTF-FCLTY-ID                                15370000
153800               ,  :TRBNTF-DEPT-NBR                                15380000
153900               ,  :TRBNTF-ENT-ID                                  15390000
154000               ,  :TRBNTF-PO-NBR                                  15400000
154100               ,  :TRBNTF-PO-LNE-NBR                              15410000
154200               ,  :TRBNTF-REC-SEQ-NBR                             15420000
154300               ,  :TRBNTF-TRBL-RSN-CDE                            15430000
154400               ,  CURRENT TIMESTAMP                               15440000
154500               ,  :TRBNTF-NOTIF-UID                               15450000
154600               ,  :TRBNTF-RESOLVED-IND                            15460000
154700               ,  :TRBNTF-RESOLVED-TMST                           15470000
154800               ,  :TRBNTF-RESOLVED-UID                            15480000
154900               ,  :TRBNTF-ACKNOWLG-TMST                           15490000
155000               ,  :TRBNTF-ACKNOWLG-UID                            15500000
155100               ,  :TRBNTF-CNTCT-EXT                               15510000
155200               ,  :TRBNTF-FCLTY-AREA-ID                           15520000
155300               ,  :TRBNTF-SHIPT-ID                                15530000
155400               ,  :TRBNTF-PKSL-SEQ-NBR                            15540000
155500               ,  :TRBNTF-PKSL-LNE-NBR                            15550000
155600               ,  :TRBNTF-WORK-ORD-SEQ-NBR                        15560000
155700               ,  :TRBNTF-WO-INSTR-SEQ-NBR                        15570000
155800               ,  :TRBNTF-OVER-SHT-PCT                            15580000
155900               ,  :PC-DEFAULT-TMST                                15590000
156000               ,  :TRBNTF-CRE-IND                                 15600000
156100               ,  :TRBNTF-PRORATE-IND                             15610000
156200               ,  :TRBNTF-RTV-IND                                 15620000
156300               ,  :PC-DEFAULT-TMST                                15630000
156400               ,  :TRBNTF-PREPK-ID)                               15640000
156500         END-EXEC                                                 15650000
156600                                                                  15660000
156700     EVALUATE TRUE                                                15670000
156800         WHEN SQLCODE = ZERO                                      15680000
156900              MOVE TRBNTF-RESOLVED-IND TO TM500-RESOLVED-IND      15690015
157000         WHEN SQLCODE = -803                                      15700000
157100             PERFORM 8000-GET-RANDOM-NBR                          15710020
157200             MOVE DP902-RANDOM-NUMBER   TO TM500-NOTIF-NBR        15720015
157300                                           TRBNTF-NOTIF-NBR       15730000
157400                                                                  15740000
157500         WHEN SQLCODE = -904                                      15750000
157600         WHEN SQLCODE = -911                                      15760000
157700         WHEN SQLCODE = -913                                      15770000
157800             CONTINUE                                             15780000
157900                                                                  15790000
158000         WHEN OTHER                                               15800000
158100              SET  PS-DONE             TO TRUE                    15810059
158110              MOVE '35'                TO TM500-RETURN-CODE       15811059
158120              MOVE SQLCODE             TO TM007-SQLCODE           15812059
158130                                          PV-DISP-TM007-SQLCODE   15813059
158140              MOVE SQLCA               TO TM007-SQLCA             15814059
158200              DISPLAY '**************************************'    15820059
158300              DISPLAY '**    UNSUCCESSFUL INSERT           **'    15830059
158400              DISPLAY '**************************************'    15840059
158500              DISPLAY '** ABEND                            **'    15850059
158600              DISPLAY '** PROGRAM = TMKUP521               **'    15860059
158700              DISPLAY '** PARAGRAPH = 2400-INSERT-TTRBNTF'        15870059
158800              DISPLAY '** DB2 OPER  = INSERT TTRBNTF       **'    15880059
158900              DISPLAY '** NOTIF_NBR      = ' TRBNTF-NOTIF-NBR     15890059
159000              DISPLAY '** OPER_UNT_ID    = ' TRBNTF-OPER-UNT-ID   15900059
159100              DISPLAY '** FCLTY_ID       = ' TRBNTF-FCLTY-ID      15910059
159200              DISPLAY '** DEPT_NBR       = ' TRBNTF-DEPT-NBR      15920059
159300              DISPLAY '** ENT_ID         = ' TRBNTF-ENT-ID        15930059
159400              DISPLAY '** PO_NBR         = ' TRBNTF-PO-NBR        15940059
159500              DISPLAY '** PO_LNE_NBR     = ' TRBNTF-PO-LNE-NBR    15950059
159600              DISPLAY '** REC_SEQ_NBR    = ' TRBNTF-REC-SEQ-NBR   15960059
159700              DISPLAY '** TRBL_RSN_CDE   = ' TRBNTF-TRBL-RSN-CDE  15970059
159710              DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE15971059
159720              DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA          15972059
159730              DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE    15973059
159800              DISPLAY '**************************************'    15980059
160000     END-EVALUATE                                                 16000000
160100     END-PERFORM.                                                 16010000
160200                                                                  16020000
160300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES AND                     16030000
160400               SQLCODE NOT = ZERO                                 16040000
160500         SET  PS-DONE             TO TRUE                         16050059
160510         MOVE '36'                TO TM500-RETURN-CODE            16051059
160520         MOVE SQLCODE             TO TM007-SQLCODE                16052059
160530                                     PV-DISP-TM007-SQLCODE        16053059
160540         MOVE SQLCA               TO TM007-SQLCA                  16054059
160600         DISPLAY '**************************************'         16060008
160700         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         16070008
160800         DISPLAY '**************************************'         16080008
160900         DISPLAY '** ABEND                            **'         16090008
161000         DISPLAY '** PROGRAM = TMKUP521               **'         16100014
161100         DISPLAY '** PARAGRAPH = 2400-INSERT-TTRBNTF'             16110008
161200         DISPLAY '** DB2 OPER  = INSERT TTRBNTF       **'         16120008
161300         DISPLAY '** NOTIF_NBR      = ' TRBNTF-NOTIF-NBR          16130008
161400         DISPLAY '** OPER_UNT_ID    = ' TRBNTF-OPER-UNT-ID        16140008
161500         DISPLAY '** FCLTY_ID       = ' TRBNTF-FCLTY-ID           16150008
161600         DISPLAY '** DEPT_NBR       = ' TRBNTF-DEPT-NBR           16160008
161700         DISPLAY '** ENT_ID         = ' TRBNTF-ENT-ID             16170008
161800         DISPLAY '** PO_NBR         = ' TRBNTF-PO-NBR             16180008
161900         DISPLAY '** PO_LNE_NBR     = ' TRBNTF-PO-LNE-NBR         16190008
162000         DISPLAY '** REC_SEQ_NBR    = ' TRBNTF-REC-SEQ-NBR        16200008
162100         DISPLAY '** TRBL_RSN_CDE   = ' TRBNTF-TRBL-RSN-CDE       16210008
162110         DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE     16211059
162120         DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA               16212059
162130         DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE         16213059
162200         DISPLAY '**************************************'         16220008
162400     END-IF.                                                      16240000
162500                                                                  16250000
162600                                                                  16260000
162700******************************************************************16270000
162800*    THIS PARAGRAPH UPDATES TRECEIV TIMESTAMP.                    16280000
162900******************************************************************16290000
163000 2500-UPDATE-TRECEIV-TMST.                                        16300009
163100                                                                  16310000
163200     PERFORM 4000-SELECT-NOTIF-IND.                               16320000
163300                                                                  16330000
163400     IF PS-NOT-DONE AND TRBRSN-NOTIF-IND = PC-T                   16340000
163500         IF PS-DO-NOT-USE-OPER                                    16350000
163600             PERFORM 2515-SELECT-IN-TRBL-TMST-NO-OP               16360000
163700         ELSE                                                     16370000
163800             PERFORM 2510-SELECT-IN-TRBL-TMST                     16380000
163900         END-IF                                                   16390000
164000                                                                  16400000
164100         IF PS-NOT-DONE AND RECEIV-IN-TRBL-TMST = PC-DEFAULT-TMST 16410000
164200             IF PS-DO-NOT-USE-OPER                                16420000
164300                 PERFORM 2525-UPDATE-IN-TRBL-TMST-NO-OP           16430000
164400             ELSE                                                 16440000
164500                 PERFORM 2520-UPDATE-IN-TRBL-TMST                 16450000
164600             END-IF                                               16460000
164700         END-IF                                                   16470000
164800     END-IF.                                                      16480000
164900                                                                  16490000
165010******************************************************************16501053
165100**                                                              **16510009
165200******************************************************************16520009
165300 2510-SELECT-IN-TRBL-TMST.                                        16530009
165400                                                                  16540000
165500     MOVE '2510-SELECT-IN-TRBL-TMST'  TO TM007-RETURNED-PARA      16550029
165700                                                                  16570000
165800     PERFORM WITH TEST AFTER                                      16580000
165900         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    16590000
166000         UNTIL   SQLCODE = +0 OR                                  16600000
166100                 PS-DONE OR                                       16610000
166200                 PV-RETRY-COUNTER > PC-MAX-RETRIES                16620000
166300                                                                  16630000
166400         EXEC SQL                                                 16640000
166500              SELECT IN_TRBL_TMST                                 16650000
166600                INTO :RECEIV-IN-TRBL-TMST                         16660000
166700                FROM TRECEIV                                      16670000
166800               WHERE OPER_UNT_ID    = :TM500-OPER-UNT-ID          16680015
166900                 AND FCLTY_ID       = :TM500-FCLTY-ID             16690015
167000                 AND ORD_NBR        = :TM500-PO-NBR               16700015
167100                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          16710015
167200                 AND VER_STATUS_CDE = :PC-ACTIVE                  16720000
167300         END-EXEC                                                 16730000
167400                                                                  16740000
167500         EVALUATE TRUE                                            16750000
167600             WHEN SQLCODE = +0                                    16760000
167700                  CONTINUE                                        16770000
167800                                                                  16780000
167900             WHEN SQLCODE = -904                                  16790000
168000             WHEN SQLCODE = -911                                  16800000
168100             WHEN SQLCODE = -913                                  16810000
168200                  CONTINUE                                        16820000
168300                                                                  16830000
168400             WHEN OTHER                                           16840000
168500              SET  PS-DONE             TO TRUE                    16850059
168510              MOVE '37'                TO TM500-RETURN-CODE       16851059
168520              MOVE SQLCODE             TO TM007-SQLCODE           16852059
168530                                          PV-DISP-TM007-SQLCODE   16853059
168540              MOVE SQLCA               TO TM007-SQLCA             16854059
168600              DISPLAY '**************************************'    16860059
168700              DISPLAY '**    UNSUCCESSFUL SELECT           **'    16870059
168800              DISPLAY '**************************************'    16880059
168900              DISPLAY '** ABEND                            **'    16890059
169000              DISPLAY '** PROGRAM = TMKUP521               **'    16900059
169100              DISPLAY '** PARAGRAPH = 2510-SELECT-IN-TRBL-TMST'   16910059
169200              DISPLAY '** DB2 OPER  = SELECT TRECEIV       **'    16920059
169300              DISPLAY '** OPER_UNT_ID    = ' TM500-OPER-UNT-ID    16930059
169400              DISPLAY '** FCLTY_ID       = ' TM500-FCLTY-ID       16940059
169500              DISPLAY '** ORD_NBR        = ' TM500-PO-NBR         16950059
169600              DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR    16960059
169700              DISPLAY '** VER_STATUS_CDE = ' PC-ACTIVE            16970059
169710              DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE16971059
169720              DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA          16972059
169730              DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE    16973059
169800              DISPLAY '**************************************'    16980059
170000         END-EVALUATE                                             17000000
170100     END-PERFORM.                                                 17010000
170200                                                                  17020000
170300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         17030000
170400         SET PS-DONE              TO TRUE                         17040059
170410         MOVE '38'                TO TM500-RETURN-CODE            17041059
170420         MOVE SQLCODE             TO TM007-SQLCODE                17042059
170430                                     PV-DISP-TM007-SQLCODE        17043059
170440         MOVE SQLCA               TO TM007-SQLCA                  17044059
170500         DISPLAY '**************************************'         17050008
170600         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         17060008
170700         DISPLAY '**************************************'         17070008
170800         DISPLAY '** ABEND                            **'         17080008
170900         DISPLAY '** PROGRAM = TMKUP521               **'         17090014
171000         DISPLAY '** PARAGRAPH = 2510-SELECT-IN-TRBL-TMST'        17100008
171100         DISPLAY '** DB2 OPER  = SELECT TRECEIV       **'         17110008
171200         DISPLAY '** OPER_UNT_ID    = ' TM500-OPER-UNT-ID         17120015
171300         DISPLAY '** FCLTY_ID       = ' TM500-FCLTY-ID            17130015
171400         DISPLAY '** ORD_NBR        = ' TM500-PO-NBR              17140015
171500         DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR         17150015
171600         DISPLAY '** VER_STATUS_CDE = ' PC-ACTIVE                 17160008
171610         DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE     17161059
171620         DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA               17162059
171630         DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE         17163059
171700         DISPLAY '**************************************'         17170008
171900     END-IF.                                                      17190000
172000                                                                  17200000
172100******************************************************************17210000
172200**                                                              **17220009
172300******************************************************************17230009
172400 2515-SELECT-IN-TRBL-TMST-NO-OP.                                  17240009
172500                                                                  17250000
172600     MOVE '2515-SELECT-IN-TRBL-TMST-NO-OP'                        17260004
172700                                  TO TM007-RETURNED-PARA.         17270029
172900                                                                  17290000
173000     PERFORM WITH TEST AFTER                                      17300000
173100         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    17310000
173200         UNTIL   SQLCODE = +0 OR                                  17320000
173300                 PS-DONE OR                                       17330000
173400                 PV-RETRY-COUNTER > PC-MAX-RETRIES                17340000
173500                                                                  17350000
173600         EXEC SQL                                                 17360000
173700              SELECT IN_TRBL_TMST                                 17370000
173800                INTO :RECEIV-IN-TRBL-TMST                         17380000
173900                FROM TRECEIV                                      17390000
174000               WHERE ORD_NBR        = :TM500-PO-NBR               17400015
174100                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          17410015
174200                 AND VER_STATUS_CDE = :PC-ACTIVE                  17420000
174300         END-EXEC                                                 17430000
174400                                                                  17440000
174500         EVALUATE TRUE                                            17450000
174600             WHEN SQLCODE = +0                                    17460000
174700                  CONTINUE                                        17470000
174800                                                                  17480000
174900             WHEN SQLCODE = -904                                  17490000
175000             WHEN SQLCODE = -911                                  17500000
175100             WHEN SQLCODE = -913                                  17510000
175200                  CONTINUE                                        17520000
175300                                                                  17530000
175400             WHEN OTHER                                           17540000
175500              SET  PS-DONE             TO TRUE                    17550060
175510              MOVE '39'                TO TM500-RETURN-CODE       17551060
175520              MOVE SQLCODE             TO TM007-SQLCODE           17552060
175530                                          PV-DISP-TM007-SQLCODE   17553060
175540              MOVE SQLCA               TO TM007-SQLCA             17554060
175600              DISPLAY '**************************************'    17560060
175700              DISPLAY '**    UNSUCCESSFUL SELECT           **'    17570060
175800              DISPLAY '**************************************'    17580060
175900              DISPLAY '** ABEND                            **'    17590060
176000              DISPLAY '** PROGRAM = TMKUP521               **'    17600060
176100              DISPLAY '** PARA = 2515-SELECT-IN-TRBL-TMST-NO-OP'  17610060
176200              DISPLAY '** DB2 OPER  = SELECT TRECEIV       **'    17620060
176300              DISPLAY '** ORD_NBR        = ' TM500-PO-NBR         17630060
176400              DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR    17640060
176500              DISPLAY '** VER_STATUS_CDE = ' PC-ACTIVE            17650060
176510              DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE17651060
176520              DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA          17652060
176530              DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE    17653060
176600              DISPLAY '**************************************'    17660060
176800         END-EVALUATE                                             17680000
176900     END-PERFORM.                                                 17690000
177000                                                                  17700000
177100     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         17710000
177200         SET PS-DONE              TO TRUE                         17720060
177210         MOVE '40'                TO TM500-RETURN-CODE            17721060
177220         MOVE SQLCODE             TO TM007-SQLCODE                17722060
177230                                     PV-DISP-TM007-SQLCODE        17723060
177240         MOVE SQLCA               TO TM007-SQLCA                  17724060
177300         DISPLAY '**************************************'         17730008
177400         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         17740008
177500         DISPLAY '**************************************'         17750008
177600         DISPLAY '** ABEND                            **'         17760008
177700         DISPLAY '** PROGRAM = TMKUP521               **'         17770014
177800         DISPLAY '** PARAGRAPH = 2515-SELECT-IN-TRBL-TMST-NO-OP'  17780008
177900         DISPLAY '** DB2 OPER  = SELECT TRECEIV       **'         17790008
178000         DISPLAY '** ORD_NBR        = ' TM500-PO-NBR              17800015
178100         DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR         17810015
178200         DISPLAY '** VER_STATUS_CDE = ' PC-ACTIVE                 17820008
178210         DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE     17821060
178220         DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA               17822060
178230         DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE         17823060
178300         DISPLAY '**************************************'         17830008
178500     END-IF.                                                      17850000
178600                                                                  17860000
178700******************************************************************17870008
178800**                                                              **17880008
178900******************************************************************17890008
179000 2520-UPDATE-IN-TRBL-TMST.                                        17900000
179100                                                                  17910000
179200     MOVE '2520-UPDATE-IN-TRBL-TMST'  TO TM007-RETURNED-PARA      17920029
179400                                                                  17940000
179500     PERFORM WITH TEST AFTER                                      17950000
179600         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    17960000
179700         UNTIL   SQLCODE = +0 OR                                  17970000
179800                 PS-DONE OR                                       17980000
179900                 PV-RETRY-COUNTER > PC-MAX-RETRIES                17990000
180000                                                                  18000000
180100         EXEC SQL                                                 18010000
180200              UPDATE TRECEIV                                      18020000
180300                 SET IN_TRBL_TMST = CURRENT TIMESTAMP             18030000
180400               WHERE OPER_UNT_ID    = :TM500-OPER-UNT-ID          18040015
180500                 AND FCLTY_ID       = :TM500-FCLTY-ID             18050015
180600                 AND ORD_NBR        = :TM500-PO-NBR               18060015
180700                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          18070015
180800                 AND VER_STATUS_CDE = :PC-ACTIVE                  18080000
180900         END-EXEC                                                 18090000
181000                                                                  18100000
181100         EVALUATE TRUE                                            18110000
181200             WHEN SQLCODE = +0                                    18120000
181300                  CONTINUE                                        18130000
181400                                                                  18140000
181500             WHEN SQLCODE = -904                                  18150000
181600             WHEN SQLCODE = -911                                  18160000
181700             WHEN SQLCODE = -913                                  18170000
181800                  CONTINUE                                        18180000
181900                                                                  18190000
182000             WHEN OTHER                                           18200000
182100              SET  PS-DONE             TO TRUE                    18210060
182110              MOVE '41'                TO TM500-RETURN-CODE       18211060
182120              MOVE SQLCODE             TO TM007-SQLCODE           18212060
182130                                          PV-DISP-TM007-SQLCODE   18213060
182140              MOVE SQLCA               TO TM007-SQLCA             18214060
182200              DISPLAY '**************************************'    18220060
182300              DISPLAY '**    UNSUCCESSFUL UPDATE           **'    18230060
182400              DISPLAY '**************************************'    18240060
182500              DISPLAY '** ABEND                            **'    18250060
182600              DISPLAY '** PROGRAM = TMKUP521               **'    18260060
182700              DISPLAY '** PARA = 2520-UPDATE-IN-TRBL-TMST'        18270060
182800              DISPLAY '** DB2 OPER  = UPDATE TRECEIV       **'    18280060
182900              DISPLAY '** OPER_UNT_ID    = ' TM500-OPER-UNT-ID    18290060
183000              DISPLAY '** FCLTY_ID       = ' TM500-FCLTY-ID       18300060
183100              DISPLAY '** ORD_NBR        = ' TM500-PO-NBR         18310060
183200              DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR    18320060
183300              DISPLAY '** VER_STATUS_CDE = ' PC-ACTIVE            18330060
183310              DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE18331060
183320              DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA          18332060
183330              DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE    18333060
183400              DISPLAY '**************************************'    18340060
183600         END-EVALUATE                                             18360000
183700     END-PERFORM.                                                 18370000
183800                                                                  18380000
183900     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         18390000
184000         SET  PS-DONE TO TRUE                                     18400000
184010         MOVE '42'                TO TM500-RETURN-CODE            18401060
184020         MOVE SQLCODE             TO TM007-SQLCODE                18402060
184030                                     PV-DISP-TM007-SQLCODE        18403060
184040         MOVE SQLCA               TO TM007-SQLCA                  18404060
184100         DISPLAY '**************************************'         18410008
184200         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         18420039
184300         DISPLAY '**************************************'         18430008
184400         DISPLAY '** ABEND                            **'         18440008
184500         DISPLAY '** PROGRAM = TMKUP521               **'         18450014
184600         DISPLAY '** PARA = 2520-UPDATE-IN-TRBL-TMST'             18460008
184700         DISPLAY '** DB2 OPER  = UPDATE TRECEIV       **'         18470008
184800         DISPLAY '** OPER_UNT_ID    = ' TM500-OPER-UNT-ID         18480015
184900         DISPLAY '** FCLTY_ID       = ' TM500-FCLTY-ID            18490015
185000         DISPLAY '** ORD_NBR        = ' TM500-PO-NBR              18500015
185100         DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR         18510015
185200         DISPLAY '** VER_STATUS_CDE = ' PC-ACTIVE                 18520008
185210         DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE     18521060
185220         DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA               18522060
185230         DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE         18523060
185300         DISPLAY '**************************************'         18530008
185500     END-IF.                                                      18550000
185600                                                                  18560000
185700******************************************************************18570008
185800**                                                              **18580008
185900******************************************************************18590008
186000 2525-UPDATE-IN-TRBL-TMST-NO-OP.                                  18600000
186100                                                                  18610000
186200     MOVE '2525-UPDATE-IN-TRBL-TMST-NO-OP'                        18620004
186300                            TO TM007-RETURNED-PARA                18630029
186500                                                                  18650000
186600     PERFORM WITH TEST AFTER                                      18660000
186700         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    18670000
186800         UNTIL   SQLCODE = +0 OR                                  18680000
186900                 PS-DONE OR                                       18690000
187000                 PV-RETRY-COUNTER > PC-MAX-RETRIES                18700000
187100                                                                  18710000
187200         EXEC SQL                                                 18720000
187300              UPDATE TRECEIV                                      18730000
187400                 SET IN_TRBL_TMST = CURRENT TIMESTAMP             18740000
187500               WHERE ORD_NBR        = :TM500-PO-NBR               18750015
187600                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          18760015
187700                 AND VER_STATUS_CDE = :PC-ACTIVE                  18770000
187800         END-EXEC                                                 18780000
187900                                                                  18790000
188000         EVALUATE TRUE                                            18800000
188100             WHEN SQLCODE = +0                                    18810000
188200                  CONTINUE                                        18820000
188300                                                                  18830000
188400             WHEN SQLCODE = -904                                  18840000
188500             WHEN SQLCODE = -911                                  18850000
188600             WHEN SQLCODE = -913                                  18860000
188700                  CONTINUE                                        18870000
188800                                                                  18880000
188900             WHEN OTHER                                           18890000
189000              SET  PS-DONE             TO TRUE                    18900060
189010              MOVE '43'                TO TM500-RETURN-CODE       18901060
189020              MOVE SQLCODE             TO TM007-SQLCODE           18902060
189030                                          PV-DISP-TM007-SQLCODE   18903060
189040              MOVE SQLCA               TO TM007-SQLCA             18904060
189100              DISPLAY '**************************************'    18910060
189200              DISPLAY '**    UNSUCCESSFUL UPDATE           **'    18920060
189300              DISPLAY '**************************************'    18930060
189400              DISPLAY '** ABEND                            **'    18940060
189500              DISPLAY '** PROGRAM = TMKUP521               **'    18950060
189600              DISPLAY '** PARA = 2525-UPDATE-IN-TRBL-TMST-NO-OP'  18960060
189700              DISPLAY '** DB2 OPER  = UPDATE TRECEIV       **'    18970060
189800              DISPLAY '** ORD_NBR        = ' TM500-PO-NBR         18980060
189900              DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR    18990060
190000              DISPLAY '** VER_STATUS_CDE = ' PC-ACTIVE            19000060
190010              DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE19001060
190020              DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA          19002060
190030              DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE    19003060
190100              DISPLAY '**************************************'    19010060
190300         END-EVALUATE                                             19030000
190400     END-PERFORM.                                                 19040000
190500                                                                  19050000
190600     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         19060000
190700         SET  PS-DONE             TO TRUE                         19070060
190710         MOVE '44'                TO TM500-RETURN-CODE            19071060
190720         MOVE SQLCODE             TO TM007-SQLCODE                19072060
190730                                     PV-DISP-TM007-SQLCODE        19073060
190740         MOVE SQLCA               TO TM007-SQLCA                  19074060
190800         DISPLAY '**************************************'         19080008
190900         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         19090008
191000         DISPLAY '**************************************'         19100008
191100         DISPLAY '** ABEND                            **'         19110008
191200         DISPLAY '** PROGRAM = TMKUP521               **'         19120014
191300         DISPLAY '** PARA = 2525-UPDATE-IN-TRBL-TMST-NO-OP'       19130008
191400         DISPLAY '** DB2 OPER  = UPDATE TRECEIV       **'         19140008
191500         DISPLAY '** ORD_NBR        = ' TM500-PO-NBR              19150015
191600         DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR         19160015
191700         DISPLAY '** VER_STATUS_CDE = ' PC-ACTIVE                 19170008
191710         DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE     19171060
191720         DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA               19172060
191730         DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE         19173060
191800         DISPLAY '**************************************'         19180008
192000     END-IF.                                                      19200000
192100                                                                  19210000
192200******************************************************************19220008
192300*    THIS PARAGRAPH UPDATES TTRBNTF.                              19230008
192400******************************************************************19240008
192500 2600-UPDATE-TTRBNTF.                                             19250000
192600                                                                  19260000
192700     EVALUATE TRUE                                                19270000
192800         WHEN TM500-IN-PROCESS                                    19280015
192900         WHEN TM500-RESPOND                                       19290015
193000              MOVE PC-I TO TRBNTF-RESOLVED-IND                    19300000
193100              PERFORM 2610-IN-PROCESS-UPDATE                      19310000
193200                                                                  19320000
193300         WHEN TM500-RESOLVE-AUTO                                  19330015
193400         WHEN TM500-RESOLVE-SPECIFIC                              19340015
193500              IF PS-DO-NOT-USE-OPER                               19350000
193600                  PERFORM 2625-VALIDATE-FOR-RESOLVE               19360000
193700              ELSE                                                19370000
193800                  PERFORM 2620-VALIDATE-FOR-RESOLVE               19380000
193900              END-IF                                              19390000
194000              IF PS-NOT-DONE AND PS-RESOLVE-FOUND                 19400000
194100                  MOVE TRBNTF-NOTIF-NBR   TO TM500-NOTIF-NBR      19410015
194200                  MOVE PC-R               TO TRBNTF-RESOLVED-IND  19420000
194300                  MOVE TM500-RESOLVED-UID TO TRBNTF-RESOLVED-UID  19430015
194400                  PERFORM 2630-RESOLVE-UPDATE                     19440000
194500***************************************************************** 19450000
194600*                 IF A DC BAD PACK IS BEING RESOLVED ON A PREPACK 19460000
194700*                 RECEIPT, ACKNOWLEDGE THE TROUBLE IMMEDIATELY.   19470000
194800***************************************************************** 19480000
194900                  IF TM500-TRBL-RSN-CDE = PC-267 OR               19490015
195000                     TM500-RESOLVE-SPECIFIC                       19500015
195100                     MOVE PC-A   TO TRBNTF-RESOLVED-IND           19510000
195200                     MOVE TM500-RESOLVED-UID                      19520015
195300                                 TO TRBNTF-ACKNOWLG-UID           19530000
195400                     PERFORM 2640-ACKNOWLEDGE-UPDATE              19540000
195500                  END-IF                                          19550000
195600              END-IF                                              19560000
195700                                                                  19570000
195800         WHEN TM500-RESOLVE-MANUAL                                19580015
195900**** IF A DC MANUAL TROUBLE IS BEING RESOLVED, AFTER RESOLUTION   19590000
196000**** IT SHOULD BE ACKNOWLEDGED IMMEDIATELY. IF THE TROUBLE BEING  19600000
196100**** RESOLVED IS NOT A DC TROUBLE, PROCESSING CONTINUNES AS USUAL 19610000
196200              PERFORM 2240-SELECT-RESP-RES-IND                    19620000
196300              IF TRBRSN-RSLV-RSPNT-CDE = PC-D                     19630000
196400                  MOVE PC-R               TO TRBNTF-RESOLVED-IND  19640000
196500                  MOVE TM500-RESOLVED-UID TO TRBNTF-RESOLVED-UID  19650015
196600                  MOVE TM500-PRORATE-IND  TO TRBNTF-PRORATE-IND   19660015
196700                  PERFORM 2630-RESOLVE-UPDATE                     19670000
196800                  MOVE PC-A               TO TRBNTF-RESOLVED-IND  19680000
196900**** IT'S BEING ACKNOWLEDGED BY SAME PERSON WHO RESOLVED IT       19690000
197000                  MOVE TM500-RESOLVED-UID TO TRBNTF-ACKNOWLG-UID  19700015
197100                  PERFORM 2640-ACKNOWLEDGE-UPDATE                 19710000
197200              ELSE                                                19720000
197300                  MOVE PC-R               TO TRBNTF-RESOLVED-IND  19730000
197400                  MOVE TM500-RESOLVED-UID TO TRBNTF-RESOLVED-UID  19740015
197500                  MOVE TM500-PRORATE-IND  TO TRBNTF-PRORATE-IND   19750015
197600                  PERFORM 2630-RESOLVE-UPDATE                     19760000
197700              END-IF                                              19770000
197800                                                                  19780000
197900         WHEN TM500-ACKNOWLEDGE                                   19790015
198000              MOVE PC-A               TO TRBNTF-RESOLVED-IND      19800000
198100              MOVE TM500-ACKNOWLG-UID TO TRBNTF-ACKNOWLG-UID      19810015
198200              PERFORM 2640-ACKNOWLEDGE-UPDATE                     19820000
198300                                                                  19830000
198400         WHEN OTHER                                               19840000
198500              SET  PS-DONE TO TRUE                                19850000
198600              MOVE SPACES  TO TM500-SQLCA                         19860015
198700              MOVE ZEROES  TO TM500-SQLCODE                       19870015
198800              MOVE PRV-5A  TO TM500-RETURN-DATA                   19880015
198900                                                                  19890000
199000     END-EVALUATE.                                                19900000
199100                                                                  19910000
199200******************************************************************19920008
199300*    THIS PARAGRAPH UPDATES TTRBNTF RESOLVED-IND TO IN-PROCESS.   19930008
199400******************************************************************19940008
199500 2610-IN-PROCESS-UPDATE.                                          19950000
199600                                                                  19960000
199700     MOVE '2610-IN-PROCESS-UPDATE'    TO TM007-RETURNED-PARA      19970029
199900                                                                  19990000
200000     PERFORM WITH TEST AFTER                                      20000000
200100         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    20010000
200200         UNTIL   SQLCODE = +0 OR                                  20020000
200300                 PS-DONE OR                                       20030000
200400                 PV-RETRY-COUNTER > PC-MAX-RETRIES                20040000
200500                                                                  20050000
200600* DID THE USER ENTER A 'Y' OR 'N' IN 'RETURN TO VENDOR'           20060000
200700*  OTHERWISE IT COULD BE BLANK                                    20070000
200800         IF TM500-RTV-YES OR TM500-RTV-NO                         20080015
200900             EXEC SQL                                             20090000
201000                  UPDATE TTRBNTF                                  20100000
201100                        SET RESOLVED_IND = :TRBNTF-RESOLVED-IND   20110000
201200                          , RTV_IND      = :TM500-RTV-SW          20120015
201300                          , RTV_RESPONSE_TMST = CURRENT TIMESTAMP 20130000
201400                   WHERE NOTIF_NBR    = :TRBNTF-NOTIF-NBR         20140000
201500             END-EXEC                                             20150000
201600         ELSE                                                     20160000
201700             EXEC SQL                                             20170000
201800                  UPDATE TTRBNTF                                  20180000
201900                     SET RESOLVED_IND = :TRBNTF-RESOLVED-IND      20190000
202000                  WHERE NOTIF_NBR    = :TRBNTF-NOTIF-NBR          20200000
202100             END-EXEC                                             20210000
202200         END-IF                                                   20220000
202300                                                                  20230000
202400         EVALUATE TRUE                                            20240000
202500             WHEN SQLCODE = +0                                    20250000
202600                  MOVE TRBNTF-RESOLVED-IND TO TM500-RESOLVED-IND  20260015
202700                                                                  20270000
202800             WHEN SQLCODE = -904                                  20280000
202900             WHEN SQLCODE = -911                                  20290000
203000             WHEN SQLCODE = -913                                  20300000
203100                  CONTINUE                                        20310000
203200                                                                  20320000
203300             WHEN OTHER                                           20330000
203301              SET  PS-DONE             TO TRUE                    20330160
203310              MOVE '44'                TO TM500-RETURN-CODE       20331060
203320              MOVE SQLCODE             TO TM007-SQLCODE           20332060
203330                                          PV-DISP-TM007-SQLCODE   20333060
203340              MOVE SQLCA               TO TM007-SQLCA             20334060
203500              DISPLAY '**************************************'    20350060
203600              DISPLAY '**    UNSUCCESSFUL UPDATE           **'    20360060
203700              DISPLAY '**************************************'    20370060
203800              DISPLAY '** ABEND                            **'    20380060
203900              DISPLAY '** PROGRAM = TMKUP521               **'    20390060
204000              DISPLAY '** PARA = 2610-IN-PROCESS-UPDATE'          20400060
204100              DISPLAY '** DB2 OPER  = UPDATE TTRBNTF       **'    20410060
204200              DISPLAY '** NOTIF_NBR      = ' TRBNTF-NOTIF-NBR     20420060
204210              DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE20421060
204220              DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA          20422060
204230              DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE    20423060
204300              DISPLAY '**************************************'    20430060
204500         END-EVALUATE                                             20450000
204600     END-PERFORM.                                                 20460000
204700                                                                  20470000
204800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         20480000
204900         SET  PS-DONE             TO TRUE                         20490060
204910         MOVE '45'                TO TM500-RETURN-CODE            20491060
204920         MOVE SQLCODE             TO TM007-SQLCODE                20492060
204930                                     PV-DISP-TM007-SQLCODE        20493060
204940         MOVE SQLCA               TO TM007-SQLCA                  20494060
205000         DISPLAY '**************************************'         20500008
205100         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         20510008
205200         DISPLAY '**************************************'         20520008
205300         DISPLAY '** ABEND                            **'         20530008
205400         DISPLAY '** PROGRAM = TMKUP521               **'         20540014
205500         DISPLAY '** PARA = 2610-IN-PROCESS-UPDATE'               20550008
205600         DISPLAY '** DB2 OPER  = UPDATE TTRBNTF       **'         20560008
205700         DISPLAY '** NOTIF_NBR      = ' TRBNTF-NOTIF-NBR          20570008
205710         DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE     20571060
205720         DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA               20572060
205730         DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE         20573060
205800         DISPLAY '**************************************'         20580008
206000     END-IF.                                                      20600000
206100                                                                  20610000
206200******************************************************************20620008
206300**                                                              **20630009
206400******************************************************************20640009
206500 2620-VALIDATE-FOR-RESOLVE.                                       20650000
206600                                                                  20660000
206700     MOVE '2620-VALIDATE-FOR-RESOLVE' TO TM007-RETURNED-PARA      20670029
206900                                                                  20690000
207000     PERFORM WITH TEST AFTER                                      20700000
207100         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    20710000
207200         UNTIL   SQLCODE = +0 OR                                  20720000
207300                 SQLCODE = +100 OR                                20730000
207400                 PS-DONE OR                                       20740000
207500                 PV-RETRY-COUNTER > PC-MAX-RETRIES                20750000
207600                                                                  20760000
207700         EXEC SQL                                                 20770000
207800              SELECT NOTIF_NBR                                    20780000
207900                INTO :TRBNTF-NOTIF-NBR                            20790000
208000                FROM TTRBNTF                                      20800000
208100               WHERE OPER_UNT_ID    = :TM500-OPER-UNT-ID          20810015
208200                 AND FCLTY_ID       = :TM500-FCLTY-ID             20820015
208300                 AND PO_NBR         = :TM500-PO-NBR               20830015
208400                 AND PO_LNE_NBR     = :TM500-PO-LNE-NBR           20840015
208500                 AND PREPK_ID       = :TM500-PREPK-ID             20850015
208600                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          20860015
208700                 AND TRBL_RSN_CDE   = :TM500-TRBL-RSN-CDE         20870015
208800                 AND RESOLVED_IND   IN (:PC-N, :PC-I)             20880000
208900         END-EXEC                                                 20890000
209000                                                                  20900000
209100         EVALUATE TRUE                                            20910000
209200             WHEN SQLCODE = +0                                    20920000
209300                  SET PS-RESOLVE-FOUND TO TRUE                    20930000
209400                                                                  20940000
209500             WHEN SQLCODE = +100                                  20950000
209600                  SET PS-NO-RESOLVE-FOUND TO TRUE                 20960000
209700                                                                  20970000
209800             WHEN SQLCODE = -904                                  20980000
209900             WHEN SQLCODE = -911                                  20990000
210000             WHEN SQLCODE = -913                                  21000000
210100                  CONTINUE                                        21010000
210200                                                                  21020000
210300             WHEN OTHER                                           21030000
210400              SET  PS-DONE             TO TRUE                    21040060
210410              MOVE '46'                TO TM500-RETURN-CODE       21041060
210420              MOVE SQLCODE             TO TM007-SQLCODE           21042060
210430                                          PV-DISP-TM007-SQLCODE   21043060
210440              MOVE SQLCA               TO TM007-SQLCA             21044060
210500              DISPLAY '**************************************'    21050060
210600              DISPLAY '**    UNSUCCESSFUL SELECT           **'    21060060
210700              DISPLAY '**************************************'    21070060
210800              DISPLAY '** ABEND                            **'    21080060
210900              DISPLAY '** PROGRAM = TMKUP521               **'    21090060
211000              DISPLAY '** PARA = 2620-VALIDATE-FOR-RESOLVE'       21100060
211100              DISPLAY '** DB2 OPER  = SELECT TTRBNTF       **'    21110060
211200              DISPLAY '** OPER_UNT_ID    = ' TM500-OPER-UNT-ID    21120060
211300              DISPLAY '** FCLTY_ID       = ' TM500-FCLTY-ID       21130060
211400              DISPLAY '** PO_NBR         = ' TM500-PO-NBR         21140060
211500              DISPLAY '** PO_LNE_NBR     = ' TM500-PO-LNE-NBR     21150060
211600              DISPLAY '** PREPK_ID       = ' TM500-PREPK-ID       21160060
211700              DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR    21170060
211800              DISPLAY '** TRBL_RSN_CDE   = ' TM500-TRBL-RSN-CDE   21180060
211900              DISPLAY '** RESOLVED_IND   =   N OR I'              21190060
211910              DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE21191060
211920              DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA          21192060
211930              DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE    21193060
212000              DISPLAY '**************************************'    21200060
212200         END-EVALUATE                                             21220000
212300     END-PERFORM.                                                 21230000
212400                                                                  21240000
212500     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         21250000
212600         SET PS-DONE              TO TRUE                         21260060
212610         MOVE '47'                TO TM500-RETURN-CODE            21261060
212620         MOVE SQLCODE             TO TM007-SQLCODE                21262060
212630                                     PV-DISP-TM007-SQLCODE        21263060
212640         MOVE SQLCA               TO TM007-SQLCA                  21264060
212700         DISPLAY '**************************************'         21270008
212800         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         21280008
212900         DISPLAY '**************************************'         21290008
213000         DISPLAY '** ABEND                            **'         21300008
213100         DISPLAY '** PROGRAM = TMKUP521               **'         21310014
213200         DISPLAY '** PARA = 2620-VALIDATE-FOR-RESOLVE'            21320008
213300         DISPLAY '** DB2 OPER  = SELECT TTRBNTF       **'         21330008
213400         DISPLAY '** OPER_UNT_ID    = ' TM500-OPER-UNT-ID         21340015
213500         DISPLAY '** FCLTY_ID       = ' TM500-FCLTY-ID            21350015
213600         DISPLAY '** PO_NBR         = ' TM500-PO-NBR              21360015
213700         DISPLAY '** PO_LNE_NBR     = ' TM500-PO-LNE-NBR          21370015
213800         DISPLAY '** PREPK_ID       = ' TM500-PREPK-ID            21380015
213900         DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR         21390015
214000         DISPLAY '** TRBL_RSN_CDE   = ' TM500-TRBL-RSN-CDE        21400015
214100         DISPLAY '** RESOLVED_IND   =   N OR I'                   21410008
214110         DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE     21411060
214120         DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA               21412060
214130         DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE         21413060
214200         DISPLAY '**************************************'         21420008
214400     END-IF.                                                      21440000
214500                                                                  21450000
214600******************************************************************21460008
214700**                                                              **21470008
214800******************************************************************21480008
214900 2625-VALIDATE-FOR-RESOLVE.                                       21490000
215000                                                                  21500000
215100     MOVE '2625-VALIDATE-FOR-RESOLVE' TO TM007-RETURNED-PARA      21510029
215300                                                                  21530000
215400     PERFORM WITH TEST AFTER                                      21540000
215500         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    21550000
215600         UNTIL   SQLCODE = +0 OR                                  21560000
215700                 SQLCODE = +100 OR                                21570000
215800                 PS-DONE OR                                       21580000
215900                 PV-RETRY-COUNTER > PC-MAX-RETRIES                21590000
216000                                                                  21600000
216100         EXEC SQL                                                 21610000
216200              SELECT NOTIF_NBR                                    21620000
216300                INTO :TRBNTF-NOTIF-NBR                            21630000
216400                FROM TTRBNTF                                      21640000
216500               WHERE PO_NBR         = :TM500-PO-NBR               21650015
216600                 AND PO_LNE_NBR     = :TM500-PO-LNE-NBR           21660015
216700                 AND PREPK_ID       = :TM500-PREPK-ID             21670015
216800                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          21680015
216900                 AND TRBL_RSN_CDE   = :TM500-TRBL-RSN-CDE         21690015
217000                 AND RESOLVED_IND   IN (:PC-N, :PC-I)             21700000
217100         END-EXEC                                                 21710000
217200                                                                  21720000
217300         EVALUATE TRUE                                            21730000
217400             WHEN SQLCODE = +0                                    21740000
217500                  SET PS-RESOLVE-FOUND TO TRUE                    21750000
217600                                                                  21760000
217700             WHEN SQLCODE = +100                                  21770000
217800                  SET PS-NO-RESOLVE-FOUND TO TRUE                 21780000
217900                                                                  21790000
218000             WHEN SQLCODE = -904                                  21800000
218100             WHEN SQLCODE = -911                                  21810000
218200             WHEN SQLCODE = -913                                  21820000
218300                  CONTINUE                                        21830000
218400                                                                  21840000
218500             WHEN OTHER                                           21850000
218600              SET  PS-DONE             TO TRUE                    21860060
218610              MOVE '48'                TO TM500-RETURN-CODE       21861060
218620              MOVE SQLCODE             TO TM007-SQLCODE           21862060
218630                                          PV-DISP-TM007-SQLCODE   21863060
218640              MOVE SQLCA               TO TM007-SQLCA             21864060
218700              DISPLAY '**************************************'    21870060
218800              DISPLAY '**    UNSUCCESSFUL SELECT           **'    21880060
218900              DISPLAY '**************************************'    21890060
219000              DISPLAY '** ABEND                            **'    21900060
219100              DISPLAY '** PROGRAM = TMKUP521               **'    21910060
219200              DISPLAY '** PARA = 2625-VALIDATE-FOR-RESOLVE'       21920060
219300              DISPLAY '** DB2 OPER  = SELECT TTRBNTF       **'    21930060
219400              DISPLAY '** PO_NBR         = ' TM500-PO-NBR         21940060
219500              DISPLAY '** PO_LNE_NBR     = ' TM500-PO-LNE-NBR     21950060
219600              DISPLAY '** PREPK_ID       = ' TM500-PREPK-ID       21960060
219700              DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR    21970060
219800              DISPLAY '** TRBL_RSN_CDE   = ' TM500-TRBL-RSN-CDE   21980060
219900              DISPLAY '** RESOLVED_IND   =  N OR I'               21990060
219910              DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE21991060
219920              DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA          21992060
219930              DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE    21993060
220000              DISPLAY '**************************************'    22000060
220200         END-EVALUATE                                             22020000
220300     END-PERFORM.                                                 22030000
220400                                                                  22040000
220500     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         22050000
220600         SET PS-DONE              TO TRUE                         22060060
220610         MOVE '49'                TO TM500-RETURN-CODE            22061060
220620         MOVE SQLCODE             TO TM007-SQLCODE                22062060
220630                                     PV-DISP-TM007-SQLCODE        22063060
220640         MOVE SQLCA               TO TM007-SQLCA                  22064060
220700         DISPLAY '**************************************'         22070008
220800         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         22080008
220900         DISPLAY '**************************************'         22090008
221000         DISPLAY '** ABEND                            **'         22100008
221100         DISPLAY '** PROGRAM = TMKUP521               **'         22110014
221200         DISPLAY '** PARA = 2625-VALIDATE-FOR-RESOLVE'            22120008
221300         DISPLAY '** DB2 OPER  = SELECT TTRBNTF       **'         22130008
221400         DISPLAY '** PO_NBR         = ' TM500-PO-NBR              22140015
221500         DISPLAY '** PO_LNE_NBR     = ' TM500-PO-LNE-NBR          22150015
221600         DISPLAY '** PREPK_ID       = ' TM500-PREPK-ID            22160015
221700         DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR         22170015
221800         DISPLAY '** TRBL_RSN_CDE   = ' TM500-TRBL-RSN-CDE        22180015
221900         DISPLAY '** RESOLVED_IND   =  N OR I'                    22190008
221910         DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE     22191060
221920         DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA               22192060
221930         DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE         22193060
222000         DISPLAY '**************************************'         22200008
222200     END-IF.                                                      22220000
222300                                                                  22230000
222400******************************************************************22240008
222500*    THIS PARAGRAPH UPDATES TTRBNTF RESOLVED-IND TO RESOLVE.      22250008
222600******************************************************************22260008
222700 2630-RESOLVE-UPDATE.                                             22270000
222800                                                                  22280000
222900     MOVE '2630-RESOLVE-UPDATE'       TO TM007-RETURNED-PARA      22290029
223100                                                                  22310000
223200     PERFORM WITH TEST AFTER                                      22320000
223300         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    22330000
223400         UNTIL   SQLCODE = +0 OR                                  22340000
223500                 PS-DONE OR                                       22350000
223600                 PV-RETRY-COUNTER > PC-MAX-RETRIES                22360000
223700                                                                  22370000
223800         EVALUATE TRUE                                            22380000
223900                                                                  22390000
224000             WHEN TM500-RTV-YES OR TM500-RTV-NO                   22400015
224100                                                                  22410000
224200              EXEC SQL                                            22420000
224300                 UPDATE TTRBNTF                                   22430000
224400                    SET RESOLVED_IND  = :TRBNTF-RESOLVED-IND      22440000
224500                      , RESOLVED_TMST = CURRENT TIMESTAMP         22450000
224600                      , RESOLVED_UID  = :TRBNTF-RESOLVED-UID      22460000
224700                      , RTV_IND       = :TM500-RTV-SW             22470015
224800                      , RTV_RESPONSE_TMST = CURRENT TIMESTAMP     22480000
224900                 WHERE NOTIF_NBR     = :TRBNTF-NOTIF-NBR          22490000
225000              END-EXEC                                            22500000
225100                                                                  22510000
225200             WHEN TRBNTF-PRORATE-IND = PC-Y                       22520000
225300                                                                  22530000
225400              EXEC SQL                                            22540000
225500                 UPDATE TTRBNTF                                   22550000
225600                    SET RESOLVED_IND  = :TRBNTF-RESOLVED-IND      22560000
225700                      , RESOLVED_TMST = CURRENT TIMESTAMP         22570000
225800                      , RESOLVED_UID  = :TRBNTF-RESOLVED-UID      22580000
225900                      , PRORATE_IND   = :TRBNTF-PRORATE-IND       22590000
226000                 WHERE NOTIF_NBR     = :TRBNTF-NOTIF-NBR          22600000
226100              END-EXEC                                            22610000
226200                                                                  22620000
226300             WHEN OTHER                                           22630000
226400                                                                  22640000
226500            EXEC SQL                                              22650000
226600              UPDATE TTRBNTF                                      22660000
226700                 SET RESOLVED_IND  = :TRBNTF-RESOLVED-IND         22670000
226800                   , RESOLVED_TMST = CURRENT TIMESTAMP            22680000
226900                   , RESOLVED_UID  = :TRBNTF-RESOLVED-UID         22690000
227000               WHERE NOTIF_NBR     = :TRBNTF-NOTIF-NBR            22700000
227100            END-EXEC                                              22710000
227200         END-EVALUATE                                             22720000
227300                                                                  22730000
227400         EVALUATE TRUE                                            22740000
227500             WHEN SQLCODE = +0                                    22750000
227600                  MOVE TRBNTF-RESOLVED-IND TO TM500-RESOLVED-IND  22760015
227700                                                                  22770000
227800             WHEN SQLCODE = -904                                  22780000
227900             WHEN SQLCODE = -911                                  22790000
228000             WHEN SQLCODE = -913                                  22800000
228100                  CONTINUE                                        22810000
228200                                                                  22820000
228300             WHEN OTHER                                           22830000
228400              SET  PS-DONE             TO TRUE                    22840060
228410              MOVE '50'                TO TM500-RETURN-CODE       22841060
228420              MOVE SQLCODE             TO TM007-SQLCODE           22842060
228430                                          PV-DISP-TM007-SQLCODE   22843060
228440              MOVE SQLCA               TO TM007-SQLCA             22844060
228500              DISPLAY '**************************************'    22850060
228600              DISPLAY '**    UNSUCCESSFUL UPDATE           **'    22860060
228700              DISPLAY '**************************************'    22870060
228800              DISPLAY '** ABEND                            **'    22880060
228900              DISPLAY '** PROGRAM = TMKUP521               **'    22890060
229000              DISPLAY '** PARA = 2630-RESOLVE-UPDATE'             22900060
229100              DISPLAY '** DB2 OPER  = UPDATE TTRBNTF       **'    22910060
229200              DISPLAY '** NOTIF_NBR      = ' TRBNTF-NOTIF-NBR     22920060
229210              DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE22921060
229220              DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA          22922060
229230              DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE    22923060
229300              DISPLAY '**************************************'    22930060
229500         END-EVALUATE                                             22950000
229600     END-PERFORM.                                                 22960000
229700                                                                  22970000
229800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         22980000
229900         SET  PS-DONE             TO TRUE                         22990060
229910         MOVE '51'                TO TM500-RETURN-CODE            22991060
229920         MOVE SQLCODE             TO TM007-SQLCODE                22992060
229930                                     PV-DISP-TM007-SQLCODE        22993060
229940         MOVE SQLCA               TO TM007-SQLCA                  22994060
230000         DISPLAY '**************************************'         23000008
230100         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         23010008
230200         DISPLAY '**************************************'         23020008
230300         DISPLAY '** ABEND                            **'         23030008
230400         DISPLAY '** PROGRAM = TMKUP521               **'         23040014
230500         DISPLAY '** PARA = 2630-RESOLVE-UPDATE'                  23050008
230600         DISPLAY '** DB2 OPER  = UPDATE TTRBNTF       **'         23060008
230700         DISPLAY '** NOTIF_NBR      = ' TRBNTF-NOTIF-NBR          23070008
230710         DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE     23071060
230720         DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA               23072060
230730         DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE         23073060
230800         DISPLAY '**************************************'         23080008
231000     END-IF.                                                      23100000
231100                                                                  23110000
231200******************************************************************23120008
231300*    THIS PARAGRAPH UPDATES TTRBNTF RESOLVED-IND TO ACKNOWLEDGE.  23130008
231400******************************************************************23140008
231500 2640-ACKNOWLEDGE-UPDATE.                                         23150000
231600                                                                  23160000
231700     MOVE '2640-ACKNOWLEDGE-UPDATE'   TO TM007-RETURNED-PARA      23170029
231900                                                                  23190000
232000     PERFORM WITH TEST AFTER                                      23200000
232100         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    23210000
232200         UNTIL   SQLCODE = +0 OR                                  23220000
232300                 PS-DONE OR                                       23230000
232400                 PV-RETRY-COUNTER > PC-MAX-RETRIES                23240000
232500                                                                  23250000
232600         EXEC SQL                                                 23260000
232700              UPDATE TTRBNTF                                      23270000
232800                 SET RESOLVED_IND  = :TRBNTF-RESOLVED-IND         23280000
232900                   , ACKNOWLG_TMST = CURRENT TIMESTAMP            23290000
233000                   , ACKNOWLG_UID  = :TRBNTF-ACKNOWLG-UID         23300000
233100               WHERE NOTIF_NBR     = :TRBNTF-NOTIF-NBR            23310000
233200         END-EXEC                                                 23320000
233300                                                                  23330000
233400         EVALUATE TRUE                                            23340000
233500             WHEN SQLCODE = +0                                    23350000
233600                  MOVE TRBNTF-RESOLVED-IND TO TM500-RESOLVED-IND  23360015
233700                                                                  23370000
233800             WHEN SQLCODE = -904                                  23380000
233900             WHEN SQLCODE = -911                                  23390000
234000             WHEN SQLCODE = -913                                  23400000
234100                  CONTINUE                                        23410000
234200                                                                  23420000
234300             WHEN OTHER                                           23430000
234400              SET  PS-DONE TO TRUE                                23440060
234410              MOVE '52'                TO TM500-RETURN-CODE       23441060
234420              MOVE SQLCODE             TO TM007-SQLCODE           23442060
234430                                          PV-DISP-TM007-SQLCODE   23443060
234440              MOVE SQLCA               TO TM007-SQLCA             23444060
234500              DISPLAY '**************************************'    23450060
234600              DISPLAY '**    UNSUCCESSFUL UPDATE           **'    23460060
234700              DISPLAY '**************************************'    23470060
234800              DISPLAY '** ABEND                            **'    23480060
234900              DISPLAY '** PROGRAM = TMKUP521               **'    23490060
235000              DISPLAY '** PARA = 2640-ACKNOWLEDGE-UPDATE'         23500060
235100              DISPLAY '** DB2 OPER  = UPDATE TTRBNTF       **'    23510060
235200              DISPLAY '** NOTIF_NBR      = ' TRBNTF-NOTIF-NBR     23520060
235210              DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE23521060
235220              DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA          23522060
235230              DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE    23523060
235300              DISPLAY '**************************************'    23530060
235500         END-EVALUATE                                             23550000
235600     END-PERFORM.                                                 23560000
235700                                                                  23570000
235800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         23580000
235900         SET  PS-DONE TO TRUE                                     23590000
235910         MOVE '53'                TO TM500-RETURN-CODE            23591060
235920         MOVE SQLCODE             TO TM007-SQLCODE                23592060
235930                                     PV-DISP-TM007-SQLCODE        23593060
235940         MOVE SQLCA               TO TM007-SQLCA                  23594060
236000         DISPLAY '**************************************'         23600008
236100         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         23610008
236200         DISPLAY '**************************************'         23620008
236300         DISPLAY '** ABEND                            **'         23630008
236400         DISPLAY '** PROGRAM = TMKUP521               **'         23640014
236500         DISPLAY '** PARA = 2640-ACKNOWLEDGE-UPDATE'              23650008
236600         DISPLAY '** DB2 OPER  = UPDATE TTRBNTF       **'         23660008
236700         DISPLAY '** NOTIF_NBR      = ' TRBNTF-NOTIF-NBR          23670008
236710         DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE     23671060
236720         DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA               23672060
236730         DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE         23673060
236800         DISPLAY '**************************************'         23680008
237000     END-IF.                                                      23700000
237100                                                                  23710000
237200******************************************************************23720008
237300**                                                              **23730008
237400******************************************************************23740008
237500 2700-DEFAULT-TRECEIV-TMST.                                       23750000
237600                                                                  23760000
237700     IF TM500-RESOLVE-MANUAL OR TM500-RESOLVE-AUTO OR             23770015
237800        TM500-RESOLVE-SPECIFIC                                    23780015
237900         PERFORM 4000-SELECT-NOTIF-IND                            23790000
238000                                                                  23800000
238100         IF PS-NOT-DONE AND TRBRSN-NOTIF-IND = PC-T               23810000
238200             PERFORM 2710-SELECT-RESOLVED-IND                     23820000
238300                                                                  23830000
238400             IF PS-NOT-DONE AND PS-NO-MORE-TROUBLE                23840000
238500                 PERFORM 2720-DEFAULT-IN-TRBL-TMST                23850000
238600             END-IF                                               23860000
238700         END-IF                                                   23870000
238800     END-IF.                                                      23880000
238900                                                                  23890000
239000******************************************************************23900008
239100**                                                              **23910008
239200******************************************************************23920008
239300 2710-SELECT-RESOLVED-IND.                                        23930000
239400                                                                  23940000
239500     MOVE '2710-SELECT-RESOLVED-IND'  TO TM007-RETURNED-PARA      23950029
239700                                                                  23970000
239800     PERFORM WITH TEST AFTER                                      23980000
239900         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    23990000
240000         UNTIL   SQLCODE = +0 OR                                  24000000
240100                 SQLCODE = +100 OR                                24010000
240200                 SQLCODE = -811 OR                                24020000
240300                 PS-DONE OR                                       24030000
240400                 PV-RETRY-COUNTER > PC-MAX-RETRIES                24040000
240500                                                                  24050000
240600         EXEC SQL                                                 24060000
240700              SELECT NOTIF_NBR                                    24070000
240800                INTO :TRBNTF-NOTIF-NBR                            24080000
240900                FROM TTRBNTF                                      24090000
241000               WHERE OPER_UNT_ID    = :TM500-OPER-UNT-ID          24100015
241100                 AND FCLTY_ID       = :TM500-FCLTY-ID             24110015
241200                 AND PO_NBR         = :TM500-PO-NBR               24120015
241300                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          24130015
241400                 AND RESOLVED_IND   IN (:PC-N, :PC-I)             24140000
241500         END-EXEC                                                 24150000
241600                                                                  24160000
241700         EVALUATE TRUE                                            24170000
241800             WHEN SQLCODE = +0                                    24180000
241900                  SET PS-MORE-TROUBLE TO TRUE                     24190000
242000                                                                  24200000
242100             WHEN SQLCODE = +100                                  24210000
242200             WHEN SQLCODE = -811                                  24220000
242300                  SET PS-NO-MORE-TROUBLE TO TRUE                  24230000
242400                                                                  24240000
242500             WHEN SQLCODE = -904                                  24250000
242600             WHEN SQLCODE = -911                                  24260000
242700             WHEN SQLCODE = -913                                  24270000
242800                  CONTINUE                                        24280000
242900                                                                  24290000
243000             WHEN OTHER                                           24300000
243100              SET  PS-DONE TO TRUE                                24310060
243110              MOVE '54'                TO TM500-RETURN-CODE       24311060
243120              MOVE SQLCODE             TO TM007-SQLCODE           24312060
243130                                          PV-DISP-TM007-SQLCODE   24313060
243140              MOVE SQLCA               TO TM007-SQLCA             24314060
243200              DISPLAY '**************************************'    24320060
243300              DISPLAY '**    UNSUCCESSFUL SELECT           **'    24330060
243400              DISPLAY '**************************************'    24340060
243500              DISPLAY '** ABEND                            **'    24350060
243600              DISPLAY '** PROGRAM = TMKUP521               **'    24360060
243700              DISPLAY '** PARA = 2710-SELECT-RESOLVED-IND'        24370060
243800              DISPLAY '** DB2 OPER  = SELECT TTRBNTF       **'    24380060
243900              DISPLAY '** OPER_UNT_ID    = ' TM500-OPER-UNT-ID    24390060
244000              DISPLAY '** FCLTY_ID       = ' TM500-FCLTY-ID       24400060
244100              DISPLAY '** PO_NBR         = ' TM500-PO-NBR         24410060
244200              DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR    24420060
244300              DISPLAY '** RESOLVED_IND   =  N OR I '              24430060
244310              DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE24431060
244320              DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA          24432060
244330              DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE    24433060
244400              DISPLAY '**************************************'    24440060
244600         END-EVALUATE                                             24460000
244700     END-PERFORM.                                                 24470000
244800                                                                  24480000
244900     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         24490000
245000         SET PS-DONE              TO TRUE                         24500060
245010         MOVE '55'                TO TM500-RETURN-CODE            24501060
245020         MOVE SQLCODE             TO TM007-SQLCODE                24502060
245030                                     PV-DISP-TM007-SQLCODE        24503060
245040         MOVE SQLCA               TO TM007-SQLCA                  24504060
245100         DISPLAY '**************************************'         24510008
245200         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         24520008
245300         DISPLAY '**************************************'         24530008
245400         DISPLAY '** ABEND                            **'         24540008
245500         DISPLAY '** PROGRAM = TMKUP521               **'         24550014
245600         DISPLAY '** PARA = 2710-SELECT-RESOLVED-IND'             24560008
245700         DISPLAY '** DB2 OPER  = SELECT TTRBNTF       **'         24570008
245800         DISPLAY '** OPER_UNT_ID    = ' TM500-OPER-UNT-ID         24580015
245900         DISPLAY '** FCLTY_ID       = ' TM500-FCLTY-ID            24590015
246000         DISPLAY '** PO_NBR         = ' TM500-PO-NBR              24600015
246100         DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR         24610015
246200         DISPLAY '** RESOLVED_IND   =  N OR I '                   24620008
246210         DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE     24621060
246220         DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA               24622060
246230         DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE         24623060
246300         DISPLAY '**************************************'         24630008
246500     END-IF.                                                      24650000
246600                                                                  24660000
246700******************************************************************24670008
246800**                                                              **24680008
246900******************************************************************24690008
247000 2720-DEFAULT-IN-TRBL-TMST.                                       24700000
247100                                                                  24710000
247200     IF PS-DO-NOT-USE-OPER                                        24720000
247300         PERFORM 2721A-GET-IN-TRBL-TMST-NO-OPER                   24730000
247400     ELSE                                                         24740000
247500         PERFORM 2721-GET-IN-TRBL-TMST                            24750000
247600     END-IF.                                                      24760000
247700                                                                  24770000
247800     IF PS-NOT-DONE                                               24780000
247900         IF RECEIV-IN-TRBL-TMST NOT = PC-DEFAULT-TMST             24790000
248000             PERFORM 2722-CALC-LGTH-OF-TRBL                       24800000
248100             IF PS-DO-NOT-USE-OPER                                24810000
248200                 PERFORM 2724-UPDATE-TRECEIV-NO-OPER              24820000
248300             ELSE                                                 24830000
248400                 PERFORM 2723-UPDATE-TRECEIV                      24840000
248500             END-IF                                               24850000
248600         END-IF                                                   24860000
248700     END-IF.                                                      24870000
248800                                                                  24880000
248900******************************************************************24890000
249000**                                                              **24900008
249100******************************************************************24910000
249200 2721-GET-IN-TRBL-TMST.                                           24920008
249300                                                                  24930000
249400     MOVE '2721-GET-IN-TRBL-TMST'     TO TM007-RETURNED-PARA      24940029
249600                                                                  24960000
249700     PERFORM WITH TEST AFTER                                      24970000
249800         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    24980000
249900         UNTIL   SQLCODE = +0 OR                                  24990000
250000                 PS-DONE OR                                       25000000
250100                 PV-RETRY-COUNTER > PC-MAX-RETRIES                25010000
250200                                                                  25020000
250300         EXEC SQL                                                 25030000
250400              SELECT IN_TRBL_TMST                                 25040000
250500                   , DAY(CURRENT TIMESTAMP - IN_TRBL_TMST)        25050000
250600                   , HOUR(CURRENT TIMESTAMP - IN_TRBL_TMST)       25060000
250700                   , MINUTE(CURRENT TIMESTAMP - IN_TRBL_TMST)     25070000
250800                   , DATE(CURRENT TIMESTAMP)                      25080000
250900                   , TIME(CURRENT TIMESTAMP)                      25090000
251000                   , DATE(IN_TRBL_TMST)                           25100000
251100                   , TIME(IN_TRBL_TMST)                           25110000
251200                INTO :RECEIV-IN-TRBL-TMST                         25120000
251300                   , :PV-DB2-DAYS                                 25130000
251400                   , :PV-DB2-HOURS                                25140000
251500                   , :PV-DB2-MINUTES                              25150000
251600                   , :PV-CURRENT-DATE                             25160000
251700                   , :PV-CURRENT-TIME                             25170000
251800                   , :PV-IN-TRBL-DATE                             25180000
251900                   , :PV-IN-TRBL-TIME                             25190000
252000                FROM TRECEIV                                      25200000
252100               WHERE OPER_UNT_ID    = :TM500-OPER-UNT-ID          25210015
252200                 AND FCLTY_ID       = :TM500-FCLTY-ID             25220015
252300                 AND ORD_NBR        = :TM500-PO-NBR               25230015
252400                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          25240015
252500                 AND VER_STATUS_CDE = :PC-ACTIVE                  25250000
252600         END-EXEC                                                 25260000
252700                                                                  25270000
252800         EVALUATE TRUE                                            25280000
252900             WHEN SQLCODE = +0                                    25290000
253000                  CONTINUE                                        25300000
253100                                                                  25310000
253200             WHEN SQLCODE = -904                                  25320000
253300             WHEN SQLCODE = -911                                  25330000
253400             WHEN SQLCODE = -913                                  25340000
253500                  CONTINUE                                        25350000
253600                                                                  25360000
253700             WHEN OTHER                                           25370000
253800              SET  PS-DONE             TO TRUE                    25380060
253810              MOVE '56'                TO TM500-RETURN-CODE       25381060
253820              MOVE SQLCODE             TO TM007-SQLCODE           25382060
253830                                          PV-DISP-TM007-SQLCODE   25383060
253840              MOVE SQLCA               TO TM007-SQLCA             25384060
253900              DISPLAY '**************************************'    25390060
254000              DISPLAY '**    UNSUCCESSFUL SELECT           **'    25400060
254100              DISPLAY '**************************************'    25410060
254200              DISPLAY '** ABEND                            **'    25420060
254300              DISPLAY '** PROGRAM = TMKUP521               **'    25430060
254400              DISPLAY '** PARA = 2721-GET-IN-TRBL-TMST'           25440060
254500              DISPLAY '** DB2 OPER  = SELECT TRECEIV       **'    25450060
254600              DISPLAY '** OPER_UNT_ID    = ' TM500-OPER-UNT-ID    25460060
254700              DISPLAY '** FCLTY_ID       = ' TM500-FCLTY-ID       25470060
254800              DISPLAY '** ORD_NBR        = ' TM500-PO-NBR         25480060
254900              DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR    25490060
255000              DISPLAY '** VER_STATUS_CDE = ' PC-ACTIVE            25500060
255010              DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE25501060
255020              DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA          25502060
255030              DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE    25503060
255100              DISPLAY '**************************************'    25510060
255300         END-EVALUATE                                             25530000
255400     END-PERFORM.                                                 25540000
255500                                                                  25550000
255600     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         25560000
255700         SET PS-DONE              TO TRUE                         25570060
255710         MOVE '57'                TO TM500-RETURN-CODE            25571060
255720         MOVE SQLCODE             TO TM007-SQLCODE                25572060
255730                                     PV-DISP-TM007-SQLCODE        25573060
255740         MOVE SQLCA               TO TM007-SQLCA                  25574060
255800         DISPLAY '**************************************'         25580008
255900         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         25590008
256000         DISPLAY '**************************************'         25600008
256100         DISPLAY '** ABEND                            **'         25610008
256200         DISPLAY '** PROGRAM = TMKUP521               **'         25620014
256300         DISPLAY '** PARA = 2721-GET-IN-TRBL-TMST'                25630008
256400         DISPLAY '** DB2 OPER  = SELECT TRECEIV       **'         25640008
256500         DISPLAY '** OPER_UNT_ID    = ' TM500-OPER-UNT-ID         25650015
256600         DISPLAY '** FCLTY_ID       = ' TM500-FCLTY-ID            25660015
256700         DISPLAY '** ORD_NBR        = ' TM500-PO-NBR              25670015
256800         DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR         25680015
256900         DISPLAY '** VER_STATUS_CDE = ' PC-ACTIVE                 25690008
256910         DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE     25691060
256920         DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA               25692060
256930         DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE         25693060
257000         DISPLAY '**************************************'         25700008
257200     END-IF.                                                      25720000
257300                                                                  25730000
257400******************************************************************25740008
257500**                                                              **25750008
257600******************************************************************25760008
257700 2721A-GET-IN-TRBL-TMST-NO-OPER.                                  25770000
257800                                                                  25780000
257900     MOVE '2721A-GET-IN-TRBL-TMST-NO-OPER'                        25790004
258000                               TO TM007-RETURNED-PARA             25800029
258100                                                                  25810000
258200     PERFORM WITH TEST AFTER                                      25820000
258300         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    25830000
258400         UNTIL   SQLCODE = +0 OR                                  25840000
258500                 PS-DONE OR                                       25850000
258600                 PV-RETRY-COUNTER > PC-MAX-RETRIES                25860000
258700                                                                  25870000
258800         EXEC SQL                                                 25880000
258900              SELECT IN_TRBL_TMST                                 25890000
259000                   , DAY(CURRENT TIMESTAMP - IN_TRBL_TMST)        25900000
259100                   , HOUR(CURRENT TIMESTAMP - IN_TRBL_TMST)       25910000
259200                   , MINUTE(CURRENT TIMESTAMP - IN_TRBL_TMST)     25920000
259300                   , DATE(CURRENT TIMESTAMP)                      25930000
259400                   , TIME(CURRENT TIMESTAMP)                      25940000
259500                   , DATE(IN_TRBL_TMST)                           25950000
259600                   , TIME(IN_TRBL_TMST)                           25960000
259700                INTO :RECEIV-IN-TRBL-TMST                         25970000
259800                   , :PV-DB2-DAYS                                 25980000
259900                   , :PV-DB2-HOURS                                25990000
260000                   , :PV-DB2-MINUTES                              26000000
260100                   , :PV-CURRENT-DATE                             26010000
260200                   , :PV-CURRENT-TIME                             26020000
260300                   , :PV-IN-TRBL-DATE                             26030000
260400                   , :PV-IN-TRBL-TIME                             26040000
260500                FROM TRECEIV                                      26050000
260600               WHERE ORD_NBR        = :TM500-PO-NBR               26060015
260700                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          26070015
260800                 AND VER_STATUS_CDE = :PC-ACTIVE                  26080000
260900         END-EXEC                                                 26090000
261000                                                                  26100000
261100         EVALUATE TRUE                                            26110000
261200             WHEN SQLCODE = +0                                    26120000
261300                  CONTINUE                                        26130000
261400                                                                  26140000
261500             WHEN SQLCODE = -904                                  26150000
261600             WHEN SQLCODE = -911                                  26160000
261700             WHEN SQLCODE = -913                                  26170000
261800                  CONTINUE                                        26180000
261900                                                                  26190000
262000             WHEN OTHER                                           26200000
262100               SET  PS-DONE TO TRUE                               26210008
262200               DISPLAY '**************************************'   26220008
262300               DISPLAY '**    UNSUCCESSFUL SELECT           **'   26230008
262400               DISPLAY '**************************************'   26240008
262500               DISPLAY '** ABEND                            **'   26250008
262600               DISPLAY '** PROGRAM = TMKUP521               **'   26260014
262700               DISPLAY '** PARA = 2721A-GET-IN-TRBL-TMST-NO-OPER' 26270008
262800               DISPLAY '** DB2 OPER  = SELECT TRECEIV       **'   26280008
262900               DISPLAY '** ORD_NBR        = ' TM500-PO-NBR        26290015
263000               DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR   26300015
263100               DISPLAY '** VER_STATUS_CDE = ' PC-ACTIVE           26310008
263200               DISPLAY '**************************************'   26320008
263400         END-EVALUATE                                             26340000
263500     END-PERFORM.                                                 26350000
263600                                                                  26360000
263700     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         26370000
263800         SET PS-DONE  TO TRUE                                     26380000
263900         DISPLAY '**************************************'         26390008
264000         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         26400008
264100         DISPLAY '**************************************'         26410008
264200         DISPLAY '** ABEND                            **'         26420008
264300         DISPLAY '** PROGRAM = TMKUP521               **'         26430014
264400         DISPLAY '** PARA = 2721A-GET-IN-TRBL-TMST-NO-OPER'       26440008
264500         DISPLAY '** DB2 OPER  = SELECT TRECEIV       **'         26450008
264600         DISPLAY '** ORD_NBR        = ' TM500-PO-NBR              26460015
264700         DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR         26470015
264800         DISPLAY '** VER_STATUS_CDE = ' PC-ACTIVE                 26480008
264900         DISPLAY '**************************************'         26490008
265100     END-IF.                                                      26510000
265200                                                                  26520000
265300******************************************************************26530009
265400**                                                              **26540009
265500******************************************************************26550009
265600 2722-CALC-LGTH-OF-TRBL.                                          26560000
265700                                                                  26570000
265800     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56               26580000
265900     SET DPG51-ACTUAL-CALENDAR-ONLY                               26590000
266000                                      TO TRUE                     26600000
266100                                                                  26610000
266200     MOVE PV-CURRENT-DATE             TO DPG52-LK-DATE-INPUT      26620000
266300     SET DPG52-LK-DTE-ISO-FMT         TO TRUE                     26630000
266400                                                                  26640000
266500     MOVE PV-IN-TRBL-DATE             TO DPG53-LK-CMPR-DATE-INPUT 26650000
266600     SET DPG53-LK-CMPR-DTE-ISO-FMT    TO TRUE                     26660000
266700                                                                  26670000
266800     CALL DP500-KOHLS-CALENDAR-ROUTINE                            26680000
266900                          USING DPG51 DPG52 DPG53                 26690000
267000                                DPG54 DPG55 DPG56                 26700000
267100                                                                  26710000
267200     EVALUATE TRUE                                                26720000
267300         WHEN DPG54-NO-ERROR                                      26730000
267400             MOVE DPG55-BUS-DAYS-DIFFERENCE                       26740000
267500                                      TO PV-DB2-DAYS              26750000
267600     END-EVALUATE                                                 26760000
267700                                                                  26770000
267800* AN ADJUSTMENT MUST BE MADE TO THE NUMBER OF DAYS BECAUSE THE    26780000
267900* CALENDAR ROUTINE COUNTS A DAY AS A DAY REGARDLESS OF THE HOUR   26790000
268000* OF THE DAY.  SO IF THE IN-TRBL DATE/TIME IS 06-30-1999 / 1300   26800000
268100* AND THE CURRENT DATE/TIME IS 07-01-99 / 1400, THE RESULT WOULD  26810000
268200* BE 1 DAY 25 HOURS IF WE DIDN'T ADJUST IT BY 1 DAY.              26820000
268300                                                                  26830000
268400     IF PV-DB2-DAYS > ZERO                                        26840000
268500         COMPUTE PV-DB2-HOURS = PV-DB2-HOURS + (PV-DB2-DAYS * 24) 26850000
268600             IF PV-IN-TRBL-TIME > PV-CURRENT-TIME                 26860000
268700                 SUBTRACT 24 FROM PV-DB2-HOURS                    26870000
268800             END-IF                                               26880000
268900     END-IF                                                       26890000
269000                                                                  26900000
269100     MOVE PV-DB2-HOURS                TO RECEIV-IN-TRBL-HOUR-CNT  26910000
269200     MOVE PV-DB2-MINUTES              TO RECEIV-IN-TRBL-MIN-CNT.  26920000
269300                                                                  26930000
269400     IF RECEIV-IN-TRBL-HOUR-CNT < ZERO OR                         26940000
269500         RECEIV-IN-TRBL-MIN-CNT < ZERO                            26950000
269600         MOVE PV-IN-TRBL-DATE         TO PV-MSG-FROM-DATE         26960000
269700         MOVE PV-IN-TRBL-TIME         TO PV-MSG-FROM-TIME         26970000
269800         MOVE PV-CURRENT-DATE         TO PV-MSG-TO-DATE           26980000
269900         MOVE PV-CURRENT-TIME         TO PV-MSG-TO-TIME           26990000
270000         DISPLAY '*----------------------------------*'           27000001
270100         DISPLAY '   RECEIV IN TRBL HOUR COUNT -OR- '             27010001
270200         DISPLAY '   RECEIV IN TRBL MIN COUNT < 0'                27020001
270300         DISPLAY '   PV-IN-TRBL-DATE ' PV-IN-TRBL-DATE            27030001
270400         DISPLAY '   PV-IN-TRBL-TIME ' PV-IN-TRBL-TIME            27040001
270500         DISPLAY '*----------------------------------*'           27050001
270600     END-IF.                                                      27060000
270700                                                                  27070000
270800******************************************************************27080001
270900**                                                                27090001
271000******************************************************************27100001
271100 2723-UPDATE-TRECEIV.                                             27110000
271200                                                                  27120000
271300     MOVE '2723-UPDATE-TRECEIV'       TO TM007-RETURNED-PARA      27130029
271500                                                                  27150000
271600     PERFORM WITH TEST AFTER                                      27160000
271700         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    27170000
271800         UNTIL   SQLCODE = +0 OR                                  27180000
271900                 PS-DONE OR                                       27190000
272000                 PV-RETRY-COUNTER > PC-MAX-RETRIES                27200000
272100                                                                  27210000
272200         EXEC SQL                                                 27220000
272300              UPDATE TRECEIV                                      27230000
272400                 SET IN_TRBL_TMST     = :PC-DEFAULT-TMST          27240000
272500                   , IN_TRBL_MIN_CNT  = :RECEIV-IN-TRBL-MIN-CNT   27250000
272600                   , IN_TRBL_HOUR_CNT = :RECEIV-IN-TRBL-HOUR-CNT  27260000
272700               WHERE OPER_UNT_ID    = :TM500-OPER-UNT-ID          27270015
272800                 AND FCLTY_ID       = :TM500-FCLTY-ID             27280015
272900                 AND ORD_NBR        = :TM500-PO-NBR               27290015
273000                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          27300015
273100                 AND VER_STATUS_CDE = :PC-ACTIVE                  27310000
273200         END-EXEC                                                 27320000
273300                                                                  27330000
273400         EVALUATE TRUE                                            27340000
273500             WHEN SQLCODE = +0                                    27350000
273600                  CONTINUE                                        27360000
273700                                                                  27370000
273800             WHEN SQLCODE = -904                                  27380000
273900             WHEN SQLCODE = -911                                  27390000
274000             WHEN SQLCODE = -913                                  27400000
274100                  CONTINUE                                        27410000
274200                                                                  27420000
274300             WHEN OTHER                                           27430000
274400               SET  PS-DONE TO TRUE                               27440008
274500               DISPLAY '**************************************'   27450008
274600               DISPLAY '**    UNSUCCESSFUL UPDATE           **'   27460008
274700               DISPLAY '**************************************'   27470008
274800               DISPLAY '** ABEND                            **'   27480008
274900               DISPLAY '** PROGRAM = TMKUP521               **'   27490014
275000               DISPLAY '** PARA = 2723-UPDATE-TRECEIV'            27500008
275100               DISPLAY '** DB2 OPER  = UPDATE TRECEIV       **'   27510008
275200               DISPLAY '** OPER_UNT_ID    = ' TM500-OPER-UNT-ID   27520015
275300               DISPLAY '** FCLTY_ID       = ' TM500-FCLTY-ID      27530015
275400               DISPLAY '** ORD_NBR        = ' TM500-PO-NBR        27540015
275500               DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR   27550015
275600               DISPLAY '** VER_STATUS_CDE = ' PC-ACTIVE           27560008
275700               DISPLAY '**************************************'   27570008
275900         END-EVALUATE                                             27590000
276000     END-PERFORM.                                                 27600000
276100                                                                  27610000
276200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         27620000
276300         SET  PS-DONE TO TRUE                                     27630000
276400         DISPLAY '**************************************'         27640008
276500         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         27650008
276600         DISPLAY '**************************************'         27660008
276700         DISPLAY '** ABEND                            **'         27670008
276800         DISPLAY '** PROGRAM = TMKUP521               **'         27680014
276900         DISPLAY '** PARA = 2723-UPDATE-TRECEIV'                  27690008
277000         DISPLAY '** DB2 OPER  = UPDATE TRECEIV       **'         27700008
277100         DISPLAY '** OPER_UNT_ID    = ' TM500-OPER-UNT-ID         27710015
277200         DISPLAY '** FCLTY_ID       = ' TM500-FCLTY-ID            27720015
277300         DISPLAY '** ORD_NBR        = ' TM500-PO-NBR              27730015
277400         DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR         27740015
277500         DISPLAY '** VER_STATUS_CDE = ' PC-ACTIVE                 27750008
277600         DISPLAY '**************************************'         27760008
277800     END-IF.                                                      27780000
277900                                                                  27790000
278000******************************************************************27800008
278100**                                                              **27810008
278200******************************************************************27820008
278300 2724-UPDATE-TRECEIV-NO-OPER.                                     27830000
278400                                                                  27840000
278500     MOVE '2724-UPDATE-TRECEIV-NO-OPER'  TO TM007-RETURNED-PARA.  27850029
278700                                                                  27870000
278800     PERFORM WITH TEST AFTER                                      27880000
278900         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    27890000
279000         UNTIL   SQLCODE = +0 OR                                  27900000
279100                 PS-DONE OR                                       27910000
279200                 PV-RETRY-COUNTER > PC-MAX-RETRIES                27920000
279300                                                                  27930000
279400         EXEC SQL                                                 27940000
279500              UPDATE TRECEIV                                      27950000
279600                 SET IN_TRBL_TMST     = :PC-DEFAULT-TMST          27960000
279700                   , IN_TRBL_MIN_CNT  = :RECEIV-IN-TRBL-MIN-CNT   27970000
279800                   , IN_TRBL_HOUR_CNT = :RECEIV-IN-TRBL-HOUR-CNT  27980000
279900               WHERE ORD_NBR        = :TM500-PO-NBR               27990015
280000                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          28000015
280100                 AND VER_STATUS_CDE = :PC-ACTIVE                  28010000
280200         END-EXEC                                                 28020000
280300                                                                  28030000
280400         EVALUATE TRUE                                            28040000
280500             WHEN SQLCODE = +0                                    28050000
280600                  CONTINUE                                        28060000
280700                                                                  28070000
280800             WHEN SQLCODE = -904                                  28080000
280900             WHEN SQLCODE = -911                                  28090000
281000             WHEN SQLCODE = -913                                  28100000
281100                  CONTINUE                                        28110000
281200                                                                  28120000
281300             WHEN OTHER                                           28130000
281400               SET  PS-DONE TO TRUE                               28140008
281500               DISPLAY '**************************************'   28150008
281600               DISPLAY '**    UNSUCCESSFUL UPDATE           **'   28160008
281700               DISPLAY '**************************************'   28170008
281800               DISPLAY '** ABEND                            **'   28180008
281900               DISPLAY '** PROGRAM = TMKUP521               **'   28190014
282000               DISPLAY '** PARA = 2724-UPDATE-TRECEIV-NO-OPER'    28200008
282100               DISPLAY '** DB2 OPER  = UPDATE TRECEIV       **'   28210008
282200               DISPLAY '** ORD_NBR        = ' TM500-PO-NBR        28220015
282300               DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR   28230015
282400               DISPLAY '** VER_STATUS_CDE = ' PC-ACTIVE           28240008
282500               DISPLAY '**************************************'   28250008
282700         END-EVALUATE                                             28270000
282800     END-PERFORM.                                                 28280000
282900                                                                  28290000
283000     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         28300000
283100         SET  PS-DONE TO TRUE                                     28310000
283200         DISPLAY '**************************************'         28320008
283300         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         28330008
283400         DISPLAY '**************************************'         28340008
283500         DISPLAY '** ABEND                            **'         28350008
283600         DISPLAY '** PROGRAM = TMKUP521               **'         28360014
283700         DISPLAY '** PARA = 2724-UPDATE-TRECEIV-NO-OPER'          28370008
283800         DISPLAY '** DB2 OPER  = UPDATE TRECEIV       **'         28380008
283900         DISPLAY '** ORD_NBR        = ' TM500-PO-NBR              28390015
284000         DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR         28400015
284100         DISPLAY '** VER_STATUS_CDE = ' PC-ACTIVE                 28410008
284200         DISPLAY '**************************************'         28420008
284400     END-IF.                                                      28440000
284500                                                                  28450000
284600******************************************************************28460008
284700*    THIS PARAGRAPH UPDATES TTRBNTF DEPT-NBR.                     28470008
284800******************************************************************28480008
284900 2800-UPDATE-DEPT-NBR.                                            28490000
285000                                                                  28500000
285100     MOVE '2800-UPDATE-DEPT-NBR'     TO TM007-RETURNED-PARA.      28510029
285300                                                                  28530000
285400     PERFORM WITH TEST AFTER                                      28540000
285500         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    28550000
285600         UNTIL   SQLCODE = +0 OR                                  28560000
285700                 PS-DONE OR                                       28570000
285800                 PV-RETRY-COUNTER > PC-MAX-RETRIES                28580000
285900                                                                  28590000
286000         EXEC SQL                                                 28600000
286100              UPDATE TTRBNTF                                      28610000
286200                 SET DEPT_NBR  = :TRBNTF-DEPT-NBR                 28620000
286300               WHERE NOTIF_NBR = :TRBNTF-NOTIF-NBR                28630000
286400         END-EXEC                                                 28640000
286500                                                                  28650000
286600         EVALUATE TRUE                                            28660000
286700             WHEN SQLCODE = +0                                    28670000
286800                  CONTINUE                                        28680000
286900                                                                  28690000
287000             WHEN SQLCODE = -904                                  28700000
287100             WHEN SQLCODE = -911                                  28710000
287200             WHEN SQLCODE = -913                                  28720000
287300                  CONTINUE                                        28730000
287400                                                                  28740000
287500             WHEN OTHER                                           28750000
287600               SET  PS-DONE TO TRUE                               28760008
287700               DISPLAY '**************************************'   28770008
287800               DISPLAY '**    UNSUCCESSFUL UPDATE           **'   28780008
287900               DISPLAY '**************************************'   28790008
288000               DISPLAY '** ABEND                            **'   28800008
288100               DISPLAY '** PROGRAM = TMKUP521               **'   28810014
288200               DISPLAY '** PARA = 2800-UPDATE-DEPT-NBR'           28820008
288300               DISPLAY '** DB2 OPER  = UPDATE TTRBNTF       **'   28830008
288400               DISPLAY '** NOTIF_NBR      = ' TRBNTF-NOTIF-NBR    28840008
288500               DISPLAY '**************************************'   28850008
288700         END-EVALUATE                                             28870000
288800     END-PERFORM.                                                 28880000
288900                                                                  28890000
289000     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         28900000
289100         SET  PS-DONE TO TRUE                                     28910000
289200         DISPLAY '**************************************'         28920008
289300         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         28930008
289400         DISPLAY '**************************************'         28940008
289500         DISPLAY '** ABEND                            **'         28950008
289600         DISPLAY '** PROGRAM = TMKUP521               **'         28960014
289700         DISPLAY '** PARA = 2800-UPDATE-DEPT-NBR'                 28970008
289800         DISPLAY '** DB2 OPER  = UPDATE TTRBNTF       **'         28980008
289900         DISPLAY '** NOTIF_NBR      = ' TRBNTF-NOTIF-NBR          28990008
290000         DISPLAY '**************************************'         29000008
290200     END-IF.                                                      29020000
290300                                                                  29030000
290400******************************************************************29040008
290500**                                                              **29050008
290600******************************************************************29060008
290700 2900-INSERT-TROUBLE-DETAIL.                                      29070000
290800                                                                  29080000
290900     PERFORM 2910-PREPARE-TTRBDTL.                                29090000
291000                                                                  29100000
291100     IF PS-NOT-DONE                                               29110000
291200         PERFORM 2920-INSERT-TTRBDTL                              29120000
291300     END-IF.                                                      29130000
291400                                                                  29140000
291500     IF PS-NOT-DONE                                               29150000
291600         PERFORM 2930-GET-TRBDTL-CRE-TMST                         29160000
291700     END-IF.                                                      29170000
291800                                                                  29180000
291900     IF PS-NOT-DONE                                               29190000
292000         PERFORM 2940-UPDATE-LAST-DTL-TMST                        29200000
292100     END-IF.                                                      29210000
292200                                                                  29220000
292300******************************************************************29230000
292400*    THIS PARAGRAPH PREPARES THE TTRBDTL FIELDS BEFORE INSERTING  29240000
292500*    THE RECORD.                                                  29250000
292600******************************************************************29260000
292700 2910-PREPARE-TTRBDTL.                                            29270009
292800                                                                  29280000
292900     INITIALIZE DCLTTRBDTL                                        29290000
293000                                                                  29300000
293100     MOVE TM500-NOTIF-NBR         TO TRBDTL-NOTIF-NBR             29310015
293200     MOVE TM500-CRE-UID           TO TRBDTL-CRE-UID               29320015
293300     MOVE TM500-FREEFORM-TEXT TO PV-FREEFORM-TEXT                 29330015
293400     MOVE TM500-FREEFORM-TEXT TO TRBDTL-FREEFORM-TEXT-TEXT        29340015
293500                                                                  29350000
293600     EVALUATE TRUE                                                29360000
293700         WHEN PV-FREEFORM-TEXT-5 > SPACES                         29370000
293800              MOVE PC-250 TO TRBDTL-FREEFORM-TEXT-LEN             29380000
293900         WHEN PV-FREEFORM-TEXT-4 > SPACES                         29390000
294000              MOVE PC-200 TO TRBDTL-FREEFORM-TEXT-LEN             29400000
294100         WHEN PV-FREEFORM-TEXT-3 > SPACES                         29410000
294200              MOVE PC-150 TO TRBDTL-FREEFORM-TEXT-LEN             29420000
294300         WHEN PV-FREEFORM-TEXT-2 > SPACES                         29430000
294400              MOVE PC-100 TO TRBDTL-FREEFORM-TEXT-LEN             29440000
294500         WHEN PV-FREEFORM-TEXT-1 > SPACES                         29450000
294600              MOVE PC-50 TO TRBDTL-FREEFORM-TEXT-LEN              29460000
294700         WHEN OTHER                                               29470000
294800             SET PS-DONE TO TRUE                                  29480000
294900     END-EVALUATE.                                                29490000
295000                                                                  29500000
295100******************************************************************29510008
295200*    THIS PARAGRAPH INSERTS A TTRBDTL RECORD.                     29520008
295300******************************************************************29530008
295400 2920-INSERT-TTRBDTL.                                             29540000
295500                                                                  29550000
295600     MOVE '2920-INSERT-TTRBDTL'    TO TM007-RETURNED-PARA.        29560029
295800                                                                  29580000
295900     PERFORM WITH TEST AFTER                                      29590000
296000         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    29600000
296100         UNTIL   SQLCODE = +0 OR                                  29610000
296200                 PS-DONE OR                                       29620000
296300                 PV-RETRY-COUNTER > PC-MAX-RETRIES                29630000
296400                                                                  29640000
296500         EXEC SQL                                                 29650000
296600              INSERT INTO TTRBDTL                                 29660000
296700                     (NOTIF_NBR                                   29670000
296800                   ,  CRE_TMST                                    29680000
296900                   ,  CRE_UID                                     29690000
297000                   ,  FREEFORM_TEXT)                              29700000
297100              VALUES (:TRBDTL-NOTIF-NBR                           29710000
297200                   ,  CURRENT TIMESTAMP                           29720000
297300                   ,  :TRBDTL-CRE-UID                             29730000
297400                   ,  :TRBDTL-FREEFORM-TEXT)                      29740000
297500         END-EXEC                                                 29750000
297600                                                                  29760000
297700         EVALUATE TRUE                                            29770000
297800             WHEN SQLCODE = +0                                    29780000
297900                  CONTINUE                                        29790000
298000                                                                  29800000
298100             WHEN SQLCODE = -904                                  29810000
298200             WHEN SQLCODE = -911                                  29820000
298300             WHEN SQLCODE = -913                                  29830000
298400                  CONTINUE                                        29840000
298500                                                                  29850000
298600             WHEN OTHER                                           29860000
298700               SET  PS-DONE TO TRUE                               29870008
298800               DISPLAY '**************************************'   29880008
298900               DISPLAY '**    UNSUCCESSFUL INSERT           **'   29890008
299000               DISPLAY '**************************************'   29900008
299100               DISPLAY '** ABEND                            **'   29910008
299200               DISPLAY '** PROGRAM = TMKUP521               **'   29920014
299300               DISPLAY '** PARA = 2920-INSERT-TTRBDTL'            29930008
299400               DISPLAY '** DB2 OPER  = INSERT TTRBDTL       **'   29940008
299500               DISPLAY '** NOTIF_NBR      = ' TRBNTF-NOTIF-NBR    29950008
299600               DISPLAY '**************************************'   29960008
299800         END-EVALUATE                                             29980000
299900     END-PERFORM.                                                 29990000
300000                                                                  30000000
300100     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         30010000
300200         SET  PS-DONE TO TRUE                                     30020000
300300         DISPLAY '**************************************'         30030008
300400         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         30040008
300500         DISPLAY '**************************************'         30050008
300600         DISPLAY '** ABEND                            **'         30060008
300700         DISPLAY '** PROGRAM = TMKUP521               **'         30070014
300800         DISPLAY '** PARA = 2920-INSERT-TTRBDTL'                  30080008
300900         DISPLAY '** DB2 OPER  = INSERT TTRBDTL       **'         30090008
301000         DISPLAY '** NOTIF_NBR      = ' TRBNTF-NOTIF-NBR          30100008
301100         DISPLAY '**************************************'         30110008
301300     END-IF.                                                      30130000
301400                                                                  30140000
301500******************************************************************30150008
301600**                                                              **30160008
301700******************************************************************30170008
301800 2930-GET-TRBDTL-CRE-TMST.                                        30180000
301900                                                                  30190000
302000     MOVE '2930-GET-TRBDTL-CRE-TMST' TO TM007-RETURNED-PARA.      30200029
302200                                                                  30220000
302300     PERFORM WITH TEST AFTER                                      30230000
302400         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    30240000
302500         UNTIL   SQLCODE = +0 OR                                  30250000
302600                 PS-DONE OR                                       30260000
302700                 PV-RETRY-COUNTER > PC-MAX-RETRIES                30270000
302800                                                                  30280000
302900         EXEC SQL                                                 30290000
303000              SELECT MAX(CRE_TMST)                                30300000
303100                INTO :TRBDTL-CRE-TMST                             30310000
303200                FROM TTRBDTL                                      30320000
303300               WHERE NOTIF_NBR = :TRBDTL-NOTIF-NBR                30330000
303400         END-EXEC                                                 30340000
303500                                                                  30350000
303600         EVALUATE TRUE                                            30360000
303700             WHEN SQLCODE = +0                                    30370000
303800                  CONTINUE                                        30380000
303900                                                                  30390000
304000             WHEN SQLCODE = -904                                  30400000
304100             WHEN SQLCODE = -911                                  30410000
304200             WHEN SQLCODE = -913                                  30420000
304300                  CONTINUE                                        30430000
304400                                                                  30440000
304500             WHEN OTHER                                           30450000
304600               SET  PS-DONE TO TRUE                               30460008
304700               DISPLAY '**************************************'   30470008
304800               DISPLAY '**    UNSUCCESSFUL SELECT           **'   30480008
304900               DISPLAY '**************************************'   30490008
305000               DISPLAY '** ABEND                            **'   30500008
305100               DISPLAY '** PROGRAM = TMKUP521               **'   30510014
305200               DISPLAY '** PARA = 2930-GET-TRBDTL-CRE-TMST'       30520008
305300               DISPLAY '** DB2 OPER  = SELECT TTRBDTL       **'   30530008
305400               DISPLAY '** NOTIF_NBR      = ' TRBDTL-NOTIF-NBR    30540008
305500               DISPLAY '**************************************'   30550008
305700         END-EVALUATE                                             30570000
305800     END-PERFORM.                                                 30580000
305900                                                                  30590000
306000     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         30600000
306100         SET  PS-DONE TO TRUE                                     30610000
306200         DISPLAY '**************************************'         30620008
306300         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         30630008
306400         DISPLAY '**************************************'         30640008
306500         DISPLAY '** ABEND                            **'         30650008
306600         DISPLAY '** PROGRAM = TMKUP521               **'         30660014
306700         DISPLAY '** PARA = 2930-GET-TRBDTL-CRE-TMST'             30670008
306800         DISPLAY '** DB2 OPER  = SELECT TTRBDTL       **'         30680008
306900         DISPLAY '** NOTIF_NBR      = ' TRBDTL-NOTIF-NBR          30690008
307000         DISPLAY '**************************************'         30700008
307200     END-IF.                                                      30720000
307300                                                                  30730000
307400******************************************************************30740008
307500*    THIS PARAGRAPH UPDATES TTRBNTF LAST-DTL-CRE-TMST.            30750008
307600******************************************************************30760008
307700 2940-UPDATE-LAST-DTL-TMST.                                       30770000
307800                                                                  30780000
307900     MOVE '2940-UPDATE-LAST-DTL-TMST'  TO TM007-RETURNED-PARA.    30790029
308100                                                                  30810000
308200     MOVE TM500-NOTIF-NBR TO TRBNTF-NOTIF-NBR.                    30820015
308300     MOVE TRBDTL-CRE-TMST TO TRBNTF-LAST-DTL-CRE-TMST.            30830000
308400                                                                  30840000
308500     PERFORM WITH TEST AFTER                                      30850000
308600         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    30860000
308700         UNTIL   SQLCODE = +0 OR                                  30870000
308800                 PS-DONE OR                                       30880000
308900                 PV-RETRY-COUNTER > PC-MAX-RETRIES                30890000
309000                                                                  30900000
309100         EXEC SQL                                                 30910000
309200              UPDATE TTRBNTF                                      30920000
309300                 SET LAST_DTL_CRE_TMST = :TRBNTF-LAST-DTL-CRE-TMST30930000
309400               WHERE NOTIF_NBR         = :TRBNTF-NOTIF-NBR        30940000
309500         END-EXEC                                                 30950000
309600                                                                  30960000
309700         EVALUATE TRUE                                            30970000
309800             WHEN SQLCODE = +0                                    30980000
309900                  CONTINUE                                        30990000
310000                                                                  31000000
310100             WHEN SQLCODE = -904                                  31010000
310200             WHEN SQLCODE = -911                                  31020000
310300             WHEN SQLCODE = -913                                  31030000
310400                  CONTINUE                                        31040000
310500                                                                  31050000
310600             WHEN OTHER                                           31060000
310700               SET  PS-DONE TO TRUE                               31070008
310800               DISPLAY '**************************************'   31080008
310900               DISPLAY '**    UNSUCCESSFUL UPDATE           **'   31090008
311000               DISPLAY '**************************************'   31100008
311100               DISPLAY '** ABEND                            **'   31110008
311200               DISPLAY '** PROGRAM = TMKUP521               **'   31120014
311300               DISPLAY '** PARA = 2940-UPDATE-LAST-DTL-TMST'      31130008
311400               DISPLAY '** DB2 OPER  = UPDATE TTRBNTF       **'   31140008
311500               DISPLAY '** NOTIF_NBR      = ' TRBNTF-NOTIF-NBR    31150008
311600               DISPLAY '**************************************'   31160008
311800         END-EVALUATE                                             31180000
311900     END-PERFORM.                                                 31190000
312000                                                                  31200000
312100     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         31210000
312200         SET  PS-DONE TO TRUE                                     31220000
312300         DISPLAY '**************************************'         31230008
312400         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         31240008
312500         DISPLAY '**************************************'         31250008
312600         DISPLAY '** ABEND                            **'         31260008
312700         DISPLAY '** PROGRAM = TMKUP521               **'         31270014
312800         DISPLAY '** PARA = 2940-UPDATE-LAST-DTL-TMST'            31280008
312900         DISPLAY '** DB2 OPER  = UPDATE TTRBNTF       **'         31290008
313000         DISPLAY '** NOTIF_NBR      = ' TRBNTF-NOTIF-NBR          31300008
313100         DISPLAY '**************************************'         31310008
313300     END-IF.                                                      31330000
313400                                                                  31340000
313500******************************************************************31350000
313600**                                                              **31360008
313700******************************************************************31370000
313800 3000-UPDATE-PO-VER-NBR.                                          31380008
313900                                                                  31390000
314000     IF TM500-RESOLVE-AUTO                                        31400015
314100      OR TM500-RESOLVE-SPECIFIC                                   31410015
314200      OR (TM500-RESOLVE-MANUAL AND                                31420015
314300          TM500-TRBL-RSN-CDE = 263)                               31430015
314400         EVALUATE TRUE                                            31440000
314500             WHEN TM500-PO-LEVEL                                  31450015
314600                  PERFORM 3100-SELECT-TPURCHS                     31460000
314700                                                                  31470000
314800                  IF PS-NOT-DONE                                  31480000
314900                      IF PS-DO-NOT-USE-OPER                       31490000
315000                          PERFORM 3210-UPDATE-TRECEIV-NO-OPER     31500000
315100                      ELSE                                        31510000
315200                          PERFORM 3200-UPDATE-TRECEIV             31520000
315300                      END-IF                                      31530000
315400                  END-IF                                          31540000
315500                                                                  31550000
315600             WHEN TM500-LINE-LEVEL                                31560015
315700                  PERFORM 3300-SELECT-TPURITM                     31570000
315800                                                                  31580000
315900                  IF PS-NOT-DONE                                  31590000
316000                      IF PS-DO-NOT-USE-OPER                       31600000
316100                          PERFORM 3410-UPDATE-TRECITM-NO-OPER     31610000
316200                      ELSE                                        31620000
316300                          PERFORM 3400-UPDATE-TRECITM             31630000
316400                      END-IF                                      31640000
316500                  END-IF                                          31650000
316600                                                                  31660000
316700             WHEN TM500-PACK-LEVEL                                31670015
316800                  PERFORM 3500-PROCESS-TPURITM                    31680000
316900                                                                  31690000
317000             WHEN OTHER                                           31700000
317100                  SET PS-DONE  TO TRUE                            31710000
317200                  MOVE SPACES  TO TM500-SQLCA                     31720015
317300                  MOVE ZEROES  TO TM500-SQLCODE                   31730015
317400                  MOVE PRV-5L  TO TM500-RETURN-DATA               31740015
317500         END-EVALUATE                                             31750000
317600     END-IF.                                                      31760000
317700                                                                  31770000
317800******************************************************************31780000
317900**                                                              **31790009
318000******************************************************************31800009
318100 3100-SELECT-TPURCHS.                                             31810009
318200                                                                  31820000
318300     MOVE '3100-SELECT-TPURCHS'  TO TM007-RETURNED-PARA.          31830029
318500                                                                  31850000
318600     PERFORM WITH TEST AFTER                                      31860000
318700         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    31870000
318800         UNTIL   SQLCODE = +0 OR                                  31880000
318900                 SQLCODE = +100 OR                                31890000
319000                 PS-DONE OR                                       31900000
319100                 PV-RETRY-COUNTER > PC-MAX-RETRIES                31910000
319200                                                                  31920000
319300         EXEC SQL                                                 31930000
319400              SELECT VER_NBR                                      31940000
319500                INTO :PURCHS-VER-NBR                              31950000
319600                FROM TPURCHS                                      31960000
319700               WHERE PO_NBR         = :TM500-PO-NBR               31970015
319800                 AND VER_STATUS_CDE = :PC-A                       31980000
319900         END-EXEC                                                 31990000
320000                                                                  32000000
320100         EVALUATE TRUE                                            32010000
320200             WHEN SQLCODE = +0                                    32020000
320300                  CONTINUE                                        32030000
320400                                                                  32040000
320500             WHEN SQLCODE = +100                                  32050000
320600                  MOVE ZEROES TO PURCHS-VER-NBR                   32060000
320700                                                                  32070000
320800             WHEN SQLCODE = -904                                  32080000
320900             WHEN SQLCODE = -911                                  32090000
321000             WHEN SQLCODE = -913                                  32100000
321100                  CONTINUE                                        32110000
321200                                                                  32120000
321300             WHEN OTHER                                           32130000
321400               SET  PS-DONE TO TRUE                               32140008
321500               DISPLAY '**************************************'   32150008
321600               DISPLAY '**    UNSUCCESSFUL SELECT           **'   32160008
321700               DISPLAY '**************************************'   32170008
321800               DISPLAY '** ABEND                            **'   32180008
321900               DISPLAY '** PROGRAM = TMKUP521               **'   32190014
322000               DISPLAY '** PARA = 3100-SELECT-TPURCHS'            32200008
322100               DISPLAY '** DB2 OPER  = SELECT TPURCHS       **'   32210008
322200               DISPLAY '** PO_NBR         = ' TM500-PO-NBR        32220015
322300               DISPLAY '** VER_STATUS_CDE = ' PC-A                32230008
322400               DISPLAY '**************************************'   32240008
322600         END-EVALUATE                                             32260000
322700     END-PERFORM.                                                 32270000
322800                                                                  32280000
322900     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         32290000
323000         SET  PS-DONE TO TRUE                                     32300000
323100         DISPLAY '**************************************'         32310008
323200         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         32320008
323300         DISPLAY '**************************************'         32330008
323400         DISPLAY '** ABEND                            **'         32340008
323500         DISPLAY '** PROGRAM = TMKUP521               **'         32350014
323600         DISPLAY '** PARA = 3100-SELECT-TPURCHS'                  32360008
323700         DISPLAY '** DB2 OPER  = SELECT TPURCHS       **'         32370008
323800         DISPLAY '** PO_NBR         = ' TM500-PO-NBR              32380015
323900         DISPLAY '** VER_STATUS_CDE = ' PC-A                      32390008
324000         DISPLAY '**************************************'         32400008
324200     END-IF.                                                      32420000
324300                                                                  32430000
324400******************************************************************32440008
324500**                                                              **32450008
324600******************************************************************32460008
324700 3200-UPDATE-TRECEIV.                                             32470000
324800                                                                  32480000
324900     MOVE '3200-UPDATE-TRECEIV'     TO TM007-RETURNED-PARA.       32490029
325100                                                                  32510000
325200     PERFORM WITH TEST AFTER                                      32520000
325300         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    32530000
325400         UNTIL   SQLCODE = +0 OR                                  32540000
325500                 PS-DONE OR                                       32550000
325600                 PV-RETRY-COUNTER > PC-MAX-RETRIES                32560000
325700                                                                  32570000
325800         EXEC SQL                                                 32580000
325900              UPDATE TRECEIV                                      32590000
326000                 SET PO_VER_NBR     = :PURCHS-VER-NBR             32600000
326100               WHERE OPER_UNT_ID    = :TM500-OPER-UNT-ID          32610015
326200                 AND FCLTY_ID       = :TM500-FCLTY-ID             32620015
326300                 AND ORD_NBR        = :TM500-PO-NBR               32630015
326400                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          32640015
326500                 AND VER_STATUS_CDE = :PC-A                       32650000
326600         END-EXEC                                                 32660000
326700                                                                  32670000
326800         EVALUATE TRUE                                            32680000
326900             WHEN SQLCODE = +0                                    32690000
327000                  CONTINUE                                        32700000
327100                                                                  32710000
327200             WHEN SQLCODE = -904                                  32720000
327300             WHEN SQLCODE = -911                                  32730000
327400             WHEN SQLCODE = -913                                  32740000
327500                  CONTINUE                                        32750000
327600                                                                  32760000
327700             WHEN OTHER                                           32770000
327800               SET  PS-DONE TO TRUE                               32780008
327900               DISPLAY '**************************************'   32790008
328000               DISPLAY '**    UNSUCCESSFUL UPDATE           **'   32800008
328100               DISPLAY '**************************************'   32810008
328200               DISPLAY '** ABEND                            **'   32820008
328300               DISPLAY '** PROGRAM = TMKUP521               **'   32830014
328400               DISPLAY '** PARA = 3200-UPDATE-TRECEIV'            32840008
328500               DISPLAY '** DB2 OPER  = UPDATE TRECEIV       **'   32850008
328600               DISPLAY '** OPER_UNT_ID    = ' TM500-OPER-UNT-ID   32860015
328700               DISPLAY '** FCLTY_ID       = ' TM500-FCLTY-ID      32870015
328800               DISPLAY '** ORD_NBR        = ' TM500-PO-NBR        32880015
328900               DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR   32890015
329000               DISPLAY '** VER_STATUS_CDE = ' PC-A                32900008
329100               DISPLAY '**************************************'   32910008
329300         END-EVALUATE                                             32930000
329400     END-PERFORM.                                                 32940000
329500                                                                  32950000
329600     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         32960000
329700         SET  PS-DONE TO TRUE                                     32970000
329800         DISPLAY '**************************************'         32980008
329900         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         32990008
330000         DISPLAY '**************************************'         33000008
330100         DISPLAY '** ABEND                            **'         33010008
330200         DISPLAY '** PROGRAM = TMKUP521               **'         33020014
330300         DISPLAY '** PARA = 3200-UPDATE-TRECEIV'                  33030008
330400         DISPLAY '** DB2 OPER  = UPDATE TRECEIV       **'         33040008
330500         DISPLAY '** OPER_UNT_ID    = ' TM500-OPER-UNT-ID         33050015
330600         DISPLAY '** FCLTY_ID       = ' TM500-FCLTY-ID            33060015
330700         DISPLAY '** ORD_NBR        = ' TM500-PO-NBR              33070015
330800         DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR         33080015
330900         DISPLAY '** VER_STATUS_CDE = ' PC-A                      33090008
331000         DISPLAY '**************************************'         33100008
331200     END-IF.                                                      33120000
331300                                                                  33130000
331400******************************************************************33140000
331500**                                                              **33150008
331600******************************************************************33160008
331700 3210-UPDATE-TRECEIV-NO-OPER.                                     33170008
331800                                                                  33180000
331900     MOVE '3210-UPDATE-TRECEIV-NO-OPER'                           33190004
332000                            TO TM007-RETURNED-PARA.               33200029
332200                                                                  33220000
332300     PERFORM WITH TEST AFTER                                      33230000
332400         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    33240000
332500         UNTIL   SQLCODE = +0 OR                                  33250000
332600                 PS-DONE OR                                       33260000
332700                 PV-RETRY-COUNTER > PC-MAX-RETRIES                33270000
332800                                                                  33280000
332900         EXEC SQL                                                 33290000
333000              UPDATE TRECEIV                                      33300000
333100                 SET PO_VER_NBR     = :PURCHS-VER-NBR             33310000
333200               WHERE ORD_NBR        = :TM500-PO-NBR               33320015
333300                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          33330015
333400                 AND VER_STATUS_CDE = :PC-A                       33340000
333500         END-EXEC                                                 33350000
333600                                                                  33360000
333700         EVALUATE TRUE                                            33370000
333800             WHEN SQLCODE = +0                                    33380000
333900                  CONTINUE                                        33390000
334000                                                                  33400000
334100             WHEN SQLCODE = -904                                  33410000
334200             WHEN SQLCODE = -911                                  33420000
334300             WHEN SQLCODE = -913                                  33430000
334400                  CONTINUE                                        33440000
334500                                                                  33450000
334600             WHEN OTHER                                           33460000
334700               SET  PS-DONE TO TRUE                               33470008
334800               DISPLAY '**************************************'   33480008
334900               DISPLAY '**    UNSUCCESSFUL UPDATE           **'   33490008
335000               DISPLAY '**************************************'   33500008
335100               DISPLAY '** ABEND                            **'   33510008
335200               DISPLAY '** PROGRAM = TMKUP521               **'   33520014
335300               DISPLAY '** PARA = 3210-UPDATE-TRECEIV-NO-OPER'    33530008
335400               DISPLAY '** DB2 OPER  = UPDATE TRECEIV       **'   33540008
335500               DISPLAY '** ORD_NBR        = ' TM500-PO-NBR        33550015
335600               DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR   33560015
335700               DISPLAY '** VER_STATUS_CDE = ' PC-A                33570008
335800               DISPLAY '**************************************'   33580008
336000         END-EVALUATE                                             33600000
336100     END-PERFORM.                                                 33610000
336200                                                                  33620000
336300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         33630000
336400         SET  PS-DONE TO TRUE                                     33640008
336500         DISPLAY '**************************************'         33650008
336600         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         33660008
336700         DISPLAY '**************************************'         33670008
336800         DISPLAY '** ABEND                            **'         33680008
336900         DISPLAY '** PROGRAM = TMKUP521               **'         33690014
337000         DISPLAY '** PARA = 3210-UPDATE-TRECEIV-NO-OPER'          33700008
337100         DISPLAY '** DB2 OPER  = UPDATE TRECEIV       **'         33710008
337200         DISPLAY '** ORD_NBR        = ' TM500-PO-NBR              33720015
337300         DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR         33730015
337400         DISPLAY '** VER_STATUS_CDE = ' PC-A                      33740008
337500         DISPLAY '**************************************'         33750008
337700     END-IF.                                                      33770000
337800                                                                  33780000
337900******************************************************************33790000
338000**                                                              **33800008
338100******************************************************************33810000
338200 3300-SELECT-TPURITM.                                             33820008
338300                                                                  33830000
338400     MOVE '3300-SELECT-TPURITM'        TO TM007-RETURNED-PARA.    33840029
338600                                                                  33860000
338700     PERFORM WITH TEST AFTER                                      33870000
338800         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    33880000
338900         UNTIL   SQLCODE = +0 OR                                  33890000
339000                 SQLCODE = +100 OR                                33900000
339100                 PS-DONE OR                                       33910000
339200                 PV-RETRY-COUNTER > PC-MAX-RETRIES                33920000
339300                                                                  33930000
339400         EXEC SQL                                                 33940000
339500              SELECT VER_NBR                                      33950000
339600                INTO :PURITM-VER-NBR                              33960000
339700                FROM TPURITM                                      33970000
339800               WHERE PO_NBR         = :TM500-PO-NBR               33980015
339900                 AND APP_PO_LNE_NBR = :TM500-PO-LNE-NBR           33990015
340000                 AND VER_STATUS_CDE = :PC-A                       34000000
340100         END-EXEC                                                 34010000
340200                                                                  34020000
340300         EVALUATE TRUE                                            34030000
340400             WHEN SQLCODE = +0                                    34040000
340500                  CONTINUE                                        34050000
340600                                                                  34060000
340700             WHEN SQLCODE = +100                                  34070000
340800                  MOVE ZEROES TO PURITM-VER-NBR                   34080000
340900                                                                  34090000
341000             WHEN SQLCODE = -904                                  34100000
341100             WHEN SQLCODE = -911                                  34110000
341200             WHEN SQLCODE = -913                                  34120000
341300                  CONTINUE                                        34130000
341400                                                                  34140000
341500             WHEN OTHER                                           34150000
341600               SET  PS-DONE TO TRUE                               34160008
341700               DISPLAY '**************************************'   34170008
341800               DISPLAY '**    UNSUCCESSFUL SELECT           **'   34180008
341900               DISPLAY '**************************************'   34190008
342000               DISPLAY '** ABEND                            **'   34200008
342100               DISPLAY '** PROGRAM = TMKUP521               **'   34210014
342200               DISPLAY '** PARA = 3300-SELECT-TPURITM'            34220008
342300               DISPLAY '** DB2 OPER  = SELECT TPURITM       **'   34230008
342400               DISPLAY '** PO_NBR         = ' TM500-PO-NBR        34240015
342500               DISPLAY '** APP_PO_LNE_NBR = ' TM500-PO-LNE-NBR    34250015
342600               DISPLAY '** VER_STATUS_CDE = ' PC-A                34260008
342700               DISPLAY '**************************************'   34270008
342900         END-EVALUATE                                             34290000
343000     END-PERFORM.                                                 34300000
343100                                                                  34310000
343200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         34320000
343300         SET  PS-DONE TO TRUE                                     34330000
343400         DISPLAY '**************************************'         34340008
343500         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         34350008
343600         DISPLAY '**************************************'         34360008
343700         DISPLAY '** ABEND                            **'         34370008
343800         DISPLAY '** PROGRAM = TMKUP521               **'         34380014
343900         DISPLAY '** PARA = 3300-SELECT-TPURITM'                  34390008
344000         DISPLAY '** DB2 OPER  = SELECT TPURITM       **'         34400008
344100         DISPLAY '** PO_NBR         = ' TM500-PO-NBR              34410015
344200         DISPLAY '** APP_PO_LNE_NBR = ' TM500-PO-LNE-NBR          34420015
344300         DISPLAY '** VER_STATUS_CDE = ' PC-A                      34430008
344400         DISPLAY '**************************************'         34440008
344600     END-IF.                                                      34460000
344700                                                                  34470000
344800******************************************************************34480000
344900**                                                              **34490008
345000******************************************************************34500008
345100 3400-UPDATE-TRECITM.                                             34510008
345200                                                                  34520000
345300     MOVE '3400-UPDATE-TRECITM'      TO TM007-RETURNED-PARA.      34530029
345500                                                                  34550000
345600     PERFORM WITH TEST AFTER                                      34560000
345700         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    34570000
345800         UNTIL   SQLCODE = +0 OR                                  34580000
345900                 PS-DONE OR                                       34590000
346000                 PV-RETRY-COUNTER > PC-MAX-RETRIES                34600000
346100                                                                  34610000
346200         EXEC SQL                                                 34620000
346300              UPDATE TRECITM                                      34630000
346400                 SET PO_VER_NBR     = :PURITM-VER-NBR             34640000
346500               WHERE OPER_UNT_ID    = :TM500-OPER-UNT-ID          34650015
346600                 AND FCLTY_ID       = :TM500-FCLTY-ID             34660015
346700                 AND ORD_NBR        = :TM500-PO-NBR               34670015
346800                 AND ORD_LNE_NBR    = :TM500-PO-LNE-NBR           34680015
346900                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          34690015
347000                 AND VER_STATUS_CDE = :PC-A                       34700000
347100         END-EXEC                                                 34710000
347200                                                                  34720000
347300         EVALUATE TRUE                                            34730000
347400             WHEN SQLCODE = +0                                    34740000
347500                  CONTINUE                                        34750000
347600                                                                  34760000
347700             WHEN SQLCODE = -904                                  34770000
347800             WHEN SQLCODE = -911                                  34780000
347900             WHEN SQLCODE = -913                                  34790000
348000                  CONTINUE                                        34800000
348100                                                                  34810000
348200             WHEN OTHER                                           34820000
348300               SET  PS-DONE TO TRUE                               34830008
348400               DISPLAY '**************************************'   34840008
348500               DISPLAY '**    UNSUCCESSFUL UPDATE           **'   34850008
348600               DISPLAY '**************************************'   34860008
348700               DISPLAY '** ABEND                            **'   34870008
348800               DISPLAY '** PROGRAM = TMKUP521               **'   34880014
348900               DISPLAY '** PARA = 3400-UPDATE-TRECITM'            34890008
349000               DISPLAY '** DB2 OPER  = UPDATE TRECITM       **'   34900008
349100               DISPLAY '** OPER_UNT_ID    = ' TM500-OPER-UNT-ID   34910015
349200               DISPLAY '** FCLTY_ID       = ' TM500-FCLTY-ID      34920015
349300               DISPLAY '** ORD_NBR        = ' TM500-PO-NBR        34930015
349400               DISPLAY '** ORD_LNE_NBR    = ' TM500-PO-LNE-NBR    34940015
349500               DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR   34950015
349600               DISPLAY '** VER_STATUS_CDE = ' PC-A                34960008
349700               DISPLAY '**************************************'   34970008
349900         END-EVALUATE                                             34990000
350000     END-PERFORM.                                                 35000000
350100                                                                  35010000
350200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         35020000
350300         SET  PS-DONE TO TRUE                                     35030000
350400         DISPLAY '**************************************'         35040008
350500         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         35050008
350600         DISPLAY '**************************************'         35060008
350700         DISPLAY '** ABEND                            **'         35070008
350800         DISPLAY '** PROGRAM = TMKUP521               **'         35080014
350900         DISPLAY '** PARA = 3400-UPDATE-TRECITM'                  35090008
351000         DISPLAY '** DB2 OPER  = UPDATE TRECITM       **'         35100008
351100         DISPLAY '** OPER_UNT_ID    = ' TM500-OPER-UNT-ID         35110015
351200         DISPLAY '** FCLTY_ID       = ' TM500-FCLTY-ID            35120015
351300         DISPLAY '** ORD_NBR        = ' TM500-PO-NBR              35130015
351400         DISPLAY '** ORD_LNE_NBR    = ' TM500-PO-LNE-NBR          35140015
351500         DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR         35150015
351600         DISPLAY '** VER_STATUS_CDE = ' PC-A                      35160008
351700         DISPLAY '**************************************'         35170008
351900     END-IF.                                                      35190000
352000                                                                  35200000
352100******************************************************************35210000
352200**                                                              **35220008
352300******************************************************************35230008
352400 3410-UPDATE-TRECITM-NO-OPER.                                     35240008
352500                                                                  35250000
352600     MOVE '3410-UPDATE-TRECITM-NO-OPER'  TO TM007-RETURNED-PARA.  35260029
352800                                                                  35280000
352900     PERFORM WITH TEST AFTER                                      35290000
353000         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    35300000
353100         UNTIL   SQLCODE = +0 OR                                  35310000
353200                 PS-DONE OR                                       35320000
353300                 PV-RETRY-COUNTER > PC-MAX-RETRIES                35330000
353400                                                                  35340000
353500         EXEC SQL                                                 35350000
353600              UPDATE TRECITM                                      35360000
353700                 SET PO_VER_NBR     = :PURITM-VER-NBR             35370000
353800               WHERE ORD_NBR        = :TM500-PO-NBR               35380015
353900                 AND ORD_LNE_NBR    = :TM500-PO-LNE-NBR           35390015
354000                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          35400015
354100                 AND VER_STATUS_CDE = :PC-A                       35410000
354200         END-EXEC                                                 35420000
354300                                                                  35430000
354400         EVALUATE TRUE                                            35440000
354500             WHEN SQLCODE = +0                                    35450000
354600                  CONTINUE                                        35460000
354700                                                                  35470000
354800             WHEN SQLCODE = -904                                  35480000
354900             WHEN SQLCODE = -911                                  35490000
355000             WHEN SQLCODE = -913                                  35500000
355100                  CONTINUE                                        35510000
355200                                                                  35520000
355300             WHEN OTHER                                           35530000
355400               SET  PS-DONE TO TRUE                               35540008
355500               DISPLAY '**************************************'   35550008
355600               DISPLAY '**    UNSUCCESSFUL UPDATE           **'   35560008
355700               DISPLAY '**************************************'   35570008
355800               DISPLAY '** ABEND                            **'   35580008
355900               DISPLAY '** PROGRAM = TMKUP521               **'   35590014
356000               DISPLAY '** PARA = 3410-UPDATE-TRECITM-NO-OPER'    35600008
356100               DISPLAY '** DB2 OPER  = UPDATE TRECITM       **'   35610008
356200               DISPLAY '** ORD_NBR        = ' TM500-PO-NBR        35620015
356300               DISPLAY '** ORD_LNE_NBR    = ' TM500-PO-LNE-NBR    35630015
356400               DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR   35640015
356500               DISPLAY '** VER_STATUS_CDE = ' PC-A                35650008
356600               DISPLAY '**************************************'   35660008
356800         END-EVALUATE                                             35680000
356900     END-PERFORM.                                                 35690000
357000                                                                  35700000
357100     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         35710000
357200         SET  PS-DONE TO TRUE                                     35720000
357300         DISPLAY '**************************************'         35730008
357400         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         35740008
357500         DISPLAY '**************************************'         35750008
357600         DISPLAY '** ABEND                            **'         35760008
357700         DISPLAY '** PROGRAM = TMKUP521               **'         35770014
357800         DISPLAY '** PARA = 3410-UPDATE-TRECITM-NO-OPER'          35780008
357900         DISPLAY '** DB2 OPER  = UPDATE TRECITM       **'         35790008
358000         DISPLAY '** ORD_NBR        = ' TM500-PO-NBR              35800015
358100         DISPLAY '** ORD_LNE_NBR    = ' TM500-PO-LNE-NBR          35810015
358200         DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR         35820015
358300         DISPLAY '** VER_STATUS_CDE = ' PC-A                      35830008
358400         DISPLAY '**************************************'         35840008
358600     END-IF.                                                      35860000
358700                                                                  35870000
358800*JPL                                                              35880000
358900******************************************************************35890009
359000**                                                              **35900009
359100******************************************************************35910009
359200 3500-PROCESS-TPURITM.                                            35920000
359300                                                                  35930000
359400     SET PS-PACK-LVL-UPD-NOT-DONE TO TRUE                         35940000
359500     IF PS-DO-NOT-USE-OPER                                        35950000
359600         PERFORM 3515-OPEN-RECITM-CSR-NO-OPER                     35960000
359700                                                                  35970000
359800         PERFORM 3523-FETCH-RECITM-CSR-NO-OPER                    35980000
359900           UNTIL PS-PACK-LVL-UPD-DONE                             35990000
360000                                                                  36000000
360100         PERFORM 3535-CLOSE-RECITM-CSR-NO-OPER                    36010000
360200     ELSE                                                         36020000
360300         PERFORM 3510-OPEN-RECITM-CSR                             36030000
360400                                                                  36040000
360500         PERFORM 3520-FETCH-RECITM-CSR                            36050000
360600           UNTIL PS-PACK-LVL-UPD-DONE                             36060000
360700                                                                  36070000
360800         PERFORM 3530-CLOSE-RECITM-CSR                            36080000
360900     END-IF.                                                      36090000
361000                                                                  36100000
361100******************************************************************36110000
361200*  THIS PARAGRAPH OPENS THE CURSOR FOR TABLE RECITM.              36120000
361300******************************************************************36130000
361400 3510-OPEN-RECITM-CSR.                                            36140000
361500                                                                  36150000
361600     MOVE '3510-OPEN-RECITM-CSR'       TO TM007-RETURNED-PARA.    36160029
361800                                                                  36180000
361900     EXEC SQL                                                     36190000
362000         OPEN RECITM-LINE-CSR                                     36200000
362100     END-EXEC.                                                    36210000
362200                                                                  36220000
362300     IF SQLCODE NOT = +0                                          36230000
362400         SET PS-PACK-LVL-UPD-DONE TO TRUE                         36240000
362500         SET PS-DONE              TO TRUE                         36250000
362600         DISPLAY '**************************************'         36260008
362700         DISPLAY '**    UNSUCCESSFUL OPEN OF CURSOR   **'         36270008
362800         DISPLAY '**************************************'         36280008
362900         DISPLAY '** ABEND                            **'         36290008
363000         DISPLAY '** PROGRAM = TMKUP521               **'         36300014
363100         DISPLAY '** PARA = 3510-OPEN-RECITM-CSR'                 36310008
363200         DISPLAY '** DB2 OPER  = OPEN CURSOR          **'         36320008
363300         DISPLAY '**************************************'         36330008
363500     END-IF.                                                      36350000
363600                                                                  36360000
363700******************************************************************36370009
363800**                                                              **36380009
363900******************************************************************36390009
364000 3515-OPEN-RECITM-CSR-NO-OPER.                                    36400000
364100                                                                  36410000
364200     MOVE '3515-OPEN-RECITM-CSR-NO-OPER'                          36420004
364300                              TO TM007-RETURNED-PARA.             36430029
364500                                                                  36450000
364600     EXEC SQL                                                     36460000
364700         OPEN RECITM-LN-NOOP-CSR                                  36470000
364800     END-EXEC.                                                    36480000
364900                                                                  36490000
365000     IF SQLCODE NOT = +0                                          36500000
365100         SET PS-PACK-LVL-UPD-DONE TO TRUE                         36510000
365200         SET PS-DONE              TO TRUE                         36520000
365300         DISPLAY '**************************************'         36530008
365400         DISPLAY '**    UNSUCCESSFUL OPEN OF CURSOR   **'         36540008
365500         DISPLAY '**************************************'         36550008
365600         DISPLAY '** ABEND                            **'         36560008
365700         DISPLAY '** PROGRAM = TMKUP521               **'         36570014
365800         DISPLAY '** PARA = 3515-OPEN-RECITM-CSR-NO-OPER'         36580008
365900         DISPLAY '** DB2 OPER  = OPEN CURSOR          **'         36590008
366000         DISPLAY '**************************************'         36600008
366200     END-IF.                                                      36620000
366300                                                                  36630000
366400******************************************************************36640000
366500*  THIS PARAGRAPH GETS THE NEXT RECORD FROM TABLE RECITM.         36650000
366600******************************************************************36660000
366700 3520-FETCH-RECITM-CSR.                                           36670000
366800                                                                  36680000
366900     MOVE '3520-FETCH-RECITM-CSR'      TO TM007-RETURNED-PARA.    36690029
367100                                                                  36710000
367200     EXEC SQL                                                     36720000
367300         FETCH RECITM-LINE-CSR                                    36730000
367400          INTO :RECITM-ORD-LNE-NBR                                36740000
367500             , :PURITM-VER-NBR                                    36750000
367600     END-EXEC.                                                    36760000
367700                                                                  36770000
367800     EVALUATE TRUE                                                36780000
367900       WHEN SQLCODE = +0                                          36790000
368000           PERFORM 3525-UPDATE-RECITM-CSR                         36800000
368100                                                                  36810000
368200       WHEN SQLCODE = +100                                        36820000
368300           SET PS-PACK-LVL-UPD-DONE TO TRUE                       36830000
368400                                                                  36840000
368500       WHEN OTHER                                                 36850000
368600           SET PS-PACK-LVL-UPD-DONE TO TRUE                       36860000
368700           SET PS-DONE              TO TRUE                       36870000
368800           DISPLAY '**************************************'       36880008
368900           DISPLAY '**    UNSUCCESSFUL FETCH            **'       36890008
369000           DISPLAY '**************************************'       36900008
369100           DISPLAY '** ABEND                            **'       36910008
369200           DISPLAY '** PROGRAM = TMKUP521               **'       36920014
369300           DISPLAY '** PARA = 3520-FETCH-RECITM-CSR'              36930008
369400           DISPLAY '** DB2 OPER  = FETCH CURSOR         **'       36940008
369500           DISPLAY '**************************************'       36950008
369700     END-EVALUATE.                                                36970000
369800                                                                  36980000
369900******************************************************************36990009
370000**                                                              **37000009
370100******************************************************************37010009
370200 3523-FETCH-RECITM-CSR-NO-OPER.                                   37020000
370300                                                                  37030000
370400     MOVE '3523-FETCH-RECITM-CSR-NO-OPER'  TO TM007-RETURNED-PARA.37040030
370600                                                                  37060000
370700     EXEC SQL                                                     37070000
370800         FETCH RECITM-LN-NOOP-CSR                                 37080000
370900          INTO :RECITM-ORD-LNE-NBR                                37090000
371000             , :PURITM-VER-NBR                                    37100000
371100     END-EXEC.                                                    37110000
371200                                                                  37120000
371300     EVALUATE TRUE                                                37130000
371400       WHEN SQLCODE = +0                                          37140000
371500           PERFORM 3528-UPDATE-RECITM-CSR-NO-OPER                 37150000
371600                                                                  37160000
371700       WHEN SQLCODE = +100                                        37170000
371800           SET PS-PACK-LVL-UPD-DONE TO TRUE                       37180000
371900                                                                  37190000
372000       WHEN OTHER                                                 37200000
372100           SET PS-PACK-LVL-UPD-DONE TO TRUE                       37210000
372200           SET PS-DONE              TO TRUE                       37220000
372300           DISPLAY '**************************************'       37230008
372400           DISPLAY '**    UNSUCCESSFUL FETCH            **'       37240008
372500           DISPLAY '**************************************'       37250008
372600           DISPLAY '** ABEND                            **'       37260008
372700           DISPLAY '** PROGRAM = TMKUP521               **'       37270014
372800           DISPLAY '** PARA = 3523-FETCH-RECITM-CSR-NO-OPER'      37280008
372900           DISPLAY '** DB2 OPER  = FETCH CURSOR         **'       37290008
373000           DISPLAY '**************************************'       37300008
373200     END-EVALUATE.                                                37320000
373300                                                                  37330000
373400******************************************************************37340000
373500*  THIS PARAGRAPH UPDATES THE RECITM RECORD.                      37350000
373600******************************************************************37360000
373700 3525-UPDATE-RECITM-CSR.                                          37370000
373800                                                                  37380000
373900     MOVE '3525-UPDATE-RECITM-CSR'   TO TM007-RETURNED-PARA.      37390029
374100                                                                  37410000
374200     PERFORM WITH TEST AFTER                                      37420000
374300       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       37430000
374400         UNTIL SQLCODE = +0                                       37440000
374500            OR PS-DONE                                            37450000
374600            OR PV-RETRY-COUNTER > PC-MAX-RETRIES                  37460000
374700                                                                  37470000
374800         EXEC SQL                                                 37480000
374900           UPDATE TRECITM                                         37490000
375000              SET PO_VER_NBR      = :PURITM-VER-NBR               37500000
375100            WHERE ORD_NBR         = :TM500-PO-NBR                 37510015
375200              AND ORD_LNE_NBR     = :RECITM-ORD-LNE-NBR           37520000
375300              AND REC_SEQ_NBR     = :TM500-REC-SEQ-NBR            37530015
375400              AND OPER_UNT_ID     = :TM500-OPER-UNT-ID            37540015
375500              AND FCLTY_ID        = :TM500-FCLTY-ID               37550015
375600              AND VER_STATUS_CDE  = :PC-A                         37560000
375700         END-EXEC                                                 37570000
375800                                                                  37580000
375900         EVALUATE TRUE                                            37590000
376000           WHEN SQLCODE = +0                                      37600000
376100               CONTINUE                                           37610000
376200                                                                  37620000
376300           WHEN SQLCODE = -904                                    37630000
376400           WHEN SQLCODE = -911                                    37640000
376500           WHEN SQLCODE = -913                                    37650000
376600               CONTINUE                                           37660000
376700                                                                  37670000
376800           WHEN OTHER                                             37680000
376900               SET PS-PACK-LVL-UPD-DONE TO TRUE                   37690000
377000               SET PS-DONE              TO TRUE                   37700000
377100               DISPLAY '**************************************'   37710008
377200               DISPLAY '**    UNSUCCESSFUL UPDATE           **'   37720008
377300               DISPLAY '**************************************'   37730008
377400               DISPLAY '** ABEND                            **'   37740008
377500               DISPLAY '** PROGRAM = TMKUP521               **'   37750014
377600               DISPLAY '** PARA = 3525-UPDATE-RECITM-CSR'         37760008
377700               DISPLAY '** DB2 OPER  = UPDATE TRECITM       **'   37770008
377800               DISPLAY '** ORD_NBR        = ' TM500-PO-NBR        37780015
377900               DISPLAY '** ORD_LNE_NBR    = ' RECITM-ORD-LNE-NBR  37790008
378000               DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR   37800015
378100               DISPLAY '** OPER_UNT_ID    = ' TM500-OPER-UNT-ID   37810015
378200               DISPLAY '** FCLTY_ID       = ' TM500-FCLTY-ID      37820015
378300               DISPLAY '** VER_STATUS_CDE = ' PC-A                37830008
378400               DISPLAY '**************************************'   37840008
378600         END-EVALUATE                                             37860000
378700     END-PERFORM.                                                 37870000
378800                                                                  37880000
378900     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         37890000
379000         SET  PS-DONE TO TRUE                                     37900000
379100         DISPLAY '**************************************'         37910008
379200         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         37920008
379300         DISPLAY '**************************************'         37930008
379400         DISPLAY '** ABEND                            **'         37940008
379500         DISPLAY '** PROGRAM = TMKUP521               **'         37950014
379600         DISPLAY '** PARA = 3525-UPDATE-RECITM-CSR'               37960008
379700         DISPLAY '** DB2 OPER  = UPDATE TRECITM       **'         37970008
379800         DISPLAY '** ORD_NBR        = ' TM500-PO-NBR              37980015
379900         DISPLAY '** ORD_LNE_NBR    = ' RECITM-ORD-LNE-NBR        37990008
380000         DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR         38000015
380100         DISPLAY '** OPER_UNT_ID    = ' TM500-OPER-UNT-ID         38010015
380200         DISPLAY '** FCLTY_ID       = ' TM500-FCLTY-ID            38020015
380300         DISPLAY '** VER_STATUS_CDE = ' PC-A                      38030008
380400         DISPLAY '**************************************'         38040008
380600     END-IF.                                                      38060000
380700                                                                  38070000
380800******************************************************************38080009
380900**                                                              **38090009
381000******************************************************************38100009
381100 3528-UPDATE-RECITM-CSR-NO-OPER.                                  38110000
381200                                                                  38120000
381300     MOVE '3528-UPDATE-RECITM-CSR-NO-OPER' TO TM007-RETURNED-PARA.38130030
381500                                                                  38150000
381600     PERFORM WITH TEST AFTER                                      38160000
381700       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       38170000
381800         UNTIL SQLCODE = +0                                       38180000
381900            OR PS-DONE                                            38190000
382000            OR PV-RETRY-COUNTER > PC-MAX-RETRIES                  38200000
382100                                                                  38210000
382200         EXEC SQL                                                 38220000
382300           UPDATE TRECITM                                         38230000
382400              SET PO_VER_NBR      = :PURITM-VER-NBR               38240000
382500            WHERE ORD_NBR         = :TM500-PO-NBR                 38250015
382600              AND ORD_LNE_NBR     = :RECITM-ORD-LNE-NBR           38260000
382700              AND REC_SEQ_NBR     = :TM500-REC-SEQ-NBR            38270015
382800              AND VER_STATUS_CDE  = :PC-A                         38280000
382900         END-EXEC                                                 38290000
383000                                                                  38300000
383100         EVALUATE TRUE                                            38310000
383200           WHEN SQLCODE = +0                                      38320000
383300               CONTINUE                                           38330000
383400                                                                  38340000
383500           WHEN SQLCODE = -904                                    38350000
383600           WHEN SQLCODE = -911                                    38360000
383700           WHEN SQLCODE = -913                                    38370000
383800               CONTINUE                                           38380000
383900                                                                  38390000
384000           WHEN OTHER                                             38400000
384100               SET PS-PACK-LVL-UPD-DONE TO TRUE                   38410000
384200               SET PS-DONE              TO TRUE                   38420000
384300               DISPLAY '**************************************'   38430008
384400               DISPLAY '**    UNSUCCESSFUL UPDATE           **'   38440008
384500               DISPLAY '**************************************'   38450008
384600               DISPLAY '** ABEND                            **'   38460008
384700               DISPLAY '** PROGRAM = TMKUP521               **'   38470014
384800               DISPLAY '** PARA = 3528-UPDATE-RECITM-CSR-NO-OPER' 38480008
384900               DISPLAY '** DB2 OPER  = UPDATE TRECITM       **'   38490008
385000               DISPLAY '** ORD_NBR        = ' TM500-PO-NBR        38500015
385100               DISPLAY '** ORD_LNE_NBR    = ' RECITM-ORD-LNE-NBR  38510008
385200               DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR   38520015
385300               DISPLAY '** VER_STATUS_CDE = ' PC-A                38530008
385400               DISPLAY '**************************************'   38540008
385600         END-EVALUATE                                             38560000
385700     END-PERFORM.                                                 38570000
385800                                                                  38580000
385900     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         38590000
386000         SET  PS-DONE TO TRUE                                     38600000
386100         DISPLAY '**************************************'         38610008
386200         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         38620008
386300         DISPLAY '**************************************'         38630008
386400         DISPLAY '** ABEND                            **'         38640008
386500         DISPLAY '** PROGRAM = TMKUP521               **'         38650014
386600         DISPLAY '** PARA = 3528-UPDATE-RECITM-CSR-NO-OPER'       38660008
386700         DISPLAY '** DB2 OPER  = UPDATE TRECITM       **'         38670008
386800         DISPLAY '** ORD_NBR        = ' TM500-PO-NBR              38680015
386900         DISPLAY '** ORD_LNE_NBR    = ' RECITM-ORD-LNE-NBR        38690008
387000         DISPLAY '** REC_SEQ_NBR    = ' TM500-REC-SEQ-NBR         38700015
387100         DISPLAY '** VER_STATUS_CDE = ' PC-A                      38710008
387200         DISPLAY '**************************************'         38720008
387400     END-IF.                                                      38740000
387500                                                                  38750000
387600******************************************************************38760000
387700*  THIS PARAGRAPH CLOSES THE CURSOR FOR TABLE RECITM.             38770000
387800******************************************************************38780000
387900 3530-CLOSE-RECITM-CSR.                                           38790000
388000                                                                  38800000
388100     MOVE '3530-CLOSE-RECITM-CSR'      TO TM007-RETURNED-PARA.    38810029
388300                                                                  38830000
388400     EXEC SQL                                                     38840000
388500         CLOSE RECITM-LINE-CSR                                    38850000
388600     END-EXEC.                                                    38860000
388700                                                                  38870000
388800     IF SQLCODE = +100                                            38880000
388900         CONTINUE                                                 38890000
389000     ELSE                                                         38900000
389100         IF SQLCODE NOT = +0                                      38910000
389200           SET  PS-DONE TO TRUE                                   38920008
389300           DISPLAY '**************************************'       38930008
389400           DISPLAY '**    UNSUCCESSFUL CLOSE OF CURSOR  **'       38940008
389500           DISPLAY '**************************************'       38950008
389600           DISPLAY '** ABEND                            **'       38960008
389700           DISPLAY '** PROGRAM = TMKUP521               **'       38970014
389800           DISPLAY '** PARA = 3530-CLOSE-RECITM-CSR'              38980008
389900           DISPLAY '** DB2 OPER  = CLOSE CURSOR         **'       38990008
390000           DISPLAY '**************************************'       39000008
390200         END-IF                                                   39020000
390300     END-IF.                                                      39030000
390400                                                                  39040000
390500******************************************************************39050009
390600**                                                              **39060009
390700******************************************************************39070009
390800 3535-CLOSE-RECITM-CSR-NO-OPER.                                   39080000
390900                                                                  39090000
391000     MOVE '3535-CLOSE-RECITM-CSR-NO-OPER'                         39100004
391100                           TO TM007-RETURNED-PARA.                39110029
391300                                                                  39130000
391400     EXEC SQL                                                     39140000
391500         CLOSE RECITM-LN-NOOP-CSR                                 39150000
391600     END-EXEC.                                                    39160000
391700                                                                  39170000
391800     IF SQLCODE = +100                                            39180000
391900         CONTINUE                                                 39190000
392000     ELSE                                                         39200000
392100         IF SQLCODE NOT = +0                                      39210000
392200           SET  PS-DONE TO TRUE                                   39220008
392300           DISPLAY '**************************************'       39230008
392400           DISPLAY '**    UNSUCCESSFUL CLOSE OF CURSOR  **'       39240008
392500           DISPLAY '**************************************'       39250008
392600           DISPLAY '** ABEND                            **'       39260008
392700           DISPLAY '** PROGRAM = TMKUP521               **'       39270014
392800           DISPLAY '** PARA = 3535-CLOSE-RECITM-CSR-NO-OPER'      39280008
392900           DISPLAY '** DB2 OPER  = CLOSE CURSOR         **'       39290008
393000           DISPLAY '**************************************'       39300008
393200         END-IF                                                   39320000
393300     END-IF.                                                      39330000
393400                                                                  39340000
393500******************************************************************39350000
393600**                                                              **39360008
393700******************************************************************39370000
393800 4000-SELECT-NOTIF-IND.                                           39380008
393900                                                                  39390000
394000     MOVE '4000-SELECT-NOTIF-IND'      TO TM007-RETURNED-PARA.    39400029
394200                                                                  39420000
394300     PERFORM WITH TEST AFTER                                      39430000
394400         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    39440000
394500         UNTIL   SQLCODE = +0 OR                                  39450000
394600                 PS-DONE OR                                       39460000
394700                 PV-RETRY-COUNTER > PC-MAX-RETRIES                39470000
394800                                                                  39480000
394900         EXEC SQL                                                 39490000
395000              SELECT NOTIF_IND                                    39500000
395100                INTO :TRBRSN-NOTIF-IND                            39510000
395200                FROM TTRBRSN                                      39520000
395300               WHERE TRBL_RSN_CDE = :TM500-TRBL-RSN-CDE           39530015
395400         END-EXEC                                                 39540000
395500                                                                  39550000
395600         EVALUATE TRUE                                            39560000
395700             WHEN SQLCODE = +0                                    39570000
395800                  CONTINUE                                        39580000
395900                                                                  39590000
396000             WHEN SQLCODE = -904                                  39600000
396100             WHEN SQLCODE = -911                                  39610000
396200             WHEN SQLCODE = -913                                  39620000
396300                  CONTINUE                                        39630000
396400                                                                  39640000
396500             WHEN OTHER                                           39650000
396600               SET  PS-DONE TO TRUE                               39660008
396700               DISPLAY '**************************************'   39670008
396800               DISPLAY '**    UNSUCCESSFUL SELECT           **'   39680008
396900               DISPLAY '**************************************'   39690008
397000               DISPLAY '** ABEND                            **'   39700008
397100               DISPLAY '** PROGRAM = TMKUP521               **'   39710014
397200               DISPLAY '** PARA = 4000-SELECT-NOTIF-IND'          39720008
397300               DISPLAY '** DB2 OPER  = SELECT TTRBRSN       **'   39730008
397400               DISPLAY '** TRBL_RSN_CDE   = ' TM500-TRBL-RSN-CDE  39740015
397500               DISPLAY '**************************************'   39750008
397700         END-EVALUATE                                             39770000
397800     END-PERFORM.                                                 39780000
397900                                                                  39790000
398000     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         39800000
398100         SET PS-DONE  TO TRUE                                     39810000
398200         DISPLAY '**************************************'         39820008
398300         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         39830008
398400         DISPLAY '**************************************'         39840008
398500         DISPLAY '** ABEND                            **'         39850008
398600         DISPLAY '** PROGRAM = TMKUP521               **'         39860014
398700         DISPLAY '** PARA = 4000-SELECT-NOTIF-IND'                39870008
398800         DISPLAY '** DB2 OPER  = SELECT TTRBRSN       **'         39880008
398900         DISPLAY '** TRBL_RSN_CDE   = ' TM500-TRBL-RSN-CDE        39890015
399000         DISPLAY '**************************************'         39900008
399200     END-IF.                                                      39920000
399300                                                                  39930000
399400******************************************************************39940020
399500**                                                              **39950020
399600******************************************************************39960020
399700 4100-ACKNL-ONLY.                                                 39970020
399800                                                                  39980020
399900     MOVE PC-ACKNOWLEDGED        TO TM500-FREEFORM-TEXT           39990077
400000                                                                  40000020
400100     PERFORM 2900-INSERT-TROUBLE-DETAIL                           40010076
400200                                                                  40020020
400300     PERFORM 4120-ACKNL-ONLY-UPD-NTF.                             40030076
400400                                                                  40040020
400500******************************************************************40050020
406900******************************************************************40690020
407000 4120-ACKNL-ONLY-UPD-NTF.                                         40700024
407100                                                                  40710020
407200     MOVE '4120-ACKNL-ONLY-UPD-NTF'   TO TM007-RETURNED-PARA.     40720038
407400                                                                  40740020
407500     PERFORM WITH TEST AFTER                                      40750020
407600         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    40760020
407700         UNTIL   SQLCODE = +0 OR                                  40770020
407800                 PS-DONE OR                                       40780020
407900                 PV-RETRY-COUNTER > PC-MAX-RETRIES                40790020
408000                                                                  40800020
408100         EXEC SQL                                                 40810020
408200              UPDATE TTRBNTF                                      40820020
408300                 SET RESOLVED_IND   = :PC-A                       40830020
408400                   , ACKNOWLG_UID   = :PC-CURRENT-PROGRAM-NAME    40840020
408500                   , ACKNOWLG_TMST  = CURRENT TIMESTAMP           40850020
408600              WHERE NOTIF_NBR       = :TM500-NOTIF-NBR            40860067
408700         END-EXEC                                                 40870020
408800                                                                  40880020
408900         EVALUATE TRUE                                            40890020
409000             WHEN SQLCODE = +0                                    40900020
409100                  SET TM007-CALL-SUCCESSFUL      TO TRUE          40910035
409200                                                                  40920020
409300             WHEN SQLCODE = -904                                  40930020
409400             WHEN SQLCODE = -911                                  40940020
409500             WHEN SQLCODE = -913                                  40950020
409600                  SET TM007-SQL-CONTENTION TO TRUE                40960036
409610                  MOVE SQLCODE             TO TM007-SQLCODE       40961034
409620                  MOVE SQLCA               TO TM007-SQLCA         40962034
409630                  MOVE '08'                TO TM500-RETURN-CODE   40963050
409700                                                                  40970020
409800             WHEN OTHER                                           40980020
409900              SET  PS-DONE                                        40990038
409910                   TM007-SQL-UNRECOVERABLE-ERROR  TO TRUE         40991038
409911              MOVE SQLCODE              TO TM007-SQLCODE          40991138
409912                                           PV-DISP-TM007-SQLCODE  40991238
409913              MOVE SQLCA                TO TM007-SQLCA            40991338
409914              MOVE '09'                 TO TM500-RETURN-CODE      40991450
410000              DISPLAY '**************************************'    41000038
410100              DISPLAY '**    UNSUCCESSFUL UPDATE           **'    41010038
410200              DISPLAY '**************************************'    41020038
410300              DISPLAY '** ABEND                            **'    41030038
410400              DISPLAY '** PROGRAM = TMKUP521               **'    41040038
410500              DISPLAY '** PARA = 4120-ACKNL-ONLY-UPD-NTF'         41050038
410600              DISPLAY '** DB2 OPER  = UPDATE TTRBNTF       **'    41060038
410700              DISPLAY '** NOTIF_NBR      = ' TM500-NOTIF-NBR      41070086
410800              DISPLAY '** PO_NBR         = ' TM007-PO-NBR         41080038
410900              DISPLAY '** REC-SEQ-NBR    = ' TM007-REC-SEQ-NBR    41090038
410910              DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE41091038
410920              DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA          41092038
410930              DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE    41093050
411000              DISPLAY '**************************************'    41100038
411200         END-EVALUATE                                             41120020
411300     END-PERFORM.                                                 41130020
411400                                                                  41140020
411500     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         41150020
411600        SET  PS-DONE                                              41160038
411601             TM007-SQL-CONTENTION TO TRUE                         41160138
411610        MOVE SQLCODE              TO TM007-SQLCODE                41161038
411620                                     PV-DISP-TM007-SQLCODE        41162038
411630        MOVE SQLCA                TO TM007-SQLCA                  41163038
411640        MOVE '10'                 TO TM500-RETURN-CODE            41164050
411700        DISPLAY '**************************************'          41170038
411800        DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'          41180038
411900        DISPLAY '**************************************'          41190038
412000        DISPLAY '** ABEND                            **'          41200038
412100        DISPLAY '** PROGRAM = TMKUP521               **'          41210038
412200        DISPLAY '** PARA = 4120-ACKNL-ONLY-UPD-NTF'               41220038
412300        DISPLAY '** DB2 OPER  = UPDATE TTRBNTF       **'          41230038
412400        DISPLAY '** NOTIF_NBR      = ' TM500-NOTIF-NBR            41240086
412500        DISPLAY '** PO_NBR         = ' TM007-PO-NBR               41250038
412600        DISPLAY '** REC-SEQ-NBR    = ' TM007-REC-SEQ-NBR          41260038
412610        DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE      41261038
412620        DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA                41262038
412630        DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE          41263050
412700        DISPLAY '**************************************'          41270038
412900     END-IF.                                                      41290020
413000                                                                  41300020
413100******************************************************************41310020
413200**                                                              **41320020
413300******************************************************************41330020
413400 4200-ACKNL-AND-FAIL.                                             41340020
413500                                                                  41350020
413600     MOVE TM500-NOTIF-NBR       TO TRBNTF-NOTIF-NBR.              41360082
413700                                                                  41370020
413800     PERFORM 4210-GET-TRBL-FOR-NEW-INSERT.                        41380020
413900                                                                  41390020
414000     PERFORM 8000-GET-RANDOM-NBR.                                 41400020
414100                                                                  41410020
414200     MOVE DP902-RANDOM-NUMBER   TO TRBNTF-NOTIF-NBR               41420078
414300                                                                  41430020
414310     IF TM007-CALL-SUCCESSFUL                                     41431035
414400        PERFORM 4220-ACKNL-FAIL-INS-NEW-NTF                       41440034
414410     END-IF.                                                      41441034
414310     IF TM007-CALL-SUCCESSFUL                                     41441180
399900         MOVE PC-TIME-LAPSE-FAIL TO TM500-FREEFORM-TEXT           41442081
400100         PERFORM 2900-INSERT-TROUBLE-DETAIL                       41444080
414410     END-IF.                                                      41445080
414500                                                                  41450021
414510     IF TM007-CALL-SUCCESSFUL                                     41451035
414600        PERFORM 4230-ACKNL-FAIL-UPD-NTF                           41460034
414610     END-IF.                                                      41461034
414700                                                                  41470020
414800                                                                  41480020
414900******************************************************************41490020
415000**                                                              **41500020
415100******************************************************************41510020
415200 4210-GET-TRBL-FOR-NEW-INSERT.                                    41520020
415300                                                                  41530020
415400     MOVE '4210-GET-TRBL-FOR-NEW-INSERT' TO TM007-RETURNED-PARA.  41540038
415600                                                                  41560020
415700     PERFORM WITH TEST AFTER                                      41570020
415800         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    41580020
415900         UNTIL   SQLCODE = +0 OR                                  41590020
416000                 PS-DONE OR                                       41600020
416100                 PV-RETRY-COUNTER > PC-MAX-RETRIES                41610020
416200                                                                  41620020
416300         EXEC SQL                                                 41630020
416400              SELECT OPER_UNT_ID                                  41640020
416500                  ,  FCLTY_ID                                     41650020
416600                  ,  DEPT_NBR                                     41660020
416700                  ,  ENT_ID                                       41670020
416800                  ,  PO_NBR                                       41680020
416900                  ,  PO_LNE_NBR                                   41690020
417000                  ,  REC_SEQ_NBR                                  41700020
417100                  ,  TRBL_RSN_CDE                                 41710020
417200                  ,  NOTIF_TMST                                   41720020
417300                  ,  NOTIF_UID                                    41730020
417400                  ,  RESOLVED_IND                                 41740020
417500                  ,  RESOLVED_TMST                                41750020
417600                  ,  RESOLVED_UID                                 41760020
417700                  ,  ACKNOWLG_TMST                                41770020
417800                  ,  ACKNOWLG_UID                                 41780020
417900                  ,  CNTCT_EXT                                    41790020
418000                  ,  FCLTY_AREA_ID                                41800020
418100                  ,  SHIPT_ID                                     41810020
418200                  ,  PKSL_SEQ_NBR                                 41820020
418300                  ,  PKSL_LNE_NBR                                 41830020
418400                  ,  WORK_ORD_SEQ_NBR                             41840020
418500                  ,  WO_INSTR_SEQ_NBR                             41850020
418600                  ,  OVER_SHT_PCT                                 41860020
418700                  ,  LAST_DTL_CRE_TMST                            41870020
418800                  ,  CRE_IND                                      41880020
418900                  ,  PRORATE_IND                                  41890020
419000                  ,  RTV_IND                                      41900020
419100                  ,  RTV_RESPONSE_TMST                            41910020
419200                  ,  PO_VER_NBR                                   41920020
419300                  ,  PO_LNE_VER_NBR                               41930020
419400                  ,  PLN_SHIP_VER_NBR                             41940020
419500                  ,  ERLY_LTE_DAY_QTY                             41950020
419600                  ,  INITR_ID                                     41960020
419700                  ,  RSPNB_RSLU_ID                                41970020
419800                  ,  PFMC_TRKG_ID                                 41980020
419900                  ,  ACTVY_RSLU_CDE                               41990020
420000                  ,  INITR_ENT_ID                                 42000020
420100                  ,  FOB_CDE                                      42010020
420200                  ,  POE_CDE                                      42020020
420300                  ,  PREPK_ID                                     42030020
420400                INTO :TRBNTF-OPER-UNT-ID                          42040020
420500                  ,  :TRBNTF-FCLTY-ID                             42050020
420600                  ,  :TRBNTF-DEPT-NBR                             42060020
420700                  ,  :TRBNTF-ENT-ID                               42070020
420800                  ,  :TRBNTF-PO-NBR                               42080020
420900                  ,  :TRBNTF-PO-LNE-NBR                           42090020
421000                  ,  :TRBNTF-REC-SEQ-NBR                          42100020
421100                  ,  :TRBNTF-TRBL-RSN-CDE                         42110020
421200                  ,  :TRBNTF-NOTIF-TMST                           42120020
421300                  ,  :TRBNTF-NOTIF-UID                            42130020
421400                  ,  :TRBNTF-RESOLVED-IND                         42140020
421500                  ,  :TRBNTF-RESOLVED-TMST                        42150020
421600                  ,  :TRBNTF-RESOLVED-UID                         42160020
421700                  ,  :TRBNTF-ACKNOWLG-TMST                        42170020
421800                  ,  :TRBNTF-ACKNOWLG-UID                         42180020
421900                  ,  :TRBNTF-CNTCT-EXT                            42190020
422000                  ,  :TRBNTF-FCLTY-AREA-ID                        42200020
422100                  ,  :TRBNTF-SHIPT-ID                             42210020
422200                  ,  :TRBNTF-PKSL-SEQ-NBR                         42220020
422300                  ,  :TRBNTF-PKSL-LNE-NBR                         42230020
422400                  ,  :TRBNTF-WORK-ORD-SEQ-NBR                     42240020
422500                  ,  :TRBNTF-WO-INSTR-SEQ-NBR                     42250020
422600                  ,  :TRBNTF-OVER-SHT-PCT                         42260020
422700                  ,  :TRBNTF-LAST-DTL-CRE-TMST                    42270020
422800                  ,  :TRBNTF-CRE-IND                              42280020
422900                  ,  :TRBNTF-PRORATE-IND                          42290020
423000                  ,  :TRBNTF-RTV-IND                              42300020
423100                  ,  :TRBNTF-RTV-RESPONSE-TMST                    42310020
423200                  ,  :TRBNTF-PO-VER-NBR                           42320020
423300                  ,  :TRBNTF-PO-LNE-VER-NBR                       42330020
423400                  ,  :TRBNTF-PLN-SHIP-VER-NBR                     42340020
423500                  ,  :TRBNTF-ERLY-LTE-DAY-QTY                     42350020
423600                  ,  :TRBNTF-INITR-ID                             42360020
423700                  ,  :TRBNTF-RSPNB-RSLU-ID                        42370020
423800                  ,  :TRBNTF-PFMC-TRKG-ID                         42380020
423900                  ,  :TRBNTF-ACTVY-RSLU-CDE                       42390020
424000                  ,  :TRBNTF-INITR-ENT-ID                         42400020
424100                  ,  :TRBNTF-FOB-CDE                              42410020
424200                  ,  :TRBNTF-POE-CDE                              42420020
424300                  ,  :TRBNTF-PREPK-ID                             42430020
424400                FROM TTRBNTF                                      42440020
424500               WHERE NOTIF_NBR    = :TM500-NOTIF-NBR              42450085
424600         END-EXEC                                                 42460020
424700                                                                  42470020
424800         EVALUATE TRUE                                            42480020
424900           WHEN SQLCODE = +0                                      42490039
425000              SET TM007-CALL-SUCCESSFUL TO TRUE                   42500039
425100                                                                  42510020
425200           WHEN SQLCODE = -904                                    42520039
425300           WHEN SQLCODE = -911                                    42530039
425400           WHEN SQLCODE = -913                                    42540039
425500              SET TM007-SQL-CONTENTION  TO TRUE                   42550039
425510              MOVE SQLCODE              TO TM007-SQLCODE          42551039
425511                                           PV-DISP-TM007-SQLCODE  42551139
425520              MOVE SQLCA                TO TM007-SQLCA            42552039
425530              MOVE '11'                 TO TM500-RETURN-CODE      42553050
425600                                                                  42560020
425700           WHEN OTHER                                             42570039
425800              SET  PS-DONE                                        42580039
425810                   TM007-SQL-UNRECOVERABLE-ERROR TO TRUE          42581039
425820              MOVE SQLCODE              TO TM007-SQLCODE          42582039
425821                                           PV-DISP-TM007-SQLCODE  42582139
425830              MOVE SQLCA                TO TM007-SQLCA            42583039
425840              MOVE '12'                 TO TM500-RETURN-CODE      42584050
425900              DISPLAY '**************************************'    42590039
426000              DISPLAY '**    UNSUCCESSFUL SELECT           **'    42600039
426100              DISPLAY '**************************************'    42610039
426200              DISPLAY '** ABEND                            **'    42620039
426300              DISPLAY '** PROGRAM = TMKUP521               **'    42630039
426400              DISPLAY '** PARA = 4210-GET-TRBL-FOR-NEW-INSERT'    42640039
426500              DISPLAY '** DB2 OPER  = SELECT TTRBNTF       **'    42650039
426600              DISPLAY '** NOTIF_NBR      = ' TM500-NOTIF-NBR      42660086
426700              DISPLAY '** PO_NBR         = ' TM007-PO-NBR         42670039
426800              DISPLAY '** REC-SEQ-NBR    = ' TM007-REC-SEQ-NBR    42680039
426810              DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE42681039
426820              DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA          42682039
426830              DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE    42683050
426900              DISPLAY '**************************************'    42690039
427100         END-EVALUATE                                             42710020
427200     END-PERFORM.                                                 42720020
427300                                                                  42730020
427400     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         42740020
427500         SET PS-DONE                                              42750039
427510             TM007-SQL-CONTENTION TO TRUE                         42751039
427520         MOVE SQLCODE             TO TM007-SQLCODE                42752039
427530                                     PV-DISP-TM007-SQLCODE        42753039
427540         MOVE SQLCA               TO TM007-SQLCA                  42754039
427550         MOVE '12'                TO TM500-RETURN-CODE            42755050
427600         DISPLAY '**************************************'         42760020
427700         DISPLAY '**   MAX DB2 RETRIES EXCEEDED       **'         42770020
427800         DISPLAY '**************************************'         42780020
427900         DISPLAY '** ABEND                            **'         42790020
428000         DISPLAY '** PROGRAM = TMKUP521               **'         42800020
428100         DISPLAY '** PARA = 4210-GET-TRBL-FOR-NEW-INSERT'         42810020
428200         DISPLAY '** DB2 OPER  = SELECT TTRBNTF       **'         42820020
428300         DISPLAY '** NOTIF_NBR      = ' TM500-NOTIF-NBR           42830086
428400         DISPLAY '** PO_NBR         = ' TM007-PO-NBR              42840020
428500         DISPLAY '** REC-SEQ-NBR    = ' TM007-REC-SEQ-NBR         42850020
428510         DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE     42851039
428520         DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA               42852039
428530         DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE         42853050
428600         DISPLAY '**************************************'         42860020
428800     END-IF.                                                      42880020
428900                                                                  42890020
429000******************************************************************42900021
429100**                                                              **42910021
429200******************************************************************42920021
429300 4220-ACKNL-FAIL-INS-NEW-NTF.                                     42930021
429400                                                                  42940021
429500     MOVE '4220-ACKNL-FAIL-INS-NEW-NTF' TO TM007-RETURNED-PARA.   42950038
429700                                                                  42970021
429800     PERFORM WITH TEST AFTER                                      42980021
429900         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     42990021
430000         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES OR               43000021
430100         SQLCODE = ZERO OR PS-DONE                                43010021
430200         EXEC SQL                                                 43020021
430300              INSERT INTO TTRBNTF                                 43030021
430400                     (NOTIF_NBR                                   43040021
430500                   ,  OPER_UNT_ID                                 43050021
430600                   ,  FCLTY_ID                                    43060021
430700                   ,  DEPT_NBR                                    43070021
430800                   ,  ENT_ID                                      43080021
430900                   ,  PO_NBR                                      43090021
431000                   ,  PO_LNE_NBR                                  43100021
431100                   ,  REC_SEQ_NBR                                 43110021
431200                   ,  TRBL_RSN_CDE                                43120021
431300                   ,  NOTIF_TMST                                  43130021
431400                   ,  NOTIF_UID                                   43140021
431500                   ,  RESOLVED_IND                                43150021
431600                   ,  RESOLVED_TMST                               43160021
431700                   ,  RESOLVED_UID                                43170021
431800                   ,  ACKNOWLG_TMST                               43180021
431900                   ,  ACKNOWLG_UID                                43190021
432000                   ,  CNTCT_EXT                                   43200021
432100                   ,  FCLTY_AREA_ID                               43210021
432200                   ,  SHIPT_ID                                    43220021
432300                   ,  PKSL_SEQ_NBR                                43230021
432400                   ,  PKSL_LNE_NBR                                43240021
432500                   ,  WORK_ORD_SEQ_NBR                            43250021
432600                   ,  WO_INSTR_SEQ_NBR                            43260021
432700                   ,  OVER_SHT_PCT                                43270021
432800                   ,  LAST_DTL_CRE_TMST                           43280021
432900                   ,  CRE_IND                                     43290021
433000                   ,  PRORATE_IND                                 43300021
433100                   ,  RTV_IND                                     43310021
433200                   ,  RTV_RESPONSE_TMST                           43320021
433300                   ,  PO_VER_NBR                                  43330021
433400                   ,  PO_LNE_VER_NBR                              43340021
433500                   ,  PLN_SHIP_VER_NBR                            43350021
433600                   ,  ERLY_LTE_DAY_QTY                            43360021
433700                   ,  INITR_ID                                    43370021
433800                   ,  RSPNB_RSLU_ID                               43380021
433900                   ,  PFMC_TRKG_ID                                43390021
434000                   ,  ACTVY_RSLU_CDE                              43400021
434100                   ,  INITR_ENT_ID                                43410021
434200                   ,  FOB_CDE                                     43420021
434300                   ,  POE_CDE                                     43430021
434400                   ,  PREPK_ID)                                   43440021
434500              VALUES (:TRBNTF-NOTIF-NBR                           43450021
434600                   ,  :TRBNTF-OPER-UNT-ID                         43460021
434700                   ,  :TRBNTF-FCLTY-ID                            43470021
434800                   ,  :TRBNTF-DEPT-NBR                            43480021
434900                   ,  :TRBNTF-ENT-ID                              43490021
435000                   ,  :TRBNTF-PO-NBR                              43500021
435100                   ,  :TRBNTF-PO-LNE-NBR                          43510021
435200                   ,  :TRBNTF-REC-SEQ-NBR                         43520021
435300                   ,  :TRBNTF-TRBL-RSN-CDE                        43530021
435400                   ,  CURRENT TIMESTAMP                           43540084
435500                   ,  :PC-CURRENT-PROGRAM-NAME                    43550084
435600                   ,  :PC-N                                       43560072
435700                   ,  :PC-DEFAULT-TMST                            43570084
435800                   ,  '        '                                  43580079
435900                   ,  :PC-DEFAULT-TMST                            43590084
436000                   ,  '        '                                  43600079
436100                   ,  :TRBNTF-CNTCT-EXT                           43610021
436200                   ,  :TRBNTF-FCLTY-AREA-ID                       43620021
436300                   ,  :TRBNTF-SHIPT-ID                            43630021
436400                   ,  :TRBNTF-PKSL-SEQ-NBR                        43640021
436500                   ,  :TRBNTF-PKSL-LNE-NBR                        43650021
436600                   ,  :TRBNTF-WORK-ORD-SEQ-NBR                    43660021
436700                   ,  :TRBNTF-WO-INSTR-SEQ-NBR                    43670021
436800                   ,  :TRBNTF-OVER-SHT-PCT                        43680021
436900                   ,  :PC-DEFAULT-TMST                            43690072
437000                   ,  :TRBNTF-CRE-IND                             43700021
437100                   ,  :TRBNTF-PRORATE-IND                         43710021
437200                   ,  :TRBNTF-RTV-IND                             43720021
437300                   ,  :TRBNTF-RTV-RESPONSE-TMST                   43730021
437400                   ,  :TRBNTF-PO-VER-NBR                          43740021
437500                   ,  :TRBNTF-PO-LNE-VER-NBR                      43750021
437600                   ,  :TRBNTF-PLN-SHIP-VER-NBR                    43760021
437700                   ,  :TRBNTF-ERLY-LTE-DAY-QTY                    43770021
437800                   ,  :TRBNTF-INITR-ID                            43780021
437900                   ,  :TRBNTF-RSPNB-RSLU-ID                       43790021
438000                   ,  :TRBNTF-PFMC-TRKG-ID                        43800021
438100                   ,  :TRBNTF-ACTVY-RSLU-CDE                      43810021
438200                   ,  :TRBNTF-INITR-ENT-ID                        43820021
438300                   ,  :TRBNTF-FOB-CDE                             43830021
438400                   ,  :TRBNTF-POE-CDE                             43840021
438500                   ,  :TRBNTF-PREPK-ID)                           43850021
438600         END-EXEC                                                 43860021
438700                                                                  43870021
438800     EVALUATE TRUE                                                43880021
438900         WHEN SQLCODE = ZERO                                      43890021
439000             SET TM007-CALL-SUCCESSFUL TO TRUE                    43900038
439100         WHEN SQLCODE = -803                                      43910021
439200             PERFORM 8000-GET-RANDOM-NBR                          43920021
439300             MOVE DP902-RANDOM-NUMBER   TO TRBNTF-NOTIF-NBR       43930088
439500         WHEN SQLCODE = -904                                      43950021
439600         WHEN SQLCODE = -911                                      43960021
439700         WHEN SQLCODE = -913                                      43970021
439800               SET TM007-SQL-CONTENTION  TO TRUE                  43980036
439810               MOVE SQLCODE              TO TM007-SQLCODE         43981026
439811                                            PV-DISP-TM007-SQLCODE 43981139
439820               MOVE SQLCA                TO TM007-SQLCA           43982026
439830               MOVE '13'                 TO TM500-RETURN-CODE     43983050
439900         WHEN OTHER                                               43990021
440000              SET  PS-DONE                                        44000039
440001                   TM007-SQL-UNRECOVERABLE-ERROR  TO TRUE         44000139
440010              MOVE SQLCODE              TO TM007-SQLCODE          44001039
440011                                           PV-DISP-TM007-SQLCODE  44001139
440020              MOVE SQLCA                TO TM007-SQLCA            44002039
440030              MOVE '14'                 TO TM500-RETURN-CODE      44003050
440100              DISPLAY '**************************************'    44010039
440200              DISPLAY '**    UNSUCCESSFUL INSERT           **'    44020039
440300              DISPLAY '**************************************'    44030039
440400              DISPLAY '** ABEND                            **'    44040039
440500              DISPLAY '** PROGRAM = TMKUP521               **'    44050039
440600              DISPLAY '** PARA = 4220-ACKNL-FAIL-INS-NEW-NTF'     44060039
440700              DISPLAY '** DB2 OPER  = INSERT TTRBNTF       **'    44070039
440800              DISPLAY '** NOTIF_NBR      = ' TRBNTF-NOTIF-NBR     44080039
440900              DISPLAY '** OPER_UNT_ID    = ' TRBNTF-OPER-UNT-ID   44090039
441000              DISPLAY '** FCLTY_ID       = ' TRBNTF-FCLTY-ID      44100039
441100              DISPLAY '** DEPT_NBR       = ' TRBNTF-DEPT-NBR      44110039
441200              DISPLAY '** ENT_ID         = ' TRBNTF-ENT-ID        44120039
441300              DISPLAY '** PO_NBR         = ' TRBNTF-PO-NBR        44130039
441400              DISPLAY '** PO_LNE_NBR     = ' TRBNTF-PO-LNE-NBR    44140039
441500              DISPLAY '** REC_SEQ_NBR    = ' TRBNTF-REC-SEQ-NBR   44150039
441600              DISPLAY '** TRBL_RSN_CDE   = ' TRBNTF-TRBL-RSN-CDE  44160039
441610              DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE44161039
441620              DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA          44162039
441630              DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE    44163050
441700              DISPLAY '**************************************'    44170039
441900     END-EVALUATE                                                 44190021
442000     END-PERFORM.                                                 44200021
442100                                                                  44210021
442200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES AND                     44220021
442300               SQLCODE NOT = ZERO                                 44230021
442400         SET  PS-DONE                                             44240039
442410              TM007-SQL-CONTENTION TO TRUE                        44241039
442420         MOVE SQLCODE              TO TM007-SQLCODE               44242039
442430                                      PV-DISP-TM007-SQLCODE       44243039
442440         MOVE SQLCA                TO TM007-SQLCA                 44244039
442450         MOVE '15'                 TO TM500-RETURN-CODE           44245050
442500         DISPLAY '**************************************'         44250021
442600         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         44260021
442700         DISPLAY '**************************************'         44270021
442800         DISPLAY '** ABEND                            **'         44280021
442900         DISPLAY '** PROGRAM = TMKUP521               **'         44290021
443000         DISPLAY '** PARA = 4220-ACKNL-FAIL-INS-NEW-NTF'          44300021
443100         DISPLAY '** DB2 OPER  = INSERT TTRBNTF       **'         44310021
443200         DISPLAY '** NOTIF_NBR      = ' TRBNTF-NOTIF-NBR          44320021
443300         DISPLAY '** OPER_UNT_ID    = ' TRBNTF-OPER-UNT-ID        44330021
443400         DISPLAY '** FCLTY_ID       = ' TRBNTF-FCLTY-ID           44340021
443500         DISPLAY '** DEPT_NBR       = ' TRBNTF-DEPT-NBR           44350021
443600         DISPLAY '** ENT_ID         = ' TRBNTF-ENT-ID             44360021
443700         DISPLAY '** PO_NBR         = ' TRBNTF-PO-NBR             44370021
443800         DISPLAY '** PO_LNE_NBR     = ' TRBNTF-PO-LNE-NBR         44380021
443900         DISPLAY '** REC_SEQ_NBR    = ' TRBNTF-REC-SEQ-NBR        44390021
444000         DISPLAY '** TRBL_RSN_CDE   = ' TRBNTF-TRBL-RSN-CDE       44400021
444010         DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE     44401039
444020         DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA               44402039
444030         DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE         44403050
444100         DISPLAY '**************************************'         44410021
444300     END-IF.                                                      44430021
444400                                                                  44440021
444500******************************************************************44450021
444600**                                                              **44460021
444700******************************************************************44470021
444800 4230-ACKNL-FAIL-UPD-NTF.                                         44480025
444900                                                                  44490021
445000     MOVE '4230-ACKNL-FAIL-UPD-NTF'   TO TM007-RETURNED-PARA.     44500039
445200                                                                  44520021
445300     PERFORM WITH TEST AFTER                                      44530021
445400         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    44540021
445500         UNTIL   SQLCODE = +0 OR                                  44550021
445600                 PS-DONE OR                                       44560021
445700                 PV-RETRY-COUNTER > PC-MAX-RETRIES                44570021
445800                                                                  44580021
445900         EXEC SQL                                                 44590021
446000              UPDATE TTRBNTF                                      44600021
446100                 SET RESOLVED_IND   = :PC-A                       44610021
446200                   , ACKNOWLG_UID   = :PC-CURRENT-PROGRAM-NAME    44620021
446300                   , ACKNOWLG_TMST  = CURRENT TIMESTAMP           44630021
446400              WHERE NOTIF_NBR       = :TM500-NOTIF-NBR            44640083
446500         END-EXEC                                                 44650021
446600                                                                  44660021
446700         EVALUATE TRUE                                            44670021
446800             WHEN SQLCODE = +0                                    44680021
446900                  SET TM007-CALL-SUCCESSFUL      TO TRUE          44690035
447000                                                                  44700021
447100             WHEN SQLCODE = -904                                  44710021
447200             WHEN SQLCODE = -911                                  44720021
447300             WHEN SQLCODE = -913                                  44730021
447400               SET TM007-SQL-CONTENTION  TO TRUE                  44740036
447410               MOVE SQLCODE              TO TM007-SQLCODE         44741026
447411                                            PV-DISP-TM007-SQLCODE 44741139
447420               MOVE SQLCA                TO TM007-SQLCA           44742026
447430               MOVE '15'                 TO TM500-RETURN-CODE     44743050
447500                                                                  44750021
447600             WHEN OTHER                                           44760021
447700              SET  PS-DONE                                        44770039
447701                   TM007-SQL-UNRECOVERABLE-ERROR  TO TRUE         44770139
447710              MOVE SQLCODE              TO TM007-SQLCODE          44771039
447711                                           PV-DISP-TM007-SQLCODE  44771139
447720              MOVE SQLCA                TO TM007-SQLCA            44772039
447730              MOVE '16'                 TO TM500-RETURN-CODE      44773050
447800              DISPLAY '**************************************'    44780039
447900              DISPLAY '**    UNSUCCESSFUL UPDATE           **'    44790039
448000              DISPLAY '**************************************'    44800039
448100              DISPLAY '** ABEND                            **'    44810039
448200              DISPLAY '** PROGRAM = TMKUP521               **'    44820039
448300              DISPLAY '** PARA = 4230-ACKNL-FAIL-UPD-NTF'         44830039
448400              DISPLAY '** DB2 OPER  = UPDATE TTRBNTF       **'    44840039
448500              DISPLAY '** NOTIF_NBR      = ' TM500-NOTIF-NBR      44850086
448600              DISPLAY '** PO_NBR         = ' TM007-PO-NBR         44860039
448700              DISPLAY '** REC-SEQ-NBR    = ' TM007-REC-SEQ-NBR    44870039
448710              DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE44871039
448720              DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA          44872039
448730              DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE    44873050
448800              DISPLAY '**************************************'    44880039
449000         END-EVALUATE                                             44900021
449100     END-PERFORM.                                                 44910021
449200                                                                  44920021
449300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         44930021
449400         SET PS-DONE                                              44940041
449410             TM007-SQL-CONTENTION TO TRUE                         44941039
449420         MOVE SQLCODE              TO TM007-SQLCODE               44942039
449430                                      PV-DISP-TM007-SQLCODE       44943039
449440         MOVE SQLCA                TO TM007-SQLCA                 44944039
449450         MOVE '17'                 TO TM500-RETURN-CODE           44945050
449500         DISPLAY '**************************************'         44950021
449600         DISPLAY '**    MAX DB2 RETRIES EXCEEDED      **'         44960039
449700         DISPLAY '**************************************'         44970021
449800         DISPLAY '** ABEND                            **'         44980021
449900         DISPLAY '** PROGRAM = TMKUP521               **'         44990021
450000         DISPLAY '** PARA = 4230-ACKNL-FAIL-UPD-NTF'              45000024
450100         DISPLAY '** DB2 OPER  = UPDATE TTRBNTF       **'         45010021
450200         DISPLAY '** NOTIF_NBR      = ' TM500-NOTIF-NBR           45020086
450300         DISPLAY '** PO_NBR         = ' TM007-PO-NBR              45030021
450400         DISPLAY '** REC-SEQ-NBR    = ' TM007-REC-SEQ-NBR         45040021
450410         DISPLAY '** TM007 SQLCODE  = ' PV-DISP-TM007-SQLCODE     45041039
450420         DISPLAY '** TM007 SQLCA    = ' TM007-SQLCA               45042039
450430         DISPLAY '** TM500 RET CODE = ' TM500-RETURN-CODE         45043050
450500         DISPLAY '**************************************'         45050021
450700     END-IF.                                                      45070021
450800                                                                  45080021
450900******************************************************************45090021
463300******************************************************************46330020
463400**                                                              **46340008
463500******************************************************************46350008
463600 6000-GET-FCLTY-AREA-ID.                                          46360000
463700                                                                  46370000
463800     COMPUTE PV-PO-LNE-NBR = TM500-PO-LNE-NBR * 1.                46380015
463900                                                                  46390000
464000     PERFORM 6550-OPEN-TWKORIN.                                   46400000
464100                                                                  46410000
464200     IF PS-NOT-DONE                                               46420000
464300         PERFORM 6600-FETCH-TWKORIN-LOOP                          46430000
464400     END-IF.                                                      46440000
464500                                                                  46450000
464600******************************************************************46460008
464700**                                                              **46470008
464800******************************************************************46480008
464900 6550-OPEN-TWKORIN.                                               46490000
465000                                                                  46500000
465100     MOVE '6550-OPEN-TWKORIN'          TO TM007-RETURNED-PARA.    46510029
465300                                                                  46530000
465400     EXEC SQL                                                     46540000
465500         OPEN TWKORIN-CSR                                         46550000
465600     END-EXEC.                                                    46560000
465700                                                                  46570000
465800     EVALUATE TRUE                                                46580000
465810         WHEN SQLCODE = ZEROS                                     46581030
465820              CONTINUE                                            46582030
465900         WHEN SQLWARN0 NOT = SPACES                               46590000
466000         WHEN SQLCODE < ZERO                                      46600000
466100         WHEN SQLCODE > ZERO                                      46610000
466200           SET PS-DONE  TO TRUE                                   46620008
466300           DISPLAY '**************************************'       46630008
466400           DISPLAY '**    UNSUCCESSFUL OPEN OF CURSOR   **'       46640008
466500           DISPLAY '**************************************'       46650008
466600           DISPLAY '** ABEND                            **'       46660008
466700           DISPLAY '** PROGRAM = TMKUP521               **'       46670014
466800           DISPLAY '** PARA = 6550-OPEN-TWKORIN'                  46680008
466900           DISPLAY '** DB2 OPER  = OPEN CURSOR          **'       46690008
467000           DISPLAY '**************************************'       46700008
467400     END-EVALUATE.                                                46740000
467500                                                                  46750000
467600******************************************************************46760000
467700**                                                              **46770008
467800******************************************************************46780008
467900 6575-CLOSE-TWKORIN.                                              46790008
468000                                                                  46800000
468100     MOVE '6575-CLOSE-TWKORIN'         TO TM007-RETURNED-PARA.    46810029
468300                                                                  46830000
468400     EXEC SQL                                                     46840000
468500         CLOSE TWKORIN-CSR                                        46850000
468600     END-EXEC.                                                    46860000
468700                                                                  46870000
468800     EVALUATE TRUE                                                46880000
468810         WHEN SQLCODE = ZEROS                                     46881030
468820              CONTINUE                                            46882030
468900         WHEN SQLWARN0 NOT = SPACES                               46890000
469000         WHEN SQLCODE < ZERO                                      46900000
469100         WHEN SQLCODE > ZERO                                      46910000
469200           SET PS-DONE  TO TRUE                                   46920008
469300           DISPLAY '**************************************'       46930008
469400           DISPLAY '**    UNSUCCESSFUL CLOSE OF CURSOR  **'       46940008
469500           DISPLAY '**************************************'       46950008
469600           DISPLAY '** ABEND                            **'       46960008
469700           DISPLAY '** PROGRAM = TMKUP521               **'       46970014
469800           DISPLAY '** PARA = 6575-CLOSE-TWKORIN'                 46980008
469900           DISPLAY '** DB2 OPER  = CLOSE CURSOR         **'       46990008
470000           DISPLAY '**************************************'       47000008
470400     END-EVALUATE.                                                47040000
470500                                                                  47050000
470600******************************************************************47060000
470700**                                                              **47070008
470800******************************************************************47080008
470900 6600-FETCH-TWKORIN-LOOP.                                         47090008
471000                                                                  47100000
471100     MOVE 'N' TO PS-TWKORIN-CURSOR-SW.                            47110000
471200     MOVE 'N' TO PS-TWKORIN-ZERO-SW.                              47120000
471300                                                                  47130000
471400     PERFORM 6650-FETCH-TWKORIN.                                  47140000
471500                                                                  47150000
471600     IF PS-NOT-DONE                                               47160000
471700         IF PS-EOF-TWKORIN-CSR                                    47170000
471800         OR WKORIN-STRT-TMST = PC-DEFAULT-TMST                    47180000
471900             PERFORM 6575-CLOSE-TWKORIN                           47190000
472000                                                                  47200000
472100             IF PS-NOT-DONE                                       47210000
472200                 PERFORM 6800-OPEN-WKORIN0-CURSOR                 47220000
472300             END-IF                                               47230000
472400                                                                  47240000
472500             IF PS-NOT-DONE                                       47250000
472600                 PERFORM 6850-FETCH-TWKORIN-ZERO                  47260000
472700             END-IF                                               47270000
472800                                                                  47280000
472900             IF PS-NOT-DONE                                       47290000
473000                 IF WKORIN-STRT-TMST = PC-DEFAULT-TMST            47300000
473100                     MOVE WKORIN-PRC-FCLTY-AREA-ID                47310000
473200                       TO PV-PRC-FCLTY-AREA-ID                    47320000
473300                     MOVE 'N' TO PS-TWKORIN-ZERO-SW               47330000
473400                     PERFORM 6805-CLOSE-WKORIN0                   47340000
473500                 ELSE                                             47350000
473600                     MOVE WKORIN-PRC-FCLTY-AREA-ID                47360000
473700                       TO PV-PRC-FCLTY-AREA-ID                    47370000
473800                     PERFORM 6850-FETCH-TWKORIN-ZERO              47380000
473900                       UNTIL PS-EOF-TWKORIN-ZERO                  47390000
474000                          OR PS-DONE                              47400000
474100                                                                  47410000
474200                     IF PS-NOT-DONE                               47420000
474300                         PERFORM 6805-CLOSE-WKORIN0               47430000
474400                     END-IF                                       47440000
474500                 END-IF                                           47450000
474600             END-IF                                               47460000
474700         ELSE                                                     47470000
474800             MOVE WKORIN-PRC-FCLTY-AREA-ID                        47480000
474900               TO PV-PRC-FCLTY-AREA-ID                            47490000
475000             PERFORM 6650-FETCH-TWKORIN                           47500000
475100               UNTIL PS-EOF-TWKORIN-CSR                           47510000
475200                  OR PS-DONE                                      47520000
475300                                                                  47530000
475400             IF PS-NOT-DONE                                       47540000
475500                 PERFORM 6575-CLOSE-TWKORIN                       47550000
475600             END-IF                                               47560000
475700         END-IF                                                   47570000
475800     END-IF.                                                      47580000
475900                                                                  47590000
476000******************************************************************47600000
476100**                                                              **47610009
476200******************************************************************47620009
476300 6650-FETCH-TWKORIN.                                              47630009
476400                                                                  47640000
476500     MOVE '6650-FETCH-TWKORIN'         TO TM007-RETURNED-PARA.    47650029
476700                                                                  47670000
476800     EXEC SQL                                                     47680000
476900          FETCH TWKORIN-CSR                                       47690000
477000           INTO :WKORIN-STRT-TMST                                 47700000
477100              , :WKORIN-STOP-TMST                                 47710000
477200              , :WKORIN-PRC-FCLTY-AREA-ID                         47720000
477300              , :WKORIN-SCREEN-SEQ-NBR                            47730000
477400     END-EXEC.                                                    47740000
477500                                                                  47750000
477600     EVALUATE TRUE                                                47760000
477700         WHEN SQLCODE = +0                                        47770000
477800              PERFORM 6675-CHECK-DATES                            47780000
477900         WHEN SQLCODE = +100                                      47790000
478000              SET PS-EOF-TWKORIN-CSR TO TRUE                      47800000
478100         WHEN SQLWARN0 NOT = SPACES                               47810000
478200         WHEN SQLCODE < ZERO                                      47820000
478300         WHEN SQLCODE > ZERO                                      47830000
478400           SET PS-DONE  TO TRUE                                   47840008
478500           DISPLAY '**************************************'       47850008
478600           DISPLAY '**    UNSUCCESSFUL FETCH            **'       47860008
478700           DISPLAY '**************************************'       47870008
478800           DISPLAY '** ABEND                            **'       47880008
478900           DISPLAY '** PROGRAM = TMKUP521               **'       47890014
479000           DISPLAY '** PARA = 6650-FETCH-TWKORIN'                 47900008
479100           DISPLAY '** DB2 OPER  = FETCH CURSOR         **'       47910008
479200           DISPLAY '**************************************'       47920008
479400     END-EVALUATE.                                                47940000
479500                                                                  47950000
479600******************************************************************47960000
479700**                                                              **47970009
479800******************************************************************47980009
479900 6675-CHECK-DATES.                                                47990009
480000                                                                  48000000
480100     IF WKORIN-STRT-TMST NOT = PC-DEFAULT-TMST                    48010000
480200         IF WKORIN-STOP-TMST NOT = PC-DEFAULT-TMST                48020000
480300             MOVE WKORIN-PRC-FCLTY-AREA-ID                        48030000
480400               TO PV-PRC-FCLTY-AREA-ID                            48040000
480500         ELSE                                                     48050000
480600             MOVE WKORIN-PRC-FCLTY-AREA-ID                        48060000
480700               TO PV-PRC-FCLTY-AREA-ID                            48070000
480800             SET PS-EOF-TWKORIN-CSR TO TRUE                       48080000
480900         END-IF                                                   48090000
481000     ELSE                                                         48100000
481100         SET PS-EOF-TWKORIN-CSR TO TRUE                           48110000
481200     END-IF.                                                      48120000
481300                                                                  48130000
481400                                                                  48140000
481500******************************************************************48150009
481600**                                                              **48160009
481700******************************************************************48170009
481800 6800-OPEN-WKORIN0-CURSOR.                                        48180000
481900                                                                  48190000
482000     MOVE '6800-OPEN-WKORIN0-CURSOR'   TO TM007-RETURNED-PARA.    48200029
482200                                                                  48220000
482300     EXEC SQL                                                     48230000
482400         OPEN WKORIN0-CSR                                         48240000
482500     END-EXEC.                                                    48250000
482600                                                                  48260000
482700     EVALUATE TRUE                                                48270000
482710         WHEN SQLCODE = ZERO                                      48271030
482720              CONTINUE                                            48272030
482800         WHEN SQLWARN0 NOT = SPACES                               48280000
482900         WHEN SQLCODE < ZERO                                      48290000
483000         WHEN SQLCODE > ZERO                                      48300000
483100           SET PS-DONE  TO TRUE                                   48310008
483200           DISPLAY '**************************************'       48320008
483300           DISPLAY '**    UNSUCCESSFUL OPEN OF CURSOR   **'       48330008
483400           DISPLAY '**************************************'       48340008
483500           DISPLAY '** ABEND                            **'       48350008
483600           DISPLAY '** PROGRAM = TMKUP521               **'       48360014
483700           DISPLAY '** PARA = 6800-OPEN-WKORIN0-CURSOR'           48370008
483800           DISPLAY '** DB2 OPER  = OPEN CURSOR          **'       48380008
483900           DISPLAY '**************************************'       48390008
484300     END-EVALUATE.                                                48430000
484400                                                                  48440000
484500******************************************************************48450000
484600**                                                              **48460008
484700******************************************************************48470008
484800 6805-CLOSE-WKORIN0.                                              48480008
484900                                                                  48490000
485000     MOVE '6805-CLOSE-WKORIN0'      TO TM007-RETURNED-PARA.       48500029
485200                                                                  48520000
485300     EXEC SQL                                                     48530000
485400         CLOSE WKORIN0-CSR                                        48540000
485500     END-EXEC.                                                    48550000
485600                                                                  48560000
485700     EVALUATE TRUE                                                48570000
485800         WHEN SQLWARN0 NOT = SPACES                               48580000
485900         WHEN SQLCODE < ZERO                                      48590000
486000         WHEN SQLCODE > ZERO                                      48600000
486100           SET PS-DONE  TO TRUE                                   48610008
486200           DISPLAY '**************************************'       48620008
486300           DISPLAY '**    UNSUCCESSFUL CLOSE OF CURSOR  **'       48630008
486400           DISPLAY '**************************************'       48640008
486500           DISPLAY '** ABEND                            **'       48650008
486600           DISPLAY '** PROGRAM = TMKUP521               **'       48660014
486700           DISPLAY '** PARA = 6805-CLOSE-WKORIN0'                 48670008
486800           DISPLAY '** DB2 OPER  = CLOSE CURSOR         **'       48680008
486900           DISPLAY '**************************************'       48690008
487300     END-EVALUATE.                                                48730000
487400                                                                  48740000
487500******************************************************************48750000
487600**                                                              **48760008
487700******************************************************************48770008
487800 6850-FETCH-TWKORIN-ZERO.                                         48780008
487900                                                                  48790000
488000     MOVE '6850-FETCH-TWKORIN-ZERO'   TO TM007-RETURNED-PARA.     48800029
488200                                                                  48820000
488300     EXEC SQL                                                     48830000
488400          FETCH WKORIN0-CSR                                       48840000
488500           INTO :WKORIN-STRT-TMST                                 48850000
488600              , :WKORIN-STOP-TMST                                 48860000
488700              , :WKORIN-PRC-FCLTY-AREA-ID                         48870000
488800              , :WKORIN-SCREEN-SEQ-NBR                            48880000
488900     END-EXEC.                                                    48890000
489000                                                                  48900000
489100     EVALUATE TRUE                                                48910000
489200         WHEN SQLCODE = +0                                        48920000
489300              PERFORM 6860-CHECK-DATES                            48930000
489400         WHEN SQLCODE = +100                                      48940000
489500              SET PS-EOF-TWKORIN-ZERO TO TRUE                     48950000
489600         WHEN SQLWARN0 NOT = SPACES                               48960000
489700         WHEN SQLCODE < ZERO                                      48970000
489800         WHEN SQLCODE > ZERO                                      48980000
489900           SET PS-DONE  TO TRUE                                   48990008
490000           DISPLAY '**************************************'       49000008
490100           DISPLAY '**    UNSUCCESSFUL FETCH            **'       49010008
490200           DISPLAY '**************************************'       49020008
490300           DISPLAY '** ABEND                            **'       49030008
490400           DISPLAY '** PROGRAM = TMKUP521               **'       49040014
490500           DISPLAY '** PARA = 6850-FETCH-TWKORIN-ZERO'            49050008
490600           DISPLAY '** DB2 OPER  = FETCH CURSOR         **'       49060008
490700           DISPLAY '**************************************'       49070008
490800     END-EVALUATE.                                                49080000
490900                                                                  49090000
491000******************************************************************49100001
491100**                                                              **49110001
491200******************************************************************49120001
491300 6860-CHECK-DATES.                                                49130000
491400                                                                  49140000
491500     IF WKORIN-STRT-TMST NOT = PC-DEFAULT-TMST                    49150000
491600         IF WKORIN-STOP-TMST NOT = PC-DEFAULT-TMST                49160000
491700             MOVE WKORIN-PRC-FCLTY-AREA-ID                        49170000
491800               TO PV-PRC-FCLTY-AREA-ID                            49180000
491900         ELSE                                                     49190000
492000             MOVE WKORIN-PRC-FCLTY-AREA-ID                        49200000
492100               TO PV-PRC-FCLTY-AREA-ID                            49210000
492200             SET PS-EOF-TWKORIN-CSR TO TRUE                       49220000
492300         END-IF                                                   49230000
492400     ELSE                                                         49240000
492500         MOVE WKORIN-PRC-FCLTY-AREA-ID                            49250000
492600           TO PV-PRC-FCLTY-AREA-ID                                49260000
492700         SET PS-EOF-TWKORIN-CSR TO TRUE                           49270000
492800     END-IF.                                                      49280000
492900                                                                  49290000
493000******************************************************************49300020
493100**                                                              **49310020
493200******************************************************************49320020
493300 8000-GET-RANDOM-NBR.                                             49330020
493400                                                                  49340020
493500     MOVE '8000-GET-RANDOM-NBR'       TO TM007-RETURNED-PARA      49350029
493700                                                                  49370020
493800     CALL PC-RAND-PGM USING DP902-RANDNBR-ROUTINE-FIELDS.         49380020
493900                                                                  49390020
494000     IF DP902-SUCCESSFUL                                          49400020
494100         CONTINUE                                                 49410020
494200     ELSE                                                         49420020
494300         SET PS-DONE      TO TRUE                                 49430020
494400         DISPLAY '**************************************'         49440020
494500         DISPLAY '** UNSUCCESSFUL CALL TO RAND NBR PGM**'         49450020
494600         DISPLAY '**************************************'         49460020
494700         DISPLAY '** ABEND                            **'         49470020
494800         DISPLAY '** PROGRAM = DPKUT902               **'         49480020
494900         DISPLAY '** PARA = 8000-GET-RANDOM-NBR       **'         49490020
495000         DISPLAY '**************************************'         49500020
495200     END-IF.                                                      49520020
495300                                                                  49530020
