000100 IDENTIFICATION DIVISION.                                                 
000200 TITLE 'PO AUDIT EXCEPT CRIT SPEC - SUSAUDPO'.                            
000300 PROGRAM-ID.    SUKCS584.                                                 
000400 AUTHOR.        DENNIS STEFFEN.                                           
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
000600 DATE-WRITTEN.  WINTER 2001.                                              
000700 DATE-COMPILED.                                                           
000900*----------------------------------------------------------------*        
001500*    CHANGES                                                     *        
      *    MADE BY: SHOBHIT BAIJAL       PR#5148D                      *        
      *    DATE:    10/05/2013                                         *        
      *                                                                *        
      *    NEW PACKAGING TYPE 'RF' WAS ADDED FOR RFID AUDITS AND LOGIC *        
      *    TO POPULATE RFID ERRORS.                                    *        
      *    CHANGES CAN BE FOUND WITH *SB 10/05/2013                    *        
001600*----------------------------------------------------------------*        
263968* CHANGED 11/15/2021    BY JIM HUNTER      WR: CHG0263968                 
263968* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263968* MAKING THE CALL DYNAMIC VS STATIC.                                      
001130*                                                                         
001110* CHANGED 01/09/2023    BY JEAN KURK       WR: CHG0278099                 
001120* CHANGE CALL OF DPKCS030 TO BE DYNAMIC                                   
263968*---------------------------------------------------------------*         
000800                                                                          
000900 ENVIRONMENT DIVISION.                                                    
001000 DATA DIVISION.                                                           
001100 WORKING-STORAGE SECTION.                                                 
001200                                                                          
001300 01  DK-DB2-KEYS.                                                         
001400     05  DK-OPER-UNT-ID               PIC S9(04) COMP VALUE ZERO.         
001500     05  DK-PO-NBR                    PIC S9(09) COMP VALUE ZERO.         
001600     05  DK-PO-LINE-NBR               PIC S9(09) COMP VALUE ZERO.         
001700     05  DK-PREPACK-ID                PIC S9(04) COMP VALUE ZERO.         
001800                                                                          
001900     05  DK-LNE-NBR-FROM              PIC S9(09) COMP VALUE ZERO.         
002000     05  DK-LNE-NBR-TO                PIC S9(09) COMP VALUE ZERO.         
002100     05  DK-PREPK-FROM                PIC S9(04) COMP VALUE ZERO.         
002200     05  DK-PREPK-TO                  PIC S9(04) COMP VALUE ZERO.         
002300     05  DK-OPER-FROM                 PIC S9(04) COMP VALUE ZERO.         
002400     05  DK-OPER-TO                   PIC S9(04) COMP VALUE ZERO.         
002500                                                                          
002600                                                                          
002700 01  PV-PROGRAM-VARIABLES.                                                
002800     05  PV-LOCATION.                                                     
002900         10  FILLER                      PIC  X(01)  VALUE '0'.           
003000         10  PV-DP020-LOCATION           PIC  X(03)  VALUE '000'.         
003100     05  PV-LOCATION-N REDEFINES PV-LOCATION                              
003200                                         PIC  9(04).                      
003300     05  PV-CICS-RESPONSE            PIC S9(04)  VALUE ZERO.              
003400     05  PV-STATUS-COUNT              PIC S9(03) COMP-3                   
003500                                                 VALUE ZERO.              
003600                                                                          
003700 01  PC-PROGRAM-CONSTANTS.                                                
003800     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'SU584A'.           
003900     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'SUKM584 '.         
004000     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'SUKCS584'.         
004000     05  PC-LOCATION-MODULE        PIC  X(08)  VALUE  'XLKUT071'.         
004001                                                                          
004002*----------------------------------------------------------------*        
004003*  SYSTEM MESSAGES                                               *        
004004*----------------------------------------------------------------*        
004020* 00005-INVALID VALUE                                            *        
004021* 00007-REQUIRED ENTRY                                           *        
004022* 00008-MUST BE NUMERIC                                          *        
004023* 00009-INVALID DATE                                             *        
004024* 00308-AT LEAST ONE ENTRY IS REQUIRED                           *        
004025* 00973- AT LEAST ONE ENTRY IS REQUIRED                          *        
004026* 02294-INVALID STORE NUMBER                                     *        
004027* 02572-INVALID VALUE - OPER UNIT ID MUST BE A DC LOCATION       *        
004028* 02805-UNABLE TO SELECT UNLOADED AT STORE WITH ANY OTHER STATUS *        
004029* 02806-FROM DATE MUST BE BEFORE THE TO DATE                     *        
004030* 02810-REQUESTED STORE IS NOT WITHIN YOUR DISTRICT              *        
004031* 02858-INVALID PURCHASE ORDER NUMBER                            *        
004032* 02859-LINE NUMBER IS ONLY VALID FOR BULK/CSEPK PURCHASE ORDRE  *        
004033* 02860-PACK ID IS ONLY VALID FOR PREPACK PURCHASE ORDERS        *        
004034* 02861-INVALID LINE NUMBER FOR PURCHASE ORDER ENTERED           *        
004035* 02862-INVALID PACK ID FOR PURCHASE ORDER ENTERED               *        
004036* 02864-PURCHASE ORDER AUDIT EXCEPTION ALREADY EXISTS - USE UPD  *        
004037* 02865-PURCHASE ORDER AUDIT EXCEPTION DOES NOT EXIST - USE ADD  *        
004038* 02866-YOU DO NOT HAVE AUTHORITY TO ADD PURCHASE ORDER AUDIT EXC*        
004039* 02867-YOU DO NOT HAVE AUTHORITY TO UPDATE PURCHASE ORDER AUDIT *        
004040* 02892-PURCHASE ORDER AND/OR OPER UNIT ID ARE REQ FOR THE LIST  *        
004050******************************************************************        
004100     05  PC-TSYMSG-NUMBERS.                                               
004200         10  PC-TSYMSG-00005       PIC  9(05)  VALUE  00005.              
004300         10  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.              
004400         10  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.              
004500         10  PC-TSYMSG-00009       PIC  9(05)  VALUE  00009.              
004600         10  PC-TSYMSG-00308       PIC  9(05)  VALUE  00308.              
004700         10  PC-TSYMSG-00973       PIC  9(05)  VALUE  00973.              
004800         10  PC-TSYMSG-02294       PIC  9(05)  VALUE  02294.              
004900         10  PC-TSYMSG-02572       PIC  9(05)  VALUE  02572.              
005000         10  PC-TSYMSG-02805       PIC  9(05)  VALUE  02805.              
005100         10  PC-TSYMSG-02806       PIC  9(05)  VALUE  02806.              
005200         10  PC-TSYMSG-02810       PIC  9(05)  VALUE  02810.              
005300         10  PC-TSYMSG-02858       PIC  9(05)  VALUE  02858.              
005400         10  PC-TSYMSG-02859       PIC  9(05)  VALUE  02859.              
005500         10  PC-TSYMSG-02860       PIC  9(05)  VALUE  02860.              
005600         10  PC-TSYMSG-02861       PIC  9(05)  VALUE  02861.              
005700         10  PC-TSYMSG-02862       PIC  9(05)  VALUE  02862.              
005800         10  PC-TSYMSG-02864       PIC  9(05)  VALUE  02864.              
005900         10  PC-TSYMSG-02865       PIC  9(05)  VALUE  02865.              
006000         10  PC-TSYMSG-02866       PIC  9(05)  VALUE  02866.              
006100         10  PC-TSYMSG-02867       PIC  9(05)  VALUE  02867.              
006200         10  PC-TSYMSG-02892       PIC  9(05)  VALUE  02892.              
006300*                                                                         
006400                                                                          
006500 01  PM-CICSAUTH-MESSAGE.                                                 
006600     05  FILLER                       PIC  X(36)     VALUE                
006700         'INVALID RETURN CODE FROM CICSAUTH - '.                          
006800     05  PM-CM-RETURN-CODE            PIC  9(04).                         
006900                                                                          
007000                                                                          
007100 01  PS-PROGRAM-SWITCHES.                                                 
007200     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.                
007300         88  PS-ERROR                          VALUE  'Y'.                
007400         88  PS-NO-ERROR                       VALUE  'N'.                
007500     05  PS-DATE-ERROR-SW          PIC  X(01)  VALUE  'N'.                
007600         88  PS-DATE-ERROR                     VALUE  'Y'.                
007700         88  PS-NO-DATE-ERROR                  VALUE  'N'.                
007800     05  PS-AUDIT-FOUND-SW         PIC  X(01)  VALUE  'N'.                
007900         88  PS-AUDIT-FOUND                    VALUE  'Y'.                
008000         88  PS-AUDIT-NOT-FOUND                VALUE  'N'.                
008100     05  PS-TRAILER-EXISTS-SW      PIC  X(01)  VALUE  'N'.                
008200         88  PS-TRAILER-EXISTS                 VALUE  'Y'.                
008300         88  PS-TRAILER-DOESNT-EXIST           VALUE  'N'.                
008400     05  PS-TRIP-EXISTS-SW         PIC  X(01)  VALUE  'N'.                
008500         88  PS-TRIP-EXISTS                    VALUE  'Y'.                
008600         88  PS-TRIP-DOESNT-EXIST              VALUE  'N'.                
008700     05  PS-SCAC-EXISTS-SW         PIC  X(01)  VALUE  'N'.                
008800         88  PS-SCAC-EXISTS                    VALUE  'Y'.                
008900         88  PS-SCAC-DOESNT-EXIST              VALUE  'N'.                
009000     05  PS-TRIP-STATUS-EXISTS-SW  PIC  X(01)  VALUE  'N'.                
009100         88  PS-TRIP-STATUS-EXISTS             VALUE  'Y'.                
009200         88  PS-NO-TRIP-STATUS                 VALUE  'N'.                
009300     05  PS-PO-EXISTS-SW           PIC  X(01)  VALUE  'N'.                
009400         88  PS-PO-EXISTS                      VALUE  'Y'.                
009500         88  PS-PO-DOESNT-EXIST                VALUE  'N'.                
009600     05  PS-RECEIVER-EXISTS-SW     PIC  X(01)  VALUE  'N'.                
009700         88  PS-RECEIVER-EXISTS                VALUE  'Y'.                
009800         88  PS-RECEIVER-DOESNT-EXIST          VALUE  'N'.                
009900     05  PS-SHIP-CDE-EXISTS-SW     PIC  X(01)  VALUE  'N'.                
010000         88  PS-SHIP-CDE-EXISTS                VALUE  'Y'.                
010100         88  PS-SHIP-CDE-DOESNT-EXIST          VALUE  'N'.                
010200     05  PS-DEPARTED-CHKD-SW       PIC  X(01)  VALUE  'N'.                
010300         88  PS-DEPARTED-CHKD                  VALUE  'Y'.                
010400         88  PS-DEPARTED-NOT-CHKD              VALUE  'N'.                
010500                                                                          
010600 01  PM-PROGRAM-MESSAGES.                                                 
010700     05  PM-ABEND-INFO-A.                                                 
010800         10  FILLER                PIC X(15)   VALUE                      
010900                                   'DP020-SRC-AID: '.                     
011000         10  PM-A-SRC-AID          PIC X(02)   VALUE  SPACE.              
011100         10  FILLER                PIC X(19)   VALUE                      
011200                                   '. DP020-FK-ACTION: '.                 
011300         10  PM-A-FK-ACTION        PIC X(01)   VALUE  SPACE.              
011400         10  FILLER                PIC X(22)   VALUE                      
011500                                   '. DP020-FK-DISPN-IND: '.              
011600         10  PM-A-FK-DISPN         PIC X(01)   VALUE  SPACE.              
011700         10  FILLER                PIC X(01)   VALUE '.'.                 
011800         10  FILLER                PIC X(19)   VALUE SPACE.               
011900                                                                          
012000                                                                          
012100*    MAP LAYOUT                                                  *        
012200     COPY SUKM584.                                                        
012300/                                                                         
012400*    RACF                                                                 
012500     COPY DPWS008.                                                        
012600*    ATTRIBUTE SETTINGS                                                   
012700     COPY DPWS015.                                                        
012800                                                                          
012900*    FUNCTION KEYS                                                        
013000                                                                          
013100     COPY DPWS016.                                                        
013200/                                                                         
013300** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **        
013400** SUB-ROUTINE (DPKUT100).                                      **        
013500     COPY DPWS010I.                                                       
013600/                                                                         
013800** PARAMETERS FOR CALLING CICS ARCHITECTURE API                 **        
013900     COPY DPWS030.                                                        
013900     COPY DPWS930.                                                        
014000/                                                                         
014100*    STANDARD COMMAREA.                                                   
014200     COPY DPWS020.                                                        
014300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                        
014400                                                                          
014500*    INTER-APPLICATION COMMAREA.                                          
014600                                                                          
014700         10  INTER-APPL-COMM-AREA PIC X(200).                             
014800     COPY SUWS020.                                                        
014900         10  ASC-SPECIFIC-COMMAREA.                                       
015000             15  ASC-ACCESS-SW               PIC X(01).                   
015100                 88  ASC-ACCESS-ALLOWED          VALUE 'Y'.               
015200                 88  ASC-ACCESS-DENIED           VALUE 'N'.               
015300             15  ASC-AUDIT-TYPE              PIC X(01).                   
015400             15  ASC-PO-NBR                  PIC X(09).                   
015500             15  ASC-PO-NBR-N REDEFINES ASC-PO-NBR                        
015600                                             PIC 9(09).                   
015700             15  ASC-PACKAGING-TYPE          PIC X(15).                   
015800             15  ASC-PKGNG-CDE               PIC X(01).                   
015900             15  ASC-OPER-UNT-ID             PIC X(04).                   
016000             15  ASC-OPER-UNT-ID-N REDEFINES ASC-OPER-UNT-ID              
016100                                             PIC 9(04).                   
016200             15  ASC-OPER-ALL                PIC X(03).                   
016300             15  ASC-STORE-NAME              PIC X(25).                   
016400             15  ASC-PO-LINE-NBR             PIC X(04).                   
016500             15  ASC-PO-LINE-NBR-N REDEFINES ASC-PO-LINE-NBR              
016600                                             PIC 9(04).                   
016700             15  ASC-PREPACK-ID              PIC X(04).                   
016800             15  ASC-PREPACK-ID-N REDEFINES ASC-PREPACK-ID                
016900                                             PIC 9(04).                   
017000             15  ASC-SHIP-FROM-DATE          PIC X(10).                   
017100             15  FILLER REDEFINES ASC-SHIP-FROM-DATE.                     
017200                 20  ASC-SHIP-FROM-MM        PIC X(02).                   
017300                 20  ASC-DASH-1              PIC X(01).                   
017400                 20  ASC-SHIP-FROM-DD        PIC X(02).                   
017500                 20  ASC-DASH-2              PIC X(01).                   
017600                 20  ASC-SHIP-FROM-CCYY      PIC X(04).                   
017700             15  ASC-SHIP-TO-DATE            PIC X(10).                   
017800             15  FILLER REDEFINES ASC-SHIP-TO-DATE.                       
017900                 20  ASC-SHIP-TO-MM          PIC X(02).                   
018000                 20  ASC-DASH-3              PIC X(01).                   
018100                 20  ASC-SHIP-TO-DD          PIC X(02).                   
018200                 20  ASC-DASH-4              PIC X(01).                   
018300                 20  ASC-SHIP-TO-CCYY        PIC X(04).                   
018400                                                                          
018500*    LOCATION MODULE                                                      
018600     COPY XLWS071.                                                        
018700                                                                          
018500*    ABEND PROCESSING                                                     
018600     COPY DPWS013.                                                        
018700/                                                                         
018800*    DATE ROUTINE WORK AREA                                               
018900     COPY DPWS500.                                                        
019000                                                                          
019100*    PO AUDIT EXCEPTION TABLE                                             
019200     EXEC SQL                                                             
019300          INCLUDE SUT00014                                                
019400     END-EXEC.                                                            
019500                                                                          
020100*    PO MASTER                                                            
020200     EXEC SQL                                                             
020300          INCLUDE TPURCHS                                                 
020400     END-EXEC.                                                            
020500                                                                          
020600*    PO LINE MASTER                                                       
020700     EXEC SQL                                                             
020800          INCLUDE TPURITM                                                 
020900     END-EXEC.                                                            
021000                                                                          
021100*    PO MASTER PRE-PACK TABLE                                             
021200     EXEC SQL                                                             
021300          INCLUDE TPOPRPK                                                 
021400     END-EXEC.                                                            
021500                                                                          
021500                                                                          
021600*  COMMUNICATION AREAS FOR DB2                                            
021700*                                                                         
021800     EXEC SQL                                                             
021900         INCLUDE SQLCA                                                    
022000     END-EXEC.                                                            
022100*----------------------------------------------------------------*        
022200                                                                          
022300 EJECT                                                                    
022400 LINKAGE SECTION.                                                         
022500                                                                          
022600 01  DFHCOMMAREA.                                                         
022700     05  FILLER                         OCCURS  1 TO 4072 TIMES           
022800                                        DEPENDING ON EIBCALEN.            
022900         10  FILLER                     PIC X.                            
023000                                                                          
023100                                                                          
023200 PROCEDURE DIVISION.                                                      
023300 0000-MAIN-MODULE.                                                        
023400     INITIALIZE DP030-CICS-API-FIELDS.                                    
023500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.               
023600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.                  
023700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).                 
023800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                               
023900     MOVE LENGTH OF SU584AI        TO DP030-MAP-LENGTH (1).               
024000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).             
024100     PERFORM 0001-CALL-CICS-ARCH-API.                                     
024200*                                                                         
024300     PERFORM 1000-CONTROL-PROCESSING                                      
024400*                                                                         
024500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).             
024600     PERFORM 0001-CALL-CICS-ARCH-API.                                     
024700                                                                          
024800 0001-CALL-CICS-ARCH-API.                                                 
024900*    CALL 'DPKCS030' USING DFHEIBLK                                       
024900     CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
025000                           DFHCOMMAREA                                    
025100                           DP030-CICS-API-FIELDS                          
025200                           DP020-STANDARD-COMMAREA                        
025300                           SU584AI.                                       
025400*                                                                         
025500     IF  DP030-RC-CALL-SUCCESSFUL                                         
025600         CONTINUE                                                         
025700     ELSE                                                                 
025800         SET DP013-NO-ROLLBACK                                            
025900             DP013-XCTL-DISPLAY-RESTART                                   
026000             DP013-CICS-ABEND      TO TRUE                                
026100         MOVE 'BEFORE 0000-MAIN-MODULE'                                   
026200                                   TO DP013-PARAGRAPH                     
026300*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX        
026400*             'T LINE'             TO DP013-MESSAGE-TEXT (2)              
026300         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
026400-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
026500         MOVE DP030-RETURN-CODE                                           
026600                                   TO DP013-MESSAGE-TEXT (3)              
026700         PERFORM DP013-0000-PROCESS-ABEND                                 
026800     END-IF.                                                              
026900 EJECT                                                                    
027000*----------------------------------------------------------------*        
027100*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *        
027200*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *        
027300*----------------------------------------------------------------*        
027400                                                                          
027500 1000-CONTROL-PROCESSING.                                                 
027600                                                                          
027700     EVALUATE TRUE                                                        
027800         WHEN DP020-NEXT-ACT-INITIAL                                      
027900             INITIALIZE ASC-SPECIFIC-COMMAREA                             
028000                        SU020-INTER-APPL-COMMAREA                         
028100             PERFORM 4000-BUILD-INITIAL-PANEL                             
028200             PERFORM 3200-RESET-ATTRIBUTES                                
028300         WHEN DP020-NEXT-ACT-RETURN                                       
028400             MOVE -1                  TO APOL                             
028500             SET DP030-SET-CURSOR-APPL-1                                  
028600                                      TO TRUE                             
028700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
028800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
028900                                                                          
029000                                                                          
029100         WHEN DP020-NEXT-ACT-READ-MAP                                     
029200             PERFORM 2000-FKEY-PROCESSING                                 
029300                                                                          
029400         WHEN OTHER                                                       
029500             SET DP013-LOGIC-ABEND                                        
029600                 DP013-NO-ROLLBACK TO TRUE                                
029700             MOVE '1000-CONTROL-PROCESSING'                               
029800                                   TO  DP013-PARAGRAPH                    
029900             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'           
030000                                   TO  DP013-MESSAGE-TEXT(1)              
030100             MOVE DP020-NEXT-APPL-ACTIVITY                                
030200                                   TO DP013-MESSAGE-TEXT(2)               
030300             PERFORM DP013-0000-PROCESS-ABEND                             
030400     END-EVALUATE.                                                        
030500                                                                          
030600*----------------------------------------------------------------*        
030700* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*        
030800* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*        
030900* EDITS.                                                         *        
031000*----------------------------------------------------------------*        
031100                                                                          
031200 2000-FKEY-PROCESSING.                                                    
031300                                                                          
031400     EVALUATE TRUE                                                        
031500                                                                          
031600         WHEN DP020-SRC-AID = DP016-CLEAR                                 
031700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
031800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
031900                                                                          
032000         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                             
032100             INITIALIZE ASC-SPECIFIC-COMMAREA                             
032200             PERFORM 4000-BUILD-INITIAL-PANEL                             
032300             PERFORM 3200-RESET-ATTRIBUTES                                
032400                                                                          
032500         WHEN OTHER                                                       
032600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                         
032700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
032800*            PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
032900             IF  PS-NO-ERROR                                              
033000                 SET DP030-CONTINUE-GO TO TRUE                            
033100                 PERFORM 2100-CHECK-FUNCTION-KEY                          
033200             ELSE                                                         
033300                 SET DP030-OVERRIDE-GO TO TRUE                            
033400             END-IF                                                       
033500     END-EVALUATE.                                                        
033600******************************************************************        
033700** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **        
033800** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **        
033900** FROM THE CICS ARCHITECTURE API.                              **        
034000******************************************************************        
034100 2100-CHECK-FUNCTION-KEY.                                                 
034200     EVALUATE TRUE                                                        
034300         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                      
034400         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)                      
034500         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)                      
034600             PERFORM 2110-PREPARE-INTER-APPL-COMM                         
034700                                                                          
034800         WHEN DP020-SRC-AID = DP016-ENTER                                 
034900             MOVE -1                  TO APOL                             
035000             SET DP030-SET-CURSOR-APPL-1                                  
035100                                      TO TRUE                             
035200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
035300                                                                          
035400         WHEN OTHER                                                       
035500             SET DP013-NO-ROLLBACK                                        
035600                 DP013-XCTL-DISPLAY-RESTART                               
035700                 DP013-CICS-ABEND  TO TRUE                                
035800             MOVE '2100-CHECK-FUNCTION-KEY'                               
035900                                   TO DP013-PARAGRAPH                     
036000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'              
036100                                   TO DP013-MESSAGE-TEXT (1)              
036200             MOVE 'OR CODE MISSING FROM THIS PROGRAM TO PROCESS:'         
036300                                   TO DP013-MESSAGE-TEXT (2)              
036400             MOVE DP020-SRC-AID    TO PM-A-SRC-AID                        
036500             MOVE DP020-FK-ACTION (DP020-SRC-AID)                         
036600                                   TO PM-A-FK-ACTION                      
036700             MOVE DP020-FK-DISPN-IND (DP020-SRC-AID)                      
036800                                   TO PM-A-FK-DISPN                       
036900             MOVE PM-ABEND-INFO-A  TO DP013-MESSAGE-TEXT (3)              
037000             MOVE 'REVIEW PFKEYS SETUP FOR THIS MNEMONIC.'                
037100                                   TO DP013-MESSAGE-TEXT (4)              
037200             PERFORM DP013-0000-PROCESS-ABEND                             
037300     END-EVALUATE.                                                        
037400                                                                          
037500******************************************************************        
037600** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **        
037700** INTER-APPLICATION COMMAREA.                                  **        
037800******************************************************************        
037900 2110-PREPARE-INTER-APPL-COMM.                                            
038000     INITIALIZE SU020-INTER-APPL-COMMAREA.                                
038100     MOVE ASC-AUDIT-TYPE              TO SU020-AUDIT-TYPE                 
038200     MOVE ASC-PO-NBR-N                TO SU020-PO-NBR                     
038300     MOVE ASC-OPER-UNT-ID-N           TO SU020-OPER-UNT-ID                
038400     MOVE ASC-OPER-ALL                TO SU020-OPER-ALL                   
038500     MOVE ASC-PKGNG-CDE               TO SU020-PKGNG-CDE                  
038600     MOVE ASC-PACKAGING-TYPE          TO SU020-PKGNG-DESC                 
038700     MOVE ASC-PO-LINE-NBR-N           TO SU020-PO-LINE-NBR                
038800     MOVE ASC-PREPACK-ID-N            TO SU020-PREPACK-ID                 
038900                                                                          
039000     IF ASC-SHIP-FROM-DATE = SPACES                                       
039100         MOVE '01-01-0001'            TO ASC-SHIP-FROM-DATE               
039200     END-IF                                                               
039300     IF ASC-SHIP-TO-DATE = SPACES                                         
039400         MOVE '09-09-9999'            TO ASC-SHIP-TO-DATE                 
039500     END-IF                                                               
039600     STRING                                                               
039700             ASC-SHIP-FROM-CCYY                                           
039800            '-'                                                           
039900            ASC-SHIP-FROM-MM                                              
040000            '-'                                                           
040100            ASC-SHIP-FROM-DD                                              
040200             DELIMITED BY SIZE        INTO SU020-SHIP-FROM-DATE           
040300     STRING                                                               
040400             ASC-SHIP-TO-CCYY                                             
040500            '-'                                                           
040600            ASC-SHIP-TO-MM                                                
040700            '-'                                                           
040800            ASC-SHIP-TO-DD                                                
040900             DELIMITED BY SIZE        INTO SU020-SHIP-TO-DATE.            
041000                                                                          
041100/                                                                         
041200 2200-MOVE-SCREEN-TO-COMMAREA.                                            
041300     IF  APOL > ZERO                                                      
041400         MOVE APOI                TO ASC-PO-NBR                           
041500     ELSE                                                                 
041600         IF APOF = DP015-ERASE-EOF                                        
041700             MOVE SPACES           TO ASC-PO-NBR                          
041800                                      APKGTYPO                            
041900         END-IF                                                           
042000     END-IF                                                               
042100                                                                          
042200     IF  AOPERL > ZERO                                                    
042300         MOVE AOPERI               TO ASC-OPER-UNT-ID                     
042400     ELSE                                                                 
042500         IF AOPERF = DP015-ERASE-EOF                                      
042600             MOVE SPACE            TO ASC-OPER-UNT-ID                     
042700                                      ASC-STORE-NAME                      
042800         END-IF                                                           
042900     END-IF                                                               
043000                                                                          
043100     IF  ALINEL > ZERO                                                    
043200         MOVE ALINEI              TO ASC-PO-LINE-NBR                      
043300     ELSE                                                                 
043400         IF ALINEF = DP015-ERASE-EOF                                      
043500             MOVE SPACE            TO ASC-PO-LINE-NBR                     
043600         END-IF                                                           
043700     END-IF                                                               
043800                                                                          
043900     IF  APREPKL > ZERO                                                   
044000         MOVE APREPKI             TO ASC-PREPACK-ID                       
044100     ELSE                                                                 
044200         IF APREPKF = DP015-ERASE-EOF                                     
044300             MOVE SPACE            TO ASC-PREPACK-ID                      
044400         END-IF                                                           
044500     END-IF                                                               
044600                                                                          
044700     IF  AFMML > ZERO                                                     
044800         MOVE AFMMI               TO ASC-SHIP-FROM-MM                     
044900     ELSE                                                                 
045000         IF AFMMF = DP015-ERASE-EOF                                       
045100             MOVE SPACE            TO ASC-SHIP-FROM-MM                    
045200                                      ASC-DASH-1                          
045300         END-IF                                                           
045400     END-IF                                                               
045500                                                                          
045600     IF  AFDDL > ZERO                                                     
045700         MOVE AFDDI               TO ASC-SHIP-FROM-DD                     
045800     ELSE                                                                 
045900         IF AFDDF = DP015-ERASE-EOF                                       
046000             MOVE SPACE            TO ASC-SHIP-FROM-DD                    
046100                                      ASC-DASH-2                          
046200         END-IF                                                           
046300     END-IF                                                               
046400                                                                          
046500     IF  AFYYL > ZERO                                                     
046600         MOVE AFYYI               TO ASC-SHIP-FROM-CCYY                   
046700     ELSE                                                                 
046800         IF AFYYF = DP015-ERASE-EOF                                       
046900             MOVE SPACE            TO ASC-SHIP-FROM-CCYY                  
047000                                      ASC-DASH-3                          
047100         END-IF                                                           
047200     END-IF                                                               
047300                                                                          
047400                                                                          
047500     IF  ATMML > ZERO                                                     
047600         MOVE ATMMI               TO ASC-SHIP-TO-MM                       
047700     ELSE                                                                 
047800         IF ATMMF = DP015-ERASE-EOF                                       
047900             MOVE SPACE            TO ASC-SHIP-TO-MM                      
048000                                      ASC-DASH-4                          
048100         END-IF                                                           
048200     END-IF                                                               
048300                                                                          
048400     IF  ATDDL > ZERO                                                     
048500         MOVE ATDDI               TO ASC-SHIP-TO-DD                       
048600     ELSE                                                                 
048700         IF ATDDF = DP015-ERASE-EOF                                       
048800             MOVE SPACE            TO ASC-SHIP-TO-DD                      
048900         END-IF                                                           
049000     END-IF                                                               
049100                                                                          
049200     IF  ATYYL > ZERO                                                     
049300         MOVE ATYYI               TO ASC-SHIP-TO-CCYY                     
049400     ELSE                                                                 
049500         IF ATYYF = DP015-ERASE-EOF                                       
049600             MOVE SPACE            TO ASC-SHIP-TO-CCYY                    
049700         END-IF                                                           
049800     END-IF                                                               
049900                                                                          
050000     IF  AAUDTYPL > ZERO                                                  
050100         IF AAUDTYPI = SPACE                                              
050200             MOVE 'B'                TO ASC-AUDIT-TYPE                    
050300         ELSE                                                             
050400             MOVE AAUDTYPI           TO ASC-AUDIT-TYPE                    
050500         END-IF                                                           
050600     ELSE                                                                 
050700         IF ATYYF = DP015-ERASE-EOF                                       
050800             MOVE 'B'              TO ASC-AUDIT-TYPE                      
050900         END-IF                                                           
051000     END-IF.                                                              
051100/                                                                         
051200 3000-EDIT-DATA-IN-COMMAREA.                                              
051300     PERFORM 3200-RESET-ATTRIBUTES.                                       
051400                                                                          
051500     EVALUATE TRUE                                                        
051600         WHEN DP020-SRC-AID = DP016-ENTER                                 
051700         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)                      
051800*            (EXCEPTION LIST SCREEN)                                      
051900             PERFORM 3001-EDIT-AUDIT-TYPE                                 
052000                                                                          
052100*            BOTH DATES HAVE TO BE ENTERED OR NONE AT ALL                 
052200             EVALUATE TRUE                                                
052300                 WHEN ASC-SHIP-FROM-DATE = SPACES                         
052400                         AND ASC-SHIP-TO-DATE = SPACES                    
052500                     CONTINUE                                             
052600                 WHEN ASC-SHIP-FROM-DATE > SPACES                         
052700                       AND ASC-SHIP-TO-DATE = SPACES                      
052800                     MOVE -1          TO ATMML                            
052900                     MOVE DP015-RED   TO ATMMC                            
053000                                         ATDDC                            
053100                                         ATYYC                            
053200                     SET DP020-MSG-FATAL                                  
053300                         DP030-SET-CURSOR-APPL-1                          
053400                         PS-DATE-ERROR                                    
053500                         PS-ERROR     TO TRUE                             
053600                         MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         
053700                 WHEN ASC-SHIP-FROM-DATE = SPACES                         
053800                          AND ASC-SHIP-TO-DATE > SPACES                   
053900                     MOVE -1          TO AFMML                            
054000                     MOVE DP015-RED   TO AFMMC                            
054100                                         AFDDC                            
054200                                         AFYYC                            
054300                     SET DP020-MSG-FATAL                                  
054400                         DP030-SET-CURSOR-APPL-1                          
054500                         PS-DATE-ERROR                                    
054600                         PS-ERROR     TO TRUE                             
054700                         MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         
054800                 WHEN OTHER                                               
054900                     PERFORM 3007-EDIT-DATES                              
055000                 END-EVALUATE                                             
055100                                                                          
055200             IF ASC-PO-NBR > SPACES                                       
055300                 PERFORM 3003-EDIT-PO-NBR                                 
055400             END-IF                                                       
055401                                                                          
055500                                                                          
055600             IF ASC-PO-NBR > SPACES AND PS-NO-ERROR                       
055700                 PERFORM 3004A-EDIT-LINE-FOR-NUMERIC                      
055800                 PERFORM 3006A-EDIT-PREPACK-FOR-NUMERIC                   
055900                                                                          
055910             PERFORM 3000A-CONSISTENCY                                    
059400             END-IF                                                       
059500                                                                          
059600             IF ASC-OPER-UNT-ID > SPACES                                  
059700                 PERFORM 3005-EDIT-OPER-UNT                               
059800             END-IF                                                       
059900                                                                          
060000             IF PS-NO-ERROR                                               
060100                 PERFORM 3009-PO-OPER-CHECK                               
060200             END-IF                                                       
060300                                                                          
060400*            IF PS-NO-ERROR                                               
060500*            THIS AVOIDS DATE FORMAT ERRORS IN SUKCS586                   
060600*                IF ASC-SHIP-FROM-DATE = SPACES                           
060700*                    MOVE '01-01-0001' TO ASC-SHIP-FROM-DATE              
060800*                END-IF                                                   
060900*                IF ASC-SHIP-TO-DATE = SPACES                             
061000*                    MOVE '09-09-9999' TO ASC-SHIP-TO-DATE                
061100*                END-IF                                                   
061200*            END-IF                                                       
061300                                                                          
061400                                                                          
061500         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                      
061600*            (ADD EXCEPTION SCREEN)                                       
061700             PERFORM 30021-FUNC01-RACF                                    
061800                                                                          
061900             IF PS-NO-ERROR AND ASC-OPER-UNT-ID > SPACES                  
062000                 PERFORM 3005-EDIT-OPER-UNT                               
062100             END-IF                                                       
062200                                                                          
062320             IF PS-NO-ERROR                                               
062400                 PERFORM 3003-EDIT-PO-NBR                                 
062500             END-IF                                                       
062600                                                                          
062700             PERFORM 3004A-EDIT-LINE-FOR-NUMERIC                          
062800             PERFORM 3006A-EDIT-PREPACK-FOR-NUMERIC                       
062900                                                                          
062910             PERFORM 3000A-CONSISTENCY                                    
062920                                                                          
063000             IF PS-NO-ERROR AND ASC-PO-NBR-N > ZEROES                     
063100                     AND ASC-PO-LINE-NBR > ZERO                           
063200                 PERFORM 3004-EDIT-PO-LINE-NBR                            
063300             END-IF                                                       
063400             IF PS-NO-ERROR                                               
063500                 PERFORM 3008-PREEXISTING-EXCEPTIONS                      
063600                 IF PS-AUDIT-FOUND                                        
063700                     MOVE -1          TO APOL                             
063800                     MOVE DP015-RED   TO APOC                             
063900                     SET DP020-MSG-FATAL                                  
064000                         DP030-SET-CURSOR-APPL-1                          
064100                         PS-ERROR     TO TRUE                             
064200                     MOVE PC-TSYMSG-02864                                 
064300                                      TO DP020-MSG-NUMBER                 
064400                 END-IF                                                   
064500             END-IF                                                       
064600                                                                          
064700         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)                      
064800*            (UPDATE EXCEPTION SCREEN)                                    
064900             PERFORM 30022-FUNC02-RACF                                    
065000                                                                          
065100             IF PS-NO-ERROR AND ASC-OPER-UNT-ID > SPACES                  
065200                 PERFORM 3005-EDIT-OPER-UNT                               
065300             END-IF                                                       
065400                                                                          
065500             IF PS-NO-ERROR                                               
065600                 PERFORM 3003-EDIT-PO-NBR                                 
065700             END-IF                                                       
065800                                                                          
065900             PERFORM 3004A-EDIT-LINE-FOR-NUMERIC                          
066000             PERFORM 3006A-EDIT-PREPACK-FOR-NUMERIC                       
066100                                                                          
066110             PERFORM 3000A-CONSISTENCY                                    
066120                                                                          
066200             IF PS-NO-ERROR AND ASC-PO-NBR-N > ZEROES                     
066300                     AND ASC-PO-LINE-NBR > ZERO                           
066400                 PERFORM 3004-EDIT-PO-LINE-NBR                            
066500             END-IF                                                       
066600                                                                          
066700             IF PS-NO-ERROR                                               
066800                 PERFORM 3008-PREEXISTING-EXCEPTIONS                      
066900                 IF PS-AUDIT-NOT-FOUND                                    
067000                     MOVE -1          TO APOL                             
067100                     MOVE DP015-RED   TO APOC                             
067200                     SET DP020-MSG-FATAL                                  
067300                         DP030-SET-CURSOR-APPL-1                          
067400                         PS-ERROR     TO TRUE                             
067500                     MOVE PC-TSYMSG-02865                                 
067600                                      TO DP020-MSG-NUMBER                 
067700                 END-IF                                                   
067800             END-IF                                                       
067900                                                                          
068000     END-EVALUATE.                                                        
068100                                                                          
068110 3000A-CONSISTENCY.                                                       
068120     EVALUATE TRUE                                                        
068130         WHEN (ASC-PREPACK-ID-N  = ZERO) AND                              
068140              (ASC-PO-LINE-NBR-N = ZERO)                                  
068150             CONTINUE                                                     
068160         WHEN (ASC-PREPACK-ID-N >  ZERO)                                  
068170               AND                                                        
068180             (ASC-PO-LINE-NBR-N >  ZERO)                                  
068190                 MOVE -1          TO ALINEL                               
068191                                         APREPKL                          
068192                 MOVE DP015-RED   TO ALINEC                               
068193                                         APREPKC                          
068194                 SET DP020-MSG-FATAL                                      
068195                     DP030-SET-CURSOR-APPL-1                              
068196                     PS-ERROR     TO TRUE                                 
068197                     MOVE PC-TSYMSG-00973 TO DP020-MSG-NUMBER             
068198         WHEN ASC-PREPACK-ID-N > ZEROES                                   
068199             IF ASC-PKGNG-CDE = 'M' OR 'I'                                
068200                 PERFORM 3006-EDIT-PREPACK                                
068201             ELSE                                                         
068202                 MOVE -1      TO APREPKL                                  
068203                 MOVE DP015-RED                                           
068204                                      TO APREPKC                          
068205                 SET DP020-MSG-FATAL                                      
068206                     DP030-SET-CURSOR-APPL-1                              
068207                     PS-ERROR     TO TRUE                                 
068208                 MOVE PC-TSYMSG-02860 TO DP020-MSG-NUMBER                 
068209             END-IF                                                       
068210         WHEN ASC-PO-LINE-NBR-N > ZERO                                    
068211                                                                          
068212             IF PS-NO-ERROR AND ASC-PO-NBR-N > ZEROES                     
068213                  AND ASC-PO-LINE-NBR-N > ZERO                            
068214                 PERFORM 3004-EDIT-PO-LINE-NBR                            
068215             END-IF                                                       
068216     END-EVALUATE.                                                        
068220                                                                          
068300 3001-EDIT-AUDIT-TYPE.                                                    
           IF ASC-AUDIT-TYPE = 'A' OR 'N' OR 'B' OR                             
      *SB 10/05/13 - BEGIN PR#5148D                                             
                               'R' OR 'Q'                                       
      *SB 10/05/13 - END PR#5148D                                               
068500         CONTINUE                                                         
068600     ELSE                                                                 
068700         MOVE -1                      TO AAUDTYPL                         
068800         MOVE DP015-RED               TO AAUDTYPC                         
068900         SET DP020-MSG-FATAL                                              
069000             DP030-SET-CURSOR-APPL-1                                      
069100             PS-ERROR                 TO TRUE                             
069200             MOVE PC-TSYMSG-00005     TO DP020-MSG-NUMBER                 
069300     END-IF.                                                              
069400                                                                          
069500 30021-FUNC01-RACF.                                                       
069600     MOVE 'SUAUDPOA'                  TO DP008-FUNCTION-NAME              
069700     PERFORM 8000-CALL-RACF.                                              
069800     IF DP008-ACCESS-ALLOWED                                              
069900         CONTINUE                                                         
070000     ELSE                                                                 
070100         MOVE -1                      TO APOL                             
070200         SET DP020-MSG-FATAL                                              
070300             DP030-SET-CURSOR-APPL-1                                      
070400             PS-ERROR                 TO TRUE                             
070500             MOVE PC-TSYMSG-02866     TO DP020-MSG-NUMBER                 
070600     END-IF.                                                              
070700                                                                          
070800 30022-FUNC02-RACF.                                                       
070900     MOVE 'SUAUDPOU'                  TO DP008-FUNCTION-NAME              
071000     PERFORM 8000-CALL-RACF.                                              
071100     IF DP008-ACCESS-ALLOWED                                              
071200         CONTINUE                                                         
071300     ELSE                                                                 
071400         MOVE -1                      TO APOL                             
071500         SET DP020-MSG-FATAL                                              
071600             DP030-SET-CURSOR-APPL-1                                      
071700             PS-ERROR                 TO TRUE                             
071800             MOVE PC-TSYMSG-02867     TO DP020-MSG-NUMBER                 
071900     END-IF.                                                              
072000                                                                          
072100 3003-EDIT-PO-NBR.                                                        
072200     MOVE ASC-PO-NBR                  TO DP010I-UNEDITED-FIELD            
072300     MOVE +9                          TO DP010I-MAXIMUM-DIGITS            
072400     MOVE ZERO                        TO DP010I-MAXIMUM-DECIMALS          
072500     SET DP010I-NEGATIVE-NOT-ALLOWED  TO TRUE                             
072600                                                                          
263968     CALL DP010I-NUMERIC-EDIT-ROUTINE                                     
263968          USING DP010I-NUMERIC-EDIT-AREA                                  
072800                                                                          
072900     IF DP010I-NO-ERROR-DETECTED                                          
073000         MOVE DP010I-NUMERIC-FIELD                                        
073100                                      TO DK-PO-NBR                        
073200                                         ASC-PO-NBR-N                     
073300                                         SU020-PO-NBR                     
073400     ELSE                                                                 
073500         MOVE -1                      TO APOL                             
073600         MOVE DP015-RED               TO APOC                             
073700         MOVE PC-TSYMSG-00008         TO DP020-MSG-NUMBER                 
073800         SET DP020-MSG-FATAL                                              
073900             DP030-SET-CURSOR-APPL-1                                      
074000             PS-ERROR                 TO TRUE                             
074100     END-IF.                                                              
074200     IF DK-PO-NBR > ZERO                                                  
074300         PERFORM 7000-SELECT-TPURCHS                                      
074400     END-IF.                                                              
074500                                                                          
074600 3004-EDIT-PO-LINE-NBR.                                                   
074700     IF PS-NO-ERROR AND ASC-PO-LINE-NBR > ZERO                            
074800         IF ASC-PKGNG-CDE = 'M' OR 'I' OR SPACE                           
074900             MOVE -1                  TO ALINEL                           
075000             MOVE DP015-RED           TO ALINEC                           
075100             MOVE PC-TSYMSG-02859     TO DP020-MSG-NUMBER                 
075200             SET DP020-MSG-FATAL                                          
075300                 DP030-SET-CURSOR-APPL-1                                  
075400                 PS-ERROR             TO TRUE                             
075500         ELSE                                                             
075600             MOVE ASC-PO-LINE-NBR     TO DK-PO-LINE-NBR                   
075700             PERFORM 7010-SELECT-TPURITM                                  
075800     END-IF.                                                              
075900                                                                          
076000 3004A-EDIT-LINE-FOR-NUMERIC.                                             
076100     MOVE ASC-PO-LINE-NBR             TO DP010I-UNEDITED-FIELD            
076200     MOVE +9                          TO DP010I-MAXIMUM-DIGITS            
076300     MOVE ZERO                        TO DP010I-MAXIMUM-DECIMALS          
076400     SET DP010I-NEGATIVE-NOT-ALLOWED  TO TRUE                             
076500                                                                          
263968     CALL DP010I-NUMERIC-EDIT-ROUTINE                                     
263968          USING DP010I-NUMERIC-EDIT-AREA                                  
076700                                                                          
076800     IF DP010I-NO-ERROR-DETECTED                                          
076900         MOVE DP010I-NUMERIC-FIELD                                        
077000                                      TO DK-PO-LINE-NBR                   
077100                                         ASC-PO-LINE-NBR-N                
077200                                         SU020-PO-LINE-NBR                
077300     ELSE                                                                 
077400         MOVE -1                      TO ALINEL                           
077500         MOVE DP015-RED               TO ALINEC                           
077600         MOVE PC-TSYMSG-00008         TO DP020-MSG-NUMBER                 
077700         SET DP020-MSG-FATAL                                              
077800             DP030-SET-CURSOR-APPL-1                                      
077900             PS-ERROR                 TO TRUE                             
078000     END-IF.                                                              
078100                                                                          
078200 3005-EDIT-OPER-UNT.                                                      
078300     IF ASC-OPER-UNT-ID = 'ALL'                                           
078400         MOVE 'ALL DISTRIBUTION CENTERS'                                  
078500                                      TO ASC-STORE-NAME                   
078600         MOVE 'ALL'                   TO ASC-OPER-ALL                     
078700     ELSE                                                                 
078800         MOVE SPACES                  TO ASC-OPER-ALL                     
078900         MOVE ASC-OPER-UNT-ID         TO DP010I-UNEDITED-FIELD            
079000         MOVE +4                      TO DP010I-MAXIMUM-DIGITS            
079100         MOVE ZERO                    TO DP010I-MAXIMUM-DECIMALS          
079200         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                          
079300                                                                          
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263968              USING DP010I-NUMERIC-EDIT-AREA                              
079500                                                                          
079600         IF DP010I-NO-ERROR-DETECTED                                      
079700             MOVE DP010I-NUMERIC-FIELD TO DK-OPER-UNT-ID                  
079800                                          ASC-OPER-UNT-ID-N               
079900                                          SU020-OPER-UNT-ID               
080000         ELSE                                                             
080100             MOVE -1                  TO AOPERL                           
080200             MOVE DP015-RED           TO AOPERC                           
080300             MOVE PC-TSYMSG-00008     TO DP020-MSG-NUMBER                 
080400             SET DP020-MSG-FATAL                                          
080500                 DP030-SET-CURSOR-APPL-1                                  
080600                 PS-ERROR             TO TRUE                             
080700         END-IF                                                           
080800                                                                          
080900         IF DK-OPER-UNT-ID > ZERO                                         
081000             PERFORM 7020-GET-STORE-NAME                                  
113000             MOVE ASC-STORE-NAME    TO AOPDESCO                           
082100         END-IF                                                           
082300     END-IF.                                                              
082400                                                                          
082500 3006-EDIT-PREPACK.                                                       
082600     PERFORM 7030-SELECT-POPRPK.                                          
082700                                                                          
082800 3006A-EDIT-PREPACK-FOR-NUMERIC.                                          
082900     MOVE ASC-PREPACK-ID              TO DP010I-UNEDITED-FIELD            
083000     MOVE +4                          TO DP010I-MAXIMUM-DIGITS            
083100     MOVE ZERO                        TO DP010I-MAXIMUM-DECIMALS          
083200     SET DP010I-NEGATIVE-NOT-ALLOWED  TO TRUE                             
083300                                                                          
263968     CALL DP010I-NUMERIC-EDIT-ROUTINE                                     
263968          USING DP010I-NUMERIC-EDIT-AREA                                  
083500                                                                          
083600     IF DP010I-NO-ERROR-DETECTED                                          
083700         MOVE DP010I-NUMERIC-FIELD    TO DK-PREPACK-ID                    
083800                                         ASC-PREPACK-ID-N                 
083900                                         SU020-PREPACK-ID                 
084000     ELSE                                                                 
084100         MOVE -1                      TO APREPKL                          
084200         MOVE DP015-RED               TO APREPKC                          
084300         MOVE PC-TSYMSG-00008         TO DP020-MSG-NUMBER                 
084400         SET DP020-MSG-FATAL                                              
084500             DP030-SET-CURSOR-APPL-1                                      
084600             PS-ERROR                 TO TRUE                             
084700     END-IF.                                                              
084800                                                                          
084900 3007-EDIT-DATES.                                                         
085000     PERFORM 30071-EDIT-FROM-DATE.                                        
085100     PERFORM 30072-EDIT-TO-DATE.                                          
085200                                                                          
085300     IF ASC-SHIP-FROM-DATE = '0001-01-01'                                 
085400        OR ASC-SHIP-TO-DATE = '9999-09-09'                                
085500         CONTINUE                                                         
085600     ELSE                                                                 
085700         IF PS-NO-DATE-ERROR                                              
085800             PERFORM 30073-VALIDATE-DATES                                 
085900         END-IF                                                           
086000             IF PS-NO-DATE-ERROR                                          
086100                 PERFORM 30074-COMPARE-DATES                              
086200             END-IF                                                       
086300     END-IF.                                                              
086400                                                                          
086500                                                                          
086600 30071-EDIT-FROM-DATE.                                                    
086700     IF ASC-SHIP-FROM-MM = SPACES                                         
086800         MOVE -1                      TO AFMML                            
086900         MOVE DP015-RED               TO AFMMC                            
087000         SET DP020-MSG-FATAL                                              
087100             DP030-SET-CURSOR-APPL-1                                      
087200             PS-DATE-ERROR                                                
087300             PS-ERROR                 TO TRUE                             
087400             MOVE PC-TSYMSG-00009     TO DP020-MSG-NUMBER                 
087500     END-IF                                                               
087600                                                                          
087700     IF ASC-SHIP-FROM-DD = SPACES                                         
087800         MOVE -1                      TO AFDDL                            
087900         MOVE DP015-RED               TO AFDDC                            
088000         SET DP020-MSG-FATAL                                              
088100             DP030-SET-CURSOR-APPL-1                                      
088200             PS-DATE-ERROR                                                
088300             PS-ERROR                 TO TRUE                             
088400             MOVE PC-TSYMSG-00009     TO DP020-MSG-NUMBER                 
088500     END-IF                                                               
088600                                                                          
088700     IF ASC-SHIP-FROM-CCYY = SPACES                                       
088800         MOVE -1                      TO AFYYL                            
088900         MOVE DP015-RED               TO AFYYC                            
089000         SET DP020-MSG-FATAL                                              
089100             DP030-SET-CURSOR-APPL-1                                      
089200             PS-DATE-ERROR                                                
089300             PS-ERROR                 TO TRUE                             
089400             MOVE PC-TSYMSG-00009     TO DP020-MSG-NUMBER                 
089500     END-IF.                                                              
089600                                                                          
089700 30072-EDIT-TO-DATE.                                                      
089800     IF ASC-SHIP-TO-MM = SPACES                                           
089900         MOVE -1                      TO ATMML                            
090000         MOVE DP015-RED               TO ATMMC                            
090100         SET DP020-MSG-FATAL                                              
090200             DP030-SET-CURSOR-APPL-1                                      
090300             PS-DATE-ERROR                                                
090400             PS-ERROR                 TO TRUE                             
090500             MOVE PC-TSYMSG-00009     TO DP020-MSG-NUMBER                 
090600     END-IF                                                               
090700                                                                          
090800     IF ASC-SHIP-TO-DD = SPACES                                           
090900         MOVE -1                      TO ATDDL                            
091000         MOVE DP015-RED               TO ATDDC                            
091100         SET DP020-MSG-FATAL                                              
091200             DP030-SET-CURSOR-APPL-1                                      
091300             PS-DATE-ERROR                                                
091400             PS-ERROR                 TO TRUE                             
091500             MOVE PC-TSYMSG-00009     TO DP020-MSG-NUMBER                 
091600     END-IF                                                               
091700                                                                          
091800     IF ASC-SHIP-TO-CCYY = SPACES                                         
091900         MOVE -1                      TO ATYYL                            
092000         MOVE DP015-RED               TO ATYYC                            
092100         SET DP020-MSG-FATAL                                              
092200             DP030-SET-CURSOR-APPL-1                                      
092300             PS-DATE-ERROR                                                
092400             PS-ERROR                 TO TRUE                             
092500             MOVE PC-TSYMSG-00009     TO DP020-MSG-NUMBER                 
092600     END-IF.                                                              
092700                                                                          
092800 30073-VALIDATE-DATES.                                                    
092900     INITIALIZE DPG51 DPG52                                               
093000                DPG53 DPG54                                               
093100                DPG55 DPG56.                                              
093200                                                                          
093300     STRING                                                               
093400         ASC-SHIP-FROM-CCYY                                               
093500         ASC-SHIP-FROM-MM                                                 
093600         ASC-SHIP-FROM-DD DELIMITED BY SIZE                               
093700                                      INTO DPG52-LK-DATE-INPUT            
093800                                                                          
093900     SET DPG51-DO-NOT-INCR-DECR-DATE                                      
094000         DPG51-ACTUAL-CALENDAR-ONLY                                       
094100         DPG52-LK-DTE-ISO             TO TRUE                             
094200                                                                          
094300     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52                  
094400                                             DPG53 DPG54                  
094500                                             DPG55 DPG56.                 
094600     IF DPG54-DATE-INVALID                                                
094700         MOVE -1                      TO AFMML                            
094800         MOVE DP015-RED               TO AFMMC                            
094900                                         AFDDC                            
095000                                         AFYYC                            
095100         SET DP020-MSG-FATAL                                              
095200             DP030-SET-CURSOR-APPL-1                                      
095300             PS-DATE-ERROR                                                
095400             PS-ERROR                 TO TRUE                             
095500             MOVE PC-TSYMSG-00009     TO DP020-MSG-NUMBER                 
095600     END-IF.                                                              
095700                                                                          
095800     INITIALIZE DPG51 DPG52                                               
095900                DPG53 DPG54                                               
096000                DPG55 DPG56.                                              
096100                                                                          
096200     STRING                                                               
096300         ASC-SHIP-TO-CCYY                                                 
096400         ASC-SHIP-TO-MM                                                   
096500         ASC-SHIP-TO-DD DELIMITED BY SIZE                                 
096600                                      INTO DPG52-LK-DATE-INPUT            
096700                                                                          
096800     SET DPG51-DO-NOT-INCR-DECR-DATE                                      
096900         DPG51-ACTUAL-CALENDAR-ONLY                                       
097000         DPG52-LK-DTE-ISO             TO TRUE                             
097100                                                                          
097200     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52                  
097300                                             DPG53 DPG54                  
097400                                             DPG55 DPG56.                 
097500     IF DPG54-DATE-INVALID                                                
097600         MOVE -1                      TO ATMML                            
097700         MOVE DP015-RED               TO ATMMC                            
097800                                         ATDDC                            
097900                                         ATYYC                            
098000         SET DP020-MSG-FATAL                                              
098100             DP030-SET-CURSOR-APPL-1                                      
098200             PS-DATE-ERROR                                                
098300             PS-ERROR                 TO TRUE                             
098400             MOVE PC-TSYMSG-00009     TO DP020-MSG-NUMBER                 
098500     END-IF.                                                              
098600                                                                          
098700 30074-COMPARE-DATES.                                                     
098800                                                                          
098900     INITIALIZE DPG51 DPG52                                               
099000                DPG53 DPG54                                               
099100                DPG55 DPG56.                                              
099200                                                                          
099300     STRING                                                               
099400         ASC-SHIP-TO-CCYY                                                 
099500         ASC-SHIP-TO-MM                                                   
099600         ASC-SHIP-TO-DD DELIMITED BY SIZE                                 
099700                                      INTO DPG52-LK-DATE-INPUT            
099800                                                                          
099900     STRING                                                               
100000         ASC-SHIP-FROM-CCYY                                               
100100         ASC-SHIP-FROM-MM                                                 
100200         ASC-SHIP-FROM-DD DELIMITED BY SIZE                               
100300                          INTO DPG53-LK-CMPR-DATE-INPUT                   
100400                                                                          
100500     SET DPG51-DO-NOT-INCR-DECR-DATE                                      
100600         DPG51-ACTUAL-CALENDAR-ONLY                                       
100700         DPG52-LK-DTE-ISO                                                 
100800         DPG53-LK-CMPR-DTE-ISO        TO TRUE                             
100900                                                                          
101000     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52                  
101100                                             DPG53 DPG54                  
101200                                             DPG55 DPG56.                 
101300     IF DPG54-CMPR-DATE-VALID                                             
101400         IF DPG55-DAYS-DIFFERENCE < ZERO                                  
101500         MOVE -1                      TO AFMML                            
101600         MOVE DP015-RED               TO ATMMC                            
101700                                         ATDDC                            
101800                                         ATYYC                            
101900                                         AFMMC                            
102000                                         AFDDC                            
102100                                         AFYYC                            
102200         SET DP020-MSG-FATAL                                              
102300             DP030-SET-CURSOR-APPL-1                                      
102400             PS-DATE-ERROR                                                
102500             PS-ERROR                 TO TRUE                             
102600             MOVE PC-TSYMSG-02806     TO DP020-MSG-NUMBER                 
102700         END-IF                                                           
102800     END-IF.                                                              
102900                                                                          
103000 3008-PREEXISTING-EXCEPTIONS.                                             
103100     PERFORM 30081-SET-KEYS.                                              
103200     PERFORM 7040-SELECT-SUT-PO-AUD-EXC.                                  
103300                                                                          
103400 30081-SET-KEYS.                                                          
103500                                                                          
103600     MOVE ASC-PO-LINE-NBR-N           TO DK-PO-LINE-NBR                   
103700     MOVE ASC-PREPACK-ID-N            TO DK-PREPACK-ID                    
103800                                                                          
103900     IF (ASC-OPER-UNT-ID = 'ALL' OR SPACES)                               
104000             OR ASC-OPER-UNT-ID-N = ZERO                                  
104100         MOVE ZEROES                  TO DK-OPER-FROM                     
104200         MOVE 9999                    TO DK-OPER-TO                       
104300     ELSE                                                                 
104400         MOVE ASC-OPER-UNT-ID-N       TO DK-OPER-FROM                     
104500                                         DK-OPER-TO                       
104600     END-IF.                                                              
104700                                                                          
104800 3009-PO-OPER-CHECK.                                                      
104900                                                                          
105000     EVALUATE TRUE                                                        
105100         WHEN ASC-PO-NBR-N > ZERO                                         
105200                        AND                                               
105300             ASC-OPER-UNT-ID > ZERO                                       
105400             CONTINUE                                                     
105500         WHEN ASC-PO-NBR-N > ZERO                                         
105600                        AND                                               
105700              (ASC-OPER-UNT-ID = ZERO OR SPACES)                          
105800             CONTINUE                                                     
105900         WHEN (ASC-PO-NBR-N = ZERO OR ASC-PO-NBR = SPACES)                
106000                        AND                                               
106100                 ASC-OPER-UNT-ID-N > ZERO                                 
106200             CONTINUE                                                     
106300                                                                          
106400         WHEN OTHER                                                       
106500             SET DP020-MSG-FATAL                                          
106600                 DP030-SET-CURSOR-APPL-1                                  
106700                 PS-ERROR             TO TRUE                             
106800             MOVE PC-TSYMSG-02892     TO DP020-MSG-NUMBER                 
106900             MOVE -1                  TO APOL                             
107000             MOVE DP015-RED           TO APOC                             
107100                                         AOPERC                           
107200     END-EVALUATE.                                                        
107300                                                                          
107400/                                                                         
107500******************************************************************        
107600** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **        
107700** MAP.                                                         **        
107800******************************************************************        
107900 3200-RESET-ATTRIBUTES.                                                   
108000     MOVE DP015-UNP-NUM-NOR-OFF       TO APOA                             
108100                                         ALINEA                           
108200                                         APREPKA                          
108300                                         AFMMA                            
108400                                         AFDDA                            
108500                                         AFYYA                            
108600                                         ATMMA                            
108700                                         ATDDA                            
108800                                         ATYYA                            
108900                                                                          
109000     MOVE DP015-GREEN                 TO APOC                             
109100                                         AOPERC                           
109200                                         ALINEC                           
109300                                         APREPKC                          
109400                                         AFMMC                            
109500                                         AFDDC                            
109600                                         AFYYC                            
109700                                         ATMMC                            
109800                                         ATDDC                            
109900                                         ATYYC                            
110000                                         AAUDTYPC                         
110100                                                                          
110200     MOVE DP015-UNDERLINE             TO APOH                             
110300                                         AOPERH                           
110400                                         ALINEH                           
110500                                         APREPKH                          
110600                                         AFMMH                            
110700                                         AFDDH                            
110800                                         AFYYH                            
110900                                         ATMMH                            
111000                                         ATDDH                            
111100                                         ATYYH                            
111200                                         AAUDTYPH.                        
111300                                                                          
111400     MOVE DP015-UNP-ALP-NOR-OFF       TO AAUDTYPA                         
111500                                         AOPERA.                          
111600                                                                          
111700 4000-BUILD-INITIAL-PANEL.                                                
111800     SET DP030-SET-CURSOR-APPL-1      TO TRUE                             
111900     MOVE 'B'                         TO AAUDTYPO                         
112000                                         ASC-AUDIT-TYPE                   
112100     MOVE DP020-LOCATION-NBR          TO ASC-OPER-UNT-ID                  
112200                                         AOPERO                           
112300                                         DK-OPER-UNT-ID                   
112400     PERFORM 7020-GET-STORE-NAME.                                         
113000     MOVE ASC-STORE-NAME              TO AOPDESCO.                        
113200                                                                          
113300     MOVE -1                          TO APOL.                            
113400                                                                          
113500                                                                          
113600*----------------------------------------------------------------*        
113700*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *        
113800*----------------------------------------------------------------*        
113900 4400-MOVE-COMMAREA-TO-SCREEN.                                            
114000                                                                          
114100*    MOVE SU020-PO-NBR                TO ASC-PO-NBR-N                     
114200*    MOVE SU020-PO-LINE-NBR           TO ASC-PO-LINE-NBR-N                
114300*    MOVE SU020-PREPACK-ID            TO ASC-PREPACK-ID                   
114400                                                                          
114500     MOVE ASC-PO-NBR-N                TO APOO                             
114600     MOVE ASC-OPER-UNT-ID-N           TO AOPERO                           
114700     MOVE ASC-STORE-NAME              TO AOPDESCO                         
114800     MOVE ASC-PO-LINE-NBR-N           TO ALINEO                           
114900     MOVE ASC-PREPACK-ID-N            TO APREPKO                          
115000                                                                          
115100     IF ASC-SHIP-FROM-DATE = '01-01-0001'                                 
115200         MOVE SPACES                  TO ASC-SHIP-FROM-DATE               
115300     END-IF                                                               
115400         MOVE ASC-SHIP-FROM-MM        TO AFMMO                            
115500         MOVE ASC-SHIP-FROM-DD        TO AFDDO                            
115600         MOVE ASC-SHIP-FROM-CCYY      TO AFYYO                            
115700                                                                          
115800     IF ASC-SHIP-TO-DATE = '09-09-9999'                                   
115900         MOVE SPACES                  TO ASC-SHIP-TO-DATE                 
116000     END-IF                                                               
116100         MOVE ASC-SHIP-TO-MM          TO ATMMO                            
116200         MOVE ASC-SHIP-TO-DD          TO ATDDO                            
116300         MOVE ASC-SHIP-TO-CCYY        TO ATYYO                            
116400                                                                          
116500     MOVE ASC-AUDIT-TYPE              TO AAUDTYPO.                        
116600     MOVE ASC-PACKAGING-TYPE          TO APKGTYPO.                        
116700/                                                                         
116800 7000-SELECT-TPURCHS.                                                     
116900     EXEC SQL                                                             
117000         SELECT                                                           
117100             VER_NBR                                                      
117200         ,   PO_TYP_CDE                                                   
117300         ,   PKGNG_CDE                                                    
117400         ,   CASE PKGNG_CDE                                               
117500                 WHEN 'M' THEN                                            
117600                     'PRE-PACK'                                           
117700                 WHEN 'I' THEN                                            
117800                     'PRE-PACK'                                           
117900                 WHEN ' ' THEN                                            
118000                     'PACK-BY-STORE'                                      
118100             ELSE                                                         
118200                 'BULK/CASEPACK'                                          
118300             END                                                          
118400         INTO                                                             
118500             :PURCHS-VER-NBR                                              
118600         ,   :PURCHS-PO-TYP-CDE                                           
118700         ,   :ASC-PKGNG-CDE                                               
118800         ,   :ASC-PACKAGING-TYPE                                          
118900         FROM TPURCHS PO                                                  
119000         WHERE                                                            
119100             PO.PO_NBR          = :DK-PO-NBR                              
119200         AND                                                              
119300             PO.VER_STATUS_CDE  = 'A'                                     
119400     END-EXEC.                                                            
119500                                                                          
119600     EVALUATE TRUE                                                        
119700         WHEN SQLCODE = ZERO                                              
119800             CONTINUE                                                     
119900         WHEN SQLCODE = +100                                              
120000             MOVE SPACES              TO ASC-PACKAGING-TYPE               
120100             MOVE -1                  TO APOL                             
120200             MOVE DP015-RED           TO APOC                             
120300             SET DP020-MSG-FATAL                                          
120400                 DP030-SET-CURSOR-APPL-1                                  
120500                 PS-ERROR             TO TRUE                             
120600             MOVE PC-TSYMSG-02858     TO DP020-MSG-NUMBER                 
120700                                                                          
120800         WHEN SQLWARN0 NOT = SPACES                                       
120900         WHEN SQLCODE < +0                                                
121000         WHEN SQLCODE > ZERO                                              
121100             MOVE '7000-SELECT-TPUCHS'                                    
121200                                      TO DP013-PARAGRAPH                  
121300             MOVE 'SELECT PURCHASE ORDER'                                 
121400                                      TO DP013-MESSAGE-TEXT (1)           
121500             MOVE SQLCA               TO DP013-SQLCA                      
121600             MOVE 'TPURCHS'           TO DP013-DB2-TABLE-NAME (1)         
121700             SET DP013-DB2-ABEND      TO TRUE                             
121800             SET DP013-XCTL-DISPLAY-RESTART                               
121900                                      TO TRUE                             
122000             PERFORM DP013-0000-PROCESS-ABEND                             
122100     END-EVALUATE.                                                        
122200                                                                          
122300 7010-SELECT-TPURITM.                                                     
122400                                                                          
122500     EXEC SQL                                                             
122600         SELECT                                                           
122700             ITM.PO_LNE_NBR                                               
122800         INTO                                                             
122900             :PURITM-PO-LNE-NBR                                           
123000         FROM TPURITM ITM                                                 
123100         WHERE                                                            
123200             ITM.PO_NBR          = :DK-PO-NBR                             
123300         AND ITM.PO_LNE_NBR      = :DK-PO-LINE-NBR                        
123400         AND ITM.VER_STATUS_CDE  = 'A'                                    
123500     END-EXEC.                                                            
123600                                                                          
123700     EVALUATE TRUE                                                        
123800         WHEN SQLCODE = ZERO                                              
123900             CONTINUE                                                     
124000         WHEN SQLCODE = +100                                              
124100             MOVE -1                  TO ALINEL                           
124200             MOVE DP015-RED           TO ALINEC                           
124300             SET DP020-MSG-FATAL                                          
124400                 DP030-SET-CURSOR-APPL-1                                  
124500                 PS-ERROR             TO TRUE                             
124600             MOVE PC-TSYMSG-02861     TO DP020-MSG-NUMBER                 
124700                                                                          
124800         WHEN SQLWARN0 NOT = SPACES                                       
124900         WHEN SQLCODE < +0                                                
125000         WHEN SQLCODE > ZERO                                              
125100             MOVE '7000-SELECT-TPURCHS'                                   
125200                                      TO DP013-PARAGRAPH                  
125300             MOVE 'SELECT PURCHASE ORDER'                                 
125400                                      TO DP013-MESSAGE-TEXT (1)           
125500             MOVE SQLCA               TO DP013-SQLCA                      
125600             MOVE 'TPURCHS'           TO DP013-DB2-TABLE-NAME (1)         
125700             SET DP013-DB2-ABEND      TO TRUE                             
125800             SET DP013-XCTL-DISPLAY-RESTART                               
125900                                      TO TRUE                             
126000             PERFORM DP013-0000-PROCESS-ABEND                             
126100     END-EVALUATE.                                                        
126200 7020-GET-STORE-NAME.                                                     
126300                                                                          
173840     INITIALIZE XL071-COMMAREA-REC.                                       
173850     MOVE DK-OPER-UNT-ID TO XL071-LOCATION-NUMBER.                        
173860                                                                          
173870     CALL PC-LOCATION-MODULE  USING DFHEIBLK                              
173890                                    XL071-COMMAREA                        
173891                                    XL071-COMMAREA-REC.                   
173892                                                                          
173894     IF XL071-NO-ERRORS                                                   
128200        MOVE XL071-LOC-NM  TO ASC-STORE-NAME                              
173894     ELSE                                                                 
081200        MOVE SPACES          TO ASC-STORE-NAME                            
081400        MOVE -1              TO AOPERL                                    
081500        MOVE DP015-RED       TO AOPERC                                    
081600        SET DP020-MSG-FATAL                                               
081700            DP030-SET-CURSOR-APPL-1                                       
081800            PS-ERROR         TO TRUE                                      
               MOVE PC-TSYMSG-02572 TO DP020-MSG-NUMBER                         
173894     END-IF.                                                              
128600                                                                          
130200                                                                          
130300 7030-SELECT-POPRPK.                                                      
130400                                                                          
130500     EXEC SQL                                                             
130600        SELECT                                                            
130700             PK.PO_PREPK_ID                                               
130800          INTO                                                            
130900             :POPRPK-PO-PREPK-ID                                          
131000          FROM  TPOPRPK PK                                                
131100         WHERE                                                            
131200             PK.PO_NBR           = :DK-PO-NBR                             
131300         AND PK.PO_PREPK_ID      = :DK-PREPACK-ID                         
131400         AND PK.PREPK_STAT_CDE   = 'A'                                    
131500     END-EXEC.                                                            
131600                                                                          
131700     EVALUATE TRUE                                                        
131800         WHEN SQLCODE = ZERO                                              
131900             CONTINUE                                                     
132000         WHEN SQLCODE = +100                                              
132100             MOVE -1                  TO APREPKL                          
132200             MOVE DP015-RED           TO APREPKC                          
132300             SET DP020-MSG-FATAL                                          
132400                 DP030-SET-CURSOR-APPL-1                                  
132500                 PS-ERROR             TO TRUE                             
132600             MOVE PC-TSYMSG-02862     TO DP020-MSG-NUMBER                 
132700                                                                          
132800         WHEN SQLWARN0 NOT = SPACES                                       
132900         WHEN SQLCODE < +0                                                
133000         WHEN SQLCODE > ZERO                                              
133100             MOVE '7030-SELECT-TPOPRPK'                                   
133200                             TO DP013-PARAGRAPH                           
133300             MOVE 'SELECT PRE-PACK'                                       
133400                             TO DP013-MESSAGE-TEXT (1)                    
133500             MOVE SQLCA      TO DP013-SQLCA                               
133600             MOVE 'TPOPRPK'  TO DP013-DB2-TABLE-NAME (1)                  
133700             SET DP013-DB2-ABEND                                          
133800                             TO TRUE                                      
133900             SET DP013-XCTL-DISPLAY-RESTART                               
134000                             TO TRUE                                      
134100             PERFORM DP013-0000-PROCESS-ABEND                             
134200     END-EVALUATE.                                                        
134300                                                                          
134400 7040-SELECT-SUT-PO-AUD-EXC.                                              
134500                                                                          
134600     EXEC SQL                                                             
134700        SELECT                                                            
134800             AUD.PO_NBR                                                   
134900         ,   AUD.PO_LNE_NBR                                               
135000         ,   AUD.PO_PREPK_ID                                              
135100         ,   AUD.OPER_UNT_ID                                              
135200          INTO                                                            
135300             :SUT00014-PO-NBR                                             
135400         ,   :SUT00014-PO-LNE-NBR                                         
135500         ,   :SUT00014-PO-PREPK-ID                                        
135600         ,   :SUT00014-OPER-UNT-ID                                        
135700          FROM  SUT_PO_AUD_EXC    AUD                                     
135800         WHERE                                                            
135900             AUD.PO_NBR          = :DK-PO-NBR                             
136000         AND AUD.PO_LNE_NBR      = :DK-PO-LINE-NBR                        
136100         AND AUD.PO_PREPK_ID     = :DK-PREPACK-ID                         
136200         AND AUD.OPER_UNT_ID     BETWEEN :DK-OPER-FROM                    
136300                                 AND :DK-OPER-TO                          
136400                                                                          
136500*        AND AUD.PO_LNE_NBR      BETWEEN :DK-LNE-NBR-FROM                 
136600*                                AND :DK-LNE-NBR-TO                       
136700*        AND AUD.PO_PREPK_ID     BETWEEN :DK-PREPK-FROM                   
136800*                                AND :DK-PREPK-TO                         
136900*        AND AUD.OPER_UNT_ID     BETWEEN :DK-OPER-FROM                    
137000*                                AND :DK-OPER-TO                          
137100     END-EXEC.                                                            
137200                                                                          
137300     EVALUATE TRUE                                                        
137400         WHEN SQLCODE = ZERO                                              
137500         WHEN SQLCODE = -811                                              
137600             SET PS-AUDIT-FOUND       TO TRUE                             
137700         WHEN SQLCODE = +100                                              
137800             SET PS-AUDIT-NOT-FOUND   TO TRUE                             
137900         WHEN SQLWARN0 NOT = SPACES                                       
138000         WHEN SQLCODE < +0                                                
138100         WHEN SQLCODE > ZERO                                              
138200             MOVE '7040-SELECT-SUT-PO '                                   
138300                             TO DP013-PARAGRAPH                           
138400             MOVE 'SELECT SUT PO AUD EXC'                                 
138500                             TO DP013-MESSAGE-TEXT (1)                    
138600             MOVE SQLCA      TO DP013-SQLCA                               
138700             MOVE 'TPOPRPK'  TO DP013-DB2-TABLE-NAME (1)                  
138800             SET DP013-DB2-ABEND                                          
138900                             TO TRUE                                      
139000             SET DP013-XCTL-DISPLAY-RESTART                               
139100                             TO TRUE                                      
139200             PERFORM DP013-0000-PROCESS-ABEND                             
139300     END-EVALUATE.                                                        
139400/                                                                         
139500 8000-CALL-RACF.                                                          
139600      SET DP008-RSRC-TYPE-FUNC           TO TRUE                          
139700      SET DP008-ACCESS-TYPE-USE          TO TRUE                          
139800                                                                          
139900     EXEC CICS                                                            
140000        LINK PROGRAM  (DP008-SECURITY-SUBROUTINE)                         
140100             COMMAREA (DP008-SECURITY-COMMAREA)                           
140200             LENGTH   (DP008-SECURITY-COMMAREA-LENGTH)                    
140300             RESP     (PV-CICS-RESPONSE)                                  
140400     END-EXEC.                                                            
140500                                                                          
140600     IF PV-CICS-RESPONSE = DFHRESP (NORMAL)                               
140700        IF DP008-CALL-SUCCESSFUL                                          
140800           CONTINUE                                                       
140900        ELSE                                                              
141000           MOVE DP008-ERROR-CODE TO PM-CM-RETURN-CODE                     
141100           MOVE PM-CICSAUTH-MESSAGE TO DP013-MESSAGE-TEXT(1)              
141200           SET DP013-CICS-ABEND TO TRUE                                   
141300           SET DP013-NO-ROLLBACK TO TRUE                                  
141400           MOVE '8000-CHECK-RACF' TO DP013-PARAGRAPH                      
141500           PERFORM DP013-0000-PROCESS-ABEND                               
141600        END-IF                                                            
141700     ELSE                                                                 
141800        MOVE 'CALL RACF SECURITY PROGRAM' TO DP013-MESSAGE-TEXT(1)        
141900        SET DP013-CICS-ABEND TO TRUE                                      
142000        SET DP013-NO-ROLLBACK TO TRUE                                     
142100        MOVE '8000-CHECK-RACF' TO DP013-PARAGRAPH                         
142200        PERFORM DP013-0000-PROCESS-ABEND                                  
142300     END-IF.                                                              
142400                                                                          
142500*----------------------------------------------------------------*        
142600*    ABEND PROCESSOR MODULE                                      *        
142700*----------------------------------------------------------------*        
142800                                                                          
142900     COPY DPPD013.                                                        
