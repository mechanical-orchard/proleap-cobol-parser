000100 IDENTIFICATION DIVISION.                                         09/16/94
000200******************************************************************IMKUP045
000300                                                                     LV020
000400 PROGRAM-ID.             IMKUP045.                                   CL**1
000500 AUTHOR.                 DIANE THEEL.                                CL**1
000600 INSTALLATION.           KOHLS DEPARTMENT STORES.                    CL**1
000700 DATE-WRITTEN.           01/14/2005.                                 CL**1
000800 DATE-COMPILED.                                                      CL**1
000900                                                                     CL**1
001000******************************************************************   CL**1
001100*  IMKUP045 - UPDATE CORPORATE INITIATIVE TABLES                 *   CL**1
001200******************************************************************   CL**1
001300* THIS IS AN ON REQUEST PROGRAM THAT WILL TAKE IN A COMMA        *   CL**1
001300* DELIMITED EXCEL FILE AND INSERT TO THE CORPORATE INITIATIVE    *   CL**1
001400* TABLES. THE LOGIC IS BASED ON HOW THE USER FILLED OUT THE      *   CL**1
001400* UPDATE FORM (INPUT FILE).  ALL ERRORS WILL BE WRITTEN TO AN    *   CL**1
      * ERROR REPORT.                                                  *        
001700******************************************************************   CL**1
      * 01/14/05 - D THEEL          -  WR NO. 28122                             
      *    - NEW PROGRAM.                                                       
      ******************************************************************        
      * 02/02/05 - D THEEL          -  WR NO. 28122                             
      *    - ADDED LOGIC FOR NEW EVENTS OR CATEGORIES REPEATED IN THE           
      *      SAME FILE.  WE WILL INSERT IT THE FIRST TIME AND GET               
      *      INPUT INDICATOR = R FOR THE REPEATS.  IF IT IS A REPEAT            
      *      GO FIND THE CATEGORY OR EVENT ID BY USING ITS DESCRIPTION.         
      ******************************************************************        
002167* 09/21/12 - COGNIZANT        -  WR NO. PKE000000002167                   
002167*    - ADDED LOGIC TO ABEND THE PROGRAM WHEN THE EVENT ID                 
002167*      DOES NOT EXIST. PREVIOUSLY, THE JOB DOES NOT FAILS WHEN IT         
002167*      COMES ACROSS SUCH A SITUATION. IT WILL JUST FAIL.                  
002167*      NOW, THE JOB WILL ABEND IN SUCH A CASE.                            
      ******************************************************************        
001800                                                                     CL**1
001900******************************************************************   CL**1
002000 ENVIRONMENT DIVISION.                                               CL**1
002100******************************************************************   CL**1
002200                                                                     CL**1
002300 CONFIGURATION SECTION.                                              CL**1
002400                                                                     CL**1
002500 SOURCE-COMPUTER.                        IBM-3090.                   CL**1
002600 OBJECT-COMPUTER.                        IBM-3090.                   CL**1
002700                                                                     CL**1
002800 INPUT-OUTPUT SECTION.                                               CL**1
002900                                                                     CL**1
003000 FILE-CONTROL.                                                       CL**1
003100                                                                     CL**1
003200     SELECT CI-INSERT-FILE                                           CL**1
003300         ASSIGN TO INP01.                                            CL**1
                                                                                
      **   SELECT NEW-ERROR-REPORT                                              
      **       ASSIGN TO RPT01.                                                 
003400                                                                     CL**1
003500                                                                     CL**1
003600******************************************************************   CL**1
003700 DATA DIVISION.                                                      CL**1
003800******************************************************************   CL**1
003900                                                                     CL**1
004000 FILE SECTION.                                                       CL**1
004100                                                                     CL**1
004200 FD  CI-INSERT-FILE                                                  CL**1
004300     RECORDING MODE IS V                                             CL**1
004400     LABEL RECORDS ARE STANDARD                                      CL**1
004500     BLOCK CONTAINS 0 RECORDS.                                       CL**1
004600                                                                     CL**1
004700 01  CI-INSERT-RECORD                    PIC X(251).                 CL**1
004800                                                                     CL**1
004900                                                                     CL**1
005000 WORKING-STORAGE SECTION.                                            CL**1
005100                                                                     CL**1
005900                                                                     CL**1
005200******************************************************************   CL**1
005300* CI INPUT FILE IS COMMA DELIMITED                               *   CL**1
005400******************************************************************   CL**1
005600 01  CI-INSERT.                                                      CL**1
005700     05  CI-NEW-CTG-IND                 PIC  X(01) VALUE SPACES.     CL**1
005700     05  CI-CTG-DESC                    PIC  X(50) VALUE SPACES.     CL**1
005700     05  CI-NEW-EVNT-IND                PIC  X(01) VALUE SPACES.     CL**1
005700     05  CI-EVNT-DESC                   PIC  X(50) VALUE SPACES.     CL**1
005700     05  CI-NAME                        PIC  X(50) VALUE SPACES.     CL**1
           05  CI-BEGIN-DTE                   PIC  X(10) VALUE SPACES.          
           05  CI-END-DTE                     PIC  X(10) VALUE SPACES.          
           05  CI-CTG-ID                      PIC  9(10) VALUE ZERO.            
           05  CI-EVNT-ID                     PIC  9(10) VALUE ZERO.            
           05  CI-FILLER                      PIC  X(20) VALUE SPACES.          
005900                                                                     CL**1
006000******************************************************************   CL**1
006100* PROGRAM VARIABLES                                              *   CL**1
006200******************************************************************   CL**1
006300                                                                     CL*17
004700 01  PV-INSERT-RECORD                    PIC X(255).                 CL**1
009600 01  PV-PROGRAM-VARIABLES.                                                
009500     05  PV-COMMITS-TAKEN            PIC S9(09)  COMP-3              CL*15
009600                                                   VALUE ZERO.       CL*15
006800     05  PV-DB2-OPERATION-ATTEMPTED      PIC X(30)   VALUE SPACE.    CL**1
006900     05  PV-PARAGRAPH-NAME               PIC X(30)   VALUE SPACE.    CL**1
007000     05  PV-RETRY-COUNT                  PIC S9(04)  VALUE ZERO           
007100                                                     COMP SYNC.           
           05  PV-SAVE-INITV-CTG-ID         PIC  S9(4) COMP.                    
           05  PV-SAVE-INITV-EVNT-ID        PIC  S9(4) COMP.                    
           05  PV-SAVE-CORP-INITV-ID        PIC  S9(4) COMP.                    
24521      05  PV-DB2-TEST                  PIC S9(04) VALUE ZEROES             
24521                                       COMP.                               
           05  PV-CTG-ID-COMP               PIC S9(10) COMP                     
                                                           VALUE ZERO.          
           05  PV-EVNT-ID-COMP              PIC S9(10) COMP                     
                                                           VALUE ZERO.          
           05  PV-DIS-CTG-ID                PIC 9(10)  VALUE ZERO.              
           05  PV-DIS-EVNT-ID               PIC 9(10)  VALUE ZERO.              
           05  PV-DIS-INITV-ID              PIC 9(10)  VALUE ZERO.              
007900                                                                     CL**1
008000******************************************************************   CL**1
008100* PROGRAM SWITCHES                                               *   CL**1
008200******************************************************************   CL**1
008300                                                                     CL*17
008400 01  PS-PROGRAM-SWITCHES.                                            CL**1
008500     05  PS-END-OF-INPUT-SW              PIC X(01)   VALUE 'N'.      CL**1
008600         88  PS-END-OF-INPUT                         VALUE 'Y'.      CL**1
008500     05  PS-ERROR-SW                     PIC X(01)   VALUE 'N'.      CL**1
008600         88  PS-NO-ERROR                             VALUE 'N'.      CL**1
008600         88  PS-ERROR                                VALUE 'Y'.      CL**1
PK2167     05  PS-ABEND-SW                     PIC X(01)   VALUE 'N'.      CL**1
PK2167         88  PS-NO-ABEND                             VALUE 'N'.      CL**1
PK2167         88  PS-ABEND                                VALUE 'Y'.      CL**1
008700                                                                     CL**1
008800******************************************************************   CL*15
008900* PROGRAM ACCUMULATORS                                           *   CL*15
009000******************************************************************   CL*15
009100                                                                     CL*17
009200 01  PA-PROGRAM-ACCUMULATORS.                                        CL*15
009300     05  PA-CI-RECS-READ                 PIC 9(09)  VALUE ZERO.      CL*15
009300     05  PA-CTG-INSERTS                  PIC 9(09)  VALUE ZERO.      CL*15
009300     05  PA-EVNT-INSERTS                 PIC 9(09)  VALUE ZERO.      CL*15
009300     05  PA-INITV-INSERTS                PIC 9(09)  VALUE ZERO.      CL*15
009300     05  PA-SUM-INSERTS                  PIC 9(09)  VALUE ZERO.      CL*15
009300     05  PA-CTG-EXISTS                   PIC 9(09)  VALUE ZERO.      CL*15
009300     05  PA-EVNT-EXISTS                  PIC 9(09)  VALUE ZERO.      CL*15
009300     05  PA-SUM-EXISTS                   PIC 9(09)  VALUE ZERO.      CL*15
009300     05  PA-MAX-CTG-SELECTS              PIC 9(09)  VALUE ZERO.      CL*15
009300     05  PA-MAX-EVNT-SELECTS             PIC 9(09)  VALUE ZERO.      CL*15
009300     05  PA-MAX-INITV-SELECTS            PIC 9(09)  VALUE ZERO.      CL*15
           05  PA-R-CTG-SELECTS                PIC 9(09)  VALUE ZERO.           
           05  PA-R-EVNT-SELECTS               PIC 9(09)  VALUE ZERO.           
009500     05  PA-COMMITS-TAKEN                PIC 9(09)  VALUE ZERO.      CL*15
009900                                                                     CL*15
010000******************************************************************   CL**1
010100* PROGRAM CONSTANTS                                              *   CL**1
010200******************************************************************   CL**1
010300                                                                     CL**1
010400 01  PC-PROGRAM-CONSTANTS.                                           CL**1
010500     05  PC-PROGRAM-NAME                 PIC  X(08)  VALUE           CL**1
010600         'IMKUP045'.                                                 CL*17
010700     05  PC-MAXIMUM-RETRY-COUNT          PIC S9(04)  VALUE +2             
010800                                                     COMP SYNC.           
010900                                                                     CL**1
011000 01  ABEND-CODE                          PIC S9(04)                  CL**1
011100                                         COMP SYNC   VALUE 0.        CL**1
011200     88  ABEND-4001-CC-MISSING-ERR                   VALUE +4001.         
011300     88  ABEND-4002-CC-INVALID-ERR                   VALUE +4002.         
011400                                                                     CL**1
012400*****************************************************************         
012500*  TABLE DCLGEN - IMT_INITV_CTG                                           
012600*****************************************************************         
012700     EXEC SQL                                                             
012800         INCLUDE IMT00005                                                 
012900     END-EXEC.                                                            
012300                                                                     CL**1
012400*****************************************************************         
012500*  TABLE DCLGEN - IMT_INITV_EVNT                                          
012600*****************************************************************         
012700     EXEC SQL                                                             
012800         INCLUDE IMT00007                                                 
012900     END-EXEC.                                                            
012300                                                                     CL**1
012400*****************************************************************         
012500*  TABLE DCLGEN - IMT_INITV_SUM                                           
012600*****************************************************************         
012700     EXEC SQL                                                             
012800         INCLUDE IMT00006                                                 
012900     END-EXEC.                                                            
012300                                                                     CL**1
012400*****************************************************************         
012500*  TABLE DCLGEN - IMT_CORP_INITV                                          
012600*****************************************************************         
012700     EXEC SQL                                                             
012800         INCLUDE IMT00002                                                 
012900     END-EXEC.                                                            
012300                                                                     CL**1
013000*                                                                         
013100*                                                                    CL**1
013200*  STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                   CL**1
013300*                                                                    CL**1
013400                                                                     CL**1
013500     EXEC SQL                                                        CL**1
013600         INCLUDE SQLCA                                               CL**1
013700     END-EXEC.                                                       CL**1
013800                                                                     CL**1
013900     COPY SQLCA2.                                                    CL**1
014000                                                                     CL**1
014100*                                                                    CL**1
014200*  VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004           CL**1
014300*                                                                    CL**1
014400     COPY DPWS004.                                                   CL**1
014500                                                                     CL**1
016100 LINKAGE SECTION.                                                    CL**1
016200                                                                     CL**1
016300 PROCEDURE DIVISION.                                                 CL**1
016400                                                                     CL**1
016500                                                                     CL**1
016600******************************************************************   CL**1
016700*                 MAINLINE.                                      *   CL**6
016800******************************************************************   CL**1
016900 0000-MAINLINE.                                                      CL**1
017000                                                                     CL**1
017100     PERFORM 1000-INITIALIZE.                                        CL*12
017200                                                                     CL**1
017300     PERFORM 2000-PROCESS-RECS                                       CL*12
017400         UNTIL PS-END-OF-INPUT.                                      CL**1
017500                                                                     CL**1
017600     PERFORM 9000-EOJ-ROUTINE.                                       CL*12
017700                                                                     CL**1
017800     GOBACK.                                                         CL**1
017900                                                                     CL**1
018000******************************************************************   CL**1
018100*      OPENS AND READ INPUT FILE                                 *   CL**6
018300******************************************************************   CL**1
018400                                                                     CL**1
018500 1000-INITIALIZE.                                                    CL**1
018600                                                                     CL**1
018800     OPEN INPUT CI-INSERT-FILE.                                      CL**1
021300     PERFORM 1200-READ-CI-INSERT-FILE.                               CL*12
021500                                                                     CL**1
021600*                                                                         
023800******************************************************************        
023900*  READ THE TUPC UPDATE FILE                                              
024000******************************************************************        
024100 1200-READ-CI-INSERT-FILE.                                                
024200                                                                          
018900     READ CI-INSERT-FILE                                             CL**3
019000         INTO PV-INSERT-RECORD                                       CL**3
019100         AT END                                                      CL**3
019200             SET PS-END-OF-INPUT TO TRUE                             CL**3
019100         NOT AT END                                                  CL**3
026300             ADD +1 TO PA-CI-RECS-READ.                                   
028300                                                                          
028400                                                                          
030600******************************************************************        
030700*  FOR EACH INPUT REC, UNSTRING THE DATA AND PROCESS THE                  
030800*  FOLLOWING TABLES:                                                      
      *  IMT_INITV_CTG, IMT_INITV_EVNT, IMT_INITV_SUM, IMT_CORP_INITV           
031000******************************************************************   CL**1
031100                                                                     CL**1
031200 2000-PROCESS-RECS.                                                  CL**4
00557      PERFORM 2200-UNSTRING.                                       FSKUP045
           PERFORM 2300-CTG.                                                    
           IF PS-NO-ERROR                                                       
 31700         PERFORM 2400-EVNT                                                
           END-IF.                                                              
           IF PS-NO-ERROR                                                       
 31700         PERFORM 2500-SUM                                                 
           END-IF.                                                              
           IF PS-NO-ERROR                                                       
 31700         PERFORM 2600-INITV                                               
           END-IF.                                                              
           IF PS-NO-ERROR                                                       
               EXEC SQL                                                         
                   COMMIT WORK                                                  
               END-EXEC                                                         
               ADD +1 TO PA-COMMITS-TAKEN                                       
           ELSE                                                                 
              DISPLAY 'NO UPDATE DONE FOR THIS ROW: '                           
              CI-CTG-DESC  ' / '                                                
              CI-EVNT-DESC ' / '                                                
              CI-NAME      ' / '                                                
              CI-BEGIN-DTE ' / '                                                
              CI-END-DTE   ' / '                                                
              CI-CTG-ID    ' / '                                                
              CI-EVNT-ID   ' / '                                                
           END-IF.                                                              
                                                                                
031300     SET PS-NO-ERROR TO TRUE.                                        CL**4
           MOVE ZERO TO PV-SAVE-INITV-EVNT-ID.                                  
           MOVE ZERO TO PV-SAVE-INITV-CTG-ID.                                   
           MOVE ZERO TO PV-SAVE-CORP-INITV-ID.                                  
033000     PERFORM 1200-READ-CI-INSERT-FILE.                               CL*12
033100                                                                     CL**1
033200     EJECT                                                                
047100*                                                                         
00554 ******************************************************************FSKUP045
00555 *  UNSTRING THE EXCEL COMMA DELIMITED FILE                        FSKUP045
00556 ******************************************************************FSKUP045
043400                                                                          
00557  2200-UNSTRING.                                                   FSKUP045
00553 *                                                                 FSKUP045
           INITIALIZE CI-INSERT.                                                
048800     UNSTRING PV-INSERT-RECORD DELIMITED BY ',' INTO                      
005700     CI-NEW-CTG-IND                                                  CL**1
005700     CI-CTG-DESC                                                     CL**1
005700     CI-NEW-EVNT-IND                                                 CL**1
005700     CI-EVNT-DESC                                                    CL**1
005700     CI-NAME                                                         CL**1
           CI-BEGIN-DTE                                                         
           CI-END-DTE                                                           
           CI-CTG-ID                                                            
           CI-EVNT-ID                                                           
           CI-FILLER.                                                           
047100*                                                                         
051300*    DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.                 CL**1
005700*    DISPLAY 'CI-NEW-CTG-IND  = ' CI-NEW-CTG-IND.                    CL**1
005700*    DISPLAY 'CI-CTG-DESC     = ' CI-CTG-DESC.                       CL**1
005700*    DISPLAY 'CI-NEW-EVNT-IND = ' CI-NEW-EVNT-IND.                   CL**1
005700*    DISPLAY 'CI-EVNT-DESC    = ' CI-EVNT-DESC.                      CL**1
005700*    DISPLAY 'CI-NAME         = ' CI-NAME.                           CL**1
047100*    DISPLAY 'CI-BEGIN-DTE    = ' CI-BEGIN-DTE.                           
047100*    DISPLAY 'CI-END-DTE      = ' CI-END-DTE.                             
047100*    DISPLAY 'CI-CTG-ID       = ' CI-CTG-ID.                              
047100*    DISPLAY 'CI-EVNT-ID      = ' CI-EVNT-ID.                             
00554 ******************************************************************FSKUP045
00555 *  PROCESS CTG.                                                   FSKUP045
00556 ******************************************************************FSKUP045
043400                                                                          
       2300-CTG.                                                                
00553 *                                                                 FSKUP045
005700     IF CI-NEW-CTG-IND = SPACE                                       CL**1
               PERFORM 5200-CTG-EXIST-CK                                        
           ELSE                                                                 
      *  THIS WAS A NEW CATEGORY EARLIER IN THIS FILE                           
      *  NOW GO FIND THE CTG ID BY USING THE CTG TYP = P AND THE                
      *  INPUT CATEGORY DESCRIPTION                                             
               IF CI-NEW-CTG-IND = 'R'                                          
                   PERFORM 5050-GET-R-CTG                                       
               ELSE                                                             
                   PERFORM 5000-GET-MAX-CTG-ID                                  
                   PERFORM 5100-INSERT-CTG                                      
               END-IF                                                           
           END-IF.                                                              
                                                                                
00554 ******************************************************************FSKUP045
00555 *  PROCESS EVNT.                                                  FSKUP045
00556 ******************************************************************FSKUP045
043400                                                                          
 31700 2400-EVNT.                                                               
           IF CI-NEW-EVNT-IND = SPACE                                           
               PERFORM 5500-EVNT-EXIST-CK                                       
           ELSE                                                                 
      *  THIS WAS A NEW EVENT EARLIER IN THIS FILE                              
      *  NOW GO FIND THE EVNT ID BY USING EVENT DESCRIPTION                     
      *  FROM THE INPUT FILE                                                    
               IF CI-NEW-EVNT-IND = 'R'                                         
                   PERFORM 5350-GET-R-EVNT                                      
               ELSE                                                             
                   PERFORM 5300-GET-MAX-EVNT-ID                                 
                   PERFORM 5400-INSERT-EVNT                                     
               END-IF                                                           
           END-IF.                                                              
043400                                                                          
00554 ******************************************************************FSKUP045
00555 *  PROCESS SUM                                                    FSKUP045
00556 ******************************************************************FSKUP045
043400                                                                          
 31700 2500-SUM.                                                                
           IF PS-NO-ERROR                                                       
               PERFORM 5600-SUM-EXIST-CK                                        
               IF SQLCODE = +100                                                
                   PERFORM 5700-INSERT-SUM                                      
               END-IF                                                           
           END-IF.                                                              
043400                                                                          
00554 ******************************************************************FSKUP045
00555 *  PROCESS INITV                                                  FSKUP045
00556 ******************************************************************FSKUP045
043400                                                                          
 31700 2600-INITV.                                                              
           IF PS-NO-ERROR                                                       
               PERFORM 5800-GET-MAX-CI-ID                                       
               PERFORM 5900-INSERT-CI                                           
           END-IF.                                                              
                                                                                
                                                                                
00554 ******************************************************************FSKUP045
00555 *  GET MAX CTG ID.                                                FSKUP045
00556 ******************************************************************FSKUP045
       5000-GET-MAX-CTG-ID.                                                     
                                                                                
051000     PERFORM  WITH TEST AFTER                                             
051100             UNTIL SQLCODE = +0                                           
024800                OR SQLCODE = -305                                         
051200                OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                
00558          EXEC SQL                                                 FSKUP045
00559              SELECT MAX(INITV_CTG_ID)                             FSKUP045
                   INTO :IMT00005-INITV-CTG-ID                                  
00560              FROM IMT_INITV_CTG                                   FSKUP045
00564          END-EXEC                                                 FSKUP045
044800                                                                          
044900         EVALUATE TRUE                                                    
045000             WHEN SQLCODE = +0                                            
045100                  ADD +1         TO IMT00005-INITV-CTG-ID            CL*15
                        MOVE IMT00005-INITV-CTG-ID TO                           
                                       PV-SAVE-INITV-CTG-ID                     
                        ADD +1         TO PA-MAX-CTG-SELECTS                    
045200             WHEN SQLCODE = -911                                          
045300             WHEN SQLCODE = -913                                          
045400                  ADD 1          TO PV-RETRY-COUNT                        
045500             WHEN OTHER                                                   
045600                  MOVE '5000-GET-MAX-CTG-ID'                             C
045700                                 TO PV-PARAGRAPH-NAME                CL**1
045800                  MOVE 'GET MAX FROM IMT_INITV_CTG'                  CL*11
045900                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
046000                  PERFORM 9100-SQL-ABEND                             CL**1
046100         END-EVALUATE                                                     
046200     END-PERFORM.                                                         
046300*                                                                         
046400     IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
045600         MOVE '5000-GET-MAX-CTG-ID'                                      C
046600                                 TO PV-PARAGRAPH-NAME                CL**1
045800         MOVE 'GET MAX FROM IMT_INITV_CTG'                           CL*11
046800                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
046900                  PERFORM 9100-SQL-ABEND                             CL**1
047000     END-IF.                                                              
           MOVE PV-SAVE-INITV-CTG-ID        TO PV-DIS-CTG-ID.                   
045600*    DISPLAY '5000-GET-MAX-CTG-ID PLUS ONE'.                             C
009300*    DISPLAY '*CTG ID               : ' PV-DIS-CTG-ID.               CL*15
                                                                                
047100*                                                                         
       5050-GET-R-CTG.                                                          
00554 ******************************************************************FSKUP045
00555 *  GET THE CTG ID OF THIS REC USING THE INPUT DESC                FSKUP045
00556 ******************************************************************FSKUP045
045600*    DISPLAY '5050-GET-R-CTG'.                                           C
009300*    DISPLAY 'CI CTG DESC           : ' CI-CTG-DESC.                 CL*15
           MOVE CI-CTG-DESC         TO IMT00005-INITV-CTG-DESC.                 
                                                                                
051000     PERFORM  WITH TEST AFTER                                             
051100             UNTIL SQLCODE = +0                                           
024800                OR SQLCODE = +100                                         
051200                OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                
00558          EXEC SQL                                                 FSKUP045
00559              SELECT INITV_CTG_ID                                  FSKUP045
                   INTO :IMT00005-INITV-CTG-ID                                  
00560              FROM IMT_INITV_CTG                                   FSKUP045
                   WHERE INITV_CTG_DESC = :IMT00005-INITV-CTG-DESC              
                     AND INITV_CTG_TYP_CDE = 'P'                                
00564          END-EXEC                                                 FSKUP045
044800                                                                          
044900         EVALUATE TRUE                                                    
045000             WHEN SQLCODE = +0                                            
                        MOVE IMT00005-INITV-CTG-ID TO                           
                                       PV-SAVE-INITV-CTG-ID                     
                        ADD +1         TO PA-R-CTG-SELECTS                      
045000             WHEN SQLCODE = +100                                          
                        SET PS-ERROR TO TRUE                                    
                        DISPLAY 'CATEGORY ID NOT FOUND ON IMT_INITV_CTG'        
                                 CI-CTG-DESC                                    
045200             WHEN SQLCODE = -911                                          
045300             WHEN SQLCODE = -913                                          
045400                  ADD 1          TO PV-RETRY-COUNT                        
045500             WHEN OTHER                                                   
                        MOVE '5050-GET-R-CTG'                                   
045700                                 TO PV-PARAGRAPH-NAME                CL**1
045800                  MOVE 'GET REPEAT FROM IMT_INITV_CTG'               CL*11
045900                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
046000                  PERFORM 9100-SQL-ABEND                             CL**1
046100         END-EVALUATE                                                     
046200     END-PERFORM.                                                         
046300*                                                                         
046400     IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '5050-GET-R-CTG'                                            
046600                                 TO PV-PARAGRAPH-NAME                CL**1
045800         MOVE 'GET REPEAT FROM IMT_INITV_CTG'                        CL*11
046800                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
046900         PERFORM 9100-SQL-ABEND                                      CL**1
047000     END-IF.                                                              
045600     MOVE PV-SAVE-INITV-CTG-ID        TO PV-DIS-CTG-ID.                  C
045600*    DISPLAY '5050-GET-R-CTG-ID'.                                        C
009300*    DISPLAY '*CTG-IDT-R-CTG-ID'.   : ' PV-DIS-CTG-ID.               CL*15
                                                                                
00554 ******************************************************************FSKUP045
00555 *  INSERT INTO IMT_INITV_CTG.                                     FSKUP045
00556 ******************************************************************FSKUP045
       5100-INSERT-CTG.                                                         
           MOVE IMT00005-INITV-CTG-ID       TO PV-DIS-CTG-ID.                   
045600*    DISPLAY '5100-INSERT-CTG'.                                          C
009300*    DISPLAY '*CTG ID               : ' PV-DIS-CTG-ID.               CL*15
      *    DISPLAY '*CTG DESC             : ' CI-CTG-DESC.                      
005700     MOVE CI-CTG-DESC              TO IMT00005-INITV-CTG-DESC.       CL**1
           MOVE 'P'                      TO IMT00005-INITV-CTG-TYP-CDE.         
051000     PERFORM  WITH TEST AFTER                                             
051100             UNTIL SQLCODE = +0                                           
024800                OR SQLCODE = -803                                         
051200                OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                
00558          EXEC SQL                                                 FSKUP045
                   INSERT INTO IMT_INITV_CTG                                    
                       ( INITV_CTG_ID                                           
                        ,INITV_CTG_DESC                                         
                        ,INITV_CTG_TYP_CDE)                                     
                   VALUES                                                       
                       ( :IMT00005-INITV-CTG-ID                                 
                        ,:IMT00005-INITV-CTG-DESC                               
                        ,:IMT00005-INITV-CTG-TYP-CDE)                           
00564          END-EXEC                                                 FSKUP045
044800                                                                          
044900         EVALUATE TRUE                                                    
045000             WHEN SQLCODE = +0                                            
                        ADD +1         TO PA-CTG-INSERTS                        
045200             WHEN SQLCODE = -911                                          
045300             WHEN SQLCODE = -913                                          
045400                  ADD 1          TO PV-RETRY-COUNT                        
045500             WHEN OTHER                                                   
045600                  MOVE '5100-INSERT-CTG'                                 C
 45700                                 TO PV-PARAGRAPH-NAME                CL**1
045800                  MOVE 'INSERT INTO IMT_INITV_CTG'                   CL*11
045900                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
046000                  PERFORM 9100-SQL-ABEND                             CL**1
046100         END-EVALUATE                                                     
046200     END-PERFORM.                                                         
046300*                                                                         
046400     IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
045600         MOVE '5100-INSERT-CTG'                                          C
046600                                 TO PV-PARAGRAPH-NAME                CL**1
045800         MOVE 'INSERT INTO IMT_INITV_CTG'                            CL*11
046800                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
046900         PERFORM 9100-SQL-ABEND                                      CL**1
047000     END-IF.                                                              
                                                                                
                                                                                
00554 ******************************************************************FSKUP045
00555 *  EXISTENCE CHECK ON IMT_INITV_CTG                               FSKUP045
00556 ******************************************************************FSKUP045
       5200-CTG-EXIST-CK.                                                       
045600*    DISPLAY '5200-CTG-EXIST-CK'.                                        C
009300*    DISPLAY 'CI CTG ID             : ' CI-CTG-ID.                   CL*15
           MOVE CI-CTG-ID                   TO PV-CTG-ID-COMP.                  
           MOVE PV-CTG-ID-COMP              TO IMT00005-INITV-CTG-ID.           
                                                                                
051000     PERFORM  WITH TEST AFTER                                             
051100             UNTIL SQLCODE = +0                                           
024800                OR SQLCODE = +100                                         
051200                OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                
00558          EXEC SQL                                                 FSKUP045
00559              SELECT 1                                             FSKUP045
                   INTO :PV-DB2-TEST                                            
00560              FROM IMT_INITV_CTG                                   FSKUP045
                   WHERE INITV_CTG_ID = :IMT00005-INITV-CTG-ID                  
24521              FETCH FIRST 1 ROW ONLY                                       
00564          END-EXEC                                                 FSKUP045
044800                                                                          
044900         EVALUATE TRUE                                                    
045000             WHEN SQLCODE = +0                                            
                        ADD +1         TO PA-CTG-EXISTS                         
                        MOVE IMT00005-INITV-CTG-ID TO                           
                                       PV-SAVE-INITV-CTG-ID                     
                   WHEN SQLCODE = +100                                          
                        SET PS-ERROR TO TRUE                                    
                        DISPLAY 'CATEGORY ID NOT FOUND ON IMT_INITV_CTG'        
                                 CI-CTG-ID                                      
045200             WHEN SQLCODE = -911                                          
045300             WHEN SQLCODE = -913                                          
045400                  ADD 1          TO PV-RETRY-COUNT                        
045500             WHEN OTHER                                                   
                        MOVE '5200-CTG-EXIST-CK'                                
045700                                 TO PV-PARAGRAPH-NAME                CL**1
045800                  MOVE 'EXISTENCE CK IMT_INITV_CTG'                  CL*11
045900                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
046000                  PERFORM 9100-SQL-ABEND                             CL**1
046100         END-EVALUATE                                                     
046200     END-PERFORM.                                                         
046300*                                                                         
046400     IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '5200-CTG-EXIST-CK'                                         
046600                                 TO PV-PARAGRAPH-NAME                CL**1
045800         MOVE 'EXISTENCE CK IMT_INITV_CTG'                           CL*11
046800                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
046900         PERFORM 9100-SQL-ABEND                                      CL**1
047000     END-IF.                                                              
047100*                                                                         
00554 ******************************************************************FSKUP045
00555 *  GET MAX EVNT ID.                                               FSKUP045
00556 ******************************************************************FSKUP045
       5300-GET-MAX-EVNT-ID.                                                    
                                                                                
051000     PERFORM  WITH TEST AFTER                                             
051100             UNTIL SQLCODE = +0                                           
024800                OR SQLCODE = -305                                         
051200                OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                
00558          EXEC SQL                                                 FSKUP045
00559              SELECT MAX(INITV_EVNT_ID)                            FSKUP045
                   INTO :IMT00007-INITV-EVNT-ID                                 
00560              FROM IMT_INITV_EVNT                                  FSKUP045
00564          END-EXEC                                                 FSKUP045
044800                                                                          
044900         EVALUATE TRUE                                                    
045000             WHEN SQLCODE = +0                                            
045100                  ADD +1         TO IMT00007-INITV-EVNT-ID           CL*15
                        MOVE IMT00007-INITV-EVNT-ID TO                          
                                       PV-SAVE-INITV-EVNT-ID                    
                        ADD +1         TO PA-MAX-EVNT-SELECTS                   
045200             WHEN SQLCODE = -911                                          
045300             WHEN SQLCODE = -913                                          
045400                  ADD 1          TO PV-RETRY-COUNT                        
045500             WHEN OTHER                                                   
045600                  MOVE '5300-GET-MAX-EVNT-ID'                            C
045700                                 TO PV-PARAGRAPH-NAME                CL**1
045800                  MOVE 'GET MAX FROM IMT_INITV_EVNT'                 CL*11
045900                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
046000                  PERFORM 9100-SQL-ABEND                             CL**1
046100         END-EVALUATE                                                     
046200     END-PERFORM.                                                         
046300*                                                                         
046400     IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
045600         MOVE '5300-GET-MAX-EVNT-ID'                                     C
046600                                 TO PV-PARAGRAPH-NAME                CL**1
045800         MOVE 'GET MAX FROM IMT_INITV_EVNT'                          CL*11
046800                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
046900         PERFORM 9100-SQL-ABEND                                      CL**1
047000     END-IF.                                                              
           MOVE PV-SAVE-INITV-EVNT-ID       TO PV-DIS-EVNT-ID.                  
045600*    DISPLAY '5300-GET-MAX-ENVT-ID'                                      C
009300*    DISPLAY '*EVENT ID PLUS ONE    : ' PV-DIS-EVNT-ID.              CL*15
047100*                                                                         
                                                                                
        5350-GET-R-EVNT.                                                        
00554 ******************************************************************FSKUP045
00555 *  GET THE EVNT ID OF THIS REC USING THE INPUT DESC               FSKUP045
00556 ******************************************************************FSKUP045
045600*    DISPLAY '5350-GET-R-EVNT'.                                          C
009300*    DISPLAY 'CI EVNT DESC          : ' CI-EVNT-DESC.                CL*15
           MOVE CI-EVNT-DESC        TO IMT00007-INITV-EVNT-DESC.                
                                                                                
051000     PERFORM  WITH TEST AFTER                                             
051100             UNTIL SQLCODE = +0                                           
024800                OR SQLCODE = +100                                         
051200                OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                
00558          EXEC SQL                                                 FSKUP045
00559              SELECT INITV_EVNT_ID                                 FSKUP045
                   INTO :IMT00007-INITV-EVNT-ID                                 
00560              FROM IMT_INITV_EVNT                                  FSKUP045
                   WHERE INITV_EVNT_DESC = :IMT00007-INITV-EVNT-DESC            
00564          END-EXEC                                                 FSKUP045
044800                                                                          
044900         EVALUATE TRUE                                                    
045000             WHEN SQLCODE = +0                                            
                        MOVE IMT00007-INITV-EVNT-ID TO                          
                                       PV-SAVE-INITV-EVNT-ID                    
                        ADD +1         TO PA-R-EVNT-SELECTS                     
045000             WHEN SQLCODE = +100                                          
                        SET PS-ERROR TO TRUE                                    
PK2167                  SET PS-ABEND TO TRUE                                    
                        DISPLAY 'EVENT ID NOT FOUND ON IMT_INITV_EVNT'          
                                 CI-EVNT-DESC                                   
PK2167                  MOVE '5350-GET-R-EVNT'                                  
045700                                 TO PV-PARAGRAPH-NAME                CL**1
PK2167                  MOVE 'CHECK EVENT ID ON IMT_INITV_EVNT'            CL*11
PK2167                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
PK2167                  PERFORM 9100-SQL-ABEND                             CL**1
045200             WHEN SQLCODE = -911                                          
 45300             WHEN SQLCODE = -913                                          
045400                  ADD 1          TO PV-RETRY-COUNT                        
045500             WHEN OTHER                                                   
                        MOVE '5350-GET-R-EVNT'                                  
045700                                 TO PV-PARAGRAPH-NAME                CL**1
045800                  MOVE 'GET REPEAT FROM IMT_INITV_EVNT'              CL*11
045900                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
046000                  PERFORM 9100-SQL-ABEND                             CL**1
046100         END-EVALUATE                                                     
046200     END-PERFORM.                                                         
046300*                                                                         
046400     IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '5350-GET-R-EVNT'                                           
046600                                 TO PV-PARAGRAPH-NAME                CL**1
045800         MOVE 'GET REPEAT FROM IMT_INITV_EVNT'                       CL*11
046800                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
046900         PERFORM 9100-SQL-ABEND                                      CL**1
047000     END-IF.                                                              
045600     DISPLAY '5350-GET-R-EVNT-ID'.                                       C
           MOVE PV-SAVE-INITV-EVNT-ID        TO PV-DIS-EVNT-ID.                 
009300     DISPLAY '*EVNT ID               : ' PV-DIS-EVNT-ID.             CL*15
00554 ******************************************************************FSKUP045
00555 *  INSERT INTO IMT_INITV_EVNT.                                    FSKUP045
00556 ******************************************************************FSKUP045
       5400-INSERT-EVNT.                                                        
005700     MOVE CI-EVNT-DESC             TO IMT00007-INITV-EVNT-DESC.      CL**1
           MOVE IMT00007-INITV-EVNT-ID     TO PV-DIS-EVNT-ID.                   
045600*    DISPLAY '5400-INSERT-ENVT'.                                         C
009300*    DISPLAY '*EVENT ID             : ' PV-DIS-EVNT-ID.              CL*15
045600*    DISPLAY '*EVENT DESC           : ' IMT00007-INITV-EVNT-DESC.        C
051000     PERFORM  WITH TEST AFTER                                             
051100             UNTIL SQLCODE = +0                                           
024800                OR SQLCODE = -803                                         
051200                OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                
00558          EXEC SQL                                                 FSKUP045
                   INSERT INTO IMT_INITV_EVNT                                   
                       ( INITV_EVNT_ID                                          
                        ,INITV_EVNT_DESC)                                       
                   VALUES                                                       
                       ( :IMT00007-INITV-EVNT-ID                                
                        ,:IMT00007-INITV-EVNT-DESC)                             
00564          END-EXEC                                                 FSKUP045
044800                                                                          
044900         EVALUATE TRUE                                                    
045000             WHEN SQLCODE = +0                                            
                        ADD +1         TO PA-EVNT-INSERTS                       
045200             WHEN SQLCODE = -911                                          
045300             WHEN SQLCODE = -913                                          
045400                  ADD 1          TO PV-RETRY-COUNT                        
045500             WHEN OTHER                                                   
045600                  MOVE '5400-INSERT-EVNT'                                C
 45700                                 TO PV-PARAGRAPH-NAME                CL**1
045800                  MOVE 'INSERT INTO IMT_INITV_EVNT'                  CL*11
045900                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
046000                  PERFORM 9100-SQL-ABEND                             CL**1
046100         END-EVALUATE                                                     
046200     END-PERFORM.                                                         
046300*                                                                         
046400     IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
045600         MOVE '5400-INSERT-EVNT'                                         C
046600                                 TO PV-PARAGRAPH-NAME                CL**1
045800         MOVE 'INSERT INTO IMT_INITV_EVNT'                           CL*11
046800                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
046900         PERFORM 9100-SQL-ABEND                                      CL**1
047000     END-IF.                                                              
                                                                                
                                                                                
00554 ******************************************************************FSKUP045
00555 *  EXISTENCE CHECK ON IMT_INITV_EVNT                              FSKUP045
00556 ******************************************************************FSKUP045
       5500-EVNT-EXIST-CK.                                                      
           MOVE CI-EVNT-ID                  TO PV-EVNT-ID-COMP.                 
           MOVE PV-EVNT-ID-COMP             TO IMT00007-INITV-EVNT-ID.          
           MOVE CI-EVNT-ID                 TO PV-DIS-EVNT-ID.                   
045600*    DISPLAY '5500-EVNT-EXIST-CK'.                                       C
009300*    DISPLAY '*EVENT ID             : ' PV-DIS-EVNT-ID.              CL*15
                                                                                
051000     PERFORM  WITH TEST AFTER                                             
051100             UNTIL SQLCODE = +0                                           
024800                OR SQLCODE = +100                                         
051200                OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                
00558          EXEC SQL                                                 FSKUP045
00559              SELECT 1                                             FSKUP045
                   INTO :PV-DB2-TEST                                            
00560              FROM IMT_INITV_EVNT                                  FSKUP045
                   WHERE INITV_EVNT_ID = :IMT00007-INITV-EVNT-ID                
24521              FETCH FIRST 1 ROW ONLY                                       
00564          END-EXEC                                                 FSKUP045
044800                                                                          
044900         EVALUATE TRUE                                                    
045000             WHEN SQLCODE = +0                                            
                        ADD +1         TO PA-EVNT-EXISTS                        
                        MOVE IMT00007-INITV-EVNT-ID TO                          
                                       PV-SAVE-INITV-EVNT-ID                    
                   WHEN SQLCODE = +100                                          
                        SET PS-ERROR TO TRUE                                    
PK2167                  SET PS-ABEND TO TRUE                                    
PK2167                  DISPLAY 'EVENT ID NOT FOUND ON IMT_INITV_EVNT'          
                                 CI-EVNT-ID                                     
                        MOVE '5350-GET-R-EVNT'                                  
PK2167                                 TO PV-PARAGRAPH-NAME                CL**1
PK2167                  MOVE 'CHECK EVENT ID ON IMT_INITV_EVNT'            CL*11
PK2167                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
PK2167                  PERFORM 9100-SQL-ABEND                             CL**1
045200             WHEN SQLCODE = -911                                          
045300             WHEN SQLCODE = -913                                          
045400                  ADD 1          TO PV-RETRY-COUNT                        
045500             WHEN OTHER                                                   
                        MOVE '5500-EVNT-EXIST-CK'                               
045700                                 TO PV-PARAGRAPH-NAME                CL**1
045800                  MOVE 'EXISTENCE CK IMT_INITV_EVNT'                 CL*11
045900                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
046000                  PERFORM 9100-SQL-ABEND                             CL**1
046100         END-EVALUATE                                                     
046200     END-PERFORM.                                                         
046300*                                                                         
046400     IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '5500-EVNT-EXIST-CK'                                        
046600                                 TO PV-PARAGRAPH-NAME                CL**1
045800         MOVE 'EXISTENCE CK IMT_INITV_EVNT'                          CL*11
046800                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
046900         PERFORM 9100-SQL-ABEND                                      CL**1
047000     END-IF.                                                              
00554 ******************************************************************FSKUP045
00555 *  EXISTENCE CHECK ON IMT_INITV_SUM                               FSKUP045
00556 ******************************************************************FSKUP045
       5600-SUM-EXIST-CK.                                                       
                                                                                
           MOVE PV-SAVE-INITV-CTG-ID       TO IMT00006-INITV-CTG-ID.            
           MOVE PV-SAVE-INITV-EVNT-ID      TO IMT00006-INITV-EVNT-ID.           
           MOVE IMT00006-INITV-CTG-ID      TO PV-DIS-CTG-ID.                    
           MOVE IMT00006-INITV-EVNT-ID     TO PV-DIS-EVNT-ID.                   
045600*    DISPLAY '5600-SUM-EXIST-CK'.                                        C
009300*    DISPLAY '*EVENT ID             : ' PV-DIS-EVNT-ID.              CL*15
009300*    DISPLAY '*CTG ID               : ' PV-DIS-CTG-ID.               CL*15
051000     PERFORM  WITH TEST AFTER                                             
051100             UNTIL SQLCODE = +0                                           
024800                OR SQLCODE = +100                                         
051200                OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                
00558          EXEC SQL                                                 FSKUP045
00559              SELECT 1                                             FSKUP045
                   INTO :PV-DB2-TEST                                            
00560              FROM IMT_INITV_SUM                                   FSKUP045
                   WHERE INITV_CTG_ID = :IMT00006-INITV-CTG-ID                  
                     AND INITV_EVNT_ID = :IMT00006-INITV-EVNT-ID                
24521              FETCH FIRST 1 ROW ONLY                                       
00564          END-EXEC                                                 FSKUP045
044800                                                                          
044900         EVALUATE TRUE                                                    
045000             WHEN SQLCODE = +0                                            
                        ADD +1         TO PA-SUM-EXISTS                         
                   WHEN SQLCODE = +100                                          
                        CONTINUE                                                
045200             WHEN SQLCODE = -911                                          
045300             WHEN SQLCODE = -913                                          
045400                  ADD 1          TO PV-RETRY-COUNT                        
045500             WHEN OTHER                                                   
                        MOVE '5600-SUM-EXIST-CK'                                
045700                                 TO PV-PARAGRAPH-NAME                CL**1
045800                  MOVE 'EXISTENCE CK IMT_INITV_SUM'                  CL*11
045900                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
046000                  PERFORM 9100-SQL-ABEND                             CL**1
046100         END-EVALUATE                                                     
046200     END-PERFORM.                                                         
046300*                                                                         
046400     IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '5600-SUM-EXIST-CK'                                         
046600                                 TO PV-PARAGRAPH-NAME                CL**1
045800         MOVE 'EXISTENCE CK IMT_INITV_SUM'                           CL*11
046800                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
046900         PERFORM 9100-SQL-ABEND                                      CL**1
047000     END-IF.                                                              
                                                                                
00554 ******************************************************************FSKUP045
00555 *  INSERT INTO IMT_INITV_SUM.                                     FSKUP045
00556 ******************************************************************FSKUP045
       5700-INSERT-SUM.                                                         
           MOVE PV-SAVE-INITV-EVNT-ID       TO IMT00006-INITV-EVNT-ID.          
           MOVE PV-SAVE-INITV-CTG-ID        TO IMT00006-INITV-CTG-ID.           
           MOVE CI-BEGIN-DTE                TO IMT00006-EFF-BEG-DTE.            
           MOVE CI-END-DTE                  TO IMT00006-EFF-END-DTE.            
           MOVE IMT00006-INITV-EVNT-ID      TO PV-DIS-EVNT-ID.                  
           MOVE IMT00006-INITV-CTG-ID       TO PV-DIS-CTG-ID.                   
      *    DISPLAY '5700-INSERT-SUM'.                                           
009300*    DISPLAY '*EVENT ID             : ' PV-DIS-EVNT-ID.              CL*15
009300*    DISPLAY '*CTG ID               : ' PV-DIS-CTG-ID.               CL*15
009300*    DISPLAY '*BEGIN DATE           : ' IMT00006-EFF-BEG-DTE.        CL*15
009300*    DISPLAY '*END DATE             : ' IMT00006-EFF-END-DTE.        CL*15
                                                                                
051000     PERFORM  WITH TEST AFTER                                             
051100             UNTIL SQLCODE = +0                                           
024800                OR SQLCODE = -803                                         
051200                OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                
00558          EXEC SQL                                                 FSKUP045
                   INSERT INTO IMT_INITV_SUM                                    
                       ( INITV_CTG_ID                                           
                        ,INITV_EVNT_ID                                          
                        ,EFF_BEG_DTE                                            
                        ,EFF_END_DTE)                                           
                   VALUES                                                       
                       ( :IMT00006-INITV-CTG-ID                                 
                        ,:IMT00006-INITV-EVNT-ID                                
                        ,:IMT00006-EFF-BEG-DTE                                  
                        ,:IMT00006-EFF-END-DTE)                                 
00564          END-EXEC                                                 FSKUP045
044800                                                                          
044900         EVALUATE TRUE                                                    
045000             WHEN SQLCODE = +0                                            
                        ADD +1         TO PA-SUM-INSERTS                        
045200             WHEN SQLCODE = -911                                          
045300             WHEN SQLCODE = -913                                          
045400                  ADD 1          TO PV-RETRY-COUNT                        
045500             WHEN OTHER                                                   
045600                  MOVE '5700-INSERT-SUM'                                 C
 45700                                 TO PV-PARAGRAPH-NAME                CL**1
045800                  MOVE 'INSERT INTO IMT_INITV_SUM'                   CL*11
045900                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
046000                  PERFORM 9100-SQL-ABEND                             CL**1
046100         END-EVALUATE                                                     
046200     END-PERFORM.                                                         
046300*                                                                         
046400     IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
045600         MOVE '5700-INSERT-SUM'                                          C
046600                                 TO PV-PARAGRAPH-NAME                CL**1
045800         MOVE 'INSERT INTO IMT_INITV_SUM'                            CL*11
046800                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
046900         PERFORM 9100-SQL-ABEND                                      CL**1
047000     END-IF.                                                              
                                                                                
047100*                                                                         
00554 ******************************************************************FSKUP045
00555 *  GET MAX CI ID.                                                 FSKUP045
00556 ******************************************************************FSKUP045
       5800-GET-MAX-CI-ID.                                                      
                                                                                
051000     PERFORM  WITH TEST AFTER                                             
051100             UNTIL SQLCODE = +0                                           
024800                OR SQLCODE = -305                                         
051200                OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                
00558          EXEC SQL                                                 FSKUP045
00559              SELECT MAX(CORP_INITV_ID)                            FSKUP045
                   INTO :IMT00002-CORP-INITV-ID                                 
00560              FROM IMT_CORP_INITV                                  FSKUP045
00564          END-EXEC                                                 FSKUP045
044800                                                                          
044900         EVALUATE TRUE                                                    
045000             WHEN SQLCODE = +0                                            
045100                  ADD +1         TO IMT00002-CORP-INITV-ID           CL*15
                        MOVE IMT00002-CORP-INITV-ID TO                          
                                       PV-SAVE-CORP-INITV-ID                    
                        ADD +1         TO PA-MAX-INITV-SELECTS                  
045200             WHEN SQLCODE = -911                                          
045300             WHEN SQLCODE = -913                                          
045400                  ADD 1          TO PV-RETRY-COUNT                        
045500             WHEN OTHER                                                   
045600                  MOVE '5800-GET-MAX-INITV-ID'                           C
045700                                 TO PV-PARAGRAPH-NAME                CL**1
045800                  MOVE 'GET MAX FROM IMT_CORP_INITV'                 CL*11
045900                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
046000                  PERFORM 9100-SQL-ABEND                             CL**1
046100         END-EVALUATE                                                     
046200     END-PERFORM.                                                         
046300*                                                                         
046400     IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
045600         MOVE '5800-GET-MAX-INITV-ID'                                    C
046600                                 TO PV-PARAGRAPH-NAME                CL**1
045800         MOVE 'GET MAX FROM IMT_CORP_INITV'                          CL*11
046800                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
046900         PERFORM 9100-SQL-ABEND                                      CL**1
047000     END-IF.                                                              
           MOVE IMT00002-CORP-INITV-ID      TO PV-DIS-INITV-ID.                 
045600*    DISPLAY '5800-GET-MAX-CI-ID'.                                       C
009300*    DISPLAY '*INITV ID             : ' PV-DIS-INITV-ID.             CL*15
                                                                                
00554 ******************************************************************FSKUP045
00555 *  INSERT INTO IMT_CORP_INITV                                     FSKUP045
00556 ******************************************************************FSKUP045
       5900-INSERT-CI.                                                          
           MOVE PV-SAVE-INITV-EVNT-ID       TO PV-DIS-EVNT-ID.                  
           MOVE PV-SAVE-INITV-CTG-ID        TO PV-DIS-CTG-ID.                   
           MOVE PV-SAVE-CORP-INITV-ID       TO PV-DIS-INITV-ID.                 
      *    DISPLAY '5900-INSERT-CI'.                                            
009300*    DISPLAY '*EVENT ID             : ' PV-DIS-EVNT-ID.              CL*15
009300*    DISPLAY '*CTG ID               : ' PV-DIS-CTG-ID.               CL*15
009300*    DISPLAY '*INITV ID             : ' PV-DIS-INITV-ID.             CL*15
009300*    DISPLAY '*BEG/SET              : ' CI-BEGIN-DTE.                CL*15
009300*    DISPLAY '*END/BRK              : ' CI-END-DTE.                  CL*15
009300*    DISPLAY '*CORP INIT NM DESC    : ' CI-NAME.                     CL*15
           MOVE PV-SAVE-INITV-EVNT-ID       TO IMT00002-INITV-EVNT-ID.          
           MOVE PV-SAVE-INITV-CTG-ID        TO IMT00002-INITV-CTG-ID.           
           MOVE PV-SAVE-CORP-INITV-ID       TO IMT00002-CORP-INITV-ID.          
           MOVE CI-BEGIN-DTE                TO IMT00002-EFF-BEG-DTE             
                                               IMT00002-SET-DTE.                
           MOVE CI-END-DTE                  TO IMT00002-EFF-END-DTE             
                                               IMT00002-BRK-DTE.                
005700     MOVE CI-NAME                TO IMT00002-CORP-INITV-NM-DESC.     CL**1
                                                                                
051000     PERFORM  WITH TEST AFTER                                             
051100             UNTIL SQLCODE = +0                                           
024800                OR SQLCODE = -803                                         
051200                OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                
00558          EXEC SQL                                                 FSKUP045
                   INSERT INTO IMT_CORP_INITV                                   
                       ( CORP_INITV_ID                                          
                        ,CORP_INITV_NM_DESC                                     
                        ,EFF_BEG_DTE                                            
                        ,EFF_END_DTE                                            
                        ,SET_DTE                                                
                        ,BRK_DTE                                                
                        ,INITV_CTG_ID                                           
                        ,INITV_EVNT_ID)                                         
                   VALUES                                                       
                       ( :IMT00002-CORP-INITV-ID                                
                        ,:IMT00002-CORP-INITV-NM-DESC                           
                        ,:IMT00002-EFF-BEG-DTE                                  
                        ,:IMT00002-EFF-END-DTE                                  
                        ,:IMT00002-SET-DTE                                      
                        ,:IMT00002-BRK-DTE                                      
                        ,:IMT00002-INITV-CTG-ID                                 
                        ,:IMT00002-INITV-EVNT-ID)                               
 0564          END-EXEC                                                 FSKUP045
044800                                                                          
044900         EVALUATE TRUE                                                    
045000             WHEN SQLCODE = +0                                            
                        ADD +1         TO PA-INITV-INSERTS                      
045200             WHEN SQLCODE = -911                                          
045300             WHEN SQLCODE = -913                                          
045400                  ADD 1          TO PV-RETRY-COUNT                        
045500             WHEN OTHER                                                   
045600                  MOVE '5900-INSERT-CI'                                  C
 45700                                 TO PV-PARAGRAPH-NAME                CL**1
045800                  MOVE 'INSERT INTO IMT_CORP_INITV'                  CL*11
045900                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
046000                  PERFORM 9100-SQL-ABEND                             CL**1
046100         END-EVALUATE                                                     
046200     END-PERFORM.                                                         
046300*                                                                         
046400     IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
045600         MOVE '5900-INSERT-CI'                                           C
046600                                 TO PV-PARAGRAPH-NAME                CL**1
045800         MOVE 'INSERT INTO IMT_CORP_INITV'                           CL*11
046800                                 TO PV-DB2-OPERATION-ATTEMPTED       CL**1
046900         PERFORM 9100-SQL-ABEND                                      CL**1
047000     END-IF.                                                              
                                                                                
047200******************************************************************   CL**1
047300*      PERFORMS WRAP UP PROCESSING                               *   CL*12
047400******************************************************************   CL**1
047500                                                                     CL**1
047600 9000-EOJ-ROUTINE.                                                   CL**1
047700                                                                     CL**1
047800     CLOSE CI-INSERT-FILE.                                           CL*12
047900                                                                     CL**1
048000     EXEC SQL                                                        CL**5
048100         COMMIT WORK                                                 CL**5
048200     END-EXEC.                                                       CL**5
048300     ADD +1 TO PA-COMMITS-TAKEN.                                     CL*16
048400                                                                     CL*12
048500     PERFORM 9005-DISPLAY-TOTALS.                                    CL*16
048600                                                                     CL*16
048700******************************************************************   CL*16
048800*      DISPLAYS PROGRAM TOTALS                                   *   CL*16
048900******************************************************************   CL*16
049000                                                                     CL*16
050800 9005-DISPLAY-TOTALS.                                                CL*16
PK2167     IF PS-ABEND                                                          
PK2167     DISPLAY '** IMKUP045 TOTALS **************'                     CL*16
PK2167     DISPLAY '** INPUT RECS READ     : ' PA-CI-RECS-READ             CL*16
PK2167     DISPLAY '**TOTAL INSERTS        :  0'                           CL*15
PK2167     DISPLAY '**COMMITS TAKEN        :  0'                           CL*15
049200                                                                     CL*16
PK2167     ELSE                                                                 
PK2167     DISPLAY '** IMKUP045 TOTALS **************'                     CL*16
PK2167     DISPLAY '** INPUT RECS READ     : ' PA-CI-RECS-READ             CL*16
PK2167     DISPLAY '**IMT_INITV_CTG INSERTS: ' PA-CTG-INSERTS              CL*15
PK2167     DISPLAY '*IMT_INITV_EVNT INSERTS: ' PA-EVNT-INSERTS             CL*15
PK2167     DISPLAY '*IMT_CORP_INITV INSERTS: ' PA-INITV-INSERTS            CL*15
PK2167     DISPLAY '*IMT_INITV_SUM INSERTS : ' PA-SUM-INSERTS              CL*15
PK2167     DISPLAY '*IMT_INITV_CTG EXISTS  : ' PA-CTG-EXISTS               CL*15
PK2167     DISPLAY '*IMT_INITV_EVNT EXISTS : ' PA-EVNT-EXISTS              CL*15
PK2167     DISPLAY '*IMT_INITV_SUM EXISTS  : ' PA-SUM-EXISTS               CL*15
PK2167     DISPLAY '**IMT_INITV_CTG SELECTS: ' PA-MAX-CTG-SELECTS          CL*15
PK2167     DISPLAY '*IMT_INITV_EVNT SELECTS: ' PA-MAX-EVNT-SELECTS         CL*15
PK2167     DISPLAY '*IMT_CORP_INITV SELECTS: ' PA-MAX-INITV-SELECTS        CL*15
PK2167     DISPLAY '**IMT_INITV_CTG REPEATS: ' PA-R-CTG-SELECTS            CL*15
PK2167     DISPLAY '*IMT_INITV_EVNT REPEATS: ' PA-R-EVNT-SELECTS           CL*15
PK2167     DISPLAY '** COMMITS TAKEN       : ' PA-COMMITS-TAKEN            CL*16
PK2167     DISPLAY '** END OF IMKUP045 TOTALS *******'                     CL*16
PK2167     END-IF.                                                              
050100                                                                     CL*16
050200******************************************************************   CL**1
050300*      PERFORMS ABEND PROCESSING FOR SQL ERRORS.                 *   CL*13
050400******************************************************************   CL**1
050500                                                                     CL**1
050600 9100-SQL-ABEND.                                                     CL**1
050700                                                                     CL*13
050800     PERFORM 9005-DISPLAY-TOTALS.                                    CL*16
050900     DISPLAY ' '.                                                    CL*16
051000     DISPLAY '9100-SQL-ABEND'                                        CL**1
051100     DISPLAY '** ABEND     **'.                                      CL**1
051200     DISPLAY '** PROGRAM   ** = IMKUP045'.                           CL*17
051300     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.                 CL**1
051400     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.        CL**1
051500                                                                     CL**1
051600******************************************************************   CL**1
051700* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-       CL**1
051800* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE            CL**1
051900* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE        CL**1
052000* FORMAT.                                                            CL**1
052100******************************************************************   CL**1
052200     COPY DPPD004.                                                   CL**1
052300                                                                     CL**1
052400     MOVE +4013 TO ABEND-CODE.                                       CL**1
052500     CALL 'ILBOABN0' USING ABEND-CODE.                               CL**1
052600                                                                     CL*13
