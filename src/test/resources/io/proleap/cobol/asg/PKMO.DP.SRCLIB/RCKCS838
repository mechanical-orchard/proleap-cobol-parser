000100 IDENTIFICATION DIVISION.                                         00010000
000200******************************************************************00020000
000300* NON-TERMINALLY ATTACHED PROGRAM                                 00030000
000310* THIS PROGRAM IS CALL WHEN AN DC INBOUND TRAILER IS SET TO UN    00031000
000320* (UNLOADED) STATUS.                                              00032000
000330* THIS IS PART OF THE RPA (ROBOTIC PROCESS AUTOMATION) PROCESS    00033000
000340* FOR MISDIRECTS.                                                 00034000
000350* WHEN AN DC INBOUND TRAILER IS SET TO UN STATUS, THIS MODULE IS  00035000
000360* CALLED TO WRITE THE MISDIRECT RECEIVERS TO THE WFT_DAT_CNTL/XFER00036000
000370* TABLES TO BE PROCESSED BY THE RPA TO CREATE NEW RECEIVERS.      00037000
000380* THE RPA PROCESS FOLLOWS THE SAME CICS SCREEN FLOW AS A DC       00038000
000381* ASSOCIATE WOULD.                                                00038100
000382* THIS MODULE IS CALLED BY TRKCS112 & RCKCS827 ONLY IF THE PARM   00038200
000383* IS SET TO INDICATE THE DC IS USING RPA FOR MISDIRECT FOR        00038300
000384* RECEIVERS.  PARM:  RPAMSD                                       00038400
000385******************************************************************00038500
000386 PROGRAM-ID.             RCKCS838.                                00038600
000387 AUTHOR.                 DENISE HAHN.                             00038700
000388 INSTALLATION.           KOHLS.                                   00038800
000389 DATE-WRITTEN            JANUARY, 2020.                           00038900
000390 DATE-COMPILED.                                                   00039000
000400                                                                  00040000
000500******************************************************************00050000
000600 ENVIRONMENT DIVISION.                                            00060000
000700 DATA DIVISION.                                                   00070000
000800                                                                  00080000
000900 WORKING-STORAGE SECTION.                                         00090000
001000                                                                  00100000
001100*---------------------------------------------------------------* 00110000
001200*                                                               * 00120000
001300*---------------------------------------------------------------* 00130000
001400*  INPUT LAYOUT.                                                  00140000
001500                                                                  00150000
001600     COPY RCWS077.                                                00160000
001700                                                                  00170000
001710* OUTPUT LAYOUT                                                   00171000
001720     COPY RCWS076.                                                00172000
001730                                                                  00173000
001740 01  DK-DB2-KEYS.                                                 00174000
001750     05  DK-OPER-UNT-ID                  PIC S9(04) COMP.         00175000
001760     05  DK-TRIP-ID                      PIC S9(09) COMP.         00176000
001770                                                                  00177000
001780 01  PC-PROGRAM-CONSTANTS.                                        00178000
001790     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00179000
001800         'RCKCS838'.                                              00180000
001900     05  PC-DEFAULT-TMST          PIC X(26)                       00190000
002000                              VALUE '9999-09-09-09.09.09.999999'. 00200000
002100*                                                                 00210000
002200                                                                  00220000
002300 01  PS-PROGRAM-SWITCHES.                                         00230000
002400     05  PS-ABEND-IND                    PIC  X(01)  VALUE 'N'.   00240000
002500         88  PS-NO-ABEND                             VALUE 'N'.   00250000
002600         88  PS-ABEND                                VALUE 'Y'.   00260000
002700     05  PS-END-OF-CSR-SW                PIC  X(01)  VALUE 'N'.   00270000
002800         88  PS-NOT-END-OF-CSR                       VALUE 'N'.   00280000
002900         88  PS-END-OF-CSR                           VALUE 'Y'.   00290000
003000                                                                  00300000
003100 01  PV-PROGRAM-VARIABLES.                                        00310000
003200     05  PV-DISP-OPER                    PIC  9(04).              00320000
003300     05  PV-DISP-TRIP-ID                 PIC  9(09).              00330000
003400     05  PV-TASK-X.                                               00340000
003500         10  PV-TASK                     PIC 9(07)   VALUE ZERO.  00350000
003600     05  PV-CICS-MSG-AREA                PIC  X(120) VALUE SPACE. 00360000
003700                                                                  00370000
003800     05  PV-USER-ID                      PIC  X(07)  VALUE SPACE. 00380000
003900     05  PV-CICS-RESP                    PIC S9(08)  VALUE ZEROS  00390000
004000                                                     COMP SYNC.   00400000
004100     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     00410000
004200                                                COMP SYNC.        00420000
004300                                                                  00430000
004400     05  PV-OPER-UNT-ID                  PIC  S9(08)  COMP.       00440000
004500     05  PV-TRIP-ID                      PIC  S9(09)  COMP.       00450000
004600     05  PV-TRIP-STATUS-CDE              PIC   X(02).             00460000
004700     05  PV-OWNER-SCAC-ID                PIC   X(04).             00470000
004800     05  PV-VEH-NBR                      PIC   X(10).             00480000
004900     05  PV-PRO-NBR                      PIC   X(22).             00490000
005000     05  PV-BOL-NBR                      PIC   X(30).             00500000
005100     05  PV-VEND-SHIP-DTE                PIC   X(08).             00510000
005200     05  PV-CARR-SHIP-DTE                PIC   X(10).             00520000
005300     05  PV-ARRIVE-DTE                   PIC   X(08).             00530000
005400     05  PV-RCVR-SELECT                  PIC   X(01).             00540000
005500     05  PV-PO-NBR                       PIC  S9(09)  COMP.       00550000
005600     05  PV-REC-SEQ-NBR                  PIC  S9(09)  COMP.       00560000
005700     05  PV-EXPTD-OPER                   PIC  S9(08)  COMP.       00570000
005800     05  PV-EXPTD-TRIP                   PIC  S9(09)  COMP.       00580000
005900     05  PV-CARTON-CNT                   PIC  S9(09)  COMP.       00590000
006000     05  PV-UNIT-COUNT                   PIC  S9(09)  COMP.       00600000
006100     05  PV-DFLT-OPER-SET-ID             PIC  S9(04)  COMP.       00610000
006200*                                                                 00620000
006300                                                                  00630000
006400     05  PV-CAPTURE-CNT           PIC S9(09) COMP VALUE ZEROES.   00640000
006500     05  PV-RANDOM-TMST           PIC  X(26) VALUE SPACES.        00650000
006600     05  PC-RANDOM-PGM            PIC  X(08) VALUE 'DPKUT902'.    00660000
006700     05  PV-CAPTURE-RANDOM-NBR    PIC  9(09) VALUE ZEROES.        00670000
006701                                                                  00670100
006702     05  pv-disp-csr-po           PIC  9(09) VALUE ZEROES.        00670200
006703     05  pv-disp-csr-rcvr         PIC  9(04) VALUE ZEROES.        00670300
006704     05  pv-disp-csr-oper         PIC  z(04) VALUE ZEROES.        00670400
006705     05  pv-disp-csr-trip         PIC  z(09) VALUE ZEROES.        00670500
006706                                                                  00670600
006707*                                                                 00670700
006708 01  SE-SYSTEM-ERROR-MESSAGE.                                     00670800
006709     05  FILLER                  PIC X(43)    VALUE               00670900
006710         'A SYSTEM ERROR HAS OCCURRED - CONTACT DP - '.           00671000
006720     05  FILLER                  PIC X(33)    VALUE               00672000
006730         'PROGRAM RCKCS838       EIBRESP = '.                     00673000
006740     05  SE-CICS-RESPONSE        PIC 9(4)     VALUE ZERO.         00674000
006750     05  FILLER                  PIC X(5)     VALUE SPACES.       00675000
006760     05  FILLER                  PIC X(14)    VALUE               00676000
006770         'ATTEMPTING TO '.                                        00677000
006780     05  SE-ATTEMPTED-ACTION     PIC X(61)    VALUE SPACES.       00678000
006790                                                                  00679000
006800                                                                  00680000
006900******************************************************************00690000
007000*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               00700000
007100******************************************************************00710000
007200     COPY DPWS013.                                                00720000
007300                                                                  00730000
007400*----------------------------------------------------------------*00740000
007500*  RANDOM NUMBER AREA                                            *00750000
007600*----------------------------------------------------------------*00760000
007700     COPY DPWS902.                                                00770000
007800                                                                  00780000
007900******************************************************************00790000
008000*  WFT_DAT_CNTL                                                   00800000
008100******************************************************************00810000
008200     EXEC SQL                                                     00820000
008300         INCLUDE WFT00004                                         00830000
008400     END-EXEC.                                                    00840000
008500                                                                  00850000
008510******************************************************************00851000
008520*  WFT_DAT_XFER                                                   00852000
008530******************************************************************00853000
008540     EXEC SQL                                                     00854000
008550         INCLUDE WFT00005                                         00855000
008560     END-EXEC.                                                    00856000
008570                                                                  00857000
008580******************************************************************00858000
008590*  SHIPMENT TABLE                                                 00859000
008600******************************************************************00860000
008700     EXEC SQL                                                     00870000
008800         INCLUDE TSHIPMT                                          00880000
008900     END-EXEC.                                                    00890000
009000                                                                  00900000
009100******************************************************************00910000
009200*  SHIPMENT TO PO TABLE                                           00920000
009300******************************************************************00930000
009400     EXEC SQL                                                     00940000
009500         INCLUDE TSHPTPO                                          00950000
009600     END-EXEC.                                                    00960000
009700                                                                  00970000
009800******************************************************************00980000
009900*  VEHICLE TRIP                                                   00990000
010000******************************************************************01000000
010100     EXEC SQL                                                     01010000
010200         INCLUDE TVHTRIP                                          01020000
010210     END-EXEC.                                                    01021000
010220                                                                  01022000
010230******************************************************************01023000
010240*  TRIP STATUS                                                    01024000
010250******************************************************************01025000
010260     EXEC SQL                                                     01026000
010270         INCLUDE TTRIPST                                          01027000
010280     END-EXEC.                                                    01028000
010290                                                                  01029000
010291******************************************************************01029100
010292*  COMPANY CONTROL                                                01029200
010293******************************************************************01029300
010294     EXEC SQL                                                     01029400
010295         INCLUDE TCOCNTL                                          01029500
010296     END-EXEC.                                                    01029600
010297                                                                  01029700
010298******************************************************************01029800
010299*  INBOUND SSCC LOCATION                                          01029900
010300******************************************************************01030000
010301     EXEC SQL                                                     01030100
010302         INCLUDE TSHUNLO                                          01030200
010303     END-EXEC.                                                    01030300
010304                                                                  01030400
010305******************************************************************01030500
010306*  INBOUND SSCC PACKSLIP ASSOCIATION                              01030600
010307******************************************************************01030700
010308     EXEC SQL                                                     01030800
010309         INCLUDE TINPKSU                                          01030900
010310     END-EXEC.                                                    01031000
010311                                                                  01031100
010312******************************************************************01031200
010313*  RECEIVER                                                       01031300
010314******************************************************************01031400
010315     EXEC SQL                                                     01031500
010316         INCLUDE TRECEIV                                          01031600
010317     END-EXEC.                                                    01031700
010318                                                                  01031800
010319******************************************************************01031900
010320*  INBOUND SSCC UPC CONTENTS                                      01032000
010321******************************************************************01032100
010322     EXEC SQL                                                     01032200
010323         INCLUDE TSHUUPC                                          01032300
010324     END-EXEC.                                                    01032400
010325                                                                  01032500
010326******************************************************************01032600
010327*  COMMUNICATIONS AREA FOR DB2                                    01032700
010328******************************************************************01032800
010329     EXEC SQL                                                     01032900
010330         INCLUDE SQLCA                                            01033000
010340     END-EXEC.                                                    01034000
010350                                                                  01035000
010360*---------------------------------------------------------------* 01036000
010370*   MISDIRECT RECEIVERS CURSOR                                  * 01037000
010380*---------------------------------------------------------------* 01038000
010390     EXEC SQL                                                     01039000
010400          DECLARE MIS_DIRECT_CSR CURSOR FOR                       01040000
010500              SELECT                                              01050000
010600                     T1.OPER_UNT_ID                               01060000
010700                   , T1.TRIP_ID                                   01070000
010800                   , T1.TRIP_STATUS_CDE                           01080000
010900                   , T1.OWNER_SCAC_ID                             01090000
010910                   , T1.VEH_NBR                                   01091000
010920                   , T1.PRO_NBR                                   01092000
010930                   , T1.BOL_NBR                                   01093000
010940                   , SUBSTR(CHAR(t1.vend_ship_dte, ISO),6,2)      01094000
010950                     || '/' ||                                    01095000
010960                     SUBSTR(CHAR(t1.vend_ship_dte, ISO),9,2)      01096000
010970                     || '/' ||                                    01097000
010980                     SUBSTR(CHAR(t1.vend_ship_dte, ISO),3,2)      01098000
010981                             AS VEND_SHIP_DTE                     01098100
010982                   , T1.OWNR_SCAC_SHIP_DTE AS CARR_SHIP_DTE       01098200
010983                   , SUBSTR(CHAR(T1.STATUS_DTE, ISO), 6, 2)       01098300
010984                     || '/' ||                                    01098400
010985                     SUBSTR(CHAR(T1.STATUS_DTE, ISO), 9, 2)       01098500
010986                     || '/' ||                                    01098600
010987                     SUBSTR(CHAR(T1.STATUS_DTE, ISO), 3, 2)       01098700
010988                             AS ARRIVE_DTE                        01098800
010989                   , T2.RCVR_SELECT                               01098900
010990                   , T2.PO_NBR                                    01099000
010991                   , T2.REC_SEQ_NBR                               01099100
010992                   , T2.EXPTD_OPER_UNT_ID                         01099200
010993                   , T2.EXPTD_TRIP                                01099300
010994                   , T2.CARTON_CNT                                01099400
010995                   , T2.UNIT_COUNT                                01099500
010996                   , T1.DFLT_OPER_SET_ID                          01099600
010997                FROM                                              01099700
010998                     (SELECT M.TRIP_ID                            01099800
010999                           , R.PRO_NBR                            01099900
011000                           , R.BOL_NBR                            01100000
011001                           , RA.VEND_SHIP_DTE                     01100100
011002                           , O.OWNR_SCAC_SHIP_DTE                 01100200
011003                           , P.OPER_UNT_ID                        01100300
011004                           , P.TRIP_STATUS_CDE                    01100400
011005                           , O.OWNER_SCAC_ID                      01100500
011006                           , O.VEH_NBR                            01100600
011007                           , Q.STATUS_DTE                         01100700
011008                           , AB.DFLT_OPER_SET_ID                  01100800
011009                           , COUNT(*)                             01100900
011010                        FROM TSHIPMT M                            01101000
011011                           , TSHPTPO N                            01101100
011012                           , TVHTRIP O                            01101200
011013                           , TTRIPST P                            01101300
011014                           , TTRIPST Q                            01101400
011015                           , TSHIPMT R                            01101500
011016                           , TSHIPMT RA                           01101600
011017                           , TCOCNTL AB                           01101700
011018                       WHERE                                      01101800
011019                             M.SHIPT_ID        = N.SHIPT_ID       01101900
011020                         AND N.PRIM_SHIPT_IND  = 'Y'              01102000
011021                         AND N.REC_SEQ_NBR     > 0                01102100
011022                         AND M.TRIP_ID         = O.TRIP_ID        01102200
011023                         AND M.TRIP_ID         = P.TRIP_ID        01102300
011024                         AND P.TRIP_ID         = :DK-TRIP-ID      01102400
011025                         AND P.TRIP_STATUS_CDE = 'UN'             01102500
011026                         AND P.OPER_UNT_ID     = :DK-OPER-UNT-ID  01102600
011027                         AND P.OPER_UNT_ID     = AB.OPER_UNT_ID   01102700
011028                         AND M.TRIP_ID         = Q.TRIP_ID        01102800
011029                         AND Q.TRIP_STATUS_CDE = 'AR'             01102900
011030                         AND O.TRIP_ID         = R.TRIP_ID        01103000
011031                         AND O.TRIP_ID         = RA.TRIP_ID       01103100
011032                         AND RA.VEND_SHIP_DTE IN                  01103200
011033                             (SELECT ABC.VEND_SHIP_DTE            01103300
011034                                FROM TSHIPMT ABC                  01103400
011035                               WHERE RA.TRIP_ID = ABC.TRIP_ID     01103500
011036                               ORDER BY ABC.VEND_SHIP_DTE DESC    01103600
011037                              FETCH FIRST 1 ROW ONLY)             01103700
011038                         AND R.PRO_NBR         IN                 01103800
011039                            (SELECT S.PRO_NBR                     01103900
011040                               FROM TSHIPMT S                     01104000
011041                              WHERE R.TRIP_ID  =  S.TRIP_ID       01104100
011042                                AND S.LAST_UPD_DTE  IN            01104200
011043                                   (SELECT MAX(T.LAST_UPD_DTE)    01104300
011044                                      FROM TSHIPMT T              01104400
011045                                     WHERE S.TRIP_ID = T.TRIP_ID  01104500
011046                                       AND T.PRO_NBR > ' ')       01104600
011047                                AND S.LAST_UPD_TME IN             01104700
011048                                 (SELECT MAX(U.LAST_UPD_TME)      01104800
011049                                    FROM TSHIPMT U                01104900
011050                                   WHERE S.TRIP_ID = U.TRIP_ID    01105000
011051                                     AND U.PRO_NBR > ' '          01105100
011052                                     AND U.LAST_UPD_DTE IN        01105200
011053                                     (SELECT MAX(V.LAST_UPD_DTE)  01105300
011054                                        FROM TSHIPMT V            01105400
011055                                       WHERE U.TRIP_ID = V.TRIP_ID01105500
011056                                         AND V.PRO_NBR > ' ')     01105600
011057                                 )                                01105700
011058                              FETCH FIRST 1 ROW ONLY              01105800
011059                            )                                     01105900
011060                         AND R.BOL_NBR         IN                 01106000
011061                          (SELECT W.BOL_NBR                       01106100
011062                             FROM TSHIPMT W                       01106200
011063                            WHERE R.TRIP_ID  =  W.TRIP_ID         01106300
011064                              AND W.LAST_UPD_DTE  IN              01106400
011065                                 (SELECT MAX(X.LAST_UPD_DTE)      01106500
011066                                    FROM TSHIPMT X                01106600
011067                                   WHERE W.TRIP_ID = X.TRIP_ID    01106700
011068                                     AND X.BOL_NBR  > ' ')        01106800
011069                             AND W.LAST_UPD_TME  IN               01106900
011070                               (SELECT MAX(Y.LAST_UPD_TME)        01107000
011071                                  FROM TSHIPMT Y                  01107100
011072                                 WHERE W.TRIP_ID  = Y.TRIP_ID     01107200
011073                                   AND Y.BOL_NBR  > ' '           01107300
011074                                   AND Y.LAST_UPD_DTE  IN         01107400
011075                                   (SELECT MAX(Z.LAST_UPD_DTE)    01107500
011076                                      FROM TSHIPMT Z              01107600
011077                                     WHERE Y.TRIP_ID = Z.TRIP_ID  01107700
011078                                       AND Z.BOL_NBR  > ' ')      01107800
011079                                )                                 01107900
011080                            FETCH FIRST 1 ROW ONLY                01108000
011081                          )                                       01108100
011082                       GROUP BY M.TRIP_ID                         01108200
011083                              , R.PRO_NBR                         01108300
011084                              , R.BOL_NBR                         01108400
011085                              , RA.VEND_SHIP_DTE                  01108500
011086                              , O.OWNR_SCAC_SHIP_DTE              01108600
011087                              , P.OPER_UNT_ID                     01108700
011088                              , P.TRIP_STATUS_CDE                 01108800
011089                              , O.OWNER_SCAC_ID                   01108900
011090                              , O.VEH_NBR                         01109000
011091                              , Q.STATUS_DTE                      01109100
011092                              , AB.DFLT_OPER_SET_ID               01109200
011093               UNION                                              01109300
011094                   SELECT AAO.TRIP_ID                             01109400
011095                        , 'UNKNOWN PRO' AS PRO_NBR                01109500
011096                        , 'UNKNOWN BOL' AS BOL_NBR                01109600
011097                        , CURRENT DATE AS VEND_SHIP_DTE           01109700
011098                        , AAO.OWNR_SCAC_SHIP_DTE                  01109800
011099                        , AAP.OPER_UNT_ID                         01109900
011100                        , AAP.TRIP_STATUS_CDE                     01110000
011101                        , AAO.OWNER_SCAC_ID                       01110100
011102                        , AAO.VEH_NBR                             01110200
011103                        , AAQ.STATUS_DTE                          01110300
011104                        , AAB.DFLT_OPER_SET_ID                    01110400
011105                        , COUNT(*)                                01110500
011106                     FROM                                         01110600
011107                          TVHTRIP AAO                             01110700
011108                        , TTRIPST AAP                             01110800
011109                        , TTRIPST AAQ                             01110900
011110                        , TCOCNTL AAB                             01111000
011111                    WHERE                                         01111100
011112                          AAO.TRIP_ID         = AAP.TRIP_ID       01111200
011113                      AND AAP.TRIP_ID         = :DK-TRIP-ID       01111300
011114                      AND AAP.TRIP_STATUS_CDE = 'UN'              01111400
011115                      AND AAP.OPER_UNT_ID     = :DK-OPER-UNT-ID   01111500
011116                      AND AAP.OPER_UNT_ID     = AAB.OPER_UNT_ID   01111600
011117                      AND AAO.TRIP_ID         = AAQ.TRIP_ID       01111700
011118                      AND AAQ.TRIP_STATUS_CDE = 'AR'              01111800
011119                      AND NOT AAO.TRIP_ID IN                      01111900
011120                          (SELECT AAR.TRIP_ID                     01112000
011121                             FROM TSHIPMT AAR)                    01112100
011122                    GROUP BY AAO.TRIP_ID                          01112200
011123                           , 2                                    01112300
011124                           , 3                                    01112400
011125                           , 4                                    01112500
011126                           , AAO.OWNR_SCAC_SHIP_DTE               01112600
011127                           , AAP.OPER_UNT_ID                      01112700
011128                           , AAP.TRIP_STATUS_CDE                  01112800
011129                           , AAO.OWNER_SCAC_ID                    01112900
011130                           , AAO.VEH_NBR                          01113000
011131                           , AAQ.STATUS_DTE                       01113100
011132                           , AAB.DFLT_OPER_SET_ID                 01113200
011133                    ORDER BY 12 DESC                              01113300
011134                           , 2                                    01113400
011135                           , 3                                    01113500
011136                           , 5                                    01113600
011137                     )  AS T1                                     01113700
011138                                                                  01113800
011139                 LEFT OUTER JOIN                                  01113900
011140                    (                                             01114000
011141******************************************************************01114100
011142** "A" MISDIRECTS WHERE CARTONS ARE ATTACHED TO A RECEIVER        01114200
011143******************************************************************01114300
011144                     SELECT 'A'                    AS RCVR_SELECT 01114400
011145                           , A.TRIP_ID             AS TRIP_ID     01114500
011146                           , D.PO_NBR              AS PO_NBR      01114600
011147                           , D.REC_SEQ_NBR         AS REC_SEQ_NBR 01114700
011148                           , f.curr_oper_unt_id                   01114800
011149                                        as exptd_oper_unt_id      01114900
011150                           , E.TRIP_ID             AS EXPTD_TRIP  01115000
011151                           , COUNT(distinct(A.SHIPT_UNT_ID))      01115100
011152                                                   AS CARTON_CNT  01115200
011153                           , SUM(H.SHPD_QTY)  AS UNIT_COUNT       01115300
011154                      FROM TSHUNLO A                              01115400
011155                         , TINPKSU B                              01115500
011156                         , TPKSLIP C                              01115600
011157                         , TSHPTPO D                              01115700
011158                         , TSHIPMT E                              01115800
011159                         , TRECEIV F                              01115900
011160                         , TVHTRIP G                              01116000
011161                         , TSHUUPC H                              01116100
011162                         , TTRIPST I                              01116200
011163                     WHERE                                        01116300
011164                           A.ACTV_CDE          = 'A'              01116400
011165                       AND A.SHIPT_UNT_ID      = B.SHIPT_UNT_ID   01116500
011166                       AND A.SHIPT_UNT_ID      = H.SHIPT_UNT_ID   01116600
011167                       AND C.VER_STAT_CDE      = 'A'              01116700
011168                       AND C.PKSL_STAT_CDE     = 'AC'             01116800
011169                       AND B.PO_NBR            = C.PO_NBR         01116900
011170                       AND B.SEQ_NBR           = C.SEQ_NBR        01117000
011171                       AND C.PO_NBR            = D.PO_NBR         01117100
011172                       AND C.REC_SEQ_NBR       = D.REC_SEQ_NBR    01117200
011173                       AND D.SHIPT_ID          = E.SHIPT_ID       01117300
011174                       AND E.TRIP_ID          <> A.TRIP_ID        01117400
011175                       AND D.PO_NBR            = F.ORD_NBR        01117500
011176                       AND D.REC_SEQ_NBR       = F.REC_SEQ_NBR    01117600
011177                       AND F.CURR_OPER_UNT_ID  = :DK-OPER-UNT-ID  01117700
011178                       AND NOT F.STATUS_CDE   IN ('VE','DE')      01117800
011179                       AND E.TRIP_ID           = G.TRIP_ID        01117900
011180                       AND G.TRIP_ID           = I.TRIP_ID        01118000
011181                       AND I.TRIP_ID           = :DK-TRIP-ID      01118100
011182                       AND I.TRIP_STATUS_CDE   = 'UN'             01118200
011183                       AND I.OPER_UNT_ID       = :DK-OPER-UNT-ID  01118300
011184                     GROUP BY 1                                   01118400
011185                             , A.TRIP_ID                          01118500
011186                             , D.PO_NBR                           01118600
011187                             , D.REC_SEQ_NBR                      01118700
011188                             , F.CURR_OPER_UNT_ID                 01118800
011189                             , E.TRIP_ID                          01118900
011190                     UNION                                        01119000
011191******************************************************************01119100
011192**  "B" MISDIRECTS WHERE CARTONS ARE NOT ATTACHED TO A RECEIVER   01119200
011193**  (NOT FREE ASTRAY PACKSLIP)                                    01119300
011194******************************************************************01119400
011195                    SELECT                                        01119500
011196                           B3.RCVR_SELECT                         01119600
011197                         , B3.TRIP_ID                             01119700
011198                         , B3.PO_NBR                              01119800
011199                         , B3.REC_SEQ_NBR                         01119900
011200                         , B3.EXPTD_OPER_UNT_ID                   01120000
011201                         , B3.EXPTD_TRIP                          01120100
011202                         , COUNT(DISTINCT(B3.SHIPT_UNT_ID))       01120200
011203                                            AS CARTON_CNT         01120300
011204                         , SUM(B3.SHPD_QTY) AS UNIT_COUNT         01120400
011205                    FROM                                          01120500
011206                    (SELECT B1.RCVR_SELECT                        01120600
011207                          , B1.TRIP_ID                            01120700
011208                          , B1.PO_NBR                             01120800
011209                          , B1.REC_SEQ_NBR                        01120900
011210                          , B1.EXPTD_OPER_UNT_ID                  01121000
011211                          , B1.EXPTD_TRIP                         01121100
011212                          , B1.SHIPT_UNT_ID                       01121200
011213                          , B2.SHPD_QTY                           01121300
011214                       FROM                                       01121400
011215                     (SELECT DISTINCT                             01121500
011216                              'B'             AS RCVR_SELECT      01121600
011217                             , AA.TRIP_ID     AS TRIP_ID          01121700
011218                             , BB.PO_NBR      AS PO_NBR           01121800
011219                             , DD.REC_SEQ_NBR AS REC_SEQ_NBR      01121900
011220                             , CC.OPER_UNT_ID                     01122000
011221                                            AS EXPTD_OPER_UNT_ID  01122100
011222                             , EE.TRIP_ID     AS EXPTD_TRIP       01122200
011223                             , AA.SHIPT_UNT_ID                    01122300
011224                          FROM TSHUNLO AA                         01122400
011225                             , TINPKSU BB                         01122500
011226                             , TPKSLIP CC                         01122600
011227                             , TSHPTPO DD                         01122700
011228                             , TSHIPMT EE                         01122800
011229                             , TSHUUPC HH                         01122900
011230                             , TTRIPST II                         01123000
011231                         WHERE                                    01123100
011232                               AA.ACTV_CDE     = 'A'              01123200
011233                           AND AA.TRIP_ID      = :DK-TRIP-ID      01123300
011234                           AND AA.SHIPT_UNT_ID = BB.SHIPT_UNT_ID  01123400
011235                           AND AA.SHIPT_UNT_ID  = HH.SHIPT_UNT_ID 01123500
011236                           AND BB.PO_NBR        = CC.PO_NBR       01123600
011237                           AND BB.SEQ_NBR       = CC.SEQ_NBR      01123700
011238                           AND CC.VER_STAT_CDE  = 'A'             01123800
011239                           AND CC.PKSL_STAT_CDE = 'IN'            01123900
011240                           AND CC.REC_SEQ_NBR   = 0               01124000
011241                           AND NOT CC.CRE_UID   = 'F/A SYTM'      01124100
011242                           AND CC.PO_NBR        = DD.PO_NBR       01124200
011243                           AND CC.REC_SEQ_NBR   = DD.REC_SEQ_NBR  01124300
011244                           AND CC.PRO_NBR       = EE.PRO_NBR      01124400
011245                           AND CC.BOL_NBR       =                 01124500
011246                               SUBSTR(EE.BOL_NBR,1,16)            01124600
011247                           AND NOT DD.SHIPT_ID  = EE.SHIPT_ID     01124700
011248                           AND AA.TRIP_ID       = II.TRIP_ID      01124800
011249                           AND II.TRIP_STATUS_CDE = 'UN'          01124900
011250                           AND II.OPER_UNT_ID   = :DK-OPER-UNT-ID 01125000
011251                      ) AS B1                                     01125100
011252                                                                  01125200
011253                      LEFT OUTER JOIN                             01125300
011254                      (SELECT BAA.SHIPT_UNT_ID                    01125400
011255                            , SUM(BHH.SHPD_QTY) AS SHPD_QTY       01125500
011256                         FROM TSHUNLO BAA                         01125600
011257                            , TSHUUPC BHH                         01125700
011258                            , TINPKSU BBB                         01125800
011259                            , TPKSLIP BCC                         01125900
011260                        WHERE  BAA.ACTV_CDE    = 'A'              01126000
011261                          AND BAA.TRIP_ID      = :DK-TRIP-ID      01126100
011262                          AND BAA.SHIPT_UNT_ID = BHH.SHIPT_UNT_ID 01126200
011263                          AND BAA.SHIPT_UNT_ID = BBB.SHIPT_UNT_ID 01126300
011264                          AND BBB.PO_NBR       = BCC.PO_NBR       01126400
011265                          AND BBB.SEQ_NBR      = BCC.SEQ_NBR      01126500
011266                          AND BCC.VER_STAT_CDE = 'A'              01126600
011267                          AND BCC.PKSL_STAT_CDE = 'IN'            01126700
011268                          AND BCC.REC_SEQ_NBR  = 0                01126800
011269                          AND NOT BCC.CRE_UID  = 'F/A SYTM'       01126900
011270                        GROUP BY BAA.SHIPT_UNT_ID                 01127000
011271                       ) AS B2                                    01127100
011272                      ON B1.SHIPT_UNT_ID   =  B2.SHIPT_UNT_ID     01127200
011273                    ) AS B3                                       01127300
011274                    GROUP BY B3.RCVR_SELECT                       01127400
011275                           , B3.TRIP_ID                           01127500
011276                           , B3.PO_NBR                            01127600
011277                           , B3.REC_SEQ_NBR                       01127700
011278                           , B3.EXPTD_OPER_UNT_ID                 01127800
011279                           , B3.EXPTD_TRIP                        01127900
011280                                                                  01128000
011281                     UNION                                        01128100
011290******************************************************************01129000
011291** "C" MISDIRECTS WHERE CARTONS ARE ATTACHED TO A FREE ASTRAY     01129100
011292**  PACKSLIP WITH NO RECEIVER SEQUENCE                            01129200
011293******************************************************************01129300
011294                     SELECT DISTINCT                              01129400
011295                            'C'                    AS RCVR_SELECT 01129500
011296                          , MM.TRIP_ID             AS TRIP_ID     01129600
011297                          , NN.PO_NBR              AS PO_NBR      01129700
011298                          , PP.REC_SEQ_NBR         AS REC_SEQ_NBR 01129800
011299                          , OO.oper_unt_id                        01129900
011300                                        as exptd_oper_unt_id      01130000
011301                          , QQ.TRIP_ID             AS EXPTD_TRIP  01130100
011302                          , COUNT(DISTINCT MM.SHIPT_UNT_ID)       01130200
011303                                                   AS CARTON_CNT  01130300
011304                         , SUM(RR.SHPD_QTY)        AS UNIT_COUNT  01130400
011305                      FROM TSHUNLO MM                             01130500
011306                         , TINPKSU NN                             01130600
011307                         , TPKSLIP OO                             01130700
011308                         , TSHPTPO PP                             01130800
011309                         , TSHIPMT QQ                             01130900
011310                         , TSHUUPC RR                             01131000
011311                         , TTRIPST TT                             01131100
011312                     WHERE                                        01131200
011313                           MM.ACTV_CDE      = 'A'                 01131300
011314                       AND MM.SHIPT_UNT_ID  = NN.SHIPT_UNT_ID     01131400
011315                       AND MM.SHIPT_UNT_ID  = RR.SHIPT_UNT_ID     01131500
011316                       AND RR.TRN_NBR       = NN.PO_NBR           01131600
011317                       AND OO.VER_STAT_CDE  = 'A'                 01131700
011318                       AND OO.PKSL_STAT_CDE = 'IN'                01131800
011319                       AND NN.PO_NBR        = OO.PO_NBR           01131900
011320                       AND NN.SEQ_NBR       = OO.SEQ_NBR          01132000
011321                       AND OO.REC_SEQ_NBR   = 0                   01132100
011322                       AND OO.CRE_UID       = 'F/A SYTM'          01132200
011323                       AND OO.PO_NBR        = PP.PO_NBR           01132300
011324                       AND OO.REC_SEQ_NBR   = PP.REC_SEQ_NBR      01132400
011325                       AND PP.CRE_TMST IN                         01132500
011326                           (SELECT MAX(SS.CRE_TMST)               01132600
011327                              FROM TSHPTPO SS                     01132700
011328                             WHERE PP.PO_NBR = SS.PO_NBR          01132800
011329                              AND PP.REC_SEQ_NBR = SS.REC_SEQ_NBR)01132900
011330                       AND PP.SHIPT_ID      = QQ.SHIPT_ID         01133000
011331                       AND MM.TRIP_ID       = TT.TRIP_ID          01133100
011332                       AND TT.TRIP_ID       = :DK-TRIP-ID         01133200
011333                       AND TT.TRIP_STATUS_CDE = 'UN'              01133300
011334                       AND TT.OPER_UNT_ID   = :DK-OPER-UNT-ID     01133400
011335                     GROUP BY 1                                   01133500
011336                         , MM.TRIP_ID                             01133600
011337                         , NN.PO_NBR                              01133700
011338                         , PP.REC_SEQ_NBR                         01133800
011339                         , OO.OPER_UNT_ID                         01133900
011340                         , QQ.TRIP_ID                             01134000
011341                     UNION                                        01134100
011342******************************************************************01134200
011343** "D" MISDIRECTS WHERE CARTONS ARE NOT ATTACHED TO A             01134300
011344** FREE ASTRAY PACKSLIP & RECEIVER FOR OTHER DC                   01134400
011345******************************************************************01134500
011346                    SELECT DISTINCT                               01134600
011347                           'D'                     AS RCVR_SELECT 01134700
011348                         , AAA.TRIP_ID             AS TRIP_ID     01134800
011349                         , BBB.PO_NBR              AS PO_NBR      01134900
011350                         , CCC.REC_SEQ_NBR         AS REC_SEQ_NBR 01135000
011351                         , CCC.oper_unt_id                        01135100
011352                                        as exptd_oper_unt_id      01135200
011353                         , EEE.TRIP_ID             AS EXPTD_TRIP  01135300
011354                         , COUNT(distinct(AAA.SHIPT_UNT_ID))      01135400
011355                                                   AS CARTON_CNT  01135500
011356                         , SUM(HHH.SHPD_QTY)       AS UNIT_COUNT  01135600
011357                      FROM TSHUNLO AAA                            01135700
011358                         , TINPKSU BBB                            01135800
011359                         , TPKSLIP CCC                            01135900
011360                         , TSHPTPO DDD                            01136000
011361                         , TSHIPMT EEE                            01136100
011362                         , TSHUUPC HHH                            01136200
011363                         , TTRIPST III                            01136300
011364                     WHERE                                        01136400
011365                           AAA.ACTV_CDE      = 'A'                01136500
011366                       AND AAA.SHIPT_UNT_ID  = BBB.SHIPT_UNT_ID   01136600
011367                       AND AAA.SHIPT_UNT_ID  = HHH.SHIPT_UNT_ID   01136700
011368                       AND CCC.VER_STAT_CDE  = 'A'                01136800
011369                       AND CCC.PKSL_STAT_CDE = 'AC'               01136900
011370                       AND BBB.PO_NBR        = CCC.PO_NBR         01137000
011371                       AND BBB.SEQ_NBR       = CCC.SEQ_NBR        01137100
011372                       AND CCC.REC_SEQ_NBR   > 0                  01137200
011373                                                                  01137300
011374                       AND NOT CCC.CRE_UID   = 'F/A SYTM'         01137400
011375                       AND CCC.PO_NBR        = DDD.PO_NBR         01137500
011376                       AND CCC.REC_SEQ_NBR   = DDD.REC_SEQ_NBR    01137600
011377                       AND DDD.SHIPT_ID      = EEE.SHIPT_ID       01137700
011378                       AND EEE.TRIP_ID      <> AAA.TRIP_ID        01137800
011379                       AND AAA.TRIP_ID       = III.TRIP_ID        01137900
011380                       AND III.TRIP_ID       = :DK-TRIP-ID        01138000
011381                       AND III.TRIP_STATUS_CDE = 'UN'             01138100
011382                       AND III.OPER_UNT_ID   = :DK-OPER-UNT-ID    01138200
011383                     GROUP BY 1                                   01138300
011384                         , AAA.TRIP_ID                            01138400
011385                         , BBB.PO_NBR                             01138500
011386                         , CCC.REC_SEQ_NBR                        01138600
011387                         , CCC.OPER_UNT_ID                        01138700
011388                         , EEE.TRIP_ID                            01138800
011389                    UNION                                         01138900
011390****************************************************************  01139000
011400** "E" MISDIRECTS WHERE CARTONS ARE ATTACHED TO A FREE ASTRAY     01140000
011410**  PACKSLIP WITH NO RECEIVER SEQUENCE                            01141000
011420**  NOT attached to shipment                                      01142000
011430** ADDED 6/22/20                                                  01143000
011440****************************************************************  01144000
011441                    SELECT DISTINCT                               01144100
011442                            'E'              AS RCVR_SELECT       01144200
011443                          , MME.TRIP_ID      AS TRIP_ID           01144300
011444                          , NNE.PO_NBR       AS PO_NBR            01144400
011445                          , ooE.rec_seq_nbr  AS REC_SEQ_NBR       01144500
011446                          , OOE.oper_unt_id                       01144600
011447                                        as exptd_oper_unt_id      01144700
011448                          , WWE.TRIP_ID      AS EXPTD_TRIP        01144800
011449                          , COUNT(DISTINCT MME.SHIPT_UNT_ID)      01144900
011450                                             AS CARTON_CNT        01145000
011451                         , SUM(RRE.SHPD_QTY) AS UNIT_COUNT        01145100
011452                      FROM TSHUNLO MME                            01145200
011453                         , TINPKSU NNE                            01145300
011454                         , TPKSLIP OOE                            01145400
011455                                                                  01145500
011456                         , TSHUUPC RRE                            01145600
011457                         , TTRIPST TTE                            01145700
011458                         , TPKSLIP UUE       -- ORIG PACKSLIP     01145800
011459                         , TSHPTPO VVE       -- ORIG RCVR         01145900
011460                         , TSHIPMT WWE       -- ORIG SHIPMT/TRIP  01146000
011461                     WHERE                                        01146100
011462                           MME.ACTV_CDE      = 'A'                01146200
011463                       AND MME.SHIPT_UNT_ID  = NNE.SHIPT_UNT_ID   01146300
011464                       AND MME.SHIPT_UNT_ID  = RRE.SHIPT_UNT_ID   01146400
011465                       AND RRE.TRN_NBR       = NNE.PO_NBR         01146500
011466                       AND OOE.VER_STAT_CDE  = 'A'                01146600
011467                       AND OOE.PKSL_STAT_CDE = 'IN'               01146700
011468                       AND NNE.PO_NBR        = OOE.PO_NBR         01146800
011469                       AND NNE.SEQ_NBR       = OOE.SEQ_NBR        01146900
011470                       AND OOE.REC_SEQ_NBR   = 0                  01147000
011471                       AND OOE.CRE_UID       = 'F/A SYTM'         01147100
011472                       and not exists                             01147200
011473                          (select *                               01147300
011474                             from tshptpo ppE                     01147400
011475                            where OOE.PO_NBR      = PPE.PO_NBR    01147500
011476                              and OOE.REC_SEQ_NBR =               01147600
011477                                  PPE.REC_SEQ_NBR                 01147700
011478                          )                                       01147800
011479                       AND OOE.PO_NBR        = UUE.PO_NBR         01147900
011480                       AND OOE.ORIG_PKSL_SEQ_NBR =  UUE.SEQ_NBR   01148000
011481                       AND UUE.VER_STAT_CDE  = 'A'                01148100
011482                       AND UUE.PKSL_STAT_CDE = 'AC'               01148200
011483                       AND UUE.PO_NBR        = VVE.PO_NBR         01148300
011484                       AND UUE.REC_SEQ_NBR   = VVE.REC_SEQ_NBR    01148400
011485                       AND VVE.CRE_TMST IN                        01148500
011486                          (SELECT MAX(XXE.CRE_TMST)               01148600
011487                             FROM TSHPTPO XXE                     01148700
011488                            WHERE VVE.PO_NBR = XXE.PO_NBR         01148800
011489                              AND VVE.REC_SEQ_NBR                 01148900
011490                                             = XXE.REC_SEQ_NBR)   01149000
011491                       AND VVE.SHIPT_ID      = WWE.SHIPT_ID       01149100
011492                       AND MME.TRIP_ID       = TTE.TRIP_ID        01149200
011493                       AND TTE.TRIP_ID       = :DK-TRIP-ID        01149300
011494                       AND TTE.TRIP_STATUS_CDE = 'AR'             01149400
011495                       AND TTE.OPER_UNT_ID   = :DK-OPER-UNT-ID    01149500
011496                     GROUP BY 1                                   01149600
011497                         , MME.TRIP_ID                            01149700
011498                         , NNE.PO_NBR                             01149800
011499                         , ooE.REC_SEQ_NBR                        01149900
011500                         , OOE.OPER_UNT_ID                        01150000
011501                         , WWE.TRIP_ID                            01150100
011502                                                                  01150200
011503                     ORDER BY 1,2,3,4,5                           01150300
011504                     ) AS T2                                      01150400
011505                ON T1.TRIP_ID = T2.TRIP_ID                        01150500
011506             WHERE NOT T2.RCVR_SELECT IS NULL                     01150600
011507               and NOT T1.OPER_UNT_ID  = T2.EXPTD_OPER_UNT_ID     01150700
011508              ORDER BY T1.OPER_UNT_ID                             01150800
011509                     , T1.TRIP_ID                                 01150900
011510                     , T1.PRO_NBR                                 01151000
011520                     , T1.BOL_NBR                                 01152000
011521                     , T1.VEND_SHIP_DTE                           01152100
011522                     , T1.OWNR_SCAC_SHIP_DTE                      01152200
011523                     , T2.RCVR_SELECT                             01152300
011524                     , T2.PO_NBR                                  01152400
011525                     , T2.REC_SEQ_NBR                             01152500
011526                     , T2.EXPTD_TRIP                              01152600
011527                     , T2.CARTON_CNT                              01152700
011528                     , T2.UNIT_COUNT                              01152800
011529                 WITH UR                                          01152900
011530                   END-EXEC.                                      01153000
011531                                                                  01153100
011532                                                                  01153200
011533******************************************************************01153300
011534 LINKAGE SECTION.                                                 01153400
011535******************************************************************01153500
011536 01  DFHCOMMAREA.                                                 01153600
011537     05  FILLER                         OCCURS  1 TO 4072 TIMES   01153700
011538                                      DEPENDING ON EIBCALEN.      01153800
011539         10  FILLER                   PIC X.                      01153900
011540                                                                  01154000
011550******************************************************************01155000
011560 PROCEDURE DIVISION.                                              01156000
011570******************************************************************01157000
011580 0000-PROGRAM-MAINLINE.                                           01158000
011590                                                                  01159000
011600** FROM TRKCS112 OR RCKCS827                                      01160000
011700                                                                  01170000
011800     MOVE LENGTH RC077-UNLOADED-TRLR-COMMAREA                     01180000
011900       TO PV-COMMAREA-LENGTH.                                     01190000
012000                                                                  01200000
012100     EXEC CICS                                                    01210000
012200         RETRIEVE                                                 01220000
012300         INTO(RC077-UNLOADED-TRLR-COMMAREA)                       01230000
012400         LENGTH(PV-COMMAREA-LENGTH)                               01240000
012500         RESP(PV-CICS-RESP)                                       01250000
012600     END-EXEC.                                                    01260000
012700                                                                  01270000
012800     MOVE EIBTASKN               TO PV-TASK.                      01280000
012900                                                                  01290000
012901     MOVE RC077-OPER-UNT-ID      TO PV-DISP-OPER.                 01290100
012902     MOVE RC077-TRIP-ID          TO PV-DISP-TRIP-ID.              01290200
012903                                                                  01290300
012904     STRING ' RCKCS838 STARTED - TASK = ' PV-TASK-X               01290400
012905            ' TRIP:' PV-DISP-OPER ' - '                           01290500
012906                     PV-DISP-TRIP-ID                              01290600
012907            '   '    RC077-SCAC                                   01290700
012908            '   '    RC077-VEH-NBR                                01290800
012909            '    CALLED BY:' RC077-FROM-PROGRAM                   01290900
012910            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.              01291000
012911     PERFORM 9990-WRITE-CICS.                                     01291100
012912                                                                  01291200
012913     move RC077-OPER-UNT-ID  to  DK-OPER-UNT-ID.                  01291300
012914     move RC077-TRIP-ID      to  DK-TRIP-ID.                      01291400
012915                                                                  01291500
012916     PERFORM 4000-OPEN-CSR.                                       01291600
012917                                                                  01291700
012918     IF  PS-NO-ABEND                                              01291800
012919         PERFORM 4100-FETCH-CSR                                   01291900
012920     END-IF.                                                      01292000
012930                                                                  01293000
012940     IF  PS-NO-ABEND  AND                                         01294000
012950         PS-NOT-END-OF-CSR                                        01295000
012960         PERFORM 2000-PROCESS-CSR                                 01296000
012970         UNTIL PS-ABEND  OR                                       01297000
012980               PS-END-OF-CSR                                      01298000
012990     END-IF.                                                      01299000
013000                                                                  01300000
013001     IF  PS-NO-ABEND                                              01300100
013002         PERFORM 4300-CLOSE-CSR                                   01300200
013003     END-IF.                                                      01300300
013004                                                                  01300400
013005     STRING ' RCKCS838 ENDED - TASK = '  PV-TASK-X                01300500
013006            ' TRIP:' PV-DISP-OPER ' - '                           01300600
013007                     PV-DISP-TRIP-ID                              01300700
013008            '   '    RC077-SCAC                                   01300800
013009            '   '    RC077-VEH-NBR                                01300900
013010            '    CALLED BY:' RC077-FROM-PROGRAM                   01301000
013020            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.              01302000
013030     PERFORM 9990-WRITE-CICS.                                     01303000
013040                                                                  01304000
013050     GOBACK.                                                      01305000
013060                                                                  01306000
013061                                                                  01306100
013062*---------------------------------------------------------------  01306200
013063* PROCESS MIS-DIRECT RECEIVERS FROM CURSOR                     -  01306300
013064*---------------------------------------------------------------  01306400
013065 2000-PROCESS-CSR.                                                01306500
013066                                                                  01306600
013067** for test only -  begin                                         01306700
013068*    STRING ' RCKCS838       - TASK = '  PV-TASK-X                01306800
013069*           ' 2000-PROCESS-CSR                '                   01306900
013070*           DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.              01307000
013071*    PERFORM 9990-WRITE-CICS.                                     01307100
013072** for test only -  end                                           01307200
013073                                                                  01307300
013074     PERFORM 5200-CAPTURE-DATA.                                   01307400
013075                                                                  01307500
013076     PERFORM 4100-FETCH-CSR.                                      01307600
013077                                                                  01307700
013078                                                                  01307800
013079*---------------------------------------------------------------  01307900
013080* OPEN CURSOR                                                  -  01308000
013081*---------------------------------------------------------------  01308100
013082 4000-OPEN-CSR.                                                   01308200
013083                                                                  01308300
013084** for test only -  begin                                         01308400
013085*    STRING ' RCKCS838       - TASK = '  PV-TASK-X                01308500
013086*           ' 4000-OPEN-CSR                   '                   01308600
013087*           DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.              01308700
013088*    PERFORM 9990-WRITE-CICS.                                     01308800
013089** for test only -  end                                           01308900
013090                                                                  01309000
013091                                                                  01309100
013092     EXEC SQL                                                     01309200
013093          OPEN MIS_DIRECT_CSR                                     01309300
013094     END-EXEC.                                                    01309400
013095                                                                  01309500
013096                                                                  01309600
013097     EVALUATE TRUE                                                01309700
013098        WHEN  SQLCODE = ZERO                                      01309800
013099              CONTINUE                                            01309900
013100                                                                  01310000
013110        WHEN SQLWARN0 NOT = SPACES                                01311000
013111        WHEN SQLCODE < ZERO                                       01311100
013112        WHEN SQLCODE > ZERO                                       01311200
013113            MOVE DK-OPER-UNT-ID    TO  PV-DISP-OPER               01311300
013114            MOVE DK-TRIP-ID        TO  PV-DISP-TRIP-ID            01311400
013115            MOVE '4000-OPEN-CSR            '                      01311500
013116                                  TO DP013-PARAGRAPH              01311600
013117            STRING 'TRIP:'           PV-DISP-OPER                 01311700
013118                                     PV-DISP-TRIP-ID              01311800
013119                                     DELIMITED BY SIZE            01311900
013120                                INTO DP013-MESSAGE-TEXT(1)        01312000
013121            MOVE SQLCA            TO DP013-SQLCA                  01312100
013122            MOVE 'TSHIPMT'        TO DP013-DB2-TABLE-NAME (1)     01312200
013123            MOVE 'TSHPTPO'        TO DP013-DB2-TABLE-NAME (2)     01312300
013124            MOVE 'TVHTRIP'        TO DP013-DB2-TABLE-NAME (3)     01312400
013125            MOVE 'TTRIPST'        TO DP013-DB2-TABLE-NAME (4)     01312500
013126            MOVE 'TSHIPMT'        TO DP013-DB2-TABLE-NAME (5)     01312600
013127            SET DP013-DB2-ABEND   TO TRUE                         01312700
013128            SET DP013-NO-ROLLBACK TO TRUE                         01312800
013129            SET PS-ABEND          TO TRUE                         01312900
013130            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                01313000
013131     END-EVALUATE.                                                01313100
013132                                                                  01313200
013133                                                                  01313300
013134*---------------------------------------------------------------  01313400
013135* FETCH CURSOR                                                 -  01313500
013136*---------------------------------------------------------------  01313600
013137 4100-FETCH-CSR.                                                  01313700
013138                                                                  01313800
013139** for test only -  begin                                         01313900
013140*    STRING ' RCKCS838       - TASK = '  PV-TASK-X                01314000
013141*           ' 4100-FETCH-CSR                  '                   01314100
013142*           DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.              01314200
013143*    PERFORM 9990-WRITE-CICS.                                     01314300
013144** for test only -  end                                           01314400
013145                                                                  01314500
013146                                                                  01314600
013147     EXEC SQL                                                     01314700
013148          FETCH MIS_DIRECT_CSR                                    01314800
013149           INTO                                                   01314900
013150                :PV-OPER-UNT-ID                                   01315000
013151              , :PV-TRIP-ID                                       01315100
013152              , :PV-TRIP-STATUS-CDE                               01315200
013153              , :PV-OWNER-SCAC-ID                                 01315300
013154              , :PV-VEH-NBR                                       01315400
013155              , :PV-PRO-NBR                                       01315500
013156              , :PV-BOL-NBR                                       01315600
013157              , :PV-VEND-SHIP-DTE                                 01315700
013158              , :PV-CARR-SHIP-DTE                                 01315800
013159              , :PV-ARRIVE-DTE                                    01315900
013160              , :PV-RCVR-SELECT                                   01316000
013161              , :PV-PO-NBR                                        01316100
013162              , :PV-REC-SEQ-NBR                                   01316200
013163              , :PV-EXPTD-OPER                                    01316300
013164              , :PV-EXPTD-TRIP                                    01316400
013165              , :PV-CARTON-CNT                                    01316500
013166              , :PV-UNIT-COUNT                                    01316600
013167              , :PV-DFLT-OPER-SET-ID                              01316700
013168     END-EXEC.                                                    01316800
013169                                                                  01316900
013170                                                                  01317000
013171     EVALUATE TRUE                                                01317100
013172        WHEN  SQLCODE = ZERO                                      01317200
013173              move PV-PO-NBR      to pv-disp-csr-po               01317300
013174              move PV-REC-SEQ-NBR to pv-disp-csr-rcvr             01317400
013175              move PV-EXPTD-OPER  to pv-disp-csr-oper             01317500
013176              move PV-EXPTD-TRIP  to pv-disp-csr-trip             01317600
013177              STRING ' RCKCS838 STARtED - TASK = ' PV-TASK-X      01317700
013178                     ' csr:' PV-RCVR-SELECT ' - '                 01317800
013179                     ' rcvr:' pv-disp-csr-oper                    01317900
013180                     '-'      pv-disp-csr-po                      01318000
013181                     '-'      pv-disp-csr-rcvr                    01318100
013182                     '  exptd trip:' pv-disp-csr-trip             01318200
013183                     '    CALLED BY:' RC077-FROM-PROGRAM          01318300
013184                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA      01318400
013185                     PERFORM 9990-WRITE-CICS                      01318500
013186                                                                  01318600
013187        WHEN  SQLCODE = +100                                      01318700
013188              SET  PS-END-OF-CSR    TO  TRUE                      01318800
013189                                                                  01318900
013190        WHEN SQLWARN0 NOT = SPACES                                01319000
013191        WHEN SQLCODE < ZERO                                       01319100
013192        WHEN SQLCODE > ZERO                                       01319200
013193            MOVE DK-OPER-UNT-ID    TO  PV-DISP-OPER               01319300
013194            MOVE DK-TRIP-ID        TO  PV-DISP-TRIP-ID            01319400
013195            MOVE '4300-CLOSE-CSR            '                     01319500
013196                                  TO DP013-PARAGRAPH              01319600
013197            STRING 'TRIP:'           PV-DISP-OPER                 01319700
013198                                     PV-DISP-TRIP-ID              01319800
013199                                     DELIMITED BY SIZE            01319900
013200                                INTO DP013-MESSAGE-TEXT(1)        01320000
013201            MOVE SQLCA            TO DP013-SQLCA                  01320100
013202            MOVE 'TSHIPMT'        TO DP013-DB2-TABLE-NAME (1)     01320200
013203            MOVE 'TSHPTPO'        TO DP013-DB2-TABLE-NAME (2)     01320300
013204            MOVE 'TVHTRIP'        TO DP013-DB2-TABLE-NAME (3)     01320400
013205            MOVE 'TTRIPST'        TO DP013-DB2-TABLE-NAME (4)     01320500
013206            MOVE 'TSHIPMT'        TO DP013-DB2-TABLE-NAME (5)     01320600
013207            SET DP013-DB2-ABEND   TO TRUE                         01320700
013208            SET DP013-NO-ROLLBACK TO TRUE                         01320800
013209            SET PS-ABEND          TO TRUE                         01320900
013210            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                01321000
013211     END-EVALUATE.                                                01321100
013212                                                                  01321200
013213*---------------------------------------------------------------  01321300
013214* CLOSE CURSOR                                                 -  01321400
013215*---------------------------------------------------------------  01321500
013216 4300-CLOSE-CSR.                                                  01321600
013217                                                                  01321700
013218** for test only -  begin                                         01321800
013219*    STRING ' RCKCS838       - TASK = '  PV-TASK-X                01321900
013220*           ' 4300-CLOSE-CSR                  '                   01322000
013221*           DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.              01322100
013222*    PERFORM 9990-WRITE-CICS.                                     01322200
013223** for test only -  end                                           01322300
013224                                                                  01322400
013225                                                                  01322500
013226     EXEC SQL                                                     01322600
013227          CLOSE MIS_DIRECT_CSR                                    01322700
013228     END-EXEC.                                                    01322800
013229                                                                  01322900
013230                                                                  01323000
013231     EVALUATE TRUE                                                01323100
013232        WHEN  SQLCODE = ZERO                                      01323200
013233              CONTINUE                                            01323300
013234                                                                  01323400
013235        WHEN SQLWARN0 NOT = SPACES                                01323500
013236        WHEN SQLCODE < ZERO                                       01323600
013237        WHEN SQLCODE > ZERO                                       01323700
013238            MOVE DK-OPER-UNT-ID    TO  PV-DISP-OPER               01323800
013239            MOVE DK-TRIP-ID        TO  PV-DISP-TRIP-ID            01323900
013240            MOVE '4300-CLOSE-CSR            '                     01324000
013241                                  TO DP013-PARAGRAPH              01324100
013242            STRING 'TRIP:'           PV-DISP-OPER                 01324200
013243                                     PV-DISP-TRIP-ID              01324300
013244                                     DELIMITED BY SIZE            01324400
013245                                INTO DP013-MESSAGE-TEXT(1)        01324500
013246            MOVE SQLCA            TO DP013-SQLCA                  01324600
013247            MOVE 'TSHIPMT'        TO DP013-DB2-TABLE-NAME (1)     01324700
013248            MOVE 'TSHPTPO'        TO DP013-DB2-TABLE-NAME (2)     01324800
013249            MOVE 'TVHTRIP'        TO DP013-DB2-TABLE-NAME (3)     01324900
013250            MOVE 'TTRIPST'        TO DP013-DB2-TABLE-NAME (4)     01325000
013251            MOVE 'TSHIPMT'        TO DP013-DB2-TABLE-NAME (5)     01325100
013252            SET DP013-DB2-ABEND   TO TRUE                         01325200
013253            SET DP013-NO-ROLLBACK TO TRUE                         01325300
013254            SET PS-ABEND          TO TRUE                         01325400
013255            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                01325500
013256     END-EVALUATE.                                                01325600
013257                                                                  01325700
013258*---------------------------------------------------------------* 01325800
013259* CAPTURE WHEN THE MISDIRECT RECEIVER INFORMATION               * 01325900
013260*---------------------------------------------------------------* 01326000
013261 5200-CAPTURE-DATA.                                               01326100
013262                                                                  01326200
013263** for test only -  begin                                         01326300
013264*    STRING ' RCKCS838       - TASK = '  PV-TASK-X                01326400
013265*           ' 5200-CAPTURE-DATA               '                   01326500
013266*           DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.              01326600
013267*    PERFORM 9990-WRITE-CICS.                                     01326700
013268** for test only -  end                                           01326800
013269                                                                  01326900
013270                                                                  01327000
013271      move  1  to  pv-capture-cnt.                                01327100
013272                                                                  01327200
013273      PERFORM 5210-WFT-DAT-CNTL.                                  01327300
013274      PERFORM 5220-WFT-DAT-XFER.                                  01327400
013275                                                                  01327500
013276                                                                  01327600
013277 5210-WFT-DAT-CNTL.                                               01327700
013278                                                                  01327800
013279** for test only -  begin                                         01327900
013280*    STRING ' RCKCS838       - TASK = '  PV-TASK-X                01328000
013281*           ' 5210-WFT-DAT-CNTL               '                   01328100
013282*           DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.              01328200
013283*    PERFORM 9990-WRITE-CICS.                                     01328300
013284** for test only -  end                                           01328400
013285                                                                  01328500
013286                                                                  01328600
013287     CALL PC-RANDOM-PGM USING DFHEIBLK                            01328700
013288                              DFHCOMMAREA                         01328800
013289                              DP902-RANDNBR-ROUTINE-FIELDS.       01328900
013290                                                                  01329000
013291     move DP902-RANDOM-NUMBER     to PV-CAPTURE-RANDOM-NBR        01329100
013292                                                                  01329200
013293     EXEC SQL                                                     01329300
013294          SET :PV-RANDOM-TMST = CURRENT TIMESTAMP                 01329400
013295     END-EXEC.                                                    01329500
013296                                                                  01329600
013297     MOVE 'TRLRMSDR'               TO WFT00004-TRN-TYP-CDE        01329700
013298     MOVE PV-CAPTURE-RANDOM-NBR    TO WFT00004-PRC-GP-ID          01329800
013299     MOVE PV-RANDOM-TMST           TO WFT00004-PRC-CNTL-TMST      01329900
013300     MOVE RC077-OPER-UNT-ID        TO WFT00004-STR-NBR            01330000
013301     MOVE 'READY'                  TO WFT00004-STAT-CDE           01330100
013302     MOVE PV-RANDOM-TMST           TO WFT00004-BEG-PRC-TMST       01330200
013303     MOVE PC-DEFAULT-TMST          TO WFT00004-END-PRC-TMST       01330300
013304     MOVE 0                        TO WFT00004-DAT-LOD-VER-NBR    01330400
013305                                                                  01330500
013306     EXEC SQL                                                     01330600
013307        INSERT INTO WFT_DAT_CNTL                                  01330700
013308               ( TRN_TYP_CDE                                      01330800
013309                ,PRC_GP_ID                                        01330900
013310                ,PRC_CNTL_TMST                                    01331000
013311                ,STR_NBR                                          01331100
013312                ,STAT_CDE                                         01331200
013313                ,BEG_PRC_TMST                                     01331300
013314                ,END_PRC_TMST                                     01331400
013315                ,DAT_LOD_VER_NBR)                                 01331500
013316        VALUES (:WFT00004-TRN-TYP-CDE                             01331600
013317              , :WFT00004-PRC-GP-ID                               01331700
013318              , :WFT00004-PRC-CNTL-TMST                           01331800
013319              , :WFT00004-STR-NBR                                 01331900
013320              , :WFT00004-STAT-CDE                                01332000
013321              , :WFT00004-BEG-PRC-TMST                            01332100
013322              , :WFT00004-END-PRC-TMST                            01332200
013323              , :WFT00004-DAT-LOD-VER-NBR)                        01332300
013324     END-EXEC.                                                    01332400
013325                                                                  01332500
013326         EVALUATE TRUE                                            01332600
013327             WHEN SQLCODE = ZERO                                  01332700
013328                 CONTINUE                                         01332800
013329             WHEN SQLWARN0 NOT = SPACES                           01332900
013330             WHEN SQLCODE < ZERO                                  01333000
013331             WHEN SQLCODE > ZERO                                  01333100
013332                                                                  01333200
013333             MOVE '5210-WFT-DAT-CNTL  '      TO DP013-PARAGRAPH   01333300
013334             MOVE 'WRITE HEADER TO WFT_DAT_CNTL'                  01333400
013335                                      TO DP013-MESSAGE-TEXT (1)   01333500
013336             MOVE SQLCA        TO DP013-SQLCA                     01333600
013337             MOVE 'WFT_DAT_CNTL      '  TO                        01333700
013338                                  DP013-DB2-TABLE-NAME (1)        01333800
013339             SET DP013-DB2-ABEND        to true                   01333900
013340                                                                  01334000
013341         END-EVALUATE.                                            01334100
013342                                                                  01334200
013343                                                                  01334300
013344 5220-WFT-DAT-XFER.                                               01334400
013345                                                                  01334500
013346** for test only -  begin                                         01334600
013347*    STRING ' RCKCS838       - TASK = '  PV-TASK-X                01334700
013348*           ' 5220-WFT-DAT-XFER               '                   01334800
013349*           DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.              01334900
013350*    PERFORM 9990-WRITE-CICS.                                     01335000
013351** for test only -  end                                           01335100
013352                                                                  01335200
013353                                                                  01335300
013354     MOVE SPACES TO RC076-TRLR-UNLD-MIS-DIRECT.                   01335400
013355     MOVE PV-OPER-UNT-ID       TO  RC076-OPER-UNT-ID.             01335500
013356     MOVE PV-TRIP-ID           TO  RC076-TRIP-ID.                 01335600
013357     MOVE PV-TRIP-STATUS-CDE   TO  RC076-TRIP-STATUS.             01335700
013358     MOVE PV-OWNER-SCAC-ID     TO  RC076-SCAC.                    01335800
013359     MOVE PV-VEH-NBR           TO  RC076-VEH-NBR.                 01335900
013360     MOVE PV-PRO-NBR           TO  RC076-PRO-NBR.                 01336000
013361     MOVE PV-BOL-NBR           TO  RC076-BOL-NBR.                 01336100
013362     MOVE PV-VEND-SHIP-DTE     TO  RC076-VEND-SHIP-DATE.          01336200
013363     MOVE PV-CARR-SHIP-DTE     TO  RC076-CARR-SHIP-DATE.          01336300
013364     MOVE PV-ARRIVE-DTE        TO  RC076-ARRIVAL-DATE.            01336400
013365     MOVE PV-RCVR-SELECT       TO  RC076-CSR-SELECTION.           01336500
013366     MOVE PV-PO-NBR            TO  RC076-PO-NBR.                  01336600
013367     MOVE PV-REC-SEQ-NBR       TO  RC076-RCVR-SEQ-NBR.            01336700
013368     MOVE PV-EXPTD-OPER        TO  RC076-EXPCTD-OPER.             01336800
013369     MOVE PV-EXPTD-TRIP        TO  RC076-EXPCTD-TRIP.             01336900
013370     MOVE PV-CARTON-CNT        TO  RC076-CARTON-COUNT.            01337000
013371     MOVE PV-UNIT-COUNT        TO  RC076-UNIT-COUNT.              01337100
013372     MOVE PV-DFLT-OPER-SET-ID  TO  RC076-OPER-SET.                01337200
013373     MOVE RC077-FROM-PROGRAM   TO  RC076-PROGRAM-ID.              01337300
013374                                                                  01337400
013375     MOVE 'TRLRMSDR'               TO WFT00005-TRN-TYP-CDE        01337500
013376     MOVE PV-CAPTURE-RANDOM-NBR    TO WFT00005-PRC-GP-ID          01337600
013377     MOVE PV-RANDOM-TMST           TO WFT00005-PRC-CNTL-TMST      01337700
013378     MOVE PV-CAPTURE-CNT           TO WFT00005-PRC-LOD-SEQ-ID     01337800
013379     MOVE 'DETAIL'                 TO WFT00005-RDM-PRC-TYP-CDE    01337900
013380     MOVE LENGTH OF RC076-TRLR-UNLD-MIS-DIRECT                    01338000
013381                                   TO WFT00005-LOD-DAT-TXT-LEN    01338100
013382     MOVE RC076-TRLR-UNLD-MIS-DIRECT                              01338200
013383                                   TO WFT00005-LOD-DAT-TXT-TEXT   01338300
013384                                                                  01338400
013385*** test only - begin                                             01338500
013386*    STRING ' RCKCS838:'                                          01338600
013387*             RC076-TRLR-UNLD-MIS-DIRECT                          01338700
013388*           DELIMITED BY SIZE INTO PV-CICS-MSG-AREA               01338800
013389*    PERFORM 9990-WRITE-CICS                                      01338900
013390*** test only - end                                               01339000
013391                                                                  01339100
013392                                                                  01339200
013393     EXEC SQL                                                     01339300
013394        INSERT INTO WFT_DAT_XFER                                  01339400
013395               ( TRN_TYP_CDE                                      01339500
013396                ,PRC_GP_ID                                        01339600
013397                ,PRC_CNTL_TMST                                    01339700
013398                ,PRC_LOD_SEQ_ID                                   01339800
013399                ,RDM_PRC_TYP_CDE                                  01339900
013400                ,LOD_DAT_TXT)                                     01340000
013401        VALUES (:WFT00005-TRN-TYP-CDE                             01340100
013402               ,:WFT00005-PRC-GP-ID                               01340200
013403               ,:WFT00005-PRC-CNTL-TMST                           01340300
013404               ,:WFT00005-PRC-LOD-SEQ-ID                          01340400
013405               ,:WFT00005-RDM-PRC-TYP-CDE                         01340500
013406               ,:WFT00005-LOD-DAT-TXT)                            01340600
013407     END-EXEC.                                                    01340700
013408                                                                  01340800
013409         EVALUATE TRUE                                            01340900
013410             WHEN SQLCODE = ZERO                                  01341000
013411                 CONTINUE                                         01341100
013412             WHEN SQLWARN0 NOT = SPACES                           01341200
013413             WHEN SQLCODE < ZERO                                  01341300
013414             WHEN SQLCODE > ZERO                                  01341400
013415                                                                  01341500
013416             MOVE '5220-WFT-DAT-XFER  '      TO DP013-PARAGRAPH   01341600
013417             MOVE 'WRITE detail TO WFT_DAT_xfer'                  01341700
013418                                      TO DP013-MESSAGE-TEXT (1)   01341800
013419             MOVE SQLCA        TO DP013-SQLCA                     01341900
013420             MOVE 'WFT_DAT_CNTL      '  TO                        01342000
013421                                  DP013-DB2-TABLE-NAME (1)        01342100
013422             SET DP013-DB2-ABEND        to true                   01342200
013423                                                                  01342300
013424         END-EVALUATE.                                            01342400
013425                                                                  01342500
013426                                                                  01342600
013427                                                                  01342700
013428******************************************************************01342800
013429*    WRITE A MESSAGE TO THE CICS LOG.                            *01342900
013430******************************************************************01343000
013440 9990-WRITE-CICS.                                                 01344000
013450                                                                  01345000
013460     MOVE LENGTH OF PV-CICS-MSG-AREA                              01346000
013470       TO PV-COMMAREA-LENGTH.                                     01347000
013480                                                                  01348000
013490     EXEC CICS                                                    01349000
013500          WRITEQ TD                                               01350000
013600           QUEUE  ('CSSL')                                        01360000
013700            FROM  (PV-CICS-MSG-AREA)                              01370000
013800          LENGTH  (PV-COMMAREA-LENGTH)                            01380000
013900            RESP  (PV-CICS-RESP)                                  01390000
014000     END-EXEC.                                                    01400000
014100                                                                  01410000
014200     MOVE SPACES TO PV-CICS-MSG-AREA.                             01420000
014300                                                                  01430000
014400                                                                  01440000
014500******************************************************************01450000
014600*                                                                *01460000
014700******************************************************************01470000
014800 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  01480000
014900                                                                  01490000
015000     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            01500000
015100     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           01510000
015200     INITIALIZE DP013-SRC-TASK-NUMBER                             01520000
015300                DP013-STACK.                                      01530000
015400     SET DP013-LINK-RETURN           TO TRUE.                     01540000
015500                                                                  01550000
015600     EXEC CICS                                                    01560000
015700         LINK                                                     01570000
015800             PROGRAM   (DP013-NAME)                               01580000
015900             COMMAREA  (DP013-PARAMETERS)                         01590000
016000             LENGTH    (DP013-LENGTH)                             01600000
016100     END-EXEC.                                                    01610000
016200                                                                  01620000
