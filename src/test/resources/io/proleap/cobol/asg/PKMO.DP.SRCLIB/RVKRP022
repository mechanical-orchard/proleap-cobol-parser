000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    RVKRP022.                                         00020000
000300 AUTHOR.        VIRGENE LENNEMAN.                                 00030000
000400 DATE-WRITTEN.  DECEMBER 2006                                     00040000
000500 DATE-COMPILED.                                                   00050000
000600                                                                  00060000
000700******************************************************************00070000
000800***                    RVKRP022                                  *00080000
000900***                                                              *00090000
001000*** THIS PROGRAM CREATES AN ERROR REPORT FOR ERRORS THAT OCCURRED*00100000
001100*** WHILE LOADING DATA FROM GENCO BACK INTO THE RTV TABLE TDFCTOR*00110000
001200*** AND TDFMEIT.                                                 *00120000
001300***                                                              *00130000
001400*** INPUT:                                                       *00140000
001500***  1. FILE UNLOADED FROM WORK TABLE RVTW_DFCTOR_ERR            *00150000
001600***  2. CONTROL CARD WITH RUN DATE                               *00160000
001700***                                                              *00170000
001800*** OUTPUT:                                                      *00180000
001900***  1. ERROR REPORT                                             *00190000
002000***  2. ERROR REPORT IN EXCEL FILE                               *00200000
002100*-----------------------------------------------------------------00210000
002200* DATE:        10/30/2011                                         00220000
002300* PROJ#:       3219  GENCO/RTV UPGRADE PROJECT                    00230000
002400* WR/IR#:      WR40134                                            00240000
002500* PROGRAMMER:  JOHN HUTCHINSON / CHRIS STRODTHOFF                 00250000
002600* DESCRIPTION: USING RV018-RTV-LOC AND RV018-RTV-LOC-NME          00260000
002700*              WRITE RTV LOCATION AND NAME TO THE REPORT HEADING. 00270000
002800*              THE REPORT IS ALSO WRITTEN TO A FILE. ADD RTV      00280000
002900*              LOCATION AND NAME TO FILE OUTPUT.                  00290000
003000*-----------------------------------------------------------------00300000
003100******************************************************************00310000
003200 ENVIRONMENT DIVISION.                                            00320000
003300 CONFIGURATION SECTION.                                           00330000
003400 SOURCE-COMPUTER.        IBM-3090.                                00340000
003500 OBJECT-COMPUTER.        IBM-3090.                                00350000
003600                                                                  00360000
003700 INPUT-OUTPUT SECTION.                                            00370000
003800 FILE-CONTROL.                                                    00380000
003900                                                                  00390000
004000     SELECT ERROR-FILE             ASSIGN TO INP01.               00400000
004100                                                                  00410000
004200     SELECT ERROR-REPORT           ASSIGN TO RPT01.               00420000
004300                                                                  00430000
004400     SELECT ERROR-REPORT-EXCEL     ASSIGN TO OUT01.               00440000
004500                                                                  00450000
004600 DATA DIVISION.                                                   00460000
004700 FILE SECTION.                                                    00470000
004800                                                                  00480000
004900 FD  ERROR-FILE                                                   00490000
005000     RECORDING MODE IS F                                          00500000
005100     LABEL RECORDS ARE STANDARD                                   00510000
005200     BLOCK CONTAINS 0 RECORDS.                                    00520000
005300                                                                  00530000
005400 01  ERROR-RECORD                   PIC X(254).                   00540000
005500                                                                  00550000
005600 FD  ERROR-REPORT                                                 00560000
005700     RECORDING MODE IS F                                          00570000
005800     LABEL RECORDS ARE STANDARD                                   00580000
005900     BLOCK CONTAINS 0 RECORDS.                                    00590000
006000                                                                  00600000
006100 01  ERROR-RPT-RECORD               PIC X(132).                   00610000
006200                                                                  00620000
006300 FD  ERROR-REPORT-EXCEL                                           00630000
006400     RECORDING MODE IS F                                          00640000
006500     LABEL RECORDS ARE STANDARD                                   00650000
006600     BLOCK CONTAINS 0 RECORDS.                                    00660000
006700                                                                  00670000
006800 01  EXCEL-REC                      PIC X(99).                    00680000
006900                                                                  00690000
007000 WORKING-STORAGE SECTION.                                         00700000
007100**  CMS 10/30/2011  BEG                                           00710000
007200***************************************************************** 00720000
007300*    CONTROL CARD INPUT                                           00730000
007400***************************************************************** 00740000
007500 01  CC-CONTROL-CARD.                                             00750000
007600     05  CC-LOC                       PIC X(04).                  00760000
007700     05  FILLER REDEFINES CC-LOC.                                 00770000
007800         10  CC-LOC-NBR               PIC 9(04).                  00780000
007900     05  FILLER                       PIC X(76).                  00790000
008000                                                                  00800000
008100***************************************************************** 00810000
008200**   DCLGEN FOR THE LOGISTICS LOCATION TABLE                      00820000
008300***************************************************************** 00830000
008400     EXEC SQL                                                     00840000
008500         INCLUDE XLT00010                                         00850000
008600     END-EXEC.                                                    00860000
008700                                                                  00870000
008800**  CMS 10/30/2011  END                                           00880000
008900                                                                  00890000
009000**  JH  10/30/2011  BEG                                           00900000
009100***************************************************************** 00910000
009200**   TCOCNTL TABLE                                                00920000
009300***************************************************************** 00930000
009400     EXEC SQL                                                     00940000
009500         INCLUDE TCOCNTL                                          00950000
009600     END-EXEC.                                                    00960000
009700                                                                  00970000
009800******************************************************************00980000
009900*  COMMUNICATIONS AREA FOR DB2                                    00990000
010000******************************************************************01000000
010100     EXEC SQL                                                     01010000
010200         INCLUDE SQLCA                                            01020000
010300     END-EXEC.                                                    01030000
010400                                                                  01040000
010500******************************************************************01050000
010600*  DB2 FORMATTED MESSAGE AREA                                     01060000
010700******************************************************************01070000
010800     COPY DPWS004.                                                01080000
010900                                                                  01090000
011000**  JH  10/30/2011  END                                           01100000
011100                                                                  01110000
011200***  PROGRAM CONSTANTS                                            01120000
011300 01  PC-PROGRAM-CONSTANTS.                                        01130000
011400     05  PC-MAX-REPORT-LINES         PIC  9(02)  VALUE 55.        01140000
011500     05  PC-MAX-RETRIES              PIC S9(04)  VALUE +3         01150000
011600                                                 COMP SYNC.       01160000
011700                                                                  01170000
011800***  PROGRAM SWITCHES                                             01180000
011900 01  PS-PROGRAM-SWITCHES.                                         01190000
012000     05  PS-END-OF-FILE-SW           PIC  X(01)    VALUE 'N'.     01200000
012100         88  PS-END-OF-FILE                        VALUE 'Y'.     01210000
012200         88  PS-NOT-END-OF-FILE                    VALUE 'N'.     01220000
012300     05  PS-NUMERIC-SW               PIC  X(01)    VALUE 'Y'.     01230000
012400         88  PS-NUMERIC                            VALUE 'Y'.     01240000
012500         88  PS-NOT-NUMERIC                        VALUE 'N'.     01250000
012600     05  PS-XLT00010-SWITCH          PIC  X(01)    VALUE 'N'.     01260000
012700         88  PS-XLT00010-FOUND                     VALUE 'Y'.     01270000
012800         88  PS-XLT00010-NOTFND                    VALUE 'N'.     01280000
012900                                                                  01290000
013000***  PROGRAM VARIABLES                                            01300000
013100 01  PV-PROGRAM-VARIABLES.                                        01310000
013200     05  PV-CURR-ORD-ID              PIC  X(12)    VALUE SPACES.  01320000
013300     05  PV-HOLD-ORD-ID              PIC  X(12)    VALUE SPACES.  01330000
013400     05  PV-HOLD-ERROR-MSG           PIC  X(37)    VALUE SPACES.  01340000
013500     05  PV-PAGE-COUNT               PIC  9(05)    VALUE 0.       01350000
013600     05  PV-REC-READ                 PIC  9(09)    VALUE 0.       01360000
013700     05  PV-REC-WRITTEN              PIC  9(09)    VALUE 0.       01370000
013800     05  PV-REPT-LINE-COUNT          PIC  9(02)    VALUE 0.       01380000
013900     05  PV-ABEND-CODE               PIC S9(04)    VALUE +0       01390000
014000                                                        COMP SYNC.01400000
014100**  JH  10/30/2011  BEG                                           01410000
014200     05  PV-RETRY-COUNTER            PIC S9(04) VALUE +0          01420000
014300                                                COMP SYNC.        01430000
014400     05  PV-KEY-LOC-NBR              PIC S9(04) VALUE +0          01440000
014500                                                COMP SYNC.        01450000
014600     05  PV-PD-DTE.                                               01460000
014700         10  PV-PD-CY                PIC 9(04)  VALUE ZERO.       01470000
014800         10  FILLER                  PIC X(01).                   01480000
014900         10  PV-PD-MM                PIC 9(02)  VALUE ZERO.       01490000
015000         10  FILLER                  PIC X(01).                   01500000
015100         10  PV-PD-DD                PIC 9(02)  VALUE ZERO.       01510000
015200     05  PC-PROGRAM-NAME             PIC X(08)  VALUE 'RVKRP022'. 01520000
015300     05  PV-PARAGRAPH                PIC X(30)  VALUE SPACE.      01530000
015400     05  PV-ABEND-MESSAGE            PIC X(30)  VALUE SPACE.      01540000
015500     05  PV-SQLCODE                  PIC S9(9)  VALUE ZEROES.     01550000
015600     05  PV-ABEND-TABLE-1            PIC X(20)  VALUE SPACES.     01560000
015700**  JH  10/30/2011  END                                           01570000
015800 01  PV-HOLD-RECORD.                                              01580000
015900     05  PV-HR-REC-TYPE          PIC  X(01)    VALUE SPACE.       01590000
016000         88  PV-HR-HEADER                      VALUE 'H'.         01600000
016100         88  PV-HR-DETAIL                      VALUE 'D'.         01610000
016200     05  PV-HR-ERROR-TYPE        PIC  X(01)    VALUE SPACE.       01620000
016300         88  PV-HR-CRITICAL                    VALUE 'C'.         01630000
016400         88  PV-HR-WARNING                     VALUE 'W'.         01640000
016500     05  PV-HR-ORD-ID-X.                                          01650000
016600         10  PV-HR-ORD-ID-9      PIC  9(12).                      01660000
016700     05  FILLER                  PIC  X(240)   VALUE SPACES.      01670000
016800                                                                  01680000
016900***  SYSTEM DATE VARIABLES                                        01690000
017000 01  SD-SYSTEM-DATE.                                              01700000
017100     05  SD-SYSTEM-CCYY              PIC  9(04)  VALUE ZEROS.     01710000
017200     05  SD-SYSTEM-MONTH             PIC  9(02)  VALUE ZEROS.     01720000
017300     05  SD-SYSTEM-DAY               PIC  9(02)  VALUE ZEROS.     01730000
017400                                                                  01740000
017500***  SYSTEM TIME VARIABLES                                        01750000
017600 01  ST-SYSTEM-TIME.                                              01760000
017700     05  ST-SYSTEM-HOUR              PIC  9(02)  VALUE ZEROS.     01770000
017800     05  ST-SYSTEM-MINUTE            PIC  9(02)  VALUE ZEROS.     01780000
017900                                                                  01790000
018000***  FILE COPYBOOK FOR RTV HEADER ERROR REC                       01800000
018100     COPY RVWS018.                                                01810000
018200                                                                  01820000
018300***  FILE COPYBOOK FOR RTV DETAIL ERROR REC                       01830000
018400     COPY RVWS019.                                                01840000
018500                                                                  01850000
018600***  STANDARD REPORT HEADER FOR A 132 COLUMN REPORT               01860000
018700     COPY DPWS132.                                                01870000
018800                                                                  01880000
018900***  CALENDAR ROUTINE COPYBOOK                                    01890000
019000     COPY DPWS500.                                                01900000
019100                                                                  01910000
019200***  REPORT HEADING AND DETAIL LINES                              01920000
019300 01  PH2-PAGE-HEADING-2.                                          01930000
019400     05  FILLER                          PIC  X(43)  VALUE SPACE. 01940000
019500     05  FILLER                          PIC  X(48)  VALUE        01950000
019600         'ERRORS LOADING RETURNS DATA TO RTV TABLES REPORT'.      01960000
019700     05  FILLER                          PIC  X(41)  VALUE SPACE. 01970000
019800                                                                  01980000
019900 01  PH3-PAGE-HEADING-3.                                          01990000
020000     05  FILLER                          PIC  X(54)  VALUE SPACE. 02000000
020100     05  FILLER                          PIC  X(16)  VALUE        02010000
020200         'PROCESSING DATE '.                                      02020000
020300**  JH  10/30/2011  BEG                                           02030000
020400     05  PH3-DATE.                                                02040000
020500         10  PH3-DATE-MM                 PIC  9(2).               02050000
020600         10  FILLER                      PIC  X      VALUE '/'.   02060000
020700         10  PH3-DATE-DD                 PIC  9(2).               02070000
020800         10  FILLER                      PIC  X      VALUE '/'.   02080000
020900         10  PH3-DATE-CCYY               PIC  9(4).               02090000
021000     05  FILLER                          PIC  X(52)  VALUE SPACE. 02100000
021100                                                                  02110000
021200 01  PH4-PAGE-HEADING-4.                                          02120000
021300     05  FILLER                          PIC  X(17)  VALUE        02130000
021400         '  RTV LOCATION:  '.                                     02140000
021500     05  PH4-RTV-LOC                     PIC  X(06).              02150000
021600     05  FILLER                          PIC  X(02)  VALUE SPACE. 02160000
021700     05  PH4-RTV-NAME                    PIC  X(10).              02170000
021800**JH 10/30/2011 END                                               02180000
021900                                                                  02190000
022000 01  DH1-DETAIL-HEADING-1.                                        02200000
022100     05  FILLER                          PIC  X(04)  VALUE SPACE. 02210000
022200     05  FILLER                          PIC  X(06)  VALUE        02220000
022300         'DEFECT'.                                                02230000
022400     05  FILLER                          PIC  X(06)  VALUE SPACE. 02240001
022500     05  FILLER                          PIC  X(10)  VALUE        02250000
022600         'DUNS NBR /'.                                            02260000
022700     05  FILLER                          PIC  X(23)  VALUE SPACE. 02270001
022800     05  FILLER                          PIC  X(06)  VALUE        02280001
022900         'RETURN'.                                                02290000
023000     05  FILLER                          PIC  X(04)  VALUE SPACE. 02300000
023100     05  FILLER                          PIC  X(12)  VALUE        02310000
023200         'ORDER DATE /'.                                          02320000
023300     05  FILLER                          PIC  X(09)  VALUE SPACE. 02330000
023400     05  FILLER                          PIC  X(03)  VALUE 'SUB'. 02340000
023500     05  FILLER                          PIC  X(49)  VALUE SPACE. 02350000
023600                                                                  02360000
023700 01  DH2-DETAIL-HEADING-2.                                        02370000
023800     05  FILLER                          PIC  X(04)  VALUE SPACE. 02380000
023900     05  FILLER                          PIC  X(06)  VALUE        02390000
024000         'ORD ID'.                                                02400000
024100     05  FILLER                          PIC  X(06)  VALUE SPACE. 02410001
024200     05  FILLER                          PIC  X(08)  VALUE        02420000
024300         'SEQ. NBR'.                                              02430000
024400     05  FILLER                          PIC  X(05)  VALUE SPACE. 02440001
024500     05  FILLER                          PIC  X(11)  VALUE        02450000
024600         'VENDOR NAME'.                                           02460000
024700     05  FILLER                          PIC  X(10)  VALUE SPACE. 02470000
024800     05  FILLER                          PIC  X(04)  VALUE        02480000
024900         'TYPE'.                                                  02490000
025000     05  FILLER                          PIC  X(04)  VALUE SPACE. 02500000
025100     05  FILLER                          PIC  X(11)  VALUE        02510000
025200         'RETURN DATE'.                                           02520000
025300     05  FILLER                          PIC  X(04)  VALUE SPACE. 02530000
025400     05  FILLER                          PIC  X(04)  VALUE        02540000
025500         'DEPT'.                                                  02550000
025600     05  FILLER                          PIC  X(02)  VALUE SPACE. 02560000
025700     05  FILLER                          PIC  X(05)  VALUE        02570000
025800         'CLASS'.                                                 02580000
025900     05  FILLER                          PIC  X(04)  VALUE SPACE. 02590000
026000     05  FILLER                          PIC  X(03)  VALUE 'SKU'. 02600000
026100     05  FILLER                          PIC  X(17)  VALUE SPACE. 02610000
026200     05  FILLER                          PIC  X(13)  VALUE        02620000
026300         'ERROR MESSAGE'.                                         02630000
026400     05  FILLER                          PIC  X(11)  VALUE SPACE. 02640000
026500                                                                  02650000
026600 01  DH3-DETAIL-HEADING-3.                                        02660000
026700     05  FILLER                          PIC  X(132) VALUE        02670000
026800                                                       ALL '-'.   02680000
026900 01  DL1-DETAIL-LINE-HDR.                                         02690000
027000     05  FILLER                          PIC  X(02)  VALUE SPACE. 02700000
027100     05  DL1-ORD-ID-X.                                            02710000
027200         10  DL1-ORD-ID-9                PIC  Z(12).              02720000
027300     05  FILLER                          PIC  X(02)  VALUE SPACE. 02730000
027400     05  DL1-DUNS-NBR                    PIC  X(10).              02740000
027500     05  FILLER                          PIC  X(02)  VALUE SPACE. 02750000
027600     05  DL1-VENDOR-NAME                 PIC  X(21).              02760000
027700     05  FILLER                          PIC  X(03)  VALUE SPACE. 02770000
027800     05  DL1-RETURN-TYPE                 PIC  X(01)  VALUE SPACE. 02780000
027900     05  FILLER                          PIC  X(05)  VALUE SPACE. 02790000
028000     05  DL1-ORD-DATE                    PIC  X(10)  VALUE SPACE. 02800000
028100     05  FILLER                          PIC  X(27)  VALUE SPACE. 02810000
028200     05  DL1-ERROR-MSG                   PIC  X(37)  VALUE SPACE. 02820000
028300                                                                  02830000
028400 01  DL2-DETAIL-LINE-DTL.                                         02840000
028500     05  FILLER                          PIC  X(02)  VALUE SPACE. 02850000
028600     05  DL2-ORD-ID-X.                                            02860000
028700         10  DL2-ORD-ID-9                PIC  9(12).              02870000
028800     05  FILLER                          PIC  X(02)  VALUE SPACE. 02880000
028900     05  DL2-SEQ-NBR-X.                                           02890000
029000         10  DL2-SEQ-NBR-9               PIC  ZZZZZZZZ9.          02900000
029100     05  FILLER                          PIC  X(27)  VALUE SPACE. 02910000
029200     05  DL2-RETURN-TYPE                 PIC  X(01)  VALUE SPACE. 02920000
029300     05  FILLER                          PIC  X(05)  VALUE SPACE. 02930000
029400     05  DL2-RETURN-DATE                 PIC  X(10)  VALUE SPACE. 02940000
029500     05  FILLER                          PIC  X(06)  VALUE SPACE. 02950000
029600     05  DL2-DEPT                        PIC  X(03)  VALUE SPACE. 02960000
029700     05  FILLER                          PIC  X(04)  VALUE SPACE. 02970000
029800     05  DL2-SUB-CLASS                   PIC  X(02)  VALUE SPACE. 02980000
029900     05  FILLER                          PIC  X(03)  VALUE SPACE. 02990000
030000     05  DL2-SKU                         PIC  X(08)  VALUE SPACE. 03000000
030100     05  FILLER                          PIC  X(01)  VALUE SPACE. 03010000
030200     05  DL2-ERROR-MSG                   PIC  X(37)  VALUE SPACE. 03020000
030300                                                                  03030000
030400                                                                  03040000
030500******* LINES USED FOR EXCEL FILE                                 03050000
030600 01  DH1X-DETAIL-HEADING-1.                                       03060000
030700     05  FILLER                          PIC  X(06)  VALUE        03070000
030800         'DEFECT'.                                                03080000
030900     05  FILLER                          PIC  X(01)  VALUE ';'.   03090000
031000     05  FILLER                          PIC  X(10)  VALUE        03100000
031100         'DUNS NBR /'.                                            03110000
031200     05  FILLER                          PIC  X(01)  VALUE ';'.   03120000
031300     05  FILLER                          PIC  X(06)  VALUE        03130000
031400         'VENDOR'.                                                03140000
031500     05  FILLER                          PIC  X(01)  VALUE ';'.   03150000
031600     05  FILLER                          PIC  X(06)  VALUE        03160000
031700         'RETURN'.                                                03170000
031800     05  FILLER                          PIC  X(01)  VALUE ';'.   03180000
031900     05  FILLER                          PIC  X(12)  VALUE        03190000
032000         'ORDER DATE /'.                                          03200000
032100     05  FILLER                          PIC  X(01)  VALUE ';'.   03210000
032200     05  FILLER                          PIC  X(04)  VALUE 'DEPT'.03220000
032300     05  FILLER                          PIC  X(01)  VALUE ';'.   03230000
032400     05  FILLER                          PIC  X(03)  VALUE 'SUB'. 03240000
032500     05  FILLER                          PIC  X(01)  VALUE ';'.   03250000
032600     05  FILLER                          PIC  X(03)  VALUE 'SKU'. 03260000
032700     05  FILLER                          PIC  X(01)  VALUE ';'.   03270000
032800     05  FILLER                          PIC  X(05)  VALUE        03280000
032900         'ERROR'.                                                 03290000
033000     05  FILLER                          PIC  X(01)  VALUE ';'.   03300000
033100                                                                  03310000
033200***********************                                           03320000
033300 01  DH2X-DETAIL-HEADING-2.                                       03330000
033400     05  FILLER                          PIC  X(06)  VALUE        03340000
033500         'ORD ID'.                                                03350000
033600     05  FILLER                          PIC  X(01)  VALUE ';'.   03360000
033700     05  FILLER                          PIC  X(08)  VALUE        03370000
033800         'SEQ. NBR'.                                              03380000
033900     05  FILLER                          PIC  X(01)  VALUE ';'.   03390000
034000     05  FILLER                          PIC  X(04)  VALUE        03400000
034100         'NAME'.                                                  03410000
034200     05  FILLER                          PIC  X(01)  VALUE ';'.   03420000
034300     05  FILLER                          PIC  X(04)  VALUE        03430000
034400         'TYPE'.                                                  03440000
034500     05  FILLER                          PIC  X(01)  VALUE ';'.   03450000
034600     05  FILLER                          PIC  X(11)  VALUE        03460000
034700         'RETURN DATE'.                                           03470000
034800     05  FILLER                          PIC  X(01)  VALUE ';'.   03480000
034900     05  FILLER                          PIC  X(03)  VALUE        03490000
035000         'NBR'.                                                   03500000
035100     05  FILLER                          PIC  X(01)  VALUE ';'.   03510000
035200     05  FILLER                          PIC  X(05)  VALUE        03520000
035300         'CLASS'.                                                 03530000
035400     05  FILLER                          PIC  X(01)  VALUE ';'.   03540000
035500     05  FILLER                          PIC  X(03)  VALUE 'NBR'. 03550000
035600     05  FILLER                          PIC  X(01)  VALUE ';'.   03560000
035700     05  FILLER                          PIC  X(07)  VALUE        03570000
035800         'MESSAGE'.                                               03580000
035900     05  FILLER                          PIC  X(01)  VALUE ';'.   03590000
036000***********************                                           03600000
036100 01  DL1X-DETAIL-LINE-HDR.                                        03610000
036200     05  DL1X-ORD-ID-X.                                           03620000
036300         10  DL1X-ORD-ID-9               PIC  9(06).              03630000
036400     05  FILLER                          PIC  X(01)  VALUE ';'.   03640000
036500     05  DL1X-DUNS-NBR                   PIC  X(10).              03650000
036600     05  FILLER                          PIC  X(01)  VALUE ';'.   03660000
036700     05  DL1X-VENDOR-NAME                PIC  X(25).              03670000
036800     05  FILLER                          PIC  X(01)  VALUE ';'.   03680000
036900     05  DL1X-RETURN-TYPE                PIC  X(01)  VALUE SPACE. 03690000
037000     05  FILLER                          PIC  X(01)  VALUE ';'.   03700000
037100     05  DL1X-ORD-DATE                   PIC  X(10)  VALUE SPACE. 03710000
037200     05  FILLER                          PIC  X(01)  VALUE ';'.   03720000
037300     05  FILLER                          PIC  X(01)  VALUE ';'.   03730000
037400     05  FILLER                          PIC  X(01)  VALUE ';'.   03740000
037500     05  FILLER                          PIC  X(01)  VALUE ';'.   03750000
037600     05  DL1X-ERROR-MSG                  PIC  X(37)  VALUE SPACE. 03760000
037700     05  FILLER                          PIC  X(01)  VALUE ';'.   03770000
037800                                                                  03780000
037900 01  DL2X-DETAIL-LINE-DTL.                                        03790000
038000     05  DL2X-ORD-ID-X.                                           03800000
038100         10  DL2X-ORD-ID-9               PIC  9(06).              03810000
038200     05  FILLER                          PIC  X(01)  VALUE ';'.   03820000
038300     05  DL2X-SEQ-NBR-X.                                          03830000
038400         10  DL2X-SEQ-NBR-9              PIC  9(09).              03840000
038500     05  FILLER                          PIC  X(01)  VALUE ';'.   03850000
038600     05  DL2X-RETURN-TYPE                PIC  X(01)  VALUE SPACE. 03860000
038700     05  FILLER                          PIC  X(01)  VALUE ';'.   03870000
038800     05  DL2X-RETURN-DATE                PIC  X(10)  VALUE SPACE. 03880000
038900     05  FILLER                          PIC  X(01)  VALUE ';'.   03890000
039000     05  DL2X-DEPT                       PIC  X(03)  VALUE SPACE. 03900000
039100     05  FILLER                          PIC  X(01)  VALUE ';'.   03910000
039200     05  DL2X-SUB-CLASS                  PIC  X(02)  VALUE SPACE. 03920000
039300     05  FILLER                          PIC  X(01)  VALUE ';'.   03930000
039400     05  DL2X-SKU                        PIC  X(08)  VALUE SPACE. 03940000
039500     05  FILLER                          PIC  X(01)  VALUE ';'.   03950000
039600     05  DL2X-ERROR-MSG                  PIC  X(37)  VALUE SPACE. 03960000
039700     05  FILLER                          PIC  X(01)  VALUE ';'.   03970000
039800                                                                  03980000
039900 01  BLANK-LINE.                                                  03990000
040000     05  FILLER                          PIC  X(132) VALUE SPACE. 04000000
040100                                                                  04010000
040200 01  END-OF-REPORT-LINE.                                          04020000
040300     05  FILLER                          PIC  X(54)  VALUE SPACE. 04030000
040400     05  FILLER                          PIC  X(25)  VALUE        04040000
040500         '***** END OF REPORT *****'.                             04050000
040600     05  FILLER                          PIC  X(53)  VALUE SPACE. 04060000
040700                                                                  04070000
040800 01  PV-NO-ERROR-LINE.                                            04080000
040900     05  FILLER                          PIC  X(43)  VALUE SPACE. 04090000
041000     05  FILLER                          PIC  X(47)  VALUE        04100000
041100         '******** THERE ARE NO ERRORS TO REPORT ********'.       04110000
041200     05  FILLER                          PIC  X(42)  VALUE SPACE. 04120000
041300                                                                  04130000
041400 PROCEDURE DIVISION.                                              04140000
041500                                                                  04150000
041600 0000-MAINLINE.                                                   04160000
041700     PERFORM 1000-INITIALIZE.                                     04170000
041800                                                                  04180000
041900     PERFORM 2000-CREATE-ERROR-REPORT                             04190000
042000         UNTIL PS-END-OF-FILE.                                    04200000
042100                                                                  04210000
042200     PERFORM 9000-EOJ-ROUTINE.                                    04220000
042300                                                                  04230000
042400     GOBACK.                                                      04240000
042500                                                                  04250000
042600******************************************************************04260000
042700*** 1000-INITIALIZE :                                             04270000
042800***   - OPENS THE INPUT AND OUTPUT FILES.                         04280000
042900***   - READS THE RUN DATE FROM CONTROL CARD.                     04290000
043000***   - WRTIE PAGE HEADING TO THE REPORT.                         04300000
043100***   - READ THE FIRST RECORD FROM THE INPUT FILE.                04310000
043200******************************************************************04320000
043300 1000-INITIALIZE.                                                 04330000
043400     INITIALIZE RV018-HDR-ERROR-RECORD                            04340000
043500                RV019-DTL-ERROR-RECORD                            04350000
043600                ERROR-RPT-RECORD                                  04360000
043700                EXCEL-REC.                                        04370000
043800                                                                  04380000
043900     SET PS-NOT-END-OF-FILE TO  TRUE.                             04390000
044000**  JH  10/30/2011  BEG                                           04400000
044100     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           04410000
044200     PERFORM 1100-VALIDATE-CONTOL-CARD.                           04420000
044300                                                                  04430000
044400     PERFORM 5000-SELECT-TCOCNTL.                                 04440000
044500                                                                  04450000
044600     MOVE COCNTL-BTCH-PRC-DTE TO PV-PD-DTE.                       04460000
044700                                                                  04470000
044800     MOVE PV-PD-MM TO PH3-DATE-MM.                                04480000
044900     MOVE PV-PD-DD TO PH3-DATE-DD.                                04490000
045000     MOVE PV-PD-CY TO PH3-DATE-CCYY.                              04500000
045100                                                                  04510000
045200**  JH  10/30/2011  END                                           04520000
045300                                                                  04530000
045400     OPEN INPUT  ERROR-FILE                                       04540000
045500          OUTPUT ERROR-REPORT                                     04550000
045600                 ERROR-REPORT-EXCEL.                              04560000
045700                                                                  04570000
045800     MOVE FUNCTION CURRENT-DATE (1:8) TO SD-SYSTEM-DATE.          04580000
045900     MOVE FUNCTION CURRENT-DATE (9:6) TO ST-SYSTEM-TIME.          04590000
046000                                                                  04600000
046100     MOVE SD-SYSTEM-CCYY   TO DP132-RUN-YEAR.                     04610000
046200     MOVE SD-SYSTEM-MONTH  TO DP132-RUN-MONTH.                    04620000
046300     MOVE SD-SYSTEM-DAY    TO DP132-RUN-DAY.                      04630000
046400                                                                  04640000
046500     MOVE ST-SYSTEM-HOUR   TO DP132-RUN-HOUR.                     04650000
046600     MOVE ST-SYSTEM-MINUTE TO DP132-RUN-MINUTE.                   04660000
046700                                                                  04670000
046800     MOVE 'RVKRP022'       TO DP132-PROGRAM-NAME.                 04680000
046900     MOVE 1                TO DP132-REPORT-NUMBER.                04690000
047000                                                                  04700000
047100**  JH  10/30/2011  BEG                                           04710000
047200**   PERFORM 4000-WRITE-PAGE-HEADING.                             04720000
047300                                                                  04730000
047400     SET PS-NUMERIC TO TRUE.                                      04740000
047500     PERFORM 3000-READ-ERROR-FILE.                                04750000
047600**  JH  10/30/2011  END                                           04760000
047700     IF PS-NOT-END-OF-FILE                                        04770000
047800         IF PV-HR-HEADER                                          04780000
047900             MOVE PV-HOLD-RECORD TO RV018-HDR-ERROR-RECORD        04790000
048000**  JH  10/30/2011  BEG                                           04800000
048100             MOVE RV018-RTV-LOC     TO PH4-RTV-LOC                04810000
048200             MOVE RV018-RTV-LOC-NME TO PH4-RTV-NAME               04820000
048300             PERFORM 4000-WRITE-PAGE-HEADING                      04830000
048400**  JH  10/30/2011  END                                           04840000
048500             IF RV018-DFCT-ORD-ID IS NUMERIC                      04850000
048600                 SET PS-NUMERIC TO TRUE                           04860000
048700                 MOVE RV018-DFCT-ORD-ID TO PV-HOLD-ORD-ID         04870000
048800                                           PV-CURR-ORD-ID         04880000
048900             ELSE                                                 04890000
049000                 SET PS-NOT-NUMERIC TO TRUE                       04900000
049100                 MOVE RV018-DFCT-ORD-ID-X TO PV-HOLD-ORD-ID       04910000
049200                                             PV-CURR-ORD-ID       04920000
049300             END-IF                                               04930000
049400         ELSE                                                     04940000
049500             MOVE PV-HOLD-RECORD TO RV019-DTL-ERROR-RECORD        04950000
049600**  JH  10/30/2011  BEG                                           04960000
049700             MOVE RV019-RTV-LOC     TO PH4-RTV-LOC                04970000
049800             MOVE RV019-RTV-LOC-NME TO PH4-RTV-NAME               04980000
049900             PERFORM 4000-WRITE-PAGE-HEADING                      04990000
050000**  JH  10/30/2011  END                                           05000000
050100             IF RV019-DFCT-ORD-ID IS NUMERIC                      05010000
050200                 SET PS-NUMERIC TO TRUE                           05020000
050300                 MOVE RV019-DFCT-ORD-ID TO PV-HOLD-ORD-ID         05030000
050400                                           PV-CURR-ORD-ID         05040000
050500             ELSE                                                 05050000
050600                 SET PS-NOT-NUMERIC TO TRUE                       05060000
050700                 MOVE RV019-DFCT-ORD-ID-X TO PV-HOLD-ORD-ID       05070000
050800                                             PV-CURR-ORD-ID       05080000
050900             END-IF                                               05090000
051000         END-IF                                                   05100000
051100     ELSE                                                         05110000
051200**       CMS 10/30/2011  BEG                                      05120000
051300         MOVE CC-LOC                TO PV-KEY-LOC-NBR             05130000
051400         PERFORM 6000-READ-XLT00010                               05140000
051500         MOVE CC-LOC                TO PH4-RTV-LOC                05150000
051600         MOVE XLT00010-LOC-10-ABBR-NM                             05160000
051700                                    TO PH4-RTV-NAME               05170000
051800         PERFORM 4000-WRITE-PAGE-HEADING                          05180000
051900         DISPLAY 'THERE ARE NO ERRORS TO REPORT FOR ' PH3-DATE    05190000
052000**       CMS 10/30/2011  END                                      05200000
052100     END-IF.                                                      05210000
052200                                                                  05220000
052300**   CMS 10/30/2011  BEG                                          05230000
052400 1100-VALIDATE-CONTOL-CARD.                                       05240000
052500     IF CC-LOC-NBR IS NOT NUMERIC                                 05250000
052600         DISPLAY '** ABEND **'                                    05260000
052700         DISPLAY '** PARAGRAPH '                                  05270000
052800                 '= 1100-VALIDATE-CONTOL-CARD **'                 05280000
052900         DISPLAY '** INVALID LOC NBR IN CONTROL CARD **'          05290000
053000         MOVE +4003 TO PV-ABEND-CODE                              05300000
053100         CALL 'ILBOABN0' USING PV-ABEND-CODE                      05310000
053200     END-IF.                                                      05320000
053300**   CMS 10/30/2011  END                                          05330000
053400                                                                  05340000
053500******************************************************************05350000
053600*** 2000-CREATE-ERROR-REPORT                                      05360000
053700***   - ANALYZE THE INPUT RECORD - IS IT HEADER OR DETAIL         05370000
053800***   - WRITE REPORT RECORD IF DEFECT_ORD_ID CHANGES              05380000
053900***   - READ RECORD FROM THE INPUT FILE.                          05390000
054000******************************************************************05400000
054100 2000-CREATE-ERROR-REPORT.                                        05410000
054200     IF PV-HR-HEADER                                              05420000
054300         PERFORM 2100-MOVE-HDR-TO-DETAIL-LINE1                    05430000
054400     ELSE                                                         05440000
054500         PERFORM 2200-MOVE-DTL-TO-DETAIL-LINE2                    05450000
054600     END-IF.                                                      05460000
054700                                                                  05470000
054800     PERFORM 3000-READ-ERROR-FILE.                                05480000
054900     IF PV-HR-HEADER                                              05490000
055000         MOVE PV-HOLD-RECORD TO RV018-HDR-ERROR-RECORD            05500000
055100         IF RV018-DFCT-ORD-ID IS NUMERIC                          05510000
055200             SET PS-NUMERIC TO TRUE                               05520000
055300             MOVE RV018-DFCT-ORD-ID TO PV-CURR-ORD-ID             05530000
055400         ELSE                                                     05540000
055500             SET PS-NOT-NUMERIC TO TRUE                           05550000
055600             MOVE RV018-DFCT-ORD-ID-X TO PV-CURR-ORD-ID           05560000
055700         END-IF                                                   05570000
055800     ELSE                                                         05580000
055900         MOVE PV-HOLD-RECORD TO RV019-DTL-ERROR-RECORD            05590000
056000         IF RV019-DFCT-ORD-ID IS NUMERIC                          05600000
056100             SET PS-NUMERIC TO TRUE                               05610000
056200             MOVE RV019-DFCT-ORD-ID TO PV-CURR-ORD-ID             05620000
056300         ELSE                                                     05630000
056400             SET PS-NOT-NUMERIC TO TRUE                           05640000
056500             MOVE RV019-DFCT-ORD-ID-X TO PV-CURR-ORD-ID           05650000
056600         END-IF                                                   05660000
056700     END-IF.                                                      05670000
056800                                                                  05680000
056900******************************************************************05690000
057000*** 2100-MOVE-HDR-TO-DETAIL-LINE1.                                05700000
057100***   - MOVE FIELDS TO DETAIL LINE FOR REPORT AND EXCEL FILE      05710000
057200***   - WRITE REPORT RECORD                                       05720000
057300******************************************************************05730000
057400 2100-MOVE-HDR-TO-DETAIL-LINE1.                                   05740000
057500     IF PS-NUMERIC                                                05750000
057600         MOVE RV018-DFCT-ORD-ID         TO DL1-ORD-ID-9           05760000
057700                                           DL1X-ORD-ID-9          05770000
057800     ELSE                                                         05780000
057900         MOVE RV018-DFCT-ORD-ID-X       TO DL1-ORD-ID-X           05790000
058000                                           DL1X-ORD-ID-X          05800000
058100     END-IF.                                                      05810000
058200                                                                  05820000
058300     MOVE RV018-VENDOR-DUNS-NBR         TO DL1-DUNS-NBR           05830000
058400                                           DL1X-DUNS-NBR.         05840000
058500     MOVE RV018-VEND-NAME               TO DL1-VENDOR-NAME        05850000
058600                                           DL1X-VENDOR-NAME.      05860000
058700     MOVE RV018-RETURN-TYPE             TO DL1-RETURN-TYPE        05870000
058800                                           DL1X-RETURN-TYPE.      05880000
058900     MOVE RV018-ORD-DTE                 TO DL1-ORD-DATE           05890000
059000                                           DL1X-ORD-DATE.         05900000
059100     STRING PV-HR-REC-TYPE DELIMITED BY SIZE                      05910000
059200            '-'            DELIMITED BY SIZE                      05920000
059300            RV018-ERROR-MSG DELIMITED BY SIZE                     05930000
059400       INTO PV-HOLD-ERROR-MSG.                                    05940000
059500     MOVE PV-HOLD-ERROR-MSG             TO DL1-ERROR-MSG          05950000
059600                                           DL1X-ERROR-MSG.        05960000
059700**  JH 10/30/2011 BEG                                             05970000
059800     MOVE RV018-RTV-LOC     TO PH4-RTV-LOC.                       05980000
059900     MOVE RV018-RTV-LOC-NME TO PH4-RTV-NAME.                      05990000
060000**  JH 10/30/2011 END                                             06000000
060100                                                                  06010000
060200     PERFORM 4100-WRITE-REPORT.                                   06020000
060300                                                                  06030000
060400******************************************************************06040000
060500*** 2200 MOVE-DTL-TO-DETAIL-LINE2.                                06050000
060600***   - MOVE FIELDS TO DETAIL LINE FOR REPORT AND EXCEL FILE      06060000
060700***   - WRITE REPORT RECORD                                       06070000
060800******************************************************************06080000
060900 2200-MOVE-DTL-TO-DETAIL-LINE2.                                   06090000
061000     IF PS-NUMERIC                                                06100000
061100         MOVE RV019-DFCT-ORD-ID         TO DL2-ORD-ID-9           06110000
061200                                           DL2X-ORD-ID-9          06120000
061300     ELSE                                                         06130000
061400         MOVE RV019-DFCT-ORD-ID-X       TO DL2-ORD-ID-X           06140000
061500                                           DL2X-ORD-ID-X          06150000
061600     END-IF.                                                      06160000
061700                                                                  06170000
061800     MOVE RV019-SEQ-NBR                 TO DL2-SEQ-NBR-9          06180000
061900                                           DL2X-SEQ-NBR-9.        06190000
062000     MOVE RV019-RETURN-TYPE             TO DL2-RETURN-TYPE        06200000
062100                                           DL2X-RETURN-TYPE.      06210000
062200     MOVE RV019-DFCT-RET-DTE            TO DL2-RETURN-DATE        06220000
062300                                           DL2X-RETURN-DATE.      06230000
062400     MOVE RV019-DEPT-NBR                TO DL2-DEPT               06240000
062500                                           DL2X-DEPT.             06250000
062600     MOVE RV019-SUB-CLASS-NBR           TO DL2-SUB-CLASS          06260000
062700                                           DL2X-SUB-CLASS.        06270000
062800     MOVE RV019-SKU                     TO DL2-SKU                06280000
062900                                           DL2X-SKU.              06290000
063000     STRING PV-HR-REC-TYPE DELIMITED BY SIZE                      06300000
063100            '-'            DELIMITED BY SIZE                      06310000
063200            RV019-ERROR-MSG DELIMITED BY SIZE                     06320000
063300       INTO PV-HOLD-ERROR-MSG.                                    06330000
063400     MOVE PV-HOLD-ERROR-MSG             TO DL2-ERROR-MSG          06340000
063500                                           DL2X-ERROR-MSG.        06350000
063600                                                                  06360000
063700     PERFORM 4100-WRITE-REPORT.                                   06370000
063800                                                                  06380000
063900******************************************************************06390000
064000*** 3000-READ-ERROR-FILE.                                         06400000
064100***   - READ ERROR FILE.                                          06410000
064200***   - AT EOF WRITE THE FINAL RECORD TO THE REPORT               06420000
064300***   - NOT AT EOF, INCREMENT THE RECORD COUNTER                  06430000
064400******************************************************************06440000
064500 3000-READ-ERROR-FILE.                                            06450000
064600     READ ERROR-FILE INTO PV-HOLD-RECORD                          06460000
064700          AT END SET PS-END-OF-FILE TO TRUE                       06470000
064800          NOT AT END ADD 1 TO PV-REC-READ                         06480000
064900     END-READ.                                                    06490000
065000                                                                  06500000
065100******************************************************************06510000
065200*** 4000-WRITE-PAGE-HEADING.                                      06520000
065300***   - WRITE HEADING TO THE REPORT.                              06530000
065400***   - EXECUTES WHEN PAGE BREAK OCCURS.                          06540000
065500******************************************************************06550000
065600 4000-WRITE-PAGE-HEADING.                                         06560000
065700     ADD  1             TO PV-PAGE-COUNT.                         06570000
065800     MOVE PV-PAGE-COUNT TO DP132-PAGE-NUMBER.                     06580000
065900                                                                  06590000
066000     WRITE ERROR-RPT-RECORD                                       06600000
066100         FROM DP132-STANDRD-HEADER-132-COLS                       06610000
066200         AFTER ADVANCING PAGE.                                    06620000
066300                                                                  06630000
066400     WRITE ERROR-RPT-RECORD                                       06640000
066500         FROM PH2-PAGE-HEADING-2                                  06650000
066600         AFTER ADVANCING 1 LINES.                                 06660000
066700                                                                  06670000
066800     WRITE ERROR-RPT-RECORD                                       06680000
066900         FROM PH3-PAGE-HEADING-3                                  06690000
067000         AFTER ADVANCING 1 LINES.                                 06700000
067100                                                                  06710000
067200**  JH 10/30/2011 BEG                                             06720000
067300     WRITE ERROR-RPT-RECORD                                       06730000
067400         FROM PH4-PAGE-HEADING-4                                  06740000
067500         AFTER ADVANCING 1 LINES.                                 06750000
067600**  JH 10/30/2011 END                                             06760000
067700                                                                  06770000
067800     WRITE EXCEL-REC                                              06780000
067900         FROM PH2-PAGE-HEADING-2                                  06790000
068000         AFTER ADVANCING 1 LINES                                  06800000
068100                                                                  06810000
068200     WRITE EXCEL-REC                                              06820000
068300         FROM PH3-PAGE-HEADING-3                                  06830000
068400         AFTER ADVANCING 1 LINES                                  06840000
068500                                                                  06850000
068600**  JH 10/30/2011 BEG                                             06860000
068700                                                                  06870000
068800     WRITE EXCEL-REC                                              06880000
068900         FROM PH4-PAGE-HEADING-4                                  06890000
069000         AFTER ADVANCING 1 LINES.                                 06900000
069100**  JH 10/30/2011 END                                             06910000
069200                                                                  06920000
069300     WRITE ERROR-RPT-RECORD                                       06930000
069400         FROM BLANK-LINE                                          06940000
069500         AFTER ADVANCING 1 LINES.                                 06950000
069600                                                                  06960000
069700     WRITE ERROR-RPT-RECORD                                       06970000
069800         FROM DH1-DETAIL-HEADING-1                                06980000
069900         AFTER ADVANCING 1 LINES.                                 06990000
070000                                                                  07000000
070100     WRITE ERROR-RPT-RECORD                                       07010000
070200         FROM DH2-DETAIL-HEADING-2                                07020000
070300         AFTER ADVANCING 1 LINES.                                 07030000
070400                                                                  07040000
070500     WRITE ERROR-RPT-RECORD                                       07050000
070600         FROM DH3-DETAIL-HEADING-3                                07060000
070700         AFTER ADVANCING 1 LINES.                                 07070000
070800                                                                  07080000
070900     WRITE ERROR-RPT-RECORD                                       07090000
071000         FROM BLANK-LINE                                          07100000
071100         AFTER ADVANCING 1 LINES.                                 07110000
071200                                                                  07120000
071300     MOVE  8 TO PV-REPT-LINE-COUNT.                               07130000
071400                                                                  07140000
071500     WRITE EXCEL-REC                                              07150000
071600         FROM DH1X-DETAIL-HEADING-1                               07160000
071700         AFTER ADVANCING 1 LINES.                                 07170000
071800                                                                  07180000
071900     WRITE EXCEL-REC                                              07190000
072000         FROM DH2X-DETAIL-HEADING-2                               07200000
072100         AFTER ADVANCING 1 LINES.                                 07210000
072200                                                                  07220000
072300******************************************************************07230000
072400*** 4100-WRITE-REPORT.                                            07240000
072500***   - WRITE DETAIL LINES TO THE REPORT.                         07250000
072600******************************************************************07260000
072700 4100-WRITE-REPORT.                                               07270000
072800     IF  PV-REPT-LINE-COUNT > PC-MAX-REPORT-LINES                 07280000
072900         PERFORM 4000-WRITE-PAGE-HEADING                          07290000
073000     END-IF.                                                      07300000
073100                                                                  07310000
073200     IF PV-HOLD-ORD-ID = PV-CURR-ORD-ID                           07320000
073300         IF PV-HR-HEADER                                          07330000
073400             WRITE ERROR-RPT-RECORD                               07340000
073500                 FROM DL1-DETAIL-LINE-HDR                         07350000
073600                 AFTER ADVANCING 1 LINES                          07360000
073700             ADD 1 TO PV-REPT-LINE-COUNT                          07370000
073800             WRITE EXCEL-REC                                      07380000
073900                 FROM DL1X-DETAIL-LINE-HDR                        07390000
074000                 AFTER ADVANCING 1 LINES                          07400000
074100         ELSE                                                     07410000
074200             WRITE ERROR-RPT-RECORD                               07420000
074300                 FROM DL2-DETAIL-LINE-DTL                         07430000
074400                 AFTER ADVANCING 1 LINES                          07440000
074500             ADD 1 TO PV-REPT-LINE-COUNT                          07450000
074600             WRITE EXCEL-REC                                      07460000
074700                 FROM DL2X-DETAIL-LINE-DTL                        07470000
074800                 AFTER ADVANCING 1 LINES                          07480000
074900     ELSE                                                         07490000
075000         WRITE ERROR-RPT-RECORD                                   07500000
075100             FROM BLANK-LINE                                      07510000
075200             AFTER ADVANCING 1 LINES                              07520000
075300         ADD 1 TO PV-REPT-LINE-COUNT                              07530000
075400         IF PV-HR-HEADER                                          07540000
075500             WRITE ERROR-RPT-RECORD                               07550000
075600                 FROM DL1-DETAIL-LINE-HDR                         07560000
075700                 AFTER ADVANCING 1 LINES                          07570000
075800             ADD 1 TO PV-REPT-LINE-COUNT                          07580000
075900             WRITE EXCEL-REC                                      07590000
076000                 FROM DL1X-DETAIL-LINE-HDR                        07600000
076100                 AFTER ADVANCING 1 LINES                          07610000
076200             MOVE PV-CURR-ORD-ID TO PV-HOLD-ORD-ID                07620000
076300         ELSE                                                     07630000
076400             WRITE ERROR-RPT-RECORD                               07640000
076500                 FROM DL2-DETAIL-LINE-DTL                         07650000
076600                 AFTER ADVANCING 1 LINES                          07660000
076700             ADD 1 TO PV-REPT-LINE-COUNT                          07670000
076800             WRITE EXCEL-REC                                      07680000
076900                 FROM DL2X-DETAIL-LINE-DTL                        07690000
077000                 AFTER ADVANCING 1 LINES                          07700000
077100             MOVE PV-CURR-ORD-ID TO PV-HOLD-ORD-ID                07710000
077200         END-IF                                                   07720000
077300     END-IF.                                                      07730000
077400                                                                  07740000
077500     ADD 1 TO PV-REC-WRITTEN.                                     07750000
077600                                                                  07760000
077700     INITIALIZE DL1-DETAIL-LINE-HDR                               07770000
077800                DL2-DETAIL-LINE-DTL.                              07780000
077900                                                                  07790000
078000******************************************************************07800000
078100*** 4200-WRITE-EMPTY-REPORT.                                      07810000
078200***   - WRITE ERROR RECORD IF THERE IS NO RECORDS IN INPUT FILE.  07820000
078300******************************************************************07830000
078400 4200-WRITE-EMPTY-REPORT.                                         07840000
078500     WRITE ERROR-RPT-RECORD                                       07850000
078600         FROM PV-NO-ERROR-LINE                                    07860000
078700         AFTER ADVANCING 2 LINES.                                 07870000
078800                                                                  07880000
078900     WRITE EXCEL-REC                                              07890000
079000         FROM PV-NO-ERROR-LINE.                                   07900000
079100**  JH  10/30/2011  BEG                                           07910000
079200                                                                  07920000
079300 5000-SELECT-TCOCNTL.                                             07930000
079400                                                                  07940000
079500     MOVE '5000-SELECT-TCOCNTL'  TO PV-PARAGRAPH.                 07950000
079600                                                                  07960000
079700     EXEC SQL                                                     07970000
079800        SELECT  A.BTCH_PRC_DTE                                    07980000
079900          INTO :COCNTL-BTCH-PRC-DTE                               07990000
080000          FROM  TCOCNTL A                                         08000000
080100          WHERE A.OPER_UNT_ID   =  90                             08010000
080200     END-EXEC.                                                    08020000
080300                                                                  08030000
080400     EVALUATE TRUE                                                08040000
080500                                                                  08050000
080600         WHEN SQLCODE = ZEROS                                     08060000
080700             CONTINUE                                             08070000
080800         WHEN OTHER                                               08080000
080900             MOVE 'TCOCNTL' TO PV-ABEND-TABLE-1                   08090000
081000             PERFORM 9100-SQL-ERROR                               08100000
081100                                                                  08110000
081200     END-EVALUATE.                                                08120000
081300**  JH  10/30/2011  END                                           08130000
081400                                                                  08140000
081500**  CMS 10/30/2011  BEG                                           08150000
081600******************************************************************08160000
081700*  READ XLT00010 - XLT_LOC TABLE.                                 08170000
081800******************************************************************08180000
081900 6000-READ-XLT00010.                                              08190000
082000     INITIALIZE DCLXLT00010.                                      08200000
082100     SET PS-XLT00010-NOTFND        TO TRUE.                       08210000
082200                                                                  08220000
082300     PERFORM                                                      08230000
082400         WITH TEST AFTER                                          08240000
082500         VARYING PV-RETRY-COUNTER                                 08250000
082600         FROM 1 BY 1                                              08260000
082700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08270000
082800                   OR (SQLCODE = ZERO)                            08280000
082900                   OR (SQLCODE = +100))                           08290000
083000         EXEC SQL                                                 08300000
083100              SELECT  LOC_10_ABBR_NM                              08310000
083200              INTO  :XLT00010-LOC-10-ABBR-NM                      08320000
083300              FROM XLT_LOC                                        08330000
083400              WHERE LOC_NBR = :PV-KEY-LOC-NBR                     08340000
083500         END-EXEC                                                 08350000
083600                                                                  08360000
083700         EVALUATE TRUE                                            08370000
083800             WHEN SQLCODE = ZERO                                  08380000
083900             WHEN SQLCODE = -904                                  08390000
084000             WHEN SQLCODE = -911                                  08400000
084100             WHEN SQLCODE = -913                                  08410000
084200                 SET PS-XLT00010-FOUND TO TRUE                    08420000
084300             WHEN SQLCODE = +100                                  08430000
084400                 SET PS-XLT00010-NOTFND TO TRUE                   08440000
084500             WHEN SQLWARN0 NOT EQUAL SPACE                        08450000
084600             WHEN SQLCODE NOT EQUAL ZERO                          08460000
084700                 DISPLAY '** ABEND **'                            08470000
084800                 DISPLAY '** PROGRAM = RVKRP022 **'               08480000
084900                 DISPLAY '** PARAGRAPH = '                        08490000
085000                         '6000-READ-XLT00010 **'                  08500000
085100                 MOVE 'SELECT XLT_LOC'  TO PV-ABEND-MESSAGE       08510000
085200                 MOVE 'XLT_LOC'         TO PV-ABEND-TABLE-1       08520000
085300                 PERFORM 9100-SQL-ERROR                           08530000
085400         END-EVALUATE                                             08540000
085500     END-PERFORM.                                                 08550000
085600                                                                  08560000
085700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08570000
085800         DISPLAY '** ABEND **'                                    08580000
085900         DISPLAY '** PROGRAM = RVKRP022 **'                       08590000
086000         DISPLAY '** PARAGRAPH = 6000-READ-XLT00010 **'           08600000
086100         MOVE 'SELECT MAX RETRIES'                                08610000
086200                                        TO PV-ABEND-MESSAGE       08620000
086300         MOVE 'XLT_LOC'                 TO PV-ABEND-TABLE-1       08630000
086400         PERFORM 9100-SQL-ERROR                                   08640000
086500     END-IF.                                                      08650000
086600**  CMS 10/30/2011  END                                           08660000
086700                                                                  08670000
086800******************************************************************08680000
086900*** 9000-EOJ-ROUTINE.                                             08690000
087000***   - WRITE TRAILER RECORD OR ERROR RECORD.                     08700000
087100***   - WRITE END OF REPORT RECORD.                               08710000
087200***   - CLOSE ALL THE OPENED FILES.                               08720000
087300******************************************************************08730000
087400 9000-EOJ-ROUTINE.                                                08740000
087500     IF  PV-REC-READ = 0                                          08750000
087600         PERFORM 4200-WRITE-EMPTY-REPORT                          08760000
087700     ELSE                                                         08770000
087800         DISPLAY 'ERROR RECORDS READ:  ' PV-REC-READ              08780000
087900         DISPLAY 'ERROR RECORDS WRITTEN: ' PV-REC-WRITTEN         08790000
088000         MOVE 4008 TO RETURN-CODE                                 08800000
088100     END-IF.                                                      08810000
088200                                                                  08820000
088300     IF  PV-REPT-LINE-COUNT > 54                                  08830000
088400         PERFORM 4000-WRITE-PAGE-HEADING                          08840000
088500     END-IF.                                                      08850000
088600                                                                  08860000
088700     WRITE ERROR-RPT-RECORD                                       08870000
088800         FROM END-OF-REPORT-LINE                                  08880000
088900         AFTER ADVANCING 2 LINES.                                 08890000
089000                                                                  08900000
089100     WRITE EXCEL-REC                                              08910000
089200         FROM END-OF-REPORT-LINE.                                 08920000
089300                                                                  08930000
089400     CLOSE ERROR-FILE                                             08940000
089500           ERROR-REPORT                                           08950000
089600           ERROR-REPORT-EXCEL.                                    08960000
089700**  JH  10/30/2011  BEG                                           08970000
089800                                                                  08980000
089900******************************************************************08990000
090000* PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    *09000000
090100* ERROR OR WARNING CODE OCCURS.                                  *09010000
090200******************************************************************09020000
090300 9100-SQL-ERROR.                                                  09030000
090400     DISPLAY '************************************************'.  09040000
090500     DISPLAY '********** PROGRAM ABEND ***********************'.  09050000
090600     DISPLAY '** PROGRAM       : ' PC-PROGRAM-NAME.               09060000
090700     DISPLAY '** PARAGRAPH     : ' PV-PARAGRAPH.                  09070000
090800     DISPLAY '** TABLE         : ' PV-ABEND-TABLE-1.              09080000
090900     DISPLAY '** ERROR MESSAGE : ' PV-ABEND-MESSAGE.              09090000
091000     DISPLAY '***********************************************'.   09100000
091100     MOVE +4013 TO PV-ABEND-CODE.                                 09110000
091200     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         09120000
091300                                                                  09130000
091400**  JH  10/30/2011  END                                           09140000
091500******************  END OF RVKRP022  *****************************09150000
