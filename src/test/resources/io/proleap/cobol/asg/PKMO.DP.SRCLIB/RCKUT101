000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400 PROGRAM-ID.             RCKUT101.                                00040001
000500 AUTHOR.                 BUDDY BARNES.                            00050001
000600 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00060001
000700 DATE-WRITTEN            9-10-98.                                 00070001
000800 DATE-COMPILED.                                                   00080001
000900                                                                  00090001
001000*----------------------------------------------------------------*00100001
001100* THIS PROGRAM APPENDS  THE GMM, DMM, AND BYR INFORMATION TO     *00110001
001200* THE STOREEXT RECORD FOR USE WITH THE BUYER RECEIPTS JOURNAL.   *00120001
001300*----------------------------------------------------------------*00130001
001400                                                                  00140001
001500******************************************************************00150001
001600 ENVIRONMENT DIVISION.                                            00160001
001700******************************************************************00170001
001800 CONFIGURATION SECTION.                                           00180001
001900                                                                  00190001
002000 SOURCE-COMPUTER.        IBM-3090.                                00200001
002100 OBJECT-COMPUTER.        IBM-3090.                                00210001
002200                                                                  00220001
002300 INPUT-OUTPUT SECTION.                                            00230001
002400 FILE-CONTROL.                                                    00240001
002500                                                                  00250001
002600      SELECT STORE-EXTRACT-IN       ASSIGN TO INP01.              00260001
002700      SELECT PROCESS-DATE-FILE      ASSIGN TO INP02.              00270001
002800      SELECT CC-DEFERRED-PARM-FILE  ASSIGN TO INP03.              00280001
002900      SELECT CC-RUN-TYPE            ASSIGN TO INP04.              00290001
003000      SELECT STORE-EXTRACT-EXTD-OUT ASSIGN TO OUT01.              00300001
003100                                                                  00310001
003200******************************************************************00320001
003300 DATA DIVISION.                                                   00330001
003400******************************************************************00340001
003500 FILE SECTION.                                                    00350001
003600 FD  STORE-EXTRACT-IN                                             00360001
003700     LABEL RECORDS ARE STANDARD                                   00370001
003800     BLOCK CONTAINS 0 RECORDS                                     00380001
003900     RECORDING MODE IS F                                          00390001
004000     RECORD CONTAINS 300 CHARACTERS                               00400001
004100     DATA RECORD IS STORE-EXTRACT-RECORD.                         00410001
004200                                                                  00420001
004300 01  STORE-EXTRACT-RECORD            PIC X(300).                  00430001
004400                                                                  00440001
004500 FD  PROCESS-DATE-FILE                                            00450001
004600     LABEL RECORDS ARE STANDARD                                   00460001
004700     BLOCK CONTAINS 0 RECORDS                                     00470001
004800     RECORDING MODE IS F                                          00480001
004900     RECORD CONTAINS 080 CHARACTERS                               00490001
005000     DATA RECORD IS PROCESS-DATE-RECORD.                          00500001
005100                                                                  00510001
005200 01  PROCESS-DATE-RECORD             PIC X(080).                  00520001
005300                                                                  00530001
005400 FD  CC-DEFERRED-PARM-FILE                                        00540001
005500     LABEL RECORDS ARE STANDARD                                   00550001
005600     BLOCK CONTAINS 0 RECORDS                                     00560001
005700     RECORDING MODE IS F                                          00570001
005800     RECORD CONTAINS 080 CHARACTERS                               00580001
005900     DATA RECORD IS CC-DEFERRED-PARM-RECORD.                      00590001
006000                                                                  00600001
006100 01  CC-DEFERRED-PARM-RECORD         PIC X(080).                  00610001
006200                                                                  00620001
006300 FD  CC-RUN-TYPE                                                  00630001
006400     RECORDING MODE IS F                                          00640001
006500     RECORD CONTAINS 080 CHARACTERS                               00650001
006600     BLOCK CONTAINS  0 RECORDS                                    00660001
006700     LABEL RECORDS ARE STANDARD.                                  00670001
006800 SKIP1                                                            00680001
006900 01  CC-RUN-TYPE-RECORD              PIC X(080).                  00690001
007000                                                                  00700001
007100 FD  STORE-EXTRACT-EXTD-OUT                                       00710001
007200     LABEL RECORDS ARE STANDARD                                   00720001
007300     BLOCK CONTAINS 0 RECORDS                                     00730001
007400     RECORDING MODE IS F                                          00740001
007500     RECORD CONTAINS 550 CHARACTERS                               00750001
007600     DATA RECORD IS STORE-EXTRACT-EXTD-RECORD.                    00760001
007700                                                                  00770001
007800 01  STORE-EXTRACT-EXTD-RECORD       PIC X(550).                  00780001
007900*------------------------------------------------------*          00790001
008000 WORKING-STORAGE SECTION.                                         00800001
008100*------------------------------------------------------*          00810001
008200 01 PC-PROGRAM-CONSTANTS.                                         00820001
008300    05 PC-PROGRAM-NAME               PIC X(08) VALUE 'RCKUT101'.  00830001
008400    05 PC-DPKUT500                   PIC X(08) VALUE 'DPKUT500'.  00840001
008500    05  PC-DPT                       PIC X(03)     VALUE 'DPT'.   00850001
008600    05  PC-DMA                       PIC X(03)     VALUE 'DMA'.   00860001
008700    05  PC-GMA                       PIC X(03)     VALUE 'GMA'.   00870001
008800    05  PC-BYR                       PIC X(03)     VALUE 'BYR'.   00880001
008900    05  PC-MCL                       PIC X(03)     VALUE 'MCL'.   00890001
009000    05  PC-SCL                       PIC X(03)     VALUE 'SCL'.   00900001
009100    05  PC-OPERCO-CDE                PIC X(02)     VALUE '03'.    00910001
009200    05  PC-NOT-FOUND                 PIC X(15)     VALUE          00920001
009300                                            '** NOT FOUND **'.    00930001
009400    05  PC-DPT-NBR                   PIC X(03)     VALUE SPACE.   00940001
009500    05  PC-SCL-NBR                   PIC X(03)     VALUE SPACE.   00950001
009600    05  PC-SCL-NBR-SHIFT.                                         00960001
009700        10  PC-SCL-NBR-1            PIC X(01)     VALUE '0'.      00970001
009800        10  PC-SCL-NBR-2-3          PIC X(02)     VALUE SPACE.    00980001
009900    05  PC-SCL-NBR-READ              PIC X(03)     VALUE SPACE.   00990001
010000 01 PV-PROGRAM-VARIABLES.                                         01000001
010100    05 PV-ABEND-CODE                 PIC 9(04)     VALUE 0.       01010001
010200    05 PV-ABEND-PARA-NAME            PIC X(30)     VALUE SPACE.   01020001
010300    05 PV-DB2-OPERATION-MSG-1        PIC X(40)     VALUE SPACE.   01030001
010400    05 PV-DB2-TABLE-NAME             PIC X(12)     VALUE SPACE.   01040001
010500    05 PV-SQLCODE                    PIC Z(8)9-.                  01050001
010600    05 PV-PARAGRAPH-NAME             PIC X(30)     VALUE SPACE.   01060001
010700    05 PV-MCL-DESC-SAVE              PIC X(25)     VALUE SPACE.   01070001
010800    05 PV-MCL-NBR-SAVE               PIC X(02)     VALUE SPACE.   01080001
010900    05 PV-SCL-DESC-SAVE              PIC X(25)     VALUE SPACE.   01090001
011000    05 PV-DPT-NAME-SAVE              PIC X(25)     VALUE SPACE.   01100001
011100    05 PV-GMM-SAVE                   PIC X(02)     VALUE SPACE.   01110001
011200    05 PV-GMM-NAME-SAVE              PIC X(30)     VALUE SPACE.   01120001
011300    05 PV-DMM-SAVE                   PIC X(02)     VALUE SPACE.   01130001
011400    05 PV-DMM-NAME-SAVE              PIC X(30)     VALUE SPACE.   01140001
011500    05 PV-BYR-SAVE                   PIC X(03)     VALUE SPACE.   01150001
011600    05 PV-BYR-NAME-SAVE              PIC X(30)     VALUE SPACE.   01160001
011610    05 PV-NUM-DISPLAY                PIC ZZZ,ZZZ,ZZ9              01161003
011620                                                   VALUE ZEROS.   01162002
011700    05 PV-FIRST-NAME.                                             01170001
011800       10 PV-FIRST-NAME-BYTE  OCCURS 12 TIMES INDEXED BY INX1     01180001
011900                                     PIC X(01).                   01190001
012000    05 PV-LAST-NAME.                                              01200001
012100       10 PV-LAST-NAME-BYTE   OCCURS 18 TIMES INDEXED BY INX2     01210001
012200                                     PIC X(01).                   01220001
012300    05 PV-NAME.                                                   01230001
012400       10 PV-NAME-BYTE        OCCURS 30 TIMES INDEXED BY INX3     01240001
012500                                     PIC X(01).                   01250001
012600    05 PV-PO-NBR                     PIC S9(09) COMP  VALUE +0.   01260001
012700    05 PV-REC-SEQ-NBR                PIC S9(09) COMP  VALUE +0.   01270001
012800    05 PV-PRCS-HOUR-DIFFERENCE       PIC S9(09)V COMP VALUE +0.   01280001
012900    05 PV-PRCS-DAY-DIFFERENCE        PIC S9(09)V COMP VALUE +0.   01290001
013000    05 PV-PRCS-DAYS                  PIC 9(03)V9      VALUE 0.    01300001
013100                                                                  01310001
013200     05  PV-ISO-DTE                      PIC X(10).               01320001
013300     05  PV-ISO-DTEX  REDEFINES          PV-ISO-DTE.              01330001
013400         10  PV-ISO-CC                   PIC 9(02).               01340001
013500         10  PV-ISO-YY                   PIC X(02).               01350001
013600         10  PV-ISO-SL1                  PIC X(01).               01360001
013700         10  PV-ISO-MM                   PIC X(02).               01370001
013800         10  PV-ISO-SL2                  PIC X(01).               01380001
013900         10  PV-ISO-DD                   PIC X(02).               01390001
014000                                                                  01400001
014100     05  PV-PROCESS-DATE                 PIC X(10).               01410001
014200     05  PV-PROCESS-DATEX REDEFINES      PV-PROCESS-DATE.         01420001
014300         10  PV-PROC-CC                  PIC 9(02).               01430001
014400         10  PV-PROC-YY                  PIC 9(02).               01440001
014500         10  FILLER                      PIC X(01).               01450001
014600         10  PV-PROC-MM                  PIC 9(02).               01460001
014700         10  FILLER                      PIC X(01).               01470001
014800         10  PV-PROC-DD                  PIC 9(02).               01480001
014900                                                                  01490001
015000     05  PV-DEF-RCPT-DAYS-BACKOFF        PIC 9(02)  VALUE 0.      01500001
015100                                                                  01510001
015200     05  PV-DEF-CUTOFF-DTE-ISO.                                   01520001
015300         10  PV-DEF-CUTOFF-MM            PIC 9(02).               01530001
015400         10  PV-DEF-CUTOFF-DD            PIC 9(02).               01540001
015500         10  PV-DEF-CUTOFF-CC            PIC 9(02).               01550001
015600         10  PV-DEF-CUTOFF-YY            PIC 9(02).               01560001
015700     05  PV-CUT-CCYYMMDD                 PIC 9(08).               01570001
015800     05  PV-CUT-CCYYMMDD-X   REDEFINES  PV-CUT-CCYYMMDD.          01580001
015900         10  PV-CUT-CCYYMMDD-CC          PIC 9(02).               01590001
016000         10  PV-CUT-CCYYMMDD-YY          PIC 9(02).               01600001
016100         10  PV-CUT-CCYYMMDD-MM          PIC 9(02).               01610001
016200         10  PV-CUT-CCYYMMDD-DD          PIC 9(02).               01620001
016300                                                                  01630001
016400     05  PV-WORK-CCYYMMDD                PIC 9(08).               01640001
016500     05  PV-WORK-CCYYMMDD-X  REDEFINES  PV-WORK-CCYYMMDD.         01650001
016600         10  PV-WORK-CCYYMMDD-CC         PIC 9(02).               01660001
016700         10  PV-WORK-CCYYMMDD-YY         PIC 9(02).               01670001
016800         10  PV-WORK-CCYYMMDD-MM         PIC 9(02).               01680001
016900         10  PV-WORK-CCYYMMDD-DD         PIC 9(02).               01690001
017000                                                                  01700001
017100     05  PV-LAST-CCYYMMDD                PIC 9(08).               01710001
017200     05  PV-LAST-CCYYMMDD-X  REDEFINES  PV-LAST-CCYYMMDD.         01720001
017300         10  PV-LAST-CCYYMMDD-CC         PIC 9(02).               01730001
017400         10  PV-LAST-CCYYMMDD-YY         PIC 9(02).               01740001
017500         10  PV-LAST-CCYYMMDD-MM         PIC 9(02).               01750001
017600         10  PV-LAST-CCYYMMDD-DD         PIC 9(02).               01760001
017700                                                                  01770001
017800 01  CD-CNTL-DEF-RCPTS-CARD.                                      01780001
017900     05  CD-DEFER-RCPT-NBR-DAYS          PIC 9(02).               01790001
018000     05  FILLER                          PIC X(78).               01800001
018100                                                                  01810001
018200***************************************************************** 01820001
018300*  CONTROL CARD TO INPUT THE PROCESS DATE                         01830001
018400***************************************************************** 01840001
018500 01  CC-PROCESS-DATE-RECORD.                                      01850001
018600     05  CC-PROCESS-DATE.                                         01860001
018700         10  CC-PROCESS-MM               PIC 9(02).               01870001
018800         10  CC-PROCESS-DD               PIC 9(02).               01880001
018900         10  CC-PROCESS-YY               PIC 9(02).               01890001
019000     05  FILLER                          PIC X.                   01900001
019100     05  CC-CALENDAR-TYPE                PIC X(02).               01910001
019200     05  FILLER                          PIC X(71).               01920001
019300                                                                  01930001
019400 01  CPU-DATE.                                                    01940001
019500     05  CPU-YEAR                    PIC X(02)     VALUE SPACES.  01950001
019600     05  CPU-MONTH                   PIC X(02)     VALUE SPACES.  01960001
019700     05  CPU-DAY                     PIC X(02)     VALUE SPACES.  01970001
019800                                                                  01980001
019900 01  CPU-TIME.                                                    01990001
020000     05  CPU-HOUR                    PIC X(02)     VALUE SPACES.  02000001
020100     05  CPU-MINUTE                  PIC X(02)     VALUE SPACES.  02010001
020200     05  FILLER                      PIC X(02)     VALUE SPACES.  02020001
020300                                                                  02030001
020400 01 PS-PROGRAM-SWITCHES.                                          02040001
020500    05 PS-END-OF-TABLE-SW            PIC X(01)     VALUE SPACE.   02050001
020600       88 PS-EOT                     VALUE 'Y'.                   02060001
020700    05 PS-FIRST-READ-SW              PIC X(01)     VALUE 'F'.     02070001
020800       88 PS-FIRST-READ              VALUE 'F'.                   02080001
020900       88 PS-NOT-FIRST-READ          VALUE ' '.                   02090001
021000    05 PS-END-OF-FILE-SW             PIC X(01)     VALUE SPACE.   02100001
021100       88 PS-EOF                     VALUE 'Y'.                   02110001
021200       88 PS-NOT-EOF                 VALUE 'N'.                   02120001
021300    05 PS-DPT-FOUND-SW               PIC X(01)     VALUE SPACE.   02130001
021400       88 PS-DPT-FOUND               VALUE 'Y'.                   02140001
021500       88 PS-DPT-NOT-FOUND           VALUE 'N'.                   02150001
021600    05 PS-SCL-FOUND-SW               PIC X(01)     VALUE SPACE.   02160001
021700       88 PS-SCL-FOUND               VALUE 'Y'.                   02170001
021800       88 PS-SCL-NOT-FOUND           VALUE 'N'.                   02180001
021900    05 PS-MCL-FOUND-SW               PIC X(01)     VALUE SPACE.   02190001
022000       88 PS-MCL-FOUND               VALUE 'Y'.                   02200001
022100       88 PS-MCL-NOT-FOUND           VALUE 'N'.                   02210001
022200    05 PS-EOF-CNTL-DEF-FILE-SW       PIC X(01)     VALUE SPACE.   02220001
022300       88 PS-NOT-EOF-CNTL-DEF-FILE   VALUE 'N'.                   02230001
022400       88 PS-EOF-CNTL-DEF-FILE       VALUE 'Y'.                   02240001
022500    05 PS-DEPT-CHANGE-SW             PIC X(01)     VALUE SPACE.   02250001
022600       88 PS-NOT-DEPT-CHANGE         VALUE 'N'.                   02260001
022700       88 PS-DEPT-CHANGE             VALUE 'Y'.                   02270001
022800    05  PS-DATE-ERROR-SW             PIC X(01)   VALUE 'N'.       02280001
022900       88  PS-NO-DATE-ERROR                      VALUE 'N'.       02290001
023000       88  PS-DATE-ERROR                         VALUE 'Y'.       02300001
023100                                                                  02310001
023200 01 WS-HOLD-FIELDS.                                               02320001
023300    05  WS-HOLD-HEADER-RECORD        PIC X(300).                  02330001
023400                                                                  02340001
023500 01 WS-CACL-FIELDS.                                               02350001
023600    05  WS-RECORDS-READ-QTY          PIC S9(9)     COMP-3         02360002
023700                                                   VALUE ZEROS.   02370001
023800    05  WS-RECORDS-WRITE-QTY         PIC S9(9)     COMP-3         02380002
023900                                                   VALUE ZEROS.   02390001
024000                                                                  02400001
024100 01  WS-RUN-TYPE-RECORD.                                          02410001
024200     05  WS-RUN-TYPE             PIC X      VALUE ' '.            02420001
024300         88  WEEKLY-RUN          VALUE 'W'.                       02430001
024400         88  MONTHLY-RUN         VALUE 'M'.                       02440001
024500     05  WS-DEFER-ALL-NONE       PIC X      VALUE ' '.            02450001
024600         88  DEFER-ALL           VALUE 'A'.                       02460001
024700         88  DEFER-NONE          VALUE 'N'.                       02470001
024800     05  FILLER                  PIC X(78).                       02480001
024900                                                                  02490001
025000     COPY STOREEXT.                                               02500001
025100     COPY RCRD043.                                                02510001
025200     COPY DPWS500.                                                02520001
025300                                                                  02530001
025400*** DB2 MESSAGE AREAS ****                                        02540001
025500     COPY DPWS004.                                                02550001
025600*                                                                 02560001
025700     EXEC SQL                                                     02570001
025800          INCLUDE SQLCA                                           02580001
025900     END-EXEC.                                                    02590001
026000                                                                  02600001
026100     EXEC SQL                                                     02610001
026200          INCLUDE TMDSEAR                                         02620001
026300     END-EXEC.                                                    02630001
026400                                                                  02640001
026500     EXEC SQL                                                     02650001
026600          INCLUDE TRSPBAR                                         02660001
026700     END-EXEC.                                                    02670001
026800                                                                  02680001
026900     EXEC SQL                                                     02690001
027000          INCLUDE TRECEIV                                         02700001
027100     END-EXEC.                                                    02710001
027200                                                                  02720001
027300********************************************************          02730001
027400 PROCEDURE DIVISION.                                              02740001
027500********************************************************          02750001
027600 0000-MAIN.                                                       02760001
027700     PERFORM 1000-INITIALIZATION         THRU 1000-EXIT.          02770001
027800                                                                  02780001
027900     PERFORM 2000-PROCESS-INPUT-FILE     THRU 2000-EXIT           02790001
028000                            UNTIL PS-EOF.                         02800001
028100                                                                  02810001
028200     CLOSE STORE-EXTRACT-IN                                       02820001
028300           PROCESS-DATE-FILE                                      02830001
028400           CC-DEFERRED-PARM-FILE                                  02840001
028500           CC-RUN-TYPE                                            02850001
028600           STORE-EXTRACT-EXTD-OUT.                                02860001
028700                                                                  02870001
028710     MOVE WS-RECORDS-READ-QTY TO PV-NUM-DISPLAY.                  02871002
028800     DISPLAY 'NUMBER OF RECORDS READ IS:     '                    02880001
028900         PV-NUM-DISPLAY.                                          02890002
028901                                                                  02890102
028910     MOVE WS-RECORDS-WRITE-QTY TO PV-NUM-DISPLAY.                 02891002
029000     DISPLAY 'NUMBER OF RECORDS WRITTEN IS:  '                    02900001
029100         PV-NUM-DISPLAY.                                          02910002
029200     STOP RUN.                                                    02920001
029300 0000-EXIT. EXIT.                                                 02930001
029400                                                                  02940001
029500 1000-INITIALIZATION.                                             02950001
029600      OPEN INPUT  STORE-EXTRACT-IN                                02960001
029700                  PROCESS-DATE-FILE                               02970001
029800                  CC-DEFERRED-PARM-FILE                           02980001
029900                  CC-RUN-TYPE                                     02990001
030000           OUTPUT STORE-EXTRACT-EXTD-OUT.                         03000001
030100                                                                  03010001
030200      INITIALIZE RC043-EXP-STORE-EXTRACT-RECORD.                  03020001
030300                                                                  03030001
030400      PERFORM 1100-PROCESS-CNTL-DATE THRU 1100-EXIT.              03040001
030500      PERFORM 1200-PROCESS-CNTL-DEFERRED THRU 1200-EXIT.          03050001
030600      PERFORM 1220-GET-DEFERRED-RCPTS-DATE THRU 1220-EXIT.        03060001
030700      PERFORM 1300-READ-CONTROL-FILE THRU 1300-EXIT.              03070001
030800                                                                  03080001
030900 1000-EXIT.  EXIT.                                                03090001
031000                                                                  03100001
031100***************************************************************   03110001
031200*  1100-PROCESS-CNTL-DATE.  READ/VALIDATE THE CONTROL CARD    *   03120001
031300*       THAT CONTAINS THE CONTROL DATE                        *   03130001
031400***************************************************************   03140001
031500 1100-PROCESS-CNTL-DATE.                                          03150001
031600     MOVE '1100-PROCESS-CNTL-DATE' TO PV-PARAGRAPH-NAME.          03160001
031700                                                                  03170001
031800     READ PROCESS-DATE-FILE INTO CC-PROCESS-DATE-RECORD           03180001
031900         AT END                                                   03190001
032000             DISPLAY '** PROGRAM ABEND **'                        03200001
032100             DISPLAY 'RCKUT101  - CONTROL DATE EMPTY'             03210001
032200             DISPLAY 'PARAGRAPH: ' PV-PARAGRAPH-NAME              03220001
032300             MOVE +4003              TO PV-ABEND-CODE             03230001
032400             PERFORM 9998-SQL-ABEND THRU 9998-EXIT.               03240001
032500                                                                  03250001
032600     DISPLAY '**************************************************' 03260001
032700     DISPLAY '** RCKUT101 CONTROL CARD: ' CC-PROCESS-DATE-RECORD  03270001
032800     DISPLAY '**          PROCESS DATE: ' CC-PROCESS-DATE         03280001
032900     DISPLAY '**         CALENDAR TYPE: ' CC-CALENDAR-TYPE.       03290001
033000     DISPLAY '**************************************************' 03300001
033100                                                                  03310001
033200     IF CC-PROCESS-YY > 95                                        03320001
033300        MOVE 19               TO PV-ISO-CC                        03330001
033400     ELSE                                                         03340001
033500        MOVE 20               TO PV-ISO-CC                        03350001
033600     END-IF.                                                      03360001
033700     MOVE CC-PROCESS-MM       TO PV-ISO-MM.                       03370001
033800     MOVE CC-PROCESS-DD       TO PV-ISO-DD.                       03380001
033900     MOVE CC-PROCESS-YY       TO PV-ISO-YY.                       03390001
034000     MOVE '-'                 TO PV-ISO-SL1                       03400001
034100                                 PV-ISO-SL2.                      03410001
034200                                                                  03420001
034300     PERFORM 9220-SPECIAL-DATE-CALL THRU 9220-EXIT.               03430001
034400                                                                  03440001
034500     IF  PS-DATE-ERROR                                            03450001
034600         DISPLAY '** PROGRAM ABEND **'                            03460001
034700         DISPLAY 'RCKUT101  - INVALID CONTROL DATE CARD: '        03470001
034800             CC-PROCESS-DATE-RECORD                               03480001
034900         DISPLAY 'PARAGRAPH: ' PV-PARAGRAPH-NAME                  03490001
035000         MOVE +4003              TO PV-ABEND-CODE                 03500001
035100         PERFORM 9998-SQL-ABEND THRU 9998-EXIT                    03510001
035200     END-IF.                                                      03520001
035300                                                                  03530001
035400     MOVE DPG55-DB2-ISO-DATE-FMT   TO PV-PROCESS-DATE.            03540001
035500     MOVE PV-PROC-CC               TO PV-LAST-CCYYMMDD-CC.        03550001
035600     MOVE PV-PROC-YY               TO PV-LAST-CCYYMMDD-YY.        03560001
035700     MOVE PV-PROC-MM               TO PV-LAST-CCYYMMDD-MM.        03570001
035800     MOVE PV-PROC-DD               TO PV-LAST-CCYYMMDD-DD.        03580001
035900 1100-EXIT.  EXIT.                                                03590001
036000                                                                  03600001
036100***************************************************************   03610001
036200*  1200-PROCESS-CNTL-DEFERRED  READ/VALIDATE THE CONTROL CARD *   03620001
036300*       THAT CONTAINS THE DEFERRED CONTROL DATA               *   03630001
036400***************************************************************   03640001
036500 1200-PROCESS-CNTL-DEFERRED.                                      03650001
036600     MOVE '1200-PROCESS-CNTL-DEFERRED' TO PV-PARAGRAPH-NAME       03660001
036700                                                                  03670001
036800     READ CC-DEFERRED-PARM-FILE INTO CD-CNTL-DEF-RCPTS-CARD       03680001
036900         AT END                                                   03690001
037000             DISPLAY '** PROGRAM ABEND **'                        03700001
037100             DISPLAY 'RCKUT101  - CONTROL DEFERRED RCPTS EMPTY'   03710001
037200             DISPLAY 'PARAGRAPH: ' PV-PARAGRAPH-NAME              03720001
037300             MOVE +4003              TO PV-ABEND-CODE             03730001
037400             PERFORM 9998-SQL-ABEND THRU 9998-EXIT                03740001
037500     END-READ.                                                    03750001
037600                                                                  03760001
037700     DISPLAY '**************************************************' 03770001
037800     DISPLAY '** RCKUT101 CONTROL DEFERRED: '                     03780001
037900                    CD-CNTL-DEF-RCPTS-CARD.                       03790001
038000     DISPLAY '**   DEFERRED NUMBER OF DAYS: '                     03800001
038100                    CD-DEFER-RCPT-NBR-DAYS.                       03810001
038200                                                                  03820001
038300*    SUBTRACT 1 FROM THE NUMBER OF DEFERRED DAYS SO THE DATE      03830001
038400*    ROUTINE WILL SELECT A DATE THAT WILL INCLUDE THE LAST DAY    03840001
038500*    OF THE MONTH                                                 03850001
038600     EVALUATE CD-DEFER-RCPT-NBR-DAYS                              03860001
038700         WHEN 00 THRU 99                                          03870001
038800              DISPLAY CD-DEFER-RCPT-NBR-DAYS                      03880001
038900                '    = #DAYS TO DEFER RCPTS BEFORE (& INCLUDING)' 03890001
039000                ' THE LAST DAY OF THE MONTH'                      03900001
039100              MOVE CD-DEFER-RCPT-NBR-DAYS TO                      03910001
039200                       PV-DEF-RCPT-DAYS-BACKOFF                   03920001
039300         WHEN OTHER                                               03930001
039400              DISPLAY '** ABEND **'                               03940001
039500              DISPLAY '** PROGRAM RCKUT101 **'                    03950001
039600              DISPLAY '** PARAGRAPH ' PV-PARAGRAPH-NAME           03960001
039700              DISPLAY 'NON-NUMERIC #DAYS TO DEFER RECPTS'         03970001
039800              MOVE +4003 TO PV-ABEND-CODE                         03980001
039900              PERFORM 9998-SQL-ABEND THRU 9998-EXIT               03990001
040000     END-EVALUATE.                                                04000001
040100                                                                  04010001
040200*    IF THE DEFERRED RECPTS DAYS IS 0, IT ESSENTIALLY MEANS THAT  04020001
040300*    NOTHING WILL BE DEFERRED                                     04030001
040400     IF  CD-DEFER-RCPT-NBR-DAYS = 00                              04040001
040500         DISPLAY '**  FORCE NO DEFERRED RECEIPTS  **'             04050001
040600     END-IF.                                                      04060001
040700 1200-EXIT.  EXIT.                                                04070001
040800                                                                  04080001
040900****************************************************************  04090001
041000* 1220-GET-DEFERRED-RCPTS-DATE                                 *  04100001
041100* USING THE LAST DAY OF THE FISCAL MONTH (FROM THE PREVIOUS    *  04110001
041200* CALL TO THE CALENDAR ROUTINE) PULL BACK THE NUMBER OF DAYS   *  04120001
041300* RETRIEVED FROM THE CONTROL CARD.  THIS WILL BE THE REPORT    *  04130001
041400* CUTOFF DATE.                                                 *  04140001
041500****************************************************************  04150001
041600 1220-GET-DEFERRED-RCPTS-DATE.                                    04160001
041700     MOVE CC-CALENDAR-TYPE      TO DPG51-CALENDAR-TYPE.           04170001
041800                                                                  04180001
041900***  USE LAST DAY OF FISCAL MONTH OUTPUT AS INPUT TO CUTOFF DATE. 04190001
042000     MOVE DPG56-LAST-FP-DB2-ISO-FMT TO DPG52-LK-DATE-INPUT.       04200001
042100     DISPLAY '**  LAST DAY OF FISCAL MONTH: '                     04210001
042200             DPG56-LAST-FP-DB2-ISO-FMT.                           04220001
042300     SET  DPG52-LK-DTE-ISO-FMT         TO TRUE.                   04230001
042400     SET  DPG51-DECREMENT-DATE         TO TRUE.                   04240001
042500     MOVE PV-DEF-RCPT-DAYS-BACKOFF                                04250001
042600                                TO DPG51-INCR-DECR-DAYS-9.        04260001
042700                                                                  04270001
042800     CALL PC-DPKUT500                                             04280001
042900         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               04290001
043000                                                                  04300001
043100     IF (DPG54-DATE-INVALID OR                                    04310001
043200         DPG54-SEVERE-ERROR)                                      04320001
043300         DISPLAY '** PROGRAM ABEND **'                            04330001
043400         DISPLAY 'RCKUT101  - INVALID DEFERRED DATE CALC'         04340001
043500         DISPLAY 'PARAGRAPH: ' PV-PARAGRAPH-NAME                  04350001
043600         MOVE +4003          TO PV-ABEND-CODE                     04360001
043700         PERFORM 9998-SQL-ABEND THRU 9998-EXIT                    04370001
043800     ELSE                                                         04380001
043900         MOVE DPG55-GREG-CC-DATE TO PV-DEF-CUTOFF-DTE-ISO         04390001
044000         MOVE PV-DEF-CUTOFF-MM   TO PV-CUT-CCYYMMDD-MM            04400001
044100         MOVE PV-DEF-CUTOFF-DD   TO PV-CUT-CCYYMMDD-DD            04410001
044200         MOVE PV-DEF-CUTOFF-CC   TO PV-CUT-CCYYMMDD-CC            04420001
044300         MOVE PV-DEF-CUTOFF-YY   TO PV-CUT-CCYYMMDD-YY            04430001
044400     END-IF.                                                      04440001
044500                                                                  04450001
044600     DISPLAY '**      CUTOFF DATE MMDDCCYY: '                     04460001
044700             PV-DEF-CUTOFF-DTE-ISO.                               04470001
044800 1220-EXIT.  EXIT.                                                04480001
044900*                                                                 04490001
045000 1300-READ-CONTROL-FILE.                                          04500001
045100     MOVE '1300-READ-CONTROL-FILE'     TO PV-PARAGRAPH-NAME.      04510001
045200                                                                  04520001
045300     READ CC-RUN-TYPE           INTO WS-RUN-TYPE-RECORD           04530001
045400         AT END                                                   04540001
045500             DISPLAY 'RCKUT101  - CONTROL FILE EMPTY'             04550001
045600     END-READ.                                                    04560001
045700 1300-EXIT. EXIT.                                                 04570001
045800                                                                  04580001
045900 2000-PROCESS-INPUT-FILE.                                         04590001
046000      READ STORE-EXTRACT-IN      INTO                             04600001
046100                             STORE-EXTRACT-LINE                   04610001
046200         AT END                                                   04620001
046300            SET PS-EOF TO TRUE                                    04630001
046400         NOT AT END                                               04640001
046500           ADD  +1                    TO WS-RECORDS-READ-QTY      04650001
046600           PERFORM 2100-UPDATE-INPUT-FILE THRU 2100-EXIT          04660001
046700      END-READ.                                                   04670001
046800 2000-EXIT. EXIT.                                                 04680001
046900                                                                  04690001
047000 2100-UPDATE-INPUT-FILE.                                          04700001
047100      MOVE STORE-EXTRACT-LINE TO RC043-EXP-STORE-EXTRACT-RECORD.  04710001
047200                                                                  04720001
047300      IF RC043-RECEIVING-LOCATION = 'DS' OR DEFER-NONE            04730001
047400          MOVE SPACES              TO RC043-DEFERRED              04740001
047500      ELSE                                                        04750001
047600          MOVE RC043-DV-MM         TO PV-WORK-CCYYMMDD-MM         04760001
047700          MOVE RC043-DV-DD         TO PV-WORK-CCYYMMDD-DD         04770001
047800          MOVE RC043-DV-YY         TO PV-WORK-CCYYMMDD-YY         04780001
047900          IF RC043-DV-YY > 80                                     04790001
048000              MOVE 19              TO PV-WORK-CCYYMMDD-CC         04800001
048100          ELSE                                                    04810001
048200              MOVE 20              TO PV-WORK-CCYYMMDD-CC         04820001
048300          END-IF                                                  04830001
048400          IF  PV-WORK-CCYYMMDD > PV-CUT-CCYYMMDD                  04840001
048500              MOVE 'DEF'           TO RC043-DEFERRED              04850001
048600          ELSE                                                    04860001
048700              MOVE SPACES          TO RC043-DEFERRED              04870001
048800          END-IF                                                  04880001
048900      END-IF.                                                     04890001
049000                                                                  04900001
049100      SET PS-NOT-DEPT-CHANGE              TO TRUE.                04910001
049200                                                                  04920001
049300      IF RC043-DEPT     IS NOT = PC-DPT-NBR                       04930001
049310         SET PS-DEPT-CHANGE               TO TRUE                 04931001
049400         MOVE RC043-DEPT                  TO PC-DPT-NBR           04940001
049500         PERFORM 2110-GET-TMDSEAR-ROW     THRU 2110-EXIT          04950001
049600         EVALUATE TRUE                                            04960001
049700             WHEN PS-DPT-FOUND                                    04970001
049800                MOVE MDSEAR-GMA-NBR  TO RC043-GMM-NBR             04980001
049900                                        PV-GMM-SAVE               04990001
050000                MOVE MDSEAR-DMA-NBR  TO RC043-DMM-NBR             05000001
050100                                        PV-DMM-SAVE               05010001
050200                MOVE MDSEAR-BYR-NBR  TO RC043-BYR-NBR             05020001
050300                                        PV-BYR-SAVE               05030001
050400                MOVE MDSEAR-DESC     TO RC043-DEPT-NAME           05040001
050500                                        PV-DPT-NAME-SAVE          05050001
050600                PERFORM 2140-GET-GMM-NAME                         05060001
050700                                         THRU 2140-EXIT           05070001
050800                PERFORM 2150-GET-DMM-NAME                         05080001
050900                                         THRU 2150-EXIT           05090001
051000                PERFORM 2160-GET-BYR-NAME                         05100001
051100                                         THRU 2160-EXIT           05110001
051200             WHEN PS-DPT-NOT-FOUND                                05120001
051300                MOVE ZEROS           TO RC043-GMM-NBR             05130001
051400                                        PV-GMM-SAVE               05140001
051500                MOVE PC-NOT-FOUND    TO RC043-GMM-NAME            05150001
051600                                        PV-GMM-NAME-SAVE          05160001
051700                MOVE ZEROS           TO RC043-DMM-NBR             05170001
051800                                        PV-DMM-SAVE               05180001
051900                MOVE PC-NOT-FOUND    TO RC043-DMM-NAME            05190001
052000                                        PV-DMM-NAME-SAVE          05200001
052100                MOVE ZEROS           TO RC043-BYR-NBR             05210001
052200                                        PV-BYR-SAVE               05220001
052300                MOVE PC-NOT-FOUND    TO RC043-BYR-NAME            05230001
052400                                        PV-BYR-NAME-SAVE          05240001
052500                MOVE PC-NOT-FOUND    TO RC043-DEPT                05250001
052600                                        PV-DPT-NAME-SAVE          05260001
052700           END-EVALUATE                                           05270001
052800      ELSE                                                        05280001
052900         MOVE PV-GMM-SAVE          TO   RC043-GMM-NBR             05290001
053000         MOVE PV-DMM-SAVE          TO   RC043-DMM-NBR             05300001
053100         MOVE PV-BYR-SAVE          TO   RC043-BYR-NBR             05310001
053200         MOVE PV-DPT-NAME-SAVE     TO   RC043-DEPT-NAME           05320001
053300         MOVE PV-GMM-NAME-SAVE     TO   RC043-GMM-NAME            05330001
053400         MOVE PV-DMM-NAME-SAVE     TO   RC043-DMM-NAME            05340001
053500         MOVE PV-BYR-NAME-SAVE     TO   RC043-BYR-NAME            05350001
053600      END-IF.                                                     05360001
053700                                                                  05370001
053800      IF RC043-CLASS    IS NOT = PC-SCL-NBR                       05380001
053810      OR PS-DEPT-CHANGE                                           05381001
053900         MOVE RC043-CLASS               TO PC-SCL-NBR             05390001
054000         MOVE RC043-CLASS               TO PC-SCL-NBR-2-3         05400001
054100         MOVE '0'                       TO PC-SCL-NBR-1           05410001
054200         MOVE PC-SCL-NBR-SHIFT          TO PC-SCL-NBR-READ        05420001
054300         PERFORM 2170-GET-TMDSEAR-ROW-SCL-DESC THRU 2170-EXIT     05430001
054400         EVALUATE TRUE                                            05440001
054500             WHEN PS-SCL-FOUND                                    05450001
054600                MOVE MDSEAR-MAJ-CL-NBR  TO RC043-MAJ-CL-NBR       05460001
054700                                           PV-MCL-NBR-SAVE        05470001
054800                MOVE MDSEAR-DESC        TO RC043-SUB-CL-DESC      05480001
054900                                           PV-SCL-DESC-SAVE       05490001
055000             WHEN PS-SCL-NOT-FOUND                                05500001
055100                MOVE ZEROS              TO RC043-MAJ-CL-NBR       05510001
055200                                           PV-MCL-NBR-SAVE        05520001
055300                MOVE PC-NOT-FOUND       TO RC043-SUB-CL-DESC      05530001
055400                                           PV-SCL-DESC-SAVE       05540001
055500           END-EVALUATE                                           05550001
055600         PERFORM 2180-GET-TMDSEAR-ROW-MCL-DESC THRU 2180-EXIT     05560001
055700         EVALUATE TRUE                                            05570001
055800             WHEN PS-MCL-FOUND                                    05580001
055900                MOVE MDSEAR-DESC     TO RC043-MAJ-CL-DESC         05590001
056000                                        PV-MCL-DESC-SAVE          05600001
056100             WHEN PS-MCL-NOT-FOUND                                05610001
056200                MOVE PC-NOT-FOUND    TO RC043-MAJ-CL-DESC         05620001
056300                                        PV-MCL-DESC-SAVE          05630001
056400           END-EVALUATE                                           05640001
056500      ELSE                                                        05650001
056600         MOVE PV-MCL-NBR-SAVE      TO   RC043-MAJ-CL-NBR          05660001
056700         MOVE PV-MCL-DESC-SAVE     TO   RC043-MAJ-CL-DESC         05670001
056800         MOVE PV-SCL-DESC-SAVE     TO   RC043-SUB-CL-DESC         05680001
056900      END-IF.                                                     05690001
057000                                                                  05700001
057100***** IF RC043-SKU-SEQ = '999'                                    05710001
057200*****     GO TO 2100-EXIT.                                        05720001
057300                                                                  05730001
057400       IF RC043-PO = PV-PO-NBR                                    05740001
057500       AND RC043-REC-SEQ-NBR = PV-REC-SEQ-NBR                     05750001
057600          MOVE PV-PRCS-DAYS       TO RC043-PRCS-DAYS              05760001
057700       ELSE                                                       05770001
057800           MOVE RC043-PO          TO PV-PO-NBR                    05780001
057900           MOVE RC043-REC-SEQ-NBR TO PV-REC-SEQ-NBR               05790001
058000           PERFORM 3000-GET-TRECEIV-INFO THRU 3000-EXIT           05800001
058100       END-IF.                                                    05810001
058200                                                                  05820001
058300      WRITE STORE-EXTRACT-EXTD-RECORD   FROM                      05830001
058400                       RC043-EXP-STORE-EXTRACT-RECORD.            05840001
058500      ADD  +1                    TO WS-RECORDS-WRITE-QTY.         05850001
058600                                                                  05860001
058700 2100-EXIT.  EXIT.                                                05870001
058800                                                                  05880001
058900 2110-GET-TMDSEAR-ROW.                                            05890001
059000      EXEC SQL                                                    05900001
059100                SELECT                                            05910001
059200                      GMA_NBR                                     05920001
059300                     ,DMA_NBR                                     05930001
059400                     ,BYR_NBR                                     05940001
059500                     ,DEPT_NBR                                    05950001
059600                     ,MDSEAR_DESC                                 05960001
059700                 INTO  :MDSEAR-GMA-NBR                            05970001
059800                      ,:MDSEAR-DMA-NBR                            05980001
059900                      ,:MDSEAR-BYR-NBR                            05990001
060000                      ,:MDSEAR-DEPT-NBR                           06000001
060100                      ,:MDSEAR-DESC                               06010001
060200                FROM TMDSEAR                                      06020001
060300                WHERE   DEPT_NBR    = :PC-DPT-NBR                 06030001
060400                   AND  OPERCO_NBR  = :PC-OPERCO-CDE              06040001
060500                   AND  MDSELV_CDE  = :PC-DPT                     06050001
060600                   AND  CURRENT DATE BETWEEN                      06060001
060700                         STRT_DTE AND END_DTE                     06070001
060800       END-EXEC.                                                  06080001
060900                                                                  06090001
061000       EVALUATE TRUE                                              06100001
061100            WHEN SQLCODE = ZERO                                   06110001
061200                SET PS-DPT-FOUND             TO TRUE              06120001
061300            WHEN SQLCODE = +100                                   06130001
061400                SET  PS-DPT-NOT-FOUND        TO TRUE              06140001
061500            WHEN OTHER                                            06150001
061600               MOVE '2110-GET-TMDSEAR-ROW  ' TO PV-ABEND-PARA-NAME06160001
061700                MOVE 'SELECT TMDSEAR ROW'                         06170001
061800                                         TO PV-DB2-OPERATION-MSG-106180001
061900                MOVE 'TMDSEAR'           TO PV-DB2-TABLE-NAME     06190001
062000                PERFORM 9998-SQL-ABEND   THRU 9998-EXIT           06200001
062100        END-EVALUATE.                                             06210001
062200                                                                  06220001
062300 2110-EXIT.  EXIT.                                                06230001
062400                                                                  06240001
062500 2140-GET-GMM-NAME.                                               06250001
062600      EXEC SQL                                                    06260001
062700           SELECT B.WORKER_FIR_NAME                               06270001
062800                , B.WORKER_LAST_NAME                              06280001
062900             INTO :RSPBAR-WORKER-FIR-NAME                         06290001
063000                , :RSPBAR-WORKER-LAST-NAME                        06300001
063100             FROM TMDSEAR A                                       06310001
063200                 ,TRSPBAR B                                       06320001
063300            WHERE A.OPERCO_NBR       = '03'                       06330001
063400              AND A.MDSELV_CDE       = 'GMA'                      06340001
063500              AND A.GMA_NBR          = :RC043-GMM-NBR             06350001
063600              AND CURRENT DATE BETWEEN                            06360001
063700                  A.STRT_DTE AND A.END_DTE                        06370001
063800              AND A.MDSEAR_DKEY      = B.MDSEAR_DKEY              06380001
063900              AND B.RSPLVL_CDE       = 'GMM'                      06390001
064000              AND CURRENT DATE BETWEEN                            06400001
064100                    WORKER_STRT_DTE AND WORKER_END_DTE            06410001
064200      END-EXEC.                                                   06420001
064300       EVALUATE TRUE                                              06430001
064400            WHEN SQLCODE = ZERO                                   06440001
064500                PERFORM 8888-STRING-RSPBAR-NAME THRU 8888-EXIT    06450001
064600                MOVE PV-NAME            TO RC043-GMM-NAME         06460001
064700                                           PV-GMM-NAME-SAVE       06470001
064800            WHEN SQLCODE = +100                                   06480001
064900                MOVE SPACE              TO RC043-GMM-NAME         06490001
065000                                           PV-GMM-NAME-SAVE       06500001
065100            WHEN OTHER                                            06510001
065200               MOVE '2140-GET-GMM-NAME'                           06520001
065300                                         TO PV-ABEND-PARA-NAME    06530001
065400                MOVE 'SELECT TRSPBAR ROW'                         06540001
065500                                         TO PV-DB2-OPERATION-MSG-106550001
065600                MOVE 'TRSPBAR'           TO PV-DB2-TABLE-NAME     06560001
065700                PERFORM 9998-SQL-ABEND   THRU 9998-EXIT           06570001
065800        END-EVALUATE.                                             06580001
065900 2140-EXIT.   EXIT.                                               06590001
066000                                                                  06600001
066100 2150-GET-DMM-NAME.                                               06610001
066200      EXEC SQL                                                    06620001
066300           SELECT B.WORKER_FIR_NAME                               06630001
066400                , B.WORKER_LAST_NAME                              06640001
066500             INTO :RSPBAR-WORKER-FIR-NAME                         06650001
066600                , :RSPBAR-WORKER-LAST-NAME                        06660001
066700             FROM TMDSEAR A                                       06670001
066800                 ,TRSPBAR B                                       06680001
066900            WHERE A.OPERCO_NBR       = '03'                       06690001
067000              AND A.MDSELV_CDE       = 'DMA'                      06700001
067100              AND A.DMA_NBR          = :RC043-DMM-NBR             06710001
067200              AND CURRENT DATE BETWEEN                            06720001
067300                  A.STRT_DTE AND A.END_DTE                        06730001
067400              AND A.MDSEAR_DKEY      = B.MDSEAR_DKEY              06740001
067500              AND B.RSPLVL_CDE       = 'DMM'                      06750001
067600              AND CURRENT DATE BETWEEN                            06760001
067700                    WORKER_STRT_DTE AND WORKER_END_DTE            06770001
067800      END-EXEC.                                                   06780001
067900      EVALUATE TRUE                                               06790001
068000            WHEN SQLCODE = ZERO                                   06800001
068100                PERFORM 8888-STRING-RSPBAR-NAME THRU 8888-EXIT    06810001
068200                MOVE PV-NAME            TO RC043-DMM-NAME         06820001
068300                                           PV-DMM-NAME-SAVE       06830001
068400            WHEN SQLCODE = +100                                   06840001
068500                MOVE SPACE              TO RC043-DMM-NAME         06850001
068600                                           PV-DMM-NAME-SAVE       06860001
068700            WHEN OTHER                                            06870001
068800               MOVE '2150-GET-DMM-NAME'                           06880001
068900                                         TO PV-ABEND-PARA-NAME    06890001
069000                MOVE 'SELECT TRSPBAR ROW'                         06900001
069100                                         TO PV-DB2-OPERATION-MSG-106910001
069200                MOVE 'TRSPBAR'           TO PV-DB2-TABLE-NAME     06920001
069300                PERFORM 9998-SQL-ABEND   THRU 9998-EXIT           06930001
069400       END-EVALUATE.                                              06940001
069500 2150-EXIT.   EXIT.                                               06950001
069600                                                                  06960001
069700 2160-GET-BYR-NAME.                                               06970001
069800      EXEC SQL                                                    06980001
069900           SELECT B.WORKER_FIR_NAME                               06990001
070000                , B.WORKER_LAST_NAME                              07000001
070100             INTO :RSPBAR-WORKER-FIR-NAME                         07010001
070200                , :RSPBAR-WORKER-LAST-NAME                        07020001
070300             FROM TMDSEAR A                                       07030001
070400                 ,TRSPBAR B                                       07040001
070500            WHERE A.OPERCO_NBR       = '03'                       07050001
070600              AND A.MDSELV_CDE       = 'DPT'                      07060001
070700              AND A.BYR_NBR          = :RC043-BYR-NBR             07070001
070800              AND CURRENT DATE BETWEEN                            07080001
070900                  A.STRT_DTE AND A.END_DTE                        07090001
071000              AND A.MDSEAR_DKEY      = B.MDSEAR_DKEY              07100001
071100              AND B.RSPLVL_CDE       = 'BYR'                      07110001
071200              AND CURRENT DATE BETWEEN                            07120001
071300                    WORKER_STRT_DTE AND WORKER_END_DTE            07130001
071400      END-EXEC.                                                   07140001
071500      EVALUATE TRUE                                               07150001
071600           WHEN SQLCODE = ZERO OR -811                            07160001
071700               PERFORM 8888-STRING-RSPBAR-NAME THRU 8888-EXIT     07170001
071800               MOVE PV-NAME            TO RC043-BYR-NAME          07180001
071900                                          PV-BYR-NAME-SAVE        07190001
072000           WHEN SQLCODE = +100                                    07200001
072100               MOVE SPACE              TO RC043-BYR-NAME          07210001
072200                                          PV-BYR-NAME-SAVE        07220001
072300           WHEN OTHER                                             07230001
072400              MOVE '2160-GET-BYR-NAME'                            07240001
072500                                        TO PV-ABEND-PARA-NAME     07250001
072600               MOVE 'SELECT TRSPBAR ROW'                          07260001
072700                                        TO PV-DB2-OPERATION-MSG-1 07270001
072800               MOVE 'TRSPBAR'           TO PV-DB2-TABLE-NAME      07280001
072900               PERFORM 9998-SQL-ABEND   THRU 9998-EXIT            07290001
073000       END-EVALUATE.                                              07300001
073100 2160-EXIT.   EXIT.                                               07310001
073200                                                                  07320001
073300 2170-GET-TMDSEAR-ROW-SCL-DESC.                                   07330001
073400      EXEC SQL                                                    07340001
073500                SELECT                                            07350001
073600                      MAJ_CL_NBR                                  07360001
073700                     ,MDSEAR_DESC                                 07370001
073800                 INTO  :MDSEAR-MAJ-CL-NBR                         07380001
073900                      ,:MDSEAR-DESC                               07390001
074000                FROM TMDSEAR                                      07400001
074100                WHERE   DEPT_NBR    = :PC-DPT-NBR                 07410001
074200                   AND  OPERCO_NBR  = :PC-OPERCO-CDE              07420001
074300                   AND  GMA_NBR     = :RC043-GMM-NBR              07430001
074400                   AND  DMA_NBR     = :RC043-DMM-NBR              07440001
074500                   AND  MDSELV_CDE  = :PC-SCL                     07450001
074600                   AND  SUB_CL_NBR  = :PC-SCL-NBR-READ            07460001
074700                   AND  CURRENT DATE BETWEEN                      07470001
074800                         STRT_DTE AND END_DTE                     07480001
074900       END-EXEC.                                                  07490001
075000*      DISPLAY 'DEPT = ' PC-DPT-NBR   '     '                     07500001
075100*              'OPERCO = ' PC-OPERCO-CDE '     '                  07510001
075200*              'GMM = ' RC043-GMM-NBR '     '                     07520001
075300*              'DMM = ' RC043-DMM-NBR '     '                     07530001
075400*              'SELVCD = ' PC-SCL '     '                         07540001
075500*              'SUB CL = ' PC-SCL-NBR-READ.                       07550001
075600                                                                  07560001
075700       EVALUATE TRUE                                              07570001
075800            WHEN SQLCODE = ZERO                                   07580001
075900                SET PS-SCL-FOUND             TO TRUE              07590001
076000            WHEN SQLCODE = +100                                   07600001
076100                SET  PS-SCL-NOT-FOUND        TO TRUE              07610001
076200            WHEN OTHER                                            07620001
076300               MOVE '2170-GET-TMDSEAR-ROW  ' TO PV-ABEND-PARA-NAME07630001
076400                MOVE 'SELECT TMDSEAR ROW'                         07640001
076500                                         TO PV-DB2-OPERATION-MSG-107650001
076600                MOVE 'TMDSEAR'           TO PV-DB2-TABLE-NAME     07660001
076700                PERFORM 9998-SQL-ABEND   THRU 9998-EXIT           07670001
076800        END-EVALUATE.                                             07680001
076900 2170-EXIT.  EXIT.                                                07690001
077000                                                                  07700001
077100 2180-GET-TMDSEAR-ROW-MCL-DESC.                                   07710001
077200      EXEC SQL                                                    07720001
077300                SELECT                                            07730001
077400                      MDSEAR_DESC                                 07740001
077500                 INTO  :MDSEAR-DESC                               07750001
077600                FROM TMDSEAR                                      07760001
077700                WHERE   DEPT_NBR    = :PC-DPT-NBR                 07770001
077800                   AND  OPERCO_NBR  = :PC-OPERCO-CDE              07780001
077900                   AND  GMA_NBR     = :RC043-GMM-NBR              07790001
078000                   AND  DMA_NBR     = :RC043-DMM-NBR              07800001
078100                   AND  MDSELV_CDE  = :PC-MCL                     07810001
078200                   AND  MAJ_CL_NBR  = :PV-MCL-NBR-SAVE            07820001
078300                   AND  CURRENT DATE BETWEEN                      07830001
078400                         STRT_DTE AND END_DTE                     07840001
078500       END-EXEC.                                                  07850001
078600                                                                  07860001
078700       EVALUATE TRUE                                              07870001
078800            WHEN SQLCODE = ZERO                                   07880001
078900                SET PS-MCL-FOUND             TO TRUE              07890001
079000            WHEN SQLCODE = +100                                   07900001
079100                SET  PS-MCL-NOT-FOUND        TO TRUE              07910001
079200            WHEN OTHER                                            07920001
079300               MOVE '2180-GET-TMDSEAR-ROW  ' TO PV-ABEND-PARA-NAME07930001
079400                MOVE 'SELECT TMDSEAR ROW'                         07940001
079500                                         TO PV-DB2-OPERATION-MSG-107950001
079600                MOVE 'TMDSEAR'           TO PV-DB2-TABLE-NAME     07960001
079700                PERFORM 9998-SQL-ABEND   THRU 9998-EXIT           07970001
079800        END-EVALUATE.                                             07980001
079900 2180-EXIT.  EXIT.                                                07990001
080000                                                                  08000001
080100 3000-GET-TRECEIV-INFO.                                           08010001
080200     EXEC SQL                                                     08020001
080300         SELECT HOUR(VERFYD_TMST - REC_TMST)                      08030001
080400              , DAY(VERFYD_TMST -  REC_TMST)                      08040001
080500          INTO :PV-PRCS-HOUR-DIFFERENCE                           08050001
080600              ,:PV-PRCS-DAY-DIFFERENCE                            08060001
080700         FROM TRECEIV                                             08070001
080800         WHERE ORD_NBR          = :PV-PO-NBR                      08080001
080900           AND REC_SEQ_NBR      = :PV-REC-SEQ-NBR                 08090001
081000           AND VER_STATUS_CDE   = 'A'                             08100001
081100     END-EXEC.                                                    08110001
081200                                                                  08120001
081300     EVALUATE TRUE                                                08130001
081400         WHEN SQLCODE = ZEROS                                     08140001
081500                                                                  08150001
081600          COMPUTE RC043-PRCS-DAYS =                               08160001
081700              (PV-PRCS-DAY-DIFFERENCE +                           08170001
081800              (PV-PRCS-HOUR-DIFFERENCE / 24))                     08180001
081900              MOVE RC043-PRCS-DAYS TO PV-PRCS-DAYS                08190001
082000         WHEN OTHER                                               08200001
082100             DISPLAY '** PROGRAM = RCKUT101 **'                   08210001
082200             DISPLAY '** PARAGRAPH = 3000-GET-TRECEIV-INFO **'    08220001
082300             DISPLAY '**     PROBLEM GETTING PROCESS DATE    **'  08230001
082400             DISPLAY '** KEY -- PO: ' PV-PO-NBR                   08240001
082500                     ' REC SEQ: '     PV-REC-SEQ-NBR              08250001
082600             MOVE ZEROS          TO RC043-PRCS-DAYS               08260001
082700             MOVE ZEROS          TO PV-PRCS-DAYS                  08270001
082800     END-EVALUATE.                                                08280001
082900 3000-EXIT.   EXIT.                                               08290001
083000                                                                  08300001
083100 8888-STRING-RSPBAR-NAME.                                         08310001
083200     MOVE RSPBAR-WORKER-FIR-NAME  TO PV-FIRST-NAME                08320001
083300     MOVE RSPBAR-WORKER-LAST-NAME TO PV-LAST-NAME                 08330001
083400                                                                  08340001
083500     INITIALIZE PV-NAME.                                          08350001
083600     SET INX3 TO 1.                                               08360001
083700                                                                  08370001
083800     PERFORM VARYING INX1 FROM 1 BY 1                             08380001
083900                 UNTIL INX1 > 12                                  08390001
084000           IF  PV-FIRST-NAME-BYTE (INX1) = SPACE                  08400001
084100               SET INX3 UP BY 1                                   08410001
084200               SET INX1   TO 12                                   08420001
084300           ELSE                                                   08430001
084400               MOVE PV-FIRST-NAME-BYTE (INX1)  TO                 08440001
084500                    PV-NAME-BYTE (INX3)                           08450001
084600               SET INX3 UP BY 1                                   08460001
084700           END-IF                                                 08470001
084800     END-PERFORM.                                                 08480001
084900                                                                  08490001
085000      PERFORM VARYING INX2 FROM 1 BY 1                            08500001
085100                  UNTIL INX2 > 18                                 08510001
085200            IF  PV-LAST-NAME-BYTE (INX2) = SPACE                  08520001
085300                SET INX2   TO 18                                  08530001
085400            ELSE                                                  08540001
085500                MOVE PV-LAST-NAME-BYTE (INX2)  TO                 08550001
085600                     PV-NAME-BYTE (INX3)                          08560001
085700                SET INX3 UP BY 1                                  08570001
085800            END-IF                                                08580001
085900      END-PERFORM.                                                08590001
086000 8888-EXIT.   EXIT.                                               08600001
086100                                                                  08610001
086200******************************************************************08620001
086300* 9220-SPECIAL-DATE-CALL.                                         08630001
086400*    CALL THE CALENDAR ROUTINE TO VERIFY THE INPUT DATE,  AND TO  08640001
086500*    GET THE FISCAL MONTH END DATE USED TO CALCULATE THE CUTOFF   08650001
086600*    DATE.                                                        08660001
086700******************************************************************08670001
086800                                                                  08680001
086900 9220-SPECIAL-DATE-CALL.                                          08690001
087000                                                                  08700001
087100     INITIALIZE DPG51                                             08710001
087200                DPG52                                             08720001
087300                DPG53                                             08730001
087400                DPG54                                             08740001
087500                DPG55                                             08750001
087600                DPG56                                             08760001
087700                                                                  08770001
087800*    SET DPG51-DO-NOT-INCR-DECR-DATE                              08780001
087900*                               TO TRUE                           08790001
088000                                                                  08800001
088100     MOVE PV-ISO-DTE            TO DPG52-LK-DATE-INPUT            08810001
088200                                                                  08820001
088300     MOVE CC-CALENDAR-TYPE      TO DPG51-CALENDAR-TYPE            08830001
088400     SET  DPG52-LK-DTE-ISO-FMT  TO TRUE                           08840001
088500     SET  DPG51-DECREMENT-DATE  TO TRUE.                          08850001
088600     MOVE 5                     TO DPG51-INCR-DECR-DAYS-9.        08860001
088700                                                                  08870001
088800     CALL PC-DPKUT500                                             08880001
088900         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56                08890001
089000                                                                  08900001
089100     IF (DPG54-DATE-INVALID OR                                    08910001
089200         DPG54-SEVERE-ERROR)                                      08920001
089300         SET PS-DATE-ERROR  TO TRUE                               08930001
089400         DISPLAY 'DPKUT500 ERROR = ' DPG54-ERROR-MESSAGE          08940001
089500     END-IF.                                                      08950001
089600 9220-EXIT.   EXIT.                                               08960001
089700                                                                  08970001
089800 9998-SQL-ABEND.                                                  08980001
089900     MOVE SQLCODE     TO PV-SQLCODE.                              08990001
090000     DISPLAY '** ABEND           ** = SQLABEND'.                  09000001
090100     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          09010001
090200     DISPLAY '** PARAGRAPH       ** = ' PV-ABEND-PARA-NAME.       09020001
090300     DISPLAY '** TABLE AFFECTED  ** = ' PV-DB2-TABLE-NAME.        09030001
090400     DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.   09040001
090500     DISPLAY '** SQLCODE         ** = ' PV-SQLCODE.               09050001
090600     COPY DPPD004.                                                09060001
090700     MOVE +4013                  TO PV-ABEND-CODE.                09070001
090800     CALL 'ILBOABN0'   USING PV-ABEND-CODE.                       09080001
090900 9998-EXIT.  EXIT.                                                09090001
091000                                                                  09100001
