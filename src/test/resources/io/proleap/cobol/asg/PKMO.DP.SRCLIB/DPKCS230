000001 PROCESS QUOTE XOPTS(QUOTE NOLINKAGE)                             00000119
000002 Identification Division.                                         00000219
000003 Program-id. DPKCS230.                                            00000319
000004*===============================================================* 00000419
000005*                                                               * 00000519
000006* MODULE NAME = DPKCS230                                        * 00000619
000007*                                                               * 00000719
000008* DESCRIPTIVE NAME = CICS/ESA WEB INTERFACE ANALYZER USER       * 00000819
000009*                     REPLACEABLE PROGRAM                       * 00000919
000010*                                                               * 00001019
000011*               @BANNER_START@                                  * 00001119
000012*               Licensed Materials - Property of IBM            * 00001219
000013*                                                               * 00001319
000014*               "Restricted Materials of IBM"                   * 00001419
000015*                                                               * 00001519
000016*               5655-018                                        * 00001619
000017*                                                               * 00001719
000018*               (C) Copyright IBM Corp. 1996,                   * 00001819
000019*                                                               * 00001919
000020*               CICS for MVS/ESA 4.1.0                          * 00002019
000021*               (Previously known as CICS/ESA)                  * 00002119
000022*               @BANNER_END@                                    * 00002219
000023*    +#--#+                                                     * 00002319
000024*                                                               * 00002419
000025* STATUS = %.B.2                                                * 00002519
000026*                                                               * 00002619
000027* FUNCTION = ANALYZES THE INCOMING HTTP REQUEST TO EXTRACT THE  * 00002719
000028*            REQUIRED CICS INFORMATION.                         * 00002819
000029*                                                               * 00002919
000030* VERSIONS OF THIS PROGRAM IN OTHER LANGUAGES ARE ALSO PROVIDED:* 00003019
000031*     ASSEMBLER - DFHWBADX                                      * 00003119
000032*     C         - DFHWBAHX                                      * 00003219
000033*     PL/I      - DFHWBALX                                      * 00003319
000034*                                                               * 00003419
000035* NOTES :                                                       * 00003519
000036*                                                               * 00003619
000037*    THIS IS A PRODUCT SENSITIVE SAMPLE.                        * 00003719
000038*    REFER TO PRODUCT DOCUMENTATION.                            * 00003819
000039*                                                               * 00003919
000040*    DEPENDENCIES = S/390                                       * 00004019
000041*    MODULE TYPE = EXECUTABLE                                   * 00004119
000042*    PROCESSOR = COBOL2 COMPILER                                * 00004219
000043*    ATTRIBUTES = READ ONLY, SERIALLY REUSABLE                  * 00004319
000044*                                                               * 00004419
000045*---------------------------------------------------------------* 00004519
000046*                                                               * 00004619
000047*     PURPOSE = ALL FUNCTIONS                                   * 00004719
000048*                                                               * 00004819
000049*     LINKAGE =                                                 * 00004919
000050*     THIS ENTRY POINT IS CALLED BY THE WBI SERVER CONTROLLER   * 00005019
000051*     PROGRAM DFHWBM VIA EXEC CICS LINK.                        * 00005119
000052*     THE PARAMETERS ARE PASSED TO THE EXIT PROGRAM VIA THE     * 00005219
000053*     COMMAREA. THE CONTROL BLOCK FOR THE PARAMETER LIST IS IN  * 00005319
000054*     DFHWBTDO.                                                 * 00005419
000055*                                                               * 00005519
000056*     INPUT =                                                   * 00005619
000057*                                                               * 00005719
000058*     OUTPUT =                                                  * 00005819
000059*                                                               * 00005919
000060*     EXIT-NORMAL = EXIT IS VIA AN EXEC CICS RETURN COMMAND.    * 00006019
000061*         THE FOLLOWING RETURN CODES MAY BE RETURNED VIA THE    * 00006119
000062*         COMMAREA:                                             * 00006219
000063*                                                               * 00006319
000064*     EXIT-ERROR =                                              * 00006419
000065*                                                               * 00006519
000066*---------------------------------------------------------------* 00006619
000067*                                                               * 00006719
000068* EXTERNAL REFERENCES =                                         * 00006819
000069*         NONE.                                                 * 00006919
000070*                                                               * 00007019
000071*     ROUTINES =                                                * 00007119
000072*         EXEC CICS RETURN - RETURN TO THE CALLING PROGRAM.     * 00007219
000073*                                                               * 00007319
000074*     CONTROL BLOCKS =                                          * 00007419
000075*        THE WBI ANALYZER PARAMETER LIST IS DEFINED IN DFHWBTDO,* 00007519
000076*        ALONG WITH A DESCRIPTION OF THE PARAMETERS.            * 00007619
000077*                                                               * 00007719
000078*---------------------------------------------------------------* 00007819
000079*                                                               * 00007919
000080* DESCRIPTION                                                   * 00008019
000081*                                                               * 00008119
000082*    THIS PROGRAM IS A SAMPLE VERSION IN COBOL2 OF THE DEFAULT  * 00008219
000083*    WBI ANALYZER. THE PROGRAM IS INVOKED WHEN AN HTTP REQUEST  * 00008319
000084*    IS RECEIVED AND WBI ANALYZER EXIT NAME HAS BEEN SET TO     * 00008419
000085*    DPKCS230. THIS NAME CAN BE CHANGED BY USE OF THE CWBC      * 00008519
000086*    TRANSACTION.                                               * 00008619
000087*                                                               * 00008719
000088*    A PARAMETER LIST IS PROVIDED AS INPUT TO THE PROGRAM. THE  * 00008819
000089*    PARAMETER LIST IS PASSED TO THE PROGRAM VIA THE COMMAREA.  * 00008919
000090*    THE PARAMETER LIST IS DEFINED IN DFHWBTDC.                 * 00009019
000091*    THE PARAMETER LIST IS ADDRESSED BY THE PROGRAM USING THE   * 00009119
000092*    NORMAL CONVENTIONS FOR A COMMAREA.                         * 00009219
000093*                                                               * 00009319
000094*---------------------------------------------------------------* 00009419
000095*                                                               * 00009519
000096* CHANGE ACTIVITY :                                             * 00009619
000097**                                                              * 00009719
000098*        $MOD(DPKCS230) COMP(ISC) PROD(CICS/ESA):               * 00009819
000099*                                                               * 00009919
000100*     PN= REASON REL YYMMDD HDXXIII : REMARKS                   * 00010019
000101*    $L0= 723    %B2 960724 HD0JADT : FIRST CODED               * 00010119
000102*                                                               * 00010219
000103*    Added SEKCS300 references            MBO  10/2/98          * 00010300
000104*    ADDED HRKCS300 REFERENCES            MBO  07/07/2002       * 00010419
000105*                                                               * 00010500
000106*===============================================================* 00010600
000107 Environment Division.                                            00010700
000108 Data Division.                                                   00010800
000109 Working-storage section.                                         00010900
000110                                                                  00011000
000111*---------------------------------------------------------------* 00011100
000112* WBI SPECIFIC INCLUDES                                         * 00011200
000113*---------------------------------------------------------------* 00011300
000114                                                                  00011400
000115* WBI URP CONSTANTS                                               00011500
000116     COPY DFHWBUCO.                                               00011600
000117 01  WBST-COMMAREA.                                               00011700
000118    05  WBST-EYECATCHER     PIC X(4) value ">STA".                00011800
000119    05  WBST-FUNCTION-CODE  PIC X.                                00011900
000120    05  WBST-RETURN-CODE    PIC X.                                00012000
000121    05  FILLER              PIC XX.                               00012100
000122    05  WBST-TOKEN          PIC 9(9) COMP.                        00012200
000123    05  WBST-TOKEN-X4   REDEFINES WBST-TOKEN                      00012300
000124                            PIC X(4).                             00012400
000125    05  WBST-USER-AREA      PIC X(256).                           00012500
000126 01  WBST-TOKEN-DW          PIC 9(18) COMP.                       00012600
000127 01  FILLER         REDEFINES WBST-TOKEN-DW.                      00012700
000128    05  FILLER              PIC X(4).                             00012800
000129    05  WBST-TOKEN-FW       PIC X(4).                             00012900
000130 01  WBST-TOKEN9            PIC 9(10).                            00013000
000131 01  WBST-TOKENX REDEFINES WBST-TOKEN9                            00013100
000132                            PIC X(10).                            00013200
000133*---------------------------------------------------------------* 00013300
000134* DATA CONSTANTS                                                * 00013400
000135*---------------------------------------------------------------* 00013500
000136 01  CREATE                 PIC X VALUE "C".                      00013600
000137 01  RETRIEVE               PIC X VALUE "R".                      00013700
000138 01  STORE                  PIC X VALUE "S".                      00013800
000139 01  DESTROY                PIC X VALUE "D".                      00013900
000140 01  GOODRC                 PIC X VALUE X"00".                    00014000
000141 01  NAME230                PIC X(3) VALUE "230".                 00014100
000142 01  lower  pic x(26) value "abcdefghijklmnopqrstuvwxyz".         00014200
000143 01  filler redefines lower.                                      00014300
000144     03  lowerc pic x occurs 26 indexed by lowerc-idx.            00014400
000145 01  upper  pic x(26) value "ABCDEFGHIJKLMNOPQRSTUVWXYZ".         00014500
000146 01  filler redefines upper.                                      00014600
000147     03  upperc pic x occurs 26.                                  00014700
000148                                                                  00014800
000149* Constants for URP-REASON *                                      00014900
000150 01  WBADX-RESOURCE-TOO-SHORT    PIC S9(8) COMP VALUE 1.          00015000
000151 01  WBADX-FIRST-SLASH-MISSING   PIC S9(8) COMP VALUE 2.          00015100
000152 01  WBADX-SERVER-NAME-MISSING   PIC S9(8) COMP VALUE 3.          00015200
000153 01  WBADX-CONV-NAME-INVALID     PIC S9(8) COMP VALUE 4.          00015300
000154 01  WBADX-TRAN-NAME-INVALID     PIC S9(8) COMP VALUE 5.          00015400
000155 01  WBADX-SERV-NAME-INVALID     PIC S9(8) COMP VALUE 6.          00015500
000156 01  WBADX-USER-TOKEN-INVALID    PIC S9(8) COMP VALUE 7.          00015600
000157                                                                  00015700
000158* Constants for input validation                                  00015800
000159 01  WBADX-MIN-RESOURCE-LENGTH   PIC S9(8) COMP VALUE 6.          00015900
000160* MIN RESOURCE IS '/A/B/C'                                        00016000
000161 01  WBADX-MAX-CONV-NAME-LENGTH  PIC S9(8) COMP VALUE 8.          00016100
000162 01  WBADX-MAX-TRAN-NAME-LENGTH  PIC S9(8) COMP VALUE 4.          00016200
000163 01  WBADX-MAX-SERV-NAME-LENGTH  PIC S9(8) COMP VALUE 8.          00016300
000164 01  WBADX-MAX-UTOK-NAME-LENGTH  PIC S9(8) COMP VALUE 10.         00016400
000165                                                                  00016500
000166*---------------------------------------------------------------* 00016600
000167* Miscellaneous local declarations                              * 00016700
000168*---------------------------------------------------------------* 00016800
000169* Pointer to ANALYZER commarea                                    00016900
000170* Work length                                                     00017000
000171* RESOURCE pointer                                                00017100
000172* Length of RESOURCE left                                         00017200
000173 01  wbra-ptr POINTER.                                            00017300
000174 01  wl       PIC 9(8) COMP.                                      00017400
000175 01  rp       POINTER.                                            00017500
000176 01  rl       PIC 9(8) COMP.                                      00017600
000177 01  char-count PIC 99 COMP.                                      00017700
000178 01  user-token PIC X(10) value spaces.                           00017800
000179 01  filler redefines user-token.                                 00017900
000180    03  user-token-1 occurs 10 PIC X.                             00018000
000181                                                                  00018100
000182 Linkage section.                                                 00018200
000183     COPY DFHEIBLC.                                               00018300
000184                                                                  00018400
000185* ANALYZER PARAMETER LIST                                         00018500
000186     COPY DFHWBTDO.                                               00018600
000187 01  rpstruct.                                                    00018700
000188    03  rpchar    PIC X.                                          00018800
000189    03  rpplus1   PIC X.                                          00018900
000190 01  rp8string pic x(8).                                          00019000
000191                                                                  00019100
000192 Procedure Division USING DFHEIBLK DFHCOMMAREA.                   00019200
000193*===============================================================* 00019300
000194* Main code                                                     * 00019400
000195*===============================================================* 00019500
000196                                                                  00019600
000197* Just return if no commarea because nowhere to set rc            00019700
000198     if eibcalen = 0                                              00019800
000199         EXEC CICS RETURN END-EXEC.                               00019900
000200                                                                  00020000
000201* Addr of parms                                                   00020100
000202     EXEC CICS ADDRESS COMMAREA(wbra-ptr) END-EXEC.               00020200
000203     SET ADDRESS OF WBRA-PARMS TO wbra-ptr.                       00020300
000204     move 1 to WBRA-TYPE-HTTP.                                    00020400
000205*--------------------------------------------------------------*  00020500
000206*  Validate the eyecatcher.                                    *  00020600
000207*--------------------------------------------------------------*  00020700
000208     if wbra-eyecatcher not = analyze-eyecatcher-init             00020800
000209         move URP-INVALID to wbra-response                        00020900
000210         move 0 to wbra-reason                                    00021000
000211         EXEC CICS RETURN END-EXEC.                               00021100
000212                                                                  00021200
000213*==============================================================*  00021300
000214*    User specific code below                                  *  00021400
000215*==============================================================*  00021500
000216                                                                  00021600
000217*--------------------------------------------------------------*  00021700
000218*  WBI DEFAULT ANALYZER LOGIC                                  *  00021800
000219*--------------------------------------------------------------*  00021900
000220*---------------------------------------------------------------* 00022000
000221* Set the name to be used for codepage translation of the user  * 00022100
000222* data to 'DFHWBUD'.                                            * 00022200
000223*---------------------------------------------------------------* 00022300
000224     move cnv-user-data-key to wbra-dfhcnv-key.                   00022400
000225                                                                  00022500
000226*---------------------------------------------------------------* 00022600
000227* This default analyzer extracts the required CICS info by      * 00022700
000228* assuming the following structure for the resource section     * 00022800
000229* of the HTTP request:-                                         * 00022900
000230*                                                               * 00023000
000231*        /CONVNAME/TRANID/PROGNAME</FILENAME><?TOKEN>           * 00023100
000232*                                                               * 00023200
000233*  where                                                        * 00023300
000234*    CONVNAME = The name of the converter program. Using the    * 00023400
000235*               string 'CICS' here will be taken as signifying  * 00023500
000236*               that no converter is required.                  * 00023600
000237*    TRANID   = The transaction id to be used for the alias.    * 00023700
000238*               'CWBA' must be specified to get the supplied    * 00023800
000239*               transaction.                                    * 00023900
000240*    PROGNAME = The name of the user program to be linked by    * 00024000
000241*               the alias.                                      * 00024100
000242*    FILENAME = An optional filename (or other information)     * 00024200
000243*               when PROGNAME is regarded as a directory.       * 00024300
000244*    TOKEN    = An optional 10char field to be passed in the    * 00024400
000245*               user-token field to the decode function of the  * 00024500
000246*               converter program.                              * 00024600
000247*---------------------------------------------------------------* 00024700
000248* RESOURCE address                                                00024800
000249* RESOURCE length                                                 00024900
000250     set rp to wbra-resource-ptr.                                 00025000
000251     set address of rpstruct to rp.                               00025100
000252     move wbra-resource-length to rl.                             00025200
000253                                                                  00025300
000254*---------------------------------------------------------------* 00025400
000255*  Validate resource length.                                    * 00025500
000256*---------------------------------------------------------------* 00025600
000257     if rl < WBADX-MIN-RESOURCE-LENGTH                            00025700
000258         move URP-EXCEPTION to wbra-response                      00025800
000259         move WBADX-RESOURCE-TOO-SHORT to wbra-reason             00025900
000260         EXEC CICS RETURN END-EXEC.                               00026000
000261                                                                  00026100
000262*---------------------------------------------------------------* 00026200
000263*  Ensure valid first character.                                * 00026300
000264*---------------------------------------------------------------* 00026400
000265     if rpchar not = "/"                                          00026500
000266         move URP-EXCEPTION to wbra-response                      00026600
000267         move WBADX-FIRST-SLASH-MISSING to wbra-reason            00026700
000268         EXEC CICS RETURN END-EXEC.                               00026800
000269                                                                  00026900
000270* Point at second character                                       00027000
000271* Decrement length left                                           00027100
000272     set rp to address of rpplus1.                                00027200
000273     set address of rpstruct to address of rpplus1.               00027300
000274     subtract 1 from rl.                                          00027400
000275                                                                  00027500
000276*---------------------------------------------------------------* 00027600
000277* Scan for converter name                                       * 00027700
000278*---------------------------------------------------------------* 00027800
000279* Start of converter name                                         00027900
000280* Look for next "/"                                               00028000
000281* Point at next character                                         00028100
000282* Decrement length left                                           00028200
000283                                                                  00028300
000284     move 0 to wl.                                                00028400
000285     perform test before until ( rpchar = "/" or rl = 0 )         00028500
000286         add 1 to wl                                              00028600
000287         subtract 1 from rl                                       00028700
000288         set address of rpstruct to address of rpplus1            00028800
000289     end-perform.                                                 00028900
000290                                                                  00029000
000291* "/" not found                                                   00029100
000292     if rpchar not = "/"                                          00029200
000293         move URP-EXCEPTION to wbra-response                      00029300
000294         move WBADX-SERVER-NAME-MISSING to wbra-reason            00029400
000295         EXEC CICS RETURN END-EXEC.                               00029500
000296                                                                  00029600
000297* Length of converter name                                        00029700
000298     if ( wl > WBADX-MAX-CONV-NAME-LENGTH or wl = 0 )             00029800
000299         move URP-EXCEPTION to wbra-response                      00029900
000300         move WBADX-CONV-NAME-INVALID to wbra-reason              00030000
000301         EXEC CICS RETURN END-EXEC.                               00030100
000302                                                                  00030200
000303*---------------------------------------------------------------* 00030300
000304* Copy the converter name to the output, converting to upper    * 00030400
000305* case in the process. If the null converter name CICS has been * 00030500
000306* specified then reset the output field to nulls.               * 00030600
000307*---------------------------------------------------------------* 00030700
000308     move "        " to wbra-converter-program.                   00030800
000309     set address of rp8string to rp.                              00030900
000310     unstring rp8string delimited by "/"                          00031000
000311         into wbra-converter-program.                             00031100
000312                                                                  00031200
000313     perform with test after varying char-count from 1 by +1      00031300
000314         until char-count = 26                                    00031400
000315         inspect wbra-converter-program replacing all             00031500
000316         lowerc(char-count) by upperc(char-count)                 00031600
000317     end-perform.                                                 00031700
000318                                                                  00031800
000319     if wbra-converter-program = "CICS    "                       00031900
000320       move low-values to wbra-converter-program.                 00032000
000321                                                                  00032100
000322*---------------------------------------------------------------* 00032200
000323* Scan for alias tranid                                         * 00032300
000324*---------------------------------------------------------------* 00032400
000325     set rp to address of rpplus1.                                00032500
000326     set address of rpstruct to address of rpplus1.               00032600
000327* Point at first char of tranid                                   00032700
000328* Decrement length left                                           00032800
000329* Error if no more                                                00032900
000330     subtract 1 from rl.                                          00033000
000331     if rl < 1                                                    00033100
000332         move URP-EXCEPTION to wbra-response                      00033200
000333         move WBADX-SERVER-NAME-MISSING to wbra-reason            00033300
000334         EXEC CICS RETURN END-EXEC.                               00033400
000335                                                                  00033500
000336* Start of tranid                                                 00033600
000337* Look for next "/"                                               00033700
000338* Point at next character                                         00033800
000339* Decrement length left                                           00033900
000340                                                                  00034000
000341     move 0 to wl.                                                00034100
000342     perform test before until ( rpchar = "/" or rl = 0 )         00034200
000343         add 1 to wl                                              00034300
000344         subtract 1 from rl                                       00034400
000345         set address of rpstruct to address of rpplus1            00034500
000346     end-perform.                                                 00034600
000347                                                                  00034700
000348* "/" not found                                                   00034800
000349     if rpchar not = "/"                                          00034900
000350         move URP-EXCEPTION to wbra-response                      00035000
000351         move WBADX-SERVER-NAME-MISSING to wbra-reason            00035100
000352         EXEC CICS RETURN END-EXEC.                               00035200
000353                                                                  00035300
000354* Length of tranid                                                00035400
000355     if ( wl > WBADX-MAX-TRAN-NAME-LENGTH or wl = 0 )             00035500
000356         move URP-EXCEPTION to wbra-response                      00035600
000357         move WBADX-TRAN-NAME-INVALID to wbra-reason              00035700
000358         EXEC CICS RETURN END-EXEC.                               00035800
000359                                                                  00035900
000360*---------------------------------------------------------------* 00036000
000361* Copy the name to the output, converting to upper case in the  * 00036100
000362* process.                                                      * 00036200
000363*---------------------------------------------------------------* 00036300
000364     move "    " to wbra-alias-tranid.                            00036400
000365     set address of rp8string to rp.                              00036500
000366     unstring rp8string delimited by "/"                          00036600
000367         into wbra-alias-tranid.                                  00036700
000368                                                                  00036800
000369     perform with test after varying char-count from 1 by +1      00036900
000370         until char-count = 26                                    00037000
000371         inspect wbra-alias-tranid replacing all                  00037100
000372         lowerc(char-count) by upperc(char-count)                 00037200
000373     end-perform.                                                 00037300
000374                                                                  00037400
000375*---------------------------------------------------------------* 00037500
000376* Scan for server program name                                  * 00037600
000377*---------------------------------------------------------------* 00037700
000378* Point at first char of name                                     00037800
000379* Decrement length left                                           00037900
000380* Error if no more                                                00038000
000381     set rp to address of rpplus1.                                00038100
000382     set address of rpstruct to address of rpplus1.               00038200
000383     subtract 1 from rl.                                          00038300
000384     if rl < 1                                                    00038400
000385         move URP-EXCEPTION to wbra-response                      00038500
000386         move WBADX-SERVER-NAME-MISSING to wbra-reason            00038600
000387         EXEC CICS RETURN END-EXEC.                               00038700
000388                                                                  00038800
000389* Start of server prog name                                       00038900
000390     move 0 to wl.                                                00039000
000391     perform test before until ( rpchar = "/" or rpchar = "?" or  00039100
000392         rl = 0 )                                                 00039200
000393         add 1 to wl                                              00039300
000394         subtract 1 from rl                                       00039400
000395         set address of rpstruct to address of rpplus1            00039500
000396     end-perform.                                                 00039600
000397* Terminated by "?" or length                                     00039700
000398                                                                  00039800
000399* Length of server prog name                                      00039900
000400     if ( wl > WBADX-MAX-SERV-NAME-LENGTH or wl = 0 )             00040000
000401         move URP-EXCEPTION to wbra-response                      00040100
000402         move WBADX-SERV-NAME-INVALID to wbra-reason              00040200
000403         EXEC CICS RETURN END-EXEC.                               00040300
000404                                                                  00040400
000405*---------------------------------------------------------------* 00040500
000406* Copy the name to the output, converting to upper case in the  * 00040600
000407* process.                                                      * 00040700
000408*---------------------------------------------------------------* 00040800
000409     move "        " to wbra-server-program.                      00040900
000410     set address of rp8string to rp.                              00041000
000411     unstring rp8string delimited by "/" or "?"                   00041100
000412         into wbra-server-program.                                00041200
000413                                                                  00041300
000414     perform with test after varying char-count from 1 by +1      00041400
000415         until char-count = 26                                    00041500
000416         inspect wbra-server-program replacing all                00041600
000417         lowerc(char-count) by upperc(char-count)                 00041700
000418     end-perform.                                                 00041800
000419                                                                  00041900
000420*---------------------------------------------------------------* 00042000
000421* If another "/" has been found, skip until end or "?".           00042100
000422*---------------------------------------------------------------* 00042200
000423     if rpchar = "/"                                              00042300
000424         perform test after until ( rpchar = "?" or rl = 0 )      00042400
000425             subtract 1 from rl                                   00042500
000426             set address of rpstruct to address of rpplus1        00042600
000427         end-perform.                                             00042700
000428                                                                  00042800
000429     IF WBRA-SERVER-PROGRAM = "SEKCS300" OR                       00042919
000430        WBRA-SERVER-PROGRAM = "HRKCS300"                          00043019
000431*---------------------------------------------------------------* 00043119
000432*  Password synchronization server program 300 detected         * 00043219
000433*  HR TRAINING LIBRARY      SERVER PROGRAM 300 DETECTED         * 00043319
000434*  No token required for this program, stateless server         * 00043419
000435*---------------------------------------------------------------* 00043519
000436         move low-values to wbra-converter-program                00043619
000437         move URP-OK to wbra-response                             00043719
000438         move 0 to wbra-reason                                    00043819
000439         EXEC CICS RETURN END-EXEC.                               00043919
000440                                                                  00044019
000441     if wbra-server-program = "SEKCS301"                          00044119
000442*---------------------------------------------------------------* 00044219
000443*  Password synchronization server program 301 detected         * 00044319
000444*  No token required for this program, stateless server         * 00044419
000445*---------------------------------------------------------------* 00044519
000446         move low-values to wbra-converter-program                00044619
000447         move URP-OK to wbra-response                             00044719
000448         move 0 to wbra-reason                                    00044819
000449         EXEC CICS RETURN END-EXEC.                               00044919
000450                                                                  00045019
000451     if rpchar not = "?" or rl < 2                                00045119
000452*---------------------------------------------------------------* 00045219
000453*  No state manager token   change to sign on prog              * 00045319
000454*---------------------------------------------------------------* 00045419
000455         move "DPKCS225" to wbra-server-program                   00045519
000456         move low-values to wbra-converter-program                00045619
000457         move URP-OK to wbra-response                             00045719
000458         move 0 to wbra-reason                                    00045819
000459         EXEC CICS RETURN END-EXEC.                               00045919
000460                                                                  00046019
000461*---------------------------------------------------------------* 00046119
000462* Copy user token without upper case translate if "?" and data  * 00046219
000463* present.                                                      * 00046319
000464*---------------------------------------------------------------* 00046419
000465* Point at first char of token                                    00046519
000466* Decrement length left                                           00046619
000467* All the rest is user token                                      00046719
000468     set address of rpstruct to address of rpplus1.               00046819
000469     subtract 1 from rl.                                          00046919
000470     move rl to wl.                                               00047019
000471     if wl > WBADX-MAX-UTOK-NAME-LENGTH                           00047119
000472         move URP-EXCEPTION to wbra-response                      00047219
000473         move WBADX-USER-TOKEN-INVALID to wbra-reason             00047319
000474         EXEC CICS RETURN END-EXEC.                               00047419
000475                                                                  00047519
000476     perform with test after varying char-count from 1 by +1      00047619
000477         until char-count = wl                                    00047719
000478         move rpchar to user-token-1(char-count)                  00047819
000479         set address of rpstruct to address of rpplus1            00047919
000480     end-perform.                                                 00048019
000481     move user-token to wbra-user-token, WBST-TOKENX.             00048119
000482                                                                  00048219
000483*===============================================================* 00048319
000484*    We have a token   check it out                             * 00048419
000485*===============================================================* 00048519
000486     move low-values to WBST-COMMAREA.                            00048619
000487*===============================================================* 00048719
000488*    Translate the display token to packed for use by DFH$WBSR  * 00048819
000489*===============================================================* 00048919
000490     MOVE ZEROS TO WBST-TOKEN-DW.                                 00049019
000491     COMPUTE WBST-TOKEN-DW = WBST-TOKEN9.                         00049119
000492     MOVE WBST-TOKEN-FW TO WBST-TOKEN-X4.                         00049219
000493     move ">STA" to WBST-EYECATCHER.                              00049319
000494     move RETRIEVE to WBST-FUNCTION-CODE.                         00049419
000495     exec cics link program("DFH$WBSR")                           00049519
000496                    commarea(WBST-COMMAREA)                       00049619
000497                    length(268)                                   00049719
000498     end-exec.                                                    00049819
000499     if WBST-RETURN-CODE = GOODRC                                 00049919
000500*===============================================================* 00050019
000501*    We have a token   and it is valid                          * 00050119
000502*===============================================================* 00050219
000503          move URP-OK to wbra-response                            00050319
000504          move 0 to wbra-reason                                   00050419
000505          EXEC CICS RETURN END-EXEC                               00050519
000506     else                                                         00050619
000507*===============================================================* 00050719
000508*    We have a token   and it is not valid  change to signon    * 00050819
000509*===============================================================* 00050919
000510          move "DPKCS225" to wbra-server-program                  00051019
000511          move low-values to wbra-converter-program               00051119
000512          move URP-OK to wbra-response                            00051219
000513          move 0 to wbra-reason                                   00051319
000514          EXEC CICS RETURN END-EXEC.                              00051419
000515                                                                  00051519
