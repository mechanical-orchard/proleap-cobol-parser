000100 TITLE 'MAINTAIN LEGACY TPOAGMT TABLE FROM RMS PO SYSTEM'.        00010025
000200 IDENTIFICATION DIVISION.                                         00020025
000300 PROGRAM-ID.    XLKUP007.                                         00030025
000400 AUTHOR.        DENNIS STEFFEN.                                   00040025
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050025
000600 DATE-WRITTEN.  MARCH 2003.                                       00060025
000700 DATE-COMPILED.                                                   00070025
000800******************************************************************00080025
000900* THIS PGM IS PART OF THE INTERFACING BETWEEN RMS PO & LEGACY PO. 00090025
001000* INSERTS, UPDATES OR DELETES ROWS ON THE LEGACY TPOAGMT TABLE.   00100025
001100******************************************************************00110025
001200 ENVIRONMENT DIVISION.                                            00120025
001300 CONFIGURATION SECTION.                                           00130025
001400 SOURCE-COMPUTER.  IBM-3090.                                      00140025
001500 OBJECT-COMPUTER.  IBM-3090.                                      00150025
001600 DATA DIVISION.                                                   00160025
001700                                                                  00170025
001800 WORKING-STORAGE SECTION.                                         00180025
001900                                                                  00190025
002000 01  PV-CRAPOLA.                                                  00200025
002100     05  PS-EXISTENCE-PO              PIC S9 COMP-3 VALUE ZERO.   00210025
002200         88  PS-PO-EXISTS-YES                       VALUE 1.      00220025
002300         88  PS-PO-EXISTS-NO                        VALUE ZERO.   00230025
002400     05  PS-POAGMT-EXIST-SW           PIC X(01)     VALUE 'N'.    00240025
002500         88  PS-POAGMT-EXISTS-NO                    VALUE 'N'.    00250025
002600         88  PS-POAGMT-EXISTS-YES                   VALUE 'Y'.    00260025
002700     05  PS-DUP-INSERT-SW             PIC X(01)     VALUE 'N'.    00270025
002800         88  PS-DUPLICATE-INSERT-YES                VALUE 'Y'.    00280025
002900         88  PS-DUPLICATE-INSERT-NO                 VALUE 'N'.    00290025
003000/                                                                 00300025
003100*    NUMERIC EDITING ROUTINE                                      00310025
003200     COPY DPWS010I.                                               00320025
003300/                                                                 00330025
003400*    PO AGREEMENTS                                                00340025
003500     EXEC SQL                                                     00350025
003600         INCLUDE TPOAGMT                                          00360025
003700     END-EXEC.                                                    00370025
003800                                                                  00380025
003900*    PO HEADERS                                                   00390025
004000     EXEC SQL                                                     00400025
004100         INCLUDE TPURCHS                                          00410025
004200     END-EXEC.                                                    00420025
004300                                                                  00430025
004400     EXEC SQL                                                     00440025
004500          INCLUDE SQLCA                                           00450025
004600     END-EXEC.                                                    00460025
004700                                                                  00470025
004800     COPY SQLCA2.                                                 00480025
004900                                                                  00490025
005000 LINKAGE SECTION.                                                 00500025
005100 01  XLRD011-RECORD.                                              00510025
005200     COPY XLRD011.                                                00520025
005300/                                                                 00530025
005400 PROCEDURE DIVISION USING XLRD011-RECORD.                         00540025
005500                                                                  00550025
005600     PERFORM 1000-INITIALIZATION.                                 00560025
005700                                                                  00570025
005800     PERFORM 2000-PROCESS-MESSAGE                                 00580025
005900                                                                  00590025
006000     PERFORM 9999-WRAPUP.                                         00600025
006100                                                                  00610025
006200     GOBACK.                                                      00620025
006300                                                                  00630025
006400 1000-INITIALIZATION.                                             00640025
006500                                                                  00650025
006600     IF XL011-DEBUG-YES                                           00660025
006700         DISPLAY 'XLKUP007 - 1000-INITIALIZATION'                 00670025
006800                 ' ORDER = ' XL011-ORDER-NBR                      00680025
006900     END-IF                                                       00690025
007000                                                                  00700025
007100     INITIALIZE XL011-RETURN-AREA                                 00710025
007200     MOVE 'XLKUP007'                  TO XL011-ERROR-PROGRAM.     00720025
007300                                                                  00730025
007400     IF XL011-MSG-ID = 'HDR_DELETE'                               00740025
007500             OR 'SPECIAL_INSTR_DELETE'                            00750025
007600             OR 'ORD_DISCOUNT_DELETE'                             00760025
007700             OR 'SPECIAL_INSTR_DELETE'                            00770025
007800         CONTINUE                                                 00780025
007900     ELSE                                                         00790025
008000         PERFORM 7000-SELECT-TPURCHS                              00800025
008100     END-IF.                                                      00810025
008200/                                                                 00820025
008300 2000-PROCESS-MESSAGE.                                            00830025
008400                                                                  00840025
008500     IF XL011-DEBUG-YES                                           00850025
008600         DISPLAY 'XLKUP007 - 2000-PROCESS-MESSAGE'                00860025
008700     END-IF                                                       00870025
008800                                                                  00880025
008900     IF XL011-SUCCESSFUL                                          00890025
009000         EVALUATE XL011-MSG-ID                                    00900025
009100           WHEN 'HDR_ADD'                                         00910025
009200               PERFORM 2100-INSERT-HDR                            00920025
009300           WHEN 'HDR_CHANGE'                                      00930025
009400               PERFORM 2200-UPDATE-HDR                            00940025
009500           WHEN 'HDR_DELETE'                                      00950025
009600               MOVE XL011-ORDER-NBR   TO POAGMT-PO-NBR            00960025
009700               PERFORM 7515-DELETE-ALL-TPOAGMT                    00970025
009800           WHEN 'HDR_ATTR_CHANGE'                                 00980025
009900               PERFORM 2250-UPDATE-HDR-ATTR                       00990025
010000           WHEN 'SPECIAL_INSTR_ADD'                               01000025
010100               IF XL011-IA-RECIPIENT-CODE = 'ED'                  01010025
010200                   PERFORM 2300-INSERT-INSTR                      01020025
010300               END-IF                                             01030025
010400           WHEN 'SPECIAL_INSTR_DELETE'                            01040025
010500               MOVE XL011-ORDER-NBR       TO POAGMT-PO-NBR        01050025
010600               IF XL011-ID-RECIPIENT-CODE = 'ED'                  01060025
010700                   PERFORM 2400-DELETE-INSTR                      01070025
010800               END-IF                                             01080025
010900           WHEN 'ORD_DISCOUNT_ADD'                                01090025
011000                 IF XL011-DA-DISC-TYPE-CODE = 'NWSTR'             01100025
011100                     PERFORM 2550-DISCOUNT-UPDATE                 01110025
011200                 ELSE                                             01120025
011300                     PERFORM 2500-DISCOUNT-ADD                    01130025
011400                 END-IF                                           01140025
011500           WHEN 'ORD_DISCOUNT_CHANGE'                             01150025
011600                 IF XL011-DC-DISC-TYPE-CODE = 'NWSTR'             01160025
011700                     PERFORM 2550-DISCOUNT-UPDATE                 01170025
011800                 ELSE                                             01180025
011900                     PERFORM 2560-DISCOUNT-UPDATE                 01190025
012000                 END-IF                                           01200025
012100           WHEN 'ORD_DISCOUNT_DELETE'                             01210025
012200                 IF XL011-DD-DISC-TYPE-CODE = 'NWSTR'             01220025
012300                     PERFORM 2650-ZERO-DISCOUNTS                  01230025
012400                 ELSE                                             01240025
012500                     PERFORM 2600-DISCOUNT-DELETE                 01250025
012600                 END-IF                                           01260025
012700           WHEN 'SPECIAL_INSTR_ADD'                               01270025
012800                 PERFORM 2700-SPEC-INSTR-ADD                      01280025
012900           WHEN 'SPECIAL_INSTR_DELETE'                            01290025
013000                 PERFORM 2710-SPEC-INSTR-DEL                      01300025
013100         END-EVALUATE                                             01310025
013200     END-IF.                                                      01320025
013300                                                                  01330025
013400 2100-INSERT-HDR.                                                 01340025
013500                                                                  01350025
013600     IF XL011-DEBUG-YES                                           01360025
013700         DISPLAY 'XLKUP007 - 2100-INSERT-HDR'                     01370025
013800     END-IF                                                       01380025
013900                                                                  01390025
014000     INITIALIZE DCLTPOAGMT                                        01400025
014100     MOVE XL011-ORDER-NBR             TO POAGMT-PO-NBR            01410025
014200     MOVE 1                           TO POAGMT-VER-NBR           01420025
014300                                                                  01430025
014400     MOVE 1                           TO POAGMT-SEQ-NBR           01440025
014500                                                                  01450025
014600     PERFORM 2112-FORMAT-TYPE-2                                   01460025
014700     PERFORM 7500-INSERT-TPOAGMT                                  01470025
014800                                                                  01480025
014900     PERFORM 2100X-DUP-INSERT                                     01490025
015000                                                                  01500025
015100     IF XL011-HA-PTKT-IND = 'Y'                                   01510025
015200         MOVE '4'                     TO POAGMT-AGRMT-TYP-ID      01520025
015300         MOVE 1                       TO POAGMT-TYP-CDE           01530025
015400                                                                  01540025
015500         PERFORM 7540-AGREEMENT-EXISTS                            01550025
015600                                                                  01560025
015700         IF XL011-SUCCESSFUL                                      01570025
015800             IF PS-POAGMT-EXISTS-NO                               01580025
015900                 MOVE XL011-HA-PTKT-LEAD-TM-DAYS                  01590025
016000                                      TO POAGMT-LEADTIME-DAYS-QTY 01600025
016100                 MOVE SPACES          TO POAGMT-EDI-PROMO-TXT     01610025
016200                 PERFORM 2111-FORMAT-TPOAGMT                      01620025
016300                 PERFORM 7500-INSERT-TPOAGMT                      01630025
016400                 PERFORM 2100X-DUP-INSERT                         01640025
016500             ELSE                                                 01650025
016600                 MOVE XL011-HA-PTKT-LEAD-TM-DAYS                  01660025
016700                                      TO POAGMT-LEADTIME-DAYS-QTY 01670025
016800                 PERFORM 7550-UPDATE-LEADTIME                     01680025
016900             END-IF                                               01690025
017000         END-IF                                                   01700025
017100                                                                  01710025
017200     END-IF                                                       01720025
017300                                                                  01730025
017400     IF XL011-HA-HANG-IND = 'Y'                                   01740025
017500         MOVE '4'                     TO POAGMT-AGRMT-TYP-ID      01750025
017600         MOVE 2                       TO POAGMT-TYP-CDE           01760025
017700         PERFORM 7540-AGREEMENT-EXISTS                            01770025
017800                                                                  01780025
017900         IF XL011-SUCCESSFUL                                      01790025
018000             IF PS-POAGMT-EXISTS-NO                               01800025
018100                 PERFORM 2111-FORMAT-TPOAGMT                      01810025
018200                 MOVE SPACES              TO POAGMT-EDI-PROMO-TXT 01820025
018300                 PERFORM 7500-INSERT-TPOAGMT                      01830025
018400                 PERFORM 2100X-DUP-INSERT                         01840025
018500             END-IF                                               01850025
018600         END-IF                                                   01860025
018700     END-IF                                                       01870025
018800                                                                  01880025
018900     IF XL011-HA-PK-BY-STR-IND = 'Y'                              01890025
019000         MOVE '4'                     TO POAGMT-AGRMT-TYP-ID      01900025
019100         MOVE 4                       TO POAGMT-TYP-CDE           01910025
019200         PERFORM 7540-AGREEMENT-EXISTS                            01920025
019300                                                                  01930025
019400         IF XL011-SUCCESSFUL                                      01940025
019500             IF PS-POAGMT-EXISTS-NO                               01950025
019600                 PERFORM 2111-FORMAT-TPOAGMT                      01960025
019700                 MOVE SPACES          TO POAGMT-EDI-PROMO-TXT     01970025
019800                 PERFORM 7500-INSERT-TPOAGMT                      01980025
019900                 PERFORM 2100X-DUP-INSERT                         01990025
020000             END-IF                                               02000025
020100         END-IF                                                   02010025
020200                                                                  02020025
020300     END-IF.                                                      02030025
020400                                                                  02040025
020500 2100X-DUP-INSERT.                                                02050025
020600     IF XL011-DEBUG-YES                                           02060025
020700         DISPLAY 'XLKUP007 - 2100X-DUP-INSERT'                    02070025
020800     END-IF                                                       02080025
020900                                                                  02090025
021000     IF PS-DUPLICATE-INSERT-YES                                   02100025
021100         PERFORM 7100-FIND-NEXT-SEQ                               02110025
      *PRB0053662-START                                                 02110128
021110         IF XL011-MSG-ID = 'HDR_ADD'                              02111030
                        AND POAGMT-AGRMT-TYP-ID = '2'                   02111130
                        AND POAGMT-TYP-CDE = 0                          02111230
021120           PERFORM 7560-UPDATE-VER-STATUS-CDE                     02112026
021130         END-IF                                                   02113026
      *PRB0053662-END                                                   02114028
021200         PERFORM 7500-INSERT-TPOAGMT                              02120025
021300         IF SQLCODE = -803                                        02130025
021400             SET PS-DUPLICATE-INSERT-NO TO TRUE                   02140025
021500             DISPLAY 'XLKUP007 - SQLERROR'                        02150025
021600             DISPLAY DCLTPOAGMT                                   02160025
021700             SET XL011-SQL-ERROR      TO TRUE                     02170025
021800         END-IF                                                   02180025
021900     END-IF.                                                      02190025
022000                                                                  02200025
022100 2111-FORMAT-TPOAGMT.                                             02210025
022200*                                                                 02220025
022300     IF XL011-DEBUG-YES                                           02230025
022400         DISPLAY 'XLKUP007 - 2111-FORMAT-TPOAGMT'                 02240025
022500     END-IF                                                       02250025
022600                                                                  02260025
022700     MOVE SPACES                      TO POAGMT-TKT-MKR-IND       02270025
022800                                         POAGMT-BULK-STK-TKT-IND  02280025
022900                                         POAGMT-AUTO-PO-CAN-IND.  02290025
023000     MOVE ZERO                        TO POAGMT-PO-CAN-DAY-QTY.   02300025
023100                                                                  02310025
023200 2112-FORMAT-TYPE-2.                                              02320025
023300                                                                  02330025
023400     IF XL011-DEBUG-YES                                           02340025
023500         DISPLAY 'XLKUP007 - 2112-FORMAT-TYPE-2'                  02350025
023600     END-IF                                                       02360025
023700                                                                  02370025
023800     MOVE '2'                         TO POAGMT-AGRMT-TYP-ID      02380025
023900     MOVE SPACES                      TO POAGMT-EDI-PROMO-TXT     02390025
024000     MOVE ZERO                        TO POAGMT-TYP-CDE           02400025
024100                                         POAGMT-DISC-DOL-AMT      02410025
024200                                         POAGMT-DISC-PCT          02420025
024300                                         POAGMT-DISC-PAY-DAY-QTY  02430025
024400     MOVE XL011-HA-TERMS              TO POAGMT-PAYT-TERM-ID.     02440025
024500/                                                                 02450025
024600 2200-UPDATE-HDR.                                                 02460025
024700                                                                  02470025
024800     IF XL011-DEBUG-YES                                           02480025
024900         DISPLAY 'XLKUP007 - 2200-UPDATE-HDR'                     02490025
025000     END-IF                                                       02500025
025100                                                                  02510025
025200     MOVE XL011-ORDER-NBR             TO POAGMT-PO-NBR            02520025
025300                                                                  02530025
025400     EVALUATE TRUE                                                02540025
025500     WHEN XL011-HAC-PTKT-IND = 'N'                                02550025
025600         MOVE '4'                     TO POAGMT-AGRMT-TYP-ID      02560025
025700         MOVE 1                       TO POAGMT-TYP-CDE           02570025
025800        PERFORM 7510-DELETE-TPOAGMT                               02580025
025900                                                                  02590025
026000     WHEN XL011-HAC-HANG-IND = 'N'                                02600025
026100         MOVE '4'                     TO POAGMT-AGRMT-TYP-ID      02610025
026200         MOVE 2                       TO POAGMT-TYP-CDE           02620025
026300        PERFORM 7510-DELETE-TPOAGMT                               02630025
026400                                                                  02640025
026500     WHEN XL011-HC-PK-BY-STR-IND = 'N'                            02650025
026600         MOVE '4'                     TO POAGMT-AGRMT-TYP-ID      02660025
026700         MOVE 4                       TO POAGMT-TYP-CDE           02670025
026800        PERFORM 7510-DELETE-TPOAGMT                               02680025
026900                                                                  02690025
027000     WHEN XL011-HC-PK-BY-STR-IND = 'Y'                            02700025
027100         MOVE XL011-ORDER-NBR         TO POAGMT-PO-NBR            02710025
027200         MOVE 1                       TO POAGMT-VER-NBR           02720025
027300         MOVE '4'                     TO POAGMT-AGRMT-TYP-ID      02730025
027400         MOVE 4                       TO POAGMT-TYP-CDE           02740025
027500         PERFORM 7540-AGREEMENT-EXISTS                            02750025
027600                                                                  02760025
027700         IF XL011-SUCCESSFUL                                      02770025
027800             IF PS-POAGMT-EXISTS-NO                               02780025
027900                 INITIALIZE DCLTPOAGMT                            02790025
028000                 MOVE XL011-ORDER-NBR     TO POAGMT-PO-NBR        02800025
028100                 MOVE 1                   TO POAGMT-VER-NBR       02810025
028200                 MOVE '4'                 TO POAGMT-AGRMT-TYP-ID  02820025
028300                 MOVE 4                   TO POAGMT-TYP-CDE       02830025
028400                 PERFORM 2111-FORMAT-TPOAGMT                      02840025
028500                 PERFORM 7500-INSERT-TPOAGMT                      02850025
028600                 PERFORM 2100X-DUP-INSERT                         02860025
028700             END-IF                                               02870025
028800         END-IF                                                   02880025
028900                                                                  02890025
029000     END-EVALUATE.                                                02900025
029100                                                                  02910025
029200     MOVE XL011-HC-TERMS              TO POAGMT-PAYT-TERM-ID.     02920025
029300     MOVE '2'                         TO POAGMT-AGRMT-TYP-ID      02930025
029400     MOVE ZERO                        TO POAGMT-TYP-CDE           02940025
029500     PERFORM 7600-UPDATE-PAY-TERMS.                               02950025
029600                                                                  02960025
029700 2250-UPDATE-HDR-ATTR.                                            02970025
029800                                                                  02980025
029900     IF XL011-DEBUG-YES                                           02990025
030000         DISPLAY 'XLKUP007 - 2250-UPDATE-HDR-ATTR'                03000025
030100     END-IF                                                       03010025
030200                                                                  03020025
030300     MOVE XL011-ORDER-NBR             TO POAGMT-PO-NBR            03030025
030400     IF XL011-HAC-PTKT-IND = 'N'                                  03040025
030500         MOVE '4'                     TO POAGMT-AGRMT-TYP-ID      03050025
030600         MOVE 1                       TO POAGMT-TYP-CDE           03060025
030700         PERFORM 7510-DELETE-TPOAGMT                              03070025
030800     END-IF                                                       03080025
030900                                                                  03090025
031000     IF XL011-HAC-HANG-IND = 'N'                                  03100025
031100         MOVE '4'                     TO POAGMT-AGRMT-TYP-ID      03110025
031200         MOVE 2                       TO POAGMT-TYP-CDE           03120025
031300         PERFORM 7510-DELETE-TPOAGMT                              03130025
031400     END-IF                                                       03140025
031500                                                                  03150025
031600     IF XL011-HAC-PTKT-IND = 'Y'                                  03160025
031700         MOVE '4'                     TO POAGMT-AGRMT-TYP-ID      03170025
031800         MOVE 1                       TO POAGMT-TYP-CDE           03180025
031900         PERFORM 7540-AGREEMENT-EXISTS                            03190025
032000                                                                  03200025
032100         IF XL011-SUCCESSFUL                                      03210025
032200             IF PS-POAGMT-EXISTS-NO                               03220025
032300                 MOVE 1               TO POAGMT-VER-NBR           03230025
032400                                         POAGMT-SEQ-NBR           03240025
032500                 MOVE XL011-HAC-PTKT-LEAD-TM-DAYS                 03250025
032600                                      TO POAGMT-LEADTIME-DAYS-QTY 03260025
032700                 PERFORM 2111-FORMAT-TPOAGMT                      03270025
032800                 MOVE SPACES          TO POAGMT-EDI-PROMO-TXT     03280025
032900                 MOVE ZEROES          TO POAGMT-DISC-DOL-AMT      03290025
033000                                         POAGMT-DISC-PCT          03300025
033100                 PERFORM 7500-INSERT-TPOAGMT                      03310025
033200                 PERFORM 2100X-DUP-INSERT                         03320025
033300             ELSE                                                 03330025
033400                 MOVE XL011-HAC-PTKT-LEAD-TM-DAYS                 03340025
033500                                      TO POAGMT-LEADTIME-DAYS-QTY 03350025
033600                 PERFORM 7550-UPDATE-LEADTIME                     03360025
033700             END-IF                                               03370025
033800         END-IF                                                   03380025
033900     END-IF.                                                      03390025
034000                                                                  03400025
034100     IF XL011-HAC-HANG-IND = 'Y'                                  03410025
034200         MOVE '4'                     TO POAGMT-AGRMT-TYP-ID      03420025
034300         MOVE 2                       TO POAGMT-TYP-CDE           03430025
034400                                                                  03440025
034500         PERFORM 7540-AGREEMENT-EXISTS                            03450025
034600                                                                  03460025
034700         IF XL011-SUCCESSFUL                                      03470025
034800             IF PS-POAGMT-EXISTS-NO                               03480025
034900                 INITIALIZE DCLTPOAGMT                            03490025
035000                 MOVE XL011-ORDER-NBR     TO POAGMT-PO-NBR        03500025
035100                 MOVE 1                   TO POAGMT-VER-NBR       03510025
035200                                             POAGMT-SEQ-NBR       03520025
035300                 MOVE '4'                 TO POAGMT-AGRMT-TYP-ID  03530025
035400                 MOVE 2                   TO POAGMT-TYP-CDE       03540025
035500                 PERFORM 2111-FORMAT-TPOAGMT                      03550025
035600                 MOVE SPACES          TO POAGMT-EDI-PROMO-TXT     03560025
035700                 MOVE ZEROES          TO POAGMT-DISC-DOL-AMT      03570025
035800                                         POAGMT-DISC-PCT          03580025
035900                 PERFORM 7500-INSERT-TPOAGMT                      03590025
036000                 PERFORM 2100X-DUP-INSERT                         03600025
036100             END-IF                                               03610025
036200         END-IF                                                   03620025
036300     END-IF.                                                      03630025
036400                                                                  03640025
036500 2300-INSERT-INSTR.                                               03650025
036600     IF XL011-DEBUG-YES                                           03660025
036700         DISPLAY 'XLKUP007 - 2300-INSERT-INSTR'                   03670025
036800     END-IF                                                       03680025
036900                                                                  03690025
037000     INITIALIZE DCLTPOAGMT                                        03700025
037100     MOVE XL011-ORDER-NBR             TO POAGMT-PO-NBR            03710025
037200     MOVE 1                           TO POAGMT-VER-NBR           03720025
037300     MOVE 1                           TO POAGMT-SEQ-NBR           03730025
037400     MOVE '3'                         TO POAGMT-AGRMT-TYP-ID      03740025
037500     MOVE ZERO                        TO POAGMT-TYP-CDE           03750025
037600     MOVE XL011-IA-INSTRUCTION-DESC   TO POAGMT-EDI-PROMO-TXT     03760025
037700                                                                  03770025
037800     PERFORM 7500-INSERT-TPOAGMT.                                 03780025
037900     PERFORM 2100X-DUP-INSERT.                                    03790025
038000                                                                  03800025
038100 2400-DELETE-INSTR.                                               03810025
038200     IF XL011-DEBUG-YES                                           03820025
038300         DISPLAY 'XLKUP007 - 2400-DELETE-INSTR'                   03830025
038400     END-IF                                                       03840025
038500                                                                  03850025
038600     MOVE '3'                         TO POAGMT-AGRMT-TYP-ID      03860025
038700     MOVE ZERO                        TO POAGMT-TYP-CDE           03870025
038800     PERFORM 7510-DELETE-TPOAGMT.                                 03880025
038900                                                                  03890025
039000 2500-DISCOUNT-ADD.                                               03900025
039100                                                                  03910025
039200     IF XL011-DEBUG-YES                                           03920025
039300         DISPLAY 'XLKUP007 - 2500-DISCOUNT-ADD'                   03930025
039400     END-IF                                                       03940025
039500                                                                  03950025
039600     INITIALIZE DCLTPOAGMT                                        03960025
039700     MOVE XL011-ORDER-NBR             TO POAGMT-PO-NBR            03970025
039800     MOVE 1                           TO POAGMT-SEQ-NBR           03980025
039900                                         POAGMT-VER-NBR           03990025
040000                                                                  04000025
040100     MOVE 3                           TO DP010I-MAXIMUM-DIGITS    04010025
040200     MOVE 2                           TO DP010I-MAXIMUM-DECIMALS  04020025
040300     MOVE XL011-DA-DISC-PERCENT       TO DP010I-UNEDITED-FIELD    04030025
040400     PERFORM 8100-NUMERIC-EDIT                                    04040025
040500     COMPUTE POAGMT-DISC-PCT = DP010I-NUMERIC-FIELD / 100         04050025
040600                                                                  04060025
040700                                                                  04070025
040800     EVALUATE XL011-DA-DISC-TYPE-CODE                             04080025
040900     WHEN 'MOS'                                                   04090025
041000         MOVE '5'                     TO POAGMT-AGRMT-TYP-ID      04100025
041100         MOVE 7                       TO POAGMT-TYP-CDE           04110025
041200         PERFORM 7540-AGREEMENT-EXISTS                            04120025
041300                                                                  04130025
041400         IF XL011-SUCCESSFUL                                      04140025
041500             IF PS-POAGMT-EXISTS-NO                               04150025
041600                 MOVE SPACES          TO POAGMT-EDI-PROMO-TXT     04160025
041700                 PERFORM 7500-INSERT-TPOAGMT                      04170025
041800                 PERFORM 2100X-DUP-INSERT                         04180025
041900             END-IF                                               04190025
042000         END-IF                                                   04200025
042100     WHEN 'TRADE'                                                 04210025
042200         MOVE '5'                     TO POAGMT-AGRMT-TYP-ID      04220025
042300         MOVE 8                       TO POAGMT-TYP-CDE           04230025
042400         PERFORM 7540-AGREEMENT-EXISTS                            04240025
042500                                                                  04250025
042600         IF XL011-SUCCESSFUL                                      04260025
042700             IF PS-POAGMT-EXISTS-NO                               04270025
042800                 MOVE SPACES          TO POAGMT-EDI-PROMO-TXT     04280025
042900                 PERFORM 7500-INSERT-TPOAGMT                      04290025
043000                 PERFORM 2100X-DUP-INSERT                         04300025
043100             END-IF                                               04310025
043200         END-IF                                                   04320025
043300     WHEN 'ADVRT'                                                 04330025
043400         MOVE '5'                     TO POAGMT-AGRMT-TYP-ID      04340025
043500         MOVE 9                       TO POAGMT-TYP-CDE           04350025
043600         PERFORM 7540-AGREEMENT-EXISTS                            04360025
043700                                                                  04370025
043800         IF XL011-SUCCESSFUL                                      04380025
043900             IF PS-POAGMT-EXISTS-NO                               04390025
044000                 MOVE SPACES          TO POAGMT-EDI-PROMO-TXT     04400025
044100                 PERFORM 7500-INSERT-TPOAGMT                      04410025
044200                 PERFORM 2100X-DUP-INSERT                         04420025
044300             END-IF                                               04430025
044400         END-IF                                                   04440025
044500     WHEN 'ADCOOP'                                                04450025
044600         MOVE '5'                     TO POAGMT-AGRMT-TYP-ID      04460025
044700         MOVE 10                      TO POAGMT-TYP-CDE           04470025
044800         PERFORM 7540-AGREEMENT-EXISTS                            04480025
044900                                                                  04490025
045000         IF XL011-SUCCESSFUL                                      04500025
045100             IF PS-POAGMT-EXISTS-NO                               04510025
045200                 MOVE SPACES          TO POAGMT-EDI-PROMO-TXT     04520025
045300                 PERFORM 7500-INSERT-TPOAGMT                      04530025
045400                 PERFORM 2100X-DUP-INSERT                         04540025
045500             END-IF                                               04550025
045600         END-IF                                                   04560025
045700     WHEN 'PROAST'                                                04570025
045800         MOVE '5'                     TO POAGMT-AGRMT-TYP-ID      04580025
045900         MOVE 11                      TO POAGMT-TYP-CDE           04590025
046000         PERFORM 7540-AGREEMENT-EXISTS                            04600025
046100                                                                  04610025
046200         IF XL011-SUCCESSFUL                                      04620025
046300             IF PS-POAGMT-EXISTS-NO                               04630025
046400                 MOVE SPACES          TO POAGMT-EDI-PROMO-TXT     04640025
046500                 PERFORM 7500-INSERT-TPOAGMT                      04650025
046600                 PERFORM 2100X-DUP-INSERT                         04660025
046700             END-IF                                               04670025
046800         END-IF                                                   04680025
046900     WHEN 'TANDT '                                                04690025
047000         MOVE '5'                     TO POAGMT-AGRMT-TYP-ID      04700025
047100         MOVE 12                      TO POAGMT-TYP-CDE           04710025
047200         PERFORM 7540-AGREEMENT-EXISTS                            04720025
047300                                                                  04730025
047400         IF XL011-SUCCESSFUL                                      04740025
047500             IF PS-POAGMT-EXISTS-NO                               04750025
047600                 MOVE SPACES          TO POAGMT-EDI-PROMO-TXT     04760025
047700                 MOVE XL011-DA-EXTENDED-DAYS-QTY                  04770025
047800                                      TO POAGMT-DISC-PAY-DAY-QTY  04780025
047900                 PERFORM 7500-INSERT-TPOAGMT                      04790025
048000                 PERFORM 2100X-DUP-INSERT                         04800025
048100             END-IF                                               04810025
048200         END-IF                                                   04820025
048300     WHEN 'BRIDAL'                                                04830025
048400         MOVE '5'                     TO POAGMT-AGRMT-TYP-ID      04840025
048500         MOVE 13                      TO POAGMT-TYP-CDE           04850025
048600         PERFORM 7540-AGREEMENT-EXISTS                            04860025
048700                                                                  04870025
048800         IF XL011-SUCCESSFUL                                      04880025
048900             IF PS-POAGMT-EXISTS-NO                               04890025
049000                 MOVE SPACES          TO POAGMT-EDI-PROMO-TXT     04900025
049100                 PERFORM 7500-INSERT-TPOAGMT                      04910025
049200                 PERFORM 2100X-DUP-INSERT                         04920025
049300             END-IF                                               04930025
049400         END-IF                                                   04940025
049500     WHEN 'VNDADD'                                                04950025
049600         MOVE '5'                     TO POAGMT-AGRMT-TYP-ID      04960025
049700         MOVE 1                       TO POAGMT-TYP-CDE           04970025
049800         PERFORM 7540-AGREEMENT-EXISTS                            04980025
049900                                                                  04990025
050000         IF XL011-SUCCESSFUL                                      05000025
050100             IF PS-POAGMT-EXISTS-NO                               05010025
050200                 MOVE SPACES          TO POAGMT-EDI-PROMO-TXT     05020025
050300                 MOVE XL011-DA-EXTENDED-DAYS-QTY                  05030025
050400                                      TO POAGMT-DISC-PAY-DAY-QTY  05040025
050500                 PERFORM 7500-INSERT-TPOAGMT                      05050025
050600                 PERFORM 2100X-DUP-INSERT                         05060025
050700             ELSE                                                 05070025
050800                 MOVE XL011-DA-EXTENDED-DAYS-QTY                  05080025
050900                                      TO POAGMT-DISC-PAY-DAY-QTY  05090025
051000                                                                  05100025
051100                 MOVE 3               TO DP010I-MAXIMUM-DIGITS    05110025
051200                 MOVE 2               TO DP010I-MAXIMUM-DECIMALS  05120025
051300                 MOVE XL011-DA-DISC-PERCENT                       05130025
051400                                      TO DP010I-UNEDITED-FIELD    05140025
051500                 PERFORM 8100-NUMERIC-EDIT                        05150025
051600                 COMPUTE POAGMT-DISC-PCT                          05160025
051700                             = DP010I-NUMERIC-FIELD / 100         05170025
051800                 PERFORM 7520-UPDATE-TPOAGMT                      05180025
051900             END-IF                                               05190025
052000         END-IF                                                   05200025
052100     END-EVALUATE.                                                05210025
052200/                                                                 05220025
052300 2550-DISCOUNT-UPDATE.                                            05230025
052400     IF XL011-DEBUG-YES                                           05240025
052500         DISPLAY 'XLKUP007 - 2550-DISCOUNT-UPDATE'                05250025
052600     END-IF                                                       05260025
052700                                                                  05270025
052800     MOVE XL011-ORDER-NBR             TO POAGMT-PO-NBR            05280025
052900     MOVE '2'                         TO POAGMT-AGRMT-TYP-ID      05290025
053000     MOVE ZERO                        TO POAGMT-TYP-CDE           05300025
053100     MOVE XL011-DC-EXTENDED-DAYS-QTY  TO POAGMT-DISC-PAY-DAY-QTY  05310025
053200                                                                  05320025
053300     MOVE 3                           TO DP010I-MAXIMUM-DIGITS    05330025
053400     MOVE 2                           TO DP010I-MAXIMUM-DECIMALS  05340025
053500     MOVE XL011-DC-DISC-PERCENT       TO DP010I-UNEDITED-FIELD    05350025
053600     PERFORM 8100-NUMERIC-EDIT                                    05360025
053700     COMPUTE POAGMT-DISC-PCT = DP010I-NUMERIC-FIELD / 100         05370025
053800                                                                  05380025
053900     PERFORM 7520-UPDATE-TPOAGMT.                                 05390025
054000                                                                  05400025
054100 2560-DISCOUNT-UPDATE.                                            05410025
054200     IF XL011-DEBUG-YES                                           05420025
054300         DISPLAY 'XLKUP007 - 2560-DISCOUNT-UPDATE'                05430025
054400     END-IF                                                       05440025
054500                                                                  05450025
054600     MOVE XL011-ORDER-NBR             TO POAGMT-PO-NBR            05460025
054700                                                                  05470025
054800     EVALUATE XL011-DC-DISC-TYPE-CODE                             05480025
054900     WHEN 'MOS'                                                   05490025
055000         MOVE '5'                     TO POAGMT-AGRMT-TYP-ID      05500025
055100         MOVE 7                       TO POAGMT-TYP-CDE           05510025
055200     WHEN 'TRADE'                                                 05520025
055300         MOVE '5'                     TO POAGMT-AGRMT-TYP-ID      05530025
055400         MOVE 8                       TO POAGMT-TYP-CDE           05540025
055500     WHEN 'ADVRT'                                                 05550025
055600         MOVE '5'                     TO POAGMT-AGRMT-TYP-ID      05560025
055700         MOVE 9                       TO POAGMT-TYP-CDE           05570025
055800     WHEN 'ADCOOP'                                                05580025
055900         MOVE '5'                     TO POAGMT-AGRMT-TYP-ID      05590025
056000         MOVE 10                      TO POAGMT-TYP-CDE           05600025
056100     WHEN 'PROAST'                                                05610025
056200         MOVE '5'                     TO POAGMT-AGRMT-TYP-ID      05620025
056300         MOVE 11                      TO POAGMT-TYP-CDE           05630025
056400     WHEN 'TANDT '                                                05640025
056500         MOVE '5'                     TO POAGMT-AGRMT-TYP-ID      05650025
056600         MOVE 12                      TO POAGMT-TYP-CDE           05660025
056700     WHEN 'BRIDAL'                                                05670025
056800         MOVE '5'                     TO POAGMT-AGRMT-TYP-ID      05680025
056900         MOVE 13                      TO POAGMT-TYP-CDE           05690025
057000     WHEN 'VNDADD'                                                05700025
057100         MOVE '5'                     TO POAGMT-AGRMT-TYP-ID      05710025
057200         MOVE 1                       TO POAGMT-TYP-CDE           05720025
057300     END-EVALUATE.                                                05730025
057400                                                                  05740025
057500     MOVE 3                           TO DP010I-MAXIMUM-DIGITS    05750025
057600     MOVE 2                           TO DP010I-MAXIMUM-DECIMALS  05760025
057700     MOVE XL011-DC-DISC-PERCENT       TO DP010I-UNEDITED-FIELD    05770025
057800     PERFORM 8100-NUMERIC-EDIT                                    05780025
057900                                                                  05790025
058000     COMPUTE POAGMT-DISC-PCT = DP010I-NUMERIC-FIELD / 100         05800025
058100                                                                  05810025
058200     MOVE XL011-DC-EXTENDED-DAYS-QTY  TO POAGMT-DISC-PAY-DAY-QTY  05820025
058300                                                                  05830025
058400     PERFORM 7520-UPDATE-TPOAGMT.                                 05840025
058500                                                                  05850025
058600 2600-DISCOUNT-DELETE.                                            05860025
058700                                                                  05870025
058800     IF XL011-DEBUG-YES                                           05880025
058900         DISPLAY 'XLKUP007 - 2600-DISCOUNT-DELETE'                05890025
059000     END-IF                                                       05900025
059100                                                                  05910025
059200     MOVE XL011-ORDER-NBR             TO POAGMT-PO-NBR            05920025
059300*    PERFORM 7515-DELETE-ALL-TPOAGMT.                             05930025
059400                                                                  05940025
059500     EVALUATE XL011-DD-DISC-TYPE-CODE                             05950025
059600     WHEN 'MOS'                                                   05960025
059700         MOVE '5'                     TO POAGMT-AGRMT-TYP-ID      05970025
059800         MOVE 7                       TO POAGMT-TYP-CDE           05980025
059900         PERFORM 7510-DELETE-TPOAGMT                              05990025
060000     WHEN 'TRADE'                                                 06000025
060100         MOVE '5'                     TO POAGMT-AGRMT-TYP-ID      06010025
060200         MOVE 8                       TO POAGMT-TYP-CDE           06020025
060300         PERFORM 7510-DELETE-TPOAGMT                              06030025
060400     WHEN 'ADVRT'                                                 06040025
060500         MOVE '5'                     TO POAGMT-AGRMT-TYP-ID      06050025
060600         MOVE 9                       TO POAGMT-TYP-CDE           06060025
060700         PERFORM 7510-DELETE-TPOAGMT                              06070025
060800     WHEN 'ADCOOP'                                                06080025
060900         MOVE '5'                     TO POAGMT-AGRMT-TYP-ID      06090025
061000         MOVE 10                      TO POAGMT-TYP-CDE           06100025
061100         PERFORM 7510-DELETE-TPOAGMT                              06110025
061200     WHEN 'PROAST'                                                06120025
061300         MOVE '5'                     TO POAGMT-AGRMT-TYP-ID      06130025
061400         MOVE 11                      TO POAGMT-TYP-CDE           06140025
061500         PERFORM 7510-DELETE-TPOAGMT                              06150025
061600     WHEN 'TANDT '                                                06160025
061700         MOVE '5'                     TO POAGMT-AGRMT-TYP-ID      06170025
061800         MOVE 12                      TO POAGMT-TYP-CDE           06180025
061900         PERFORM 7510-DELETE-TPOAGMT                              06190025
062000     WHEN 'BRIDAL'                                                06200025
062100         MOVE '5'                     TO POAGMT-AGRMT-TYP-ID      06210025
062200         MOVE 13                      TO POAGMT-TYP-CDE           06220025
062300         PERFORM 7510-DELETE-TPOAGMT                              06230025
062400     WHEN 'VNDADD'                                                06240025
062500         MOVE '5'                     TO POAGMT-AGRMT-TYP-ID      06250025
062600         MOVE 1                       TO POAGMT-TYP-CDE           06260025
062700         MOVE ZERO                    TO POAGMT-DISC-PAY-DAY-QTY  06270025
062800         PERFORM 7510-DELETE-TPOAGMT                              06280025
062900     END-EVALUATE.                                                06290025
063000                                                                  06300025
063100 2650-ZERO-DISCOUNTS.                                             06310025
063200     IF XL011-DEBUG-YES                                           06320025
063300         DISPLAY 'XLKUP007 - 2650-ZERO-DISCOUNTS'                 06330025
063400     END-IF                                                       06340025
063500                                                                  06350025
063600     MOVE XL011-ORDER-NBR             TO POAGMT-PO-NBR            06360025
063700     MOVE '2'                         TO POAGMT-AGRMT-TYP-ID      06370025
063800     MOVE ZERO                        TO POAGMT-TYP-CDE           06380025
063900                                         POAGMT-DISC-PAY-DAY-QTY  06390025
064000                                         POAGMT-DISC-PCT          06400025
064100                                                                  06410025
064200     PERFORM 7520-UPDATE-TPOAGMT.                                 06420025
064300/                                                                 06430025
064400 2700-SPEC-INSTR-ADD.                                             06440025
064500     IF XL011-DEBUG-YES                                           06450025
064600         DISPLAY 'XLKUP007 - 2700-SPEC-INSTR-ADD'                 06460025
064700     END-IF                                                       06470025
064800                                                                  06480025
064900     INITIALIZE DCLTPOAGMT                                        06490025
065000     MOVE XL011-ORDER-NBR             TO POAGMT-PO-NBR            06500025
065100     MOVE 1                           TO POAGMT-SEQ-NBR           06510025
065200                                         POAGMT-VER-NBR           06520025
065300     MOVE '3'                         TO POAGMT-AGRMT-TYP-ID      06530025
065400     MOVE ZERO                        TO POAGMT-TYP-CDE           06540025
065500     MOVE XL011-IA-INSTRUCTION-DESC   TO POAGMT-EDI-PROMO-TXT     06550025
065600     PERFORM 7500-INSERT-TPOAGMT                                  06560025
065700     PERFORM 2100X-DUP-INSERT.                                    06570025
065800                                                                  06580025
065900 2710-SPEC-INSTR-DEL.                                             06590025
066000     IF XL011-DEBUG-YES                                           06600025
066100         DISPLAY 'XLKUP007 - 2710-SPEC-INSTR-DEL'                 06610025
066200     END-IF                                                       06620025
066300                                                                  06630025
066400     MOVE XL011-ORDER-NBR             TO POAGMT-PO-NBR            06640025
066500     MOVE '3'                         TO POAGMT-AGRMT-TYP-ID      06650025
066600     MOVE ZERO                        TO POAGMT-TYP-CDE           06660025
066700     PERFORM 7510-DELETE-TPOAGMT.                                 06670025
066800/                                                                 06680025
066900 7000-SELECT-TPURCHS.                                             06690025
067000                                                                  06700025
067100     IF XL011-DEBUG-YES                                           06710025
067200         DISPLAY 'XLKUP007 - 7000-SELECT-TPURCHS'                 06720025
067300     END-IF                                                       06730025
067400                                                                  06740025
067500     MOVE '7000-SELECT-TPURCHS'       TO XL011-ERROR-PARAGRAPH    06750025
067600     MOVE XL011-ORDER-NBR             TO PURCHS-PO-NBR            06760025
067700     MOVE ZERO                        TO PS-EXISTENCE-PO          06770025
067800                                                                  06780025
067900     EXEC SQL                                                     06790025
068000         SELECT 1                                                 06800025
068100         INTO                                                     06810025
068200             :PS-EXISTENCE-PO                                     06820025
068300         FROM                                                     06830025
068400             TPURCHS                                              06840025
068500         WHERE                                                    06850025
068600             PO_NBR                   = :PURCHS-PO-NBR            06860025
068700         AND VER_STATUS_CDE           = 'A'                       06870025
068800         FETCH FIRST 1 ROWS ONLY                                  06880025
068900     END-EXEC.                                                    06890025
069000                                                                  06900025
069100     MOVE SQLCODE                     TO XL011-SQLCODE            06910025
069200     EVALUATE TRUE                                                06920025
069300         WHEN SQLCODE = ZERO                                      06930025
069400             CONTINUE                                             06940025
069500         WHEN SQLCODE = +100                                      06950025
069600             STRING 'NO TPURCHS FOR PO = ' XL011-ORDER-NBR        06960025
069700                     DELIMITED BY SIZE                            06970025
069800                                      INTO XL011-ERROR-TEXT       06980025
069900             SET XL011-SYSTEM-ERROR   TO TRUE                     06990025
070000             MOVE 'TPURCHS'           TO XL011-DB2-TABLE-NAME(1)  07000025
070100         WHEN OTHER                                               07010025
070200             SET XL011-SQL-ERROR      TO TRUE                     07020025
070300             MOVE 'TPURCHS'           TO XL011-DB2-TABLE-NAME(1)  07030025
070400     END-EVALUATE.                                                07040025
070500/                                                                 07050025
070600 7100-FIND-NEXT-SEQ.                                              07060025
070700                                                                  07070025
070800     IF XL011-DEBUG-YES                                           07080025
070900         DISPLAY 'XLKUP007 - 7100-FIND-NEXT-SEQ'                  07090025
071000     END-IF                                                       07100025
071100                                                                  07110025
071200     MOVE '7100-FIND-NEXT-SEQ'        TO XL011-ERROR-PARAGRAPH    07120025
071300     EXEC SQL                                                     07130025
071400         SELECT MAX(SEQ_NBR) + 1                                  07140025
071500         INTO :POAGMT-SEQ-NBR                                     07150025
071600         FROM TPOAGMT                                             07160025
071700         WHERE PO_NBR         = :POAGMT-PO-NBR                    07170025
071800         AND AGRMT_TYP_ID     = :POAGMT-AGRMT-TYP-ID              07180025
071900         AND VER_STATUS_CDE   = 'A'                               07190025
072000     END-EXEC.                                                    07200025
072100                                                                  07210025
072200     MOVE SQLCODE                     TO XL011-SQLCODE            07220025
072300     EVALUATE TRUE                                                07230025
072400         WHEN SQLCODE = ZERO                                      07240025
072500             CONTINUE                                             07250025
072600         WHEN SQLCODE = +100                                      07260025
072700         WHEN SQLCODE = -305                                      07270025
072800             MOVE 1                   TO POAGMT-SEQ-NBR           07280025
072900         WHEN OTHER                                               07290025
073000             SET XL011-SQL-ERROR      TO TRUE                     07300025
073100     END-EVALUATE.                                                07310025
073200/                                                                 07320025
073300 7500-INSERT-TPOAGMT.                                             07330025
073400                                                                  07340025
073500     IF XL011-DEBUG-YES                                           07350025
073600         DISPLAY 'XLKUP007 - 7500-INSERT-TPOAGMT'                 07360025
073700     END-IF                                                       07370025
073800                                                                  07380025
073900     MOVE '7500-INSERT-TPOAGMT'       TO XL011-ERROR-PARAGRAPH    07390025
074000     SET   PS-DUPLICATE-INSERT-NO     TO TRUE                     07400025
074100                                                                  07410025
074200     EXEC SQL                                                     07420025
074300         INSERT INTO TPOAGMT                                      07430025
074400             (                                                    07440025
074500              PO_NBR                                              07450025
074600             ,VER_NBR                                             07460025
074700             ,AGRMT_TYP_ID                                        07470025
074800             ,SEQ_NBR                                             07480025
074900             ,VER_STATUS_CDE                                      07490025
075000             ,TYP_CDE                                             07500025
075100             ,TKT_MKR_IND                                         07510025
075200             ,BULK_STK_TKT_IND                                    07520025
075300             ,EDI_PROMO_TXT                                       07530025
075400             ,PO_CAN_DAY_QTY                                      07540025
075500             ,AUTO_PO_CAN_IND                                     07550025
075600             ,DISC_DOL_AMT                                        07560025
075700             ,DISC_PCT                                            07570025
075800             ,DISC_PAY_DAY_QTY                                    07580025
075900             ,LAST_UPD_TMST                                       07590025
076000             ,PAYT_TERM_ID                                        07600025
076100             ,LAST_UPD_BY_UID                                     07610025
076200             ,LEADTIME_DAYS_QTY                                   07620025
076300             )                                                    07630025
076400         VALUES                                                   07640025
076500             (                                                    07650025
076600             :POAGMT-PO-NBR                                       07660025
076700            ,:POAGMT-VER-NBR                                      07670025
076800            ,:POAGMT-AGRMT-TYP-ID                                 07680025
076900            ,:POAGMT-SEQ-NBR                                      07690025
077000            ,'A'                                                  07700025
077100            ,:POAGMT-TYP-CDE                                      07710025
077200            ,:POAGMT-TKT-MKR-IND                                  07720025
077300            ,:POAGMT-BULK-STK-TKT-IND                             07730025
077400            ,:POAGMT-EDI-PROMO-TXT                                07740025
077500            ,:POAGMT-PO-CAN-DAY-QTY                               07750025
077600            ,:POAGMT-AUTO-PO-CAN-IND                              07760025
077700            ,:POAGMT-DISC-DOL-AMT                                 07770025
077800            ,:POAGMT-DISC-PCT                                     07780025
077900            ,:POAGMT-DISC-PAY-DAY-QTY                             07790025
078000            ,CURRENT TIMESTAMP                                    07800025
078100            ,:POAGMT-PAYT-TERM-ID                                 07810025
078200            ,'XLKUP007'                                           07820025
078300            ,:POAGMT-LEADTIME-DAYS-QTY                            07830025
078400             )                                                    07840025
078500        END-EXEC                                                  07850025
078600                                                                  07860025
078700     MOVE SQLCODE                     TO XL011-SQLCODE            07870025
078800     EVALUATE TRUE                                                07880025
078900         WHEN SQLCODE = ZERO                                      07890025
079000             CONTINUE                                             07900025
079100         WHEN SQLCODE = -803                                      07910025
079200             SET PS-DUPLICATE-INSERT-YES  TO TRUE                 07920025
079300         WHEN OTHER                                               07930025
079400             DISPLAY 'XLKUP007 - SQLERROR'                        07940025
079500             DISPLAY DCLTPOAGMT                                   07950025
079600             SET XL011-SQL-ERROR      TO TRUE                     07960025
079700     END-EVALUATE.                                                07970025
079800/                                                                 07980025
079900 7510-DELETE-TPOAGMT.                                             07990025
080000     IF XL011-DEBUG-YES                                           08000025
080100         DISPLAY 'XLKUP007 - 7510-DELETE-TPOAGMT'                 08010025
080200         DISPLAY 'XLKUP007 - PO NUMBER ' POAGMT-PO-NBR            08020025
080300         DISPLAY 'XLKUP007 - AGRMT TYPE ' POAGMT-AGRMT-TYP-ID     08030025
080400         DISPLAY 'XLKUP007 - TYPE CDE   ' POAGMT-TYP-CDE          08040025
080500     END-IF                                                       08050025
080600                                                                  08060025
080700     MOVE '7510-DELETE-TPOAGMT'       TO XL011-ERROR-PARAGRAPH    08070025
080800     EXEC SQL                                                     08080025
080900         DELETE                                                   08090025
081000         FROM                                                     08100025
081100             TPOAGMT                                              08110025
081200         WHERE                                                    08120025
081300             PO_NBR                   = :POAGMT-PO-NBR            08130025
081400         AND AGRMT_TYP_ID             = :POAGMT-AGRMT-TYP-ID      08140025
081500         AND TYP_CDE                  = :POAGMT-TYP-CDE           08150025
081600     END-EXEC.                                                    08160025
081700                                                                  08170025
081800     MOVE SQLCODE                     TO XL011-SQLCODE            08180025
081900     EVALUATE TRUE                                                08190025
082000         WHEN SQLCODE = ZERO                                      08200025
082100         WHEN SQLCODE = +100                                      08210025
082200             CONTINUE                                             08220025
082300       WHEN OTHER                                                 08230025
082400             SET XL011-SQL-ERROR      TO TRUE                     08240025
082500             IF XL011-DEBUG-YES                                   08250025
082600                 DISPLAY 'XLKUP007 - DELETE SQLCODE ' SQLCODE     08260025
082700             END-IF                                               08270025
082800     END-EVALUATE.                                                08280025
082900/                                                                 08290025
083000 7515-DELETE-ALL-TPOAGMT.                                         08300025
083100     IF XL011-DEBUG-YES                                           08310025
083200         DISPLAY 'XLKUP007 - 7515-DELETE-ALL-TPOAGMT'             08320025
083300     END-IF                                                       08330025
083400                                                                  08340025
083500     MOVE '7515-DELETE-ALL-TPOAGMT'   TO XL011-ERROR-PARAGRAPH    08350025
083600     EXEC SQL                                                     08360025
083700         DELETE                                                   08370025
083800         FROM                                                     08380025
083900             TPOAGMT                                              08390025
084000         WHERE                                                    08400025
084100             PO_NBR                   = :POAGMT-PO-NBR            08410025
084200     END-EXEC.                                                    08420025
084300                                                                  08430025
084400     MOVE SQLCODE                     TO XL011-SQLCODE            08440025
084500     EVALUATE TRUE                                                08450025
084600         WHEN SQLCODE = ZERO                                      08460025
084700         WHEN SQLCODE = +100                                      08470025
084800             CONTINUE                                             08480025
084900       WHEN OTHER                                                 08490025
085000             SET XL011-SQL-ERROR      TO TRUE                     08500025
085100     END-EVALUATE.                                                08510025
085200/                                                                 08520025
085300 7520-UPDATE-TPOAGMT.                                             08530025
085400     IF XL011-DEBUG-YES                                           08540025
085500         DISPLAY 'XLKUP007 - 7520-UPDATE-TPOAGMT'                 08550025
085600     END-IF                                                       08560025
085700                                                                  08570025
085800     MOVE '7520-UPDATE-TPOAGMT'       TO XL011-ERROR-PARAGRAPH    08580025
085900     EXEC SQL                                                     08590025
086000         UPDATE                                                   08600025
086100             TPOAGMT                                              08610025
086200         SET                                                      08620025
086300             DISC_PAY_DAY_QTY         = :POAGMT-DISC-PAY-DAY-QTY  08630025
086400           , DISC_PCT                 = :POAGMT-DISC-PCT          08640025
086500           , LAST_UPD_TMST            = CURRENT TIMESTAMP         08650025
086600           , LAST_UPD_BY_UID          = 'XLKUP007'                08660025
086700         WHERE                                                    08670025
086800             PO_NBR                   = :POAGMT-PO-NBR            08680025
086900         AND AGRMT_TYP_ID             = :POAGMT-AGRMT-TYP-ID      08690025
087000         AND TYP_CDE                  = :POAGMT-TYP-CDE           08700025
087100         AND VER_STATUS_CDE           = 'A'                       08710025
087200     END-EXEC.                                                    08720025
087300                                                                  08730025
087400     MOVE SQLCODE                     TO XL011-SQLCODE            08740025
087500     EVALUATE TRUE                                                08750025
087600         WHEN SQLCODE = ZERO                                      08760025
087700             CONTINUE                                             08770025
087800         WHEN SQLCODE = +100                                      08780025
087900             IF POAGMT-AGRMT-TYP-ID  = '5'                        08790025
088000                 MOVE ZERO            TO POAGMT-DISC-DOL-AMT      08800025
088100                 MOVE 1               TO POAGMT-SEQ-NBR           08810025
088200                                         POAGMT-VER-NBR           08820025
088300                 INITIALIZE              POAGMT-TKT-MKR-IND       08830025
088400                                         POAGMT-BULK-STK-TKT-IND  08840025
088500                                         POAGMT-EDI-PROMO-TXT     08850025
088600                                         POAGMT-PO-CAN-DAY-QTY    08860025
088700                                         POAGMT-AUTO-PO-CAN-IND   08870025
088800                                         POAGMT-DISC-DOL-AMT      08880025
088900                                         POAGMT-DISC-DOL-AMT      08890025
089000                                         POAGMT-PAYT-TERM-ID      08900025
089100                                         POAGMT-LEADTIME-DAYS-QTY 08910025
089200                 PERFORM 7500-INSERT-TPOAGMT                      08920025
089300                 PERFORM 2100X-DUP-INSERT                         08930025
089400             ELSE                                                 08940025
089500                 SET XL011-SQL-ERROR      TO TRUE                 08950025
089600             END-IF                                               08960025
089700         WHEN OTHER                                               08970025
089800             SET XL011-SQL-ERROR      TO TRUE                     08980025
089900     END-EVALUATE.                                                08990025
090000                                                                  09000025
090100*7530-UPDATE-PCT-ONLY.                                            09010025
090200*    MOVE '7530-UPDATE-PCT-ONLY'      TO XL011-ERROR-PARAGRAPH    09020025
090300*    EXEC SQL                                                     09030025
090400*        UPDATE                                                   09040025
090500*            TPOAGMT                                              09050025
090600*        SET                                                      09060025
090700*            DISC_PCT                 = :POAGMT-DISC-PCT          09070025
090800*          , LAST_UPD_TMST            = CURRENT TIMESTAMP         09080025
090900*          , LAST_UPD_BY_UID          = 'XLKUP007'                09090025
091000*        WHERE                                                    09100025
091100*            PO_NBR                   = :POAGMT-PO-NBR            09110025
091200*        AND AGRMT_TYP_ID             = :POAGMT-AGRMT-TYP-ID      09120025
091300*        AND TYP_CDE                  = :POAGMT-TYP-CDE           09130025
091400*        AND VER_STATUS_CDE           = 'A'                       09140025
091500*    END-EXEC.                                                    09150025
091600*                                                                 09160025
091700*    MOVE SQLCODE                     TO XL011-SQLCODE            09170025
091800*    EVALUATE TRUE                                                09180025
091900*        WHEN SQLCODE = ZERO                                      09190025
092000*            CONTINUE                                             09200025
092100*        WHEN OTHER                                               09210025
092200*            SET XL011-SQL-ERROR      TO TRUE                     09220025
092300*    END-EVALUATE.                                                09230025
092400                                                                  09240025
092500 7540-AGREEMENT-EXISTS.                                           09250025
092600                                                                  09260025
092700     IF XL011-DEBUG-YES                                           09270025
092800         DISPLAY 'XLKUP007 - 7540-AGREEMENT-EXISTS'               09280025
092900     END-IF                                                       09290025
093000                                                                  09300025
093100     MOVE '7540-AGGREEMENT-EXISTS'    TO XL011-ERROR-PARAGRAPH    09310025
093200     EXEC SQL                                                     09320025
093300     SELECT                                                       09330025
093400             LEADTIME_DAYS_QTY                                    09340025
093500     INTO                                                         09350025
093600             :POAGMT-LEADTIME-DAYS-QTY                            09360025
093700     FROM TPOAGMT                                                 09370025
093800     WHERE                                                        09380025
093900             PO_NBR                   = :POAGMT-PO-NBR            09390025
094000         AND AGRMT_TYP_ID             = :POAGMT-AGRMT-TYP-ID      09400025
094100         AND TYP_CDE                  = :POAGMT-TYP-CDE           09410025
094200         AND VER_STATUS_CDE           = 'A'                       09420025
094300     END-EXEC.                                                    09430025
094400                                                                  09440025
094500     MOVE SQLCODE                     TO XL011-SQLCODE            09450025
094600     EVALUATE TRUE                                                09460025
094700         WHEN SQLCODE = ZERO                                      09470025
094800             SET PS-POAGMT-EXISTS-YES TO TRUE                     09480025
094900         WHEN SQLCODE = +100                                      09490025
095000             SET PS-POAGMT-EXISTS-NO  TO TRUE                     09500025
095100         WHEN OTHER                                               09510025
095200             SET XL011-SQL-ERROR      TO TRUE                     09520025
095300     END-EVALUATE.                                                09530025
095400                                                                  09540025
095500                                                                  09550025
095600 7550-UPDATE-LEADTIME.                                            09560025
095700                                                                  09570025
095800     IF XL011-DEBUG-YES                                           09580025
095900         DISPLAY 'XLKUP007 - 7550-UPDATE-LEADTIME'                09590025
096000     END-IF                                                       09600025
096100                                                                  09610025
096200     MOVE '7550-UPDATE-LEADTIME'      TO XL011-ERROR-PARAGRAPH    09620025
096300     EXEC SQL                                                     09630025
096400     UPDATE TPOAGMT                                               09640025
096500         SET                                                      09650025
096600             LAST_UPD_TMST            = CURRENT TIMESTAMP         09660025
096700         ,   LAST_UPD_BY_UID          = 'XLKUP007'                09670025
096800         ,   LEADTIME_DAYS_QTY        = :POAGMT-LEADTIME-DAYS-QTY 09680025
096900                                                                  09690025
097000     WHERE                                                        09700025
097100             PO_NBR                   = :POAGMT-PO-NBR            09710025
097200         AND AGRMT_TYP_ID             = :POAGMT-AGRMT-TYP-ID      09720025
097300         AND TYP_CDE                  = :POAGMT-TYP-CDE           09730025
097400         AND VER_STATUS_CDE           = 'A'                       09740025
097500     END-EXEC.                                                    09750025
097600                                                                  09760025
097700     MOVE SQLCODE                     TO XL011-SQLCODE            09770025
097800     EVALUATE TRUE                                                09780025
097900         WHEN SQLCODE = ZERO                                      09790025
098000             CONTINUE                                             09800025
098100         WHEN OTHER                                               09810025
098200             SET XL011-SQL-ERROR      TO TRUE                     09820025
098300     END-EVALUATE.                                                09830025
098400*PRB0053662-START                                                 09840026
098410 7560-UPDATE-VER-STATUS-CDE.                                      09841026
098420     IF XL011-DEBUG-YES                                           09842026
098430         DISPLAY 'XLKUP007 - 7560-UPDATE-VER-STATUS-CDE'          09843026
098440     END-IF                                                       09844026
098450                                                                  09845026
098460     MOVE '7560-UPDATE-VER-STATUS-CDE' TO XL011-ERROR-PARAGRAPH   09846026
098470     EXEC SQL                                                     09847026
098480     UPDATE TPOAGMT                                               09848026
098490         SET                                                      09849026
098491             VER_STATUS_CDE           = 'I'                       09849126
098492     WHERE                                                        09849226
098493             PO_NBR                   = :POAGMT-PO-NBR            09849326
098494         AND AGRMT_TYP_ID             = '2'                       09849426
098495         AND TYP_CDE                  = 0                         09849526
098496         AND VER_STATUS_CDE           = 'A'                       09849626
098497     END-EXEC.                                                    09849726
098498                                                                  09849826
098499     MOVE SQLCODE                     TO XL011-SQLCODE            09849926
098500     EVALUATE TRUE                                                09850026
098501         WHEN SQLCODE = ZERO                                      09850126
098503             CONTINUE                                             09850326
098504         WHEN OTHER                                               09850426
098505             SET XL011-SQL-ERROR      TO TRUE                     09850526
098506     END-EVALUATE.                                                09850626
098507*PRB0053662-END                                                   09850726
098510 7600-UPDATE-PAY-TERMS.                                           09851025
098600                                                                  09860025
098700     IF XL011-DEBUG-YES                                           09870025
098800         DISPLAY 'XLKUP007 - 7600-UPDATE-PAY-TERMS'               09880025
098900     END-IF                                                       09890025
099000                                                                  09900025
099100     MOVE '7600-UPDATE-PAY-TERMS'     TO XL011-ERROR-PARAGRAPH    09910025
099200     EXEC SQL                                                     09920025
099300     UPDATE TPOAGMT                                               09930025
099400         SET                                                      09940025
099500             LAST_UPD_TMST            = CURRENT TIMESTAMP         09950025
099600         ,   LAST_UPD_BY_UID          = 'XLKUP007'                09960025
099700         ,   PAYT_TERM_ID             = :POAGMT-PAYT-TERM-ID      09970025
099800                                                                  09980025
099900     WHERE                                                        09990025
100000             PO_NBR                   = :POAGMT-PO-NBR            10000025
100100         AND AGRMT_TYP_ID             = :POAGMT-AGRMT-TYP-ID      10010025
100200         AND TYP_CDE                  = :POAGMT-TYP-CDE           10020025
100300         AND VER_STATUS_CDE           = 'A'                       10030025
100400     END-EXEC.                                                    10040025
100500                                                                  10050025
100600     MOVE SQLCODE                     TO XL011-SQLCODE            10060025
100700     EVALUATE TRUE                                                10070025
100800         WHEN SQLCODE = ZERO                                      10080025
100900             CONTINUE                                             10090025
101000         WHEN OTHER                                               10100025
101100             SET XL011-SQL-ERROR      TO TRUE                     10110025
101200     END-EVALUATE.                                                10120025
101300                                                                  10130025
101400/                                                                 10140025
101500 8100-NUMERIC-EDIT.                                               10150025
101600     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                      10160025
101700     CALL DP010I-NUMERIC-EDIT-ROUTINE                             10170025
101800          USING DP010I-NUMERIC-EDIT-AREA                          10180025
101900     IF  DP010I-ERROR-DETECTED                                    10190025
102000         MOVE '8100-NUMERIC-EDIT'     TO XL011-ERROR-PARAGRAPH    10200025
102100     END-IF.                                                      10210025
102200/                                                                 10220025
102300 9999-WRAPUP.                                                     10230025
102400                                                                  10240025
102500     IF XL011-DEBUG-YES                                           10250025
102600         DISPLAY 'XLKUP007 - 9999-WRAPUP'                         10260025
102700     END-IF                                                       10270025
102800                                                                  10280025
102900     MOVE SQLCA                       TO XL011-SQLCA.             10290025
103000                                                                  10300025
