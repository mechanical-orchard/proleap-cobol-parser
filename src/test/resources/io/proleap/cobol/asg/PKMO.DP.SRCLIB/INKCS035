       IDENTIFICATION DIVISION.                                         INKCS035
       PROGRAM-ID.    INKCS035.                                            CL**1
       INSTALLATION.  KOHLS DEPARTMENT STORES.                             CL**1
       DATE-WRITTEN.  05/09/2001.                                          CL**1
       DATE-COMPILED.                                                      CL**1
                                                                           CL**1
      ******************************************************************   CL*27
      *PURPOSE:  UNPROCESSED ONLINE SHEET INVENTORY INQUIRY/SELECT TO      CL*27
      *          UPDATE CICS SCREEN. (INSTRSTC)                                 
      *                                                                         
      *          THE SCREEN IS ACCESSED FROM THE PHYSICAL INVENTORY MENU   CL*27
      *   INMENU. A CURSOR IS OPENED WHICH SELECTS STORES WE NEED TO       CL*27
      *   PROCESS SHEET INVENTORY FOR. THE SELECTED STORES ARE USED IN          
      *   BATCH SHEET INVENTORY SCHEDULE TO PROCESS SHEET INVENTORY.            
      *                                                                         
      *           A LIST IS DISPLAY FOR UNPROCESSED SHEET INVENTORY. THE   CL*27
      *   USER HAS THE OPTION TO SELECT THE STORE FOR SHEET PROCESSING,    CL*27
      *   F15. THE USER IS ABLE TO SELSECT ALL STORES, F21; AS WELL AS,    CL*27
      *   DESLECT OR REFRESH THE SCREEN (F9 OR F5) ONCE THE UPDATE KEY     CL*27
      *   IS SELECTED, THE CHANGES TO THE STORES WILL BE MADE.             CL*27
      *                                                                    CL*28
      *           F3 - END.                                                CL*28
      *           F4 - MAIN MENU.                                          CL*28
      *           F5 - REFRESH SCREEN.                                     CL*28
      *           F6 - 1ST PAGE.                                           CL*28
      *           F7 - PREVIOUS PAGE.                                      CL*28
      *           F8 - NEXT PAGE.                                          CL*28
      *           F9 - DESLECT ALL ITEMS.                                  CL*28
      *           F15 - UPDATE (PROCESS THE SELECT STORES FOR SHEETS)      CL*28
      *           F21 - SELECT ALL ITEMS.                                  CL*28
      *           F22 - PRINT THE ONLINE SHEETS NOT PROCESSED REPORT       CL*28
      *                                                                    CL*28
      *CHANGE HISTORY:                                                          
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES                             
      * -------  ----------  ----------------------------------------           
W05091* W05091   05-09-2001  AUTOMATED SHEET INVENTORY SELECTS                  
W05091*                      (CREATION.....)      -ROD JANSSEN                  
22000 * 22000    02-28-2001  CHANGE TO ALLOW ON-DEMAND SUBMISSION               
22000 *                      OF THE BATCH VERSION OF THIS STORE                 
22000 *                      STATUS REPORT.       -V. LEE YANG                  
SECRTY* SECRTY   08-28-2001  ONLY THOSE IN THE FUNCTION GROUP INUPDSHT          
SECRTY*                      CAN PERFORM UPDATES  -ROD JANSSEN                  
22055 * 22055    01-22-2002  INCLUDE DC AND ONLY DISPLAYS STORE WITH            
22055 *                      SHEETS ENTERED       -ROD JANSSEN                  
      * 22960    01-30-2002  CORRECT BATCH JOB SUBMITTED TO INCLUDE             
      *                      EOF AT THE END OF JOB, SO IT WILL EXECUTE          
      *                      RIGHT AWAY.                                        
      *                                           -V. LEE YANG                  
020402* 22960    02-04-2002  COMMENTED OUT LOGIC IN ONLINE-SHEETS-CSR           
020402*                      CURSOR AND REPLACED IT SO THAT ANY STORE           
020402*                      THAT HASN'T PROCESSED SHEETS, WILL SHOW UP         
020402*                      FOR SHEET SELECTION  -RONNA BUTZ                   
23511 * 23511    04-02-2002  BUILD IN CURSOR EFFICIENCIES                       
23511 *                                           -ROD JANSSEN                  
      * 23511C   05-03-2002  CHANGE TO ALLOW THE VIEWING OF WHETHER A           
      *                      A STORE HAS ENTERED INVENTORY SHEETS 14            
      *                      DAYS BEFORE PLANNED INVENTORY DATE.                
      *                                           -CAROL WOJCIECHOWSKI          
      * W23511   06-29-2002  DRIVING CURSOR WAS NOT BRING UP STORE 870          
      *                      AS A CANDIDATE FOR SHEET PROCESSING. ALTER         
      *                      CSR BY REMOVING 2 CONDITIONS.                      
      *                                           -SCOTT JACKSON                
      * 23511C   07-03-2002  CHANGE TO LOOK AT THE INVENTORY RECEIVED           
      *                      DATE TO BE ABLE TO SELECT TO PROCESS               
      *                      INVENTORY SHEETS.                                  
      *                                           -CAROL WOJCIECHOWSKI          
      * W24521   03-31-2003  REMOVE JOBCARD REFERENCES TO UCC11 UTILITY         
      *                                           -SCOTT JACKSON                
W26600* W26600   07-  -2004  PHYSICAL INVENTORY STORE EXPANSION                 
W26600*                      M JOHNSON                                          
      * W26006   02-24-2005  REMOVE REFERENCES TO OBSOLETE STORE TABLE.         
      *                      ERIN SEARL                                         
W28545* W28545   08-22-2005  ROD JANSSEN THE NEW TRANSFER PROCESS               
      * W29908   01-23-2006  LEE YANG ADD PKMO.PROCLIB TO THE JCLLIB            
W28545* W28545   08-10-2006  ADD LOGIC FOR DEPARTMENT LEVEL                     
W28545*                      INVENTORY PROCESS. JOIN TINVPAR/TINCNTL            
W28545*                      -B. GRAHAM - STRATAGEM                             
      * W33304   06-05-2008  HOLDING INVENTORY LEDGER OPEN ACROSS               
      *                      PERIODS INVENTORY SHORTAGE REPORTING               
      *                      -J. LIN                                            
      ******************************************************************   CL*27
263126* CHANGED 10/25/2021    BY JIM HUNTER      WR: CHG0263126                 
263126* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263126* MAKING THE CALL DYNAMIC VS STATIC.                                      
      ******************************************************************        
1122RM* CHANGED 11/03/2022    BY BOB MCASEY      WR: CHG0277188                 
1122RM* ADDED THE DPKCS930 COPYBOOK. CHANGED THE PARAMETERS FOR CALLING         
1122RM* THE CICS ARCHITECTURE API.                                              
1122RM*---------------------------------------------------------------*         
                                                                           CL**1
       ENVIRONMENT DIVISION.                                               CL**1
       DATA DIVISION.                                                      CL**1
       WORKING-STORAGE SECTION.                                            CL**1
                                                                           CL**1
22000  01  TD-TRANSIENT-DATA-AREA.                                              
22000      05  TD-QUEUE-NAME           PIC X(4)     VALUE 'IRTD'.               
22000      05  TD-QUEUE-NAME-LENGTH    PIC S9(4)    VALUE +4                    
22000                                  COMP SYNC.                               
22000      05  TD-JCL-LINE             PIC X(80)    VALUE SPACES.               
22000      05  TD-JCL-LINE-LENGTH      PIC S9(4)    VALUE +80                   
22000                                  COMP SYNC.                               
22000                                                                           
22000  01  JL-JCL-WORK-AREA.                                            INKCS046
22000      05  JL-JCL-INK309-LINE-1.                                            
22000          10  FILLER                     PIC X(02)    VALUE '//'.          
22000          10  JL-JCL-INK309-JOBNAME      PIC X(08)    VALUE SPACES.        
22000          10  FILLER REDEFINES JL-JCL-INK309-JOBNAME.                      
22000              15  FILLER                 PIC X(07).                        
22000              15  JL-JCL-INK309-JOB-UNQ  PIC X(01).                        
22000          10  FILLER                     PIC X(11)    VALUE                
22000              ' JOB KOHLS,'.                                               
22000          10  FILLER                     PIC X(01)    VALUE QUOTE.         
22000          10  FILLER                     PIC X(18)    VALUE                
22000              'INV STR STATUS RPT'.                                        
22000          10  FILLER                     PIC X(01)    VALUE QUOTE.         
22000          10  FILLER                     PIC X(01)    VALUE ','.           
22000      05  JL-JCL-INK309-LINE-2.                                            
22000          10  FILLER                     PIC X(21)    VALUE                
22000              '//             CLASS='.                                     
22000          10  JL-JCL-INK309-JOBCLASS     PIC X(01)    VALUE 'Q'.           
22000          10  FILLER                     PIC X(10)    VALUE                
22000              ',MSGCLASS='.                                                
22000          10  JL-JCL-INK309-MSGCLASS     PIC X(01)    VALUE 'P'.           
22000          10  JL-JCL-INK309-NOTIFY-OPT   PIC X(16)    VALUE SPACES.        
22000      05  JL-JCL-INK309-LINE-3.                                            
22000          10  FILLER                     PIC X(13)    VALUE                
22000              '/*JOBPARM K=0'.                                             
22000      05  JL-JCL-INK309-CMT-SHORT.                                         
22000          10  FILLER                     PIC X(03)    VALUE '//*'.         
22000      05  JL-JCL-INK309-CMT-LONG.                                          
22000          10  FILLER                     PIC X(40)    VALUE                
22000              '//**************************************'.          ********
22000          10  FILLER                     PIC X(32)    VALUE                
22000              '********************************'.                  ********
22000      05  JL-JCL-INK309-CMT-USER-INFO.                                     
22000          10  FILLER                     PIC X(26)    VALUE                
22000              '//* INK309 - SUBMITTED BY '.                                
22000          10  JL-JCL-INK309-CMT-USRID    PIC X(08)    VALUE SPACES.        
22000          10  FILLER                     PIC X(06)    VALUE                
22000              ' FROM '.                                                    
22000          10  JL-JCL-INK309-CMT-REGION   PIC X(08)    VALUE SPACES.        
22000          10  FILLER                     PIC X(04)    VALUE                
22000              ' ON '.                                                      
22000          10  JL-JCL-INK309-CMT-SUBDATE  PIC X(10)    VALUE SPACES.        
22000          10  FILLER                     PIC X(02)    VALUE SPACES.        
22000          10  JL-JCL-INK309-CMT-SUBTIME  PIC X(08)    VALUE SPACES.        
22000      05  JL-JCL-INK309-CMT-1.                                             
22000          10  FILLER                     PIC X(40)    VALUE                
22000              '//* THIS JOB PRODUCES VARIOUS SECTION OF'.          ********
22000          10  FILLER                     PIC X(32)    VALUE                
22000              'THE INVENTORY STORE STATUS      '.                  ********
22000      05  JL-JCL-INK309-CMT-2.                                             
22000          10  FILLER                     PIC X(40)    VALUE                
22000              '//* REPORT AND PRINT THEM AT THE USER DE'.          ********
22000          10  FILLER                     PIC X(32)    VALUE                
22000              'FAULT PRINT DESTINATION OR      '.                  ********
22000      05  JL-JCL-INK309-CMT-3.                                             
22000          10  FILLER                     PIC X(40)    VALUE                
22000              '//* LOCAL, IF THERE IS NO DEFAULT PRINTE'.          ********
22000          10  FILLER                     PIC X(32)    VALUE                
22000              'R DEFINED TO THE USER.          '.                  ********
22000      05  JL-JCL-INK309-CMT-4.                                             
22000          10  FILLER                     PIC X(22)    VALUE                
22000              '//* OPTION REQUESTED: '.                            ********
22000          10  JL-JCL-INK309-CMT-OPTION   PIC X(20)    VALUE SPACES.        
22000      05  JL-JCL-INK309-LINE-10.                                           
22000          10  FILLER                     PIC X(39)    VALUE                
22000              '//JOBLIB   DD DSN=PKMO.LOADLIB,DISP=SHR'.                   
22000      05  JL-JCL-INK309-LINE-12.                                           
22000          10  FILLER                     PIC X(32)    VALUE                
22000              '//PS020    EXEC INK3091,PRTDEST='.                          
22000          10  JL-JCL-INK309-PRTDEST      PIC X(08)    VALUE                
22000              'LOCAL'.                                                     
22000      05  JL-JCL-INK309-LINE-13.                                           
22000          10  FILLER                     PIC X(20)    VALUE                
22000              '//S010.SYSUT1   DD *'.                                      
22000      05  JL-JCL-INK309-LINE-14.                                           
W26600         10  FILLER                     PIC X(04)    VALUE                
W26600             'RPT'.                                                       
22000          10  JL-JCL-INK309-REQ-OPTION   PIC X(16)    VALUE SPACES.        
W26600         10  FILLER                     PIC X(01)    VALUE SPACE.         
W26600         10  JL-REQ-USERID              PIC X(08)    VALUE SPACE.         
22000      05  JL-JCL-INK309-LINE-EOD.                                          
22000          10  FILLER                     PIC X(02)    VALUE '/*'.          
22960      05  JL-JCL-INK309-LINE-EOF.                                          
22960          10  FILLER                     PIC X(05)    VALUE                
22960              '/*EOF'.                                                     
22000      05  JL-JCL-TEST-LINE-10.                                             
22000          10  FILLER                     PIC X(35)    VALUE                
22000              '//PROCS  JCLLIB ORDER=(TKMA.PROCLIB'.                       
W29908         10  FILLER                     PIC X(19)    VALUE                
W29908             ',QKMO.PROCLIB.STAGE'.                                       
W29908         10  FILLER                     PIC X(18)    VALUE                
W29908             ',PKMO.PROCLIB)'.                                            
22000      05  JL-JCL-TEST-LINE-11A.                                            
22000          10  FILLER                     PIC X(39)    VALUE                
22000              '//JOBLIB   DD DSN=TKMA.LOADLIB,DISP=SHR'.                   
22000      05  JL-JCL-TEST-LINE-11B.                                            
22000          10  FILLER                     PIC X(39)    VALUE                
22000              '//         DD DSN=QKMO.LOADLIB,DISP=SHR'.                   
22000      05  JL-JCL-TEST-LINE-11C.                                            
22000          10  FILLER                     PIC X(39)    VALUE                
22000              '//         DD DSN=PKMO.LOADLIB,DISP=SHR'.                   
22000      05  JL-JCL-TEST-NOTIFY.                                              
22000          10  FILLER                     PIC X(08)    VALUE                
22000              ',NOTIFY='.                                                  
22000          10  JL-JCL-TEST-USER           PIC X(08)    VALUE SPACES.        
22000                                                                   INKCS046
W26600******************************************************************        
W26600 01  NI-NULL-INDICATORS.                                                  
W26600     05  NI-LOC-10-ABBR-NM           PIC S9(04)      VALUE +0     INKCS046
W26600                                                     COMP.                
W26600                                                                          
       01  PC-PROGRAM-CONSTANTS.                                           CL**1
           05  PC-ITEM-NUMBER-LENGTH          PIC S9(04)  VALUE +5         CL**1
                                                          COMP SYNC.       CL**1
           05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE            CL**1
                                                          'IN035A  '.      CL**1
           05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE            CL**1
                                                          'INKM035 '.      CL**1
           05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE            CL**1
                                                          'INKCS035'.      CL**1
           05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.         CL**1
           05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.         CL**1
           05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14        CL**1
                                                          COMP SYNC.       CL**1
           05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2         CL**1
                                                          COMP SYNC.       CL**1
           05  PC-MAX-ITEMS                   PIC S9(09)  VALUE            CL**1
                                                          +1000000         CL**1
                                                          COMP-3.          CL**1
           05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       INKCS046
                                                          COMP-3.       INKCS046
           05  PC-ADD                         PIC  X(03)  VALUE 'ADD'.     CL**1
           05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.     CL**1
           05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.     CL**1
           05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.     CL**1
           05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.     CL**1
           05  PC-TSYMSG-NUMBERS.                                          CL**1
               10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.     CL**1
               10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.     CL**1
SECRTY         10  PC-TSYMSG-00045            PIC  9(05)  VALUE 00045.  INKCS048
               10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.     CL**1
               10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.     CL**1
               10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.     CL**1
               10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.     CL**1
               10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.     CL**1
               10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.     CL**1
               10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.     CL**1
               10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.     CL*15
               10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.     CL*15
               10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.     CL**1
22000          10  PC-TSYMSG-00098            PIC  9(05)  VALUE 00098.  INKCS046
               10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.     CL**1
               10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.     CL**1
               10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.     CL**1
               10  PC-TSYMSG-00831            PIC  9(05)  VALUE 00831.     CL**1
22000                                                                   INKCS046
22000      05  PC-PRINT-ALL-RPT               PIC  X(16)  VALUE         INKCS046
22000          'ALL REPT        '.                                              
22000      05  PC-PRINT-LOCATION              PIC  X(16)  VALUE         INKCS046
22000          'LOCATION        '.                                              
22000      05  PC-PRINT-SCANNED-INV           PIC  X(16)  VALUE         INKCS046
22000          'SCANNED INV     '.                                              
22000      05  PC-PRINT-SHEETS                PIC  X(16)  VALUE         INKCS046
22000          'SHEETS          '.                                              
22000      05  PC-PRINT-INVALIDS              PIC  X(16)  VALUE         INKCS046
22000          'INVALIDS        '.                                              
22000      05  PC-PRINT-STOCKROOM             PIC  X(16)  VALUE         INKCS046
22000          'STOCKROOM       '.                                              
22000      05  PC-PRINT-SALES-ADJUSTMENT      PIC  X(16)  VALUE         INKCS046
22000          'SALES ADJUSTMENT'.                                              
22000      05  PC-PRINT-BOOKING-NOT-CPLD      PIC  X(16)  VALUE         INKCS046
22000          'BOOKING NOT CPLD'.                                              
22000      05  PC-PRINT-BOOKING-CPLD          PIC  X(16)  VALUE         INKCS046
22000          'BOOKING COMPLETE'.                                              
           05  PC-INCOMPLETE-DTE              PIC  X(10)  VALUE         INKCS046
                                                        '9999-09-09'.   INKCS046
           05  PC-COMPANY                     PIC  X(02)  VALUE '03'.           
           05  PC-CS                          PIC  X(02)  VALUE 'CS'.   INKCS046
           05  PC-C                           PIC  X(01)  VALUE 'C'.    INKCS046
           05  PC-N                           PIC  X(01)  VALUE 'N'.    INKCS046
           05  PC-Y                           PIC  X(01)  VALUE 'Y'.    INKCS046
           05  PC-S                           PIC  X(01)  VALUE 'S'.    INKCS046
SECRTY     05  PC-CRITERIA-PROCESSING         PIC  X(08)  VALUE                 
SECRTY                                                    'INUPDSHT'.           
SECRTY                                                                  INKCS046
SECRTY 01  PM-CICSAUTH-MESSAGE.                                                 
SECRTY     05  FILLER                         PIC  X(36)  VALUE                 
SECRTY         'INVALID RETURN CODE FROM CICSAUTH - '.                          
SECRTY     05  PM-CM-RETURN-CODE              PIC  9(04)  VALUE ZERO.           
SECRTY                                                                          
       01  PS-PROGRAM-SWITCHES.                                            CL**1
           05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.       CL**1
               88  PS-NO-ERROR                            VALUE 'Y'.       CL**1
               88  PS-ERROR                               VALUE 'N'.       CL**1
           05  PS-START-ITEM-ERROR-SW         PIC  X(01)  VALUE 'Y'.       CL**1
               88  PS-NO-START-ITEM-ERROR                 VALUE 'Y'.       CL**1
               88  PS-START-ITEM-ERROR                    VALUE 'N'.       CL**1
           05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.       CL**1
               88  PS-DONE                                VALUE 'Y'.       CL**1
               88  PS-NOT-DONE                            VALUE 'N'.       CL**1
           05  PS-MORE-CURSOR-TINVPAR-ROWS-SW PIC  X(01)  VALUE 'N'.       CL*22
               88  PS-MORE-CURSOR-TINVPAR-ROWS            VALUE 'Y'.       CL*17
               88  PS-NO-MORE-CURSOR-TINVPAR-ROWS         VALUE 'N'.       CL*17
22000      05  PS-INTERNAL-READER-ENQ-DEQ-IND PIC X(1)    VALUE 'D'.            
22000          88  PS-INTERNAL-READER-ENQUEUED            VALUE 'E'.            
22000          88  PS-INTERNAL-READER-DEQUEUED            VALUE 'D'.            
           05  PS-TINENTY-FOUND-SW            PIC  X(01)  VALUE 'N'.    INKCS046
               88  PS-TINENTY-FOUND                       VALUE 'Y'.    INKCS046
               88  PS-TINENTY-NOT-FOUND                   VALUE 'N'.    INKCS046
           05  PS-TINVDTL-FOUND-SW            PIC  X(01)  VALUE 'N'.    INKCS046
               88  PS-TINVDTL-FOUND                       VALUE 'Y'.    INKCS046
               88  PS-TINVDTL-NOT-FOUND                   VALUE 'N'.    INKCS046
           05  PS-TSTKRMW-FOUND-SW            PIC  X(01)  VALUE 'N'.    INKCS046
               88  PS-TSTKRMW-FOUND                       VALUE 'Y'.    INKCS046
               88  PS-TSTKRMW-NOT-FOUND                   VALUE 'N'.    INKCS046
                                                                           CL*17
       01  PV-PROGRAM-VARIABLES.                                           CL*17
22000      05  PV-CICS-ID.                                                      
22000          10  PV-FIRST-4              PIC X(4)       VALUE SPACES.         
22000          10  PV-CICS-REGION-TYPE     PIC X          VALUE SPACE.          
22000              88  PV-CICS-REGION-PRODUCTION          VALUE 'P'.            
22000              88  PV-CICS-REGION-ACCEPTANCE          VALUE 'A'.            
22000              88  PV-CICS-REGION-QUALITY             VALUE 'Q'.            
22000              88  PV-CICS-REGION-LEARNING            VALUE 'L'.            
22000              88  PV-CICS-REGION-TEST                VALUE 'T'.            
22000              88  PV-CICS-REGION-SYSTEST             VALUE 'S'.            
22000          10  PV-CICS-REGION-CODE     PIC X          VALUE SPACES.         
22000          10  PV-LAST-2               PIC X(2)       VALUE SPACES.         
           05  PV-SUB                         PIC S9(04)  VALUE +0         CL*17
                                                          COMP SYNC.       CL**1
           05  PV-REMAINDER                   PIC S9(04)  VALUE +0         CL**8
                                                          COMP SYNC.       CL**8
           05  PV-READ-COUNT                  PIC S9(09)  VALUE +0         CL**1
                                                          COMP-3.          CL**1
           05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0         CL**1
                                                          COMP-3.          CL**1
           05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      INKCS046
                                                          COMP SYNC.    INKCS046
           05  PV-CURRENT-DATE                PIC X(10)   VALUE SPACE.  INKCS046
23511C     05  PV-CURRENT-DATE-CCYY-MM-DD.                              INKCS046
23511C         10  PV-CURRENT-DATE-CCYY       PIC X(4)    VALUE SPACES. INKCS046
23511C         10  FILLER                     PIC X       VALUE '-'.    INKCS046
23511C         10  PV-CURRENT-DATE-MM         PIC X(2)    VALUE SPACES. INKCS046
23511C         10  FILLER                     PIC X       VALUE '-'.    INKCS046
23511C         10  PV-CURRENT-DATE-DD         PIC X(2)    VALUE SPACES. INKCS046
           05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0         CL**1
                                                          COMP-3.          CL**1
           05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0         CL**1
                                                          COMP-3.          CL**1
           05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0         CL**1
                                                          COMP-3.          CL**1
           05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0         CL**1
                                                          COMP-3.          CL**1
           05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0         CL**1
                                                          COMP-3.          CL**1
           05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0         CL**1
                                                          COMP SYNC.       CL**1
           05  PV-CICS-RESP                   PIC S9(04)  VALUE +0         CL**1
                                                          COMP SYNC.       CL**1
W26600*    05  PV-NUM-STORE                   PIC 9(03)   VALUE ZERO.   INKCS046
           05  PV-ITEM                        PIC S9(04)  VALUE +0         CL**1
                                                          COMP SYNC.       CL**1
           05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0         CL**1
                                                          COMP SYNC.       CL**1
           05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0         CL**1
                                                          COMP SYNC.       CL**1
           05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0         CL**1
                                                          COMP SYNC.       CL**1
           05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0         CL**1
                                                          COMP SYNC.       CL**1
           05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0         CL**1
                                                          COMP SYNC.       CL**1
           05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0         CL**1
                                                          COMP SYNC.       CL**1
           05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0         CL**1
                                                          COMP SYNC.       CL**1
           05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0         CL**1
                                                          COMP SYNC.       CL**1
           05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0         CL**1
                                                          COMP SYNC.       CL**1
           05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0         CL**1
                                                          COMP SYNC.       CL**1
           05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0         CL**1
                                                          COMP SYNC.       CL**1
           05  PV-SUM-ITM-EXTD-AMT            PIC S9(7)V99 COMP-3.         CL**1
22000      05  PV-SQL-TINENTY-DATE-CHECK      PIC X(10)   VALUE SPACES.         
22000      05  PV-SQL-TADJDTL-DATE-CHECK      PIC X(10)   VALUE SPACES.         
           05  PV-STKRM-WITHD-DAYS-LEFT       PIC S9(09)  VALUE +0      INKCS046
                                                          COMP SYNC.    INKCS046
           05  PV-LITERAL                     PIC X(01)   VALUE SPACE.  INKCS046
                                                                           CL**1
      ******************************************************************   CL**1
      **  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **   CL**1
      **  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **   CL**1
      **  APPLICATION-SPECIFIC COMMAREA.                              **   CL**1
      ******************************************************************   CL**1
       01  LQW-LIST-QUEUE-WORK-AREA.                                       CL**1
           05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.     CL**1
           05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES              CL**1
                                              INDEXED BY LQW-IDX.          CL**1
               10  LQW-LIST-ITEM-NUMBER   PIC S9(09)  COMP-3.              CL**1
               10  LQW-TEMP-SELECTED-SW   PIC  X(01).                      CL**1
               10  LQW-SELECTED-SW        PIC  X(01).                      CL**1
                   88  LQW-SELECT         VALUE 'S'.                       CL**1
                   88  LQW-DESELECT       VALUE ' '.                       CL**1
               10  LQW-ACTION             PIC X(03).                       CL**6
W26600         10  LQW-STORE-NUMBER       PIC 9(04).                    INKCS046
               10  LQW-STORE-NAME         PIC X(10).                    INKCS046
               10  LQW-LOC-TYPE           PIC X(06).                    INKCS046
               10  LQW-ACT-INV-DTE        PIC X(10).                    INKCS046
               10  LQW-ACT-RECD-DATE      PIC X(08).                    INKCS046
               10  LQW-ON-LINE-SHEET      PIC X(09).                    INKCS046
               10  LQW-SALES-ADJUST       PIC X(09).                    INKCS046
               10  LQW-UNIT-BOOKING       PIC X(12).                    INKCS046
23511C         10  LQW-ACT-RECD-DTE       PIC X(10).                    INKCS046
                                                                           CL**1
      *---------------------------------------------------------------*    CL**1
      *  RECORD LAYOUT FOR THE SELECTION                                   CL**1
      *  TEMP STORAGE QUEUE.                                          *    CL**1
      *---------------------------------------------------------------*    CL**1
           COPY INWS035.                                                   CL*29
                                                                           CL**1
      *---------------------------------------------------------------*    CL**1
      *    MAP LAYOUT                                                 *    CL**1
      *---------------------------------------------------------------*    CL**1
           COPY INKM035.                                                   CL**1
                                                                           CL**1
       01  MR-OCCURS-LAYOUT                   REDEFINES  IN035AO.          CL**1
           05  FILLER                         PIC X(42).                   CL**1
           05  MR-SCROLL-AREA                 OCCURS 14 TIMES.             CL**1
               10  MR-SELECTL                 PIC S9(04) COMP.             CL**1
               10  MR-SELECTA                 PIC  X(01).                  CL**1
               10  MR-SELECTC                 PIC  X(01).                  CL**1
               10  MR-SELECTH                 PIC  X(01).                  CL**1
               10  MR-SELECTI                 PIC  X(01).                  CL**1
                                                                           CL**1
               10  MR-ACTIONL                 PIC S9(04) COMP.             CL**1
               10  MR-ACTIONA                 PIC  X(01).                  CL**1
               10  MR-ACTIONC                 PIC  X(01).                  CL**1
               10  MR-ACTIONH                 PIC  X(01).                  CL**1
               10  MR-ACTION                  PIC  X(03).                  CL**1
                                                                           CL**1
               10  MR-STOREL                  PIC S9(04) COMP.                  
               10  MR-STOREA                  PIC  X(01).               INKCS046
               10  MR-STOREC                  PIC  X(01).               INKCS046
               10  MR-STOREH                  PIC  X(01).               INKCS046
W26600         10  MR-STORE                   PIC  X(04).               INKCS046
                                                                        INKCS046
               10  MR-STORE-NAMEL             PIC S9(04) COMP.          INKCS046
               10  MR-STORE-NAMEA             PIC  X(01).               INKCS046
               10  MR-STORE-NAMEC             PIC  X(01).               INKCS046
               10  MR-STORE-NAMEH             PIC  X(01).               INKCS046
               10  MR-STORE-NAME              PIC  X(10).               INKCS046
                                                                        INKCS046
               10  MR-LOC-TYPEL               PIC S9(04) COMP.          INKCS046
               10  MR-LOC-TYPEA               PIC  X(01).               INKCS046
               10  MR-LOC-TYPEC               PIC  X(01).               INKCS046
               10  MR-LOC-TYPEH               PIC  X(01).               INKCS046
W26600         10  MR-LOC-TYPE                PIC  X(05).               INKCS046
                                                                        INKCS046
               10  MR-ACT-INV-DTEL            PIC S9(04) COMP.          INKCS046
               10  MR-ACT-INV-DTEA            PIC  X(01).               INKCS046
               10  MR-ACT-INV-DTEC            PIC  X(01).               INKCS046
               10  MR-ACT-INV-DTEH            PIC  X(01).               INKCS046
               10  MR-ACT-INV-DTE             PIC  X(05).               INKCS046
                                                                        INKCS046
               10  MR-ACT-RECD-DATEL          PIC S9(04) COMP.          INKCS046
               10  MR-ACT-RECD-DATEA          PIC  X(01).               INKCS046
               10  MR-ACT-RECD-DATEC          PIC  X(01).               INKCS046
               10  MR-ACT-RECD-DATEH          PIC  X(01).               INKCS046
               10  MR-ACT-RECD-DATE           PIC  X(08).               INKCS046
                                                                        INKCS046
               10  MR-ONLINE-SHEETL           PIC S9(04) COMP.          INKCS046
               10  MR-ONLINE-SHEETA           PIC  X(01).               INKCS046
               10  MR-ONLINE-SHEETC           PIC  X(01).               INKCS046
               10  MR-ONLINE-SHEETH           PIC  X(01).               INKCS046
               10  MR-ONLINE-SHEET            PIC  X(09).               INKCS046
                                                                        INKCS046
               10  MR-SLE-ADJ-DATEL        PIC S9(04) COMP.             INKCS046
               10  MR-SLE-ADJ-DATEA        PIC  X(01).                  INKCS046
               10  MR-SLE-ADJ-DATEC        PIC  X(01).                  INKCS046
               10  MR-SLE-ADJ-DATEH        PIC  X(01).                  INKCS046
               10  MR-SLE-ADJ-DATE         PIC  X(09).                  INKCS046
                                                                        INKCS046
               10  MR-UNT-BK-DATEL         PIC S9(04) COMP.             INKCS046
               10  MR-UNT-BK-DATEA         PIC  X(01).                  INKCS046
               10  MR-UNT-BK-DATEC         PIC  X(01).                  INKCS046
               10  MR-UNT-BK-DATEH         PIC  X(01).                  INKCS046
               10  MR-UNT-BK-DATE          PIC  X(12).                  INKCS046
                                                                           CL**1
      *---------------------------------------------------------------*    CL**1
      *    ATTRIBUTE SETTINGS COPYBOOK.                               *    CL**1
      *---------------------------------------------------------------*    CL**1
           COPY DPWS015.                                                   CL**1
                                                                           CL**1
      *---------------------------------------------------------------*    CL**8
      *    DATE / TIME COPYBOOK.                                      *    CL**8
      *---------------------------------------------------------------*    CL**8
           COPY DPWS017.                                                   CL**8
                                                                           CL**8
      *---------------------------------------------------------------*    CL**1
      *    FUNCTION KEYS COPYBOOK.                                    *    CL**1
      *---------------------------------------------------------------*    CL**1
           COPY DPWS016.                                                   CL**1
                                                                           CL**1
      *---------------------------------------------------------------*    CL**1
      *    NUMERIC EDIT LAYOUT.                                       *    CL**1
      *---------------------------------------------------------------*    CL**1
           COPY DPWS010I.                                                  CL**1
                                                                           CL**1
      *---------------------------------------------------------------*    CL**1
      *    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   *    CL**1
      *---------------------------------------------------------------*    CL**1
           COPY DPWS030.                                                   CL**1
1122RM     COPY DPWS930.                                                   CL**1
                                                                           CL**1
      *---------------------------------------------------------------*    CL**1
      *    STANDARD COMMAREA.                                         *    CL**1
      *---------------------------------------------------------------*    CL**1
           COPY DPWS020.                                                   CL**1
           05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                   CL**1
                                                                           CL**1
      *---------------------------------------------------------------*    CL**1
      *  INTER-APPLICATION COMMAREA.                                       CL**1
      *---------------------------------------------------------------*    CL**1
             10  INTER-APPL-COMM-AREA       PIC X(200).                    CL**1
                                                                                
      *----------------------------------------------------------------*07/07/94
      *   THIS IS THE INTER-APPLICATION COMMUNICATIONS WORK AREA       *ETWS307 
      *   USED IN THE EDI VENDOR DETAILS SUB-SYSTEM.                   *ETWS307 
      *----------------------------------------------------------------*ETWS307 
             10  IN035-INTER-APPL-COMMAREA   REDEFINES                  ETWS307 
                 INTER-APPL-COMM-AREA.                                  ETWS307 
                 15  IN035-NUMBER-OF-SELECTED-ITEMS PIC S9(09)             CL**4
                                                  COMP-3.                  CL**4
                 15  IN035-NUMBER-OF-TS-ITEMS PIC S9(05)                   CL**4
                                                  COMP-3.                  CL**4
                 15  IN035-SEL-QUEUE-NAME     PIC X(8).                    CL**4
23511C           15  FILLER                   PIC X(184).                  CL*10
                                                                        ETWS307 
      *---------------------------------------------------------------*    CL**1
      *  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   *    CL**1
      *---------------------------------------------------------------*    CL**1
               10  ASC-SPECIFIC-COMMAREA.                                  CL**1
                   15  ASC-TODAYS-DATE-YMD                 PIC 9(06).      CL**6
                   15  ASC-TODAYS-DATE-YYYYMMDD            PIC 9(08).      CL**6
23511C             15  ASC-TODAYS-DATE-YYYYMMDD-PARTS  REDEFINES           CL**6
23511C                    ASC-TODAYS-DATE-YYYYMMDD.                        CL**6
23511C                 20  ASC-TODAYS-DATE-YYYY            PIC  X(04).     CL**1
23511C                 20  ASC-TODAYS-DATE-MM              PIC  X(02).     CL**1
23511C                 20  ASC-TODAYS-DATE-DD              PIC  X(02).     CL**1
                   15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                   CL**6
                       20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).     CL**1
                           88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.      CL**1
                           88  ASC-BLOCK-MODIFIED          VALUE 'Y'.      CL**1
                                                                           CL**1
                       20  ASC-ITEM-ARRAY.                                 CL**1
                           25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.           CL**1
                               30  ASC-LIST-ITEM-NUMBER                    CL**1
                                                           PIC S9(09)      CL**1
                                                           COMP-3.         CL**1
                               30  ASC-TEMP-SELECTED-SW    PIC  X(01).     CL**1
                                   88  ASC-VALID-SELECT    VALUE ' '       CL**1
                                                                 'S'       CL**1
                                                                 'B'       CL**1
                                                                 'E'.      CL**1
                                   88  ASC-TEMP-NO-SELECT  VALUE ' '.      CL**1
                                   88  ASC-TEMP-SELECT     VALUE 'S'.      CL**1
                                   88  ASC-TEMP-BEGIN      VALUE 'B'.      CL**1
                                   88  ASC-TEMP-END        VALUE 'E'.      CL**1
                               30  ASC-SELECTED-SW    PIC  X(01).          CL**6
                                   88  ASC-NO-SELECT       VALUE ' '.      CL**1
                                   88  ASC-SELECT          VALUE 'S'.      CL**1
                                   88  ASC-BEGIN           VALUE 'B'.      CL**1
                                   88  ASC-END             VALUE 'E'.      CL**1
                               30  ASC-ACTION         PIC X(03).           CL**6
W26600                         30  ASC-STORE-NUMBER   PIC 9(04).        INKCS046
                               30  ASC-STORE-NAME     PIC X(10).        INKCS046
                               30  ASC-LOC-TYPE       PIC X(06).        INKCS046
                               30  ASC-ACT-INV-DTE    PIC X(10).        INKCS046
                               30  ASC-ACT-RECD-DATE  PIC X(08).        INKCS046
                               30  ASC-ON-LINE-SHEET  PIC X(09).        INKCS046
                               30  ASC-SALES-ADJUST   PIC X(09).        INKCS046
                               30  ASC-UNIT-BOOKING   PIC X(12).        INKCS046
23511C                         30  ASC-ACT-RECD-DTE   PIC X(10).        INKCS046
                                                                           CL**1
                   15  ASC-BLK-SUB                         PIC S9(04)      CL**1
                                                                COMP       CL**1
                                                                SYNC.      CL**1
                   15  ASC-ITEM-SUB                        PIC S9(04)      CL**1
                                                                COMP       CL**1
                                                                SYNC.      CL**1
                   15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)      CL**1
                                                                COMP-3.    CL**1
                   15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)      CL**1
                                                                COMP-3.    CL**1
                   15  ASC-ITEMS-DISPLAYED                 PIC S9(03)      CL**1
                                                                COMP-3.    CL**1
                   15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)      CL**1
                                                                COMP-3.    CL**1
                   15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)      CL**1
                                                                COMP-3.    CL**1
                   15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)      CL**1
                                                                COMP       CL**1
                                                                SYNC.      CL**1
                   15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)      CL**1
                                                                COMP-3.    CL**1
                   15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)      CL**1
                                                                COMP-3.    CL**1
                   15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).     CL**1
                       88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.      CL**1
                       88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.      CL**1
                   15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).     CL**1
                       88  ASC-UPDATE-TSQ                  VALUE 'Y'.      CL**1
                       88  ASC-NO-TSQ-UPDATE               VALUE ' '.      CL**1
                   15  ASC-LIST-QUEUE-NAME.                                CL**1
                       20  ASC-LIST-TERM-ID                PIC  X(04).     CL**1
                       20  ASC-LIST-TASK-NUMBER            PIC S9(05)      CL**1
                                                                COMP-3.    CL**1
                       20  ASC-LIST-SEQ                    PIC  9(01).     CL**1
                   15  ASC-SEL-QUEUE-NAME.                                 CL**1
                       20  ASC-SEL-TERM-ID                 PIC  X(04).     CL**1
                       20  ASC-SEL-TASK-NUMBER             PIC S9(05)      CL**1
                                                                COMP-3.    CL**1
                       20  ASC-SEL-SEQ                     PIC  9(01).     CL**1
                                                                           CL**1
                   15  ASC-SEL-SUB                 PIC S9(04) COMP.        CL*14
                   15  ASC-SEL-ITEM                PIC S9(04) COMP.        CL*14
                   15  ASC-NUMBER-OF-TS-ITEMS      PIC S9(05) COMP-3.      CL*14
                   15  ASC-START-ITEM-REQUEST.                          INKCS046
                       20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  INKCS046
                   15  ASC-INT-APPL-FORMAT-IND       PIC  X(01).        INKCS046
                       88  ASC-ALL-LOC-INQ           VALUE 'A'.         INKCS046
                       88  ASC-SCANNED-INV-NP        VALUE 'B'.         INKCS046
                       88  ASC-ONLINE-SHEETS-NP      VALUE 'C'.         INKCS046
                       88  ASC-INVALIDS-NOT-CORR     VALUE 'D'.         INKCS046
                       88  ASC-STCKRM-WITHDRWL-NE    VALUE 'E'.         INKCS046
                       88  ASC-SALES-ADJUSTS-NC      VALUE 'F'.         INKCS046
                       88  ASC-UNIT-BOOKINGS-NC      VALUE 'G'.         INKCS046
                       88  ASC-UNIT-BOOKINGS-COMPLET VALUE 'H'.         INKCS046
SECRTY             15  ASC-UPDTE-AUTHORIZED-SW       PIC X(01).         INKCS048
SECRTY                 88  ASC-UPDTE-AUTHORIZED      VALUE 'Y'.         INKCS048
SECRTY                 88  ASC-UPDTE-NOT-AUTHORIZED  VALUE 'N'.         INKCS048
W26600           10  FILLER                          PIC X(314).           CL*10
                                                                           CL**3
      *---------------------------------------------------------------*    CL**1
      *    CALENDAR ROUTINE                                                CL**3
      *---------------------------------------------------------------*    CL**1
           COPY DPWS500.                                                   CL**3
                                                                           CL**1
SECRTY*---------------------------------------------------------------*         
SECRTY*    CICSAUTH COPYBOOK.                                         *         
SECRTY*---------------------------------------------------------------*         
SECRTY     COPY DPWS008.                                                        
SECRTY                                                                          
      *---------------------------------------------------------------*    CL**3
      *    ABEND PROCESSING COPYBOOK.                                 *    CL**3
      *---------------------------------------------------------------*    CL**3
           COPY DPWS013.                                                   CL**3
                                                                           CL**3
28545                                                                           
28545 *****************************************************************         
28545 * TINCNTL DCLGEN                                                          
28545 *****************************************************************         
28545      EXEC SQL                                                             
28545          INCLUDE TINCNTL                                                  
28545      END-EXEC.                                                            
      *---------------------------------------------------------------* INKCS046
      *    TINVPAR - PHYSICAL INVENTORY TABLE                         * INKCS046
      *---------------------------------------------------------------* INKCS046
           EXEC SQL                                                     INKCS046
                INCLUDE TINVPAR                                         INKCS046
           END-EXEC.                                                    INKCS046
                                                                        INKCS046
W26600*---------------------------------------------------------------* INKCS046
W26600*    XMT_LOC - LOCATION TABLE                                     INKCS046
W26600*---------------------------------------------------------------* INKCS046
W26600     EXEC SQL                                                     INKCS046
W26600          INCLUDE XMT00001                                        INKCS046
W26600     END-EXEC.                                                    INKCS046
                                                                        INKCS046
      *---------------------------------------------------------------* INKCS046
      *    TINENTY - PHYSICAL INVENTORY OF PRE-COUNTED ITEMS TABLE    * INKCS046
      *---------------------------------------------------------------* INKCS046
           EXEC SQL                                                     INKCS046
                INCLUDE TINENTY                                         INKCS046
           END-EXEC.                                                    INKCS046
                                                                        INKCS046
      *---------------------------------------------------------------* INKCS046
      *    TINVDTL - INVALID INVENTORY DETAIL TABLE                   * INKCS046
      *---------------------------------------------------------------* INKCS046
           EXEC SQL                                                     INKCS046
                INCLUDE TINVDTL                                         INKCS046
           END-EXEC.                                                    INKCS046
                                                                        INKCS046
      *---------------------------------------------------------------* INKCS046
      *    TSTKRMW - STOCKROOM WITHDRAWL LINE TABLE                   * INKCS046
      *---------------------------------------------------------------* INKCS046
           EXEC SQL                                                     INKCS046
                INCLUDE TSTKRMW                                         INKCS046
           END-EXEC.                                                    INKCS046
                                                                        INKCS046
22000 *---------------------------------------------------------------*         
22000 *    TADJDTL - SALES ADJUSTMENT DETAIL TABLE                    *         
22000 *---------------------------------------------------------------*         
22000      EXEC SQL                                                             
22000           INCLUDE TADJDTL                                                 
22000      END-EXEC.                                                            
22000                                                                           
22000 *---------------------------------------------------------------*         
22000 *    TUSER   - USER INFORMATION TABLE                           *         
22000 *---------------------------------------------------------------*         
22000      EXEC SQL                                                             
22000           INCLUDE TUSER                                                   
22000      END-EXEC.                                                            
22000                                                                           
      *---------------------------------------------------------------*    CL**1
      *    DB2 AREA FOR COMMUNICATIONS                                *    CL**1
      *---------------------------------------------------------------*    CL**1
           EXEC SQL                                                        CL**1
                INCLUDE SQLCA                                              CL**1
           END-EXEC.                                                       CL**1
                                                                           CL**1
      *---------------------------------------------------------------* INKCS046
      *    TINVPAR ON-LINE SHEETS NOT PROCESSED DECLARE               * INKCS046
      *---------------------------------------------------------------* INKCS046
           EXEC SQL                                                     INKCS046
                DECLARE ONLINE-SHEETS-CSR CURSOR FOR                    INKCS046
23511 *         SELECT DISTINCT A.STORE_NBR                             INKCS046
W26600          SELECT DISTINCT A.LOC_NBR                               INKCS046
                       , A.ACTL_INV_DTE                                         
                       , A.PLND_INV_DTE                                         
                       , A.SCAN_INV_IND                                         
                       , A.ACTL_UNIT_BK_DTE                             INKCS046
                       , A.ACTL_FIN_BK_DTE                              INKCS046
                       , A.ACTL_INV_RECD_DTE                            INKCS046
                       , DAYS(A.ACTL_INV_DTE) + A.STKRM_DAY_QTY         INKCS046
                                              - DAYS(CURRENT_DATE)              
                       , A.SLS_ADJ_CPLD_IND                             INKCS046
W33304                 , A.SCHD_PHY_CNT_CDE                             INKCS046
                       , A.SHEET_INV_CPLD_IND                           INKCS046
                       , A.UNT_BKG_STAT_CDE                             INKCS046
                       , A.FIL_TOT_BAL_CDE                              INKCS046
W26600                 , B.LOC_TYP_CDE                                  INKCS046
W26600                 , B.LOC_10_ABBR_NM                               INKCS046
W26600*                , B.TYPE_CODE                                    INKCS046
W26600*                , B.CHAR10_ABBR_NAME                             INKCS046
                FROM   TINVPAR A                                        INKCS046
W26600                ,XMT_LOC B                                                
23511                 ,TINENTY C                                                
28545                 ,TINCNTL D                                                
W26600          WHERE A.LOC_NBR =  B.LOC_NBR                                    
28545             AND A.INV_ID = D.INV_ID                                       
28545             AND D.ACTV_IND = 'Y'                                          
  |               AND A.ACTL_FIN_BK_DTE = '9999-09-09'                          
W33304            AND A.LOC_INV_STAT_CDE = 'IN'                                 
23511C            AND ((A.ACTL_INV_DTE <> '9999-09-09'                          
23511C                AND CURRENT DATE >=  A.ACTL_INV_DTE)                      
23511C            OR (A.ACTL_INV_DTE = '9999-09-09'                             
23511C              AND DATE(PLND_INV_DTE - 14 DAYS) <= CURRENT DATE))          
W26600            AND C.STR_NBR = B.LOC_NBR                                     
W28545******      AND C.SHEET_TYP_CDE = 'K'                                     
W26000            AND A.SHEET_INV_CPLD_IND = 'N'                                
W23511******      AND A.SHEET_INV_CPLD_IND <> 'S'                               
  |               AND ((A.SHEET_INV_CPLD_IND <> 'Y'                             
  |                    AND A.SCAN_INV_IND = 'Y')                                
  |                OR (A.SCAN_INV_IND = 'N'                                     
W33304                 AND A.SCHD_PHY_CNT_CDE IN ('PI','NS')))                  
W28545***************  AND A.ACTL_INV_RECD_DTE = '9999-09-09'))                 
23511 ********* ORDER BY A.STORE_NBR                                    INKCS046
           END-EXEC.                                                    INKCS046
                                                                        INKCS046
      *---------------------------------------------------------------*    CL*17
      * TINVPAR UPDATE CURSOR                                              CL*17
      *---------------------------------------------------------------*    CL*17
           EXEC SQL                                                        CL*17
             DECLARE TINVPAR_UPDT_CSR CURSOR FOR                           CL*17
W26600*        SELECT STORE_NBR                                            CL*17
W26600         SELECT LOC_NBR                                              CL*17
                     ,ACTL_INV_DTE                                         CL*17
                     ,SHEET_INV_CPLD_IND                                        
28545                ,A.INV_ID                                                  
28545          FROM TINVPAR A                                                   
28545              ,TINCNTL B                                                   
W26600*        WHERE (STORE_NBR = :INVPAR-STORE-NBR)                       CL*19
W26600         WHERE (LOC_NBR = :INVPAR-LOC-NBR)                           CL*19
                 AND (ACTL_INV_DTE = :INVPAR-ACTL-INV-DTE)                 CL*19
28545            AND A.INV_ID = B.INV_ID                                        
28545            AND B.ACTV_IND = 'Y'                                           
           END-EXEC.                                                       CL*17
                                                                           CL**1
      ******************************************************************   CL**1
       LINKAGE SECTION.                                                    CL**1
      ******************************************************************   CL**1
       01  DFHCOMMAREA.                                                    CL**1
           05  FILLER                         OCCURS  1 TO 4072 TIMES      CL**1
                                              DEPENDING ON EIBCALEN.       CL**1
               10  FILLER                     PIC X.                       CL**1
                                                                           CL**1
      ******************************************************************   CL**1
      ******************************************************************   CL**1
       PROCEDURE DIVISION.                                                 CL**1
      ******************************************************************   CL**1
                                                                                
       0000-MAIN-MODULE.                                                   CL**1
           INITIALIZE DP030-CICS-API-FIELDS.                               CL**1
           MOVE +1                       TO DP030-NUMBER-OF-MAPS.          CL**1
           MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.             CL**1
           MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).            CL**1
           SET DP030-RECEIVE-APPL-MAP    TO TRUE.                          CL**1
           MOVE LENGTH OF IN035AI        TO DP030-MAP-LENGTH (1).          CL**1
           MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).        CL**1
           PERFORM 0001-CALL-CICS-ARCH-API.                                CL**1
                                                                           CL**1
           PERFORM 1000-CONTROL-PROCESSING                                 CL**1
                                                                           CL**1
           MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).        CL**1
           PERFORM 0001-CALL-CICS-ARCH-API.                                CL**1
                                                                           CL**1
      ******************************************************************   CL**1
      **  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **   CL**1
      **  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **   CL**1
      ******************************************************************   CL**1
       0001-CALL-CICS-ARCH-API.                                            CL**1
1122RM*    CALL 'DPKCS030' USING DFHEIBLK                                  CL**1
1122RM     CALL DP930-CICS-ARCH-API                                             
1122RM                     USING DFHEIBLK                                       
                                 DFHCOMMAREA                               CL**1
                                 DP030-CICS-API-FIELDS                     CL**1
                                 DP020-STANDARD-COMMAREA                   CL**1
                                 IN035AI.                                  CL**1
      *                                                                    CL**1
           IF  DP030-RC-CALL-SUCCESSFUL                                    CL**1
               CONTINUE                                                    CL**1
           ELSE                                                            CL**1
               SET DP013-NO-ROLLBACK                                       CL**1
                   DP013-XCTL-DISPLAY-RESTART                              CL**1
                   DP013-CICS-ABEND      TO TRUE                           CL**1
               MOVE '0001-CALL-CICS-ARCH-API'                              CL**1
                                         TO DP013-PARAGRAPH                CL**1
1122RM*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX   CL**1
1122RM*             'T LINE'             TO DP013-MESSAGE-TEXT (2)         CL**1
1122RM         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
1122RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
               MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)         CL**1
               PERFORM DP013-0000-PROCESS-ABEND                            CL**1
           END-IF.                                                         CL**1
                                                                           CL**1
      *----------------------------------------------------------------*   CL**1
      * 1000-CONTROL-PROCESSING.                                                
      * PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT          CL**1
      * COURSE OF ACTION IS FOR THIS TRANSACTION.                          CL**1
      *                                                                    CL**1
      * NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE      CL**1
      *  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS        CL**1
      *  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS       CL**1
      *  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS.     CL**1
      *----------------------------------------------------------------*   CL**1
       1000-CONTROL-PROCESSING.                                            CL**1
                                                                           CL**1
           EVALUATE TRUE                                                   CL**1
               WHEN DP020-NEXT-ACT-INITIAL                                 CL**1
                   INITIALIZE ASC-SPECIFIC-COMMAREA                        CL**1
                   MOVE EIBTRMID         TO ASC-LIST-TERM-ID               CL**1
                                            ASC-SEL-TERM-ID                CL**1
                   MOVE DP020-SRC-TASK-NUMBER                              CL**1
                                         TO ASC-LIST-TASK-NUMBER           CL**1
                                            ASC-SEL-TASK-NUMBER            CL**1
                   MOVE PC-LIST-QUEUE-SEQ TO ASC-LIST-SEQ                  CL**1
                   MOVE PC-SEL-QUEUE-SEQ  TO ASC-SEL-SEQ                   CL**1
                   PERFORM 1100-GET-TODAYS-DATE                            CL**6
                   PERFORM 4000-BUILD-INITIAL-PANEL                        CL**3
                                                                           CL**1
               WHEN DP020-NEXT-ACT-READ-MAP                                CL**1
                   MOVE ASC-ITEM-AT-TOP-OF-PANEL                           CL**1
                                         TO PV-TOP-ITEM                    CL**1
SECRTY             PERFORM 1300-DETERMINE-UPDTE-AUTH                    INKCS048
23511C             PERFORM 1150-FORMAT-TODAYS-DATE                              
                   PERFORM 2000-PROCESS-PANEL                              CL**1
                                                                           CL**1
               WHEN DP020-NEXT-ACT-RETURN                                  CL**1
                   MOVE ASC-ITEM-AT-TOP-OF-PANEL                           CL**1
                                         TO PV-TOP-ITEM                    CL**1
                   MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL       CL**1
                   PERFORM 6000-REFRESH-PANEL-FROM-TEMP                    CL**1
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                      CL**1
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
                                                                           CL**1
               WHEN OTHER                                                  CL**1
                   SET DP013-LOGIC-ABEND TO TRUE                           CL**1
                   SET DP013-NO-ROLLBACK TO TRUE                           CL**1
                   MOVE '1000-CONTROL-PROCESSING'                          CL**1
                                         TO DP013-PARAGRAPH                CL**1
                   MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'       CL**1
                                         TO DP013-MESSAGE-TEXT(1)          CL**1
                   PERFORM DP013-0000-PROCESS-ABEND                        CL**1
           END-EVALUATE.                                                   CL**1
                                                                           CL**1
      *----------------------------------------------------------------*   CL**1
      * 1100-GET-TODAYS-DATE.                                                   
      *----------------------------------------------------------------*   CL**6
       1100-GET-TODAYS-DATE.                                               CL**6
                                                                           CL**6
           PERFORM DP017-0000-GET-CURR-DATE-TIME.                          CL**6
           MOVE DP017-CURRENT-DATE-YMD      TO ASC-TODAYS-DATE-YMD.        CL**6
           MOVE DP017-CURRENT-DATE-YYYYMMDD TO ASC-TODAYS-DATE-YYYYMMDD.   CL**6
                                                                           CL**6
      *----------------------------------------------------------------*   CL**1
      * 1150-FORMAT-TODAYS-DATE.                                                
      *----------------------------------------------------------------*   CL**6
                                                                           CL**6
23511C 1150-FORMAT-TODAYS-DATE.                                            CL**6
                                                                           CL**6
23511C     MOVE ASC-TODAYS-DATE-YYYY TO PV-CURRENT-DATE-CCYY.              CL**1
23511C     MOVE ASC-TODAYS-DATE-MM TO PV-CURRENT-DATE-MM.                  CL**1
23511C     MOVE ASC-TODAYS-DATE-DD TO PV-CURRENT-DATE-DD.                  CL**1
                                                                           CL**6
SECRTY/----------------------------------------------------------------*   CL**6
 |    *  DETERMINE IF THE USER IS AUTHORIZED TO UPDATE FROM THE SCREEN          
 |    *----------------------------------------------------------------*   CL**6
 |     1300-DETERMINE-UPDTE-AUTH.                                               
 |         SET DP008-RSRC-TYPE-FUNC        TO TRUE.                             
 |         SET DP008-ACCESS-TYPE-READ      TO TRUE.                             
 |         MOVE PC-CRITERIA-PROCESSING     TO DP008-RESOURCE-NAME.              
 |                                                                              
 |         EXEC CICS                                                            
 |              LINK PROGRAM  (DP008-SECURITY-SUBROUTINE)                       
 |                   COMMAREA (DP008-SECURITY-COMMAREA)                         
 |                   LENGTH   (DP008-SECURITY-COMMAREA-LENGTH)                  
 |                   RESP     (PV-CICS-RESP)                                    
 |         END-EXEC.                                                            
 |                                                                              
 |         IF  PV-CICS-RESP = DFHRESP(NORMAL)                                   
 |             IF  DP008-CALL-SUCCESSFUL                                        
 |                 IF  DP008-ACCESS-ALLOWED                                     
 |                     SET ASC-UPDTE-AUTHORIZED    TO TRUE                      
 |                 ELSE                                                         
 |                     SET ASC-UPDTE-NOT-AUTHORIZED TO TRUE                     
 |                 END-IF                                                       
 |             ELSE                                                             
 |                 MOVE DP008-ERROR-CODE   TO PM-CM-RETURN-CODE                 
 |                 MOVE PM-CICSAUTH-MESSAGE                                     
 |                                         TO DP013-MESSAGE-TEXT(1)             
 |                 SET DP013-CICS-ABEND      TO TRUE                            
 |                 SET DP013-NO-ROLLBACK     TO TRUE                            
 |                                                                              
 |                 MOVE '1300-DETERMINE-UPDTE-AUTH'                             
 |                                           TO DP013-PARAGRAPH                 
 |                 PERFORM DP013-0000-PROCESS-ABEND                             
 |             END-IF                                                           
 |         ELSE                                                                 
 |             MOVE 'CALL RACF SECURITY PROGRAM'                                
 |                                         TO DP013-MESSAGE-TEXT(1)             
 |             SET DP013-CICS-ABEND      TO TRUE                                
 |             SET DP013-NO-ROLLBACK     TO TRUE                                
 |                                                                              
 |             MOVE '1300-DETERMINE-UPDTE-AUTH' TO DP013-PARAGRAPH              
  |            PERFORM DP013-0000-PROCESS-ABEND                                 
  |        END-IF.                                                              
SECRTY                                                                          
      *----------------------------------------------------------------*   CL**6
      * 2000-PROCESS-PANEL.                                                     
      * DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA       CL**6
      * ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT       CL**6
      * USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST      CL**6
      * OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID          CL**6
      * FUNCTION KEYS CAN GET THIS FAR.                                    CL**6
      *----------------------------------------------------------------*   CL**6
       2000-PROCESS-PANEL.                                                 CL**6
           EVALUATE TRUE                                                   CL**1
               WHEN DP020-SRC-AID = DP016-CLEAR                            CL**1
                   MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL       CL**1
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                      CL**1
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
                                                                           CL**1
               WHEN DP020-FK-REFRESH (DP020-SRC-AID)                       CL**1
                   PERFORM 2050-DELETE-LIST-QUEUE                          CL**1
                   PERFORM 4000-BUILD-INITIAL-PANEL                        CL**1
                                                                           CL**1
               WHEN DP020-FK-DESELECT(DP020-SRC-AID)                       CL**1
                   PERFORM 2140-DESELECT-ALL-ITEMS                         CL**1
                   PERFORM 3200-RESET-ATTRIBUTES                           CL**1
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
                                                                           CL**1
               WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                     CL**1
                   PERFORM 2150-SELECT-ALL-ITEMS                           CL**1
                   PERFORM 3200-RESET-ATTRIBUTES                           CL**1
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
                                                                           CL**1
               WHEN OTHER                                                  CL**1
                   PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                    CL**1
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                      CL**1
                   IF  PS-NO-ERROR                                         CL**1
                       SET DP030-CONTINUE-GO TO TRUE                       CL**1
                       PERFORM 2100-CHECK-FUNCTION-KEY                     CL**1
                   ELSE                                                    CL**1
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                CL**1
                       SET DP030-OVERRIDE-GO TO TRUE                       CL**1
                   END-IF                                                  CL**1
           END-EVALUATE.                                                   CL**1
       EJECT                                                               CL**1
      *----------------------------------------------------------------*   CL**1
      *  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *   CL**1
      *----------------------------------------------------------------*   CL**1
       2050-DELETE-LIST-QUEUE.                                             CL**1
                                                                           CL**1
           EXEC CICS                                                       CL**1
               DELETEQ TS                                                  CL**1
                   QUEUE (ASC-LIST-QUEUE-NAME)                             CL**1
                   RESP  (PV-CICS-RESP)                                    CL**1
           END-EXEC.                                                       CL**1
                                                                           CL**1
           IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                          CL**1
              (PV-CICS-RESP = DFHRESP(QIDERR))                             CL**1
               CONTINUE                                                    CL**1
           ELSE                                                            CL**1
               SET DP013-CICS-ABEND      TO TRUE                           CL**1
               SET DP013-NO-ROLLBACK     TO TRUE                           CL**1
                                                                           CL**1
               MOVE '2050-DELETE-LIST-QUEUE'                               CL**1
                                         TO DP013-PARAGRAPH                CL**1
               MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'       CL**1
                                         TO DP013-MESSAGE-TEXT (1)         CL**1
               PERFORM DP013-0000-PROCESS-ABEND                            CL**1
           END-IF.                                                         CL**1
                                                                           CL**1
           MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.     CL**1
                                                                           CL**1
      *----------------------------------------------------------------*   CL**1
      * ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*   CL**1
      * NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *   CL**1
      * CICS ARCHITECTURE API.                                         *   CL**1
      *----------------------------------------------------------------*   CL**1
       2100-CHECK-FUNCTION-KEY.                                            CL**1
           EVALUATE TRUE                                                   CL**1
22000          WHEN DP020-FK-LOCAL-FUNC-10 (DP020-SRC-AID)                      
22000              PERFORM 6200-FORMAT-AND-SUBMIT                               
22000              PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   INKCS046
22000              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 INKCS046
22000              MOVE PC-TSYMSG-00098 TO DP020-MSG-NUMBER                     
22000              SET DP020-MSG-INFORMATIONAL TO TRUE                          
               WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                 CL**3
SECRTY             IF ASC-UPDTE-AUTHORIZED                                      
                     IF DP020-SRC-AID = DP016-PF15                         CL**3
                       IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO             CL**3
                           PERFORM 5000-PREPARE-SEL-QUEUE                  CL*13
                           MOVE ASC-NUMBER-OF-SELECTED-ITEMS               CL*16
                                      TO ASC-NUMBER-OF-TS-ITEMS            CL*16
                                                                           CL*14
                           MOVE IN035-MAX-ITEMS TO ASC-SEL-SUB             CL*14
                           MOVE ZERO TO ASC-SEL-ITEM                       CL*14
                           PERFORM 2145-GET-NEXT-ITEM                      CL*14
                               ASC-NUMBER-OF-SELECTED-ITEMS TIMES          CL*14
                                                                           CL*14
                           MOVE ZERO     TO ASC-ITEM-AT-TOP-OF-PANEL       CL*17
                           PERFORM 6000-REFRESH-PANEL-FROM-TEMP            CL*13
                           PERFORM 3000-EDIT-DATA-IN-COMMAREA              CL*13
                           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            CL*14
                                                                           CL*14
                           SET DP020-MSG-INFORMATIONAL TO TRUE             CL*14
                           MOVE PC-TSYMSG-00059  TO DP020-MSG-NUMBER       CL*14
                       ELSE                                                CL**3
                           SET DP030-OVERRIDE-GO                           CL**3
                               DP020-MSG-WARNING TO TRUE                   CL**3
                           MOVE PC-TSYMSG-00057                            CL**3
                                             TO DP020-MSG-NUMBER           CL**3
                           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            CL**3
                       END-IF                                              CL**3
                   ELSE                                                    CL**3
                       SET DP013-NO-ROLLBACK                               CL**3
                           DP013-XCTL-DISPLAY-RESTART                      CL**3
                           DP013-CICS-ABEND  TO TRUE                       CL**3
                       MOVE '2100-CHECK-FUNCTION-KEY'                      CL**3
                                             TO DP013-PARAGRAPH            CL**3
                       MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'     CL**3
                                             TO DP013-MESSAGE-TEXT (1)     CL**3
                       PERFORM DP013-0000-PROCESS-ABEND                    CL**3
                   END-IF                                                  CL**3
SECRTY           ELSE                                                   02980000
SECRTY             SET DP020-MSG-WARNING       TO TRUE                  02980000
SECRTY             MOVE PC-TSYMSG-00045        TO DP020-MSG-NUMBER      02980000
SECRTY             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**3
SECRTY           END-IF                                                 02980000
                                                                           CL**3
               WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                     CL**1
                   IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                 CL**1
                       INITIALIZE IN035-INTER-APPL-COMMAREA                CL**1
                       MOVE ASC-NUMBER-OF-SELECTED-ITEMS                   CL**1
                                      TO IN035-NUMBER-OF-SELECTED-ITEMS    CL**1
                       PERFORM 5000-PREPARE-SEL-QUEUE                      CL**1
                   ELSE                                                    CL**1
                       SET DP030-OVERRIDE-GO                               CL**1
                                         TO TRUE                           CL**1
      *                ---- A LIST ITEM MUST BE SELECTED ----              CL**1
                       MOVE PC-TSYMSG-00057                                CL**1
                                         TO DP020-MSG-NUMBER               CL**1
                       SET DP020-MSG-WARNING                               CL**1
                                         TO TRUE                           CL**1
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                CL**1
                   END-IF                                                  CL**1
                                                                           CL**1
               WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                     CL**1
                   MOVE +1               TO PV-TOP-ITEM                    CL**1
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
                                                                           CL**1
               WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                      CL**1
                   PERFORM 2110-BROWSE-BACKWARD                            CL**1
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
                                                                           CL**1
               WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                      CL**1
                   PERFORM 2120-BROWSE-FORWARD                             CL**1
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
                                                                           CL**1
               WHEN DP020-SRC-AID = DP016-ENTER                            CL**1
                   PERFORM 2130-CHECK-FOR-JUMP-BROWSE                      CL**1
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
                                                                           CL**1
               WHEN OTHER                                                  CL**1
                   SET DP013-NO-ROLLBACK                                   CL**1
                       DP013-XCTL-DISPLAY-RESTART                          CL**1
                       DP013-CICS-ABEND  TO TRUE                           CL**1
                   MOVE '2100-CHECK-FUNCTION-KEY'                          CL**1
                                         TO DP013-PARAGRAPH                CL**1
                   MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'         CL**1
                                         TO DP013-MESSAGE-TEXT (1)         CL**1
                   PERFORM DP013-0000-PROCESS-ABEND                        CL**1
           END-EVALUATE.                                                   CL**1
                                                                           CL**1
      *----------------------------------------------------------------*   CL**1
      *    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *   CL**1
      *    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *   CL**1
      *    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *   CL**1
      *    MESSAGE.                                                    *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       2110-BROWSE-BACKWARD.                                               CL**1
           SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL       CL**1
               GIVING PV-TOP-ITEM.                                         CL**1
      *                                                                    CL**1
           IF  ((PV-TOP-ITEM < +1)                                         CL**1
             OR (PV-TOP-ITEM = +1))                                        CL**1
               MOVE +1                   TO PV-TOP-ITEM                    CL**1
      *        -- TOP OF LIST --                                           CL**1
               MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER               CL**1
               SET DP020-MSG-INFORMATIONAL TO TRUE                         CL**1
           END-IF.                                                         CL**1
                                                                           CL**1
       EJECT                                                               CL**1
      *----------------------------------------------------------------*   CL**1
      *    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *   CL**1
      *    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *   CL**1
      *    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       2120-BROWSE-FORWARD.                                                CL**1
                                                                           CL**1
           ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL                 CL**1
               GIVING PV-TOP-ITEM.                                         CL**1
           IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                      CL**1
               MOVE ASC-ITEM-AT-TOP-OF-PANEL                               CL**1
                                         TO PV-TOP-ITEM                    CL**1
      *        -- BOTTOM OF LIST --                                        CL**1
               MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER               CL**1
               SET DP020-MSG-INFORMATIONAL                                 CL**1
                                         TO TRUE                           CL**1
           ELSE                                                            CL**1
               COMPUTE PV-BOTTOM-ITEM =                                    CL**1
                   PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                    CL**1
               IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ               CL**1
      *            -- BOTTOM OF LIST --                                    CL**1
                   MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER               CL**1
                   SET DP020-MSG-INFORMATIONAL                             CL**1
                                         TO TRUE                           CL**1
               END-IF                                                      CL**1
           END-IF.                                                         CL**1
       EJECT                                                               CL**1
      *----------------------------------------------------------------*   CL**1
      *    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *   CL**1
      *    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *   CL**1
      *    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *   CL**1
      *    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *   CL**1
      *    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *   CL**1
      *    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       2130-CHECK-FOR-JUMP-BROWSE.                                         CL**1
           IF (ASC-START-ITEM-REQUEST = SPACE)                             CL**1
               MOVE ASC-ITEM-AT-TOP-OF-PANEL                               CL**1
                                         TO PV-TOP-ITEM                    CL**1
           ELSE                                                            CL**1
               MOVE ASC-START-ITEM-REQUEST  TO DP010I-UNEDITED-FIELD       CL**1
               MOVE PC-ITEM-NUMBER-LENGTH   TO DP010I-MAXIMUM-DIGITS       CL**1
               MOVE +0                      TO DP010I-MAXIMUM-DECIMALS     CL**1
               SET DP010I-NEGATIVE-NOT-ALLOWED                             CL**1
                                         TO TRUE                           CL**1
263126         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263126              USING DP010I-NUMERIC-EDIT-AREA                              
                                                                           CL**1
               IF  NOT DP010I-ERROR-DETECTED                               CL**1
                   MOVE DP010I-NUMERIC-FIELD                               CL**1
                                         TO  ASC-START-ITEM-REQUEST-N      CL**1
                   IF  ASC-START-ITEM-REQUEST-N > ZERO                     CL**1
                       IF  ASC-START-ITEM-REQUEST-N >                      CL**1
                                                ASC-NUMBER-OF-ITEMS-READ   CL**1
                           MOVE SPACE TO ASC-START-ITEM-REQUEST            CL**1
                           COMPUTE PV-TOP-ITEM =                           CL**1
                                   ASC-NUMBER-OF-ITEMS-READ                CL**1
                                   - PC-ITEMS-PER-PANEL + 1                CL**1
                           IF  PV-TOP-ITEM < +1                            CL**1
                               MOVE +1   TO PV-TOP-ITEM                    CL**1
      *                        ---- BOTTOM OF LIST ----                    CL**1
                               MOVE PC-TSYMSG-00070                        CL**1
                                         TO DP020-MSG-NUMBER               CL**1
                               SET DP020-MSG-INFORMATIONAL                 CL**1
                                         TO TRUE                           CL**1
                           END-IF                                          CL**1
                       ELSE                                                CL**1
                           MOVE ASC-START-ITEM-REQUEST-N                   CL**1
                                         TO PV-TOP-ITEM                    CL**1
                           MOVE SPACE    TO ASC-START-ITEM-REQUEST         CL**1
                           COMPUTE PV-BOTTOM-ITEM =                        CL**1
                               PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1        CL**1
                           IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ   CL**1
      *                        -- BOTTOM OF LIST --                        CL**1
                               MOVE PC-TSYMSG-00070                        CL**1
                                         TO DP020-MSG-NUMBER               CL**1
                               SET DP020-MSG-INFORMATIONAL                 CL**1
                                         TO TRUE                           CL**1
                           END-IF                                          CL**1
                       END-IF                                              CL**1
                   ELSE                                                    CL**1
      *                --- VALUE OUT OF RANGE ----                         CL**1
                       MOVE PC-TSYMSG-00101     TO DP020-MSG-NUMBER        CL**1
                       MOVE -1                  TO ASTRTITL                CL**1
                       SET DP030-SET-CURSOR-APPL-1                         CL**1
                                                TO TRUE                    CL**1
                       MOVE DP015-REVERSE       TO ASTRTITH                CL**1
                       MOVE DP015-RED           TO ASTRTITC                CL**1
                       MOVE DP015-UNP-NUM-BRT-OFF                          CL**1
                                                TO ASTRTITA                CL**1
                       SET DP020-MSG-FATAL      TO TRUE                    CL**1
                       SET PS-START-ITEM-ERROR TO TRUE                     CL**1
                   END-IF                                                  CL**1
                                                                           CL**1
               ELSE                                                        CL**1
      *            ---- MUST BE NUMERIC ----                               CL**1
                   MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER         CL**1
                   MOVE -1                     TO ASTRTITL                 CL**1
                   SET DP030-SET-CURSOR-APPL-1 TO TRUE                     CL**1
                   MOVE DP015-REVERSE          TO ASTRTITH                 CL**1
                   MOVE DP015-RED              TO ASTRTITC                 CL**1
                   MOVE DP015-UNP-NUM-BRT-OFF  TO ASTRTITA                 CL**1
                   SET DP020-MSG-FATAL         TO TRUE                     CL**1
                   SET PS-START-ITEM-ERROR     TO TRUE                     CL**1
               END-IF                                                      CL**1
           END-IF.                                                         CL**1
       EJECT                                                               CL**1
      *----------------------------------------------------------------*   CL**1
      *    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *   CL**1
      *    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *   CL**1
      *----------------------------------------------------------------*   CL**1
       2140-DESELECT-ALL-ITEMS.                                            CL**1
           MOVE +1                       TO ASC-BLK-SUB.                   CL**1
                                                                           CL**1
           PERFORM 2141-CLEAR-SELECTED-INDS                                CL**1
               VARYING ASC-ITEM-SUB                                        CL**1
               FROM 1 BY 1                                                 CL**1
               UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                    CL**1
                                                                           CL**1
           ADD +1                        TO ASC-BLK-SUB.                   CL**1
                                                                           CL**1
           PERFORM 2141-CLEAR-SELECTED-INDS                                CL**1
               VARYING ASC-ITEM-SUB                                        CL**1
               FROM 1 BY 1                                                 CL**1
               UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                    CL**1
                                                                           CL**1
           MOVE ASC-LIST-ITEM-NUMBER(1 1)                                  CL**1
                                         TO PV-LIST-ITEM-NUMBER.           CL**1
                                                                           CL**1
           COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                               CL**1
               1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).       CL**1
                                                                           CL**1
           IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                        CL**1
              (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)         CL**1
               MOVE +1                   TO ASC-BLK-SUB                    CL**1
                                                                           CL**1
               PERFORM 5100-WRITE-TEMP-STORAGE                             CL**1
                                                                           CL**1
               MOVE +1                   TO PV-BLOCK-NUMBER                CL**1
                                                                           CL**1
               COMPUTE PV-PREV-BLOCK-IN-ARRAY =                            CL**1
                   PV-FIRST-BLOCK-IN-ARRAY - 1                             CL**1
                                                                           CL**1
               PERFORM                                                     CL**1
                   UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY          CL**1
                                                                           CL**1
                   PERFORM 4410-READ-TEMP-STORAGE                          CL**1
                                                                           CL**1
                   PERFORM 2141-CLEAR-SELECTED-INDS                        CL**1
                       VARYING ASC-ITEM-SUB FROM 1 BY 1                    CL**1
                       UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL             CL**1
                                                                           CL**1
                   PERFORM 5100-WRITE-TEMP-STORAGE                         CL**1
                                                                           CL**1
                   ADD +1                TO PV-BLOCK-NUMBER                CL**1
                                                                           CL**1
               END-PERFORM                                                 CL**1
                                                                           CL**1
               COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                            CL**1
                   PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY        CL**1
                                                                           CL**1
               PERFORM                                                     CL**1
                   UNTIL PV-NEXT-BLOCK-IN-ARRAY >                          CL**1
                         ASC-HIGHEST-BLOCK-WRITTEN                         CL**1
                                                                           CL**1
                   MOVE PV-NEXT-BLOCK-IN-ARRAY                             CL**1
                                         TO PV-BLOCK-NUMBER                CL**1
                                                                           CL**1
                   PERFORM 4410-READ-TEMP-STORAGE                          CL**1
                                                                           CL**1
                   PERFORM 2141-CLEAR-SELECTED-INDS                        CL**1
                       VARYING ASC-ITEM-SUB                                CL**1
                       FROM 1 BY 1                                         CL**1
                       UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL             CL**1
                                                                           CL**1
                   PERFORM 5100-WRITE-TEMP-STORAGE                         CL**1
                                                                           CL**1
                   ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY         CL**1
                                                                           CL**1
               END-PERFORM                                                 CL**1
                                                                           CL**1
               MOVE PV-FIRST-BLOCK-IN-ARRAY                                CL**1
                                         TO PV-BLOCK-NUMBER                CL**1
                                                                           CL**1
               PERFORM 4410-READ-TEMP-STORAGE                              CL**1
           END-IF.                                                         CL**1
                                                                           CL**1
                                                                           CL**1
           MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS.    CL**1
           MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.   CL**1
           MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.     CL**1
                                                                           CL**1
           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                           CL**1
                                                                           CL**1
       EJECT                                                               CL**1
      *----------------------------------------------------------------*   CL**1
      *    MARK EACH ITEM AS BEING NOT SELECTED.                       *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       2141-CLEAR-SELECTED-INDS.                                           CL**1
                                                                           CL**1
           IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)              CL**1
                   NOT EQUAL ZERO                                          CL**1
               IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             CL**1
                   SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             CL**1
                       ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       CL**1
                       ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                     CL**1
                                         TO TRUE                           CL**1
               END-IF                                                      CL**1
           END-IF.                                                         CL**1
                                                                           CL**1
       EJECT                                                               CL**1
                                                                           CL**1
      ******************************************************************   CL*14
      ** GET THE NEXT ITEM THE LIST QUEUE.                                 CL*14
      ******************************************************************   CL*14
       2145-GET-NEXT-ITEM.                                                 CL*14
           ADD +1                       TO ASC-SEL-SUB.                    CL*14
           IF  ASC-SEL-SUB > IN035-MAX-ITEMS                               CL*14
               ADD +1                   TO ASC-SEL-ITEM                    CL*14
               MOVE +1                  TO ASC-SEL-SUB                     CL*14
           END-IF.                                                         CL*14
           IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                    CL*14
               PERFORM 9100-READ-SEL-QUEUE                                 CL*14
               IF  IN035-ITEM (ASC-SEL-SUB) > ZERO                         CL*14
W26600             MOVE IN035-STORE-NBR (ASC-SEL-SUB)                           
W26600                            TO INVPAR-LOC-NBR                             
                   MOVE IN035-ACTL-INV-DTE (ASC-SEL-SUB)                        
                                  TO INVPAR-ACTL-INV-DTE                        
                   PERFORM 8000-PROCESS-SHEET                              CL*17
                   SET IN035-UPD (ASC-SEL-SUB) TO TRUE                     CL*14
                   PERFORM 9200-REWRITE-SEL-QUEUE                          CL*14
               ELSE                                                        CL*14
                   SUBTRACT +1 FROM ASC-SEL-SUB                            CL*14
      *            ---- BOTTOM OF LIST ----                                CL*14
                   MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER                CL*14
                   SET DP020-MSG-INFORMATIONAL TO TRUE                     CL*14
               END-IF                                                      CL*14
           ELSE                                                            CL*14
               SUBTRACT +1 FROM ASC-SEL-ITEM                               CL*14
               MOVE IN035-MAX-ITEMS     TO ASC-SEL-SUB                     CL*14
      *        ---- BOTTOM OF LIST ----                                    CL*14
               MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER                CL*14
               SET DP020-MSG-INFORMATIONAL TO TRUE                         CL*14
           END-IF.                                                         CL*14
                                                                           CL*14
      *----------------------------------------------------------------*   CL*14
      *  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *   CL*14
      *  FOR ALL ITEMS.                                                *   CL*14
      *----------------------------------------------------------------*   CL*14
       2150-SELECT-ALL-ITEMS.                                              CL**1
                                                                           CL**1
           MOVE +1                       TO ASC-BLK-SUB.                   CL**1
                                                                           CL**1
           PERFORM 2151-SET-SELECTED-INDS                                  CL**1
               VARYING ASC-ITEM-SUB                                        CL**1
               FROM 1 BY 1                                                 CL**1
               UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                    CL**1
                                                                           CL**1
           ADD +1                        TO ASC-BLK-SUB.                   CL**1
                                                                           CL**1
           PERFORM 2151-SET-SELECTED-INDS                                  CL**1
               VARYING ASC-ITEM-SUB                                        CL**1
               FROM 1 BY 1                                                 CL**1
               UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                    CL**1
                                                                           CL**1
           MOVE ASC-LIST-ITEM-NUMBER(1 1)                                  CL**1
                                         TO PV-LIST-ITEM-NUMBER.           CL**1
                                                                           CL**1
           COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                               CL**1
               1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).       CL**1
                                                                           CL**1
           IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                        CL**1
              (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)       CL**1
               MOVE +1                   TO ASC-BLK-SUB                    CL**1
                                                                           CL**1
               PERFORM 5100-WRITE-TEMP-STORAGE                             CL**1
                                                                           CL**1
               MOVE +1                   TO PV-BLOCK-NUMBER                CL**1
                                                                           CL**1
               COMPUTE PV-PREV-BLOCK-IN-ARRAY =                            CL**1
                   PV-FIRST-BLOCK-IN-ARRAY - 1                             CL**1
                                                                           CL**1
               PERFORM                                                     CL**1
                   UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY          CL**1
                                                                           CL**1
                   PERFORM 4410-READ-TEMP-STORAGE                          CL**1
                                                                           CL**1
                   PERFORM 2151-SET-SELECTED-INDS                          CL**1
                       VARYING ASC-ITEM-SUB                                CL**1
                       FROM 1 BY 1                                         CL**1
                       UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL             CL**1
                                                                           CL**1
                   PERFORM 5100-WRITE-TEMP-STORAGE                         CL**1
                                                                           CL**1
                   ADD +1                TO PV-BLOCK-NUMBER                CL**1
                                                                           CL**1
               END-PERFORM                                                 CL**1
                                                                           CL**1
               COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                            CL**1
                   PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY        CL**1
                                                                           CL**1
               PERFORM                                                     CL**1
                   UNTIL PV-NEXT-BLOCK-IN-ARRAY >                          CL**1
                         ASC-HIGHEST-BLOCK-WRITTEN                         CL**1
                                                                           CL**1
                   MOVE PV-NEXT-BLOCK-IN-ARRAY                             CL**1
                                         TO PV-BLOCK-NUMBER                CL**1
                                                                           CL**1
                   PERFORM 4410-READ-TEMP-STORAGE                          CL**1
                                                                           CL**1
                   PERFORM 2151-SET-SELECTED-INDS                          CL**1
                       VARYING ASC-ITEM-SUB                                CL**1
                       FROM 1 BY 1                                         CL**1
                       UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL             CL**1
                                                                           CL**1
                   PERFORM 5100-WRITE-TEMP-STORAGE                         CL**1
                                                                           CL**1
                   ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY         CL**1
                                                                           CL**1
               END-PERFORM                                                 CL**1
                                                                           CL**1
               MOVE PV-FIRST-BLOCK-IN-ARRAY                                CL**1
                                         TO PV-BLOCK-NUMBER                CL**1
                                                                           CL**1
               PERFORM 4410-READ-TEMP-STORAGE                              CL**1
           END-IF.                                                         CL**1
                                                                           CL**1
                                                                           CL**1
           MOVE ASC-NUMBER-OF-ITEMS-READ TO                                CL**1
                             ASC-NUMBER-OF-SELECTED-ITEMS.                 CL**1
                                                                           CL**1
           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                           CL**1
                                                                           CL**1
       EJECT                                                               CL**1
      *----------------------------------------------------------------*   CL**1
      *    MARK EACH ITEM AS BEING SELECTED.                           *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       2151-SET-SELECTED-INDS.                                             CL**1
                                                                           CL**1
           IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)              CL**1
                   NOT EQUAL ZERO                                          CL**1
23511C         IF (ASC-ACT-RECD-DTE (ASC-BLK-SUB ASC-ITEM-SUB)                  
23511C               = PC-INCOMPLETE-DTE )                              INKCS046
23511C             IF  (ASC-LOC-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)                 
23511C                  = 'CS' OR 'DC' OR 'DA' OR 'RV')                         
23511C                 IF  PV-CURRENT-DATE-CCYY-MM-DD                   INKCS046
23511C                     < ASC-ACT-INV-DTE (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
23511C                     NEXT SENTENCE                                        
23511C                 ELSE                                                     
23511C                     IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)     CL**1
23511C                         SET ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)   CL**1
23511C                             ASC-TEMP-SELECT                         CL**1
23511C                                        (ASC-BLK-SUB ASC-ITEM-SUB)   CL**1
23511C                             ASC-BLOCK-MODIFIED(ASC-BLK-SUB)         CL**1
23511C                             TO  TRUE                                CL**1
23511C                     END-IF                                          CL**1
23511C                 END-IF                                              CL**1
23511C             END-IF                                                  CL**1
23511C         ELSE                                                        CL**1
               IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                CL**1
                   SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                CL**1
                       ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)           CL**1
                       ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                     CL**1
                                     TO  TRUE                              CL**1
               END-IF                                                      CL**1
           END-IF.                                                         CL**1
                                                                           CL**1
                                                                           CL**1
      ******************************************************************   CL**1
      ** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **   CL**1
      ** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **   CL**1
      ******************************************************************   CL**1
       2200-MOVE-SCREEN-TO-COMMAREA.                                       CL**1
                                                                           CL**1
           MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.                CL**1
           MOVE +1                       TO PV-SUB.                        CL**1
      *                                                                    CL**1
           PERFORM 3100-SET-SUBSCRIPTS.                                    CL**1
           IF  ASTRTITL > ZERO                                             CL**1
               MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST             CL**1
           ELSE                                                            CL**1
               IF ASTRTITF = DP015-ERASE-EOF                               CL**1
                   MOVE SPACE TO ASC-START-ITEM-REQUEST                    CL**1
               END-IF.                                                     CL**1
                                                                           CL**1
           PERFORM 2210-MOVE-LINES-TO-COMMAREA                             CL**1
               VARYING PV-SUB                                              CL**1
               FROM 1 BY 1                                                 CL**1
               UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                         CL**1
      ******************************************************************   CL**1
      ** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**   CL**1
      ******************************************************************   CL**1
       2210-MOVE-LINES-TO-COMMAREA.                                        CL**1
           IF  MR-SELECTL (PV-SUB) > ZERO                                  CL**1
               SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE                CL**1
               MOVE MR-SELECTI (PV-SUB)                                    CL**1
                                         TO ASC-TEMP-SELECTED-SW           CL**1
                                       (ASC-BLK-SUB, ASC-ITEM-SUB)         CL**1
           ELSE                                                            CL**1
               IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                   CL**1
                       SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE        CL**1
                       MOVE SPACE        TO ASC-TEMP-SELECTED-SW           CL**1
                                       (ASC-BLK-SUB, ASC-ITEM-SUB)         CL**1
               END-IF                                                      CL**1
           END-IF.                                                         CL**1
           ADD +1                        TO ASC-ITEM-SUB.                  CL**1
           IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                           CL**1
               ADD +1                    TO ASC-BLK-SUB                    CL**1
               MOVE +1                   TO ASC-ITEM-SUB                   CL**1
           END-IF.                                                         CL**1
      ******************************************************************   CL**1
      ** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **   CL**1
      ** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **   CL**1
      ******************************************************************   CL**1
       3000-EDIT-DATA-IN-COMMAREA.                                         CL**1
           SET PS-NO-ERROR               TO TRUE.                          CL**1
           PERFORM 3200-RESET-ATTRIBUTES.                                  CL**1
           MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                        CL**1
      **                                                                   CL**1
      * CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.                 CL**1
      * EDITTING IS DONE FROM THE BOTTOM UP.                               CL**1
      **                                                                   CL**1
           COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                          CL**1
               ASC-ITEMS-DISPLAYED - 1.                                    CL**1
           PERFORM 3100-SET-SUBSCRIPTS.                                    CL**1
           PERFORM 3300-EDIT-SELECTIONS                                    CL**1
               VARYING PV-SUB                                              CL**1
               FROM PV-SUB BY -1                                           CL**1
               UNTIL PV-SUB < +1                                           CL**1
      *                                                                    CL**1
           IF  PS-NO-ERROR                                                 CL**1
               PERFORM 3400-CHECK-RANGE-SEQUENCE                           CL**1
           END-IF.                                                         CL**1
      *                                                                    CL**1
           IF  ((PS-NO-ERROR)                                              CL**1
             AND (ASC-START-OF-SELECTED-RANGE > ZERO)                      CL**1
             AND (ASC-END-OF-SELECTED-RANGE > ZERO))                       CL**1
                   PERFORM 3500-MARK-RANGE-AS-SELECTED                     CL**1
           END-IF.                                                         CL**1
       EJECT                                                               CL**1
      *----------------------------------------------------------------*   CL**1
      *    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *   CL**1
      *    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*   CL**1
      *    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *   CL**1
      *                                                                *   CL**1
      *    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *   CL**1
      *    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *   CL**1
      *    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *   CL**1
      *    US IN THE 2ND BLOCK OF THE ARRAY.                           *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       3100-SET-SUBSCRIPTS.                                                CL**1
                                                                           CL**1
           COMPUTE ASC-ITEM-SUB =                                          CL**1
               (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.           CL**1
                                                                           CL**1
           IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                            CL**1
               SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB               CL**1
                                                                           CL**1
               MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB                  CL**1
           ELSE                                                            CL**1
               MOVE +1                     TO ASC-BLK-SUB                  CL**1
           END-IF.                                                         CL**1
      ******************************************************************   CL**1
      ** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **   CL**1
      ******************************************************************   CL**1
                                                                           CL**1
       3200-RESET-ATTRIBUTES.                                              CL**1
           MOVE DP015-UNP-NUM-NOR-OFF    TO ASTRTITA.                      CL**1
           MOVE DP015-GREEN              TO ASTRTITC.                      CL**1
           MOVE DP015-UNDERLINE          TO ASTRTITH.                      CL**1
      *                                                                    CL**1
           PERFORM                                                         CL**1
               VARYING PV-SUB                                              CL**1
               FROM 1 BY 1                                                 CL**1
               UNTIL PV-SUB > PC-ITEMS-PER-PANEL                           CL**1
               MOVE DP015-UNP-ALP-NOR-OFF                                  CL**1
                                     TO MR-SELECTA (PV-SUB)                CL**1
               MOVE DP015-GREEN      TO MR-SELECTC (PV-SUB)                CL**1
               MOVE DP015-UNDERLINE  TO MR-SELECTH (PV-SUB)                CL**1
               MOVE DP015-BLUE       TO MR-SELECTC        (PV-SUB)         CL**1
                                        MR-ACTIONC        (PV-SUB)         CL**1
                                        MR-STOREC         (PV-SUB)         CL**5
                                        MR-STORE-NAMEC    (PV-SUB)         CL**5
                                        MR-LOC-TYPEC      (PV-SUB)         CL**5
                                        MR-ACT-INV-DTEC   (PV-SUB)         CL**5
                                        MR-ACT-RECD-DATEC (PV-SUB)              
                                        MR-ONLINE-SHEETC  (PV-SUB)              
                                        MR-SLE-ADJ-DATEC  (PV-SUB)              
                                        MR-UNT-BK-DATEC   (PV-SUB)              
           END-PERFORM.                                                    CL**1
      ******************************************************************   CL**1
      ** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **   CL**1
      ** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **   CL**1
      ** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **   CL**1
      ** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **   CL**1
      ******************************************************************   CL**1
       3300-EDIT-SELECTIONS.                                               CL**1
           EVALUATE TRUE                                                   CL**1
               WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)        CL**1
                   = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)            CL**1
                       CONTINUE                                            CL**1
               WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)            CL**1
                   IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)           CL**1
                       ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS      CL**1
                       MOVE ASC-TEMP-SELECTED-SW                           CL**1
                                            (ASC-BLK-SUB ASC-ITEM-SUB)     CL**1
                                      TO ASC-SELECTED-SW                   CL**1
                                            (ASC-BLK-SUB ASC-ITEM-SUB)     CL**1
                   END-IF                                                  CL**1
               WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)        CL**1
                       = SPACE                                             CL**1
                   EVALUATE TRUE                                           CL**1
                       WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)          CL**1
                           SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS   CL**1
                           MOVE SPACE TO ASC-SELECTED-SW                   CL**1
                                            (ASC-BLK-SUB ASC-ITEM-SUB)     CL**1
                       WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           CL**1
                           MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE       CL**1
                           MOVE SPACE TO ASC-SELECTED-SW                   CL**1
                                            (ASC-BLK-SUB ASC-ITEM-SUB)     CL**1
                       WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)             CL**1
                           MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE         CL**1
                           MOVE SPACE TO ASC-SELECTED-SW                   CL**1
                                            (ASC-BLK-SUB ASC-ITEM-SUB)     CL**1
                   END-EVALUATE                                            CL**1
               WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)              CL**1
                   IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)               CL**1
                       SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS       CL**1
                   END-IF                                                  CL**1
                   PERFORM 3310-EDIT-RANGE                                 CL**1
               WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)                CL**1
                   IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)               CL**1
                       SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS       CL**1
                   END-IF                                                  CL**1
                   PERFORM 3310-EDIT-RANGE                                 CL**1
               WHEN OTHER                                                  CL**1
      *            ---- INVALID VALUE ----                                 CL**1
                   MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER              CL**1
                   SET DP020-MSG-FATAL    TO TRUE                          CL**1
                   MOVE -1                TO MR-SELECTL (PV-SUB)           CL**1
                   SET DP030-SET-CURSOR-APPL-1                             CL**1
                                          TO TRUE                          CL**1
                   MOVE DP015-RED         TO MR-SELECTC (PV-SUB)           CL**1
                   MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)           CL**1
                   SET PS-ERROR TO TRUE                                    CL**1
                   IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)               CL**1
                       SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS        CL**1
                       MOVE SPACE         TO ASC-SELECTED-SW               CL**1
                                              (ASC-BLK-SUB ASC-ITEM-SUB)   CL**1
                   END-IF                                                  CL**1
           END-EVALUATE.                                                   CL**1
                                                                           CL**1
           SUBTRACT +1             FROM PV-ITEM-IN-USE.                    CL**1
           SUBTRACT +1 FROM ASC-ITEM-SUB.                                  CL**1
           IF  ASC-ITEM-SUB < 1                                            CL**1
               SUBTRACT +1 FROM ASC-BLK-SUB                                CL**1
               MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                   CL**1
           END-IF.                                                         CL**1
      ******************************************************************   CL**1
      ** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **   CL**1
      ** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **   CL**1
      ** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**   CL**1
      ** THE ENDING.                                                  **   CL**1
      ******************************************************************   CL**1
       3310-EDIT-RANGE.                                                    CL**1
           IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                   CL**1
               IF  ASC-START-OF-SELECTED-RANGE = ZERO                      CL**1
                   MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)   CL**1
                                         TO ASC-SELECTED-SW                CL**1
                                              (ASC-BLK-SUB ASC-ITEM-SUB)   CL**1
                   MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE    CL**1
               ELSE                                                        CL**1
                   IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE        CL**1
                       CONTINUE                                            CL**1
                   ELSE                                                    CL**1
      *                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --           CL**1
                       MOVE PC-TSYMSG-00054                                CL**1
                                         TO DP020-MSG-NUMBER               CL**1
                       SET DP020-MSG-FATAL                                 CL**1
                                         TO TRUE                           CL**1
                       MOVE -1           TO MR-SELECTL (PV-SUB)            CL**1
                       SET DP030-SET-CURSOR-APPL-1                         CL**1
                                         TO TRUE                           CL**1
                       MOVE DP015-RED    TO MR-SELECTC (PV-SUB)            CL**1
                       MOVE DP015-UNDERLINE                                CL**1
                                         TO MR-SELECTH (PV-SUB)            CL**1
                       SET PS-ERROR      TO TRUE                           CL**1
                   END-IF                                                  CL**1
               END-IF                                                      CL**1
           ELSE                                                            CL**1
               IF  ASC-END-OF-SELECTED-RANGE = ZERO                        CL**1
                   MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)    CL**1
                                         TO ASC-SELECTED-SW                CL**1
                                           (ASC-BLK-SUB ASC-ITEM-SUB)      CL**1
                   MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE      CL**1
               ELSE                                                        CL**1
                   IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE          CL**1
                       CONTINUE                                            CL**1
                   ELSE                                                    CL**1
      *                -- ONLY ONE END-OF-RANGE ALLOWED --                 CL**1
                       MOVE PC-TSYMSG-00055                                CL**1
                                         TO DP020-MSG-NUMBER               CL**1
                       SET DP020-MSG-FATAL                                 CL**1
                                         TO TRUE                           CL**1
                       MOVE -1           TO MR-SELECTL (PV-SUB)            CL**1
                       SET DP030-SET-CURSOR-APPL-1                         CL**1
                                         TO TRUE                           CL**1
                       SET PS-ERROR      TO TRUE                           CL**1
                   END-IF                                                  CL**1
               END-IF                                                      CL**1
           END-IF.                                                         CL**1
      *                                                                    CL**1
      ******************************************************************   CL**1
      ** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **   CL**1
      ** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **   CL**1
      ******************************************************************   CL**1
       3400-CHECK-RANGE-SEQUENCE.                                          CL**1
           IF  ASC-START-OF-SELECTED-RANGE > ZERO                          CL**1
             AND  ASC-END-OF-SELECTED-RANGE > ZERO                         CL**1
             AND  ASC-START-OF-SELECTED-RANGE >                            CL**1
                                               ASC-END-OF-SELECTED-RANGE   CL**1
      *        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                   CL**1
               MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                    CL**1
               SET DP020-MSG-FATAL TO TRUE                                 CL**1
               SET PS-ERROR TO TRUE                                        CL**1
               PERFORM 3410-POSITION-AT-ERROR                              CL**1
           ELSE                                                            CL**1
               MOVE -1 TO MR-SELECTL (1)                                   CL**1
           END-IF.                                                         CL**1
           SET DP030-SET-CURSOR-APPL-1   TO TRUE.                          CL**1
                                                                           CL**1
                                                                           CL**1
      ******************************************************************   CL**1
      ** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **   CL**1
      ** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **   CL**1
      ** SHOULD BE POSITIONED ON A RANGE ERROR.                       **   CL**1
      ******************************************************************   CL**1
       3410-POSITION-AT-ERROR.                                             CL**1
           COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                    CL**1
                          - PV-TOP-ITEM + 1.                               CL**1
           IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                         CL**1
               CONTINUE                                                    CL**1
           ELSE                                                            CL**1
               MOVE -1                   TO MR-SELECTL (PV-SUB)            CL**1
               MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)            CL**1
               MOVE DP015-RED            TO MR-SELECTC (PV-SUB)            CL**1
           END-IF.                                                         CL**1
      *                                                                    CL**1
           COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                      CL**1
                          - PV-TOP-ITEM + 1.                               CL**1
           IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                         CL**1
               CONTINUE                                                    CL**1
           ELSE                                                            CL**1
               MOVE -1                   TO MR-SELECTL (PV-SUB)            CL**1
               MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)            CL**1
               MOVE DP015-RED            TO MR-SELECTC (PV-SUB)            CL**1
           END-IF.                                                         CL**1
       EJECT                                                               CL**1
      *----------------------------------------------------------------*   CL**1
      *    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *   CL**1
      *    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *   CL**1
      *    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       3500-MARK-RANGE-AS-SELECTED.                                        CL**1
           MOVE +1                       TO  ASC-BLK-SUB.                  CL**1
           PERFORM 3510-MARK-SELECTED-INDS                                 CL**1
               VARYING ASC-ITEM-SUB                                        CL**1
               FROM 1 BY 1                                                 CL**1
               UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                    CL**1
                                                                           CL**1
           ADD +1                        TO ASC-BLK-SUB.                   CL**1
           PERFORM 3510-MARK-SELECTED-INDS                                 CL**1
               VARYING ASC-ITEM-SUB                                        CL**1
               FROM 1 BY 1                                                 CL**1
               UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                    CL**1
                                                                           CL**1
           MOVE ASC-LIST-ITEM-NUMBER(1 1)                                  CL**1
                                         TO  PV-LIST-ITEM-NUMBER.          CL**1
           COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                               CL**1
               1 + ((PV-LIST-ITEM-NUMBER - 1) /                            CL**1
                     PC-ITEMS-PER-PANEL).                                  CL**1
                                                                           CL**1
           MOVE ASC-START-OF-SELECTED-RANGE                                CL**1
                                         TO PV-START-OF-SELECTED-RANGE.    CL**1
           COMPUTE PV-FIRST-BLOCK-IN-RANGE =                               CL**1
               1 + ((PV-START-OF-SELECTED-RANGE - 1) /                     CL**1
                     PC-ITEMS-PER-PANEL).                                  CL**1
                                                                           CL**1
           MOVE ASC-END-OF-SELECTED-RANGE                                  CL**1
                                         TO  PV-END-OF-SELECTED-RANGE.     CL**1
           COMPUTE PV-LAST-BLOCK-IN-RANGE =                                CL**1
               1 + ((PV-END-OF-SELECTED-RANGE - 1) /                       CL**1
                     PC-ITEMS-PER-PANEL).                                  CL**1
           COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                                CL**1
               PV-FIRST-BLOCK-IN-ARRAY + 1.                                CL**1
                                                                           CL**1
           IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR       CL**1
              (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)           CL**1
               MOVE +1                   TO ASC-BLK-SUB                    CL**1
               PERFORM 5100-WRITE-TEMP-STORAGE                             CL**1
               COMPUTE PV-PREV-BLOCK-IN-ARRAY =                            CL**1
                   PV-FIRST-BLOCK-IN-ARRAY - 1                             CL**1
                                                                           CL**1
               PERFORM                                                     CL**1
                   UNTIL PV-FIRST-BLOCK-IN-RANGE >                         CL**1
                         PV-PREV-BLOCK-IN-ARRAY                            CL**1
                   MOVE PV-FIRST-BLOCK-IN-RANGE                            CL**1
                                         TO PV-BLOCK-NUMBER                CL**1
                   PERFORM 4410-READ-TEMP-STORAGE                          CL**1
                   PERFORM 3510-MARK-SELECTED-INDS                         CL**1
                       VARYING ASC-ITEM-SUB                                CL**1
                       FROM 1 BY 1                                         CL**1
                       UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL             CL**1
                   PERFORM 5100-WRITE-TEMP-STORAGE                         CL**1
                   ADD +1                TO PV-FIRST-BLOCK-IN-RANGE        CL**1
               END-PERFORM                                                 CL**1
                                                                           CL**1
               COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                            CL**1
                   PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY        CL**1
               PERFORM                                                     CL**1
                   UNTIL PV-NEXT-BLOCK-IN-ARRAY >                          CL**1
                         PV-LAST-BLOCK-IN-RANGE                            CL**1
                   MOVE PV-NEXT-BLOCK-IN-ARRAY                             CL**1
                                         TO PV-BLOCK-NUMBER                CL**1
                   PERFORM 4410-READ-TEMP-STORAGE                          CL**1
                   PERFORM 3510-MARK-SELECTED-INDS                         CL**1
                       VARYING ASC-ITEM-SUB                                CL**1
                       FROM 1 BY 1                                         CL**1
                       UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL             CL**1
                   PERFORM 5100-WRITE-TEMP-STORAGE                         CL**1
                   ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY         CL**1
               END-PERFORM                                                 CL**1
                                                                           CL**1
               MOVE PV-FIRST-BLOCK-IN-ARRAY                                CL**1
                                         TO PV-BLOCK-NUMBER                CL**1
               PERFORM 4410-READ-TEMP-STORAGE                              CL**1
           END-IF.                                                         CL**1
                                                                           CL**1
           MOVE +0                       TO ASC-START-OF-SELECTED-RANGE    CL**1
                                            ASC-END-OF-SELECTED-RANGE.     CL**1
                                                                           CL**1
       EJECT                                                               CL**1
      *----------------------------------------------------------------*   CL**1
      * SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       3510-MARK-SELECTED-INDS.                                            CL**1
                                                                           CL**1
           IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                            CL**1
                                      ASC-ITEM-SUB) >                      CL**1
               ASC-START-OF-SELECTED-RANGE)                                CL**1
           OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                            CL**1
                                      ASC-ITEM-SUB) =                      CL**1
               ASC-START-OF-SELECTED-RANGE)                                CL**1
                                                                           CL**1
               IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                        CL**1
                                          ASC-ITEM-SUB) <                  CL**1
                   ASC-END-OF-SELECTED-RANGE)                              CL**1
               OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                        CL**1
                                          ASC-ITEM-SUB) =                  CL**1
                   ASC-END-OF-SELECTED-RANGE)                              CL**1
                                                                           CL**1
                   IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             CL**1
                       SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)      CL**1
                           ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)      CL**1
                                     TO TRUE                               CL**1
                       SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                 CL**1
                                     TO TRUE                               CL**1
                       ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS       CL**1
                   END-IF                                                  CL**1
               END-IF                                                      CL**1
           END-IF.                                                         CL**1
                                                                           CL**1
       EJECT                                                               CL**1
      *----------------------------------------------------------------*   CL**1
      *    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *   CL**1
      *    INITIALIZE ALL COUNTERS AND FLAGS.                          *   CL**1
      *    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *   CL**1
      *    DISPLAY THE PANEL TO USER.                                  *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       4000-BUILD-INITIAL-PANEL.                                           CL**1
                                                                           CL**1
           INITIALIZE                  ASC-BLOCK-ENTRIES (1)               CL**1
                                       ASC-BLOCK-ENTRIES (2).              CL**1
           MOVE +1                 TO ASC-BLK-SUB.                         CL**1
           SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                               CL**1
                                                                           CL**1
           MOVE +0                 TO ASC-ITEM-SUB                         CL**1
                                      ASC-NUMBER-OF-ITEMS-READ             CL**1
                                      ASC-NUMBER-OF-SELECTED-ITEMS         CL**1
                                      ASC-HIGHEST-BLOCK-WRITTEN            CL**1
                                      ASC-START-OF-SELECTED-RANGE          CL**1
                                      ASC-END-OF-SELECTED-RANGE            CL**1
                                      ASC-ITEM-AT-TOP-OF-PANEL.            CL**1
                                                                           CL**1
           MOVE 'C'          TO ASC-INT-APPL-FORMAT-IND.                        
                                                                           CL**1
           PERFORM 4010-OPEN-CURSOR.                                       CL**1
                                                                           CL**1
           IF SQLCODE = ZERO                                               CL**1
               PERFORM 4300-READ-ITEMS-FROM-DB                             CL**1
                                                                           CL**1
               PERFORM 4020-CLOSE-CURSOR                                   CL**1
                                                                           CL**1
               MOVE +1                   TO  PV-TOP-ITEM                   CL**1
               IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                         CL**1
                   SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                   CL**1
                   SET DP020-MSG-FATAL   TO  TRUE                          CL**1
      *            ---- NO LIST ITEMS FOUND FOR CRITERIA ----              CL**1
                   MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER              CL**1
               ELSE                                                        CL**1
                   MOVE -1               TO MR-SELECTL (1)                 CL**1
                   SET DP030-SET-CURSOR-APPL-1                             CL**1
                                         TO TRUE                           CL**1
                   PERFORM                                                 CL**1
                       VARYING PV-SUB                                      CL**1
                       FROM 1 BY 1                                         CL**1
                       UNTIL PV-SUB > PC-ITEMS-PER-PANEL                   CL**1
                       MOVE DP015-BLUE TO MR-SELECTC        (PV-SUB)       CL**1
                                          MR-ACTIONC        (PV-SUB)       CL**1
                                          MR-STOREC         (PV-SUB)       CL**5
                                          MR-STORE-NAMEC    (PV-SUB)       CL**5
                                          MR-LOC-TYPEC      (PV-SUB)       CL**5
                                          MR-ACT-INV-DTEC   (PV-SUB)       CL**5
                                          MR-ACT-RECD-DATEC (PV-SUB)            
                                          MR-ONLINE-SHEETC  (PV-SUB)            
                                          MR-SLE-ADJ-DATEC  (PV-SUB)            
                                          MR-UNT-BK-DATEC   (PV-SUB)            
                   END-PERFORM                                             CL**1
                                                                           CL**1
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
               END-IF                                                      CL**1
           ELSE                                                            CL**1
               SET  DP020-NEXT-ACT-APPL-ERROR                              CL**1
                    DP020-MSG-WARNING         TO TRUE                      CL**1
      *        ---- WAIT 15 SECONDS, THEN RETRY ----                       CL**1
               MOVE PC-TSYMSG-00551  TO  DP020-MSG-NUMBER                  CL**1
           END-IF.                                                         CL**1
                                                                           CL**1
      *----------------------------------------------------------------*   CL**1
      *   OPEN THE CURSOR.                                                 CL**1
      *   IN THIS PARTICULAR APPLICATION ONE OF 5 DIFFERENT CURSORS    *   CL**1
      *   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *   CL**1
      *   USER.                                                        *   CL**1
      *----------------------------------------------------------------*   CL**1
       4010-OPEN-CURSOR.                                                   CL**1
                                                                           CL**1
           PERFORM                                                      INKCS046
               WITH TEST AFTER                                          INKCS046
               VARYING PV-RETRY-COUNTER                                 INKCS046
               FROM 1 BY 1                                              INKCS046
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               INKCS046
                         OR (SQLCODE = ZERO))                           INKCS046
               EVALUATE TRUE                                            INKCS046
                   WHEN ASC-ONLINE-SHEETS-NP                            INKCS046
                        EXEC SQL                                        INKCS046
                             OPEN ONLINE-SHEETS-CSR                     INKCS046
                        END-EXEC                                        INKCS046
                   WHEN OTHER                                           INKCS046
                        SET DP013-LOGIC-ABEND TO TRUE                   INKCS046
                        SET DP013-NO-ROLLBACK TO TRUE                   INKCS046
                        MOVE '4010-OPEN-CURSOR' TO DP013-PARAGRAPH      INKCS046
                        MOVE 'INVALID INTER APPL FORMAT INDICATOR'      INKCS046
                                             TO DP013-MESSAGE-TEXT(1)   INKCS046
                        PERFORM DP013-0000-PROCESS-ABEND                INKCS046
               END-EVALUATE                                             INKCS046
                                                                        INKCS046
               EVALUATE TRUE                                            INKCS046
                   WHEN SQLCODE = ZERO                                  INKCS046
                   WHEN SQLCODE = -904                                  INKCS046
                   WHEN SQLCODE = -913                                  INKCS046
                       CONTINUE                                         INKCS046
                   WHEN SQLWARN0 NOT = SPACES                           INKCS046
                   WHEN SQLCODE < ZERO                                  INKCS046
                   WHEN SQLCODE > ZERO                                  INKCS046
                       MOVE '4010-OPEN-CURSOR'                          INKCS046
                                         TO DP013-PARAGRAPH             INKCS046
                       MOVE 'OPEN LINE CURSOR - '                       INKCS046
                                         TO DP013-MESSAGE-TEXT (1)      INKCS046
                       MOVE SQLCA        TO DP013-SQLCA                 INKCS046
                       MOVE 'TINVPAR '   TO DP013-DB2-TABLE-NAME (1)    INKCS046
                       MOVE 'XMT_LOC '   TO DP013-DB2-TABLE-NAME (2)    INKCS046
                       SET DP013-DB2-ABEND                              INKCS046
                           DP013-XCTL-DISPLAY-RESTART TO TRUE           INKCS046
                       PERFORM DP013-0000-PROCESS-ABEND                 INKCS046
               END-EVALUATE                                             INKCS046
           END-PERFORM.                                                 INKCS046
                                                                        INKCS046
           IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        INKCS046
               MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             INKCS046
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   INKCS046
                                         TO DP013-MESSAGE-TEXT (1)      INKCS046
               MOVE SQLCA                TO DP013-SQLCA                 INKCS046
               MOVE 'TINVPAR '           TO DP013-DB2-TABLE-NAME (1)    INKCS046
               MOVE 'XMT_LOC '           TO DP013-DB2-TABLE-NAME (2)    INKCS046
               SET DP013-DB2-ABEND                                      INKCS046
                   DP013-XCTL-DISPLAY-RESTART                           INKCS046
                                         TO TRUE                        INKCS046
               PERFORM DP013-0000-PROCESS-ABEND                         INKCS046
           END-IF.                                                      INKCS046
                                                                           CL**1
      *----------------------------------------------------------------*   CL**1
      * CLOSE THE CURSOR.                                                  CL**1
      *   IN THIS PARTICULAR APPLICATION ONE OF 2 DIFFERENT CURSORS    *   CL**1
      *   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *   CL**1
      *   USER.                                                        *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       4020-CLOSE-CURSOR.                                                  CL**1
                                                                           CL**1
           EVALUATE TRUE                                                INKCS046
               WHEN ASC-ONLINE-SHEETS-NP                                INKCS046
                    EXEC SQL                                            INKCS046
                         CLOSE ONLINE-SHEETS-CSR                        INKCS046
                    END-EXEC                                            INKCS046
               WHEN OTHER                                               INKCS046
                    SET DP013-LOGIC-ABEND TO TRUE                       INKCS046
                    SET DP013-NO-ROLLBACK TO TRUE                       INKCS046
                    MOVE '4020-CLOSE-CURSOR' TO DP013-PARAGRAPH         INKCS046
                    MOVE 'INVALID INTER APPL FORMAT INDICATOR'          INKCS046
                                         TO DP013-MESSAGE-TEXT(1)       INKCS046
                    PERFORM DP013-0000-PROCESS-ABEND                    INKCS046
           END-EVALUATE.                                                INKCS046
                                                                        INKCS046
           EVALUATE TRUE                                                INKCS046
               WHEN SQLCODE = ZERO                                      INKCS046
                   CONTINUE                                             INKCS046
               WHEN SQLWARN0 NOT = SPACES                               INKCS046
               WHEN SQLCODE < ZERO                                      INKCS046
               WHEN SQLCODE > ZERO                                      INKCS046
                   MOVE '4020-CLOSE-CURSOR'                             INKCS046
                                     TO DP013-PARAGRAPH                 INKCS046
                   MOVE 'CLOSE LINE CURSOR '                            INKCS046
                                     TO DP013-MESSAGE-TEXT (1)          INKCS046
                   MOVE SQLCA        TO DP013-SQLCA                     INKCS046
                   MOVE 'TINVDTL '   TO DP013-DB2-TABLE-NAME (1)        INKCS046
                   MOVE 'XMT_LOC '   TO DP013-DB2-TABLE-NAME (2)        INKCS046
                   SET DP013-DB2-ABEND                                  INKCS046
                       DP013-XCTL-DISPLAY-RESTART TO TRUE               INKCS046
                   PERFORM DP013-0000-PROCESS-ABEND                     INKCS046
           END-EVALUATE.                                                INKCS046
                                                                           CL**1
      *----------------------------------------------------------------*   CL**1
      *    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *   CL**1
      *    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *   CL**1
      *    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *   CL**1
      *    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *   CL**1
      *    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *   CL**1
      *                                                                *   CL**1
      *    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *   CL**1
      *    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *   CL**1
      *    UPON INITIALIZATION.                                        *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       4300-READ-ITEMS-FROM-DB.                                            CL**1
                                                                                
           PERFORM                                                      INKCS046
               VARYING PV-READ-COUNT                                    INKCS046
               FROM 1 BY 1                                              INKCS046
               UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    INKCS046
                  OR (ASC-NO-ITEMS-LEFT-ON-DB))                         INKCS046
                                                                        INKCS046
               PERFORM 4310-FETCH-CURSOR                                INKCS046
                                                                        INKCS046
               IF  ASC-ITEMS-LEFT-ON-DB                                 INKCS046
                   PERFORM 4500-GET-TINENTY                                     
                   IF NOT ASC-ONLINE-SHEETS-NP                          INKCS046
                     OR (PS-TINENTY-FOUND                               INKCS046
                          OR (INVPAR-SCAN-INV-IND = 'N'                 INKCS046
W33304                    AND INVPAR-SCHD-PHY-CNT-CDE = 'PI' OR 'NS'))          
                       IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                INKC
                           ADD +1        TO ASC-ITEM-SUB                    INKC
                       ELSE                                                 INKC
                           ADD +1        TO ASC-BLK-SUB                     INKC
                           MOVE +1       TO ASC-ITEM-SUB                    INKC
                                                                            INKC
                           IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         INKC
                               MOVE +1   TO ASC-BLK-SUB                     INKC
                               SET ASC-BLOCK-MODIFIED (1)                   INKC
                                         TO TRUE                            INKC
                               PERFORM 5100-WRITE-TEMP-STORAGE              INKC
                               MOVE ASC-BLOCK-ENTRIES                       INKC
                                         (PC-MAX-BLOCKS-IN-ARRAY)           INKC
                                       TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)    INKC
                               ADD +1    TO ASC-BLK-SUB                     INKC
                               INITIALIZE ASC-BLOCK-ENTRIES(ASC-BLK-SUB)    INKC
                               SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      INKC
                                         TO TRUE                            INKC
                           END-IF                                       INKCS046
                       END-IF                                           INKCS046
                                                                        INKCS046
                       ADD +1            TO ASC-NUMBER-OF-ITEMS-READ        INKC
                       MOVE ASC-NUMBER-OF-ITEMS-READ                    INKCS046
                                         TO ASC-LIST-ITEM-NUMBER        INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
W26600                 MOVE INVPAR-LOC-NBR                                      
                                         TO ASC-STORE-NUMBER                    
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
W26600                 MOVE XMT00001-LOC-10-ABBR-NM                             
                                         TO ASC-STORE-NAME                      
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
23511C                 MOVE INVPAR-ACTL-INV-RECD-DTE                    INKCS046
23511C                     TO ASC-ACT-RECD-DTE                          INKCS046
23511C                            (ASC-BLK-SUB ASC-ITEM-SUB)            INKCS046
                       PERFORM 4320-FIELD-FILL                                  
                                                                                
                   END-IF                                               INKCS046
               END-IF                                                   INKCS046
           END-PERFORM.                                                 INKCS046
                                                                        INKCS046
           IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                             CL**1
               MOVE +1               TO ASC-BLK-SUB                        CL**1
               PERFORM 5100-WRITE-TEMP-STORAGE                             CL**1
               ADD +1                TO ASC-BLK-SUB                        CL**1
               PERFORM 5100-WRITE-TEMP-STORAGE                             CL**1
                                                                           CL**1
               MOVE 1                TO ASC-BLK-SUB                        CL**1
                                        PV-BLOCK-NUMBER                    CL**1
               PERFORM 4410-READ-TEMP-STORAGE                              CL**1
               IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1                CL**1
                   MOVE 2            TO ASC-BLK-SUB                        CL**1
                                        PV-BLOCK-NUMBER                    CL**1
                   PERFORM 4410-READ-TEMP-STORAGE                          CL**1
               END-IF                                                      CL**1
           END-IF.                                                         CL**1
                                                                           CL**1
      *----------------------------------------------------------------*   CL**1
      * 4310-FETCH-CURSOR.                                                 CL**1
      *----------------------------------------------------------------*   CL**1
       4310-FETCH-CURSOR.                                                  CL**1
                                                                           CL**1
           EVALUATE TRUE                                                INKCS046
               WHEN ASC-ONLINE-SHEETS-NP                                INKCS046
                    EXEC SQL                                            INKCS046
                         FETCH ONLINE-SHEETS-CSR                        INKCS046
                         INTO                                           INKCS046
W26600*                       :INVPAR-STORE-NBR                         INKCS046
W26600                        :INVPAR-LOC-NBR                           INKCS046
                            , :INVPAR-ACTL-INV-DTE                      INKCS046
                            , :INVPAR-PLND-INV-DTE                              
                            , :INVPAR-SCAN-INV-IND                      INKCS046
                            , :INVPAR-ACTL-UNIT-BK-DTE                  INKCS046
                            , :INVPAR-ACTL-FIN-BK-DTE                   INKCS046
                            , :INVPAR-ACTL-INV-RECD-DTE                 INKCS046
                            , :PV-STKRM-WITHD-DAYS-LEFT                 INKCS046
                            , :INVPAR-SLS-ADJ-CPLD-IND                  INKCS046
W33304                      , :INVPAR-SCHD-PHY-CNT-CDE                  INKCS046
                            , :INVPAR-SHEET-INV-CPLD-IND                INKCS046
                            , :INVPAR-UNT-BKG-STAT-CDE                  INKCS046
                            , :INVPAR-FIL-TOT-BAL-CDE                   INKCS046
W26600                      , :XMT00001-LOC-TYP-CDE                     INKCS046
W26600                      , :XMT00001-LOC-10-ABBR-NM:NI-LOC-10-ABBR-NMINKCS046
                    END-EXEC                                            INKCS046
               WHEN OTHER                                               INKCS046
                    SET DP013-LOGIC-ABEND TO TRUE                       INKCS046
                    SET DP013-NO-ROLLBACK TO TRUE                       INKCS046
                    MOVE '4310-FETCH-CURSOR'                            INKCS046
                                          TO DP013-PARAGRAPH            INKCS046
                    MOVE 'INVALID INTER APPL FORMAT INDICATOR'          INKCS046
                                          TO DP013-MESSAGE-TEXT(1)      INKCS046
                    PERFORM DP013-0000-PROCESS-ABEND                    INKCS046
           END-EVALUATE.                                                INKCS046
                                                                        INKCS046
           EVALUATE TRUE                                                INKCS046
               WHEN SQLCODE = ZERO                                      INKCS046
               WHEN SQLCODE = +100                                      INKCS046
                    CONTINUE                                            INKCS046
               WHEN SQLWARN0 NOT = SPACE                                INKCS046
               WHEN SQLCODE NOT = ZERO                                  INKCS046
                    MOVE '4310-FETCH-CURSOR'                            INKCS046
                                     TO DP013-PARAGRAPH                 INKCS046
                    MOVE 'FETCH CURSOR'                                 INKCS046
                                     TO DP013-MESSAGE-TEXT (1)          INKCS046
                    MOVE SQLCA       TO DP013-SQLCA                     INKCS046
                    SET DP013-DB2-ABEND                                 INKCS046
                                     TO TRUE                            INKCS046
                    PERFORM DP013-0000-PROCESS-ABEND                    INKCS046
           END-EVALUATE.                                                INKCS046
                                                                        INKCS046
           IF  SQLCODE EQUAL +100                                       INKCS046
               SET ASC-NO-ITEMS-LEFT-ON-DB                              INKCS046
                                         TO TRUE                        INKCS046
           END-IF.                                                      INKCS046
                                                                           CL**1
      *----------------------------------------------------------------*INKCS046
      * 4320-FIELD-FILL.                                                INKCS046
      * FILL THE LINE FIELDS IN THE COMMAREA.                           INKCS046
      *----------------------------------------------------------------*INKCS046
       4320-FIELD-FILL.                                                 INKCS046
                                                                        INKCS046
      *    FILL LOCATION TYPE                                           INKCS046
W33304     IF INVPAR-SCHD-PHY-CNT-CDE = 'EI'                            INKCS046
               MOVE 'EST SH'                TO ASC-LOC-TYPE             INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
           ELSE                                                                 
W33304         IF INVPAR-SCHD-PHY-CNT-CDE = 'CL'                        INKCS046
                   MOVE 'CLOSED'            TO ASC-LOC-TYPE             INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
               ELSE                                                             
                   IF INVPAR-SCAN-INV-IND = 'Y'                         INKCS046
                       MOVE 'SCAN'          TO ASC-LOC-TYPE             INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                   ELSE                                                         
                       IF INVPAR-SCAN-INV-IND = 'N'                     INKCS046
W26600                     IF XMT00001-LOC-TYP-CDE = 'CS'               INKCS046
W26600                                         OR 'DC' OR 'DA'          INKCS046
                                               OR 'RV'                          
W26600                         MOVE XMT00001-LOC-TYP-CDE                INKCS046
                                            TO ASC-LOC-TYPE             INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                           ELSE                                                 
                               MOVE SPACES  TO ASC-LOC-TYPE             INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                           END-IF                                       INKCS046
                       ELSE                                                     
                           MOVE SPACES      TO ASC-LOC-TYPE             INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                       END-IF                                           INKCS046
                   END-IF                                               INKCS046
               END-IF                                                   INKCS046
           END-IF.                                                      INKCS046
                                                                        INKCS046
      *    FILL ACTUAL INVENTORY DATE                                   INKCS046
           IF INVPAR-ACTL-INV-DTE = PC-INCOMPLETE-DTE                   INKCS046
************** MOVE INVPAR-PLND-INV-DTE(6:5)                            INKCS046
               MOVE INVPAR-PLND-INV-DTE                                 INKCS046
                                 TO ASC-ACT-INV-DTE                     INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
           ELSE                                                                 
************** MOVE INVPAR-PLND-INV-DTE(6:5)                            INKCS046
               MOVE INVPAR-PLND-INV-DTE                                 INKCS046
                                 TO ASC-ACT-INV-DTE                     INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
           END-IF.                                                      INKCS046
                                                                        INKCS046
      *    FILL ACTUAL RECEIVED DATE                                    INKCS046
           IF INVPAR-ACTL-INV-DTE = PC-INCOMPLETE-DTE                   INKCS046
JS0300         MOVE SPACES       TO ASC-ACT-RECD-DATE                   INKCS046
JS0300                                       (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
JS0300     ELSE                                                                 
JS0300       IF INVPAR-ACTL-INV-DTE = PV-CURRENT-DATE                   INKCS046
W33304           IF INVPAR-SCHD-PHY-CNT-CDE = 'PI' OR 'NS'              INKCS046
JS0300              AND INVPAR-SCAN-INV-IND = 'N'                       INKCS046
JS0300                MOVE 'NOT PROC' TO ASC-ACT-RECD-DATE              INKCS046
JS0300                                       (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
JS0300           ELSE                                                           
JS0300              MOVE SPACES       TO ASC-ACT-RECD-DATE              INKCS046
JS0300                                       (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
JS0300           END-IF                                                         
             ELSE                                                               
               IF INVPAR-ACTL-INV-RECD-DTE = PC-INCOMPLETE-DTE          INKCS046
W33304             IF INVPAR-SCHD-PHY-CNT-CDE = 'PI' OR 'NS'            INKCS046
                     AND INVPAR-SCAN-INV-IND = 'Y'                      INKCS046
                       IF INVPAR-FIL-TOT-BAL-CDE = 'Y'                  INKCS046
                           MOVE 'BALANCE'   TO ASC-ACT-RECD-DATE        INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                       ELSE                                                     
                           IF INVPAR-FIL-TOT-BAL-CDE = 'N'              INKCS046
                               MOVE 'PEND TTL' TO ASC-ACT-RECD-DATE     INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                           ELSE                                                 
                               MOVE 'NOT RECD' TO ASC-ACT-RECD-DATE     INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                           END-IF                                               
                       END-IF                                                   
                   ELSE                                                         
W33304                 IF INVPAR-SCHD-PHY-CNT-CDE = 'PI' OR 'NS'        INKCS046
                         AND INVPAR-SCAN-INV-IND = 'N'                  INKCS046
                           MOVE 'NOT PROC' TO ASC-ACT-RECD-DATE         INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                       ELSE                                                     
W33304                     IF INVPAR-SCHD-PHY-CNT-CDE = 'EI' OR 'CL'    INKCS046
                               MOVE 'N/A'  TO ASC-ACT-RECD-DATE         INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                           ELSE                                                 
                               MOVE 'ERR'  TO ASC-ACT-RECD-DATE         INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                       END-IF                                                   
                   END-IF                                                       
               ELSE                                                             
                   MOVE INVPAR-ACTL-INV-RECD-DTE(6:5)                   INKCS046
                                            TO ASC-ACT-RECD-DATE        INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
               END-IF                                                   INKCS046
           END-IF.                                                      INKCS046
                                                                        INKCS046
      *    FILL ON-LINE SHEET                                           INKCS046
           IF INVPAR-SHEET-INV-CPLD-IND = 'S'                           INKCS046
               MOVE 'SELECTED'  TO ASC-ON-LINE-SHEET                            
                                         (ASC-BLK-SUB ASC-ITEM-SUB)             
           ELSE                                                                 
           IF INVPAR-ACTL-INV-DTE = PC-INCOMPLETE-DTE                   INKCS046
JS0400        AND INVPAR-SCAN-INV-IND = 'Y'                             INKCS046
W33304        AND INVPAR-SCHD-PHY-CNT-CDE = 'PI' OR 'NS'                INKCS046
JS0400        AND PS-TINENTY-FOUND                                              
JS0400            MOVE 'STARTED'   TO ASC-ON-LINE-SHEET                         
JS0400                                   (ASC-BLK-SUB ASC-ITEM-SUB)             
JS0400     ELSE                                                                 
JS0400         IF INVPAR-ACTL-INV-DTE = PC-INCOMPLETE-DTE               INKCS046
JS0400             MOVE SPACES      TO ASC-ON-LINE-SHEET                        
JS0400                                   (ASC-BLK-SUB ASC-ITEM-SUB)             
               ELSE                                                             
                 IF INVPAR-SHEET-INV-CPLD-IND = 'Y'                     INKCS046
22000                MOVE PV-SQL-TINENTY-DATE-CHECK(6:5)                        
22000                    TO ASC-ON-LINE-SHEET(ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                 ELSE                                                           
                     IF INVPAR-SCAN-INV-IND = 'Y'                       INKCS046
                         IF PS-TINENTY-FOUND                                    
                             MOVE 'STARTED'   TO ASC-ON-LINE-SHEET      INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                         ELSE                                                   
                             MOVE SPACES      TO ASC-ON-LINE-SHEET      INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                         END-IF                                         INKCS046
                     ELSE                                                       
                        IF INVPAR-ACTL-INV-RECD-DTE = PC-INCOMPLETE-DTE INKCS046
                             IF PS-TINENTY-FOUND                                
                                 MOVE 'STARTED'                         INKCS046
                                            TO ASC-ON-LINE-SHEET        INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                             ELSE                                               
                                 MOVE 'NOT ENTRD'                       INKCS046
                                            TO ASC-ON-LINE-SHEET        INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                             END-IF                                     INKCS046
                         ELSE                                                   
22000                        IF PS-TINENTY-FOUND                                
22000                            MOVE PV-SQL-TINENTY-DATE-CHECK(6:5)            
22000                                TO ASC-ON-LINE-SHEET                       
22000                                        (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
22000                        ELSE                                               
22000                            MOVE 'NONE'                                    
22000                                TO ASC-ON-LINE-SHEET                       
22000                                        (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
22000                        END-IF                                             
                        END-IF                                          INKCS046
                     END-IF                                             INKCS046
                 END-IF                                                 INKCS046
             END-IF                                                     INKCS046
JS0400     END-IF.                                                      INKCS046
                                                                        INKCS046
      *    FILL SALES ADJUSTMENTS                                       INKCS046
W33304     IF INVPAR-SCHD-PHY-CNT-CDE = 'EI'                            INKCS046
W33304       OR INVPAR-SCHD-PHY-CNT-CDE = 'CL'                          INKCS046
             OR INVPAR-SCAN-INV-IND = 'N'                               INKCS046
               MOVE 'N/A'                   TO ASC-SALES-ADJUST         INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB)         
           ELSE                                                                 
               IF INVPAR-ACTL-INV-DTE = PC-INCOMPLETE-DTE               INKCS046
                 OR INVPAR-ACTL-INV-DTE = PV-CURRENT-DATE                       
JS0331           OR INVPAR-ACTL-INV-RECD-DTE = PC-INCOMPLETE-DTE        INKCS046
                   MOVE SPACES              TO ASC-SALES-ADJUST         INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
               ELSE                                                             
                   IF INVPAR-SLS-ADJ-CPLD-IND = 'Y'                     INKCS046
22000                  PERFORM 4800-GET-TADJDTL                                 
22000                  MOVE PV-SQL-TADJDTL-DATE-CHECK(6:5)                      
22000                      TO ASC-SALES-ADJUST(ASC-BLK-SUB ASC-ITEM-SUB)INKCS046
                   ELSE                                                         
W33304                 IF INVPAR-SCHD-PHY-CNT-CDE = 'PI' OR 'NS'        INKCS046
                         AND INVPAR-SCAN-INV-IND = 'Y'                  INKCS046
                         AND INVPAR-SLS-ADJ-CPLD-IND = 'N'              INKCS046
                           PERFORM 4600-GET-TINVDTL                             
                           IF PS-TINVDTL-FOUND                                  
                               MOVE 'WAIT-CORR'                         INKCS046
                                            TO ASC-SALES-ADJUST         INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                           ELSE                                                 
JS0400                       PERFORM 4700-GET-TSTKRMW                           
JS0400                       IF PS-TSTKRMW-NOT-FOUND                            
                               AND PV-STKRM-WITHD-DAYS-LEFT > ZERO      INKCS046
                                   MOVE 'WAIT-STRM'                     INKCS046
                                            TO ASC-SALES-ADJUST         INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                              ELSE                                              
                               MOVE 'WAIT-CAND'                         INKCS046
                                            TO ASC-SALES-ADJUST         INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                              END-IF                                            
                           END-IF                                               
                       ELSE                                                     
                           MOVE 'ERR'       TO ASC-SALES-ADJUST         INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                       END-IF                                                   
                   END-IF                                                       
               END-IF                                                   INKCS046
           END-IF.                                                      INKCS046
                                                                        INKCS046
      *    FILL UNIT BOOKINGS                                           INKCS046
           IF INVPAR-SCAN-INV-IND = 'N'                                 INKCS046
W26600       AND (XMT00001-LOC-TYP-CDE = 'DC' OR 'DA' OR 'RV')                  
               MOVE 'N/A'                   TO ASC-UNIT-BOOKING         INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
           ELSE                                                                 
W33304         IF INVPAR-SCHD-PHY-CNT-CDE = 'EI'                        INKCS046
                   MOVE 'N/A'               TO ASC-UNIT-BOOKING         INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
               ELSE                                                             
                   IF INVPAR-ACTL-INV-RECD-DTE = PC-INCOMPLETE-DTE      INKCS046
JS0500               AND INVPAR-ACTL-INV-DTE = PC-INCOMPLETE-DTE                
W33304               AND INVPAR-SCHD-PHY-CNT-CDE = 'CL'                         
                       MOVE SPACES          TO ASC-UNIT-BOOKING         INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
JS0500             ELSE                                                         
JS0500             IF INVPAR-ACTL-INV-RECD-DTE = PC-INCOMPLETE-DTE      INKCS046
W33304               AND INVPAR-SCHD-PHY-CNT-CDE NOT = 'CL'                     
                       MOVE SPACES          TO ASC-UNIT-BOOKING         INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                   ELSE                                                         
                       IF INVPAR-ACTL-UNIT-BK-DTE = PC-INCOMPLETE-DTE   INKCS046
                           IF INVPAR-SLS-ADJ-CPLD-IND NOT = 'Y'         INKCS046
W33304                       AND INVPAR-SCHD-PHY-CNT-CDE NOT = 'CL'             
                               MOVE 'WAIT-SLS ADJ'                      INKCS046
                                            TO ASC-UNIT-BOOKING         INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                           ELSE                                                 
W33304                       IF INVPAR-UNT-BKG-STAT-CDE = 'SL'          INKCS046
                                 MOVE 'WAIT-NOT SEL'                    INKCS046
                                            TO ASC-UNIT-BOOKING         INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                             ELSE                                               
W33304                         IF INVPAR-UNT-BKG-STAT-CDE = 'AP'        INKCS046
                                   MOVE 'SEL FOR BKNG'                  INKCS046
                                            TO ASC-UNIT-BOOKING         INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                               ELSE                                             
W33304                           IF INVPAR-UNT-BKG-STAT-CDE = 'IP'      INKCS046
                                     MOVE 'BKNG IN PROC'                INKCS046
                                            TO ASC-UNIT-BOOKING         INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                                 ELSE                                           
W33304                           IF INVPAR-UNT-BKG-STAT-CDE = 'IN'      INKCS046
JS0400                               MOVE 'WAIT-CAND   '                INKCS046
JS0400                                      TO ASC-UNIT-BOOKING         INKCS046
JS0400                                       (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                                 ELSE                                           
                                     MOVE 'ERROR       '                INKCS046
                                            TO ASC-UNIT-BOOKING         INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                                 END-IF                                         
                               END-IF                                           
                             END-IF                                             
                           END-IF                                               
                       ELSE                                                     
                           MOVE INVPAR-ACTL-UNIT-BK-DTE(6:5)            INKCS046
                                            TO ASC-UNIT-BOOKING         INKCS046
                                             (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
                       END-IF                                                   
                   END-IF                                                       
               END-IF                                                   INKCS046
           END-IF.                                                      INKCS046
                                                                        INKCS046
      *----------------------------------------------------------------*   CL**1
      * MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       4400-MOVE-COMMAREA-TO-SCREEN.                                       CL**1
                                                                           CL**1
           IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))                CL**1
               AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))             CL**1
               OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))             CL**1
                   MOVE +1    TO ASC-BLK-SUB                               CL**1
                   PERFORM 5100-WRITE-TEMP-STORAGE                         CL**1
                   ADD +1     TO ASC-BLK-SUB                               CL**1
                   PERFORM 5100-WRITE-TEMP-STORAGE                         CL**1
                   DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                CL**1
                       GIVING PV-BLOCK-NUMBER                              CL**1
                       REMAINDER PV-REMAINDER                              CL**1
                   IF  PV-REMAINDER > ZERO                                 CL**1
                       ADD +1 TO PV-BLOCK-NUMBER                           CL**1
                   END-IF                                                  CL**1
                   MOVE +1    TO ASC-BLK-SUB                               CL**1
                   PERFORM 4410-READ-TEMP-STORAGE                          CL**1
                   ADD +1     TO ASC-BLK-SUB                               CL**1
                                 PV-BLOCK-NUMBER                           CL**1
                   PERFORM 4410-READ-TEMP-STORAGE                          CL**1
           END-IF.                                                         CL**1
           MOVE +1            TO ASC-BLK-SUB.                              CL**1
           COMPUTE ASC-ITEM-SUB =                                          CL**1
               ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))                 CL**1
               + PC-ITEMS-PER-PANEL).                                      CL**1
      *                                                                    CL**1
           IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                           CL**1
               ADD +1         TO ASC-BLK-SUB                               CL**1
               SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB               CL**1
           END-IF.                                                         CL**1
      *                                                                    CL**1
           COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                              CL**1
               ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                   CL**1
           PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                           CL**1
23511C     MOVE ASC-TODAYS-DATE-YYYY TO PV-CURRENT-DATE-CCYY.              CL**1
23511C     MOVE ASC-TODAYS-DATE-MM TO PV-CURRENT-DATE-MM.                  CL**1
23511C     MOVE ASC-TODAYS-DATE-DD TO PV-CURRENT-DATE-DD.                  CL**1
           PERFORM 4420-FORMAT-LIST-LINES                                  CL**1
               VARYING PV-SUB                                              CL**1
               FROM PC-ITEMS-PER-PANEL BY -1                               CL**1
               UNTIL PV-SUB < +1.                                          CL**1
      *                                                                    CL**1
           COMPUTE ASC-ITEMS-DISPLAYED =                                   CL**1
               ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).             CL**1
           IF PS-NO-START-ITEM-ERROR                                       CL**1
               MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL   CL**1
                                                ASTRTITO                   CL**1
               MOVE SPACE                    TO ASC-START-ITEM-REQUEST     CL**1
           ELSE                                                            CL**1
               MOVE ASC-START-ITEM-REQUEST   TO ASTRTITO                   CL**1
           END-IF.                                                         CL**1
           MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                       CL**1
           MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                       CL**1
           MOVE ASC-NUMBER-OF-SELECTED-ITEMS                               CL**1
                                         TO ASELITO.                       CL**1
      *                                                                    CL**1
           IF  DP020-MSG-NUMBER-X = SPACE                                  CL**1
               IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ     CL**1
      *            --- MORE ITEMS TO DISPLAY ----                          CL**1
                   MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER               CL**1
                   SET DP020-MSG-INFORMATIONAL TO TRUE                     CL**1
               END-IF                                                      CL**1
           END-IF.                                                         CL**1
      *----------------------------------------------------------------*   CL**1
      *    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       4410-READ-TEMP-STORAGE.                                             CL**1
                                                                           CL**1
           EXEC CICS                                                       CL**1
               READQ TS                                                    CL**1
                   QUEUE (ASC-LIST-QUEUE-NAME)                             CL**1
                   INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                  CL**1
                   ITEM  (PV-BLOCK-NUMBER)                                 CL**1
                   RESP  (PV-CICS-RESP)                                    CL**1
           END-EXEC.                                                       CL**1
                                                                           CL**1
           IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                          CL**1
             OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                        CL**1
               CONTINUE                                                    CL**1
           ELSE                                                            CL**1
               SET DP013-CICS-ABEND     TO TRUE                            CL**1
               SET DP013-NO-ROLLBACK    TO TRUE                            CL**1
               MOVE '4410-READ-TEMP-STORAGE'                               CL**1
                                        TO DP013-PARAGRAPH                 CL**1
               MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'         CL**1
                                        TO DP013-MESSAGE-TEXT(1)           CL**1
               PERFORM DP013-0000-PROCESS-ABEND                            CL**1
           END-IF.                                                         CL**1
                                                                           CL**1
           SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.                CL**1
      *                                                                    CL**1
           IF  PV-CICS-RESP = DFHRESP (ITEMERR)                            CL**1
               INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)                  CL**1
           END-IF.                                                         CL**1
       EJECT                                                               CL**1
      *----------------------------------------------------------------*   CL**1
      *    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       4420-FORMAT-LIST-LINES.                                             CL**1
           IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ         CL**1
               SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                   CL**1
               MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)              CL**1
               MOVE SPACE              TO MR-SELECTI (PV-SUB)              CL**1
                                          MR-ACTION  (PV-SUB)              CL**1
      *----------------------INITIALIZE MAP FIELDS                         CL**1
               MOVE SPACE              TO MR-STORE         (PV-SUB)     INKCS046
                                          MR-STORE-NAME    (PV-SUB)     INKCS046
                                          MR-LOC-TYPE      (PV-SUB)     INKCS046
                                          MR-ACT-INV-DTE   (PV-SUB)     INKCS046
                                          MR-ACT-RECD-DATE (PV-SUB)     INKCS046
                                          MR-ONLINE-SHEET (PV-SUB)      INKCS046
                                          MR-SLE-ADJ-DATE (PV-SUB)      INKCS046
                                          MR-UNT-BK-DATE   (PV-SUB)     INKCS046
      *----------------------END INITIALIZE                                CL**1
           ELSE                                                            CL**1
               IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         CL**1
                                                         > SPACE           CL**1
                   MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)    CL**1
                                       TO MR-SELECTI (PV-SUB)              CL**1
               ELSE                                                        CL**1
                   MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         CL**1
                                       TO MR-SELECTI (PV-SUB)              CL**1
               END-IF                                                      CL**1
      *                                                                    CL**1
               IF  DP030-SET-CURSOR-TRAILER                                CL**1
                   IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)   CL**1
                       > SPACE)                                            CL**1
                     OR (PV-SUB = 1))                                      CL**1
                      SET DP030-SET-CURSOR-APPL-1 TO TRUE                  CL**1
                      MOVE -1          TO MR-SELECTL (PV-SUB)              CL**1
                   END-IF                                                  CL**1
               END-IF                                                      CL**1
      *                                                                         
23511C         IF (ASC-ACT-RECD-DTE (ASC-BLK-SUB ASC-ITEM-SUB)                  
23511C               = PC-INCOMPLETE-DTE )                              INKCS046
23511C             IF  (ASC-LOC-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)                 
23511C                  = 'CS' OR 'DC' OR 'DA' OR 'RV')                         
23511C                 IF PV-CURRENT-DATE-CCYY-MM-DD                    INKCS046
23511C                     < ASC-ACT-INV-DTE (ASC-BLK-SUB ASC-ITEM-SUB) INKCS046
23511C                     MOVE DP015-ASK-DRK-OFF                               
23511C                         TO MR-SELECTA (PV-SUB)                           
23511C                     MOVE SPACE        TO MR-SELECTI (PV-SUB)        CL**1
23511C                                          MR-ACTION  (PV-SUB)        CL**1
23511C                 END-IF                                              CL**1
23511C             ELSE                                                         
23511C                 MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)      CL**1
23511C                 MOVE SPACE              TO MR-SELECTI (PV-SUB)      CL**1
23511C                                            MR-ACTION  (PV-SUB)      CL**1
23511C             END-IF                                                  CL**1
23511C         END-IF                                                           
      *                                                                         
               IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL                   
      *---------------MOVE COMMAREA TO THE SCREEN----------------------         
                   MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)              CL**1
                                       TO MR-ACTION (PV-SUB)               CL**6
                   MOVE ASC-STORE-NUMBER  (ASC-BLK-SUB ASC-ITEM-SUB)    INKCS046
                                       TO MR-STORE         (PV-SUB)     INKCS046
                   MOVE ASC-STORE-NAME    (ASC-BLK-SUB ASC-ITEM-SUB)    INKCS046
                                       TO MR-STORE-NAME    (PV-SUB)     INKCS046
                   MOVE ASC-LOC-TYPE      (ASC-BLK-SUB ASC-ITEM-SUB)    INKCS046
                                       TO MR-LOC-TYPE      (PV-SUB)     INKCS046
                   MOVE ASC-ACT-INV-DTE                                 INKCS046
                         (ASC-BLK-SUB ASC-ITEM-SUB)(6:5)                INKCS046
                                       TO MR-ACT-INV-DTE   (PV-SUB)     INKCS046
                   MOVE ASC-ACT-RECD-DATE (ASC-BLK-SUB ASC-ITEM-SUB)    INKCS046
                                       TO MR-ACT-RECD-DATE (PV-SUB)     INKCS046
                   MOVE ASC-ON-LINE-SHEET (ASC-BLK-SUB ASC-ITEM-SUB)    INKCS046
                                       TO MR-ONLINE-SHEET (PV-SUB)      INKCS046
                   MOVE ASC-SALES-ADJUST  (ASC-BLK-SUB ASC-ITEM-SUB)    INKCS046
                                       TO MR-SLE-ADJ-DATE (PV-SUB)      INKCS046
                   MOVE ASC-UNIT-BOOKING  (ASC-BLK-SUB ASC-ITEM-SUB)    INKCS046
                                       TO MR-UNT-BK-DATE   (PV-SUB)     INKCS046
                   MOVE DP015-BLUE     TO MR-STOREC        (PV-SUB)             
                                          MR-STORE-NAMEC   (PV-SUB)             
                                          MR-LOC-TYPEC     (PV-SUB)             
                                          MR-ACT-INV-DTEC (PV-SUB)              
                                          MR-ACT-RECD-DATEC (PV-SUB)            
                                          MR-ONLINE-SHEETC (PV-SUB)             
                                          MR-SLE-ADJ-DATEC (PV-SUB)             
                                          MR-UNT-BK-DATEC (PV-SUB)              
      *---------------MOVE COMMAREA TO THE SCEEN-----------------------         
               END-IF                                                           
           END-IF.                                                              
           SUBTRACT +1 FROM ASC-ITEM-SUB                                        
           IF  ASC-ITEM-SUB < + 1                                               
               MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                          
               MOVE +1                 TO ASC-BLK-SUB                           
           END-IF.                                                              
      ******************************************************************        
      ** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **        
      ** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **        
      ** ISSUE A WARNING.                                             **        
      ******************************************************************        
       4430-CHECK-FOR-BEGIN-AND-END.                                            
           IF  ASC-START-OF-SELECTED-RANGE > ZERO                               
               IF  ASC-END-OF-SELECTED-RANGE = ZERO                             
      *            -- NO END-OF-RANGE SPECFIED ---                              
                   MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER                    
                   SET DP020-MSG-WARNING TO TRUE                                
                   PERFORM 4431-POSITION-AT-WARNING                             
               END-IF                                                           
           ELSE                                                                 
               IF  ASC-END-OF-SELECTED-RANGE > ZERO                             
      *            -- NO BEGINNING-OF-RANGE SPECFIED ---                        
                   MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER                    
                   SET DP020-MSG-WARNING TO TRUE                                
                   PERFORM 4431-POSITION-AT-WARNING                             
               END-IF                                                           
           END-IF.                                                              
      ******************************************************************        
      ** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **        
      ** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **        
      ** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **        
      ** POSITION THE CURSOR THERE.                                   **        
      ******************************************************************        
       4431-POSITION-AT-WARNING.                                                
           COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                         
                          - PV-TOP-ITEM + 1.                                    
           IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
               CONTINUE                                                         
           ELSE                                                                 
               SET DP030-SET-CURSOR-APPL-1                                      
                                         TO TRUE                                
               MOVE -1                   TO MR-SELECTL (PV-SUB)                 
               MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)                 
               MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)                 
           END-IF.                                                              
      *                                                                         
           COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                           
                          - PV-TOP-ITEM + 1.                                    
           IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
               CONTINUE                                                         
           ELSE                                                                 
               SET DP030-SET-CURSOR-APPL-1                                      
                                         TO TRUE                                
               MOVE -1                   TO MR-SELECTL (PV-SUB)                 
               MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)            CL**1
               MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)            CL**1
           END-IF.                                                         CL**1
                                                                           CL**1
      *----------------------------------------------------------------*   CL*17
      * DETERMINE IF A ROW EXISTS ON THE TINENTY TABLE FOR A STORE     *   CL*17
22000 * AND GET THE LATEST ENTRY DATE FOR REPORTING                    *   CL*17
      *----------------------------------------------------------------*   CL*17
       4500-GET-TINENTY.                                                   CL*17
                                                                           CL*17
W26600*        MOVE INVPAR-STORE-NBR TO PV-NUM-STORE.                      CL*17
W26600*        MOVE PV-NUM-STORE     TO INENTY-STR-NBR.                    CL*17
               MOVE INVPAR-LOC-NBR   TO INENTY-STR-NBR.                    CL*17
                                                                           CL*17
               EXEC SQL                                                    CL*17
22000              SELECT MAX(DATE(LAST_UPD_TMST))                         CL*17
22000              INTO  :PV-SQL-TINENTY-DATE-CHECK                        CL*17
                   FROM  TINENTY                                           CL*17
                   WHERE STR_NBR = :INENTY-STR-NBR                         CL*17
               END-EXEC.                                                   CL*17
                                                                           CL*17
               EVALUATE TRUE                                               CL*17
                   WHEN SQLCODE = ZERO                                     CL*17
22000                  SET PS-TINENTY-FOUND TO TRUE                        CL*17
22000              WHEN SQLCODE = -305                                     CL*17
22000                  MOVE SPACES TO PV-SQL-TINENTY-DATE-CHECK                 
22000                  SET PS-TINENTY-NOT-FOUND TO TRUE                    CL*17
22000              WHEN SQLCODE = +100                                     CL*17
22000                  MOVE SPACES TO PV-SQL-TINENTY-DATE-CHECK                 
22000                  SET PS-TINENTY-NOT-FOUND TO TRUE                    CL*17
                   WHEN SQLWARN0 NOT = SPACES                              CL*17
                   WHEN SQLCODE NOT EQUAL ZERO                             CL*17
                       MOVE '4500-GET-TINENTY'                             CL*17
                                         TO DP013-PARAGRAPH                CL*17
22000                  MOVE 'CHECK/GET TINENTY DATE'                       CL*17
                                         TO DP013-MESSAGE-TEXT (1)         CL*17
                       MOVE SQLCA        TO DP013-SQLCA                    CL*17
                       MOVE 'TINENTY'    TO DP013-DB2-TABLE-NAME (1)       CL*17
                       SET DP013-DB2-ABEND                                 CL*17
                           DP013-XCTL-DISPLAY-RESTART                      CL*17
                                         TO TRUE                           CL*17
                       PERFORM DP013-0000-PROCESS-ABEND                    CL*17
               END-EVALUATE.                                               CL*17
      /                                                                 INKCS046
      *----------------------------------------------------------------*   CL*17
      * DETERMINE IF A ROW EXISTS ON THE TINVDTL TABLE FOR A STORE     *   CL*17
      *----------------------------------------------------------------*   CL*17
                                                                           CL*17
       4600-GET-TINVDTL.                                                   CL*17
                                                                           CL*17
               EXEC SQL                                                    CL*17
                   SELECT '1'                                              CL*17
                   INTO  :PV-LITERAL                                       CL*17
                   FROM  TINVDTL                                           CL*17
W26600*            WHERE STORE_NBR       = :INVPAR-STORE-NBR               CL*17
W26600             WHERE LOC_NBR         = :INVPAR-LOC-NBR                 CL*17
22960                AND INVALID_REC_IND = 'Y'                                  
               END-EXEC.                                                   CL*17
                                                                           CL*17
               EVALUATE TRUE                                               CL*17
                   WHEN SQLCODE = ZERO                                     CL*17
                   WHEN SQLCODE = -811                                     CL*17
                       SET PS-TINVDTL-FOUND TO TRUE                        CL*17
                   WHEN SQLCODE = +100                                     CL*17
                       SET PS-TINVDTL-NOT-FOUND TO TRUE                    CL*17
                   WHEN SQLWARN0 NOT = SPACES                              CL*17
                   WHEN SQLCODE NOT EQUAL ZERO                             CL*17
                       MOVE '4600-GET-TINVDTL'                             CL*17
                                         TO DP013-PARAGRAPH                CL*17
                       MOVE 'SELECT TINVDTL COUNT'                         CL*17
                                         TO DP013-MESSAGE-TEXT (1)         CL*17
                       MOVE SQLCA        TO DP013-SQLCA                    CL*17
                       MOVE 'TINVDTL'    TO DP013-DB2-TABLE-NAME (1)       CL*17
                       SET DP013-DB2-ABEND                                 CL*17
                           DP013-XCTL-DISPLAY-RESTART                      CL*17
                                         TO TRUE                           CL*17
                       PERFORM DP013-0000-PROCESS-ABEND                    CL*17
               END-EVALUATE.                                               CL*17
      /                                                                 INKCS046
      *----------------------------------------------------------------*   CL*17
      * DETERMINE IF A ROW EXISTS ON THE TSTKRMW TABLE FOR A STORE     *   CL*17
      *----------------------------------------------------------------*   CL*17
                                                                           CL*17
JS0400 4700-GET-TSTKRMW.                                                   CL*17
                                                                           CL*17
W26600*        MOVE INVPAR-STORE-NBR TO PV-NUM-STORE.                      CL*17
W26600*        MOVE PV-NUM-STORE     TO STKRMW-STORE-NBR.                  CL*17
W26600         MOVE INVPAR-LOC-NBR   TO STKRMW-LOC-NBR.                    CL*17
                                                                           CL*17
               EXEC SQL                                                    CL*17
                   SELECT '1'                                              CL*17
                   INTO  :PV-LITERAL                                       CL*17
                   FROM  TSTKRMW                                           CL*17
                   WHERE LOC_NBR = :STKRMW-LOC-NBR                         CL*17
               END-EXEC.                                                   CL*17
                                                                           CL*17
               EVALUATE TRUE                                               CL*17
                   WHEN SQLCODE = ZERO                                     CL*17
                   WHEN SQLCODE = -811                                     CL*17
                       SET PS-TSTKRMW-FOUND TO TRUE                        CL*17
                   WHEN SQLCODE = +100                                     CL*17
                       SET PS-TSTKRMW-NOT-FOUND TO TRUE                    CL*17
                   WHEN SQLWARN0 NOT = SPACES                              CL*17
                   WHEN SQLCODE NOT EQUAL ZERO                             CL*17
                       MOVE '4700-GET-TSTKRMW'                             CL*17
                                         TO DP013-PARAGRAPH                CL*17
                       MOVE 'SELECT TSTKRMW COUNT'                         CL*17
                                         TO DP013-MESSAGE-TEXT (1)         CL*17
                       MOVE SQLCA        TO DP013-SQLCA                    CL*17
                       MOVE 'TSTKRMW'    TO DP013-DB2-TABLE-NAME (1)       CL*17
                       SET DP013-DB2-ABEND                                 CL*17
                           DP013-XCTL-DISPLAY-RESTART                      CL*17
                                         TO TRUE                           CL*17
                       PERFORM DP013-0000-PROCESS-ABEND                    CL*17
               END-EVALUATE.                                               CL*17
                                                                           CL*17
22000 *----------------------------------------------------------------*   CL*17
22000 * DETERMINE IF A ROW EXISTS ON THE TADJDTL TABLE FOR A STORE     *   CL*17
22000 * AND GET THE LATEST ENTRY DATE FOR REPORTING                    *   CL*17
22000 *----------------------------------------------------------------*   CL*17
22000  4800-GET-TADJDTL.                                                   CL*17
22000                                                                      CL*17
22000 *        MOVE INVPAR-STORE-NBR TO PV-NUM-STORE.                      CL*17
22000 *        MOVE PV-NUM-STORE     TO ADJDTL-STORE-NBR.                  CL*17
W26600         MOVE INVPAR-LOC-NBR   TO ADJDTL-LOC-NBR                     CL*17
22000                                                                      CL*17
22000          EXEC SQL                                                    CL*17
22000              SELECT MAX(DATE(CRE_TMST))                              CL*17
22000              INTO  :PV-SQL-TADJDTL-DATE-CHECK                        CL*17
22000              FROM  TADJDTL                                           CL*17
22000 *            WHERE STORE_NBR = :ADJDTL-STORE-NBR                     CL*17
W26600             WHERE LOC_NBR = :ADJDTL-LOC-NBR                         CL*17
22000                  AND ADJ_TYPE_CDE = 'SA'                                  
22000          END-EXEC.                                                   CL*17
22000                                                                      CL*17
22000          EVALUATE TRUE                                               CL*17
22000              WHEN SQLCODE = ZERO                                     CL*17
22000                  CONTINUE                                            CL*17
22000              WHEN SQLCODE = -305                                     CL*17
22000                  MOVE SPACES TO PV-SQL-TADJDTL-DATE-CHECK            CL*17
22000              WHEN SQLCODE = +100                                     CL*17
22000                  MOVE SPACES TO PV-SQL-TADJDTL-DATE-CHECK            CL*17
22000              WHEN SQLWARN0 NOT = SPACES                              CL*17
22000              WHEN SQLCODE NOT EQUAL ZERO                             CL*17
22000                  MOVE '4800-GET-TADJDTL'                             CL*17
22000                                    TO DP013-PARAGRAPH                CL*17
22000                  MOVE 'CHECK/GET TADJDTL DATE'                       CL*17
22000                                    TO DP013-MESSAGE-TEXT (1)         CL*17
22000                  MOVE SQLCA        TO DP013-SQLCA                    CL*17
22000                  MOVE 'TADJDTL'    TO DP013-DB2-TABLE-NAME (1)       CL*17
22000                  SET DP013-DB2-ABEND                                 CL*17
22000                      DP013-XCTL-DISPLAY-RESTART                      CL*17
22000                                    TO TRUE                           CL*17
22000                  PERFORM DP013-0000-PROCESS-ABEND                    CL*17
22000          END-EVALUATE.                                               CL*17
22000                                                                   INKCS046
      /----------------------------------------------------------------*   CL**1
      * PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *   CL**1
      * ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *   CL**1
      * FOR THE SELECTED ITEMS QUEUE.                                  *   CL**1
      *                                                                *   CL**1
      * FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *   CL**1
      * QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *   CL**1
      * THE ARRAY IS FULL.                                             *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       5000-PREPARE-SEL-QUEUE.                                             CL**1
                                                                           CL**1
           MOVE +1                   TO  ASC-BLK-SUB.                      CL**1
           PERFORM 5100-WRITE-TEMP-STORAGE.                                CL**1
           ADD +1                    TO  ASC-BLK-SUB.                      CL**1
           PERFORM 5100-WRITE-TEMP-STORAGE.                                CL**1
                                                                           CL**1
           MOVE ASC-SEL-QUEUE-NAME   TO  IN035-SEL-QUEUE-NAME.             CL**1
           PERFORM 6010-DELETE-SEL-QUEUE.                                  CL**1
                                                                           CL**1
           SET ASC-UPDATE-TSQ        TO  TRUE.                             CL**1
                                                                           CL**1
           SET IN035-IDX             TO  1.                                CL**1
           MOVE ZERO                 TO IN035-NUMBER-OF-TS-ITEMS.          CL**1
           INITIALIZE IN035-SELECTED-ITEM-ARRAY.                           CL**1
                                                                           CL**1
           PERFORM 5200-FILL-SEL-QUEUE-RECORD                              CL**1
                   VARYING PV-ITEM                                         CL**1
                   FROM 1 BY 1                                             CL**1
                   UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN.              CL**1
                                                                           CL**1
           IF  IN035-IDX > 1                                               CL**1
               PERFORM 5205-WRITE-SEL-QUEUE                                CL**1
               ADD +1                TO IN035-NUMBER-OF-TS-ITEMS           CL**1
           END-IF.                                                         CL**1
       EJECT                                                               CL**1
      *----------------------------------------------------------------*   CL**1
      *    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *   CL**1
      *    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       5100-WRITE-TEMP-STORAGE.                                            CL**1
           MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                        CL**1
                                         TO PV-LIST-ITEM-NUMBER.           CL**1
           COMPUTE PV-BLOCK-NUMBER =                                       CL**1
               1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).       CL**1
                                                                           CL**1
           IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)                CL**1
           OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)                CL**1
               IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                         CL**1
                   PERFORM 5105-REWRITE-ASC-LISTQ                          CL**1
               END-IF                                                      CL**1
           ELSE                                                            CL**1
               COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                          CL**1
               ASC-HIGHEST-BLOCK-WRITTEN + 1                               CL**1
               PERFORM 5110-WRITE-ASC-LISTQ                                CL**1
               ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN      CL**1
           END-IF.                                                         CL**1
                                                                           CL**1
           SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.                CL**1
      ******************************************************************   CL**1
      ** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **   CL**1
      ** SPECIFIC COMMAREA.                                           **   CL**1
      ******************************************************************   CL**1
       5105-REWRITE-ASC-LISTQ.                                             CL**1
           EXEC CICS                                                       CL**1
               WRITEQ TS                                                   CL**1
                   QUEUE (ASC-LIST-QUEUE-NAME)                             CL**1
                   FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                  CL**1
                   ITEM  (PV-BLOCK-NUMBER)                                 CL**1
                   REWRITE                                                 CL**1
                   RESP  (PV-CICS-RESP)                                    CL**1
           END-EXEC.                                                       CL**1
                                                                           CL**1
           IF  PV-CICS-RESP = DFHRESP(NORMAL)                              CL**1
               CONTINUE                                                    CL**1
           ELSE                                                            CL**1
               SET DP013-CICS-ABEND            TO TRUE                     CL**1
               SET DP013-NO-ROLLBACK           TO TRUE                     CL**1
               MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH          CL**1
               MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'        CL**1
                                               TO DP013-MESSAGE-TEXT(1)    CL**1
               PERFORM DP013-0000-PROCESS-ABEND                            CL**1
           END-IF.                                                         CL**1
                                                                           CL**1
      ******************************************************************   CL**1
      ** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **   CL**1
      ** SPECIFIC COMMAREA.                                           **   CL**1
      ******************************************************************   CL**1
       5110-WRITE-ASC-LISTQ.                                               CL**1
           EXEC CICS                                                       CL**1
               WRITEQ TS                                                   CL**1
                   QUEUE (ASC-LIST-QUEUE-NAME)                             CL**1
                   FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                  CL**1
                   ITEM  (PV-BLOCK-NUMBER)                                 CL**1
                   RESP  (PV-CICS-RESP)                                    CL**1
           END-EXEC.                                                       CL**1
           IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                         CL**1
               SET DP013-CICS-ABEND      TO TRUE                           CL**1
               SET DP013-NO-ROLLBACK     TO TRUE                           CL**1
               MOVE '5110-WRITE-ASC-LISTQ'                                 CL**1
                                         TO DP013-PARAGRAPH                CL**1
               MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'              CL**1
                                         TO DP013-MESSAGE-TEXT(1)          CL**1
               PERFORM DP013-0000-PROCESS-ABEND                            CL**1
           END-IF.                                                         CL**1
       EJECT                                                               CL**1
      *----------------------------------------------------------------*   CL**1
      * READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *   CL**1
      * TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       5200-FILL-SEL-QUEUE-RECORD.                                         CL**1
                                                                           CL**1
           PERFORM 6112-READ-LIST-QUEUE.                                   CL**1
                                                                           CL**1
           IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                          CL**1
               PERFORM                                                     CL**1
               VARYING LQW-IDX                                             CL**1
               FROM 1 BY 1                                                 CL**1
               UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL               CL**1
                 OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO             CL**1
                                                                           CL**1
                   IF  LQW-SELECT (LQW-IDX)                                CL**1
                       MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)                 CL**1
                                         TO IN035-ITEM (IN035-IDX)         CL**1
                       MOVE LQW-STORE-NUMBER  (LQW-IDX)                    CL**1
                             TO IN035-STORE-NBR (IN035-IDX)                CL**1
                       MOVE LQW-ACT-INV-DTE  (LQW-IDX)                     CL**1
                             TO IN035-ACTL-INV-DTE (IN035-IDX)             CL**1
                       MOVE SPACE        TO IN035-ACTION-SW (IN035-IDX)    CL**1
                       SET IN035-IDX UP BY 1                               CL**1
                       IF  IN035-IDX > IN035-MAX-ITEMS                     CL**1
                           PERFORM 5205-WRITE-SEL-QUEUE                    CL**1
                           ADD +1        TO IN035-NUMBER-OF-TS-ITEMS       CL**1
                           INITIALIZE IN035-SELECTED-ITEM-ARRAY            CL**1
                           SET IN035-IDX TO  1                             CL**1
                       END-IF                                              CL**1
                   END-IF                                                  CL**1
               END-PERFORM                                                 CL**1
           END-IF.                                                         CL**1
                                                                           CL**1
      *----------------------------------------------------------------*   CL**1
      *    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       5205-WRITE-SEL-QUEUE.                                               CL**1
                                                                           CL**1
           MOVE ASC-NUMBER-OF-SELECTED-ITEMS                               CL**1
                                         TO IN035-SELECTED-ITEMS.          CL**1
                                                                           CL**1
           EXEC CICS                                                       CL**1
                WRITEQ TS                                                  CL**1
                    QUEUE (ASC-SEL-QUEUE-NAME)                             CL**1
                    FROM  (IN035-SELECTED-SHEET)                           CL**1
                    ITEM  (PV-SEL-QUEUE-ITEM)                              CL**1
                    RESP  (PV-CICS-RESP)                                   CL**1
           END-EXEC.                                                       CL**1
                                                                           CL**1
           IF  PV-CICS-RESP = DFHRESP (NORMAL)                             CL**1
               CONTINUE                                                    CL**1
           ELSE                                                            CL**1
               SET DP013-CICS-ABEND      TO TRUE                           CL**1
               SET DP013-NO-ROLLBACK     TO TRUE                           CL**1
               MOVE '5205-WRITE-SEL-QUEUE'                                 CL**1
                                         TO DP013-PARAGRAPH                CL**1
               MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'             CL**1
                                         TO DP013-MESSAGE-TEXT(1)          CL**1
               PERFORM DP013-0000-PROCESS-ABEND                            CL**1
           END-IF.                                                         CL**1
       EJECT                                                               CL**1
      ******************************************************************   CL**1
      ** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **   CL**1
      ** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **   CL**1
      ** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **   CL**1
      ** THE USER.                                                    **   CL**1
      ******************************************************************   CL**1
       6000-REFRESH-PANEL-FROM-TEMP.                                       CL**1
           IF  ASC-UPDATE-TSQ                                              CL**1
               SET ASC-NO-TSQ-UPDATE TO TRUE                               CL**1
               MOVE ZERO                 TO PV-SAVE-ITEM                   CL**1
                                            PV-SEL-QUEUE-ITEM              CL**1
               MOVE ASC-NUMBER-OF-SELECTED-ITEMS                           CL**1
                                         TO PV-HOLD-SELECTED-ITEMS         CL**1
               PERFORM 6100-UPDATE-TSQ                                     CL**1
                   UNTIL PV-ITEMS-PROCESSED >                              CL**1
                                           PV-HOLD-SELECTED-ITEMS          CL**1
               PERFORM 6010-DELETE-SEL-QUEUE                               CL**1
               INITIALIZE ASC-BLOCK-ENTRIES (1)                            CL**1
                          ASC-BLOCK-ENTRIES (2)                            CL**1
                                                                           CL**1
               DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                    CL**1
                      GIVING PV-BLOCK-NUMBER                               CL**1
                      REMAINDER PV-REMAINDER                               CL**1
               IF  PV-REMAINDER > ZERO                                     CL**1
                   ADD +1     TO PV-BLOCK-NUMBER                           CL**1
               END-IF                                                      CL**1
               MOVE +1        TO ASC-BLK-SUB                               CL**1
               PERFORM 4410-READ-TEMP-STORAGE                              CL**1
               ADD +1         TO ASC-BLK-SUB                               CL**1
                                 PV-BLOCK-NUMBER                           CL**1
               PERFORM 4410-READ-TEMP-STORAGE                              CL**1
                                                                           CL**1
           END-IF.                                                         CL**1
                                                                           CL**1
      *----------------------------------------------------------------*   CL**1
      *    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *   CL**1
      *----------------------------------------------------------------*   CL**1
       6010-DELETE-SEL-QUEUE.                                              CL**1
                                                                           CL**1
           EXEC CICS                                                       CL**1
               DELETEQ TS                                                  CL**1
                   QUEUE (ASC-SEL-QUEUE-NAME)                              CL**1
                   RESP  (PV-CICS-RESP)                                    CL**1
           END-EXEC.                                                       CL**1
      *                                                                    CL**1
           IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                         CL**1
              (PV-CICS-RESP = DFHRESP(QIDERR)))                            CL**1
               CONTINUE                                                    CL**1
           ELSE                                                            CL**1
               SET DP013-CICS-ABEND TO TRUE                                CL**1
               SET DP013-NO-ROLLBACK TO TRUE                               CL**1
               MOVE '6010-DELETE-SEL-QUEUE'                                CL**1
                              TO DP013-PARAGRAPH                           CL**1
               MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'            CL**1
                              TO DP013-MESSAGE-TEXT (1)                    CL**1
               PERFORM DP013-0000-PROCESS-ABEND                            CL**1
           END-IF.                                                         CL**1
                                                                           CL**1
      *----------------------------------------------------------------*   CL**1
      *    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *   CL**1
      *    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *   CL**1
      *    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *   CL**1
      *    THE TEMP QUEUE.                                             *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       6100-UPDATE-TSQ.                                                    CL**1
                                                                           CL**1
           ADD 1                     TO  PV-SEL-QUEUE-ITEM.                CL**1
           PERFORM 6105-READ-SEL-QUEUE.                                    CL**1
           PERFORM                                                         CL**1
               VARYING IN035-IDX                                           CL**1
               FROM 1 BY 1                                                 CL**1
               UNTIL ((PV-ITEMS-PROCESSED >                                CL**1
                                    PV-HOLD-SELECTED-ITEMS)                CL**1
               OR (IN035-IDX GREATER THAN IN035-MAX-ITEMS))                CL**1
               IF  IN035-ACTION-SW (IN035-IDX) > SPACE                     CL**1
                   PERFORM 6110-PROCESS-ITEMS                              CL**1
               END-IF                                                      CL**1
               ADD +1                TO PV-ITEMS-PROCESSED                 CL**1
           END-PERFORM.                                                    CL**1
           PERFORM 6111-WRITE-LIST-QUEUE.                                  CL**1
      *----------------------------------------------------------------*   CL**1
      *    READ THE LIST QUEUE RECORD.                                 *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       6105-READ-SEL-QUEUE.                                                CL**1
                                                                           CL**1
           EXEC CICS                                                       CL**1
                READQ TS                                                   CL**1
                    QUEUE (ASC-SEL-QUEUE-NAME)                             CL**1
                    INTO  (IN035-SELECTED-SHEET)                           CL**1
                    ITEM  (PV-SEL-QUEUE-ITEM)                              CL**1
                    RESP  (PV-CICS-RESP)                                   CL**1
           END-EXEC.                                                       CL**1
      *                                                                    CL**1
           IF  PV-CICS-RESP = DFHRESP (NORMAL)                             CL**1
               CONTINUE                                                    CL**1
           ELSE                                                            CL**1
               SET DP013-CICS-ABEND      TO  TRUE                          CL**1
               SET DP013-NO-ROLLBACK     TO  TRUE                          CL**1
               MOVE '6105-READ-SEL-QUEUE'                                  CL**1
                                         TO  DP013-PARAGRAPH               CL**1
               MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'              CL**1
                                         TO  DP013-MESSAGE-TEXT(1)         CL**1
               PERFORM DP013-0000-PROCESS-ABEND                            CL**1
           END-IF.                                                         CL**1
       EJECT                                                               CL**1
      *----------------------------------------------------------------*   CL**1
      *    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*   CL**1
      *    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*   CL**1
      *    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       6110-PROCESS-ITEMS.                                                 CL**1
                                                                           CL**1
           COMPUTE PV-ITEM = 1 + ((IN035-ITEM (IN035-IDX) - 1)             CL**1
                           / PC-ITEMS-PER-PANEL).                          CL**1
                                                                           CL**1
           IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                              CL**1
               IF  PV-SAVE-ITEM NOT EQUAL ZERO                             CL**1
                   PERFORM 6111-WRITE-LIST-QUEUE                           CL**1
               END-IF                                                      CL**1
               MOVE PV-ITEM          TO PV-SAVE-ITEM                       CL**1
                                                                           CL**1
               PERFORM 6112-READ-LIST-QUEUE                                CL**1
               IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                  CL**1
                   CONTINUE                                                CL**1
               END-IF                                                      CL**1
           END-IF.                                                         CL**1
                                                                           CL**1
           COMPUTE PV-SUB = (IN035-ITEM (IN035-IDX)                        CL**1
                          - LQW-LIST-ITEM-NUMBER (1)) + 1.                 CL**1
           SET LQW-DESELECT (PV-SUB) TO    TRUE                            CL**1
           MOVE LQW-SELECTED-SW (PV-SUB)                                   CL**1
                                     TO LQW-TEMP-SELECTED-SW (PV-SUB).     CL**1
                                                                           CL**1
           MOVE IN035-ACTION-SW (IN035-IDX)   TO LQW-ACTION (PV-SUB).      CL**1
                                                                                
           IF IN035-ACTION-SW (IN035-IDX) IS EQUAL TO 'UPD'                     
               MOVE 'SELECTED'       TO LQW-ON-LINE-SHEET (PV-SUB)              
           ELSE                                                                 
           IF IN035-ACTION-SW (IN035-IDX) IS EQUAL TO 'ADD'                     
               MOVE 'ADD'            TO LQW-ON-LINE-SHEET (PV-SUB)              
           ELSE                                                                 
           IF IN035-ACTION-SW (IN035-IDX) IS EQUAL TO 'DEL'                     
               MOVE 'DELETE'         TO LQW-ON-LINE-SHEET (PV-SUB)              
           ELSE                                                                 
           IF IN035-ACTION-SW (IN035-IDX) IS EQUAL TO 'ERR'                     
               MOVE 'ERROR'          TO LQW-ON-LINE-SHEET (PV-SUB)              
           END-IF.                                                              
                                                                                
           SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                   CL**1
                                                                           CL**1
      *----------------------------------------------------------------*   CL**1
      *    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       6111-WRITE-LIST-QUEUE.                                              CL**1
                                                                           CL**1
           EXEC CICS                                                       CL**1
               WRITEQ TS                                                   CL**1
                   QUEUE (ASC-LIST-QUEUE-NAME)                             CL**1
                   FROM  (LQW-LIST-QUEUE-WORK-AREA)                        CL**1
                   ITEM  (PV-SAVE-ITEM)                                    CL**1
                   REWRITE                                                 CL**1
                   RESP  (PV-CICS-RESP)                                    CL**1
           END-EXEC.                                                       CL**1
      *                                                                    CL**1
           IF  PV-CICS-RESP = DFHRESP (NORMAL)                             CL**1
               CONTINUE                                                    CL**1
           ELSE                                                            CL**1
               SET DP013-CICS-ABEND  TO  TRUE                              CL**1
               SET DP013-NO-ROLLBACK TO  TRUE                              CL**1
               MOVE '6111-WRITE-LIST-QUEUE'                                CL**1
                                     TO  DP013-PARAGRAPH                   CL**1
               MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                     CL**1
                                     TO  DP013-MESSAGE-TEXT(1)             CL**1
               PERFORM DP013-0000-PROCESS-ABEND                            CL**1
           END-IF.                                                         CL**1
                                                                           CL**1
       EJECT                                                               CL**1
      *----------------------------------------------------------------*   CL**1
      *    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       6112-READ-LIST-QUEUE.                                               CL**1
                                                                           CL**1
           EXEC CICS                                                       CL**1
               READQ TS                                                    CL**1
                   QUEUE (ASC-LIST-QUEUE-NAME)                             CL**1
                   INTO  (LQW-LIST-QUEUE-WORK-AREA)                        CL**1
                   ITEM  (PV-ITEM)                                         CL**1
                   RESP  (PV-CICS-RESP)                                    CL**1
           END-EXEC.                                                       CL**1
      *                                                                    CL**1
           IF  PV-CICS-RESP = DFHRESP (NORMAL)                             CL**1
               CONTINUE                                                    CL**1
           ELSE                                                            CL**1
               SET DP013-CICS-ABEND        TO TRUE                         CL**1
               SET DP013-NO-ROLLBACK       TO TRUE                         CL**1
               MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH              CL**1
               MOVE 'ATTEMPTING TO READQ LIST QUEUE'                       CL**1
                                           TO DP013-MESSAGE-TEXT(1)        CL**1
               PERFORM DP013-0000-PROCESS-ABEND                            CL**1
           END-IF.                                                         CL**1
                                                                           CL**1
22000 ******************************************************************        
22000 ** FORMAT AND SUBMIT BATCH JOB.                                 **        
22000 ******************************************************************        
22000  6200-FORMAT-AND-SUBMIT.                                                  
22000                                                                           
22000      PERFORM 9500-ENQUEUE-INTERNAL-READER.                                
22000                                                                           
22000      EXEC CICS                                                            
22000        ASSIGN                                                             
22000          APPLID (PV-CICS-ID)                                              
22000      END-EXEC.                                                            
22000                                                                           
22000      IF PV-CICS-REGION-PRODUCTION                                         
22000          MOVE 'INK309'     TO JL-JCL-INK309-JOBNAME                       
22000          MOVE 'Q'          TO JL-JCL-INK309-JOBCLASS                      
22000          MOVE 'P'          TO JL-JCL-INK309-MSGCLASS                      
22000          MOVE SPACES       TO JL-JCL-INK309-NOTIFY-OPT                    
22000      ELSE                                                                 
22000          MOVE DP020-USERID TO JL-JCL-INK309-JOBNAME                       
22000                               JL-JCL-TEST-USER                            
22000          MOVE 'P'          TO JL-JCL-INK309-JOB-UNQ                       
22000          MOVE 'A'          TO JL-JCL-INK309-JOBCLASS                      
22000          MOVE 'X'          TO JL-JCL-INK309-MSGCLASS                      
22000          MOVE JL-JCL-TEST-NOTIFY TO JL-JCL-INK309-NOTIFY-OPT              
22000      END-IF.                                                              
22000      MOVE JL-JCL-INK309-LINE-1 TO TD-JCL-LINE.                            
22000      PERFORM 8500-WRITE-TD-LINE.                                          
22000                                                                           
22000      MOVE JL-JCL-INK309-LINE-2 TO TD-JCL-LINE.                            
22000      PERFORM 8500-WRITE-TD-LINE.                                          
22000                                                                           
22000      MOVE JL-JCL-INK309-LINE-3 TO TD-JCL-LINE.                            
22000      PERFORM 8500-WRITE-TD-LINE.                                          
22000                                                                           
22000      MOVE JL-JCL-INK309-CMT-SHORT     TO TD-JCL-LINE.                     
22000      PERFORM 8500-WRITE-TD-LINE.                                          
22000                                                                           
22000      MOVE JL-JCL-INK309-CMT-LONG      TO TD-JCL-LINE.                     
22000      PERFORM 8500-WRITE-TD-LINE.                                          
22000                                                                           
22000      MOVE JL-JCL-INK309-CMT-SHORT     TO TD-JCL-LINE.                     
22000      PERFORM 8500-WRITE-TD-LINE.                                          
22000                                                                           
22000      PERFORM DP017-0000-GET-CURR-DATE-TIME.                               
22000      MOVE DP017-EDITED-DATE-MMDDYYYY                                      
22000          TO JL-JCL-INK309-CMT-SUBDATE                                     
22000      MOVE DP017-EDITED-TIME-HMS                                           
22000          TO JL-JCL-INK309-CMT-SUBTIME                                     
22000      MOVE DP020-USERID TO JL-JCL-INK309-CMT-USRID                         
22000      MOVE PV-CICS-ID   TO JL-JCL-INK309-CMT-REGION.                       
22000      MOVE JL-JCL-INK309-CMT-USER-INFO TO TD-JCL-LINE.                     
22000      PERFORM 8500-WRITE-TD-LINE.                                          
22000                                                                           
22000      MOVE JL-JCL-INK309-CMT-SHORT     TO TD-JCL-LINE.                     
22000      PERFORM 8500-WRITE-TD-LINE.                                          
22000                                                                           
22000      MOVE JL-JCL-INK309-CMT-1         TO TD-JCL-LINE.                     
22000      PERFORM 8500-WRITE-TD-LINE.                                          
22000                                                                           
22000      MOVE JL-JCL-INK309-CMT-2         TO TD-JCL-LINE.                     
22000      PERFORM 8500-WRITE-TD-LINE.                                          
22000                                                                           
22000      MOVE JL-JCL-INK309-CMT-3         TO TD-JCL-LINE.                     
22000      PERFORM 8500-WRITE-TD-LINE.                                          
22000                                                                           
22000      MOVE JL-JCL-INK309-CMT-SHORT     TO TD-JCL-LINE.                     
22000      PERFORM 8500-WRITE-TD-LINE.                                          
22000                                                                           
22000      EVALUATE TRUE                                                        
22000          WHEN ASC-ONLINE-SHEETS-NP                                        
22000              MOVE PC-PRINT-SHEETS                                         
22000                  TO JL-JCL-INK309-REQ-OPTION                              
22000      END-EVALUATE.                                                        
W26600     MOVE DP020-USERID                TO JL-REQ-USERID                    
22000      MOVE JL-JCL-INK309-LINE-14       TO JL-JCL-INK309-CMT-OPTION.        
22000      MOVE JL-JCL-INK309-CMT-4         TO TD-JCL-LINE.                     
22000      PERFORM 8500-WRITE-TD-LINE.                                          
22000                                                                           
22000      MOVE JL-JCL-INK309-CMT-SHORT     TO TD-JCL-LINE.                     
22000      PERFORM 8500-WRITE-TD-LINE.                                          
22000                                                                           
22000      MOVE JL-JCL-INK309-CMT-LONG      TO TD-JCL-LINE.                     
22000      PERFORM 8500-WRITE-TD-LINE.                                          
22000                                                                           
22000      MOVE JL-JCL-INK309-CMT-SHORT     TO TD-JCL-LINE.                     
22000      PERFORM 8500-WRITE-TD-LINE.                                          
22000                                                                           
22000      IF PV-CICS-REGION-PRODUCTION                                         
22000          MOVE JL-JCL-INK309-LINE-10       TO TD-JCL-LINE                  
22000          PERFORM 8500-WRITE-TD-LINE                                       
22000      ELSE                                                                 
22000          MOVE JL-JCL-TEST-LINE-10         TO TD-JCL-LINE                  
22000          PERFORM 8500-WRITE-TD-LINE                                       
22000          MOVE JL-JCL-INK309-CMT-SHORT     TO TD-JCL-LINE                  
22000          PERFORM 8500-WRITE-TD-LINE                                       
22000                                                                           
22000          MOVE JL-JCL-TEST-LINE-11A        TO TD-JCL-LINE                  
22000          PERFORM 8500-WRITE-TD-LINE                                       
22000          MOVE JL-JCL-TEST-LINE-11B        TO TD-JCL-LINE                  
22000          PERFORM 8500-WRITE-TD-LINE                                       
22000          MOVE JL-JCL-TEST-LINE-11C        TO TD-JCL-LINE                  
22000          PERFORM 8500-WRITE-TD-LINE                                       
22000      END-IF.                                                              
22000                                                                           
22000      MOVE JL-JCL-INK309-CMT-SHORT     TO TD-JCL-LINE.                     
22000      PERFORM 8500-WRITE-TD-LINE.                                          
22000                                                                           
22000      MOVE JL-JCL-INK309-CMT-SHORT     TO TD-JCL-LINE.                     
22000      PERFORM 8500-WRITE-TD-LINE.                                          
22000                                                                           
22000      EXEC SQL                                                             
22000          SELECT DFLT_PRTR_ID                                              
22000          INTO  :USER-DFLT-PRTR-ID                                         
22000          FROM  TUSER                                                      
22000          WHERE USER_CODE = :DP020-USERID                                  
22000      END-EXEC.                                                            
22000      MOVE 'LOCAL'           TO JL-JCL-INK309-PRTDEST.                     
22000      EVALUATE TRUE                                                        
22000          WHEN SQLCODE = ZERO                                              
22000              IF USER-DFLT-PRTR-ID NOT = SPACES                            
22000                  MOVE USER-DFLT-PRTR-ID TO JL-JCL-INK309-PRTDEST          
22000              END-IF                                                       
22000          WHEN SQLCODE = +100                                              
22000              CONTINUE                                                     
22000          WHEN OTHER                                                       
22000              MOVE '6200-FORMAT-AND-SUBMIT'                                
22000                                TO DP013-PARAGRAPH                         
22000              MOVE 'SELECT DFLT-PRT-ID'                                    
22000                                TO DP013-MESSAGE-TEXT (1)                  
22000              MOVE SQLCA        TO DP013-SQLCA                             
22000              MOVE 'TUSER  '    TO DP013-DB2-TABLE-NAME (1)                
22000              SET DP013-DB2-ABEND                                          
22000                  DP013-XCTL-DISPLAY-RESTART                               
22000                                TO TRUE                                    
22000              PERFORM DP013-0000-PROCESS-ABEND                             
22000      END-EVALUATE.                                                        
22000                                                                           
22000      MOVE JL-JCL-INK309-LINE-12       TO TD-JCL-LINE.                     
22000      PERFORM 8500-WRITE-TD-LINE.                                          
22000                                                                           
22000      MOVE JL-JCL-INK309-LINE-13       TO TD-JCL-LINE.                     
22000      PERFORM 8500-WRITE-TD-LINE.                                          
22000                                                                           
22000      MOVE JL-JCL-INK309-LINE-14       TO TD-JCL-LINE.                     
22000      PERFORM 8500-WRITE-TD-LINE.                                          
22000                                                                           
22000      MOVE JL-JCL-INK309-LINE-EOD      TO TD-JCL-LINE.                     
22000      PERFORM 8500-WRITE-TD-LINE.                                          
22000                                                                           
22000      MOVE JL-JCL-INK309-CMT-SHORT     TO TD-JCL-LINE.                     
22000      PERFORM 8500-WRITE-TD-LINE.                                          
22000                                                                           
22960      MOVE JL-JCL-INK309-LINE-EOF      TO TD-JCL-LINE.                     
22000      PERFORM 8500-WRITE-TD-LINE.                                          
22000                                                                           
22000      PERFORM 9600-DEQUEUE-INTERNAL-READER.                                
22000                                                                           
      *----------------------------------------------------------------*   CL*17
      *    OPEN A CURSOR OF ALL ROWS WHICH MEET THE SPECIFIED CRITERIA     CL*17
      *    FOR EVERY ROW RETRUNED, UPDATE TO VEND_ACK_IND SWITCH TO BE     CL*17
      *    AN 'N'.                                                         CL*17
      *----------------------------------------------------------------*   CL*17
       8000-PROCESS-SHEET.                                                 CL*17
                                                                           CL*17
           SET PS-MORE-CURSOR-TINVPAR-ROWS TO TRUE.                        CL*17
           PERFORM 8100-OPEN-CURSOR-TINVPAR.                               CL*17
           PERFORM 8200-FETCH-CURSOR-TINVPAR-ROW.                          CL*17
           PERFORM 8300-PROCESS-ROWS                                       CL*17
               UNTIL PS-NO-MORE-CURSOR-TINVPAR-ROWS.                       CL*17
           PERFORM 8400-CLOSE-CURSOR-TINVPAR.                              CL*17
                                                                           CL*17
      *----------------------------------------------------------------*   CL*17
      * 8100-OPEN-CURSOR-TINVPAR.                                          CL*17
      *----------------------------------------------------------------*   CL*17
       8100-OPEN-CURSOR-TINVPAR.                                           CL*17
                                                                           CL*17
           MOVE 'CURSOR TINVPAR' TO DP013-MESSAGE-TEXT (2).                CL*17
                                                                           CL*17
           EXEC SQL                                                        CL*17
                 OPEN TINVPAR_UPDT_CSR                                     CL*17
           END-EXEC                                                        CL*17
                                                                           CL*17
           EVALUATE TRUE                                                   CL*17
               WHEN SQLCODE = ZERO                                         CL*17
                   CONTINUE                                                CL*17
               WHEN SQLWARN0 NOT = SPACES                                  CL*17
               WHEN SQLCODE  NOT = ZERO                                    CL*17
                   MOVE '8100-OPEN-CURSOR-TINVPAR'                         CL*17
                                     TO DP013-PARAGRAPH                    CL*17
                   MOVE 'OPEN CURSOR'                                      CL*17
                                     TO DP013-MESSAGE-TEXT (1)             CL*17
                   MOVE 'TINVPAR '   TO DP013-DB2-TABLE-NAME (1)           CL*17
                   MOVE SQLCA        TO DP013-SQLCA                        CL*17
                   SET DP013-DB2-ABEND                                     CL*17
                       DP013-XCTL-DISPLAY-RESTART TO TRUE                  CL*17
                   PERFORM DP013-0000-PROCESS-ABEND                        CL*17
           END-EVALUATE.                                                   CL*17
                                                                           CL*17
      *----------------------------------------------------------------*   CL*17
      * 8200-FETCH-CURSOR-TINVPAR-ROW.                                     CL*17
      *----------------------------------------------------------------*   CL*17
       8200-FETCH-CURSOR-TINVPAR-ROW.                                      CL*17
                                                                           CL*17
           MOVE 'CURSOR TINVPAR' TO DP013-MESSAGE-TEXT (2).                CL*17
                                                                           CL*17
           EXEC SQL                                                        CL*17
               FETCH TINVPAR_UPDT_CSR                                      CL*17
W26600*        INTO :INVPAR-STORE-NBR                                      CL*17
W26600         INTO :INVPAR-LOC-NBR                                        CL*17
                   ,:INVPAR-ACTL-INV-DTE                                   CL*17
                   ,:INVPAR-SLS-ADJ-CPLD-IND                               CL*17
28545              ,:INVPAR-INV-ID                                         CL*17
           END-EXEC.                                                       CL*17
                                                                           CL*17
           EVALUATE TRUE                                                   CL*17
               WHEN SQLCODE = ZERO                                         CL*17
                   CONTINUE                                                     
               WHEN SQLCODE = +100                                         CL*17
                   SET PS-NO-MORE-CURSOR-TINVPAR-ROWS TO TRUE              CL*17
               WHEN SQLWARN0 NOT = SPACE                                   CL*17
               WHEN SQLCODE  NOT = ZERO                                    CL*17
                   MOVE '8200-FETCH-CURSOR-TINVPAR-ROW'                    CL*18
                                       TO DP013-PARAGRAPH                  CL*17
                   MOVE 'FETCH CURSOR' TO DP013-MESSAGE-TEXT (1)           CL*17
                   MOVE SQLCA          TO DP013-SQLCA                      CL*17
                   SET DP013-DB2-ABEND TO TRUE                             CL*17
                   PERFORM DP013-0000-PROCESS-ABEND                        CL*17
           END-EVALUATE.                                                   CL*17
                                                                           CL*17
      *----------------------------------------------------------------*   CL*17
      * 8300-PROCESS-ROWS.                                                 CL*17
      *----------------------------------------------------------------*   CL*17
       8300-PROCESS-ROWS.                                                  CL*17
                                                                           CL*17
           PERFORM 8350-UPDATE-TINVPAR-ROW.                                CL*17
           PERFORM 8200-FETCH-CURSOR-TINVPAR-ROW.                          CL*17
                                                                           CL*17
      *----------------------------------------------------------------*   CL*17
      * 8350-UPDATE-TINVPAR-ROW.                                           CL*17
      *----------------------------------------------------------------*   CL*17
       8350-UPDATE-TINVPAR-ROW.                                            CL*17
                                                                           CL*17
           EXEC SQL                                                        CL*17
             UPDATE TINVPAR                                                CL*20
               SET SHEET_INV_CPLD_IND = 'S'                                CL*21
W26600*      WHERE (STORE_NBR = :INVPAR-STORE-NBR)                         CL*17
W26600       WHERE (LOC_NBR = :INVPAR-LOC-NBR)                             CL*17
               AND (ACTL_INV_DTE = :INVPAR-ACTL-INV-DTE)                   CL*17
28545          AND (INV_ID       = :INVPAR-INV-ID)                         CL*17
           END-EXEC.                                                       CL*17
                                                                           CL*17
           EVALUATE TRUE                                                   CL*17
               WHEN SQLCODE = ZERO                                         CL*17
                   CONTINUE                                                CL*17
               WHEN SQLWARN0 NOT = SPACES                                  CL*17
               WHEN SQLCODE  NOT = ZERO                                    CL*17
                   MOVE '8350-UPDATE-TINVPAR-ROW'                          CL*18
                                     TO DP013-PARAGRAPH                    CL*17
                   MOVE 'UPDATE A ROW IN TINVPAR'                          CL*18
                                     TO DP013-MESSAGE-TEXT(1)              CL*17
                   MOVE SQLCA        TO DP013-SQLCA                        CL*17
                   MOVE 'TINVPAR'    TO DP013-DB2-TABLE-NAME (1)           CL*18
                   SET DP013-DB2-ABEND                                     CL*17
                       DP013-XCTL-DISPLAY-RESTART TO TRUE                  CL*17
                   PERFORM DP013-0000-PROCESS-ABEND                        CL*17
           END-EVALUATE.                                                   CL*17
                                                                           CL*17
      *----------------------------------------------------------------*   CL*17
      * 8400-CLOSE-CURSOR-TINVPAR.                                         CL*17
      *----------------------------------------------------------------*   CL*17
       8400-CLOSE-CURSOR-TINVPAR.                                          CL*17
                                                                           CL*17
           MOVE 'CURSOR TINVPAR' TO DP013-MESSAGE-TEXT (2).                CL*17
                                                                           CL*17
           EXEC SQL                                                        CL*17
                CLOSE TINVPAR_UPDT_CSR                                     CL*17
           END-EXEC.                                                       CL*17
                                                                           CL*17
           EVALUATE TRUE                                                   CL*17
               WHEN SQLCODE = ZERO                                         CL*17
                   CONTINUE                                                CL*17
               WHEN SQLWARN0 NOT = SPACES                                  CL*17
               WHEN SQLCODE  NOT = ZERO                                    CL*17
                   MOVE '8200-CLOSE-CURSOR-TINVPAR'                        CL*17
                                     TO DP013-PARAGRAPH                    CL*17
                   MOVE 'CLOSE CURSOR'                                     CL*17
                                     TO DP013-MESSAGE-TEXT (1)             CL*17
                   MOVE SQLCA        TO DP013-SQLCA                        CL*17
                   MOVE 'TINVPAR '   TO DP013-DB2-TABLE-NAME (1)           CL*17
                   SET DP013-DB2-ABEND                                     CL*17
                       DP013-XCTL-DISPLAY-RESTART TO TRUE                  CL*17
                   PERFORM DP013-0000-PROCESS-ABEND                        CL*17
           END-EVALUATE.                                                   CL*17
                                                                                
22000 ******************************************************************        
22000 *  WRITE A JCL LINE TO THE TRANSIENT DATA QUEUE FOR THE INTERNAL *        
22000 *  READER.  ON ANY ERROR, DEQUEUE THE INTERNAL READER AND ABEND. *        
22000 ******************************************************************        
22000  8500-WRITE-TD-LINE.                                                      
22000      EXEC CICS                                                            
22000          WRITEQ TD                                                        
22000              QUEUE(TD-QUEUE-NAME)                                         
22000              FROM(TD-JCL-LINE)                                            
22000              LENGTH(TD-JCL-LINE-LENGTH)                                   
22000              RESP(PV-CICS-RESP)                                           
22000      END-EXEC.                                                            
22000                                                                           
22000      IF PV-CICS-RESP NOT = DFHRESP(NORMAL)                                
22000          SET DP013-CICS-ABEND      TO TRUE                                
22000          SET DP013-NO-ROLLBACK     TO TRUE                                
22000          MOVE '8500-WRITE-TD-LINE' TO DP013-PARAGRAPH                     
22000          MOVE 'ATTEMPTING TO WRITE TO INTERNAL READER TD QUEUE'           
22000                                    TO DP013-MESSAGE-TEXT(1)               
22000          PERFORM 9600-DEQUEUE-INTERNAL-READER                             
22000          PERFORM DP013-0000-PROCESS-ABEND                                 
22000      END-IF.                                                              
22000                                                                           
      *----------------------------------------------------------------*   CL*17
      *    READ THE SELECTION TEMPORARY STORAGE QUEUE                      CL*17
      *----------------------------------------------------------------*   CL*17
       9100-READ-SEL-QUEUE.                                                CL*17
           EXEC CICS                                                       CL*14
               READQ TS                                                    CL*14
                   QUEUE (ASC-SEL-QUEUE-NAME)                              CL*14
                   INTO  (IN035-SELECTED-SHEET)                            CL*14
                   ITEM  (ASC-SEL-ITEM)                                    CL*14
                   RESP  (PV-CICS-RESP)                                    CL*14
           END-EXEC.                                                       CL*14
                                                                           CL*14
           IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                          CL*14
               CONTINUE                                                    CL*14
           ELSE                                                            CL*14
               SET DP013-LOGIC-ABEND                                       CL*14
                   DP013-NO-ROLLBACK     TO TRUE                           CL*14
               MOVE '9100-READ-SEL-QUEUE'                                  CL*14
                                         TO DP013-PARAGRAPH                CL*14
               MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'      CL*14
                                         TO DP013-MESSAGE-TEXT (1)         CL*14
               PERFORM DP013-0000-PROCESS-ABEND                            CL*14
           END-IF.                                                         CL*14
      *                                                                    CL*14
      ******************************************************************   CL*14
      * UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *   CL*14
      ******************************************************************   CL*14
       9200-REWRITE-SEL-QUEUE.                                             CL*14
           EXEC CICS                                                       CL*14
                WRITEQ TS                                                  CL*14
                    QUEUE  (ASC-SEL-QUEUE-NAME)                            CL*14
                    FROM   (IN035-SELECTED-SHEET)                          CL*14
                    ITEM   (ASC-SEL-ITEM)                                  CL*14
                    RESP   (PV-CICS-RESP)                                  CL*14
                    REWRITE                                                CL*14
           END-EXEC.                                                       CL*14
                                                                           CL*14
           IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                      CL*14
               SET DP013-CICS-ABEND                                        CL*14
                   DP013-NO-ROLLBACK     TO TRUE                           CL*14
               MOVE '9200-REWRITE-SEL-QUEUE'                               CL*14
                                         TO DP013-PARAGRAPH                CL*14
               MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'      CL*14
                                         TO DP013-MESSAGE-TEXT (1)         CL*14
               PERFORM DP013-0000-PROCESS-ABEND                            CL*14
           END-IF.                                                         CL*14
                                                                           CL*14
22000 ******************************************************************        
22000 *  ENQUEUE THE TRANSIENT DATA QUEUE FOR THE INTERNAL READER.     *        
22000 *  THIS WILL PREVENT INTERLEAVING OF JCL SUBMITTED CONCURRENTLY  *        
22000 *  BY MULTIPLE USERS.  IF THE QUEUE IS BUSY, THIS PROGRAM WILL   *        
22000 *  WAIT TO ENQUEUE IT, BY NOT SPECIFICALLY HANDLING THE QBUSY    *        
22000 *  CONDITION.                                                    *        
22000 ******************************************************************        
22000  9500-ENQUEUE-INTERNAL-READER.                                            
22000      EXEC CICS                                                            
22000          ENQ                                                              
22000              RESOURCE(TD-QUEUE-NAME)                                      
22000              LENGTH(TD-QUEUE-NAME-LENGTH)                                 
22000              RESP(PV-CICS-RESP)                                           
22000      END-EXEC.                                                            
22000                                                                           
22000      IF PV-CICS-RESP NOT = DFHRESP(NORMAL)                                
22000          SET DP013-CICS-ABEND      TO TRUE                                
22000          SET DP013-NO-ROLLBACK     TO TRUE                                
22000          MOVE '9500-ENQUEUE-INTERNAL-READER'                              
22000                                    TO DP013-PARAGRAPH                     
22000          STRING 'ENQUEUE '            DELIMITED BY SIZE                   
22000                 TD-QUEUE-NAME         DELIMITED BY SIZE                   
22000                 ' (INTERNAL READER)'  DELIMITED BY SIZE                   
22000              INTO DP013-MESSAGE-TEXT (1)                                  
22000          PERFORM DP013-0000-PROCESS-ABEND                                 
22000      END-IF.                                                              
22000                                                                           
22000      SET PS-INTERNAL-READER-ENQUEUED TO TRUE.                             
22000                                                                           
22000 ******************************************************************        
22000 *  DEQUEUE THE TRANSIENT DATA QUEUE FOR THE INTERNAL READER.     *        
22000 *  THIS SHOULD BE DONE FOLLOWING A SUCCESSFUL REPORT REQUEST     *        
22000 *  SUBMISSION, A CANCELLATION OF THE CURRENT REPORT REQUEST, OR  *        
22000 *  ANY DETECTED ABENDS.  THIS WILL FREE UP THE INTERNAL READER   *        
22000 *  FOR THE NEXT USER.                                            *        
22000 ******************************************************************        
22000  9600-DEQUEUE-INTERNAL-READER.                                            
22000      SET PS-INTERNAL-READER-DEQUEUED TO TRUE.                             
22000                                                                           
22000      EXEC CICS                                                            
22000          DEQ                                                              
22000              RESOURCE(TD-QUEUE-NAME)                                      
22000              LENGTH(TD-QUEUE-NAME-LENGTH)                                 
22000              RESP(PV-CICS-RESP)                                           
22000      END-EXEC.                                                            
22000                                                                           
22000      IF PV-CICS-RESP NOT = DFHRESP(NORMAL)                                
22000          SET DP013-CICS-ABEND      TO TRUE                                
22000          SET DP013-NO-ROLLBACK     TO TRUE                                
22000          MOVE '9600-DEQUEUE-INTERNAL-READER'                              
22000                                    TO DP013-PARAGRAPH                     
22000          STRING 'DEQUEUE '            DELIMITED BY SIZE                   
22000                 TD-QUEUE-NAME         DELIMITED BY SIZE                   
22000                 ' (INTERNAL READER)'  DELIMITED BY SIZE                   
22000              INTO DP013-MESSAGE-TEXT (1)                                  
22000          PERFORM DP013-0000-PROCESS-ABEND                                 
22000      END-IF.                                                              
22000                                                                           
      ******************************************************************   CL**8
      *    CURRENT SYSTEM DATE/TIME MODULE                                 CL**8
      ******************************************************************   CL**8
                                                                           CL**8
           COPY DPPD017.                                                   CL**8
      *----------------------------------------------------------------*   CL**1
      *    ABEND PROCESSOR MODULE                                      *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
           COPY DPPD013.                                                   CL**1
