000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.        TRKUP009.                                     00050000
000600 AUTHOR.            DENISE HAHN.                                  00060000
000700 INSTALLATION.      KOHLS.                                        00070000
000800 DATE-WRITTEN       DECEMBER 2019.                                00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001110* THIS THE PURGE OF OLD TRIPS - COPY OF TRKUP003, BUT WITH A     *00111003
001111* DIFFERENT DRIVING CURSOR                                       *00111100
001120******************************************************************00112000
001130******************************************************************00113000
001200*  THIS PROGRAM WILL DELETE OLD TVHTRIPS (AND THE COORESPONDING  *00120000
001300*  SHIPMENT ROWS).                                               *00130000
001400*  NEW PARM:  #YEARS BACK FROM CURRENT DATE                      *00140000
001410*  PARM WILL BE USED IN THE CURSOR TO LOOK AT TSHIPMT ROWS WHERE *00141000
001420*  THE LAST_UPD_DTE IS IS < CURRENT DATE - PARM # YEARS)         *00142000
001421*  PARM:  TRSHDY                                                 *00142101
001422*                                                                *00142201
001500*  IF THE CURRENT TVEHICL ROW IS FOR THE SAME TRIP, IT WILL BE   *00150000
001600*  UPDATED WITH A STATUS OF 'ET'. AND THE TRIP # WILL BE SET TO  *00160000
001700*  NULL.                                                         *00170000
001710*                                                                *00171000
001720*  ROWS WILL BE PURGED FROM:                                     *00172000
001721*       TSHIPMT, TSHIPST, TVHTRIP, TTRIPST                       *00172100
001722*                                                                 00172200
001730*  TSHIPMT:  CASCADE DELETE TVHTRIP (BY TRIP_ID)                 *00173000
001731*            CASCADE DELETE TSHIPST (BY SHIPT_ID)                *00173100
001740*                                                                *00174000
001750*  TVHTRIP:  CASCADE DELETE TTRIPST (BY TRIP_ID)                 *00175000
001760*            CASCADE DELETE SUT_INBD_TRIP_DOOR (BY TRIP_ID)      *00176000
001770*            CASCADE DELETE TFLSCHD (BY TRIP_ID)                 *00177000
001780*            CASCADE DELETE TVHSEAL (BY TRIP_ID)                 *00178000
001790*            CASCADE DELETE SUT_PNA_TRIP_ASGMT (BY INBD_TRIP_ID) *00179000
001791*                                                                *00179100
001792*  IF THERE ARE ROWS ON TSHPTPO - WILL CHECK TO SEE IF THE PO    *00179200
001793*  EXISTS ON TPURCHS.  IF IT DOES NOT, THEN THE TSHPTPO ROWS     *00179300
001794*  WILL ALSO BE DELETED.                                         *00179400
001795*                                                                *00179500
001796*  NOTE:  RAN A QUERY OF SHIPMENTS BETWEEN 1990-2000,            *00179600
001797*         7992 SHIPMENTS WERE RETURNED                           *00179700
001798*         ONLY 7 OF THOSE SHIPMENTS HAD TSHPTPO ROWS             *00179800
001799*         NONE OF THE 7 PO EXIST ON TPURCHS - ALREADY PURGED     *00179900
001800*                                                                *00180000
001801*  PROGRAM WILL COMMIT AFTER EACH SHIPMENT IS PROCESSED FROM     *00180100
001802*  THE CURSOR.                                                   *00180200
001810******************************************************************00181000
001900                                                                  00190000
002000******************************************************************00200000
002100 ENVIRONMENT DIVISION.                                            00210000
002200******************************************************************00220000
002300                                                                  00230000
002400 CONFIGURATION SECTION.                                           00240000
002500                                                                  00250000
002600 SOURCE-COMPUTER.   IBM-3090.                                     00260000
002700 OBJECT-COMPUTER.   IBM-3090.                                     00270000
002800                                                                  00280000
002900 INPUT-OUTPUT SECTION.                                            00290000
003000                                                                  00300000
003100 FILE-CONTROL.                                                    00310000
003200                                                                  00320000
003300******************************************************************00330000
003400 DATA DIVISION.                                                   00340000
003500******************************************************************00350000
003600                                                                  00360000
003700******************************************************************00370000
003800 WORKING-STORAGE SECTION.                                         00380000
003900******************************************************************00390000
004000*                                                                 00400032
004100 01  ABEND-CODE                          PIC S9(04)  VALUE +0     00410033
004200                                                     COMP SYNC.   00420033
004300*    88  ABEND-4001-WRITE-ERROR                      VALUE +4001. 00430032
004400*    88  ABEND-4002-READ-ERROR                       VALUE +4002. 00440032
004500*    88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003. 00450032
004600*    88  ABEND-4004-TABLE-ERROR                      VALUE +4004. 00460032
004700*    88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 00470032
004800*    88  ABEND-4006-CLOSE-ERROR                      VALUE +4006. 00480032
004900*    88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 00490032
005000*    88  ABEND-4008-DATA-ERROR                       VALUE +4008. 00500032
005100*    88  ABEND-4009-KEY-DATA-ERROR                   VALUE +4009. 00510032
005400*    88  ABEND-4013-DB2-ERROR                        VALUE +4013. 00540032
005500                                                                  00550033
005600 01  DL1-DETAIL-LINE-1.                                           00560033
005700     05  FILLER                          PIC  X(05)  VALUE SPACE. 00570033
005800     05  FILLER                          PIC  X(24)  VALUE        00580033
005900         ' TOTAL TVHTRIP  READ:   '.                              00590037
006000     05  DL1-TOT-TVHTRIP-READ            PIC  ZZZ,ZZZ,ZZ9.        00600033
006100                                                                  00610033
006200 01  DL2-DETAIL-LINE-2.                                           00620033
006300     05  FILLER                          PIC  X(05)  VALUE SPACE. 00630033
006400     05  FILLER                          PIC  X(24)  VALUE        00640033
006500         ' TOTAL TVHTRIP  DELETED:'.                              00650037
006600     05  DL2-TOT-TVHTRIP-DEL             PIC  ZZZ,ZZZ,ZZ9.        00660033
006700                                                                  00670033
006800 01  DL3-DETAIL-LINE-3.                                           00680033
006900     05  FILLER                          PIC  X(05)  VALUE SPACE. 00690033
007000     05  FILLER                          PIC  X(24)  VALUE        00700033
007100         ' TOTAL TSHPTPO  READ:   '.                              00710037
007200     05  DL3-TOT-TSHPTPO-READ            PIC  ZZZ,ZZZ,ZZ9.        00720033
007300                                                                  00730033
007400 01  DL4-DETAIL-LINE-4.                                           00740033
007500     05  FILLER                          PIC  X(05)  VALUE SPACE. 00750033
007600     05  FILLER                          PIC  X(24)  VALUE        00760033
007700         ' TOTAL TSHPTPO  DELETED:'.                              00770037
007800     05  DL4-TOT-TSHPTPO-DEL             PIC  ZZZ,ZZZ,ZZ9.        00780033
007900                                                                  00790033
008000 01  DL5-DETAIL-LINE-5.                                           00800033
008100     05  FILLER                          PIC  X(05)  VALUE SPACE. 00810033
008200     05  FILLER                          PIC  X(24)  VALUE        00820033
008300         ' TOTAL TSHIPMT  READ:   '.                              00830037
008400     05  DL5-TOT-TSHIPMT-READ            PIC  ZZZ,ZZZ,ZZ9.        00840033
008500                                                                  00850033
008600 01  DL6-DETAIL-LINE-6.                                           00860033
008700     05  FILLER                          PIC  X(05)  VALUE SPACE. 00870033
008800     05  FILLER                          PIC  X(24)  VALUE        00880033
008900         ' TOTAL TSHIPMT  DELETED:'.                              00890037
009000     05  DL6-TOT-TSHIPMT-DEL             PIC  ZZZ,ZZZ,ZZ9.        00900033
009100                                                                  00910033
009200 01  DL7-DETAIL-LINE-7.                                           00920036
009300     05  FILLER                          PIC  X(05)  VALUE SPACE. 00930036
009400     05  FILLER                          PIC  X(24)  VALUE        00940036
009500         ' TOTAL TSHIPST  DELETED:'.                              00950036
009600     05  DL7-TOT-TSHIPST-DEL             PIC  ZZZ,ZZZ,ZZ9.        00960036
009700                                                                  00970036
010400 01  DL9-DETAIL-LINE-9.                                           01040033
010500     05  FILLER                          PIC  X(05)  VALUE SPACE. 01050033
010600     05  FILLER                          PIC  X(24)  VALUE        01060033
010700         ' TOTAL TVEHICL  READ:   '.                              01070037
010800     05  DL9-TOT-TVEHICL-READ            PIC  ZZZ,ZZZ,ZZ9.        01080033
010900                                                                  01090033
011000 01  DL10-DETAIL-LINE-10.                                         01100033
011100     05  FILLER                          PIC  X(05)  VALUE SPACE. 01110033
011200     05  FILLER                          PIC  X(24)  VALUE        01120033
011300         ' TOTAL TVEHICL  UPDATED:'.                              01130037
011400     05  DL10-TOT-TVEHICL-UPD            PIC  ZZZ,ZZZ,ZZ9.        01140033
011500                                                                  01150033
011600 01  DL10-DETAIL-LINE-12.                                         01160033
011700     05  FILLER                          PIC  X(05)  VALUE SPACE. 01170033
011800     05  FILLER                          PIC  X(24)  VALUE        01180033
011900         ' TOTAL TAUVHCL INSERTED:'.                              01190033
012000     05  DL10-TOT-TAUVHCL-INSERT         PIC  ZZZ,ZZZ,ZZ9.        01200033
012100                                                                  01210033
012200 01  DL11-DETAIL-LINE-11.                                         01220033
012300     05  FILLER                          PIC  X(05)  VALUE SPACE. 01230033
012310                                                                  01231046
012400 01  DL13-DETAIL-LINE-13.                                         01240047
012500     05  FILLER                          PIC  X(05)  VALUE SPACE. 01250046
012600     05  FILLER                          PIC  X(24)  VALUE        01260046
012610         ' OLD TVHTRIP READ:      '.                              01261046
012620     05  DL13-TOT-OLD-TVHTRIP            PIC  ZZZ,ZZZ,ZZ9.        01262046
012630                                                                  01263046
012700                                                                  01270033
014300 01  PC-PROGRAM-CONSTANTS.                                        01430033
014600     05  PC-TRKUP009                     PIC X(08)   VALUE        01460032
014700                                                     'TRKUP009'.  01470032
014710     05  PC-ET                           PIC  X(02)  VALUE 'ET'.  01471032
014800     05  PC-MAX-RETRIES                  PIC S9(04)  VALUE +3     01480033
014900                                                     COMP SYNC.   01490033
015000     05  PC-NEG-1                        PIC S9(03)  VALUE -1     01500033
015010                                                     COMP-3.      01501033
015020                                                                  01502033
017100 01  PS-PROGRAM-SWITCHES.                                         01710033
017200     05  PS-TRIP-ID-NULL-SW              PIC  X(01)  VALUE 'N'.   01720042
017300         88  PS-TRIP-ID-NULL                         VALUE 'Y'.   01730042
017400         88  PS-TRIP-ID-NOT-NULL                     VALUE 'N'.   01740042
017401     05  PS-PO-RCVR-EXISTS-SW            PIC  X(01)  VALUE 'N'.   01740142
017402         88  PS-PO-RCVR-EXISTS                       VALUE 'Y'.   01740242
017403         88  PS-PO-RCVR-EXISTS-NO                    VALUE 'N'.   01740342
017410     05  PS-END-OF-OLD-TSHIPMT-SW        PIC  X(01)  VALUE 'N'.   01741044
017420         88  PS-END-OF-OLD-TSHIPMT-CSR               VALUE 'Y'.   01742033
017430         88  PS-NOT-END-OF-OLD-TSHIPMT-CSR           VALUE 'N'.   01743033
017440     05  PS-END-OF-OLD-TVHTRIP-SW        PIC  X(01)  VALUE 'N'.   01744044
017450         88  PS-END-OF-OLD-TVHTRIP-CSR               VALUE 'Y'.   01745044
017460         88  PS-NOT-END-OF-OLD-TVHTRIP-CSR           VALUE 'N'.   01746044
017500     05  PS-END-OF-TSHPTPO-IND           PIC  X(01)  VALUE 'N'.   01750033
017600         88  PS-END-OF-TSHPTPO-CSR                   VALUE 'Y'.   01760033
017700         88  PS-NOT-END-OF-TSHPTPO-CSR               VALUE 'N'.   01770033
017800     05  PS-END-OF-TSHIPMT-IND           PIC  X(01)  VALUE 'N'.   01780033
017900         88  PS-END-OF-TSHIPMT-CSR                   VALUE 'Y'.   01790033
018000         88  PS-NOT-END-OF-TSHIPMT-CSR               VALUE 'N'.   01800033
018700     05  INSERT-TO-AUDIT-SW              PIC  X(01)  VALUE 'N'.   01870033
018800         88  INSERT-TO-AUDIT                         VALUE 'Y'.   01880033
018900         88  NO-INSERT                               VALUE 'N'.   01890033
019000     05  OK-TO-DELETE-SW                 PIC X(01)   VALUE 'N'.   01900033
019100         88  OK-TO-DELETE                            VALUE 'Y'.   01910033
019200         88  NOT-OK-TO-DELETE                        VALUE 'N'.   01920033
019300     05  PS-SHIPMT-DELETED-SW            PIC X(01)   VALUE 'Y'.   01930033
019400         88  PS-SHIPMT-DELETED                       VALUE 'Y'.   01940033
019500         88  PS-SHIPMT-NOT-DELETED                   VALUE 'N'.   01950033
019600*                                                                 01960032
019700 01  DK-DB2-KEY-FIELDS.                                           01970032
019800     05  DK-PURGE-BEFORE                 PIC   X(10).             01980032
019801     05  DK-TRIP-ID                      PIC  S9(09) COMP.        01980132
019802     05  DK-SHIPT-ID                     PIC  S9(09) COMP.        01980232
019803     05  DK-SHIPMT-LAST-UPD-DTE          PIC   X(10).             01980332
019804     05  DK-SHIPMT-EST-AR-TMST           PIC   X(26).             01980432
019805     05  DK-TSHPTPO-COUNT                PIC  S9(09) COMP.        01980532
019806     05  DK-TRIP-LAST-UPD-DTE            PIC   X(10).             01980632
019807     05  DK-TRIP-LAST-UPD-TME            PIC   X(08).             01980732
019808     05  DK-TRIP-STATUS-CDE              PIC   X(02).             01980832
019809     05  DK-TRIP-EST-AR-TMST             PIC   X(26).             01980932
019810     05  DK-STATUS-DTE                   PIC   X(10).             01981032
019811     05  DK-STATUS-TME                   PIC   X(08).             01981132
019812     05  DK-OWNER-SCAC-ID                PIC   X(04).             01981232
019813     05  DK-VEH-NBR                      PIC   X(10).             01981332
019814     05  DK-CURR-TRIP-ID                 PIC  S9(09) COMP.        01981432
019815*                                                                 01981532
019816 01  PV-PROGRAM-VARIABLES.                                        01981632
019820     05  PV-CURRENT-DATE                 PIC  X(10).              01982032
019821     05  PV-TRIP-TSHIPMT-CNT             PIC  S9(09) COMP.        01982132
019822                                                                  01982232
019823     05  PV-NULL-IND-1                   PIC S9(04)  VALUE ZEROS  01982332
019824                                                     COMP SYNC.   01982432
019825     05  PV-NULL-IND-2                   PIC S9(04)  VALUE ZEROS  01982532
019826                                                     COMP SYNC.   01982632
019827     05  PV-NULL-IND-3                   PIC S9(04)  VALUE ZEROS  01982732
019828                                                     COMP SYNC.   01982832
019829     05  PV-NULL-IND-4                   PIC S9(04)  VALUE ZEROS  01982932
019830                                                     COMP SYNC.   01983032
019831     05  PV-NULL-IND-5                   PIC S9(04)  VALUE ZEROS  01983132
019832                                                     COMP SYNC.   01983232
019833     05  PV-NULL-IND-6                   PIC S9(04)  VALUE ZEROS  01983332
019834                                                     COMP SYNC.   01983432
019835     05  PV-NULL-IND-7                   PIC S9(04)  VALUE ZEROS  01983532
019836                                                     COMP SYNC.   01983632
019837     05  PV-NULL-IND-8                   PIC S9(04)  VALUE ZEROS  01983732
019838                                                     COMP SYNC.   01983832
019839     05  PV-NULL-IND-9                   PIC S9(04)  VALUE ZEROS  01983932
019840                                                     COMP SYNC.   01984032
019841     05  PV-NULL-IND-10                  PIC S9(04)  VALUE ZEROS  01984132
019842                                                     COMP SYNC.   01984232
019843     05  PV-NULL-IND-11                  PIC S9(04)  VALUE ZEROS  01984332
019844                                                     COMP SYNC.   01984432
019845     05  PV-NULL-IND-12                  PIC S9(04)  VALUE ZEROS  01984543
019846                                                     COMP SYNC.   01984643
019847     05  PV-VEHICL-CURR-TRIP-ID          PIC S9(09)  COMP SYNC.   01984732
019848     05  PV-VEHICL-CURR-TRIP-ID-NULL     PIC S9(04)  VALUE +0     01984832
019849                                                     COMP SYNC.   01984932
019850     05  PV-AUVHCL-CURR-TRIP-ID-NULL     PIC S9(04)  VALUE +0     01985032
019851                                                     COMP SYNC.   01985132
019852                                                                  01985232
019853     05  PV-DISP-FUNC-QTY                PIC  Z(09).              01985333
019854     05  PV-DISP-SQLCODE                 PIC  -999.               01985433
019855     05  PV-DISP-SHIPT-ID                PIC  Z(09).              01985533
019856     05  PV-DISP-TRIP-ID                 PIC  Z(09).              01985633
019857     05  PV-DISP-TSHPTPO-CNT             PIC  ZZZ,ZZZ,ZZ9.        01985733
019858     05  PV-DISP-CURR-TRIP               PIC  Z(09).              01985833
019859                                                                  01985933
019860     05  PV-TVHTRIP-READ                 PIC S9(09)  VALUE +0     01986033
019900                                                     COMP-3.      01990033
020000     05  PV-TSHPTPO-READ                 PIC S9(09)  VALUE +0     02000033
020100                                                     COMP-3.      02010033
020200     05  PV-TSHIPMT-READ                 PIC S9(09)  VALUE +0     02020033
020300                                                     COMP-3.      02030033
020600     05  PV-TVEHICL-READ                 PIC S9(09)  VALUE +0     02060033
020700                                                     COMP-3.      02070033
020800     05  PV-TAUVHCL-INSERTED             PIC S9(09)  VALUE +0     02080033
020900                                                     COMP-3.      02090033
021000     05  PV-TVHTRIP-DELETED              PIC S9(09)  VALUE +0     02100033
021100                                                     COMP-3.      02110033
021200     05  PV-TSHPTPO-DELETED              PIC S9(09)  VALUE +0     02120033
021300                                                     COMP-3.      02130033
021400     05  PV-TSHIPMT-DELETED              PIC S9(09)  VALUE +0     02140033
021500                                                     COMP-3.      02150033
021600     05  PV-TSHIPMT-TSHIPST-DELETED      PIC S9(09)  VALUE +0     02160036
021700                                                     COMP-3.      02170036
021800     05  PV-TVEHICL-UPDATED              PIC S9(09)  VALUE +0     02180033
021900                                                     COMP-3.      02190033
022000     05  PV-OLD-TVHTRIP-READ             PIC S9(09)  VALUE +0     02200046
022100                                                     COMP-3.      02210046
022400     05  PV-RETRY-CNT                    PIC S9(01)  VALUE +0.    02240033
023500                                                                  02350033
024300     05  PV-CPU-DATE.                                             02430033
024400         10  PV-CPU-DATE-YY               PIC 9(2)   VALUE ZEROS. 02440033
024500         10  PV-CPU-DATE-MM               PIC 9(2)   VALUE ZEROS. 02450033
024600         10  PV-CPU-DATE-DD               PIC 9(2)   VALUE ZEROS. 02460033
024700                                                                  02470033
026000*                                                                 02600000
026100*  PARM TABLE                                                     02610002
026200*                                                                 02620000
026300     EXEC SQL                                                     02630032
026400         INCLUDE TKRPRPM                                          02640032
026500     END-EXEC.                                                    02650032
026600                                                                  02660032
026601*                                                                 02660117
026602*  TRECEIV                                                        02660217
026603*                                                                 02660317
026604     EXEC SQL                                                     02660432
026605         INCLUDE TRECEIV                                          02660532
026606     END-EXEC.                                                    02660632
026607                                                                  02660732
026610*                                                                 02661002
026620*  DCLGEN FOR THE DB2 TRIP TABLE.                                 02662002
026630*                                                                 02663002
026640     EXEC SQL                                                     02664032
026650         INCLUDE TVHTRIP                                          02665032
026660     END-EXEC.                                                    02666032
026670                                                                  02667032
026700*                                                                 02670000
026800*  DCLGEN FOR THE DB2 SHIPMENT TABLE.                             02680000
026900*                                                                 02690000
027000     EXEC SQL                                                     02700032
027100         INCLUDE TSHIPMT                                          02710032
027200     END-EXEC.                                                    02720032
027300                                                                  02730032
027400*                                                                 02740000
027500*  DCLGEN FOR THE DB2 SHIP TO PO TABLE                            02750000
027600*                                                                 02760000
027700     EXEC SQL                                                     02770032
027800         INCLUDE TSHPTPO                                          02780032
027900     END-EXEC.                                                    02790032
028000                                                                  02800032
029500*                                                                 02950000
029600*  DCLGEN FOR THE DB2 VEHICLE TABLE.                              02960000
029700*                                                                 02970000
029800     EXEC SQL                                                     02980032
029900         INCLUDE TVEHICL                                          02990032
030000     END-EXEC.                                                    03000032
030100                                                                  03010032
030200*                                                                 03020000
030300*  DCLGEN FOR THE DB2 TR VEHICLE AUDIT TABLE.                     03030000
030400*                                                                 03040000
030500     EXEC SQL                                                     03050032
030600         INCLUDE TAUVHCL                                          03060032
030700     END-EXEC.                                                    03070032
030800                                                                  03080032
032310*                                                                 03231001
032320*  CURSOR USED TO SELECT ALL OLD SHIPMENTS THAT HAVE NOT PURGED   03232001
032330*  BASED ON PARM X DAYS TO LOOK BACK.                             03233001
032340*                                                                 03234001
032353     EXEC SQL                                                     03235332
032354         DECLARE OLD-TSHIPMT-CSR CURSOR                           03235432
032355                 WITH HOLD FOR                                    03235532
032360          SELECT T3.SHIPT_ID                                      03236032
032370               , T3.SHIPMT_LAST_UPD_DTE                           03237032
032380               , T3.SHIPMT_EST_AR_TMST                            03238032
032390               , T3.TRIP_ID                                       03239032
032391               , T3.TSHPTPO_COUNT                                 03239132
032392               , T4.TRIP_LAST_UPD_DTE                             03239232
032393               , T4.TRIP_LAST_UPD_TME                             03239332
032394               , T4.TRIP_STATUS_CDE                               03239432
032395               , T4.TRIP_EST_AR_TMST                              03239532
032396               , T4.STATUS_DTE                                    03239632
032397               , T4.STATUS_TME                                    03239732
032398               , T4.OWNER_SCAC_ID                                 03239832
032399               , T4.VEH_NBR                                       03239932
032400               , T4.CURR_TRIP_ID                                  03240032
032401          FROM                                                    03240132
032402          (SELECT T1.SHIPT_ID                                     03240232
032403                , T1.SHIPMT_LAST_UPD_DTE                          03240332
032404                , T1.SHIPMT_EST_AR_TMST                           03240432
032405                , T1.TRIP_ID                                      03240532
032406                , T2.TSHPTPO_COUNT                                03240632
032407            FROM                                                  03240732
032408           (SELECT A.SHIPT_ID                                     03240832
032409                 , A.LAST_UPD_DTE AS SHIPMT_LAST_UPD_DTE          03240932
032410                 , A.EST_AR_TMST  AS SHIPMT_EST_AR_TMST           03241032
032411                 , A.TRIP_ID                                      03241132
032412              FROM TSHIPMT A                                      03241251
032414             WHERE A.LAST_UPD_DTE  <   :DK-PURGE-BEFORE           03241432
032415           ) AS T1                                                03241532
032416          LEFT OUTER JOIN                                         03241632
032417           (SELECT B.SHIPT_ID                                     03241732
032418                 , COUNT(C.SHIPT_ID)  AS TSHPTPO_COUNT            03241832
032419              FROM TSHIPMT B                                      03241951
032420                 , TSHPTPO C                                      03242051
032422             WHERE B.LAST_UPD_DTE  <   :DK-PURGE-BEFORE           03242232
032423               AND B.SHIPT_ID      = C.SHIPT_ID                   03242332
032424             GROUP BY B.SHIPT_ID                                  03242432
032425           ) AS T2                                                03242532
032426           ON T1.SHIPT_ID  =  T2.SHIPT_ID                         03242632
032427          ) AS T3                                                 03242732
032428          LEFT OUTER JOIN                                         03242832
032429           (SELECT D.SHIPT_ID                                     03242932
032430                 , D.TRIP_ID                                      03243032
032431                 , E.LAST_UPD_DTE  AS TRIP_LAST_UPD_DTE           03243132
032432                 , E.LAST_UPD_TME  AS TRIP_LAST_UPD_TME           03243232
032433                 , E.EST_AR_TMST   AS TRIP_EST_AR_TMST            03243332
032434                 , F.TRIP_STATUS_CDE                              03243432
032435                 , F.STATUS_DTE                                   03243532
032436                 , F.STATUS_TME                                   03243632
032437                 , E.OWNER_SCAC_ID                                03243732
032438                 , E.VEH_NBR                                      03243832
032439                 , K.CURR_TRIP_ID                                 03243932
032440              FROM TSHIPMT D                                      03244051
032441                 , TVHTRIP E                                      03244151
032442                 , TTRIPST F                                      03244251
032443                 , TTRSTYP G                                      03244351
032444                 , TVEHICL K                                      03244451
032446             WHERE D.LAST_UPD_DTE  <   :DK-PURGE-BEFORE           03244632
032447               AND D.TRIP_ID          =  E.TRIP_ID                03244732
032448               AND D.TRIP_ID          =  F.TRIP_ID                03244832
032449               AND F.TRIP_STATUS_CDE  =  G.TRIP_STATUS_CDE        03244932
032450               AND G.PRTY_CDE IN                                  03245032
032451                   (SELECT MAX(H.PRTY_CDE)                        03245132
032452                      FROM TTRSTYP H                              03245251
032453                         , TTRIPST I                              03245351
032454                     WHERE F.TRIP_ID  =  I.TRIP_ID                03245432
032455                       AND I.TRIP_STATUS_CDE  =                   03245532
032456                           H.TRIP_STATUS_CDE                      03245632
032457                   )                                              03245732
032458               AND E.OWNER_SCAC_ID  =  K.OWNER_SCAC_ID            03245832
032459               AND E.VEH_NBR        =  K.VEH_NBR                  03245932
032460           ) AS T4                                                03246032
032461          ON T3.SHIPT_ID  = T4.SHIPT_ID  AND                      03246132
032462             T3.TRIP_ID   = T4.TRIP_ID                            03246232
032463          ORDER BY T4.STATUS_DTE                                  03246332
032464                 , T4.STATUS_TME                                  03246432
032465                 , T3.SHIPMT_LAST_UPD_DTE                         03246532
032466     END-EXEC.                                                    03246632
032490                                                                  03249032
032500                                                                  03250032
032600     EXEC SQL                                                     03260032
032700         DECLARE TSHPTPO-CSR CURSOR FOR                           03270032
032900          SELECT SHIPT_ID                                         03290039
033000               , PO_NBR                                           03300039
033100               , REC_SEQ_NBR                                      03310039
033200            FROM TSHPTPO                                          03320051
033300           WHERE SHIPT_ID       = :SHIPMT-SHIPT-ID                03330039
033400     END-EXEC.                                                    03340032
033500                                                                  03350032
033600*                                                                 03360044
033700*  CURSOR USED TO SELECT ALL OLD TRIPS THAT DO NOT HAVE A MATCHING03370044
033800*  SHIPMENT ENTRY                                                 03380044
033900*                                                                 03390044
034000     EXEC SQL                                                     03400044
034100         DECLARE OLD-TVHTRIP-CSR CURSOR                           03410044
034200                 WITH HOLD FOR                                    03420044
034300          SELECT T1.TRIP_ID                                       03430044
034400               , T1.TRIP_LAST_UPD_DTE                             03440044
034500               , T1.TRIP_LAST_UPD_TME                             03450044
034600               , T1.OWNER_SCAC_ID                                 03460044
034700               , T1.VEH_NBR                                       03470044
034800               , T1.TRIP_STATUS_CDE                               03480044
034900               , T1.STATUS_DTE                                    03490044
035000               , T1.STATUS_TME                                    03500044
035100               , T2.CURR_TRIP_ID                                  03510044
035200            FROM                                                  03520044
035300          (SELECT A.TRIP_ID                                       03530044
035400                , A.LAST_UPD_DTE AS TRIP_LAST_UPD_DTE             03540044
035500                , A.LAST_UPD_TME AS TRIP_LAST_UPD_TME             03550044
035600                , A.OWNER_SCAC_ID                                 03560044
035700                , A.VEH_NBR                                       03570044
035800                , B.TRIP_STATUS_CDE                               03580044
035900                , B.STATUS_DTE                                    03590044
036000                , B.STATUS_TME                                    03600044
036200             FROM TVHTRIP A                                       03620051
036300                , TTRIPST B                                       03630051
036400                , TTRSTYP C                                       03640051
036500            WHERE A.LAST_UPD_DTE     < :DK-PURGE-BEFORE           03650044
036600              AND A.TRIP_ID          = B.TRIP_ID                  03660044
036700              AND B.TRIP_STATUS_CDE  =  C.TRIP_STATUS_CDE         03670044
036800              AND C.PRTY_CDE IN                                   03680044
036900                  (SELECT MAX(D.PRTY_CDE)                         03690044
037000                     FROM TTRSTYP D                               03700051
037100                        , TTRIPST E                               03710051
037110                    WHERE B.TRIP_ID  =  E.TRIP_ID                 03711044
037120                      AND E.TRIP_STATUS_CDE = D.TRIP_STATUS_CDE)  03712044
037130              AND NOT A.TRIP_ID IN                                03713044
037140                 (SELECT F.TRIP_ID                                03714044
037150                    FROM TSHIPMT F)                               03715051
037160            ) AS T1                                               03716044
037170            LEFT OUTER JOIN                                       03717044
037180            (SELECT H.TRIP_ID                                     03718044
037190                  , I.CURR_TRIP_ID                                03719044
037191               FROM TVHTRIP H                                     03719151
037192                  , TVEHICL I                                     03719251
037193              WHERE H.LAST_UPD_DTE < '2000-01-01'                 03719344
037194                AND H.TRIP_ID      = I.CURR_TRIP_ID               03719444
037195                AND NOT H.TRIP_ID IN                              03719544
037196                   (SELECT J.TRIP_ID                              03719644
037197                      FROM TSHIPMT J)                             03719751
037198            ) AS T2                                               03719844
037199              ON T1.TRIP_ID  =  T2.TRIP_ID                        03719944
037200            ORDER BY T1.TRIP_LAST_UPD_DTE                         03720044
037201                   , T1.TRIP_LAST_UPD_TME                         03720144
037229     END-EXEC.                                                    03722944
037230                                                                  03723044
037231                                                                  03723144
037240*                                                                 03724000
037300*  COMMUNICATION AREAS FOR DB2                                    03730000
037400*                                                                 03740000
037500     EXEC SQL                                                     03750000
037600         INCLUDE SQLCA                                            03760000
037700     END-EXEC.                                                    03770000
037800                                                                  03780000
037900*                                                                 03790000
038000*  DB2 COMMUNICATION AREA 2                                       03800000
038100*                                                                 03810000
038200     COPY SQLCA2.                                                 03820000
038300                                                                  03830000
038400 PROCEDURE DIVISION.                                              03840000
038500                                                                  03850000
038600******************************************************************03860000
038700*  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM    03870000
038800******************************************************************03880000
038900                                                                  03890000
039000 0000-PROGRAM-MAINLINE.                                           03900000
039010                                                                  03901002
039020*    DISPLAY ' 0000-PROGRAM-MAINLINE               '.             03902030
039030     DISPLAY '**************************************'             03903035
039040     DISPLAY '* TRKUP009 - BEGIN                   *'             03904035
039050     DISPLAY '**************************************'             03905035
039100                                                                  03910000
039200     PERFORM 1000-INITIALIZE.                                     03920000
039300                                                                  03930000
039301     DISPLAY ' '.                                                 03930145
039302     DISPLAY ' PROCESSING OLD TSHIPMT'.                           03930245
039303     DISPLAY ' '.                                                 03930345
039310                                                                  03931045
039400     PERFORM 2000-PROCESS-RECS-TO-DELETE                          03940000
039500         UNTIL PS-END-OF-OLD-TSHIPMT-CSR.                         03950001
039600                                                                  03960000
039700     PERFORM 4200-CLOSE-OLD-TSHIPMT-CSR.                          03970001
040400                                                                  04040000
040402     DISPLAY ' '.                                                 04040245
040403     DISPLAY ' PROCESSING OLD TVHTRIP'.                           04040345
040404     DISPLAY ' '.                                                 04040445
040405                                                                  04040545
040410     PERFORM 4300-OPEN-OLD-TVHTRIP-CSR.                           04041044
040411                                                                  04041145
040412     MOVE ZEROES         TO  PV-DISP-SHIPT-ID                     04041245
040413                             PV-DISP-TRIP-ID                      04041345
040415                             PV-DISP-CURR-TRIP.                   04041545
040416                                                                  04041645
040420     PERFORM 4400-FETCH-OLD-TVHTRIP-CSR.                          04042044
040430                                                                  04043044
040500     PERFORM 2500-PROCESS-OLD-TVHTRIP                             04050044
040600         UNTIL PS-END-OF-OLD-TVHTRIP-CSR.                         04060044
040700                                                                  04070044
040800     PERFORM 4500-CLOSE-OLD-TVHTRIP-CSR.                          04080044
040810                                                                  04081044
040900     PERFORM 9500-EOJ-ROUTINE.                                    04090000
041000                                                                  04100000
041100     STOP RUN.                                                    04110000
041200                                                                  04120000
041300******************************************************************04130000
041400*  1000-INITIALIZE - ACCEPTS THE CONTROL CARD AND VALIDATES THE   04140000
041500*  FORMAT.  OPENS THE DRIVING CURSOR AND PERFORMS THE FIRST FETCH.04150000
041600******************************************************************04160000
041700                                                                  04170000
041800 1000-INITIALIZE.                                                 04180000
041901                                                                  04190102
041902*    DISPLAY ' 1000-INITIALIZE                     '.             04190230
041903                                                                  04190302
041910     PERFORM 1010-GET-PURGE-DATE.                                 04191002
041920                                                                  04192002
042000     ACCEPT PV-CPU-DATE FROM DATE.                                04200000
046800     PERFORM 4000-OPEN-OLD-TSHIPMT-CSR.                           04680001
046900     PERFORM 4100-FETCH-OLD-SHIPMT-CSR.                           04690001
047000                                                                  04700000
047100                                                                  04710000
047101******************************************************************04710102
047102* GET THE BACK PURGE DATE FOR OLD SHIPMENTS                      *04710202
047103******************************************************************04710302
047110 1010-GET-PURGE-DATE.                                             04711002
047111                                                                  04711102
047112*    DISPLAY ' 1010-GET-PURGE-DATE                 '.             04711230
047113                                                                  04711302
047114     EXEC SQL                                                     04711402
047115        SELECT   FUNC_QTY                                         04711502
047116               , CURRENT DATE                                     04711602
047117               , CURRENT DATE - FUNC_QTY DAYS                     04711702
047131          INTO   :KRPRPM-FUNC-QTY                                 04713102
047132               , :PV-CURRENT-DATE                                 04713202
047133               , :DK-PURGE-BEFORE                                 04713302
047150        FROM   TKRPRPM                                            04715002
047151        WHERE  LOC_ID            =  90                            04715102
047152          AND  INTFC_SYS_CDE     = 'KHL'                          04715202
047153          AND  SYS_PRC_FUNC_CDE  = 'TRSHDY'                       04715302
047154          AND  FUNC_PRC_STAT_CDE = 'AC'                           04715402
047155          AND  FUNC_BEG_TMST    <=  CURRENT TIMESTAMP             04715511
047156          AND  FUNC_END_TMST    >=  CURRENT TIMESTAMP             04715611
047158     END-EXEC.                                                    04715802
047159                                                                  04715902
047160     EVALUATE TRUE                                                04716002
047161         WHEN SQLCODE = ZERO                                      04716102
047162             MOVE KRPRPM-FUNC-QTY  TO  PV-DISP-FUNC-QTY           04716202
047163             DISPLAY '** PARM: TRSHDY'                            04716302
047164             DISPLAY '** QTY:         ' PV-DISP-FUNC-QTY          04716402
047165             DISPLAY '** CURRENT DATE:' PV-CURRENT-DATE           04716505
047166             DISPLAY '** PURGE DATE:  ' DK-PURGE-BEFORE           04716607
047171         WHEN OTHER                                               04717102
047173             MOVE SQLCODE  TO  PV-DISP-SQLCODE                    04717302
047174             DISPLAY ' '                                          04717441
047175             DISPLAY '** ABEND - TRKUP009 ** ' PV-DISP-SQLCODE    04717541
047176             DISPLAY '** 1010-GET-PURGE-DATE'                     04717641
047177             DISPLAY '** SELECT ERROR ON TKRPRPM'                 04717741
047178             DISPLAY '** PARM:  TRSHDY'                           04717841
047181             PERFORM 9200-SQL-WARNING                             04718102
047187     END-EVALUATE.                                                04718702
047188                                                                  04718802
047190                                                                  04719002
051900******************************************************************05190000
052000* 2000-PROCESS-RECS-TO-DELETE - USE THE INFORMATION RETRIEVED     05200000
052100* FROM THE DRIVING CURSOR TO DELETE THE INACTIVE VHTRIP ROWS.     05210000
052200******************************************************************05220000
052300                                                                  05230000
052400 2000-PROCESS-RECS-TO-DELETE.                                     05240000
052410                                                                  05241002
052420*    DISPLAY ' 2000-PROCESS-RECS-TO-DELETE         '.             05242030
052500                                                                  05250000
052600     SET PS-NOT-END-OF-TSHIPMT-CSR                                05260000
052700         PS-SHIPMT-DELETED     TO TRUE.                           05270000
052710     MOVE DK-SHIPT-ID          TO  SHIPMT-SHIPT-ID                05271029
052711                                   PV-DISP-SHIPT-ID.              05271129
052720     MOVE DK-TRIP-ID           TO  VHTRIP-TRIP-ID                 05272029
052730                                   PV-DISP-TRIP-ID.               05273029
052910                                                                  05291014
053100     SET PS-NOT-END-OF-TSHPTPO-CSR TO TRUE.                       05310014
053110     IF  DK-TSHPTPO-COUNT  >  0                                   05311029
053200         PERFORM 5000-OPEN-TSHPTPO-CSR                            05320014
053300         SET OK-TO-DELETE TO TRUE                                 05330014
053400         PERFORM 5100-FETCH-TSHPTPO-CSR                           05340014
053500         PERFORM 2100-CHECK-TSHPTPO                               05350014
053600           UNTIL PS-END-OF-TSHPTPO-CSR OR                         05360014
053700                 NOT-OK-TO-DELETE                                 05370014
053800         PERFORM 5200-CLOSE-TSHPTPO-CSR                           05380014
053810     ELSE                                                         05381014
053811         SET OK-TO-DELETE TO TRUE                                 05381114
053812     END-IF.                                                      05381214
053820                                                                  05382014
053900     IF  OK-TO-DELETE                                             05390014
054000         IF  DK-TSHPTPO-COUNT  >  0                               05400029
054200             PERFORM 2400-DELETE-TSHPTPO                          05420029
054210         END-IF                                                   05421029
054300         PERFORM 3950-DELETE-TSHIPMT                              05430014
054310         SET NOT-OK-TO-DELETE                                     05431029
054320             PS-NOT-END-OF-TSHPTPO-CSR TO TRUE                    05432029
054400     ELSE                                                         05440014
054500         SET PS-SHIPMT-NOT-DELETED     TO TRUE                    05450014
054510         DISPLAY ' TSHIPMT NOT DELETED'                           05451014
054600     END-IF                                                       05460014
054810                                                                  05481014
054900     IF  PS-SHIPMT-NOT-DELETED  OR                                05490042
054910         PS-TRIP-ID-NULL                                          05491042
055000         CONTINUE                                                 05500000
055100     ELSE                                                         05510000
055110        PERFORM 2305-COUNT-SHIPMT-FOR-TRIP                        05511014
055120        IF  PV-TRIP-TSHIPMT-CNT  =  0                             05512014
055200            PERFORM 2300-DELETE-TVHTRIP                           05520014
055300         END-IF                                                   05530014
055310     END-IF.                                                      05531014
055400                                                                  05540000
055401     IF  PS-TRIP-ID-NULL                                          05540142
055402         CONTINUE                                                 05540242
055403     ELSE                                                         05540342
055410         IF  DK-TRIP-ID  > 0  AND                                 05541042
055420             DK-TRIP-ID  = DK-CURR-TRIP-ID                        05542042
055500             PERFORM 2200-PROCESS-RECS-TO-UPDATE                  05550042
055510         END-IF                                                   05551042
055520     END-IF.                                                      05552042
055600                                                                  05560029
055800     PERFORM 8000-COMMIT.                                         05580029
056000                                                                  05600000
056100     PERFORM 4100-FETCH-OLD-SHIPMT-CSR.                           05610006
056200                                                                  05620000
056300******************************************************************05630000
056400* 2100-CHECK-TSHPTPO THIS PARAGRAPH WILL CHECK THE RECORD SEQUENCE05640000
056500* NUMBER, IF ITS SOMETHING OTHER THAN ZERO THAN NO ROWS SHOULD BE 05650000
056600* DELETED.                                                        05660000
056700******************************************************************05670000
056800 2100-CHECK-TSHPTPO.                                              05680000
056810                                                                  05681002
056820*    DISPLAY ' 2100-CHECK-TSHPTPO                  '.             05682030
056900                                                                  05690000
056901     SET  PS-PO-RCVR-EXISTS-NO  TO  TRUE                          05690119
056910                                                                  05691016
057000     IF  SHPTPO-REC-SEQ-NBR NOT EQUAL ZERO                        05700016
057010         PERFORM 2105-CHECK-RCVR-EXISTS                           05701016
057020         IF  PS-PO-RCVR-EXISTS                                    05702016
057100             SET NOT-OK-TO-DELETE TO TRUE                         05710016
057101             DISPLAY 'TSHPTPO - PO-RCVR EXISTS'                   05710150
057110         ELSE                                                     05711019
057112             PERFORM 5100-FETCH-TSHPTPO-CSR                       05711219
057120         END-IF                                                   05712019
057130     ELSE                                                         05713020
057140         PERFORM 5100-FETCH-TSHPTPO-CSR                           05714020
057200     END-IF.                                                      05720000
057300                                                                  05730000
057500                                                                  05750000
057501                                                                  05750116
057502******************************************************************05750216
057503* CHECK TO SEE IF THE RECEIVERS EXISTS - IT COULD HAVE BEEN      *05750316
057504* DELETED AS PART OF THE PO PURGE.                               *05750416
057505******************************************************************05750516
057510 2105-CHECK-RCVR-EXISTS.                                          05751016
057511                                                                  05751116
057512*    DISPLAY ' 2105-CHECK-RCVR-EXISTS              '.             05751230
057513                                                                  05751316
057516     PERFORM                                                      05751616
057517         WITH TEST AFTER                                          05751716
057518         VARYING PV-RETRY-CNT                                     05751816
057519         FROM 1 BY 1                                              05751916
057520         UNTIL (PV-RETRY-CNT > PC-MAX-RETRIES                     05752016
057521                OR SQLCODE = 0                                    05752149
057522                OR SQLCODE = +100)                                05752249
057523                                                                  05752349
057524         EXEC SQL                                                 05752449
057525             SELECT ORD_NBR                                       05752549
057526                  , REC_SEQ_NBR                                   05752649
057527               INTO :RECEIV-ORD-NBR                               05752749
057528                  , :RECEIV-REC-SEQ-NBR                           05752849
057529               FROM TRECEIV                                       05752949
057530              WHERE ORD_NBR        = :SHPTPO-PO-NBR               05753049
057531                AND REC_SEQ_NBR    = :SHPTPO-REC-SEQ-NBR          05753149
057532         END-EXEC                                                 05753249
057533                                                                  05753349
057534         EVALUATE TRUE                                            05753449
057535             WHEN SQLCODE = 0                                     05753549
057536                  SET PS-PO-RCVR-EXISTS                           05753649
057537                      NOT-OK-TO-DELETE   TO  TRUE                 05753749
057538                                                                  05753849
057539             WHEN SQLCODE = +100                                  05753949
057540                  SET PS-PO-RCVR-EXISTS-NO  TO TRUE               05754049
057541                                                                  05754149
057542             WHEN SQLCODE = -904                                  05754249
057543             WHEN SQLCODE = -911                                  05754349
057544                 CONTINUE                                         05754449
057545                                                                  05754549
057546             WHEN SQLCODE < 0                                     05754649
057547                 DISPLAY ' '                                      05754749
057548                 DISPLAY '** ABEND - TRKUP009 **'                 05754849
057549                 DISPLAY '** 2105-CHECK-RCVR-EXISTS    '          05754949
057550                 DISPLAY '** CHECK IF RCVR EXISTS   '             05755049
057551                 DISPLAY '** PO-RCVR: '  SHPTPO-PO-NBR            05755149
057552                         '-'             SHPTPO-REC-SEQ-NBR       05755249
057553                 DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID          05755349
057554                 DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID         05755449
057555                 PERFORM 9000-SQL-ERROR                           05755549
057556                                                                  05755649
057557             WHEN SQLCODE > 0                                     05755749
057558             WHEN SQLWARN0 = 'W'                                  05755849
057559                 DISPLAY ' '                                      05755949
057560                 DISPLAY '** ABEND - TRKUP009 **'                 05756049
057561                 DISPLAY '** 2105-CHECK-RCVR-EXISTS    '          05756149
057562                 DISPLAY '** CHECK IF RCVR EXISTS     '           05756249
057563                 DISPLAY '** PO-RCVR: '  SHPTPO-PO-NBR            05756349
057564                         '-'             SHPTPO-REC-SEQ-NBR       05756449
057565                 DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID          05756549
057566                 DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID         05756649
057567                 PERFORM 9200-SQL-WARNING                         05756749
057568         END-EVALUATE                                             05756849
057569     END-PERFORM.                                                 05756949
057570                                                                  05757049
057571     IF PV-RETRY-CNT > PC-MAX-RETRIES                             05757149
057572         DISPLAY ' '                                              05757249
057573         DISPLAY '** ABEND - TRKUP009 **'                         05757349
057574         DISPLAY '** 2105-CHECK-RCVR-EXISTS    '                  05757449
057575         DISPLAY '** CHECK IF RCVR EXISTS     '                   05757549
057576         DISPLAY '** PO-RCVR: '  SHPTPO-PO-NBR                    05757649
057577                 '-'             SHPTPO-REC-SEQ-NBR               05757749
057578         DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID                  05757849
057579         DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID                 05757949
057580         PERFORM 9000-SQL-ERROR                                   05758049
057581     END-IF.                                                      05758149
057582                                                                  05758249
057583                                                                  05758349
057584                                                                  05758449
057590                                                                  05759016
057600******************************************************************05760000
057700* 2200-PROCESS-RECS-TO-UPDATE - USE THE INFORMATION RETRIEVED     05770000
057800* FROM THE DRIVING CURSOR TO UPDATE THE TVEHICL RECORDS.          05780000
057900******************************************************************05790000
058000                                                                  05800000
058100 2200-PROCESS-RECS-TO-UPDATE.                                     05810000
058110                                                                  05811002
058120*    DISPLAY ' 2200-PROCESS-RECS-TO-UPDATE         '.             05812030
058200                                                                  05820000
058300     PERFORM 7600-UPDATE-TVEHICL.                                 05830000
058700                                                                  05870000
058900                                                                  05890000
059000******************************************************************05900000
059100* 2300-DELETE-TVHTRIP - PERFORM A DELETE ON THE INACTIVE TVHTRIP  05910000
059200* ROWS BASED ON THE KEY RETURNED FROM THE DRIVING CURSOR.         05920000
059300******************************************************************05930000
059400                                                                  05940000
059500 2300-DELETE-TVHTRIP.                                             05950000
059510                                                                  05951002
059520*    DISPLAY ' 2300-DELETE-TVHTRIP                 '.             05952030
059600                                                                  05960030
059700     PERFORM                                                      05970030
059800         WITH TEST AFTER                                          05980030
059900         VARYING PV-RETRY-CNT                                     05990030
060000         FROM 1 BY 1                                              06000030
060100         UNTIL (PV-RETRY-CNT > PC-MAX-RETRIES                     06010030
060200                OR SQLCODE = 0)                                   06020030
060300                                                                  06030030
060400         EXEC SQL                                                 06040030
060500             DELETE FROM TVHTRIP                                  06050051
060600              WHERE TRIP_ID        = :VHTRIP-TRIP-ID              06060030
060700         END-EXEC                                                 06070030
060800                                                                  06080030
060900         EVALUATE TRUE                                            06090030
061000             WHEN SQLCODE = 0                                     06100030
061100                 ADD SQLERRD(3)  TO PV-TVHTRIP-DELETED            06110030
061200                                                                  06120030
061300             WHEN SQLCODE = +100                                  06130030
061400                 DISPLAY ' '                                      06140041
061410                 DISPLAY '** ABEND - TRKUP009 **'                 06141041
061500                 DISPLAY '** 2300-DELETE-TVHTRIP'                 06150030
061600                 DISPLAY '** DELETE ERROR ON TVHTRIP'             06160030
061710                 DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID          06171030
061720                 DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID         06172030
061800                 PERFORM 9000-SQL-ERROR                           06180030
061900             WHEN SQLCODE = -904                                  06190030
062000             WHEN SQLCODE = -911                                  06200030
062100                 CONTINUE                                         06210030
062200             WHEN SQLCODE < 0                                     06220030
062210                 DISPLAY ' '                                      06221041
062300                 DISPLAY '** ABEND - TRKUP009 **'                 06230030
062400                 DISPLAY '** 2300-DELETE-TVHTRIP'                 06240030
062500                 DISPLAY '** DELETE ERROR ON TVHTRIP'             06250030
062600                 DISPLAY '** TRIP-ID = ' PV-DISP-TRIP-ID          06260030
062610                 DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID         06261030
062700                 PERFORM 9000-SQL-ERROR                           06270030
062800             WHEN SQLCODE > 0                                     06280030
062900             WHEN SQLWARN0 = 'W'                                  06290030
062910                 DISPLAY ' '                                      06291041
063000                 DISPLAY '** ABEND - TRKUP009 **'                 06300030
063100                 DISPLAY '** 2300-DELETE-TVHTRIP'                 06310030
063200                 DISPLAY '** DELETE WARNING ON TVHTRIP'           06320030
063300                 DISPLAY '** TRIP-ID = ' PV-DISP-TRIP-ID          06330030
063310                 DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID         06331030
063400                 PERFORM 9200-SQL-WARNING                         06340030
063500         END-EVALUATE                                             06350030
063600     END-PERFORM.                                                 06360030
063700                                                                  06370000
063800     IF PV-RETRY-CNT > PC-MAX-RETRIES                             06380000
063810         DISPLAY ' '                                              06381041
063900         DISPLAY '** ABEND - TRKUP009 **'                         06390000
064000         DISPLAY '** 2300-DELETE-TVHTRIP'                         06400000
064100         DISPLAY '** DELETE ERROR ON TVHTRIP'                     06410000
064200         DISPLAY '** MAX RETRIES EXCEEDED'                        06420000
064300         DISPLAY '** TRIP-ID = ' PV-DISP-TRIP-ID                  06430029
064310         DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID                 06431029
064400         PERFORM 9000-SQL-ERROR                                   06440000
064500     END-IF.                                                      06450000
064501                                                                  06450114
064502                                                                  06450214
064503******************************************************************06450314
064504* COUN THE NUMBER OF TSHIPMT ROWS ARE STILL ON THE TRIP           06450414
064506******************************************************************06450614
064507 2305-COUNT-SHIPMT-FOR-TRIP.                                      06450714
064508                                                                  06450814
064509*    DISPLAY ' 2305-COUNT-SHIPMT-FOR-TRIP          '.             06450930
064510                                                                  06451014
064520     MOVE ZEROES  TO  PV-TRIP-TSHIPMT-CNT                         06452014
064521                                                                  06452114
064522     PERFORM                                                      06452214
064523         WITH TEST AFTER                                          06452314
064524         VARYING PV-RETRY-CNT                                     06452414
064525         FROM 1 BY 1                                              06452514
064526         UNTIL (PV-RETRY-CNT > PC-MAX-RETRIES                     06452614
064527                OR SQLCODE = 0)                                   06452714
064528                                                                  06452814
064529         EXEC SQL                                                 06452914
064530             SELECT COUNT(*)                                      06453014
064531               INTO :PV-TRIP-TSHIPMT-CNT                          06453114
064532               FROM TSHIPMT                                       06453251
064533              WHERE TRIP_ID        = :VHTRIP-TRIP-ID              06453314
064534         END-EXEC                                                 06453414
064535                                                                  06453514
064536         EVALUATE TRUE                                            06453614
064537             WHEN SQLCODE = 0                                     06453714
064538                  CONTINUE                                        06453814
064539                                                                  06453914
064546             WHEN SQLCODE = -904                                  06454614
064547             WHEN SQLCODE = -911                                  06454714
064548                 CONTINUE                                         06454814
064549                                                                  06454914
064550             WHEN SQLCODE < 0                                     06455014
064551                 DISPLAY ' '                                      06455141
064552                 DISPLAY '** ABEND - TRKUP009 **'                 06455241
064553                 DISPLAY '** 2305-COUNT-SHIPMT-FOR-TRIP'          06455341
064554                 DISPLAY '** COUNT TSHIPMT FOR TRIP '             06455441
064555                 DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID          06455541
064556                 DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID         06455629
064557                 PERFORM 9000-SQL-ERROR                           06455714
064558                                                                  06455814
064559             WHEN SQLCODE > 0                                     06455914
064560             WHEN SQLWARN0 = 'W'                                  06456014
064561                 DISPLAY ' '                                      06456141
064562                 DISPLAY '** ABEND - TRKUP009 **'                 06456214
064563                 DISPLAY '** 2305-COUNT-SHIPMT-FOR-TRIP'          06456314
064564                 DISPLAY '** COUNT TSHIPMT FOR TRIP   '           06456414
064565                 DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID          06456529
064566                 DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID         06456629
064567                 PERFORM 9200-SQL-WARNING                         06456714
064568         END-EVALUATE                                             06456814
064569     END-PERFORM.                                                 06456914
064570                                                                  06457014
064571     IF PV-RETRY-CNT > PC-MAX-RETRIES                             06457114
064572         DISPLAY ' '                                              06457241
064573         DISPLAY '** ABEND - TRKUP009 **'                         06457341
064574         DISPLAY '** 2305-COUNT-SHIPMT-FOR-TRIP'                  06457441
064575         DISPLAY '** COUNT TSHIPMT FOR TRIP '                     06457541
064576         DISPLAY '** MAX RETRIES EXCEEDED'                        06457641
064577         DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID                  06457741
064578         DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID                 06457841
064579         PERFORM 9000-SQL-ERROR                                   06457941
064580     END-IF.                                                      06458041
064581                                                                  06458141
064590                                                                  06459014
064600******************************************************************06460000
064700* 2400-DELETE-TSHPTPO - PERFORM A DELETE ON THE TSHPTPO RECORDS   06470000
064800* FOR A TRIP.                                                     06480000
064900******************************************************************06490000
065000                                                                  06500000
065100 2400-DELETE-TSHPTPO.                                             06510000
065110                                                                  06511002
065120*    DISPLAY ' 2400-DELETE-TSHPTPO                 '.             06512030
065200                                                                  06520030
065300     PERFORM                                                      06530030
065400         WITH TEST AFTER                                          06540030
065500         VARYING PV-RETRY-CNT                                     06550030
065600         FROM 1 BY 1                                              06560030
065700         UNTIL (PV-RETRY-CNT > PC-MAX-RETRIES                     06570030
065800                OR SQLCODE = +100                                 06580030
065900                OR SQLCODE = 0)                                   06590030
066000                                                                  06600030
066100         EXEC SQL                                                 06610030
066200             DELETE FROM TSHPTPO                                  06620051
066300              WHERE SHIPT_ID        = :SHIPMT-SHIPT-ID            06630030
066400         END-EXEC                                                 06640030
066500                                                                  06650030
066600         EVALUATE TRUE                                            06660030
066700             WHEN SQLCODE = 0                                     06670030
066800                 ADD SQLERRD(3)  TO PV-TSHPTPO-DELETED            06680030
066900                                                                  06690030
067000             WHEN SQLCODE = +100                                  06700030
067100             WHEN SQLCODE = -904                                  06710030
067200             WHEN SQLCODE = -911                                  06720030
067300                 CONTINUE                                         06730030
067400             WHEN SQLCODE < 0                                     06740030
067410                 DISPLAY ' '                                      06741041
067500                 DISPLAY '** ABEND - TRKUP009 **'                 06750030
067600                 DISPLAY '** 2400-DELETE-TSHPTPO'                 06760030
067700                 DISPLAY '** DELETE ERROR ON TSHPTPO'             06770030
067710                 DISPLAY '** TRIP-ID: ' PV-DISP-TRIP-ID           06771030
067800                 DISPLAY '** SHIPT-ID:' PV-DISP-SHIPT-ID          06780030
067900                 PERFORM 9000-SQL-ERROR                           06790030
068000             WHEN SQLCODE > 0                                     06800030
068100             WHEN SQLWARN0 = 'W'                                  06810030
068110                 DISPLAY ' '                                      06811041
068200                 DISPLAY '** ABEND - TRKUP009 **'                 06820030
068300                 DISPLAY '** 2400-DELETE-TSHPTPO'                 06830030
068400                 DISPLAY '** DELETE WARNING ON TSHPTPO'           06840030
068410                 DISPLAY '** TRIP-ID: ' PV-DISP-TRIP-ID           06841030
068500                 DISPLAY '** SHIPT-ID:' PV-DISP-SHIPT-ID          06850030
068600                 PERFORM 9200-SQL-WARNING                         06860030
068700         END-EVALUATE                                             06870030
068800     END-PERFORM.                                                 06880030
068900                                                                  06890030
069000     IF PV-RETRY-CNT > PC-MAX-RETRIES                             06900030
069100         DISPLAY ' '                                              06910041
069110         DISPLAY '** ABEND - TRKUP009 **'                         06911041
069200         DISPLAY '** 2400-DELETE-TSHPTPO'                         06920030
069300         DISPLAY '** DELETE ERROR ON TSHPTPO'                     06930030
069400         DISPLAY '** MAX RETRIES EXCEEDED'                        06940030
069410         DISPLAY '** TRIP-ID: ' PV-DISP-TRIP-ID                   06941030
069500         DISPLAY '** SHIPT-ID:' PV-DISP-SHIPT-ID                  06950030
069600         PERFORM 9000-SQL-ERROR                                   06960030
069700     END-IF.                                                      06970030
069800                                                                  06980000
069801                                                                  06980144
069810******************************************************************06981044
069820* PROCESS OLD TVEHICL ROWS THAT HAVE NO MATCHING SHIPMENT ROW    *06982044
069830******************************************************************06983044
069900 2500-PROCESS-OLD-TVHTRIP.                                        06990045
070000                                                                  07000044
070020*    DISPLAY ' 2500-PROCESS-OLD-TVHTRIP            '.             07002045
070030                                                                  07003045
070040     SET PS-NOT-END-OF-OLD-TVHTRIP-CSR TO TRUE.                   07004046
070080     MOVE DK-TRIP-ID                   TO VHTRIP-TRIP-ID          07008046
070090                                          PV-DISP-TRIP-ID.        07009046
070091                                                                  07009145
070118     IF  PS-TRIP-ID-NULL                                          07011845
070119         CONTINUE                                                 07011945
070120     ELSE                                                         07012045
070123         PERFORM 2300-DELETE-TVHTRIP                              07012345
070125     END-IF.                                                      07012545
070126                                                                  07012645
070127     IF  PS-TRIP-ID-NULL                                          07012745
070128         CONTINUE                                                 07012845
070129     ELSE                                                         07012945
070130         IF  DK-TRIP-ID  > 0  AND                                 07013045
070131             DK-TRIP-ID  = DK-CURR-TRIP-ID                        07013145
070132             PERFORM 2200-PROCESS-RECS-TO-UPDATE                  07013245
070133         END-IF                                                   07013345
070134     END-IF.                                                      07013445
070135                                                                  07013545
070136     PERFORM 8000-COMMIT.                                         07013645
070137                                                                  07013745
070138     PERFORM 4400-FETCH-OLD-TVHTRIP-CSR.                          07013845
070139                                                                  07013945
070140                                                                  07014044
080300******************************************************************08030000
080400* 3950-DELETE-TSHIPMT   - DELETE THE RECORD PROCESSED.           *08040000
080500******************************************************************08050000
080600                                                                  08060000
080700 3950-DELETE-TSHIPMT.                                             08070000
080710                                                                  08071002
080720*    DISPLAY ' 3950-DELETE-TSHIPMT                 '.             08072030
080800                                                                  08080030
080900     EXEC SQL                                                     08090030
081000       DELETE                                                     08100030
081100       FROM     TSHIPMT                                           08110051
081300       WHERE    SHIPT_ID   = :SHIPMT-SHIPT-ID                     08130042
081400     END-EXEC.                                                    08140030
081500                                                                  08150030
081600     EVALUATE TRUE                                                08160030
081700         WHEN SQLCODE < ZERO                                      08170030
081900            DISPLAY '** ABEND - TRKUP009 **'                      08190030
081910         WHEN SQLCODE = +100                                      08191041
081920            DISPLAY ' '                                           08192041
081921            DISPLAY '** TRIP ID: ' PV-DISP-TRIP-ID                08192141
081930            DISPLAY '** SHIPT ID:' PV-DISP-SHIPT-ID               08193041
082000            DISPLAY '** 3950-DELETE-TSHIPMT **'                   08200030
082100            DISPLAY '** DELETE ERROR ON TSHIPMT ** '              08210030
082200            PERFORM 9000-SQL-ERROR                                08220030
082300         WHEN SQLCODE > ZERO                                      08230030
082400         WHEN SQLWARN0 NOT = SPACES                               08240030
082401            DISPLAY ' '                                           08240141
082500            DISPLAY '** ABEND - TRKUP009 **'                      08250030
082510            DISPLAY '** TRIP ID: ' PV-DISP-TRIP-ID                08251041
082520            DISPLAY '** SHIPT ID:' PV-DISP-SHIPT-ID               08252041
082600            DISPLAY '** 3950-DELETE-TSHIPMT ** '                  08260030
082700            DISPLAY '** DELETE WARNING ON THSIPMT **'             08270030
082800            PERFORM 9000-SQL-ERROR                                08280030
082900         WHEN OTHER                                               08290030
083000            ADD +1         TO PV-TSHIPMT-DELETED                  08300036
083100            ADD SQLERRD(3) TO PV-TSHIPMT-TSHIPST-DELETED          08310036
083200     END-EVALUATE.                                                08320030
083210                                                                  08321009
083220                                                                  08322009
083300******************************************************************08330000
083400* 4000-OPEN-OLD-TSHIPMT-CSR - OPEN THE CURSOR USED TO SELECT ALL *08340001
083500* OLD SHIPMENTS THAT NEED TO BE DELETED.                         *08350001
083700******************************************************************08370000
083800                                                                  08380000
083900 4000-OPEN-OLD-TSHIPMT-CSR.                                       08390001
083910                                                                  08391002
083920*    DISPLAY ' 4000-OPEN-OLD-TSHIPMT-CSR           '.             08392030
084000                                                                  08400000
084100     EXEC SQL                                                     08410000
084200         OPEN OLD-TSHIPMT-CSR                                     08420001
084300     END-EXEC.                                                    08430000
084400                                                                  08440000
084500     EVALUATE TRUE                                                08450000
084600         WHEN SQLCODE < ZERO                                      08460000
084700             DISPLAY ' '                                          08470041
084701             DISPLAY '** ABEND - TRKUP009 **'                     08470141
084710             DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID              08471041
084720             DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID             08472041
084730             DISPLAY '** VEHICLE: '  DK-VEH-NBR                   08473041
084800             DISPLAY '** 4000-OPEN-OLD-TSHIPMT-CSR'               08480001
084900             DISPLAY '** OPEN ERROR ON TVHTRIP'                   08490000
085000             PERFORM 9000-SQL-ERROR                               08500000
085100         WHEN ((SQLCODE > ZERO) AND (SQLCODE NOT = +100))         08510000
085200         WHEN SQLWARN0 NOT = SPACES                               08520000
085201             DISPLAY ' '                                          08520141
085300             DISPLAY '** ABEND - TRKUP009 **'                     08530000
085310             DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID              08531041
085320             DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID             08532041
085330             DISPLAY '** VEHICLE: '  DK-VEH-NBR                   08533041
085400             DISPLAY '** 4000-OPEN-OLD-TSHIPMT-CSR'               08540001
085500             DISPLAY '** OPEN WARNING ON TVHTRIP'                 08550000
085600             PERFORM 9200-SQL-WARNING                             08560000
085700         WHEN OTHER                                               08570000
085800             CONTINUE                                             08580000
085900     END-EVALUATE.                                                08590000
086000                                                                  08600000
086100******************************************************************08610000
086200* 4100-FETCH-OLD-SHIPMT-CSR                                      *08620006
086300*  FETCH A TRIPS WITH NULL VEHICL NUMBER OLDER THAN THE CONTROL  *08630000
086400*  DATE.                                                         *08640000
086500******************************************************************08650000
086600                                                                  08660000
086700 4100-FETCH-OLD-SHIPMT-CSR.                                       08670006
086710                                                                  08671002
086720*    DISPLAY ' 4100-FETCH-OLD-SHIPMT-CSR           '.             08672030
086800                                                                  08680000
086810     DISPLAY ' '.                                                 08681046
087000                                                                  08700000
087010     SET PS-TRIP-ID-NOT-NULL TO  TRUE.                            08701046
087020                                                                  08702042
087100     EXEC SQL                                                     08710030
087200         FETCH OLD-TSHIPMT-CSR                                    08720001
087310          INTO :DK-SHIPT-ID                                       08731012
087320             , :DK-SHIPMT-LAST-UPD-DTE                            08732012
087330             , :DK-SHIPMT-EST-AR-TMST  :PV-NULL-IND-2             08733026
087340             , :DK-TRIP-ID            :PV-NULL-IND-12             08734042
087350             , :DK-TSHPTPO-COUNT       :PV-NULL-IND-11            08735028
087360             , :DK-TRIP-LAST-UPD-DTE   :PV-NULL-IND-3             08736026
087370             , :DK-TRIP-LAST-UPD-TME   :PV-NULL-IND-4             08737026
087380             , :DK-TRIP-STATUS-CDE     :PV-NULL-IND-5             08738026
087390             , :DK-TRIP-EST-AR-TMST    :PV-NULL-IND-6             08739026
087391             , :DK-STATUS-DTE          :PV-NULL-IND-7             08739126
087392             , :DK-STATUS-TME          :PV-NULL-IND-8             08739226
087393             , :DK-OWNER-SCAC-ID       :PV-NULL-IND-9             08739326
087394             , :DK-VEH-NBR             :PV-NULL-IND-10            08739426
087395             , :DK-CURR-TRIP-ID        :PV-NULL-IND-1             08739526
087400     END-EXEC.                                                    08740000
087500                                                                  08750000
087600     EVALUATE TRUE                                                08760000
087700         WHEN SQLCODE = 0                                         08770000
087712             IF  PV-NULL-IND-1  =  -1                             08771226
087720                 MOVE ZEROES        TO  DK-CURR-TRIP-ID           08772026
087730             END-IF                                               08773026
087731             IF  PV-NULL-IND-2  =  -1                             08773126
087732                 MOVE SPACES        TO  DK-SHIPMT-EST-AR-TMST     08773226
087733             END-IF                                               08773326
087734             IF  PV-NULL-IND-3  =  -1                             08773426
087735                 MOVE SPACES        TO  DK-TRIP-LAST-UPD-DTE      08773526
087736             END-IF                                               08773626
087743             IF  PV-NULL-IND-4  =  -1                             08774326
087744                 MOVE SPACES        TO  DK-TRIP-LAST-UPD-TME      08774426
087745             END-IF                                               08774526
087746             IF  PV-NULL-IND-5  =  -1                             08774626
087747                 MOVE SPACES        TO  DK-TRIP-STATUS-CDE        08774726
087748             END-IF                                               08774826
087749             IF  PV-NULL-IND-6  =  -1                             08774926
087750                 MOVE SPACES        TO  DK-TRIP-EST-AR-TMST       08775026
087751             END-IF                                               08775126
087752             IF  PV-NULL-IND-7  =  -1                             08775226
087753                 MOVE SPACES        TO  DK-STATUS-DTE             08775326
087754             END-IF                                               08775426
087755             IF  PV-NULL-IND-8  =  -1                             08775526
087756                 MOVE SPACES        TO  DK-STATUS-TME             08775627
087757             END-IF                                               08775726
087758             IF  PV-NULL-IND-9  =  -1                             08775826
087759                 MOVE SPACES        TO  DK-OWNER-SCAC-ID          08775926
087760             END-IF                                               08776026
087761             IF  PV-NULL-IND-10 =  -1                             08776126
087762                 MOVE SPACES        TO  DK-VEH-NBR                08776226
087763             END-IF                                               08776326
087764             IF  PV-NULL-IND-11 =  -1                             08776428
087765                 MOVE ZEROES        TO  DK-TSHPTPO-COUNT          08776528
087766             END-IF                                               08776628
087767             IF  PV-NULL-IND-12 =  -1                             08776742
087768                 SET PS-TRIP-ID-NULL TO  TRUE                     08776842
087769             END-IF                                               08776942
087770                                                                  08777026
087800             ADD  1                 TO PV-TVHTRIP-READ            08780033
087801             MOVE  DK-SHIPT-ID      TO PV-DISP-SHIPT-ID           08780112
087802             MOVE  DK-TRIP-ID       TO PV-DISP-TRIP-ID            08780212
087803             MOVE  DK-TSHPTPO-COUNT TO PV-DISP-TSHPTPO-CNT        08780312
087804             MOVE  DK-CURR-TRIP-ID  TO PV-DISP-CURR-TRIP          08780412
087805                                                                  08780512
087820             DISPLAY ' SHIPT-ID:'     PV-DISP-SHIPT-ID            08782013
087830                     '  LAST UPD:'    DK-SHIPMT-LAST-UPD-DTE      08783012
087840                     '  EST AR:'      DK-SHIPMT-EST-AR-TMST       08784012
087850             DISPLAY ' TRIP-ID:'     PV-DISP-TRIP-ID              08785012
087860                     '  TSHPTPO-CNT:' PV-DISP-TSHPTPO-CNT         08786012
087870                     '  LAST UPD:'    DK-TRIP-LAST-UPD-DTE        08787012
087880                     ' @ '            DK-TRIP-LAST-UPD-TME        08788012
087890             DISPLAY ' TRIP ST:'      DK-TRIP-STATUS-CDE          08789012
087891                     '  EST AR:'      DK-TRIP-EST-AR-TMST         08789112
087892                     '  ST DTE:'      DK-STATUS-DTE               08789212
087893                     ' @ '            DK-STATUS-TME               08789312
087894             DISPLAY ' SCAC/TRLR: '   DK-OWNER-SCAC-ID            08789412
087895                     '/'              DK-VEH-NBR                  08789512
087896                     '  CURR TRIP:'   PV-DISP-CURR-TRIP           08789612
087900         WHEN SQLCODE = +100                                      08790000
088000             SET PS-END-OF-OLD-TSHIPMT-CSR                        08800001
088100                                 TO TRUE                          08810000
088700         WHEN OTHER                                               08870026
088810             MOVE SQLCODE TO PV-DISP-SQLCODE                      08881025
088820             DISPLAY ' '                                          08882041
088900             DISPLAY '** ABEND - TRKUP009 **'                     08890000
089000             DISPLAY '** 4100-FETCH-OLD-SHIPMT-CSR '              08900006
089100             DISPLAY '** FETCH WARNING ON TVHTRIP/TSHIPMTP JOIN'  08910000
089101             DISPLAY '** SQLCODE: ' PV-DISP-SQLCODE               08910125
089103             DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID              08910329
089104             DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID             08910429
089105             DISPLAY '** VEHICLE: '  DK-VEH-NBR                   08910529
089200             PERFORM 9200-SQL-WARNING                             08920000
089300     END-EVALUATE.                                                08930000
089400                                                                  08940000
089500******************************************************************08950000
089600* 4200-CLOSE-OLD-TSHIPMT-CSR - CLOSES CURSOR                     *08960001
089700******************************************************************08970000
089800                                                                  08980000
089900 4200-CLOSE-OLD-TSHIPMT-CSR.                                      08990001
089910                                                                  08991002
089920*    DISPLAY ' 4200-CLOSE-OLD-TSHIPMT-CSR          '.             08992030
090000                                                                  09000000
090100     EXEC SQL                                                     09010000
090200         CLOSE OLD-TSHIPMT-CSR                                    09020001
090300     END-EXEC.                                                    09030000
090400                                                                  09040000
090500     EVALUATE TRUE                                                09050000
090600         WHEN SQLCODE < ZERO                                      09060000
090610             DISPLAY ' '                                          09061041
090700             DISPLAY '** ABEND - TRKUP009 **'                     09070000
090800             DISPLAY '** 4200-CLOSE-OLD-TSHIPMT-CSR'              09080001
090900             DISPLAY '** CLOSE ERROR ON TVHTRIP/TSHIPMT JOIN'     09090000
090910             DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID              09091029
090920             DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID             09092029
091000             PERFORM 9000-SQL-ERROR                               09100000
091100         WHEN SQLCODE > ZERO                                      09110000
091200         WHEN SQLWARN0 NOT = SPACES                               09120000
091210             DISPLAY ' '                                          09121041
091300             DISPLAY '** ABEND - TRKUP009 **'                     09130000
091400             DISPLAY '** 4200-CLOSE-OLD-TSHIPMT-CSR'              09140001
091500             DISPLAY '** CLOSE ERROR ON TVHTRIP/TSHIPMT JOIN'     09150000
091510             DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID              09151029
091520             DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID             09152029
091600             PERFORM 9200-SQL-WARNING                             09160000
091700         WHEN OTHER                                               09170000
091800             CONTINUE                                             09180000
091900     END-EVALUATE.                                                09190000
092000                                                                  09200000
092001                                                                  09200144
092010******************************************************************09201044
092020* 4300-OPEN-OLD-VEHICL-CSR - OPEN THE CURSOR USED TO SELECT ALL  *09202044
092030* OLD TVHTRIPS THAT NEED TO BE DELETED.                          *09203044
092040******************************************************************09204044
092050                                                                  09205044
092060 4300-OPEN-OLD-TVHTRIP-CSR.                                       09206044
092070                                                                  09207044
092080*    DISPLAY ' 4300-OPEN-OLD-TVHTRIP-CSR           '.             09208044
092090                                                                  09209044
092091     EXEC SQL                                                     09209144
092092         OPEN OLD-TVHTRIP-CSR                                     09209244
092093     END-EXEC.                                                    09209344
092094                                                                  09209444
092095     EVALUATE TRUE                                                09209544
092096         WHEN SQLCODE < ZERO                                      09209644
092097             DISPLAY ' '                                          09209744
092098             DISPLAY '** ABEND - TRKUP009 **'                     09209844
092099             DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID              09209944
092100             DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID             09210044
092101             DISPLAY '** VEHICLE: '  DK-VEH-NBR                   09210144
092102             DISPLAY '** 4300-OPEN-OLD-TVHTRIP-CSR'               09210244
092103             DISPLAY '** OPEN ERROR ON TVHTRIP'                   09210344
092104             PERFORM 9000-SQL-ERROR                               09210444
092105         WHEN ((SQLCODE > ZERO) AND (SQLCODE NOT = +100))         09210544
092106         WHEN SQLWARN0 NOT = SPACES                               09210644
092107             DISPLAY ' '                                          09210744
092108             DISPLAY '** ABEND - TRKUP009 **'                     09210844
092109             DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID              09210944
092110             DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID             09211044
092111             DISPLAY '** VEHICLE: '  DK-VEH-NBR                   09211144
092112             DISPLAY '** 4300-OPEN-OLD-TVHTRIP-CSR'               09211244
092113             DISPLAY '** OPEN WARNING ON TVHTRIP'                 09211344
092114             PERFORM 9200-SQL-WARNING                             09211444
092115         WHEN OTHER                                               09211544
092116             CONTINUE                                             09211644
092117     END-EVALUATE.                                                09211744
092118                                                                  09211844
092119                                                                  09211944
092120******************************************************************09212044
092121* 4400-FETCH-OLD-TVHTRIP-CSR                                     *09212144
092122*  FETCH A TRIPS WITH NULL VEHICL NUMBER OLDER THAN THE CONTROL  *09212244
092123*  DATE.                                                         *09212344
092124******************************************************************09212444
092125                                                                  09212544
092126 4400-FETCH-OLD-TVHTRIP-CSR.                                      09212648
092127                                                                  09212744
092128*    DISPLAY ' 4400-FETCH-OLD-TVHTRIP-CSR          '.             09212844
092129                                                                  09212944
092130     DISPLAY ' '.                                                 09213047
092131                                                                  09213144
092132     SET PS-TRIP-ID-NOT-NULL TO  TRUE.                            09213247
092133                                                                  09213344
092134     EXEC SQL                                                     09213444
092135         FETCH OLD-TVHTRIP-CSR                                    09213544
092136          INTO :DK-TRIP-ID             :PV-NULL-IND-12            09213645
092137             , :DK-TRIP-LAST-UPD-DTE   :PV-NULL-IND-3             09213745
092138             , :DK-TRIP-LAST-UPD-TME   :PV-NULL-IND-4             09213845
092139             , :DK-OWNER-SCAC-ID       :PV-NULL-IND-9             09213945
092140             , :DK-VEH-NBR             :PV-NULL-IND-10            09214045
092141             , :DK-TRIP-STATUS-CDE     :PV-NULL-IND-5             09214145
092142             , :DK-STATUS-DTE          :PV-NULL-IND-7             09214245
092143             , :DK-STATUS-TME          :PV-NULL-IND-8             09214345
092144             , :DK-CURR-TRIP-ID        :PV-NULL-IND-1             09214445
092145                                                                  09214545
092152     END-EXEC.                                                    09215244
092153                                                                  09215344
092154     EVALUATE TRUE                                                09215444
092155         WHEN SQLCODE = 0                                         09215544
092156             IF  PV-NULL-IND-1  =  -1                             09215644
092157                 MOVE ZEROES        TO  DK-CURR-TRIP-ID           09215744
092158             END-IF                                               09215844
092162             IF  PV-NULL-IND-3  =  -1                             09216244
092163                 MOVE SPACES        TO  DK-TRIP-LAST-UPD-DTE      09216344
092164             END-IF                                               09216444
092165             IF  PV-NULL-IND-4  =  -1                             09216544
092166                 MOVE SPACES        TO  DK-TRIP-LAST-UPD-TME      09216644
092167             END-IF                                               09216744
092168             IF  PV-NULL-IND-5  =  -1                             09216844
092169                 MOVE SPACES        TO  DK-TRIP-STATUS-CDE        09216944
092170             END-IF                                               09217044
092174             IF  PV-NULL-IND-7  =  -1                             09217444
092175                 MOVE SPACES        TO  DK-STATUS-DTE             09217544
092176             END-IF                                               09217644
092177             IF  PV-NULL-IND-8  =  -1                             09217744
092178                 MOVE SPACES        TO  DK-STATUS-TME             09217844
092179             END-IF                                               09217944
092180             IF  PV-NULL-IND-9  =  -1                             09218044
092181                 MOVE SPACES        TO  DK-OWNER-SCAC-ID          09218144
092182             END-IF                                               09218244
092183             IF  PV-NULL-IND-10 =  -1                             09218344
092184                 MOVE SPACES        TO  DK-VEH-NBR                09218444
092185             END-IF                                               09218544
092189             IF  PV-NULL-IND-12 =  -1                             09218944
092190                 SET PS-TRIP-ID-NULL TO  TRUE                     09219044
092191             END-IF                                               09219144
092192                                                                  09219244
092193             ADD  1                 TO PV-OLD-TVHTRIP-READ        09219345
092195             MOVE  DK-TRIP-ID       TO PV-DISP-TRIP-ID            09219544
092197             MOVE  DK-CURR-TRIP-ID  TO PV-DISP-CURR-TRIP          09219744
092198                                                                  09219844
092202             DISPLAY ' TRIP-ID:'     PV-DISP-TRIP-ID              09220244
092204                     '  LAST UPD:'    DK-TRIP-LAST-UPD-DTE        09220444
092205                     ' @ '            DK-TRIP-LAST-UPD-TME        09220544
092206             DISPLAY ' TRIP ST:'      DK-TRIP-STATUS-CDE          09220644
092208                     '  ST DTE:'      DK-STATUS-DTE               09220844
092209                     ' @ '            DK-STATUS-TME               09220944
092210             DISPLAY ' SCAC/TRLR: '   DK-OWNER-SCAC-ID            09221044
092211                     '/'              DK-VEH-NBR                  09221144
092212                     '  CURR TRIP:'   PV-DISP-CURR-TRIP           09221244
092213         WHEN SQLCODE = +100                                      09221344
092214             SET PS-END-OF-OLD-TVHTRIP-CSR                        09221444
092215                                 TO TRUE                          09221544
092216         WHEN OTHER                                               09221644
092217             MOVE SQLCODE TO PV-DISP-SQLCODE                      09221744
092218             DISPLAY ' '                                          09221844
092219             DISPLAY '** ABEND - TRKUP009 **'                     09221944
092220             DISPLAY '** 4400-FETCH-OLD-TVHTRIP-CSR'              09222044
092221             DISPLAY '** FETCH WARNING ON TVHTRIP/TTRIPST  JOIN'  09222144
092222             DISPLAY '** SQLCODE: ' PV-DISP-SQLCODE               09222244
092223             DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID              09222344
092225             DISPLAY '** VEHICLE: '  DK-VEH-NBR                   09222544
092226             PERFORM 9200-SQL-WARNING                             09222644
092227     END-EVALUATE.                                                09222744
092228                                                                  09222844
092229                                                                  09222944
092230******************************************************************09223044
092231* 4500-CLOSE-OLD-TVHTRIP-CSR - CLOSES CURSOR                     *09223144
092232******************************************************************09223244
092233                                                                  09223344
092234 4500-CLOSE-OLD-TVHTRIP-CSR.                                      09223444
092235                                                                  09223544
092236*    DISPLAY ' 4500-CLOSE-OLD-TVHTRIP-CSR          '.             09223644
092237                                                                  09223744
092238     EXEC SQL                                                     09223844
092239         CLOSE OLD-TVHTRIP-CSR                                    09223944
092240     END-EXEC.                                                    09224044
092241                                                                  09224144
092242     EVALUATE TRUE                                                09224244
092243         WHEN SQLCODE < ZERO                                      09224344
092244             DISPLAY ' '                                          09224444
092245             DISPLAY '** ABEND - TRKUP009 **'                     09224544
092246             DISPLAY '** 4500-CLOSE-OLD-TSHIPMT-CSR'              09224644
092247             DISPLAY '** CLOSE ERROR ON TVHTRIP/TTRIPST JOIN'     09224744
092248             DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID              09224844
092250             PERFORM 9000-SQL-ERROR                               09225044
092251         WHEN SQLCODE > ZERO                                      09225144
092252         WHEN SQLWARN0 NOT = SPACES                               09225244
092253             DISPLAY ' '                                          09225344
092254             DISPLAY '** ABEND - TRKUP009 **'                     09225444
092255             DISPLAY '** 4500-CLOSE-OLD-TVHTRIP-CSR'              09225544
092256             DISPLAY '** CLOSE ERROR ON TVHTRIP/TTRIPST JOIN'     09225644
092257             DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID              09225744
092259             PERFORM 9200-SQL-WARNING                             09225944
092260         WHEN OTHER                                               09226044
092261             CONTINUE                                             09226144
092262     END-EVALUATE.                                                09226244
092263                                                                  09226344
092264                                                                  09226444
092265******************************************************************09226544
092270* 5000-OPEN-TTRIPSP-CSR - OPEN THE CURSOR USED TO SELECT ALL     *09227000
092300* TRIP STATUS RECORDS FOR A TRIP.                                 09230000
092400******************************************************************09240000
092500                                                                  09250000
092600 5000-OPEN-TSHPTPO-CSR.                                           09260000
092610                                                                  09261002
092620*    DISPLAY ' 5000-OPEN-TSHPTPO-CSR               '.             09262030
092700                                                                  09270000
092800     EXEC SQL                                                     09280000
092900         OPEN TSHPTPO-CSR                                         09290000
093000     END-EXEC.                                                    09300000
093100                                                                  09310000
093200     EVALUATE TRUE                                                09320000
093300         WHEN SQLCODE < ZERO                                      09330000
093301             DISPLAY ' '                                          09330141
093402             DISPLAY '** ABEND - TRKUP009 **'                     09340200
093403             DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID              09340341
093404             DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID             09340441
093500             DISPLAY '** 5000-OPEN-TSHPTPO-CSR'                   09350000
093600             DISPLAY '** OPEN ERROR ON TSHPTPO'                   09360000
093700             PERFORM 9000-SQL-ERROR                               09370000
093800         WHEN ((SQLCODE > ZERO) AND (SQLCODE NOT = +100))         09380000
093900         WHEN SQLWARN0 NOT = SPACES                               09390000
093901             DISPLAY ' '                                          09390141
094002             DISPLAY '** ABEND - TRKUP009 **'                     09400200
094003             DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID              09400341
094004             DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID             09400441
094100             DISPLAY '** 5000-OPEN-TSHPTPO-CSR'                   09410000
094200             DISPLAY '** OPEN WARNING ON TSHPTPO'                 09420000
094300             PERFORM 9200-SQL-WARNING                             09430000
094400         WHEN OTHER                                               09440000
094500             CONTINUE                                             09450000
094600     END-EVALUATE.                                                09460000
094700                                                                  09470000
094800******************************************************************09480000
094900* 5100-FETCH-TSHPTPO-CSR.                                        *09490000
095000*  FETCH A TRIPS WITH NULL VEHICL NUMBER OLDER THAN THE CONTROL  *09500000
095100*  DATE.                                                         *09510000
095200******************************************************************09520000
095300                                                                  09530000
095400 5100-FETCH-TSHPTPO-CSR.                                          09540000
095410                                                                  09541002
095420*    DISPLAY ' 5100-FETCH-TSHPTPO-CSR              '.             09542030
095500                                                                  09550000
095600     INITIALIZE DCLTSHPTPO.                                       09560000
095700                                                                  09570000
095800     EXEC SQL                                                     09580000
095900         FETCH TSHPTPO-CSR                                        09590000
096000          INTO :SHPTPO-SHIPT-ID                                   09600000
096100             , :SHPTPO-PO-NBR                                     09610000
096200             , :SHPTPO-REC-SEQ-NBR                                09620000
096300     END-EXEC.                                                    09630000
096400                                                                  09640000
096500     EVALUATE TRUE                                                09650000
096600         WHEN SQLCODE = 0                                         09660000
096700             ADD 1               TO PV-TSHPTPO-READ               09670033
096800         WHEN SQLCODE = +100                                      09680000
096900             SET PS-END-OF-TSHPTPO-CSR                            09690000
097000                                 TO TRUE                          09700000
097100         WHEN SQLCODE < ZERO                                      09710000
097101             DISPLAY ' '                                          09710141
097202             DISPLAY '** ABEND - TRKUP009 **'                     09720200
097203             DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID              09720341
097204             DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID             09720441
097300             DISPLAY '** 5100-FETCH-TSHPTPO-CSR'                  09730000
097400             DISPLAY '** FETCH ERROR ON TSHPTPO'                  09740000
097500             PERFORM 9000-SQL-ERROR                               09750000
097600         WHEN SQLCODE > ZERO                                      09760000
097700         WHEN SQLWARN0 NOT = SPACES                               09770000
097701             DISPLAY ' '                                          09770141
097802             DISPLAY '** ABEND - TRKUP009 **'                     09780200
097803             DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID              09780341
097804             DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID             09780441
097900             DISPLAY '** 5100-FETCH-TSHPTPO-CSR'                  09790000
098000             DISPLAY '** FETCH WARNING ON TSHPTPO'                09800000
098100             PERFORM 9200-SQL-WARNING                             09810000
098200     END-EVALUATE.                                                09820000
098300                                                                  09830000
098400******************************************************************09840000
098500* 5200-CLOSE-TSHPTPO-CSR - CLOSES THE CURSOR                     *09850000
098600******************************************************************09860000
098700                                                                  09870000
098800 5200-CLOSE-TSHPTPO-CSR.                                          09880000
098810                                                                  09881002
098820*    DISPLAY ' 5200-CLOSE-TSHPTPO-CSR              '.             09882030
098900                                                                  09890000
099000     EXEC SQL                                                     09900000
099100         CLOSE TSHPTPO-CSR                                        09910000
099200     END-EXEC.                                                    09920000
099300                                                                  09930000
099400     EVALUATE TRUE                                                09940000
099500         WHEN SQLCODE < ZERO                                      09950000
099501             DISPLAY ' '                                          09950141
099602             DISPLAY '** ABEND - TRKUP009 **'                     09960200
099603             DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID              09960341
099604             DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID             09960441
099700             DISPLAY '** 5200-CLOSE-TSHPTPO-CSR'                  09970000
099800             DISPLAY '** CLOSE ERROR ON TSHPTPO'                  09980000
099900             PERFORM 9000-SQL-ERROR                               09990000
100000         WHEN SQLCODE > ZERO                                      10000000
100100         WHEN SQLWARN0 NOT = SPACES                               10010000
100101             DISPLAY ' '                                          10010141
100202             DISPLAY '** ABEND - TRKUP009 **'                     10020200
100203             DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID              10020341
100204             DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID             10020441
100300             DISPLAY '** 5200-CLOSE-TSHPTPO-CSR'                  10030000
100400             DISPLAY '** CLOSE ERROR ON TSHPTPO'                  10040000
100500             PERFORM 9200-SQL-WARNING                             10050000
100600         WHEN OTHER                                               10060000
100700             CONTINUE                                             10070000
100800     END-EVALUATE.                                                10080000
100900                                                                  10090000
110200******************************************************************11020000
110300* 7600-UPDATE-TVEHICL - RETRIEVE THE TSHIPMT RECORDS WITH A      *11030000
110400* TRIP-ID WHICH MATCHES THE TRIP-ID OF THE TVHTRIP CURSOR.       *11040000
110500******************************************************************11050000
110600*                                                                 11060009
110700 7600-UPDATE-TVEHICL.                                             11070000
110710                                                                  11071002
110720*    DISPLAY ' 7600-UPDATE-TVEHICL                 '.             11072030
110730                                                                  11073002
110800     MOVE ZEROES TO PV-VEHICL-CURR-TRIP-ID.                       11080030
110900     MOVE PC-NEG-1 TO PV-VEHICL-CURR-TRIP-ID-NULL.                11090030
111000                                                                  11100030
111100     EXEC SQL                                                     11110030
111200       UPDATE  TVEHICL                                            11120051
111300          SET  LAST_UPD_DTE      = CURRENT DATE                   11130030
111400              ,LAST_UPD_TME      = CURRENT TIME                   11140030
111500              ,LAST_UPD_UID      = :PC-TRKUP009                   11150030
111600              ,CURR_STATUS_CDE   = :PC-ET                         11160030
111700              ,CURR_STATUS_DTE   = CURRENT DATE                   11170030
111800              ,CURR_STATUS_TME   = CURRENT TIME                   11180030
111900              ,CURR_TRIP_ID      = :PV-VEHICL-CURR-TRIP-ID        11190030
112000                                   :PV-VEHICL-CURR-TRIP-ID-NULL   11200030
112100        WHERE  OWNER_SCAC_ID     = :DK-OWNER-SCAC-ID              11210030
112200          AND  VEH_NBR           = :DK-VEH-NBR                    11220030
112300     END-EXEC.                                                    11230030
112400                                                                  11240030
112500     EVALUATE TRUE                                                11250030
112600         WHEN SQLCODE < ZERO                                      11260030
112610             DISPLAY ' '                                          11261041
112700             DISPLAY '** ABEND - TRKUP009 **'                     11270030
112800             DISPLAY '** 7600-UPDATE-TVEHICL'                     11280030
112900             DISPLAY '** UPDATE ERROR ON TVEHICL'                 11290030
113000             DISPLAY '** SCAC:    '  DK-OWNER-SCAC-ID             11300030
113010             DISPLAY '** VEHICLE: '  DK-VEH-NBR                   11301030
113120             DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID              11312030
113130             DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID             11313030
113200             PERFORM 9000-SQL-ERROR                               11320030
113300         WHEN SQLCODE > ZERO                                      11330030
113400         WHEN SQLWARN0 NOT = SPACES                               11340030
113410             DISPLAY ' '                                          11341041
113500             DISPLAY '** ABEND - TRKUP009 **'                     11350030
113600             DISPLAY '** 7600-UPDATE-TVEHICL'                     11360030
113700             DISPLAY '** UPDATE WARNING ON TVEHICL'               11370030
113701             DISPLAY '** SCAC:    '  DK-OWNER-SCAC-ID             11370130
113702             DISPLAY '** VEHICLE: '  DK-VEH-NBR                   11370230
113704             DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID              11370430
113705             DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID             11370530
113800             PERFORM 9200-SQL-WARNING                             11380030
113900         WHEN OTHER                                               11390030
114000             ADD 1    TO PV-TVEHICL-UPDATED                       11400033
114100             PERFORM 7650-INSERT-TAUVHCL                          11410030
114200     END-EVALUATE.                                                11420030
114300                                                                  11430000
114310                                                                  11431009
114400******************************************************************11440000
114500* 7650-INSERT-TAUVHCL INSERTS THE UPDATED TVEHICL ROW TO THE AUDIT11450000
114600*      TABLE.                                                     11460000
114700******************************************************************11470000
114800                                                                  11480030
114900 7650-INSERT-TAUVHCL.                                             11490000
114910                                                                  11491002
114920*    DISPLAY ' 7650-INSERT-TAUVHCL                 '.             11492030
115000                                                                  11500000
115100     EXEC SQL                                                     11510030
115200        SELECT   OWNER_SCAC_ID                                    11520030
115300               , VEH_NBR                                          11530030
115400               , CRT_SRC_CDE                                      11540030
115500               , LAST_UPD_DTE                                     11550030
115600               , LAST_UPD_TME                                     11560030
115700               , LAST_UPD_UID                                     11570030
115800               , USAGE_CDE                                        11580030
115900               , VEH_TYP_CDE                                      11590030
116000               , CURR_STATUS_CDE                                  11600030
116100               , CURR_STATUS_DTE                                  11610030
116200               , CURR_STATUS_TME                                  11620030
116300               , CURR_OPER_UNT_ID                                 11630030
116400               , CURR_FCLTY_ID                                    11640030
116500               , CURR_FAC_AREA_ID                                 11650030
116600               , CURR_LOC_DTE                                     11660030
116700               , CURR_LOC_TME                                     11670030
116800               , CURR_TRIP_ID                                     11680030
116900               , VEH_SIZE_CDE                                     11690030
117000          INTO   :AUVHCL-OWNER-SCAC-ID                            11700030
117100               , :AUVHCL-VEH-NBR                                  11710030
117200               , :AUVHCL-CRT-SRC-CDE                              11720030
117300               , :AUVHCL-LAST-UPD-DTE                             11730030
117400               , :AUVHCL-LAST-UPD-TME                             11740030
117500               , :AUVHCL-LAST-UPD-UID                             11750030
117600               , :AUVHCL-USAGE-CDE                                11760030
117700               , :AUVHCL-VEH-TYP-CDE                              11770030
117800               , :AUVHCL-CURR-STATUS-CDE                          11780030
117900               , :AUVHCL-CURR-STATUS-DTE                          11790030
118000               , :AUVHCL-CURR-STATUS-TME                          11800030
118100               , :AUVHCL-CURR-OPER-UNT-ID                         11810030
118200               , :AUVHCL-CURR-FCLTY-ID                            11820030
118300               , :AUVHCL-CURR-FAC-AREA-ID                         11830030
118400               , :AUVHCL-CURR-LOC-DTE                             11840030
118500               , :AUVHCL-CURR-LOC-TME                             11850030
118600               , :AUVHCL-CURR-TRIP-ID                             11860030
118700                             :PV-AUVHCL-CURR-TRIP-ID-NULL         11870030
118800               , :AUVHCL-VEH-SIZE-CDE                             11880030
118900        FROM   TVEHICL                                            11890051
119000        WHERE  OWNER_SCAC_ID     = :DK-OWNER-SCAC-ID              11900030
119100          AND  VEH_NBR           = :DK-VEH-NBR                    11910030
119200     END-EXEC.                                                    11920030
119300                                                                  11930030
119400     EVALUATE TRUE                                                11940030
119500         WHEN SQLCODE < ZERO                                      11950030
119510             DISPLAY ' '                                          11951041
119600             DISPLAY '** ABEND - TRKUP009 **'                     11960030
119700             DISPLAY '** 7650-SELECT-TVEHICL'                     11970030
119800             DISPLAY '** SELECT ERROR ON TVEHICL'                 11980030
119900             DISPLAY '** SCAC:    '  DK-OWNER-SCAC-ID             11990030
120000             DISPLAY '** VEHICLE: '  DK-VEH-NBR                   12000030
120120             DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID              12012030
120130             DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID             12013030
120200             PERFORM 9000-SQL-ERROR                               12020030
120300         WHEN SQLCODE > ZERO                                      12030030
120400         WHEN SQLWARN0 NOT = SPACES                               12040030
120410             DISPLAY ' '                                          12041041
120500             DISPLAY '** ABEND - TRKUP009 **'                     12050030
120600             DISPLAY '** 7650-SELECT-TVEHICL'                     12060030
120700             DISPLAY '** SELECT WARNING ON TVEHICL'               12070030
120701             DISPLAY '** SELECT ERROR ON TVEHICL'                 12070130
120702             DISPLAY '** SCAC:    '  DK-OWNER-SCAC-ID             12070230
120703             DISPLAY '** VEHICLE: '  DK-VEH-NBR                   12070330
120706             DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID              12070630
120707             DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID             12070730
120800             PERFORM 9200-SQL-WARNING                             12080030
120900         WHEN OTHER                                               12090030
121000             SET INSERT-TO-AUDIT TO TRUE                          12100030
121100             IF PV-AUVHCL-CURR-TRIP-ID-NULL = PC-NEG-1            12110030
121200                MOVE ZEROS    TO  AUVHCL-CURR-TRIP-ID             12120030
121300             END-IF                                               12130030
121400     END-EVALUATE.                                                12140030
121500                                                                  12150030
121600     IF INSERT-TO-AUDIT                                           12160030
121700        SET NO-INSERT TO TRUE                                     12170030
121800        EXEC SQL                                                  12180030
121900           INSERT INTO TAUVHCL                                    12190030
122000               ( OWNER_SCAC_ID                                    12200030
122100               , VEH_NBR                                          12210030
122200               , CRT_SRC_CDE                                      12220030
122300               , LAST_UPD_DTE                                     12230030
122400               , LAST_UPD_TME                                     12240030
122500               , LAST_UPD_UID                                     12250030
122600               , USAGE_CDE                                        12260030
122700               , VEH_TYP_CDE                                      12270030
122800               , CURR_STATUS_CDE                                  12280030
122900               , CURR_STATUS_DTE                                  12290030
123000               , CURR_STATUS_TME                                  12300030
123100               , CURR_OPER_UNT_ID                                 12310030
123200               , CURR_FCLTY_ID                                    12320030
123300               , CURR_FAC_AREA_ID                                 12330030
123400               , CURR_LOC_DTE                                     12340030
123500               , CURR_LOC_TME                                     12350030
123600               , CURR_TRIP_ID                                     12360030
123700               , VEH_SIZE_CDE)                                    12370030
123800           VALUES                                                 12380030
123900                (:AUVHCL-OWNER-SCAC-ID                            12390030
124000               , :AUVHCL-VEH-NBR                                  12400030
124100               , :AUVHCL-CRT-SRC-CDE                              12410030
124200               , :AUVHCL-LAST-UPD-DTE                             12420030
124300               , :AUVHCL-LAST-UPD-TME                             12430030
124400               , :AUVHCL-LAST-UPD-UID                             12440030
124500               , :AUVHCL-USAGE-CDE                                12450030
124600               , :AUVHCL-VEH-TYP-CDE                              12460030
124700               , :AUVHCL-CURR-STATUS-CDE                          12470030
124800               , :AUVHCL-CURR-STATUS-DTE                          12480030
124900               , :AUVHCL-CURR-STATUS-TME                          12490030
125000               , :AUVHCL-CURR-OPER-UNT-ID                         12500030
125100               , :AUVHCL-CURR-FCLTY-ID                            12510030
125200               , :AUVHCL-CURR-FAC-AREA-ID                         12520030
125300               , :AUVHCL-CURR-LOC-DTE                             12530030
125400               , :AUVHCL-CURR-LOC-TME                             12540030
125500               , :AUVHCL-CURR-TRIP-ID                             12550030
125600                        :PV-AUVHCL-CURR-TRIP-ID-NULL              12560030
125700               , :AUVHCL-VEH-SIZE-CDE)                            12570030
125800        END-EXEC                                                  12580030
125900        EVALUATE TRUE                                             12590030
126000            WHEN SQLCODE < ZERO                                   12600030
126010                DISPLAY ' '                                       12601041
126100                DISPLAY '** ABEND - TRKUP009 **'                  12610030
126200                DISPLAY '** 7650-INSERT-TAUVHCL'                  12620030
126300                DISPLAY '** INSERT ERROR ON TAUVHCL'              12630030
126301                DISPLAY '** SCAC:    '  DK-OWNER-SCAC-ID          12630130
126302                DISPLAY '** VEHICLE: '  DK-VEH-NBR                12630230
126305                DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID           12630530
126306                DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID          12630630
126400                PERFORM 9000-SQL-ERROR                            12640030
126500            WHEN SQLCODE > ZERO                                   12650030
126600            WHEN SQLWARN0 NOT = SPACES                            12660030
126610                DISPLAY ' '                                       12661041
126700                DISPLAY '** ABEND - TRKUP009 **'                  12670030
126800                DISPLAY '** 7650-INSERT-TAUVHCL'                  12680030
126900                DISPLAY '** INSERT WARNING ON TAUVHCL'            12690030
126901                DISPLAY '** SCAC:    '  DK-OWNER-SCAC-ID          12690130
126902                DISPLAY '** VEHICLE: '  DK-VEH-NBR                12690230
126904                DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID           12690430
126905                DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID          12690530
127000                PERFORM 9200-SQL-WARNING                          12700030
127100            WHEN OTHER                                            12710030
127200                ADD 1    TO PV-TAUVHCL-INSERTED                   12720033
127300        END-EVALUATE                                              12730030
127400     ELSE                                                         12740030
127500        CONTINUE                                                  12750030
127600     END-IF.                                                      12760030
127700                                                                  12770000
127800******************************************************************12780000
127900* 8000-COMMIT - PERFORMS A COMMIT ON ALL ROWS DELETED SO FAR      12790000
128000******************************************************************12800000
128100                                                                  12810030
128200 8000-COMMIT.                                                     12820000
128201                                                                  12820102
128210*    DISPLAY ' 8000-COMMIT                         '.             12821035
128300                                                                  12830000
128400     EXEC SQL                                                     12840030
128500         COMMIT                                                   12850030
128600     END-EXEC.                                                    12860030
128700                                                                  12870030
128800     EVALUATE TRUE                                                12880030
128900         WHEN SQLCODE = 0                                         12890030
129002             DISPLAY '** SCAC/TRLR:  ' DK-OWNER-SCAC-ID           12900235
129003                     '/'               DK-VEH-NBR                 12900335
129006             DISPLAY '** TRIP/SHIPT: ' PV-DISP-TRIP-ID            12900635
129007                     '/'               PV-DISP-SHIPT-ID           12900737
129100         WHEN SQLCODE < 0                                         12910030
129110             DISPLAY ' '                                          12911041
129200             DISPLAY '** ABEND - TRKUP009 **'                     12920030
129300             DISPLAY '** 8000-COMMIT'                             12930030
129400             DISPLAY '** COMMIT ERROR '                           12940030
129402             DISPLAY '** SCAC:    '  DK-OWNER-SCAC-ID             12940230
129403             DISPLAY '** VEHICLE: '  DK-VEH-NBR                   12940330
129405             DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID              12940530
129406             DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID             12940630
129500             PERFORM 9000-SQL-ERROR                               12950030
129600         WHEN SQLCODE > 0                                         12960030
129700         WHEN SQLWARN0 = 'W'                                      12970030
129710             DISPLAY ' '                                          12971041
129800             DISPLAY '** ABEND - TRKUP009 **'                     12980030
129900             DISPLAY '** 8000-COMMIT'                             12990030
130000             DISPLAY '** COMMIT WARNING'                          13000030
130002             DISPLAY '** SCAC:    '  DK-OWNER-SCAC-ID             13000230
130003             DISPLAY '** VEHICLE: '  DK-VEH-NBR                   13000330
130005             DISPLAY '** TRIP-ID: '  PV-DISP-TRIP-ID              13000530
130006             DISPLAY '** SHIPT-ID:'  PV-DISP-SHIPT-ID             13000630
130100             PERFORM 9200-SQL-WARNING                             13010030
130200     END-EVALUATE.                                                13020030
130300                                                                  13030000
130600                                                                  13060009
133800******************************************************************13380000
133900* 9000-SQL-ERROR - PERFORMS THE ABEND FOR THE PROGRAM IN THE      13390000
134000* EVENT THAT AN SQL ERROR CODE OCCURS.                            13400000
134100******************************************************************13410000
134200 9000-SQL-ERROR.                                                  13420000
134210                                                                  13421030
134220*    DISPLAY ' 9000-SQL-ERROR                      '.             13422030
134300                                                                  13430000
134400     MOVE SQLCODE                TO SQLCODE2.                     13440030
134500     MOVE SQLERRD(3)             TO SQLERRD3.                     13450030
134600                                                                  13460030
134700     DISPLAY '** ABEND **         ** = SQLERROR'.                 13470030
134800     DISPLAY '** PROGRAM          ** = TRKUP009'.                 13480030
134900     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                13490030
135000     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                13500030
135100     DISPLAY '** SQLERRM          ** = ' SQLERRM.                 13510030
135200     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                13520030
135300                                                                  13530030
135400     EXEC SQL                                                     13540030
135500         ROLLBACK                                                 13550030
135600     END-EXEC.                                                    13560030
135700                                                                  13570030
135701     PERFORM 9500-EOJ-ROUTINE.                                    13570130
135702                                                                  13570230
135800     MOVE +4013                  TO ABEND-CODE.                   13580030
135900     CALL 'ILBOABN0' USING ABEND-CODE.                            13590030
136000                                                                  13600000
136100******************************************************************13610000
136200* 9200-SQL-WARNING - PERFORMS THE ABEND FOR THE PROGRAM IN THE    13620000
136300* EVENT THAT AN SQL WARNING CODE OCCURS.                          13630000
136400******************************************************************13640000
136500 9200-SQL-WARNING.                                                13650000
136510                                                                  13651030
136520*    DISPLAY ' 9200-SQL-WARNING                    '.             13652030
136600                                                                  13660000
136700     DISPLAY '9200-SQL-WARNING'.                                  13670000
136800     MOVE SQLCODE                TO SQLCODE2.                     13680000
136900     MOVE SQLERRD(3)             TO SQLERRD3.                     13690000
137000     DISPLAY '** ABEND **       ** = SQLWARNING'.                 13700000
137100     DISPLAY '** PROGRAM        ** = TRKUP009'.                   13710000
137200     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  13720000
137300     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  13730000
137400     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                  13740000
137500     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                  13750000
137600     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                  13760000
137700     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                  13770000
137800     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                  13780000
137900     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                  13790000
138000     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                  13800000
138100     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                  13810000
138200                                                                  13820000
138300     EXEC SQL                                                     13830030
138400         ROLLBACK                                                 13840030
138500     END-EXEC.                                                    13850030
138501                                                                  13850100
138502     PERFORM 9500-EOJ-ROUTINE.                                    13850200
138600                                                                  13860000
138700     MOVE +4013                  TO ABEND-CODE.                   13870000
138800     CALL 'ILBOABN0' USING ABEND-CODE.                            13880000
138801                                                                  13880100
138802******************************************************************13880200
138803* 9500-EOJ-ROUTINE - CLOSES CURSOR AND WRITES JOB STATISTICS.     13880300
138804******************************************************************13880400
138805 9500-EOJ-ROUTINE.                                                13880500
138806                                                                  13880602
138807*    DISPLAY ' 9500-EOJ-ROUTINE                    '.             13880730
138808                                                                  13880800
138809     MOVE PV-TVHTRIP-READ        TO DL1-TOT-TVHTRIP-READ.         13880900
138810     MOVE PV-TVHTRIP-DELETED     TO DL2-TOT-TVHTRIP-DEL.          13881000
138811     MOVE PV-TSHPTPO-READ        TO DL3-TOT-TSHPTPO-READ.         13881100
138812     MOVE PV-TSHPTPO-DELETED     TO DL4-TOT-TSHPTPO-DEL.          13881200
138813     MOVE PV-TSHIPMT-READ        TO DL5-TOT-TSHIPMT-READ.         13881300
138814     MOVE PV-TSHIPMT-DELETED     TO DL6-TOT-TSHIPMT-DEL.          13881400
138815     MOVE PV-TSHIPMT-TSHIPST-DELETED                              13881536
138816                                 TO DL7-TOT-TSHIPST-DEL.          13881636
138817     MOVE PV-TVEHICL-READ        TO DL9-TOT-TVEHICL-READ.         13881700
138818     MOVE PV-TVEHICL-UPDATED     TO DL10-TOT-TVEHICL-UPD.         13881800
138820     MOVE PV-TAUVHCL-INSERTED    TO DL10-TOT-TAUVHCL-INSERT.      13882000
138821     MOVE PV-OLD-TVHTRIP-READ    TO DL13-TOT-OLD-TVHTRIP.         13882146
138822                                                                  13882246
138823     DISPLAY ' '.                                                 13882346
138824     DISPLAY '**************************************'             13882446
138825     DISPLAY DL1-DETAIL-LINE-1.                                   13882546
138826     DISPLAY DL2-DETAIL-LINE-2.                                   13882646
138827     DISPLAY DL3-DETAIL-LINE-3.                                   13882746
138828     DISPLAY DL4-DETAIL-LINE-4.                                   13882846
138829     DISPLAY DL5-DETAIL-LINE-5.                                   13882946
138830     DISPLAY DL6-DETAIL-LINE-6.                                   13883046
138831     DISPLAY DL7-DETAIL-LINE-7.                                   13883146
138832     DISPLAY DL9-DETAIL-LINE-9.                                   13883246
138833     DISPLAY DL10-DETAIL-LINE-10.                                 13883346
138834     DISPLAY DL10-DETAIL-LINE-12.                                 13883446
138835     DISPLAY DL11-DETAIL-LINE-11.                                 13883546
138836     DISPLAY DL13-DETAIL-LINE-13.                                 13883646
138837     DISPLAY '**************************************'.            13883746
138838                                                                  13883846
