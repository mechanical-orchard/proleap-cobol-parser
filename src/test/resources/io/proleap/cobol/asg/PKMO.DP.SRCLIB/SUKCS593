000100 TITLE 'AUDITED CARTON ERROR INFORMATION SULCNINF'.               00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300 PROGRAM-ID.    SUKCS593.                                         00030000
000400 AUTHOR.        DENNIS STEFFEN.                                   00040000
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
000600 DATE-WRITTEN.  SPRING, 2002.                                     00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900*       GIVEN:  AUDIT CONTROL NUMBER                              00090000
001000*               CARTON ID                                         00100000
001100*               UPC NUMBER                                        00110000
001200*     RESULTS:  A LIST OF ALL EXCEPTIONS IN THE FOLLOWING ORDER   00120000
001300*                                                                 00130000
001400*       1 - OVERAGES OR SHORTAGES                                 00140000
001500*           (PARA 4110-OVER-SHORT AND 4120-SHOW-OVER-SHORT)       00150000
001600*       2 - CARTON ERRORS ("PO ON DIFF CART", "STR DIFF ON CART"  00160000
001700*       3 - ITEM RELATED ERRORS SUCH AS STYLE, TICKETING, LABELING00170000
001800*           COLOR, OR SIZE                                        00180000
001900*                                                                 00190000
263968*---------------------------------------------------------------* 00191012
263968* CHANGED 11/15/2021    BY JIM HUNTER      WR: CHG0263968         00192012
263968* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00193012
263968* MAKING THE CALL DYNAMIC VS STATIC.                              00194012
001130*                                                                 00194113
001110* CHANGED 01/09/2023    BY JEAN KURK       WR: CHG0278099         00194213
001120* CHANGE CALL OF DPKCS030 TO BE DYNAMIC                           00194313
263968*---------------------------------------------------------------* 00195012
002000/                                                                 00200000
002100 ENVIRONMENT DIVISION.                                            00210000
002200                                                                  00220000
002300 DATA DIVISION.                                                   00230000
002400                                                                  00240000
002500 WORKING-STORAGE SECTION.                                         00250000
002600                                                                  00260000
002700 01  DK-DB2-KEYS.                                                 00270000
002800     05  DK-OPER-UNIT                   PIC S9(04)  COMP VALUE +0.00280000
002900     05  DK-DEPT-NBR                    PIC  X(03).               00290000
003000     05  DK-ENT-ID                      PIC S9(09)  COMP.         00300000
003100     05  DK-AUDIT-NBR                   PIC S9(09)  COMP.         00310000
003110     05  DK-INTR-UPC                    PIC S9(09)  COMP.         00311000
003200     05  DK-UPC-NBR                     PIC S9(15)V COMP-3.       00320000
003300     05  DK-SHIPT-UNIT-ID               PIC S9(18)V COMP-3.       00330000
003400                                                                  00340000
003500 01  PC-PROGRAM-CONSTANTS.                                        00350000
003600     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00360000
003700                                                    'SU593A  '.   00370000
003800     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00380000
003900                                                    'SUKM593 '.   00390000
004000     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00400000
004100                                                    'SUKCS593'.   00410000
004200     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00420000
004300     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00430000
004400     05  PC-INTER-APPL-CODES.                                     00440000
004500         10  PC-INTER-APPL-CRIT-SPEC                              00450000
004600                                  PIC  X(01)  VALUE '1'.          00460000
004700         10  PC-INTER-APPL-LIST   PIC  X(01)  VALUE '2'.          00470000
004800     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +10     00480000
004900                                                    COMP SYNC.    00490000
005000     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00500000
005100                                                    COMP SYNC.    00510000
005200     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00520000
005300                                                    +1000000      00530000
005400                                                    COMP-3.       00540000
005500     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00550000
005600                                                    COMP SYNC.    00560000
005700     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00570000
005800                                                    COMP-3.       00580000
005900     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00590000
006000     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00600000
006100     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00610000
006200     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00620000
006300     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00630000
006400     05  PC-01                          PIC  X(02)  VALUE '01'.   00640000
006500     05  PC-DC                     PIC  X(02)  VALUE  'DC'.       00650000
006600     05  PC-N                      PIC  X(01)  VALUE  'N'.        00660000
006700     05  PC-MAX-DATE               PIC  X(10)  VALUE '9999-09-09'.00670000
006800     05  PC-MULT-ERRORS            PIC  X(15)  VALUE              00680000
006900                                    'MULTIPLE ERRORS'.            00690000
007000     05  PC-NO-ERRORS              PIC  X(15)  VALUE              00700000
007100                                    'NO ERRORS      '.            00710000
007200     05  PC-PASS                   PIC  X(10)  VALUE              00720000
007300                                    'PASS      '.                 00730000
007400     05  PC-FAIL                   PIC  X(10)  VALUE              00740000
007500                                    'FAIL      '.                 00750000
007600     05  PC-IN-PROCESS             PIC  X(10)  VALUE              00760000
007700                                    'IN PROCESS'.                 00770000
007800     05  PC-PROMPT                 PIC  X(10)  VALUE              00780000
007900                                    'PROMPT    '.                 00790000
008000     05  PC-NOT-NEEDED             PIC  X(10)  VALUE              00800000
008100                                    'NOT NEEDED'.                 00810000
008200     05  PC-ALL                    PIC  X(10)  VALUE              00820000
008300                                    'ALL       '.                 00830000
008400     05  PC-MANUAL                 PIC  X(06)  VALUE 'MANUAL'.    00840000
008500     05  PC-SYSTEM                 PIC  X(06)  VALUE 'SYSTEM'.    00850000
008600*                                                                 00860000
008700******************************************************************00870000
008800*   SYSTEM MESSAGES                                              *00880000
008900******************************************************************00890000
009000* 00005 - INVALID VALUE                                          *00900000
009100* 00008 - MUST BE NUMERIC                                        *00910000
009200* 00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED    *00920000
009300* 00051 - NO END OF RANGE HAS BEEN SPECIFIED                     *00930000
009400* 00052 - END OF RANGE PRECEDES START OF RANGE                   *00940000
009500* 00053 - NO START OF RANGE HAS BEEN SPECIFIED                   *00950000
009600* 00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED     *00960000
009700* 00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED       *00970000
009800* 00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION         *00980000
009900* 00069 - TOP OF LIST                                            *00990000
010000* 00070 - BOTTOM OF LIST                                         *01000000
010100* 00101 - VALUE MUST BE GREATER THAN ZERO AND LESS THAN 100,000,0*01010000
010200* 00148 - DATA DOES NOT EXIST                                    *01020000
010300* 00279 - MORE ITEMS TO DISPLAY                                  *01030000
010400* 00302 - DATA ENTERED IN THE 'KEY' FIELD IS INVALID             *01040000
010500* 02844 - YOU DO NOT HAVE THE AUTHORITY TO UPDATE RANK           *01050000
010600* 99901 - INVALID COMMAND WAS ENTERED                            *01060000
010700******************************************************************01070000
010800     05  PC-TSYMSG-NUMBERS.                                       01080000
010900         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01090000
011000         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  01100000
011100         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01110000
011200         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01120000
011300         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01130000
011400         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01140000
011500         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01150000
011600         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01160000
011700         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01170000
011800         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01180000
011900         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01190000
012000         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01200000
012100         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  01210000
012200         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01220000
012300         10  PC-TSYMSG-00302            PIC  9(05)  VALUE 00302.  01230000
012400         10  PC-TSYMSG-02844            PIC  9(05)  VALUE 02844.  01240000
012500         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  01250000
012600*                                                                 01260000
012700 01  PC-EXCEPTIONS.                                               01270000
012800     05  PC-NO-BARCODE                   PIC S9(04)  VALUE +03.   01280000
012900     05  PC-DMGD-BARCODE                 PIC S9(04)  VALUE +04.   01290000
013000     05  PC-NO-UPC                       PIC S9(04)  VALUE +05.   01300000
013100     05  PC-UPC-NOT-FOUND                PIC S9(04)  VALUE +06.   01310000
013200     05  PC-SKU-NOT-FOUND                PIC S9(04)  VALUE +07.   01320000
013300     05  PC-NO-TAG-TICKET                PIC S9(04)  VALUE +08.   01330000
013400     05  PC-STYLE-SUB                    PIC S9(04)  VALUE +09.   01340000
013500     05  PC-UPC-MISDIRECT                PIC S9(04)  VALUE +12.   01350000
013600     05  PC-WRONG-TICKET-DEPT            PIC S9(04)  VALUE +13.   01360000
013700     05  PC-WRONG-TICKET-RETAIL          PIC S9(04)  VALUE +14.   01370000
013800     05  PC-WRONG-TICKET-COLOR           PIC S9(04)  VALUE +15.   01380000
013900     05  PC-WRONG-TICKET-SIZE            PIC S9(04)  VALUE +16.   01390000
014000     05  PC-WRONG-MDSE-LBL-RETAIL        PIC S9(04)  VALUE +17.   01400000
014100     05  PC-WRONG-MDSE-LBL-COLOR         PIC S9(04)  VALUE +18.   01410000
014200     05  PC-WRONG-MDSE-LBL-SIZE          PIC S9(04)  VALUE +19.   01420000
014300     05  PC-WRONG-TICKET-MAJ-CLS         PIC S9(04)  VALUE +21.   01430000
014400     05  PC-WRONG-TICKET-SUB-CLS         PIC S9(04)  VALUE +22.   01440000
014500     05  PC-SIZE-STRIP-MDSE              PIC S9(04)  VALUE +23.   01450000
014600     05  PC-WRONG-TICKET-STYLE           PIC S9(4)   VALUE +24.   01460000
014700     05  PC-WRONG-MDSE-LBL-STYLE         PIC S9(4)   VALUE +25.   01470000
014800     05  PC-WRONG-MDSE-TKT-OK            PIC S9(4)   VALUE +26.   01480000
014900     05  PC-WRONG-TKT-MDSE-OK            PIC S9(4)   VALUE +27.   01490000
015000     05  PC-NO-MDSE-TAG                  PIC S9(4)   VALUE +28.   01500000
015100     05  PC-OVER                         PIC S9(4)   VALUE +29.   01510000
015200     05  PC-SHORT                        PIC S9(4)   VALUE +30.   01520000
      *SB 01/27/14 - BEGIN PR#5148D                                     01521000
           05  PC-WRG-TAGS-NO-EPC              PIC S9(4)   VALUE +38.   01522000
           05  PC-WRG-RFID-TGS-CLR             PIC S9(4)   VALUE +39.   01523000
           05  PC-WRG-RFID-TGS-SIZ             PIC S9(4)   VALUE +40.   01524000
           05  PC-WRG-RFID-TGS-STL             PIC S9(4)   VALUE +41.   01525000
           05  PC-VA-NO-EPC-LOGO               PIC S9(4)   VALUE +42.   01526000
      *SB 01/27/14 - END   PR#5148D                                     01531000
015300                                                                  01532000
015400 01  PS-PROGRAM-SWITCHES.                                         01540000
015500     05  PS-OS-CSR-SW                   PIC  X(01)  VALUE SPACE.  01550000
015600         88  PS-END-OS-CSR                          VALUE 'Y'.    01560000
015700     05  PS-CTN-CSR-SW                  PIC  X(01)  VALUE SPACE.  01570000
015800         88  PS-END-CTN-CSR                         VALUE 'Y'.    01580000
015900     05  PS-UPC-CSR-SW                  PIC  X(01)  VALUE SPACE.  01590000
016000         88  PS-END-UPC-CSR                         VALUE 'Y'.    01600000
016100     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01610000
016200         88  PS-NO-ERROR                            VALUE 'Y'.    01620000
016300         88  PS-ERROR                               VALUE 'N'.    01630000
016400     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01640000
016500         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01650000
016600         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01660000
016700     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01670000
016800         88  PS-DONE                                VALUE 'Y'.    01680000
016900         88  PS-NOT-DONE                            VALUE 'N'.    01690000
017000     05  PS-END-OF-RANKINGS-SW          PIC  X(01)  VALUE 'N'.    01700000
017100         88  PS-END-OF-RANKINGS                     VALUE 'Y'.    01710000
017200         88  PS-NOT-END-OF-RANKINGS                 VALUE 'N'.    01720000
017300     05  PS-ACCESS-SW                   PIC  X(01)  VALUE 'N'.    01730000
017400         88  PS-ACCESS-ALLOWED                      VALUE 'Y'.    01740000
017500         88  PS-ACCESS-NOT-ALLOWED                  VALUE 'N'.    01750000
017600     05  PS-LIST-END-SW                 PIC  X(01)  VALUE  'N'.   01760000
017700         88  PS-LIST-END                            VALUE  'Y'.   01770000
017800         88  PS-NO-LIST-END                         VALUE  'N'.   01780000
017900     05  PS-OVER-SHORT-SW               PIC  X(01)  VALUE  'N'.   01790000
018000         88  PS-OVER                                VALUE  'O'.   01800000
018100         88  PS-SHORT                               VALUE  'S'.   01810000
018200         88  PS-SUB                                 VALUE  'B'.   01820000
      *SB 01/02/14 - BEGIN PR#5148D                                     01820100
           05  PS-RFID-AUDIT-SW               PIC  X(01)  VALUE  'N'.   01821000
               88  PS-RFID-AUDIT                          VALUE  'Y'.   01822000
               88  PS-NO-RFID-AUDIT                       VALUE  'N'.   01823000
           05  PS-SYS-MAN-AUD-SW              PIC  X(01)  VALUE  'S'.   01824000
               88  PS-SYS-AUDIT                           VALUE  'S'.   01825000
               88  PS-MAN-AUDIT                           VALUE  'M'.   01826000
           05  PS-PO-EXCEPTION-SW             PIC  X(01)  VALUE  'N'.   01827000
               88  PS-RFID-PO-EXC                         VALUE  'Y'.   01828000
               88  PS-NO-RFID-PO-EXC                      VALUE  'N'.   01829000
      *SB 01/02/14 - END PR#5148D                                       01829100
018300*                                                                 01830000
018400 01  PV-PROGRAM-VARIABLES.                                        01840000
018500     05  PV-SCANNED-UNIT-QTY            PIC S9(09)  VALUE +0      01850000
018600                                                    COMP.         01860000
      *SB 01/02/14 - BEGIN PR#5148D                                     01860100
           05  PV-RFID-TAGGED-QTY             PIC S9(09)  VALUE +0      01861000
                                                          COMP.         01862000
      *SB 01/02/14 - END PR#5148D                                       01863000
018700     05  PV-CICS-RESPONSE               PIC S9(04)  VALUE +0      01870000
018800                                                    COMP SYNC.    01880000
018900     05  PV-SUB                         PIC S9(04)  VALUE +0      01890000
019000                                                    COMP SYNC.    01900000
019100     05  PV-END-SUB                     PIC S9(04)  VALUE +0      01910000
019200                                                    COMP SYNC.    01920000
019300     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01930000
019400                                                    COMP SYNC.    01940000
019500     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01950000
019600                                                    COMP-3.       01960000
019700     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01970000
019800                                                    COMP-3.       01980000
019900     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01990000
020000                                                    COMP-3.       02000000
020100     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      02010000
020200                                                    COMP-3.       02020000
020300     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      02030000
020400                                                    COMP-3.       02040000
020500     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      02050000
020600                                                    COMP-3.       02060000
020700     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      02070000
020800                                                    COMP-3.       02080000
020900     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      02090000
021000                                                    COMP SYNC.    02100000
021100     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      02110000
021200                                                    COMP SYNC.    02120000
021300     05  PV-ITEM                        PIC S9(04)  VALUE +0      02130000
021400                                                    COMP SYNC.    02140000
021500     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      02150000
021600                                                    COMP SYNC.    02160000
021700     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      02170000
021800                                                    COMP SYNC.    02180000
021900     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      02190000
022000                                                    COMP SYNC.    02200000
022100     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      02210000
022200                                                    COMP SYNC.    02220000
022300     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      02230000
022400                                                    COMP SYNC.    02240000
022500     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02250000
022600                                                    COMP SYNC.    02260000
022700     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02270000
022800                                                    COMP SYNC.    02280000
022900     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      02290000
023000                                                    COMP SYNC.    02300000
023100     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      02310000
023200                                                    COMP SYNC.    02320000
023300     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      02330000
023400                                                    COMP SYNC.    02340000
023500     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      02350000
023600                                                    COMP SYNC.    02360000
023700     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      02370000
023800                                                    COMP SYNC.    02380000
023900     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02390000
024000                                                    COMP SYNC.    02400000
024100     05  PV-PREPACKS-PER-CRTN           PIC S9(04)  VALUE +0      02410000
024200                                                    COMP SYNC.    02420000
024300     05  PV-TSUAUPC-X-RECS              PIC S9(04)  VALUE +0      02430000
024400                                                    COMP SYNC.    02440000
024500     05  PV-TSUAUPC-P-RECS              PIC S9(04)  VALUE +0      02450000
024600                                                    COMP SYNC.    02460000
024700     05  PV-UNION-IND                   PIC  X(02).               02470000
024800     05  PV-VILNCD-FALR-IND             PIC  X(02).               02480000
024900     05  PV-BULK-VND-RNKG-CDE           PIC  X(06).               02490000
025000     05  PV-PREPACK-VND-RNKG-CDE        PIC  X(06).               02500000
025100     05  PV-PBS-VND-RNKG-CDE            PIC  X(06).               02510000
025200     05  PV-COUNT-DEPT-RANKGS           PIC S9(04)  COMP.         02520000
025300                                                                  02530000
025400     05  PV-COUNT                       PIC S9(09)  COMP.         02540000
025400     05  PV-RFID-COUNT                  PIC S9(09)  COMP.         02541000
025500     05  PV-RECEIVED-COUNT              PIC S9(09)  COMP.         02550000
025600     05  PV-ORDERED-COUNT               PIC S9(09)  COMP.         02560000
025700     05  PV-DIFFERENCE                  PIC S9(09)  COMP.         02570000
025800     05  PV-DISP-QTY                    PIC ZZZZZZZ.              02580000
025900     05  PV-DISP-DEC                    PIC ZZ,ZZ9.99.            02590000
026000     05  PV-DISP-PO                     PIC 9(09).                02600000
026100     05  PV-DISP-STR                    PIC 9999.                 02610000
026110     05  PV-DISP-NBR                    PIC 9999.                 02611000
026200     05  PV-DISP-DIFFERENCE             PIC ZZZ,ZZ9.              02620000
026300     05  PV-DISP-ORD-QTY                PIC Z,ZZZ,ZZ9.            02630000
026400     05  PV-DISP-REC-QTY                PIC Z,ZZZ,ZZ9.            02640000
026500     05  PV-ERROR-TYPE                  PIC X(03) VALUE SPACES.   02650000
026600     05  PV-ERROR-DESC                  PIC X(20) VALUE SPACES.   02660000
026700     05  PV-DESC-AREA.                                            02670000
026800         10  PV-DESC OCCURS 20 TIMES    PIC X(01).                02680000
026900     05  PV-ORDER-DESC                  PIC X(20) VALUE SPACES    02690000
027000                                                  JUST RIGHT.     02700000
027100     05  PV-RECVD-DESC                  PIC X(20) VALUE SPACES    02710000
027200                                                  JUST RIGHT.     02720000
027300     05  PV-AUD-OR-ORD                  PIC X(03) VALUE SPACES.   02730000
027400         88  PV-AUDIT-VALUE                   VALUE 'AUD'.        02740000
027500         88  PV-ORDER-VALUE                   VALUE 'EXP'.        02750000
027600                                                                  02760000
027700     05  PV-ENT-ID                      PIC ZZZZZZZZ9.            02770000
027800     05  PV-DEPT-NBR                    PIC ZZ9 BLANK ZERO.       02780000
027900     05  PV-PO-RECEIVER.                                          02790000
028000         10  PV-PO-NBR                  PIC ZZZZZZZZ9.            02800000
028100         10  FILLER                     PIC X(1)  VALUE '-'.      02810000
028200         10  PV-RECEIVER                PIC 999.                  02820000
028300     05  PV-REQ-DATE.                                             02830000
028400         10  PV-REQ-DATE-MM             PIC 9(02).                02840000
028500         10  FILLER                     PIC X(1)  VALUE '-'.      02850000
028600         10  PV-REQ-DATE-DD             PIC 9(02).                02860000
028700         10  FILLER                     PIC X(1)  VALUE '-'.      02870000
028800         10  PV-REQ-DATE-YY             PIC 9(02).                02880000
028900     05  PV-FROM-DATE-TIME.                                       02890000
029000         10  PV-FROM-DATE-YY            PIC 9(04).                02900000
029100         10  FILLER                     PIC X(1)  VALUE '-'.      02910000
029200         10  PV-FROM-DATE-MM            PIC 9(02).                02920000
029300         10  FILLER                     PIC X(1)  VALUE '-'.      02930000
029400         10  PV-FROM-DATE-DD            PIC 9(02).                02940000
029500         10  FILLER                     PIC X(16)                 02950000
029600                  VALUE '-01.01.01.000001'.                       02960000
029700     05  PV-TO-DATE-TIME.                                         02970000
029800         10  PV-TO-DATE-YY              PIC 9(04).                02980000
029900         10  FILLER                     PIC X(1)  VALUE '-'.      02990000
030000         10  PV-TO-DATE-MM              PIC 9(02).                03000000
030100         10  FILLER                     PIC X(1)  VALUE '-'.      03010000
030200         10  PV-TO-DATE-DD              PIC 9(02).                03020000
030300         10  FILLER                     PIC X(16)                 03030000
030400                  VALUE '-23.59.59.999999'.                       03040000
030500     05  PV-DISPLAY-DATE.                                         03050000
030600         10  PV-DISPLAY-DATE-MM         PIC 9(02).                03060000
030700         10  FILLER                     PIC X(1)  VALUE '/'.      03070000
030800         10  PV-DISPLAY-DATE-DD         PIC 9(02).                03080000
030900         10  FILLER                     PIC X(1)  VALUE '/'.      03090000
031000         10  PV-DISPLAY-DATE-YY         PIC 9(04).                03100000
031100******************************************************************03110000
031200**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **03120000
031300**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **03130000
031400**  APPLICATION-SPECIFIC COMMAREA.                              **03140000
031500******************************************************************03150000
031600 01  LQW-LIST-QUEUE-WORK-AREA.                                    03160000
031700     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  03170000
031800     05  LQW-ITEM-ENTRIES               OCCURS 10 TIMES           03180000
031900                                        INDEXED BY LQW-IDX.       03190000
032000         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       03200000
032100         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               03210000
032200         10  LQW-SELECTED-SW            PIC  X(01).               03220000
032300             88  LQW-SELECT                         VALUE 'S'.    03230000
032400             88  LQW-DESELECT                       VALUE ' '.    03240000
032500         10  LQW-ACTION                 PIC  X(03).               03250000
032600                                                                  03260000
032700         10  LQW-ERROR-DESC           PIC X(15).                  03270000
032800         10  LQW-ERROR-TYPE           PIC X(01).                  03280000
032900         10  LQW-QTY                  PIC X(09).                  03290000
033000         10  LQW-TYPE                 PIC X(03).                  03300000
033100         10  LQW-ORDER-DESC           PIC X(20).                  03310000
033200         10  LQW-RECVD-DESC           PIC X(20).                  03320000
033300/                                                                 03330000
033400                                                                  03340000
033500*---------------------------------------------------------------* 03350000
033600*  RECORD LAYOUT FOR THE AUDIT CARTON LIST TEMP STORAGE QUEUE.  * 03360000
033700*---------------------------------------------------------------* 03370000
033800                                                                  03380000
033900     COPY SUWS030.                                                03390000
034000                                                                  03400000
034100*----------------------------------------------------------------*03410000
034200**  SECURITY SUBROUTINE PARAMETERS                                03420000
034300*----------------------------------------------------------------*03430000
034400     COPY DPWS008.                                                03440000
034500/                                                                 03450000
034600*---------------------------------------------------------------* 03460000
034700*    MAP LAYOUT                                                 * 03470000
034800*---------------------------------------------------------------* 03480000
034900                                                                  03490000
035000     COPY SUKM593.                                                03500000
035100*                                                                 03510000
035200 01  MR-OCCURS-LAYOUT                   REDEFINES  SU593AO.       03520000
035300     05  FILLER                         PIC X(291).               03530000
035400     05  MR-SCROLL-AREA                 OCCURS 10 TIMES.          03540000
035500         10  MR-ERROR-DESCL             PIC S9(04) COMP.          03550000
035600         10  MR-ERROR-DESCA             PIC  X(01).               03560000
035700         10  MR-ERROR-DESCC             PIC  X(01).               03570000
035800         10  MR-ERROR-DESCH             PIC  X(01).               03580000
035900         10  MR-ERROR-DESC              PIC  X(15).               03590000
036000                                                                  03600000
036100         10  MR-ERROR-INDL              PIC S9(04) COMP.          03610000
036200         10  MR-ERROR-INDA              PIC  X(01).               03620000
036300         10  MR-ERROR-INDC              PIC  X(01).               03630000
036400         10  MR-ERROR-INDH              PIC  X(01).               03640000
036500         10  MR-ERROR-IND               PIC  X(01).               03650000
036600                                                                  03660000
036700         10  MR-ERROR-LEVELL            PIC S9(04) COMP.          03670000
036800         10  MR-ERROR-LEVELA            PIC  X(01).               03680000
036900         10  MR-ERROR-LEVELC            PIC  X(01).               03690000
037000         10  MR-ERROR-LEVELH            PIC  X(01).               03700000
037100         10  MR-ERROR-LEVEL             PIC  X(03).               03710000
037200                                                                  03720000
037300         10  MR-QTYL                    PIC S9(04) COMP.          03730000
037400         10  MR-QTYA                    PIC  X(01).               03740000
037500         10  MR-QTYC                    PIC  X(01).               03750000
037600         10  MR-QTYH                    PIC  X(01).               03760000
037700         10  MR-QTY                     PIC  X(07).               03770000
037800                                                                  03780000
037900         10  MR-TYPEL                   PIC S9(04) COMP.          03790000
038000         10  MR-TYPEA                   PIC  X(01).               03800000
038100         10  MR-TYPEC                   PIC  X(01).               03810000
038200         10  MR-TYPEH                   PIC  X(01).               03820000
038300         10  MR-TYPE                    PIC  X(03).               03830000
038400                                                                  03840000
038500         10  MR-RECVD-DESCL             PIC S9(04) COMP.          03850000
038600         10  MR-RECVD-DESCA             PIC  X(01).               03860000
038700         10  MR-RECVD-DESCC             PIC  X(01).               03870000
038800         10  MR-RECVD-DESCH             PIC  X(01).               03880000
038900         10  MR-RECVD-DESC              PIC  X(20).               03890000
039000                                                                  03900000
039100         10  MR-ORDERED-DESCL           PIC S9(04) COMP.          03910000
039200         10  MR-ORDERED-DESCA           PIC  X(01).               03920000
039300         10  MR-ORDERED-DESCC           PIC  X(01).               03930000
039400         10  MR-ORDERED-DESCH           PIC  X(01).               03940000
039500         10  MR-ORDERED-DESC            PIC  X(20).               03950000
039600/                                                                 03960000
039700*---------------------------------------------------------------* 03970000
039800*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03980000
039900*---------------------------------------------------------------* 03990000
040000                                                                  04000000
040100     COPY DPWS015.                                                04010000
040200                                                                  04020000
040300*---------------------------------------------------------------* 04030000
040400*    FUNCTION KEYS COPYBOOK.                                    * 04040000
040500*---------------------------------------------------------------* 04050000
040600                                                                  04060000
040700     COPY DPWS016.                                                04070000
040800                                                                  04080000
040900*---------------------------------------------------------------* 04090000
041000*    NUMERIC EDIT LAYOUT.                                       * 04100000
041100*---------------------------------------------------------------* 04110000
041200                                                                  04120000
041300     COPY DPWS010I.                                               04130000
041400/                                                                 04140000
041500*---------------------------------------------------------------* 04150000
041600*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * 04160013
041700*---------------------------------------------------------------* 04170000
041800                                                                  04180000
041900     COPY DPWS030.                                                04190000
041900     COPY DPWS930.                                                04191013
042000/                                                                 04200000
042100*---------------------------------------------------------------* 04210000
042200*    STANDARD COMMAREA.                                         * 04220000
042300*---------------------------------------------------------------* 04230000
042400                                                                  04240000
042500     COPY DPWS020.                                                04250000
042600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04260000
042700                                                                  04270000
042800*---------------------------------------------------------------* 04280000
042900* INTER-APPLICATION COMMAREA.                                   * 04290000
043000*   SUWS029 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 04300000
043100*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 04310000
043200*---------------------------------------------------------------* 04320000
043300                                                                  04330000
043400         10  INTER-APPL-COMM-AREA       PIC X(200).               04340000
043500     COPY SUWS029.                                                04350000
043600*---------------------------------------------------------------* 04360000
043700*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 04370000
043800*---------------------------------------------------------------* 04380000
043900         10  ASC-SPECIFIC-COMMAREA.                               04390000
044000             15  ASC-LIST-KEYS.                                   04400000
044100                 20  ASC-PACKAGING-TYPE              PIC  X(02).  04410000
044200                 20  ASC-REQUEST-DATE                PIC  X(08).  04420000
044300                 20  ASC-REQUEST-MDCY                PIC  X(10).  04430000
044400                 20  ASC-REQUEST-TIME                PIC  X(05).  04440000
044500                 20  ASC-PROCESS-STATUS              PIC  X(01).  04450000
044600                 20  ASC-PO                          PIC  9(09).  04460000
044700                 20  ASC-RECEIVER-SEQ                PIC  9(03).  04470000
044800                 20  ASC-PO-RECEIVER.                             04480000
044900                     25  ASC-PO-NBR                PIC ZZZZZZZZ9. 04490000
045000                     25  FILLER                      PIC X(1).    04500000
045100                     25  ASC-RECEIVER                PIC 999.     04510000
045200                 20  ASC-SOURCE                      PIC  X(06).  04520000
045300                 20  ASC-VENDOR-NAME                 PIC  X(30).  04530000
045400                 20  ASC-ENT-ID.                                  04540000
045500                     25  ASC-ENT-ID-N                PIC 9(09).   04550000
045600                 20  ASC-DEPARTMENT-DESC             PIC  X(30).  04560000
045700                 20  ASC-DEPT-NBR.                                04570000
045800                     25  ASC-DEPT-NBR-N              PIC  9(03).  04580000
045900                 20  ASC-AUDIT-TYPE                  PIC  X(01).  04590000
046000                 20  ASC-AUDIT-STATUS                PIC  X(01).  04600000
046100                 20  ASC-OPER-UNIT-ID                PIC  Z(04).  04610000
046200                 20  ASC-OPER-DESC                   PIC  X(30).  04620000
046300                 20  ASC-FROM-DATE-MM                PIC  9(02).  04630000
046400                 20  ASC-FROM-DATE-DD                PIC  9(02).  04640000
046500                 20  ASC-FROM-DATE-YY                PIC  9(04).  04650000
046600                 20  ASC-TO-DATE-MM                  PIC  9(02).  04660000
046700                 20  ASC-TO-DATE-DD                  PIC  9(02).  04670000
046800                 20  ASC-TO-DATE-YY                  PIC  9(04).  04680000
046900                 20  ASC-AUDIT-NUMBER                PIC  Z(09).  04690000
047000                 20  ASC-CARTON-ID                   PIC  9(18).  04700000
047100                 20  ASC-UPC-NBR                     PIC  9(15).  04710000
047110                 20  ASC-INTR-UPC                    PIC S9(09)   04711000
047120                                                          COMP.   04712000
047200             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                04720000
047300                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  04730000
047400                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   04740000
047500                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   04750000
047600                                                                  04760000
047700                 20  ASC-ITEM-ARRAY.                              04770000
047800                     25  ASC-ITEM-ENTRIES OCCURS 10 TIMES.        04780000
047900                         30  ASC-LIST-ITEM-NUMBER                 04790000
048000                                                     PIC S9(09)   04800000
048100                                                     COMP-3.      04810000
048200                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  04820000
048300                             88  ASC-VALID-SELECT    VALUE ' '    04830000
048400                                                           'S'    04840000
048500                                                           'B'    04850000
048600                                                           'E'.   04860000
048700                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   04870000
048800                             88  ASC-TEMP-SELECT     VALUE 'S'.   04880000
048900                             88  ASC-TEMP-BEGIN      VALUE 'B'.   04890000
049000                             88  ASC-TEMP-END        VALUE 'E'.   04900000
049100                         30  ASC-SELECTED-SW         PIC  X(01).  04910000
049200                             88  ASC-NO-SELECT       VALUE ' '.   04920000
049300                             88  ASC-SELECT          VALUE 'S'.   04930000
049400                             88  ASC-BEGIN           VALUE 'B'.   04940000
049500                             88  ASC-END             VALUE 'E'.   04950000
049600                         30  ASC-ACTION              PIC X(03).   04960000
049700                         30  ASC-ERROR-DESC          PIC X(15).   04970000
049800                         30  ASC-ERROR-IND           PIC X(01).   04980000
049900                         30  ASC-ERROR-LEVEL         PIC X(03).   04990000
050000                         30  ASC-QTY                 PIC X(07).   05000000
050100                         30  ASC-TYPE                PIC X(03).   05010000
050200                         30  ASC-ORDER-DESC          PIC X(20)    05020000
050300                                                 JUST RIGHT.      05030000
050400                         30  ASC-RECVD-DESC          PIC X(20)    05040000
050500                                                 JUST RIGHT.      05050000
050600                                                                  05060000
050700             15  ASC-BLK-SUB                         PIC S9(04)   05070000
050800                                                          COMP    05080000
050900                                                          SYNC.   05090000
051000             15  ASC-ITEM-SUB                        PIC S9(04)   05100000
051100                                                          COMP    05110000
051200                                                          SYNC.   05120000
051300             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   05130000
051400                                                          COMP-3. 05140000
051500             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   05150000
051600                                                          COMP-3. 05160000
051700             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   05170000
051800                                                          COMP-3. 05180000
051900             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   05190000
052000                                                          COMP-3. 05200000
052100             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   05210000
052200                                                          COMP-3. 05220000
052300             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   05230000
052400                                                          COMP    05240000
052500                                                          SYNC.   05250000
052600             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   05260000
052700                                                          COMP-3. 05270000
052800             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   05280000
052900                                                          COMP-3. 05290000
053000             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  05300000
053100                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   05310000
053200                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   05320000
053300             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  05330000
053400                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   05340000
053500                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   05350000
053600             15  ASC-LIST-QUEUE-NAME.                             05360000
053700                 20  ASC-LIST-TERM-ID                PIC  X(04).  05370000
053800                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   05380000
053900                                                          COMP-3. 05390000
054000                 20  ASC-LIST-SEQ                    PIC  9(01).  05400000
054100             15  ASC-SEL-QUEUE-NAME.                              05410000
054200                 20  ASC-SEL-TERM-ID                 PIC  X(04).  05420000
054300                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   05430000
054400                                                          COMP-3. 05440000
054500                 20  ASC-SEL-SEQ                     PIC  9(01).  05450000
054600                                                                  05460000
054700             15  ASC-SEL-QUEUE-NAME-IN.                           05470000
054800                 20  ASC-SEL-TERM-ID-IN  PIC X(04).               05480000
054900                 20  ASC-SEL-TASK-NUMBER-IN                       05490000
055000                                      PIC S9(05) COMP-3.          05500000
055100                 20  ASC-SEL-SEQ-IN      PIC 9(01).               05510000
055200             15  ASC-USE-SELECTION-QUEUE-IND                      05520000
055300                                           PIC  X(01).            05530000
055400                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 05540000
055500             15  ASC-START-ITEM-REQUEST.                          05550000
055600                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  05560000
055700             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05)  COMP-3.    05570000
055800             15  ASC-SEL-SUB               PIC S9(04)  COMP.      05580000
055900             15  ASC-SEL-ITEM              PIC S9(04)  COMP.      05590000
056000             15  FILLER                    PIC  X(973).           05600000
056100*                                                                 05610000
056200/                                                                 05620000
056300*---------------------------------------------------------------* 05630000
056400*    ABEND PROCESSING COPYBOOK.                                 * 05640000
056500*---------------------------------------------------------------* 05650000
056600                                                                  05660000
056700     COPY DPWS013.                                                05670000
056800                                                                  05680000
056900                                                                  05690000
057000*----------------------------------------------------------------*05700000
057100*    DB2 DCLGEN FOR THE EXTERNAL ENTERPRISE TABLE                 05710000
057200*----------------------------------------------------------------*05720000
057300     EXEC SQL                                                     05730000
057400          INCLUDE TEXTENT                                         05740000
057500     END-EXEC.                                                    05750000
057600                                                                  05760000
057700*----------------------------------------------------------------*05770000
057800*    DB2 DCLGEN FOR THE ENTERPRISE NAME TABLE                     05780000
057900*----------------------------------------------------------------*05790000
058000     EXEC SQL                                                     05800000
058100          INCLUDE TENTNME                                         05810000
058200     END-EXEC.                                                    05820000
058300                                                                  05830000
059100*---------------------------------------------------------------* 05910000
059200*  DCLGEN FOR THE DB2 DEPARTMENT TABLE                            05920000
059300*---------------------------------------------------------------* 05930000
059400     EXEC SQL                                                     05940000
059500         INCLUDE TVNDDPT                                          05950000
059600     END-EXEC.                                                    05960000
059700*----------------------------------------------------------------*05970000
059800*    DB2 DCLGEN FOR THE MERCHANDISE AREA TABLE                    05980000
059900*----------------------------------------------------------------*05990000
060000     EXEC SQL                                                     06000000
060100          INCLUDE TMDSEAR                                         06010000
060200     END-EXEC.                                                    06020000
060300                                                                  06030000
060400     EXEC SQL                                                     06040000
060500         INCLUDE TSUATRN                                          06050000
060600     END-EXEC.                                                    06060000
060700                                                                  06070000
060800     EXEC SQL                                                     06080000
060900         INCLUDE TCTEXCP                                          06090000
061000     END-EXEC.                                                    06100000
061100                                                                  06110000
061200     EXEC SQL                                                     06120000
061300         INCLUDE TSUEXCP                                          06130000
061400     END-EXEC.                                                    06140000
061500                                                                  06150000
061600     EXEC SQL                                                     06160000
061700         INCLUDE TSHPUNT                                          06170000
061800     END-EXEC.                                                    06180000
061900                                                                  06190000
061910**    XLT_UPC                                                     06191000
062000     EXEC SQL                                                     06200000
062100         INCLUDE XLT00006                                         06210000
062200     END-EXEC.                                                    06220000
062300                                                                  06230000
062400     EXEC SQL                                                     06240000
062500         INCLUDE TSHUUPC                                          06250000
062600     END-EXEC.                                                    06260000
062700                                                                  06270000
062800     EXEC SQL                                                     06280000
062900         INCLUDE TSUAUPC                                          06290000
063000     END-EXEC.                                                    06300000
063100                                                                  06310000
063200                                                                  06320000
063300     EXEC SQL                                                     06330000
063400         INCLUDE TVILNCD                                          06340000
063500     END-EXEC.                                                    06350000
063600                                                                  06360000
063700     EXEC SQL                                                     06370000
063800          INCLUDE SUT00015                                        06380000
063900     END-EXEC.                                                    06390000
064000                                                                  06400000
063700     EXEC SQL                                                     06400100
063800          INCLUDE SUT00014                                        06400200
063900     END-EXEC.                                                    06400300
064000                                                                  06400400
064000* INCLUDE LOCATION TABLE                                          06400500
063700     EXEC SQL                                                     06401000
063800          INCLUDE XLT00010                                        06402000
063900     END-EXEC.                                                    06403000
064000                                                                  06404000
064100     EXEC SQL                                                     06410000
064200          INCLUDE SQLCA                                           06420000
064300     END-EXEC.                                                    06430000
064400/                                                                 06440000
064500*    OVERAGES AND SHORTAGES ARE SHOWN FIRST                       06450000
064600     EXEC SQL                                                     06460000
064700         DECLARE OVER-SHORT-CSR CURSOR FOR                        06470000
064800               SELECT UPC_NBR                                     06480000
064900               ,    SUM(SCND_UNT_QTY) AS QTY                      06490000
      *SB 01/02/14 - BEGIN PR#5148D                                     06490100
                     ,    SUM(RFID_TGD_QTY) AS QTY1                     06491000
      *SB 01/02/14 - END PR#5148D                                       06492000
065000               ,    'AUD'                                         06500000
065100                FROM  TSUAUPC                                     06510000
065200                WHERE AUD_CNTL_NBR        = :DK-AUDIT-NBR         06520000
065300                  AND SHIPT_UNT_ID        = :DK-SHIPT-UNIT-ID     06530000
065400                  AND UPC_NBR             = :DK-UPC-NBR           06540000
065500                  AND SCN_TYP_CDE        <> 'E'                   06550000
065600               GROUP BY UPC_NBR                                   06560000
065700                                                                  06570000
065800               UNION                                              06580000
065900                                                                  06590000
066000             ( SELECT A.UPC_NBR                                   06600000
066100                    , A.SHPD_QTY  AS QTY                          06610000
066100                    , A.SHPD_QTY  AS QTY1                         06611000
066200               ,    'EXP'                                         06620000
066300                FROM  TSHUUPC       A                             06630000
066400                    , TSHPUNT       B                             06640000
066410                    , XLT_UPC       C                             06641000
066500                WHERE A.SHIPT_UNT_ID       = B.SHIPT_UNT_ID       06650000
066600                  AND A.SHIPT_UNT_ID       = :DK-SHIPT-UNIT-ID    06660000
066700                  AND A.UPC_NBR            = C.UPC_NBR            06670000
066710                  AND C.INTR_UPC_ID        = :DK-INTR-UPC         06671000
066800                                                                  06680000
066900            UNION                                                 06690000
067000                                                                  06700000
067100               SELECT SHUUPC.UPC_NBR                              06710000
067200                    , SHUUPC.SHPD_QTY   AS QTY                    06720000
067200                    , SHUUPC.SHPD_QTY   AS QTY1                   06721000
067300               ,    'EXP'                                         06730000
067400                FROM  TSHUUPC        SHUUPC                       06740000
067500                    , TSHPUNT        SHPUNT                       06750000
067600                WHERE SHUUPC.SHIPT_UNT_ID  = SHPUNT.SHIPT_UNT_ID  06760000
067700                  AND SHUUPC.SHIPT_UNT_ID  = :DK-SHIPT-UNIT-ID    06770000
067800                  AND UPC_NBR              = :DK-UPC-NBR          06780000
067900                  AND NOT EXISTS                                  06790000
068000                      (SELECT *                                   06800000
068100                       FROM XLT_UPC  UPC                          06810000
068200                       WHERE UPC.UPC_NBR  = SHUUPC.UPC_NBR        06820000
068300                       )                                          06830000
068400                       )                                          06840000
068500         WITH UR                                                  06850000
068600     END-EXEC.                                                    06860000
068700                                                                  06870000
068800                                                                  06880000
068900*  CARTON ERRORS ONLY.                                            06890000
069000     EXEC SQL                                                     06900000
069100          DECLARE CARTON-CSR CURSOR FOR                           06910000
069200                                                                  06920000
069300         SELECT                                                   06930000
069400                 EXCP.VILN_GP_CDE                                 06940000
069500              ,  EXCP.VILN_GP_SEQ_NBR                             06950000
069600              ,  VILN.VILN_CDE_SHRT_DESC                          06960000
069700              ,  EXCP.OVRRID_SYS_DAT_TXT                          06970000
069800              ,  TRN.TRN_NBR                                      06980000
069900              ,  TRN.DEST_OPER_UNT_ID                             06990000
070000         FROM                                                     07000000
070100             TCTEXCP EXCP                                         07010000
070200           , TSUATRN TRN                                          07020000
070300           , TVILNCD VILN                                         07030000
070400         WHERE                                                    07040000
070500             EXCP.AUD_CNTL_NBR     = TRN.AUD_CNTL_NBR             07050000
070600         AND EXCP.SHIPT_UNT_ID     = TRN.SHIPT_UNT_ID             07060000
070700         AND VILN.VILN_GP_CDE      = EXCP.VILN_GP_CDE             07070000
070800         AND VILN.VILN_GP_SEQ_NBR  = EXCP.VILN_GP_SEQ_NBR         07080000
070900                                                                  07090000
071000         AND TRN.AUD_CNTL_NBR      = :DK-AUDIT-NBR                07100000
071100         AND TRN.SHIPT_UNT_ID      = :DK-SHIPT-UNIT-ID            07110000
071200         ORDER BY                                                 07120000
071300              EXCP.VILN_GP_SEQ_NBR                                07130000
071400         WITH UR                                                  07140000
071500     END-EXEC.                                                    07150000
071600                                                                  07160000
071700     EXEC SQL                                                     07170000
071800         DECLARE ITEM-CSR CURSOR FOR                              07180000
071900                                                                  07190000
072000         SELECT                                                   07200000
072100                 'A'                                              07210000
072200              ,  EXCP.VILN_GP_SEQ_NBR                             07220000
072300              ,  VILN.VILN_CDE_SHRT_DESC                          07230000
072400              ,  VILN.FALR_IND                                    07240000
072500              ,  EXCP.OVRRID_SYS_DAT_TXT                          07250000
072600              ,  SUM(UPC.SCND_UNT_QTY) AS ERROR_COUNT             07260000
      *SB 01/02/14 - BEGIN PR#5148D                                     07260100
                    ,  SUM(UPC.RFID_TGD_QTY) AS ERROR_COUNT1            07261000
      *SB 01/02/14 - END PR#5148D                                       07262000
072700         FROM                                                     07270000
072800                TSUAUPC UPC                                       07280000
072900             ,  TSUEXCP EXCP                                      07290000
073000             ,  TVILNCD VILN                                      07300000
073100         WHERE                                                    07310000
073200             UPC.AUD_CNTL_NBR   = :DK-AUDIT-NBR                   07320000
073300         AND UPC.SHIPT_UNT_ID   = :DK-SHIPT-UNIT-ID               07330000
073400         AND UPC.UPC_NBR        = :DK-UPC-NBR                     07340000
073500         AND UPC.SCN_TYP_CDE    = 'E'                             07350000
073600*        AND EXCP.VILN_GP_SEQ_NBR <> 12                           07360000
073700         AND UPC.AUD_CNTL_NBR   = EXCP.AUD_CNTL_NBR               07370000
073800         AND UPC.SHIPT_UNT_ID   = EXCP.SHIPT_UNT_ID               07380000
073900         AND UPC.UPC_NBR        = EXCP.UPC_NBR                    07390000
074000         AND UPC.SCN_TMST       = EXCP.SCN_TMST                   07400000
074100         AND VILN.VILN_GP_CDE   = EXCP.VILN_GP_CDE                07410000
074200         AND VILN.VILN_GP_SEQ_NBR = EXCP.VILN_GP_SEQ_NBR          07420000
074300                                                                  07430000
074400        GROUP BY EXCP.VILN_GP_SEQ_NBR                             07440000
074500              ,  VILN.VILN_CDE_SHRT_DESC                          07450000
074600              ,  VILN.FALR_IND                                    07460000
074700              ,  EXCP.OVRRID_SYS_DAT_TXT                          07470000
074800                                                                  07480000
074900       UNION                                                      07490000
075000                                                                  07500000
075100         SELECT                                                   07510000
075200                 'B'                                              07520000
075300              ,  EXCP.VILN_GP_SEQ_NBR                             07530000
075400              ,  VILN.VILN_CDE_SHRT_DESC                          07540000
075500              ,  VILN.FALR_IND                                    07550000
075600              ,  EXCP.OVRRID_SYS_DAT_TXT                          07560000
075700              ,  1 AS ERROR_COUNT                                 07570000
      *SB 01/02/14 - BEGIN PR#5148D                                     07570100
                    ,  1 AS ERROR_COUNT1                                07571000
      *SB 01/02/14 - END PR#5148D                                       07572000
075800         FROM                                                     07580000
075900                TSUEXCP EXCP                                      07590000
076000             ,  TVILNCD VILN                                      07600000
076100         WHERE                                                    07610000
076200             EXCP.AUD_CNTL_NBR  = :DK-AUDIT-NBR                   07620000
076300         AND EXCP.SHIPT_UNT_ID  = :DK-SHIPT-UNIT-ID               07630000
076400         AND EXCP.UPC_NBR       = :DK-UPC-NBR                     07640000
076500         AND VILN.VILN_GP_CDE   = EXCP.VILN_GP_CDE                07650000
076600         AND VILN.VILN_GP_SEQ_NBR = EXCP.VILN_GP_SEQ_NBR          07660000
076700*        AND EXCP.VILN_GP_SEQ_NBR <> 12                           07670000
076800         AND NOT EXISTS                                           07680000
076900             (SELECT *                                            07690000
077000              FROM TSUEXCP  EXCPS                                 07700000
077100                 , TSUAUPC  UPCS                                  07710000
077200              WHERE                                               07720000
077300                    UPCS.AUD_CNTL_NBR  = :DK-AUDIT-NBR            07730000
077400                AND UPCS.SHIPT_UNT_ID  = :DK-SHIPT-UNIT-ID        07740000
077500                AND UPCS.UPC_NBR       = :DK-UPC-NBR              07750000
077600                AND UPCS.AUD_CNTL_NBR  = EXCPS.AUD_CNTL_NBR       07760000
077700                AND UPCS.SHIPT_UNT_ID  = EXCPS.SHIPT_UNT_ID       07770000
077800                AND UPCS.UPC_NBR       = EXCPS.UPC_NBR            07780000
077900                AND UPCS.SCN_TMST      = EXCPS.SCN_TMST)          07790000
078000         GROUP BY EXCP.VILN_GP_SEQ_NBR                            07800000
078100               ,  VILN.VILN_CDE_SHRT_DESC                         07810000
078200               ,  VILN.FALR_IND                                   07820000
078300               ,  EXCP.OVRRID_SYS_DAT_TXT                         07830000
078400                                                                  07840000
078500       UNION                                                      07850000
078600                                                                  07860000
078700         SELECT                                                   07870000
078800                 'C'                                              07880000
078900              ,  EXCP.VILN_GP_SEQ_NBR                             07890000
079000              ,  VILN.VILN_CDE_SHRT_DESC                          07900000
079100              ,  VILN.FALR_IND                                    07910000
079200              ,  EXCP.OVRRID_SYS_DAT_TXT                          07920000
079300              ,  SUM(AUPC.SCND_UNT_QTY) AS ERROR_COUNT            07930000
      *SB 01/02/14 - BEGIN PR#5148D                                     07930100
                    ,  SUM(AUPC.RFID_TGD_QTY) AS ERROR_COUNT1           07931000
      *SB 01/02/14 - END PR#5148D                                       07932000
079400         FROM                                                     07940000
079500                TSUEXCP EXCP                                      07950000
079600             ,  TVILNCD VILN                                      07960000
079700             ,  TSUAUPC AUPC                                      07970000
079800         WHERE                                                    07980000
079900             EXCP.AUD_CNTL_NBR  = :DK-AUDIT-NBR                   07990000
080000         AND EXCP.SHIPT_UNT_ID  = :DK-SHIPT-UNIT-ID               08000000
080100         AND EXCP.UPC_NBR       = :DK-UPC-NBR                     08010000
080200         AND EXCP.AUD_CNTL_NBR  = AUPC.AUD_CNTL_NBR               08020000
080300         AND EXCP.SHIPT_UNT_ID  = AUPC.SHIPT_UNT_ID               08030000
080400         AND EXCP.UPC_NBR       = AUPC.UPC_NBR                    08040000
080500         AND EXCP.SCN_TMST      = AUPC.SCN_TMST                   08050000
080600         AND AUPC.SCN_TYP_CDE  <> 'E'                             08060000
080700         AND VILN.VILN_GP_CDE   = EXCP.VILN_GP_CDE                08070000
080800         AND VILN.VILN_GP_SEQ_NBR = EXCP.VILN_GP_SEQ_NBR          08080000
080900         AND NOT EXISTS                                           08090000
081000             (SELECT *                                            08100000
081100              FROM TSUEXCP  EXCPS                                 08110000
081200                 , TSUAUPC  UPCS                                  08120000
081300              WHERE                                               08130000
081400                    UPCS.AUD_CNTL_NBR  = :DK-AUDIT-NBR            08140000
081500                AND UPCS.SHIPT_UNT_ID  = :DK-SHIPT-UNIT-ID        08150000
081600                AND UPCS.UPC_NBR       = :DK-UPC-NBR              08160000
081700                AND UPCS.AUD_CNTL_NBR  = EXCPS.AUD_CNTL_NBR       08170000
081800                AND UPCS.SHIPT_UNT_ID  = EXCPS.SHIPT_UNT_ID       08180000
081900                AND UPCS.UPC_NBR       = EXCPS.UPC_NBR            08190000
082000                AND UPCS.SCN_TMST      = EXCPS.SCN_TMST           08200000
082100                AND UPCS.SCN_TYP_CDE   = 'E')                     08210000
082200         GROUP BY EXCP.VILN_GP_SEQ_NBR                            08220000
082300               ,  VILN.VILN_CDE_SHRT_DESC                         08230000
082400               ,  VILN.FALR_IND                                   08240000
082500               ,  EXCP.OVRRID_SYS_DAT_TXT                         08250000
082600       UNION                                                      08260000
082700         SELECT                                                   08270000
082800                 'D'                                              08280000
082900              ,  EXCP.VILN_GP_SEQ_NBR                             08290000
083000              ,  VILN.VILN_CDE_SHRT_DESC                          08300000
083100              ,  VILN.FALR_IND                                    08310000
083200              ,  EXCP.OVRRID_SYS_DAT_TXT                          08320000
083300*             ,  COUNT(*) AS ERROR_COUNT                          08330000
      *SB 01/02/14 - BEGIN PR#5148D                                     08330100
                    ,  SUM(SCND_UNT_QTY) AS ERROR_COUNT                 08330200
                    ,  SUM(RFID_TGD_QTY) AS ERROR_COUNT1                08330300
      *             ,  COUNT(*) AS ERROR_COUNT1                         08331000
      *SB 01/02/14 - END PR#5148D                                       08332000
083400           FROM   TSUEXCP EXCP                                    08340000
083500                , TVILNCD VILN                                    08350000
083600                , TSUAUPC AUPC                                    08360000
083700          WHERE  EXCP.AUD_CNTL_NBR  = :DK-AUDIT-NBR               08370000
083800            AND  EXCP.SHIPT_UNT_ID  = :DK-SHIPT-UNIT-ID           08380000
083900            AND  EXCP.UPC_NBR       = :DK-UPC-NBR                 08390000
084000            AND  EXCP.VILN_GP_CDE   = VILN.VILN_GP_CDE            08400000
084100            AND  EXCP.VILN_GP_SEQ_NBR = VILN.VILN_GP_SEQ_NBR      08410000
084200            AND  EXCP.AUD_CNTL_NBR  = AUPC.AUD_CNTL_NBR           08420000
084300            AND  EXCP.SHIPT_UNT_ID  = AUPC.SHIPT_UNT_ID           08430000
084400            AND  EXCP.UPC_NBR       = AUPC.UPC_NBR                08440000
084500            AND  EXCP.SCN_TMST      = AUPC.SCN_TMST               08450000
084600            AND  AUPC.SCN_TYP_CDE  <> 'E'                         08460000
084700            AND EXISTS                                            08470000
084800                (SELECT *                                         08480000
084900                 FROM TSUEXCP  EXCPS                              08490000
085000                    , TSUAUPC  UPCS                               08500000
085100                 WHERE                                            08510000
085200                       UPCS.AUD_CNTL_NBR  = :DK-AUDIT-NBR         08520000
085300                   AND UPCS.SHIPT_UNT_ID  = :DK-SHIPT-UNIT-ID     08530000
085400                   AND UPCS.UPC_NBR       = :DK-UPC-NBR           08540000
085500                   AND UPCS.AUD_CNTL_NBR  = EXCPS.AUD_CNTL_NBR    08550000
085600                   AND UPCS.SHIPT_UNT_ID  = EXCPS.SHIPT_UNT_ID    08560000
085700                   AND UPCS.UPC_NBR       = EXCPS.UPC_NBR         08570000
085800                   AND UPCS.SCN_TMST      = EXCPS.SCN_TMST        08580000
085900                   AND UPCS.SCN_TYP_CDE   = 'E')                  08590000
086000            GROUP BY                                              08600000
086100                 EXCP.VILN_GP_SEQ_NBR                             08610000
086200              ,  VILN.VILN_CDE_SHRT_DESC                          08620000
086300              ,  VILN.FALR_IND                                    08630000
086400              ,  EXCP.OVRRID_SYS_DAT_TXT                          08640000
086500         WITH UR                                                  08650000
086600                                                                  08660000
086700     END-EXEC.                                                    08670000
086800/                                                                 08680000
086900     EXEC SQL                                                     08690000
087000         DECLARE UPC-CSR CURSOR                                   08700000
087100         FOR SELECT                                               08710000
087110               UPC.SKU_NBR                                        08711000
087500            ,  UPC.ITM_DESC                                       08750000
087600            ,  UPC.VND_STYL_DESC                                  08760000
087700            ,  UPC.UPC_CLOR_DESC                                  08770000
087800            ,  UPC.UPC_SIZE_DESC                                  08780000
087900            ,  UPC.UPC_RTL_AMT                                    08790000
087910            ,  UPC.DEPT_NBR                                       08791000
087920            ,  UPC.MAJ_CL_NBR                                     08792000
087930            ,  UPC.SUB_CL_NBR                                     08793000
088000         FROM                                                     08800000
088100               TSUAUPC UPC                                        08810000
088200         WHERE                                                    08820000
088300               UPC.AUD_CNTL_NBR     = :DK-AUDIT-NBR               08830000
088400           AND UPC.SHIPT_UNT_ID     = :DK-SHIPT-UNIT-ID           08840000
088500           AND UPC.UPC_NBR          = :DK-UPC-NBR                 08850000
088600           AND UPC.SCN_TYP_CDE    <>  'E'                         08860000
088700         GROUP BY                                                 08870000
088800               UPC.SKU_NBR                                        08880000
089100            ,  UPC.ITM_DESC                                       08910000
089200            ,  UPC.VND_STYL_DESC                                  08920000
089300            ,  UPC.UPC_CLOR_DESC                                  08930000
089400            ,  UPC.UPC_SIZE_DESC                                  08940000
089500            ,  UPC.UPC_RTL_AMT                                    08950000
089510            ,  UPC.DEPT_NBR                                       08951000
089520            ,  UPC.MAJ_CL_NBR                                     08952000
089530            ,  UPC.SUB_CL_NBR                                     08953000
089600                                                                  08960000
089700     OPTIMIZE FOR 1 ROW                                           08970000
089800     WITH UR                                                      08980000
089900                                                                  08990000
090000     END-EXEC.                                                    09000000
090100/                                                                 09010000
090200 LINKAGE SECTION.                                                 09020000
090300                                                                  09030000
090400 01  DFHCOMMAREA.                                                 09040000
090500     05  FILLER                         OCCURS  1 TO 4072 TIMES   09050000
090600                                        DEPENDING ON EIBCALEN.    09060000
090700         10  FILLER                     PIC X.                    09070000
090800                                                                  09080000
090900/                                                                 09090000
091000 PROCEDURE DIVISION.                                              09100000
091100******************************************************************09110000
091200**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **09120000
091300**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **09130000
091400**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **09140000
091500******************************************************************09150000
091600 0000-MAIN-MODULE.                                                09160000
091700     INITIALIZE DP030-CICS-API-FIELDS.                            09170000
091800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       09180000
091900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          09190000
092000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         09200000
092100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       09210000
092200     MOVE LENGTH OF SU593AI        TO DP030-MAP-LENGTH (1).       09220000
092300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     09230000
092400     PERFORM 0001-CALL-CICS-ARCH-API.                             09240000
092500*                                                                 09250000
092600     PERFORM 1000-CONTROL-PROCESSING                              09260000
092700*                                                                 09270000
092800     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     09280000
092900     PERFORM 0001-CALL-CICS-ARCH-API.                             09290000
093000                                                                  09300000
093100******************************************************************09310000
093200**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **09320000
093300**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **09330000
093400******************************************************************09340000
093500 0001-CALL-CICS-ARCH-API.                                         09350000
093600*    CALL 'DPKCS030' USING DFHEIBLK                               09360013
093600     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      09361013
093700                           DFHCOMMAREA                            09370000
093800                           DP030-CICS-API-FIELDS                  09380000
093900                           DP020-STANDARD-COMMAREA                09390000
094000                           SU593AI.                               09400000
094100*                                                                 09410000
094200     IF  DP030-RC-CALL-SUCCESSFUL                                 09420000
094300         CONTINUE                                                 09430000
094400     ELSE                                                         09440000
094500         SET DP013-NO-ROLLBACK                                    09450000
094600             DP013-XCTL-DISPLAY-RESTART                           09460000
094700             DP013-CICS-ABEND      TO TRUE                        09470000
094800         MOVE '0001-CALL-CICS-ARCH-API'                           09480000
094900                                   TO DP013-PARAGRAPH             09490000
095000*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX09500013
095100*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      09510013
095000         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O09511013
095100-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      09512013
095200         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      09520000
095300         PERFORM DP013-0000-PROCESS-ABEND                         09530000
095400     END-IF.                                                      09540000
095500*----------------------------------------------------------------*09550000
095600* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *09560000
095700* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *09570000
095800*                                                                *09580000
095900* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *09590000
096000*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *09600000
096100*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *09610000
096200*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *09620000
096300*----------------------------------------------------------------*09630000
096400                                                                  09640000
096500 1000-CONTROL-PROCESSING.                                         09650000
096600                                                                  09660000
096700     EVALUATE TRUE                                                09670000
096800         WHEN DP020-NEXT-ACT-INITIAL                              09680000
096900             INITIALIZE ASC-SPECIFIC-COMMAREA                     09690000
097000             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            09700000
097100                                      ASC-SEL-TERM-ID             09710000
097200             MOVE DP020-SRC-TASK-NUMBER                           09720000
097300                                   TO ASC-LIST-TASK-NUMBER        09730000
097400                                      ASC-SEL-TASK-NUMBER         09740000
097500             MOVE PC-LIST-QUEUE-SEQ                               09750000
097600                                   TO ASC-LIST-SEQ                09760000
097700             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 09770000
097800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 09780000
097900***-----$TEMPLATE NOTE$-------------------------------------------09790000
098000*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,09800000
098100*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  09810000
098200*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.09820000
098300***---------------------------------------------------------------09830000
098400             IF  PS-COMMAREA-NOT-VALID                            09840000
098500***              MOVE PC-TSYMSG-99901                             09850000
098600***                                TO DP020-MSG-NUMBER            09860000
098700***              SET DP020-MSG-FATAL                              09870000
098800***                                TO TRUE                        09880000
098900                 SET DP020-NEXT-ACT-APPL-ERROR                    09890000
099000                                   TO TRUE                        09900000
099100             ELSE                                                 09910000
099200                 PERFORM 4000-BUILD-INITIAL-PANEL                 09920000
099300             END-IF                                               09930000
099400                                                                  09940000
099500         WHEN DP020-NEXT-ACT-READ-MAP                             09950000
099600             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        09960000
099700                                   TO PV-TOP-ITEM                 09970000
099800             PERFORM 2000-PROCESS-PANEL                           09980000
099900                                                                  09990000
100000         WHEN DP020-NEXT-ACT-RETURN                               10000000
100100             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        10010000
100200                                   TO PV-TOP-ITEM                 10020000
100300             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    10030000
100400             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 10040000
100500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10050000
100600*            PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10060000
100700                                                                  10070000
100800         WHEN OTHER                                               10080000
100900             SET DP013-LOGIC-ABEND TO TRUE                        10090000
101000             SET DP013-NO-ROLLBACK TO TRUE                        10100000
101100             MOVE '1000-CONTROL-PROCESSING'                       10110000
101200                                   TO DP013-PARAGRAPH             10120000
101300             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    10130000
101400                                   TO DP013-MESSAGE-TEXT(1)       10140000
101500             PERFORM DP013-0000-PROCESS-ABEND                     10150000
101600     END-EVALUATE.                                                10160000
101700                                                                  10170000
101800/                                                                 10180000
101900*----------------------------------------------------------------*10190000
102000* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *10200000
102100* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *10210000
102200*----------------------------------------------------------------*10220000
102300                                                                  10230000
102400 1100-PROCESS-INTER-APPL-COMM.                                    10240000
102500                                                                  10250000
102600     SET PS-COMMAREA-VALID         TO TRUE.                       10260000
102700     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     10270000
102800     EVALUATE DP020-INT-APPL-FORMAT-IND                           10280000
102900                                                                  10290000
103000         WHEN PC-INTER-APPL-LIST                                  10300000
103100             MOVE SU029-AUDIT-NBR     TO ASC-AUDIT-NUMBER         10310000
103200             MOVE SU029-CARTON-ID     TO ASC-CARTON-ID            10320000
103300             MOVE SU029-OPER-UNIT-ID  TO ASC-OPER-UNIT-ID         10330000
103400                                         DK-OPER-UNIT             10340000
103500             IF DK-OPER-UNIT > 0                                  10350000
103600                 PERFORM 4200-SELECT-OPER-DESC                    10360000
103700                 MOVE XLT00010-LOC-NM     TO ASC-OPER-DESC        10370000
103800             END-IF                                               10380000
103900             IF SU029-ENT-ID NOT NUMERIC                          10390000
103900                 MOVE ZEROES          TO SU029-ENT-ID             10391000
103900             END-IF                                               10391100
103900             MOVE SU029-ENT-ID        TO DK-ENT-ID                10392000
104000                                         ASC-ENT-ID-N             10400000
104100             PERFORM 4230-SELECT-VENDOR                           10410000
104200             MOVE ENTNME-ENT-NAME-DESC    TO ASC-VENDOR-NAME      10420000
104300             MOVE SU029-DEPT-NBR      TO ASC-DEPT-NBR-N           10430000
104400             MOVE ASC-DEPT-NBR        TO DK-DEPT-NBR              10440000
104500             PERFORM 4250-SELECT-DEPT                             10450000
104600             MOVE MDSEAR-DESC         TO ASC-DEPARTMENT-DESC      10460000
104700                                                                  10470000
104800             MOVE SU029-PROCESS-STATUS  TO ASC-PROCESS-STATUS     10480000
104900             MOVE SU029-SOURCE        TO ASC-SOURCE               10490000
105000             MOVE SU029-PO-RECEIVER   TO ASC-PO-RECEIVER          10500000
105100             MOVE SU029-REQUEST-MDCY  TO ASC-REQUEST-MDCY         10510000
105200             SET ASC-USE-SELECTION-QUEUE TO TRUE                  10520000
105300             MOVE SU029-NUMBER-OF-SELECTED-ITEMS                  10530000
105400                                   TO ASC-NUMBER-OF-SELECTED-ITEMS10540000
105500             MOVE SU029-NUMBER-OF-TS-ITEMS                        10550000
105600                                   TO ASC-NUMBER-OF-TS-ITEMS      10560000
105700             MOVE SU029-SEL-QUEUE-NAME                            10570000
105800                                   TO ASC-SEL-QUEUE-NAME-IN       10580000
105900             PERFORM 1120-PREPARE-LIST-ENTRY                      10590000
106000                                                                  10600000
106100         WHEN OTHER                                               10610000
106200             IF  DP020-NAV-KEY-DATA > SPACE                       10620000
106300                 PERFORM 1110-EDIT-NAV-KEY                        10630000
106400             ELSE                                                 10640000
106500                 MOVE PC-TSYMSG-00148                             10650000
106600                                   TO DP020-MSG-NUMBER            10660000
106700                 SET DP020-MSG-FATAL                              10670000
106800                     DP020-NEXT-ACT-APPL-ERROR                    10680000
106900                                   TO TRUE                        10690000
107000             END-IF                                               10700000
107100     END-EVALUATE.                                                10710000
107200                                                                  10720000
107300******************************************************************10730000
107400** EDIT THE KEY ENTERED BY THE USER INTO THE KEY FIELD OF THE   **10740000
107500** COMMAND LINE.  A VALID MESSAGE NUMBER IS THE ONLY KEY        **10750000
107600** ACCEPTED.                                                    **10760000
107700******************************************************************10770000
107800 1110-EDIT-NAV-KEY.                                               10780000
107900     IF  ASC-ENT-ID > SPACE                                       10790000
108000         MOVE DP020-NAV-KEY-DATA   TO DP010I-UNEDITED-FIELD       10800000
108100         MOVE LENGTH OF ASC-ENT-ID                                10810000
108200                                   TO DP010I-MAXIMUM-DIGITS       10820000
108300         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     10830000
108400         SET DP010I-NEGATIVE-NOT-ALLOWED                          10840000
108500                                   TO TRUE                        10850000
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                         10861012
263968              USING DP010I-NUMERIC-EDIT-AREA                      10862012
108700         IF  DP010I-ERROR-DETECTED                                10870000
108800             SET PS-ERROR                                         10880000
108900                 DP020-MSG-FATAL   TO TRUE                        10890000
109000*            -- INVALID DATA IN KEY FIELD ---                     10900000
109100             MOVE PC-TSYMSG-00302  TO DP020-MSG-NUMBER            10910000
109200             SET DP020-NEXT-ACT-APPL-ERROR                        10920000
109300                                   TO TRUE                        10930000
109400         ELSE                                                     10940000
109500             MOVE DP010I-NUMERIC-FIELD                            10950000
109600                                   TO ASC-ENT-ID-N                10960000
109700         END-IF                                                   10970000
109400     ELSE                                                         10971000
108800         SET PS-ERROR                                             10972000
108900             DP020-MSG-FATAL           TO TRUE                    10973000
109000*        -- INVALID DATA IN KEY FIELD ---                         10974000
109100         MOVE PC-TSYMSG-00302          TO DP020-MSG-NUMBER        10975000
109200         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    10976000
109800     END-IF.                                                      10980000
109900*----------------------------------------------------------------*10990000
110000* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *11000000
110100* STORAGE QUEUE PASSED FROM THE LIST.                            *11010000
110200*----------------------------------------------------------------*11020000
110300 1120-PREPARE-LIST-ENTRY.                                         11030000
110400     MOVE SU030-MAX-ITEMS          TO ASC-SEL-SUB.                11040000
110500     MOVE ZERO                     TO ASC-SEL-ITEM.               11050000
110600     PERFORM 2300-GET-NEXT-RECORD.                                11060000
110700/                                                                 11070000
110800*----------------------------------------------------------------*11080000
110900* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *11090000
111000* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *11100000
111100* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *11110000
111200* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *11120000
111300* FUNCTION KEYS CAN GET THIS FAR.                                *11130000
111400*----------------------------------------------------------------*11140000
111500                                                                  11150000
111600 2000-PROCESS-PANEL.                                              11160000
111700     EVALUATE TRUE                                                11170000
111800         WHEN DP020-SRC-AID = DP016-CLEAR                         11180000
111900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    11190000
112000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   11200000
112100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11210000
112200                                                                  11220000
112300         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    11230000
112400*            MOVE ASC-ENT-ID-N     TO DK-ENT-ID                   11240000
112500*            MOVE ASC-AUDIT-NBR    TO DK-AUDIT-NBR                11250000
112600             PERFORM 2050-DELETE-LIST-QUEUE                       11260000
112700             PERFORM 4000-BUILD-INITIAL-PANEL                     11270000
112800                                                                  11280000
112900         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             11290000
113000             IF ASC-USE-SELECTION-QUEUE                           11300000
113100                 PERFORM 2300-GET-NEXT-RECORD                     11310000
113200                 IF PS-LIST-END                                   11320000
113300                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         11330000
113400                     SET PS-NO-LIST-END TO TRUE                   11340000
113500                 ELSE                                             11350000
113600                     PERFORM 2050-DELETE-LIST-QUEUE               11360000
113700                     PERFORM 3200-RESET-ATTRIBUTES                11370000
113800                     PERFORM 4000-BUILD-INITIAL-PANEL             11380000
113900                 END-IF                                           11390000
114000              ELSE                                                11400000
114100*                --- BOTTOM OF LIST ---                           11410000
114200                 MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER         11420000
114300                 SET DP020-MSG-INFORMATIONAL TO TRUE              11430000
114400             END-IF                                               11440000
114500                                                                  11450000
114600         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             11460000
114700             IF ASC-USE-SELECTION-QUEUE                           11470000
114800                 PERFORM 2310-GET-PREV-RECORD                     11480000
114900                 IF PS-LIST-END                                   11490000
115000                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         11500000
115100                     SET PS-NO-LIST-END TO TRUE                   11510000
115200                 ELSE                                             11520000
115300                     PERFORM 2050-DELETE-LIST-QUEUE               11530000
115400                     PERFORM 3200-RESET-ATTRIBUTES                11540000
115500                     PERFORM 4000-BUILD-INITIAL-PANEL             11550000
115600                 END-IF                                           11560000
115700             ELSE                                                 11570000
115800                 MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER         11580000
115900                 SET DP020-MSG-INFORMATIONAL TO TRUE              11590000
116000             END-IF                                               11600000
116100                                                                  11610000
116200         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    11620000
116300             PERFORM 2140-DESELECT-ALL-ITEMS                      11630000
116400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11640000
116500                                                                  11650000
116600         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  11660000
116700             PERFORM 2150-SELECT-ALL-ITEMS                        11670000
116800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11680000
116900                                                                  11690000
117000         WHEN OTHER                                               11700000
117100             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 11710000
117200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   11720000
117300             IF  PS-NO-ERROR                                      11730000
117400                 SET DP030-CONTINUE-GO                            11740000
117500                                 TO TRUE                          11750000
117600                 PERFORM 2100-CHECK-FUNCTION-KEY                  11760000
117700             ELSE                                                 11770000
117800                 SET DP030-OVERRIDE-GO                            11780000
117900                                 TO TRUE                          11790000
118000             END-IF                                               11800000
118100     END-EVALUATE.                                                11810000
118200/                                                                 11820000
118300*----------------------------------------------------------------*11830000
118400*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *11840000
118500*----------------------------------------------------------------*11850000
118600 2050-DELETE-LIST-QUEUE.                                          11860000
118700                                                                  11870000
118800     EXEC CICS                                                    11880000
118900         DELETEQ TS                                               11890000
119000             QUEUE (ASC-LIST-QUEUE-NAME)                          11900000
119100             RESP  (PV-CICS-RESP)                                 11910000
119200     END-EXEC.                                                    11920000
119300                                                                  11930000
119400     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       11940000
119500        (PV-CICS-RESP = DFHRESP(QIDERR))                          11950000
119600         CONTINUE                                                 11960000
119700     ELSE                                                         11970000
119800         SET DP013-CICS-ABEND      TO TRUE                        11980000
119900         SET DP013-NO-ROLLBACK     TO TRUE                        11990000
120000                                                                  12000000
120100         MOVE '2050-DELETE-LIST-QUEUE'                            12010000
120200                                   TO DP013-PARAGRAPH             12020000
120300         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    12030000
120400                                   TO DP013-MESSAGE-TEXT (1)      12040000
120500         PERFORM DP013-0000-PROCESS-ABEND                         12050000
120600     END-IF.                                                      12060000
120700                                                                  12070000
120800     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  12080000
120900/                                                                 12090000
121000*----------------------------------------------------------------*12100000
121100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*12110000
121200* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *12120000
121300* CICS ARCHITECTURE API.                                         *12130000
121400*----------------------------------------------------------------*12140000
121500 2100-CHECK-FUNCTION-KEY.                                         12150000
121600     EVALUATE TRUE                                                12160000
121700                                                                  12170000
121800* F15 - UPDATE VENDOR RANK   (LOCAL-FUNC-01)                      12180000
121900*                                                                 12190000
122000*        WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              12200000
122100*            IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              12210000
122200*                MOVE 'SUVNDRKU' TO DP008-FUNCTION-NAME           12220000
122300*                PERFORM 2105-RACF-ACCESS                         12230000
122400*                IF  PS-ACCESS-NOT-ALLOWED                        12240000
122500*                    SET  PS-ERROR                                12250000
122600*                         DP020-MSG-FATAL TO TRUE                 12260000
122700*                    MOVE PC-TSYMSG-02844 TO DP020-MSG-NUMBER     12270000
122800*                    SET  DP030-SET-CURSOR-APPL-1 TO TRUE         12280000
122900*                    SET DP030-OVERRIDE-GO       TO TRUE          12290000
123000*                END-IF                                           12300000
123100*                IF PS-NO-ERROR                                   12310000
123200*                    INITIALIZE SU029-INTER-APPL-COMMAREA         12320000
123300*                    MOVE ASC-NUMBER-OF-SELECTED-ITEMS            12330000
123400*                               TO SU029-NUMBER-OF-SELECTED-ITEMS 12340000
123500*                    PERFORM 5000-PREPARE-SEL-QUEUE               12350000
123600*                END-IF                                           12360000
123700*            ELSE                                                 12370000
123800*                SET DP030-OVERRIDE-GO                            12380000
123900*                                  TO TRUE                        12390000
124000*                MOVE PC-TSYMSG-00057                             12400000
124100*                                  TO DP020-MSG-NUMBER            12410000
124200*                SET DP020-MSG-WARNING                            12420000
124300*                                  TO TRUE                        12430000
124400*            END-IF                                               12440000
124500*                                                                 12450000
124600         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  12460000
124700             MOVE +1               TO PV-TOP-ITEM                 12470000
124800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12480000
124900                                                                  12490000
125000         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   12500000
125100             PERFORM 2110-BROWSE-BACKWARD                         12510000
125200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12520000
125300                                                                  12530000
125400         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   12540000
125500             PERFORM 2120-BROWSE-FORWARD                          12550000
125600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12560000
125700                                                                  12570000
125800         WHEN DP020-SRC-AID = DP016-ENTER                         12580000
125900             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   12590000
126000             IF  PS-ERROR                                         12600000
126100                 CONTINUE                                         12610000
126200             ELSE                                                 12620000
126300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             12630000
126400             END-IF                                               12640000
126500                                                                  12650000
126600         WHEN OTHER                                               12660000
126700             PERFORM 2050-DELETE-LIST-QUEUE                       12670000
126800             PERFORM 4000-BUILD-INITIAL-PANEL                     12680000
126900             PERFORM 3200-RESET-ATTRIBUTES                        12690000
127000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12700000
127100*            SET DP013-NO-ROLLBACK                                12710000
127200*                DP013-XCTL-DISPLAY-RESTART                       12720000
127300*                DP013-CICS-ABEND  TO TRUE                        12730000
127400*            MOVE '2100-CHECK-FUNCTION-KEY'                       12740000
127500*                                  TO DP013-PARAGRAPH             12750000
127600*            MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      12760000
127700*                                  TO DP013-MESSAGE-TEXT (1)      12770000
127800*            PERFORM DP013-0000-PROCESS-ABEND                     12780000
127900     END-EVALUATE.                                                12790000
128000                                                                  12800000
128100*----------------------------------------------------------------*12810000
128200* CHECK TO SEE IF USER HAS RACF AUTHORIZATION                     12820000
128300*----------------------------------------------------------------*12830000
128400*2105-RACF-ACCESS.                                                12840000
128500*                                                                 12850000
128600*     SET DP008-RSRC-TYPE-FUNC           TO TRUE                  12860000
128700*     SET DP008-ACCESS-TYPE-USE          TO TRUE                  12870000
128800*                                                                 12880000
128900*     EXEC CICS                                                   12890000
129000*        LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                 12900000
129100*             COMMAREA (DP008-SECURITY-COMMAREA)                  12910000
129200*             LENGTH (DP008-SECURITY-COMMAREA-LENGTH)             12920000
129300*     END-EXEC                                                    12930000
129400*                                                                 12940000
129500*     IF DP008-CALL-SUCCESSFUL                                    12950000
129600*        IF DP008-ACCESS-ALLOWED                                  12960000
129700*            SET PS-ACCESS-ALLOWED TO TRUE                        12970000
129800*        ELSE                                                     12980000
129900*            SET PS-ACCESS-NOT-ALLOWED TO TRUE                    12990000
130000*        END-IF                                                   13000000
130100*    ELSE                                                         13010000
130200*        MOVE '2105-RACF-ACCESS'                                  13020000
130300*                              TO DP013-PARAGRAPH                 13030000
130400*         MOVE 'UNABLE TO ACCESS CICS'                            13040000
130500*                              TO DP013-MESSAGE-TEXT (1)          13050000
130600*         MOVE SQLCA                 TO DP013-SQLCA               13060000
130700*         SET DP013-DB2-ABEND                                     13070000
130800*             DP013-XCTL-DISPLAY-RESTART                          13080000
130900*                              TO TRUE                            13090000
131000*         PERFORM DP013-0000-PROCESS-ABEND                        13100000
131100*     END-IF.                                                     13110000
131200                                                                  13120000
131300*                                                                 13130000
131400*----------------------------------------------------------------*13140000
131500*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *13150000
131600*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *13160000
131700*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *13170000
131800*    MESSAGE.                                                    *13180000
131900*----------------------------------------------------------------*13190000
132000                                                                  13200000
132100 2110-BROWSE-BACKWARD.                                            13210000
132200     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    13220000
132300         GIVING PV-TOP-ITEM.                                      13230000
132400*                                                                 13240000
132500     IF  ((PV-TOP-ITEM < +1)                                      13250000
132600       OR (PV-TOP-ITEM = +1))                                     13260000
132700         MOVE +1                   TO PV-TOP-ITEM                 13270000
132800*        -- TOP OF LIST --                                        13280000
132900         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            13290000
133000         SET DP020-MSG-INFORMATIONAL TO TRUE                      13300000
133100     END-IF.                                                      13310000
133200                                                                  13320000
133300/                                                                 13330000
133400*----------------------------------------------------------------*13340000
133500*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *13350000
133600*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *13360000
133700*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *13370000
133800*----------------------------------------------------------------*13380000
133900                                                                  13390000
134000 2120-BROWSE-FORWARD.                                             13400000
134100                                                                  13410000
134200     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              13420000
134300         GIVING PV-TOP-ITEM.                                      13430000
134400     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   13440000
134500         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            13450000
134600                                   TO PV-TOP-ITEM                 13460000
134700*        -- BOTTOM OF LIST --                                     13470000
134800         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            13480000
134900         SET DP020-MSG-INFORMATIONAL                              13490000
135000                                   TO TRUE                        13500000
135100     ELSE                                                         13510000
135200         COMPUTE PV-BOTTOM-ITEM =                                 13520000
135300             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 13530000
135400         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            13540000
135500*            -- BOTTOM OF LIST --                                 13550000
135600             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            13560000
135700             SET DP020-MSG-INFORMATIONAL                          13570000
135800                                   TO TRUE                        13580000
135900         END-IF                                                   13590000
136000     END-IF.                                                      13600000
136100/                                                                 13610000
136200*----------------------------------------------------------------*13620000
136300*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *13630000
136400*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *13640000
136500*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *13650000
136600*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *13660000
136700*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *13670000
136800*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *13680000
136900*----------------------------------------------------------------*13690000
137000                                                                  13700000
137100 2130-CHECK-FOR-JUMP-BROWSE.                                      13710000
137200     SET PS-NO-ERROR               TO TRUE.                       13720000
137300     IF (ASC-START-ITEM-REQUEST = SPACE)                          13730000
137400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            13740000
137500                                   TO PV-TOP-ITEM                 13750000
137600     ELSE                                                         13760000
137700         MOVE ASC-START-ITEM-REQUEST                              13770000
137800                                   TO DP010I-UNEDITED-FIELD       13780000
137900         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       13790000
138000         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     13800000
138100         SET DP010I-NEGATIVE-NOT-ALLOWED                          13810000
138200                                   TO TRUE                        13820000
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                         13831012
263968              USING DP010I-NUMERIC-EDIT-AREA                      13832012
138400                                                                  13840000
138500         IF  NOT DP010I-ERROR-DETECTED                            13850000
138600             MOVE DP010I-NUMERIC-FIELD                            13860000
138700                                   TO  ASC-START-ITEM-REQUEST-N   13870000
138800             IF  ASC-START-ITEM-REQUEST-N > ZERO                  13880000
138900                 IF  ASC-START-ITEM-REQUEST-N >                   13890000
139000                                          ASC-NUMBER-OF-ITEMS-READ13900000
139100                     MOVE SPACE TO ASC-START-ITEM-REQUEST         13910000
139200                     COMPUTE PV-TOP-ITEM =                        13920000
139300                             ASC-NUMBER-OF-ITEMS-READ             13930000
139400                             - PC-ITEMS-PER-PANEL + 1             13940000
139500                     IF  PV-TOP-ITEM < +1                         13950000
139600                         MOVE +1   TO PV-TOP-ITEM                 13960000
139700                         MOVE PC-TSYMSG-00070                     13970000
139800                                   TO DP020-MSG-NUMBER            13980000
139900                         SET DP020-MSG-INFORMATIONAL              13990000
140000                                   TO TRUE                        14000000
140100                     END-IF                                       14010000
140200                 ELSE                                             14020000
140300                     MOVE ASC-START-ITEM-REQUEST-N                14030000
140400                                   TO PV-TOP-ITEM                 14040000
140500                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      14050000
140600                     COMPUTE PV-BOTTOM-ITEM =                     14060000
140700                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     14070000
140800                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ14080000
140900*                        -- BOTTOM OF LIST --                     14090000
141000                         MOVE PC-TSYMSG-00070                     14100000
141100                                   TO DP020-MSG-NUMBER            14110000
141200                         SET DP020-MSG-INFORMATIONAL              14120000
141300                                   TO TRUE                        14130000
141400                     END-IF                                       14140000
141500                 END-IF                                           14150000
141600             ELSE                                                 14160000
141700*                --- VALUE OUT OF RANGE ----                      14170000
141800                 MOVE PC-TSYMSG-00101                             14180000
141900                                   TO DP020-MSG-NUMBER            14190000
142000                 MOVE -1           TO ASTRTITL                    14200000
142100                 SET DP030-SET-CURSOR-APPL-1                      14210000
142200                                   TO TRUE                        14220000
142300                 MOVE DP015-REVERSE                               14230000
142400                                   TO ASTRTITH                    14240000
142500                 MOVE DP015-RED    TO ASTRTITC                    14250000
142600                 MOVE DP015-UNP-NUM-BRT-MDT                       14260000
142700                                   TO ASTRTITA                    14270000
142800                 SET DP020-MSG-FATAL                              14280000
142900                                   TO TRUE                        14290000
143000                 SET PS-ERROR      TO TRUE                        14300000
143100             END-IF                                               14310000
143200                                                                  14320000
143300         ELSE                                                     14330000
143400             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            14340000
143500             MOVE -1               TO ASTRTITL                    14350000
143600             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  14360000
143700             MOVE DP015-REVERSE    TO ASTRTITH                    14370000
143800             MOVE DP015-RED        TO ASTRTITC                    14380000
143900             MOVE DP015-UNP-NUM-BRT-MDT                           14390000
144000                                   TO ASTRTITA                    14400000
144100             SET DP020-MSG-FATAL   TO TRUE                        14410000
144200             SET PS-ERROR          TO TRUE                        14420000
144300         END-IF                                                   14430000
144400     END-IF.                                                      14440000
144500/                                                                 14450000
144600*----------------------------------------------------------------*14460000
144700*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *14470000
144800*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *14480000
144900*----------------------------------------------------------------*14490000
145000 2140-DESELECT-ALL-ITEMS.                                         14500000
145100     MOVE +1                       TO ASC-BLK-SUB.                14510000
145200                                                                  14520000
145300     PERFORM 2141-CLEAR-SELECTED-INDS                             14530000
145400         VARYING ASC-ITEM-SUB                                     14540000
145500         FROM 1 BY 1                                              14550000
145600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14560000
145700                                                                  14570000
145800     ADD +1                        TO ASC-BLK-SUB.                14580000
145900                                                                  14590000
146000     PERFORM 2141-CLEAR-SELECTED-INDS                             14600000
146100         VARYING ASC-ITEM-SUB                                     14610000
146200         FROM 1 BY 1                                              14620000
146300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14630000
146400                                                                  14640000
146500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               14650000
146600                                   TO PV-LIST-ITEM-NUMBER.        14660000
146700                                                                  14670000
146800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            14680000
146900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    14690000
147000                                                                  14700000
147100     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     14710000
147200        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      14720000
147300         MOVE +1                   TO ASC-BLK-SUB                 14730000
147400                                                                  14740000
147500         PERFORM 5100-WRITE-TEMP-STORAGE                          14750000
147600                                                                  14760000
147700         MOVE +1                   TO PV-BLOCK-NUMBER             14770000
147800                                                                  14780000
147900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         14790000
148000             PV-FIRST-BLOCK-IN-ARRAY - 1                          14800000
148100                                                                  14810000
148200         PERFORM                                                  14820000
148300             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       14830000
148400                                                                  14840000
148500             PERFORM 4410-READ-TEMP-STORAGE                       14850000
148600                                                                  14860000
148700             PERFORM 2141-CLEAR-SELECTED-INDS                     14870000
148800                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 14880000
148900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14890000
149000                                                                  14900000
149100             PERFORM 5100-WRITE-TEMP-STORAGE                      14910000
149200                                                                  14920000
149300             ADD +1                TO PV-BLOCK-NUMBER             14930000
149400                                                                  14940000
149500         END-PERFORM                                              14950000
149600                                                                  14960000
149700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         14970000
149800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     14980000
149900                                                                  14990000
150000         PERFORM                                                  15000000
150100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15010000
150200                   ASC-HIGHEST-BLOCK-WRITTEN                      15020000
150300                                                                  15030000
150400             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15040000
150500                                   TO PV-BLOCK-NUMBER             15050000
150600                                                                  15060000
150700             PERFORM 4410-READ-TEMP-STORAGE                       15070000
150800                                                                  15080000
150900             PERFORM 2141-CLEAR-SELECTED-INDS                     15090000
151000                 VARYING ASC-ITEM-SUB                             15100000
151100                 FROM 1 BY 1                                      15110000
151200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15120000
151300                                                                  15130000
151400             PERFORM 5100-WRITE-TEMP-STORAGE                      15140000
151500                                                                  15150000
151600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      15160000
151700                                                                  15170000
151800         END-PERFORM                                              15180000
151900                                                                  15190000
152000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             15200000
152100                                   TO PV-BLOCK-NUMBER             15210000
152200                                                                  15220000
152300         PERFORM 4410-READ-TEMP-STORAGE                           15230000
152400     END-IF.                                                      15240000
152500                                                                  15250000
152600                                                                  15260000
152700     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 15270000
152800     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.15280000
152900     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  15290000
153000                                                                  15300000
153100     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        15310000
153200                                                                  15320000
153300/                                                                 15330000
153400*----------------------------------------------------------------*15340000
153500*    MARK EACH ITEM AS BEING NOT SELECTED.                       *15350000
153600*----------------------------------------------------------------*15360000
153700                                                                  15370000
153800 2141-CLEAR-SELECTED-INDS.                                        15380000
153900                                                                  15390000
154000     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           15400000
154100             NOT EQUAL ZERO                                       15410000
154200         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15420000
154300             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15430000
154400                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    15440000
154500                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  15450000
154600                                   TO TRUE                        15460000
154700         END-IF                                                   15470000
154800     END-IF.                                                      15480000
154900                                                                  15490000
155000/                                                                 15500000
155100*----------------------------------------------------------------*15510000
155200*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *15520000
155300*  FOR ALL ITEMS.                                                *15530000
155400*----------------------------------------------------------------*15540000
155500                                                                  15550000
155600 2150-SELECT-ALL-ITEMS.                                           15560000
155700                                                                  15570000
155800     MOVE +1                       TO ASC-BLK-SUB.                15580000
155900                                                                  15590000
156000     PERFORM 2151-SET-SELECTED-INDS                               15600000
156100         VARYING ASC-ITEM-SUB                                     15610000
156200         FROM 1 BY 1                                              15620000
156300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15630000
156400                                                                  15640000
156500     ADD +1                        TO ASC-BLK-SUB.                15650000
156600                                                                  15660000
156700     PERFORM 2151-SET-SELECTED-INDS                               15670000
156800         VARYING ASC-ITEM-SUB                                     15680000
156900         FROM 1 BY 1                                              15690000
157000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15700000
157100                                                                  15710000
157200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15720000
157300                                   TO PV-LIST-ITEM-NUMBER.        15730000
157400                                                                  15740000
157500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15750000
157600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    15760000
157700                                                                  15770000
157800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     15780000
157900        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    15790000
158000         MOVE +1                   TO ASC-BLK-SUB                 15800000
158100                                                                  15810000
158200         PERFORM 5100-WRITE-TEMP-STORAGE                          15820000
158300                                                                  15830000
158400         MOVE +1                   TO PV-BLOCK-NUMBER             15840000
158500                                                                  15850000
158600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15860000
158700             PV-FIRST-BLOCK-IN-ARRAY - 1                          15870000
158800                                                                  15880000
158900         PERFORM                                                  15890000
159000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       15900000
159100                                                                  15910000
159200             PERFORM 4410-READ-TEMP-STORAGE                       15920000
159300                                                                  15930000
159400             PERFORM 2151-SET-SELECTED-INDS                       15940000
159500                 VARYING ASC-ITEM-SUB                             15950000
159600                 FROM 1 BY 1                                      15960000
159700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15970000
159800                                                                  15980000
159900             PERFORM 5100-WRITE-TEMP-STORAGE                      15990000
160000                                                                  16000000
160100             ADD +1                TO PV-BLOCK-NUMBER             16010000
160200                                                                  16020000
160300         END-PERFORM                                              16030000
160400                                                                  16040000
160500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         16050000
160600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     16060000
160700                                                                  16070000
160800         PERFORM                                                  16080000
160900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       16090000
161000                   ASC-HIGHEST-BLOCK-WRITTEN                      16100000
161100                                                                  16110000
161200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          16120000
161300                                   TO PV-BLOCK-NUMBER             16130000
161400                                                                  16140000
161500             PERFORM 4410-READ-TEMP-STORAGE                       16150000
161600                                                                  16160000
161700             PERFORM 2151-SET-SELECTED-INDS                       16170000
161800                 VARYING ASC-ITEM-SUB                             16180000
161900                 FROM 1 BY 1                                      16190000
162000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16200000
162100                                                                  16210000
162200             PERFORM 5100-WRITE-TEMP-STORAGE                      16220000
162300                                                                  16230000
162400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16240000
162500                                                                  16250000
162600         END-PERFORM                                              16260000
162700                                                                  16270000
162800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             16280000
162900                                   TO PV-BLOCK-NUMBER             16290000
163000                                                                  16300000
163100         PERFORM 4410-READ-TEMP-STORAGE                           16310000
163200     END-IF.                                                      16320000
163300                                                                  16330000
163400                                                                  16340000
163500     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             16350000
163600                       ASC-NUMBER-OF-SELECTED-ITEMS.              16360000
163700                                                                  16370000
163800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        16380000
163900                                                                  16390000
164000/                                                                 16400000
164100*----------------------------------------------------------------*16410000
164200*    MARK EACH ITEM AS BEING SELECTED.                           *16420000
164300*----------------------------------------------------------------*16430000
164400                                                                  16440000
164500 2151-SET-SELECTED-INDS.                                          16450000
164600                                                                  16460000
164700     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           16470000
164800             NOT EQUAL ZERO                                       16480000
164900         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             16490000
165000             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             16500000
165100                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        16510000
165200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  16520000
165300                               TO  TRUE                           16530000
165400         END-IF                                                   16540000
165500     END-IF.                                                      16550000
165600******************************************************************16560000
165700** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **16570000
165800** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **16580000
165900******************************************************************16590000
166000 2200-MOVE-SCREEN-TO-COMMAREA.                                    16600000
166100                                                                  16610000
166200     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             16620000
166300     MOVE +1                       TO PV-SUB.                     16630000
166400*                                                                 16640000
166500     PERFORM 3100-SET-SUBSCRIPTS.                                 16650000
166600     IF  ASTRTITL > ZERO                                          16660000
166700         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          16670000
166800     ELSE                                                         16680000
166900         IF  ASTRTITF = DP015-ERASE-EOF                           16690000
167000             INITIALIZE ASC-START-ITEM-REQUEST                    16700000
167100         END-IF                                                   16710000
167200     END-IF.                                                      16720000
167300******************************************************************16730000
167400** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**16740000
167500******************************************************************16750000
167600 2300-GET-NEXT-RECORD.                                            16760000
167700     ADD +1                        TO ASC-SEL-SUB.                16770000
167800     IF  ASC-SEL-SUB > SU030-MAX-ITEMS                            16780000
167900         ADD +1                    TO ASC-SEL-ITEM                16790000
168000         MOVE +1                   TO ASC-SEL-SUB                 16800000
168100     END-IF.                                                      16810000
168200     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                16820000
168300         PERFORM 9100-READ-SEL-QUEUE                              16830000
168400         IF  SU030-ITEM (ASC-SEL-SUB) > ZERO                      16840000
168500             MOVE SU030-UPC-NBR (ASC-SEL-SUB)                     16850000
168600                                   TO ASC-UPC-NBR                 16860000
168610             MOVE SU030-INTR-UPC (ASC-SEL-SUB)                    16861000
168620                                   TO ASC-INTR-UPC                16862000
168700             SET SU030-INQ (ASC-SEL-SUB)                          16870000
168800                                   TO TRUE                        16880000
168900             PERFORM 9200-REWRITE-LIST-QUEUE                      16890000
169000         ELSE                                                     16900000
169100             SUBTRACT +1 FROM ASC-SEL-SUB                         16910000
169200*            --- BOTTOM OF LIST ---                               16920000
169300             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            16930000
169400             SET DP020-MSG-INFORMATIONAL                          16940000
169500                                   TO TRUE                        16950000
169600         END-IF                                                   16960000
169700     ELSE                                                         16970000
169800         SUBTRACT +1 FROM ASC-SEL-ITEM                            16980000
169900         MOVE SU030-MAX-ITEMS      TO ASC-SEL-SUB                 16990000
170000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            17000000
170100         SET DP020-MSG-INFORMATIONAL                              17010000
170200                                   TO TRUE                        17020000
170300     END-IF.                                                      17030000
170400                                                                  17040000
170500 2310-GET-PREV-RECORD.                                            17050000
170600     SUBTRACT +1                 FROM ASC-SEL-SUB.                17060000
170700     IF ASC-SEL-SUB < +1                                          17070000
170800         SUBTRACT +1             FROM ASC-SEL-ITEM                17080000
170900         MOVE SU030-MAX-ITEMS      TO ASC-SEL-SUB                 17090000
171000     END-IF.                                                      17100000
171100                                                                  17110000
171200     MOVE SU029-SEL-QUEUE-NAME     TO ASC-SEL-QUEUE-NAME-IN       17120000
171300     IF ASC-SEL-ITEM > ZERO                                       17130000
171400         PERFORM 9100-READ-SEL-QUEUE                              17140000
171500         MOVE SU030-UPC-NBR(ASC-SEL-SUB)                          17150000
171600                                      TO ASC-UPC-NBR              17160000
171610         MOVE SU030-INTR-UPC (ASC-SEL-SUB)                        17161000
171620                                   TO ASC-INTR-UPC                17162000
171700         SET SU030-INQ (ASC-SEL-SUB) TO TRUE                      17170000
171800         PERFORM 5120-REWRITE-LIST-QUEUE                          17180000
171900     ELSE                                                         17190000
172000             MOVE +1 TO  ASC-SEL-SUB                              17200000
172100                         ASC-SEL-ITEM                             17210000
172200*            --- TOP OF LIST ---                                  17220000
172300             MOVE PC-TSYMSG-00069  TO DP020-MSG-NUMBER            17230000
172400             SET DP020-MSG-INFORMATIONAL                          17240000
172500                                   TO TRUE                        17250000
172600     END-IF.                                                      17260000
172700                                                                  17270000
172800******************************************************************17280000
172900** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **17290000
173000** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **17300000
173100******************************************************************17310000
173200 3000-EDIT-DATA-IN-COMMAREA.                                      17320000
173300     SET PS-NO-ERROR               TO TRUE.                       17330000
173400     PERFORM 3200-RESET-ATTRIBUTES.                               17340000
173500     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     17350000
173600**                                                                17360000
173700* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              17370000
173800* EDITTING IS DONE FROM THE BOTTOM UP.                            17380000
173900**                                                                17390000
174000     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       17400000
174100         ASC-ITEMS-DISPLAYED - 1.                                 17410000
174200     PERFORM 3100-SET-SUBSCRIPTS.                                 17420000
174300     PERFORM 3300-EDIT-SELECTIONS                                 17430000
174400         VARYING PV-SUB                                           17440000
174500         FROM PV-SUB BY -1                                        17450000
174600         UNTIL PV-SUB < +1                                        17460000
174700*                                                                 17470000
174800     IF  PS-NO-ERROR                                              17480000
174900         PERFORM 3400-CHECK-RANGE-SEQUENCE                        17490000
175000     END-IF.                                                      17500000
175100*                                                                 17510000
175200     IF  ((PS-NO-ERROR)                                           17520000
175300       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   17530000
175400       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    17540000
175500             PERFORM 3500-MARK-RANGE-AS-SELECTED                  17550000
175600     END-IF.                                                      17560000
175700/                                                                 17570000
175800*----------------------------------------------------------------*17580000
175900*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *17590000
176000*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*17600000
176100*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *17610000
176200*                                                                *17620000
176300*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *17630000
176400*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *17640000
176500*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *17650000
176600*    US IN THE 2ND BLOCK OF THE ARRAY.                           *17660000
176700*----------------------------------------------------------------*17670000
176800                                                                  17680000
176900 3100-SET-SUBSCRIPTS.                                             17690000
177000                                                                  17700000
177100     COMPUTE ASC-ITEM-SUB =                                       17710000
177200         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        17720000
177300                                                                  17730000
177400     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         17740000
177500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            17750000
177600                                                                  17760000
177700         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               17770000
177800     ELSE                                                         17780000
177900         MOVE +1                     TO ASC-BLK-SUB               17790000
178000     END-IF.                                                      17800000
178100******************************************************************17810000
178200** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **17820000
178300******************************************************************17830000
178400                                                                  17840000
178500 3200-RESET-ATTRIBUTES.                                           17850000
178600     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   17860000
178700     MOVE DP015-GREEN              TO ASTRTITC.                   17870000
178800     MOVE DP015-UNDERLINE          TO ASTRTITH.                   17880000
178900*                                                                 17890000
179000******************************************************************17900000
179100** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **17910000
179200** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **17920000
179300** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **17930000
179400** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **17940000
179500******************************************************************17950000
179600 3300-EDIT-SELECTIONS.                                            17960000
179700     EVALUATE TRUE                                                17970000
179800         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     17980000
179900             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         17990000
180000                 CONTINUE                                         18000000
180100         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         18010000
180200             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        18020000
180300                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   18030000
180400                 MOVE ASC-TEMP-SELECTED-SW                        18040000
180500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18050000
180600                                TO ASC-SELECTED-SW                18060000
180700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18070000
180800             END-IF                                               18080000
180900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     18090000
181000                 = SPACE                                          18100000
181100             EVALUATE TRUE                                        18110000
181200                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       18120000
181300                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS18130000
181400                     MOVE SPACE TO ASC-SELECTED-SW                18140000
181500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18150000
181600                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        18160000
181700                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    18170000
181800                     MOVE SPACE TO ASC-SELECTED-SW                18180000
181900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18190000
182000                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          18200000
182100                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      18210000
182200                     MOVE SPACE TO ASC-SELECTED-SW                18220000
182300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18230000
182400             END-EVALUATE                                         18240000
182500         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           18250000
182600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            18260000
182700                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    18270000
182800             END-IF                                               18280000
182900             PERFORM 3310-EDIT-RANGE                              18290000
183000         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             18300000
183100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            18310000
183200                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    18320000
183300             END-IF                                               18330000
183400             PERFORM 3310-EDIT-RANGE                              18340000
183500         WHEN OTHER                                               18350000
183600             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           18360000
183700             SET DP020-MSG-FATAL    TO TRUE                       18370000
183800             SET DP030-SET-CURSOR-APPL-1                          18380000
183900                                    TO TRUE                       18390000
184000             SET PS-ERROR TO TRUE                                 18400000
184100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            18410000
184200                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     18420000
184300                 MOVE SPACE         TO ASC-SELECTED-SW            18430000
184400                                        (ASC-BLK-SUB ASC-ITEM-SUB)18440000
184500             END-IF                                               18450000
184600     END-EVALUATE.                                                18460000
184700                                                                  18470000
184800     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 18480000
184900     SUBTRACT +1 FROM ASC-ITEM-SUB.                               18490000
185000     IF  ASC-ITEM-SUB < 1                                         18500000
185100         SUBTRACT +1 FROM ASC-BLK-SUB                             18510000
185200         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                18520000
185300     END-IF.                                                      18530000
185400******************************************************************18540000
185500** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **18550000
185600** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **18560000
185700** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**18570000
185800** THE ENDING.                                                  **18580000
185900******************************************************************18590000
186000 3310-EDIT-RANGE.                                                 18600000
186100     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                18610000
186200         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   18620000
186300             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)18630000
186400                                   TO ASC-SELECTED-SW             18640000
186500                                        (ASC-BLK-SUB ASC-ITEM-SUB)18650000
186600             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 18660000
186700         ELSE                                                     18670000
186800             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     18680000
186900                 CONTINUE                                         18690000
187000             ELSE                                                 18700000
187100*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        18710000
187200                 MOVE PC-TSYMSG-00054                             18720000
187300                                   TO DP020-MSG-NUMBER            18730000
187400                 SET DP020-MSG-FATAL                              18740000
187500                                   TO TRUE                        18750000
187600                 SET DP030-SET-CURSOR-APPL-1                      18760000
187700                                   TO TRUE                        18770000
187800                 SET PS-ERROR      TO TRUE                        18780000
187900             END-IF                                               18790000
188000         END-IF                                                   18800000
188100     ELSE                                                         18810000
188200         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     18820000
188300             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 18830000
188400                                   TO ASC-SELECTED-SW             18840000
188500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   18850000
188600             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   18860000
188700         ELSE                                                     18870000
188800             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       18880000
188900                 CONTINUE                                         18890000
189000             ELSE                                                 18900000
189100*                -- ONLY ONE END-OF-RANGE ALLOWED --              18910000
189200                 MOVE PC-TSYMSG-00055                             18920000
189300                                   TO DP020-MSG-NUMBER            18930000
189400                 SET DP020-MSG-FATAL                              18940000
189500                                   TO TRUE                        18950000
189600                 SET DP030-SET-CURSOR-APPL-1                      18960000
189700                                   TO TRUE                        18970000
189800                 SET PS-ERROR      TO TRUE                        18980000
189900             END-IF                                               18990000
190000         END-IF                                                   19000000
190100     END-IF.                                                      19010000
190200*                                                                 19020000
190300******************************************************************19030000
190400** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **19040000
190500** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **19050000
190600******************************************************************19060000
190700 3400-CHECK-RANGE-SEQUENCE.                                       19070000
190800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       19080000
190900       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      19090000
191000       AND  ASC-START-OF-SELECTED-RANGE >                         19100000
191100                                         ASC-END-OF-SELECTED-RANGE19110000
191200*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                19120000
191300         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 19130000
191400         SET DP020-MSG-FATAL TO TRUE                              19140000
191500         SET PS-ERROR TO TRUE                                     19150000
191600     END-IF.                                                      19160000
191700*----------------------------------------------------------------*19170000
191800*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *19180000
191900*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *19190000
192000*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *19200000
192100*----------------------------------------------------------------*19210000
192200                                                                  19220000
192300 3500-MARK-RANGE-AS-SELECTED.                                     19230000
192400     MOVE +1                       TO  ASC-BLK-SUB.               19240000
192500     PERFORM 3510-MARK-SELECTED-INDS                              19250000
192600         VARYING ASC-ITEM-SUB                                     19260000
192700         FROM 1 BY 1                                              19270000
192800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19280000
192900                                                                  19290000
193000     ADD +1                        TO ASC-BLK-SUB.                19300000
193100     PERFORM 3510-MARK-SELECTED-INDS                              19310000
193200         VARYING ASC-ITEM-SUB                                     19320000
193300         FROM 1 BY 1                                              19330000
193400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19340000
193500                                                                  19350000
193600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               19360000
193700                                   TO  PV-LIST-ITEM-NUMBER.       19370000
193800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            19380000
193900         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         19390000
194000               PC-ITEMS-PER-PANEL).                               19400000
194100                                                                  19410000
194200     MOVE ASC-START-OF-SELECTED-RANGE                             19420000
194300                                   TO PV-START-OF-SELECTED-RANGE. 19430000
194400     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            19440000
194500         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  19450000
194600               PC-ITEMS-PER-PANEL).                               19460000
194700                                                                  19470000
194800     MOVE ASC-END-OF-SELECTED-RANGE                               19480000
194900                                   TO  PV-END-OF-SELECTED-RANGE.  19490000
195000     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             19500000
195100         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    19510000
195200               PC-ITEMS-PER-PANEL).                               19520000
195300     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             19530000
195400         PV-FIRST-BLOCK-IN-ARRAY + 1.                             19540000
195500                                                                  19550000
195600     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    19560000
195700        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        19570000
195800         MOVE +1                   TO ASC-BLK-SUB                 19580000
195900         PERFORM 5100-WRITE-TEMP-STORAGE                          19590000
196000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         19600000
196100             PV-FIRST-BLOCK-IN-ARRAY - 1                          19610000
196200                                                                  19620000
196300         PERFORM                                                  19630000
196400             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      19640000
196500                   PV-PREV-BLOCK-IN-ARRAY                         19650000
196600             MOVE PV-FIRST-BLOCK-IN-RANGE                         19660000
196700                                   TO PV-BLOCK-NUMBER             19670000
196800             PERFORM 4410-READ-TEMP-STORAGE                       19680000
196900             PERFORM 3510-MARK-SELECTED-INDS                      19690000
197000                 VARYING ASC-ITEM-SUB                             19700000
197100                 FROM 1 BY 1                                      19710000
197200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19720000
197300             PERFORM 5100-WRITE-TEMP-STORAGE                      19730000
197400             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     19740000
197500         END-PERFORM                                              19750000
197600                                                                  19760000
197700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         19770000
197800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     19780000
197900         PERFORM                                                  19790000
198000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       19800000
198100                   PV-LAST-BLOCK-IN-RANGE                         19810000
198200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          19820000
198300                                   TO PV-BLOCK-NUMBER             19830000
198400             PERFORM 4410-READ-TEMP-STORAGE                       19840000
198500             PERFORM 3510-MARK-SELECTED-INDS                      19850000
198600                 VARYING ASC-ITEM-SUB                             19860000
198700                 FROM 1 BY 1                                      19870000
198800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19880000
198900             PERFORM 5100-WRITE-TEMP-STORAGE                      19890000
199000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      19900000
199100         END-PERFORM                                              19910000
199200                                                                  19920000
199300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             19930000
199400                                   TO PV-BLOCK-NUMBER             19940000
199500         PERFORM 4410-READ-TEMP-STORAGE                           19950000
199600     END-IF.                                                      19960000
199700                                                                  19970000
199800     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 19980000
199900                                      ASC-END-OF-SELECTED-RANGE.  19990000
200000                                                                  20000000
200100/                                                                 20010000
200200*----------------------------------------------------------------*20020000
200300* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *20030000
200400*----------------------------------------------------------------*20040000
200500                                                                  20050000
200600 3510-MARK-SELECTED-INDS.                                         20060000
200700                                                                  20070000
200800     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         20080000
200900                                ASC-ITEM-SUB) >                   20090000
201000         ASC-START-OF-SELECTED-RANGE)                             20100000
201100     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         20110000
201200                                ASC-ITEM-SUB) =                   20120000
201300         ASC-START-OF-SELECTED-RANGE)                             20130000
201400                                                                  20140000
201500         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     20150000
201600                                    ASC-ITEM-SUB) <               20160000
201700             ASC-END-OF-SELECTED-RANGE)                           20170000
201800         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     20180000
201900                                    ASC-ITEM-SUB) =               20190000
202000             ASC-END-OF-SELECTED-RANGE)                           20200000
202100                                                                  20210000
202200             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          20220000
202300                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   20230000
202400                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   20240000
202500                               TO TRUE                            20250000
202600                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              20260000
202700                               TO TRUE                            20270000
202800                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    20280000
202900             END-IF                                               20290000
203000         END-IF                                                   20300000
203100     END-IF.                                                      20310000
203200                                                                  20320000
203300/                                                                 20330000
203400*----------------------------------------------------------------*20340000
203500*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *20350000
203600*    INITIALIZE ALL COUNTERS AND FLAGS.                          *20360000
203700*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *20370000
203800*    DISPLAY THE PANEL TO USER.                                  *20380000
203900*----------------------------------------------------------------*20390000
204000                                                                  20400000
204100 4000-BUILD-INITIAL-PANEL.                                        20410000
204200                                                                  20420000
204300     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            20430000
204400                                 ASC-BLOCK-ENTRIES (2).           20440000
204500     MOVE +1                 TO ASC-BLK-SUB.                      20450000
204600     SET ASC-ITEMS-LEFT-ON-DB                                     20460000
204700                             TO TRUE.                             20470000
204800                                                                  20480000
204900     MOVE +0                 TO ASC-ITEM-SUB                      20490000
205000                                ASC-NUMBER-OF-ITEMS-READ          20500000
205100                                ASC-NUMBER-OF-SELECTED-ITEMS      20510000
205200                                ASC-HIGHEST-BLOCK-WRITTEN         20520000
205300                                ASC-START-OF-SELECTED-RANGE       20530000
205400                                ASC-END-OF-SELECTED-RANGE         20540000
205500                                ASC-ITEM-AT-TOP-OF-PANEL.         20550000
205600     PERFORM 4100-PREPARE-CURSOR.                                 20560000
205700     PERFORM 4010-OPEN-CURSOR.                                    20570000
205800                                                                  20580000
205900     PERFORM 4300-READ-ITEMS-FROM-DB.                             20590000
206000                                                                  20600000
206100     PERFORM 4020-CLOSE-CURSOR.                                   20610000
206200                                                                  20620000
206300     MOVE +1                   TO  PV-TOP-ITEM.                   20630000
206400     MOVE -1                   TO  ASTRTITL.                      20640000
206500     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          20650000
206600         IF DP020-FK-PREV-SELECTION (DP020-SRC-AID) OR            20660000
206700            DP020-FK-NEXT-SELECTION (DP020-SRC-AID)               20670000
206800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 20680000
206900         ELSE                                                     20690000
207000             SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                20700000
207100         END-IF                                                   20710000
207200         SET DP020-MSG-FATAL   TO  TRUE                           20720000
207300         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               20730000
207400     ELSE                                                         20740000
207500         SET DP030-SET-CURSOR-APPL-1                              20750000
207600                               TO TRUE                            20760000
207700         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     20770000
207800     END-IF.                                                      20780000
207900/                                                                 20790000
208000*----------------------------------------------------------------*20800000
208100* OPEN THE AUDIT DETAIL CURSOR.                                  *20810000
208200*----------------------------------------------------------------*20820000
208300                                                                  20830000
208400 4010-OPEN-CURSOR.                                                20840000
208500     PERFORM                                                      20850000
208600         WITH TEST AFTER                                          20860000
208700         VARYING PV-RETRY-COUNTER                                 20870000
208800         FROM 1 BY 1                                              20880000
208900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               20890000
209000                   OR (SQLCODE = ZERO))                           20900000
209100             MOVE 'CURSOR:  CTN-ERROR-CSR'                        20910000
209200                               TO DP013-MESSAGE-TEXT (2)          20920000
209300         EXEC SQL                                                 20930000
209400              OPEN ITEM-CSR                                       20940000
209500         END-EXEC                                                 20950000
209600                                                                  20960000
209700         EVALUATE TRUE                                            20970000
209800             WHEN SQLCODE = ZERO                                  20980000
209900             WHEN SQLCODE = -904                                  20990000
210000             WHEN SQLCODE = -913                                  21000000
210100                 CONTINUE                                         21010000
210200             WHEN SQLWARN0 NOT = SPACES                           21020000
210300             WHEN SQLCODE < ZERO                                  21030000
210400             WHEN SQLCODE > ZERO                                  21040000
210500                 MOVE '4010-OPEN-CURSOR'                          21050000
210600                                   TO DP013-PARAGRAPH             21060000
210700                 MOVE 'OPEN AUDIT DETAIL CURSOR - '               21070000
210800                                   TO DP013-MESSAGE-TEXT (1)      21080000
210900                 MOVE SQLCA        TO DP013-SQLCA                 21090000
211000                 MOVE 'TSUAUPC '  TO DP013-DB2-TABLE-NAME (1)     21100000
211100                 MOVE 'TSHUUPC '  TO DP013-DB2-TABLE-NAME (2)     21110000
211200                 SET DP013-DB2-ABEND                              21120000
211300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           21130000
211400                 PERFORM DP013-0000-PROCESS-ABEND                 21140000
211500         END-EVALUATE                                             21150000
211600     END-PERFORM.                                                 21160000
211700*                                                                 21170000
211800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21180000
211900         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             21190000
212000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   21200000
212100                                   TO DP013-MESSAGE-TEXT (1)      21210000
212200         MOVE SQLCA                TO DP013-SQLCA                 21220000
212300         MOVE 'TSUAUPC '  TO DP013-DB2-TABLE-NAME (1)             21230000
212400         MOVE 'TSHUUPC '  TO DP013-DB2-TABLE-NAME (2)             21240000
212500         SET DP013-DB2-ABEND                                      21250000
212600             DP013-XCTL-DISPLAY-RESTART                           21260000
212700                                   TO TRUE                        21270000
212800         PERFORM DP013-0000-PROCESS-ABEND                         21280000
212900     END-IF.                                                      21290000
213000                                                                  21300000
213100/                                                                 21310000
213200*----------------------------------------------------------------*21320000
213300* CLOSE THE AUDIT ITEM CURSOR                                     21330000
213400*----------------------------------------------------------------*21340000
213500                                                                  21350000
213600 4020-CLOSE-CURSOR.                                               21360000
213700                                                                  21370000
213800     EXEC SQL                                                     21380000
213900          CLOSE ITEM-CSR                                          21390000
214000     END-EXEC.                                                    21400000
214100*                                                                 21410000
214200     EVALUATE TRUE                                                21420000
214300         WHEN SQLCODE = ZERO                                      21430000
214400             CONTINUE                                             21440000
214500         WHEN SQLWARN0 NOT = SPACES                               21450000
214600         WHEN SQLCODE < ZERO                                      21460000
214700         WHEN SQLCODE > ZERO                                      21470000
214800             MOVE '4020-CLOSE-CURSOR'                             21480000
214900                               TO DP013-PARAGRAPH                 21490000
215000             MOVE 'CLOSE THE AUDIT ITEM CURSOR'                   21500000
215100                               TO DP013-MESSAGE-TEXT (1)          21510000
215200             MOVE SQLCA        TO DP013-SQLCA                     21520000
215300             MOVE 'TSUAUPC '  TO DP013-DB2-TABLE-NAME (1)         21530000
215400             MOVE 'TSHUUPC '  TO DP013-DB2-TABLE-NAME (2)         21540000
215500             SET DP013-DB2-ABEND                                  21550000
215600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               21560000
215700             PERFORM DP013-0000-PROCESS-ABEND                     21570000
215800     END-EVALUATE.                                                21580000
215900                                                                  21590000
216000/                                                                 21600000
216100*----------------------------------------------------------------*21610000
216200*    SET UP THE HOST VARIABLES.                                  *21620000
216300*----------------------------------------------------------------*21630000
216400                                                                  21640000
216500 4100-PREPARE-CURSOR.                                             21650000
216600                                                                  21660000
216700     MOVE ASC-AUDIT-NUMBER            TO DK-AUDIT-NBR             21670000
216800     MOVE ASC-CARTON-ID               TO DK-SHIPT-UNIT-ID         21680000
216900     MOVE ASC-UPC-NBR                 TO DK-UPC-NBR.              21690000
216920     MOVE ASC-INTR-UPC                TO DK-INTR-UPC.             21692000
217000                                                                  21700000
      *SB 01/02/14 - BEGIN PR#5148D                                     21700100
           PERFORM 8000-CHECK-RFID-AUDIT.                               21701000
      *SB 01/02/14 - END PR#5148D                                       21701100
                                                                        21702000
217100*    THIS IS THE TOP TWO PARTS OF THE SCROLLING SECTION           21710000
           IF PS-NO-RFID-AUDIT                                          21711000
217200        PERFORM 4110-OVER-SHORT                                   21720000
           END-IF.                                                      21721000
217300**** PERFORM 4130-CARTON-ERRORS.                                  21730000
217400                                                                  21740000
217500*    THIS IS NEEDED IF ANY ITEM EXCEPTIONS ARE FOUND              21750000
217600     PERFORM 7200-OPEN-UPC-CSR.                                   21760000
217700     PERFORM 7210-FETCH-UPC-CSR.                                  21770000
217800     PERFORM 7220-CLOSE-UPC-CSR.                                  21780000
217900                                                                  21790000
218000     PERFORM 7300-COUNT-X-RECS.                                   21800000
218100     IF PV-TSUAUPC-X-RECS = 0                                     21810000
218200         MOVE 0         TO PV-PREPACKS-PER-CRTN                   21820000
218300     ELSE                                                         21830000
218400         PERFORM 7400-COUNT-P-RECS                                21840000
218500         COMPUTE PV-PREPACKS-PER-CRTN =                           21850000
218600           ((PV-TSUAUPC-X-RECS / PV-TSUAUPC-P-RECS ) + 1)         21860000
218700     END-IF.                                                      21870000
218800                                                                  21880000
218900 4110-OVER-SHORT.                                                 21890000
219000     PERFORM 7000-OPEN-OVER-SHORT-CSR.                            21900000
219100     PERFORM 7010-FETCH-OVER-SHORT-CSR.                           21910000
219200     PERFORM UNTIL PS-END-OS-CSR                                  21920000
219300         IF PV-AUDIT-VALUE                                        21930000
219400             MOVE PV-COUNT            TO PV-RECEIVED-COUNT        21940000
219500         ELSE                                                     21950000
219600             MOVE PV-COUNT            TO PV-ORDERED-COUNT         21960000
219700         END-IF                                                   21970000
219800         PERFORM 7010-FETCH-OVER-SHORT-CSR                        21980000
219900     END-PERFORM.                                                 21990000
220000                                                                  22000000
220100     PERFORM 7020-CLOSE-OVER-SHORT-CSR.                           22010000
220200                                                                  22020000
220300     EVALUATE TRUE                                                22030000
220400         WHEN PV-RECEIVED-COUNT = PV-ORDERED-COUNT                22040000
220500             CONTINUE                                             22050000
220600         WHEN PV-RECEIVED-COUNT > PV-ORDERED-COUNT                22060000
220700*            OVERAGE                                              22070000
220800             IF PV-ORDERED-COUNT = ZERO                           22080000
220900                 MOVE 'VND OVER/MISPCK'   TO PV-ERROR-DESC        22090000
221000                 SET PS-SUB   TO TRUE                             22100000
221100             ELSE                                                 22110000
221200                 MOVE 'VENDOR OVER    '   TO PV-ERROR-DESC        22120000
221300                 SET PS-OVER  TO TRUE                             22130000
221400             END-IF                                               22140000
221500             MOVE PV-ORDERED-COUNT    TO PV-DISP-ORD-QTY          22150000
221600             MOVE PV-RECEIVED-COUNT   TO PV-DISP-REC-QTY          22160000
221700             COMPUTE PV-DIFFERENCE = PV-RECEIVED-COUNT            22170000
221800                             - PV-ORDERED-COUNT                   22180000
221900             MOVE PV-DIFFERENCE       TO PV-DISP-DIFFERENCE       22190000
222000             PERFORM 4120-SHOW-OVER-SHORT                         22200000
222100         WHEN OTHER                                               22210000
222200*            SHORTAGE                                             22220000
222300             MOVE 'VENDOR SHORT   '   TO PV-ERROR-DESC            22230000
222400             SET PS-SHORT TO TRUE                                 22240000
222500             MOVE PV-ORDERED-COUNT    TO PV-DISP-ORD-QTY          22250000
222600             MOVE PV-RECEIVED-COUNT   TO PV-DISP-REC-QTY          22260000
222700             COMPUTE PV-DIFFERENCE = PV-ORDERED-COUNT             22270000
222800                             - PV-RECEIVED-COUNT                  22280000
222900             MOVE PV-DIFFERENCE       TO PV-DISP-DIFFERENCE       22290000
223000             PERFORM 4120-SHOW-OVER-SHORT                         22300000
223100     END-EVALUATE.                                                22310000
223200                                                                  22320000
223300 4120-SHOW-OVER-SHORT.                                            22330000
223400                                                                  22340000
223500     IF  ASC-ITEMS-LEFT-ON-DB                                     22350000
223600         IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                    22360000
223700             ADD +1            TO ASC-ITEM-SUB                    22370000
223800         ELSE                                                     22380000
223900             ADD +1            TO ASC-BLK-SUB                     22390000
224000             MOVE +1           TO ASC-ITEM-SUB                    22400000
224100                                                                  22410000
224200             IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY             22420000
224300                 MOVE +1       TO ASC-BLK-SUB                     22430000
224400                 SET ASC-BLOCK-MODIFIED (1)                       22440000
224500                                   TO TRUE                        22450000
224600                 PERFORM 5100-WRITE-TEMP-STORAGE                  22460000
224700                 MOVE ASC-BLOCK-ENTRIES                           22470000
224800                               (PC-MAX-BLOCKS-IN-ARRAY)           22480000
224900                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 22490000
225000                 ADD +1        TO ASC-BLK-SUB                     22500000
225100                 INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)       22510000
225200                 SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)          22520000
225300                                   TO TRUE                        22530000
225400             END-IF                                               22540000
225500         END-IF                                                   22550000
225600         ADD +1                TO ASC-NUMBER-OF-ITEMS-READ        22560000
225700         MOVE ASC-NUMBER-OF-ITEMS-READ                            22570000
225800                                   TO ASC-LIST-ITEM-NUMBER        22580000
225900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22590000
226000*    MOVE DATA ITEMS TO ASC- TABLE HERE                           22600000
226100         MOVE PV-ERROR-DESC        TO ASC-ERROR-DESC              22610000
226200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22620000
226300         MOVE '*'                  TO ASC-ERROR-IND               22630000
226400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22640000
226500         MOVE 'CAR'                TO ASC-ERROR-LEVEL             22650000
226600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22660000
226700         MOVE '       '            TO ASC-QTY                     22670000
226800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22680000
226900         MOVE '   '                TO ASC-TYPE                    22690000
227000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22700000
227100         MOVE SPACES               TO ASC-ORDER-DESC              22710000
227200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22720000
227300         MOVE SPACES               TO ASC-RECVD-DESC              22730000
227400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22740000
227500         END-IF.                                                  22750000
227600*    END-PERFORM.                                                 22760000
227700                                                                  22770000
227800     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          22780000
227900         MOVE +1               TO ASC-BLK-SUB                     22790000
228000         PERFORM 5100-WRITE-TEMP-STORAGE                          22800000
228100         ADD +1                TO ASC-BLK-SUB                     22810000
228200         PERFORM 5100-WRITE-TEMP-STORAGE                          22820000
228300                                                                  22830000
228400         MOVE 1                TO ASC-BLK-SUB                     22840000
228500                                  PV-BLOCK-NUMBER                 22850000
228600         PERFORM 4410-READ-TEMP-STORAGE                           22860000
228700         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             22870000
228800             MOVE 2            TO ASC-BLK-SUB                     22880000
228900                                  PV-BLOCK-NUMBER                 22890000
229000             PERFORM 4410-READ-TEMP-STORAGE                       22900000
229100         END-IF                                                   22910000
229200     END-IF.                                                      22920000
229300                                                                  22930000
229400 4130-CARTON-ERRORS.                                              22940000
229500                                                                  22950000
229600     PERFORM 7100-OPEN-CARTON-CSR.                                22960000
229700     PERFORM 7110-FETCH-CARTON-CSR.                               22970000
229800     PERFORM UNTIL PS-END-CTN-CSR                                 22980000
229900         PERFORM 4140-SHOW-CARTON-ERRORS                          22990000
230000         PERFORM 7110-FETCH-CARTON-CSR                            23000000
230100     END-PERFORM                                                  23010000
230200                                                                  23020000
230300     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          23030000
230400         MOVE +1               TO ASC-BLK-SUB                     23040000
230500         PERFORM 5100-WRITE-TEMP-STORAGE                          23050000
230600         ADD +1                TO ASC-BLK-SUB                     23060000
230700         PERFORM 5100-WRITE-TEMP-STORAGE                          23070000
230800                                                                  23080000
230900         MOVE 1                TO ASC-BLK-SUB                     23090000
231000                                  PV-BLOCK-NUMBER                 23100000
231100         PERFORM 4410-READ-TEMP-STORAGE                           23110000
231200         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             23120000
231300             MOVE 2            TO ASC-BLK-SUB                     23130000
231400                                  PV-BLOCK-NUMBER                 23140000
231500             PERFORM 4410-READ-TEMP-STORAGE                       23150000
231600         END-IF                                                   23160000
231700     END-IF.                                                      23170000
231800                                                                  23180000
231900     PERFORM 7120-CLOSE-CARTON-CSR.                               23190000
232000                                                                  23200000
232100 4140-SHOW-CARTON-ERRORS.                                         23210000
232200*  FIRST LOAD ALL THE DATA FIELDS TO THE ASC- AREA                23220000
232300*  THEN WRITE THE LIST QUEUE  WHEN DATA IS DONE                   23230000
232400                                                                  23240000
232500         IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                    23250000
232600             ADD +1            TO ASC-ITEM-SUB                    23260000
232700         ELSE                                                     23270000
232800             ADD +1            TO ASC-BLK-SUB                     23280000
232900             MOVE +1           TO ASC-ITEM-SUB                    23290000
233000                                                                  23300000
233100             IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY             23310000
233200                 MOVE +1       TO ASC-BLK-SUB                     23320000
233300                 SET ASC-BLOCK-MODIFIED (1)                       23330000
233400                                   TO TRUE                        23340000
233500                 PERFORM 5100-WRITE-TEMP-STORAGE                  23350000
233600                 MOVE ASC-BLOCK-ENTRIES                           23360000
233700                               (PC-MAX-BLOCKS-IN-ARRAY)           23370000
233800                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 23380000
233900                 ADD +1        TO ASC-BLK-SUB                     23390000
234000                 INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)       23400000
234100                 SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)          23410000
234200                                   TO TRUE                        23420000
234300             END-IF                                               23430000
234400         END-IF                                                   23440000
234500         ADD +1                TO ASC-NUMBER-OF-ITEMS-READ        23450000
234600         MOVE ASC-NUMBER-OF-ITEMS-READ                            23460000
234700                                   TO ASC-LIST-ITEM-NUMBER        23470000
234800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23480000
234900*    MOVE DATA ITEMS TO ASC- TABLE HERE                           23490000
235000         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     23500000
235100                                   TO TRUE                        23510000
235200         MOVE VILNCD-VILN-CDE-SHRT-DESC                           23520000
235300                                   TO ASC-ERROR-DESC              23530000
235400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23540000
235500         MOVE '*'                  TO ASC-ERROR-IND               23550000
235600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23560000
235700         MOVE 'CAR'                TO ASC-ERROR-LEVEL             23570000
235800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23580000
235900         MOVE '       '            TO ASC-QTY                     23590000
236000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23600000
236100         MOVE SPACES               TO ASC-TYPE                    23610000
236200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23620000
236300         IF CTEXCP-VILN-GP-SEQ-NBR = 1                            23630000
236400             MOVE SUATRN-TRN-NBR   TO PV-DISP-PO                  23640000
236500             MOVE PV-DISP-PO       TO ASC-ORDER-DESC              23650000
236600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23660000
236700             MOVE CTEXCP-OVRRID-SYS-DAT-TXT (1:9)                 23670000
236800                                   TO ASC-RECVD-DESC              23680000
236900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23690000
237000         ELSE                                                     23700000
237100             MOVE SUATRN-DEST-OPER-UNT-ID                         23710000
237200                                   TO PV-DISP-STR                 23720000
237300             MOVE PV-DISP-STR      TO ASC-ORDER-DESC              23730000
237400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23740000
237500             MOVE CTEXCP-OVRRID-SYS-DAT-TXT (1:4)                 23750000
237600                                   TO ASC-RECVD-DESC              23760000
237700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23770000
237800         END-IF.                                                  23780000
238000                                                                  23800000
238100                                                                  23810000
238200 4200-SELECT-OPER-DESC.                                           23820000
238300                                                                  23830000
238400     EXEC SQL                                                     23840000
238500        SELECT                                                    23850000
238600             LOC_NM                                               23860000
238700          INTO                                                    23870000
238800             :XLT00010-LOC-NM                                     23880000
238900          FROM  XLT_LOC                                           23890000
239000        WHERE  LOC_TYP_CDE    = :PC-DC                            23900000
239100          AND  LOC_NBR        = :DK-OPER-UNIT                     23910000
239200          AND  E_BUS_IND      = :PC-N                             23920000
239300          AND  OPN_DTE        < CURRENT DATE + 1 DAY              23930000
239300          AND  CLO_DTE        = :PC-MAX-DATE                      23940000
239800     END-EXEC.                                                    23980000
239900                                                                  23990000
240000     EVALUATE TRUE                                                24000000
240100         WHEN SQLCODE = ZERO                                      24010000
240200             CONTINUE                                             24020000
240300         WHEN SQLCODE = +100                                      24030000
240400             MOVE SPACES TO XLT00010-LOC-NM                       24040000
240500                                                                  24050000
240600         WHEN SQLWARN0 NOT = SPACES                               24060000
240700         WHEN SQLCODE < +0                                        24070000
240800         WHEN SQLCODE > ZERO                                      24080000
240900             MOVE '4200-SELECT-OPER-DESC'                         24090000
241000                             TO DP013-PARAGRAPH                   24100000
241100             MOVE 'SELECT OPER UNIT'                              24110000
241200                             TO DP013-MESSAGE-TEXT (1)            24120000
241300             MOVE SQLCA      TO DP013-SQLCA                       24130000
241400             MOVE 'XLT_LOC'  TO DP013-DB2-TABLE-NAME (1)          24140000
241500             SET DP013-DB2-ABEND                                  24150000
241600                             TO TRUE                              24160000
241700             SET DP013-XCTL-DISPLAY-RESTART                       24170000
241800                             TO TRUE                              24180000
241900             PERFORM DP013-0000-PROCESS-ABEND                     24190000
242000     END-EVALUATE.                                                24200000
242100                                                                  24210000
242200                                                                  24220000
242300 4230-SELECT-VENDOR.                                              24230000
242400                                                                  24240000
242500     EXEC SQL                                                     24250000
242600          SELECT ENT_NAME_DESC                                    24260000
242700            INTO :ENTNME-ENT-NAME-DESC                            24270000
242800            FROM TEXTENT A                                        24280000
242900                ,TENTNME B                                        24290000
243000           WHERE A.ENT_ID      = :DK-ENT-ID                       24300000
243100             AND A.ENT_ID = B.ENT_ID                              24310000
243200             AND A.STATUS_CDE  = 'A'                              24320000
243300             AND B.TYPE_CDE    = '01'                             24330000
P40473           WITH UR                                                24331000
243400     END-EXEC.                                                    24340000
243500                                                                  24350000
243600     EVALUATE TRUE                                                24360000
243700         WHEN SQLCODE = +0                                        24370000
243800         WHEN SQLCODE = -811                                      24380000
243900             CONTINUE                                             24390000
244000         WHEN SQLCODE = +100                                      24400000
244100             MOVE SPACES   TO ENTNME-ENT-NAME-DESC                24410000
244200         WHEN SQLWARN0 NOT = SPACES                               24420000
244300         WHEN SQLCODE < +0                                        24430000
244400         WHEN SQLCODE > +0                                        24440000
244500             MOVE '4230-SELECT-VENDOR'                            24450000
244600                             TO DP013-PARAGRAPH                   24460000
244700             MOVE 'SELECT SCAC CODE'                              24470000
244800                             TO DP013-MESSAGE-TEXT (1)            24480000
244900             MOVE SQLCA      TO DP013-SQLCA                       24490000
245000             MOVE 'TEXTENT'  TO DP013-DB2-TABLE-NAME (1)          24500000
245100             SET DP013-DB2-ABEND                                  24510000
245200                             TO TRUE                              24520000
245300             SET DP013-XCTL-DISPLAY-RESTART                       24530000
245400                             TO TRUE                              24540000
245500             PERFORM DP013-0000-PROCESS-ABEND                     24550000
245600     END-EVALUATE.                                                24560000
245700                                                                  24570000
245800                                                                  24580000
245900 4250-SELECT-DEPT.                                                24590000
246000                                                                  24600000
246100     EXEC SQL                                                     24610000
246200         SELECT A.ENT_ID                                          24620000
246300             ,  B.MDSEAR_DESC                                     24630000
246400          INTO  :VNDDPT-ENT-ID                                    24640000
246500             ,  :MDSEAR-DESC                                      24650000
246600          FROM  TVNDDPT A                                         24660000
246700             ,  TMDSEAR B                                         24670000
246800          WHERE A.ENT_ID         = :DK-ENT-ID                     24680000
246900           AND  A.DEPT_NBR       = :DK-DEPT-NBR                   24690000
247000            AND A.DEPT_NBR       = B.DEPT_NBR                     24700000
247100            AND B.MDSELV_CDE     = 'DPT'                          24710000
247200            AND B.OPERCO_NBR     = '03'                           24720000
247300            AND (B.STRT_DTE     <= CURRENT DATE AND               24730000
247400                 B.END_DTE       > CURRENT DATE)                  24740000
247500     END-EXEC.                                                    24750000
247600                                                                  24760000
247700     EVALUATE TRUE                                                24770000
247800         WHEN SQLCODE = +0                                        24780000
247900             CONTINUE                                             24790000
248000                                                                  24800000
248100         WHEN SQLCODE = +100                                      24810000
248200             MOVE SPACES   TO MDSEAR-DESC                         24820000
248300                                                                  24830000
248400         WHEN SQLWARN0 NOT = SPACE                                24840000
248500         WHEN SQLCODE < +0                                        24850000
248600         WHEN SQLCODE > +0                                        24860000
248700             MOVE '4250-SELECT-DEPT'                              24870000
248800                             TO DP013-PARAGRAPH                   24880000
248900             MOVE 'VALIDATE THE DEPT NUMBER'                      24890000
249000                             TO DP013-MESSAGE-TEXT (1)            24900000
249100             MOVE SQLCA      TO DP013-SQLCA                       24910000
249200             MOVE 'TVNDDPT'  TO DP013-DB2-TABLE-NAME (1)          24920000
249300             MOVE 'TMDSEAR'  TO DP013-DB2-TABLE-NAME (2)          24930000
249400             SET DP013-DB2-ABEND                                  24940000
249500                             TO TRUE                              24950000
249600             SET DP013-XCTL-DISPLAY-RESTART                       24960000
249700                             TO TRUE                              24970000
249800             PERFORM DP013-0000-PROCESS-ABEND                     24980000
249900     END-EVALUATE.                                                24990000
250000                                                                  25000000
250100*----------------------------------------------------------------*25010000
250200*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *25020000
250300*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *25030000
250400*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *25040000
250500*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *25050000
250600*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *25060000
250700*                                                                *25070000
250800*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *25080000
250900*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *25090000
251000*    UPON INITIALIZATION.                                        *25100000
251100*----------------------------------------------------------------*25110000
251200                                                                  25120000
251300 4300-READ-ITEMS-FROM-DB.                                         25130000
251400                                                                  25140000
251500     PERFORM                                                      25150000
251600         VARYING PV-READ-COUNT                                    25160000
251700         FROM 1 BY 1                                              25170000
251800         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    25180000
251900            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         25190000
252000                                                                  25200000
252100         PERFORM 4310-FETCH                                       25210000
252200                                                                  25220000
252300         IF  ASC-ITEMS-LEFT-ON-DB                                 25230000
252400             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                25240000
252500                 ADD +1            TO ASC-ITEM-SUB                25250000
252600             ELSE                                                 25260000
252700                 ADD +1            TO ASC-BLK-SUB                 25270000
252800                 MOVE +1           TO ASC-ITEM-SUB                25280000
252900                                                                  25290000
253000                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         25300000
253100                     MOVE +1       TO ASC-BLK-SUB                 25310000
253200                     SET ASC-BLOCK-MODIFIED (1)                   25320000
253300                                   TO TRUE                        25330000
253400                     PERFORM 5100-WRITE-TEMP-STORAGE              25340000
253500                     MOVE ASC-BLOCK-ENTRIES                       25350000
253600                               (PC-MAX-BLOCKS-IN-ARRAY)           25360000
253700                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 25370000
253800                     ADD +1        TO ASC-BLK-SUB                 25380000
253900                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   25390000
254000                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      25400000
254100                                   TO TRUE                        25410000
254200                 END-IF                                           25420000
254300             END-IF                                               25430000
254400             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    25440000
254500             MOVE ASC-NUMBER-OF-ITEMS-READ                        25450000
254600                                   TO ASC-LIST-ITEM-NUMBER        25460000
254700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  25470000
254800*    MOVE CURSOR DATA ITEMS TO ASC- TABLE HERE                    25480000
254900             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                 25490000
255000                                   TO TRUE                        25500000
255100             MOVE VILNCD-VILN-CDE-SHRT-DESC                       25510000
255200                                   TO ASC-ERROR-DESC              25520000
255300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  25530000
255400             IF PV-VILNCD-FALR-IND = 'Y'                          25540000
255500                 MOVE 'F'          TO ASC-ERROR-IND               25550000
255600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  25560000
255700                 MOVE 'UNT'        TO ASC-ERROR-LEVEL             25570000
255800                                  (ASC-BLK-SUB ASC-ITEM-SUB)      25580000
255900             ELSE                                                 25590000
256000                 IF PV-VILNCD-FALR-IND = '*'                      25600000
256100                     MOVE '*'          TO ASC-ERROR-IND           25610000
256200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  25620000
256300                     MOVE 'CAR'        TO ASC-ERROR-LEVEL         25630000
256400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  25640000
256500                     MOVE 0            TO PV-SCANNED-UNIT-QTY     25650000
256600                 ELSE                                             25660000
256700                     MOVE 'UNT'        TO ASC-ERROR-LEVEL         25670000
256800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  25680000
256900                 END-IF                                           25690000
257000             END-IF                                               25700000
257100             MOVE PV-SCANNED-UNIT-QTY                             25710000
257200                                   TO PV-DISP-QTY                 25720000
257300             MOVE PV-DISP-QTY      TO ASC-QTY                     25730000
257400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  25740000
257500             IF PV-VILNCD-FALR-IND = '*'                          25750000
257600                 MOVE SPACES           TO ASC-TYPE                25760000
257700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  25770000
257800             ELSE                                                 25780000
257900                 PERFORM 4301-TYPE-AND-TEXTS                      25790000
258000                 MOVE PV-ERROR-TYPE    TO ASC-TYPE                25800000
258100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  25810000
258200             END-IF                                               25820000
258300                                                                  25830000
258400             MOVE PV-ORDER-DESC    TO ASC-ORDER-DESC              25840000
258500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  25850000
258600             MOVE PV-RECVD-DESC    TO ASC-RECVD-DESC              25860000
258700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  25870000
258800                                                                  25880000
258900         END-IF                                                   25890000
259000     END-PERFORM.                                                 25900000
259100                                                                  25910000
259200     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          25920000
259300         MOVE +1               TO ASC-BLK-SUB                     25930000
259400         PERFORM 5100-WRITE-TEMP-STORAGE                          25940000
259500         ADD +1                TO ASC-BLK-SUB                     25950000
259600         PERFORM 5100-WRITE-TEMP-STORAGE                          25960000
259700                                                                  25970000
259800         MOVE 1                TO ASC-BLK-SUB                     25980000
259900                                  PV-BLOCK-NUMBER                 25990000
260000         PERFORM 4410-READ-TEMP-STORAGE                           26000000
260100         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             26010000
260200             MOVE 2            TO ASC-BLK-SUB                     26020000
260300                                  PV-BLOCK-NUMBER                 26030000
260400             PERFORM 4410-READ-TEMP-STORAGE                       26040000
260500         END-IF                                                   26050000
260600     END-IF.                                                      26060000
260700                                                                  26070000
260800 4301-TYPE-AND-TEXTS.                                             26080000
260900                                                                  26090000
261000     MOVE SUEXCP-OVRRID-SYS-DAT-TXT   TO PV-DESC-AREA             26100000
261100     PERFORM 4301B-TRIM-REC                                       26110000
261200                                                                  26120000
261300     EVALUATE SUEXCP-VILN-GP-SEQ-NBR                              26130000
261400                                                                  26140000
261500       WHEN PC-STYLE-SUB                                          26150000
261600       WHEN PC-WRONG-TICKET-STYLE                                 26160000
261700       WHEN PC-WRONG-MDSE-LBL-STYLE                               26170000
      *SB 01/27/14 - BEGIN PR#5148D                                     26171000
             WHEN PC-WRG-RFID-TGS-STL                                   26171100
      *SB 01/27/14 - END   PR#5148D                                     26172000
261800           MOVE SUEXCP-OVRRID-SYS-DAT-TXT                         26180000
261900                                      TO PV-DESC-AREA             26190000
262000           PERFORM 4301B-TRIM-REC                                 26200000
262100           MOVE 'STY'                 TO PV-ERROR-TYPE            26210000
262200           MOVE SUAUPC-VND-STYL-DESC  TO PV-DESC-AREA             26220000
262300           PERFORM 4301A-TRIM-ORD                                 26230000
262400                                                                  26240000
262500       WHEN PC-WRONG-TICKET-DEPT                                  26250000
262600           MOVE SUEXCP-OVRRID-SYS-DAT-TXT                         26260000
262700                                      TO PV-DESC-AREA             26270000
262800           PERFORM 4301B-TRIM-REC                                 26280000
262900           MOVE 'DPT'                 TO PV-ERROR-TYPE            26290000
263000           MOVE SUAUPC-DEPT-NBR       TO PV-DISP-NBR              26300000
263010           MOVE PV-DISP-NBR           TO PV-DESC-AREA             26301000
263100           PERFORM 4301A-TRIM-ORD                                 26310000
263200                                                                  26320000
263300       WHEN PC-WRONG-TICKET-RETAIL                                26330000
263400       WHEN PC-WRONG-MDSE-LBL-RETAIL                              26340000
263500           MOVE SUEXCP-OVRRID-SYS-DAT-TXT                         26350000
263600                                      TO PV-DESC-AREA             26360000
263700           PERFORM 4301B-TRIM-REC                                 26370000
263800           MOVE 'RTL'                 TO PV-ERROR-TYPE            26380000
263900           MOVE SUAUPC-UPC-RTL-AMT    TO PV-DISP-DEC              26390000
264000           MOVE PV-DISP-DEC           TO PV-DESC-AREA             26400000
264100           PERFORM 4301A-TRIM-ORD                                 26410000
264200                                                                  26420000
264300       WHEN PC-WRONG-TICKET-COLOR                                 26430000
264400       WHEN PC-WRONG-MDSE-LBL-COLOR                               26440000
      *SB 01/27/14 - BEGIN PR#5148D                                     26441000
             WHEN PC-WRG-RFID-TGS-CLR                                   26442000
      *SB 01/27/14 - END   PR#5148D                                     26443000
264500           MOVE SUEXCP-OVRRID-SYS-DAT-TXT                         26450000
264600                                      TO PV-DESC-AREA             26460000
264700           PERFORM 4301B-TRIM-REC                                 26470000
264800           MOVE 'CLR'                 TO PV-ERROR-TYPE            26480000
264900           MOVE SUAUPC-UPC-CLOR-DESC  TO PV-DESC-AREA             26490000
265000           PERFORM 4301A-TRIM-ORD                                 26500000
265100                                                                  26510000
265200       WHEN PC-WRONG-TICKET-SIZE                                  26520000
265300       WHEN PC-WRONG-MDSE-LBL-SIZE                                26530000
      *SB 01/27/14 - BEGIN PR#5148D                                     26531000
             WHEN PC-WRG-RFID-TGS-SIZ                                   26532000
      *SB 01/27/14 - END   PR#5148D                                     26533000
265400           MOVE SUEXCP-OVRRID-SYS-DAT-TXT                         26540000
265500                                      TO PV-DESC-AREA             26550000
265600           PERFORM 4301B-TRIM-REC                                 26560000
265700           MOVE 'SZE'                 TO PV-ERROR-TYPE            26570000
265800           MOVE SUAUPC-UPC-SIZE-DESC  TO PV-DESC-AREA             26580000
265900           PERFORM 4301A-TRIM-ORD                                 26590000
266000                                                                  26600000
266100       WHEN PC-WRONG-TICKET-MAJ-CLS                               26610000
266200           MOVE SUEXCP-OVRRID-SYS-DAT-TXT(1:2)                    26620000
266300                                      TO PV-DESC-AREA             26630000
266400           PERFORM 4301B-TRIM-REC                                 26640000
266500           MOVE 'MCL'                 TO PV-ERROR-TYPE            26650000
266600           MOVE SUAUPC-MAJ-CL-NBR     TO PV-DISP-NBR              26660000
266610           MOVE PV-DISP-NBR           TO PV-DESC-AREA             26661000
266700           PERFORM 4301A-TRIM-ORD                                 26670000
266800                                                                  26680000
266900       WHEN PC-WRONG-TICKET-SUB-CLS                               26690000
267000           MOVE SUEXCP-OVRRID-SYS-DAT-TXT                         26700000
267100                                      TO PV-DESC-AREA             26710000
267200           PERFORM 4301B-TRIM-REC                                 26720000
267300           MOVE 'SCL'                 TO PV-ERROR-TYPE            26730000
267400           MOVE SUAUPC-SUB-CL-NBR     TO PV-DISP-NBR              26740000
267410           MOVE PV-DISP-NBR           TO PV-DESC-AREA             26741000
267500           PERFORM 4301A-TRIM-ORD                                 26750000
267600                                                                  26760000
267700       WHEN PC-OVER                                               26770000
267800            IF PS-OVER                                            26780000
267900               MOVE SPACES                TO PV-ERROR-TYPE        26790000
268000               MOVE PV-DISP-ORD-QTY       TO PV-ORDER-DESC        26800000
268100               MOVE PV-DISP-REC-QTY       TO PV-RECVD-DESC        26810000
268200           ELSE                                                   26820000
268300               MOVE SPACES                TO PV-ERROR-TYPE        26830000
268400                                             PV-ORDER-DESC        26840000
268500                                             PV-RECVD-DESC        26850000
268600           END-IF                                                 26860000
268700       WHEN PC-SHORT                                              26870000
268800            IF PS-SHORT                                           26880000
268900               MOVE SPACES                TO PV-ERROR-TYPE        26890000
269000               MOVE PV-DISP-ORD-QTY       TO PV-ORDER-DESC        26900000
269100               MOVE PV-DISP-REC-QTY       TO PV-RECVD-DESC        26910000
269200           ELSE                                                   26920000
269300               MOVE SPACES                TO PV-ERROR-TYPE        26930000
269400                                             PV-ORDER-DESC        26940000
269500                                             PV-RECVD-DESC        26950000
269600           END-IF                                                 26960000
269700       WHEN PC-UPC-MISDIRECT                                      26970000
269800            IF PS-SUB                                             26980000
269900               MOVE SPACES                TO PV-ERROR-TYPE        26990000
270000               MOVE PV-DISP-ORD-QTY       TO PV-ORDER-DESC        27000000
270100               MOVE PV-DISP-REC-QTY       TO PV-RECVD-DESC        27010000
270200           ELSE                                                   27020000
270300               MOVE SPACES                TO PV-ERROR-TYPE        27030000
270400                                             PV-ORDER-DESC        27040000
270500                                             PV-RECVD-DESC        27050000
270600           END-IF                                                 27060000
270700                                                                  27070000
      *SB 03/21/14 - BEGIN PR#5148D                                     27070100
             WHEN PC-WRG-TAGS-NO-EPC                                    27071000
269900            MOVE SPACES               TO PV-ERROR-TYPE            27071100
                  MOVE PV-DISP-QTY          TO PV-DESC-AREA             27071200
267200            PERFORM 4301B-TRIM-REC                                27071300
267400            MOVE 0                    TO PV-DESC-AREA             27071500
267500            PERFORM 4301A-TRIM-ORD                                27071700
      *SB 03/21/14 - END   PR#5148D                                     27071800
                                                                        27072000
270800       WHEN OTHER                                                 27080000
270900           MOVE SPACES                TO PV-RECVD-DESC            27090000
271000                                         PV-ERROR-TYPE            27100000
271100                                         PV-ORDER-DESC            27110000
271200                                                                  27120000
271300     END-EVALUATE.                                                27130000
271400                                                                  27140000
271500 4301A-TRIM-ORD.                                                  27150000
271600     PERFORM VARYING PV-END-SUB FROM 20 BY -1 UNTIL               27160000
271700         PV-DESC(PV-END-SUB) > SPACES OR PV-END-SUB = ZERO        27170000
271800     END-PERFORM.                                                 27180000
271900     IF PV-END-SUB > ZERO                                         27190000
272000         MOVE PV-DESC-AREA(1:PV-END-SUB)  TO PV-ORDER-DESC        27200000
272100     ELSE                                                         27210000
272200         MOVE SPACES                      TO PV-ORDER-DESC        27220000
272300     END-IF.                                                      27230000
272400                                                                  27240000
272500 4301B-TRIM-REC.                                                  27250000
272600     PERFORM VARYING PV-END-SUB FROM 20 BY -1 UNTIL               27260000
272700         PV-DESC(PV-END-SUB) > SPACES OR PV-END-SUB = ZERO        27270000
272800     END-PERFORM.                                                 27280000
272900     IF PV-END-SUB > ZERO                                         27290000
273000         MOVE PV-DESC-AREA(1:PV-END-SUB)  TO PV-RECVD-DESC        27300000
273100     ELSE                                                         27310000
273200         MOVE SPACES                      TO PV-RECVD-DESC        27320000
273300     END-IF.                                                      27330000
273400/                                                                 27340000
273500*----------------------------------------------------------------*27350000
273600*    FETCH THE AUDIT DETAIL-CURSOR                               *27360000
273700*----------------------------------------------------------------*27370000
273800                                                                  27380000
273900 4310-FETCH.                                                      27390000
274000                                                                  27400000
274100     EXEC SQL                                                     27410000
274200          FETCH ITEM-CSR                                          27420000
274300          INTO                                                    27430000
274400             :PV-UNION-IND                                        27440000
274500         ,   :SUEXCP-VILN-GP-SEQ-NBR                              27450000
274600         ,   :VILNCD-VILN-CDE-SHRT-DESC                           27460000
274700         ,   :PV-VILNCD-FALR-IND                                  27470000
274800         ,   :SUEXCP-OVRRID-SYS-DAT-TXT                           27480000
274900         ,   :PV-SCANNED-UNIT-QTY                                 27490000
274900         ,   :PV-RFID-TAGGED-QTY                                  27491000
275000     END-EXEC.                                                    27500000
275100                                                                  27510000
275200     EVALUATE TRUE                                                27520000
275300         WHEN SQLCODE = ZERO                                      27530000
275400         WHEN SQLCODE = +100                                      27540000
      *SB 01/02/14 - BEGIN PR#5148D                                     27540100
                    IF SUEXCP-VILN-GP-SEQ-NBR = 42                      27541100
                       SUBTRACT PV-RFID-TAGGED-QTY FROM                 27541200
                                PV-SCANNED-UNIT-QTY                     27541300
                       ELSE                                             27541400
      *SB 03/21/14 - BEGIN PR#5148D                                     27541500
                          IF SUEXCP-VILN-GP-SEQ-NBR = 38                27542400
                             IF PV-RFID-TAGGED-QTY > 0                  27542500
                                MOVE PV-RFID-TAGGED-QTY TO              27542600
                                     PV-SCANNED-UNIT-QTY                27543000
                             END-IF                                     27543100
                          ELSE                                          27543200
                             IF SUEXCP-VILN-GP-SEQ-NBR = 39 OR 40 OR 41 27543300
                                MOVE PV-RFID-TAGGED-QTY TO              27543400
                                     PV-SCANNED-UNIT-QTY                27543500
                             END-IF                                     27543600
                          END-IF                                        27543700
      *SB 03/21/14 - END   PR#5148D                                     27543800
                    END-IF                                              27543900
      *SB 01/02/14 - END PR#5148D                                       27545000
275600         WHEN SQLWARN0 NOT = SPACE                                27560000
275700         WHEN SQLCODE NOT = ZERO                                  27570000
275800              MOVE '4310-FETCH-CURSOR'                            27580000
275900                               TO DP013-PARAGRAPH                 27590000
276000              MOVE 'FETCH CARTON CURSOR'                          27600000
276100                               TO DP013-MESSAGE-TEXT (1)          27610000
276200              MOVE 'TSUAUPC '  TO DP013-DB2-TABLE-NAME (1)        27620000
276300              MOVE 'TSUEXCP '  TO DP013-DB2-TABLE-NAME (2)        27630000
276400              MOVE 'TVILNCD '  TO DP013-DB2-TABLE-NAME (3)        27640000
276500              MOVE SQLCA       TO DP013-SQLCA                     27650000
276600              SET DP013-DB2-ABEND                                 27660000
276700                               TO TRUE                            27670000
276800              PERFORM DP013-0000-PROCESS-ABEND                    27680000
276900     END-EVALUATE.                                                27690000
277000                                                                  27700000
277100     IF  SQLCODE EQUAL +100                                       27710000
277200         SET ASC-NO-ITEMS-LEFT-ON-DB                              27720000
277300                                   TO TRUE                        27730000
277400     END-IF.                                                      27740000
277500                                                                  27750000
277600                                                                  27760000
277700                                                                  27770000
277800                                                                  27780000
277900*----------------------------------------------------------------*27790000
278000* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *27800000
278100*----------------------------------------------------------------*27810000
278200                                                                  27820000
278300 4400-MOVE-COMMAREA-TO-SCREEN.                                    27830000
278400     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             27840000
278500         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          27850000
278600         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          27860000
278700             MOVE +1    TO ASC-BLK-SUB                            27870000
278800             PERFORM 5100-WRITE-TEMP-STORAGE                      27880000
278900             ADD +1     TO ASC-BLK-SUB                            27890000
279000             PERFORM 5100-WRITE-TEMP-STORAGE                      27900000
279100             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             27910000
279200                 GIVING PV-BLOCK-NUMBER                           27920000
279300                 REMAINDER PV-REMAINDER                           27930000
279400             IF  PV-REMAINDER > ZERO                              27940000
279500                 ADD +1 TO PV-BLOCK-NUMBER                        27950000
279600             END-IF                                               27960000
279700             MOVE +1    TO ASC-BLK-SUB                            27970000
279800             PERFORM 4410-READ-TEMP-STORAGE                       27980000
279900             ADD +1     TO ASC-BLK-SUB                            27990000
280000                           PV-BLOCK-NUMBER                        28000000
280100             PERFORM 4410-READ-TEMP-STORAGE                       28010000
280200     END-IF.                                                      28020000
280300     MOVE +1            TO ASC-BLK-SUB.                           28030000
280400     COMPUTE ASC-ITEM-SUB =                                       28040000
280500         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              28050000
280600         + PC-ITEMS-PER-PANEL).                                   28060000
280700*                                                                 28070000
280800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        28080000
280900         ADD +1         TO ASC-BLK-SUB                            28090000
281000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            28100000
281100     END-IF.                                                      28110000
281200*                                                                 28120000
281300     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           28130000
281400         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                28140000
281500     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        28150000
281600     PERFORM 4420-FORMAT-LIST-LINES                               28160000
281700         VARYING PV-SUB                                           28170000
281800         FROM PC-ITEMS-PER-PANEL BY -1                            28180000
281900         UNTIL PV-SUB < +1.                                       28190000
282000                                                                  28200000
282100     MOVE ASC-AUDIT-NUMBER            TO AAUDITO.                 28210000
282200     MOVE ASC-SOURCE                  TO ASOURCEO                 28220000
282300     MOVE ASC-VENDOR-NAME             TO AVENDNMO                 28230000
282400     MOVE ASC-ENT-ID-N                TO AVENDIDO                 28240000
282500*    MOVE ASC-AUDIT-TYPE              TO                          28250000
282600     MOVE ASC-OPER-UNIT-ID            TO AOPRUNTO                 28260000
282700     MOVE ASC-OPER-DESC               TO AOPRDSCO                 28270000
282800     MOVE ASC-AUDIT-NUMBER            TO AAUDITO                  28280000
282900     MOVE ASC-CARTON-ID               TO ACARTONO                 28290000
283000     MOVE ASC-UPC-NBR                 TO AUPCO                    28300000
283100                                                                  28310000
283200     MOVE ASC-REQUEST-MDCY            TO AREQDTEO.                28320000
283300                                                                  28330000
283400     EVALUATE ASC-PROCESS-STATUS                                  28340000
283500        WHEN 'P' MOVE PC-PASS          TO AAUDSTAO                28350000
283600        WHEN 'F' MOVE PC-FAIL          TO AAUDSTAO                28360000
283700        WHEN 'I' MOVE PC-IN-PROCESS    TO AAUDSTAO                28370000
283800        WHEN 'N' MOVE PC-NOT-NEEDED    TO AAUDSTAO                28380000
283900        WHEN 'R' MOVE PC-PROMPT        TO AAUDSTAO                28390000
284000        WHEN 'A' MOVE PC-ALL           TO AAUDSTAO                28400000
284100     END-EVALUATE.                                                28410000
284200                                                                  28420000
284300     MOVE ASC-PO-RECEIVER             TO APORCVRO.                28430000
284400                                                                  28440000
284500     EVALUATE ASC-SOURCE                                          28450000
284600         WHEN 'MAN' MOVE PC-MANUAL     TO ASOURCEO                28460000
284700         WHEN 'SYS' MOVE PC-SYSTEM     TO ASOURCEO                28470000
284800     END-EVALUATE.                                                28480000
284900                                                                  28490000
285000     IF ASC-DEPT-NBR-N > ZERO                                     28500000
285100         MOVE ASC-DEPT-NBR-N           TO PV-DEPT-NBR             28510000
285200         MOVE PV-DEPT-NBR              TO ADEPTO                  28520000
285300         MOVE ASC-DEPARTMENT-DESC      TO ADPTDSCO                28530000
285400     ELSE                                                         28540000
285500         MOVE SPACES                   TO ADEPTO                  28550000
285600                                          ADPTDSCO                28560000
285700     END-IF.                                                      28570000
285800                                                                  28580000
285900                                                                  28590000
286000     COMPUTE ASC-ITEMS-DISPLAYED =                                28600000
286100         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          28610000
286200     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    28620000
286300                                      ASTRTITO.                   28630000
286400     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    28640000
286500     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    28650000
286600*    MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            28660000
286700*                                  TO ASELITO.                    28670000
286800*                                                                 28680000
286900     IF  DP020-MSG-NUMBER-X = SPACE                               28690000
287000         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  28700000
287100*            --- MORE ITEMS TO DISPLAY ----                       28710000
287200             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            28720000
287300             SET DP020-MSG-INFORMATIONAL TO TRUE                  28730000
287400         END-IF                                                   28740000
287500     END-IF.                                                      28750000
287600*----------------------------------------------------------------*28760000
287700*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *28770000
287800*----------------------------------------------------------------*28780000
287900                                                                  28790000
288000 4410-READ-TEMP-STORAGE.                                          28800000
288100                                                                  28810000
288200     EXEC CICS                                                    28820000
288300         READQ TS                                                 28830000
288400             QUEUE (ASC-LIST-QUEUE-NAME)                          28840000
288500             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               28850000
288600             ITEM  (PV-BLOCK-NUMBER)                              28860000
288700             RESP  (PV-CICS-RESP)                                 28870000
288800     END-EXEC.                                                    28880000
288900                                                                  28890000
289000     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       28900000
289100       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     28910000
289200         CONTINUE                                                 28920000
289300     ELSE                                                         28930000
289400         SET DP013-CICS-ABEND     TO TRUE                         28940000
289500         SET DP013-NO-ROLLBACK    TO TRUE                         28950000
289600         MOVE '4410-READ-TEMP-STORAGE'                            28960000
289700                                  TO DP013-PARAGRAPH              28970000
289800         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      28980000
289900                                  TO DP013-MESSAGE-TEXT(1)        28990000
290000         PERFORM DP013-0000-PROCESS-ABEND                         29000000
290100     END-IF.                                                      29010000
290200                                                                  29020000
290300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             29030000
290400*                                                                 29040000
290500     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         29050000
290600         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               29060000
290700     END-IF.                                                      29070000
290800/                                                                 29080000
290900*----------------------------------------------------------------*29090000
291000*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *29100000
291100*----------------------------------------------------------------*29110000
291200                                                                  29120000
291300 4420-FORMAT-LIST-LINES.                                          29130000
291400     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      29140000
291500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                29150000
291600         MOVE SPACES             TO MR-ERROR-DESC (PV-SUB)        29160000
291700                                    MR-ERROR-IND (PV-SUB)         29170000
291800                                    MR-ERROR-LEVEL (PV-SUB)       29180000
291900                                    MR-QTY (PV-SUB)               29190000
292000                                    MR-TYPE (PV-SUB)              29200000
292100                                    MR-ORDERED-DESC (PV-SUB)      29210000
292200                                    MR-RECVD-DESC (PV-SUB)        29220000
292300     ELSE                                                         29230000
292400         IF  DP030-SET-CURSOR-TRAILER                             29240000
292500             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)29250000
292600                 > SPACE)                                         29260000
292700               OR (PV-SUB = 1))                                   29270000
292800                SET DP030-SET-CURSOR-APPL-1 TO TRUE               29280000
292900             END-IF                                               29290000
293000         END-IF                                                   29300000
293100*                                                                 29310000
293200         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           29320000
293300*  MOVE ASC- TABLE INTO MR MAP HERE                               29330000
293400             MOVE ASC-ERROR-DESC  (ASC-BLK-SUB ASC-ITEM-SUB)      29340000
293500                                 TO MR-ERROR-DESC (PV-SUB)        29350000
293600             MOVE ASC-ERROR-IND   (ASC-BLK-SUB ASC-ITEM-SUB)      29360000
293700                                 TO MR-ERROR-IND (PV-SUB)         29370000
293800             MOVE ASC-ERROR-LEVEL (ASC-BLK-SUB ASC-ITEM-SUB)      29380000
293900                                 TO MR-ERROR-LEVEL (PV-SUB)       29390000
294000             MOVE ASC-QTY         (ASC-BLK-SUB ASC-ITEM-SUB)      29400000
294100                                 TO MR-QTY (PV-SUB)               29410000
294200             MOVE ASC-TYPE        (ASC-BLK-SUB ASC-ITEM-SUB)      29420000
294300                                 TO MR-TYPE (PV-SUB)              29430000
294400             MOVE ASC-ORDER-DESC  (ASC-BLK-SUB ASC-ITEM-SUB)      29440000
294500                                 TO MR-ORDERED-DESC (PV-SUB)      29450000
294600             MOVE ASC-RECVD-DESC  (ASC-BLK-SUB ASC-ITEM-SUB)      29460000
294700                                 TO MR-RECVD-DESC (PV-SUB)        29470000
294800         END-IF                                                   29480000
294900     END-IF.                                                      29490000
295000     SUBTRACT +1 FROM ASC-ITEM-SUB                                29500000
295100     IF  ASC-ITEM-SUB < + 1                                       29510000
295200         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  29520000
295300         MOVE +1                 TO ASC-BLK-SUB                   29530000
295400     END-IF.                                                      29540000
295500******************************************************************29550000
295600** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **29560000
295700** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **29570000
295800** ISSUE A WARNING.                                             **29580000
295900******************************************************************29590000
296000 4430-CHECK-FOR-BEGIN-AND-END.                                    29600000
296100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       29610000
296200         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     29620000
296300*            -- NO END-OF-RANGE SPECFIED ---                      29630000
296400             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            29640000
296500             SET DP020-MSG-WARNING TO TRUE                        29650000
296600         END-IF                                                   29660000
296700     ELSE                                                         29670000
296800         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     29680000
296900*            -- NO BEGINNING-OF-RANGE SPECFIED ---                29690000
297000             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            29700000
297100             SET DP020-MSG-WARNING TO TRUE                        29710000
297200         END-IF                                                   29720000
297300     END-IF.                                                      29730000
297400*----------------------------------------------------------------*29740000
297500* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *29750000
297600* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *29760000
297700* FOR THE SELECTED ITEMS QUEUE.                                  *29770000
297800*                                                                *29780000
297900* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *29790000
298000* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *29800000
298100* THE ARRAY IS FULL.                                             *29810000
298200*----------------------------------------------------------------*29820000
298300                                                                  29830000
298400 5000-PREPARE-SEL-QUEUE.                                          29840000
298500                                                                  29850000
298600     MOVE +1                   TO  ASC-BLK-SUB.                   29860000
298700     PERFORM 5100-WRITE-TEMP-STORAGE.                             29870000
298800     ADD +1                    TO  ASC-BLK-SUB.                   29880000
298900     PERFORM 5100-WRITE-TEMP-STORAGE.                             29890000
299000                                                                  29900000
299100     MOVE ASC-SEL-QUEUE-NAME   TO  SU029-SEL-QUEUE-NAME.          29910000
299200     PERFORM 6010-DELETE-SEL-QUEUE.                               29920000
299300                                                                  29930000
299400     SET ASC-UPDATE-TSQ        TO  TRUE.                          29940000
299500                                                                  29950000
299600     SET SU030-IDX             TO  1.                             29960000
299700     MOVE ZERO                 TO SU029-NUMBER-OF-TS-ITEMS.       29970000
299800     INITIALIZE SU030-SELECTED-ITEM-ARRAY.                        29980000
299900                                                                  29990000
300000     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           30000000
300100             VARYING PV-ITEM                                      30010000
300200             FROM 1 BY 1                                          30020000
300300             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     30030000
300400                                                                  30040000
300500     IF  SU030-IDX > 1                                            30050000
300600         PERFORM 5205-WRITE-SEL-QUEUE                             30060000
300700         ADD +1                TO SU029-NUMBER-OF-TS-ITEMS        30070000
300800     END-IF.                                                      30080000
300900/                                                                 30090000
301000*----------------------------------------------------------------*30100000
301100*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *30110000
301200*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *30120000
301300*----------------------------------------------------------------*30130000
301400                                                                  30140000
301500 5100-WRITE-TEMP-STORAGE.                                         30150000
301600     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     30160000
301700                                   TO PV-LIST-ITEM-NUMBER.        30170000
301800     COMPUTE PV-BLOCK-NUMBER =                                    30180000
301900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    30190000
302000                                                                  30200000
302100     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             30210000
302200     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             30220000
302300         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      30230000
302400             PERFORM 5105-REWRITE-ASC-LISTQ                       30240000
302500         END-IF                                                   30250000
302600     ELSE                                                         30260000
302700         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       30270000
302800         ASC-HIGHEST-BLOCK-WRITTEN + 1                            30280000
302900         PERFORM 5110-WRITE-ASC-LISTQ                             30290000
303000         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   30300000
303100     END-IF.                                                      30310000
303200                                                                  30320000
303300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             30330000
303400******************************************************************30340000
303500** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **30350000
303600** SPECIFIC COMMAREA.                                           **30360000
303700******************************************************************30370000
303800 5105-REWRITE-ASC-LISTQ.                                          30380000
303900     EXEC CICS                                                    30390000
304000         WRITEQ TS                                                30400000
304100             QUEUE (ASC-LIST-QUEUE-NAME)                          30410000
304200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               30420000
304300             ITEM  (PV-BLOCK-NUMBER)                              30430000
304400             REWRITE                                              30440000
304500             RESP  (PV-CICS-RESP)                                 30450000
304600     END-EXEC.                                                    30460000
304700                                                                  30470000
304800     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           30480000
304900         CONTINUE                                                 30490000
305000     ELSE                                                         30500000
305100         SET DP013-CICS-ABEND            TO TRUE                  30510000
305200         SET DP013-NO-ROLLBACK           TO TRUE                  30520000
305300         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       30530000
305400         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     30540000
305500                                         TO DP013-MESSAGE-TEXT(1) 30550000
305600         PERFORM DP013-0000-PROCESS-ABEND                         30560000
305700     END-IF.                                                      30570000
305800                                                                  30580000
305900******************************************************************30590000
306000** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **30600000
306100** SPECIFIC COMMAREA.                                           **30610000
306200******************************************************************30620000
306300 5110-WRITE-ASC-LISTQ.                                            30630000
306400     EXEC CICS                                                    30640000
306500         WRITEQ TS                                                30650000
306600             QUEUE (ASC-LIST-QUEUE-NAME)                          30660000
306700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               30670000
306800             ITEM  (PV-BLOCK-NUMBER)                              30680000
306900             RESP  (PV-CICS-RESP)                                 30690000
307000     END-EXEC.                                                    30700000
307100     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      30710000
307200         SET DP013-CICS-ABEND      TO TRUE                        30720000
307300         SET DP013-NO-ROLLBACK     TO TRUE                        30730000
307400         MOVE '5110-WRITE-ASC-LISTQ'                              30740000
307500                                   TO DP013-PARAGRAPH             30750000
307600         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           30760000
307700                                   TO DP013-MESSAGE-TEXT(1)       30770000
307800         PERFORM DP013-0000-PROCESS-ABEND                         30780000
307900     END-IF.                                                      30790000
308000/                                                                 30800000
308100*----------------------------------------------------------------*30810000
308200* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *30820000
308300* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *30830000
308400*----------------------------------------------------------------*30840000
308500                                                                  30850000
308600 5120-REWRITE-LIST-QUEUE.                                         30860000
308700     EXEC CICS                                                    30870000
308800          WRITEQ TS                                               30880000
308900              QUEUE   (ASC-SEL-QUEUE-NAME-IN)                     30890000
309000              FROM    (SU030-SELECT-RECORD)                       30900000
309100              ITEM    (ASC-SEL-ITEM)                              30910000
309200              RESP    (PV-CICS-RESP)                              30920000
309300              REWRITE                                             30930000
309400     END-EXEC.                                                    30940000
309500*             FROM    (SU029-SELECT-RECORD)                       30950000
309600*             FROM    (SU029-INTER-APPL-COMMAREA)                 30960000
309700                                                                  30970000
309800     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    30980000
309900         SET DP013-CICS-ABEND                                     30990000
310000             DP013-NO-ROLLBACK     TO TRUE                        31000000
310100         MOVE '5120-REWRITE-LIST-QUEUE'                           31010000
310200                                   TO DP013-PARAGRAPH             31020000
310300         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   31030000
310400                                   TO DP013-MESSAGE-TEXT (1)      31040000
310500         PERFORM DP013-0000-PROCESS-ABEND                         31050000
310600     END-IF.                                                      31060000
310700                                                                  31070000
310800                                                                  31080000
310900 5200-FILL-SEL-QUEUE-RECORD.                                      31090000
311000                                                                  31100000
311100     PERFORM 6112-READ-LIST-QUEUE.                                31110000
311200                                                                  31120000
311300     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       31130000
311400         PERFORM                                                  31140000
311500         VARYING LQW-IDX                                          31150000
311600         FROM 1 BY 1                                              31160000
311700         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            31170000
311800           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          31180000
311900                                                                  31190000
312000             IF  LQW-SELECT (LQW-IDX)                             31200000
312100                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              31210000
312200                                   TO SU030-ITEM (SU030-IDX)      31220000
312300*                MOVE LQW-UPC (LQW-IDX)                           31230000
312400*                                  TO SU030-UPC-NBR    (SU030-IDX)31240000
312500                 MOVE SPACE        TO SU030-ACTION-SW (SU030-IDX) 31250000
312600                 SET SU030-IDX UP BY 1                            31260000
312700                 IF  SU030-IDX > SU030-MAX-ITEMS                  31270000
312800                     PERFORM 5205-WRITE-SEL-QUEUE                 31280000
312900                     ADD +1        TO SU029-NUMBER-OF-TS-ITEMS    31290000
313000                     INITIALIZE SU030-SELECTED-ITEM-ARRAY         31300000
313100                     SET SU030-IDX TO  1                          31310000
313200                 END-IF                                           31320000
313300             END-IF                                               31330000
313400         END-PERFORM                                              31340000
313500     END-IF.                                                      31350000
313600                                                                  31360000
313700*----------------------------------------------------------------*31370000
313800*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *31380000
313900*----------------------------------------------------------------*31390000
314000                                                                  31400000
314100 5205-WRITE-SEL-QUEUE.                                            31410000
314200                                                                  31420000
314300     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            31430000
314400                                   TO SU030-SELECTED-ITEMS.       31440000
314500                                                                  31450000
314600     EXEC CICS                                                    31460000
314700          WRITEQ TS                                               31470000
314800              QUEUE (ASC-SEL-QUEUE-NAME)                          31480000
314900              FROM  (SU030-SELECT-RECORD)                         31490000
315000              ITEM  (PV-SEL-QUEUE-ITEM)                           31500000
315100              RESP  (PV-CICS-RESP)                                31510000
315200     END-EXEC.                                                    31520000
315300                                                                  31530000
315400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          31540000
315500         CONTINUE                                                 31550000
315600     ELSE                                                         31560000
315700         SET DP013-CICS-ABEND      TO TRUE                        31570000
315800         SET DP013-NO-ROLLBACK     TO TRUE                        31580000
315900         MOVE '5205-WRITE-SEL-QUEUE'                              31590000
316000                                   TO DP013-PARAGRAPH             31600000
316100         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          31610000
316200                                   TO DP013-MESSAGE-TEXT(1)       31620000
316300         PERFORM DP013-0000-PROCESS-ABEND                         31630000
316400     END-IF.                                                      31640000
316500/                                                                 31650000
316600******************************************************************31660000
316700** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **31670000
316800** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **31680000
316900** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **31690000
317000** THE USER.                                                    **31700000
317100******************************************************************31710000
317200 6000-REFRESH-PANEL-FROM-TEMP.                                    31720000
317300     IF  ASC-UPDATE-TSQ                                           31730000
317400         SET ASC-NO-TSQ-UPDATE TO TRUE                            31740000
317500         MOVE ZERO                 TO PV-SAVE-ITEM                31750000
317600                                      PV-SEL-QUEUE-ITEM           31760000
317700         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        31770000
317800                                   TO PV-HOLD-SELECTED-ITEMS      31780000
317900         MOVE +1                   TO PV-ITEMS-PROCESSED          31790000
318000         PERFORM 6100-UPDATE-TSQ                                  31800000
318100             UNTIL PV-ITEMS-PROCESSED >                           31810000
318200                                     PV-HOLD-SELECTED-ITEMS       31820000
318300         PERFORM 6010-DELETE-SEL-QUEUE                            31830000
318400         INITIALIZE ASC-BLOCK-ENTRIES (1)                         31840000
318500                    ASC-BLOCK-ENTRIES (2)                         31850000
318600     END-IF.                                                      31860000
318700                                                                  31870000
318800*----------------------------------------------------------------*31880000
318900*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *31890000
319000*----------------------------------------------------------------*31900000
319100 6010-DELETE-SEL-QUEUE.                                           31910000
319200                                                                  31920000
319300     EXEC CICS                                                    31930000
319400         DELETEQ TS                                               31940000
319500             QUEUE (ASC-SEL-QUEUE-NAME)                           31950000
319600             RESP  (PV-CICS-RESP)                                 31960000
319700     END-EXEC.                                                    31970000
319800*                                                                 31980000
319900     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      31990000
320000        (PV-CICS-RESP = DFHRESP(QIDERR)))                         32000000
320100         CONTINUE                                                 32010000
320200     ELSE                                                         32020000
320300         SET DP013-CICS-ABEND TO TRUE                             32030000
320400         SET DP013-NO-ROLLBACK TO TRUE                            32040000
320500         MOVE '6010-DELETE-SEL-QUEUE'                             32050000
320600                        TO DP013-PARAGRAPH                        32060000
320700         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         32070000
320800                        TO DP013-MESSAGE-TEXT (1)                 32080000
320900         PERFORM DP013-0000-PROCESS-ABEND                         32090000
321000     END-IF.                                                      32100000
321100                                                                  32110000
321200*----------------------------------------------------------------*32120000
321300*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *32130000
321400*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *32140000
321500*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *32150000
321600*    THE TEMP QUEUE.                                             *32160000
321700*----------------------------------------------------------------*32170000
321800                                                                  32180000
321900 6100-UPDATE-TSQ.                                                 32190000
322000                                                                  32200000
322100     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             32210000
322200     PERFORM 6105-READ-SEL-QUEUE.                                 32220000
322300     PERFORM                                                      32230000
322400         VARYING SU030-IDX                                        32240000
322500         FROM 1 BY 1                                              32250000
322600         UNTIL ((PV-ITEMS-PROCESSED >                             32260000
322700                              PV-HOLD-SELECTED-ITEMS)             32270000
322800         OR (SU030-IDX GREATER THAN SU030-MAX-ITEMS))             32280000
322900         IF  SU030-ACTION-SW (SU030-IDX) > SPACE                  32290000
323000             PERFORM 6110-PROCESS-ITEMS                           32300000
323100         END-IF                                                   32310000
323200         ADD +1                TO PV-ITEMS-PROCESSED              32320000
323300     END-PERFORM.                                                 32330000
323400     PERFORM 6111-WRITE-LIST-QUEUE.                               32340000
323500*----------------------------------------------------------------*32350000
323600*    READ THE LIST QUEUE RECORD.                                 *32360000
323700*----------------------------------------------------------------*32370000
323800                                                                  32380000
323900 6105-READ-SEL-QUEUE.                                             32390000
324000                                                                  32400000
324100     EXEC CICS                                                    32410000
324200          READQ TS                                                32420000
324300              QUEUE (ASC-SEL-QUEUE-NAME)                          32430000
324400              INTO  (SU030-SELECT-RECORD)                         32440000
324500              ITEM  (PV-SEL-QUEUE-ITEM)                           32450000
324600              RESP  (PV-CICS-RESP)                                32460000
324700     END-EXEC.                                                    32470000
324800*                                                                 32480000
324900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          32490000
325000         CONTINUE                                                 32500000
325100     ELSE                                                         32510000
325200         SET DP013-CICS-ABEND      TO  TRUE                       32520000
325300         SET DP013-NO-ROLLBACK     TO  TRUE                       32530000
325400         MOVE '6105-READ-SEL-QUEUE'                               32540000
325500                                   TO  DP013-PARAGRAPH            32550000
325600         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           32560000
325700                                   TO  DP013-MESSAGE-TEXT(1)      32570000
325800         PERFORM DP013-0000-PROCESS-ABEND                         32580000
325900     END-IF.                                                      32590000
326000/                                                                 32600000
326100*----------------------------------------------------------------*32610000
326200*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*32620000
326300*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*32630000
326400*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *32640000
326500*----------------------------------------------------------------*32650000
326600                                                                  32660000
326700 6110-PROCESS-ITEMS.                                              32670000
326800                                                                  32680000
326900     COMPUTE PV-ITEM = 1 + ((SU030-ITEM (SU030-IDX) - 1)          32690000
327000                     / PC-ITEMS-PER-PANEL).                       32700000
327100                                                                  32710000
327200     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           32720000
327300         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          32730000
327400             PERFORM 6111-WRITE-LIST-QUEUE                        32740000
327500         END-IF                                                   32750000
327600         MOVE PV-ITEM          TO PV-SAVE-ITEM                    32760000
327700                                                                  32770000
327800         PERFORM 6112-READ-LIST-QUEUE                             32780000
327900         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               32790000
328000             CONTINUE                                             32800000
328100         END-IF                                                   32810000
328200     END-IF.                                                      32820000
328300                                                                  32830000
328400     COMPUTE PV-SUB = (SU030-ITEM (SU030-IDX)                     32840000
328500                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              32850000
328600     SET LQW-DESELECT (PV-SUB) TO    TRUE                         32860000
328700     MOVE LQW-SELECTED-SW (PV-SUB)                                32870000
328800                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  32880000
328900     EVALUATE TRUE                                                32890000
329000         WHEN SU030-INQ (SU030-IDX)                               32900000
329100              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             32910000
329200                                                                  32920000
329300         WHEN SU030-UPD (SU030-IDX)                               32930000
329400              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             32940000
329500                                                                  32950000
329600         WHEN SU030-DEL (SU030-IDX)                               32960000
329700              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             32970000
329800                                                                  32980000
329900         WHEN SU030-ERR (SU030-IDX)                               32990000
330000              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             33000000
330100     END-EVALUATE.                                                33010000
330200                                                                  33020000
330300     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                33030000
330400                                                                  33040000
330500*----------------------------------------------------------------*33050000
330600*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *33060000
330700*----------------------------------------------------------------*33070000
330800                                                                  33080000
330900 6111-WRITE-LIST-QUEUE.                                           33090000
331000                                                                  33100000
331100     EXEC CICS                                                    33110000
331200         WRITEQ TS                                                33120000
331300             QUEUE (ASC-LIST-QUEUE-NAME)                          33130000
331400             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     33140000
331500             ITEM  (PV-SAVE-ITEM)                                 33150000
331600             REWRITE                                              33160000
331700             RESP  (PV-CICS-RESP)                                 33170000
331800     END-EXEC.                                                    33180000
331900*                                                                 33190000
332000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          33200000
332100         CONTINUE                                                 33210000
332200     ELSE                                                         33220000
332300         SET DP013-CICS-ABEND  TO  TRUE                           33230000
332400         SET DP013-NO-ROLLBACK TO  TRUE                           33240000
332500         MOVE '6111-WRITE-LIST-QUEUE'                             33250000
332600                               TO  DP013-PARAGRAPH                33260000
332700         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  33270000
332800                               TO  DP013-MESSAGE-TEXT(1)          33280000
332900         PERFORM DP013-0000-PROCESS-ABEND                         33290000
333000     END-IF.                                                      33300000
333100                                                                  33310000
333200/                                                                 33320000
333300*----------------------------------------------------------------*33330000
333400*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*33340000
333500*----------------------------------------------------------------*33350000
333600                                                                  33360000
333700 6112-READ-LIST-QUEUE.                                            33370000
333800                                                                  33380000
333900     EXEC CICS                                                    33390000
334000         READQ TS                                                 33400000
334100             QUEUE (ASC-LIST-QUEUE-NAME)                          33410000
334200             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     33420000
334300             ITEM  (PV-ITEM)                                      33430000
334400             RESP  (PV-CICS-RESP)                                 33440000
334500     END-EXEC.                                                    33450000
334600*                                                                 33460000
334700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          33470000
334800         CONTINUE                                                 33480000
334900     ELSE                                                         33490000
335000         SET DP013-CICS-ABEND        TO TRUE                      33500000
335100         SET DP013-NO-ROLLBACK       TO TRUE                      33510000
335200         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           33520000
335300         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    33530000
335400                                     TO DP013-MESSAGE-TEXT(1)     33540000
335500         PERFORM DP013-0000-PROCESS-ABEND                         33550000
335600     END-IF.                                                      33560000
335700/                                                                 33570000
335800 7000-OPEN-OVER-SHORT-CSR.                                        33580000
335900     EXEC SQL                                                     33590000
336000         OPEN                                                     33600000
336100            OVER-SHORT-CSR                                        33610000
336200     END-EXEC.                                                    33620000
336300                                                                  33630000
336400     EVALUATE TRUE                                                33640000
336500         WHEN SQLCODE = ZERO                                      33650000
336600                 CONTINUE                                         33660000
336700         WHEN SQLCODE = -904                                      33670000
336800         WHEN SQLCODE = -913                                      33680000
336900         WHEN SQLWARN0 NOT = SPACES                               33690000
337000         WHEN SQLCODE < ZERO                                      33700000
337100         WHEN SQLCODE > ZERO                                      33710000
337200             MOVE '7000-OPEN-OVER-SHORT-CSR'                      33720000
337300                                   TO DP013-PARAGRAPH             33730000
337400             MOVE 'OPEN OVER/SHORT CURSOR - '                     33740000
337500                                   TO DP013-MESSAGE-TEXT (1)      33750000
337600             MOVE SQLCA        TO DP013-SQLCA                     33760000
337700             MOVE 'TSUAUPC '  TO DP013-DB2-TABLE-NAME (1)         33770000
337800             MOVE 'TSHUUPC '  TO DP013-DB2-TABLE-NAME (2)         33780000
337900             MOVE 'TSHPUNT '  TO DP013-DB2-TABLE-NAME (3)         33790000
338000             SET DP013-DB2-ABEND                                  33800000
338100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           33810000
338200             PERFORM DP013-0000-PROCESS-ABEND                     33820000
338300         END-EVALUATE.                                            33830000
338400*                                                                 33840000
338500 7010-FETCH-OVER-SHORT-CSR.                                       33850000
338600     EXEC SQL                                                     33860000
338700         FETCH OVER-SHORT-CSR                                     33870000
338800     INTO                                                         33880000
338900         :SHUUPC-UPC-NBR                                          33890000
339000     ,   :PV-COUNT                                                33900000
      *SB 01/02/14 - BEGIN PR#5148D                                     33900100
           ,   :PV-RFID-COUNT                                           33901000
      *SB 01/02/14 - END PR#5148D                                       33902000
339100     ,   :PV-AUD-OR-ORD                                           33910000
339200     END-EXEC                                                     33920000
339300                                                                  33930000
339400     EVALUATE TRUE                                                33940000
339500         WHEN SQLCODE = ZERO                                      33950000
      *SB 01/02/14 - BEGIN PR#5148D                                     33951000
                    IF PS-RFID-AUDIT                                    33960000
                       MOVE PV-RFID-COUNT TO PV-COUNT                   33960100
                    END-IF                                              33961000
      *SB 01/02/14 - END PR#5148D                                       33962000
339700         WHEN SQLCODE = +100                                      33970000
339800             SET PS-END-OS-CSR        TO TRUE                     33980000
339900         WHEN SQLCODE = -904                                      33990000
340000         WHEN SQLCODE = -913                                      34000000
340100         WHEN SQLWARN0 NOT = SPACES                               34010000
340200         WHEN SQLCODE < ZERO                                      34020000
340300         WHEN SQLCODE > ZERO                                      34030000
340400             MOVE '7010-FETCH-OVER-SHORT-CSR'                     34040000
340500                                   TO DP013-PARAGRAPH             34050000
340600             MOVE 'FETCH OVER/SHORT CURSOR - '                    34060000
340700                                   TO DP013-MESSAGE-TEXT (1)      34070000
340800             MOVE SQLCA        TO DP013-SQLCA                     34080000
340900             MOVE 'TSUAUPC '  TO DP013-DB2-TABLE-NAME (1)         34090000
341000             MOVE 'TSHUUPC '  TO DP013-DB2-TABLE-NAME (2)         34100000
341100             MOVE 'TSHPUNT '  TO DP013-DB2-TABLE-NAME (3)         34110000
341200             SET DP013-DB2-ABEND                                  34120000
341300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           34130000
341400             PERFORM DP013-0000-PROCESS-ABEND                     34140000
341500     END-EVALUATE.                                                34150000
341600                                                                  34160000
341700 7020-CLOSE-OVER-SHORT-CSR.                                       34170000
341800                                                                  34180000
341900     EXEC SQL                                                     34190000
342000         CLOSE                                                    34200000
342100            OVER-SHORT-CSR                                        34210000
342200     END-EXEC.                                                    34220000
342300                                                                  34230000
342400     EVALUATE TRUE                                                34240000
342500         WHEN SQLCODE = ZERO                                      34250000
342600                 CONTINUE                                         34260000
342700         WHEN SQLCODE = -904                                      34270000
342800         WHEN SQLCODE = -913                                      34280000
342900         WHEN SQLWARN0 NOT = SPACES                               34290000
343000         WHEN SQLCODE < ZERO                                      34300000
343100         WHEN SQLCODE > ZERO                                      34310000
343200             MOVE '7020-CLOSE-OVER-SHORT-CSR'                     34320000
343300                                   TO DP013-PARAGRAPH             34330000
343400             MOVE 'CLOSE OVER/SHORT CURSOR - '                    34340000
343500                                   TO DP013-MESSAGE-TEXT (1)      34350000
343600             MOVE SQLCA        TO DP013-SQLCA                     34360000
343700             MOVE 'TSUAUPC '  TO DP013-DB2-TABLE-NAME (1)         34370000
343800             MOVE 'TSHUUPC '  TO DP013-DB2-TABLE-NAME (2)         34380000
343900             MOVE 'TSHPUNT '  TO DP013-DB2-TABLE-NAME (3)         34390000
344000             SET DP013-DB2-ABEND                                  34400000
344100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           34410000
344200             PERFORM DP013-0000-PROCESS-ABEND                     34420000
344300     END-EVALUATE.                                                34430000
344400/                                                                 34440000
344500 7100-OPEN-CARTON-CSR.                                            34450000
344600     EXEC SQL                                                     34460000
344700         OPEN                                                     34470000
344800            CARTON-CSR                                            34480000
344900     END-EXEC.                                                    34490000
345000                                                                  34500000
345100     EVALUATE TRUE                                                34510000
345200         WHEN SQLCODE = ZERO                                      34520000
345300                 CONTINUE                                         34530000
345400         WHEN SQLCODE = -904                                      34540000
345500         WHEN SQLCODE = -913                                      34550000
345600         WHEN SQLWARN0 NOT = SPACES                               34560000
345700         WHEN SQLCODE < ZERO                                      34570000
345800         WHEN SQLCODE > ZERO                                      34580000
345900             MOVE '7100-OPEN-CARTON-CSR'                          34590000
346000                                   TO DP013-PARAGRAPH             34600000
346100             MOVE 'OPEN CARTON CURSOR - '                         34610000
346200                                   TO DP013-MESSAGE-TEXT (1)      34620000
346300             MOVE SQLCA        TO DP013-SQLCA                     34630000
346400             MOVE 'TSUAUPC '  TO DP013-DB2-TABLE-NAME (1)         34640000
346500             MOVE 'TSHUUPC '  TO DP013-DB2-TABLE-NAME (2)         34650000
346600             MOVE 'TSHPUNT '  TO DP013-DB2-TABLE-NAME (3)         34660000
346700             SET DP013-DB2-ABEND                                  34670000
346800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           34680000
346900             PERFORM DP013-0000-PROCESS-ABEND                     34690000
347000         END-EVALUATE.                                            34700000
347100/                                                                 34710000
347200 7110-FETCH-CARTON-CSR.                                           34720000
347300                                                                  34730000
347400     EXEC SQL                                                     34740000
347500         FETCH CARTON-CSR                                         34750000
347600     INTO                                                         34760000
347700            :CTEXCP-VILN-GP-CDE                                   34770000
347800         ,  :CTEXCP-VILN-GP-SEQ-NBR                               34780000
347900         ,  :VILNCD-VILN-CDE-SHRT-DESC                            34790000
348000         ,  :CTEXCP-OVRRID-SYS-DAT-TXT                            34800000
348100         ,  :SUATRN-TRN-NBR                                       34810000
348200         ,  :SUATRN-DEST-OPER-UNT-ID                              34820000
348300     END-EXEC                                                     34830000
348400                                                                  34840000
348500     EVALUATE TRUE                                                34850000
348600         WHEN SQLCODE = ZERO                                      34860000
348700                 CONTINUE                                         34870000
348800         WHEN SQLCODE = +100                                      34880000
348900             SET PS-END-CTN-CSR       TO TRUE                     34890000
349000         WHEN SQLCODE = -904                                      34900000
349100         WHEN SQLCODE = -913                                      34910000
349200         WHEN SQLWARN0 NOT = SPACES                               34920000
349300         WHEN SQLCODE < ZERO                                      34930000
349400         WHEN SQLCODE > ZERO                                      34940000
349500             MOVE '7110-FETCH-CARTON-CSR'                         34950000
349600                                   TO DP013-PARAGRAPH             34960000
349700             MOVE 'FETCH OVER/SHORT CURSOR - '                    34970000
349800                                   TO DP013-MESSAGE-TEXT (1)      34980000
349900             MOVE SQLCA        TO DP013-SQLCA                     34990000
350000             MOVE 'TSUAUPC '  TO DP013-DB2-TABLE-NAME (1)         35000000
350100             MOVE 'TSHUUPC '  TO DP013-DB2-TABLE-NAME (2)         35010000
350200             MOVE 'TSHPUNT '  TO DP013-DB2-TABLE-NAME (3)         35020000
350300             SET DP013-DB2-ABEND                                  35030000
350400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           35040000
350500             PERFORM DP013-0000-PROCESS-ABEND                     35050000
350600     END-EVALUATE.                                                35060000
350700                                                                  35070000
350800 7120-CLOSE-CARTON-CSR.                                           35080000
350900                                                                  35090000
351000     EXEC SQL                                                     35100000
351100         CLOSE                                                    35110000
351200            CARTON-CSR                                            35120000
351300     END-EXEC.                                                    35130000
351400                                                                  35140000
351500     EVALUATE TRUE                                                35150000
351600         WHEN SQLCODE = ZERO                                      35160000
351700                 CONTINUE                                         35170000
351800         WHEN SQLCODE = -904                                      35180000
351900         WHEN SQLCODE = -913                                      35190000
352000         WHEN SQLWARN0 NOT = SPACES                               35200000
352100         WHEN SQLCODE < ZERO                                      35210000
352200         WHEN SQLCODE > ZERO                                      35220000
352300             MOVE '7120-CLOSE-CARTON-CSR'                         35230000
352400                                   TO DP013-PARAGRAPH             35240000
352500             MOVE 'CLOSE OVER/SHORT CURSOR - '                    35250000
352600                                   TO DP013-MESSAGE-TEXT (1)      35260000
352700             MOVE SQLCA        TO DP013-SQLCA                     35270000
352800             MOVE 'TSUAUPC '  TO DP013-DB2-TABLE-NAME (1)         35280000
352900             MOVE 'TSHUUPC '  TO DP013-DB2-TABLE-NAME (2)         35290000
353000             MOVE 'TSHPUNT '  TO DP013-DB2-TABLE-NAME (3)         35300000
353100             SET DP013-DB2-ABEND                                  35310000
353200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           35320000
353300             PERFORM DP013-0000-PROCESS-ABEND                     35330000
353400     END-EVALUATE.                                                35340000
353500                                                                  35350000
353600/                                                                 35360000
353700 7200-OPEN-UPC-CSR.                                               35370000
353800     EXEC SQL                                                     35380000
353900         OPEN                                                     35390000
354000            UPC-CSR                                               35400000
354100     END-EXEC.                                                    35410000
354200                                                                  35420000
354300     EVALUATE TRUE                                                35430000
354400         WHEN SQLCODE = ZERO                                      35440000
354500                 CONTINUE                                         35450000
354600         WHEN SQLCODE = -904                                      35460000
354700         WHEN SQLCODE = -913                                      35470000
354800         WHEN SQLWARN0 NOT = SPACES                               35480000
354900         WHEN SQLCODE < ZERO                                      35490000
355000         WHEN SQLCODE > ZERO                                      35500000
355100             MOVE '7200-OPEN-CARTON-CSR'                          35510000
355200                                   TO DP013-PARAGRAPH             35520000
355300             MOVE 'OPEN UPC CURSOR - '                            35530000
355400                                   TO DP013-MESSAGE-TEXT (1)      35540000
355500             MOVE SQLCA        TO DP013-SQLCA                     35550000
355600             MOVE 'TSUAUPC '  TO DP013-DB2-TABLE-NAME (1)         35560000
355700             SET DP013-DB2-ABEND                                  35570000
355800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           35580000
355900             PERFORM DP013-0000-PROCESS-ABEND                     35590000
356000         END-EVALUATE.                                            35600000
356100/                                                                 35610000
356200 7210-FETCH-UPC-CSR.                                              35620000
356300                                                                  35630000
356400     EXEC SQL                                                     35640000
356500         FETCH UPC-CSR                                            35650000
356600     INTO                                                         35660000
356700           :SUAUPC-SKU-NBR                                        35670000
357000         , :SUAUPC-ITM-DESC                                       35700000
357100         , :SUAUPC-VND-STYL-DESC                                  35710000
357200         , :SUAUPC-UPC-CLOR-DESC                                  35720000
357300         , :SUAUPC-UPC-SIZE-DESC                                  35730000
357400         , :SUAUPC-UPC-RTL-AMT                                    35740000
357410         , :SUAUPC-DEPT-NBR                                       35741000
357420         , :SUAUPC-MAJ-CL-NBR                                     35742000
357430         , :SUAUPC-SUB-CL-NBR                                     35743000
357500     END-EXEC                                                     35750000
357600                                                                  35760000
357700     EVALUATE TRUE                                                35770000
357800         WHEN SQLCODE = ZERO                                      35780000
357900                 CONTINUE                                         35790000
358000         WHEN SQLCODE = +100                                      35800000
358100             SET PS-END-UPC-CSR       TO TRUE                     35810000
358200         WHEN SQLCODE = -904                                      35820000
358300         WHEN SQLCODE = -913                                      35830000
358400         WHEN SQLWARN0 NOT = SPACES                               35840000
358500         WHEN SQLCODE < ZERO                                      35850000
358600         WHEN SQLCODE > ZERO                                      35860000
358700             MOVE '7210-FETCH-UPC-CSR'                            35870000
358800                                   TO DP013-PARAGRAPH             35880000
358900             MOVE 'FETCH UPC CURSOR - '                           35890000
359000                                   TO DP013-MESSAGE-TEXT (1)      35900000
359100             MOVE SQLCA        TO DP013-SQLCA                     35910000
359200             MOVE 'TSUAUPC '  TO DP013-DB2-TABLE-NAME (1)         35920000
359300             SET DP013-DB2-ABEND                                  35930000
359400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           35940000
359500             PERFORM DP013-0000-PROCESS-ABEND                     35950000
359600     END-EVALUATE.                                                35960000
359700                                                                  35970000
359800 7220-CLOSE-UPC-CSR.                                              35980000
359900                                                                  35990000
360000     EXEC SQL                                                     36000000
360100         CLOSE                                                    36010000
360200            UPC-CSR                                               36020000
360300     END-EXEC.                                                    36030000
360400                                                                  36040000
360500     EVALUATE TRUE                                                36050000
360600         WHEN SQLCODE = ZERO                                      36060000
360700             CONTINUE                                             36070000
360800         WHEN SQLCODE = -904                                      36080000
360900         WHEN SQLCODE = -913                                      36090000
361000         WHEN SQLWARN0 NOT = SPACES                               36100000
361100         WHEN SQLCODE < ZERO                                      36110000
361200         WHEN SQLCODE > ZERO                                      36120000
361300             MOVE '7220-CLOSE-UPC-CSR'                            36130000
361400                                   TO DP013-PARAGRAPH             36140000
361500             MOVE 'CLOSE UPC CURSOR - '                           36150000
361600                                   TO DP013-MESSAGE-TEXT (1)      36160000
361700             MOVE SQLCA        TO DP013-SQLCA                     36170000
361800             MOVE 'TSUAUPC '  TO DP013-DB2-TABLE-NAME (1)         36180000
361900             SET DP013-DB2-ABEND                                  36190000
362000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           36200000
362100             PERFORM DP013-0000-PROCESS-ABEND                     36210000
362200     END-EVALUATE.                                                36220000
362300                                                                  36230000
362400 7300-COUNT-X-RECS.                                               36240000
362500                                                                  36250000
362600     EXEC SQL                                                     36260000
362700           SELECT COUNT(*)                                        36270000
362800           INTO :PV-TSUAUPC-X-RECS                                36280000
362900            FROM  TSUAUPC                                         36290000
363000            WHERE AUD_CNTL_NBR        = :DK-AUDIT-NBR             36300000
363100              AND SHIPT_UNT_ID        = :DK-SHIPT-UNIT-ID         36310000
363200              AND UPC_NBR             = :DK-UPC-NBR               36320000
363300              AND SCN_TYP_CDE         = 'X'                       36330000
363400     END-EXEC.                                                    36340000
363500                                                                  36350000
363600     EVALUATE TRUE                                                36360000
363700         WHEN SQLCODE = ZERO                                      36370000
363800         WHEN SQLCODE = +100                                      36380000
363900             CONTINUE                                             36390000
364000         WHEN SQLWARN0 NOT = SPACES                               36400000
364100         WHEN SQLCODE < ZERO                                      36410000
364200         WHEN SQLCODE > ZERO                                      36420000
364300             MOVE '7300-COUNT-X-RECS'                             36430000
364400                                   TO DP013-PARAGRAPH             36440000
364500             MOVE 'SELECT X RECORDS - '                           36450000
364600                                   TO DP013-MESSAGE-TEXT (1)      36460000
364700             MOVE SQLCA        TO DP013-SQLCA                     36470000
364800             MOVE 'TSUAUPC '  TO DP013-DB2-TABLE-NAME (1)         36480000
364900             SET DP013-DB2-ABEND                                  36490000
365000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           36500000
365100             PERFORM DP013-0000-PROCESS-ABEND                     36510000
365200     END-EVALUATE.                                                36520000
365300                                                                  36530000
365400 7400-COUNT-P-RECS.                                               36540000
365500                                                                  36550000
365600     EXEC SQL                                                     36560000
365700           SELECT COUNT(*)                                        36570000
365800           INTO :PV-TSUAUPC-P-RECS                                36580000
365900            FROM  TSUAUPC                                         36590000
366000            WHERE AUD_CNTL_NBR        = :DK-AUDIT-NBR             36600000
366100              AND SHIPT_UNT_ID        = :DK-SHIPT-UNIT-ID         36610000
366200              AND UPC_NBR             = :DK-UPC-NBR               36620000
366300              AND SCN_TYP_CDE         = 'P'                       36630000
366400     END-EXEC.                                                    36640000
366500                                                                  36650000
366600     EVALUATE TRUE                                                36660000
366700         WHEN SQLCODE = ZERO                                      36670000
366800         WHEN SQLCODE = +100                                      36680000
366900             CONTINUE                                             36690000
367000         WHEN SQLWARN0 NOT = SPACES                               36700000
367100         WHEN SQLCODE < ZERO                                      36710000
367200         WHEN SQLCODE > ZERO                                      36720000
367300             MOVE '7400-COUNT-P-RECS'                             36730000
367400                                   TO DP013-PARAGRAPH             36740000
367500             MOVE 'SELECT P RECORDS - '                           36750000
367600                                   TO DP013-MESSAGE-TEXT (1)      36760000
367700             MOVE SQLCA        TO DP013-SQLCA                     36770000
367800             MOVE 'TSUAUPC '  TO DP013-DB2-TABLE-NAME (1)         36780000
367900             SET DP013-DB2-ABEND                                  36790000
368000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           36800000
368100             PERFORM DP013-0000-PROCESS-ABEND                     36810000
368200     END-EVALUATE.                                                36820000
368300                                                                  36830000
       8000-CHECK-RFID-AUDIT.                                           36831000
                                                                        36832000
           INITIALIZE DCLSUT00015                                       36833000
                      DCLSUT00014.                                      36834000
                                                                        36835000
           PERFORM 8100-CHK-SYSTEM-AUDIT                                36836000
                                                                        36837000
           IF PS-SYS-AUDIT                                              36838000
              IF SUT00015-PKGNG-TYP-CDE = 'RF'                          36838100
                 SET PS-RFID-AUDIT TO TRUE                              36838200
              ELSE                                                      36838300
                 SET PS-NO-RFID-AUDIT TO TRUE                           36838400
              END-IF                                                    36838500
           ELSE                                                         36839000
              PERFORM 8200-CHK-RFID-PO-EXCEPTION                        36839100
              IF PS-RFID-PO-EXC                                         36839200
                 SET PS-RFID-AUDIT TO TRUE                              36839300
              ELSE                                                      36839400
                 SET PS-NO-RFID-AUDIT TO TRUE                           36839500
              END-IF                                                    36839600
           END-IF.                                                      36839800
                                                                        36839900
       8100-CHK-SYSTEM-AUDIT.                                           36840000
                                                                        36840100
           MOVE ASC-AUDIT-NUMBER TO SUT00015-AUD-CNTL-NBR               36840200
                                                                        36840300
           EXEC SQL                                                     36840400
                SELECT PKGNG_TYP_CDE                                    36840500
                INTO  :SUT00015-PKGNG-TYP-CDE                           36840600
                FROM   SUT_PO_AUD_REQ                                   36840700
                WHERE  AUD_CNTL_NBR = :SUT00015-AUD-CNTL-NBR            36840800
           END-EXEC.                                                    36840900
                                                                        36841000
           EVALUATE SQLCODE                                             36841100
              WHEN 0                                                    36841200
                   SET PS-SYS-AUDIT TO TRUE                             36841300
              WHEN 100                                                  36841400
                   SET PS-MAN-AUDIT TO TRUE                             36841500
              WHEN OTHER                                                36841600
367300             MOVE '8100-CHK-SYSTEM-AUDIT'                         36841700
367400                                   TO DP013-PARAGRAPH             36841800
367500             MOVE 'SELECT AUDIT TYPE'                             36841900
367600                                   TO DP013-MESSAGE-TEXT (1)      36842000
367700             MOVE SQLCA        TO DP013-SQLCA                     36842100
367800             MOVE 'SUT00015'  TO DP013-DB2-TABLE-NAME (1)         36842200
367900             SET DP013-DB2-ABEND                                  36842300
368000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           36842400
368100             PERFORM DP013-0000-PROCESS-ABEND                     36842500
           END-EVALUATE.                                                36842700
                                                                        36842800
       8200-CHK-RFID-PO-EXCEPTION.                                      36842900
                                                                        36843000
           MOVE ASC-PO-NBR       TO SUT00014-PO-NBR.                    36843100
           MOVE ASC-OPER-UNIT-ID TO SUT00014-OPER-UNT-ID.               36843200
                                                                        36843300
           EXEC SQL                                                     36843400
                SELECT AUD_TYP_CDE                                      36843500
                INTO  :SUT00014-AUD-TYP-CDE                             36843600
                FROM   SUT_PO_AUD_EXC                                   36843700
                WHERE  PO_NBR      = :SUT00014-PO-NBR                   36843800
                AND    OPER_UNT_ID = :SUT00014-OPER-UNT-ID              36843900
                AND    AUD_TYP_CDE = 'R'                                36844000
           END-EXEC.                                                    36844100
                                                                        36844200
           EVALUATE SQLCODE                                             36844300
              WHEN 0                                                    36844400
                   SET PS-RFID-PO-EXC    TO TRUE                        36844500
              WHEN 100                                                  36844600
                   SET PS-NO-RFID-PO-EXC TO TRUE                        36844700
              WHEN OTHER                                                36844800
367300             MOVE '8200-CHK-RFID-PO-EXCEPTION'                    36844900
367400                                   TO DP013-PARAGRAPH             36845000
367500             MOVE 'SELECT RFID PO EXC'                            36845100
367600                                   TO DP013-MESSAGE-TEXT (1)      36845200
367700             MOVE SQLCA        TO DP013-SQLCA                     36845300
367800             MOVE 'SUT00014'  TO DP013-DB2-TABLE-NAME (1)         36845400
367900             SET DP013-DB2-ABEND                                  36845500
368000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           36845600
368100             PERFORM DP013-0000-PROCESS-ABEND                     36845700
           END-EVALUATE.                                                36845800
                                                                        36845900
368400*----------------------------------------------------------------*36846000
368500* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *36850000
368600*----------------------------------------------------------------*36860000
368700                                                                  36870000
368800 9100-READ-SEL-QUEUE.                                             36880000
368900     EXEC CICS                                                    36890000
369000         READQ TS                                                 36900000
369100             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        36910000
369200             INTO  (SU030-SELECT-RECORD)                          36920000
369300             ITEM  (ASC-SEL-ITEM)                                 36930000
369400             RESP  (PV-CICS-RESPONSE)                             36940000
369500     END-EXEC.                                                    36950000
369600                                                                  36960000
369700     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   36970000
369800         CONTINUE                                                 36980000
369900     ELSE                                                         36990000
370000         SET DP013-LOGIC-ABEND                                    37000000
370100             DP013-NO-ROLLBACK     TO TRUE                        37010000
370200         MOVE '9100-READ-SEL-QUEUE'                               37020000
370300                                   TO DP013-PARAGRAPH             37030000
370400         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   37040000
370500                                   TO DP013-MESSAGE-TEXT (1)      37050000
370600         PERFORM DP013-0000-PROCESS-ABEND                         37060000
370700     END-IF.                                                      37070000
370800*----------------------------------------------------------------*37080000
370900* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *37090000
371000*----------------------------------------------------------------*37100000
371100 9200-REWRITE-LIST-QUEUE.                                         37110000
371200     EXEC CICS                                                    37120000
371300          WRITEQ TS                                               37130000
371400              QUEUE  (ASC-SEL-QUEUE-NAME-IN)                      37140000
371500              FROM   (SU030-SELECT-RECORD)                        37150000
371600              ITEM   (ASC-SEL-ITEM)                               37160000
371700              RESP   (PV-CICS-RESPONSE)                           37170000
371800              REWRITE                                             37180000
371900     END-EXEC.                                                    37190000
372000                                                                  37200000
372100     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               37210000
372200         SET DP013-CICS-ABEND                                     37220000
372300             DP013-NO-ROLLBACK     TO TRUE                        37230000
372400         MOVE '9200-REWRITE-LIST-QUEUE'                           37240000
372500                                   TO DP013-PARAGRAPH             37250000
372600         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   37260000
372700                                   TO DP013-MESSAGE-TEXT (1)      37270000
372800         PERFORM DP013-0000-PROCESS-ABEND                         37280000
372900     END-IF.                                                      37290000
373000                                                                  37300000
373100/                                                                 37310000
373200*----------------------------------------------------------------*37320000
373300*    ABEND PROCESSOR MODULE                                      *37330000
373400*----------------------------------------------------------------*37340000
373500                                                                  37350000
373600     COPY DPPD013.                                                37360000
