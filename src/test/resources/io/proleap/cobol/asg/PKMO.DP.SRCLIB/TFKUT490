000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             TFKUT490.                                00050000
000600 AUTHOR.                 JACK KRAMER.                             00060000
000700 INSTALLATION.           KOHLS.                                   00070000
000800 DATE-WRITTEN            APRIL, 1997.                             00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*      THIS PROGRAM WILL READ AN INPUT CONTROL CARD AND CREATE    00120000
001300*  AN OUTPUT FILE CONTAINING A BEGINNING AND ENDING DATE FOR      00130000
001400*  THE REQUESTED REPORTING TIME FRAME. A NORMAL RUN WILL WRITE    00140006
001410*  THE OUTPUT FILE WITH BEGIN AND END DATES FOR THE PREVIOUS      00141006
001420*  FISCAL PERIOD. A SPECIAL RUN WILL READ BEGIN AND END DATES FROM00142006
001430*  THE CONTROL CARD, AND WILL INSURE THAT THE DATES ARE VALID.    00143006
001500******************************************************************00150000
001600                                                                  00160000
001700******************************************************************00170000
001800 ENVIRONMENT DIVISION.                                            00180000
001900******************************************************************00190000
002000                                                                  00200000
002100 CONFIGURATION SECTION.                                           00210000
002200                                                                  00220000
002300 SOURCE-COMPUTER.        IBM-3090.                                00230000
002400 OBJECT-COMPUTER.        IBM-3090.                                00240000
002500                                                                  00250000
002600 INPUT-OUTPUT SECTION.                                            00260000
002700                                                                  00270000
002800 FILE-CONTROL.                                                    00280000
002900                                                                  00290000
003000     SELECT CONTROL-CARD-FILE                                     00300000
003100         ASSIGN TO INP01.                                         00310000
003200                                                                  00320000
003300     SELECT PROCESS-DATES-FILE                                    00330005
003400         ASSIGN TO OUT01.                                         00340000
003500                                                                  00350000
003600******************************************************************00360000
003700 DATA DIVISION.                                                   00370000
003800******************************************************************00380000
003900                                                                  00390000
004000 FILE SECTION.                                                    00400000
004100                                                                  00410000
004200 FD  CONTROL-CARD-FILE                                            00420000
004300     LABEL RECORDS ARE STANDARD                                   00430000
004400     RECORDING MODE IS F                                          00440000
004500     BLOCK CONTAINS 0 RECORDS                                     00450000
004600     RECORD CONTAINS 80 CHARACTERS.                               00460000
004700                                                                  00470000
004800 01  CC-RECORD                       PIC X(80).                   00480000
004900                                                                  00490000
005000 FD  PROCESS-DATES-FILE                                           00500005
005100     RECORDING MODE IS F                                          00510000
005200     LABEL RECORDS ARE STANDARD                                   00520000
005300     BLOCK CONTAINS 0 RECORDS.                                    00530000
005400                                                                  00540000
005500 01  PROCESS-DATES-RECORD                PIC  X(16).              00550005
005600                                                                  00560000
005700******************************************************************00570000
005800 WORKING-STORAGE SECTION.                                         00580000
005900******************************************************************00590000
006000                                                                  00600000
006100*                                                                 00610000
006200*  RECORD LAYOUT FOR THE FISCAL DATES FILE                        00620000
006300*                                                                 00630000
006400     COPY TFRD029.                                                00640000
006500                                                                  00650000
006600*                                                                 00660000
006700*  RECORD LAYOUT FOR THE CONTROL CARD FILE                        00670000
006800*                                                                 00680000
006900     COPY TFRD035.                                                00690000
007000                                                                  00700000
007100*                                                                 00710000
007200*  COPY BOOK FOR THE CALENDAR ROUTINE                             00720000
007300*                                                                 00730000
007400     COPY DPWS500.                                                00740000
007500                                                                  00750000
007600*                                                                 00760000
007700*  DB2 FORMATTED ERROR MESSAGE                                    00770000
007800*                                                                 00780000
007900     COPY DPWS004.                                                00790000
008000                                                                  00800000
008100 01  ABEND-CODE                          PIC S9(04)  VALUE +0     00810000
008200                                                     COMP SYNC.   00820000
008300                                                                  00830000
008400 01  CD-CURRENT-DATE.                                             00840000
008500     05  CD-CURRENT-YEAR                 PIC  9(02)  VALUE ZEROS. 00841017
008600     05  CD-CURRENT-MONTH                PIC  9(02)  VALUE ZEROS. 00842017
008700     05  CD-CURRENT-DAY                  PIC  9(02)  VALUE ZEROS. 00843017
008800                                                                  00880000
008900 01  PC-PROGRAM-CONSTANTS.                                        00890000
009100     05  PC-PROGRAM-NAME           PIC  X(08)  VALUE  'TFKUT490'. 00910000
009200     05  PC-1-PERIOD                     PIC  S9(03) VALUE  +1    00920010
009300                                                     COMP-3.      00930000
009600                                                                  00960000
009700 01  PV-PROGRAM-VARIABLES.                                        00970000
009800     05  PV-GREGORIAN-DATE.                                       00980000
009900         10  PV-GD-MONTH                 PIC  9(02)  VALUE ZEROS. 00990000
010000         10  PV-GD-DAY                   PIC  9(02)  VALUE ZEROS. 01000000
010100         10  PV-GD-YEAR                  PIC  9(02)  VALUE ZEROS. 01010000
010200     05  PV-GREGORIAN-CC-DATE.                                    01020000
010300         10  PV-GD-CC-MONTH              PIC  9(02)  VALUE ZEROS. 01030000
010400         10  PV-GD-CC-DAY                PIC  9(02)  VALUE ZEROS. 01040000
010500         10  PV-GD-CC-CENTURY            PIC  9(02)  VALUE ZEROS. 01050000
010600         10  PV-GD-CC-YEAR               PIC  9(02)  VALUE ZEROS. 01060000
010700     05  PV-BEG-DATE                     PIC  X(10)  VALUE SPACE. 01070000
010800     05  PV-END-DATE                     PIC  X(10)  VALUE SPACE. 01080000
010900                                                                  01090000
011000******************************************************************01100000
011100 PROCEDURE DIVISION.                                              01110000
011200******************************************************************01120000
011300                                                                  01130000
011400******************************************************************01140000
011500*  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM    01150000
011600******************************************************************01160000
011700 0000-PROGRAM-MAINLINE.                                           01170000
011800     PERFORM 1000-INITIALIZE.                                     01180000
011900                                                                  01190000
012000     PERFORM 9000-EOJ-ROUTINE.                                    01200000
012100                                                                  01210000
012200     STOP RUN.                                                    01220000
012300*                                                                 01230000
012400******************************************************************01240000
012500*  1000-INITIALIZE - ACCEPTS THE CURRENT SYSTEM DATE, OPENS AND   01250000
012600*  READS THE CONTROL CARD FILE. PASSES CONTROL TO THE APPROPRIATE 01260000
012700*  PARAGRAPH DEPENDING ON THE REQUESTED RUN TYPE.                 01270000
012800******************************************************************01280000
012900 1000-INITIALIZE.                                                 01290000
013000     ACCEPT CD-CURRENT-DATE  FROM  DATE.                          01300017
013100                                                                  01310000
013200     OPEN OUTPUT PROCESS-DATES-FILE                               01320005
013300          INPUT  CONTROL-CARD-FILE.                               01330000
013400                                                                  01340000
013500     PERFORM 7000-READ-CONTROL-CARD-FILE.                         01350000
013600     DISPLAY 'TF035-CONTROL-CARD-RECORD = '                       01360000
013700         TF035-CONTROL-CARD-RECORD.                               01370000
013800     IF TF035-NORMAL-RUN                                          01380000
013900         PERFORM 1100-GET-FISCAL-MONTH-DATES                      01390000
014000     ELSE                                                         01400000
014100         PERFORM 1200-VALIDATE-INPUT-DATES                        01410000
014200     END-IF.                                                      01420000
014300*                                                                 01430000
014400     PERFORM 8000-WRITE-PROCESS-DATES-FILE.                       01440005
014500*                                                                 01450000
014600******************************************************************01460000
014700* USE THE CURRENT DATE TO DETERMINE THE BEGINNING AND ENDING      01470000
014800* DATES FOR THE PREVIOUS FISCAL PERIOD.                           01480000
014900******************************************************************01490000
015000 1100-GET-FISCAL-MONTH-DATES.                                     01500000
015100     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              01510000
015200*  CALL THE CALENDAR ROUTINE WITH CURRENT DATE TO FIND THE FIRST  01520000
015300*  DAY OF THE CURRENT FISCAL MONTH                                01530000
015400                                                                  01540000
015600     SET  DPG51-FISCAL-454-CALENDAR                               01560000
015700          DPG51-DO-NOT-INCR-DECR-DATE                             01570000
015800          DPG52-LK-DTE-GREG          TO  TRUE.                    01580000
015900     MOVE CD-CURRENT-YEAR            TO  PV-GD-YEAR.              01590000
016000     MOVE CD-CURRENT-MONTH           TO  PV-GD-MONTH.             01600000
016100     MOVE CD-CURRENT-DAY             TO  PV-GD-DAY.               01610000
016200     MOVE PV-GREGORIAN-DATE          TO  DPG52-GREG-DATE-N.       01620000
016300     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          01630009
016400                                             DPG53 DPG54          01640009
016500                                             DPG55 DPG56.         01650009
016600     EVALUATE TRUE                                                01660000
016700         WHEN DPG54-DATE-VALID                                    01670000
                   INITIALIZE DPG51 DPG52 DPG53                         01671011
016800             MOVE DPG56-FISCAL-PERIOD-NBR                         01680013
                                          TO DPG52-FISCAL-CC-PRD-PP     01680113
016800             MOVE DPG56-FISCAL-YEAR-CCYY                          01680213
                                          TO DPG52-FISCAL-CC-PRD-YR     01682013
                   INITIALIZE DPG54 DPG55 DPG56                         01683011
016900         WHEN OTHER                                               01690000
017000             DISPLAY '** ABEND **'                                01700000
017100             DISPLAY '** PGM = ' PC-PROGRAM-NAME                  01710000
017200             DISPLAY '** 1100-GET-FISCAL-MONTH-DATES - 1 **'      01720000
017300             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE. '  01730000
017400             DISPLAY '** ERROR MESSAGE = '                        01740000
017500                     DPG54-ERROR-MESSAGE                          01750000
017600             DISPLAY '** DPG51 = ' DPG51                          01760000
017700             DISPLAY '** DPG52 = ' DPG52                          01770000
017800             DISPLAY '** DPG53 = ' DPG53                          01780000
017900             DISPLAY '** DPG54 = ' DPG54                          01790000
018000             MOVE +4019 TO ABEND-CODE                             01800000
018100             CALL 'ILBOABN0' USING ABEND-CODE                     01810000
018200     END-EVALUATE.                                                01820000
018300*  DECREMENT 1 FISCAL PERIOD TO FIND THE PREVIOUS FISCAL PERIOD.  01820113
018400*  SAVE THE FIRST AND LAST DAYS OF THAT FISCAL PERIOD FOR THE     01821013
018500*  BEGIN AND END DATES FOR RETRIEVING  RECEIVED TRANSFERS.        01830013
018700     SET DPG51-FISCAL-454-CALENDAR                                01870000
018800         DPG51-DECREMENT-DATE                                     01880000
018900         DPG52-LK-DTE-FISC-PRD-CC TO TRUE.                        01881013
019000     MOVE PC-1-PERIOD         TO DPG51-INCR-DECR-FISCAL-PRD-9.    01900010
019100     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          01910009
019200                                             DPG53 DPG54          01920009
019300                                             DPG55 DPG56.         01930009
019400     EVALUATE TRUE                                                01940000
019500         WHEN DPG54-DATE-VALID                                    01950000
019600             MOVE DPG56-FIRST-FP-GREG-CC                          01960000
019700                                      TO  TF029-PROCESS-START-DATE01970003
019800             MOVE  DPG56-LAST-FP-GREG-CC                          01980000
019900                                      TO  TF029-PROCESS-END-DATE  01990003
020000         WHEN OTHER                                               02000000
020100             DISPLAY '** ABEND **'                                02010000
020200             DISPLAY '** PGM = ' PC-PROGRAM-NAME                  02020000
020300             DISPLAY '** 1100-GET-FISCAL-MONTH-DATES - 2 **'      02030000
020400             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE. '  02040000
020500             DISPLAY '** ERROR MESSAGE = '                        02050000
020600                     DPG54-ERROR-MESSAGE                          02060000
020700             DISPLAY '** DPG51 = ' DPG51                          02070000
020800             DISPLAY '** DPG52 = ' DPG52                          02080000
020900             DISPLAY '** DPG53 = ' DPG53                          02090000
021000             DISPLAY '** DPG54 = ' DPG54                          02100000
021100             MOVE +4019 TO ABEND-CODE                             02110000
021200             CALL 'ILBOABN0' USING ABEND-CODE                     02120000
021300     END-EVALUATE.                                                02130000
021400     DISPLAY 'NORMAL RUN, FISCAL BEGIN DATE = '                   02140004
021500                                       TF029-PROCESS-START-DATE.  02150004
021600     DISPLAY 'NORMAL RUN, FISCAL END DATE   = '                   02160004
021700                                       TF029-PROCESS-END-DATE.    02170004
021800*                                                                 02180000
021900******************************************************************02190000
022000* VALIDATE THE INPUT BEGIN AND END DATES FROM THE CONTROL CARD    02200000
022100******************************************************************02210000
022200 1200-VALIDATE-INPUT-DATES.                                       02220000
022300     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              02230000
022400*  CALL THE CALENDAR ROUTINE WITH CONTROL CARD BEGIN DATE         02240000
022500                                                                  02250000
022700     SET  DPG51-ACTUAL-CALENDAR-ONLY                              02270000
022800          DPG51-DO-NOT-INCR-DECR-DATE                             02280000
022900          DPG52-LK-DTE-GREG-CC       TO  TRUE.                    02290000
023000     MOVE TF035-BEGIN-YEAR           TO  PV-GD-CC-YEAR.           02300000
023100     MOVE TF035-BEGIN-MONTH          TO  PV-GD-CC-MONTH.          02310000
023200     MOVE TF035-BEGIN-DAY            TO  PV-GD-CC-DAY.            02320000
023300     MOVE TF035-BEGIN-CENTURY        TO  PV-GD-CC-CENTURY.        02330000
023400     MOVE PV-GREGORIAN-CC-DATE       TO  DPG52-GREG-CC-DATE-N.    02340008
023500     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          02350009
023600                                             DPG53 DPG54          02360009
023700                                             DPG55 DPG56.         02370009
023800     EVALUATE TRUE                                                02380000
023900         WHEN DPG54-DATE-VALID                                    02390000
024000             MOVE DPG55-DB2-ISO-DATE-FMT     TO PV-BEG-DATE       02400000
024100             MOVE DPG55-GREG-CC-DATE  TO  TF029-PROCESS-START-DATE02410003
024200         WHEN OTHER                                               02420000
024300             DISPLAY '** ABEND **'                                02430000
024400             DISPLAY '** PGM = ' PC-PROGRAM-NAME                  02440000
024500             DISPLAY '** 1200-VALIDATE-INPUT-DATES - 1 **'        02450000
024600             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE. '  02460000
024700             DISPLAY '** ERROR MESSAGE = '                        02470000
024800                     DPG54-ERROR-MESSAGE                          02480000
024900             DISPLAY '** DPG51 = ' DPG51                          02490000
025000             DISPLAY '** DPG52 = ' DPG52                          02500000
025100             DISPLAY '** DPG53 = ' DPG53                          02510000
025200             DISPLAY '** DPG54 = ' DPG54                          02520000
025300             MOVE +4019 TO ABEND-CODE                             02530000
025400             CALL 'ILBOABN0' USING ABEND-CODE                     02540000
025500     END-EVALUATE.                                                02550000
025600                                                                  02560000
025700     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              02570000
025800*  CALL THE CALENDAR ROUTINE WITH CONTROL CARD END DATE           02580000
025900                                                                  02590000
026100     SET  DPG51-ACTUAL-CALENDAR-ONLY                              02610000
026200          DPG51-DO-NOT-INCR-DECR-DATE                             02620000
026300          DPG52-LK-DTE-GREG-CC       TO  TRUE.                    02630000
026400     MOVE TF035-END-YEAR             TO  PV-GD-CC-YEAR.           02640000
026500     MOVE TF035-END-MONTH            TO  PV-GD-CC-MONTH.          02650000
026600     MOVE TF035-END-DAY              TO  PV-GD-CC-DAY.            02660000
026700     MOVE TF035-END-CENTURY          TO  PV-GD-CC-CENTURY.        02670000
023400     MOVE PV-GREGORIAN-CC-DATE       TO  DPG52-GREG-CC-DATE-N.    02671008
026900     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          02690009
027000                                             DPG53 DPG54          02700009
027100                                             DPG55 DPG56.         02710009
027200     EVALUATE TRUE                                                02720000
027300         WHEN DPG54-DATE-VALID                                    02730000
027400             MOVE DPG55-DB2-ISO-DATE-FMT     TO PV-END-DATE       02740000
027500             MOVE DPG55-GREG-CC-DATE  TO  TF029-PROCESS-END-DATE  02750003
027600         WHEN OTHER                                               02760000
027700             DISPLAY '** ABEND **'                                02770000
027800             DISPLAY '** PGM = ' PC-PROGRAM-NAME                  02780000
027900             DISPLAY '** 1200-VALIDATE-INPUT-DATES - 2 **'        02790000
028000             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE. '  02800000
028100             DISPLAY '** ERROR MESSAGE = '                        02810000
028200                     DPG54-ERROR-MESSAGE                          02820000
028300             DISPLAY '** DPG51 = ' DPG51                          02830000
028400             DISPLAY '** DPG52 = ' DPG52                          02840000
028500             DISPLAY '** DPG53 = ' DPG53                          02850000
028600             DISPLAY '** DPG54 = ' DPG54                          02860000
028700             MOVE +4019 TO ABEND-CODE                             02870000
028800             CALL 'ILBOABN0' USING ABEND-CODE                     02880000
028900     END-EVALUATE.                                                02890000
029000     IF PV-END-DATE < PV-BEG-DATE                                 02900008
029100         DISPLAY '** ABEND **'                                    02910000
029200         DISPLAY '** PGM = ' PC-PROGRAM-NAME                      02920000
029300         DISPLAY '** 1200-VALIDATE-INPUT-DATES - 3 **'            02930000
029400         DISPLAY '** BEGIN DATE NOT > END DATE. '                 02940000
029500         DISPLAY '** BEGIN DATE = '  PV-BEG-DATE                  02950000
029600         DISPLAY '** END DATE = '    PV-END-DATE                  02960000
029700         MOVE +4019 TO ABEND-CODE                                 02970000
029800         CALL 'ILBOABN0' USING ABEND-CODE                         02980000
029900     END-IF.                                                      02990000
030000*----------------------------------------------------------------*03000000
030100*  READ THE SCHEDULE DATE CONTROL CARD.                          *03010000
030200*----------------------------------------------------------------*03020000
030300 7000-READ-CONTROL-CARD-FILE.                                     03030000
030400     READ CONTROL-CARD-FILE                                       03040000
030500         INTO TF035-CONTROL-CARD-RECORD                           03050000
030600     END-READ.                                                    03060000
030700******************************************************************03070000
030800* WRITES AN OUTPUT FILE CONTAINING THE SPECIFIED BEGINNING AND    03080000
030900* ENDING DATES.                                                   03090000
031000******************************************************************03100000
031100 8000-WRITE-PROCESS-DATES-FILE.                                   03110005
031200     WRITE PROCESS-DATES-RECORD                                   03120005
031300         FROM TF029-PROCESS-DATES-RECORD                          03130002
031400     END-WRITE.                                                   03140000
031500*                                                                 03150000
031600*                                                                 03160000
031700 9000-EOJ-ROUTINE.                                                03170000
031800     CLOSE PROCESS-DATES-FILE                                     03180005
031900           CONTROL-CARD-FILE.                                     03190000
