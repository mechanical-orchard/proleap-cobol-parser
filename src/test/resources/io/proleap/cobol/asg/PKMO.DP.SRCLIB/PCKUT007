000100******************************************************************00010007
000200 IDENTIFICATION DIVISION.                                         00020007
000300******************************************************************00030007
000400                                                                  00040007
000500 PROGRAM-ID.             PCKUT007.                                00050007
000600 AUTHOR.                 MICHAEL WALTERS.                         00060007
000700 INSTALLATION.           KOHLS.                                   00070007
000800 DATE-WRITTEN            SEPTEMBER, 1995.                         00080007
000900 DATE-COMPILED.                                                   00090007
001000                                                                  00100007
001100******************************************************************00110007
001200*  CREATES THE DISTRIBUTION CENTER TURN REPORT EXTRACT FILE.      00120007
001300******************************************************************00130007
001400                                                                  00140007
001500******************************************************************00150007
001600 ENVIRONMENT DIVISION.                                            00160007
001700******************************************************************00170007
001800                                                                  00180007
001900 CONFIGURATION SECTION.                                           00190007
002000                                                                  00200007
002100 SOURCE-COMPUTER.        IBM-3090.                                00210007
002200 OBJECT-COMPUTER.        IBM-3090.                                00220007
002300                                                                  00230007
002400 INPUT-OUTPUT SECTION.                                            00240007
002500                                                                  00250007
002600 FILE-CONTROL.                                                    00260007
002700                                                                  00270007
002800     SELECT RE-RECEIPT-EXTRACT-FILE                               00280007
002900         ASSIGN TO IN01.                                          00290007
003000                                                                  00300007
003100     SELECT TR-TURN-REPORT-FILE                                   00310007
003200         ASSIGN TO OUT01.                                         00320007
003300                                                                  00330007
003400******************************************************************00340007
003500 DATA DIVISION.                                                   00350007
003600******************************************************************00360007
003700                                                                  00370007
003800 FILE SECTION.                                                    00380007
003900                                                                  00390007
004000 FD  RE-RECEIPT-EXTRACT-FILE                                      00400007
004100     RECORDING MODE IS F                                          00410007
004200     LABEL RECORDS ARE STANDARD                                   00420007
004300     BLOCK CONTAINS 0 RECORDS.                                    00430007
004400                                                                  00440007
004500 01  RE-RECEIPT-EXTRACT-RECORD       PIC  X(300).                 00450007
004600                                                                  00460007
004700 FD  TR-TURN-REPORT-FILE                                          00470007
004800     RECORDING MODE IS F                                          00480007
004900     LABEL RECORDS ARE STANDARD                                   00490007
005000     BLOCK CONTAINS 0 RECORDS.                                    00500007
005100                                                                  00510007
005200 01  TR-TURN-REPORT-RECORD           PIC  X(150).                 00520007
005300                                                                  00530007
005400******************************************************************00540007
005500 WORKING-STORAGE SECTION.                                         00550007
005600******************************************************************00560007
005700                                                                  00570007
005800*                                                                 00580007
005900******************************************************************00590007
006000*  WORK AREA FOR THE RECEIPT EXTRACT INPUT FILE.                  00600007
006100******************************************************************00610007
006200     COPY STOREEXT.                                               00620007
006300                                                                  00630007
006400******************************************************************00640007
006500*  WORK AREA FOR THE TURN REPORT OUTPUT FILE.                     00650007
006600******************************************************************00660007
006700     COPY PCRD032.                                                00670018
006800                                                                  00680007
006900 01  ABEND-CODE                          PIC S9(04) VALUE +0      00690007
007000                                                     COMP SYNC.   00700007
007100*                                                                 00710007
007200*                                                                 00720007
007300******************************************************************00730007
007400*  WORK AREA FOR FISCAL CALENDAR ROUTINE.                         00740007
007500******************************************************************00750007
007600     COPY DPWS500.                                                00760007
007700*                                                                 00770007
007800******************************************************************00780007
007900*  WORK AREA FOR SQL ERROR ROUTINE 'DSNTIAR'                      00790007
008000******************************************************************00800007
008100     COPY DPWS004.                                                00810007
008200                                                                  00820007
008300                                                                  00830007
008400 01  DK-DB2-KEY-VARAIBLES.                                        00840007
008500     05  DK-OPER-UNT-ID                  PIC S9(04)  COMP.        00850007
008600     05  DK-FCLTY-ID                     PIC S9(04)  COMP.        00860007
008700     05  DK-PO-NBR                       PIC S9(09)  COMP.        00870007
008800     05  DK-REC-SEQ-NBR                  PIC S9(09)  COMP.        00880007
008900     05  DK-RECEIVE-TMST                 PIC  X(26).              00890007
009000                                                                  00900007
009100                                                                  00910007
009200 01  PT-PROGRAM-TOTALS.                                           00920007
009300     05  PT-READ-COUNT                   PIC 9(9)    VALUE 0.     00930007
009400     05  PT-WRITE-COUNT                  PIC 9(9)    VALUE 0.     00940007
009500     05  PT-SQL-COUNT                    PIC 9(9)    VALUE 0.     00950007
009600     05  PT-HELD-COUNT                   PIC 9(9)    VALUE 0.     00960007
009610     05  PT-FLBK-COUNT                   PIC 9(9)    VALUE 0.     00961018
009700                                                                  00970007
009800 01  PS-PROGRAM-SWITCHES.                                         00980007
009900     05  PS-EOF-EXTRACT-FILE-IND         PIC  X(01)  VALUE 'N'.   00990007
010000         88  PS-END-OF-EXTRACT-FILE                  VALUE 'Y'.   01000007
010100         88  PS-NOT-END-OF-EXTRACT-FILE              VALUE 'N'.   01010007
010200                                                                  01020007
010300     05  PS-EOC-TROUBLE-CURSOR-IND       PIC  X(01)  VALUE 'N'.   01030007
010400         88  PS-END-OF-TROUBLE-CURSOR                VALUE 'Y'.   01040007
010500         88  PS-NOT-END-OF-TROUBLE-CURSOR            VALUE 'N'.   01050007
010600                                                                  01060007
010700     05  PS-PRCS-AREA-IND                PIC  X(01)  VALUE 'N'.   01070007
010800         88  PS-GET-PRCS-AREA                        VALUE 'Y'.   01080007
010900         88  PS-NO-PRCS-AREA                         VALUE 'N'.   01090007
011000                                                                  01100007
011100     05  PS-CHECK-DATES-IND              PIC  X(01)  VALUE 'N'.   01110007
011200         88  PS-CHECK-DATES                          VALUE 'Y'.   01120007
011300         88  PS-NO-CHECK-DATES                       VALUE 'Y'.   01130007
011400                                                                  01140007
011500     05  PS-TROUBLE-DATA-IND             PIC  X(01)  VALUE 'N'.   01150007
011600         88  PS-NO-TROUBLE-DATA                      VALUE 'N'.   01160007
011700         88  PS-TROUBLE-DATA-EXISTS                  VALUE 'Y'.   01170007
011800                                                                  01180007
011900     05  PS-TOTAL-TYPE-IND               PIC  X(01)  VALUE 'N'.   01190007
012000         88  PS-PRCS-AREA-TOTAL                      VALUE '1'.   01200007
012100         88  PS-FCLTY-TOTAL                          VALUE '2'.   01210007
012200         88  PS-GRAND-TOTAL                          VALUE '3'.   01220007
012300                                                                  01230007
012400 01  PV-PROGRAM-VARIABLES.                                        01240007
012500     05  PV-TROUBLE-CNT                  PIC S9(05)V   COMP.      01250007
012600     05  PV-DAYS-IN-TROUBLE              PIC S9(04)V9  COMP.      01260007
012700     05  PV-TEMP-DAYS-IN-TROUBLE         PIC S9(04)V9  COMP.      01270007
012800     05  PV-TEMP-HRS-IN-TROUBLE          PIC S9(02)V9  COMP.      01280007
012900     05  PV-PRCS-HOUR-DIFFERENCE         PIC S9(09)V   COMP.      01290007
013000     05  PV-PRCS-DAY-DIFFERENCE          PIC S9(09)V   COMP.      01300012
013001     05  PV-PRCS-MIN-DIFFERENCE          PIC S9(09)V   COMP.      01300112
013010     05  PV-PRCS-DAY-CALC                PIC S9(04)V99 COMP.      01301013
013020     05  PV-PRCS-MIN-CALC                PIC S9(04)V99 COMP.      01302013
013100     05  PV-VERIFY-DATE                  PIC  X(10)  VALUE SPACES.01310007
013200     05  PV-VERIFY-DTE REDEFINES PV-VERIFY-DATE.                  01320007
013300         10 PV-VERIFY-CC                 PIC  X(02).              01330007
013400         10 PV-VERIFY-YY                 PIC  X(02).              01340007
013500         10 FILLER                       PIC  X(01).              01350007
013600         10 PV-VERIFY-MM                 PIC  X(02).              01360007
013700         10 FILLER                       PIC  X(01).              01370007
013800         10 PV-VERIFY-DD                 PIC  X(02).              01380007
013900     05  PV-RECEIVE-DATE                 PIC  X(10)  VALUE SPACES.01390007
014000     05  PV-RECEIV-DTE REDEFINES PV-RECEIVE-DATE.                 01400007
014100         10 PV-RECEIVE-CC                PIC  X(02).              01410007
014200         10 PV-RECEIVE-YY                PIC  X(02).              01420007
014300         10 FILLER                       PIC  X(01).              01430007
014400         10 PV-RECEIVE-MM                PIC  X(02).              01440007
014500         10 FILLER                       PIC  X(01).              01450007
014600         10 PV-RECEIVE-DD                PIC  X(02).              01460007
014700     05  PV-CURRENT-DATE                 PIC  X(10)  VALUE SPACES.01470007
014800     05  PV-CURR-DATE REDEFINES PV-CURRENT-DATE.                  01480007
014900         10 PV-CURR-CENTURY              PIC  X(02).              01490007
015000         10 PV-CURR-YEAR                 PIC  X(02).              01500007
015100         10 FILLER                       PIC  X(01).              01510007
015200         10 PV-CURR-MONTH                PIC  X(02).              01520007
015300         10 FILLER                       PIC  X(01).              01530007
015400         10 PV-CURR-DAY                  PIC  X(02).              01540007
015500     05  PV-CURRENT-TIME                 PIC  X(08)  VALUE SPACES.01550007
015600     05  PV-CURR-TIME REDEFINES PV-CURRENT-TIME.                  01560007
015700         10 PV-CURR-HOUR                 PIC  X(02).              01570007
015800         10 FILLER                       PIC  X(01).              01580007
015900         10 PV-CURR-MINUTE               PIC  X(02).              01590007
016000         10 FILLER                       PIC  X(01).              01600007
016100         10 PV-CURR-SECOND               PIC  X(02).              01610007
016200     05  PV-CURR-DEPT                    PIC  X(03)  VALUE SPACES.01620007
016300* TIMESTAMP VARIABLES                                             01630007
016400     05  PV-DB2-NOTIFY-TMST              PIC  X(26)  VALUE SPACES.01640007
016500     05  PV-DB2-NOTIF-TMS REDEFINES PV-DB2-NOTIFY-TMST.           01650007
016600         10  PV-DB2-NOTIFY-DATE.                                  01660007
016700             15 PV-DB2-NOTIFY-CC         PIC  X(02).              01670007
016800             15 PV-DB2-NOTIFY-YY         PIC  X(02).              01680007
016900             15 FILLER                   PIC  X(01).              01690007
017000             15 PV-DB2-NOTIFY-MM         PIC  X(02).              01700007
017100             15 FILLER                   PIC  X(01).              01710007
017200             15 PV-DB2-NOTIFY-DD         PIC  X(02).              01720007
017300         10  FILLER                      PIC  X(01).              01730007
017400         10  PV-DB2-NOTIFY-TIME.                                  01740007
017500             15 PV-DB2-NOTIFY-HOUR       PIC  X(02).              01750007
017600             15 FILLER                   PIC  X(01).              01760007
017700             15 PV-DB2-NOTIFY-MIN        PIC  X(02).              01770007
017800             15 FILLER                   PIC  X(01).              01780007
017900             15 PV-DB2-NOTIFY-SEC        PIC  X(02).              01790007
018000         10 FILLER                       PIC  X(01).              01800007
018100         10 PV-DB2-NOTIFY-MSEC           PIC  X(06).              01810007
018200*                                                                 01820007
018300     05  PV-DB2-RESOLVED-TMST            PIC  X(26)  VALUE SPACES.01830007
018400     05  PV-DB2-RSLVD-TMS REDEFINES PV-DB2-RESOLVED-TMST.         01840007
018500         10  PV-DB2-RESOLVED-DATE.                                01850007
018600             15 PV-DB2-RESOLVED-CC       PIC  X(02).              01860007
018700             15 PV-DB2-RESOLVED-YY       PIC  X(02).              01870007
018800             15 FILLER                   PIC  X(01).              01880007
018900             15 PV-DB2-RESOLVED-MM       PIC  X(02).              01890007
019000             15 FILLER                   PIC  X(01).              01900007
019100             15 PV-DB2-RESOLVED-DD       PIC  X(02).              01910007
019200         10  FILLER                      PIC  X(01).              01920007
019300         10  PV-DB2-RESOLVED-TIME.                                01930007
019400             15 PV-DB2-RESOLVED-HOUR     PIC  X(02).              01940007
019500             15 FILLER                   PIC  X(01).              01950007
019600             15 PV-DB2-RESOLVED-MIN      PIC  X(02).              01960007
019700             15 FILLER                   PIC  X(01).              01970007
019800             15 PV-DB2-RESOLVED-SEC      PIC  X(02).              01980007
019900         10 FILLER                       PIC  X(01).              01990007
020000         10 PV-DB2-RESOLVED-MSEC         PIC  X(06).              02000007
020100*                                                                 02010007
020200     05  PV-HOLD-NOTIFY-TMST             PIC  X(26)  VALUE SPACES.02020007
020300     05  PV-HOLD-NOTIF-TMS REDEFINES PV-HOLD-NOTIFY-TMST.         02030007
020400         10  PV-HOLD-NOTIFY-DATE.                                 02040007
020500             15 PV-HOLD-NOTIFY-CC        PIC  9(02).              02050007
020600             15 PV-HOLD-NOTIFY-YY        PIC  9(02).              02060007
020700             15 FILLER                   PIC  X(01).              02070007
020800             15 PV-HOLD-NOTIFY-MM        PIC  9(02).              02080007
020900             15 FILLER                   PIC  X(01).              02090007
021000             15 PV-HOLD-NOTIFY-DD        PIC  9(02).              02100007
021100         10  FILLER                      PIC  X(01).              02110007
021200         10  PV-HOLD-NOTIFY-TIME.                                 02120007
021300             15 PV-HOLD-NOTIFY-HOUR      PIC  9(02).              02130007
021400             15 FILLER                   PIC  X(01).              02140007
021500             15 PV-HOLD-NOTIFY-MIN       PIC  9(02).              02150007
021600             15 FILLER                   PIC  X(01).              02160007
021700             15 PV-HOLD-NOTIFY-SEC       PIC  9(02).              02170007
021800         10 FILLER                       PIC  X(01).              02180007
021900         10 PV-HOLD-NOTIFY-MSEC          PIC  9(06).              02190007
022000*                                                                 02200007
022100     05  PV-HOLD-RESOLVED-TMST           PIC  X(26)  VALUE SPACES.02210007
022200     05  PV-HOLD-RSLVD-TMS REDEFINES PV-HOLD-RESOLVED-TMST.       02220007
022300         10  PV-HOLD-RESOLVED-DATE.                               02230007
022400             15 PV-HOLD-RESOLVED-CC      PIC  9(02).              02240007
022500             15 PV-HOLD-RESOLVED-YY      PIC  9(02).              02250007
022600             15 FILLER                   PIC  X(01).              02260007
022700             15 PV-HOLD-RESOLVED-MM      PIC  9(02).              02270007
022800             15 FILLER                   PIC  X(01).              02280007
022900             15 PV-HOLD-RESOLVED-DD      PIC  9(02).              02290007
023000         10  FILLER                      PIC  X(01).              02300007
023100         10  PV-HOLD-RESOLVED-TIME.                               02310007
023200             15 PV-HOLD-RESOLVED-HOUR    PIC  9(02).              02320007
023300             15 FILLER                   PIC  X(01).              02330007
023400             15 PV-HOLD-RESOLVED-MIN     PIC  9(02).              02340007
023500             15 FILLER                   PIC  X(01).              02350007
023600             15 PV-HOLD-RESOLVED-SEC     PIC  9(02).              02360007
023700         10 FILLER                       PIC  X(01).              02370007
023800         10 PV-HOLD-RESOLVED-MSEC        PIC  9(06).              02380007
023900*                                                                 02390007
024000*        HOLD VARIABLES                                           02400007
024100     05  PV-HOLD-PO-NBR                  PIC  9(08)  VALUE ZERO.  02410007
024200     05  PV-HOLD-REC-SEQ-NBR             PIC  9(09)  VALUE ZERO.  02420007
024300     05  PV-HOLD-DATE-VERIFIED           PIC  9(06)  VALUE ZERO.  02430007
024400     05  PV-HOLD-DATE-RECEIVED           PIC  9(06)  VALUE ZERO.  02440007
024500*                                                                 02450007
024600     05  PV-PAGE-COUNT                   PIC S9(04)  VALUE +0     02460007
024700                                                     COMP SYNC.   02470007
024800     05  PV-LINE-COUNT                   PIC S9(04)  VALUE +0     02480007
024900                                                     COMP SYNC.   02490007
025000     05  PV-PARAGRAPH-NAME               PIC  X(30)  VALUE SPACE. 02500007
025100     05  PV-DB2-OPERATION-ATTEMPTED      PIC  X(30)  VALUE SPACE. 02510007
025200     05  PV-DB2-OPER-UNT-ID              PIC  X(03).              02520007
025300     05  PV-WORK-DATE.                                            02530007
025400         10  PV-WORK-MONTH               PIC  X(02).              02540007
025500         10  FILLER                      PIC  X(01) VALUE '/'.    02550007
025600         10  PV-WORK-DAY                 PIC  X(02).              02560007
025700         10  FILLER                      PIC  X(01) VALUE '/'.    02570007
025800         10  PV-WORK-YEAR                PIC  X(02).              02580007
025810                                                                  02581015
025820     05  PV-DURATION-DAYS                       PIC S9(09)        02582015
025830                                                       COMP-3.    02583015
025840     05  PV-DURATION-TIME                       PIC S9(06)        02584015
025850                                                       COMP-3.    02585015
025860     05  PV-DURATION-TIME-BREAKER-N             PIC 9(06).        02586015
025870     05  PV-DURATION-TIME-BREAKER REDEFINES                       02587015
025880         PV-DURATION-TIME-BREAKER-N.                              02588015
025890         10  PV-DURATION-HOURS                  PIC 9(02).        02589015
025891         10  PV-DURATION-MINUTES                PIC 9(02).        02589115
025892         10  PV-DURATION-SECONDS                PIC 9(02).        02589215
025893     05  PV-DURATION-SIGN                       PIC S9(01).       02589315
025894     05  PV-NUMBER-DAYS                         PIC S9(09)V999    02589415
025895                                                       COMP.      02589515
025896     05  PV-NUMBER-HOURS                        PIC S9(09)        02589615
025897                                                       COMP.      02589715
025900                                                                  02590007
026000 01  SD-SYSTEM-DATE.                                              02600007
026100     05  SD-SYSTEM-YEAR                  PIC  9(02)  VALUE ZEROS. 02610007
026200     05  SD-SYSTEM-MONTH                 PIC  9(02)  VALUE ZEROS. 02620007
026300     05  SD-SYSTEM-DAY                   PIC  9(02)  VALUE ZEROS. 02630007
026400                                                                  02640007
026500 01  ST-SYSTEM-TIME.                                              02650007
026600     05  ST-SYSTEM-HOUR                  PIC  9(02)  VALUE ZEROS. 02660007
026700     05  ST-SYSTEM-MINUTE                PIC  9(02)  VALUE ZEROS. 02670007
026800                                                                  02680007
026900*                                                                 02690007
027000******************************************************************02700007
027100*  WORK FIELDS FOR THE MBS SUBROUTINE                             02710007
027200******************************************************************02720007
027300     COPY DPWS003.                                                02730007
027400*                                                                 02740007
027500******************************************************************02750007
027600*  DB2 COMMUNICATION AREA.                                        02760007
027700******************************************************************02770007
027800     EXEC SQL                                                     02780007
027900          INCLUDE SQLCA                                           02790007
028000     END-EXEC.                                                    02800007
028100*                                                                 02810007
028200******************************************************************02820007
028300*  DB2 TABLE DB2PDBA.TRECEIV                                      02830007
028400******************************************************************02840007
028500     EXEC SQL                                                     02850007
028600          INCLUDE TRECEIV                                         02860007
028700     END-EXEC.                                                    02870007
028800*                                                                 02880007
028900*                                                                 02890007
029000******************************************************************02900007
029100*  DB2 TABLE DB2PDBA.TCKRSTCN                                     02910007
029200******************************************************************02920007
029300     EXEC SQL                                                     02930007
029400          INCLUDE TCKRSTCN                                        02940007
029500     END-EXEC.                                                    02950007
029600*                                                                 02960007
029700*                                                                 02970007
029800******************************************************************02980007
029900*  DB2 TABLE DB2PDBA.TDFCTOR                                      02990007
030000******************************************************************03000007
030100     EXEC SQL                                                     03010007
030200          INCLUDE TDFCTOR                                         03020007
030300     END-EXEC.                                                    03030007
030400*                                                                 03040007
030500*                                                                 03050007
030600******************************************************************03060007
030700*  DB2 TABLE DB2PDBA.TVNDDPT                                      03070007
030800******************************************************************03080007
030900     EXEC SQL                                                     03090007
031000          INCLUDE TVNDDPT                                         03100007
031100     END-EXEC.                                                    03110007
031200*                                                                 03120007
031300*                                                                 03130007
031400******************************************************************03140007
031500*  DB2 TABLE DB2PDBA.TENTNME                                      03150007
031600******************************************************************03160007
031700     EXEC SQL                                                     03170007
031800          INCLUDE TENTNME                                         03180007
031900     END-EXEC.                                                    03190007
032000*                                                                 03200007
032100*                                                                 03210007
032200******************************************************************03220007
032300*  DB2 TABLE DB2PDBA.TEXTENT                                      03230007
032400******************************************************************03240007
032500     EXEC SQL                                                     03250007
032600          INCLUDE TEXTENT                                         03260007
032700     END-EXEC.                                                    03270007
032800*                                                                 03280007
032900*                                                                 03290007
033000******************************************************************03300007
033100*  DB2 TABLE DB2PDBA.TDFMEIT                                      03310007
033200******************************************************************03320007
033300     EXEC SQL                                                     03330007
033400          INCLUDE TDFMEIT                                         03340007
033500     END-EXEC.                                                    03350007
033600*                                                                 03360007
033700******************************************************************03370007
033800*  DB2 TABLE DB2PDBA.TSK                                          03380007
033900******************************************************************03390007
034000     EXEC SQL                                                     03400007
034100          INCLUDE TSK                                             03410007
034200     END-EXEC.                                                    03420007
034300*                                                                 03430007
034400******************************************************************03440007
034500*  DB2 TABLE DB2PDBA.TFLAREA - FACILITY AREA TABLE                03450007
034600******************************************************************03460007
034700     EXEC SQL                                                     03470007
034800          INCLUDE TFLAREA                                         03480007
034900     END-EXEC.                                                    03490007
035000*                                                                 03500007
035100******************************************************************03510007
035200*  DB2 TABLE DB2PDBA.TTRBNTF - TROUBLE NOTIFY TABLE               03520007
035300******************************************************************03530007
035400     EXEC SQL                                                     03540007
035500          INCLUDE TTRBNTF                                         03550007
035600     END-EXEC.                                                    03560007
035700*                                                                 03570007
035800******************************************************************03580007
035900*  DB2 TABLE DB2PDBA.TTRBRSN - TROUBLE REASON TABLE               03590007
036000******************************************************************03600007
036100     EXEC SQL                                                     03610007
036200          INCLUDE TTRBRSN                                         03620007
036300     END-EXEC.                                                    03630007
036400*                                                                 03640007
036500*   DB2 COMMUNICATIONS AREA2                                      03650007
036600*                                                                 03660007
036700     COPY SQLCA2.                                                 03670007
036800 EJECT                                                            03680007
036900*                                                                 03690007
037000*  CURSOR DECLARATION TO FETCH EACH ROW OF TROUBLE TO DETERMINE   03700007
037100*  THE NUMBER OF DAYS THE ORDER WAS IN TROUBLE                    03710007
037200*                                                                 03720007
037300                                                                  03730007
037400     EXEC SQL                                                     03740007
037500         DECLARE TROUBLE_CURSOR CURSOR FOR                        03750007
037600         SELECT A.RESOLVED_TMST                                   03760007
037700              , A.NOTIF_TMST                                      03770007
037800         FROM TTRBNTF A                                           03780007
037900            , TTRBRSN B                                           03790007
038000         WHERE PO_NBR             = :DK-PO-NBR                    03800007
038100           AND A.REC_SEQ_NBR      = :DK-REC-SEQ-NBR               03810007
038200           AND A.TRBL_RSN_CDE     = B.TRBL_RSN_CDE                03820007
038300           AND B.NOTIF_IND        = 'T'                           03830007
038400           AND A.RESOLVED_TMST    > :DK-RECEIVE-TMST              03840007
038500         ORDER BY A.NOTIF_TMST                                    03850007
038600                , A.RESOLVED_TMST                                 03860007
038700     END-EXEC.                                                    03870007
038800                                                                  03880007
038900* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 03890007
039000 PROCEDURE DIVISION.                                              03900007
039100* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 03910007
039200                                                                  03920007
039300******************************************************************03930007
039400*  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM    03940007
039500******************************************************************03950007
039600 0000-PROGRAM-MAINLINE.                                           03960007
039700                                                                  03970007
039800     PERFORM 1000-INITIALIZE.                                     03980007
039900                                                                  03990007
040000     PERFORM 2000-CREATE-FILE                                     04000007
040100         UNTIL PS-END-OF-EXTRACT-FILE.                            04010007
040200                                                                  04020007
040300     PERFORM 9000-EOJ-ROUTINE.                                    04030007
040400     STOP RUN.                                                    04040007
040500*0000-EXIT.                                                       04050007
040600                                                                  04060007
040700******************************************************************04070007
040800*  1000-INITIALIZE -  OPENS ALL THE REPORT FILE, ACCEPTS, EDITS,  04080007
040900*  AND DISPLAYS CONTROL CARD INFORMATION, OPENS AND FETCHES FIRST 04090007
041000*  OCCURANCE OF DB2 CURSOR, PRINTS INITIAL PAGE HEADING TO REPORT 04100007
041100*  FILE.                                                          04110007
041200******************************************************************04120007
041300 1000-INITIALIZE.                                                 04130007
041400                                                                  04140007
041500     PERFORM 1050-GET-DATE-TIME.                                  04150007
041600                                                                  04160007
041700     OPEN OUTPUT TR-TURN-REPORT-FILE                              04170007
041800          INPUT  RE-RECEIPT-EXTRACT-FILE.                         04180007
041900                                                                  04190007
042000     SET PS-NOT-END-OF-EXTRACT-FILE   TO TRUE.                    04200007
042100                                                                  04210007
042200     MOVE +0 TO PV-HOLD-PO-NBR                                    04220007
042300                PV-HOLD-REC-SEQ-NBR                               04230007
042400                PT-READ-COUNT                                     04240007
042500                PT-WRITE-COUNT                                    04250007
042600                PT-HELD-COUNT                                     04260007
042610                PT-FLBK-COUNT                                     04261019
042700                PT-SQL-COUNT.                                     04270007
042800                                                                  04280007
042900     PERFORM 6000-READ-EXTRACT-FILE.                              04290007
043000                                                                  04300007
043100*1000-EXIT.                                                       04310007
043200                                                                  04320007
043300******************************************************************04330007
043400*  1050-GET-DATE-TIME - GET THE CURRENT DATE AND TIME FROM DB2    04340007
043500******************************************************************04350007
043600 1050-GET-DATE-TIME.                                              04360007
043700                                                                  04370007
043800     EXEC SQL                                                     04380007
043900         SET :PV-CURRENT-DATE = CURRENT DATE                      04390007
044000     END-EXEC.                                                    04400007
044100                                                                  04410007
044200     EXEC SQL                                                     04420007
044300         SET :PV-CURRENT-TIME = CURRENT TIME                      04430007
044400     END-EXEC.                                                    04440007
044500                                                                  04450007
044600     EVALUATE TRUE                                                04460007
044700         WHEN SQLCODE = ZERO                                      04470007
044800             ADD +1                  TO PT-SQL-COUNT              04480007
044900             MOVE PV-CURR-YEAR       TO SD-SYSTEM-YEAR            04490007
045000             MOVE PV-CURR-MONTH      TO SD-SYSTEM-MONTH           04500007
045100             MOVE PV-CURR-DAY        TO SD-SYSTEM-DAY             04510007
045200             MOVE PV-CURR-HOUR       TO ST-SYSTEM-HOUR            04520007
045300             MOVE PV-CURR-MINUTE     TO ST-SYSTEM-MINUTE          04530007
045400         WHEN OTHER                                               04540007
045500              MOVE '1050-GET-DATE-TIME'                           04550007
045600                               TO  PV-PARAGRAPH-NAME              04560007
045700              MOVE 'SET CURRENT DATE/TIME FROM DB2'               04570007
045800                               TO  PV-DB2-OPERATION-ATTEMPTED     04580007
045900              PERFORM 9100-SQL-ABEND                              04590007
046000     END-EVALUATE.                                                04600007
046100                                                                  04610007
046200                                                                  04620007
046300                                                                  04630007
046400*1050-EXIT.                                                       04640007
046500******************************************************************04650007
046600* 2000-CREATE-FILE.                                               04660007
046700* PROCESS:  THIS PARAGRAPH WILL UPDATE EACH RECORD WITH THE       04670007
046800* FOLLOWING DATA:   CARTON COUNT, TROUBLE COUNT, DAYS IN TROUBLE  04680007
046900*  PROCESS DAYS                                                   04690007
047000******************************************************************04700007
047100 2000-CREATE-FILE.                                                04710007
047200                                                                  04720007
047300*    IGNORE DIRECT SHIPMENT ORDERS                                04730007
047400     IF SE-RECEIVING-LOCATION = 'DS'                              04740007
047500         CONTINUE                                                 04750007
047600     ELSE                                                         04760007
047700         IF SE-PO = PV-HOLD-PO-NBR                                04770007
047800         AND SE-REC-SEQ-NBR = PV-HOLD-REC-SEQ-NBR                 04780007
047900             ADD SE-RETAIL-UNITS-MARK                             04790007
048000                                    TO PC032-UNITS-RECVD          04800007
048100             ADD SE-RETAIL-EXTENSION                              04810007
048200                                    TO PC032-RETAIL-EXTENSION     04820007
048300         ELSE                                                     04830007
048400             IF PV-HOLD-PO-NBR = 0                                04840007
048500             AND PV-HOLD-REC-SEQ-NBR = 0                          04850007
048600                 CONTINUE                                         04860007
048700             ELSE                                                 04870007
048800                 PERFORM 7000-WRITE-REPORT-FILE                   04880007
048900             END-IF                                               04890007
049000                                                                  04900007
049100             MOVE SE-PO             TO PC032-PO-NBR               04910007
049200                                       PV-HOLD-PO-NBR             04920007
049300                                       DK-PO-NBR                  04930007
049400             MOVE SE-REC-SEQ-NBR    TO PC032-REC-SEQ-NBR          04940007
049500                                       DK-REC-SEQ-NBR             04950007
049600                                       PV-HOLD-REC-SEQ-NBR        04960007
049700             MOVE SE-VENDOR-NAME-INHOUSE                          04970007
049800                                    TO PC032-VND-NAME             04980007
049900             MOVE SE-VENDOR-NO-INHOUSE                            04990007
050000                                    TO PC032-VND-NBR              05000007
050100                                                                  05010007
050200             MOVE SE-RETAIL-UNITS-MARK                            05020007
050300                                    TO PC032-UNITS-RECVD          05030007
050400             MOVE SE-RETAIL-EXTENSION                             05040007
050500                                    TO PC032-RETAIL-EXTENSION     05050007
050600             MOVE SE-DEPT           TO PC032-DPT-NBR              05060007
050700                                                                  05070007
050800             PERFORM 8100-GET-TRECEIV-INFO                        05080007
050900                                                                  05090007
051000             MOVE PV-VERIFY-YY      TO PC032-DV-YY                05100007
051100             MOVE PV-VERIFY-MM      TO PC032-DV-MM                05110007
051200             MOVE PV-VERIFY-DD      TO PC032-DV-DD                05120007
051300                                                                  05130007
051400             MOVE PV-RECEIVE-YY     TO PC032-DR-YY                05140007
051500             MOVE PV-RECEIVE-MM     TO PC032-DR-MM                05150007
051600             MOVE PV-RECEIVE-DD     TO PC032-DR-DD                05160007
051601                                                                  05160115
051602*            PERFORM 2200-CALC-DAYS                               05160217
051610*            MOVE PV-PRCS-DAY-DIFFERENCE                          05161014
051611*                                   TO PV-PRCS-DAY-CALC           05161114
051620*            MOVE PV-PRCS-MIN-DIFFERENCE                          05162014
051640*                                   TO PV-PRCS-MIN-CALC           05164014
051700                                                                  05170007
051710             COMPUTE PC032-PRCS-DAYS =                            05171017
051720                 (PV-PRCS-DAY-DIFFERENCE +                        05172017
051730                 (PV-PRCS-HOUR-DIFFERENCE / 24))                  05173017
051800*            COMPUTE PC032-PRCS-DAYS =                            05180014
051900*                (PV-PRCS-DAY-CALC +                              05190014
052000*                (PV-PRCS-MIN-CALC / 1440))                       05200014
052100                                                                  05210007
052200             IF  SE-OPER-UNT-ID NOT EQUAL SE-CURR-OPER-UNT-ID     05220007
052300                 DISPLAY 'PO '                                    05230007
052400                         SE-PO                                    05240007
052500                         ' RECV '                                 05250007
052600                         SE-REC-SEQ-NBR                           05260007
052700                         ' LINE '                                 05270007
052800                         SE-POLINENO                              05280007
052900                         ' HAS DIFFERENT OPER UNITS '             05290007
053000             END-IF                                               05300007
053100             MOVE RECEIV-CURR-OPER-UNT-ID                         05310007
053200                                    TO PC032-OPER-UNT-ID          05320007
053300                                       DK-OPER-UNT-ID             05330007
053400             MOVE RECEIV-CURR-FCLTY-ID                            05340007
053500                                    TO PC032-FCLTY-ID             05350007
053600                                       DK-FCLTY-ID                05360007
053700             IF RECEIV-ACTL-CART-CNT = 0                          05370007
053800                 MOVE RECEIV-EXPTED-CART-CNT                      05380007
053900                                    TO PC032-CARTON-CNT           05390007
054000             ELSE                                                 05400007
054100                 MOVE RECEIV-ACTL-CART-CNT                        05410007
054200                                    TO PC032-CARTON-CNT           05420007
054300             END-IF                                               05430007
054400                                                                  05440007
054410             IF SE-PO-TYP-CDE = 'FB' OR 'IF'                      05441019
054420                 MOVE '999998'      TO PC032-PRCS-AREA            05442019
054430                 ADD +1             TO PT-FLBK-COUNT              05443019
054440             ELSE                                                 05444019
054450                 PERFORM 8000-CHECK-HELD-TROUBLE                  05445019
054600                 IF SQLCODE = +100                                05460018
054700                     MOVE SE-PROCESSING-AREA6 TO PC032-PRCS-AREA  05470018
054900                 ELSE                                             05490018
055000                     MOVE '999999'      TO PC032-PRCS-AREA        05500018
055100                     ADD +1             TO PT-HELD-COUNT          05510018
055200                 END-IF                                           05520018
055210             END-IF                                               05521019
055300             PERFORM 5000-GET-TROUBLE-DAYS                        05530007
055400             MOVE PV-TROUBLE-CNT    TO PC032-TROUBLE-CNT          05540007
055500             MOVE PV-DAYS-IN-TROUBLE                              05550007
055600                                    TO PC032-DAYS-IN-TRBL         05560007
055700         END-IF                                                   05570007
055800     END-IF.                                                      05580007
055900                                                                  05590007
056000     PERFORM 6000-READ-EXTRACT-FILE.                              05600007
056100                                                                  05610007
056200 2200-CALC-DAYS.                                                  05620015
056210                                                                  05621015
056220     IF PV-DURATION-TIME < ZERO                                   05622015
056230         MOVE -1                 TO PV-DURATION-SIGN              05623015
056240     ELSE                                                         05624015
056250         MOVE  1                 TO PV-DURATION-SIGN              05625015
056260     END-IF.                                                      05626015
056270     MOVE PV-DURATION-TIME       TO PV-DURATION-TIME-BREAKER-N.   05627015
056280                                                                  05628015
056290     COMPUTE PV-NUMBER-DAYS =                                     05629015
056291         PV-DURATION-DAYS +                                       05629115
056292         ((PV-DURATION-HOURS / 24) +                              05629215
056293         ((PV-DURATION-MINUTES / 60) / 10) * PV-DURATION-SIGN).   05629315
056294                                                                  05629415
056295     ADD .05 TO PV-NUMBER-DAYS.                                   05629515
056296     MOVE PV-NUMBER-DAYS         TO PC032-PRCS-DAYS.              05629615
056297                                                                  05629715
056298                                                                  05629815
056300******************************************************************05630007
056400* 5000-GET-TROUBLE-DAYS  --  DETERMINE THE TOTAL NUMBER OF DAYS   05640007
056500* THE ORDER WAS HELD UP BY THE TROUBLE SYSTEM                     05650007
056600******************************************************************05660007
056700 5000-GET-TROUBLE-DAYS.                                           05670007
056800                                                                  05680007
056900     SET PS-NOT-END-OF-TROUBLE-CURSOR                             05690007
057000         PS-TROUBLE-DATA-EXISTS                                   05700007
057100         PC032-NO-UNRSLVD-TRBL  TO TRUE.                          05710007
057200                                                                  05720007
057300     MOVE +0                    TO  PV-TROUBLE-CNT                05730007
057400                                    PV-DAYS-IN-TROUBLE.           05740007
057500                                                                  05750007
057600     PERFORM 8300-OPEN-TROUBLE-CURSOR.                            05760007
057700                                                                  05770007
057800     PERFORM 8400-FETCH-TROUBLE-CURSOR.                           05780007
057900                                                                  05790007
058000     IF PS-END-OF-TROUBLE-CURSOR                                  05800007
058100         SET PS-NO-TROUBLE-DATA TO TRUE                           05810007
058200     ELSE                                                         05820007
058300         IF  PV-DB2-NOTIFY-TMST < DK-RECEIVE-TMST                 05830007
058400             MOVE DK-RECEIVE-TMST                                 05840007
058500                                TO  PV-HOLD-NOTIFY-TMST           05850007
058600         ELSE                                                     05860007
058700             MOVE PV-DB2-NOTIFY-TMST                              05870007
058800                                TO  PV-HOLD-NOTIFY-TMST           05880007
058900         END-IF                                                   05890007
059000         MOVE PV-DB2-RESOLVED-TMST                                05900007
059100                                TO  PV-HOLD-RESOLVED-TMST         05910007
059200     END-IF.                                                      05920007
059300                                                                  05930007
059400                                                                  05940007
059500     PERFORM UNTIL PS-END-OF-TROUBLE-CURSOR                       05950007
059600                                                                  05960007
059700         IF  PV-DB2-NOTIFY-TMST < DK-RECEIVE-TMST                 05970007
059800             MOVE DK-RECEIVE-TMST                                 05980007
059900                                TO  PV-DB2-NOTIFY-TMST            05990007
060000         END-IF                                                   06000007
060100                                                                  06010007
060200         IF PV-DB2-NOTIFY-TMST > PV-HOLD-RESOLVED-TMST            06020007
060300             PERFORM 5100-CALCULATE-DAYS                          06030007
060400             ADD PV-TEMP-DAYS-IN-TROUBLE TO PV-DAYS-IN-TROUBLE    06040007
060500             MOVE PV-DB2-NOTIFY-TMST                              06050007
060600                                TO  PV-HOLD-NOTIFY-TMST           06060007
060700             MOVE PV-DB2-RESOLVED-TMST                            06070007
060800                                TO  PV-HOLD-RESOLVED-TMST         06080007
060900         ELSE                                                     06090007
061000             IF PV-DB2-RESOLVED-TMST > PV-HOLD-RESOLVED-TMST      06100007
061100                 MOVE PV-DB2-RESOLVED-TMST                        06110007
061200                                TO  PV-HOLD-RESOLVED-TMST         06120007
061300             END-IF                                               06130007
061400         END-IF                                                   06140007
061500         PERFORM 8400-FETCH-TROUBLE-CURSOR                        06150007
061600                                                                  06160007
061700     END-PERFORM.                                                 06170007
061800                                                                  06180007
061900     IF PS-TROUBLE-DATA-EXISTS                                    06190007
062000         PERFORM 5100-CALCULATE-DAYS                              06200007
062100         ADD  PV-TEMP-DAYS-IN-TROUBLE                             06210007
062200                                  TO PV-DAYS-IN-TROUBLE           06220007
062300     END-IF.                                                      06230007
062400                                                                  06240007
062500                                                                  06250007
062600     PERFORM 8500-CLOSE-TROUBLE-CURSOR.                           06260007
062700                                                                  06270007
062800*                                                                 06280007
062900******************************************************************06290007
063000* 5100-CALCULATE-DAYS.                                           *06300007
063100*  THIS PROCEDURE WILL CALCULATE THE NUMBER OF DAYS BETWEEN THE  *06310007
063200*  TWO "HOLD" TIMESTAMPS.                                        *06320007
063300******************************************************************06330007
063400 5100-CALCULATE-DAYS.                                             06340007
063500                                                                  06350007
063600* FIRST USE THE CALLED CALENDAR MODULE TO DETERMINE THE NUMBER    06360007
063700* OF DAYS BETWEEN THE DATES.                                      06370007
063800* IF THERE IS UNRESOLVED TROUBLE (DEFAULT DATE) THEN SKIP THE CALL06380007
063900* TO THE DATE UTILITY, SET THE UNRESOLVED TROUBLE FLAG, AND MOVE 006390007
064000* TO THE TEMP DAYS FIELD.                                         06400007
064100                                                                  06410007
064200     IF PV-HOLD-RESOLVED-DATE = '9999-09-09'                      06420007
064300     OR PV-HOLD-NOTIFY-DATE   = '9999-09-09'                      06430007
064400         SET PC032-UNRSLVD-TRBL  TO TRUE                          06440007
064500         MOVE +0                 TO PV-TEMP-DAYS-IN-TROUBLE       06450007
064600     ELSE                                                         06460007
064700         INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56           06470007
064800         SET DPG51-ACTUAL-CALENDAR-ONLY                           06480007
064900                                 TO TRUE                          06490007
065000                                                                  06500007
065100         MOVE PV-HOLD-RESOLVED-DATE                               06510007
065200                                 TO DPG52-LK-DATE-INPUT           06520007
065300         SET DPG52-LK-DTE-ISO-FMT                                 06530007
065400                                 TO TRUE                          06540007
065500                                                                  06550007
065600         MOVE PV-HOLD-NOTIFY-DATE                                 06560007
065700                                 TO DPG53-LK-CMPR-DATE-INPUT      06570007
065800         SET DPG53-LK-CMPR-DTE-ISO-FMT                            06580007
065900                                 TO TRUE                          06590007
066000                                                                  06600007
066100         CALL DP500-KOHLS-CALENDAR-ROUTINE                        06610007
066200                          USING DPG51 DPG52 DPG53                 06620007
066300                                DPG54 DPG55 DPG56                 06630007
066400                                                                  06640007
066500         EVALUATE TRUE                                            06650007
066600             WHEN DPG54-NO-ERROR                                  06660007
066700                 MOVE DPG55-DAYS-DIFFERENCE                       06670007
066800                                 TO PV-TEMP-DAYS-IN-TROUBLE       06680007
066900                                                                  06690007
067000             WHEN DPG54-DATE-INVALID                              06700007
067100                 DISPLAY '** ABEND **'                            06710007
067200                 DISPLAY '** PROGRAM = PCKUT007 -- CALLED MODULE '06720007
067300                         'DPKUT500 **'                            06730007
067400                 DISPLAY '** PARAGRAPH = 5100-CALCULATE-DAYS. **' 06740007
067500                 DISPLAY '** INVALID START DATE: '                06750007
067600                                             PV-HOLD-NOTIFY-DATE  06760007
067700                 DISPLAY '** ERROR MESSAGE FROM CALLED MODULE:   '06770007
067800                 DISPLAY DPG54-ERROR-MESSAGE                      06780007
067900                 MOVE +4003 TO ABEND-CODE                         06790007
068000                 CALL 'ILBOABN0' USING ABEND-CODE                 06800007
068100                                                                  06810007
068200             WHEN DPG54-CMPR-DATE-INVALID                         06820007
068300                 DISPLAY '** ABEND **'                            06830007
068400                 DISPLAY '** PROGRAM = PCKUT007 -- CALLED MODULE '06840007
068500                         'DPKUT500 **'                            06850007
068600                 DISPLAY '** PARAGRAPH = 5100-CALCULATE-DAYS. **' 06860007
068700                 DISPLAY '** INVALID END DATE: '                  06870007
068800                                             PV-HOLD-RESOLVED-DATE06880007
068900                 DISPLAY '** ERROR MESSAGE FROM CALLED MODULE:   '06890007
069000                 DISPLAY DPG54-ERROR-MESSAGE                      06900007
069100                 MOVE +4003 TO ABEND-CODE                         06910007
069200                 CALL 'ILBOABN0' USING ABEND-CODE                 06920007
069300                                                                  06930007
069400             WHEN OTHER                                           06940007
069500                 DISPLAY '** ABEND **'                            06950007
069600                 DISPLAY '** PROGRAM = PCKUT007 -- CALLED MODULE '06960007
069700                         'DPKUT500 **'                            06970007
069800                 DISPLAY '** PARAGRAPH = 5100-CALCULATE-DAYS. **' 06980007
069900                 DISPLAY DPG54-ERROR-MESSAGE                      06990007
070000                 MOVE +4003 TO ABEND-CODE                         07000007
070100                 CALL 'ILBOABN0' USING ABEND-CODE                 07010007
070200                                                                  07020007
070300         END-EVALUATE                                             07030007
070400*                                                                 07040007
070500* CALCULATE THE NUMBER OF HOURS TO FIGURE THE FRACTIONAL PART OF  07050007
070600* THE NUMBER OF DAYS IN TROUBLE                                   07060007
070700* IF THE TROUBLE WAS RESOLVED BEFORE THE TIME OF THE NOTIFICATION,07070007
070800* IT WAS NOT A FULL DAY....MUST SUBRACT 1 DAY FROM THE DAY COUNT  07080007
070900* AND FIGURE THE NUMBER OF HOURS TO ADD TO THE DAY (DIVIDE BY     07090007
071000* 24 TO GET THE FRACTIONAL HOUR EQUIVALENT                        07100007
071100*                                                                 07110007
071200         IF PV-HOLD-RESOLVED-TIME < PV-HOLD-NOTIFY-TIME           07120007
071300             SUBTRACT +1 FROM PV-TEMP-DAYS-IN-TROUBLE             07130007
071400             COMPUTE PV-TEMP-HRS-IN-TROUBLE =                     07140007
071500               (24 - (PV-HOLD-NOTIFY-HOUR                         07150007
071600                   -  PV-HOLD-RESOLVED-HOUR))                     07160007
071700         ELSE                                                     07170007
071800             COMPUTE PV-TEMP-HRS-IN-TROUBLE =                     07180007
071900               (PV-HOLD-RESOLVED-HOUR - PV-HOLD-NOTIFY-HOUR)      07190007
072000         END-IF                                                   07200007
072100                                                                  07210007
072200         IF PV-TEMP-HRS-IN-TROUBLE = 0                            07220007
072300             CONTINUE                                             07230007
072400         ELSE                                                     07240007
072500             COMPUTE PV-TEMP-DAYS-IN-TROUBLE =                    07250007
072600                 (PV-TEMP-DAYS-IN-TROUBLE +                       07260007
072700                 (PV-TEMP-HRS-IN-TROUBLE / 24))                   07270007
072800         END-IF                                                   07280007
072900     END-IF.                                                      07290007
073000*                                                                 07300007
073100*                                                                 07310007
073200******************************************************************07320007
073300* 6000-READ-EXTRACT-FILE.                                        *07330007
073400*  THIS PROCEDURE WILL READ ONE EXTRACT RECORD FROM THE EXTRACT  *07340007
073500*  FLAT FILE.                                                    *07350007
073600******************************************************************07360007
073700 6000-READ-EXTRACT-FILE.                                          07370007
073800*                                                                 07380007
073900     READ RE-RECEIPT-EXTRACT-FILE                                 07390007
074000         INTO STORE-EXTRACT-LINE                                  07400007
074100         AT END SET PS-END-OF-EXTRACT-FILE TO TRUE.               07410007
074200                                                                  07420007
074300     IF PS-NOT-END-OF-EXTRACT-FILE                                07430007
074400         ADD +1 TO PT-READ-COUNT.                                 07440007
074500                                                                  07450007
074600******************************************************************07460007
074700* 7000-WRITE-REPORT-FILE                                          07470007
074800*  THIS PROCEDURE WILL WRITE ONE REPORT RECORD TO THE REPORT     *07480007
074900*  FLAT FILE.                                                    *07490007
075000******************************************************************07500007
075100 7000-WRITE-REPORT-FILE.                                          07510007
075200                                                                  07520007
075300     WRITE TR-TURN-REPORT-RECORD                                  07530007
075400         FROM PC032-TURN-RPT-EXTRACT-RECORD.                      07540007
075500                                                                  07550007
075600     ADD +1 TO PT-WRITE-COUNT.                                    07560007
075700                                                                  07570007
075800*7000-EXIT.                                                       07580007
075900                                                                  07590007
076000*                                                                 07600007
076100******************************************************************07610007
076200* 8000-CHECK-HELD-TROUBLE.                                       *07620007
076300*                                                                *07630007
076400* 12/17/97 - LOGIC CHANGED TO EXCLUDE ONLY 999 - STORAGE OFF-SITE*07640007
076500*            TROUBLE FROM THE AGING CALCULATION.                 *07650007
076600*                                                                *07660007
076700******************************************************************07670007
076800 8000-CHECK-HELD-TROUBLE.                                         07680007
076900     EXEC SQL                                                     07690007
077000         SELECT A.TRBL_RSN_CDE                                    07700007
077100         INTO :TRBNTF-TRBL-RSN-CDE                                07710007
077200         FROM TTRBNTF A                                           07720007
077300         WHERE PO_NBR             = :DK-PO-NBR                    07730007
077400           AND A.REC_SEQ_NBR      = :DK-REC-SEQ-NBR               07740007
077500           AND A.TRBL_RSN_CDE     IN (999)                        07750007
077600     END-EXEC.                                                    07760007
077700                                                                  07770007
077800     EVALUATE TRUE                                                07780007
077900         WHEN SQLCODE = ZERO                                      07790007
078000         WHEN SQLCODE = -811                                      07800007
078100         WHEN SQLCODE = +100                                      07810007
078200             CONTINUE                                             07820007
078300         WHEN OTHER                                               07830007
078400             DISPLAY '** ABEND **'                                07840007
078500             DISPLAY '** PROGRAM = PCKUT007 **'                   07850007
078600             DISPLAY '** PARAGRAPH = 8000-CHECK-HELD-TROUBLE'     07860007
078700             DISPLAY '** KEY -- PO: ' DK-PO-NBR                   07870007
078800                     ' REC SEQ: '     DK-REC-SEQ-NBR              07880007
078900             PERFORM 9100-SQL-ABEND                               07890007
079000     END-EVALUATE.                                                07900007
079100                                                                  07910007
079200*                                                                 07920007
079300******************************************************************07930007
079400* 8100-GET-TRECEIV-INFO.                                         *07940007
079500*                                                                *07950007
079600******************************************************************07960007
079700 8100-GET-TRECEIV-INFO.                                           07970007
079800     EXEC SQL                                                     07980007
079900         SELECT EXPTED_CART_CNT                                   07990007
080000              , ACTL_CART_CNT                                     08000007
080100              , CURR_OPER_UNT_ID                                  08010007
080200              , CURR_FCLTY_ID                                     08020007
080300              , REC_TMST                                          08030007
080400              , DATE(VERFYD_TMST)                                 08040007
080500              , DATE(REC_TMST)                                    08050007
080600              , (HOUR(VERFYD_TMST) - HOUR(REC_TMST))              08060017
080710              , (DAYS(VERFYD_TMST) - DAYS(REC_TMST))              08071016
080800         INTO  :RECEIV-EXPTED-CART-CNT                            08080007
080900              ,:RECEIV-ACTL-CART-CNT                              08090007
081000              ,:RECEIV-CURR-OPER-UNT-ID                           08100007
081100              ,:RECEIV-CURR-FCLTY-ID                              08110007
081200              ,:DK-RECEIVE-TMST                                   08120007
081300              ,:PV-VERIFY-DATE                                    08130007
081400              ,:PV-RECEIVE-DATE                                   08140007
081600              ,:PV-PRCS-HOUR-DIFFERENCE                           08160017
081610              ,:PV-PRCS-DAY-DIFFERENCE                            08161017
081700         FROM TRECEIV                                             08170007
081800         WHERE ORD_NBR          = :DK-PO-NBR                      08180007
081900           AND REC_SEQ_NBR      = :DK-REC-SEQ-NBR                 08190007
082000           AND VER_STATUS_CDE   = 'A'                             08200007
082100     END-EXEC.                                                    08210007
082200                                                                  08220007
082300     EVALUATE TRUE                                                08230007
082400         WHEN SQLCODE = ZEROS                                     08240007
082500             ADD +1                  TO PT-SQL-COUNT              08250007
082600         WHEN OTHER                                               08260007
082700             DISPLAY '** ABEND **'                                08270007
082800             DISPLAY '** PROGRAM = PCKUT007 **'                   08280007
082900             DISPLAY '** PARAGRAPH = 8100-GET-TRECEIV-INFO **'    08290007
083000             DISPLAY '** KEY -- PO: ' DK-PO-NBR                   08300007
083100                     ' REC SEQ: '     DK-REC-SEQ-NBR              08310007
083200             PERFORM 9100-SQL-ABEND                               08320007
083300     END-EVALUATE.                                                08330007
083400                                                                  08340007
083500                                                                  08350007
083600******************************************************************08360007
083700* 8300-OPEN-TROUBLE-CURSOR.                                      *08370007
083800******************************************************************08380007
083900 8300-OPEN-TROUBLE-CURSOR.                                        08390007
084000                                                                  08400007
084100     EXEC SQL                                                     08410007
084200          OPEN TROUBLE_CURSOR                                     08420007
084300     END-EXEC.                                                    08430007
084400                                                                  08440007
084500     EVALUATE TRUE                                                08450007
084600         WHEN SQLWARN0 NOT EQUAL SPACE                            08460007
084700         WHEN SQLCODE NOT EQUAL ZERO                              08470007
084800             DISPLAY '** ABEND **'                                08480007
084900             DISPLAY '** PROGRAM = PCKUT007 **'                   08490007
085000             DISPLAY '** PARAGRAPH = 8300-OPEN-TROUBLE-CURSOR **' 08500007
085100             PERFORM 9100-SQL-ABEND                               08510007
085200     END-EVALUATE.                                                08520007
085300                                                                  08530007
085400******************************************************************08540007
085500* 8400-FETCH-TROUBLE-CURSOR.                                     *08550007
085600******************************************************************08560007
085700 8400-FETCH-TROUBLE-CURSOR.                                       08570007
085800                                                                  08580007
085900     EXEC SQL                                                     08590007
086000          FETCH TROUBLE_CURSOR                                    08600007
086100          INTO  :PV-DB2-RESOLVED-TMST                             08610007
086200              , :PV-DB2-NOTIFY-TMST                               08620007
086300     END-EXEC.                                                    08630007
086400                                                                  08640007
086500     EVALUATE TRUE                                                08650007
086600         WHEN SQLCODE = ZERO                                      08660007
086700              ADD +1           TO PV-TROUBLE-CNT                  08670007
086800                                                                  08680007
086900         WHEN SQLCODE = +100                                      08690007
087000              SET PS-END-OF-TROUBLE-CURSOR                        08700007
087100                               TO  TRUE                           08710007
087200                                                                  08720007
087300         WHEN SQLWARN0 NOT EQUAL SPACE                            08730007
087400         WHEN SQLCODE NOT EQUAL ZERO                              08740007
087500             DISPLAY '** ABEND **'                                08750007
087600             DISPLAY '** PROGRAM = PCKUT007 **'                   08760007
087700             DISPLAY '** PARAGRAPH = 8400-FETCH-TROUBLE-CURSOR**' 08770007
087800             PERFORM 9100-SQL-ABEND                               08780007
087900     END-EVALUATE.                                                08790007
088000*                                                                 08800007
088100******************************************************************08810007
088200* 8500-CLOSE-TROUBLE-CURSOR.                                     *08820007
088300******************************************************************08830007
088400 8500-CLOSE-TROUBLE-CURSOR.                                       08840007
088500                                                                  08850007
088600                                                                  08860007
088700     EXEC SQL                                                     08870007
088800         CLOSE TROUBLE_CURSOR                                     08880007
088900     END-EXEC.                                                    08890007
089000                                                                  08900007
089100     EVALUATE TRUE                                                08910007
089200         WHEN SQLWARN0 NOT EQUAL SPACE                            08920007
089300         WHEN SQLCODE NOT EQUAL ZERO                              08930007
089400             DISPLAY '** ABEND **'                                08940007
089500             DISPLAY '** PROGRAM = PCKUT007 **'                   08950007
089600             DISPLAY '** PARAGRAPH = 8500-CLOSE-TROUBLE-CURSOR**' 08960007
089700             PERFORM 9100-SQL-ABEND                               08970007
089800     END-EVALUATE.                                                08980007
089900                                                                  08990007
090000     EXEC SQL                                                     09000007
090100         COMMIT                                                   09010007
090200     END-EXEC.                                                    09020007
090300                                                                  09030007
090400*                                                                 09040007
090500                                                                  09050007
090600 EJECT                                                            09060007
090700                                                                  09070007
090800                                                                  09080007
090900******************************************************************09090007
091000* 9000-EOJ-ROUTINE - WRITE THE LAST LINE, AND DISPLAY TOTALS      09100007
091100******************************************************************09110007
091200 9000-EOJ-ROUTINE.                                                09120007
091300                                                                  09130007
091400     PERFORM 7000-WRITE-REPORT-FILE.                              09140007
091500                                                                  09150007
091600     CLOSE TR-TURN-REPORT-FILE                                    09160007
091700           RE-RECEIPT-EXTRACT-FILE.                               09170007
091800                                                                  09180007
091900     DISPLAY ' READ COUNT: ' PT-READ-COUNT.                       09190007
092000     DISPLAY 'WRITE COUNT: ' PT-WRITE-COUNT.                      09200007
092100     DISPLAY '  SQL COUNT: ' PT-SQL-COUNT.                        09210007
092200     DISPLAY ' PO''S HELD: ' PT-HELD-COUNT.                       09220007
092210     DISPLAY 'FLOWBACK OR: ' PT-FLBK-COUNT.                       09221019
092300                                                                  09230007
092400*9000-EXIT.                                                       09240007
092500******************************************************************09250007
092600* 9100-SQL-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      09260007
092700* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 09270007
092800******************************************************************09280007
092900 9100-SQL-ABEND.                                                  09290007
093000     DISPLAY '** ABEND     **'.                                   09300007
093100     DISPLAY '** PROGRAM   ** = PCKUT007'.                        09310007
093200     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              09320007
093300     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     09330007
093400                                                                  09340007
093500******************************************************************09350007
093600* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    09360007
093700* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         09370007
093800* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     09380007
093900* FORMAT.                                                         09390007
094000******************************************************************09400007
094100     COPY DPPD004.                                                09410007
094200                                                                  09420007
094300     MOVE +4013 TO ABEND-CODE.                                    09430007
094400     CALL 'ILBOABN0' USING ABEND-CODE.                            09440007
094500*9100-EXIT.                                                       09450007
