000100 IDENTIFICATION DIVISION.                                         00010000
000200 TITLE 'MANIFESTING - ENTER DATA FOR FAST XFER SML LABELS'.       00020000
000300                                                                  00030000
000400 PROGRAM-ID.             PCKRF854.                                00040000
000500 AUTHOR.                 DENNIS STEFFEN.                          00050000
000600 INSTALLATION.           KOHLS.                                   00060000
000700 DATE-WRITTEN.           JANUARY 2001.                            00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000 ENVIRONMENT DIVISION.                                            00100000
001100 DATA DIVISION.                                                   00110000
001200                                                                  00120000
001300 WORKING-STORAGE SECTION.                                         00130000
001400******************************************************************00140000
001500*                                                                 00150000
001600 01  DK-DB2-KEYS.                                                 00160000
001700     05  DK-FR-STR-NBR                PIC  S9(04) COMP            00170000
001800                                           VALUE ZERO.            00180000
001900     05  DK-XFER-SEQ-NBR              PIC  S9(08) COMP            00190000
002000                                           VALUE ZERO.            00200000
002100     05  DK-TRN-NBR                   PIC  S9(09) COMP            00210000
002200                                           VALUE ZERO.            00220000
002300                                                                  00230000
002400 01  PC-PROGRAM-CONSTANTS.                                        00240000
002500     05  PC-TRANID                       PIC X(04) VALUE 'E854'.  00250000
002600                                                                  00260000
002700     05  PC-CURRENT-PROGRAM-NAME         PIC X(08)                00270000
002800                                               VALUE 'PCKRF854'.  00280000
002900     05  PC-PRTR-VALIDATION-PGM          PIC X(08)                00290000
003000                                               VALUE 'DPKCS060'.  00300000
003100     05  PC-MANIFEST-NBR-MODULE      PIC  X(08)  VALUE 'PCKCS721'.00310000
003200                                                                  00320000
003300                                                                  00330000
003400* ERROR MESSAGES                                                 *00340000
003500     05  PC-DB2-DATABASE-ERROR-MSG  PIC X(19) VALUE               00350000
003600                                           'DB2 ACCESS ERROR   '. 00360000
003700     05  PC-UNRECOGNIZED-PF-KEY-MSG PIC X(19) VALUE               00370000
003800                                           'UNRECOGNIZED PF KEY'. 00380000
003900     05  PC-ENTER-THROUGH-MENU-MSG  PIC X(19) VALUE               00390000
004000                                           'ENTER THROUGH MENU '. 00400000
004100     05  PC-TRANS-UNAVAILABLE-MSG   PIC X(19) VALUE               00410000
004200                                           'TRANS NOT AVAILABLE'. 00420000
004300     05  PC-PLS-ENT-FLD-MSG         PIC X(19) VALUE               00430000
004400                                           'PLEASE ENTER FIELD '. 00440000
004500     05  PC-MUST-BE-NUM-MSG         PIC X(19) VALUE               00450000
004600                                           'MUST BE NUMERIC    '. 00460000
004700     05  PC-MUST-BE-GT-0-MSG        PIC X(19) VALUE               00470000
004800                                           'MUST BE > ZERO     '. 00480000
004900     05  PC-FIRST-1-NOT-0-MSG       PIC X(19) VALUE               00490000
005000                                           'FIRST DIGIT NOT 0  '. 00500000
005100     05  PC-TOO-MANY-DIGITS         PIC X(19) VALUE               00510000
005200                                           'TOO MANY DIGITS    '. 00520000
005300     05  PC-CICS-ERR-MSG            PIC X(19) VALUE               00530000
005400                                           'CICS ACCESS ERROR  '. 00540000
005500     05  PC-WRONG-FACILITY          PIC X(19) VALUE               00550000
005600                                           'WRG FCLTY - F2 CONF'. 00560000
005700     05  PC-MORE-DIGITS-REQD        PIC X(19) VALUE               00570000
005800                                           'MORE DIGITS REQUIRD'. 00580000
005900     05  PC-IGNORE-UPDATE-MSG       PIC X(19) VALUE               00590000
006000                                           'UPDATE NOT DONE    '. 00600000
006100     05  PC-PCKCS721               PIC  X(08)  VALUE 'PCKCS721'.  00610000
006200                                                                  00620000
006300 01  PS-PROGRAM-SWITCHES.                                         00630000
006400     05  PS-ERROR-SW                  PIC  X(01)  VALUE 'N'.      00640000
006500         88  PS-ERRORS-YES                        VALUE 'Y'.      00650000
006600         88  PS-ERRORS-NO                         VALUE 'N'.      00660000
006700     05  PS-VALID-INPUT-SW            PIC  X(01)  VALUE 'N'.      00670000
006800         88  PS-VALID-INPUT                       VALUE 'Y'.      00680000
006900         88  PS-INVALID-INPUT                     VALUE 'N'.      00690000
007000     05  PS-XCTL-SW                   PIC X(04)   VALUE SPACES.   00700000
007100         88  PS-XCTL-E853                         VALUE 'E853'.   00710000
007200         88  PS-XCTL-E854                         VALUE 'E854'.   00720000
007300         88  PS-XCTL-E855                         VALUE 'E855'.   00730000
007400         88  PS-XCTL-E857                         VALUE 'E857'.   00740000
007500         88  PS-XCTL-E858                         VALUE 'E858'.   00750000
007600     05  PS-FAST-ITEM-CSR-SW          PIC X(01)   VALUE 'N'.      00760000
007700         88  PS-END-FAST-ITEM-CSR                 VALUE 'Y'.      00770000
007800         88  PS-START-FAST-ITEM-CSR               VALUE 'N'.      00780000
007900     05  PS-INVALID-STORE-NBR-SW      PIC X(01)   VALUE 'N'.      00790001
008000         88  PS-INVALID-STORE-NBR                 VALUE 'Y'.      00800000
008100         88  PS-VALID-STORE-NBR                   VALUE 'N'.      00810000
008200                                                                  00820000
008300*----------------------------------------------------------------*00830000
008400*  PROGRAM VARIABLES                                             *00840000
008500*----------------------------------------------------------------*00850000
008600 01  PV-PROGRAM-VARIABLES.                                        00860000
008700                                                                  00870000
008800     05  PV-SUB                       PIC S9(4) COMP              00880000
008900                                                VALUE ZERO.       00890000
009000     05  PV-MANIFEST-START            PIC S9(9) COMP-3.           00900000
009100     05  PV-MANIFEST-END              PIC S9(9) COMP-3.           00910000
009200     05  PV-TRN-NBR-COMP              PIC S9(10) COMP VALUE       00920000
009300                                                      ZEROES.     00930000
009400     05  PV-TRN-NBR                   PIC 9(10) VALUE ZEROES.     00940000
009500     05  PV-TRN-NBR-N REDEFINES PV-TRN-NBR.                       00950000
009600         10  PV-TRN-STORE             PIC 9(04).                  00960000
009700         10  PV-TRN-SEQUENCE          PIC 9(06).                  00970000
009800                                                                  00980000
009900     05  PV-BARCODE-18                PIC 9(18) VALUE ZERO.       00990000
010000     05  PV-DC-5-CHAR-ABBR            PIC X(05) VALUE SPACES.     01000000
010100     05  PV-DC-5-CHAR-ABBR-R REDEFINES PV-DC-5-CHAR-ABBR.         01010000
010200         10 FILLER                    PIC  X(03).                 01020000
010300         10 PV-2-DIGIT-DC-ABBR        PIC  X(02).                 01030000
010400                                                                  01040000
010500     05  PV-STORE-NUMBER.                                         01050000
010600         10  PV-STORE-NUMBER-N        PIC 9(04) VALUE ZERO.       01060000
010700     05  PV-FAST-NBR.                                             01070000
010800         10  PV-FAST-STORE            PIC 9(04) VALUE ZERO.       01080000
010900         10  FILLER                   PIC X(01) VALUE '-'.        01090000
011000         10  PV-FAST-SEQ              PIC 9(06) VALUE ZERO.       01100000
011100         10  FILLER                   PIC X(01) VALUE '-'.        01110000
011200         10  PV-FAST-CHK-DIGIT        PIC 9(01) VALUE ZERO.       01120000
011300                                                                  01130000
011400     05  PV-NULL-IND                     PIC S9(4)   VALUE ZERO   01140000
011500                                                     COMP SYNC.   01150000
011600     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01160000
011700                                                     COMP SYNC.   01170000
011800     05  PV-MESSAGE-AREA                 PIC  X(19)  VALUE SPACE. 01180000
011900     05  PV-CICS-RESPONSE                PIC S9(09)  VALUE ZEROS  01190000
012000                                                     COMP SYNC.   01200000
012100     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 01210000
012200                                                                  01220000
012300 01  PV-LOG-MSG.                                                  01230000
012400     05  FILLER                       PIC X(12) VALUE             01240000
012500         ' E857 ERROR '.                                          01250000
012600     05  FILLER                       PIC X(09) VALUE             01260000
012700         'SQLCODE= '.                                             01270000
012800     05  PV-SQLCODE                   PIC -9(03).                 01280000
012900     05  FILLER                       PIC X(06) VALUE             01290000
013000         ' ERR= '.                                                01300000
013100     05  PV-ERROR-NBR                 PIC 9(03) VALUE ZERO.       01310000
013200     05  FILLER                       PIC X(07) VALUE             01320000
013300         ' FAST= '.                                               01330000
013400     05  PV-DISPLAY-FAST              PIC X(13) VALUE ZEROES.     01340000
013500     05  FILLER                       PIC X(05) VALUE             01350000
013600         ' PO= '.                                                 01360000
013700     05  PV-DISPLAY-PO                PIC 9(09) VALUE ZEROES.     01370000
013800     05  FILLER                       PIC X(07) VALUE             01380000
013900         ' RCVR= '.                                               01390000
014000     05  PV-DISPLAY-RCVR              PIC 9(04) VALUE ZEROES.     01400000
014100     05  FILLER                       PIC X(07) VALUE             01410000
014200         ' LINE= '.                                               01420000
014300     05  PV-DISPLAY-PO-LNE-NBR        PIC 9(04) VALUE ZEROES.     01430000
014400     05  FILLER                       PIC X(06) VALUE             01440000
014500         ' STR= '.                                                01450000
014600     05  PV-DISPLAY-STORE             PIC 9(04) VALUE ZEROES.     01460000
014700                                                                  01470000
014800 01  PV-EDITING-FIELDS.                                           01480000
014900                                                                  01490000
015000     05  PV-PROGRAM-DATA.                                         01500000
015100** AS PART OF THE PO EXPANSION PROJECT, COMMENTED OUT THE NEXT    01510001
015200** 7 LINES BECAUSE THEY ARE NEVER REFERENCED IN THE PROGRAM.      01520001
015300*        10  PV-PO                       PIC  X(07)  VALUE SPACE. 01530001
015400*        10  PV-PO-N REDEFINES PV-PO     PIC  ZZZZZZ9.            01540001
015500*                                                                 01550000
015600*        10  PV-PO-RCVR.                                          01560001
015700*            15 PV-PO-OUT                PIC  9(07).              01570001
015800*            15 FILLER                   PIC  X(01)  VALUE '-'.   01580001
015900*            15 PV-RCVR-OUT              PIC 9(03).               01590001
016000*                                                                 01600000
016100                                                                  01610000
016200         10  PV-PO-LINE-N                  PIC 9(09).             01620000
016300         10  PV-PO-LINE-X REDEFINES PV-PO-LINE-N.                 01630000
016400             15 FILLER                     PIC X(05).             01640000
016500             15 PV-PO-LINE-OUT             PIC X(04).             01650000
016600                                                                  01660000
016700         10  PV-PO-LINE-LBL.                                      01670000
016800             15  PV-LINE-LBL-1           PIC 9(01).               01680000
016900             15  PV-LINE-LBL-3           PIC 9(03).               01690000
017000                                                                  01700000
017100/                                                                 01710000
017200* COMMAREA FOR PCRF85X SCREENS                                    01720000
017300 01  CA-COMMAREA.                                                 01730000
017400     COPY PCWS033.                                                01740000
017500     05  CA-ENTRY-PATH-IND            PIC X(08) VALUE SPACES.     01750000
017600         88  CA-853                             VALUE 'PCKRF853'. 01760000
017700         88  CA-857                             VALUE 'PCKRF857'. 01770000
017800         88  CA-858                             VALUE 'PCKRF858'. 01780000
017900     05  PV-STORE-X.                                              01790000
018000         10  PV-STORE                 PIC 9(04) VALUE ZERO.       01800000
018100     05  PV-STORE-NBR                 PIC S9(04) COMP             01810000
018200                                                     VALUE ZERO.  01820000
018300     05  PV-LABEL-QTY-X.                                          01830000
018400         10  PV-LABEL-QTY             PIC 9(04) VALUE ZERO.       01840000
018500     05  PV-MULT-FLAG                 PIC X(01) VALUE SPACE.      01850000
018600     05  PV-PRTR-NBR                  PIC X(04) VALUE SPACE.      01860000
018700*    05  PV-FAST-NBR                  PIC X(12) VALUE SPACES.     01870000
018800                                                                  01880000
018900     05  PM-PROGRAM-MESSAGE-1.                                    01890000
019000         10  PM-RET-CDE           PIC  X(02)  VALUE SPACES.       01900000
019100         10  FILLER               PIC  X(01)  VALUE '-'.          01910000
019200         10  PM-RET-MSG           PIC  X(25)  VALUE SPACES.       01920000
019300         10  FILLER               PIC  X(48)  VALUE SPACES.       01930000
019400                                                                  01940000
019500                                                                  01950000
019600*  CHECK DIGIT WORK AREA                                          01960000
019700     COPY PCWS037.                                                01970000
019800                                                                  01980000
019900*  MAP LAYOUT                                                     01990000
020000     COPY PCKM854.                                                02000000
020100                                                                  02010000
020200* HELP SCREEN COMMAREA                                            02020000
020300     COPY PCWS192.                                                02030000
020400                                                                  02040000
020500* HELP SCREEN WORK AREA                                           02050000
020600     COPY PCWS188.                                                02060000
020700                                                                  02070000
020800* PRINTER VALIDATION AREA                                         02080000
020900     COPY DPWS072.                                                02090000
021000/                                                                 02100000
021100* BARCODE AREA                                                    02110000
021200     COPY PCWS160.                                                02120000
021300/                                                                 02130000
021400* MANIFEST NBR MODULE                                             02140000
021500     COPY PCWS187.                                                02150000
021600/                                                                 02160000
021700* CARTON LABELING SYSTEM COMMAREA                                 02170000
021800     COPY PCWS140.                                                02180000
021900/                                                                 02190000
022000     COPY DPWS010I.                                               02200000
022100*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   02210000
022200     COPY DPWS015.                                                02220000
022300                                                                  02230000
022400*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      02240000
022500     COPY DFHAID.                                                 02250000
022600                                                                  02260000
022700*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               02270000
022800     COPY DPWS013.                                                02280000
022900/                                                                 02290000
023000******************************************************************02300000
023100*    DB2 AREA FOR THE STORE MANIFEST TABLE                        02310000
023200******************************************************************02320000
023300                                                                  02330000
023400     EXEC SQL                                                     02340000
023500         INCLUDE TDCSTMF                                          02350000
023600     END-EXEC.                                                    02360000
023700                                                                  02370000
023800     EXEC SQL                                                     02380000
023900         INCLUDE TTFMSTR                                          02390000
024000     END-EXEC.                                                    02400000
024100                                                                  02410000
024200     EXEC SQL                                                     02420000
024300         INCLUDE TTFITEM                                          02430000
024400     END-EXEC.                                                    02440000
024500                                                                  02450000
024600*                                                                 02460000
024700*  DCLGEN FOR THE OUTBOUND CARTON TABLE (SUT_OTBND_CART)          02470000
024800*                                                                 02480000
024900     EXEC SQL                                                     02490000
025000         INCLUDE SUT00024                                         02500000
025100     END-EXEC.                                                    02510000
025200                                                                  02520000
025300*                                                                 02530000
025400*  DCLGEN FOR THE OUTBOUND LOCATION TABLE (SUT_OTBND_LOC)         02540000
025500*                                                                 02550000
025600     EXEC SQL                                                     02560000
025700         INCLUDE SUT00027                                         02570000
025800     END-EXEC.                                                    02580000
025900                                                                  02590000
026000*                                                                 02600000
026100*  DCLGEN FOR THE OUTBOUND UPC TABLE (SUT_OTBND_UPC)              02610000
026200*                                                                 02620000
026300     EXEC SQL                                                     02630000
026400         INCLUDE SUT00028                                         02640000
026500     END-EXEC.                                                    02650000
026600                                                                  02660000
026700*                                                                 02670000
026800*  DCLGEN FOR THE LOGISTICS DOMAIN LOCATION MASTER TABLE          02680000
026900*  (XLT_LOC)                                                      02690000
027000*                                                                 02700000
027100     EXEC SQL                                                     02710000
027200         INCLUDE XLT00010                                         02720000
027300     END-EXEC.                                                    02730000
027400                                                                  02740000
027500     EXEC SQL                                                     02750000
027600         INCLUDE TCOCNTL                                          02760000
027700     END-EXEC.                                                    02770000
027800                                                                  02780000
027900*  PARAMETER TABLE*                                               02790000
028000     EXEC SQL                                                     02800000
028100         INCLUDE TKRPRPM                                          02810000
028200     END-EXEC.                                                    02820000
028300                                                                  02830000
028400     EXEC SQL                                                     02840000
028500         INCLUDE SQLCA                                            02850000
028600     END-EXEC.                                                    02860000
028700/                                                                 02870000
028800     EXEC SQL                                                     02880000
028900         DECLARE FAST-ITEM-CSR CURSOR FOR                         02890000
029000         SELECT                                                   02900000
029100             FITM.XFER_LNE_NBR                                    02910000
029200         ,   FITM.KOHLS_UPC_NBR                                   02920000
029300         ,   FITM.XFER_QTY                                        02930000
029400         FROM TTFITEM FITM                                        02940000
029500         WHERE                                                    02950000
029600             XFER_DKEY_ID = :PC033-XFER-DKEY-ID                   02960000
029700     END-EXEC.                                                    02970000
029800                                                                  02980000
029900                                                                  02990000
030000 LINKAGE SECTION.                                                 03000000
030100 01  DFHCOMMAREA.                                                 03010000
030200     05  FILLER                         OCCURS  1 TO 4072 TIMES   03020000
030300                                      DEPENDING ON EIBCALEN.      03030000
030400         10  FILLER                   PIC X.                      03040000
030500/                                                                 03050000
030600 PROCEDURE DIVISION.                                              03060000
030700 0000-PROGRAM-MAINLINE.                                           03070000
030800                                                                  03080000
030900                                                                  03090000
031000     INITIALIZE CA-COMMAREA                                       03100000
031100     MOVE DFHCOMMAREA                 TO CA-COMMAREA.             03110000
031200                                                                  03120000
031300     EVALUATE TRUE                                                03130000
031400         WHEN EIBCALEN = ZERO                                     03140000
031500             MOVE PC-ENTER-THROUGH-MENU-MSG                       03150000
031600                                      TO PV-MESSAGE-AREA          03160000
031700             PERFORM 8110-RETURN                                  03170000
031800                                                                  03180000
031900         WHEN EIBTRNID = 'Z278'                                   03190000
032000             MOVE DFHCOMMAREA         TO PC192-COMMAREA           03200000
032100             MOVE PC192-HOST-SAVE-AREA                            03210000
032200                                      TO CA-COMMAREA              03220000
032300             SET PC033-PROCESS-SCREEN TO TRUE                     03230000
032400             MOVE PC192-HOST-SAVE-MAP TO PC854AO                  03240000
032500             MOVE -1                  TO ASTOREL                  03250000
032600             PERFORM 8000-SEND-MAP                                03260000
032700             PERFORM 8100-RETURN-TRANID                           03270000
032800                                                                  03280000
032900         WHEN PC033-INITIALIZE-SCREEN                             03290000
033000         WHEN EIBAID = DFHCLEAR                                   03300000
033100             PERFORM 1000-INITIALIZE                              03310000
033200             SET PC033-PROCESS-SCREEN TO TRUE                     03320000
033300             MOVE PC-CURRENT-PROGRAM-NAME                         03330000
033400                                      TO PC033-LAST-PROGRAM       03340000
033500             IF PC033-STR-NBR > ZERO                              03350000
033600                 MOVE -1              TO ALABELSL                 03360000
033700             ELSE                                                 03370000
033800                 MOVE -1              TO ASTOREL                  03380000
033900             END-IF                                               03390000
034000             PERFORM 8000-SEND-MAP                                03400000
034100             PERFORM 8100-RETURN-TRANID                           03410000
034200                                                                  03420000
034300                                                                  03430000
034400         WHEN EIBAID = DFHPF3                                     03440000
034500             MOVE 'PCKRF853'          TO PV-TRANSFER-PROGRAM      03450000
034600             PERFORM 8200-XCTL                                    03460000
034700                                                                  03470000
034800         WHEN EIBAID = DFHENTER                                   03480000
034900             PERFORM 8020-RECEIVE-MAP                             03490000
035000             PERFORM 2000-PROCESS                                 03500000
035100             IF PS-ERRORS-NO                                      03510000
035200                 IF PV-MULT-FLAG = 'Y'                            03520000
035300                     MOVE 'PCKRF855'  TO PV-TRANSFER-PROGRAM      03530000
035400                                                                  03540000
035500                     MOVE PC033-FIRST-CARTON                      03550000
035600                                      TO PC033-CARTON             03560000
035700                     IF CA-858                                    03570000
035800                         SET PC033-MOVE-FAST-TO-NEW-LABEL         03580000
035900                                      TO TRUE                     03590000
036000                     ELSE                                         03600000
036100                         SET PC033-NEW-FAST-LABEL                 03610000
036200                                      TO TRUE                     03620000
036300                     END-IF                                       03630000
036400                     PERFORM 8200-XCTL                            03640000
036500                 ELSE                                             03650000
036600                     MOVE 'PCKRF853'  TO PV-TRANSFER-PROGRAM      03660000
036700                     PERFORM 8200-XCTL                            03670000
036800                 END-IF                                           03680000
036900             ELSE                                                 03690000
037000                 PERFORM 8010-SEND-DATA-ONLY                      03700000
037100                 PERFORM 8100-RETURN-TRANID                       03710000
037200             END-IF                                               03720000
037300                                                                  03730000
037400         WHEN EIBAID = DFHPF1                                     03740000
037500             PERFORM 8020-RECEIVE-MAP                             03750000
037600             MOVE PC854AO             TO PC192-HOST-SAVE-MAP      03760000
037700             PERFORM 1200-HELP-SCREEN                             03770000
037800                                                                  03780000
037900         WHEN OTHER                                               03790000
038000             PERFORM 8020-RECEIVE-MAP                             03800000
038100             MOVE -1                  TO ASTOREL                  03810000
038200             MOVE PC-UNRECOGNIZED-PF-KEY-MSG                      03820000
038300                                      TO AMSGLNO                  03830000
038400             PERFORM 8010-SEND-DATA-ONLY                          03840000
038500             PERFORM 8100-RETURN-TRANID                           03850000
038600     END-EVALUATE.                                                03860000
038700                                                                  03870000
038800     GOBACK.                                                      03880000
038900                                                                  03890000
039000 1000-INITIALIZE.                                                 03900000
039100                                                                  03910000
039200     MOVE PC-TRANID                   TO PC033-TRAN-ID            03920000
039300     MOVE PC033-LAST-PROGRAM          TO CA-ENTRY-PATH-IND.       03930000
039400     PERFORM 1100-FORMAT-FAST-NBR.                                03940000
039500     PERFORM 2030-MOVE-COMMAREA-TO-MAP                            03950000
039600     MOVE 'N'                         TO AMULTO                   03960000
039700                                         PV-MULT-FLAG             03970000
039800     MOVE PC033-SML-PRTR-ID           TO APRTRO                   03980000
039900                                         PV-PRTR-NBR.             03990000
040000                                                                  04000000
040100 1100-FORMAT-FAST-NBR.                                            04010000
040200     IF PC033-FR-STR-NBR = ZERO                                   04020000
040300                AND PC033-XFER-SEQ-NBR = ZERO                     04030000
040400       MOVE 'UNKNOWN'                 TO AFASTO                   04040000
040500                                         PV-FAST-NBR              04050000
040600     ELSE                                                         04060000
040700         MOVE PC033-FR-STR-NBR        TO                          04070000
040800                                     PC037-XFER-FROM-STORE-NBR    04080000
040900         MOVE PC033-XFER-SEQ-NBR      TO PC037-XFER-SEQ-NBR       04090000
041000         PERFORM P0300-GET-CHK-DIGIT                              04100000
041100         STRING PC033-FR-STR-NBR   '-'                            04110000
041200                PC037-XFER-SEQ-NBR '-'                            04120000
041300                PC037-CHK-DIGIT                                   04130000
041400                    DELIMITED BY SIZE                             04140000
041500                                      INTO AFASTO                 04150000
041600         MOVE AFASTO                  TO PV-FAST-NBR              04160000
041700     END-IF.                                                      04170000
041800                                                                  04180000
041900     IF PC033-STR-NBR > ZERO AND PS-ERRORS-NO                     04190000
042000         MOVE PC033-STR-NBR           TO PV-STORE                 04200000
042100                                         ASTOREO                  04210000
042200         MOVE DP015-ASK-NOR-MDT       TO ASTOREA                  04220000
042300         MOVE -1                      TO ALABELSL                 04230000
042400     END-IF.                                                      04240000
042500                                                                  04250000
042600 1200-HELP-SCREEN.                                                04260000
042700     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      04270000
042800     MOVE 'PCKRF854'                  TO PC192-PROGRAM-NAME       04280000
042900     COPY PCPD188.                                                04290000
043000     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      04300000
043100     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA     04310000
043200     PERFORM 8220-XCTL-TO-HELP.                                   04320000
043300                                                                  04330000
043400/                                                                 04340000
043500 2000-PROCESS.                                                    04350000
043600     PERFORM 2010-LOAD-MAP-TO-COMMAREA.                           04360000
043700     PERFORM 2020-EDIT-FIELDS.                                    04370000
043800                                                                  04380000
043900* IF ONLY ONE FAST NUMBER IS INVOLVED IT IS OKAY TO PRINT         04390000
044000* THE LABEL NOW.  OTHERWISE THE LABE SHOULD BE PRINTED BY         04400000
044100* PCKRF855 AFTER ALL OF THE FAST NUMBERS HAVE BEEN SCANNED        04410000
044200* AND F3 IS PRESSED TO EXIT BACK TO THE FAST TOTE MENU.           04420000
044300                                                                  04430000
044400     IF PS-ERRORS-NO                                              04440000
044500         IF PV-MULT-FLAG = 'N'                                    04450000
044600             PERFORM 3000-PRINT-LABELS                            04460000
044700         ELSE                                                     04470000
044800             PERFORM 3010-GET-MANIFEST-NBRS                       04480000
044900         END-IF                                                   04490000
045000                                                                  04500000
045100* PROCESSING DEPENDS ON THE ENTRY PATH TAKEN                      04510000
045200         IF PS-ERRORS-NO                                          04520000
045300             EVALUATE TRUE                                        04530000
045400                 WHEN CA-853                                      04540000
045500                     PERFORM VARYING PC033-CARTON FROM            04550000
045600                             PC033-FIRST-CARTON BY 1 UNTIL        04560000
045700                             PC033-CARTON > PC033-LAST-CARTON     04570000
045800                         PERFORM 7200-INSERT-OTBND-CART           04580000
045900                         PERFORM 7350-INSERT-OTBND-LOC            04590000
046000                         PERFORM 4000-ADD-FAST-TO-CARTON          04600000
046100                     END-PERFORM                                  04610000
046200                 WHEN CA-857                                      04620000
046300                     PERFORM VARYING PC033-CARTON FROM            04630000
046400                             PC033-FIRST-CARTON BY 1 UNTIL        04640000
046500                             PC033-CARTON > PC033-LAST-CARTON     04650000
046600                         PERFORM 4300-INSERT-DUMMY-SHIP-UNITS     04660000
046700                     END-PERFORM                                  04670000
046800                 WHEN CA-858                                      04680000
046900                     IF PC033-MOVE-FAST-TO-NEW-LABEL              04690000
047000                             PERFORM VARYING PC033-CARTON FROM    04700000
047100                                 PC033-FIRST-CARTON BY 1 UNTIL    04710000
047200                                 PC033-CARTON > PC033-LAST-CARTON 04720000
047300                                                                  04730000
047400                            PERFORM 7200-INSERT-OTBND-CART        04740000
047500                            PERFORM 7350-INSERT-OTBND-LOC         04750000
047600                            PERFORM 4000-ADD-FAST-TO-CARTON       04760000
047700                                                                  04770000
047800                         END-PERFORM                              04780000
047900                     ELSE                                         04790000
048000                         PERFORM 4200-UPDATE-SHIP-UNITS           04800000
048100                     END-IF                                       04810000
048200             END-EVALUATE                                         04820000
048300             PERFORM 2030-MOVE-COMMAREA-TO-MAP                    04830000
048400         END-IF                                                   04840000
048500                                                                  04850000
048600     END-IF.                                                      04860000
048700                                                                  04870000
048800 2010-LOAD-MAP-TO-COMMAREA.                                       04880000
048900                                                                  04890000
049000     IF  ASTOREL > ZERO                                           04900000
049100         MOVE ASTOREI                 TO PV-STORE-X               04910000
049200     ELSE                                                         04920000
049300         IF ASTOREA = DP015-ERASE-EOF                             04930000
049400             MOVE ZEROES              TO PV-STORE-X               04940000
049500         END-IF                                                   04950000
049600     END-IF.                                                      04960000
049700                                                                  04970000
049800                                                                  04980000
049900     IF  ALABELSL > ZERO                                          04990000
050000         MOVE ALABELSI                TO PV-LABEL-QTY-X           05000000
050100     ELSE                                                         05010000
050200         IF ALABELSA = DP015-ERASE-EOF                            05020000
050300             MOVE ZEROES              TO PV-LABEL-QTY-X           05030000
050400         END-IF                                                   05040000
050500     END-IF.                                                      05050000
050600                                                                  05060000
050700     IF  AMULTL > ZERO                                            05070000
050800         MOVE AMULTI                  TO PV-MULT-FLAG             05080000
050900     ELSE                                                         05090000
051000         IF AMULTA = DP015-ERASE-EOF                              05100000
051100             MOVE SPACES              TO PV-MULT-FLAG             05110000
051200         END-IF                                                   05120000
051300     END-IF.                                                      05130000
051400                                                                  05140000
051500     IF  APRTRL > ZERO                                            05150000
051600         MOVE APRTRI                  TO PV-PRTR-NBR              05160000
051700                                         PC033-SML-PRTR-ID        05170000
051800     ELSE                                                         05180000
051900         IF APRTRA = DP015-ERASE-EOF                              05190000
052000             MOVE PC033-SML-PRTR-ID   TO PV-PRTR-NBR              05200000
052100         END-IF                                                   05210000
052200     END-IF.                                                      05220000
052300                                                                  05230000
052400 2020-EDIT-FIELDS.                                                05240000
052500                                                                  05250000
052600     MOVE SPACES                      TO AMSGLNO                  05260000
052700     PERFORM 2100-VALIDATE-PRINTER                                05270000
052800     IF PS-ERRORS-NO                                              05280000
052900         PERFORM 2150-VALIDATE-PRINTER-ID-SML                     05290000
053000         IF PS-ERRORS-NO                                          05300000
053100             CONTINUE                                             05310000
053200         END-IF                                                   05320000
053300     END-IF                                                       05330000
053400                                                                  05340000
053500     IF PV-MULT-FLAG = 'N' OR 'Y'                                 05350000
053600         CONTINUE                                                 05360000
053700     ELSE                                                         05370000
053800         MOVE 'N'                     TO PV-MULT-FLAG             05380000
053900                                         AMULTO                   05390000
054000     END-IF                                                       05400000
054100                                                                  05410000
054200     IF  PV-LABEL-QTY-X > SPACES                                  05420000
054300         MOVE PV-LABEL-QTY-X          TO DP010I-UNEDITED-FIELD    05430000
054400         MOVE LENGTH OF PV-LABEL-QTY-X                            05440000
054500                                      TO DP010I-MAXIMUM-DIGITS    05450000
054600         MOVE ZERO                    TO DP010I-MAXIMUM-DECIMALS  05460000
054700         SET  DP010I-NEGATIVE-NOT-ALLOWED                         05470000
054800                                      TO TRUE                     05480000
054910         CALL DP010I-NUMERIC-EDIT-ROUTINE                         05491002
054920                         USING DP010I-NUMERIC-EDIT-AREA           05492002
055000         IF  DP010I-ERROR-DETECTED                                05500000
055100             SET PS-ERRORS-YES        TO TRUE                     05510000
055200             MOVE 'INVALID QTY'       TO AMSGLNO                  05520000
055300             MOVE -1                  TO ALABELSL                 05530000
055400        ELSE                                                      05540000
055500             PERFORM 2200-DETERMINE-MAX-LABELS                    05550000
055600             IF DP010I-NUMERIC-FIELD > KRPRPM-FUNC-QTY            05560000
055700                 SET PS-ERRORS-YES        TO TRUE                 05570000
055800                 MOVE 'QTY TOO LARGE'     TO AMSGLNO              05580000
055900                 MOVE -1                  TO ALABELSL             05590000
056000             ELSE                                                 05600000
056100                 MOVE DP010I-NUMERIC-FIELD                        05610000
056200                                      TO                          05620000
056300                                   PC033-NBR-LABELS-REQUESTED     05630000
056400                                   PV-LABEL-QTY                   05640000
056500             END-IF                                               05650000
056600         END-IF                                                   05660000
056700     END-IF.                                                      05670000
056800                                                                  05680000
056900     IF PC033-NBR-LABELS-REQUESTED = ZERO                         05690000
057000         MOVE 'QTY REQUIRED'          TO AMSGLNO                  05700000
057100         MOVE -1                      TO ALABELSL                 05710000
057200         SET PS-ERRORS-YES            TO TRUE                     05720000
057300     END-IF.                                                      05730000
057400                                                                  05740000
057500     IF  PV-STORE-X > SPACES                                      05750000
057600         MOVE PV-STORE-X              TO DP010I-UNEDITED-FIELD    05760000
057700         MOVE LENGTH OF PV-STORE-X    TO DP010I-MAXIMUM-DIGITS    05770000
057800         MOVE ZERO                    TO DP010I-MAXIMUM-DECIMALS  05780000
057900         SET  DP010I-NEGATIVE-NOT-ALLOWED                         05790000
058000                                      TO TRUE                     05800000
058110         CALL DP010I-NUMERIC-EDIT-ROUTINE                         05811002
058120                         USING DP010I-NUMERIC-EDIT-AREA           05812002
058200         IF  DP010I-ERROR-DETECTED                                05820000
058300             SET PS-ERRORS-YES        TO TRUE                     05830000
058400             MOVE 'INVALID STORE'     TO AMSGLNO                  05840000
058500             MOVE -1                  TO ASTOREL                  05850000
058600        ELSE                                                      05860000
058700             MOVE DP010I-NUMERIC-FIELD                            05870000
058800                                      TO PV-STORE-NBR             05880000
058900             SET PS-VALID-STORE-NBR TO TRUE                       05890000
059000             PERFORM 7400-VALIDATE-STORE-NBR                      05900000
059100             IF PS-INVALID-STORE-NBR                              05910000
059200                 SET PS-ERRORS-YES        TO TRUE                 05920000
059300                 MOVE 'INVALID STORE'     TO AMSGLNO              05930000
059400                 MOVE -1                  TO ASTOREL              05940000
059500             ELSE                                                 05950000
059600                 MOVE DP010I-NUMERIC-FIELD                        05960000
059700                                      TO PC033-STR-NBR            05970000
059800                                         PV-STORE                 05980000
059900             END-IF                                               05990000
060000         END-IF                                                   06000000
060100     END-IF.                                                      06010000
060200                                                                  06020000
060300                                                                  06030000
060400*    IF PC033-FR-STR-NBR = ZERO                                   06040000
060500*        SET PS-ERRORS-YES            TO TRUE                     06050000
060600*        MOVE 'STORE REQUIRED'        TO AMSGLNO                  06060000
060700*        MOVE -1                      TO ASTOREL                  06070000
060800*    ELSE                                                         06080000
060900     MOVE PC033-STR-NBR               TO PV-STORE.                06090000
061000     IF PS-ERRORS-NO                                              06100000
061100         MOVE DP015-ASK-NOR-MDT       TO ASTOREA                  06110000
061200         MOVE -1                      TO ALABELSL                 06120000
061300     END-IF.                                                      06130000
061400*    END-IF.                                                      06140000
061500                                                                  06150000
061600 2030-MOVE-COMMAREA-TO-MAP.                                       06160000
061700*    MOVE PV-FAST-NBR                 TO AFASTO                   06170000
061800     MOVE PC033-STR-NBR               TO ASTOREO                  06180000
061900     IF PC033-NBR-LABELS-REQUESTED < 1                            06190000
062000         MOVE 1                       TO                          06200000
062100                              PC033-NBR-LABELS-REQUESTED          06210000
062200                              PV-LABEL-QTY                        06220000
062300     END-IF                                                       06230000
062400     MOVE PC033-NBR-LABELS-REQUESTED  TO ALABELSO                 06240000
062500     MOVE PV-MULT-FLAG                TO AMULTO                   06250000
062600     MOVE PC033-SML-PRTR-ID           TO APRTRO.                  06260000
062700/                                                                 06270000
062800 2100-VALIDATE-PRINTER.                                           06280000
062900                                                                  06290000
063000     MOVE '01'                        TO DP072-RPT-PGM-TYP-ID.    06300000
063100     MOVE PC033-OPER-UNT-ID           TO DP072-ORIGIN-OPER-UNT-ID 06310000
063200                                        DP072-OPER-UNT-ID.        06320000
063300     MOVE 1                           TO DP072-ORIGIN-FCLTY-ID    06330000
063400                                         DP072-FCLTY-ID.          06340000
063500     MOVE 'PCKCS126'                  TO DP072-RPT-PGM-NME        06350000
063600     MOVE PV-PRTR-NBR                 TO DP072-PRINTER-ID         06360000
063700     SET DP072-VALIDATE               TO TRUE                     06370000
063800                                                                  06380000
063900     EXEC CICS                                                    06390000
064000          LINK PROGRAM  (PC-PRTR-VALIDATION-PGM)                  06400000
064100               COMMAREA (DP072-COMM-AREA)                         06410000
064200               RESP     (PV-CICS-RESPONSE)                        06420000
064300     END-EXEC                                                     06430000
064400                                                                  06440000
064500     EVALUATE TRUE                                                06450000
064600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06460000
064700              CONTINUE                                            06470000
064800         WHEN OTHER                                               06480000
064900             SET PS-ERRORS-YES        TO TRUE                     06490000
065000             MOVE 'INVALID PRINTER ID'                            06500000
065100                                      TO AMSGLNO                  06510000
065200             MOVE -1                  TO APRTRL                   06520000
065300     END-EVALUATE.                                                06530000
065400                                                                  06540000
065500                                                                  06550000
065600*----------------------------------------------------------------*06560000
065700*  VALIDATE THE PRINTER NUMBER ENTERED ON THE SCREEN TO ENSURE   *06570000
065800*  THIS IS A VALID PRINTER AND THAT SHIPPING MANIFEST LABELS     *06580000
065900*  CAN BE PRINTED ON THIS PRINTER.                               *06590000
066000*----------------------------------------------------------------*06600000
066100 2150-VALIDATE-PRINTER-ID-SML.                                    06610000
066200                                                                  06620000
066300     EVALUATE TRUE                                                06630000
066400     WHEN PC033-SML-PRTR-ID = SPACES                              06640000
066500         MOVE 'PRINTER REQUIRED'      TO AMSGLNO                  06650000
066600         MOVE -1                      TO APRTRL                   06660000
066700         SET PS-ERRORS-YES            TO TRUE                     06670000
066800     WHEN DP072-PRTR-CLUSTER-OS-RLSE-CDE  = 'MGMX'                06680000
066900         MOVE 'INVALID PRINTER ID'    TO AMSGLNO                  06690000
067000         MOVE -1                      TO APRTRL                   06700000
067100         SET PS-ERRORS-YES            TO TRUE                     06710000
067200     WHEN DP072-PRTR-PRTR-TRK-STAT-CDE    NOT = 'A'               06720000
067300         SET PS-ERRORS-YES            TO TRUE                     06730000
067400         MOVE -1                      TO APRTRL                   06740000
067500         MOVE 'INVALID PRINTER ID'                                06750000
067600                                      TO AMSGLNO                  06760000
067700     END-EVALUATE.                                                06770000
067800/                                                                 06780000
067900******************************************************************06790000
068000*CHECK IF DC IS USING RDM BLIND RECEIVING                         06800000
068100******************************************************************06810000
068200 2200-DETERMINE-MAX-LABELS.                                       06820000
068300                                                                  06830000
068400                                                                  06840000
068500     EXEC SQL                                                     06850000
068600          SELECT FUNC_QTY                                         06860000
068700          INTO  :KRPRPM-FUNC-QTY                                  06870000
068800          FROM   TKRPRPM                                          06880000
068900          WHERE  SYS_PRC_FUNC_CDE  = 'MXFXLB'                     06890000
069000            AND  LOC_ID            = 90                           06900000
069100            AND  INTFC_SYS_CDE     = 'KHL'                        06910000
069200            AND  FUNC_PRC_STAT_CDE = 'AC'                         06920000
069300            AND  FUNC_END_TMST     > CURRENT TIMESTAMP            06930000
069400     END-EXEC.                                                    06940000
069500                                                                  06950000
069600                                                                  06960000
069700     EVALUATE TRUE                                                06970000
069800         WHEN SQLCODE = ZERO                                      06980000
069900             CONTINUE                                             06990000
070000         WHEN SQLWARN0 NOT = SPACES                               07000000
070100         WHEN SQLCODE < ZERO                                      07010000
070200         WHEN SQLCODE > ZERO                                      07020000
070300                                                                  07030000
070400             MOVE '2200-DETERMINE-MAX-LABELS'                     07040000
070500                             TO PC033-PARAGRAPH                   07050000
070600             MOVE 'PCKRF854 - GET MAX LABEL COUNT'                07060000
070700                             TO PC033-MESSAGE-TEXT(1)             07070000
070800             MOVE SQLCA      TO PC033-SQLCA                       07080000
070900             MOVE 'TKRPRPM'  TO PC033-DB2-TABLE-NAME(1)           07090000
071000             SET PC033-ABEND          TO TRUE                     07100000
071100             MOVE 99                  TO PC033-PGM-MSG-NBR        07110000
071200             PERFORM 8210-XCTL-ERROR-SCREEN                       07120000
071300                                                                  07130000
071400                                                                  07140000
071500     END-EVALUATE.                                                07150000
071600/                                                                 07160000
071700 3000-PRINT-LABELS.                                               07170000
071800                                                                  07180000
071900     SET PC140-COMMON-MFST-LBL-NBR    TO TRUE                     07190000
072000     MOVE DP072-PRTR-IP-ADDRESS       TO PC140-SML-IP-ADDRESS     07200000
072100     MOVE DP072-PRTR-CLUSTER-OS-RLSE-CDE                          07210000
072200                                      TO PC140-SML-OS-RLSE-CDE    07220000
072300     MOVE DP072-PRTR-DATA-XFER-MODE-ID                            07230000
072400                                      TO PC140-SML-XFER-MODE-ID   07240000
072500     MOVE DP072-XMIT-INTFC-CDE                                    07250000
072600                                      TO PC140-XMIT-INTFC-CDE     07260000
072700     MOVE DP072-PRTR-TYP-CDE                                      07270000
072800                                      TO PC140-SML-PRTR-TYPE      07280000
072900                                                                  07290000
073000     MOVE DP072-PRTR-OPER-UNT-ID      TO XLT00010-LOC-NBR         07300000
073100                                         COCNTL-OPER-UNT-ID       07310000
073200     PERFORM 7000-GET-DC-LOCATION.                                07320000
073300     PERFORM 7100-CHECK-IF-DC.                                    07330000
073400                                                                  07340000
073500     MOVE PC033-NBR-LABELS-REQUESTED  TO PC140-SML-TOT-CART       07350000
073600     PERFORM 3010-GET-MANIFEST-NBRS                               07360000
073700                                                                  07370000
073800     MOVE 'FT-'                       TO PC140-SML-TYPE           07380000
073900     MOVE PC033-SML-PRTR-ID           TO PC140-SML-PRTR-ID        07390000
074000     PERFORM 7050-GET-STORE-NAME                                  07400000
074100                                                                  07410000
074200     MOVE XLT00010-LOC-10-ABBR-NM     TO PC140-SML-STR-NAME       07420000
074300     MOVE PC187-START-MFST-NBR        TO PC140-SML-STRT-MFST-NBR  07430000
074400     MOVE PC033-OPER-UNT-ID           TO PC140-SML-ORIGIN-DC      07440000
074500     MOVE ZERO                        TO PC140-SML-DIVERT-PFX.    07450000
074600     MOVE COCNTL-SSCC-18-IND          TO PC140-CRA-DC-SSCC-18-IND 07460000
074700                                                                  07470000
074800                                                                  07480000
074900     MOVE PC033-STR-NBR               TO PC140-CRA-LOC-ID         07490000
075000                                                                  07500000
075100     MOVE PC033-STR-NBR               TO PV-STORE-NUMBER-N        07510000
075200     MOVE PV-STORE-NUMBER             TO PC140-SML-STR-NBR        07520000
075300                                                                  07530000
075400     INITIALIZE PC140-SML-ZNE-LINE-1                              07540000
075500                PC140-SML-ZNE-LINE-2                              07550000
075600                PC140-SML-ZNE-LINE-3.                             07560000
075700     MOVE '* FAST TRANSFER *'         TO PC140-SML-ZNE-LINE-1.    07570000
075800     MOVE PC033-FR-STR-NBR            TO PC037-XFER-FROM-STORE-NBR07580000
075900                                         PV-FAST-STORE            07590000
076000     MOVE PC033-XFER-SEQ-NBR          TO PC037-XFER-SEQ-NBR       07600000
076100                                         PV-FAST-SEQ              07610000
076200     PERFORM P0300-GET-CHK-DIGIT                                  07620000
076300                                                                  07630000
076400     MOVE PC037-FAST-CHECK-DIGIT      TO PV-FAST-CHK-DIGIT        07640000
076500     IF PC033-FR-STR-NBR = ZERO                                   07650000
076600                AND PC033-XFER-SEQ-NBR = ZERO                     07660000
076700         MOVE 'UNKNOWN'               TO PC140-SML-ZNE-LINE-2     07670000
076800     ELSE                                                         07680000
076900         MOVE PV-FAST-NBR             TO PC140-SML-ZNE-LINE-2     07690000
077000     END-IF                                                       07700000
077100                                                                  07710000
077200     PERFORM 6100-LINK-SOCKET-PRINT-ROUTINE.                      07720000
077300                                                                  07730000
077400 3010-GET-MANIFEST-NBRS.                                          07740000
077500                                                                  07750000
077600     MOVE PC033-STR-NBR               TO PC187-STR-NBR            07760000
077700     MOVE PC033-NBR-LABELS-REQUESTED  TO PC187-NO-OF-LBLS         07770000
077800                                                                  07780000
077900     PERFORM 6000-LINK-PCKCS721.                                  07790000
078000                                                                  07800000
078100     MOVE ZERO                        TO                          07810000
078200                              PC160-20-SML-CONTAINER-CDE          07820000
078300     MOVE 1                           TO                          07830000
078400                              PC160-20-SML-SOFTWARE-SRC           07840000
078500     MOVE 4                           TO                          07850000
078600                              PC160-20-SML-PACKAGING-TYP          07860000
078700     MOVE ZERO                        TO                          07870000
078800                              PC160-20-SML-BC-DIVERT-PFX          07880000
078900     MOVE PC033-STR-NBR               TO                          07890000
079000                              PC160-20-SML-BC-DIVERT-CDE          07900000
079100     MOVE PC033-OPER-UNT-ID           TO                          07910000
079200                              PC160-20-SML-BC-DC-ORIGIN           07920000
079300     MOVE PC187-START-MFST-NBR        TO                          07930000
079400                              PC160-20-SML-BC-MNFST-NBR           07940000
079500                                                                  07950000
079600     MOVE PC160-20-DIGIT-BARCODE (3:18)                           07960000
079700                                      TO PV-BARCODE-18.           07970000
079800     MOVE PV-BARCODE-18               TO PC033-CARTON             07980000
079900                                         PC033-FIRST-CARTON.      07990000
080000     MOVE SPACES                      TO PC033-BRCDE-NBR.         08000000
080100     MOVE PC160-20-DIGIT-BARCODE (1:20)                           08010000
080200                                      TO PC033-BRCDE-NBR.         08020000
080300     COMPUTE PC033-LAST-CARTON =                                  08030000
080400          ( ( PC033-NBR-LABELS-REQUESTED +                        08040000
080500                       PC033-CARTON ) - 1 ).                      08050000
080600/                                                                 08060000
080700     COPY PCPD037.                                                08070000
080800/                                                                 08080000
080900 4100-SHIP-UNITS.                                                 08090000
081000     CONTINUE.                                                    08100000
081100 4200-UPDATE-SHIP-UNITS.                                          08110000
081200     CONTINUE.                                                    08120000
081300 4300-INSERT-DUMMY-SHIP-UNITS.                                    08130000
081400     PERFORM 7200-INSERT-OTBND-CART                               08140000
081500     PERFORM 7350-INSERT-OTBND-LOC                                08150000
081600     MOVE ZERO                        TO SUT00028-TRN-NBR         08160000
081700                                         TFITEM-KOHLS-UPC-NBR     08170000
081800                                         SUT00028-SHPD-UNT-QTY    08180000
081900     PERFORM 7250-INSERT-OTBND-UPC.                               08190000
082000 4000-ADD-FAST-TO-CARTON.                                         08200000
082100                                                                  08210000
082200     IF PC033-FR-STR-NBR = ZERO AND PC033-XFER-SEQ-NBR = ZERO     08220000
082300         MOVE ZERO                    TO SUT00028-TRN-NBR         08230000
082400                                         TFITEM-XFER-LNE-NBR      08240000
082500                                         TFITEM-KOHLS-UPC-NBR     08250000
082600                                         SUT00028-SHPD-UNT-QTY    08260000
082700         PERFORM 7250-INSERT-OTBND-UPC                            08270000
082800     ELSE                                                         08280000
082900         PERFORM 7300-OPEN-FAST-ITEM-CSR                          08290000
083000         PERFORM 7310-FETCH-FAST-ITEM-CSR                         08300000
083100                                                                  08310000
083200         PERFORM UNTIL PS-END-FAST-ITEM-CSR                       08320000
083300             MOVE  PC033-FR-STR-NBR   TO  PV-TRN-STORE            08330000
083400             MOVE  PC033-XFER-SEQ-NBR TO  PV-TRN-SEQUENCE         08340000
083500             MOVE  PV-TRN-NBR         TO  PV-TRN-NBR-COMP         08350000
083600             MOVE  PV-TRN-NBR-COMP    TO  SUT00028-TRN-NBR        08360000
083700             MOVE  TFITEM-XFER-QTY    TO  SUT00028-SHPD-UNT-QTY   08370000
083800             PERFORM 7250-INSERT-OTBND-UPC                        08380000
083900             PERFORM 7310-FETCH-FAST-ITEM-CSR                     08390000
084000         END-PERFORM                                              08400000
084100         PERFORM 7320-CLOSE-FAST-ITEM-CSR                         08410000
084200     END-IF.                                                      08420000
084300/                                                                 08430000
084400 6000-LINK-PCKCS721.                                              08440000
084500                                                                  08450000
084600     MOVE LENGTH OF PC187-COMMAREA-REC  TO  PV-COMMAREA-LENGTH.   08460000
084700                                                                  08470000
084800     EXEC CICS                                                    08480000
084900         LINK PROGRAM  (PC-PCKCS721)                              08490000
085000              COMMAREA (PC187-COMMAREA-REC)                       08500000
085100              LENGTH   (PV-COMMAREA-LENGTH)                       08510000
085200              RESP     (PV-CICS-RESPONSE)                         08520000
085300     END-EXEC.                                                    08530000
085400                                                                  08540000
085500     EVALUATE TRUE                                                08550000
085600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 08560000
085700              IF  PC187-CRA-SUCCESSFUL                            08570000
085800                  CONTINUE                                        08580000
085900              ELSE                                                08590000
086000                  SET PC140-CRA-SOCKET-COMM-ERROR TO TRUE         08600000
086100*                 MOVE SQLCODE              TO PV-SQL-CODE        08610000
086200*                 STRING ' PCKCS707 - '        DELIMITED BY SIZE  08620000
086300*                        '6000-LINK-PCKCS721 ' DELIMITED BY SIZE  08630000
086400*                        ' RETURN MESSAGE - '  DELIMITED BY SIZE  08640000
086500*                        PC187-CRA-RET-MSG     DELIMITED BY SIZE  08650000
086600*                        '  PARA-'             DELIMITED BY SIZE  08660000
086700*                        PC187-CRA-REQ-ID      DELIMITED BY SIZE  08670000
086800*                                         INTO PV-CICS-MSG-AREA   08680000
086900*                 MOVE LENGTH OF PV-CICS-MSG-AREA                 08690000
087000*                                           TO PV-COMMAREA-LENGTH 08700000
087100*                 PERFORM 9990-WRITE-CICS                         08710000
087200              END-IF                                              08720000
087300         WHEN OTHER                                               08730000
087400              SET PC140-CRA-SOCKET-COMM-ERROR TO TRUE             08740000
087500*             MOVE SQLCODE              TO PV-SQL-CODE            08750000
087600*             STRING ' PCKCS707 (OTHER) -' DELIMITED BY SIZE      08760000
087700*                    '6000-LINK-PCKCS721 ' DELIMITED BY SIZE      08770000
087800*                    ' RETURN MESSAGE - '  DELIMITED BY SIZE      08780000
087900*                    PC187-CRA-RET-MSG     DELIMITED BY SIZE      08790000
088000*                    '  PARA-'             DELIMITED BY SIZE      08800000
088100*                    PC187-CRA-REQ-ID      DELIMITED BY SIZE      08810000
088200*                                     INTO PV-CICS-MSG-AREA       08820000
088300*             MOVE LENGTH OF PV-CICS-MSG-AREA                     08830000
088400*                                       TO PV-COMMAREA-LENGTH     08840000
088500*             PERFORM 9990-WRITE-CICS                             08850000
088600     END-EVALUATE.                                                08860000
088700/                                                                 08870000
088800 6100-LINK-SOCKET-PRINT-ROUTINE.                                  08880000
088900                                                                  08890000
089000     MOVE PC033-USER-ID               TO PC140-CRA-USERID.        08900000
089100     MOVE LENGTH OF PC140-LABELMST    TO PV-COMMAREA-LENGTH.      08910000
089200                                                                  08920000
089300     EXEC CICS                                                    08930000
089400          LINK PROGRAM  ('PCKCS707')                              08940000
089500               COMMAREA (PC140-LABELMST)                          08950000
089600               LENGTH   (PV-COMMAREA-LENGTH)                      08960000
089700               RESP     (PV-CICS-RESPONSE)                        08970000
089800     END-EXEC.                                                    08980000
089900                                                                  08990000
090000     EVALUATE TRUE                                                09000000
090100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 09010000
090200              CONTINUE                                            09020000
090300         WHEN OTHER                                               09030000
090400             PERFORM DP014-0000-PROCESS-ABEND                     09040000
090500     END-EVALUATE.                                                09050000
090600                                                                  09060000
090700     EVALUATE TRUE                                                09070000
090800     WHEN PC140-CRA-SOCKET-COMM-ERROR                             09080000
090900         SET PS-ERRORS-YES            TO TRUE                     09090000
091000         MOVE '*** COMM ERROR *** '   TO AMSGLNO                  09100000
091100*LABEL REQUEST FAILED DUE TO COMMUNICATION ERROR - CALL HELP DESK 09110000
091200     WHEN PC140-CRA-INVALID-PRT-FMT                               09120000
091300         MOVE PC140-CRA-RET-CDE       TO PM-RET-CDE               09130000
091400         MOVE PC140-CRA-RET-MSG       TO PM-RET-MSG               09140000
091500         MOVE 'INVALID PRT FORMAT'    TO AMSGLNO                  09150000
091600     WHEN OTHER                                                   09160000
091700         SET PC033-LABEL-PRINT-COMPLETED                          09170000
091800                                      TO TRUE                     09180000
091900*       PRINT REQUEST HAS BEEN SUBMITTED                          09190000
092000     END-EVALUATE.                                                09200000
092100/                                                                 09210000
092200 7000-GET-DC-LOCATION.                                            09220000
092300     EXEC SQL                                                     09230000
092400          SELECT LOC_5_ABBR_NM                                    09240000
092500          INTO  :PV-DC-5-CHAR-ABBR                                09250000
092600          FROM   XLT_LOC                                          09260000
092700          WHERE  LOC_TYP_CDE = 'DC'                               09270000
092800          AND    LOC_NBR   = :XLT00010-LOC-NBR                    09280000
092900     END-EXEC.                                                    09290000
093000                                                                  09300000
093100     EVALUATE TRUE                                                09310000
093200         WHEN SQLCODE = ZERO                                      09320000
093300              MOVE  PV-2-DIGIT-DC-ABBR                            09330000
093400                                      TO PC140-CRA-DC-ID          09340000
093500              MOVE  XLT00010-LOC-NBR  TO PC140-CRA-OPER-UNT-ID    09350000
093600                                                                  09360000
093700         WHEN SQLCODE = +100                                      09370000
093800              MOVE  '90'              TO PC140-CRA-DC-ID          09380000
093900                                         PC140-CRA-OPER-UNT-ID    09390000
094000                                                                  09400000
094100         WHEN SQLWARN0 NOT = SPACES                               09410000
094200         WHEN SQLCODE NOT EQUAL ZERO                              09420000
094300             MOVE '7000-GET-DC-LOCATION'                          09430000
094400                             TO PC033-PARAGRAPH                   09440000
094500             MOVE 'PCKRF854 - GET DC LOCATION CODE'               09450000
094600                             TO PC033-MESSAGE-TEXT(1)             09460000
094700             MOVE PC140-CRA-DC-ID                                 09470000
094800                             TO PC033-MESSAGE-TEXT(2)             09480000
094900             MOVE SQLCA      TO PC033-SQLCA                       09490000
095000             MOVE 'XLT_LOC'  TO PC033-DB2-TABLE-NAME(1)           09500000
095100             SET PC033-ABEND          TO TRUE                     09510000
095200             MOVE 99                  TO PC033-PGM-MSG-NBR        09520000
095300             PERFORM 8210-XCTL-ERROR-SCREEN                       09530000
095400     END-EVALUATE.                                                09540000
095500                                                                  09550000
095600 7050-GET-STORE-NAME.                                             09560000
095700     EXEC SQL                                                     09570000
095800             SELECT LOC_10_ABBR_NM                                09580000
095900             INTO  :XLT00010-LOC-10-ABBR-NM                       09590000
096000             FROM   XLT_LOC                                       09600000
096100             WHERE  LOC_NBR = :PC033-STR-NBR                      09610000
096200             AND    LOC_TYP_CDE IN ('DS', 'DC', 'CS', 'RV')       09620000
096300     END-EXEC                                                     09630000
096400                                                                  09640000
096500                                                                  09650000
096600         EVALUATE TRUE                                            09660000
096700             WHEN SQLCODE = ZERO                                  09670000
096800             WHEN SQLCODE = +100                                  09680000
096900             WHEN SQLCODE = -904                                  09690000
097000             WHEN SQLCODE = -913                                  09700000
097100                 CONTINUE                                         09710000
097200             WHEN SQLWARN0 NOT = SPACES                           09720000
097300             WHEN SQLCODE < ZERO                                  09730000
097400             WHEN SQLCODE > ZERO                                  09740000
097500                 MOVE '2240-GET-STORE-NAME'                       09750000
097600                                 TO PC033-PARAGRAPH               09760000
097700                 MOVE 'SELECT STORE NAME'                         09770000
097800                                 TO PC033-MESSAGE-TEXT (1)        09780000
097900                 MOVE SQLCA      TO PC033-SQLCA                   09790000
098000                 MOVE 'XLT_LOC'  TO PC033-DB2-TABLE-NAME (1)      09800000
098100                 SET PC033-ABEND      TO TRUE                     09810000
098200                 MOVE 99              TO PC033-PGM-MSG-NBR        09820000
098300                 PERFORM 8210-XCTL-ERROR-SCREEN                   09830000
098400     END-EVALUATE.                                                09840000
098500/                                                                 09850000
098600 7100-CHECK-IF-DC.                                                09860000
098700                                                                  09870000
098800     EXEC SQL                                                     09880000
098900          SELECT  SSCC_18_IND                                     09890000
099000            INTO :COCNTL-SSCC-18-IND                              09900000
099100            FROM  TCOCNTL                                         09910000
099200           WHERE  OPER_UNT_ID = :COCNTL-OPER-UNT-ID               09920000
099300     END-EXEC.                                                    09930000
099400                                                                  09940000
099500     EVALUATE TRUE                                                09950000
099600         WHEN SQLCODE = ZERO                                      09960000
099700              CONTINUE                                            09970000
099800         WHEN SQLCODE = +100                                      09980000
099900              SET PS-ERRORS-YES       TO TRUE                     09990000
100000*INVALID DISTRIBUTION CENTER                                      10000000
100100         WHEN SQLWARN0 NOT = SPACES                               10010000
100200         WHEN SQLCODE < +0                                        10020000
100300         WHEN SQLCODE > +0                                        10030000
100400              MOVE '7100-CHECK-IF-DC'                             10040000
100500                                      TO PC033-PARAGRAPH          10050000
100600              MOVE 'CHECK IF OPER UNIT IS FOR DC'                 10060000
100700                                      TO PC033-MESSAGE-TEXT (1)   10070000
100800              MOVE SQLCA              TO PC033-SQLCA              10080000
100900              MOVE 'TCOCNTL'          TO PC033-DB2-TABLE-NAME (1) 10090000
101000              SET PC033-ABEND         TO TRUE                     10100000
101100              MOVE 99                 TO PC033-PGM-MSG-NBR        10110000
101200              PERFORM 8210-XCTL-ERROR-SCREEN                      10120000
101300     END-EVALUATE.                                                10130000
101400/                                                                 10140000
101500 7200-INSERT-OTBND-CART.                                          10150000
101600     EXEC SQL                                                     10160000
101700         INSERT INTO SUT_OTBND_CART                               10170000
101800             (SHIPT_UNT_ID                                        10180000
101900         ,    ORGN_LOC_NBR                                        10190000
102000         ,    DEST_LOC_NBR                                        10200000
102100         ,    CART_SRC_CDE                                        10210000
102200         ,    MSTR_CART_IND                                       10220000
102300         ,    PRNT_CART_ID                                        10230000
102400         ,    ORIG_CART_ID                                        10240000
102500         ,    ACTV_IND                                            10250000
102600         ,    CRE_DTE                                             10260000
102700         ,    CRE_TM                                              10270000
102800         ,    CRE_USR_ID                                          10280000
102900         ,    CRE_PGM_NM                                          10290000
103000         ,    CART_RVSN_NBR                                       10300000
103100         ,    CART_TYP_CDE                                        10310000
103200         )                                                        10320000
103300             VALUES                                               10330000
103400            (:PC033-CARTON                                        10340000
103500         ,   :PC033-OPER-UNT-ID                                   10350000
103600         ,   :PC033-STR-NBR                                       10360000
103700         ,   'FXR'                                                10370000
103800         ,   'N'                                                  10380000
103900         ,   :PC033-CARTON                                        10390000
104000         ,   0                                                    10400000
104100         ,   'Y'                                                  10410000
104200         ,   CURRENT DATE                                         10420000
104300         ,   CURRENT TIME                                         10430000
104400         ,   :PC033-USER-ID                                       10440000
104500         ,   'PCKRF854'                                           10450000
104600         ,   0                                                    10460000
104700         ,   'S'                                                  10470000
104800         )                                                        10480000
104900         END-EXEC                                                 10490000
105000                                                                  10500000
105100         EVALUATE TRUE                                            10510000
105200             WHEN SQLCODE = ZERO                                  10520000
105300             WHEN SQLCODE = -803                                  10530000
105400             WHEN SQLCODE = -904                                  10540000
105500             WHEN SQLCODE = -913                                  10550000
105600             WHEN SQLCODE = -911                                  10560000
105700                 CONTINUE                                         10570000
105800             WHEN SQLWARN0 NOT = SPACES                           10580000
105900             WHEN SQLCODE < ZERO                                  10590000
106000             WHEN SQLCODE > ZERO                                  10600000
106100                 MOVE '7200-INSERT-OTBND-CART'                    10610000
106200                                 TO PC033-PARAGRAPH               10620000
106300                 MOVE 'PCKRF854 - INSERT SUT_OTBND_CART'          10630000
106400                                 TO PC033-MESSAGE-TEXT (1)        10640000
106500                 MOVE SQLCA      TO PC033-SQLCA                   10650000
106600                 MOVE 'SUT00024' TO PC033-DB2-TABLE-NAME (1)      10660000
106700                 SET PC033-ABEND         TO TRUE                  10670000
106800                 MOVE 99              TO PC033-PGM-MSG-NBR        10680000
106900                 PERFORM 8210-XCTL-ERROR-SCREEN                   10690000
107000     END-EVALUATE.                                                10700000
107100/                                                                 10710000
107200 7250-INSERT-OTBND-UPC.                                           10720000
107300     EXEC SQL                                                     10730000
107400         INSERT INTO SUT_OTBND_UPC                                10740000
107500             (                                                    10750000
107600                 SHIPT_UNT_ID                                     10760000
107700             ,   TRN_NBR                                          10770000
107800             ,   TRN_LNE_NBR                                      10780000
107900             ,   TRN_TYP_CDE                                      10790000
108000             ,   UPC_NBR                                          10800000
108100             ,   SHPD_UNT_QTY                                     10810000
108200             ,   RCVR_SEQ_NBR                                     10820000
108300             )                                                    10830000
108400             VALUES                                               10840000
108500             (                                                    10850000
108600                 :PC033-CARTON                                    10860000
108700             ,   :SUT00028-TRN-NBR                                10870000
108800             ,   :TFITEM-XFER-LNE-NBR                             10880000
108900             ,   'FX'                                             10890000
109000             ,   :TFITEM-KOHLS-UPC-NBR                            10900000
109100             ,   :SUT00028-SHPD-UNT-QTY                           10910000
109200             ,   0                                                10920000
109300             )                                                    10930000
109400         END-EXEC                                                 10940000
109500                                                                  10950000
109600                                                                  10960000
109700     EVALUATE TRUE                                                10970000
109800         WHEN SQLCODE = ZERO                                      10980000
109900             CONTINUE                                             10990000
110000         WHEN SQLCODE = -803                                      11000000
110100             SET PS-ERRORS-YES        TO TRUE                     11010000
110200             MOVE DP015-UNP-ALP-NOR-MDT                           11020000
110300                                      TO AFASTA                   11030000
110400             MOVE -1              TO AFASTL                       11040000
110500             MOVE 'DUP FAST NBR IN CTN '                          11050000
110600                                      TO AMSGLNO                  11060000
110700         WHEN SQLCODE = -904                                      11070000
110800         WHEN SQLCODE = -913                                      11080000
110900         WHEN SQLCODE = -911                                      11090000
111000             MOVE 1                   TO PV-ERROR-NBR             11100000
111100             PERFORM 9903-WRITE-CICS-LOG                          11110000
111200             PERFORM 9000-SOFT-ABORT                              11120000
111300         WHEN SQLWARN0 NOT = SPACES                               11130000
111400         WHEN SQLCODE NOT EQUAL ZERO                              11140000
111500             MOVE 2                   TO PV-ERROR-NBR             11150000
111600                                         PC033-ERROR-NBR          11160000
111700             PERFORM 9903-WRITE-CICS-LOG                          11170000
111800             MOVE '7150-INSERT-OTBND-UPC'                         11180000
111900                                      TO PC033-PARAGRAPH          11190000
112000             MOVE 'PCKRF854 - INSERT SUT_OTBND_UPC'               11200000
112100                                      TO PC033-MESSAGE-TEXT(1)    11210000
112200*            MOVE DK-TRN-NBR          TO PC033-MESSAGE-TEXT(2)    11220000
112300             MOVE SQLCA               TO PC033-SQLCA              11230000
112400             MOVE 'SUT00028'          TO PC033-DB2-TABLE-NAME(1)  11240000
112500             SET PC033-ABEND          TO TRUE                     11250000
112600             MOVE 99                  TO PC033-PGM-MSG-NBR        11260000
112700             PERFORM 8210-XCTL-ERROR-SCREEN                       11270000
112800     END-EVALUATE.                                                11280000
112900/                                                                 11290000
113000 7300-OPEN-FAST-ITEM-CSR.                                         11300000
113100     EXEC SQL                                                     11310000
113200         OPEN FAST-ITEM-CSR                                       11320000
113300     END-EXEC                                                     11330000
113400                                                                  11340000
113500     EVALUATE TRUE                                                11350000
113600         WHEN SQLCODE = ZERO                                      11360000
113700             SET PS-START-FAST-ITEM-CSR                           11370000
113800                                      TO TRUE                     11380000
113900         WHEN SQLCODE = -904                                      11390000
114000         WHEN SQLCODE = -913                                      11400000
114100         WHEN SQLCODE = -911                                      11410000
114200             MOVE 3                   TO PV-ERROR-NBR             11420000
114300             PERFORM 9903-WRITE-CICS-LOG                          11430000
114400             PERFORM 9000-SOFT-ABORT                              11440000
114500         WHEN SQLWARN0 NOT = SPACES                               11450000
114600         WHEN SQLCODE NOT EQUAL ZERO                              11460000
114700             MOVE 4                   TO PV-ERROR-NBR             11470000
114800                                         PC033-ERROR-NBR          11480000
114900             PERFORM 9903-WRITE-CICS-LOG                          11490000
115000             MOVE '7300-OPEN-FAST-ITEM-CSR'                       11500000
115100                                      TO PC033-PARAGRAPH          11510000
115200             MOVE 'PCKRF854 - OPEN FAST ITEM CSR'                 11520000
115300                                      TO PC033-MESSAGE-TEXT(1)    11530000
115400             MOVE SQLCA               TO PC033-SQLCA              11540000
115500             MOVE 'TTFITEM'           TO PC033-DB2-TABLE-NAME(1)  11550000
115600             SET PC033-ABEND          TO TRUE                     11560000
115700             MOVE 99                  TO PC033-PGM-MSG-NBR        11570000
115800             PERFORM 8210-XCTL-ERROR-SCREEN                       11580000
115900     END-EVALUATE.                                                11590000
116000                                                                  11600000
116100 7310-FETCH-FAST-ITEM-CSR.                                        11610000
116200                                                                  11620000
116300     EXEC SQL                                                     11630000
116400     FETCH FAST-ITEM-CSR                                          11640000
116500     INTO                                                         11650000
116600         :TFITEM-XFER-LNE-NBR                                     11660000
116700      ,  :TFITEM-KOHLS-UPC-NBR                                    11670000
116800      ,  :TFITEM-XFER-QTY                                         11680000
116900     END-EXEC.                                                    11690000
117000                                                                  11700000
117100     EVALUATE TRUE                                                11710000
117200         WHEN SQLCODE = ZERO                                      11720000
117300             CONTINUE                                             11730000
117400         WHEN SQLCODE = +100                                      11740000
117500             SET PS-END-FAST-ITEM-CSR TO TRUE                     11750000
117600         WHEN SQLCODE = -904                                      11760000
117700         WHEN SQLCODE = -913                                      11770000
117800         WHEN SQLCODE = -911                                      11780000
117900             MOVE 5                   TO PV-ERROR-NBR             11790000
118000             PERFORM 9903-WRITE-CICS-LOG                          11800000
118100             PERFORM 9000-SOFT-ABORT                              11810000
118200         WHEN SQLWARN0 NOT = SPACES                               11820000
118300         WHEN SQLCODE NOT EQUAL ZERO                              11830000
118400             MOVE 6                   TO PV-ERROR-NBR             11840000
118500                                         PC033-ERROR-NBR          11850000
118600             PERFORM 9903-WRITE-CICS-LOG                          11860000
118700             MOVE '7310-FETCH-FAST-ITEM-CSR'                      11870000
118800                                      TO PC033-PARAGRAPH          11880000
118900             MOVE 'PCKRF854 - OPEN FAST ITEM CSR'                 11890000
119000                                      TO PC033-MESSAGE-TEXT(1)    11900000
119100             MOVE SQLCA               TO PC033-SQLCA              11910000
119200             MOVE 'TTFITEM'           TO PC033-DB2-TABLE-NAME(1)  11920000
119300             SET PC033-ABEND          TO TRUE                     11930000
119400             MOVE 99                  TO PC033-PGM-MSG-NBR        11940000
119500             PERFORM 8210-XCTL-ERROR-SCREEN                       11950000
119600     END-EVALUATE.                                                11960000
119700                                                                  11970000
119800 7320-CLOSE-FAST-ITEM-CSR.                                        11980000
119900     EXEC SQL                                                     11990000
120000         CLOSE FAST-ITEM-CSR                                      12000000
120100     END-EXEC                                                     12010000
120200                                                                  12020000
120300     EVALUATE TRUE                                                12030000
120400         WHEN SQLCODE = ZERO                                      12040000
120500             CONTINUE                                             12050000
120600         WHEN SQLCODE = -904                                      12060000
120700         WHEN SQLCODE = -913                                      12070000
120800         WHEN SQLCODE = -911                                      12080000
120900             MOVE 7                   TO PV-ERROR-NBR             12090000
121000             PERFORM 9903-WRITE-CICS-LOG                          12100000
121100             PERFORM 9000-SOFT-ABORT                              12110000
121200         WHEN SQLWARN0 NOT = SPACES                               12120000
121300         WHEN SQLCODE NOT EQUAL ZERO                              12130000
121400             MOVE 8                   TO PV-ERROR-NBR             12140000
121500                                         PC033-ERROR-NBR          12150000
121600             PERFORM 9903-WRITE-CICS-LOG                          12160000
121700             MOVE '7320-CLOSE-FAST-ITEM-CSR'                      12170000
121800                                      TO PC033-PARAGRAPH          12180000
121900             MOVE 'PCKRF854 - CLOSE FAST ITEM CSR'                12190000
122000                                      TO PC033-MESSAGE-TEXT(1)    12200000
122100             MOVE SQLCA               TO PC033-SQLCA              12210000
122200             MOVE 'TTFITEM'           TO PC033-DB2-TABLE-NAME(1)  12220000
122300             SET PC033-ABEND          TO TRUE                     12230000
122400             MOVE 99                  TO PC033-PGM-MSG-NBR        12240000
122500             PERFORM 8210-XCTL-ERROR-SCREEN                       12250000
122600     END-EVALUATE.                                                12260000
122700/                                                                 12270000
122800 7350-INSERT-OTBND-LOC.                                           12280000
122900                                                                  12290000
123000     EXEC SQL                                                     12300000
123100         INSERT INTO SUT_OTBND_LOC                                12310000
123200         (                                                        12320000
123300              SHIPT_UNT_ID                                        12330000
123400              , LOC_NBR                                           12340000
123500              , SCN_CDE                                           12350000
123600              , CRE_USR_ID                                        12360000
123700              , CRE_TMST                                          12370000
123800              , INBD_TRIP_ID                                      12380000
123900         )                                                        12390000
124000         VALUES                                                   12400000
124100         (                                                        12410000
124200                 :PC033-CARTON                                    12420000
124300               , :PC033-OPER-UNT-ID                               12430000
124400               , 'USED'                                           12440000
124500               , :PC033-USER-ID                                   12450000
124600               , CURRENT TIMESTAMP                                12460000
124700               , 0                                                12470000
124800           )                                                      12480000
124900     END-EXEC.                                                    12490000
125000                                                                  12500000
125100     EVALUATE TRUE                                                12510000
125200         WHEN SQLCODE = ZERO                                      12520000
125300             CONTINUE                                             12530000
125400         WHEN SQLCODE = -904                                      12540000
125500         WHEN SQLCODE = -913                                      12550000
125600         WHEN SQLCODE = -911                                      12560000
125700             MOVE 9                   TO PV-ERROR-NBR             12570000
125800             PERFORM 9903-WRITE-CICS-LOG                          12580000
125900             PERFORM 9000-SOFT-ABORT                              12590000
126000         WHEN SQLWARN0 NOT = SPACES                               12600000
126100         WHEN SQLCODE NOT EQUAL ZERO                              12610000
126200             MOVE 10                  TO PV-ERROR-NBR             12620000
126300                                         PC033-ERROR-NBR          12630000
126400             PERFORM 9903-WRITE-CICS-LOG                          12640000
126500             MOVE '7350-INSERT-OTBND-LOC'                         12650000
126600                                      TO PC033-PARAGRAPH          12660000
126700             MOVE 'PCKRF854 - INSERT SUT_OTBND_LOC'               12670000
126800                                      TO PC033-MESSAGE-TEXT(1)    12680000
126900             MOVE SQLCA               TO PC033-SQLCA              12690000
127000             MOVE 'SUT00027'          TO PC033-DB2-TABLE-NAME(1)  12700000
127100             SET PC033-ABEND          TO TRUE                     12710000
127200             MOVE 99                  TO PC033-PGM-MSG-NBR        12720000
127300             PERFORM 8210-XCTL-ERROR-SCREEN                       12730000
127400     END-EVALUATE.                                                12740000
127500/                                                                 12750000
127600 7400-VALIDATE-STORE-NBR.                                         12760000
127700                                                                  12770000
127800     EXEC SQL                                                     12780000
127900          SELECT  MFST_NBR                                        12790000
128000          INTO    :DCSTMF-MFST-NBR                                12800000
128100          FROM    TDCSTMF                                         12810000
128200        WHERE STR_NBR = :PV-STORE-NBR                             12820000
128300     END-EXEC.                                                    12830000
128400                                                                  12840000
128500     EVALUATE TRUE                                                12850000
128600         WHEN SQLCODE = ZERO                                      12860000
128700             CONTINUE                                             12870000
128800         WHEN SQLCODE = -904                                      12880000
128900         WHEN SQLCODE = -913                                      12890000
129000         WHEN SQLCODE = -911                                      12900000
129100             MOVE 11                  TO PV-ERROR-NBR             12910000
129200             PERFORM 9903-WRITE-CICS-LOG                          12920000
129300             PERFORM 9000-SOFT-ABORT                              12930000
129400         WHEN SQLWARN0 NOT = SPACES                               12940000
129500         WHEN SQLCODE NOT EQUAL ZERO                              12950000
129600             SET PS-INVALID-STORE-NBR TO TRUE                     12960000
129700     END-EVALUATE.                                                12970000
129800/                                                                 12980000
129900 8000-SEND-MAP.                                                   12990000
130000                                                                  13000000
130100     EXEC CICS                                                    13010000
130200         SEND MAP       ('PC854A')                                13020000
130300              MAPSET    ('PCKM854')                               13030000
130400              ERASE                                               13040000
130500              CURSOR                                              13050000
130600              RESP      (PV-CICS-RESPONSE)                        13060000
130700     END-EXEC.                                                    13070000
130800                                                                  13080000
130900     EVALUATE TRUE                                                13090000
131000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 13100000
131100             CONTINUE                                             13110000
131200         WHEN OTHER                                               13120000
131300             MOVE '8000-SEND-MAP'     TO DP013-PARAGRAPH          13130000
131400             MOVE 'PCKRF854 - UNABLE TO SEND MAP'                 13140000
131500                                      TO DP013-MESSAGE-TEXT (1)   13150000
131600             SET DP013-CICS-ABEND                                 13160000
131700                 DP013-ROLLBACK       TO TRUE                     13170000
131800             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               13180000
131900     END-EVALUATE.                                                13190000
132000                                                                  13200000
132100 8010-SEND-DATA-ONLY.                                             13210000
132200                                                                  13220000
132300     EXEC CICS                                                    13230000
132400         SEND MAP       ('PC854A')                                13240000
132500              MAPSET    ('PCKM854')                               13250000
132600              CURSOR                                              13260000
132700              DATAONLY                                            13270000
132800              RESP      (PV-CICS-RESPONSE)                        13280000
132900     END-EXEC.                                                    13290000
133000                                                                  13300000
133100     EVALUATE TRUE                                                13310000
133200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 13320000
133300             CONTINUE                                             13330000
133400         WHEN OTHER                                               13340000
133500             MOVE '8010-SEND-DATA-ONLY'                           13350000
133600                                      TO DP013-PARAGRAPH          13360000
133700             MOVE 'PCKRF854 - UNABLE TO SEND DATA'                13370000
133800                                      TO DP013-MESSAGE-TEXT (1)   13380000
133900             SET DP013-CICS-ABEND                                 13390000
134000                 DP013-ROLLBACK       TO TRUE                     13400000
134100             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               13410000
134200     END-EVALUATE.                                                13420000
134300                                                                  13430000
134400 8020-RECEIVE-MAP.                                                13440000
134500                                                                  13450000
134600     EXEC CICS                                                    13460000
134700         RECEIVE MAP    ('PC854A')                                13470000
134800                 MAPSET ('PCKM854')                               13480000
134900                 RESP   (PV-CICS-RESPONSE)                        13490000
135000     END-EXEC.                                                    13500000
135100                                                                  13510000
135200     EVALUATE TRUE                                                13520000
135300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 13530000
135400             CONTINUE                                             13540000
135500         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                13550000
135600             CONTINUE                                             13560000
135700         WHEN OTHER                                               13570000
135800            MOVE '8020-RECEIVE-MAP'      TO DP013-PARAGRAPH       13580000
135900            MOVE 'PCKRF854 - UNABLE TO RECEIVE MAP'               13590000
136000                                         TO DP013-MESSAGE-TEXT (1)13600000
136100            SET DP013-LOGIC-ABEND        TO TRUE                  13610000
136200            SET DP013-ROLLBACK           TO TRUE                  13620000
136300            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                13630000
136400     END-EVALUATE.                                                13640000
136500                                                                  13650000
136600 8100-RETURN-TRANID.                                              13660000
136700                                                                  13670000
136800     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       13680000
136900     EXEC CICS                                                    13690000
137000         RETURN TRANSID  (PC-TRANID)                              13700000
137100                COMMAREA (CA-COMMAREA)                            13710000
137200                LENGTH   (PV-COMMAREA-LENGTH)                     13720000
137300                RESP     (PV-CICS-RESPONSE)                       13730000
137400     END-EXEC.                                                    13740000
137500                                                                  13750000
137600     EVALUATE TRUE                                                13760000
137700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 13770000
137800             CONTINUE                                             13780000
137900         WHEN OTHER                                               13790000
138000             MOVE '8100-RETURN-TRANID'  TO DP013-PARAGRAPH        13800000
138100             MOVE 'PCKRF854 - UNABLE TO RETURN TO TRANID'         13810000
138200                 TO DP013-MESSAGE-TEXT (1)                        13820000
138300             SET DP013-CICS-ABEND       TO TRUE                   13830000
138400             SET DP013-ROLLBACK         TO TRUE                   13840000
138500             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               13850000
138600     END-EVALUATE.                                                13860000
138700                                                                  13870000
138800 8110-RETURN.                                                     13880000
138900                                                                  13890000
139000     EXEC CICS                                                    13900000
139100         SEND FROM (PV-MESSAGE-AREA)                              13910000
139200              LENGTH (19)                                         13920000
139300              ERASE                                               13930000
139400     END-EXEC.                                                    13940000
139500                                                                  13950000
139600     EXEC CICS                                                    13960000
139700         RETURN                                                   13970000
139800     END-EXEC.                                                    13980000
139900                                                                  13990000
140000 8200-XCTL.                                                       14000000
140100     SET PC033-INITIALIZE-SCREEN      TO TRUE.                    14010000
140200     MOVE PC-CURRENT-PROGRAM-NAME     TO PC033-LAST-PROGRAM.      14020000
140300     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       14030000
140400                                                                  14040000
140500     EXEC CICS                                                    14050000
140600         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    14060000
140700               COMMAREA  (CA-COMMAREA)                            14070000
140800               LENGTH    (PV-COMMAREA-LENGTH)                     14080000
140900               RESP      (PV-CICS-RESPONSE)                       14090000
141000     END-EXEC.                                                    14100000
141100                                                                  14110000
141200     EVALUATE TRUE                                                14120000
141300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 14130000
141400             CONTINUE                                             14140000
141500         WHEN OTHER                                               14150000
141600             MOVE '8200-XCTL'                                     14160000
141700                                      TO DP013-PARAGRAPH          14170000
141800             MOVE 'PCKRF854 - UNABLE TO XCTL TO PROGRAM: '        14180000
141900                                      TO DP013-MESSAGE-TEXT (1)   14190000
142000             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   14200000
142100             SET DP013-CICS-ABEND                                 14210000
142200                 DP013-ROLLBACK       TO TRUE                     14220000
142300             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               14230000
142400*            MOVE PC-TRANS-UNAVAILABLE-MSG                        14240000
142500*                                     TO AMSGLNO                  14250000
142600*            MOVE -1                  TO AFASTL                   14260000
142700             SET PC033-PROCESS-SCREEN TO TRUE                     14270000
142800             PERFORM 8000-SEND-MAP                                14280000
142900             PERFORM 8100-RETURN-TRANID                           14290000
143000     END-EVALUATE.                                                14300000
143100                                                                  14310000
143200 8210-XCTL-ERROR-SCREEN.                                          14320000
143300                                                                  14330000
143400     IF NOT PC033-ABEND                                           14340000
143500         SET PC033-INITIALIZE-SCREEN  TO TRUE                     14350000
143600     END-IF                                                       14360000
143700     MOVE DFHEIBLK                    TO PC033-DFHEIBLK.          14370000
143800     MOVE PC-CURRENT-PROGRAM-NAME     TO PC033-LAST-PROGRAM.      14380000
143900     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       14390000
144000     MOVE 'PCKRF852'                  TO PV-TRANSFER-PROGRAM      14400000
144100                                                                  14410000
144200     IF PC033-PGM-MSG-NBR = ZERO                                  14420000
144300         MOVE 3                       TO PC033-PGM-MSG-NBR        14430000
144400     END-IF                                                       14440000
144500                                                                  14450000
144600     EXEC CICS                                                    14460000
144700         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    14470000
144800               COMMAREA  (CA-COMMAREA)                            14480000
144900               LENGTH    (PV-COMMAREA-LENGTH)                     14490000
145000               RESP      (PV-CICS-RESPONSE)                       14500000
145100     END-EXEC.                                                    14510000
145200                                                                  14520000
145300     EVALUATE TRUE                                                14530000
145400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 14540000
145500             CONTINUE                                             14550000
145600         WHEN OTHER                                               14560000
145700             MOVE '8200-XCTL'                                     14570000
145800                                      TO DP013-PARAGRAPH          14580000
145900             MOVE 'PCKRF854 - UNABLE TO XCTL TO PROGRAM: '        14590000
146000                                      TO DP013-MESSAGE-TEXT (1)   14600000
146100             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   14610000
146200             SET DP013-CICS-ABEND                                 14620000
146300                 DP013-ROLLBACK       TO TRUE                     14630000
146400             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               14640000
146500*            MOVE PC-TRANS-UNAVAILABLE-MSG                        14650000
146600*                                     TO AMSGLNO                  14660000
146700             SET PC033-PROCESS-SCREEN TO TRUE                     14670000
146800*            MOVE -1                  TO AFASTL                   14680000
146900             PERFORM 8000-SEND-MAP                                14690000
147000             PERFORM 8100-RETURN-TRANID                           14700000
147100     END-EVALUATE.                                                14710000
147200                                                                  14720000
147300*                                                                 14730000
147400 8220-XCTL-TO-HELP.                                               14740000
147500                                                                  14750000
147600     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH       14760000
147700                                                                  14770000
147800     EXEC CICS                                                    14780000
147900         XCTL                                                     14790000
148000             PROGRAM   (PV-TRANSFER-PROGRAM)                      14800000
148100             COMMAREA  (PC192-COMMAREA)                           14810000
148200             LENGTH    (PV-COMMAREA-LENGTH)                       14820000
148300             RESP      (PV-CICS-RESPONSE)                         14830000
148400     END-EXEC.                                                    14840000
148500                                                                  14850000
148600     EVALUATE TRUE                                                14860000
148700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 14870000
148800              CONTINUE                                            14880000
148900         WHEN OTHER                                               14890000
149000             MOVE '8220-XCTL-TO-HELP' TO DP013-PARAGRAPH          14900000
149100             MOVE 'PCKRF854 - UNABLE TO XCTL TO PROGRAM: '        14910000
149200                                      TO DP013-MESSAGE-TEXT (1)   14920000
149300             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   14930000
149400             SET DP013-CICS-ABEND                                 14940000
149500                 DP013-ROLLBACK       TO TRUE                     14950000
149600             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               14960000
149700*            MOVE PC-TRANS-UNAVAILABLE-MSG                        14970000
149800*                                     TO AMSGLNO                  14980000
149900             SET PC033-PROCESS-SCREEN TO TRUE                     14990000
150000*            MOVE -1                  TO AFASTL                   15000000
150100             PERFORM 8000-SEND-MAP                                15010000
150200             PERFORM 8100-RETURN-TRANID                           15020000
150300     END-EVALUATE.                                                15030000
150400*                                                                 15040000
150500/                                                                 15050000
150600 9000-SOFT-ABORT.                                                 15060000
150700                                                                  15070000
150800     EXEC CICS                                                    15080000
150900         SYNCPOINT ROLLBACK                                       15090000
151000     END-EXEC                                                     15100000
151100                                                                  15110000
151200*    MOVE 'DB2 ACCESS ERROR'          TO AMSGLNO.                 15120000
151300                                                                  15130000
151400     MOVE 4                           TO PC033-PGM-MSG-NBR        15140000
151500     MOVE SQLCODE                     TO PC033-SQLCODE            15150000
151600     PERFORM 8210-XCTL-ERROR-SCREEN.                              15160000
151700                                                                  15170000
151800 9903-WRITE-CICS-LOG.                                             15180000
151900                                                                  15190000
152000     MOVE SQLCODE                     TO PV-SQLCODE               15200000
152100     STRING PC033-FR-STR-NBR '-'                                  15210000
152200            PC033-XFER-SEQ-NBR '-'                                15220000
152300            PC037-FAST-CHECK-DIGIT DELIMITED BY SIZE              15230000
152400                                      INTO PV-DISPLAY-FAST        15240000
152500     MOVE PC033-PO-NBR                TO PV-DISPLAY-PO            15250000
152600     MOVE PC033-RCVR-SEQ-NBR          TO PV-DISPLAY-RCVR          15260000
152700     MOVE PC033-PO-LINE-NBR           TO PV-DISPLAY-PO-LNE-NBR    15270000
152800     MOVE PC033-STR-NBR               TO PV-DISPLAY-STORE         15280000
152900                                                                  15290000
153000     EXEC CICS                                                    15300000
153100         WRITEQ TD                                                15310000
153200             QUEUE  ('CSSL')                                      15320000
153300             FROM   (PV-LOG-MSG)                                  15330000
153400             RESP   (PV-CICS-RESPONSE)                            15340000
153500     END-EXEC.                                                    15350000
153600                                                                  15360000
153700 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  15370000
153800                                                                  15380000
153900     MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.           15390000
154000     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          15400000
154100     INITIALIZE DP013-SRC-TASK-NUMBER                             15410000
154200                DP013-STACK.                                      15420000
154300     SET DP013-LINK-RETURN            TO TRUE.                    15430000
154400                                                                  15440000
154500     EXEC CICS                                                    15450000
154600         LINK                                                     15460000
154700             PROGRAM   (DP013-NAME)                               15470000
154800             COMMAREA  (DP013-PARAMETERS)                         15480000
154900             LENGTH    (DP013-LENGTH)                             15490000
155000     END-EXEC.                                                    15500000
155100                                                                  15510000
155200*----------------------------------------------------------------*15520000
155300*    ABEND PROCESSOR MODULE                                      *15530000
155400*----------------------------------------------------------------*15540000
155500                                                                  15550000
155600     COPY DPPD014.                                                15560000
155700                                                                  15570000
