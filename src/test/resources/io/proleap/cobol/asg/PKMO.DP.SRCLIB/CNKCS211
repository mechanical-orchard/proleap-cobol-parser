000100 IDENTIFICATION DIVISION.                                         00010099
000200 PROGRAM-ID.    CNKCS211.                                         00020099
000300 AUTHOR.        DENNIS STEFFEN.                                   00030099
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040099
000500 DATE-WRITTEN.  APRIL 1998.                                       00050099
000600 DATE-COMPILED.                                                   00060099
000700                                                                  00070099
000800*---------------------------------------------------------------* 00080099
000900*    Y211 - P2L MODULE/STORE ZONE UPDATE LIST                     00090099
001000*                                                                 00100099
001100*    THIS PROGRAM GENERATES A LIST OF PACK-TO-LIGHT MODULES AND   00110099
001200*    THEIR DESCRIPTIONS, SUBAREAS, AND DEPARTMENT INDICATORS.     00120099
001300*    RECORDS CAN BE SELECTED FOR UPDATE THE STORE ZONE.  OPERATOR 00130099
001400*    SELECTS ONE OR MORE ITEMS AND PRESSES A FUNCTION KEY.  NO    00140099
001500*    SELECTION IS NECESSARY TO GO TO THE ZONE LIST SCREEN.        00150099
001600*                                                                 00160099
001700*---------------------------------------------------------------* 00170099
263455* CHANGED 11/02/2021    BY JIM HUNTER      WR: CHG0263455         00171099
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00172099
263455* MAKING THE CALL DYNAMIC VS STATIC.                              00173099
263455*----------------------------------------------------------------*00174099
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961         00175099
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00176099
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00177099
CICS  *-----------------------------------------------------------------00178099
001800                                                                  00180099
001900 ENVIRONMENT DIVISION.                                            00190099
002000 DATA DIVISION.                                                   00200099
002100/                                                                 00210099
002200 WORKING-STORAGE SECTION.                                         00220099
002300                                                                  00230099
002400 01  DK-DB2-KEYS.                                                 00240099
002500     05  DK-OPER-UNT-ID               PIC S9(04) COMP.            00250099
002600     05  DK-FCLTY-ID                  PIC S9(04) COMP.            00260099
002700                                                                  00270099
002800 01  PC-PROGRAM-CONSTANTS.                                        00280099
002900     05  PC-CURRENT-MAP-NAME          PIC X(08)  VALUE            00290099
003000                                                    'CN211A  '.   00300099
003100     05  PC-CURRENT-MAPSET-NAME       PIC X(08)  VALUE            00310099
003200                                                    'CNKM211 '.   00320099
003300     05  PC-CURRENT-PROGRAM-NAME      PIC X(08)  VALUE            00330099
003400                                                    'CNKCS211'.   00340099
003500     05  PC-LIST-QUEUE-SEQ            PIC 9(01)  VALUE 1.         00350099
003600     05  PC-SEL-QUEUE-SEQ             PIC 9(01)  VALUE 2.         00360099
003700     05  PC-ITEMS-PER-PANEL           PIC S9(04)  VALUE +12       00370099
003800                                                    COMP SYNC.    00380099
003900     05  PC-MAX-BLOCKS-IN-ARRAY       PIC S9(04)  VALUE +2        00390099
004000                                                    COMP SYNC.    00400099
004100     05  PC-MAX-ITEMS                 PIC S9(09)  VALUE           00410099
004200                                                    +1000000      00420099
004300                                                    COMP-3.       00430099
004400     05  PC-MSG-NUMBER-LENGTH         PIC S9(04)  VALUE +7        00440099
004500                                                    COMP SYNC.    00450099
004600     05  PC-4                         PIC S9(04)  VALUE +4        00460099
004700                                                    COMP SYNC.    00470099
004800     05  PC-INQ                       PIC X(03)  VALUE 'INQ'.     00480099
004900     05  PC-UPD                       PIC X(03)  VALUE 'UPD'.     00490099
005000     05  PC-DEL                       PIC X(03)  VALUE 'DEL'.     00500099
005100     05  PC-ERR                       PIC X(03)  VALUE 'ERR'.     00510099
005200                                                                  00520099
005300******************************************************************00530099
005400* 00005-INVALID VALUE                                             00540099
005500* 00008-MUST BE NUMERIC                                           00550099
005600* 00050-NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED       00560099
005700* 00051-NO END OF RANGE HAS BEEN SPECIFIED                        00570099
005800* 00052-END OF RANGE PRECEDES START OF RANGE                      00580099
005900* 00053-NO START OF RANGE HAS BEEN SPECIFIED                      00590099
006000* 00054-ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED        00600099
006100* 00055-ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED          00610099
006200* 00059-UPDATE(S) SUCCESSFUL                                      00620099
006300* 00069-TOP OF LIST                                               00630099
006400* 00070-BOTTOM OF LIST                                            00640099
006500* 00101-VALUE MUST BE > ZERO AND LESS THAN 100,000,000            00650099
006600* 00254-ERRORS OCCURRED; NO UPDATE PERFORMED                      00660099
006700* 00279-MORE ITEMS TO DISPLAY                                     00670099
006800* 00551-WAIT 15 SECONDS;RETRY FUNCTION AGAIN; IF UNSUCCESSFUL     00680099
006900* 01692-ONE STORE ZONE MUST BE SELECTED                           00690099
007000* 03717-FINE JEWLY MOD CANNOT BE SET UP AS HANG/FOLD              00700099
007010* 03718-DC SETUP FOR HANG FOLD INVALID ZONE                       00701099
007100* 99901-INVALID COMMAND WAS ENTERED                               00710099
007200******************************************************************00720099
007300                                                                  00730099
007400     05  PC-TSYMSG-NUMBERS.                                       00740099
007500         10  PC-TSYMSG-00005          PIC 9(05)  VALUE 00005.     00750099
007600         10  PC-TSYMSG-00008          PIC 9(05)  VALUE 00008.     00760099
007700         10  PC-TSYMSG-00050          PIC 9(05)  VALUE 00050.     00770099
007800         10  PC-TSYMSG-00051          PIC 9(05)  VALUE 00051.     00780099
007900         10  PC-TSYMSG-00052          PIC 9(05)  VALUE 00052.     00790099
008000         10  PC-TSYMSG-00053          PIC 9(05)  VALUE 00053.     00800099
008100         10  PC-TSYMSG-00054          PIC 9(05)  VALUE 00054.     00810099
008200         10  PC-TSYMSG-00055          PIC 9(05)  VALUE 00055.     00820099
008300         10  PC-TSYMSG-00059          PIC 9(05)  VALUE 00059.     00830099
008400         10  PC-TSYMSG-00069          PIC 9(05)  VALUE 00069.     00840099
008500         10  PC-TSYMSG-00070          PIC 9(05)  VALUE 00070.     00850099
008600         10  PC-TSYMSG-00101          PIC 9(05)  VALUE 00101.     00860099
008700         10  PC-TSYMSG-00254          PIC 9(05)  VALUE 00254.     00870099
008800         10  PC-TSYMSG-00279          PIC 9(05)  VALUE 00279.     00880099
008900         10  PC-TSYMSG-00551          PIC 9(05)  VALUE 00551.     00890099
009000         10  PC-TSYMSG-01692          PIC 9(05)  VALUE 01692.     00900099
009100         10  PC-TSYMSG-03717          PIC 9(05)  VALUE 03717.     00910099
009110         10  PC-TSYMSG-03718          PIC 9(05)  VALUE 03718.     00911099
009200         10  PC-TSYMSG-99901          PIC 9(05)  VALUE 99901.     00920099
009300                                                                  00930099
009400 01  PS-PROGRAM-SWITCHES.                                         00940099
009500     05  PS-ERROR-SW                  PIC X(01)  VALUE 'Y'.       00950099
009600         88  PS-NO-ERROR                            VALUE 'Y'.    00960099
009700         88  PS-ERROR                               VALUE 'N'.    00970099
009800     05  PS-ZONE-SW                   PIC X(01)  VALUE 'Y'.       00980099
009900         88  PS-VALID-ZONE                          VALUE 'Y'.    00990099
010000         88  PS-INVALID-ZONE                        VALUE 'N'.    01000099
010100     05  PS-COMMAREA-SW               PIC X(01)  VALUE 'N'.       01010099
010200         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01020099
010300         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01030099
010400     05  PS-NEXT-SCREEN-SW            PIC X(01)  VALUE 'N'.       01040099
010500         88  PS-NO-NEXT-SCREEN                  VALUE 'N'.        01050099
010600         88  PS-NEXT-SCREEN                     VALUE 'Y'.        01060099
010700                                                                  01070099
010800 01  PV-PROGRAM-VARIABLES.                                        01080099
010900     05  PV-SUB                       PIC S9(04)  VALUE +0        01090099
011000                                                    COMP SYNC.    01100099
011100     05  PV-REMAINDER                 PIC S9(04)  VALUE +0        01110099
011200                                                    COMP SYNC.    01120099
011300     05  PV-READ-COUNT                PIC S9(09)  VALUE +0        01130099
011400                                                    COMP-3.       01140099
011500     05  PV-ITEMS-PROCESSED           PIC S9(09)  VALUE +0        01150099
011600                                                    COMP-3.       01160099
011700     05  PV-HOLD-SELECTED-ITEMS       PIC S9(09)  VALUE +0        01170099
011800                                                    COMP-3.       01180099
011900     05  PV-ITEM-IN-USE               PIC S9(09)  VALUE +0        01190099
012000                                                    COMP-3.       01200099
012100     05  PV-TOP-ITEM                  PIC S9(09)  VALUE +0        01210099
012200                                                    COMP-3.       01220099
012300     05  PV-BOTTOM-ITEM               PIC S9(09)  VALUE +0        01230099
012400                                                    COMP-3.       01240099
012500     05  PV-BLOCK-NUMBER              PIC S9(04)  VALUE +0        01250099
012600                                                    COMP SYNC.    01260099
012700     05  PV-CICS-RESP                 PIC S9(04)  VALUE +0        01270099
012800                                                    COMP SYNC.    01280099
012900     05  PV-ITEM                      PIC S9(04)  VALUE +0        01290099
013000                                                    COMP SYNC.    01300099
013100     05  PV-SEL-QUEUE-ITEM            PIC S9(04)  VALUE +0        01310099
013200                                                    COMP SYNC.    01320099
013300     05  PV-SAVE-ITEM                 PIC S9(04)  VALUE +0        01330099
013400                                                    COMP SYNC.    01340099
013500     05  PV-HIGHEST-BLOCK-WRITTEN     PIC S9(04)  VALUE +0        01350099
013600                                                    COMP SYNC.    01360099
013700     05  PV-LIST-ITEM-NUMBER          PIC S9(04)  VALUE +0        01370099
013800                                                    COMP SYNC.    01380099
013900     05  PV-FIRST-BLOCK-IN-ARRAY      PIC S9(04)  VALUE +0        01390099
014000                                                    COMP SYNC.    01400099
014100     05  PV-NEXT-BLOCK-IN-ARRAY       PIC S9(04)  VALUE +0        01410099
014200                                                    COMP SYNC.    01420099
014300     05  PV-PREV-BLOCK-IN-ARRAY       PIC S9(04)  VALUE +0        01430099
014400                                                    COMP SYNC.    01440099
014500     05  PV-FIRST-BLOCK-IN-RANGE      PIC S9(04)  VALUE +0        01450099
014600                                                    COMP SYNC.    01460099
014700     05  PV-LAST-BLOCK-IN-RANGE       PIC S9(04)  VALUE +0        01470099
014800                                                    COMP SYNC.    01480099
014900     05  PV-START-OF-SELECTED-RANGE   PIC S9(04)  VALUE +0        01490099
015000                                                    COMP SYNC.    01500099
015100     05  PV-END-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0        01510099
015200                                                    COMP SYNC.    01520099
015300     05  PV-STR-ZN-NULL-IND           PIC S9(04) VALUE ZERO       01530099
015400                                                    COMP SYNC.    01540099
015500     05  PV-SEARCH-ZONE               PIC X(05)  VALUE SPACES.    01550099
015600                                                                  01560099
015700     05  PV-ZONE-WORK                 PIC X(05).                  01570099
015800         88 PV-HANG                              VALUE 'HANG '    01580099
015900                                                       ' HANG'.   01590099
016000         88 PV-FOLD                              VALUE 'FOLD ',   01600099
016100                                                       ' FOLD'.   01610099
016110     05  PV-WST-STORE-ZONE            PIC X(05).                  01611099
016200                                                                  01620099
016300*---------------------------------------------------------------* 01630099
016400*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 01640099
016500*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 01650099
016600*   APPLICATION-SPECIFIC COMMAREA.                              * 01660099
016700*---------------------------------------------------------------* 01670099
016800 01  LQW-LIST-QUEUE-WORK-AREA.                                    01680099
016900     05  LQW-BLOCK-MODIFIED           PIC X(01)   VALUE SPACE.    01690099
017000     05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           01700099
017100                                        INDEXED BY LQW-IDX.       01710099
017200         10  LQW-LIST-ITEM-NUMBER     PIC S9(09)  COMP-3.         01720099
017300         10  LQW-TEMP-SELECTED-SW     PIC X(01).                  01730099
017400         10  LQW-SELECTED-SW          PIC X(01).                  01740099
017500             88  LQW-SELECT                         VALUE 'S'.    01750099
017600             88  LQW-DESELECT                       VALUE ' '.    01760099
017700         10  LQW-ACTION               PIC X(03).                  01770099
017800             88  LQW-NULL-ACTION                    VALUE SPACES. 01780099
017900             88  LQW-ERROR                          VALUE 'ERR'.  01790099
018000             88  LQW-INQUIRE                        VALUE 'INQ'.  01800099
018100             88  LQW-UPDATE                         VALUE 'UPD'.  01810099
018200         10  LQW-U-STORE-ZONE         PIC X(05).                  01820099
018300         10  LQW-P2L-MOD              PIC 9(03).                  01830099
018400         10  LQW-MOD-DESC             PIC X(07).                  01840099
018500         10  LQW-STORE-ZONE           PIC X(05).                  01850099
018600         10  LQW-STORE-ZONE-DESC      PIC X(25).                  01860099
018700         10  LQW-LBL-TYP-CDE          PIC X(02).                  01870099
018750         10  LQW-P2L-MOD-MDSE-TYPE    PIC X(01).                  01875099
018770             88  LQW-P2L-FINE-JEWELRY     VALUE 'F'.              01877099
018780             88  LQW-P2L-CAGE-FRGRNCE     VALUE 'C'.              01878099
018790             88  LQW-P2L-HRTW             VALUE 'H'.              01879099
018791             88  LQW-P2L-OTHER            VALUE 'O'.              01879199
018792         10  LQW-MOD-DIVERT-CDE       PIC X(04).                  01879299
018800                                                                  01880099
018900/                                                                 01890099
019000*---------------------------------------------------------------* 01900099
019100*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 01910099
019200*---------------------------------------------------------------* 01920099
019300     COPY CNWS007.                                                01930099
019400                                                                  01940099
019500/                                                                 01950099
019600*---------------------------------------------------------------* 01960099
019700*    MAP LAYOUT                                                 * 01970099
019800*---------------------------------------------------------------* 01980099
019900                                                                  01990099
020000     COPY CNKM211.                                                02000099
020100                                                                  02010099
020200 01  MR-OCCURS-LAYOUT                   REDEFINES  CN211AO.       02020099
020300     02  MR-HEADER-INFO.                                          02030099
020400     05  FILLER                       PIC X(12).                  02040099
020500                                                                  02050099
020600     05  MR-ZONEL                     PIC S9(04) COMP.            02060099
020700     05  MR-ZONEA                     PIC X(01).                  02070099
020800     05  MR-ZONEC                     PIC X(01).                  02080099
020900     05  MR-ZONEH                     PIC X(01).                  02090099
021000     05  MR-ZONE                      PIC X(14).                  02100099
021100                                                                  02110099
021200     05  MR-OPERL                     PIC S9(04) COMP.            02120099
021300     05  MR-OPERA                     PIC X(01).                  02130099
021400     05  MR-OPERC                     PIC X(01).                  02140099
021500     05  MR-OPERH                     PIC X(01).                  02150099
021600     05  MR-OPER                      PIC X(04).                  02160099
021700                                                                  02170099
021800     05  MR-FDESCL                    PIC S9(04) COMP.            02180099
021900     05  MR-FDESCA                    PIC X(01).                  02190099
022000     05  MR-FDESCC                    PIC X(01).                  02200099
022100     05  MR-FDESCH                    PIC X(01).                  02210099
022200     05  MR-FDESC                     PIC X(25).                  02220099
022300                                                                  02230099
022400     05  MR-FCLTYL                    PIC S9(04) COMP.            02240099
022500     05  MR-FCLTYA                    PIC X(01).                  02250099
022600     05  MR-FCLTYC                    PIC X(01).                  02260099
022700     05  MR-FCLTYH                    PIC X(01).                  02270099
022800     05  MR-FCLTY                     PIC X(04).                  02280099
022900                                                                  02290099
023000     05  FILLER                       PIC X(30).                  02300099
023100                                                                  02310099
023200     02  MR-DETAIL-LINES.                                         02320099
023300     05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          02330099
023400         10  MR-SELECTL               PIC S9(04) COMP.            02340099
023500         10  MR-SELECTA               PIC X(01).                  02350099
023600         10  MR-SELECTC               PIC X(01).                  02360099
023700         10  MR-SELECTH               PIC X(01).                  02370099
023800         10  MR-SELECT                PIC X(01).                  02380099
023900                                                                  02390099
024000         10  MR-ACTIONL               PIC S9(04) COMP.            02400099
024100         10  MR-ACTIONA               PIC X(01).                  02410099
024200         10  MR-ACTIONC               PIC X(01).                  02420099
024300         10  MR-ACTIONH               PIC X(01).                  02430099
024400         10  MR-ACTION                PIC X(03).                  02440099
024500                                                                  02450099
024600         10  MR-U-STORE-ZONE-L        PIC S9(04) COMP.            02460099
024700         10  MR-U-STORE-ZONE-A        PIC X(01).                  02470099
024800         10  MR-U-STORE-ZONE-C        PIC X(01).                  02480099
024900         10  MR-U-STORE-ZONE-H        PIC X(01).                  02490099
025000         10  MR-U-STORE-ZONE          PIC X(05).                  02500099
025100                                                                  02510099
025200         10  MR-P2L-MOD-L             PIC S9(04) COMP.            02520099
025300         10  MR-P2L-MOD-A             PIC X(01).                  02530099
025400         10  MR-PL2-MOD-C             PIC X(01).                  02540099
025500         10  MR-PL2-MOD-H             PIC X(01).                  02550099
025600         10  MR-P2L-MOD               PIC X(03).                  02560099
025700                                                                  02570099
025800         10  MR-MOD-DESC-L            PIC S9(04) COMP.            02580099
025900         10  MR-MOD-DESC-A            PIC X(01).                  02590099
026000         10  MR-MOD-DESC-C            PIC X(01).                  02600099
026100         10  MR-MOD-DESC-H            PIC X(01).                  02610099
026200         10  MR-MOD-DESC              PIC X(07).                  02620099
026300                                                                  02630099
026400         10  MR-STORE-ZONE-L          PIC S9(04) COMP.            02640099
026500         10  MR-STORE-ZONE-A          PIC X(01).                  02650099
026600         10  MR-STORE-ZONE-C          PIC X(01).                  02660099
026700         10  MR-STORE-ZONE-H          PIC X(01).                  02670099
026800         10  MR-STORE-ZONE            PIC X(05).                  02680099
026900                                                                  02690099
027000         10  MR-STORE-ZONE-DESC-L     PIC S9(04) COMP.            02700099
027100         10  MR-STORE-ZONE-DESC-A     PIC X(01).                  02710099
027200         10  MR-STORE-ZONE-DESC-C     PIC X(01).                  02720099
027300         10  MR-STORE-ZONE-DESC-H     PIC X(01).                  02730099
027400         10  MR-STORE-ZONE-DESC       PIC X(20).                  02740099
027500                                                                  02750099
027600         10  MR-MDSE-TYPE-L           PIC S9(04) COMP.            02760099
027700         10  MR-MDSE-TYPE-A           PIC X(01).                  02770099
027800         10  MR-MDSE-TYPE-C           PIC X(01).                  02780099
027900         10  MR-MDSE-TYPE-H           PIC X(01).                  02790099
028000         10  MR-MDSE-TYPE             PIC X(05).                  02800099
028100                                                                  02810099
028200         10  MR-DIVERT-CODE-L         PIC S9(04) COMP.            02820099
028300         10  MR-DIVERT-CODE-A         PIC X(01).                  02830099
028400         10  MR-DIVERT-CODE-C         PIC X(01).                  02840099
028500         10  MR-DIVERT-CODE-H         PIC X(01).                  02850099
028600         10  MR-DIVERT-CODE           PIC X(04).                  02860099
028700                                                                  02870099
028800                                                                  02880099
028900/                                                                 02890099
029000*---------------------------------------------------------------* 02900099
029100*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02910099
029200*---------------------------------------------------------------* 02920099
029300     COPY DPWS015.                                                02930099
029400/                                                                 02940099
029500*---------------------------------------------------------------* 02950099
029600*    FUNCTION KEYS COPYBOOK.                                    * 02960099
029700*---------------------------------------------------------------* 02970099
029800     COPY DPWS016.                                                02980099
029900/                                                                 02990099
030000*---------------------------------------------------------------* 03000099
030100*    NUMERIC EDIT LAYOUT.                                       * 03010099
030200*---------------------------------------------------------------* 03020099
030300     COPY DPWS010I.                                               03030099
030400/                                                                 03040099
030500*---------------------------------------------------------------* 03050099
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 03060099
030700*---------------------------------------------------------------* 03070099
030800     COPY DPWS030.                                                03080099
CICS       COPY DPWS930.                                                03081099
030900/                                                                 03090099
031000*---------------------------------------------------------------* 03100099
031100*    STANDARD COMMAREA.                                         * 03110099
031200*---------------------------------------------------------------* 03120099
031300                                                                  03130099
031400     COPY DPWS020.                                                03140099
031500     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03150099
031600                                                                  03160099
031700*---------------------------------------------------------------* 03170099
031800* INTER-APPLICATION COMMAREA.                                   * 03180099
031900*   CNWS001 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 03190099
032000*             SPEC SCREEN.                                      * 03200099
032100*   CNWS003 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03210099
032200*             THIS LIST PROGRAM FOR A LOCAL-GO FUNCTION.        * 03220099
032300*---------------------------------------------------------------* 03230099
032400                                                                  03240099
032500         10  INTER-APPL-COMM-AREA     PIC X(200).                 03250099
032600     COPY CNWS001.                                                03260099
032700     COPY CNWS003.                                                03270099
032800*---------------------------------------------------------------* 03280099
032900*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03290099
033000*---------------------------------------------------------------* 03300099
033100         10  ASC-SPECIFIC-COMMAREA.                               03310099
033200             15  ASC-LIST-KEYS.                                   03320099
033300*  THESE ARE THE KEYS PASSED FROM THE CRIT SPEC SCREEN            03330099
033400                 20  ASC-KEY-FCLTY-ID PIC S9(04) COMP.            03340099
033500                 20  ASC-KEY-OPER-UNT-ID                          03350099
033600                                      PIC S9(04) COMP.            03360099
033700             15  ASC-BLOCK-ENTRIES      OCCURS 2 TIMES.           03370099
033800                 20  ASC-BLOCK-MODIFIED-SW                        03380099
033900                                      PIC  X(01).                 03390099
034000                     88  ASC-BLOCK-NOT-MODIFIED    VALUE 'N'.     03400099
034100                     88  ASC-BLOCK-MODIFIED        VALUE 'Y'.     03410099
034200                                                                  03420099
034300                 20  ASC-ITEM-ARRAY.                              03430099
034400                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        03440099
034500                         30  ASC-LIST-ITEM-NUMBER                 03450099
034600                                      PIC S9(09) COMP-3.          03460099
034700                         30  ASC-TEMP-SELECTED-SW                 03470099
034800                                      PIC X(01).                  03480099
034900                             88  ASC-VALID-SELECT  VALUE ' '      03490099
035000                                                         'S'      03500099
035100                                                         'B'      03510099
035200                                                         'E'.     03520099
035300                             88  ASC-TEMP-NO-SELECT               03530099
035400                                                   VALUE ' '.     03540099
035500                             88  ASC-TEMP-SELECT   VALUE 'S'.     03550099
035600                             88  ASC-TEMP-BEGIN    VALUE 'B'.     03560099
035700                             88  ASC-TEMP-END      VALUE 'E'.     03570099
035800                         30  ASC-SELECTED-SW                      03580099
035900                                      PIC X(01).                  03590099
036000                             88  ASC-NO-SELECT     VALUE ' '.     03600099
036100                             88  ASC-SELECT        VALUE 'S'.     03610099
036200                             88  ASC-BEGIN         VALUE 'B'.     03620099
036300                             88  ASC-END           VALUE 'E'.     03630099
036400                         30  ASC-ACTION          PIC X(03).       03640099
036500                         30  ASC-U-STORE-ZONE                     03650099
036600                                      PIC X(05).                  03660099
036700                         30  ASC-P2L-MOD                          03670099
036800                                      PIC 9(03).                  03680099
036900                         30  ASC-MOD-DESC                         03690099
037000                                      PIC X(07).                  03700099
037100                         30  ASC-STORE-ZONE                       03710099
037200                                      PIC X(05).                  03720099
037300                         30  ASC-STORE-ZONE-DESC                  03730099
037400                                      PIC X(25).                  03740099
037500                         30  ASC-LBL-TYP-CDE                      03750099
037600                                      PIC X(02).                  03760099
037700                         30  ASC-P2L-MOD-MDSE-TYPE                03770099
037800                                      PIC X(01).                  03780099
037900                             88 ASC-P2L-FINE-JEWELRY  VALUE 'F'.  03790099
038000                             88 ASC-P2L-CAGE-FRGRNCE  VALUE 'C'.  03800099
038100                             88 ASC-P2L-HRTW          VALUE 'H'.  03810099
038200                             88 ASC-P2L-OTHER         VALUE 'O'.  03820099
038300                         30  ASC-MOD-DIVERT-CDE                   03830099
038400                                      PIC X(04).                  03840099
038500                                                                  03850099
038600             15  ASC-BLK-SUB          PIC S9(04) COMP SYNC.       03860099
038700             15  ASC-ITEM-SUB         PIC S9(04) COMP SYNC.       03870099
038800             15  ASC-NUMBER-OF-ITEMS-READ                         03880099
038900                                      PIC S9(09) COMP-3.          03890099
039000             15  ASC-NUMBER-OF-SELECTED-ITEMS                     03900099
039100                                      PIC S9(09) COMP-3.          03910099
039200             15  ASC-ITEMS-DISPLAYED  PIC S9(03) COMP-3.          03920099
039300             15  ASC-ITEM-AT-TOP-OF-PANEL                         03930099
039400                                      PIC S9(09) COMP-3.          03940099
039500             15  ASC-ITEM-AT-BOT-OF-PANEL                         03950099
039600                                      PIC S9(09) COMP-3.          03960099
039700             15  ASC-HIGHEST-BLOCK-WRITTEN                        03970099
039800                                      PIC S9(04) COMP SYNC.       03980099
039900             15  ASC-START-OF-SELECTED-RANGE                      03990099
040000                                      PIC S9(09) COMP-3.          04000099
040100             15  ASC-END-OF-SELECTED-RANGE                        04010099
040200                                      PIC S9(09) COMP-3.          04020099
040300             15  ASC-ITEMS-LEFT-INDICATOR                         04030099
040400                                      PIC X(01).                  04040099
040500                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     04050099
040600                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     04060099
040700             15  ASC-TEMP-QUEUE-UPDATE-SW                         04070099
040800                                      PIC X(01).                  04080099
040900                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     04090099
041000                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     04100099
041100             15  ASC-LIST-QUEUE-NAME.                             04110099
041200                 20  ASC-LIST-TERM-ID PIC X(04).                  04120099
041300                 20  ASC-LIST-TASK-NUMBER                         04130099
041400                                      PIC S9(05) COMP-3.          04140099
041500                 20  ASC-LIST-SEQ     PIC 9(01).                  04150099
041600             15  ASC-SEL-QUEUE-NAME.                              04160099
041700                 20  ASC-SEL-TERM-ID  PIC X(04).                  04170099
041800                 20  ASC-SEL-TASK-NUMBER                          04180099
041900                                      PIC S9(05) COMP-3.          04190099
042000                 20  ASC-SEL-SEQ      PIC 9(01).                  04200099
042100                                                                  04210099
042200             15  ASC-CURSOR-SW        PIC X(01).                  04220099
042300                 88  ASC-NO-CURSOR                 VALUE 'Z'.     04230099
042400                 88  ASC-TYPE-CURSOR               VALUE 'S'.     04240099
042500                 88  ASC-LOC-CURSOR                VALUE 'N'.     04250099
042600                 88  ASC-DESC-CURSOR               VALUE 'T'.     04260099
042700             15  ASC-START-ITEM-REQUEST.                          04270099
042800                 20  ASC-START-ITEM-REQUEST-N                     04280099
042900                                      PIC 9(07).                  04290099
043000             15  ASC-FCLTY-NME        PIC X(25).                  04300099
043100             15  ASC-FCLTY-ID-X.                                  04310099
043200                 20 ASC-FCLTY-ID      PIC 9(04).                  04320099
043300             15  ASC-OPER-UNT-ID-X.                               04330099
043400                 20 ASC-OPER-UNT-ID   PIC 9(04).                  04340099
043500             15  ASC-P2L-ZONE         PIC X(14).                  04350099
043600                 88 ASC-COMMODITY         VALUE 'COMMODITY     '. 04360099
043700                 88 ASC-HANG-FOLD         VALUE 'HANG/FOLD     '. 04370099
043800                 88 ASC-HANG-COMMODITY    VALUE 'HANG/COMMODITY'. 04380099
043900             15  ASC-CICS-SYSTEM       PIC X(08).                 04390099
044000                 88 ASC-TEST-CICS             VALUE 'CICST1  '.   04400099
044100                                                                  04410099
044200 01  PT-ZONE-TABLE.                                               04420099
044300     05  PT-ZONE-ENTRIES OCCURS 50 TIMES INDEXED BY               04430099
044400                         PT-ZONE-IDX.                             04440099
044500         10  PT-ZONE-ID               PIC X(05).                  04450099
044600         10  PT-ZONE-DESC             PIC X(20).                  04460099
044601                                                                  04460199
044602                                                                  04460299
044610 01  PT-HANG-FOLD-ZONE-TABLE.                                     04461099
044620     05  PT-HANG-FOLD-ZONE-ENTRIES OCCURS 50 TIMES INDEXED BY     04462099
044630                         PT-HANG-FOLD-ZONE-IDX.                   04463099
044640         10  PT-HANG-FOLD-ZONE        PIC X(05).                  04464099
044660                                                                  04466099
044670                                                                  04467099
044700/                                                                 04470099
044800*---------------------------------------------------------------* 04480099
044900*    ABEND PROCESSING COPYBOOK.                                 * 04490099
045000*---------------------------------------------------------------* 04500099
045100     COPY DPWS013.                                                04510099
045200                                                                  04520099
045300/                                                                 04530099
045400*---------------------------------------------------------------* 04540099
045500*    DB2 AREA FOR THE FACILITY LOCATION TYPE TABLE              * 04550099
045600*---------------------------------------------------------------* 04560099
045700     EXEC SQL                                                     04570099
045800          INCLUDE TFLAREA                                         04580099
045900     END-EXEC.                                                    04590099
046000                                                                  04600099
046100/                                                                 04610099
046200     COPY XLWS071.                                                04620099
046300                                                                  04630099
046400/                                                                 04640099
046500     EXEC SQL                                                     04650099
046600          INCLUDE TP2LMOD                                         04660099
046700     END-EXEC.                                                    04670099
046800/                                                                 04680099
046900     EXEC SQL                                                     04690099
047000          INCLUDE TSTRZN                                          04700099
047100     END-EXEC.                                                    04710099
047200*                                                                 04720099
047300*** PARAMETER DATABASE                                            04730099
047400*                                                                 04740099
047500     EXEC SQL                                                     04750099
047600          INCLUDE TKRPRPM                                         04760099
047700     END-EXEC.                                                    04770099
047710*                                                                 04771099
047720*** INTEGRATION DATABASE - WST_INTGRTN_TYP                        04772099
047730*                                                                 04773099
047740     EXEC SQL                                                     04774099
047750          INCLUDE WST00008                                        04775099
047760     END-EXEC.                                                    04776099
047800                                                                  04780099
047810*                                                                 04781099
047820*** ATTRIBUTE DEFINITION - WST_ATTR_DEFN                          04782099
047830*                                                                 04783099
047840     EXEC SQL                                                     04784099
047850          INCLUDE WST00009                                        04785099
047860     END-EXEC.                                                    04786099
047870                                                                  04787099
047880*                                                                 04788099
047890*** ATTRIBUTE ELEMENT    - WST_ATTR_ELEM                          04789099
047891*                                                                 04789199
047892     EXEC SQL                                                     04789299
047893          INCLUDE WST00010                                        04789399
047894     END-EXEC.                                                    04789499
047895                                                                  04789599
047896/                                                                 04789699
047900     EXEC SQL                                                     04790099
048000          INCLUDE SQLCA                                           04800099
048100     END-EXEC.                                                    04810099
048200                                                                  04820099
048300/                                                                 04830099
048400*---------------------------------------------------------------* 04840099
048500*    FCLTY-CSR FOR SELECT OF ALL LOCATIONS WITHIN STORE         * 04850099
048600*---------------------------------------------------------------* 04860099
048700                                                                  04870099
048800     EXEC SQL                                                     04880099
048900          DECLARE P2L-MOD-CSR CURSOR FOR                          04890099
049000           SELECT A.MODU_NBR                                      04900099
049100                , A.MODU_DESC                                     04910099
049200                , A.DFLT_STR_ZN_ID                                04920099
049300                , B.STR_ZN_DESC                                   04930099
049400                , A.MODU_MDSE_TYP_CDE                             04940099
049500                , A.DIVERT_CDE                                    04950099
049600             FROM TP2LMOD A                                       04960099
049700             LEFT OUTER JOIN                                      04970099
049800                  TSTRZN  B                                       04980099
049900             ON                                                   04990099
050000                  A.DFLT_STR_ZN_ID = B.STR_ZN_ID                  05000099
050100            WHERE A.OPER_UNT_ID    = :DK-OPER-UNT-ID              05010099
050200              AND A.FCLTY_ID       = :DK-FCLTY-ID                 05020099
050300              ORDER BY A.MODU_NBR                                 05030099
050400     END-EXEC.                                                    05040099
050500/                                                                 05050099
050600     EXEC SQL                                                     05060099
050700         DECLARE ZONE-CSR CURSOR FOR                              05070099
050800         SELECT                                                   05080099
050900             STR_ZN_ID                                            05090099
051000           , STR_ZN_DESC                                          05100099
051100         FROM TSTRZN                                              05110099
051200     END-EXEC.                                                    05120099
051300/                                                                 05130099
051301     EXEC SQL                                                     05130199
051302         DECLARE HANG-FOLD-CSR CURSOR FOR                         05130299
051303          SELECT                                                  05130399
051306                   E.ATTR_ELEM_TXT  AS STORE_ZONE                 05130699
051311            FROM                                                  05131199
051312                   WST_INTGRTN_TYP  A                             05131299
051313               ,   WST_ATTR_DEFN    B                             05131399
051314               ,   WST_ATTR_ELEM    C                             05131499
051315               ,   WST_ATTR_ELEM    D                             05131599
051316               ,   WST_ATTR_ELEM    E                             05131699
051317               ,   WST_ATTR_ELEM    F                             05131799
051318               ,   WST_ATTR_ELEM    G                             05131899
051319            WHERE                                                 05131999
051320                  A.INTGRTN_TYP_CDE   = 'P2LHNGFLD'               05132099
051321              AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE         05132199
051322              AND B.ATTR_DEFN_SEQ_NBR = 1                         05132299
051323              AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE         05132399
051324              AND C.ATTR_DEFN_SEQ_NBR = 1                         05132499
051325              AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE         05132599
051326              AND D.ATTR_DEFN_SEQ_NBR = 2                         05132699
051327              AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE         05132799
051328              AND E.ATTR_DEFN_SEQ_NBR = 3                         05132899
051329              AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE         05132999
051330              AND F.ATTR_DEFN_SEQ_NBR = 4                         05133099
051331              AND B.INTGRTN_TYP_CDE   = G.INTGRTN_TYP_CDE         05133199
051332              AND G.ATTR_DEFN_SEQ_NBR = 5                         05133299
051333              AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR       05133399
051334              AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR       05133499
051335              AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR       05133599
051336              AND C.ATTR_ELEM_SEQ_NBR = G.ATTR_ELEM_SEQ_NBR       05133699
051337              AND C.ATTR_ELEM_NBR     =  90                       05133799
051338              AND D.ATTR_ELEM_TXT     = 'P2L'                     05133899
051339              AND F.ATTR_ELEM_TMST   <=  CURRENT TIMESTAMP        05133999
051340              AND G.ATTR_ELEM_TMST   >=  CURRENT TIMESTAMP        05134099
051341     END-EXEC.                                                    05134199
051342                                                                  05134299
051350/                                                                 05135099
051400 LINKAGE SECTION.                                                 05140099
051500                                                                  05150099
051600 01  DFHCOMMAREA.                                                 05160099
051700     05  FILLER                         OCCURS  1 TO 4072 TIMES   05170099
051800                                        DEPENDING ON EIBCALEN.    05180099
051900         10  FILLER                   PIC X.                      05190099
052000                                                                  05200099
052100/                                                                 05210099
052200 PROCEDURE DIVISION.                                              05220099
052300*---------------------------------------------------------------* 05230099
052400*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 05240099
052500*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 05250099
052600*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 05260099
052700*---------------------------------------------------------------* 05270099
052800 0000-MAIN-MODULE.                                                05280099
052900                                                                  05290099
053000     INITIALIZE DP030-CICS-API-FIELDS.                            05300099
053100                                                                  05310099
053200     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05320099
053300     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05330099
053400     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05340099
053500                                                                  05350099
053600     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05360099
053700                                                                  05370099
053800     MOVE LENGTH OF CN211AI        TO DP030-MAP-LENGTH (1).       05380099
053900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05390099
054000                                                                  05400099
054100     PERFORM 0001-CALL-CICS-ARCH-API.                             05410099
054200     PERFORM 1000-CONTROL-PROCESSING                              05420099
054300                                                                  05430099
054400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05440099
054500     PERFORM 0001-CALL-CICS-ARCH-API.                             05450099
054600                                                                  05460099
054700*---------------------------------------------------------------* 05470099
054800*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 05480099
054900*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 05490099
055000*---------------------------------------------------------------* 05500099
055100 0001-CALL-CICS-ARCH-API.                                         05510099
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05520099
055300                                    DFHCOMMAREA                   05530099
055400                                    DP030-CICS-API-FIELDS         05540099
055500                                    DP020-STANDARD-COMMAREA       05550099
055600                                    CN211AI.                      05560099
055700                                                                  05570099
055800     IF  DP030-RC-CALL-SUCCESSFUL                                 05580099
055900         CONTINUE                                                 05590099
056000     ELSE                                                         05600099
056100         SET DP013-NO-ROLLBACK                                    05610099
056200             DP013-XCTL-DISPLAY-RESTART                           05620099
056300             DP013-CICS-ABEND      TO TRUE                        05630099
056400         MOVE '0001-CALL-CICS-ARCH-API'                           05640099
056500                                   TO DP013-PARAGRAPH             05650099
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05651099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05652099
056800         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05680099
056900         PERFORM DP013-0000-PROCESS-ABEND                         05690099
057000     END-IF.                                                      05700099
057100                                                                  05710099
057200*----------------------------------------------------------------*05720099
057300* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05730099
057400* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05740099
057500*                                                                *05750099
057600* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05760099
057700*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05770099
057800*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05780099
057900*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05790099
058000*----------------------------------------------------------------*05800099
058100                                                                  05810099
058200 1000-CONTROL-PROCESSING.                                         05820099
058300                                                                  05830099
058400                                                                  05840099
058500     EVALUATE TRUE                                                05850099
058600         WHEN DP020-NEXT-ACT-INITIAL                              05860099
058700             INITIALIZE ASC-SPECIFIC-COMMAREA                     05870099
058800             EXEC CICS                                            05880099
058900                 ASSIGN APPLID (ASC-CICS-SYSTEM)                  05890099
059000             END-EXEC                                             05900099
059100             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05910099
059200                                      ASC-SEL-TERM-ID             05920099
059300             MOVE DP020-SRC-TASK-NUMBER                           05930099
059400                                   TO ASC-LIST-TASK-NUMBER        05940099
059500                                      ASC-SEL-TASK-NUMBER         05950099
059600             MOVE PC-LIST-QUEUE-SEQ                               05960099
059700                                   TO ASC-LIST-SEQ                05970099
059800             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05980099
059900             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05990099
060000                                                                  06000099
060100***-----$TEMPLATE NOTE$-------------------------------------------06010099
060200*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,06020099
060300*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  06030099
060400*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.06040099
060500***---------------------------------------------------------------06050099
060600             IF  PS-COMMAREA-NOT-VALID                            06060099
060700                 MOVE PC-TSYMSG-99901                             06070099
060800                                   TO DP020-MSG-NUMBER            06080099
060900                 SET DP020-MSG-FATAL                              06090099
061000                                   TO TRUE                        06100099
061100                 SET DP020-NEXT-ACT-APPL-ERROR                    06110099
061200                                   TO TRUE                        06120099
061300             ELSE                                                 06130099
061400                 PERFORM 4000-BUILD-INITIAL-PANEL                 06140099
061500                 PERFORM 3200-RESET-ATTRIBUTES                    06150099
061600             END-IF                                               06160099
061700                                                                  06170099
061800         WHEN DP020-NEXT-ACT-READ-MAP                             06180099
061900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06190099
062000                                   TO PV-TOP-ITEM                 06200099
062100             PERFORM 2000-PROCESS-PANEL                           06210099
062200                                                                  06220099
062300         WHEN DP020-NEXT-ACT-RETURN                               06230099
062400             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06240099
062500                                   TO PV-TOP-ITEM                 06250099
062600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06260099
062700             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 06270099
062800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06280099
062900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06290099
063000                                                                  06300099
063100         WHEN OTHER                                               06310099
063200             SET DP013-LOGIC-ABEND TO TRUE                        06320099
063300             SET DP013-NO-ROLLBACK TO TRUE                        06330099
063400             MOVE '1000-CONTROL-PROCESSING'                       06340099
063500                                   TO DP013-PARAGRAPH             06350099
063600             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06360099
063700                                   TO DP013-MESSAGE-TEXT(1)       06370099
063800             PERFORM DP013-0000-PROCESS-ABEND                     06380099
063900     END-EVALUATE.                                                06390099
064000                                                                  06400099
064100/                                                                 06410099
064200*----------------------------------------------------------------*06420099
064300* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *06430099
064400*----------------------------------------------------------------*06440099
064500                                                                  06450099
064600 1100-PROCESS-INTER-APPL-COMM.                                    06460099
064700                                                                  06470099
064800     SET PS-COMMAREA-VALID         TO TRUE.                       06480099
064900     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06490099
065000                                                                  06500099
065100/                                                                 06510099
065200*----------------------------------------------------------------*06520099
065300* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06530099
065400* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06540099
065500* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06550099
065600* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06560099
065700* FUNCTION KEYS CAN GET THIS FAR.                                *06570099
065800*----------------------------------------------------------------*06580099
065900                                                                  06590099
066000 2000-PROCESS-PANEL.                                              06600099
066100     SET PS-NEXT-SCREEN TO TRUE.                                  06610099
066200     EVALUATE TRUE                                                06620099
066300         WHEN DP020-SRC-AID = DP016-CLEAR                         06630099
066400             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06640099
066500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06650099
066600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06660099
066700                                                                  06670099
066800         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06680099
066900             MOVE ASC-KEY-OPER-UNT-ID                             06690099
067000                                   TO DK-OPER-UNT-ID              06700099
067100             MOVE ASC-KEY-FCLTY-ID TO DK-FCLTY-ID                 06710099
067200             PERFORM 2050-DELETE-LIST-QUEUE                       06720099
067300             PERFORM 4000-BUILD-INITIAL-PANEL                     06730099
067400             PERFORM 3200-RESET-ATTRIBUTES                        06740099
067500                                                                  06750099
067600         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    06760099
067700             PERFORM 2140-DESELECT-ALL-ITEMS                      06770099
067800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06780099
067900                                                                  06790099
068000         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  06800099
068100             PERFORM 2150-SELECT-ALL-ITEMS                        06810099
068200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06820099
068300                                                                  06830099
068400         WHEN OTHER                                               06840099
068500             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06850099
068600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06860099
068700             IF  PS-NO-ERROR                                      06870099
068800                 SET DP030-CONTINUE-GO TO TRUE                    06880099
068900                 PERFORM 2100-CHECK-FUNCTION-KEY                  06890099
069000             ELSE                                                 06900099
069100                 SET DP030-OVERRIDE-GO TO TRUE                    06910099
069200             END-IF                                               06920099
069300     END-EVALUATE.                                                06930099
069400                                                                  06940099
069500/                                                                 06950099
069600*----------------------------------------------------------------*06960099
069700*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06970099
069800*----------------------------------------------------------------*06980099
069900 2050-DELETE-LIST-QUEUE.                                          06990099
070000                                                                  07000099
070100     EXEC CICS                                                    07010099
070200         DELETEQ TS                                               07020099
070300           QUEUE (ASC-LIST-QUEUE-NAME)                            07030099
070400            RESP (PV-CICS-RESP)                                   07040099
070500     END-EXEC.                                                    07050099
070600                                                                  07060099
070700     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07070099
070800        (PV-CICS-RESP = DFHRESP(QIDERR))                          07080099
070900         CONTINUE                                                 07090099
071000     ELSE                                                         07100099
071100         SET DP013-CICS-ABEND      TO TRUE                        07110099
071200         SET DP013-NO-ROLLBACK     TO TRUE                        07120099
071300                                                                  07130099
071400         MOVE '2050-DELETE-LIST-QUEUE'                            07140099
071500                                   TO DP013-PARAGRAPH             07150099
071600         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    07160099
071700                                   TO DP013-MESSAGE-TEXT (1)      07170099
071800         PERFORM DP013-0000-PROCESS-ABEND                         07180099
071900     END-IF.                                                      07190099
072000                                                                  07200099
072100     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  07210099
072200                                                                  07220099
072300/                                                                 07230099
072400*----------------------------------------------------------------*07240099
072500* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*07250099
072600* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *07260099
072700* CICS ARCHITECTURE API.                                         *07270099
072800*----------------------------------------------------------------*07280099
072900 2100-CHECK-FUNCTION-KEY.                                         07290099
073000                                                                  07300099
073100     SET PS-NEXT-SCREEN TO TRUE.                                  07310099
073200     EVALUATE TRUE                                                07320099
073300         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               07330099
073400             IF  ASC-NUMBER-OF-SELECTED-ITEMS = ZERO              07340099
073500                 MOVE PC-TSYMSG-01692  TO DP020-MSG-NUMBER        07350099
073600                 SET DP020-MSG-FATAL   TO TRUE                    07360099
073700                 MOVE -1               TO MR-SELECTL (1)          07370099
073800                 SET DP030-SET-CURSOR-APPL-1                      07380099
073900                                       TO TRUE                    07390099
074000                 SET PS-ERROR          TO TRUE                    07400099
074100                 SET ASC-NO-TSQ-UPDATE TO TRUE                    07410099
074200             ELSE                                                 07420099
074300                 PERFORM 5000-PREPARE-SEL-QUEUE                   07430099
074400                 PERFORM 4410-READ-TEMP-STORAGE                   07440099
074500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07450099
074600             END-IF                                               07460099
074700                                                                  07470099
074800         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  07480099
074900*  UPDATE                                                         07490099
075000         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               07500099
075100             SET ASC-NO-TSQ-UPDATE TO TRUE                        07510099
075200             PERFORM 5000-PREPARE-SEL-QUEUE                       07520099
075300             PERFORM 4410-READ-TEMP-STORAGE                       07530099
075400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07540099
075500                                                                  07550099
075600         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07560099
075700             MOVE +1               TO PV-TOP-ITEM                 07570099
075800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07580099
075900             PERFORM 3200-RESET-ATTRIBUTES                        07590099
076000                                                                  07600099
076100         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07610099
076200             PERFORM 2110-BROWSE-BACKWARD                         07620099
076300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07630099
076400             PERFORM 3200-RESET-ATTRIBUTES                        07640099
076500                                                                  07650099
076600         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07660099
076700             PERFORM 2120-BROWSE-FORWARD                          07670099
076800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07680099
076900             PERFORM 3200-RESET-ATTRIBUTES                        07690099
077000                                                                  07700099
077100         WHEN DP020-SRC-AID = DP016-ENTER                         07710099
077200             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   07720099
077300             IF  PS-NO-ERROR                                      07730099
077400                 IF ASC-OPER-UNT-ID = ASC-KEY-OPER-UNT-ID         07740099
077500                     AND                                          07750099
077600                     ASC-FCLTY-ID = ASC-KEY-FCLTY-ID              07760099
077700                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07770099
077800                     PERFORM 3200-RESET-ATTRIBUTES                07780099
077900                 ELSE                                             07790099
078000                     MOVE ASC-OPER-UNT-ID                         07800099
078100                                   TO DK-OPER-UNT-ID              07810099
078200                                      ASC-KEY-OPER-UNT-ID         07820099
078300                     MOVE ASC-FCLTY-ID TO DK-FCLTY-ID             07830099
078400                                          ASC-KEY-FCLTY-ID        07840099
078500                     PERFORM 2050-DELETE-LIST-QUEUE               07850099
078600                     PERFORM 4000-BUILD-INITIAL-PANEL             07860099
078700                     PERFORM 3200-RESET-ATTRIBUTES                07870099
078800                 END-IF                                           07880099
078900             ELSE                                                 07890099
079000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07900099
079100             END-IF                                               07910099
079200                                                                  07920099
079300         WHEN OTHER                                               07930099
079400             SET DP013-NO-ROLLBACK                                07940099
079500                 DP013-XCTL-DISPLAY-RESTART                       07950099
079600                 DP013-CICS-ABEND  TO TRUE                        07960099
079700             MOVE '2100-CHECK-FUNCTION-KEY'                       07970099
079800                                   TO DP013-PARAGRAPH             07980099
079900             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07990099
080000                                   TO DP013-MESSAGE-TEXT (1)      08000099
080100             PERFORM DP013-0000-PROCESS-ABEND                     08010099
080200     END-EVALUATE.                                                08020099
080300                                                                  08030099
080400/                                                                 08040099
080500*----------------------------------------------------------------*08050099
080600*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *08060099
080700*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *08070099
080800*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *08080099
080900*    MESSAGE.                                                    *08090099
081000*----------------------------------------------------------------*08100099
081100                                                                  08110099
081200 2110-BROWSE-BACKWARD.                                            08120099
081300                                                                  08130099
081400     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    08140099
081500         GIVING PV-TOP-ITEM.                                      08150099
081600                                                                  08160099
081700     IF  ((PV-TOP-ITEM < +1)                                      08170099
081800       OR (PV-TOP-ITEM = +1))                                     08180099
081900         MOVE +1                   TO PV-TOP-ITEM                 08190099
082000*        -- TOP OF LIST --                                        08200099
082100         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            08210099
082200         SET DP020-MSG-INFORMATIONAL                              08220099
082300                                   TO TRUE                        08230099
082400     END-IF.                                                      08240099
082500                                                                  08250099
082600/                                                                 08260099
082700*----------------------------------------------------------------*08270099
082800*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *08280099
082900*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *08290099
083000*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *08300099
083100*----------------------------------------------------------------*08310099
083200                                                                  08320099
083300 2120-BROWSE-FORWARD.                                             08330099
083400                                                                  08340099
083500     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              08350099
083600         GIVING PV-TOP-ITEM.                                      08360099
083700                                                                  08370099
083800     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   08380099
083900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08390099
084000                                   TO PV-TOP-ITEM                 08400099
084100*        -- BOTTOM OF LIST --                                     08410099
084200         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08420099
084300         SET DP020-MSG-INFORMATIONAL                              08430099
084400                                   TO TRUE                        08440099
084500     ELSE                                                         08450099
084600         COMPUTE PV-BOTTOM-ITEM =                                 08460099
084700             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 08470099
084800         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            08480099
084900*            -- BOTTOM OF LIST --                                 08490099
085000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08500099
085100             SET DP020-MSG-INFORMATIONAL                          08510099
085200                                   TO TRUE                        08520099
085300         END-IF                                                   08530099
085400     END-IF.                                                      08540099
085500                                                                  08550099
085600/                                                                 08560099
085700*----------------------------------------------------------------*08570099
085800*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *08580099
085900*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *08590099
086000*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *08600099
086100*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *08610099
086200*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *08620099
086300*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *08630099
086400*----------------------------------------------------------------*08640099
086500                                                                  08650099
086600 2130-CHECK-FOR-JUMP-BROWSE.                                      08660099
086700                                                                  08670099
086800     SET PS-NO-ERROR               TO TRUE.                       08680099
086900     IF (ASC-START-ITEM-REQUEST = SPACE)                          08690099
087000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08700099
087100                                   TO PV-TOP-ITEM                 08710099
087200     ELSE                                                         08720099
087300         MOVE ASC-START-ITEM-REQUEST                              08730099
087400                                   TO DP010I-UNEDITED-FIELD       08740099
087500         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       08750099
087600         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     08760099
087700         SET DP010I-NEGATIVE-NOT-ALLOWED                          08770099
087800                                   TO TRUE                        08780099
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08791099
263455              USING DP010I-NUMERIC-EDIT-AREA                      08792099
088000                                                                  08800099
088100         IF  NOT DP010I-ERROR-DETECTED                            08810099
088200             MOVE DP010I-NUMERIC-FIELD                            08820099
088300                                   TO ASC-START-ITEM-REQUEST-N    08830099
088400             IF  ASC-START-ITEM-REQUEST-N > ZERO                  08840099
088500                 IF  ASC-START-ITEM-REQUEST-N >                   08850099
088600                                          ASC-NUMBER-OF-ITEMS-READ08860099
088700                     MOVE SPACE TO ASC-START-ITEM-REQUEST         08870099
088800                     COMPUTE PV-TOP-ITEM =                        08880099
088900                             ASC-NUMBER-OF-ITEMS-READ             08890099
089000                             - PC-ITEMS-PER-PANEL + 1             08900099
089100                     IF  PV-TOP-ITEM < +1                         08910099
089200                         MOVE +1   TO PV-TOP-ITEM                 08920099
089300                         MOVE PC-TSYMSG-00070                     08930099
089400                                   TO DP020-MSG-NUMBER            08940099
089500                         SET DP020-MSG-INFORMATIONAL              08950099
089600                                   TO TRUE                        08960099
089700                     END-IF                                       08970099
089800                 ELSE                                             08980099
089900                     MOVE ASC-START-ITEM-REQUEST-N                08990099
090000                                   TO PV-TOP-ITEM                 09000099
090100                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      09010099
090200                     COMPUTE PV-BOTTOM-ITEM =                     09020099
090300                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     09030099
090400                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ09040099
090500*                        -- BOTTOM OF LIST --                     09050099
090600                         MOVE PC-TSYMSG-00070                     09060099
090700                                   TO DP020-MSG-NUMBER            09070099
090800                         SET DP020-MSG-INFORMATIONAL              09080099
090900                                   TO TRUE                        09090099
091000                     END-IF                                       09100099
091100                 END-IF                                           09110099
091200             ELSE                                                 09120099
091300*                --- VALUE OUT OF RANGE ----                      09130099
091400                 MOVE PC-TSYMSG-00101                             09140099
091500                                   TO DP020-MSG-NUMBER            09150099
091600                 MOVE -1           TO ASTRTITL                    09160099
091700                 SET DP030-SET-CURSOR-APPL-1                      09170099
091800                                   TO TRUE                        09180099
091900                 MOVE DP015-REVERSE                               09190099
092000                                   TO ASTRTITH                    09200099
092100                 MOVE DP015-RED    TO ASTRTITC                    09210099
092200                 MOVE DP015-UNP-NUM-BRT-MDT                       09220099
092300                                   TO ASTRTITA                    09230099
092400                 SET DP020-MSG-FATAL                              09240099
092500                                   TO TRUE                        09250099
092600                 SET PS-ERROR      TO TRUE                        09260099
092700             END-IF                                               09270099
092800                                                                  09280099
092900         ELSE                                                     09290099
093000             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09300099
093100             MOVE -1               TO ASTRTITL                    09310099
093200             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09320099
093300             MOVE DP015-REVERSE    TO ASTRTITH                    09330099
093400             MOVE DP015-RED        TO ASTRTITC                    09340099
093500             MOVE DP015-UNP-NUM-BRT-MDT                           09350099
093600                                   TO ASTRTITA                    09360099
093700             SET DP020-MSG-FATAL   TO TRUE                        09370099
093800             SET PS-ERROR          TO TRUE                        09380099
093900         END-IF                                                   09390099
094000     END-IF.                                                      09400099
094100                                                                  09410099
094200/                                                                 09420099
094300*----------------------------------------------------------------*09430099
094400*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *09440099
094500*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *09450099
094600*----------------------------------------------------------------*09460099
094700 2140-DESELECT-ALL-ITEMS.                                         09470099
094800                                                                  09480099
094900     MOVE +1                       TO ASC-BLK-SUB.                09490099
095000                                                                  09500099
095100     PERFORM 2141-CLEAR-SELECTED-INDS                             09510099
095200         VARYING ASC-ITEM-SUB                                     09520099
095300         FROM 1 BY 1                                              09530099
095400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09540099
095500                                                                  09550099
095600     ADD +1                        TO ASC-BLK-SUB.                09560099
095700                                                                  09570099
095800     PERFORM 2141-CLEAR-SELECTED-INDS                             09580099
095900         VARYING ASC-ITEM-SUB                                     09590099
096000         FROM 1 BY 1                                              09600099
096100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09610099
096200                                                                  09620099
096300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09630099
096400                                   TO PV-LIST-ITEM-NUMBER.        09640099
096500                                                                  09650099
096600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09660099
096700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09670099
096800                                                                  09680099
096900     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09690099
097000        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      09700099
097100         MOVE +1                   TO ASC-BLK-SUB                 09710099
097200                                                                  09720099
097300         PERFORM 5100-WRITE-TEMP-STORAGE                          09730099
097400                                                                  09740099
097500         MOVE +1                   TO PV-BLOCK-NUMBER             09750099
097600                                                                  09760099
097700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09770099
097800             PV-FIRST-BLOCK-IN-ARRAY - 1                          09780099
097900                                                                  09790099
098000         PERFORM                                                  09800099
098100             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09810099
098200                                                                  09820099
098300             PERFORM 4410-READ-TEMP-STORAGE                       09830099
098400                                                                  09840099
098500             PERFORM 2141-CLEAR-SELECTED-INDS                     09850099
098600                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 09860099
098700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09870099
098800                                                                  09880099
098900             PERFORM 5100-WRITE-TEMP-STORAGE                      09890099
099000                                                                  09900099
099100             ADD +1                TO PV-BLOCK-NUMBER             09910099
099200                                                                  09920099
099300         END-PERFORM                                              09930099
099400                                                                  09940099
099500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09950099
099600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09960099
099700                                                                  09970099
099800         PERFORM                                                  09980099
099900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09990099
100000                   ASC-HIGHEST-BLOCK-WRITTEN                      10000099
100100                                                                  10010099
100200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10020099
100300                                   TO PV-BLOCK-NUMBER             10030099
100400                                                                  10040099
100500             PERFORM 4410-READ-TEMP-STORAGE                       10050099
100600                                                                  10060099
100700             PERFORM 2141-CLEAR-SELECTED-INDS                     10070099
100800                 VARYING ASC-ITEM-SUB                             10080099
100900                 FROM 1 BY 1                                      10090099
101000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10100099
101100                                                                  10110099
101200             PERFORM 5100-WRITE-TEMP-STORAGE                      10120099
101300                                                                  10130099
101400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10140099
101500                                                                  10150099
101600         END-PERFORM                                              10160099
101700                                                                  10170099
101800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10180099
101900                                   TO PV-BLOCK-NUMBER             10190099
102000                                                                  10200099
102100         PERFORM 4410-READ-TEMP-STORAGE                           10210099
102200     END-IF.                                                      10220099
102300                                                                  10230099
102400                                                                  10240099
102500     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS10250099
102600     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.10260099
102700     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  10270099
102800                                                                  10280099
102900     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10290099
103000                                                                  10300099
103100/                                                                 10310099
103200*----------------------------------------------------------------*10320099
103300*    MARK EACH ITEM AS BEING NOT SELECTED.                       *10330099
103400*----------------------------------------------------------------*10340099
103500                                                                  10350099
103600 2141-CLEAR-SELECTED-INDS.                                        10360099
103700                                                                  10370099
103800     IF  ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)          10380099
103900             NOT EQUAL ZERO                                       10390099
104000         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10400099
104100             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10410099
104200                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    10420099
104300                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10430099
104400                                   TO TRUE                        10440099
104500         END-IF                                                   10450099
104600     END-IF.                                                      10460099
104700                                                                  10470099
104800/                                                                 10480099
104900*----------------------------------------------------------------*10490099
105000*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *10500099
105100*  FOR ALL ITEMS.                                                *10510099
105200*----------------------------------------------------------------*10520099
105300                                                                  10530099
105400 2150-SELECT-ALL-ITEMS.                                           10540099
105500                                                                  10550099
105600     MOVE +1                       TO ASC-BLK-SUB.                10560099
105700                                                                  10570099
105800     PERFORM 2151-SET-SELECTED-INDS                               10580099
105900         VARYING ASC-ITEM-SUB                                     10590099
106000         FROM 1 BY 1                                              10600099
106100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10610099
106200                                                                  10620099
106300     ADD +1                        TO ASC-BLK-SUB.                10630099
106400                                                                  10640099
106500     PERFORM 2151-SET-SELECTED-INDS                               10650099
106600         VARYING ASC-ITEM-SUB                                     10660099
106700         FROM 1 BY 1                                              10670099
106800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10680099
106900                                                                  10690099
107000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10700099
107100                                   TO PV-LIST-ITEM-NUMBER.        10710099
107200                                                                  10720099
107300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10730099
107400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10740099
107500                                                                  10750099
107600     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10760099
107700        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    10770099
107800         MOVE +1                   TO ASC-BLK-SUB                 10780099
107900                                                                  10790099
108000         PERFORM 5100-WRITE-TEMP-STORAGE                          10800099
108100                                                                  10810099
108200         MOVE +1                   TO PV-BLOCK-NUMBER             10820099
108300                                                                  10830099
108400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10840099
108500             PV-FIRST-BLOCK-IN-ARRAY - 1                          10850099
108600                                                                  10860099
108700         PERFORM                                                  10870099
108800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10880099
108900                                                                  10890099
109000             PERFORM 4410-READ-TEMP-STORAGE                       10900099
109100                                                                  10910099
109200             PERFORM 2151-SET-SELECTED-INDS                       10920099
109300                 VARYING ASC-ITEM-SUB                             10930099
109400                 FROM 1 BY 1                                      10940099
109500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10950099
109600                                                                  10960099
109700             PERFORM 5100-WRITE-TEMP-STORAGE                      10970099
109800                                                                  10980099
109900             ADD +1                TO PV-BLOCK-NUMBER             10990099
110000         END-PERFORM                                              11000099
110100                                                                  11010099
110200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11020099
110300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11030099
110400                                                                  11040099
110500         PERFORM                                                  11050099
110600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11060099
110700                   ASC-HIGHEST-BLOCK-WRITTEN                      11070099
110800                                                                  11080099
110900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11090099
111000                                   TO PV-BLOCK-NUMBER             11100099
111100                                                                  11110099
111200             PERFORM 4410-READ-TEMP-STORAGE                       11120099
111300                                                                  11130099
111400             PERFORM 2151-SET-SELECTED-INDS                       11140099
111500                 VARYING ASC-ITEM-SUB                             11150099
111600                 FROM 1 BY 1                                      11160099
111700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11170099
111800                                                                  11180099
111900             PERFORM 5100-WRITE-TEMP-STORAGE                      11190099
112000                                                                  11200099
112100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11210099
112200         END-PERFORM                                              11220099
112300                                                                  11230099
112400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11240099
112500                                   TO PV-BLOCK-NUMBER             11250099
112600                                                                  11260099
112700         PERFORM 4410-READ-TEMP-STORAGE                           11270099
112800     END-IF.                                                      11280099
112900                                                                  11290099
113000                                                                  11300099
113100     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             11310099
113200          ASC-NUMBER-OF-SELECTED-ITEMS.                           11320099
113300                                                                  11330099
113400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11340099
113500                                                                  11350099
113600/                                                                 11360099
113700*----------------------------------------------------------------*11370099
113800*    MARK EACH ITEM AS BEING SELECTED.                           *11380099
113900*----------------------------------------------------------------*11390099
114000                                                                  11400099
114100 2151-SET-SELECTED-INDS.                                          11410099
114200                                                                  11420099
114300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11430099
114400             NOT EQUAL ZERO                                       11440099
114500         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11450099
114600             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11460099
114700                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        11470099
114800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11480099
114900                                   TO TRUE                        11490099
115000         END-IF                                                   11500099
115100     END-IF.                                                      11510099
115200                                                                  11520099
115300/                                                                 11530099
115400*----------------------------------------------------------------*11540099
115500*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *11550099
115600*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *11560099
115700*----------------------------------------------------------------*11570099
115800 2200-MOVE-SCREEN-TO-COMMAREA.                                    11580099
115900                                                                  11590099
116000     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             11600099
116100     MOVE +1                       TO PV-SUB.                     11610099
116200                                                                  11620099
116300     PERFORM 3100-SET-SUBSCRIPTS.                                 11630099
116400                                                                  11640099
116500     IF  ASTRTITL > ZERO                                          11650099
116600         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      11660099
116700     ELSE                                                         11670099
116800         IF  ASTRTITF = DP015-ERASE-EOF                           11680099
116900             INITIALIZE ASC-START-ITEM-REQUEST                    11690099
117000         END-IF                                                   11700099
117100     END-IF.                                                      11710099
117200                                                                  11720099
117300     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          11730099
117400         VARYING PV-SUB                                           11740099
117500         FROM 1 BY 1                                              11750099
117600         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      11760099
117700                                                                  11770099
117800/                                                                 11780099
117900*----------------------------------------------------------------*11790099
118000*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *11800099
118100*----------------------------------------------------------------*11810099
118200 2210-MOVE-LINES-TO-COMMAREA.                                     11820099
118300                                                                  11830099
118400     IF  MR-SELECTL (PV-SUB) > ZERO                               11840099
118500         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     11850099
118600                                   TO TRUE                        11860099
118700         MOVE MR-SELECT (PV-SUB)   TO ASC-TEMP-SELECTED-SW        11870099
118800                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11880099
118900     ELSE                                                         11890099
119000         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                11900099
119100             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         11910099
119200             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        11920099
119300                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11930099
119400         END-IF                                                   11940099
119500     END-IF.                                                      11950099
119600                                                                  11960099
119700     IF  MR-U-STORE-ZONE-L (PV-SUB) > ZERO                        11970099
119800         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     11980099
119900                                   TO TRUE                        11990099
120000         MOVE MR-U-STORE-ZONE (PV-SUB)                            12000099
120100                                   TO ASC-U-STORE-ZONE            12010099
120200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12020099
120300     ELSE                                                         12030099
120400         IF  MR-U-STORE-ZONE-A (PV-SUB) = DP015-ERASE-EOF         12040099
120500             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         12050099
120600             MOVE SPACE            TO ASC-U-STORE-ZONE            12060099
120700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12070099
120800         END-IF                                                   12080099
120900     END-IF.                                                      12090099
121000                                                                  12100099
121100                                                                  12110099
121200     ADD +1                        TO ASC-ITEM-SUB.               12120099
121300                                                                  12130099
121400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12140099
121500         ADD +1                    TO ASC-BLK-SUB                 12150099
121600         MOVE +1                   TO ASC-ITEM-SUB                12160099
121700     END-IF.                                                      12170099
121800                                                                  12180099
121900/                                                                 12190099
122000*----------------------------------------------------------------*12200099
122100*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *12210099
122200*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *12220099
122300*----------------------------------------------------------------*12230099
122400 3000-EDIT-DATA-IN-COMMAREA.                                      12240099
122500                                                                  12250099
122600     SET PS-NO-ERROR               TO TRUE.                       12260099
122700                                                                  12270099
122800     PERFORM 3200-RESET-ATTRIBUTES.                               12280099
122900                                                                  12290099
123000     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     12300099
123100**                                                                12310099
123200* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              12320099
123300* EDITTING IS DONE FROM THE BOTTOM UP.                            12330099
123400**                                                                12340099
123500     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       12350099
123600         ASC-ITEMS-DISPLAYED - 1.                                 12360099
123700                                                                  12370099
123800     PERFORM 3100-SET-SUBSCRIPTS.                                 12380099
123900     PERFORM 3001-BUILD-ZONE-TABLE                                12390099
124000     PERFORM 3300-EDIT-SELECTIONS                                 12400099
124100         VARYING PV-SUB                                           12410099
124200         FROM PV-SUB BY -1                                        12420099
124300         UNTIL PV-SUB < +1                                        12430099
124400                                                                  12440099
124500*  EDIT FCLTY ID                                                  12450099
124600     MOVE ASC-FCLTY-ID-X           TO DP010I-UNEDITED-FIELD       12460099
124700     MOVE PC-4                     TO DP010I-MAXIMUM-DIGITS       12470099
124800     MOVE +0                       TO DP010I-MAXIMUM-DECIMALS     12480099
124900     SET DP010I-NEGATIVE-NOT-ALLOWED                              12490099
125000                                   TO TRUE                        12500099
263455     CALL DP010I-NUMERIC-EDIT-ROUTINE                             12511099
263455          USING DP010I-NUMERIC-EDIT-AREA                          12512099
125200                                                                  12520099
125300     IF  NOT DP010I-ERROR-DETECTED                                12530099
125400         MOVE DP010I-NUMERIC-FIELD                                12540099
125500                                   TO ASC-FCLTY-ID                12550099
125600                                      DK-FCLTY-ID                 12560099
125700     ELSE                                                         12570099
125800         MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER                12580099
125900         MOVE -1               TO MR-FCLTYL                       12590099
126000         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      12600099
126100         MOVE DP015-REVERSE    TO MR-FCLTYH                       12610099
126200         MOVE DP015-RED        TO MR-FCLTYC                       12620099
126300         MOVE DP015-UNP-NUM-BRT-MDT                               12630099
126400                                   TO MR-FCLTYA                   12640099
126500         SET DP020-MSG-FATAL   TO TRUE                            12650099
126600         SET PS-ERROR          TO TRUE                            12660099
126700     END-IF                                                       12670099
126800                                                                  12680099
126900                                                                  12690099
127000*  EDIT OPER ID                                                   12700099
127100     MOVE ASC-OPER-UNT-ID          TO DK-OPER-UNT-ID              12710099
127200     PERFORM 4320-GET-STORE-INFORMATION.                          12720099
127300**??                                                              12730099
127400     IF ASC-FCLTY-NME = SPACES                                    12740099
127500         MOVE ALL '?'          TO MR-FDESC                        12750099
127600     END-IF                                                       12760099
127700                                                                  12770099
127800     IF  PS-NO-ERROR                                              12780099
127900         PERFORM 3400-CHECK-RANGE-SEQUENCE                        12790099
128000     END-IF.                                                      12800099
128100                                                                  12810099
128200     IF  ((PS-NO-ERROR)                                           12820099
128300       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   12830099
128400       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    12840099
128500             PERFORM 3500-MARK-RANGE-AS-SELECTED                  12850099
128600     END-IF.                                                      12860099
128700                                                                  12870099
128800 3001-BUILD-ZONE-TABLE.                                           12880099
128900     INITIALIZE PT-ZONE-TABLE                                     12890099
129000     PERFORM 7000-OPEN-TSTRZN-CURSOR.                             12900099
129100     PERFORM 7100-FETCH-TSTRZN-CURSOR.                            12910099
129200     PERFORM VARYING PT-ZONE-IDX FROM 1 BY 1                      12920099
129300             UNTIL SQLCODE = +100 OR PT-ZONE-IDX > 50             12930099
129400         MOVE STRZN-STR-ZN-ID      TO PT-ZONE-ID (PT-ZONE-IDX)    12940099
129500         MOVE STRZN-STR-ZN-DESC    TO PT-ZONE-DESC (PT-ZONE-IDX)  12950099
129600         PERFORM 7100-FETCH-TSTRZN-CURSOR                         12960099
129700     END-PERFORM.                                                 12970099
129800     PERFORM 7200-CLOSE-TSTRZN-CURSOR.                            12980099
129801                                                                  12980199
129802                                                                  12980299
129810     INITIALIZE PT-HANG-FOLD-ZONE-TABLE.                          12981099
129820     PERFORM 7210-OPEN-HANG-FOLD-CURSOR.                          12982099
129830     PERFORM 7220-FETCH-HANG-FOLD-CURSOR.                         12983099
129840     PERFORM VARYING PT-HANG-FOLD-ZONE-IDX FROM 1 BY 1            12984099
129850             UNTIL SQLCODE = +100 OR PT-HANG-FOLD-ZONE-IDX > 50   12985099
129860         MOVE PV-WST-STORE-ZONE                                   12986099
129861           TO PT-HANG-FOLD-ZONE(PT-HANG-FOLD-ZONE-IDX)            12986199
129880         PERFORM 7220-FETCH-HANG-FOLD-CURSOR                      12988099
129890     END-PERFORM.                                                 12989099
129891     PERFORM 7230-CLOSE-HANG-FOLD-CURSOR.                         12989199
129900                                                                  12990099
129910                                                                  12991099
129920                                                                  12992099
130000/                                                                 13000099
130100*----------------------------------------------------------------*13010099
130200*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *13020099
130300*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*13030099
130400*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *13040099
130500*                                                                *13050099
130600*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *13060099
130700*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *13070099
130800*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *13080099
130900*    US IN THE 2ND BLOCK OF THE ARRAY.                           *13090099
131000*----------------------------------------------------------------*13100099
131100                                                                  13110099
131200 3100-SET-SUBSCRIPTS.                                             13120099
131300                                                                  13130099
131400     COMPUTE ASC-ITEM-SUB =                                       13140099
131500         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        13150099
131600                                                                  13160099
131700     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         13170099
131800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            13180099
131900                                                                  13190099
132000         MOVE PC-MAX-BLOCKS-IN-ARRAY                              13200099
132100                                   TO ASC-BLK-SUB                 13210099
132200     ELSE                                                         13220099
132300         MOVE +1                   TO ASC-BLK-SUB                 13230099
132400     END-IF.                                                      13240099
132500                                                                  13250099
132600*----------------------------------------------------------------*13260099
132700*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *13270099
132800*----------------------------------------------------------------*13280099
132900                                                                  13290099
133000 3200-RESET-ATTRIBUTES.                                           13300099
133100                                                                  13310099
133200     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA                    13320099
133300     MOVE DP015-GREEN              TO ASTRTITC                    13330099
133400     MOVE DP015-UNDERLINE          TO ASTRTITH                    13340099
133500                                                                  13350099
133600         PERFORM                                                  13360099
133700             VARYING PV-SUB                                       13370099
133800             FROM 1 BY 1                                          13380099
133900             UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                   13390099
134000             EVALUATE TRUE                                        13400099
134100             WHEN ASC-TEST-CICS                                   13410099
134200                 IF  DP020-LOCATION-NBR = 090                     13420099
134300                     MOVE DP015-UNP-ALP-NOR-OFF                   13430099
134400                                   TO MR-SELECTA (PV-SUB)         13440099
134500                                      MR-U-STORE-ZONE-A (PV-SUB)  13450099
134600                     MOVE DP015-ASK-NOR-OFF                       13460099
134700                                   TO MR-ACTIONA (PV-SUB)         13470099
134800                     MOVE DP015-GREEN                             13480099
134900                                   TO MR-SELECTC (PV-SUB)         13490099
135000                                      MR-U-STORE-ZONE-C (PV-SUB)  13500099
135100                     MOVE DP015-BLUE                              13510099
135200                                   TO MR-ACTIONC (PV-SUB)         13520099
135300                     MOVE DP015-UNDERLINE                         13530099
135400                                   TO MR-SELECTH (PV-SUB)         13540099
135500                                      MR-U-STORE-ZONE-H (PV-SUB)  13550099
135600                 ELSE                                             13560099
135700                     IF DP020-LOCATION-NBR = ASC-OPER-UNT-ID      13570099
135800                         MOVE DP015-UNP-ALP-NOR-OFF               13580099
135900                                   TO MR-SELECTA (PV-SUB)         13590099
136000                                      MR-U-STORE-ZONE-A (PV-SUB)  13600099
136100                         MOVE DP015-ASK-NOR-OFF                   13610099
136200                                   TO MR-ACTIONA (PV-SUB)         13620099
136300                         MOVE DP015-GREEN                         13630099
136400                                   TO MR-SELECTC (PV-SUB)         13640099
136500                                      MR-U-STORE-ZONE-C (PV-SUB)  13650099
136600                         MOVE DP015-BLUE                          13660099
136700                                   TO MR-ACTIONC (PV-SUB)         13670099
136800                         MOVE DP015-UNDERLINE                     13680099
136900                                   TO MR-SELECTH (PV-SUB)         13690099
137000                                      MR-U-STORE-ZONE-H (PV-SUB)  13700099
137100                     ELSE                                         13710099
137200                         MOVE DP015-ASK-NOR-OFF                   13720099
137300                                   TO MR-SELECTA (PV-SUB)         13730099
137400                                      MR-U-STORE-ZONE-A (PV-SUB)  13740099
137500                                      MR-ACTIONA (PV-SUB)         13750099
137600                         MOVE DP015-BLUE                          13760099
137700                                   TO MR-SELECTC (PV-SUB)         13770099
137800                                      MR-U-STORE-ZONE-C (PV-SUB)  13780099
137900                                      MR-ACTIONC (PV-SUB)         13790099
138000                         MOVE DP015-HL-OFF                        13800099
138100                                   TO MR-SELECTH (PV-SUB)         13810099
138200                                      MR-U-STORE-ZONE-H (PV-SUB)  13820099
138300                                      MR-ACTIONH (PV-SUB)         13830099
138400                     END-IF                                       13840099
138500                 END-IF                                           13850099
138600             WHEN OTHER                                           13860099
138700                 IF DP020-LOCATION-NBR = ASC-OPER-UNT-ID          13870099
138800                     MOVE DP015-UNP-ALP-NOR-OFF                   13880099
138900                                   TO MR-SELECTA (PV-SUB)         13890099
139000                                      MR-U-STORE-ZONE-A (PV-SUB)  13900099
139100                     MOVE DP015-ASK-NOR-OFF                       13910099
139200                                   TO MR-ACTIONA (PV-SUB)         13920099
139300                     MOVE DP015-GREEN                             13930099
139400                                   TO MR-SELECTC (PV-SUB)         13940099
139500                                      MR-U-STORE-ZONE-C (PV-SUB)  13950099
139600                     MOVE DP015-BLUE                              13960099
139700                                   TO MR-ACTIONC (PV-SUB)         13970099
139800                     MOVE DP015-UNDERLINE                         13980099
139900                                   TO MR-SELECTH (PV-SUB)         13990099
140000                                      MR-U-STORE-ZONE-H (PV-SUB)  14000099
140100                 ELSE                                             14010099
140200                     MOVE DP015-ASK-NOR-OFF                       14020099
140300                                   TO MR-SELECTA (PV-SUB)         14030099
140400                                      MR-U-STORE-ZONE-A (PV-SUB)  14040099
140500                                      MR-ACTIONA (PV-SUB)         14050099
140600                     MOVE DP015-BLUE                              14060099
140700                                   TO MR-SELECTC (PV-SUB)         14070099
140800                                      MR-U-STORE-ZONE-C (PV-SUB)  14080099
140900                                      MR-ACTIONC (PV-SUB)         14090099
141000                     MOVE DP015-HL-OFF                            14100099
141100                                   TO MR-SELECTH (PV-SUB)         14110099
141200                                      MR-U-STORE-ZONE-H (PV-SUB)  14120099
141300                                      MR-ACTIONH (PV-SUB)         14130099
141400                 END-IF                                           14140099
141500             END-EVALUATE                                         14150099
141600                                                                  14160099
141700         END-PERFORM.                                             14170099
141800                                                                  14180099
141900*----------------------------------------------------------------*14190099
142000*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *14200099
142100*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *14210099
142200*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *14220099
142300*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *14230099
142400*----------------------------------------------------------------*14240099
142500 3300-EDIT-SELECTIONS.                                            14250099
142600                                                                  14260099
142700     MOVE SPACES                   TO ASC-ACTION                  14270099
142800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14280099
142900                                      MR-ACTION (PV-SUB)          14290099
143000                                                                  14300099
143100     EVALUATE TRUE                                                14310099
143200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14320099
143300             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         14330099
143400                 CONTINUE                                         14340099
143500                                                                  14350099
143600         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         14360099
143700             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        14370099
143800                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS14380099
143900                 MOVE ASC-TEMP-SELECTED-SW                        14390099
144000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14400099
144100                                   TO ASC-SELECTED-SW             14410099
144200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14420099
144300             END-IF                                               14430099
144400                                                                  14440099
144500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14450099
144600                 = SPACE                                          14460099
144700             EVALUATE TRUE                                        14470099
144800                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       14480099
144900                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS14490099
145000                     MOVE SPACE    TO ASC-SELECTED-SW             14500099
145100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14510099
145200                                                                  14520099
145300                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        14530099
145400                     MOVE ZERO     TO ASC-START-OF-SELECTED-RANGE 14540099
145500                     MOVE SPACE    TO ASC-SELECTED-SW             14550099
145600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14560099
145700                                                                  14570099
145800                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          14580099
145900                     MOVE ZERO     TO ASC-END-OF-SELECTED-RANGE   14590099
146000                     MOVE SPACE    TO ASC-SELECTED-SW             14600099
146100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14610099
146200             END-EVALUATE                                         14620099
146300                                                                  14630099
146400         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           14640099
146500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14650099
146600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14660099
146700             END-IF                                               14670099
146800             PERFORM 3310-EDIT-RANGE                              14680099
146900                                                                  14690099
147000         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             14700099
147100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14710099
147200                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14720099
147300             END-IF                                               14730099
147400             PERFORM 3310-EDIT-RANGE                              14740099
147500                                                                  14750099
147600         WHEN OTHER                                               14760099
147700             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            14770099
147800             SET DP020-MSG-FATAL   TO TRUE                        14780099
147900             MOVE -1               TO MR-SELECTL (PV-SUB)         14790099
148000             SET DP030-SET-CURSOR-APPL-1                          14800099
148100                                   TO TRUE                        14810099
148200             MOVE DP015-RED        TO MR-SELECTC (PV-SUB)         14820099
148300             MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB)         14830099
148400             SET PS-ERROR          TO TRUE                        14840099
148500             MOVE PC-ERR           TO ASC-ACTION                  14850099
148600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14860099
148700                                      MR-ACTION (PV-SUB)          14870099
148800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14880099
148900                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     14890099
149000                 MOVE SPACE        TO ASC-SELECTED-SW             14900099
149100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14910099
149200             END-IF                                               14920099
149300     END-EVALUATE.                                                14930099
149400                                                                  14940099
149500     IF ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)               14950099
149600         MOVE ASC-U-STORE-ZONE (ASC-BLK-SUB ASC-ITEM-SUB)         14960099
149700                                    TO PV-SEARCH-ZONE             14970099
149800         PERFORM 3301-VERIFY-ZONE                                 14980099
149900         IF PS-INVALID-ZONE                                       14990099
150000             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            15000099
150100             SET DP020-MSG-FATAL   TO TRUE                        15010099
150200             MOVE -1               TO MR-U-STORE-ZONE-L (PV-SUB)  15020099
150300             SET DP030-SET-CURSOR-APPL-1                          15030099
150400                                   TO TRUE                        15040099
150500             MOVE DP015-RED        TO MR-U-STORE-ZONE-C (PV-SUB)  15050099
150600             MOVE DP015-REVERSE    TO MR-U-STORE-ZONE-H (PV-SUB)  15060099
150700             SET PS-ERROR          TO TRUE                        15070099
150800             MOVE PC-ERR           TO ASC-ACTION                  15080099
150900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15090099
151000                                      MR-ACTION (PV-SUB)          15100099
151100         ELSE                                                     15110099
151200             IF  ASC-P2L-FINE-JEWELRY(ASC-BLK-SUB ASC-ITEM-SUB)   15120099
151300                 MOVE ASC-U-STORE-ZONE(ASC-BLK-SUB ASC-ITEM-SUB)  15130099
151400                   TO PV-ZONE-WORK                                15140099
151500                 IF  PV-HANG  OR                                  15150099
151600                     PV-FOLD                                      15160099
151700                     MOVE PC-TSYMSG-03717  TO DP020-MSG-NUMBER    15170099
151800                     SET  DP020-MSG-FATAL  TO TRUE                15180099
151900                     MOVE -1  TO MR-U-STORE-ZONE-L (PV-SUB)       15190099
152000                     SET DP030-SET-CURSOR-APPL-1                  15200099
152100                                           TO TRUE                15210099
152200                     MOVE DP015-RED                               15220099
152300                                  TO MR-U-STORE-ZONE-C (PV-SUB)   15230099
152400                     MOVE DP015-REVERSE                           15240099
152500                                  TO MR-U-STORE-ZONE-H (PV-SUB)   15250099
152600                      SET PS-ERROR         TO TRUE                15260099
152700                      MOVE PC-ERR                                 15270099
152800                                  TO ASC-ACTION                   15280099
152900                                    (ASC-BLK-SUB ASC-ITEM-SUB)    15290099
153000                                     MR-ACTION (PV-SUB)           15300099
153100                 END-IF                                           15310099
153200             END-IF                                               15320099
153300         END-IF                                                   15330099
153301                                                                  15330199
153310         IF  ASC-HANG-FOLD                                        15331099
153320             PERFORM 3302-VERIFY-HANG-FOLD                        15332099
153321             IF PS-INVALID-ZONE                                   15332199
153330                 MOVE PC-TSYMSG-03718  TO DP020-MSG-NUMBER        15333099
153331                 MOVE ASC-P2L-ZONE     TO DP020-MSG-TEXT          15333199
153340                 SET DP020-MSG-FATAL   TO TRUE                    15334099
153350                 MOVE -1             TO MR-U-STORE-ZONE-L (PV-SUB)15335099
153360                 SET DP030-SET-CURSOR-APPL-1                      15336099
153370                                     TO TRUE                      15337099
153380                 MOVE DP015-RED      TO MR-U-STORE-ZONE-C (PV-SUB)15338099
153390                 MOVE DP015-REVERSE  TO MR-U-STORE-ZONE-H (PV-SUB)15339099
153391                 SET PS-ERROR          TO TRUE                    15339199
153392                 MOVE PC-ERR           TO ASC-ACTION              15339299
153393                                        (ASC-BLK-SUB ASC-ITEM-SUB)15339399
153394                                          MR-ACTION (PV-SUB)      15339499
153395             END-IF                                               15339599
153396         END-IF                                                   15339699
153400     END-IF.                                                      15340099
153500                                                                  15350099
153600     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             15360099
153700     SUBTRACT +1 FROM ASC-ITEM-SUB.                               15370099
153800                                                                  15380099
153900     IF  ASC-ITEM-SUB < 1                                         15390099
154000         SUBTRACT +1 FROM ASC-BLK-SUB                             15400099
154100         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                15410099
154200     END-IF.                                                      15420099
154300                                                                  15430099
154400 3301-VERIFY-ZONE.                                                15440099
154500                                                                  15450099
154600     IF PV-SEARCH-ZONE = SPACES                                   15460099
154700         SET PS-INVALID-ZONE TO TRUE                              15470099
154800     ELSE                                                         15480099
154900         SET PT-ZONE-IDX        TO 1                              15490099
155000         SEARCH PT-ZONE-ENTRIES                                   15500099
155100         AT END                                                   15510099
155200             SET PS-INVALID-ZONE TO TRUE                          15520099
155300         WHEN                                                     15530099
155400             PT-ZONE-ID (PT-ZONE-IDX) = SPACES                    15540099
155500             SET PS-INVALID-ZONE TO TRUE                          15550099
155600         WHEN                                                     15560099
155700             PT-ZONE-ID (PT-ZONE-IDX) = PV-SEARCH-ZONE            15570099
155800                 SET PS-VALID-ZONE TO TRUE                        15580099
155900         END-SEARCH                                               15590099
156000     END-IF.                                                      15600099
156100                                                                  15610099
156200     IF  PS-INVALID-ZONE                                          15620099
156300         IF  ASC-HANG-FOLD  OR                                    15630099
156400             ASC-HANG-COMMODITY                                   15640099
156500             MOVE PV-SEARCH-ZONE  TO  PV-ZONE-WORK                15650099
156600             IF  PV-HANG  OR                                      15660099
156700                 PV-FOLD                                          15670099
156800                 SET PS-VALID-ZONE TO TRUE                        15680099
156900             END-IF                                               15690099
157000         END-IF                                                   15700099
157100     END-IF.                                                      15710099
157200                                                                  15720099
157201                                                                  15720199
157202*************************************************************     15720299
157203*IF DC IS SETUP FOR HANG/FOLD THE ZONE CANNOT BE:           *     15720399
157204*            CHILD, JRS, MENS, WOMEN                        *     15720499
157205*************************************************************     15720599
157206 3302-VERIFY-HANG-FOLD.                                           15720699
157207                                                                  15720799
157210     IF  PS-VALID-ZONE                                            15721099
157211         SET PT-HANG-FOLD-ZONE-IDX TO 1                           15721199
157212         SEARCH PT-HANG-FOLD-ZONE-ENTRIES                         15721299
157213         AT END                                                   15721399
157214             SET PS-VALID-ZONE TO TRUE                            15721499
157218         WHEN                                                     15721899
157219             PT-HANG-FOLD-ZONE (PT-HANG-FOLD-ZONE-IDX)            15721999
157220                                                = PV-SEARCH-ZONE  15722099
157221                 SET PS-INVALID-ZONE TO TRUE                      15722199
157223         END-SEARCH                                               15722399
157224     END-IF.                                                      15722499
157230                                                                  15723099
157300                                                                  15730099
157400*----------------------------------------------------------------*15740099
157500*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *15750099
157600*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *15760099
157700*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *15770099
157800*  THE ENDING.                                                   *15780099
157900*----------------------------------------------------------------*15790099
158000 3310-EDIT-RANGE.                                                 15800099
158100                                                                  15810099
158200     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                15820099
158300         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   15830099
158400             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)15840099
158500                                   TO ASC-SELECTED-SW             15850099
158600                                        (ASC-BLK-SUB ASC-ITEM-SUB)15860099
158700             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 15870099
158800         ELSE                                                     15880099
158900             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     15890099
159000                 CONTINUE                                         15900099
159100             ELSE                                                 15910099
159200*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        15920099
159300                 MOVE PC-TSYMSG-00054                             15930099
159400                                   TO DP020-MSG-NUMBER            15940099
159500                 SET DP020-MSG-FATAL                              15950099
159600                                   TO TRUE                        15960099
159700                 MOVE -1           TO MR-SELECTL (PV-SUB)         15970099
159800                 SET DP030-SET-CURSOR-APPL-1                      15980099
159900                                   TO TRUE                        15990099
160000                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         16000099
160100                 MOVE DP015-UNDERLINE                             16010099
160200                                   TO MR-SELECTH (PV-SUB)         16020099
160300                 SET PS-ERROR      TO TRUE                        16030099
160400             END-IF                                               16040099
160500         END-IF                                                   16050099
160600     ELSE                                                         16060099
160700         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     16070099
160800             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 16080099
160900                                   TO ASC-SELECTED-SW             16090099
161000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   16100099
161100             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   16110099
161200         ELSE                                                     16120099
161300             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       16130099
161400                 CONTINUE                                         16140099
161500             ELSE                                                 16150099
161600*                -- ONLY ONE END-OF-RANGE ALLOWED --              16160099
161700                 MOVE PC-TSYMSG-00055                             16170099
161800                                   TO DP020-MSG-NUMBER            16180099
161900                 SET DP020-MSG-FATAL                              16190099
162000                                   TO TRUE                        16200099
162100                 MOVE -1           TO MR-SELECTL (PV-SUB)         16210099
162200                 SET DP030-SET-CURSOR-APPL-1                      16220099
162300                                   TO TRUE                        16230099
162400                 SET PS-ERROR      TO TRUE                        16240099
162500             END-IF                                               16250099
162600         END-IF                                                   16260099
162700     END-IF.                                                      16270099
162800                                                                  16280099
162900*----------------------------------------------------------------*16290099
163000*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *16300099
163100*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *16310099
163200*----------------------------------------------------------------*16320099
163300 3400-CHECK-RANGE-SEQUENCE.                                       16330099
163400                                                                  16340099
163500     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       16350099
163600       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      16360099
163700       AND  ASC-START-OF-SELECTED-RANGE >                         16370099
163800                                         ASC-END-OF-SELECTED-RANGE16380099
163900*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                16390099
164000         MOVE PC-TSYMSG-00052      TO DP020-MSG-NUMBER            16400099
164100         SET DP020-MSG-FATAL       TO TRUE                        16410099
164200         SET PS-ERROR              TO TRUE                        16420099
164300         PERFORM 3410-POSITION-AT-ERROR                           16430099
164400     END-IF.                                                      16440099
164500                                                                  16450099
164600*----------------------------------------------------------------*16460099
164700*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *16470099
164800*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *16480099
164900*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *16490099
165000*----------------------------------------------------------------*16500099
165100 3410-POSITION-AT-ERROR.                                          16510099
165200                                                                  16520099
165300     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       16530099
165400                                                                  16540099
165500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 16550099
165600                    - PV-TOP-ITEM + 1.                            16560099
165700                                                                  16570099
165800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16580099
165900         CONTINUE                                                 16590099
166000     ELSE                                                         16600099
166100         MOVE -1                   TO MR-SELECTL (PV-SUB)         16610099
166200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16620099
166300         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16630099
166400     END-IF.                                                      16640099
166500                                                                  16650099
166600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   16660099
166700                    - PV-TOP-ITEM + 1.                            16670099
166800                                                                  16680099
166900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16690099
167000         CONTINUE                                                 16700099
167100     ELSE                                                         16710099
167200         MOVE -1                   TO MR-SELECTL (PV-SUB)         16720099
167300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16730099
167400         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16740099
167500     END-IF.                                                      16750099
167600                                                                  16760099
167700/                                                                 16770099
167800*----------------------------------------------------------------*16780099
167900*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *16790099
168000*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *16800099
168100*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *16810099
168200*----------------------------------------------------------------*16820099
168300                                                                  16830099
168400 3500-MARK-RANGE-AS-SELECTED.                                     16840099
168500                                                                  16850099
168600     MOVE +1                       TO ASC-BLK-SUB.                16860099
168700                                                                  16870099
168800     PERFORM 3510-MARK-SELECTED-INDS                              16880099
168900         VARYING ASC-ITEM-SUB                                     16890099
169000         FROM 1 BY 1                                              16900099
169100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16910099
169200                                                                  16920099
169300     ADD +1                        TO ASC-BLK-SUB.                16930099
169400                                                                  16940099
169500     PERFORM 3510-MARK-SELECTED-INDS                              16950099
169600         VARYING ASC-ITEM-SUB                                     16960099
169700         FROM 1 BY 1                                              16970099
169800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16980099
169900                                                                  16990099
170000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               17000099
170100                                   TO PV-LIST-ITEM-NUMBER.        17010099
170200                                                                  17020099
170300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            17030099
170400         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         17040099
170500               PC-ITEMS-PER-PANEL).                               17050099
170600                                                                  17060099
170700     MOVE ASC-START-OF-SELECTED-RANGE                             17070099
170800                                   TO PV-START-OF-SELECTED-RANGE. 17080099
170900                                                                  17090099
171000     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            17100099
171100         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  17110099
171200               PC-ITEMS-PER-PANEL).                               17120099
171300                                                                  17130099
171400     MOVE ASC-END-OF-SELECTED-RANGE                               17140099
171500                                   TO PV-END-OF-SELECTED-RANGE.   17150099
171600                                                                  17160099
171700     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             17170099
171800         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    17180099
171900               PC-ITEMS-PER-PANEL).                               17190099
172000                                                                  17200099
172100     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             17210099
172200         PV-FIRST-BLOCK-IN-ARRAY + 1.                             17220099
172300                                                                  17230099
172400     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    17240099
172500        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        17250099
172600         MOVE +1                   TO ASC-BLK-SUB                 17260099
172700         PERFORM 5100-WRITE-TEMP-STORAGE                          17270099
172800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         17280099
172900             PV-FIRST-BLOCK-IN-ARRAY - 1                          17290099
173000                                                                  17300099
173100         PERFORM                                                  17310099
173200             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      17320099
173300                   PV-PREV-BLOCK-IN-ARRAY                         17330099
173400             MOVE PV-FIRST-BLOCK-IN-RANGE                         17340099
173500                                   TO PV-BLOCK-NUMBER             17350099
173600             PERFORM 4410-READ-TEMP-STORAGE                       17360099
173700             PERFORM 3510-MARK-SELECTED-INDS                      17370099
173800                 VARYING ASC-ITEM-SUB                             17380099
173900                 FROM 1 BY 1                                      17390099
174000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17400099
174100             PERFORM 5100-WRITE-TEMP-STORAGE                      17410099
174200             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     17420099
174300         END-PERFORM                                              17430099
174400                                                                  17440099
174500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         17450099
174600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     17460099
174700         PERFORM                                                  17470099
174800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       17480099
174900                   PV-LAST-BLOCK-IN-RANGE                         17490099
175000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          17500099
175100                                   TO PV-BLOCK-NUMBER             17510099
175200             PERFORM 4410-READ-TEMP-STORAGE                       17520099
175300             PERFORM 3510-MARK-SELECTED-INDS                      17530099
175400                 VARYING ASC-ITEM-SUB                             17540099
175500                 FROM 1 BY 1                                      17550099
175600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17560099
175700             PERFORM 5100-WRITE-TEMP-STORAGE                      17570099
175800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      17580099
175900         END-PERFORM                                              17590099
176000                                                                  17600099
176100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             17610099
176200                                   TO PV-BLOCK-NUMBER             17620099
176300         PERFORM 4410-READ-TEMP-STORAGE                           17630099
176400     END-IF.                                                      17640099
176500                                                                  17650099
176600     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 17660099
176700                                      ASC-END-OF-SELECTED-RANGE.  17670099
176800                                                                  17680099
176900/                                                                 17690099
177000*----------------------------------------------------------------*17700099
177100* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *17710099
177200*----------------------------------------------------------------*17720099
177300                                                                  17730099
177400 3510-MARK-SELECTED-INDS.                                         17740099
177500                                                                  17750099
177600     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) >         17760099
177700         ASC-START-OF-SELECTED-RANGE)                             17770099
177800     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =         17780099
177900         ASC-START-OF-SELECTED-RANGE)                             17790099
178000                                                                  17800099
178100         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     17810099
178200             ASC-END-OF-SELECTED-RANGE)                           17820099
178300         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     17830099
178400             ASC-END-OF-SELECTED-RANGE)                           17840099
178500                                                                  17850099
178600             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          17860099
178700                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   17870099
178800                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   17880099
178900                                   TO TRUE                        17890099
179000                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              17900099
179100                                   TO TRUE                        17910099
179200                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS17920099
179300             END-IF                                               17930099
179400         END-IF                                                   17940099
179500     END-IF.                                                      17950099
179600                                                                  17960099
179700/                                                                 17970099
179800*----------------------------------------------------------------*17980099
179900*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *17990099
180000*    INITIALIZE ALL COUNTERS AND FLAGS.                          *18000099
180100*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *18010099
180200*    DISPLAY THE PANEL TO USER.                                  *18020099
180300*----------------------------------------------------------------*18030099
180400                                                                  18040099
180500 4000-BUILD-INITIAL-PANEL.                                        18050099
180600                                                                  18060099
180700     INITIALIZE ASC-BLOCK-ENTRIES (1)                             18070099
180800                ASC-BLOCK-ENTRIES (2).                            18080099
180900                                                                  18090099
181000     MOVE +1                       TO ASC-BLK-SUB.                18100099
181100                                                                  18110099
181200     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       18120099
181300                                                                  18130099
181400     MOVE +0                       TO ASC-ITEM-SUB                18140099
181500                                      ASC-NUMBER-OF-ITEMS-READ    18150099
181600                                      ASC-NUMBER-OF-SELECTED-ITEMS18160099
181700                                      ASC-HIGHEST-BLOCK-WRITTEN   18170099
181800                                      ASC-START-OF-SELECTED-RANGE 18180099
181900                                      ASC-END-OF-SELECTED-RANGE   18190099
182000                                      ASC-ITEM-AT-TOP-OF-PANEL.   18200099
182100                                                                  18210099
182200     PERFORM 4100-PREPARE-CURSOR.                                 18220099
182300                                                                  18230099
182400     PERFORM 4010-OPEN-CURSOR.                                    18240099
182500                                                                  18250099
182600     PERFORM 4300-READ-ITEMS-FROM-DB.                             18260099
182700                                                                  18270099
182800     PERFORM 4020-CLOSE-CURSOR.                                   18280099
182900                                                                  18290099
183000     MOVE +1                       TO PV-TOP-ITEM.                18300099
183100                                                                  18310099
183200     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          18320099
183300         IF DP020-NEXT-ACT-INITIAL                                18330099
183400             SET DP020-NEXT-ACT-APPL-ERROR                        18340099
183500                                   TO TRUE                        18350099
183600             SET DP020-MSG-FATAL   TO TRUE                        18360099
183700             MOVE PC-TSYMSG-00050  TO DP020-MSG-NUMBER            18370099
183800         ELSE                                                     18380099
183900             SET DP020-MSG-FATAL   TO TRUE                        18390099
184000             MOVE PC-TSYMSG-00050  TO DP020-MSG-NUMBER            18400099
184100             SET ASC-BLOCK-MODIFIED (1)                           18410099
184200                 ASC-BLOCK-MODIFIED (2)                           18420099
184300                                   TO TRUE                        18430099
184400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 18440099
184500         END-IF                                                   18450099
184600     ELSE                                                         18460099
184700         MOVE -1                   TO MR-SELECTL (1)              18470099
184800         SET DP030-SET-CURSOR-APPL-1                              18480099
184900                                   TO TRUE                        18490099
185000         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     18500099
185100     END-IF.                                                      18510099
185200                                                                  18520099
185300/                                                                 18530099
185400*----------------------------------------------------------------*18540099
185500* OPEN THE FACILITY CURSOR.                                      *18550099
185600*----------------------------------------------------------------*18560099
185700                                                                  18570099
185800 4010-OPEN-CURSOR.                                                18580099
185900                                                                  18590099
186000     EXEC SQL                                                     18600099
186100         OPEN P2L-MOD-CSR                                         18610099
186200     END-EXEC                                                     18620099
186300                                                                  18630099
186400     EVALUATE TRUE                                                18640099
186500         WHEN SQLCODE = ZERO                                      18650099
186600              CONTINUE                                            18660099
186700         WHEN SQLCODE = -904                                      18670099
186800         WHEN SQLCODE = -911                                      18680099
186900         WHEN SQLCODE = -913                                      18690099
187000              PERFORM 9900-SOFT-ABORT                             18700099
187100         WHEN SQLWARN0 NOT = SPACE                                18710099
187200         WHEN SQLCODE  NOT = ZERO                                 18720099
187300             MOVE '4010-OPEN-CURSOR'                              18730099
187400                                   TO DP013-PARAGRAPH             18740099
187500             MOVE 'OPEN P2L-MOD-CSR CURSOR'                       18750099
187600                                   TO DP013-MESSAGE-TEXT (1)      18760099
187700             MOVE SQLCA       TO DP013-SQLCA                      18770099
187800             MOVE 'TP2LMOD'   TO DP013-DB2-TABLE-NAME (1)         18780099
187900             MOVE 'TSTRZN '   TO DP013-DB2-TABLE-NAME (2)         18790099
188000             SET DP013-DB2-ABEND                                  18800099
188100                                   TO TRUE                        18810099
188200             PERFORM DP013-0000-PROCESS-ABEND                     18820099
188300     END-EVALUATE.                                                18830099
188400                                                                  18840099
188500/                                                                 18850099
188600*----------------------------------------------------------------*18860099
188700* CLOSE THE FACILITY CURSOR.                                     *18870099
188800*----------------------------------------------------------------*18880099
188900                                                                  18890099
189000 4020-CLOSE-CURSOR.                                               18900099
189100                                                                  18910099
189200     EXEC SQL                                                     18920099
189300         CLOSE P2L-MOD-CSR                                        18930099
189400     END-EXEC.                                                    18940099
189500                                                                  18950099
189600     EVALUATE TRUE                                                18960099
189700         WHEN SQLCODE = ZERO                                      18970099
189800              CONTINUE                                            18980099
189900         WHEN SQLWARN0 NOT = SPACE                                18990099
190000         WHEN SQLCODE  NOT = +0                                   19000099
190100              MOVE '4020-CLOSE-CURSOR'                            19010099
190200                                   TO DP013-PARAGRAPH             19020099
190300              MOVE 'CLOSE P2L-MOD-CSR CURSOR'                     19030099
190400                                   TO DP013-MESSAGE-TEXT (1)      19040099
190500              MOVE SQLCA           TO DP013-SQLCA                 19050099
190600              MOVE 'TP2LMOD'       TO DP013-DB2-TABLE-NAME (1)    19060099
190700              MOVE 'TSTRZN '       TO DP013-DB2-TABLE-NAME (2)    19070099
190800              SET DP013-DB2-ABEND  TO TRUE                        19080099
190900              PERFORM DP013-0000-PROCESS-ABEND                    19090099
191000     END-EVALUATE.                                                19100099
191100                                                                  19110099
191200/                                                                 19120099
191300*----------------------------------------------------------------*19130099
191400*    DEPENDING ON WHAT WAS PASSED IN THE COMMAREA, SETUP THE     *19140099
191500*    DB2 KEYS IN PREPARATION FOR THE OPEN CURSOR.                *19150099
191600*----------------------------------------------------------------*19160099
191700                                                                  19170099
191800 4100-PREPARE-CURSOR.                                             19180099
191900     IF DP020-NEXT-ACT-READ-MAP AND NOT DP020-FK-REFRESH          19190099
192000                                         (DP020-SRC-AID)          19200099
192100        MOVE ASC-OPER-UNT-ID       TO DK-OPER-UNT-ID              19210099
192200                                                                  19220099
192300        MOVE ASC-FCLTY-ID          TO DK-FCLTY-ID                 19230099
192400     ELSE                                                         19240099
192500        MOVE CN001-OPER-UNT-ID     TO DK-OPER-UNT-ID              19250099
192600                                      ASC-KEY-OPER-UNT-ID         19260099
192700                                      ASC-OPER-UNT-ID             19270099
192800                                                                  19280099
192900        MOVE CN001-FCLTY-ID        TO DK-FCLTY-ID                 19290099
193000                                      ASC-KEY-FCLTY-ID            19300099
193100                                      ASC-FCLTY-ID                19310099
193200     END-IF.                                                      19320099
193300                                                                  19330099
193400                                                                  19340099
193500     PERFORM 4330-GET-P2L-ZONE.                                   19350099
193600                                                                  19360099
193700                                                                  19370099
193800*----------------------------------------------------------------*19380099
193900*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *19390099
194000*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *19400099
194100*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *19410099
194200*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *19420099
194300*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *19430099
194400*                                                                *19440099
194500*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *19450099
194600*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *19460099
194700*    UPON INITIALIZATION.                                        *19470099
194800*----------------------------------------------------------------*19480099
194900                                                                  19490099
195000 4300-READ-ITEMS-FROM-DB.                                         19500099
195100                                                                  19510099
195200     PERFORM 4320-GET-STORE-INFORMATION.                          19520099
195300                                                                  19530099
195400     PERFORM                                                      19540099
195500         VARYING PV-READ-COUNT                                    19550099
195600         FROM 1 BY 1                                              19560099
195700         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    19570099
195800            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         19580099
195900                                                                  19590099
196000         PERFORM 4310-FETCH                                       19600099
196100                                                                  19610099
196200         IF  ASC-ITEMS-LEFT-ON-DB                                 19620099
196300             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                19630099
196400                 ADD +1            TO ASC-ITEM-SUB                19640099
196500             ELSE                                                 19650099
196600                 ADD +1            TO ASC-BLK-SUB                 19660099
196700                 MOVE +1           TO ASC-ITEM-SUB                19670099
196800                                                                  19680099
196900                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         19690099
197000                     MOVE +1       TO ASC-BLK-SUB                 19700099
197100                     SET ASC-BLOCK-MODIFIED (1)                   19710099
197200                                   TO TRUE                        19720099
197300                     PERFORM 5100-WRITE-TEMP-STORAGE              19730099
197400                     MOVE ASC-BLOCK-ENTRIES                       19740099
197500                               (PC-MAX-BLOCKS-IN-ARRAY)           19750099
197600                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 19760099
197700                     ADD +1        TO ASC-BLK-SUB                 19770099
197800                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   19780099
197900                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      19790099
198000                                   TO TRUE                        19800099
198100                 END-IF                                           19810099
198200             END-IF                                               19820099
198300             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    19830099
198400             MOVE ASC-NUMBER-OF-ITEMS-READ                        19840099
198500                                   TO ASC-LIST-ITEM-NUMBER        19850099
198600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19860099
198700                                                                  19870099
198800             MOVE P2LMOD-MODU-NBR  TO  ASC-P2L-MOD                19880099
198900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19890099
199000             MOVE P2LMOD-MODU-DESC                                19900099
199100                                   TO  ASC-MOD-DESC               19910099
199200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19920099
199300             MOVE P2LMOD-DFLT-STR-ZN-ID                           19930099
199400                                   TO  ASC-STORE-ZONE             19940099
199500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19950099
199600             IF PV-STR-ZN-NULL-IND < ZERO                         19960099
199700                 MOVE SPACES       TO  ASC-STORE-ZONE-DESC        19970099
199800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19980099
199900             ELSE                                                 19990099
200000                 MOVE STRZN-STR-ZN-DESC                           20000099
200100                                   TO  ASC-STORE-ZONE-DESC        20010099
200200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20020099
200210             END-IF                                               20021099
200220                                                                  20022099
200230             IF  P2LMOD-DFLT-STR-ZN-ID  =  'HANG'                 20023099
200240                 MOVE  'HANG MDSE'  TO ASC-STORE-ZONE-DESC        20024099
200250                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20025099
200260             ELSE                                                 20026099
200270             IF  P2LMOD-DFLT-STR-ZN-ID  =  'FOLD'                 20027099
200280                 MOVE  'FOLD MDSE'  TO ASC-STORE-ZONE-DESC        20028099
200290                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20029099
200291             END-IF                                               20029199
200292             END-IF                                               20029299
200293                                                                  20029399
200300             MOVE P2LMOD-MODU-MDSE-TYP-CDE                        20030099
200400                                   TO  ASC-P2L-MOD-MDSE-TYPE      20040099
200500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20050099
200600             MOVE P2LMOD-DIVERT-CDE                               20060099
200700                                   TO  ASC-MOD-DIVERT-CDE         20070099
200800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20080099
201000         END-IF                                                   20100099
201100     END-PERFORM.                                                 20110099
201200                                                                  20120099
201300     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          20130099
201400         MOVE +1                   TO ASC-BLK-SUB                 20140099
201500         PERFORM 5100-WRITE-TEMP-STORAGE                          20150099
201600         ADD +1                    TO ASC-BLK-SUB                 20160099
201700         PERFORM 5100-WRITE-TEMP-STORAGE                          20170099
201800                                                                  20180099
201900         MOVE 1                    TO ASC-BLK-SUB                 20190099
202000                                      PV-BLOCK-NUMBER             20200099
202100         PERFORM 4410-READ-TEMP-STORAGE                           20210099
202200         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             20220099
202300             MOVE 2                TO ASC-BLK-SUB                 20230099
202400                                      PV-BLOCK-NUMBER             20240099
202500             PERFORM 4410-READ-TEMP-STORAGE                       20250099
202600         END-IF                                                   20260099
202700     END-IF.                                                      20270099
202800                                                                  20280099
202900/                                                                 20290099
203000*----------------------------------------------------------------*20300099
203100*    FETCH THE FACILITY LOCATION CURSOR.                         *20310099
203200*----------------------------------------------------------------*20320099
203300                                                                  20330099
203400 4310-FETCH.                                                      20340099
203500                                                                  20350099
203600     EXEC SQL                                                     20360099
203700         FETCH P2L-MOD-CSR                                        20370099
203800          INTO                                                    20380099
203900               :P2LMOD-MODU-NBR                                   20390099
204000            ,  :P2LMOD-MODU-DESC                                  20400099
204100            ,  :P2LMOD-DFLT-STR-ZN-ID                             20410099
204200            ,  :STRZN-STR-ZN-DESC:PV-STR-ZN-NULL-IND              20420099
204300            ,  :P2LMOD-MODU-MDSE-TYP-CDE                          20430099
204400            ,  :P2LMOD-DIVERT-CDE                                 20440099
204500     END-EXEC.                                                    20450099
204600                                                                  20460099
204700     EVALUATE TRUE                                                20470099
204800         WHEN SQLCODE = ZERO                                      20480099
204900              CONTINUE                                            20490099
205000         WHEN SQLCODE = +100                                      20500099
205100              SET ASC-NO-ITEMS-LEFT-ON-DB                         20510099
205200                                   TO TRUE                        20520099
205300         WHEN SQLWARN0 NOT = SPACE                                20530099
205400         WHEN SQLCODE < ZERO                                      20540099
205500         WHEN SQLCODE > ZERO                                      20550099
205600              MOVE '4310-FETCH-CURSOR'                            20560099
205700                                   TO DP013-PARAGRAPH             20570099
205800              MOVE 'FETCH P2L MODULE CURSOR'                      20580099
205900                                   TO DP013-MESSAGE-TEXT (1)      20590099
206000              MOVE SQLCA           TO DP013-SQLCA                 20600099
206100              MOVE 'TP2LMOD'       TO DP013-DB2-TABLE-NAME (1)    20610099
206200              MOVE 'TSTRZN '       TO DP013-DB2-TABLE-NAME (2)    20620099
206300              SET DP013-DB2-ABEND  TO TRUE                        20630099
206400              PERFORM DP013-0000-PROCESS-ABEND                    20640099
206500     END-EVALUATE.                                                20650099
206600                                                                  20660099
206601/                                                                 20660199
206602                                                                  20660203
206603****************************************************************  20660303
206604*    THIS PARAGRAPH RETRIEVES THE STORE INFORMATION.           *  20660403
206605*                                                              *  20660503
206606****************************************************************  20660603
206607                                                                  20660703
206608 4320-GET-STORE-INFORMATION.                                      20660803
206609                                                                  20660903
206610     INITIALIZE XL071-COMMAREA.                                   20661003
206611     MOVE DK-OPER-UNT-ID TO XL071-LOCATION-NUMBER.                20661103
206612                                                                  20661203
206613     CALL XL071-LOCATION-MODULE USING                             20661303
206614                                DFHEIBLK                          20661403
206615                                XL071-COMMAREA                    20661503
206616                                XL071-COMMAREA-REC.               20661603
206617                                                                  20661703
206618     EVALUATE TRUE                                                20661803
206619         WHEN XL071-NO-ERRORS                                     20661903
206620         WHEN XL071-DC-ASGMT-NOT-FND                              20662003
206621              MOVE XL071-LOC-NM TO ASC-FCLTY-NME                  20662103
206622                                                                  20662203
206623         WHEN XL071-LOC-NOT-FOUND                                 20662303
206624              MOVE SPACES       TO ASC-FCLTY-NME                  20662403
206625                                                                  20662503
206626         WHEN OTHER                                               20662603
206627              MOVE '4320-GET-STORE-INFORMATION'                   20662703
206628                                  TO DP013-PARAGRAPH              20662803
206629              STRING 'SELECT STORE NUMBER - '                     20662999
206630                      XL071-LOCATION-NUMBER                       20663099
206640                     ' - BAD RETURN CODE FROM XLKUT071 - '        20664099
206650                      XL071-RETURN-CODE                           20665099
206660                      DELIMITED BY SIZE                           20666099
206670                      INTO DP013-MESSAGE-TEXT (1)                 20667099
206680              STRING 'SQLCODE - '                                 20668099
206690                      XL071-SQLCODE                               20669099
206700                     ' - '                                        20670099
206800                      XL071-DB2-TABLE                             20680099
206900                      DELIMITED BY SIZE                           20690099
207000                      INTO DP013-MESSAGE-TEXT (2)                 20700099
207100              MOVE XL071-SQLCA     TO DP013-SQLCA                 20710099
207101              MOVE XL071-DB2-TABLE TO DP013-DB2-TABLE-NAME (1)    20710199
207102              MOVE XL071-SQLCODE TO SQLCODE                       20710203
207103              SET DP013-DB2-ABEND                                 20710303
207104                  DP013-XCTL-DISPLAY-RESTART TO TRUE              20710403
207105              PERFORM DP013-0000-PROCESS-ABEND                    20710503
207106                                                                  20710603
207107     END-EVALUATE.                                                20710703
207108                                                                  20710899
207109                                                                  20710999
207110*----------------------------------------------------------------*20711099
207120* DETERMINE HOW THIS DC HAS THE ZONES SET UP IN PACK-TO-LIGHT    *20712099
207130*  - HANG/FOLD     - HANG/COMMODITY     - COMMODITY              *20713099
207140*----------------------------------------------------------------*20714099
207150 4330-GET-P2L-ZONE.                                               20715099
207160     EXEC SQL                                                     20716099
207170          SELECT  FUNC_TXT                                        20717099
207180            INTO :KRPRPM-FUNC-TXT                                 20718099
207190            FROM  TKRPRPM                                         20719099
207200           WHERE  LOC_ID            = :DK-OPER-UNT-ID             20720099
207300             AND  SYS_PRC_FUNC_CDE  = 'P2LZON'                    20730099
207400             AND  INTFC_SYS_CDE     = 'KHL'                       20740099
207500             AND  FUNC_PRC_STAT_CDE = 'AC'                        20750099
207600             AND  FUNC_BEG_TMST    <=  CURRENT TIMESTAMP          20760099
207700             AND  FUNC_END_TMST    >=  CURRENT TIMESTAMP          20770099
207800     END-EXEC.                                                    20780099
207900                                                                  20790099
208000     EVALUATE TRUE                                                20800099
208100         WHEN SQLCODE = ZERO                                      20810099
208200              MOVE  KRPRPM-FUNC-TXT   TO  ASC-P2L-ZONE            20820099
208300                                          MR-ZONE                 20830099
208400         WHEN SQLCODE = +100                                      20840099
208500              MOVE 'COMMODITY'        TO  ASC-P2L-ZONE            20850099
208600                                          MR-ZONE                 20860099
208700         WHEN SQLWARN0 NOT = SPACE                                20870099
208800         WHEN SQLCODE < ZERO                                      20880099
208900         WHEN SQLCODE > ZERO                                      20890099
209000              MOVE '4330-GET-P2L-ZONE'                            20900099
209100                                   TO DP013-PARAGRAPH             20910099
209200              MOVE 'FETCH P2L ZONE PARM    '                      20920099
209300                                   TO DP013-MESSAGE-TEXT (1)      20930099
209400              MOVE SQLCA           TO DP013-SQLCA                 20940099
209500              MOVE 'TKRPRPM'       TO DP013-DB2-TABLE-NAME (1)    20950099
209600              SET DP013-DB2-ABEND  TO TRUE                        20960099
209700              PERFORM DP013-0000-PROCESS-ABEND                    20970099
209800     END-EVALUATE.                                                20980099
209900                                                                  20990099
210000                                                                  21000099
210100*----------------------------------------------------------------*21010099
210200* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *21020099
210300*----------------------------------------------------------------*21030099
210400                                                                  21040099
210500 4400-MOVE-COMMAREA-TO-SCREEN.                                    21050099
210600                                                                  21060099
210700     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             21070099
210800         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          21080099
210900         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          21090099
211000             MOVE +1               TO ASC-BLK-SUB                 21100099
211100                                                                  21110099
211200             PERFORM 5100-WRITE-TEMP-STORAGE                      21120099
211300                                                                  21130099
211400             ADD +1                TO ASC-BLK-SUB                 21140099
211500             PERFORM 5100-WRITE-TEMP-STORAGE                      21150099
211600                                                                  21160099
211700             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             21170099
211800                 GIVING PV-BLOCK-NUMBER                           21180099
211900                 REMAINDER PV-REMAINDER                           21190099
212000             IF  PV-REMAINDER > ZERO                              21200099
212100                 ADD +1            TO PV-BLOCK-NUMBER             21210099
212200             END-IF                                               21220099
212300                                                                  21230099
212400             MOVE +1               TO ASC-BLK-SUB                 21240099
212500             PERFORM 4410-READ-TEMP-STORAGE                       21250099
212600                                                                  21260099
212700             ADD +1                TO ASC-BLK-SUB                 21270099
212800                                      PV-BLOCK-NUMBER             21280099
212900             PERFORM 4410-READ-TEMP-STORAGE                       21290099
213000     END-IF.                                                      21300099
213100                                                                  21310099
213200     MOVE +1                       TO ASC-BLK-SUB.                21320099
213300                                                                  21330099
213400     COMPUTE ASC-ITEM-SUB =                                       21340099
213500         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              21350099
213600         + PC-ITEMS-PER-PANEL).                                   21360099
213700                                                                  21370099
213800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        21380099
213900         ADD +1                    TO ASC-BLK-SUB                 21390099
214000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            21400099
214100     END-IF.                                                      21410099
214200                                                                  21420099
214300     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           21430099
214400         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                21440099
214500                                                                  21450099
214600     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        21460099
214700                                                                  21470099
214800     PERFORM 4420-FORMAT-LIST-LINES                               21480099
214900         VARYING PV-SUB                                           21490099
215000         FROM PC-ITEMS-PER-PANEL BY -1                            21500099
215100         UNTIL PV-SUB < +1.                                       21510099
215200                                                                  21520099
215300     COMPUTE ASC-ITEMS-DISPLAYED =                                21530099
215400         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          21540099
215500                                                                  21550099
215600     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    21560099
215700                                      ASTRTITO.                   21570099
215800                                                                  21580099
215900     MOVE ASC-OPER-UNT-ID          TO MR-OPER.                    21590099
216000     MOVE ASC-FCLTY-ID             TO MR-FCLTY.                   21600099
216100     MOVE ASC-FCLTY-NME            TO MR-FDESC.                   21610099
216200     MOVE ASC-P2L-ZONE             TO MR-ZONE.                    21620099
216300                                                                  21630099
216400     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    21640099
216500     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    21650099
216600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            21660099
216700                                   TO ASELITO.                    21670099
216800                                                                  21680099
216900     IF  DP020-MSG-NUMBER-X = SPACE                               21690099
217000         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  21700099
217100*            --- MORE ITEMS TO DISPLAY ----                       21710099
217200             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            21720099
217300             SET DP020-MSG-INFORMATIONAL                          21730099
217400                                   TO TRUE                        21740099
217500         END-IF                                                   21750099
217600     END-IF.                                                      21760099
217700                                                                  21770099
217800*----------------------------------------------------------------*21780099
217900*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *21790099
218000*----------------------------------------------------------------*21800099
218100                                                                  21810099
218200 4410-READ-TEMP-STORAGE.                                          21820099
218300                                                                  21830099
218400     EXEC CICS                                                    21840099
218500         READQ TS                                                 21850099
218600             QUEUE (ASC-LIST-QUEUE-NAME)                          21860099
218700             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21870099
218800             ITEM  (PV-BLOCK-NUMBER)                              21880099
218900             RESP  (PV-CICS-RESP)                                 21890099
219000     END-EXEC.                                                    21900099
219100                                                                  21910099
219200     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       21920099
219300       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     21930099
219400         CONTINUE                                                 21940099
219500     ELSE                                                         21950099
219600         SET DP013-CICS-ABEND      TO TRUE                        21960099
219700         SET DP013-NO-ROLLBACK     TO TRUE                        21970099
219800         MOVE '4410-READ-TEMP-STORAGE'                            21980099
219900                                   TO DP013-PARAGRAPH             21990099
220000         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      22000099
220100                                   TO DP013-MESSAGE-TEXT(1)       22010099
220200         PERFORM DP013-0000-PROCESS-ABEND                         22020099
220300     END-IF.                                                      22030099
220400                                                                  22040099
220500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      22050099
220600                                   TO TRUE.                       22060099
220700                                                                  22070099
220800     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         22080099
220900         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               22090099
221000     END-IF.                                                      22100099
221100                                                                  22110099
221200/                                                                 22120099
221300*----------------------------------------------------------------*22130099
221400*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *22140099
221500*----------------------------------------------------------------*22150099
221600                                                                  22160099
221700 4420-FORMAT-LIST-LINES.                                          22170099
221800                                                                  22180099
221900     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      22190099
222000         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                22200099
222100         MOVE DP015-ASK-DRK-OFF    TO MR-SELECTA (PV-SUB)         22210099
222200                                      MR-ACTIONA (PV-SUB)         22220099
222300                                      MR-U-STORE-ZONE-A (PV-SUB)  22230099
222400         MOVE SPACE                TO MR-SELECT  (PV-SUB)         22240099
222500                                      MR-ACTION  (PV-SUB)         22250099
222600                                      MR-U-STORE-ZONE (PV-SUB)    22260099
222700                                      MR-P2L-MOD      (PV-SUB)    22270099
222800                                      MR-MOD-DESC     (PV-SUB)    22280099
222900                                      MR-STORE-ZONE   (PV-SUB)    22290099
223000                                      MR-STORE-ZONE-DESC (PV-SUB) 22300099
223100                                      MR-MDSE-TYPE       (PV-SUB) 22310099
223200                                      MR-DIVERT-CODE     (PV-SUB) 22320099
223300     ELSE                                                         22330099
223400         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      22340099
223500                                                   > SPACE        22350099
223600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 22360099
223700                                   TO MR-SELECT  (PV-SUB)         22370099
223800         ELSE                                                     22380099
223900             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      22390099
224000                                   TO MR-SELECT  (PV-SUB)         22400099
224100         END-IF                                                   22410099
224200                                                                  22420099
224300         IF  DP030-SET-CURSOR-TRAILER                             22430099
224400             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)22440099
224500                 > SPACE)                                         22450099
224600               OR (PV-SUB = 1))                                   22460099
224700                SET DP030-SET-CURSOR-APPL-1 TO TRUE               22470099
224800                MOVE -1            TO MR-SELECTL (PV-SUB)         22480099
224900             END-IF                                               22490099
225000         END-IF                                                   22500099
225100                                                                  22510099
225200         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           22520099
225300             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           22530099
225400                                   TO MR-ACTION (PV-SUB)          22540099
225500                                                                  22550099
225600             MOVE ASC-U-STORE-ZONE (ASC-BLK-SUB ASC-ITEM-SUB)     22560099
225700                                   TO MR-U-STORE-ZONE (PV-SUB)    22570099
225800             MOVE ASC-P2L-MOD      (ASC-BLK-SUB ASC-ITEM-SUB)     22580099
225900                                   TO MR-P2L-MOD      (PV-SUB)    22590099
226000             MOVE ASC-MOD-DESC     (ASC-BLK-SUB ASC-ITEM-SUB)     22600099
226100                                   TO MR-MOD-DESC     (PV-SUB)    22610099
226200             MOVE ASC-STORE-ZONE   (ASC-BLK-SUB ASC-ITEM-SUB)     22620099
226300                                   TO MR-STORE-ZONE   (PV-SUB)    22630099
226400             MOVE ASC-STORE-ZONE-DESC                             22640099
226500                                   (ASC-BLK-SUB ASC-ITEM-SUB)     22650099
226600                                   TO MR-STORE-ZONE-DESC (PV-SUB) 22660099
226700             EVALUATE TRUE                                        22670099
226800                 WHEN ASC-P2L-FINE-JEWELRY                        22680099
226900                                        (ASC-BLK-SUB ASC-ITEM-SUB)22690099
227000                      MOVE 'FINE'  TO MR-MDSE-TYPE    (PV-SUB)    22700099
227100                 WHEN ASC-P2L-CAGE-FRGRNCE                        22710099
227200                                        (ASC-BLK-SUB ASC-ITEM-SUB)22720099
227300                      MOVE 'CAGE'  TO MR-MDSE-TYPE    (PV-SUB)    22730099
227400                 WHEN ASC-P2L-HRTW      (ASC-BLK-SUB ASC-ITEM-SUB)22740099
227500                      MOVE 'HRTW'  TO MR-MDSE-TYPE    (PV-SUB)    22750099
227600                 WHEN OTHER                                       22760099
227700                      MOVE 'OTHER' TO MR-MDSE-TYPE    (PV-SUB)    22770099
227800             END-EVALUATE                                         22780099
227900                                                                  22790099
228000             MOVE ASC-MOD-DIVERT-CDE    (ASC-BLK-SUB ASC-ITEM-SUB)22800099
228100                                   TO MR-DIVERT-CODE  (PV-SUB)    22810099
228200         END-IF                                                   22820099
228300     END-IF.                                                      22830099
228400                                                                  22840099
228500     SUBTRACT +1 FROM ASC-ITEM-SUB.                               22850099
228600                                                                  22860099
228700     IF  ASC-ITEM-SUB < + 1                                       22870099
228800         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                22880099
228900         MOVE +1                   TO ASC-BLK-SUB                 22890099
229000     END-IF.                                                      22900099
229100                                                                  22910099
229200/                                                                 22920099
229300*----------------------------------------------------------------*22930099
229400*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *22940099
229500*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *22950099
229600*  ISSUE A WARNING.                                              *22960099
229700*----------------------------------------------------------------*22970099
229800 4430-CHECK-FOR-BEGIN-AND-END.                                    22980099
229900                                                                  22990099
230000     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       23000099
230100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     23010099
230200*            -- NO END-OF-RANGE SPECFIED ---                      23020099
230300             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            23030099
230400             SET DP020-MSG-WARNING TO TRUE                        23040099
230500             PERFORM 4431-POSITION-AT-WARNING                     23050099
230600         END-IF                                                   23060099
230700     ELSE                                                         23070099
230800         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     23080099
230900*            -- NO BEGINNING-OF-RANGE SPECFIED ---                23090099
231000             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            23100099
231100             SET DP020-MSG-WARNING TO TRUE                        23110099
231200             PERFORM 4431-POSITION-AT-WARNING                     23120099
231300         END-IF                                                   23130099
231400     END-IF.                                                      23140099
231500                                                                  23150099
231600/                                                                 23160099
231700*----------------------------------------------------------------*23170099
231800*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *23180099
231900*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *23190099
232000*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *23200099
232100*  POSITION THE CURSOR THERE.                                    *23210099
232200*----------------------------------------------------------------*23220099
232300 4431-POSITION-AT-WARNING.                                        23230099
232400                                                                  23240099
232500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 23250099
232600                    - PV-TOP-ITEM + 1.                            23260099
232700                                                                  23270099
232800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23280099
232900         CONTINUE                                                 23290099
233000     ELSE                                                         23300099
233100         SET DP030-SET-CURSOR-APPL-1                              23310099
233200                                   TO TRUE                        23320099
233300         MOVE -1                   TO MR-SELECTL (PV-SUB)         23330099
233400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         23340099
233500         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         23350099
233600     END-IF.                                                      23360099
233700                                                                  23370099
233800     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   23380099
233900                    - PV-TOP-ITEM + 1.                            23390099
234000                                                                  23400099
234100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23410099
234200         CONTINUE                                                 23420099
234300     ELSE                                                         23430099
234400         SET DP030-SET-CURSOR-APPL-1                              23440099
234500                                   TO TRUE                        23450099
234600         MOVE -1                   TO MR-SELECTL (PV-SUB)         23460099
234700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         23470099
234800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         23480099
234900     END-IF.                                                      23490099
235000                                                                  23500099
235100/                                                                 23510099
235200*----------------------------------------------------------------*23520099
235300* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *23530099
235400* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *23540099
235500* FOR THE SELECTED ITEMS QUEUE.                                  *23550099
235600*                                                                *23560099
235700* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *23570099
235800* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *23580099
235900* THE ARRAY IS FULL.                                             *23590099
236000*----------------------------------------------------------------*23600099
236100                                                                  23610099
236200 5000-PREPARE-SEL-QUEUE.                                          23620099
236300                                                                  23630099
236400     MOVE +1                       TO ASC-BLK-SUB.                23640099
236500     PERFORM 5100-WRITE-TEMP-STORAGE.                             23650099
236600     ADD +1                        TO ASC-BLK-SUB.                23660099
236700     PERFORM 5100-WRITE-TEMP-STORAGE.                             23670099
236800                                                                  23680099
236900     MOVE ASC-SEL-QUEUE-NAME       TO CN003-SEL-QUEUE-NAME.       23690099
237000     PERFORM 6010-DELETE-SEL-QUEUE.                               23700099
237100                                                                  23710099
237200*  NOT NEEDED BECAUSE A SELECTION ISN'T NECESSARY TO              23720099
237300*  TRANSFER CONTROL                                               23730099
237400*    IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                      23740099
237500*        SET ASC-UPDATE-TSQ        TO TRUE                        23750099
237600*    END-IF.                                                      23760099
237700                                                                  23770099
237800     SET CN007-IDX                 TO 1.                          23780099
237900     MOVE ZERO                     TO CN003-NUMBER-OF-TS-ITEMS.   23790099
238000     INITIALIZE CN007-SELECTED-ITEM-ARRAY.                        23800099
238100                                                                  23810099
238200                                                                  23820099
238300     EVALUATE TRUE                                                23830099
238400         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              23840099
238500             PERFORM 5300-SEARCH-FOR-SELECTION                    23850099
238600                 VARYING PV-ITEM  FROM 1 BY 1                     23860099
238700                 UNTIL   PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN      23870099
238800                                                                  23880099
238900             MOVE PC-TSYMSG-00059                                 23890099
239000                                 TO DP020-MSG-NUMBER              23900099
239100             SET DP020-MSG-INFORMATIONAL                          23910099
239200                                 TO TRUE                          23920099
239300             MOVE ASC-KEY-OPER-UNT-ID                             23930099
239400                                   TO DK-OPER-UNT-ID              23940099
239500             MOVE ASC-KEY-FCLTY-ID TO DK-FCLTY-ID                 23950099
239600                                                                  23960099
239700     INITIALIZE ASC-BLOCK-ENTRIES (1)                             23970099
239800                        ASC-BLOCK-ENTRIES (2)                     23980099
239900     MOVE +1             TO ASC-BLK-SUB                           23990099
240000                            PV-TOP-ITEM                           24000099
240100                                                                  24010099
240200     MOVE ZERO           TO ASC-ITEM-SUB                          24020099
240300                            ASC-NUMBER-OF-SELECTED-ITEMS          24030099
240400                            ASC-START-OF-SELECTED-RANGE           24040099
240500                            ASC-END-OF-SELECTED-RANGE             24050099
240600                            ASC-ITEM-AT-TOP-OF-PANEL              24060099
240700                                                                  24070099
240800     PERFORM 4410-READ-TEMP-STORAGE                               24080099
240900     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         24090099
241000     PERFORM 3200-RESET-ATTRIBUTES                                24100099
241100                                                                  24110099
241200                                                                  24120099
241300         WHEN OTHER                                               24130099
241400             PERFORM 5200-FILL-SEL-QUEUE-RECORD                   24140099
241500                 VARYING PV-ITEM  FROM 1 BY 1                     24150099
241600                 UNTIL   PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN      24160099
241700                                                                  24170099
241800     END-EVALUATE.                                                24180099
241900                                                                  24190099
242000                                                                  24200099
242100     IF  CN007-IDX > 1                                            24210099
242200         PERFORM 5205-WRITE-SEL-QUEUE                             24220099
242300         ADD +1                    TO CN003-NUMBER-OF-TS-ITEMS    24230099
242400     END-IF.                                                      24240099
242500                                                                  24250099
242600/                                                                 24260099
242700*----------------------------------------------------------------*24270099
242800*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *24280099
242900*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *24290099
243000*----------------------------------------------------------------*24300099
243100                                                                  24310099
243200 5100-WRITE-TEMP-STORAGE.                                         24320099
243300                                                                  24330099
243400     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     24340099
243500                                   TO PV-LIST-ITEM-NUMBER.        24350099
243600     COMPUTE PV-BLOCK-NUMBER =                                    24360099
243700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    24370099
243800                                                                  24380099
243900     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             24390099
244000     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             24400099
244100         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      24410099
244200             PERFORM 5105-REWRITE-ASC-LISTQ                       24420099
244300         END-IF                                                   24430099
244400     ELSE                                                         24440099
244500         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       24450099
244600         ASC-HIGHEST-BLOCK-WRITTEN + 1                            24460099
244700         PERFORM 5110-WRITE-ASC-LISTQ                             24470099
244800         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   24480099
244900     END-IF.                                                      24490099
245000                                                                  24500099
245100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      24510099
245200                                   TO TRUE.                       24520099
245300                                                                  24530099
245400/                                                                 24540099
245500*----------------------------------------------------------------*24550099
245600*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *24560099
245700*  SPECIFIC COMMAREA.                                            *24570099
245800*----------------------------------------------------------------*24580099
245900 5105-REWRITE-ASC-LISTQ.                                          24590099
246000                                                                  24600099
246100     EXEC CICS                                                    24610099
246200         WRITEQ TS                                                24620099
246300             QUEUE (ASC-LIST-QUEUE-NAME)                          24630099
246400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24640099
246500             ITEM  (PV-BLOCK-NUMBER)                              24650099
246600             REWRITE                                              24660099
246700             RESP  (PV-CICS-RESP)                                 24670099
246800     END-EXEC.                                                    24680099
246900                                                                  24690099
247000     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           24700099
247100         CONTINUE                                                 24710099
247200     ELSE                                                         24720099
247300         SET DP013-CICS-ABEND      TO TRUE                        24730099
247400         SET DP013-NO-ROLLBACK     TO TRUE                        24740099
247500         MOVE '5105-REWRITE-ASC-LISTQ'                            24750099
247600                                   TO DP013-PARAGRAPH             24760099
247700         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     24770099
247800                                   TO DP013-MESSAGE-TEXT(1)       24780099
247900         PERFORM DP013-0000-PROCESS-ABEND                         24790099
248000     END-IF.                                                      24800099
248100                                                                  24810099
248200/                                                                 24820099
248300*----------------------------------------------------------------*24830099
248400*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *24840099
248500*  SPECIFIC COMMAREA.                                            *24850099
248600*----------------------------------------------------------------*24860099
248700 5110-WRITE-ASC-LISTQ.                                            24870099
248800                                                                  24880099
248900     EXEC CICS                                                    24890099
249000         WRITEQ TS                                                24900099
249100             QUEUE (ASC-LIST-QUEUE-NAME)                          24910099
249200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24920099
249300             ITEM  (PV-BLOCK-NUMBER)                              24930099
249400             RESP  (PV-CICS-RESP)                                 24940099
249500     END-EXEC.                                                    24950099
249600                                                                  24960099
249700     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      24970099
249800         SET DP013-CICS-ABEND      TO TRUE                        24980099
249900         SET DP013-NO-ROLLBACK     TO TRUE                        24990099
250000         MOVE '5110-WRITE-ASC-LISTQ'                              25000099
250100                                   TO DP013-PARAGRAPH             25010099
250200         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           25020099
250300                                   TO DP013-MESSAGE-TEXT(1)       25030099
250400         PERFORM DP013-0000-PROCESS-ABEND                         25040099
250500     END-IF.                                                      25050099
250600                                                                  25060099
250700/                                                                 25070099
250800*----------------------------------------------------------------*25080099
250900* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *25090099
251000* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *25100099
251100*----------------------------------------------------------------*25110099
251200                                                                  25120099
251300 5200-FILL-SEL-QUEUE-RECORD.                                      25130099
251400                                                                  25140099
251500     PERFORM 6112-READ-LIST-QUEUE.                                25150099
251600                                                                  25160099
251700     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       25170099
251800         PERFORM                                                  25180099
251900         VARYING LQW-IDX                                          25190099
252000         FROM 1 BY 1                                              25200099
252100         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            25210099
252200           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          25220099
252300                                                                  25230099
252400             IF  LQW-SELECT (LQW-IDX)                             25240099
252500                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              25250099
252600                                   TO CN007-ITEM      (CN007-IDX) 25260099
252700                 MOVE SPACE        TO CN007-ACTION-SW (CN007-IDX) 25270099
252800                 MOVE LQW-MOD-DESC (LQW-IDX)                      25280099
252900                                   TO CN007-CNTL-DESC (CN007-IDX) 25290099
253000                 SET LQW-DESELECT (LQW-IDX)                       25300099
253100                     LQW-INQUIRE  (LQW-IDX)                       25310099
253200                                   TO  TRUE                       25320099
253300                 SET CN007-IDX UP BY 1                            25330099
253400                 IF  CN007-IDX > CN007-MAX-ITEMS                  25340099
253500                     PERFORM 5205-WRITE-SEL-QUEUE                 25350099
253600                     ADD +1        TO CN003-NUMBER-OF-TS-ITEMS    25360099
253700                     INITIALIZE CN007-SELECTED-ITEM-ARRAY         25370099
253800                     SET CN007-IDX TO 1                           25380099
253900                 END-IF                                           25390099
254000             END-IF                                               25400099
254100         END-PERFORM                                              25410099
254200     END-IF.                                                      25420099
254300                                                                  25430099
254400/                                                                 25440099
254500*----------------------------------------------------------------*25450099
254600*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *25460099
254700*----------------------------------------------------------------*25470099
254800                                                                  25480099
254900 5205-WRITE-SEL-QUEUE.                                            25490099
255000                                                                  25500099
255100     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            25510099
255200                                   TO CN007-SELECTED-ITEMS.       25520099
255300                                                                  25530099
255400     EXEC CICS                                                    25540099
255500          WRITEQ TS                                               25550099
255600              QUEUE (ASC-SEL-QUEUE-NAME)                          25560099
255700              FROM  (CN007-TS-SEL-REC)                            25570099
255800              ITEM  (PV-SEL-QUEUE-ITEM)                           25580099
255900              RESP  (PV-CICS-RESP)                                25590099
256000     END-EXEC.                                                    25600099
256100                                                                  25610099
256200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25620099
256300         CONTINUE                                                 25630099
256400     ELSE                                                         25640099
256500         SET DP013-CICS-ABEND      TO TRUE                        25650099
256600         SET DP013-NO-ROLLBACK     TO TRUE                        25660099
256700         MOVE '5205-WRITE-SEL-QUEUE'                              25670099
256800                                   TO DP013-PARAGRAPH             25680099
256900         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          25690099
257000                                   TO DP013-MESSAGE-TEXT(1)       25700099
257100         PERFORM DP013-0000-PROCESS-ABEND                         25710099
257200     END-IF.                                                      25720099
257300                                                                  25730099
257400/                                                                 25740099
257500 5300-SEARCH-FOR-SELECTION.                                       25750099
257600                                                                  25760099
257700     PERFORM 6112-READ-LIST-QUEUE.                                25770099
257800                                                                  25780099
257900     IF PV-CICS-RESP = DFHRESP (NORMAL)                           25790099
258000         PERFORM                                                  25800099
258100         VARYING LQW-IDX  FROM 1 BY 1                             25810099
258200         UNTIL   LQW-IDX > PC-ITEMS-PER-PANEL OR                  25820099
258300                 LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO            25830099
258400                                                                  25840099
258500             IF LQW-SELECT (LQW-IDX)                              25850099
258600                 MOVE LQW-MOD-DESC (LQW-IDX)                      25860099
258700                                 TO P2LMOD-MODU-DESC              25870099
258800                 MOVE LQW-U-STORE-ZONE (LQW-IDX)                  25880099
258900                                 TO P2LMOD-DFLT-STR-ZN-ID         25890099
259000                                                                  25900099
259100                 PERFORM 5500-UPDATE-P2LMOD                       25910099
259200                 ADD +1          TO CN003-NUMBER-OF-TS-ITEMS      25920099
259300                 SET LQW-DESELECT (LQW-IDX)                       25930099
259400                     LQW-UPDATE   (LQW-IDX)                       25940099
259500                                 TO TRUE                          25950099
259600                 MOVE LQW-SELECTED-SW (LQW-IDX)                   25960099
259700                                 TO LQW-TEMP-SELECTED-SW (LQW-IDX)25970099
259800                 SUBTRACT 1    FROM ASC-NUMBER-OF-SELECTED-ITEMS  25980099
259900             ELSE                                                 25990099
260000                 SET LQW-NULL-ACTION (LQW-IDX) TO TRUE            26000099
260100             END-IF                                               26010099
260200         END-PERFORM                                              26020099
260300     END-IF.                                                      26030099
260400                                                                  26040099
260500     MOVE PV-ITEM                TO PV-SAVE-ITEM.                 26050099
260600     PERFORM 6111-WRITE-LIST-QUEUE.                               26060099
260700                                                                  26070099
260800 5500-UPDATE-P2LMOD.                                              26080099
260900     EXEC SQL                                                     26090099
261000         UPDATE TP2LMOD A                                         26100099
261100             SET DFLT_STR_ZN_ID      = :P2LMOD-DFLT-STR-ZN-ID     26110099
261200            WHERE A.OPER_UNT_ID      = :DK-OPER-UNT-ID            26120099
261300              AND A.FCLTY_ID         = :DK-FCLTY-ID               26130099
261400              AND A.MODU_DESC        = :P2LMOD-MODU-DESC          26140099
261500     END-EXEC.                                                    26150099
261600                                                                  26160099
261700     EVALUATE TRUE                                                26170099
261800         WHEN SQLCODE = ZERO                                      26180099
261900             MOVE LQW-U-STORE-ZONE (LQW-IDX) TO                   26190099
262000                       LQW-STORE-ZONE (LQW-IDX)                   26200099
262100                       PV-SEARCH-ZONE                             26210099
262200             MOVE SPACES     TO LQW-U-STORE-ZONE (LQW-IDX)        26220099
262300             PERFORM 3301-VERIFY-ZONE                             26230099
262400             IF PS-VALID-ZONE                                     26240099
262500                 MOVE PT-ZONE-DESC (PT-ZONE-IDX)                  26250099
262600                                   TO LQW-STORE-ZONE-DESC         26260099
262700                                      (LQW-IDX)                   26270099
262800             END-IF                                               26280099
262900         WHEN SQLCODE = +100                                      26290099
263000* IF ONE OF THE SELECTED ITEMS IS NOT FOUND, ROLLBACK ALL         26300099
263100* THE UPDATES                                                     26310099
263200             MOVE PC-TSYMSG-00254  TO DP020-MSG-NUMBER            26320099
263300             SET DP020-MSG-FATAL   TO TRUE                        26330099
263400             MOVE -1               TO MR-SELECTL (PV-SUB)         26340099
263500             SET DP030-SET-CURSOR-APPL-1                          26350099
263600                                   TO TRUE                        26360099
263700             MOVE DP015-RED        TO MR-SELECTC (PV-SUB)         26370099
263800             MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB)         26380099
263900             SET PS-ERROR          TO TRUE                        26390099
264000              PERFORM 9900-SOFT-ABORT                             26400099
264100         WHEN SQLCODE = -904                                      26410099
264200         WHEN SQLCODE = -911                                      26420099
264300         WHEN SQLCODE = -913                                      26430099
264400              PERFORM 9900-SOFT-ABORT                             26440099
264500         WHEN SQLWARN0 NOT = SPACE                                26450099
264600         WHEN SQLCODE  NOT = ZERO                                 26460099
264700             MOVE '5500-UPDATE-PCLABL'                            26470099
264800                                   TO DP013-PARAGRAPH             26480099
264900             MOVE 'UPDATE PCLABL TABLE'                           26490099
265000                                   TO DP013-MESSAGE-TEXT (1)      26500099
265100             MOVE SQLCA       TO DP013-SQLCA                      26510099
265200             MOVE 'TP2LMOD'   TO DP013-DB2-TABLE-NAME (1)         26520099
265300             MOVE 'TSTRZN '   TO DP013-DB2-TABLE-NAME (2)         26530099
265400             SET DP013-DB2-ABEND                                  26540099
265500                                   TO TRUE                        26550099
265600             PERFORM DP013-0000-PROCESS-ABEND                     26560099
265700     END-EVALUATE.                                                26570099
265800                                                                  26580099
265900/                                                                 26590099
266000*----------------------------------------------------------------*26600099
266100*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *26610099
266200*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *26620099
266300*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *26630099
266400*  THE USER.                                                     *26640099
266500*----------------------------------------------------------------*26650099
266600 6000-REFRESH-PANEL-FROM-TEMP.                                    26660099
266700                                                                  26670099
266800     IF  ASC-UPDATE-TSQ                                           26680099
266900         SET ASC-NO-TSQ-UPDATE     TO TRUE                        26690099
267000         MOVE ZERO                 TO PV-SAVE-ITEM                26700099
267100                                      PV-SEL-QUEUE-ITEM           26710099
267200         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        26720099
267300                                   TO PV-HOLD-SELECTED-ITEMS      26730099
267400         PERFORM 6100-UPDATE-TSQ                                  26740099
267500             UNTIL PV-ITEMS-PROCESSED >                           26750099
267600                                     ASC-NUMBER-OF-SELECTED-ITEMS 26760099
267700         PERFORM 6010-DELETE-SEL-QUEUE                            26770099
267800         INITIALIZE ASC-BLOCK-ENTRIES (1)                         26780099
267900                    ASC-BLOCK-ENTRIES (2)                         26790099
268000     END-IF.                                                      26800099
268100                                                                  26810099
268200/                                                                 26820099
268300*----------------------------------------------------------------*26830099
268400*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *26840099
268500*----------------------------------------------------------------*26850099
268600 6010-DELETE-SEL-QUEUE.                                           26860099
268700                                                                  26870099
268800     EXEC CICS                                                    26880099
268900         DELETEQ TS                                               26890099
269000             QUEUE (ASC-SEL-QUEUE-NAME)                           26900099
269100             RESP  (PV-CICS-RESP)                                 26910099
269200     END-EXEC.                                                    26920099
269300                                                                  26930099
269400     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      26940099
269500         (PV-CICS-RESP = DFHRESP(QIDERR)))                        26950099
269600         CONTINUE                                                 26960099
269700     ELSE                                                         26970099
269800         SET DP013-CICS-ABEND      TO TRUE                        26980099
269900         SET DP013-NO-ROLLBACK     TO TRUE                        26990099
270000         MOVE '6010-DELETE-SEL-QUEUE'                             27000099
270100                                   TO DP013-PARAGRAPH             27010099
270200         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         27020099
270300                                   TO DP013-MESSAGE-TEXT (1)      27030099
270400         PERFORM DP013-0000-PROCESS-ABEND                         27040099
270500     END-IF.                                                      27050099
270600                                                                  27060099
270700/                                                                 27070099
270800*----------------------------------------------------------------*27080099
270900*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *27090099
271000*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *27100099
271100*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *27110099
271200*    THE TEMP QUEUE.                                             *27120099
271300*----------------------------------------------------------------*27130099
271400                                                                  27140099
271500 6100-UPDATE-TSQ.                                                 27150099
271600                                                                  27160099
271700     ADD 1                         TO PV-SEL-QUEUE-ITEM.          27170099
271800     PERFORM 6105-READ-SEL-QUEUE.                                 27180099
271900                                                                  27190099
272000     PERFORM                                                      27200099
272100         VARYING CN007-IDX                                        27210099
272200         FROM 1 BY 1                                              27220099
272300         UNTIL ((PV-ITEMS-PROCESSED >                             27230099
272400                              PV-HOLD-SELECTED-ITEMS)             27240099
272500         OR (CN007-IDX GREATER THAN CN007-MAX-ITEMS))             27250099
272600         IF  CN007-ACTION-SW (CN007-IDX) > SPACE                  27260099
272700             PERFORM 6110-PROCESS-ITEMS                           27270099
272800         END-IF                                                   27280099
272900         ADD +1                    TO PV-ITEMS-PROCESSED          27290099
273000     END-PERFORM.                                                 27300099
273100                                                                  27310099
273200     PERFORM 6111-WRITE-LIST-QUEUE.                               27320099
273300                                                                  27330099
273400/                                                                 27340099
273500*----------------------------------------------------------------*27350099
273600*    READ THE LIST QUEUE RECORD.                                 *27360099
273700*----------------------------------------------------------------*27370099
273800                                                                  27380099
273900 6105-READ-SEL-QUEUE.                                             27390099
274000                                                                  27400099
274100     EXEC CICS                                                    27410099
274200          READQ TS                                                27420099
274300              QUEUE (ASC-SEL-QUEUE-NAME)                          27430099
274400              INTO  (CN007-TS-SEL-REC)                            27440099
274500              ITEM  (PV-SEL-QUEUE-ITEM)                           27450099
274600              RESP  (PV-CICS-RESP)                                27460099
274700     END-EXEC.                                                    27470099
274800                                                                  27480099
274900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27490099
275000         CONTINUE                                                 27500099
275100     ELSE                                                         27510099
275200         SET DP013-CICS-ABEND      TO TRUE                        27520099
275300         SET DP013-NO-ROLLBACK     TO TRUE                        27530099
275400         MOVE '6105-READ-SEL-QUEUE'                               27540099
275500                                   TO DP013-PARAGRAPH             27550099
275600         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           27560099
275700                                   TO DP013-MESSAGE-TEXT(1)       27570099
275800         PERFORM DP013-0000-PROCESS-ABEND                         27580099
275900     END-IF.                                                      27590099
276000                                                                  27600099
276100/                                                                 27610099
276200*----------------------------------------------------------------*27620099
276300*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*27630099
276400*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*27640099
276500*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *27650099
276600*----------------------------------------------------------------*27660099
276700                                                                  27670099
276800 6110-PROCESS-ITEMS.                                              27680099
276900                                                                  27690099
277000     COMPUTE PV-ITEM = 1 + ((CN007-ITEM (CN007-IDX) - 1)          27700099
277100                     / PC-ITEMS-PER-PANEL).                       27710099
277200                                                                  27720099
277300     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           27730099
277400         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          27740099
277500             PERFORM 6111-WRITE-LIST-QUEUE                        27750099
277600         END-IF                                                   27760099
277700         MOVE PV-ITEM              TO PV-SAVE-ITEM                27770099
277800                                                                  27780099
277900         PERFORM 6112-READ-LIST-QUEUE                             27790099
278000         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               27800099
278100             CONTINUE                                             27810099
278200         END-IF                                                   27820099
278300     END-IF.                                                      27830099
278400                                                                  27840099
278500     COMPUTE PV-SUB = (CN007-ITEM (CN007-IDX)                     27850099
278600                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              27860099
278700                                                                  27870099
278800     SET LQW-DESELECT (PV-SUB)     TO TRUE.                       27880099
278900     MOVE LQW-SELECTED-SW (PV-SUB) TO LQW-TEMP-SELECTED-SW        27890099
279000                                     (PV-SUB).                    27900099
279100     EVALUATE TRUE                                                27910099
279200         WHEN CN007-INQ (CN007-IDX)                               27920099
279300              MOVE PC-INQ          TO LQW-ACTION (PV-SUB)         27930099
279400                                                                  27940099
279500         WHEN CN007-UPD (CN007-IDX)                               27950099
279600              MOVE PC-UPD          TO LQW-ACTION (PV-SUB)         27960099
279700                                                                  27970099
279800         WHEN CN007-DEL (CN007-IDX)                               27980099
279900              MOVE PC-DEL          TO LQW-ACTION (PV-SUB)         27990099
280000                                                                  28000099
280100         WHEN CN007-ERR (CN007-IDX)                               28010099
280200              MOVE PC-ERR          TO LQW-ACTION (PV-SUB)         28020099
280300     END-EVALUATE.                                                28030099
280400                                                                  28040099
280500     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                28050099
280600                                                                  28060099
280700/                                                                 28070099
280800*----------------------------------------------------------------*28080099
280900*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *28090099
281000*----------------------------------------------------------------*28100099
281100                                                                  28110099
281200 6111-WRITE-LIST-QUEUE.                                           28120099
281300                                                                  28130099
281400     EXEC CICS                                                    28140099
281500         WRITEQ TS                                                28150099
281600             QUEUE (ASC-LIST-QUEUE-NAME)                          28160099
281700             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     28170099
281800             ITEM  (PV-SAVE-ITEM)                                 28180099
281900             REWRITE                                              28190099
282000             RESP  (PV-CICS-RESP)                                 28200099
282100     END-EXEC.                                                    28210099
282200                                                                  28220099
282300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28230099
282400         CONTINUE                                                 28240099
282500     ELSE                                                         28250099
282600         SET DP013-CICS-ABEND      TO TRUE                        28260099
282700         SET DP013-NO-ROLLBACK     TO TRUE                        28270099
282800         MOVE '6111-WRITE-LIST-QUEUE'                             28280099
282900                                   TO DP013-PARAGRAPH             28290099
283000         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  28300099
283100                                   TO DP013-MESSAGE-TEXT(1)       28310099
283200         PERFORM DP013-0000-PROCESS-ABEND                         28320099
283300     END-IF.                                                      28330099
283400                                                                  28340099
283500/                                                                 28350099
283600*----------------------------------------------------------------*28360099
283700*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*28370099
283800*----------------------------------------------------------------*28380099
283900                                                                  28390099
284000 6112-READ-LIST-QUEUE.                                            28400099
284100                                                                  28410099
284200     EXEC CICS                                                    28420099
284300         READQ TS                                                 28430099
284400             QUEUE (ASC-LIST-QUEUE-NAME)                          28440099
284500             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     28450099
284600             ITEM  (PV-ITEM)                                      28460099
284700             RESP  (PV-CICS-RESP)                                 28470099
284800     END-EXEC.                                                    28480099
284900                                                                  28490099
285000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28500099
285100         CONTINUE                                                 28510099
285200     ELSE                                                         28520099
285300         SET DP013-CICS-ABEND      TO TRUE                        28530099
285400         SET DP013-NO-ROLLBACK     TO TRUE                        28540099
285500         MOVE '6112-READ-LIST-QUEUE'                              28550099
285600                                   TO DP013-PARAGRAPH             28560099
285700         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    28570099
285800                                   TO DP013-MESSAGE-TEXT(1)       28580099
285900         PERFORM DP013-0000-PROCESS-ABEND                         28590099
286000     END-IF.                                                      28600099
286100/                                                                 28610099
286200 7000-OPEN-TSTRZN-CURSOR.                                         28620099
286300                                                                  28630099
286400     EXEC SQL                                                     28640099
286500         OPEN ZONE-CSR                                            28650099
286600     END-EXEC                                                     28660099
286700                                                                  28670099
286800     EVALUATE TRUE                                                28680099
286900         WHEN SQLCODE = ZERO                                      28690099
287000              CONTINUE                                            28700099
287100         WHEN SQLCODE = -904                                      28710099
287200         WHEN SQLCODE = -911                                      28720099
287300         WHEN SQLCODE = -913                                      28730099
287400              PERFORM 9900-SOFT-ABORT                             28740099
287500         WHEN SQLWARN0 NOT = SPACE                                28750099
287600         WHEN SQLCODE  NOT = ZERO                                 28760099
287700             MOVE '7000-OPEN-TSTRZN-CURSOR'                       28770099
287800                                   TO DP013-PARAGRAPH             28780099
287900             MOVE 'OPEN ZONE CURSOR'                              28790099
288000                                   TO DP013-MESSAGE-TEXT (1)      28800099
288100             MOVE SQLCA       TO DP013-SQLCA                      28810099
288200             MOVE 'TSTRZN '   TO DP013-DB2-TABLE-NAME (1)         28820099
288300             SET DP013-DB2-ABEND                                  28830099
288400                                   TO TRUE                        28840099
288500             PERFORM DP013-0000-PROCESS-ABEND                     28850099
288600     END-EVALUATE.                                                28860099
288700                                                                  28870099
288800 7100-FETCH-TSTRZN-CURSOR.                                        28880099
288900     EXEC SQL                                                     28890099
289000         FETCH ZONE-CSR                                           28900099
289100          INTO :STRZN-STR-ZN-ID                                   28910099
289200             , :STRZN-STR-ZN-DESC                                 28920099
289300     END-EXEC.                                                    28930099
289400                                                                  28940099
289500     EVALUATE TRUE                                                28950099
289600         WHEN SQLCODE = ZERO                                      28960099
289700         WHEN SQLCODE = +100                                      28970099
289800              CONTINUE                                            28980099
289900         WHEN SQLWARN0 NOT = SPACE                                28990099
290000         WHEN SQLCODE < ZERO                                      29000099
290100         WHEN SQLCODE > ZERO                                      29010099
290200             MOVE '7000-FETCH-TSTRZN-CURSOR'                      29020099
290300                                   TO DP013-PARAGRAPH             29030099
290400              MOVE 'FETCH ZONE CURSOR'                            29040099
290500                                   TO DP013-MESSAGE-TEXT (1)      29050099
290600              MOVE SQLCA           TO DP013-SQLCA                 29060099
290700              MOVE 'TSTRZN '       TO DP013-DB2-TABLE-NAME (1)    29070099
290800              SET DP013-DB2-ABEND  TO TRUE                        29080099
290900              PERFORM DP013-0000-PROCESS-ABEND                    29090099
291000     END-EVALUATE.                                                29100099
291100                                                                  29110099
291200 7200-CLOSE-TSTRZN-CURSOR.                                        29120099
291300                                                                  29130099
291400     EXEC SQL                                                     29140099
291500         CLOSE ZONE-CSR                                           29150099
291600     END-EXEC.                                                    29160099
291700                                                                  29170099
291800     EVALUATE TRUE                                                29180099
291900         WHEN SQLCODE = ZERO                                      29190099
292000              CONTINUE                                            29200099
292100         WHEN SQLWARN0 NOT = SPACE                                29210099
292200         WHEN SQLCODE  NOT = +0                                   29220099
292300              MOVE '7200-CLOSE-TSTRZN-CURSOR'                     29230099
292400                                   TO DP013-PARAGRAPH             29240099
292500              MOVE 'CLOSE ZONE CURSOR'                            29250099
292600                                   TO DP013-MESSAGE-TEXT (1)      29260099
292700              MOVE SQLCA           TO DP013-SQLCA                 29270099
292800              MOVE 'TSTRZN '       TO DP013-DB2-TABLE-NAME (1)    29280099
292900              SET DP013-DB2-ABEND  TO TRUE                        29290099
293000              PERFORM DP013-0000-PROCESS-ABEND                    29300099
293100     END-EVALUATE.                                                29310099
293101                                                                  29310199
293103                                                                  29310399
293110 7210-OPEN-HANG-FOLD-CURSOR.                                      29311099
293120                                                                  29312099
293130     EXEC SQL                                                     29313099
293140         OPEN HANG-FOLD-CSR                                       29314099
293150     END-EXEC                                                     29315099
293160                                                                  29316099
293170     EVALUATE TRUE                                                29317099
293180         WHEN SQLCODE = ZERO                                      29318099
293190              CONTINUE                                            29319099
293191         WHEN SQLCODE = -904                                      29319199
293192         WHEN SQLCODE = -911                                      29319299
293193         WHEN SQLCODE = -913                                      29319399
293194              PERFORM 9900-SOFT-ABORT                             29319499
293195         WHEN SQLWARN0 NOT = SPACE                                29319599
293196         WHEN SQLCODE  NOT = ZERO                                 29319699
293197             MOVE '7210-OPEN-HANG-FOLD-CURSOR'                    29319799
293198                                   TO DP013-PARAGRAPH             29319899
293199             MOVE 'OPEN HANG FOLD CURSOR'                         29319999
293200                                   TO DP013-MESSAGE-TEXT (1)      29320099
293201             MOVE 'WST_INTGRTN_TYP   WST_ATTR_DEFN'               29320199
293202                                   TO DP013-MESSAGE-TEXT (2)      29320299
293203             MOVE 'WST_ATTR_ELEM'                                 29320399
293204                                   TO DP013-MESSAGE-TEXT (3)      29320499
293205             MOVE SQLCA       TO DP013-SQLCA                      29320599
293206             MOVE 'WST00008'  TO DP013-DB2-TABLE-NAME (1)         29320699
293207             MOVE 'WST00009'  TO DP013-DB2-TABLE-NAME (2)         29320799
293208             MOVE 'WST00010'  TO DP013-DB2-TABLE-NAME (3)         29320899
293209             SET DP013-DB2-ABEND                                  29320999
293210                                   TO TRUE                        29321099
293211             PERFORM DP013-0000-PROCESS-ABEND                     29321199
293212     END-EVALUATE.                                                29321299
293213                                                                  29321399
293214 7220-FETCH-HANG-FOLD-CURSOR.                                     29321499
293215                                                                  29321599
293216     EXEC SQL                                                     29321699
293217         FETCH HANG-FOLD-CSR                                      29321799
293218          INTO :PV-WST-STORE-ZONE                                 29321899
293220     END-EXEC.                                                    29322099
293221                                                                  29322199
293222     EVALUATE TRUE                                                29322299
293223         WHEN SQLCODE = ZERO                                      29322399
293224         WHEN SQLCODE = +100                                      29322499
293225              CONTINUE                                            29322599
293226         WHEN SQLWARN0 NOT = SPACE                                29322699
293227         WHEN SQLCODE < ZERO                                      29322799
293228         WHEN SQLCODE > ZERO                                      29322899
293229             MOVE '7220-FETCH-HANG-FOLD-CURSOR'                   29322999
293230                                   TO DP013-PARAGRAPH             29323099
293231              MOVE 'FETCH HANG FOLD CURSOR'                       29323199
293232                                   TO DP013-MESSAGE-TEXT (1)      29323299
293233              MOVE 'WST_INTGRTN_TYP   WST_ATTR_DEFN'              29323399
293234                                   TO DP013-MESSAGE-TEXT (2)      29323499
293235              MOVE 'WST_ATTR_ELEM'                                29323599
293236                                   TO DP013-MESSAGE-TEXT (3)      29323699
293237              MOVE SQLCA           TO DP013-SQLCA                 29323799
293238              MOVE 'WST00008'  TO DP013-DB2-TABLE-NAME (1)        29323899
293239              MOVE 'WST00009'  TO DP013-DB2-TABLE-NAME (2)        29323999
293240              MOVE 'WST00010'  TO DP013-DB2-TABLE-NAME (3)        29324099
293242              SET DP013-DB2-ABEND  TO TRUE                        29324299
293243              PERFORM DP013-0000-PROCESS-ABEND                    29324399
293244     END-EVALUATE.                                                29324499
293245                                                                  29324599
293246 7230-CLOSE-HANG-FOLD-CURSOR.                                     29324699
293247                                                                  29324799
293248     EXEC SQL                                                     29324899
293249         CLOSE HANG-FOLD-CSR                                      29324999
293250     END-EXEC.                                                    29325099
293251                                                                  29325199
293252     EVALUATE TRUE                                                29325299
293253         WHEN SQLCODE = ZERO                                      29325399
293254              CONTINUE                                            29325499
293255         WHEN SQLWARN0 NOT = SPACE                                29325599
293256         WHEN SQLCODE  NOT = +0                                   29325699
293257              MOVE '7230-CLOSE-HANG-FOLD-CURSOR'                  29325799
293258                                   TO DP013-PARAGRAPH             29325899
293259              MOVE 'CLOSE HANG FOLD CURSOR'                       29325999
293260                                   TO DP013-MESSAGE-TEXT (1)      29326099
293261              MOVE 'WST_INTGRTN_TYP   WST_ATTR_DEFN'              29326199
293262                                   TO DP013-MESSAGE-TEXT (2)      29326299
293263              MOVE 'WST_ATTR_ELEM'                                29326399
293264                                   TO DP013-MESSAGE-TEXT (3)      29326499
293265              MOVE SQLCA           TO DP013-SQLCA                 29326599
293266              MOVE 'WST00008'  TO DP013-DB2-TABLE-NAME (1)        29326699
293267              MOVE 'WST00009'  TO DP013-DB2-TABLE-NAME (2)        29326799
293268              MOVE 'WST00010'  TO DP013-DB2-TABLE-NAME (3)        29326899
293270              SET DP013-DB2-ABEND  TO TRUE                        29327099
293271              PERFORM DP013-0000-PROCESS-ABEND                    29327199
293272     END-EVALUATE.                                                29327299
293273                                                                  29327399
293280                                                                  29328099
293300 9900-SOFT-ABORT.                                                 29330099
293400     SET PS-ERROR         TO TRUE.                                29340099
293500     SET DP020-MSG-FATAL  TO TRUE.                                29350099
293600     MOVE 'THROUGH SOFT-ABORT PARA'                               29360099
293700                      TO DP013-MESSAGE-TEXT (1)                   29370099
293800     MOVE PC-TSYMSG-00551 TO DP020-MSG-NUMBER.                    29380099
293900     IF PS-NO-NEXT-SCREEN                                         29390099
294000        SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                     29400099
294100     END-IF.                                                      29410099
294200     PERFORM 9901-BACKUP.                                         29420099
294300     MOVE 'PROGRAM EXIT CALL' TO DP013-MESSAGE-TEXT (1).          29430099
294400     PERFORM 0001-CALL-CICS-ARCH-API.                             29440099
294500                                                                  29450099
294600 9901-BACKUP.                                                     29460099
294700     EXEC CICS SYNCPOINT                                          29470099
294800          ROLLBACK                                                29480099
294900     END-EXEC.                                                    29490099
295000                                                                  29500099
295100/                                                                 29510099
295200*----------------------------------------------------------------*29520099
295300*    ABEND PROCESSOR MODULE                                      *29530099
295400*----------------------------------------------------------------*29540099
295500                                                                  29550099
295600     COPY DPPD013.                                                29560099
