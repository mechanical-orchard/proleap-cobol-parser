000100 IDENTIFICATION DIVISION.                                         00020000
000200 PROGRAM-ID.    POKCS082.                                         00040002
000300 AUTHOR.        DENNIS STEFFEN - OMNI RESOURCES.                  00050002
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000500 DATE-WRITTEN.  DECEMBER 1996.                                    00070002
000600 DATE-COMPILED.                                                   00080000
000700 ENVIRONMENT DIVISION.                                            00200000
000800 DATA DIVISION.                                                   00240000
000900                                                                  00260000
C98147*----------------------------------------------------------------*        
C98147* DATE  11/25/14  LINDA FRIESS                  - CHG0098147              
C98147*       RECOMPILED PROGRAM TO BRING IN NEW MAP WITH 8-DIGIT PO            
C98147*----------------------------------------------------------------*        
CICS  *  CHANGED 11/15/2022    BY BARB SCHULTZ    WR: CHG0278485                
CICS  *                                                                         
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL             
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.              
CICS  *----------------------------------------------------------------*        
001000 WORKING-STORAGE SECTION.                                         00270000
001100                                                                  00280000
001200                                                                  00340000
001300 01  PC-PROGRAM-CONSTANTS.                                        00350000
001400     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'POKCS082'.  00360002
001500     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'PO082A  '.  00370002
001600     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'POKM082 '.  00380002
001700     05  PC-DPKUT100              PIC  X(08)  VALUE  'DPKUT100'.  00380002
001800     05  PC-DPKUT500              PIC  X(08)  VALUE  'DPKUT500'.  00380002
001900     05  PC-APPL-MAP              PIC S9(04)  VALUE  +1           00390000
002000                                              COMP.               00400000
002100     05  PC-A                     PIC X       VALUE 'A'.          00410003
002200     05  PC-N                     PIC X       VALUE 'N'.          00410003
002300     05  PC-S                     PIC X       VALUE 'S'.          00410003
002400     05  PC-R                     PIC X       VALUE 'R'.          00410003
002500     05  PC-Y                     PIC X       VALUE 'Y'.          00410003
002600     05  PC-CA                    PIC X(2)    VALUE 'CA'.         00410003
002700     05  PC-CM                    PIC X(2)    VALUE 'CM'.         00410003
002800     05  PC-NULL-TMST             PIC X(26)   VALUE               00410003
002900         '0001-01-01-00.00.00.000000'.                                    
003000     05  PC-NULL-DTE              PIC X(10)   VALUE '9999-09-09'. 00410003
003100     05  PC-NULL-TM               PIC X(08)   VALUE '09.09.09'.   00410003
003200     05  PC-NOT-TRANSMITTED       PIC X(15) VALUE                         
003300             'NOT TRANSMITTED'.                                           
003400     05  PC-TRANSMITTED           PIC X(15) VALUE                         
003500             'TRANSMITTED    '.                                           
003600     05  PC-SCHEDULED             PIC X(15) VALUE                         
003700             'SCHEDULED      '.                                           
003800     05  PC-SENT-WO-SPLITS        PIC X(15) VALUE                         
003900             'SENT W/O SPLITS'.                                           
004000     05  PC-RETRANSMITTED         PIC X(15) VALUE                         
004100             'RETRANSMITTED  '.                                           
004200                                                                          
004300     05  PC-TSYMSG-NUMBERS.                                       00510000
004400         10  PC-TSYMSG-00005      PIC  9(05)  VALUE  00005.       00520000
004500         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       00520000
004600         10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       00520000
004700         10  PC-TSYMSG-00009      PIC  9(05)  VALUE  00009.       00520000
004800         10  PC-TSYMSG-00046      PIC  9(05)  VALUE  00046.       00520000
004900         10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       00530000
005000         10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.       00540000
005100         10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.       00550000
005200         10  PC-TSYMSG-00095      PIC  9(05)  VALUE  00095.       00560000
005300         10  PC-TSYMSG-00148      PIC  9(05)  VALUE  00148.       00570000
005400         10  PC-TSYMSG-00302      PIC  9(05)  VALUE  00302.       00580000
005500         10  PC-TSYMSG-00388      PIC  9(05)  VALUE  00388.       00590000
005600         10  PC-TSYMSG-00551      PIC  9(05)  VALUE  00551.       00590000
005700         10  PC-TSYMSG-00968      PIC  9(05)  VALUE  00968.       00590000
005800         10  PC-TSYMSG-01465      PIC  9(05)  VALUE  01465.       00590000
005900         10  PC-TSYMSG-01466      PIC  9(05)  VALUE  01466.       00590000
006000         10  PC-TSYMSG-01523      PIC  9(05)  VALUE  01523.       00590000
006100         10  PC-TSYMSG-99901      PIC  9(05)  VALUE  99901.       00600000
006200                                                                  00610000
006300 01  PS-PROGRAM-SWITCHES.                                         00620000
006400     05  PS-ERROR-SW              PIC  X(01) VALUE  'N'.          00630000
006500         88  PS-ERROR                        VALUE  'Y'.          00640000
006600         88  PS-NO-ERROR                     VALUE  'N'.          00650000
006700     05  PS-KEYING-ERR-SW         PIC X(01)  VALUE 'N'.           RCKCS266
006800         88  PS-KEYED-OKAY                   VALUE 'Y'.           RCKCS266
006900         88  PS-KEYED-WRONG                  VALUE 'N'.           RCKCS266
007000                                                                  00660000
007100 01  PV-PROGRAM-VARIABLES.                                        00670000
007200     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            00680000
007300                                              COMP SYNC.          00690000
007400     05  PV-INPUT-DATE.                                           RCKCS266
007500         10  PV-INPUT-DATE-MM           PIC 9(2)     VALUE ZEROES.RCKCS266
007600         10  PV-INPUT-DATE-DD           PIC 9(2)     VALUE ZEROES.RCKCS266
007700         10  PV-INPUT-DATE-CCYY         PIC 9(4)     VALUE ZEROES.RCKCS266
007800         10  FILLER REDEFINES PV-INPUT-DATE-CCYY.                 RCKCS266
007900             15  PV-INPUT-DATE-CC       PIC 9(2).                 RCKCS266
008000             15  PV-INPUT-DATE-YY       PIC 9(2).                 RCKCS266
008100     05  PV-VALID-DATE.                                           RCKCS266
008200         10  PV-VALID-DATE-MM           PIC X(2)     VALUE SPACES.RCKCS266
008300         10  PV-VALID-DATE-DD           PIC X(2)     VALUE SPACES.RCKCS266
008400         10  PV-VALID-DATE-CCYY         PIC X(4)     VALUE SPACES.RCKCS266
008500         10  FILLER REDEFINES PV-VALID-DATE-CCYY.                 RCKCS266
008600             15  PV-VALID-DATE-CC       PIC X(2).                 RCKCS266
008700             15  PV-VALID-DATE-YY       PIC X(2).                 RCKCS266
008800     05  PV-CURRENT-DATE                PIC X(10).                        
008900                                                                  00740000
009000     EJECT                                                        00750000
009100**--------------------------------------------------------------**00760000
009200** THE LAYOUT FOR THE TEMPORARY STORAGE QUEUE CONTAINING        **00770000
009300** SELECTED LIST ITEMS TO BE PROCESSED BY THIS PROGRAM.         **00780000
009400**--------------------------------------------------------------**00790000
009500     COPY DPWS057.                                                00800003
009600 EJECT                                                            00810000
009700                                                                  00820000
009800*----------------------------------------------------------------*00830000
009900*    MAP LAYOUT                                                  *00840000
010000*----------------------------------------------------------------*00850000
010100                                                                  00860000
010200     COPY POKM082.                                                00870002
010300                                                                  00880000
010400 EJECT                                                            00890000
010500*----------------------------------------------------------------*00900000
010600*    ATTRIBUTE SETTINGS COPYBOOK.                                *00910000
010700*----------------------------------------------------------------*00920000
010800                                                                  00930000
010900     COPY DPWS015.                                                00940003
011000                                                                  00950000
011100*----------------------------------------------------------------*00960000
011200*    FUNCTION KEYS COPYBOOK                                      *00970000
011300*----------------------------------------------------------------*00980000
011400                                                                  00990000
011500     COPY DPWS016.                                                01000003
011600                                                                  01010000
011700/                                                                 01020000
011800**--------------------------------------------------------------**01030000
011900** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01040000
012000** SUB-ROUTINE (DPKUT100).                                      **01050000
012100**--------------------------------------------------------------**01060000
012200     COPY DPWS010I.                                               01070003
012300/                                                                 01020000
012400** DATE EDITING                                                 **01050000
012500     COPY DPWS500.                                                01070003
012600 EJECT                                                            01080000
012700**--------------------------------------------------------------**01090000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          **01100000
013000**--------------------------------------------------------------**01120000
013100     COPY DPWS030.                                                01130003
CICS       COPY DPWS930.                                                01130003
013200 EJECT                                                            01140000
013300**--------------------------------------------------------------**01150000
013400*    STANDARD COMMAREA.                                           01160000
013500**--------------------------------------------------------------**01170000
013600                                                                  01180000
013700     COPY DPWS020.                                                01190003
013800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01200000
013900                                                                  01210000
014000***************************************************************** 01220000
014100*    INTER-APPLICATION COMMAREA.                                  01230000
014200***************************************************************** 01240000
014300                                                                  01250000
014400         10  INTER-APPL-COMM-AREA PIC X(200).                     01260000
014500     COPY POWS011.                                                01270002
014600     COPY TRWS119.                                                        
014700***************************************************************** 01290000
014800*    SPECIFIC COMMMAREA FOR POKCS082.                             01300002
014900***************************************************************** 01310000
015000         10  ASC-SPECIFIC-COMMAREA.                               01320000
015100             15  ASC-INT-APPL-FORMAT-IND   PIC  X(01).            01330000
015200             15  ASC-MSG-NUMBER.                                  01340000
015300                 20  ASC-MSG-NUMBER-N      PIC  9(05).            01350000
015400             15  ASC-SYSTEM-ID             PIC  X(02).            01360000
015500             15  ASC-MSG-TEXT              PIC  X(70).            01370000
015600             15  ASC-USE-SELECTION-QUEUE-IND                      01380000
015700                                           PIC  X(01).            01390000
015800                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 01400000
015900             15  ASC-SEL-QUEUE-NAME        PIC  X(08).            01410000
016000             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05)  COMP-3.    01420000
016100             15  ASC-NUMBER-OF-SELECTED-ITEMS                     01430000
016200                                           PIC S9(09)  COMP-3.    01440000
016300             15  ASC-SEL-SUB               PIC S9(04)  COMP.      01450000
016400             15  ASC-SEL-ITEM              PIC S9(04)  COMP.      01460000
016500             15  ASC-KEY-PO-NBR            PIC S9(09) COMP.       00300003
016600             15  ASC-KEY-VENDOR-NAME       PIC X(30).                     
016700             15  ASC-KEY-DEPT-NBR          PIC X(03).                     
016800             15  ASC-STATUS-CDE            PIC X(02).             01550038
016900             15  ASC-SCREEN-FIELDS.                                       
017000                 20  ASC-PO-STATUS-DESC    PIC X(20).             01560644
022100                 20  ASC-DCONSLR-RLSE-CDE  PIC X(1).                      
022200                 20  ASC-DCONSLR-ACTL-DTE  PIC X(10).                     
022300                 20  ASC-DCONSLR-ACTL-TM   PIC X(8).                      
022400                 20  ASC-DCN-RLSE-CDE      PIC X(1).                      
022500                 20  ASC-DCN-ACTL-DTE      PIC X(10).                     
022600                 20  ASC-DCN-ACTL-TM       PIC X(8).                      
022900                 20  ASC-DCTEXT            PIC X(19).                     
023000     EJECT                                                        01480000
023100*----------------------------------------------------------------*01490000
023200*    ABEND PROCESSING COPYBOOK.                                  *01500000
023300*----------------------------------------------------------------*01510000
023400                                                                  01520000
023500     COPY DPWS013.                                                01530003
023600/                                                                 01550003
023700     EXEC SQL                                                     01590000
023800          INCLUDE TIMPORL                                         01600003
023900     END-EXEC.                                                    01610000
024000/                                                                 01611003
024100     EXEC SQL                                                     01590000
024200          INCLUDE TIMCNRL                                         01600003
024300     END-EXEC.                                                    01610000
024400/                                                                 01611003
024500     EXEC SQL                                                     01590000
024600          INCLUDE TAUCNRL                                         01600003
024700     END-EXEC.                                                    01610000
024800/                                                                 01611003
024900     EXEC SQL                                                     01612003
025000          INCLUDE TPURCHS                                         01613003
025100     END-EXEC.                                                    01614003
025200/                                                                 01620003
025300     EXEC SQL                                                     01612003
025400          INCLUDE TSTATCD                                         01613003
025500     END-EXEC.                                                    01614003
025600/                                                                 01620003
025700     EXEC SQL                                                     01710000
025800          INCLUDE SQLCA                                           01720000
025900     END-EXEC.                                                    01730000
026000/                                                                 01750003
026100*----------------------------------------------------------------*07260000
026200*    CURSOR DECLARATION FOR TIMCNRL EARLIEST RELEASE DATE (Y&R)  *07270000
026300*----------------------------------------------------------------*07280000
026400                                                                  07290000
026500         EXEC SQL                                                 10643099
026600          DECLARE  RLSE_DTE_CSR CURSOR                            07310000
026700             FOR SELECT MIN(DATE(DCONSLR_ACTL_DTE))               10644099
026800                   ,DCONSLR_ACTL_TM                                       
026900                   ,DCONSLR_RLSE_CDE                                      
027000             FROM   TIMCNRL                                       10648099
027100             WHERE  PO_NBR           = :ASC-KEY-PO-NBR            28180000
027200             AND    (DCONSLR_RLSE_CDE = 'R'  OR                   28190000
027300                     DCONSLR_RLSE_CDE = 'Y')                      28200000
027400             AND    DATE(DCONSLR_ACTL_DTE)   <>                   10651099
027500                                '9999-09-09'                      10652099
027600             GROUP BY DCONSLR_ACTL_DTE                                    
027700                     ,DCONSLR_ACTL_TM                                     
027800                     ,DCONSLR_RLSE_CDE                                    
027900             ORDER BY DCONSLR_ACTL_DTE                                    
028000                     ,DCONSLR_ACTL_TM                                     
028100             FOR FETCH ONLY                                               
028200         END-EXEC                                                 10653099
028300                                                                  10654099
028400*----------------------------------------------------------------*07260000
028500*    CURSOR DECLARATION FOR TAUCNRL EARLIEST RELEASE DATE (Y&R)  *07270000
028600*----------------------------------------------------------------*07280000
028700                                                                  07290000
028800         EXEC SQL                                                 10643099
028900          DECLARE  RLSE_DTE2_CSR CURSOR                           07310000
029000             FOR SELECT MIN(DATE(DCONSLR_ACTL_DTE))               10644099
029100                   ,DCONSLR_ACTL_TM                                       
029200                   ,DCONSLR_RLSE_CDE                                      
029300             FROM   TAUCNRL                                       10648099
029400             WHERE  PO_NBR           = :ASC-KEY-PO-NBR            28180000
029500             AND    (DCONSLR_RLSE_CDE = 'R'  OR                   28190000
029600                     DCONSLR_RLSE_CDE = 'Y')                      28200000
029700             AND    DATE(DCONSLR_ACTL_DTE)   <>                   10651099
029800                                '9999-09-09'                      10652099
029900             GROUP BY DCONSLR_ACTL_DTE                                    
030000                     ,DCONSLR_ACTL_TM                                     
030100                     ,DCONSLR_RLSE_CDE                                    
030200             ORDER BY DCONSLR_ACTL_DTE                                    
030300                     ,DCONSLR_ACTL_TM                                     
030400             FOR FETCH ONLY                                               
030500         END-EXEC                                                 10653099
030600                                                                  10654099
030700*----------------------------------------------------------------*07260000
030800*    CURSOR DECLARATION FOR SELECTING EARLIEST RELEASE DATE      *07270000
030900*----------------------------------------------------------------*07280000
031000                                                                  07290000
031100         EXEC SQL                                                 10643099
031200          DECLARE  RLSE_DTE_NO_CD_CSR CURSOR                      07310000
031300             FOR SELECT MIN(DATE(DCONSLR_ACTL_DTE))               10644099
031400                   ,DCONSLR_ACTL_TM                                       
031500                   ,DCONSLR_RLSE_CDE                                      
031600             FROM   TIMCNRL                                       10648099
031700             WHERE  PO_NBR           = :ASC-KEY-PO-NBR            28180000
031800             AND    DATE(DCONSLR_ACTL_DTE)   <>                   10651099
031900                                '9999-09-09'                      10652099
032000             GROUP BY DCONSLR_ACTL_DTE                                    
032100                     ,DCONSLR_ACTL_TM                                     
032200                     ,DCONSLR_RLSE_CDE                                    
032300             ORDER BY DCONSLR_ACTL_DTE                                    
032400                     ,DCONSLR_ACTL_TM                                     
032500             FOR FETCH ONLY                                               
032600         END-EXEC                                                 10653099
032700                                                                  10654099
032710*----------------------------------------------------------------*        
032720*    CURSOR DECLARATION FOR TAUCNRL Y&R WITH EARLIEST RELEASE    *        
032721*    DATE WHEN TIMCNRL ROW HAS A 'D' RELEASE CODE WITH A DEFAULT *        
032722*    DATE.                                                       *        
032730*----------------------------------------------------------------*        
032740                                                                          
032750         EXEC SQL                                                         
032760          DECLARE  RLSE_DTE_D1_CSR CURSOR                                 
032770             FOR SELECT MIN(DATE(DCONSLR_ACTL_DTE))                       
032780                   ,DCONSLR_ACTL_TM                                       
032790                   ,DCONSLR_RLSE_CDE                                      
032791             FROM   TAUCNRL                                               
032792             WHERE  PO_NBR           = :ASC-KEY-PO-NBR                    
032793             AND    (DCONSLR_RLSE_CDE = 'R'  OR                           
032794                     DCONSLR_RLSE_CDE = 'Y')                              
032797             GROUP BY DCONSLR_ACTL_DTE                                    
032798                     ,DCONSLR_ACTL_TM                                     
032799                     ,DCONSLR_RLSE_CDE                                    
032800             ORDER BY DCONSLR_ACTL_DTE                                    
032801                     ,DCONSLR_ACTL_TM                                     
032802             FOR FETCH ONLY                                               
032803         END-EXEC                                                         
032804                                                                          
032806*----------------------------------------------------------------*        
032808*    CURSOR DECLARATION FOR TAUCNRL S&D(W/DATE) WITH EARLIEST    *        
032809*    RELEASE DATE WHEN TIMCNRL ROW HAS A 'D' RELEASE CODE WITH   *        
032810*    A DEFAULT DATE.                                             *        
032811*----------------------------------------------------------------*        
032812                                                                          
032813         EXEC SQL                                                         
032814          DECLARE  RLSE_DTE_D2_CSR CURSOR                                 
032815             FOR SELECT MIN(DATE(DCONSLR_ACTL_DTE))                       
032816                   ,DCONSLR_ACTL_TM                                       
032817                   ,DCONSLR_RLSE_CDE                                      
032818             FROM   TAUCNRL                                               
032819             WHERE  PO_NBR           = :ASC-KEY-PO-NBR                    
032820               AND  (DCONSLR_RLSE_CDE = 'S')                              
032821                OR  (DCONSLR_RLSE_CDE = 'D' AND                           
032822                     DCONSLR_ACTL_DTE <> :PC-NULL-DTE)                    
032823             GROUP BY DCONSLR_ACTL_DTE                                    
032824                     ,DCONSLR_ACTL_TM                                     
032825                     ,DCONSLR_RLSE_CDE                                    
032826             ORDER BY DCONSLR_ACTL_DTE                                    
032827                     ,DCONSLR_ACTL_TM                                     
032828             FOR FETCH ONLY                                               
032829         END-EXEC                                                         
032830                                                                          
032840*---------------------------------------------------------------* 02460099
032900 LINKAGE SECTION.                                                 01760000
033000                                                                  01770000
033100 01  DFHCOMMAREA.                                                 01780000
033200     05  FILLER                         OCCURS  1 TO 4072 TIMES   01790000
033300                                        DEPENDING ON EIBCALEN.    01800000
033400         10  FILLER                     PIC X.                    01810000
033500/                                                                 01820003
033600 PROCEDURE DIVISION.                                              01840000
033700                                                                  01930000
033800     INITIALIZE DP030-CICS-API-FIELDS.                            01940000
033900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       01950000
034000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          01960000
034100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         01970000
034200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       01980000
034300     MOVE LENGTH OF PO082AI        TO DP030-MAP-LENGTH (1).       01990000
034400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02000000
034500     PERFORM 0001-CALL-CICS-ARCH-API.                             02010000
034600                                                                  02020000
034700     PERFORM 1000-CONTROL-PROCESSING                              02030000
034800                                                                  02040000
034900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02050000
035000     PERFORM 0001-CALL-CICS-ARCH-API.                             02060000
035100                                                                  02070000
035200 0001-CALL-CICS-ARCH-API.                                         02080000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02090000
035400                                    DFHCOMMAREA                   02100000
035500                                    DP030-CICS-API-FIELDS         02110000
035600                                    DP020-STANDARD-COMMAREA       02120000
035700                                    PO082AI.                      02130000
035800                                                                  02140000
035900     IF  DP030-RC-CALL-SUCCESSFUL                                 02150000
036000         CONTINUE                                                 02160000
036100     ELSE                                                         02170000
036200         SET DP013-NO-ROLLBACK                                    02180000
036300             DP013-XCTL-DISPLAY-RESTART                           02190000
036400             DP013-CICS-ABEND      TO TRUE                        02200000
CICS           MOVE '0001-CALL-CICS-ARCH-API'                           02210000
036600                                   TO DP013-PARAGRAPH             02220000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O02230000
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02240000
036900         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      02250000
037000         PERFORM DP013-0000-PROCESS-ABEND                         02260000
037100     END-IF.                                                      02270000
037200 EJECT                                                            02280000
037300 1000-CONTROL-PROCESSING.                                         02340000
037400                                                                  02350000
037500     EVALUATE TRUE                                                02360000
037600         WHEN DP020-NEXT-ACT-INITIAL                              02370000
037700             MOVE PO011-PO-NBR   TO ASC-KEY-PO-NBR                        
037800             MOVE PO011-VENDOR-NAME                                       
037900                                 TO ASC-KEY-VENDOR-NAME                   
038000             MOVE PO011-DEPT-NBR TO ASC-KEY-DEPT-NBR                      
038100             PERFORM 4000-BUILD-INITIAL-PANEL                     02420003
038200***          IF  SQLCODE = +100 OR PS-ERROR                       02430003
038300             IF  PS-ERROR                                         02430003
038400                 SET DP020-NEXT-ACT-APPL-ERROR TO TRUE            02440003
038500                 MOVE PC-TSYMSG-01523                             02450003
038600                                   TO DP020-MSG-NUMBER            02460000
038700                 SET DP020-MSG-INFORMATIONAL TO TRUE              02470003
038800             END-IF                                               02480003
038900                                                                  02500000
039000         WHEN DP020-NEXT-ACT-READ-MAP                             02510000
039100             PERFORM 2000-PROCESS-PANEL                           02520000
039200                                                                  02530000
039300         WHEN DP020-NEXT-ACT-RETURN                               02540000
039310             PERFORM 4000-BUILD-INITIAL-PANEL                     02420003
039500                                                                  02570000
039600         WHEN OTHER                                               02580000
039700             SET DP013-LOGIC-ABEND TO TRUE                        02590000
039800             SET DP013-NO-ROLLBACK TO TRUE                        02600000
039900             MOVE '1000-CONTROL-PROCESSING'                       02610000
040000                                   TO DP013-PARAGRAPH             02620000
040100             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   02630000
040200                                   TO DP013-MESSAGE-TEXT(1)       02640000
040300             MOVE DP020-NEXT-APPL-ACTIVITY                        02650000
040400                                   TO DP013-MESSAGE-TEXT(2)       02660000
040500             PERFORM DP013-0000-PROCESS-ABEND                     02670000
040600     END-EVALUATE.                                                02680000
040700/                                                                         
040800*----------------------------------------------------------------*03450000
040900* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *03460000
041000* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *03470000
041100* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *03480000
041200* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *03490000
041300* FUNCTION KEYS CAN GET THIS FAR.                                *03500000
041400*----------------------------------------------------------------*03510000
041500                                                                  03520000
041600 2000-PROCESS-PANEL.                                              03530000
041700                                                                  03540000
041800     EVALUATE TRUE                                                03550000
041900                                                                  03560000
042000         WHEN DP020-SRC-AID = DP016-CLEAR                         03570000
042100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03580000
042200                                                                  03600000
042300         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     03610000
042400             SET DP030-DONT-ERASE                                 03620000
042500                 DP030-SEND-DATAONLY (PC-APPL-MAP)                03630000
042600                                   TO TRUE                        03640000
042700             PERFORM 4000-BUILD-INITIAL-PANEL                     03650000
042800                                                                  03670000
042900         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             03680000
043000             IF  ASC-USE-SELECTION-QUEUE                          03690000
043100                 PERFORM 2110-GET-NEXT-MESSAGE                    03700000
043200                 PERFORM 4000-BUILD-INITIAL-PANEL                 03710000
043300             ELSE                                                 03730000
043400*                --- BOTTOM OF LIST ---                           03740000
043500                 MOVE PC-TSYMSG-00070                             03750000
043600                                   TO DP020-MSG-NUMBER            03760000
043700                 SET DP020-MSG-INFORMATIONAL                      03770000
043800                                   TO TRUE                        03780000
043900             END-IF                                               03790000
044000                                                                  03800000
044100         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             03810000
044200             IF  ASC-USE-SELECTION-QUEUE                          03820000
044300                 PERFORM 2120-GET-PREV-MESSAGE                    03830000
044400                 PERFORM 4000-BUILD-INITIAL-PANEL                 03840000
044500             ELSE                                                 03860000
044600*                --- TOP OF LIST ---                              03870000
044700                 MOVE PC-TSYMSG-00069                             03880000
044800                                   TO DP020-MSG-NUMBER            03890000
044900                 SET DP020-MSG-INFORMATIONAL                      03900000
045000                                   TO TRUE                        03910000
045100             END-IF                                               03920000
045200                                                                  03930000
045300         WHEN OTHER                                               03940000
045400             IF  PS-NO-ERROR                                      03970000
045500                 SET DP030-CONTINUE-GO                            03980000
045600                                   TO TRUE                        03990000
045700                 PERFORM 2100-CHECK-FUNCTION-KEY                  04000000
045800             ELSE                                                 04010000
045900                 SET DP030-OVERRIDE-GO                            04020000
046000                                   TO TRUE                        04030000
046100             END-IF                                               04040000
046200     END-EVALUATE.                                                04050000
046300*----------------------------------------------------------------*04060000
046400* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *04070000
046500* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *04080000
046600* FROM THE CICS ARCHITECTURE API.                                *04090000
046700*----------------------------------------------------------------*04100000
046800                                                                  04110000
046900 2100-CHECK-FUNCTION-KEY.                                         04120000
047000                                                                          
047100     EVALUATE TRUE                                                04130000
047200         WHEN DP020-SRC-AID = DP016-ENTER                         04140000
047300             CONTINUE                                             04150000
047400                                                                  04240000
047500         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                      
047600             INITIALIZE TR119-INTER-APPL-COMMAREA                         
047700             MOVE ASC-KEY-PO-NBR      TO TR119-PO-NBR                     
047800             MOVE ASC-KEY-VENDOR-NAME TO TR119-VENDOR-NAME                
047900             MOVE ASC-KEY-DEPT-NBR    TO TR119-DEPT-NBR                   
048000             MOVE ASC-PO-STATUS-DESC  TO TR119-STATUS                     
048100                                                                          
048200         WHEN OTHER                                               04250000
048300             SET DP013-NO-ROLLBACK                                04260000
048400                 DP013-XCTL-DISPLAY-RESTART                       04270000
048500                 DP013-CICS-ABEND  TO TRUE                        04280000
048600             MOVE '2000-PROCESS-PANEL'                            04290000
048700                                   TO DP013-PARAGRAPH             04300000
048800             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      04310000
048900                                   TO DP013-MESSAGE-TEXT (1)      04320000
049000             PERFORM DP013-0000-PROCESS-ABEND                     04330000
049100     END-EVALUATE.                                                04340000
049200                                                                  04350000
049300 2110-GET-NEXT-MESSAGE.                                           04360000
049400     ADD +1                        TO ASC-SEL-SUB.                04370000
049500     IF  ASC-SEL-SUB > DP057-MAX-ITEMS                            04380000
049600         ADD +1                    TO ASC-SEL-ITEM                04390000
049700         MOVE +1                   TO ASC-SEL-SUB                 04400000
049800     END-IF.                                                      04410000
049900     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                04420000
050000         PERFORM 9100-READ-SEL-QUEUE                              04430000
050100         IF  DP057-ITEM (ASC-SEL-SUB) > ZERO                      04440000
050200             MOVE DP057-MESSAGE-NUMBER (ASC-SEL-SUB)              04450000
050300                                   TO ASC-MSG-NUMBER-N            04460000
050400             SET DP057-INQ (ASC-SEL-SUB)                          04470000
050500                                   TO TRUE                        04480000
050600             PERFORM 9200-REWRITE-LIST-QUEUE                      04490000
050700         ELSE                                                     04500000
050800             SUBTRACT +1 FROM ASC-SEL-SUB                         04510000
050900*            --- BOTTOM OF LIST ---                               04520000
051000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            04530000
051100             SET DP020-MSG-INFORMATIONAL                          04540000
051200                                   TO TRUE                        04550000
051300         END-IF                                                   04560000
051400     ELSE                                                         04570000
051500         SUBTRACT +1 FROM ASC-SEL-ITEM                            04580000
051600         MOVE DP057-MAX-ITEMS      TO ASC-SEL-SUB                 04590000
051700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            04600000
051800         SET DP020-MSG-INFORMATIONAL                              04610000
051900                                   TO TRUE                        04620000
052000     END-IF.                                                      04630000
052100******************************************************************04640000
052200** GET THE MESSAGE NUMBER (KEY) OF THE PREVIOUS SELECTED        **04650000
052300** OBJECT FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.          **04660000
052400******************************************************************04670000
052500 2120-GET-PREV-MESSAGE.                                           04680000
052600     SUBTRACT +1 FROM ASC-SEL-SUB.                                04690000
052700     IF  ASC-SEL-SUB < +1                                         04700000
052800         SUBTRACT +1 FROM ASC-SEL-ITEM                            04710000
052900         MOVE DP057-MAX-ITEMS      TO ASC-SEL-SUB                 04720000
053000     END-IF.                                                      04730000
053100                                                                  04740000
053200     IF  ASC-SEL-ITEM > ZERO                                      04750000
053300         PERFORM 9100-READ-SEL-QUEUE                              04760000
053400         MOVE DP057-MESSAGE-NUMBER (ASC-SEL-SUB)                  04770000
053500                                   TO ASC-MSG-NUMBER-N            04780000
053600     ELSE                                                         04790000
053700         MOVE +1                   TO ASC-SEL-ITEM                04800000
053800                                      ASC-SEL-SUB                 04810000
053900*        --- TOP OF LIST ---                                      04820000
054000         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            04830000
054100         SET DP020-MSG-INFORMATIONAL                              04840000
054200                                   TO TRUE                        04850000
054300     END-IF.                                                      04860000
054400 EJECT                                                            04870000
054500                                                                  05980000
054600 4000-BUILD-INITIAL-PANEL.                                        06630000
054700                                                                  06640000
054800     PERFORM 7000-SELECT-TPURCHS.                                 06670003
054900     IF PS-NO-ERROR                                               06670103
055400         MOVE PURCHS-STATUS-CDE  TO ASC-STATUS-CDE                11520940
055500         PERFORM 7100-SELECT-TIMPORL                              06671003
055600         PERFORM 7200-GET-PO-STATUS-DESC                          16310014
055700         IF PS-NO-ERROR                                                   
055800             MOVE SPACES         TO ASC-DCTEXT                            
055900             PERFORM 7300-SELECT-TIMCNRL                                  
056000             IF PS-NO-ERROR                                               
056100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06710000
056200             END-IF                                                       
056300         END-IF                                                           
056400     END-IF.                                                      06672003
056500                                                                  06730000
056600*----------------------------------------------------------------*07320000
056700*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *07330000
056800*----------------------------------------------------------------*07340000
056900                                                                  07350000
057000 4400-MOVE-COMMAREA-TO-SCREEN.                                    07360000
057100     MOVE ASC-KEY-PO-NBR           TO APONUMO                     07370000
057200     MOVE ASC-KEY-VENDOR-NAME      TO AVENDO                              
057300     MOVE ASC-KEY-DEPT-NBR         TO ADEPTO                              
057400     MOVE ASC-PO-STATUS-DESC       TO ASTATO                      16520014
057500                                                                          
071100* DECONSOLIDATOR ACTUAL DATE                                              
071200     IF ASC-DCONSLR-ACTL-DTE = PC-NULL-DTE                                
071300        MOVE SPACES TO ADEDTE2O                                           
071400     ELSE                                                                 
071500         STRING ASC-DCONSLR-ACTL-DTE (6:2) '/'                            
071600                ASC-DCONSLR-ACTL-DTE (9:2) '/'                            
071700                ASC-DCONSLR-ACTL-DTE (3:2)                                
071800             DELIMITED BY SIZE INTO ADEDTE2O                              
071900     END-IF.                                                              
072000                                                                  07400000
072100* DECONSOLIDATOR ACTUAL TIME                                              
072200     IF ASC-DCONSLR-ACTL-TM = PC-NULL-TM                                  
072300        MOVE SPACES TO ADETIMEO                                           
072400     ELSE                                                                 
072500         STRING ASC-DCONSLR-ACTL-TM (1:2) ':'                             
072600                ASC-DCONSLR-ACTL-TM (4:2)                                 
072700             DELIMITED BY SIZE INTO ADETIMEO                              
072800     END-IF.                                                              
072900                                                                  07400000
073000* DECONSOLIDATOR RELEASE STATUS                                           
073100     EVALUATE ASC-DCONSLR-RLSE-CDE                                        
073200         WHEN 'N'                                                         
073300             MOVE PC-NOT-TRANSMITTED TO ADESTATO                          
073400         WHEN 'D'                                                         
073500             IF ASC-DCONSLR-ACTL-DTE = PC-NULL-DTE                        
073600                 MOVE PC-NOT-TRANSMITTED TO ADESTATO                      
073700             ELSE                                                         
073800                 MOVE PC-SENT-WO-SPLITS TO ADESTATO                       
073900             END-IF                                                       
074000         WHEN 'Y'                                                         
074100             MOVE PC-TRANSMITTED     TO ADESTATO                          
074200         WHEN 'S'                                                         
074300         WHEN 'M'                                                         
074400             MOVE PC-SENT-WO-SPLITS TO ADESTATO                           
074500         WHEN 'R'                                                         
074600             MOVE PC-RETRANSMITTED   TO ADESTATO                          
074700     END-EVALUATE.                                                        
074800                                                                          
077100* DCN            LABEL TEXT                                               
077200     MOVE ASC-DCTEXT TO ADCTEXTO.                                         
077300                                                                          
077400* DCN            ACTUAL DATE                                              
077500     IF ASC-DCN-ACTL-DTE = PC-NULL-DTE                                    
077600        MOVE SPACES TO ADCDTE2O                                           
077700     ELSE                                                                 
077800         STRING ASC-DCN-ACTL-DTE (6:2) '/'                                
077900                ASC-DCN-ACTL-DTE (9:2) '/'                                
078000                ASC-DCN-ACTL-DTE (3:2)                                    
078100             DELIMITED BY SIZE INTO ADCDTE2O                              
078200     END-IF.                                                              
078300                                                                  07400000
078400* DCN            ACTUAL TIME                                              
078500     IF ASC-DCN-ACTL-TM = PC-NULL-TM                                      
078600        MOVE SPACES TO ADCTIMEO                                           
078700     ELSE                                                                 
078800         STRING ASC-DCN-ACTL-TM (1:2) ':'                                 
078900                ASC-DCN-ACTL-TM (4:2)                                     
079000             DELIMITED BY SIZE INTO ADCTIMEO                              
079100     END-IF.                                                              
079200                                                                  07400000
079300* DCN            RELEASE STATUS                                           
079400     EVALUATE ASC-DCN-RLSE-CDE                                            
079500         WHEN 'N'                                                         
079600             MOVE PC-NOT-TRANSMITTED TO ADCSTATO                          
079700         WHEN 'D'                                                         
079800             IF ASC-DCN-ACTL-DTE = PC-NULL-DTE                            
079810                 PERFORM 7750-PROCESS-D-RLSE-CDES                         
079820                 EVALUATE ASC-DCN-RLSE-CDE                                
079830                     WHEN 'R'                                             
079831                         MOVE PC-RETRANSMITTED   TO ADCSTATO              
079840                     WHEN 'Y'                                             
079841                         MOVE PC-TRANSMITTED     TO ADCSTATO              
079850                     WHEN 'S'                                             
079851                         MOVE PC-SENT-WO-SPLITS  TO ADCSTATO              
079852                     WHEN 'D'                                             
079853                         IF ASC-DCN-ACTL-DTE = PC-NULL-DTE                
079854                             MOVE PC-NOT-TRANSMITTED TO ADCSTATO          
079855                         ELSE                                             
079856                             MOVE PC-SENT-WO-SPLITS  TO ADCSTATO          
079857                         END-IF                                           
079880                 END-EVALUATE                                             
079881                 IF ASC-DCN-ACTL-DTE EQUAL PC-NULL-DTE                    
079882                     MOVE SPACES TO ADCDTE2O                              
079883                 ELSE                                                     
079890                     STRING ASC-DCN-ACTL-DTE (6:2) '/'                    
079900                            ASC-DCN-ACTL-DTE (9:2) '/'                    
079910                            ASC-DCN-ACTL-DTE (3:2)                        
079920                         DELIMITED BY SIZE INTO ADCDTE2O                  
079930                 END-IF                                                   
079931                 IF ASC-DCN-ACTL-TM EQUAL PC-NULL-TM                      
079932                     MOVE SPACES TO ADCTIMEO                              
079933                 ELSE                                                     
079940                     STRING ASC-DCN-ACTL-TM (1:2) ':'                     
079950                            ASC-DCN-ACTL-TM (4:2)                         
079960                         DELIMITED BY SIZE INTO ADCTIMEO                  
079970                 END-IF                                                   
080000             ELSE                                                         
080100                 MOVE PC-SENT-WO-SPLITS TO ADCSTATO                       
080200             END-IF                                                       
080300         WHEN 'Y'                                                         
080400             MOVE PC-TRANSMITTED     TO ADCSTATO                          
080500         WHEN 'S'                                                         
080600         WHEN 'M'                                                         
080700             MOVE PC-SENT-WO-SPLITS TO ADCSTATO                           
080800         WHEN 'R'                                                         
080900             MOVE PC-RETRANSMITTED   TO ADCSTATO                          
081000     END-EVALUATE.                                                        
081100                                                                          
081200 EJECT                                                            07410000
081300*----------------------------------------------------------------*08030000
081400* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *08040000
081500* OBJECT WAS UDPATED.                                            *08050000
081600*----------------------------------------------------------------*08060000
081700 5200-UPDATE-SELECTION-QUEUE.                                     08070000
081800     PERFORM 9100-READ-SEL-QUEUE.                                 08080000
081900     SET DP057-UPD (ASC-SEL-SUB) TO TRUE.                         08090000
082000     PERFORM 9200-REWRITE-LIST-QUEUE.                             08100000
082100/                                                                 08110000
082200 7000-SELECT-TPURCHS.                                             08110103
082300         EXEC SQL                                                 08110203
082400         SELECT                                                   08110303
082500             EDI_REXMIT_IND                                       08110403
082600            ,EDI_REXMIT_TMST                                      08110503
082700            ,STATUS_CDE                                           12376140
082800         INTO                                                             
082900             :PURCHS-EDI-REXMIT-IND                               08110403
083000            ,:PURCHS-EDI-REXMIT-TMST                              08110503
083100            ,:PURCHS-STATUS-CDE                                   12376340
083200         FROM TPURCHS                                             08111703
083300         WHERE PO_NBR         = :ASC-KEY-PO-NBR                   08111803
083400           AND VER_STATUS_CDE = :PC-A                             08111903
083500     END-EXEC.                                                    08112003
083600         EVALUATE TRUE                                            08112103
083700             WHEN SQLCODE = ZERO                                  08112203
083800                 CONTINUE                                                 
083900             WHEN SQLCODE = +100                                  08112303
084000                 SET PS-ERROR TO TRUE                                     
084100             WHEN SQLCODE = -904                                  08112403
084200             WHEN SQLCODE = -911                                  08112403
084300             WHEN SQLCODE = -913                                  08112503
084400                 PERFORM 9900-SOFT-ABORT                                  
084500             WHEN SQLWARN0 NOT = SPACES                           08112703
084600             WHEN SQLCODE < ZERO                                  08112803
084700             WHEN SQLCODE > ZERO                                  08112903
084800                 MOVE '7000-SELECT-TPURCHS'                       08113003
084900                                   TO DP013-PARAGRAPH             08113103
085000                 MOVE 'SELECT REXMIT INFO'                        08113203
085100                                   TO DP013-MESSAGE-TEXT (1)      08113303
085200                 MOVE SQLCA        TO DP013-SQLCA                 08113403
085300                 MOVE 'TPURCHS'    TO DP013-DB2-TABLE-NAME (1)    08113503
085400                 SET DP013-DB2-ABEND                              08113603
085500                     DP013-XCTL-DISPLAY-RESTART                   08113703
085600                                   TO TRUE                        08113803
085700                 PERFORM DP013-0000-PROCESS-ABEND                 08113903
085800         END-EVALUATE.                                            08114003
085900 7100-SELECT-TIMPORL.                                             08114103
086000     EXEC SQL                                                     08114203
086100     SELECT                                                       08115003
087400         DCONSLR_RLSE_CDE                                         08119503
087500        ,DCONSLR_ACTL_DTE                                         08119703
087600        ,DCONSLR_ACTL_TM                                          08119803
087700        INTO                                                              
089000         :IMPORL-DCONSLR-RLSE-CDE                                         
089100        ,:IMPORL-DCONSLR-ACTL-DTE                                         
089200        ,:IMPORL-DCONSLR-ACTL-TM                                          
089300     FROM TIMPORL                                                 08119903
089400     WHERE PO_NBR       = :ASC-KEY-PO-NBR                         08120003
089500     AND VER_STATUS_CDE = :PC-A                                   08120203
089600     END-EXEC.                                                    08120303
089700         EVALUATE TRUE                                            08112103
089800             WHEN SQLCODE = ZERO                                  08112203
092300                MOVE IMPORL-DCONSLR-RLSE-CDE                              
092400                                 TO ASC-DCONSLR-RLSE-CDE                  
092500                MOVE IMPORL-DCONSLR-ACTL-DTE                              
092600                                 TO ASC-DCONSLR-ACTL-DTE                  
092700                MOVE IMPORL-DCONSLR-ACTL-TM                               
092800                                 TO ASC-DCONSLR-ACTL-TM                   
092900             WHEN SQLCODE = +100                                  08112303
093000                 SET PS-ERROR    TO TRUE                                  
093100             WHEN SQLCODE = -904                                  08112403
093200             WHEN SQLCODE = -911                                  08112403
093300             WHEN SQLCODE = -913                                  08112503
093400                 PERFORM 9900-SOFT-ABORT                                  
093500             WHEN SQLWARN0 NOT = SPACES                           08112703
093600             WHEN SQLCODE < ZERO                                  08112803
093700             WHEN SQLCODE > ZERO                                  08112903
093800                 MOVE '7100-SELECT-TIMPORL'                       08113003
093900                                   TO DP013-PARAGRAPH             08113103
094000                 MOVE 'SELECT MESSAGE NUMBER'                     08113203
094100                                   TO DP013-MESSAGE-TEXT (1)      08113303
094200                 MOVE SQLCA        TO DP013-SQLCA                 08113403
094300                 MOVE 'TIMPORL'    TO DP013-DB2-TABLE-NAME (1)    08113503
094400                 SET DP013-DB2-ABEND                              08113603
094500                     DP013-XCTL-DISPLAY-RESTART                   08113703
094600                                   TO TRUE                        08113803
094700                 PERFORM DP013-0000-PROCESS-ABEND                 08113903
094800         END-EVALUATE.                                            08114003
094900/                                                                         
095000 7200-GET-PO-STATUS-DESC.                                         16310014
095100                                                                  16320014
095200     EXEC SQL                                                     16410014
095300         SELECT STATUS_DESC                                       16420014
095400         INTO :STATCD-STATUS-DESC                                 16430014
095500         FROM TSTATCD                                             16440014
095600         WHERE STATUS_TYP_CDE = 'P'                               16450014
095700           AND STATUS_CDE     = :ASC-STATUS-CDE                   16460014
095800     END-EXEC                                                     16470014
095900                                                                  16480014
096000     EVALUATE TRUE                                                16490014
096100         WHEN SQLCODE = ZERO                                      16500014
096200              MOVE STATCD-STATUS-DESC                             16510014
096300                                 TO ASC-PO-STATUS-DESC            16520014
096400                                                                  16530014
096500         WHEN SQLCODE = +100                                      16540014
096600              MOVE SPACES        TO ASC-PO-STATUS-DESC            16550014
096700              SET PS-ERROR       TO TRUE                                  
096800         WHEN SQLCODE = -904                                      16560014
096900         WHEN SQLCODE = -913                                      16570014
097000             PERFORM 9900-SOFT-ABORT                              08112838
097100                  CONTINUE                                        16580014
097200                                                                  16590014
097300         WHEN SQLWARN0 NOT = SPACES                               16600014
097400         WHEN SQLCODE < +0                                        16610014
097500         WHEN SQLCODE > +0                                        16620014
097600             MOVE '7200-GET-PO-STATUS-DESC'                       16630014
097700                                 TO DP013-PARAGRAPH               16640014
097800             MOVE 'UNSUCCESSFUL SELECT PO STATUS DESC'            16650014
097900                                 TO DP013-MESSAGE-TEXT (1)        16660014
098000             MOVE SQLCA          TO DP013-SQLCA                   16670014
098100             MOVE 'TSTATCD '     TO DP013-DB2-TABLE-NAME (1)      16680014
098200             SET DP013-DB2-ABEND                                  16690014
098300                 DP013-XCTL-DISPLAY-RESTART                       16700014
098400                                 TO TRUE                          16710014
098500             PERFORM DP013-0000-PROCESS-ABEND                     16720014
098600     END-EVALUATE.                                                16730014
098700/                                                                 16890014
098800 7300-SELECT-TIMCNRL.                                             08114103
098900     EXEC SQL                                                     08114203
099000     SELECT                                                       08115003
099100         DCONSLR_RLSE_CDE                                         08116003
099200        ,DCONSLR_ACTL_DTE                                         08118003
099300        ,DCONSLR_ACTL_TM                                          08119003
099400        INTO                                                              
099500         :IMCNRL-DCONSLR-RLSE-CDE                                         
099600        ,:IMCNRL-DCONSLR-ACTL-DTE                                         
099700        ,:IMCNRL-DCONSLR-ACTL-TM                                          
099800     FROM TIMCNRL                                                 08119903
099900     WHERE PO_NBR         = :ASC-KEY-PO-NBR                       08120003
100000     AND (DCONSLR_RLSE_CDE = :PC-R                                08120203
100100       OR DCONSLR_RLSE_CDE = :PC-Y)                               08120203
100200     END-EXEC.                                                    08120303
100300         EVALUATE TRUE                                            08112103
100400             WHEN SQLCODE = ZERO                                  08112203
100500                MOVE 'DECONSOL CONT.....:'                                
100600                                 TO ASC-DCTEXT                            
100700                MOVE IMCNRL-DCONSLR-RLSE-CDE                              
100800                                 TO ASC-DCN-RLSE-CDE                      
100900                MOVE IMCNRL-DCONSLR-ACTL-DTE                              
101000                                 TO ASC-DCN-ACTL-DTE                      
101100                MOVE IMCNRL-DCONSLR-ACTL-TM                               
101200                                 TO ASC-DCN-ACTL-TM                       
101300             WHEN SQLCODE = +100                                  08112303
101400                PERFORM  7400-SELECT-TIMCNRL                              
101500             WHEN SQLCODE = -811                                  08112303
101600                PERFORM  7600-SELECT-TIMCNRL-MIN                          
101700             WHEN SQLCODE = -904                                  08112403
101800             WHEN SQLCODE = -911                                  08112403
101900             WHEN SQLCODE = -913                                  08112503
102000                 PERFORM 9900-SOFT-ABORT                                  
102100             WHEN SQLWARN0 NOT = SPACES                           08112703
102200             WHEN SQLCODE < ZERO                                  08112803
102300             WHEN SQLCODE > ZERO                                  08112903
102400                 MOVE '7300-SELECT-TIMCNRL'                       08113003
102500                                   TO DP013-PARAGRAPH             08113103
102600                 MOVE 'SELECT MESSAGE NUMBER'                     08113203
102700                                   TO DP013-MESSAGE-TEXT (1)      08113303
102800                 MOVE SQLCA        TO DP013-SQLCA                 08113403
102900                 MOVE 'TIMCNRL'    TO DP013-DB2-TABLE-NAME (1)    08113503
103000                 SET DP013-DB2-ABEND                              08113603
103100                     DP013-XCTL-DISPLAY-RESTART                   08113703
103200                                   TO TRUE                        08113803
103300                 PERFORM DP013-0000-PROCESS-ABEND                 08113903
103400         END-EVALUATE.                                            08114003
103500/                                                                         
103600 7400-SELECT-TIMCNRL.                                             08114103
103700     EXEC SQL                                                     08114203
103800       SELECT                                                     08115003
103900           DCONSLR_RLSE_CDE                                       08116003
104000          ,DCONSLR_ACTL_DTE                                       08118003
104100          ,DCONSLR_ACTL_TM                                        08119003
104200          INTO                                                            
104300           :IMCNRL-DCONSLR-RLSE-CDE                                       
104400          ,:IMCNRL-DCONSLR-ACTL-DTE                                       
104500          ,:IMCNRL-DCONSLR-ACTL-TM                                        
104600       FROM TIMCNRL                                               08119903
104700       WHERE PO_NBR          = :ASC-KEY-PO-NBR                    08120003
104800     END-EXEC.                                                    08120303
104900         EVALUATE TRUE                                            08112103
105000             WHEN SQLCODE = ZERO                                  08112203
105100                MOVE 'DECONSOL CONT.....:'                                
105200                                 TO ASC-DCTEXT                            
105300                MOVE IMCNRL-DCONSLR-RLSE-CDE                              
105400                                 TO ASC-DCN-RLSE-CDE                      
105500                MOVE IMCNRL-DCONSLR-ACTL-DTE                              
105600                                 TO ASC-DCN-ACTL-DTE                      
105700                MOVE IMCNRL-DCONSLR-ACTL-TM                               
105800                                 TO ASC-DCN-ACTL-TM                       
105900             WHEN SQLCODE = +100                                  08112203
106000                MOVE 'N'         TO ASC-DCN-RLSE-CDE                      
106100                MOVE 'DECONSOL CONT.....:'                                
106200                                 TO ASC-DCTEXT                            
106300                MOVE PC-NULL-DTE TO ASC-DCN-ACTL-DTE                      
106400                MOVE PC-NULL-TM  TO ASC-DCN-ACTL-TM                       
106500             WHEN SQLCODE = -811                                  08112303
106600                PERFORM  7500-SELECT-TIMCNRL-MIN                          
106700             WHEN SQLCODE = -904                                  08112403
106800             WHEN SQLCODE = -911                                  08112403
106900             WHEN SQLCODE = -913                                  08112503
107000                 PERFORM 9900-SOFT-ABORT                                  
107100             WHEN SQLWARN0 NOT = SPACES                           08112703
107200             WHEN SQLCODE < ZERO                                  08112803
107300             WHEN SQLCODE > ZERO                                  08112903
107400                 MOVE '7400-SELECT-TIMCNRL'                       08113003
107500                                   TO DP013-PARAGRAPH             08113103
107600                 MOVE 'SELECT MESSAGE NUMBER'                     08113203
107700                                   TO DP013-MESSAGE-TEXT (1)      08113303
107800                 MOVE SQLCA        TO DP013-SQLCA                 08113403
107900                 MOVE 'TIMCNRL'    TO DP013-DB2-TABLE-NAME (1)    08113503
108000                 SET DP013-DB2-ABEND                              08113603
108100                     DP013-XCTL-DISPLAY-RESTART                   08113703
108200                                   TO TRUE                        08113803
108300                 PERFORM DP013-0000-PROCESS-ABEND                 08113903
108400         END-EVALUATE.                                            08114003
108500/                                                                         
108600 7500-SELECT-TIMCNRL-MIN.                                         08114103
108700                                                                  09724099
108800         EXEC SQL                                                 09725099
108900             OPEN RLSE_DTE_NO_CD_CSR                              09726099
109000         END-EXEC.                                                09727099
109100                                                                  09728099
109200         EVALUATE TRUE                                            09729099
109300             WHEN SQLCODE = ZERO                                  09730099
109400             WHEN SQLCODE = -904                                  09731099
109500             WHEN SQLCODE = -913                                  09732099
109600                 CONTINUE                                         09733099
109700             WHEN SQLWARN0 NOT = SPACES                           09734099
109800             WHEN SQLCODE < ZERO                                  09735099
109900             WHEN SQLCODE > ZERO                                  09736099
110000                 MOVE '7500-SELECT-TIMCNRL-MIN'                   09737099
110100                                   TO DP013-PARAGRAPH             09738099
110200                 MOVE 'OPEN CURSOR - '                            09739099
110300                                   TO DP013-MESSAGE-TEXT (1)      09740099
110400                 MOVE SQLCA        TO DP013-SQLCA                 09741099
110500                 MOVE 'TIMCNRL'    TO DP013-DB2-TABLE-NAME (1)    09742099
110600                 SET DP013-DB2-ABEND                              09743099
110700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09744099
110800                 PERFORM DP013-0000-PROCESS-ABEND                 09745099
110900         END-EVALUATE.                                            09746099
111000                                                                  09748099
111100     IF  SQLCODE NOT EQUAL ZERO                                   09749099
111200         MOVE '7500-SELECT-TIMCNRL-MIN'   TO DP013-PARAGRAPH      09750099
111300         MOVE 'RESOURCE NOT AVAILABLE - ATTEMPTING TO OPEN CSR'   09751099
111400                                   TO DP013-MESSAGE-TEXT (1)      09752099
111500         MOVE SQLCA                TO DP013-SQLCA                 09753099
111600         MOVE 'TIMCNRL'           TO DP013-DB2-TABLE-NAME (1)     09754099
111700         SET DP013-DB2-ABEND                                      09755099
111800             DP013-XCTL-DISPLAY-RESTART                           09756099
111900                                   TO TRUE                        09757099
112000         PERFORM DP013-0000-PROCESS-ABEND                         09758099
112100     END-IF.                                                      09759099
112200     EXEC SQL                                                     09767099
112300        FETCH RLSE_DTE_NO_CD_CSR                                  09768099
112400        INTO                                                      09769099
112500           :IMCNRL-DCONSLR-ACTL-DTE                               10644099
112600          ,:IMCNRL-DCONSLR-ACTL-TM                                        
112700          ,:IMCNRL-DCONSLR-RLSE-CDE                                       
112800     END-EXEC                                                     09772099
112900                                                                  09773099
113000         EVALUATE TRUE                                            08112103
113100             WHEN SQLCODE = ZERO                                  08112203
113200                MOVE 'DECONSOL CONT MULT:'                                
113300                                 TO ASC-DCTEXT                            
113400                MOVE IMCNRL-DCONSLR-RLSE-CDE                              
113500                                 TO ASC-DCN-RLSE-CDE                      
113600                MOVE IMCNRL-DCONSLR-ACTL-DTE                              
113700                                 TO ASC-DCN-ACTL-DTE                      
113800                MOVE IMCNRL-DCONSLR-ACTL-TM                               
113900                                 TO ASC-DCN-ACTL-TM                       
114000                PERFORM  7700-SELECT-TAUCNRL-MIN                          
114100             WHEN SQLCODE = +100                                  08112303
114200                MOVE 'N'         TO ASC-DCN-RLSE-CDE                      
114300                MOVE 'DECONSOL CONT.....:'                                
114400                                 TO ASC-DCTEXT                            
114500                MOVE PC-NULL-DTE TO ASC-DCN-ACTL-DTE                      
114600                MOVE PC-NULL-TM  TO ASC-DCN-ACTL-TM                       
114700             WHEN SQLCODE = -904                                  08112403
114800             WHEN SQLCODE = -911                                  08112403
114900             WHEN SQLCODE = -913                                  08112503
115000                 PERFORM 9900-SOFT-ABORT                                  
115100             WHEN SQLWARN0 NOT = SPACES                           08112703
115200             WHEN SQLCODE < ZERO                                  08112803
115300             WHEN SQLCODE > ZERO                                  08112903
115400                 MOVE '7500-SELECT-TIMCNRL-MIN'                   08113003
115500                                   TO DP013-PARAGRAPH             08113103
115600                 MOVE 'FETCH - MIN RLSE DATE, NO CODE'            08113203
115700                                   TO DP013-MESSAGE-TEXT (1)      08113303
115800                 MOVE SQLCA        TO DP013-SQLCA                 08113403
115900                 MOVE 'TIMCNRL'    TO DP013-DB2-TABLE-NAME (1)    08113503
116000                 SET DP013-DB2-ABEND                              08113603
116100                     DP013-XCTL-DISPLAY-RESTART                   08113703
116200                                   TO TRUE                        08113803
116300                 PERFORM DP013-0000-PROCESS-ABEND                 08113903
116400         END-EVALUATE.                                            08114003
116500                                                                  09766099
116600         EXEC SQL                                                 09814099
116700             CLOSE RLSE_DTE_NO_CD_CSR                             09815099
116800         END-EXEC.                                                09816099
116900                                                                  09817099
117000         EVALUATE TRUE                                            09818099
117100             WHEN SQLCODE = ZERO                                  09819099
117200             WHEN SQLCODE = -904                                  09820099
117300             WHEN SQLCODE = -913                                  09821099
117400                 CONTINUE                                         09822099
117500             WHEN SQLWARN0 NOT = SPACES                           09823099
117600             WHEN SQLCODE < ZERO                                  09824099
117700             WHEN SQLCODE > ZERO                                  09825099
117800                 MOVE '7500-SELECT-TIMCNRL-MIN'                   09826099
117900                                   TO DP013-PARAGRAPH             09827099
118000                 MOVE 'CLOSE CURSOR - '                           09828099
118100                                   TO DP013-MESSAGE-TEXT (1)      09829099
118200                 MOVE SQLCA        TO DP013-SQLCA                 09830099
118300                 MOVE 'TIMCNRL'    TO DP013-DB2-TABLE-NAME (1)    09831099
118400                 SET DP013-DB2-ABEND                              09832099
118500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09833099
118600                 PERFORM DP013-0000-PROCESS-ABEND                 09834099
118700         END-EVALUATE.                                            09835099
118800                                                                  09837099
118900     IF  SQLCODE NOT EQUAL ZERO                                   09838099
119000         MOVE '7500-SELECT-TIMCNRL-MIN'  TO DP013-PARAGRAPH       09839099
119100         MOVE 'RESOURCE NOT AVAILABLE - ATTEMPTING TO CLOSE CSR'  09840099
119200                                   TO DP013-MESSAGE-TEXT (1)      09841099
119300         MOVE SQLCA                TO DP013-SQLCA                 09842099
119400         MOVE 'TIMCNRL'           TO DP013-DB2-TABLE-NAME (1)     09843099
119500         SET DP013-DB2-ABEND                                      09844099
119600             DP013-XCTL-DISPLAY-RESTART                           09845099
119700                                   TO TRUE                        09846099
119800         PERFORM DP013-0000-PROCESS-ABEND                         09847099
119900     END-IF.                                                      09848099
120000 EJECT                                                            09849099
120100                                                                  09766099
120200/                                                                         
120300 7600-SELECT-TIMCNRL-MIN.                                         08114103
120400                                                                          
120500         EXEC SQL                                                 09725099
120600             OPEN RLSE_DTE_CSR                                    09726099
120700         END-EXEC.                                                09727099
120800                                                                  09728099
120900         EVALUATE TRUE                                            09729099
121000             WHEN SQLCODE = ZERO                                  09730099
121100             WHEN SQLCODE = -904                                  09731099
121200             WHEN SQLCODE = -913                                  09732099
121300                 CONTINUE                                         09733099
121400             WHEN SQLWARN0 NOT = SPACES                           09734099
121500             WHEN SQLCODE < ZERO                                  09735099
121600             WHEN SQLCODE > ZERO                                  09736099
121700                 MOVE '7600-SELECT-TIMCNRL-MIN'                   09737099
121800                                   TO DP013-PARAGRAPH             09738099
121900                 MOVE 'OPEN CURSOR - '                            09739099
122000                                   TO DP013-MESSAGE-TEXT (1)      09740099
122100                 MOVE SQLCA        TO DP013-SQLCA                 09741099
122200                 MOVE 'TIMCNRL'    TO DP013-DB2-TABLE-NAME (1)    09742099
122300                 SET DP013-DB2-ABEND                              09743099
122400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09744099
122500                 PERFORM DP013-0000-PROCESS-ABEND                 09745099
122600         END-EVALUATE.                                            09746099
122700                                                                  09748099
122800     IF  SQLCODE NOT EQUAL ZERO                                   09749099
122900         MOVE '7600-SELECT-TIMCNRL-MIN'   TO DP013-PARAGRAPH      09750099
123000         MOVE 'RESOURCE NOT AVAILABLE - ATTEMPTING TO OPEN CSR'   09751099
123100                                   TO DP013-MESSAGE-TEXT (1)      09752099
123200         MOVE SQLCA                TO DP013-SQLCA                 09753099
123300         MOVE 'TIMCNRL'           TO DP013-DB2-TABLE-NAME (1)     09754099
123400         SET DP013-DB2-ABEND                                      09755099
123500             DP013-XCTL-DISPLAY-RESTART                           09756099
123600                                   TO TRUE                        09757099
123700         PERFORM DP013-0000-PROCESS-ABEND                         09758099
123800     END-IF.                                                      09759099
123900     EXEC SQL                                                     09767099
124000        FETCH RLSE_DTE_CSR                                        09768099
124100        INTO                                                      09769099
124200           :IMCNRL-DCONSLR-ACTL-DTE                               10644099
124300          ,:IMCNRL-DCONSLR-ACTL-TM                                        
124400          ,:IMCNRL-DCONSLR-RLSE-CDE                                       
124500     END-EXEC.                                                    09772099
124600                                                                  09773099
124700         EVALUATE TRUE                                            08112103
124800             WHEN SQLCODE = ZERO                                  08112203
124900                MOVE 'DECONSOL CONT MULT:'                                
125000                                 TO ASC-DCTEXT                            
125100                MOVE IMCNRL-DCONSLR-RLSE-CDE                              
125200                                 TO ASC-DCN-RLSE-CDE                      
125300                MOVE IMCNRL-DCONSLR-ACTL-DTE                              
125400                                 TO ASC-DCN-ACTL-DTE                      
125500                MOVE IMCNRL-DCONSLR-ACTL-TM                               
125600                                 TO ASC-DCN-ACTL-TM                       
125700                PERFORM  7700-SELECT-TAUCNRL-MIN                          
125800             WHEN SQLCODE = +100                                  08112303
125900                SET PS-ERROR     TO TRUE                                  
126000             WHEN SQLCODE = -904                                  08112403
126100             WHEN SQLCODE = -911                                  08112403
126200             WHEN SQLCODE = -913                                  08112503
126300                 PERFORM 9900-SOFT-ABORT                                  
126400             WHEN SQLWARN0 NOT = SPACES                           08112703
126500             WHEN SQLCODE < ZERO                                  08112803
126600             WHEN SQLCODE > ZERO                                  08112903
126700                 MOVE '7600-SELECT-TIMCNRL-MIN'                   08113003
126800                                   TO DP013-PARAGRAPH             08113103
126900                 MOVE 'FETCH - MIN RLSE DATE'                     08113203
127000                                   TO DP013-MESSAGE-TEXT (1)      08113303
127100                 MOVE SQLCA        TO DP013-SQLCA                 08113403
127200                 MOVE 'TIMCNRL'    TO DP013-DB2-TABLE-NAME (1)    08113503
127300                 SET DP013-DB2-ABEND                              08113603
127400                     DP013-XCTL-DISPLAY-RESTART                   08113703
127500                                   TO TRUE                        08113803
127600                 PERFORM DP013-0000-PROCESS-ABEND                 08113903
127700         END-EVALUATE.                                            08114003
127800                                                                  09766099
127900         EXEC SQL                                                 09814099
128000             CLOSE RLSE_DTE_CSR                                   09815099
128100         END-EXEC.                                                09816099
128200                                                                  09817099
128300         EVALUATE TRUE                                            09818099
128400             WHEN SQLCODE = ZERO                                  09819099
128500             WHEN SQLCODE = -904                                  09820099
128600             WHEN SQLCODE = -913                                  09821099
128700                 CONTINUE                                         09822099
128800             WHEN SQLWARN0 NOT = SPACES                           09823099
128900             WHEN SQLCODE < ZERO                                  09824099
129000             WHEN SQLCODE > ZERO                                  09825099
129100                 MOVE '7600-SELECT-TIMCNRL-MIN'                   09826099
129200                                   TO DP013-PARAGRAPH             09827099
129300                 MOVE 'CLOSE CURSOR - '                           09828099
129400                                   TO DP013-MESSAGE-TEXT (1)      09829099
129500                 MOVE SQLCA        TO DP013-SQLCA                 09830099
129600                 MOVE 'TIMCNRL'    TO DP013-DB2-TABLE-NAME (1)    09831099
129700                 SET DP013-DB2-ABEND                              09832099
129800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09833099
129900                 PERFORM DP013-0000-PROCESS-ABEND                 09834099
130000         END-EVALUATE.                                            09835099
130100                                                                  09837099
130200     IF  SQLCODE NOT EQUAL ZERO                                   09838099
130300         MOVE '7600-SELECT-TIMCNRL-MIN'  TO DP013-PARAGRAPH       09839099
130400         MOVE 'RESOURCE NOT AVAILABLE - ATTEMPTING TO CLOSE CSR'  09840099
130500                                   TO DP013-MESSAGE-TEXT (1)      09841099
130600         MOVE SQLCA                TO DP013-SQLCA                 09842099
130700         MOVE 'TIMCNRL'           TO DP013-DB2-TABLE-NAME (1)     09843099
130800         SET DP013-DB2-ABEND                                      09844099
130900             DP013-XCTL-DISPLAY-RESTART                           09845099
131000                                   TO TRUE                        09846099
131100         PERFORM DP013-0000-PROCESS-ABEND                         09847099
131200     END-IF.                                                      09848099
131300 EJECT                                                            09849099
131400                                                                          
131500                                                                          
131600 7700-SELECT-TAUCNRL-MIN.                                         08114103
131700                                                                          
131800         EXEC SQL                                                 09725099
131900             OPEN RLSE_DTE2_CSR                                   09726099
132000         END-EXEC.                                                09727099
132100                                                                  09728099
132200         EVALUATE TRUE                                            09729099
132300             WHEN SQLCODE = ZERO                                  09730099
132400             WHEN SQLCODE = -904                                  09731099
132500             WHEN SQLCODE = -913                                  09732099
132600                 CONTINUE                                         09733099
132700             WHEN SQLWARN0 NOT = SPACES                           09734099
132800             WHEN SQLCODE < ZERO                                  09735099
132900             WHEN SQLCODE > ZERO                                  09736099
133000                 MOVE '7700-SELECT-TAUCNRL-MIN'                   09737099
133100                                   TO DP013-PARAGRAPH             09738099
133200                 MOVE 'OPEN CURSOR - '                            09739099
133300                                   TO DP013-MESSAGE-TEXT (1)      09740099
133400                 MOVE SQLCA        TO DP013-SQLCA                 09741099
133500                 MOVE 'TAUCNRL'    TO DP013-DB2-TABLE-NAME (1)    09742099
133600                 SET DP013-DB2-ABEND                              09743099
133700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09744099
133800                 PERFORM DP013-0000-PROCESS-ABEND                 09745099
133900         END-EVALUATE.                                            09746099
134000                                                                  09748099
134100     IF  SQLCODE NOT EQUAL ZERO                                   09749099
134200         MOVE '7700-SELECT-TAUCNRL-MIN'   TO DP013-PARAGRAPH      09750099
134300         MOVE 'RESOURCE NOT AVAILABLE - ATTEMPTING TO OPEN CSR'   09751099
134400                                   TO DP013-MESSAGE-TEXT (1)      09752099
134500         MOVE SQLCA                TO DP013-SQLCA                 09753099
134600         MOVE 'TAUCNRL'           TO DP013-DB2-TABLE-NAME (1)     09754099
134700         SET DP013-DB2-ABEND                                      09755099
134800             DP013-XCTL-DISPLAY-RESTART                           09756099
134900                                   TO TRUE                        09757099
135000         PERFORM DP013-0000-PROCESS-ABEND                         09758099
135100     END-IF.                                                      09759099
135200     EXEC SQL                                                     09767099
135300        FETCH RLSE_DTE2_CSR                                       09768099
135400        INTO                                                      09769099
135500           :AUCNRL-DCONSLR-ACTL-DTE                               10644099
135600          ,:AUCNRL-DCONSLR-ACTL-TM                                        
135700          ,:AUCNRL-DCONSLR-RLSE-CDE                                       
135800     END-EXEC.                                                    09772099
135900                                                                  09773099
136000         EVALUATE TRUE                                            08112103
136100             WHEN SQLCODE = ZERO                                  08112203
136200                IF AUCNRL-DCONSLR-ACTL-DTE <                              
136300                           IMCNRL-DCONSLR-ACTL-DTE                        
136400                    MOVE AUCNRL-DCONSLR-RLSE-CDE                          
136500                                     TO ASC-DCN-RLSE-CDE                  
136600                    MOVE AUCNRL-DCONSLR-ACTL-DTE                          
136700                                     TO ASC-DCN-ACTL-DTE                  
136800                    MOVE AUCNRL-DCONSLR-ACTL-TM                           
136900                                 TO ASC-DCN-ACTL-TM                       
137000                END-IF                                                    
137100             WHEN SQLCODE = +100                                  08112303
137200                 CONTINUE                                                 
137300             WHEN SQLCODE = -904                                  08112403
137400             WHEN SQLCODE = -911                                  08112403
137500             WHEN SQLCODE = -913                                  08112503
137600                 PERFORM 9900-SOFT-ABORT                                  
137700             WHEN SQLWARN0 NOT = SPACES                           08112703
137800             WHEN SQLCODE < ZERO                                  08112803
137900             WHEN SQLCODE > ZERO                                  08112903
138000                 MOVE '7700-SELECT-TAUCNRL-MIN'                   08113003
138100                                   TO DP013-PARAGRAPH             08113103
138200                 MOVE 'FETCH - MIN RLSE DATE'                     08113203
138300                                   TO DP013-MESSAGE-TEXT (1)      08113303
138400                 MOVE SQLCA        TO DP013-SQLCA                 08113403
138500                 MOVE 'TAUCNRL'    TO DP013-DB2-TABLE-NAME (1)    08113503
138600                 SET DP013-DB2-ABEND                              08113603
138700                     DP013-XCTL-DISPLAY-RESTART                   08113703
138800                                   TO TRUE                        08113803
138900                 PERFORM DP013-0000-PROCESS-ABEND                 08113903
139000         END-EVALUATE.                                            08114003
139100                                                                  09766099
139200         EXEC SQL                                                 09814099
139300             CLOSE RLSE_DTE2_CSR                                  09815099
139400         END-EXEC.                                                09816099
139500                                                                  09817099
139600         EVALUATE TRUE                                            09818099
139700             WHEN SQLCODE = ZERO                                  09819099
139800             WHEN SQLCODE = -904                                  09820099
139900             WHEN SQLCODE = -913                                  09821099
140000                 CONTINUE                                         09822099
140100             WHEN SQLWARN0 NOT = SPACES                           09823099
140200             WHEN SQLCODE < ZERO                                  09824099
140300             WHEN SQLCODE > ZERO                                  09825099
140400                 MOVE '7700-SELECT-TAUCNRL-MIN'                   09826099
140500                                   TO DP013-PARAGRAPH             09827099
140600                 MOVE 'CLOSE CURSOR - '                           09828099
140700                                   TO DP013-MESSAGE-TEXT (1)      09829099
140800                 MOVE SQLCA        TO DP013-SQLCA                 09830099
140900                 MOVE 'TAUCNRL'    TO DP013-DB2-TABLE-NAME (1)    09831099
141000                 SET DP013-DB2-ABEND                              09832099
141100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09833099
141200                 PERFORM DP013-0000-PROCESS-ABEND                 09834099
141300         END-EVALUATE.                                            09835099
141400                                                                  09837099
141500     IF  SQLCODE NOT EQUAL ZERO                                   09838099
141600         MOVE '7700-SELECT-TAUCNRL-MIN'  TO DP013-PARAGRAPH       09839099
141700         MOVE 'RESOURCE NOT AVAILABLE - ATTEMPTING TO CLOSE CSR'  09840099
141800                                   TO DP013-MESSAGE-TEXT (1)      09841099
141900         MOVE SQLCA                TO DP013-SQLCA                 09842099
142000         MOVE 'TAUCNRL'           TO DP013-DB2-TABLE-NAME (1)     09843099
142100         SET DP013-DB2-ABEND                                      09844099
142200             DP013-XCTL-DISPLAY-RESTART                           09845099
142300                                   TO TRUE                        09846099
142400         PERFORM DP013-0000-PROCESS-ABEND                         09847099
142500     END-IF.                                                      09848099
142600 EJECT                                                            09849099
142611*----------------------------------------------------------------*        
142612* PERFORM WHEN THE ROW ON TIMCNRL HAS A 'D' RELEASE CODE AND THE *        
142613* DCONSLR-ACTL-DTE HAS A DEFAULT DATE.                           *        
142614*----------------------------------------------------------------*        
142620 7750-PROCESS-D-RLSE-CDES.                                                
142630                                                                          
142640         EXEC SQL                                                         
142650             OPEN RLSE_DTE_D1_CSR                                         
142660         END-EXEC.                                                        
142670                                                                          
142680         EVALUATE TRUE                                                    
142690             WHEN SQLCODE = ZERO                                          
142691             WHEN SQLCODE = -904                                          
142692             WHEN SQLCODE = -913                                          
142693                 CONTINUE                                                 
142694             WHEN SQLWARN0 NOT = SPACES                                   
142695             WHEN SQLCODE < ZERO                                          
142696             WHEN SQLCODE > ZERO                                          
142697                 MOVE '7750-PROCESS-D-RLSE-CDES'                          
142698                                   TO DP013-PARAGRAPH                     
142699                 MOVE 'OPEN CURSOR - '                                    
142700                                   TO DP013-MESSAGE-TEXT (1)              
142701                 MOVE SQLCA        TO DP013-SQLCA                         
142702                 MOVE 'TAUCNRL'    TO DP013-DB2-TABLE-NAME (1)            
142703                 SET DP013-DB2-ABEND                                      
142704                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
142705                 PERFORM DP013-0000-PROCESS-ABEND                         
142706         END-EVALUATE.                                                    
142707                                                                          
142708     IF  SQLCODE NOT EQUAL ZERO                                           
142709         MOVE '7750-PROCESS-D-RLSE-CDES'  TO DP013-PARAGRAPH              
142710         MOVE 'RESOURCE NOT AVAILABLE - ATTEMPTING TO OPEN CSR'           
142711                                   TO DP013-MESSAGE-TEXT (1)              
142712         MOVE SQLCA                TO DP013-SQLCA                         
142713         MOVE 'TAUCNRL'            TO DP013-DB2-TABLE-NAME (1)            
142714         SET DP013-DB2-ABEND                                              
142715             DP013-XCTL-DISPLAY-RESTART                                   
142716                                   TO TRUE                                
142717         PERFORM DP013-0000-PROCESS-ABEND                                 
142718     END-IF.                                                              
142719                                                                          
142720     EXEC SQL                                                             
142721        FETCH RLSE_DTE_D1_CSR                                             
142722        INTO                                                              
142723           :AUCNRL-DCONSLR-ACTL-DTE                                       
142724          ,:AUCNRL-DCONSLR-ACTL-TM                                        
142725          ,:AUCNRL-DCONSLR-RLSE-CDE                                       
142726     END-EXEC.                                                            
142727                                                                          
142728         EVALUATE TRUE                                                    
142729             WHEN SQLCODE = ZERO                                          
142730             WHEN SQLCODE = -811                                          
142732                 MOVE AUCNRL-DCONSLR-RLSE-CDE                             
142733                                  TO ASC-DCN-RLSE-CDE                     
142734                 MOVE AUCNRL-DCONSLR-ACTL-DTE                             
142735                                  TO ASC-DCN-ACTL-DTE                     
142736                 MOVE AUCNRL-DCONSLR-ACTL-TM                              
142737                                  TO ASC-DCN-ACTL-TM                      
142738                                                                          
142739             WHEN SQLCODE = +100                                          
142740                 PERFORM 7755-PROCESS-D-RLSE-CDES-2                       
142741             WHEN SQLCODE = -904                                          
142742             WHEN SQLCODE = -911                                          
142743             WHEN SQLCODE = -913                                          
142744                 PERFORM 9900-SOFT-ABORT                                  
142745             WHEN SQLWARN0 NOT = SPACES                                   
142746             WHEN SQLCODE < ZERO                                          
142747             WHEN SQLCODE > ZERO                                          
142748                 MOVE '7750-PROCESS-D-RLSE-CDES'                          
142749                                   TO DP013-PARAGRAPH                     
142750                 MOVE 'FETCH - RLSE DTE D1 CSR'                           
142751                                   TO DP013-MESSAGE-TEXT (1)              
142752                 MOVE SQLCA        TO DP013-SQLCA                         
142753                 MOVE 'TAUCNRL'    TO DP013-DB2-TABLE-NAME (1)            
142754                 SET DP013-DB2-ABEND                                      
142755                     DP013-XCTL-DISPLAY-RESTART                           
142756                                   TO TRUE                                
142757                 PERFORM DP013-0000-PROCESS-ABEND                         
142758         END-EVALUATE.                                                    
142759                                                                          
142760         EXEC SQL                                                         
142761             CLOSE RLSE_DTE_D1_CSR                                        
142762         END-EXEC.                                                        
142763                                                                          
142764         EVALUATE TRUE                                                    
142765             WHEN SQLCODE = ZERO                                          
142766             WHEN SQLCODE = -904                                          
142767             WHEN SQLCODE = -913                                          
142768                 CONTINUE                                                 
142769             WHEN SQLWARN0 NOT = SPACES                                   
142770             WHEN SQLCODE < ZERO                                          
142771             WHEN SQLCODE > ZERO                                          
142772                 MOVE '7750-PROCESS-D-RLSE-CDES'                          
142773                                   TO DP013-PARAGRAPH                     
142774                 MOVE 'CLOSE CURSOR - '                                   
142775                                   TO DP013-MESSAGE-TEXT (1)              
142776                 MOVE SQLCA        TO DP013-SQLCA                         
142777                 MOVE 'TAUCNRL'    TO DP013-DB2-TABLE-NAME (1)            
142778                 SET DP013-DB2-ABEND                                      
142779                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
142780                 PERFORM DP013-0000-PROCESS-ABEND                         
142781         END-EVALUATE.                                                    
142782                                                                          
142783     IF  SQLCODE NOT EQUAL ZERO                                           
142784         MOVE '7750-PROCESS-D-RLSE-CDES' TO DP013-PARAGRAPH               
142785         MOVE 'RESOURCE NOT AVAILABLE - ATTEMPTING TO CLOSE CSR'          
142786                                   TO DP013-MESSAGE-TEXT (1)              
142787         MOVE SQLCA                TO DP013-SQLCA                         
142788         MOVE 'TAUCNRL'            TO DP013-DB2-TABLE-NAME (1)            
142789         SET DP013-DB2-ABEND                                              
142790             DP013-XCTL-DISPLAY-RESTART                                   
142791                                   TO TRUE                                
142792         PERFORM DP013-0000-PROCESS-ABEND                                 
142793     END-IF.                                                              
142794*----------------------------------------------------------------*        
142795* PERFORM WHEN THE ROW ON TIMCNRL HAS A 'D' RELEASE CODE AND THE *        
142796* DCONSLR-ACTL-DTE HAS A DEFAULT DATE (SECOND PART OF PARA 7750).*        
142797*----------------------------------------------------------------*        
142798 7755-PROCESS-D-RLSE-CDES-2.                                              
142799                                                                          
142801         EXEC SQL                                                         
142802             OPEN RLSE_DTE_D2_CSR                                         
142803         END-EXEC.                                                        
142804                                                                          
142805         EVALUATE TRUE                                                    
142806             WHEN SQLCODE = ZERO                                          
142807             WHEN SQLCODE = -904                                          
142808             WHEN SQLCODE = -913                                          
142809                 CONTINUE                                                 
142810             WHEN SQLWARN0 NOT = SPACES                                   
142811             WHEN SQLCODE < ZERO                                          
142812             WHEN SQLCODE > ZERO                                          
142813                 MOVE '7755-PROCESS-D-RLSE-CDES-2'                        
142814                                   TO DP013-PARAGRAPH                     
142815                 MOVE 'OPEN CURSOR - '                                    
142816                                   TO DP013-MESSAGE-TEXT (1)              
142817                 MOVE SQLCA        TO DP013-SQLCA                         
142818                 MOVE 'TAUCNRL'    TO DP013-DB2-TABLE-NAME (1)            
142819                 SET DP013-DB2-ABEND                                      
142820                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
142821                 PERFORM DP013-0000-PROCESS-ABEND                         
142822         END-EVALUATE.                                                    
142823                                                                          
142824     IF  SQLCODE NOT EQUAL ZERO                                           
142825         MOVE '7755-PROCESS-D-RLSE-CDES-2' TO DP013-PARAGRAPH             
142826         MOVE 'RESOURCE NOT AVAILABLE - ATTEMPTING TO OPEN CSR'           
142827                                   TO DP013-MESSAGE-TEXT (1)              
142828         MOVE SQLCA                TO DP013-SQLCA                         
142829         MOVE 'TAUCNRL'            TO DP013-DB2-TABLE-NAME (1)            
142830         SET DP013-DB2-ABEND                                              
142831             DP013-XCTL-DISPLAY-RESTART                                   
142832                                   TO TRUE                                
142833         PERFORM DP013-0000-PROCESS-ABEND                                 
142834     END-IF.                                                              
142835                                                                          
142836     EXEC SQL                                                             
142837        FETCH RLSE_DTE_D2_CSR                                             
142838        INTO                                                              
142839           :AUCNRL-DCONSLR-ACTL-DTE                                       
142840          ,:AUCNRL-DCONSLR-ACTL-TM                                        
142841          ,:AUCNRL-DCONSLR-RLSE-CDE                                       
142842     END-EXEC.                                                            
142843                                                                          
142844         EVALUATE TRUE                                                    
142845             WHEN SQLCODE = ZERO                                          
142846             WHEN SQLCODE = -811                                          
142847                 MOVE AUCNRL-DCONSLR-RLSE-CDE                             
142848                                  TO ASC-DCN-RLSE-CDE                     
142849                 MOVE AUCNRL-DCONSLR-ACTL-DTE                             
142850                                  TO ASC-DCN-ACTL-DTE                     
142851                 MOVE AUCNRL-DCONSLR-ACTL-TM                              
142852                                  TO ASC-DCN-ACTL-TM                      
142853                                                                          
142854             WHEN SQLCODE = +100                                          
142855                 CONTINUE                                                 
142856             WHEN SQLCODE = -904                                          
142857             WHEN SQLCODE = -911                                          
142858             WHEN SQLCODE = -913                                          
142859                 PERFORM 9900-SOFT-ABORT                                  
142860             WHEN SQLWARN0 NOT = SPACES                                   
142861             WHEN SQLCODE < ZERO                                          
142862             WHEN SQLCODE > ZERO                                          
142863                 MOVE '7755-PROCESS-D-RLSE-CDES-2'                        
142864                                   TO DP013-PARAGRAPH                     
142865                 MOVE 'FETCH - RLSE DTE D2 CSR'                           
142866                                   TO DP013-MESSAGE-TEXT (1)              
142867                 MOVE SQLCA        TO DP013-SQLCA                         
142868                 MOVE 'TAUCNRL'    TO DP013-DB2-TABLE-NAME (1)            
142869                 SET DP013-DB2-ABEND                                      
142870                     DP013-XCTL-DISPLAY-RESTART                           
142871                                   TO TRUE                                
142872                 PERFORM DP013-0000-PROCESS-ABEND                         
142873         END-EVALUATE.                                                    
142874                                                                          
142875         EXEC SQL                                                         
142876             CLOSE RLSE_DTE_D2_CSR                                        
142877         END-EXEC.                                                        
142878                                                                          
142879         EVALUATE TRUE                                                    
142880             WHEN SQLCODE = ZERO                                          
142881             WHEN SQLCODE = -904                                          
142882             WHEN SQLCODE = -913                                          
142883                 CONTINUE                                                 
142884             WHEN SQLWARN0 NOT = SPACES                                   
142885             WHEN SQLCODE < ZERO                                          
142886             WHEN SQLCODE > ZERO                                          
142887                 MOVE '7755-PROCESS-D-RLSE-CDES-2'                        
142888                                   TO DP013-PARAGRAPH                     
142889                 MOVE 'CLOSE CURSOR - '                                   
142890                                   TO DP013-MESSAGE-TEXT (1)              
142891                 MOVE SQLCA        TO DP013-SQLCA                         
142892                 MOVE 'TAUCNRL'    TO DP013-DB2-TABLE-NAME (1)            
142893                 SET DP013-DB2-ABEND                                      
142894                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
142895                 PERFORM DP013-0000-PROCESS-ABEND                         
142896         END-EVALUATE.                                                    
142897                                                                          
142898     IF  SQLCODE NOT EQUAL ZERO                                           
142899         MOVE '7755-PROCESS-D-RLSE-CDES-2' TO DP013-PARAGRAPH             
142900         MOVE 'RESOURCE NOT AVAILABLE - ATTEMPTING TO CLOSE CSR'          
142901                                   TO DP013-MESSAGE-TEXT (1)              
142902         MOVE SQLCA                TO DP013-SQLCA                         
142903         MOVE 'TAUCNRL'            TO DP013-DB2-TABLE-NAME (1)            
142904         SET DP013-DB2-ABEND                                              
142905             DP013-XCTL-DISPLAY-RESTART                                   
142906                                   TO TRUE                                
142907         PERFORM DP013-0000-PROCESS-ABEND                                 
142908     END-IF.                                                              
142909*----------------------------------------------------------------*08121000
142910* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *08130000
142920*----------------------------------------------------------------*08140000
143000                                                                  08150000
143100 9100-READ-SEL-QUEUE.                                             08160000
143200     EXEC CICS                                                    08170000
143300         READQ TS                                                 08180000
143400             QUEUE (ASC-SEL-QUEUE-NAME)                           08190000
143500             INTO  (DP057-MESSAGE-SEL-REC)                        08200000
143600             ITEM  (ASC-SEL-ITEM)                                 08210000
143700             RESP  (PV-CICS-RESPONSE)                             08220000
143800     END-EXEC.                                                    08230000
143900                                                                  08240000
144000     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   08250000
144100         CONTINUE                                                 08260000
144200     ELSE                                                         08270000
144300         SET DP013-LOGIC-ABEND                                    08280000
144400             DP013-NO-ROLLBACK     TO TRUE                        08290000
144500         MOVE '9100-READ-SEL-QUEUE'                               08300000
144600                                   TO DP013-PARAGRAPH             08310000
144700         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   08320000
144800                                   TO DP013-MESSAGE-TEXT (1)      08330000
144900         PERFORM DP013-0000-PROCESS-ABEND                         08340000
145000     END-IF.                                                      08350000
145100*----------------------------------------------------------------*08360000
145200* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *08370000
145300*----------------------------------------------------------------*08380000
145400 9200-REWRITE-LIST-QUEUE.                                         08390000
145500     EXEC CICS                                                    08400000
145600          WRITEQ TS                                               08410000
145700              QUEUE  (ASC-SEL-QUEUE-NAME)                         08420000
145800              FROM   (DP057-MESSAGE-SEL-REC)                      08430000
145900              ITEM   (ASC-SEL-ITEM)                               08440000
146000              RESP   (PV-CICS-RESPONSE)                           08450000
146100              REWRITE                                             08460000
146200     END-EXEC.                                                    08470000
146300                                                                  08480000
146400     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               08490000
146500         SET DP013-CICS-ABEND                                     08500000
146600             DP013-NO-ROLLBACK     TO TRUE                        08510000
146700         MOVE '9200-REWRITE-LIST-QUEUE'                           08520000
146800                                   TO DP013-PARAGRAPH             08530000
146900         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   08540000
147000                                   TO DP013-MESSAGE-TEXT (1)      08550000
147100         PERFORM DP013-0000-PROCESS-ABEND                         08560000
147200     END-IF.                                                      08570000
147300/                                                                 08580000
147400 9900-SOFT-ABORT.                                                         
147500     SET PS-ERROR         TO TRUE.                                        
147600     SET DP020-MSG-FATAL  TO TRUE.                                        
147700     MOVE 'THROUGH SOFT-ABORT PARA'                                       
147800                      TO DP013-MESSAGE-TEXT (1)                           
147900     MOVE PC-TSYMSG-00551 TO DP020-MSG-NUMBER.                            
148000     SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                                
148100     PERFORM 9901-BACKOUT.                                                
148200     MOVE 'PROGRAM EXIT CALL' TO DP013-MESSAGE-TEXT (1).                  
148300     PERFORM 0001-CALL-CICS-ARCH-API.                                     
148400                                                                          
148500 9901-BACKOUT.                                                            
148600     EXEC CICS SYNCPOINT                                                  
148700          ROLLBACK                                                        
148800     END-EXEC.                                                            
148900                                                                          
149000 EJECT                                                            08590000
149100*----------------------------------------------------------------*08600000
149200*    ABEND PROCESSOR MODULE                                      *08610000
149300*----------------------------------------------------------------*08620000
149400                                                                  08630000
149500     COPY DPPD013.                                                08640000
