000100******************************************************************00010004
000200 IDENTIFICATION DIVISION.                                         00020004
000600******************************************************************00060004
000700 PROGRAM-ID.    CNKUP809.                                         00070099
000800 AUTHOR.        TKMA497.                                          00080007
000900 INSTALLATION.  KOHLS.                                            00090004
001000 DATE-WRITTEN   SEPTEMBER, 2011.                                  00100099
001100 DATE-COMPILED.                                                   00110004
001200******************************************************************00120004
001210*  NEW DC - TICKET FORMAT INSERT  - TTKTFMT                       00121099
001300*  THIS PROGRAM INSERTS TTKTFMT DATA FROM A FLAT FILE TO THE      00130099
001400*  TTKTFMT TABLE                                                  00140099
006600******************************************************************00660004
007000 ENVIRONMENT DIVISION.                                            00700004
007100******************************************************************00710004
007200 CONFIGURATION SECTION.                                           00720004
007300*                                                                 00730004
007400 SOURCE-COMPUTER.        IBM-3090.                                00740004
007500 OBJECT-COMPUTER.        IBM-3090.                                00750004
007600*                                                                 00760004
007700 INPUT-OUTPUT SECTION.                                            00770004
007800*                                                                 00780004
007900 FILE-CONTROL.                                                    00790004
008000*                                                                 00800099
008400     SELECT TTKTFMT-FILE-IN                                       00840099
008500         ASSIGN TO INP01.                                         00850060
008700*                                                                 00870004
008800******************************************************************00880004
008900 DATA DIVISION.                                                   00890004
009000******************************************************************00900004
009100 FILE SECTION.                                                    00910004
009200*                                                                 00920004
010000*                                                                 01000004
010100 FD  TTKTFMT-FILE-IN                                              01010099
010200     RECORDING MODE IS F                                          01020004
010300     BLOCK CONTAINS 0 RECORDS                                     01030004
010400     LABEL RECORDS ARE STANDARD.                                  01040004
010500*                                                                 01050004
010600 01  TTKTFMT-RECORD-IN              PIC  X(128).                  01060099
010800*                                                                 01080004
010900 WORKING-STORAGE SECTION.                                         01090004
010910 01  WS-TTKTFMT.                                                  01091099
010920     05  WS-TKTFMT-DATA.                                          01092099
010930         10 WS-TKTFMT-OPER-UNT-ID         PIC  S9(4) COMP.        01093099
010940         10 WS-TKTFMT-FCLTY-ID            PIC  S9(4) COMP.        01094099
010950         10 WS-TKTFMT-TKT-OFF-ID          PIC   X(6).             01095099
010960         10 WS-TKTFMT-TKT-FMT-ID          PIC   X(6).             01096099
010970         10 WS-TKTFMT-TKT-OFF-DESC        PIC   X(30).            01097099
010980         10 WS-TKTFMT-TKT-FMT-DESC        PIC   X(30).            01098099
010990         10 WS-TKTFMT-TYP-CDE             PIC   X(1).             01099099
011000         10 WS-TKTFMT-OPT-BLK-TAGS-IND    PIC   X(1).             01100099
011001         10 WS-TKTFMT-PRT-SIZE-IND        PIC   X(1).             01100199
011002         10 WS-TKTFMT-PRT-COLOR-IND       PIC   X(1).             01100299
011003         10 WS-TKTFMT-PRT-GP-PR-IND       PIC   X(1).             01100399
011004         10 WS-TKTFMT-CMPANON-OP-UNT-ID   PIC  S9(4) COMP.        01100499
011005         10 WS-CMPANON-OP-UNT-ID-NULL     PIC  S9(4) COMP.        01100599
011006         10 WS-TKTFMT-CMPANON-FCLTY-ID    PIC  S9(4) COMP.        01100699
011007         10 WS-CMPANON-FCLTY-ID-NULL      PIC  S9(4) COMP.        01100799
011008         10 WS-TKTFMT-CMPANON-TKT-ID      PIC   X(6).             01100899
011009         10 WS-CMPANON-TKT-ID-NULL        PIC  S9(4) COMP.        01100999
011010         10 WS-TKTFMT-PAPER-TYP-ID        PIC   X(6).             01101099
011011         10 WS-TKTFMT-OPT-BLK-LBLS-IND    PIC   X(1).             01101199
011012         10 WS-TKTFMT-STKR-NBR-REQ-IND    PIC   X(1).             01101299
011013         10 WS-TKTFMT-TKT-OFF-ADR-ID      PIC   X(8).             01101399
011014         10 WS-TKTFMT-TKT-FMT-NBR         PIC   X(15).            01101499
011020*                                                                 01102004
011100 01  PC-PROGRAM-CONSTANTS.                                        01110004
011200     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)    VALUE            01120019
011300         'CNKUP809'.                                              01130099
014600*                                                                 01460004
014700 01  PS-PROGRAM-SWITCHES.                                         01470004
015201     05  PS-END-OF-INPUT-SW          PIC  X(01)    VALUE 'N'.     01520163
015210         88 PS-END-OF-INPUT-NO                     VALUE 'N'.     01521063
015220         88 PS-END-OF-INPUT-YES                    VALUE 'Y'.     01522063
015400*                                                                 01540004
015500 01  PV-PROGRAM-VARIABLES.                                        01550004
015600     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     01560004
015700                                                   COMP.          01570004
015800     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  01580004
015810     05  PV-LOC-ID                   PIC  9(04).                  01581087
015820     05  PV-COMMIT-CNT               PIC S9(03)    COMP-3.        01582090
015830     05  PV-INSERT-CNT               PIC S9(03)    COMP-3         01583093
015840                                                   VALUE +1.      01584093
015900     05  PV-TTKTFMT-CNT              PIC S9(05)    VALUE ZERO     01590099
016000                                                   COMP-3.        01600004
016100     05  PV-INPUT-CNT                PIC S9(05)    VALUE ZERO     01610066
016200                                                   COMP-3.        01620004
016410     05  PV-DISPLAY-CNT              PIC ZZZZ9.                   01641033
016420     05  PV-DISPLAY-OPER-UNT-ID      PIC  9(4).                   01642099
016421     05  PV-DISPLAY-FCLTY-ID         PIC  9(4).                   01642199
016500     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01650004
020400*                                                                 02040004
021300******************************************************************02130004
021400*  COPY BOOK FOR DB2 FORMATTED MESSAGE AREA                       02140004
021500******************************************************************02150004
021600     COPY DPWS004.                                                02160004
021800*                                                                 02180004
021900******************************************************************02190004
022000*  COMMUNICATIONS AREA FOR DB2                                    02200004
022100******************************************************************02210004
022200     EXEC SQL                                                     02220004
022300          INCLUDE SQLCA                                           02230004
022400     END-EXEC.                                                    02240004
022500*                                                                 02250004
022510*----------------------------------------------------------------*02251035
022520*    DB2 TABLE FOR PACK-TO-LIGHT MODULES                          02252099
022530*----------------------------------------------------------------*02253035
022540     EXEC SQL                                                     02254035
022550          INCLUDE TTKTFMT                                         02255099
022560     END-EXEC.                                                    02256035
024900*                                                                 02490004
024920*----------------------------------------------------------------*02492099
024930*    DB2 TABLE FOR PARAMETERS                                     02493099
024940*----------------------------------------------------------------*02494099
024950     EXEC SQL                                                     02495099
024960          INCLUDE TKRPRPM                                         02496099
024970     END-EXEC.                                                    02497099
024980*                                                                 02498099
046000*                                                                 04600004
046100******************************************************************04610004
046200 PROCEDURE DIVISION.                                              04620004
046300******************************************************************04630004
046400                                                                  04640004
046500******************************************************************04650004
046600*  CONTROLS THE MAIN PROCESSING OF THE PROGRAM.                   04660004
046700******************************************************************04670004
046800 0000-PROGRAM-MAINLINE.                                           04680004
046810     PERFORM 1000-INITIALIZE.                                     04681091
047000*                                                                 04700004
047010     PERFORM 5000-READ-INPUT.                                     04701066
047020     IF PS-END-OF-INPUT-NO                                        04702099
047029         PERFORM 2000-PROCESS-TTKTFMT                             04702999
047030             UNTIL PS-END-OF-INPUT-YES                            04703099
047050         PERFORM 8000-COMMIT                                      04705099
047060     END-IF.                                                      04706099
047480     PERFORM 9000-DISPLAY-COUNTS                                  04748043
047500*                                                                 04750004
047510     CLOSE TTKTFMT-FILE-IN.                                       04751099
047520*                                                                 04752064
047600     STOP RUN.                                                    04760004
047700*                                                                 04770004
048400******************************************************************04840004
048800*                                                                 04880004
048801 1000-INITIALIZE.                                                 04880191
048802                                                                  04880299
048803     DISPLAY '**'.                                                04880399
048804     DISPLAY '** PROGRAM:  CNKUP809'.                             04880499
048805     DISPLAY '**'.                                                04880599
048806                                                                  04880699
048810     OPEN INPUT TTKTFMT-FILE-IN.                                  04881099
049100                                                                  04910094
049200     EXEC SQL                                                     04920091
049400          SELECT FUNC_QTY                                         04940092
049500            INTO :PV-COMMIT-CNT                                   04950092
049593            FROM TKRPRPM                                          04959399
049594           WHERE LOC_ID           = 90                            04959494
049595             AND INTFC_SYS_CDE    = 'KHL'                         04959594
049596             AND SYS_PRC_FUNC_CDE = 'DCCOMT'                      04959699
049597         WITH UR                                                  04959791
049598     END-EXEC                                                     04959891
049599     EVALUATE TRUE                                                04959995
049600         WHEN SQLCODE = ZERO                                      04960095
049601              CONTINUE                                            04960199
049602         WHEN OTHER                                               04960295
049603              DISPLAY 'SYS_PRC_FUNC_CDE = DCCOMT'                 04960399
049609              MOVE '1000-INITIALIZE'                              04960995
049610                                 TO PV-ABEND-PARAGRAPH            04961095
049611              MOVE 'SELECT'      TO PV-DB2-OPERATION-ATTEMPTED    04961195
049612              PERFORM 9200-SQL-ABEND                              04961295
049613     END-EVALUATE.                                                04961395
049614*                                                                 04961495
049620******************************************************************04962004
049700 2000-PROCESS-TTKTFMT.                                            04970099
058600*                                                                 05860004
059200     PERFORM 7000-INSERT-TTKTFMT                                  05920099
059800*                                                                 05980004
061910     PERFORM 5000-READ-INPUT.                                     06191067
062000*                                                                 06200004
062001 5000-READ-INPUT.                                                 06200166
062010     READ TTKTFMT-FILE-IN                                         06201099
062021          INTO WS-TTKTFMT                                         06202199
062030          AT END                                                  06203065
062040              SET PS-END-OF-INPUT-YES TO TRUE                     06204073
062050          NOT AT END                                              06205067
062060              ADD +1 TO PV-INPUT-CNT.                             06206067
111900*                                                                 11190004
112000******************************************************************11200004
112100*  INSERT TICKET FORMAT TABLE                                     11210099
112200******************************************************************11220004
112300 7000-INSERT-TTKTFMT.                                             11230099
112301*                                                                 11230168
112302     EXEC SQL                                                     11230269
112310     INSERT INTO TTKTFMT                                          11231099
112320                (OPER_UNT_ID                                      11232099
112321                ,FCLTY_ID                                         11232199
112322                ,TKT_OFF_ID                                       11232299
112323                ,TKT_FMT_ID                                       11232399
112324                ,TKT_OFF_DESC                                     11232499
112325                ,TKT_FMT_DESC                                     11232599
112326                ,TYP_CDE                                          11232699
112327                ,OPT_BLK_TAGS_IND                                 11232799
112328                ,PRT_SIZE_IND                                     11232899
112329                ,PRT_COLOR_IND                                    11232999
112330                ,PRT_GP_PR_IND                                    11233099
112331                ,CMPANON_OP_UNT_ID                                11233199
112332                ,CMPANON_FCLTY_ID                                 11233299
112333                ,CMPANON_TKT_ID                                   11233399
112334                ,PAPER_TYP_ID                                     11233499
112335                ,OPT_BLK_LBLS_IND                                 11233599
112336                ,STKR_NBR_REQ_IND                                 11233699
112337                ,TKT_OFF_ADR_ID                                   11233799
112338                ,TKT_FMT_NBR)                                     11233899
112397        VALUES (:WS-TKTFMT-OPER-UNT-ID                            11239799
112398               ,:WS-TKTFMT-FCLTY-ID                               11239899
112399               ,:WS-TKTFMT-TKT-OFF-ID                             11239999
112400               ,:WS-TKTFMT-TKT-FMT-ID                             11240099
112401               ,:WS-TKTFMT-TKT-OFF-DESC                           11240199
112402               ,:WS-TKTFMT-TKT-FMT-DESC                           11240299
112403               ,:WS-TKTFMT-TYP-CDE                                11240399
112404               ,:WS-TKTFMT-OPT-BLK-TAGS-IND                       11240499
112405               ,:WS-TKTFMT-PRT-SIZE-IND                           11240599
112406               ,:WS-TKTFMT-PRT-COLOR-IND                          11240699
112407               ,:WS-TKTFMT-PRT-GP-PR-IND                          11240799
112408               ,:WS-TKTFMT-CMPANON-OP-UNT-ID                      11240899
112409                    :WS-CMPANON-OP-UNT-ID-NULL                    11240999
112410               ,:WS-TKTFMT-CMPANON-FCLTY-ID                       11241099
112411                    :WS-CMPANON-FCLTY-ID-NULL                     11241199
112412               ,:WS-TKTFMT-CMPANON-TKT-ID                         11241299
112413                    :WS-CMPANON-TKT-ID-NULL                       11241399
112414               ,:WS-TKTFMT-PAPER-TYP-ID                           11241499
112415               ,:WS-TKTFMT-OPT-BLK-LBLS-IND                       11241599
112416               ,:WS-TKTFMT-STKR-NBR-REQ-IND                       11241699
112417               ,:WS-TKTFMT-TKT-OFF-ADR-ID                         11241799
112418               ,:WS-TKTFMT-TKT-FMT-NBR)                           11241899
112680     END-EXEC.                                                    11268069
112700*                                                                 11270004
112800     EVALUATE TRUE                                                11280004
112900         WHEN SQLCODE = ZERO                                      11290004
112910              ADD +1 TO PV-TTKTFMT-CNT                            11291099
112911                        PV-INSERT-CNT                             11291197
112912              IF PV-INSERT-CNT > PV-COMMIT-CNT                    11291299
112920                   PERFORM 8000-COMMIT                            11292098
112930                   MOVE +1    TO PV-INSERT-CNT                    11293098
112933              END-IF                                              11293398
112934         WHEN SQLCODE = -803                                      11293498
112938              MOVE WS-TKTFMT-OPER-UNT-ID                          11293899
112939                                     TO PV-DISPLAY-OPER-UNT-ID    11293999
112940              DISPLAY '*** DUPLICATE INSERT FOR: '                11294099
112941              DISPLAY '    ' PV-DISPLAY-OPER-UNT-ID ' '           11294199
112942                             WS-TKTFMT-TKT-OFF-ID ' '             11294299
112943                             WS-TKTFMT-TKT-FMT-ID                 11294399
113100         WHEN OTHER                                               11310004
113101              PERFORM 9000-DISPLAY-COUNTS                         11310199
113102              MOVE WS-TKTFMT-OPER-UNT-ID                          11310299
113103                                     TO PV-DISPLAY-OPER-UNT-ID    11310399
113107              DISPLAY '  ' PV-DISPLAY-OPER-UNT-ID ' '             11310799
113108                           WS-TKTFMT-TKT-OFF-ID ' '               11310899
113109                           WS-TKTFMT-TKT-FMT-ID                   11310999
113200              MOVE '7000-INSERT-TTKTFMT'                          11320099
113300                                 TO PV-ABEND-PARAGRAPH            11330022
113400              MOVE 'INSERT'      TO PV-DB2-OPERATION-ATTEMPTED    11340068
113500              PERFORM 9200-SQL-ABEND                              11350004
113600     END-EVALUATE.                                                11360004
143400*                                                                 14340004
143500 8000-COMMIT.                                                     14350098
143510     EXEC SQL                                                     14351098
143520          COMMIT                                                  14352098
143530     END-EXEC                                                     14353098
143540     IF SQLCODE = ZERO                                            14354099
143541         MOVE WS-TKTFMT-OPER-UNT-ID TO PV-DISPLAY-OPER-UNT-ID     14354199
143553         DISPLAY '*** COMMIT TAKEN AT: '                          14355399
143554                  PV-DISPLAY-OPER-UNT-ID ' '                      14355499
143555                  WS-TKTFMT-TKT-OFF-ID ' '                        14355599
143556                  WS-TKTFMT-TKT-FMT-ID                            14355699
143570     ELSE                                                         14357098
143571         PERFORM 9000-DISPLAY-COUNTS                              14357199
143580         MOVE WS-TKTFMT-OPER-UNT-ID TO PV-DISPLAY-OPER-UNT-ID     14358099
143592         DISPLAY '  ' PV-DISPLAY-OPER-UNT-ID ' '                  14359299
143593                      WS-TKTFMT-TKT-OFF-ID ' '                    14359399
143594                      WS-TKTFMT-TKT-FMT-ID                        14359499
144300         MOVE '8000-COMMIT' TO PV-ABEND-PARAGRAPH                 14430099
144500         MOVE 'COMMIT'      TO PV-DB2-OPERATION-ATTEMPTED         14450098
144600         PERFORM 9200-SQL-ABEND                                   14460098
144610     END-IF.                                                      14461099
144700******************************************************************14470004
144800 9000-DISPLAY-COUNTS.                                             14480033
145100                                                                  14510004
145200     DISPLAY '********************************************'.      14520099
145300     DISPLAY '**                                        **'.      14530099
145301     DISPLAY '** TTKTFMT - TICKET FORMAT                **'.      14530199
145302     DISPLAY '**                                        **'.      14530299
145310     MOVE PV-INPUT-CNT       TO PV-DISPLAY-CNT                    14531071
145400     DISPLAY 'INPUT FILE COUNT ----: ' PV-DISPLAY-CNT.            14540099
145500     MOVE PV-TTKTFMT-CNT     TO PV-DISPLAY-CNT                    14550099
145501     DISPLAY 'TTKTFMT INSERTED ----: ' PV-DISPLAY-CNT.            14550199
145502     DISPLAY '**                                        **'.      14550299
145510     DISPLAY '********************************************'.      14551037
146600*                                                                 14660004
146700*                                                                 14670004
146800******************************************************************14680004
146900*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    14690004
147000*  ERROR OR WARNING CODE OCCURS.                                  14700004
147100******************************************************************14710004
147200 9200-SQL-ABEND.                                                  14720004
147300     DISPLAY '9200-SQL-ABEND'.                                    14730004
147400     DISPLAY '** ABEND     **'.                                   14740004
147500     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        14750004
147600     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             14760004
147700     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     14770004
147800*                                                                 14780004
147900*                                                                 14790004
148000******************************************************************14800004
148100* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    14810004
148200* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         14820004
148300* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     14830004
148400* FORMAT.                                                         14840004
148500******************************************************************14850004
148600     COPY DPPD004.                                                14860004
148700                                                                  14870004
148800     IF  SQLCODE NOT = -911                                       14880004
148900         EXEC SQL                                                 14890004
149000              COMMIT                                              14900004
149100         END-EXEC                                                 14910004
149200     END-IF.                                                      14920004
149300                                                                  14930004
149400     MOVE +4013                  TO PV-ABEND-CODE.                14940004
149500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         14950004
