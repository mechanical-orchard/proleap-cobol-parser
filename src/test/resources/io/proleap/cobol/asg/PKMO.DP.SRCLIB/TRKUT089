000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.              TRKUT089.                               00020000
000300 AUTHOR.                  DENISE HAHN.                            00030000
000400 DATE-WRITTEN.            JULY 2020.                              00040000
000500 DATE-COMPILED.                                                   00050000
000600                                                                  00060000
000700******************************************************************00070000
000800* THIS PROGRAM WILL EXTRACT DATA FROM TVEHICL WHERE THE CURRENT  *00080000
000810* TRIP STATUS ON TVEHICL IS ET, BUT THE LAST TRIP FOR THE VEHICLE*00081000
000900* IS NOT IN ET STATUS.                                           *00090000
000910* WILL ALSO CHECK IF TSHIPST (SHIPMENT STATUS) IS SET TO ET      *00091000
000911* EXTRACT WILL BE USED BY TRKUP089 TO INSERT DP & ET ROWS INTO   *00091100
000912* TSHIPST & TTRIPST                                              *00091200
000917******************************************************************00091700
000918 ENVIRONMENT DIVISION.                                            00091800
000919 CONFIGURATION SECTION.                                           00091900
000920                                                                  00092000
000921 INPUT-OUTPUT SECTION.                                            00092100
000922 FILE-CONTROL.                                                    00092200
000923                                                                  00092300
000924     SELECT TRIP-FILE                                             00092400
000925        ASSIGN TO OUT01.                                          00092500
000926                                                                  00092600
000927     SELECT SHPMT-FILE                                            00092700
000928        ASSIGN TO OUT02.                                          00092800
000929                                                                  00092900
000930 DATA DIVISION.                                                   00093000
000940 FILE SECTION.                                                    00094000
000950                                                                  00095000
000960 FD  TRIP-FILE                                                    00096000
000970     RECORDING MODE IS F                                          00097000
000980     LABEL RECORDS ARE STANDARD                                   00098000
000990     RECORD CONTAINS 125 CHARACTERS                               00099000
001000     DATA RECORD IS TRIP-RECORD.                                  00100000
001100                                                                  00110000
001200 01  TRIP-RECORD                 PIC X(125).                      00120000
001300                                                                  00130000
001400                                                                  00140000
001500 FD  SHPMT-FILE                                                   00150000
001600     RECORDING MODE IS F                                          00160000
001700     LABEL RECORDS ARE STANDARD                                   00170000
001800     RECORD CONTAINS 100 CHARACTERS                               00180000
001900     DATA RECORD IS SHPMT-RECORD.                                 00190000
002000                                                                  00200000
002010 01  SHPMT-RECORD                PIC X(100).                      00201000
002020                                                                  00202000
002030                                                                  00203000
002040 WORKING-STORAGE SECTION.                                         00204000
002050                                                                  00205000
002060                                                                  00206000
002070 01  PROGRAM-SWITCHES.                                            00207000
002080     05  PS-END-OF-TRIP-CSR-SW       PIC  X(01)  VALUE 'N'.       00208000
002090         88  PS-END-OF-TRIP-CSR-YES              VALUE 'Y'.       00209000
002100         88  PS-END-OF-TRIP-CSR-NO               VALUE 'N'.       00210000
002200     05  PS-END-OF-SHPMT-CSR-SW      PIC  X(01)  VALUE 'N'.       00220000
002300         88  PS-END-OF-SHPMT-CSR-YES             VALUE 'Y'.       00230000
002400         88  PS-END-OF-SHPMT-CSR-NO              VALUE 'N'.       00240000
002500     05  PS-ERROR-SW                 PIC  X(01)  VALUE 'N'.       00250000
002600         88  PS-ERROR-YES                        VALUE 'Y'.       00260000
002700         88  PS-ERROR-NO                         VALUE 'N'.       00270000
002800                                                                  00280000
002900 01  PV-ABEND-FIELDS.                                             00290000
003000     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'TRKUT089'.00300000
003100     05  PV-ABEND-CODE               PIC S9(04)  VALUE +0         00310000
003200                                                 COMP SYNC.       00320000
003300     05  PV-PARAGRAPH-NAME           PIC  X(30)  VALUE SPACES.    00330000
003400     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)  VALUE SPACES.    00340000
003500     05  PV-ABEND-PARAGRAPH          PIC  X(30)  VALUE SPACES.    00350000
003600     05  PV-ABEND-OPERATION          PIC  X(30)  VALUE SPACES.    00360000
003700     05  PV-DB2-OPER-ATTEMPTED       PIC  X(30)  VALUE SPACES.    00370000
003800     05  PV-DB2-OPERATION-MESSAGE-1  PIC  X(79)  VALUE SPACES.    00380000
003900     05  PV-DB2-OPERATION-MESSAGE-2  PIC  X(79)  VALUE SPACES.    00390000
004000     05  PV-DB2-OPERATION-MESSAGE-3  PIC  X(79)  VALUE SPACES.    00400000
004100     05  PV-DB2-OPERATION-MESSAGE-4  PIC  X(79)  VALUE SPACES.    00410000
004200     05  PV-SQLCODE                  PIC -Z(03)  VALUE ZERO.      00420000
004300     05  PV-NEW-STATUS-DTE           PIC  X(10)  VALUE SPACES.    00430000
004400                                                                  00440000
004500                                                                  00450000
004600 01  DK-DB2-KEYS.                                                 00460000
004700     05  DK-TRIP-ID                  PIC  S9(9) COMP VALUE ZEROES.00470000
004800 01  PROGRAM-VARIABLES.                                           00480000
004900     05  PV-TRIP-COUNT               PIC  9(09).                  00490000
005000     05  PV-SHPMT-COUNT              PIC S9(09)  VALUE ZEROES     00500000
005100                                                 COMP.            00510000
005200     05  PV-NULL-IND-1               PIC S9(04)  VALUE ZEROS      00520000
005300                                                 COMP SYNC.       00530000
005400     05  PV-NULL-IND-2               PIC S9(04)  VALUE ZEROS      00540000
005500                                                 COMP SYNC.       00550000
005600     05  PV-DISP-TRIP                PIC  Z(10)  VALUE ZEROS.     00560000
005610     05  PV-DISP-OPER                PIC  Z(03)  VALUE ZERO.      00561000
005620                                                                  00562000
005630 01  ABEND-CODE                PIC S9(04)  VALUE +0 COMP SYNC.    00563000
005640     88 ABEND-4013                         VALUE +4013.           00564000
005650                                                                  00565000
005660***************************************************************** 00566000
005670*    TRIP FILE LAYOUT                                           * 00567000
005680***************************************************************** 00568000
005690     COPY TRRD074.                                                00569001
005700                                                                  00570000
005800***************************************************************** 00580000
005900*    SHPMT FILE LAYOUT                                          * 00590000
005910***************************************************************** 00591000
005920     COPY TRRD075.                                                00592001
005930                                                                  00593000
005940***************************************************************** 00594000
005950*    SQL ABEND ROUTINE WORKING STORAGE                          * 00595000
005960***************************************************************** 00596000
005970     COPY DPWS004.                                                00597000
005980                                                                  00598000
005990     EXEC SQL                                                     00599000
006000        INCLUDE TVHTRIP                                           00600000
006100     END-EXEC.                                                    00610000
006200                                                                  00620000
006300     EXEC SQL                                                     00630000
006400        INCLUDE TTRIPST                                           00640000
006500     END-EXEC.                                                    00650000
006600                                                                  00660000
006700     EXEC SQL                                                     00670000
006800        INCLUDE TTRSTYP                                           00680000
006900     END-EXEC.                                                    00690000
007000                                                                  00700000
007100     EXEC SQL                                                     00710000
007200        INCLUDE TVEHICL                                           00720000
007300     END-EXEC.                                                    00730000
007400                                                                  00740000
007500     EXEC SQL                                                     00750000
007600        INCLUDE TSHIPMT                                           00760000
007700     END-EXEC.                                                    00770000
007800                                                                  00780000
007900     EXEC SQL                                                     00790000
008000        INCLUDE TSHIPST                                           00800000
008100     END-EXEC.                                                    00810000
008200                                                                  00820000
008210     EXEC SQL                                                     00821000
008220        INCLUDE TSHSTYP                                           00822000
008230     END-EXEC.                                                    00823000
008240                                                                  00824000
008250     EXEC SQL                                                     00825000
008260        DECLARE TRIP_CSR CURSOR FOR                               00826000
008270         SELECT B.OWNER_SCAC_ID                                   00827000
008280               ,B.VEH_NBR                                         00828000
008290               ,C.TRIP_ID                                         00829000
008300               ,D.TRIP_STATUS_CDE                                 00830000
008400               ,D.OPER_UNT_ID                                     00840000
008500               ,D.STATUS_DTE                                      00850000
008600               ,D.STATUS_TME                                      00860000
008700               ,D.STATUS_UID                                      00870000
008800               ,D.STATUS_DTE + 1 DAY AS NEW_STATUS_DTE            00880000
008900           FROM  TVEHICL B                                        00890000
009000               , TVHTRIP C                                        00900000
009100               , TTRIPST D                                        00910000
009110               , TTRSTYP H                                        00911000
009130          WHERE B.CURR_STATUS_CDE = 'ET'                          00913000
009140            AND B.OWNER_SCAC_ID   =  C.OWNER_SCAC_ID              00914000
009150            AND B.VEH_NBR         =  C.VEH_NBR                    00915000
009160            AND C.TRIP_ID         =  D.TRIP_ID                    00916000
009170            AND D.TRIP_STATUS_CDE = H.TRIP_STATUS_CDE             00917000
009180            AND H.PRTY_CDE IN                                     00918000
009190                (SELECT MAX(HI.PRTY_CDE)                          00919000
009200                   FROM TTRIPST DI                                00920000
009201                      , TTRSTYP HI                                00920100
009202                  WHERE D.TRIP_ID  = DI.TRIP_ID                   00920200
009203                    AND DI.TRIP_STATUS_CDE = HI.TRIP_STATUS_CDE   00920300
009204                )                                                 00920400
009205            AND D.OPER_UNT_ID > 0                                 00920500
009206            AND NOT D.TRIP_STATUS_CDE IN ( 'ET','DE','EN','UG')   00920600
010094       ORDER BY 3                                                 01009400
010095         WITH UR                                                  01009500
010096     END-EXEC.                                                    01009600
010097                                                                  01009700
010098                                                                  01009800
010099     EXEC SQL                                                     01009900
010100        DECLARE SHPMT_CSR CURSOR FOR                              01010000
010200         SELECT A.TRIP_ID                                         01020000
010201              , B.SHIPT_ID                                        01020100
010202              , B.SHIPT_STATUS_CDE                                01020200
010203              , B.STATUS_DTE                                      01020300
010204              , B.STATUS_TME                                      01020400
010208              , B.STATUS_DTE + 1 DAY AS NEW_STATUS_DTE            01020800
010209           FROM TSHIPMT A                                         01020900
010210              , TSHIPST B                                         01021000
010211              , TSHSTYP F                                         01021100
010212         WHERE A.TRIP_ID  =  :DK-TRIP-ID                          01021200
010213           AND A.SHIPT_ID  =  B.SHIPT_ID                          01021300
010214           AND B.STATUS_DTE  IN                                   01021400
010215               (SELECT MAX(C.STATUS_DTE)                          01021500
010216                  FROM TSHIPST C                                  01021600
010217                 WHERE B.SHIPT_ID  =  C.SHIPT_ID)                 01021700
010218           AND B.STATUS_TME  IN                                   01021800
010219               (SELECT MAX(D.STATUS_TME)                          01021900
010220                  FROM TSHIPST D                                  01022000
010221                 WHERE B.SHIPT_ID  =  D.SHIPT_ID                  01022100
010222                   AND D.STATUS_DTE  IN                           01022200
010223                      (SELECT MAX(E.STATUS_DTE)                   01022300
010224                         FROM TSHIPST E                           01022400
010225                        WHERE D.SHIPT_ID  =  E.SHIPT_ID)          01022500
010226               )                                                  01022600
010227           AND B.SHIPT_STATUS_CDE  =  F.SHIPT_STATUS_CDE          01022700
010228           AND NOT B.SHIPT_STATUS_CDE IN ('DE','ET')              01022800
010229        ORDER BY 1,2                                              01022900
010230         WITH UR                                                  01023000
010240     END-EXEC.                                                    01024000
010250                                                                  01025000
010260                                                                  01026000
010270*   DB2 SQL COMMUNICATION AREA                                    01027000
010280     EXEC SQL                                                     01028000
010290          INCLUDE SQLCA                                           01029000
010300     END-EXEC.                                                    01030000
010400                                                                  01040000
010500                                                                  01050000
010600******************************************************************01060000
010700 PROCEDURE DIVISION.                                              01070000
010800******************************************************************01080000
010900* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     01090000
011000*      PROGRAM.                                                   01100000
011100******************************************************************01110000
011200 0000-PROGRAM-MAINLINE.                                           01120000
011300                                                                  01130000
011400     OPEN OUTPUT TRIP-FILE                                        01140000
011500                 SHPMT-FILE.                                      01150000
011600                                                                  01160000
011700     PERFORM 8000-OPEN-TRIP-CSR                                   01170000
011800     PERFORM 8010-FETCH-TRIP-CSR                                  01180000
011900                                                                  01190000
012000     PERFORM 2000-PROCESS-TRIP                                    01200000
012100       UNTIL PS-END-OF-TRIP-CSR-YES.                              01210000
012200                                                                  01220000
012300     PERFORM 8020-CLOSE-TRIP-CSR.                                 01230000
012400                                                                  01240000
012500     DISPLAY '************************************************'   01250000
012600     DISPLAY '** TRKUT089'                                        01260000
012700     DISPLAY '** '                                                01270000
012800     DISPLAY '** TRIP COUNT:  ' PV-TRIP-COUNT                     01280000
012900     DISPLAY '** SHPMT COUNT: ' PV-SHPMT-COUNT                    01290000
013000     DISPLAY '************************************************'   01300000
013100                                                                  01310000
013200     CLOSE TRIP-FILE                                              01320000
013300           SHPMT-FILE.                                            01330000
013400                                                                  01340000
013500     STOP RUN.                                                    01350000
013600                                                                  01360000
013700***********************************************************       01370000
013800*                                                         *       01380000
013900***********************************************************       01390000
014000 2000-PROCESS-TRIP.                                               01400000
014100                                                                  01410000
014200     PERFORM 3000-WRITE-TRIP-RECORD.                              01420000
014300                                                                  01430000
014400     SET  PS-END-OF-SHPMT-CSR-NO  TO  TRUE.                       01440000
014510                                                                  01451006
014520     MOVE  VHTRIP-TRIP-ID  TO  DK-TRIP-ID.                        01452006
014530                                                                  01453006
014600     PERFORM 8030-OPEN-SHPMT-CSR                                  01460000
014700     PERFORM 8040-FETCH-SHPMT-CSR                                 01470000
015000                                                                  01500000
015100     PERFORM 2100-PROCESS-SHPMT                                   01510000
015200       UNTIL PS-END-OF-SHPMT-CSR-YES.                             01520000
015300                                                                  01530000
015400     PERFORM 8050-CLOSE-SHPMT-CSR.                                01540000
015500                                                                  01550000
015600     PERFORM 8010-FETCH-TRIP-CSR.                                 01560000
015700                                                                  01570000
015800                                                                  01580000
015900***********************************************************       01590000
016000*                                                         *       01600000
016100***********************************************************       01610000
016110 2100-PROCESS-SHPMT.                                              01611000
016111                                                                  01611100
016112     PERFORM 3100-WRITE-SHPMT-RECORD.                             01611200
016113                                                                  01611300
016114     PERFORM 8040-FETCH-SHPMT-CSR.                                01611400
016115                                                                  01611500
016116                                                                  01611600
016117***********************************************************       01611700
016118*                                                         *       01611800
016119***********************************************************       01611900
016120 3000-WRITE-TRIP-RECORD.                                          01612000
016130                                                                  01613000
016140     INITIALIZE  TR074-RECORD.                                    01614001
016150     MOVE VHTRIP-OWNER-SCAC-ID     TO TR074-OWNER-SCAC-ID.        01615001
016160     MOVE VHTRIP-VEH-NBR           TO TR074-VEH-NBR.              01616001
016170     MOVE VHTRIP-TRIP-ID           TO TR074-TRIP-ID.              01617001
016180     MOVE TRIPST-TRIP-STATUS-CDE   TO TR074-TRIP-STATUS-CDE.      01618001
016190     MOVE TRIPST-STATUS-DTE        TO TR074-TRIP-STATUS-DTE.      01619001
016200     MOVE TRIPST-STATUS-TME        TO TR074-TRIP-STATUS-TME.      01620001
016300     MOVE TRIPST-STATUS-UID        TO TR074-TRIP-STATUS-UID.      01630001
016400     MOVE TRIPST-OPER-UNT-ID       TO TR074-OPER-UNT-ID.          01640001
016500     MOVE TRIPST-FCLTY-ID          TO TR074-FCLTY-ID.             01650001
016600     MOVE VEHICL-CURR-STATUS-CDE   TO TR074-VEH-STATUS-CDE.       01660001
016700     MOVE VEHICL-CURR-TRIP-ID      TO TR074-VEH-TRIP-ID.          01670001
016800                                                                  01680000
016900     MOVE PV-NEW-STATUS-DTE        TO TR074-NEW-STATUS-DTE.       01690001
017000                                                                  01700000
017100     WRITE TRIP-RECORD                                            01710000
017200      FROM TR074-RECORD.                                          01720001
017300                                                                  01730000
017400     MOVE  TR074-OPER-UNT-ID TO PV-DISP-OPER.                     01740001
017500     MOVE  TR074-TRIP-ID     TO PV-DISP-TRIP.                     01750001
017600                                                                  01760000
017700     DISPLAY 'OPER: '           PV-DISP-OPER                      01770000
017800             '  TRIP: '         PV-DISP-TRIP                      01780000
017900             '   '              TR074-OWNER-SCAC-ID               01790001
018000             '/'                TR074-VEH-NBR                     01800001
018100             '  ST: '           TR074-TRIP-STATUS-CDE             01810001
018200             '  '               TR074-TRIP-STATUS-DTE             01820001
018300             ' @ '              TR074-TRIP-STATUS-TME             01830001
018400             '  '               TR074-TRIP-STATUS-UID             01840001
018500             '  NEW DTE:'       TR074-NEW-STATUS-DTE.             01850001
018600                                                                  01860000
018700     ADD +1                      TO PV-TRIP-COUNT.                01870000
018800                                                                  01880000
018900                                                                  01890000
019000***********************************************************       01900000
019100*                                                         *       01910000
019200***********************************************************       01920000
019300 3100-WRITE-SHPMT-RECORD.                                         01930000
019400                                                                  01940000
019500     INITIALIZE  TR075-RECORD.                                    01950001
019600     MOVE SHIPMT-TRIP-ID           TO TR075-TRIP-ID.              01960001
019700     MOVE SHIPMT-SHIPT-ID          TO TR075-SHIPT-ID.             01970001
019800     MOVE SHIPST-SHIPT-STATUS-CDE  TO TR075-SHIPT-STATUS-CDE.     01980001
019900     MOVE SHIPST-STATUS-DTE        TO TR075-STATUS-DTE.           01990001
020000     MOVE SHIPST-STATUS-TME        TO TR075-STATUS-TME.           02000001
020100                                                                  02010000
020200     MOVE PV-NEW-STATUS-DTE        TO TR075-NEW-STATUS-DTE.       02020001
020300                                                                  02030000
020400     WRITE SHPMT-RECORD                                           02040000
020500      FROM TR075-RECORD.                                          02050001
020600                                                                  02060000
020700     ADD +1                      TO PV-SHPMT-COUNT.               02070000
020800                                                                  02080000
020900                                                                  02090000
021000***********************************************************       02100000
021100*                                                         *       02110000
021200***********************************************************       02120000
021300 8000-OPEN-TRIP-CSR.                                              02130000
021400                                                                  02140000
021500     EXEC SQL                                                     02150000
021600        OPEN TRIP_CSR                                             02160000
021700     END-EXEC.                                                    02170000
021800                                                                  02180000
021900     EVALUATE TRUE                                                02190000
022000         WHEN SQLCODE = ZERO                                      02200000
022100             CONTINUE                                             02210000
022200         WHEN OTHER                                               02220000
022300             MOVE '8000-OPEN-TRIP-CSR'                            02230000
022400                                       TO PV-ABEND-PARAGRAPH      02240000
022500             MOVE 'OPEN TRIP CURSOR'   TO PV-ABEND-OPERATION      02250000
022600             PERFORM 9900-DB2-ABEND                               02260000
022700     END-EVALUATE.                                                02270000
022800                                                                  02280000
022900                                                                  02290000
023000***********************************************************       02300000
023100*                                                         *       02310000
023200***********************************************************       02320000
023300 8010-FETCH-TRIP-CSR.                                             02330000
023400                                                                  02340000
023500     EXEC SQL                                                     02350000
023600        FETCH TRIP_CSR                                            02360000
023700        INTO :VHTRIP-OWNER-SCAC-ID                                02370000
023800           , :VHTRIP-VEH-NBR                                      02380000
023900           , :VHTRIP-TRIP-ID                                      02390000
024000           , :TRIPST-TRIP-STATUS-CDE                              02400000
024100           , :TRIPST-OPER-UNT-ID                                  02410000
024200           , :TRIPST-STATUS-DTE                                   02420000
024300           , :TRIPST-STATUS-TME                                   02430000
024400           , :TRIPST-STATUS-UID                                   02440000
024700           , :PV-NEW-STATUS-DTE                                   02470000
024800     END-EXEC.                                                    02480000
024900                                                                  02490000
025000     EVALUATE TRUE                                                02500000
025100         WHEN SQLCODE = ZERO                                      02510000
025800                                                                  02580000
025900             MOVE SPACES  TO  VEHICL-CURR-STATUS-CDE              02590000
026000             MOVE ZEROES  TO  VEHICL-CURR-TRIP-ID                 02600000
026100                                                                  02610000
026200         WHEN SQLCODE = +100                                      02620000
026300             SET  PS-END-OF-TRIP-CSR-YES  TO TRUE                 02630000
026400         WHEN OTHER                                               02640000
026500             MOVE '8010-FETCH-TRIP-CSR'                           02650000
026600                                       TO PV-ABEND-PARAGRAPH      02660000
026700             MOVE 'FETCH TRIP CSR'     TO PV-ABEND-OPERATION      02670000
026800             PERFORM 9900-DB2-ABEND                               02680000
026900     END-EVALUATE.                                                02690000
027000                                                                  02700000
027100                                                                  02710000
027200***********************************************************       02720000
027300*                                                         *       02730000
027400***********************************************************       02740000
027500 8020-CLOSE-TRIP-CSR.                                             02750000
027600                                                                  02760000
027700     EXEC SQL                                                     02770000
027800        CLOSE TRIP_CSR                                            02780000
027900     END-EXEC.                                                    02790000
028000                                                                  02800000
028100     EVALUATE TRUE                                                02810000
028200         WHEN SQLCODE = ZERO                                      02820000
028300             CONTINUE                                             02830000
028400         WHEN OTHER                                               02840000
028410             MOVE '8020-CLOSE-TRIP-CSR'                           02841000
028411                                       TO PV-ABEND-PARAGRAPH      02841100
028412             MOVE 'CLOSE TRIP CSR'     TO PV-ABEND-OPERATION      02841200
028413             PERFORM 9900-DB2-ABEND                               02841300
028414     END-EVALUATE.                                                02841400
028415                                                                  02841500
028416                                                                  02841600
028417***********************************************************       02841700
028418*                                                         *       02841800
028419***********************************************************       02841900
028420 8030-OPEN-SHPMT-CSR.                                             02842000
028421                                                                  02842100
028422     EXEC SQL                                                     02842200
028423        OPEN SHPMT_CSR                                            02842300
028424     END-EXEC.                                                    02842400
028425                                                                  02842500
028426     EVALUATE TRUE                                                02842600
028427         WHEN SQLCODE = ZERO                                      02842700
028428             CONTINUE                                             02842800
028429         WHEN OTHER                                               02842900
028430             MOVE '8030-OPEN-SHPMT-CSR'                           02843000
028431                                       TO PV-ABEND-PARAGRAPH      02843100
028432             MOVE 'OPEN TRIP CURSOR'   TO PV-ABEND-OPERATION      02843200
028433             PERFORM 9900-DB2-ABEND                               02843300
028434     END-EVALUATE.                                                02843400
028435                                                                  02843500
028436                                                                  02843600
028437***********************************************************       02843700
028438*                                                         *       02843800
028439***********************************************************       02843900
028440 8040-FETCH-SHPMT-CSR.                                            02844000
028450                                                                  02845000
028451     EXEC SQL                                                     02845100
028452        FETCH SHPMT_CSR                                           02845200
028453        INTO :SHIPMT-TRIP-ID                                      02845300
028454           , :SHIPMT-SHIPT-ID                                     02845400
028455           , :SHIPST-SHIPT-STATUS-CDE                             02845500
028456           , :SHIPST-STATUS-DTE                                   02845600
028457           , :SHIPST-STATUS-TME                                   02845700
028458           , :PV-NEW-STATUS-DTE                                   02845800
028459     END-EXEC.                                                    02845900
028460                                                                  02846000
028461     EVALUATE TRUE                                                02846100
028462         WHEN SQLCODE = ZERO                                      02846200
028463             CONTINUE                                             02846300
028464         WHEN SQLCODE = +100                                      02846400
028465             SET  PS-END-OF-SHPMT-CSR-YES  TO TRUE                02846500
028466         WHEN OTHER                                               02846600
028467             MOVE '8040-FETCH-SHPMT-CSR'                          02846700
028468                                       TO PV-ABEND-PARAGRAPH      02846800
028469             MOVE 'FETCH SHPMT CSR'    TO PV-ABEND-OPERATION      02846900
028470             PERFORM 9900-DB2-ABEND                               02847000
028471     END-EVALUATE.                                                02847100
028472                                                                  02847200
028473                                                                  02847300
028474***********************************************************       02847400
028475*                                                         *       02847500
028476***********************************************************       02847600
028477 8050-CLOSE-SHPMT-CSR.                                            02847700
028478                                                                  02847800
028479     EXEC SQL                                                     02847900
028480        CLOSE SHPMT_CSR                                           02848000
028481     END-EXEC.                                                    02848100
028482                                                                  02848200
028483     EVALUATE TRUE                                                02848300
028484         WHEN SQLCODE = ZERO                                      02848400
028485             CONTINUE                                             02848500
028486         WHEN OTHER                                               02848600
028487             MOVE '8050-CLOSE-TRIP-CSR'                           02848700
028488                                       TO PV-ABEND-PARAGRAPH      02848800
028489             MOVE 'CLOSE SHPMT CSR'    TO PV-ABEND-OPERATION      02848900
028490             PERFORM 9900-DB2-ABEND                               02849000
028491     END-EVALUATE.                                                02849100
028492                                                                  02849200
028493                                                                  02849300
028494                                                                  02849400
028495                                                                  02849500
028496***********************************************************       02849600
028497*                                                         *       02849700
028498***********************************************************       02849800
028499 9900-DB2-ABEND.                                                  02849900
028500                                                                  02850000
028600     MOVE SQLCODE TO PV-SQLCODE.                                  02860000
028700     DISPLAY '*** DB2 ERROR '.                                    02870000
028800     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       02880000
028900     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 02890000
029000     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               02900000
029100     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               02910000
029200     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       02920000
029300     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       02930000
029400     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       02940000
029500                                                                  02950000
029510     COPY DPPD004.                                                02951000
029520                                                                  02952000
029530     IF SQLCODE NOT = -911                                        02953000
029540         EXEC SQL                                                 02954000
029550              ROLLBACK                                            02955000
029560         END-EXEC                                                 02956000
029570     END-IF.                                                      02957000
029580                                                                  02958000
029590     MOVE +4013                  TO PV-ABEND-CODE.                02959000
029600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02960000
029700                                                                  02970000
