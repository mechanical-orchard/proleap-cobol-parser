000100 IDENTIFICATION DIVISION.                                                 
000200 PROGRAM-ID.     APKUP076.                                                
000300 AUTHOR.         CAROLYN GIFFORD.                                    LV004
000400*DATE-WRITTEN.   JUNE 16, 1998.                                      CL**1
000500*DATE-COMPILED.                                                      CL**1
000600*************************************************************        CL**1
000800*    UPDATE PERIOD CONTROL DATES ON TAPCNTL                 *        CL**1
000801*                                                           *        CL**1
000802*    COBOL 2  WITH SQL                                      *        CL**1
000803*                                                           *        CL**1
000900*    UPDATE BATCH CONTROL TABLE. SET PREVIOUS WEEK END DATE *        CL**1
000910*    TO CURRENT WEEK END DATE AND SET CURRENT WEEK END DATE *        CL**1
001000*    TO CURRENT WEEK END DATE PLUS 7 DAYS.                  *        CL**1
001010*                                                           *        CL**1
001100*************************************************************        CL**1
001200*                                                           *        CL**1
001300*    TAPCNTL - AP BATCH CONTROL TABLE.                      *        CL**1
001400*                                                           *        CL**1
001500*************************************************************        CL**1
001600* CHANGE LOG:                                               *        CL**1
001700*                                                           *        CL**1
001800* 06/16/98     INITIAL VERSION.         WR#4164             *        CL**1
001900*                                                           *        CL**1
002900*   /  /   - DESCR                                          *     00290052
003200*        BY:                                        WR#     *     00300003
003300*                                                           *             
003301*************************************************************        CL**1
003302                                                                     CL**1
003303 ENVIRONMENT DIVISION.                                               CL**1
003304                                                                     CL**1
003305 INPUT-OUTPUT SECTION.                                               CL**1
003306                                                                     CL**1
003400 DATA DIVISION.                                                      CL**1
003500                                                                     CL**1
003600 FILE SECTION.                                                       CL**1
003700                                                                     CL**1
003800/                                                                    CL**1
003900 WORKING-STORAGE SECTION.                                            CL**1
004000                                                                     CL**1
004100 01  FILLER                        PIC X(25) VALUE                   CL**1
004200                             'WS FOR APKUP076 BEGINS==>'.            CL**1
004300 01  ABEND-CODE                    PIC S9(4) COMP SYNC               CL**1
004400                                             VALUE ZEROS.            CL**1
004500     88 AP-DB2-ERROR               VALUE +4013.                      CL**1
004600                                                                     CL**1
004700 01  PV-ABEND-FILEDS.                                                CL**1
004800     05  PV-ABEND-PROGRAM             PIC X(8)  VALUE 'APKUP076'.    CL**1
004900     05  PV-ABEND-SQLCODE             PIC X(4)  VALUE SPACES.        CL**1
005000     05  PV-ABEND-PARAGRAPH           PIC X(50) VALUE SPACES.        CL**1
005100     05  PV-ABEND-OPERATION           PIC X(50) VALUE SPACES.        CL**1
005200     05  PV-ABEND-STRUCTURE-1         PIC X(8)  VALUE SPACES.        CL**1
005400     05  PV-ABEND-STATUS              PIC XX    VALUE SPACES.        CL**1
005500                                                                     CL**1
005600 01  PV-WORK-AREA.                                                   CL**1
005700     05  PV-PROGRAM-NAME         PIC X(08)     VALUE 'APKUP076'.     CL**1
005800                                                                     CL**1
006500 01  PREV-WEEK-END-DATE.                                             CL**1
006600     05  PREV-WEEK-END-DATE-YYYY      PIC X(04) VALUE SPACES.        CL**1
006700     05  FILLER                       PIC X(01) VALUE '-'.           CL**1
006800     05  PREV-WEEK-END-DATE-MM        PIC X(02) VALUE SPACES.        CL**1
006900     05  FILLER                       PIC X(01) VALUE '-'.           CL**1
007000     05  PREV-WEEK-END-DATE-DD        PIC X(02) VALUE SPACES.        CL**1
007001                                                                          
007002 01  CURR-WEEK-END-DATE.                                             CL**1
007003     05  CURR-WEEK-END-DATE-YYYY      PIC X(04) VALUE SPACES.        CL**1
007004     05  FILLER                       PIC X(01) VALUE '-'.           CL**1
007005     05  CURR-WEEK-END-DATE-MM        PIC X(02) VALUE SPACES.        CL**1
007006     05  FILLER                       PIC X(01) VALUE '-'.           CL**1
007007     05  CURR-WEEK-END-DATE-DD        PIC X(02) VALUE SPACES.        CL**1
007008                                                                     CL**1
007300 01  RUN-TIME.                                                       CL**1
007400     05  R-HR                    PIC 99.                             CL**1
007500     05  R-MIN                   PIC 99.                             CL**1
007600     05  R-SEC                   PIC 99.                             CL**1
007700     05  R-TH                    PIC 99.                             CL**1
007800*                                                                    CL**1
007900 01  DATE-IN.                                                        CL**1
008000     05 DATE-IN-YY               PIC XX.                             CL**1
008100     05 DATE-IN-MM               PIC XX.                             CL**1
008200     05 DATE-IN-DD               PIC XX.                             CL**1
008300                                                                          
008400     EJECT                                                                
008700                                                                          
008800 01  FILLER                      PIC X(35)  VALUE                    CL**1
008900     'END OF AP WORK RECORD AREA       **'.                          CL**1
009000                                                                     CL**1
009100     COPY DPWS004.                                                   CL**1
009200                                                                     CL**1
009300******************************************************************   CL**1
009400*  COMMUNICATIONS AREA2 FOR DB2                                      CL**1
009500******************************************************************   CL**1
009600     COPY SQLCA2.                                                    CL**1
009700                                                                     CL**1
009800                                                                     CL**1
009900     EXEC SQL                                                        CL**1
010000          INCLUDE SQLCA                                              CL**1
010100     END-EXEC.                                                       CL**1
010200                                                                     CL**1
010300                                                                     CL**1
010400     EXEC SQL                                                        CL**1
010500          INCLUDE TAPCNTL                                            CL**1
010600     END-EXEC.                                                       CL**1
010700                                                                     CL**1
010800 01  FILLER                        PIC X(25) VALUE                   CL**1
010900          '<====WS FOR APKUP076 ENDS'.                               CL**1
011000                                                                     CL**1
011400 PROCEDURE DIVISION.                                                 CL**1
011500                                                                     CL**1
011600 A100-MAINLINE.                                                      CL**1
011700                                                                     CL**1
011800     PERFORM B100-HOUSEKEEPING.                                      CL**1
011900     PERFORM B200-UPDATE-CONTROL.                                         
012000                                                                     CL**1
012100     PERFORM B300-END-OF-JOB.                                        CL**1
012200                                                                     CL**1
012300     GOBACK.                                                         CL**1
012400        EJECT                                                        CL**1
012500                                                                     CL**1
020700 B100-HOUSEKEEPING.                                                  CL**1
020800*                                                                    CL**1
020900*****************************************************************    CL**1
021000*    GET DATE AND TIME FROM JOB *                                    CL**1
021100*****************************************************************    CL**1
021200*                                                                    CL**1
021300     ACCEPT RUN-TIME FROM TIME.                                      CL**1
021400     ACCEPT DATE-IN  FROM DATE.                                      CL**1
021600                                                                     CL**1
021700     DISPLAY ' RUN-DATE = ' DATE-IN '   RUN-TIME = ' RUN-TIME.       CL**1
021800                                                                     CL**1
021900     INITIALIZE DCLTAPCNTL.                                          CL**1
021901                                                                          
021902 B200-UPDATE-CONTROL.                                                CL**1
021903*                                                                    CL**1
021904*****************************************************************    CL**1
021905*     UPDATE THE PREVIOUS WEEK END DATE AND CURRENT WEEK END DATE    CL**1
021906*****************************************************************    CL**1
021907*                                                                    CL**1
021908     EXEC SQL                                                             
021909         UPDATE TAPCNTL                                                   
021910         SET PREV_WK_END_DTE = CURR_WK_END_DTE                            
021911           , CURR_WK_END_DTE = (CURR_WK_END_DTE + 7 DAYS)                 
021912     END-EXEC.                                                            
021913                                                                          
021914     EVALUATE TRUE                                                        
021915         WHEN SQLCODE = ZERO                                              
021916              CONTINUE                                                    
021917                                                                          
021918         WHEN SQLWARN0 NOT = SPACES                                       
021919         WHEN SQLCODE  NOT = ZERO                                         
021920              MOVE 'B200-UPDATE-CONTROL '                                 
021921                              TO PV-ABEND-PARAGRAPH                       
021922              MOVE 'UNSUCCESSFUL UPDATE PREVIOUS DATE ROW'                
021923                              TO PV-ABEND-OPERATION                       
021924              MOVE 'TAPCNTL ' TO PV-ABEND-STRUCTURE-1                     
021925              PERFORM Z999-SQL-ERROR                                      
021926     END-EVALUATE.                                                        
021927                                                                     CL**1
021928     EVALUATE TRUE                                                   CL**1
021929        WHEN SQLCODE = ZEROS                                         CL**1
021930             CONTINUE                                                CL**1
021931        WHEN OTHER                                                   CL**1
021932             MOVE 'B200-UPDATE-CONTROL           ' TO                CL**1
021933                                       PV-ABEND-PARAGRAPH            CL**1
021934             MOVE 'UNSUCCESSFUL UPDATE PREVIOUS DATE ROW'            CL**1
021935                             TO PV-ABEND-OPERATION                   CL**1
021936             MOVE 'TAPCNTL ' TO PV-ABEND-STRUCTURE-1                 CL**1
021937             PERFORM Z999-SQL-ERROR                                  CL**1
021938     END-EVALUATE.                                                   CL**1
021939                                                                          
022100 B300-END-OF-JOB.                                                    CL**1
022200*                                                                    CL**1
022300*****************************************************************    CL**1
022400*     END JOB                                                           *1
022500*****************************************************************    CL**1
022600*                                                                    CL**1
023000     DISPLAY '** PROGRAM APKUP076 ENDS NORMALLY **'.                      
023100                                                                     CL**1
023900                                                                          
024000 Z999-SQL-ERROR.                                                     CL**1
024100*                                                                    CL**1
024200*****************************************************************    CL**1
024300*     PROCESS DB2 ABENDS                                             CL**1
024400*****************************************************************    CL**1
024500*                                                                    CL**1
024600     DISPLAY '*** DB2 ERROR '.                                       CL**1
024700     DISPLAY '*** SQL CODE = '  PV-ABEND-SQLCODE.                    CL**1
024800     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                    CL**1
024900     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.                  CL**1
025000     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.                  CL**1
025100     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.                CL**1
025400                                                                     CL**1
025500     COPY DPPD004.                                                   CL**1
025600                                                                     CL**1
025700     MOVE +4013                    TO ABEND-CODE.                    CL**1
025800                                                                     CL**1
025900     CALL 'ILBOABN0' USING ABEND-CODE.                               CL**1
