000100 IDENTIFICATION DIVISION.                                         00010049
000200 PROGRAM-ID.         PCKUT071.                                    00020049
000300 AUTHOR.             JEAN KURKOWSKI.                              00030049
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040049
000500 DATE-WRITTEN.       JULY 2007.                                   00050049
000600                                                                  00060049
000700****************************************************************  00070049
000800* I M P O R T A N T --- WHEN COMPILING THIS PROGRAM THE MQ SERIES 00080049
000900* SWITCH ON THE 2ND COMPILE SCREEN NEEDS TO BE SET TO 'Y'.        00090049
001000* THIS PROGRAM USES MQSERIES.                                     00100049
001100****************************************************************  00110049
001200*            XML - LABOR DATA - PACK TO LIGHT                     00120049
001300*                                                                 00130050
001400* THIS PROGRAM WILL GET MESSAGES FROMT THE DC UPLOAD QUEUE        00140050
001500* (PC.DC.PCCP2L.UPLOADS.Q) AND FORMAT THE DATA AND THEN CALL      00150050
001600* THE APPROPRIATE MODULE TO PROCESS THE DATA.                     00160050
001700*                                                                 00170050
001800****************************************************************  00180050
001900 ENVIRONMENT DIVISION.                                            00190050
002000****************************************************************  00200050
002100 CONFIGURATION SECTION.                                           00210050
002200 SOURCE-COMPUTER.        IBM-3090.                                00220050
002300 OBJECT-COMPUTER.        IBM-3090.                                00230050
002400 INPUT-OUTPUT SECTION.                                            00240050
002500                                                                  00250050
002600 FILE-CONTROL.                                                    00260050
002700****************************************************************  00270050
002800 DATA DIVISION.                                                   00280050
002900****************************************************************  00290050
003000 FILE SECTION.                                                    00300050
003100                                                                  00310050
003200 WORKING-STORAGE SECTION.                                         00320050
003300******************************************************************00330050
003400  01  PV-ABEND-CODE                  PIC S9(04) VALUE ZERO        00340050
003500                                                COMP SYNC.        00350050
003600******************************************************************00360050
003700*    PROGRAM CONSTANTS                                            00370050
003800******************************************************************00380050
003900 01  PC-PROGRAM-CONSTANTS.                                        00390050
004000     05  PC-PGM-NAME                 PIC X(08) VALUE 'PCKUT071'.  00400050
004100     05  PC-PGM-PCKMD                PIC X(08) VALUE 'PCKUT072'.  00410049
004200     05  PC-PGM-INBLN                PIC X(08) VALUE 'PCKUT073'.  00420050
004300     05  PC-PGM-BXOPN                PIC X(08) VALUE 'PCKUT074'.  00430049
004400     05  PC-PGM-BXCLS                PIC X(08) VALUE 'PCKUT075'.  00440049
004500     05  PC-END-RUN-MSG              PIC  X(30) VALUE             00450049
004600                            'STOP PROCESSING P2L LABOR DATA'.     00460049
004700******************************************************************00470049
004800*    PROGRAM VARIABLES                                            00480049
004900******************************************************************00490049
005000 01  PV-PROGRAM-VARIABLES.                                        00500049
005100     05  PV-CALLED-PROGRAM        PIC X(08) VALUE SPACES.         00510057
005200     05  PV-CURRENT-TMST          PIC X(26) VALUE SPACES.         00520057
005300     05  PV-CURRENT-ELEMENT       PIC X(30) VALUE SPACES.         00530057
005400     05  PV-CURRENT-ATTRIBUTE     PIC X(30) VALUE SPACES.         00540057
005500     05  PV-PARAGRAPH             PIC X(30) VALUE SPACE.          00550049
005600     05  PV-SQLCODE               PIC -999.                       00560049
005700     05  PV-ERR-CDE               PIC X(03).                      00570049
005800     05  PV-DISP-OPER             PIC X(04).                      00580057
005900     05  PV-DISP-SQLCODE          PIC -999.                       00590057
006000     05  PV-DISPLAY-NBR           PIC ZZZ,ZZZ,ZZ9.                00600055
006100     05  PV-DISPLAY-NBR2          PIC Z,ZZ9.                      00610049
006200     05  PV-DC-NBR                PIC S9(04) COMP.                00620049
006300     05  PV-QUEUE-MANAGER         PIC  X(20).                     00630049
006400     05  PV-SERVER-NAME           PIC  X(20).                     00640049
006500     05  PV-CRA-RET-MSG           PIC  X(25).                     00650063
006600     05  PV-CRA-RET-CDE           PIC  X(02) VALUE '00'.          00660063
006700         88 PV-SUCCESSFUL                    VALUE '00'.          00670049
006800         88 PV-ERROR                         VALUE '01'.          00680049
006900         88 PV-SQL-ERROR                     VALUE '02'.          00690049
007000         88 PV-INVALID-DATA                  VALUE '03'.          00700049
007010         88 PV-UNKNOWN-USER                  VALUE '04'.          00701079
007020                                                                  00702096
007100     05  PV-DATE-TIME             PIC  X(22) JUST RIGHT.          00710096
007101     05  PV-DATE-TIME-R REDEFINES PV-DATE-TIME.                   00710196
007102         10  PV-PICK-DATE         PIC X(10).                      00710296
007103         10  FILLER               PIC X(01).                      00710396
007104         10  PV-PICK-TIME         PIC X(08).                      00710496
007105         10  PV-DATE-TIME-SPACE   PIC X(01).                      00710599
007106         10  PV-PICK-AM-PM        PIC X(02).                      00710696
007107     05  PV-DATE-TIME-R2 REDEFINES PV-DATE-TIME.                  00710797
007108         10  PV-PICK-MONTH1       PIC X(01).                      00710897
007109         10  PV-PICK-MONTH1-REM   PIC X(21).                      00710999
007113     05  PV-DATE-TIME-R4 REDEFINES PV-DATE-TIME.                  00711399
007114         10  PV-PICK-MONTH2       PIC X(02).                      00711499
007115         10  FILLER               PIC X(20).                      00711599
007116                                                                  00711699
007117     05  PV-DATE-TIME-R5 REDEFINES PV-DATE-TIME.                  00711799
007118         10  PV-PICK-MONTH-R5     PIC X(02).                      00711899
007119         10  PV-PICK-DAY-R5       PIC X(03).                      00711999
007120         10  PV-PICK-DATE-R5-REM  PIC X(16).                      00712099
007121         10  FILLER               PIC X(01).                      00712199
007122                                                                  00712299
007123     05  PV-DATE-TIME-R6 REDEFINES PV-DATE-TIME.                  00712399
007124         10  PV-PICK-DATE-R6       PIC X(10).                     00712499
007125         10  FILLER                PIC X(01).                     00712599
007126         10  PV-PICK-TIME-R6       PIC X(08).                     00712699
007127         10  PV-DATE-TIME-SPACE-R6 PIC X(01).                     00712799
007128         10  PV-PICK-AM-PM-R6      PIC X(02).                     00712899
007129                                                                  00712999
007130     05  PV-DATE-TIME-WK.                                         00713099
007131         10  PV-PICK-MONTH-WK     PIC X(02).                      00713199
007132         10  PV-PICK-DAY-WK       PIC X(04).                      00713299
007133         10  PV-PICK-DATE-WK-REM  PIC X(16).                      00713399
007134                                                                  00713499
007135     05  PV-DATE-TIME-WORK.                                       00713599
007136         10  PV-PICK-MONTH-SEPT   PIC X(21).                      00713699
007137         10  FILLER               PIC X(01).                      00713799
007138                                                                  00713899
007139     05  PV-QTY                   PIC  X(05) JUST RIGHT.          00713999
007140     05  PV-QTY-R REDEFINES PV-QTY.                               00714099
007141         10  PV-QTY-1             PIC  X(01).                     00714199
007142         10  PV-QTY-2             PIC  X(01).                     00714299
007143         10  PV-QTY-3             PIC  X(01).                     00714390
007150         10  PV-QTY-4             PIC  X(01).                     00715090
007160         10  PV-QTY-5             PIC  X(01).                     00716090
007200     05  PV-QTY-NUM       REDEFINES PV-QTY PIC 9(05).             00720049
007300     05  PV-IND                   PIC  X(01) JUST RIGHT.          00730049
007400     05  PV-IND-NUM       REDEFINES PV-IND PIC 9(01).             00740049
007500     05  PV-UNKNOWN-MSG           PIC X(100).                     00750055
007600                                                                  00760049
007610     05  PV-EVENT-DATE-TIME             PIC  X(19) JUST RIGHT.    00761099
007620     05  PV-EVENT-DATE-TIME-R REDEFINES PV-EVENT-DATE-TIME.       00762099
007630         10  PV-EVENT-DATE.                                       00763099
007631             15 PV-EVENT-YMD-YEAR       PIC X(04).                00763199
007632             15 FILLER                  PIC X(01).                00763299
007633             15 PV-EVENT-YMD-MONTH      PIC X(02).                00763399
007634             15 FILLER                  PIC X(01).                00763499
007635             15 PV-EVENT-YMD-DAY        PIC X(02).                00763599
007640         10  FILLER                     PIC X(01).                00764099
007650         10  PV-EVENT-TIME.                                       00765099
007660             15 PV-EVENT-24-HOUR        PIC 9(02).                00766099
007670             15 FILLER                  PIC X(01).                00767099
007680             15 PV-EVENT-24-MIN         PIC 9(02).                00768099
007690             15 FILLER                  PIC X(01).                00769099
007691             15 PV-EVENT-24-SEC         PIC 9(02).                00769199
007695                                                                  00769599
007720     05  PV-EVENT-DATE-MDY.                                       00772099
007721             15 PV-EVENT-MDY-MONTH      PIC X(02).                00772199
007722             15 PV-MDY-DASH-1           PIC X(01).                00772299
007723             15 PV-EVENT-MDY-DAY        PIC X(02).                00772399
007724             15 PV-MDY-DASH-2           PIC X(01).                00772499
007725             15 PV-EVENT-MDY-YEAR       PIC X(04).                00772599
007726         10  FILLER                     PIC X(01).                00772699
007727     05  PV-EVENT-TIME-12-HOUR.                                   00772799
007728             15 PV-EVENT-12-HOUR        PIC 9(02).                00772899
007729             15 PV-12-HR-COLON-1        PIC X(01).                00772999
007730             15 PV-EVENT-12-MIN         PIC 9(02).                00773099
007731             15 PV-12-HR-COLON-2        PIC X(01).                00773199
007732             15 PV-EVENT-12-SEC         PIC 9(02).                00773299
007733             15 FILLER                  PIC X(01).                00773399
007734             15 PV-EVENT-12-AMPM        PIC X(02).                00773499
007735                                                                  00773599
007736     05  PV-PICKER-NAME                 PIC  X(08)  VALUE SPACES. 00773699
007737     05  PV-PICKER-BARCODE              PIC  X(08)  VALUE SPACES. 00773799
007738     05  PV-UPDATE-MSG                  PIC  X(100) VALUE SPACES. 00773899
007739                                                                  00773999
007740                                                                  00774099
007750******************************************************************00775099
007800*    PROGRAM ACCUMULATORS                                         00780049
007900******************************************************************00790049
008000 01  PA-PROGRAM-ACCUMULATORS.                                     00800049
008100     05  PA-MQ-MSGS-READ           PIC  S9(09)  VALUE +0 COMP-3.  00810049
008200     05  PA-ERRORS-PROCESSED       PIC  S9(09)  VALUE +0 COMP-3.  00820049
008300     05  PA-UPDATES-PROCESSED      PIC  S9(09)  VALUE +0 COMP-3.  00830049
008301     05  PA-PICKMADE-COUNT         PIC  S9(09)  VALUE +0 COMP-3.  00830183
008302     05  PA-LAUNCH-COUNT           PIC  S9(09)  VALUE +0 COMP-3.  00830283
008303     05  PA-BOXOPEN-COUNT          PIC  S9(09)  VALUE +0 COMP-3.  00830383
008304     05  PA-BOXCLOSE-COUNT         PIC  S9(09)  VALUE +0 COMP-3.  00830483
008305     05  PA-UNKNOWN-MSG-CNT        PIC  S9(09)  VALUE +0 COMP-3.  00830583
008306     05  PA-BAD-PICKMADE-COUNT     PIC  S9(09)  VALUE +0 COMP-3.  00830683
008307     05  PA-BAD-LAUNCH-COUNT       PIC  S9(09)  VALUE +0 COMP-3.  00830783
008308     05  PA-BAD-BOXOPEN-COUNT      PIC  S9(09)  VALUE +0 COMP-3.  00830883
008309     05  PA-BAD-BOXCLOSE-COUNT     PIC  S9(09)  VALUE +0 COMP-3.  00830983
008310     05  PA-BAD-UNKNOWN-MSG-CNT    PIC  S9(09)  VALUE +0 COMP-3.  00831083
008311     05  PA-CONSECUTIVE-ERRORS     PIC   9(09)  VALUE ZERO.       00831175
008312     05  PA-CAPTURE-COUNT          PIC   9(09)  VALUE ZERO.       00831284
008320     05  PA-PICK-BAD-USERID        PIC   9(09)  VALUE ZERO.       00832099
008400     05  PA-MQ-COMMITS             PIC  S9(09)  VALUE +0 COMP-3.  00840049
008500     05  PA-XML-PARSED             PIC  S9(09)  VALUE +0 COMP-3.  00850049
008600     05  PA-END-RUN-MSG-CNT        PIC  S9(09)  VALUE +0 COMP-3.  00860049
008700******************************************************************00870049
008800*    PROGRAM VARIABLES FOR QUEUE MANAGER AND QUEUE NAMES.         00880049
008900******************************************************************00890049
009000 01  PV-Q-MANAGER-VARIABLES.                                      00900049
009100     05  PV-QMGR-NAME                 PIC X(48).                  00910049
009200     05  PV-QUE-NAME                  PIC X(48).                  00920049
009300     05  PV-HANDLE                    PIC S9(9) BINARY VALUE 0.   00930049
009400     05  PV-QMGR-NAME-ERROR           PIC X(48).                  00940049
009500     05  PV-QUE-NAME-ERROR            PIC X(48).                  00950049
009600     05  PV-HANDLE-ERROR              PIC S9(9) BINARY VALUE 0.   00960049
009700     05  PV-HCONN                PIC S9(9) BINARY VALUE 0.        00970049
009800     05  PV-OPEN-OPTIONS         PIC S9(9) BINARY.                00980049
009900     05  PV-COMPLETION-CODE      PIC S9(9) BINARY.                00990049
010000     05  PV-REASON               PIC S9(9) BINARY.                01000049
010100     05  PV-ERROR-MESSAGE        PIC X(48) VALUE SPACES.          01010049
010200     05  PV-CON-REASON           PIC S9(9) BINARY.                01020049
010300     05  PV-MSGBUFFER            PIC X(32432) VALUE SPACES.       01030049
010400     05  PV-ERRMSGBUFFER         PIC X(630) VALUE SPACES.         01040049
010500     05  PV-MSG-LENGTH           PIC S9(9) BINARY VALUE 1000.     01050049
010600     05  PV-DATA-LENGTH          PIC S9(9) BINARY.                01060049
010700     05  PV-ACTION               PIC X(60) VALUE SPACES.          01070049
010800     05  PV-MQCHECK              PIC X(8)  VALUE 'MQR2C'.         01080049
010900     05  PV-MQ-REASON-TEXT       PIC X(30) VALUE SPACES.          01090049
011000     05  PV-DISPLAY-CDE          PIC -Z(8)9.                      01100049
011100     05  PV-REASON-CDE           PIC -Z(8)9.                      01110049
011200                                                                  01120049
011300*PV-MSG IS THE INPUT MESSAGE                                      01130049
011400 01  PV-MSG                      PIC X(32432) VALUE SPACES.       01140049
011500 01  XML-LENGTH                  PIC 9(7)     VALUE ZEROS.        01150049
011600                                                                  01160049
011700 01  PC-MQCONN                   PIC X(8)  VALUE 'CSQBCONN'.      01170049
011800 01  PC-MQOPEN                   PIC X(8)  VALUE 'CSQBOPEN'.      01180049
011900 01  PC-MQINQ                    PIC X(8)  VALUE 'CSQBINQ'.       01190049
012000 01  PC-MQGET                    PIC X(8)  VALUE 'CSQBGET'.       01200049
012100 01  PC-MQPUT                    PIC X(8)  VALUE 'CSQBPUT'.       01210049
012200 01  PC-MQCMIT                   PIC X(8)  VALUE 'CSQBCOMM'.      01220049
012300 01  PC-MQCLOSE                  PIC X(8)  VALUE 'CSQBCLOS'.      01230049
012400 01  PC-MQDISC                   PIC X(8)  VALUE 'CSQBDISC'.      01240049
012500 01  PC-MQBACK                   PIC X(8)  VALUE 'CSQBBACK'.      01250049
012600                                                                  01260049
012700* API CONTROL BLOCKS                                              01270049
012800 01  MQM-OBJECT-DESCRIPTOR.                                       01280049
012900     COPY CMQODV.                                                 01290049
013000 01  MQM-MESSAGE-DESCRIPTOR.                                      01300049
013100     COPY CMQMDV.                                                 01310049
013200 01  MQM-PUT-MESSAGE-OPTIONS.                                     01320049
013300     COPY CMQPMOV.                                                01330049
013400 01  MQM-GET-MESSAGE-OPTIONS.                                     01340049
013500     COPY CMQGMOV.                                                01350049
013600                                                                  01360049
013700* MQV CONTAINS CONSTANTS (FOR FILLING IN THE CONTROL BLOCKS)      01370049
013800* AND RETURN CODES (FOR TESTING THE RESULT OF A CALL)             01380049
013900 01  MQM-CONSTANTS.                                               01390049
014000     COPY CMQV.                                                   01400049
014100                                                                  01410049
014200 01  PS-PROGRAM-SWITCHES.                                         01420049
014300     05  PS-TIME-TO-END-PROGRAM-SW      PIC X(01)  VALUE 'N'.     01430049
014400         88  PS-TIME-TO-END-PROGRAM-YES            VALUE 'Y'.     01440049
014500         88  PS-TIME-TO-END-PROGRAM-NO             VALUE 'N'.     01450049
014600     05  PS-XML-TYPE-SW                 PIC X(01)  VALUE 'U'.     01460049
014700         88  PS-XML-PCKMD                          VALUE 'P'.     01470049
014800         88  PS-XML-INBLN                          VALUE 'I'.     01480049
014900         88  PS-XML-BXOPN                          VALUE 'O'.     01490049
015000         88  PS-XML-BXCLS                          VALUE 'C'.     01500049
015100         88  PS-XML-UNKNOWN                        VALUE 'U'.     01510049
015200     05  PS-FIRST-ELEMENT-SW            PIC X(01)  VALUE 'Y'.     01520049
015300         88  PS-FIRST-ELEMENT-YES                  VALUE 'Y'.     01530049
015400         88  PS-FIRST-ELEMENT-NO                   VALUE 'N'.     01540049
015401                                                                  01540199
015410     05  PS-USER-FOUND-SW               PIC X(01)  VALUE 'Y'.     01541099
015420         88  PS-USER-FOUND                         VALUE 'Y'.     01542099
015421         88  PS-USER-FOUND-NO                      VALUE 'N'.     01542199
015500                                                                  01550049
015600***************************************************************** 01560049
015700* MQ SERIES COMPLETION CODES.                                     01570049
015800***************************************************************** 01580049
015900     COPY ISWS002.                                                01590049
016000                                                                  01600049
016100***************************************************************** 01610049
016200* XML CODE DESCRIPTIONS, AND DISPLAYING FORMATTED XML MESSAGES    01620049
016300***************************************************************** 01630049
016400     COPY ISWS007.                                                01640049
016500     COPY ISWS008.                                                01650049
016600     COPY ISWS009.                                                01660049
016700                                                                  01670049
016800***************************************************************** 01680049
016900* COMMUNICATION AREA FOR CALLED PROGRAMS                          01690049
017000***************************************************************** 01700049
017100     COPY PCWS243.                                                01710049
017200     COPY PCWS244.                                                01720049
017300     COPY PCWS245.                                                01730049
017400     COPY PCWS246.                                                01740049
017500                                                                  01750049
017600***************************************************************** 01760049
017700* ERROR RECORDS FOR TUPLDER                                       01770049
017800***************************************************************** 01780049
017900     COPY PCWS057.                                                01790049
018000     COPY PCWS058.                                                01800049
018100     COPY PCWS059.                                                01810049
018200     COPY PCWS060.                                                01820049
018300                                                                  01830049
018400******************************************************************01840049
018500* COMMUNICATIONS AREA FOR DB2                                     01850049
018600******************************************************************01860049
018700     EXEC SQL                                                     01870049
018800          INCLUDE SQLCA                                           01880049
018900     END-EXEC.                                                    01890049
019000                                                                  01900049
019100******************************************************************01910049
019200*  DB2 VIEW DECLARATION - CONSUMER QUEUE VIEW (GET/READ)          01920049
019300*        (WSV_CNSMR_QUE) WSV00006                                 01930049
019400******************************************************************01940049
019500     EXEC SQL                                                     01950049
019600         INCLUDE WSV00006                                         01960049
019700     END-EXEC.                                                    01970049
019800                                                                  01980049
019900******************************************************************01990049
020000*  DB2 TABLE DECLARATION - ERROR MESSAGES                         02000049
020100******************************************************************02010049
020200     EXEC SQL                                                     02020049
020300         INCLUDE TUPLDER                                          02030049
020400     END-EXEC.                                                    02040049
020500                                                                  02050049
020600******************************************************************02060049
020700*  DB2 TABLE DECLARATION - WST_INTGRTN_TYP                        02070049
020800******************************************************************02080049
020900     EXEC SQL                                                     02090049
021000         INCLUDE WST00008                                         02100049
021100     END-EXEC.                                                    02110049
021200                                                                  02120049
021300******************************************************************02130049
021400*  DB2 TABLE DECLARATION - WST_ATTR_DEFN                          02140049
021500******************************************************************02150049
021600     EXEC SQL                                                     02160049
021700         INCLUDE WST00009                                         02170049
021800     END-EXEC.                                                    02180049
021900                                                                  02190049
022000******************************************************************02200049
022100*  DB2 TABLE DECLARATION - WST_ATTR_ELEM                          02210049
022200******************************************************************02220049
022300     EXEC SQL                                                     02230049
022400         INCLUDE WST00010                                         02240049
022500     END-EXEC.                                                    02250049
022600                                                                  02260049
022610******************************************************************02261084
022620*  DB2 TABLE DECLARATION - TKRPRPM                                02262084
022630******************************************************************02263084
022640     EXEC SQL                                                     02264084
022650         INCLUDE TKRPRPM                                          02265084
022660     END-EXEC.                                                    02266084
022670                                                                  02267084
022671******************************************************************02267199
022680*     XLT_USR                                                     02268099
022681******************************************************************02268199
022690     EXEC SQL                                                     02269099
022691         INCLUDE XLT00024                                         02269199
022692     END-EXEC.                                                    02269299
022693                                                                  02269399
022694******************************************************************02269499
022695*     DLT_TMP_EMP                                                 02269599
022696******************************************************************02269699
022697     EXEC SQL                                                     02269799
022698         INCLUDE DLT00002                                         02269899
022699     END-EXEC.                                                    02269999
022700                                                                  02270099
022710                                                                  02271049
022800***************************************************************** 02280049
022900 PROCEDURE DIVISION.                                              02290049
023000***************************************************************** 02300049
023100*                                                                 02310049
023200******************************************************************02320049
023300*    MAIN PROCESSING.                                             02330049
023400******************************************************************02340049
023500 0000-MAIN-MODULE.                                                02350049
023600                                                                  02360049
023700     initialize  PS-PROGRAM-SWITCHES                              02370074
023800                 PV-PROGRAM-VARIABLES.                            02380074
023900                                                                  02390074
024000     MOVE '0000-MAIN-MODULE'           TO PV-PARAGRAPH.           02400049
024100                                                                  02410049
024200     DISPLAY 'PCKUT071 - 0000-MAIN-MODULE.             '.         02420049
024300     DISPLAY '**********************************'.                02430049
024400     DISPLAY '* START OF PCKUT071               '.                02440049
024500     DISPLAY '**********************************'.                02450049
024600                                                                  02460049
024700     PERFORM 1000-INITIALIZATION.                                 02470049
024800     PERFORM 1200-MQSERIES-CONNECT.                               02480049
024900     PERFORM 1300-MQSERIES-OPEN.                                  02490049
025000     PERFORM 1400-GET-MQ-MESSAGE.                                 02500049
025010                                                                  02501084
025020     PERFORM 2250-CHECK-CAPTURE-MESSAGES.                         02502084
025030                                                                  02503084
025100     PERFORM 2000-PROCESS-XML                                     02510049
025200             UNTIL PS-TIME-TO-END-PROGRAM-YES.                    02520049
025300*            UNTIL PV-REASON = MQRC-NO-MSG-AVAILABLE              02530049
025400*             OR PS-TIME-TO-END-PROGRAM-YES.                      02540049
025500     PERFORM 9300-EOJ.                                            02550049
025600     GOBACK.                                                      02560049
025700                                                                  02570049
025800***************************************************************** 02580049
025900* INITIALIZATION                                                  02590049
026000*     GETS MQ QUEUE & QUEUE MANAGER INFORMATION                   02600049
026100***************************************************************** 02610049
026200 1000-INITIALIZATION.                                             02620049
026300                                                                  02630049
026400     MOVE '1000-INITIALIZATION'        TO PV-PARAGRAPH.           02640049
026500                                                                  02650049
026600*    DISPLAY 'PCKUT071 - 1000-INITIALIZATION.          '.         02660049
026700                                                                  02670049
026800     PERFORM 1100-GET-MQ-INFO.                                    02680049
026900                                                                  02690049
027000******************************************************************02700049
027100* GETS MQ INFO FROM WSV_CNSMR_QUE (GET/READ) - LABOR TRANS        02710049
027200******************************************************************02720049
027300 1100-GET-MQ-INFO.                                                02730049
027400                                                                  02740049
027500     MOVE '1100-GET-MQ-INFO'           TO PV-PARAGRAPH.           02750049
027600                                                                  02760049
027700*    DISPLAY 'PCKUT071 - 1100-GET-MQ-INFO.         '.             02770049
027800                                                                  02780049
027900     EXEC SQL                                                     02790049
028000        SELECT QUE_MGR,                                           02800049
028100               QUE_NM                                             02810049
028200         INTO :WSV00006-QUE-MGR                                   02820049
028300             ,:WSV00006-QUE-NM                                    02830049
028400         FROM WSV_CNSMR_QUE                                       02840049
028500        WHERE APPL_FUNC_DESC  = 'QUEUE'                           02850049
028600          AND INTGRTN_TYP_CDE = 'P2LLABORQ'                       02860049
028700     END-EXEC.                                                    02870049
028800                                                                  02880049
028900*    DISPLAY 'WSV00006-QUE-MGR= ' WSV00006-QUE-MGR-TEXT           02890049
029000*    DISPLAY 'WSV00006-QUE-NM = ' WSV00006-QUE-NM-TEXT            02900049
029100                                                                  02910049
029200     EVALUATE TRUE                                                02920049
029300         WHEN SQLCODE = 0                                         02930049
029400             INITIALIZE PV-QMGR-NAME                              02940049
029500             MOVE WSV00006-QUE-MGR-TEXT TO PV-QMGR-NAME           02950049
029600             INITIALIZE PV-QUE-NAME                               02960049
029700             MOVE WSV00006-QUE-NM-TEXT TO PV-QUE-NAME             02970049
031100         WHEN OTHER                                               03110049
031500             MOVE SQLCODE         TO  PV-DISP-SQLCODE             03150067
031600             DISPLAY ' PCKUT071 - 1100 '                          03160067
031700                     ' SQLCODE: '  PV-DISP-SQLCODE                03170067
031800                     ' QUEUE: P2LLABORQ'                          03180067
031900                                                                  03190095
032000             MOVE '106'           TO PV-ERR-CDE                   03200049
032100             MOVE  SQLCODE        TO PV-DISP-SQLCODE              03210055
032200             INITIALIZE  PV-UNKNOWN-MSG                           03220055
032300             STRING 'PCKUT071-1100-GET-MQ-INFO - '                03230055
032400                    'QUEUE - P2LLABORQ - WSV_CNSMR_QUE '          03240055
032500                    'SQLCODE = ' PV-DISP-SQLCODE                  03250055
032600                                       DELIMITED BY SIZE          03260055
032700                                  INTO PV-UNKNOWN-MSG             03270055
032800             PERFORM 5000-WRITE-ERROR-REC                         03280049
032900             MOVE +4018           TO PV-ABEND-CODE                03290049
033000             PERFORM 9500-ABEND                                   03300049
033100     END-EVALUATE.                                                03310049
033200                                                                  03320049
033300******************************************************************03330049
033400* CONNECT TO QUEUE MANAGER.                                       03340049
033500******************************************************************03350049
033600 1200-MQSERIES-CONNECT.                                           03360049
033700                                                                  03370049
033800     MOVE '1200-MQSERIES-CONNECT'      TO PV-PARAGRAPH.           03380049
033900                                                                  03390049
034000*    DISPLAY 'PCKUT071 - 1200-MQSERIES-CONNECT.        '.         03400049
034100                                                                  03410049
034200     CALL PC-MQCONN USING PV-QMGR-NAME                            03420049
034300                          PV-HCONN                                03430049
034400                          PV-COMPLETION-CODE                      03440049
034500                          PV-REASON.                              03450049
034600                                                                  03460049
034700     MOVE PV-REASON TO PV-CON-REASON.                             03470049
034800     IF PV-COMPLETION-CODE = MQCC-OK THEN                         03480049
036300         CONTINUE                                                 03630064
036400     ELSE                                                         03640049
036800         DISPLAY ' PCKUT071 - 1200-MQ-CONNECT '                   03680067
036900                 ' COMPLETION CODE:'  PV-COMPLETION-CODE          03690067
037000                 ' REASON CODE:'      PV-REASON-CDE               03700067
037100                                                                  03710095
037200         MOVE '107'              TO PV-ERR-CDE                    03720049
037300         MOVE PV-COMPLETION-CODE TO PV-DISPLAY-CDE                03730049
037400         MOVE PV-REASON          TO PV-REASON-CDE                 03740049
037500         INITIALIZE  PV-UNKNOWN-MSG                               03750055
037600         STRING 'PCKUT071-1200-MQ-CONNECT - '                     03760055
037700                'COMPLETION CODE=' PV-DISPLAY-CDE                 03770055
037800                ' REASON CODE='    PV-REASON-CDE                  03780057
037900                                   DELIMITED BY SIZE              03790055
038000                              INTO PV-UNKNOWN-MSG                 03800055
038100         PERFORM 5000-WRITE-ERROR-REC                             03810049
038200         MOVE +4018              TO PV-ABEND-CODE                 03820049
038300         PERFORM 9500-ABEND                                       03830049
038400     END-IF.                                                      03840049
038500                                                                  03850049
038600***************************************************************** 03860049
038700*   OPEN THE QUEUE FOR GETS                                       03870049
038800***************************************************************** 03880049
038900 1300-MQSERIES-OPEN.                                              03890049
039000*    DISPLAY 'PCKUT071 - 1300-MQSERIES-OPEN.       '.             03900049
039100                                                                  03910049
039200     MOVE '1300-MQSERIES-OPEN'         TO PV-PARAGRAPH.           03920049
039300                                                                  03930049
039400*    NON-DESTRUCTIVE READ (FOR TESTING ONLY)                      03940049
039500*    COMPUTE PV-OPEN-OPTIONS        = MQOO-BROWSE                 03950049
039600*                                   + MQOO-FAIL-IF-QUIESCING.     03960049
039700                                                                  03970049
039800     COMPUTE PV-OPEN-OPTIONS        = MQOO-INPUT-SHARED           03980049
039900                                    + MQOO-OUTPUT                 03990049
040000                                    + MQOO-SET-IDENTITY-CONTEXT   04000049
040100                                    + MQOO-FAIL-IF-QUIESCING.     04010049
040200                                                                  04020049
040300     MOVE MQOT-Q                   TO MQOD-OBJECTTYPE.            04030049
040400     MOVE PV-QMGR-NAME             TO MQOD-OBJECTQMGRNAME.        04040049
040500     MOVE PV-QUE-NAME              TO MQOD-OBJECTNAME.            04050049
040600                                                                  04060049
040700     CALL PC-MQOPEN USING PV-HCONN                                04070049
040800                          MQM-OBJECT-DESCRIPTOR                   04080049
040900                          PV-OPEN-OPTIONS                         04090049
041000                          PV-HANDLE                               04100049
041100                          PV-COMPLETION-CODE                      04110049
041200                          PV-REASON.                              04120049
041300                                                                  04130049
041400     IF PV-COMPLETION-CODE = MQCC-OK THEN                         04140049
042900         CONTINUE                                                 04290063
043000     ELSE                                                         04300049
043400         DISPLAY ' PCKUT071 - 1300-MQ-OPEN'                       04340067
043500                 ' COMPLETION CODE:'  PV-COMPLETION-CODE          04350067
043600                 ' REASON CODE:'      PV-REASON-CDE               04360067
043700                                                                  04370095
043800         MOVE '104'              TO PV-ERR-CDE                    04380049
043900         MOVE PV-COMPLETION-CODE TO PV-DISPLAY-CDE                04390049
044000         MOVE PV-REASON          TO PV-REASON-CDE                 04400049
044100         INITIALIZE  PV-UNKNOWN-MSG                               04410055
044200         STRING 'PCKUT071-1300-MQ-OPEN -    '                     04420057
044300                'COMPLETION CODE=' PV-DISPLAY-CDE                 04430055
044400                ' REASON CODE='    PV-REASON-CDE                  04440057
044500                                 DELIMITED BY SIZE                04450055
044600                            INTO PV-UNKNOWN-MSG                   04460055
044700         PERFORM 5000-WRITE-ERROR-REC                             04470049
044800         MOVE +4018              TO PV-ABEND-CODE                 04480049
044900         PERFORM 9500-ABEND                                       04490049
045000     END-IF.                                                      04500049
045100                                                                  04510049
045200****************************************************************  04520049
045300** GET THE MESSAGES FROM THE QUEUE.                               04530049
045400****************************************************************  04540049
045500 1400-GET-MQ-MESSAGE.                                             04550049
045600                                                                  04560049
045700     MOVE '1400-GET-MQ-MESSAGE'        TO PV-PARAGRAPH.           04570049
045800                                                                  04580049
045900*    DISPLAY 'PCKUT071 - 1400-GET-MQ-MESSAGE.          '.         04590049
046000                                                                  04600049
046100     INITIALIZE PV-MSGBUFFER                                      04610049
046200                PV-MSG.                                           04620049
046300     MOVE 'U'                    TO PS-XML-TYPE-SW.               04630049
046400     MOVE 0                      TO PV-DC-NBR.                    04640049
046500     MOVE '000'                  TO PV-ERR-CDE.                   04650049
046600     SET PS-FIRST-ELEMENT-YES    TO TRUE.                         04660049
046700                                                                  04670049
046800     MOVE MQMI-NONE              TO MQMD-MSGID.                   04680049
046900     MOVE MQCI-NONE              TO MQMD-CORRELID.                04690049
047000                                                                  04700049
047100     MOVE MQFMT-STRING           TO MQMD-FORMAT.                  04710049
047200     MOVE +32432                 TO PV-MSG-LENGTH.                04720049
047300                                                                  04730049
047400*** THE UNLIMITED WAIT INTERVAL MEANS THAT PROCESSING WILL        04740049
047500*** CONTINUE UNTIL A END-OF-RUN MESSAGE APPEARS ON THE Q.         04750049
047600     MOVE MQWI-UNLIMITED       TO MQGMO-WAITINTERVAL.             04760049
047700                                                                  04770049
047800*    30 SECONDS FOR TESTING PURPOSES                              04780049
047900*    MOVE 30000                TO MQGMO-WAITINTERVAL.             04790049
048000                                                                  04800049
048100                                                                  04810049
048200*        QUEUE RECORDS ARE NOT DESTROYED (TEST ONLY)              04820049
048300*    COMPUTE MQGMO-OPTIONS =   MQGMO-NO-SYNCPOINT                 04830049
048400*                            + MQGMO-CONVERT                      04840049
048500*                            + MQGMO-BROWSE-NEXT                  04850049
048600*                            + MQGMO-ACCEPT-TRUNCATED-MSG         04860049
048700*                            + MQGMO-FAIL-IF-QUIESCING            04870049
048800*                            + MQGMO-WAIT.                        04880049
048900                                                                  04890049
049000     COMPUTE MQGMO-OPTIONS  =  MQGMO-SYNCPOINT +                  04900049
049100                               MQGMO-CONVERT   +                  04910049
049200                               MQGMO-ACCEPT-TRUNCATED-MSG +       04920049
049300                               MQGMO-WAIT.                        04930049
049400                                                                  04940049
049500     CALL PC-MQGET USING PV-HCONN                                 04950049
049600                         PV-HANDLE                                04960049
049700                         MQM-MESSAGE-DESCRIPTOR                   04970049
049800                         MQM-GET-MESSAGE-OPTIONS                  04980049
049900                         PV-MSG-LENGTH                            04990049
050000                         PV-MSGBUFFER(1:PV-MSG-LENGTH)            05000049
050100                         PV-DATA-LENGTH                           05010049
050200                         PV-COMPLETION-CODE                       05020049
050300                         PV-REASON.                               05030049
050400                                                                  05040049
050500     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        05050049
050600         IF ((PV-REASON NOT = MQRC-NO-MSG-AVAILABLE)              05060049
050700          AND (PV-REASON NOT = MQRC-TRUNCATED-MSG-ACCEPTED))      05070049
050800            MOVE '105'              TO PV-ERR-CDE                 05080049
050900            MOVE PV-COMPLETION-CODE TO PV-DISPLAY-CDE             05090049
051000            MOVE PV-REASON          TO PV-REASON-CDE              05100049
051100            INITIALIZE  PV-UNKNOWN-MSG                            05110055
051200            STRING 'PCKUT071-1400-GET-MSG -   '                   05120057
051300                   'COMPLETION CODE=' PV-DISPLAY-CDE              05130055
051400                   ' REASON CODE='    PV-REASON-CDE               05140057
051500                                      DELIMITED BY SIZE           05150055
051600                                 INTO PV-UNKNOWN-MSG              05160055
051700            PERFORM 5000-WRITE-ERROR-REC                          05170049
051800            MOVE +4018              TO PV-ABEND-CODE              05180049
051900            PERFORM 9500-ABEND                                    05190049
052000         ELSE                                                     05200049
052100*THIS MEANS A MSG WAS TRUNCATED                                   05210049
052200            IF PV-COMPLETION-CODE = +1                            05220049
052300             AND PV-REASON = +2079                                05230049
052400               MOVE '108'              TO PV-ERR-CDE              05240049
052500               MOVE PV-COMPLETION-CODE TO PV-DISPLAY-CDE          05250049
052600               MOVE PV-REASON          TO PV-REASON-CDE           05260049
052700               INITIALIZE  PV-UNKNOWN-MSG                         05270055
052800               STRING 'PCKUT071-1400-GET-MSG -    '               05280057
052900                      'COMPLETION CODE=' PV-DISPLAY-CDE           05290055
053000                      ' REASON CODE='    PV-REASON-CDE            05300057
053100                                         DELIMITED BY SIZE        05310055
053200                                    INTO PV-UNKNOWN-MSG           05320055
053300               PERFORM 5000-WRITE-ERROR-REC                       05330049
053400               MOVE +4018              TO PV-ABEND-CODE           05340049
053500               PERFORM 9500-ABEND                                 05350049
053600            ELSE                                                  05360049
053700               IF (PV-REASON = MQRC-NO-MSG-AVAILABLE)             05370049
053800                  CONTINUE                                        05380049
053900               END-IF                                             05390049
054000            END-IF                                                05400049
054100         END-IF                                                   05410049
054200     ELSE                                                         05420049
055800         MOVE PV-MSGBUFFER  TO PV-MSG                             05580049
055900         ADD +1             TO PA-MQ-MSGS-READ                    05590049
055910*** dmh                                                           05591099
056000***      DISPLAY 'PV-MSGBUFF:' PV-MSGBUFFER(1:PV-DATA-LENGTH)     05600099
056100***      DISPLAY 'PV-MSGLNGT:' PV-MSG-LENGTH                      05610099
056200***      DISPLAY 'PV-DATLNGT:' PV-DATA-LENGTH                     05620099
056300***      DISPLAY 'PV-COMPLCD:' PV-COMPLETION-CODE                 05630099
056400***      DISPLAY 'PV-REASON :' PV-REASON                          05640099
056500***      DISPLAY 'MESSAGE   :' PV-MSG(1:PV-DATA-LENGTH)           05650099
056510*** dmh                                                           05651099
056600     END-IF.                                                      05660049
056700                                                                  05670049
056800******************************************************************05680049
056900* PROCESS/PARSE THE XML DATA                                      05690049
057000******************************************************************05700049
057100 2000-PROCESS-XML.                                                05710049
057200                                                                  05720049
057300     MOVE '2000-PROCESS-XML'           TO PV-PARAGRAPH.           05730049
057400                                                                  05740049
057500*    DISPLAY 'PCKUT071 - 2000-PROCESS-XML.             '.         05750049
057600                                                                  05760049
057700*    DISPLAY "PROCESSING XML...".                                 05770049
057800                                                                  05780049
057900     INITIALIZE PC057-UPLOAD-ERROR-RECORD                         05790049
058000                PC058-UPLOAD-ERROR-RECORD                         05800049
058100                PC059-UPLOAD-ERROR-RECORD                         05810099
058200                PC060-UPLOAD-ERROR-RECORD.                        05820049
058300                                                                  05830049
058310     INITIALIZE  PC243-COMMAREA                                   05831077
058311                 PC244-COMMAREA                                   05831177
058312                 PC245-COMMAREA                                   05831277
058313                 PC246-COMMAREA.                                  05831377
058320                                                                  05832077
058400     INITIALIZE PC243-CRA-RET-CDE                                 05840077
058500                PC243-CRA-RET-MSG                                 05850071
058600                PC244-CRA-RET-CDE                                 05860071
058700                PC244-CRA-RET-MSG                                 05870071
058800                PC245-CRA-RET-CDE                                 05880071
058900                PC245-CRA-RET-MSG                                 05890071
059000                PC246-CRA-RET-CDE                                 05900071
059100                PC246-CRA-RET-MSG.                                05910071
059200                                                                  05920071
059300*THE "END RUN OF PROGRAM" MSG WILL SHUT DOWN THIS STARTED TASK.   05930049
059400     IF PV-MSG (1:30) = PC-END-RUN-MSG                            05940049
059500        SET PS-TIME-TO-END-PROGRAM-YES TO TRUE                    05950049
059600        ADD 1 TO PA-END-RUN-MSG-CNT                               05960049
059700     ELSE                                                         05970049
059800        PERFORM 2050-GET-DC-NBR                                   05980049
059900        XML PARSE PV-MSG (1:PV-DATA-LENGTH)                       05990099
060000           PROCESSING PROCEDURE                                   06000049
060100               2100-HANDLE-XML                                    06010049
060200                   ON EXCEPTION                                   06020049
060300                        PERFORM 3000-XML-ERROR                    06030049
060400                   NOT ON EXCEPTION                               06040049
060500                        PERFORM 3100-XML-SUCCESS                  06050049
060600        END-XML                                                   06060049
060700                                                                  06070099
060712        IF  KRPRPM-FUNC-TXT  = 'Y'                                06071299
060713            PERFORM 2200-CAPTURE-MESSAGE                          06071384
060720        END-IF                                                    06072084
060722                                                                  06072299
060723******************************************************************06072399
060724* ADDED CHECK TO VALIDATE TK#.  DC'S ARE NOT ALWAYS MAKING SURE  *06072499
060725* THAT THE PICKERNAME & PICKERBARCODE ARE THE SAME               *06072599
060726* DMH - 03/12/20 BEGIN                                           *06072699
060727******************************************************************06072799
060730         SET  PS-USER-FOUND-NO        TO TRUE                     06073099
060733                                                                  06073399
060734         MOVE FUNCTION UPPER-CASE(PV-PICKER-BARCODE)              06073499
060736                                  TO  XLT00024-USR-ID             06073699
060737                                      DLT00002-TMP-USR-ID         06073799
060738         PERFORM 7100-KOHLS-USER                                  06073899
060740                                                                  06074099
060741         IF  PS-USER-FOUND                                        06074199
060742             IF  PV-PICKER-BARCODE  =  PV-PICKER-NAME             06074299
060743                 CONTINUE                                         06074399
060746             ELSE                                                 06074699
060747                 MOVE PV-DC-NBR  TO  PV-DISP-OPER                 06074799
060748                 MOVE SPACES TO PV-UPDATE-MSG                     06074899
060750                 STRING  'PICKERNAME UPDATED: '                   06075099
060751                         ' FROM: '  PV-PICKER-NAME                06075199
060752                         ' TO:   '  PV-PICKER-BARCODE             06075299
060753                         '  TYPE:'  PS-XML-TYPE-SW                06075399
060754                         '  OPER:'  PV-DISP-OPER                  06075499
060755                         DELIMITED BY SIZE                        06075599
060756                    INTO PV-UPDATE-MSG                            06075699
060757                 DISPLAY PV-UPDATE-MSG                            06075799
060758                 perform 7110-CAPTURE-UPDATE                      06075899
060759                                                                  06075999
060760                 MOVE FUNCTION UPPER-CASE(PV-PICKER-BARCODE)      06076099
060762                   TO  PV-PICKER-NAME                             06076299
060763                       PC243-PICKER-ID                            06076399
060764                       PC058-PM-PICKER-BARCODE                    06076499
060765                       PC244-LAUNCH-USER-ID                       06076599
060766                       PC057-IL-PICKER-NAME                       06076699
060767                       PC245-BOXOPEN-USER-ID                      06076799
060768                       PC059-BO-PICKER-NAME                       06076899
060769                       PC246-BOXCLOSE-USER-ID                     06076999
060770                       PC060-BC-PICKER-NAME                       06077099
060771             END-IF                                               06077199
060772         ELSE                                                     06077299
060773             IF  PV-PICKER-BARCODE  =  PV-PICKER-NAME             06077399
060774                 CONTINUE                                         06077499
060775             ELSE                                                 06077599
060776                 MOVE FUNCTION UPPER-CASE(PV-PICKER-NAME)         06077699
060777                                      TO XLT00024-USR-ID          06077799
060778                                         DLT00002-TMP-USR-ID      06077899
060779                 PERFORM 7100-KOHLS-USER                          06077999
060780                 IF  PS-USER-FOUND                                06078099
060781                     MOVE PV-DC-NBR  TO  PV-DISP-OPER             06078199
060782                     MOVE SPACES TO PV-UPDATE-MSG                 06078299
060783                     string  'PICKER BARCODE UPDATED: '           06078399
060784                             ' FROM: '  PV-PICKER-BARCODE         06078499
060785                             ' TO:   '  PV-PICKER-NAME            06078599
060786                             '  TYPE:'  PS-XML-TYPE-SW            06078699
060787                             '  OPER:'  PV-DISP-OPER              06078799
060788                             delimited by size                    06078899
060789                        into PV-UPDATE-MSG                        06078999
060790                     DISPLAY PV-UPDATE-MSG                        06079099
060791                     perform 7110-CAPTURE-UPDATE                  06079199
060792                                                                  06079299
060793                     MOVE FUNCTION UPPER-CASE(PV-PICKER-NAME)     06079399
060795                       TO  PV-PICKER-BARCODE                      06079599
060796                           PC057-IL-PICKER-BARCODE                06079699
060797                           PC058-PM-PICKER-BARCODE                06079799
060798                           PC059-BO-PICKER-BARCODE                06079899
060799                           PC060-BC-PICKER-BARCODE                06079999
060800                 END-IF                                           06080099
060801             END-IF                                               06080199
060802         END-IF                                                   06080299
060803                                                                  06080399
060804******************************************************************06080499
060805* DMH - 03/12/20 END                                             *06080599
060806******************************************************************06080699
060807                                                                  06080799
060808                                                                  06080899
060810        PERFORM 2500-CALL-LABOR-MODULE                            06081049
060900        PERFORM 8500-MQ-COMMIT                                    06090049
060901                                                                  06090175
060910        IF  PA-CONSECUTIVE-ERRORS  > 9                            06091075
060920            SET  PS-TIME-TO-END-PROGRAM-YES  TO TRUE              06092075
060930        ELSE                                                      06093075
060940           INITIALIZE  PS-PROGRAM-SWITCHES                        06094078
060950                      PV-PROGRAM-VARIABLES                        06095078
061000           PERFORM 1400-GET-MQ-MESSAGE                            06100078
061100        END-IF                                                    06110075
061110     END-IF.                                                      06111075
061200                                                                  06120049
061300******************************************************************06130049
061400* GETS THE QUEUE MANAGER, SERVER NAME & DC NBR                    06140049
061500******************************************************************06150049
061600 2050-GET-DC-NBR.                                                 06160049
061700                                                                  06170049
061800     MOVE '2050-GET-DC-NBR'            TO PV-PARAGRAPH.           06180049
061900                                                                  06190049
062000*    DISPLAY 'PCKUT071 - 2050-GET-DC-NBR.         '.              06200049
062100*    DISPLAY '   MQMD-REPLYTOQMGR: ' MQMD-REPLYTOQMGR.            06210049
062200                                                                  06220049
062300     EXEC SQL                                                     06230049
062400        SELECT C.ATTR_ELEM_TXT                                    06240049
062500             , D.ATTR_ELEM_TXT                                    06250049
062600             , INT (E.ATTR_ELEM_NBR)                              06260049
062700         INTO :PV-QUEUE-MANAGER                                   06270049
062800             ,:PV-SERVER-NAME                                     06280049
062900             ,:PV-DC-NBR                                          06290049
063000         FROM  WST_INTGRTN_TYP  A                                 06300049
063100             , WST_ATTR_DEFN    B                                 06310049
063200             , WST_ATTR_ELEM    C                                 06320049
063300             , WST_ATTR_ELEM    D                                 06330049
063400             , WST_ATTR_ELEM    E                                 06340049
063500        WHERE  A.INTGRTN_TYP_CDE   = 'PCCQMGR'                    06350099
063600          AND  A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE            06360049
063700          AND  B.ATTR_DEFN_SEQ_NBR = 1                            06370049
063800          AND  B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE            06380049
063900          AND  C.ATTR_DEFN_SEQ_NBR = 1                            06390049
064000          AND  B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE            06400049
064100          AND  D.ATTR_DEFN_SEQ_NBR = 2                            06410049
064200          AND  B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE            06420049
064300          AND  E.ATTR_DEFN_SEQ_NBR = 3                            06430049
064400          AND  C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR          06440049
064500          AND  C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR          06450049
064600          AND  C.ATTR_ELEM_TXT     = :MQMD-REPLYTOQMGR            06460049
064700     END-EXEC.                                                    06470049
064800                                                                  06480049
064900     EVALUATE TRUE                                                06490049
065000         WHEN SQLCODE = 0                                         06500049
065100             MOVE PV-DC-NBR          TO PC243-DC-NBR              06510049
065200                                        PC058-PM-DC-NBR           06520049
065300                                        PC244-DC-NBR              06530049
065400                                        PC057-IL-DC-NBR           06540049
065500                                        PC245-DC-NBR              06550049
065600                                        PC059-BO-DC-NBR           06560049
065700                                        PC246-DC-NBR              06570049
065800                                        PC060-BC-DC-NBR           06580049
067200         WHEN OTHER                                               06720049
067600         MOVE  SQLCODE  TO  PV-DISP-SQLCODE                       06760067
067700         DISPLAY ' PCKUT071 - 2050-GET-DC '                       06770068
067800                 ' SQLCODE:'          PV-DISP-SQLCODE             06780069
067900                 ' FUNCTION:PCCQMGR'                              06790069
068000                 ' QMGR:'             MQMD-REPLYTOQMGR            06800067
068100                                                                  06810095
068200             MOVE 0               TO PV-DC-NBR                    06820049
068300             MOVE '100'           TO PV-ERR-CDE                   06830049
068400             INITIALIZE  PV-UNKNOWN-MSG                           06840055
068500             STRING 'PCKUT071-2050 - UNKNOWN QUEUE MGR - '        06850055
068600                    'PCCQMGR ' MQMD-REPLYTOQMGR                   06860055
068700                                     DELIMITED BY SIZE            06870055
068800                                INTO PV-UNKNOWN-MSG               06880055
068900             PERFORM 5000-WRITE-ERROR-REC                         06890049
069000     END-EVALUATE.                                                06900049
069100                                                                  06910049
069200******************************************************************06920049
069300* PREP THE DB2 FIELDS WITH THE XML DATA                           06930049
069400******************************************************************06940049
069500 2100-HANDLE-XML.                                                 06950049
069600                                                                  06960049
069700     COMPUTE XML-LENGTH = FUNCTION LENGTH(XML-TEXT).              06970049
069710*** dmh begin                                                     06971099
069720***        display XML-EVENT '-'                                  06972099
069730***               ' message length'                               06973099
069750***               ' - ' xml-length                                06975099
069760*** dmh end                                                       06976099
069800                                                                  06980049
069900     EVALUATE XML-EVENT                                           06990049
070000       WHEN 'START-OF-ELEMENT'                                    07000049
070100                                                                  07010087
071200         MOVE XML-TEXT(1:XML-LENGTH) TO PV-CURRENT-ELEMENT        07120049
071210                                                                  07121099
071300*** dmh begin                                                     07130099
071310***        display XML-EVENT '-'                                  07131099
071320***                PV-CURRENT-ELEMENT   '-'                       07132099
071330***                XML-TEXT(1:XML-LENGTH)                         07133099
071340***               ' - ' xml-length                                07134099
071350*** dmh end                                                       07135099
071360                                                                  07136099
071400         IF PS-FIRST-ELEMENT-YES                                  07140049
071600            EVALUATE PV-CURRENT-ELEMENT                           07160049
071700               WHEN 'PickMade'                                    07170049
071800                   SET PS-XML-PCKMD     TO TRUE                   07180049
071900                   SET PC058-PICK-MADE  TO TRUE                   07190058
072000                                                                  07200087
073100               WHEN 'InboundLaunched'                             07310049
073200                   SET PS-XML-INBLN          TO TRUE              07320058
073300                   SET PC057-INBOUND-LAUNCH  TO TRUE              07330058
073400                                                                  07340087
074500               WHEN 'BoxOpened'                                   07450049
074600                   SET PS-XML-BXOPN     TO TRUE                   07460049
074700                   SET PC059-BOX-OPEN   TO TRUE                   07470059
074800                                                                  07480087
074900               WHEN 'CartonOpened'                                07490099
075000                   SET PS-XML-BXOPN     TO TRUE                   07500099
075100                   SET PC059-BOX-OPEN   TO TRUE                   07510099
075200                                                                  07520099
075900               WHEN 'BoxClosed'                                   07590049
076000                   SET PS-XML-BXCLS     TO TRUE                   07600049
076100                   SET PC060-BOX-CLOSE  TO TRUE                   07610059
076200                                                                  07620087
076300               WHEN 'CartonClosed'                                07630099
076400                   SET PS-XML-BXCLS     TO TRUE                   07640099
076500                   SET PC060-BOX-CLOSE  TO TRUE                   07650099
076600                                                                  07660099
077300               WHEN OTHER                                         07730049
077700                  DISPLAY ' PCKUT071 - 2100-HANDLE-XML '          07770067
077800                 ' XML ELEMENT:'      PV-CURRENT-ELEMENT          07780067
077900                                                                  07790087
078000                   MOVE '101'           TO PV-ERR-CDE             07800049
078100                   INITIALIZE  PV-UNKNOWN-MSG                     07810057
078200                   STRING 'PCKUT071-2100 - UNKNOWN MSG TYPE - '   07820057
078300                           PV-CURRENT-ELEMENT                     07830057
078400                                           DELIMITED BY SIZE      07840057
078500                                      INTO PV-UNKNOWN-MSG         07850057
078600                   PERFORM 5000-WRITE-ERROR-REC                   07860049
078700            END-EVALUATE                                          07870049
078800            SET PS-FIRST-ELEMENT-NO     TO TRUE                   07880049
078900         END-IF                                                   07890049
079000                                                                  07900049
079100       WHEN 'END-OF-ELEMENT'                                      07910049
079300                                                                  07930049
079400       WHEN 'ATTRIBUTE-NAME'                                      07940049
079500         MOVE XML-TEXT(1:XML-LENGTH) TO PV-CURRENT-ATTRIBUTE      07950049
079600*** dmh begin                                                     07960099
079610***        display XML-EVENT '-'                                  07961099
079620***                PV-CURRENT-ATTRIBUTE '-'                       07962099
079630***                XML-TEXT(1:XML-LENGTH)                         07963099
079640***               ' - ' xml-length                                07964099
079641*** dmh end                                                       07964199
079650                                                                  07965099
079700                                                                  07970049
079800       WHEN 'ATTRIBUTE-CHARACTERS'                                07980049
079900       WHEN 'ATTRIBUTE-CHARACTER'                                 07990049
080000       WHEN 'CONTENT-CHARACTERS'                                  08000049
080100       WHEN 'CONTENT-CHARACTER'                                   08010049
080110                                                                  08011099
080120*** dmh begin                                                     08012099
080200***        display XML-EVENT '-'                                  08020099
080210***                PV-CURRENT-ATTRIBUTE '-'                       08021099
080220***                XML-TEXT(1:XML-LENGTH)                         08022099
080230***               ' - ' xml-length                                08023099
080231*** dmh end                                                       08023199
080240                                                                  08024099
080300        EVALUATE PV-CURRENT-ATTRIBUTE                             08030049
080400         WHEN 'PickOrderNumber'                                   08040049
080500           MOVE XML-TEXT(1:XML-LENGTH) TO PC243-PICK-ORDER-NBR    08050049
080600                                       PC058-PM-PICKORDER-NUMBER  08060049
080700                                       PC244-PICK-ORDER-NBR       08070049
080800                                       PC057-IL-PICKORDER-NBR     08080049
080900         WHEN 'InnerPackIndicator'                                08090049
081000           MOVE XML-TEXT(1:XML-LENGTH) TO PC243-INNER-PK-IND      08100088
081100         WHEN 'InnerPackQty'                                      08110049
081110           MOVE ZEROES                 TO PV-QTY-NUM              08111089
081200           MOVE XML-TEXT(1:XML-LENGTH) TO PV-QTY                  08120088
081210           IF  PV-QTY-1  =  SPACE OR                              08121093
081211               PV-QTY-1  =  LOW-VALUES                            08121193
081220               MOVE ZERO  TO  PV-QTY-1                            08122090
081221           END-IF                                                 08122191
081230           IF  PV-QTY-2  =  SPACE OR                              08123093
081231               PV-QTY-2  =  LOW-VALUES                            08123193
081240               MOVE ZERO  TO  PV-QTY-2                            08124090
081241           END-IF                                                 08124191
081250           IF  PV-QTY-3  =  SPACE OR                              08125093
081251               PV-QTY-3  =  LOW-VALUES                            08125193
081260               MOVE ZERO  TO  PV-QTY-3                            08126090
081262           END-IF                                                 08126293
081270           IF  PV-QTY-4  =  SPACE OR                              08127093
081271               PV-QTY-4  =  LOW-VALUES                            08127193
081280               MOVE ZERO  TO  PV-QTY-4                            08128090
081281           END-IF                                                 08128191
081290           IF  PV-QTY-5  =  SPACE OR                              08129093
081291               PV-QTY-5  =  LOW-VALUES                            08129193
081292               MOVE ZERO  TO  PV-QTY-5                            08129293
081293           END-IF                                                 08129393
081300           MOVE PV-QTY-NUM             TO PC243-INNER-PK-QTY      08130049
081400         WHEN 'ProductName'                                       08140049
081500           MOVE XML-TEXT(7:4)          TO PC243-STR-NBR           08150073
081600                                          PC058-PM-STR-NBR        08160073
081610         WHEN 'StoreName'                                         08161099
081620           MOVE XML-TEXT(7:4)          TO PC243-STR-NBR           08162099
081630                                          PC058-PM-STR-NBR        08163099
081700         WHEN 'LocationBarCode'                                   08170049
081800           MOVE XML-TEXT(1:XML-LENGTH) TO PC243-LOCATION-NM       08180088
081900                                       PC058-PM-LOCATION-BARCODE  08190049
082000                                       PC245-LOCATION-NM          08200049
082100                                       PC059-BO-LOCATION-NM       08210049
082200                                       PC246-LOCATION-NM          08220049
082300                                       PC060-BC-LOCATION-NM       08230049
082400         WHEN 'BoxBarCode'                                        08240049
082500           MOVE XML-TEXT(1:XML-LENGTH) TO PC243-BOX-BAR-CODE-NBR  08250049
082600                                       PC058-PM-BOX-BARCODE       08260049
082700                                       PC245-BOX-BAR-CODE-NBR     08270049
082800                                       PC059-BO-BOX-BARCODE       08280049
082900                                       PC246-BOX-BAR-CODE-NBR     08290049
083000                                       PC060-BC-BOX-BARCODE       08300049
083010         WHEN 'CartonBarCode'                                     08301099
083020           MOVE XML-TEXT(1:XML-LENGTH) TO PC243-BOX-BAR-CODE-NBR  08302099
083030                                       PC058-PM-BOX-BARCODE       08303099
083040                                       PC245-BOX-BAR-CODE-NBR     08304099
083050                                       PC059-BO-BOX-BARCODE       08305099
083060                                       PC246-BOX-BAR-CODE-NBR     08306099
083070                                       PC060-BC-BOX-BARCODE       08307099
083100         WHEN 'PickOrderQty'                                      08310049
083110           MOVE ZEROES                 TO PV-QTY-NUM              08311089
083200           MOVE XML-TEXT(1:XML-LENGTH) TO PV-QTY                  08320088
083210           IF  PV-QTY-1  =  SPACE OR                              08321093
083211               PV-QTY-1  =  LOW-VALUES                            08321193
083212               MOVE ZERO  TO  PV-QTY-1                            08321293
083213           END-IF                                                 08321393
083220           IF  PV-QTY-2  =  SPACE OR                              08322093
083221               PV-QTY-2  =  LOW-VALUES                            08322193
083222               MOVE ZERO  TO  PV-QTY-2                            08322293
083223           END-IF                                                 08322393
083230           IF  PV-QTY-3  =  SPACE OR                              08323093
083231               PV-QTY-3  =  LOW-VALUES                            08323193
083232               MOVE ZERO  TO  PV-QTY-3                            08323293
083233           END-IF                                                 08323393
083240           IF  PV-QTY-4  =  SPACE OR                              08324093
083241               PV-QTY-4  =  LOW-VALUES                            08324193
083242               MOVE ZERO  TO  PV-QTY-4                            08324293
083243           END-IF                                                 08324393
083250           IF  PV-QTY-5  =  SPACE OR                              08325093
083251               PV-QTY-5  =  LOW-VALUES                            08325193
083260               MOVE ZERO  TO  PV-QTY-5                            08326090
083270           END-IF                                                 08327091
083300           MOVE PV-QTY-NUM             TO PC243-EXP-PICK-ORDER-QTY08330049
083400                                       PC058-PM-PICKORDER-QTY     08340049
083500*DMH     WHEN 'PickedQty'                                         08350099
083501         WHEN 'Qty'                                               08350199
083510           MOVE ZEROES                 TO PV-QTY-NUM              08351089
083600           MOVE XML-TEXT(1:XML-LENGTH) TO PV-QTY                  08360088
083610           IF  PV-QTY-1  =  SPACE OR                              08361093
083611               PV-QTY-1  =  LOW-VALUES                            08361193
083620               MOVE ZERO  TO  PV-QTY-1                            08362090
083621           END-IF                                                 08362191
083630           IF  PV-QTY-2  =  SPACE OR                              08363093
083631               PV-QTY-2  =  LOW-VALUES                            08363193
083640               MOVE ZERO  TO  PV-QTY-2                            08364090
083641           END-IF                                                 08364191
083650           IF  PV-QTY-3  =  SPACE OR                              08365093
083651               PV-QTY-3  =  LOW-VALUES                            08365193
083660               MOVE ZERO  TO  PV-QTY-3                            08366090
083661           END-IF                                                 08366191
083670           IF  PV-QTY-4  =  SPACE OR                              08367093
083671               PV-QTY-4  =  LOW-VALUES                            08367193
083680               MOVE ZERO  TO  PV-QTY-4                            08368090
083681           END-IF                                                 08368191
083690           IF  PV-QTY-5  =  SPACE OR                              08369093
083691               PV-QTY-5  =  LOW-VALUES                            08369193
083692               MOVE ZERO  TO  PV-QTY-5                            08369293
083693           END-IF                                                 08369393
083700           MOVE PV-QTY-NUM             TO PC243-PICKED-QTY        08370049
083800                                       PC058-PM-PICKED-QTY        08380049
083810                                                                  08381099
084270                                                                  08427099
084300         WHEN 'PickerName'                                        08430049
084400           MOVE XML-TEXT(1:XML-LENGTH) TO PC243-PICKER-ID         08440049
084500                                       PC058-PM-PICKER-BARCODE    08450049
084600                                       PC244-LAUNCH-USER-ID       08460049
084700                                       PC057-IL-PICKER-NAME       08470051
084800                                       PC245-BOXOPEN-USER-ID      08480049
084900                                       PC059-BO-PICKER-NAME       08490051
085000                                       PC246-BOXCLOSE-USER-ID     08500049
085100                                       PC060-BC-PICKER-NAME       08510051
085110                                       PV-PICKER-NAME             08511099
085200         WHEN 'PickedQty'                                         08520049
085210           MOVE ZEROES                 TO PV-QTY-NUM              08521089
085300           MOVE XML-TEXT(1:XML-LENGTH) TO PV-QTY                  08530088
085310           IF  PV-QTY-1  =   SPACE OR                             08531093
085311               PV-QTY-1  =   LOW-VALUES                           08531193
085320               MOVE ZERO  TO  PV-QTY-1                            08532090
085321           END-IF                                                 08532191
085330           IF  PV-QTY-2  =   SPACE OR                             08533093
085331               PV-QTY-2  =   LOW-VALUES                           08533193
085340               MOVE ZERO  TO  PV-QTY-2                            08534090
085341           END-IF                                                 08534191
085350           IF  PV-QTY-3  =   SPACE OR                             08535093
085351               PV-QTY-3  =   LOW-VALUES                           08535193
085360               MOVE ZERO  TO  PV-QTY-3                            08536090
085361           END-IF                                                 08536191
085370           IF  PV-QTY-4  =   SPACE OR                             08537093
085371               PV-QTY-4  =   LOW-VALUES                           08537193
085380               MOVE ZERO  TO  PV-QTY-4                            08538090
085381           END-IF                                                 08538191
085390           IF  PV-QTY-5  =   SPACE OR                             08539093
085391               PV-QTY-5  =   LOW-VALUES                           08539193
085392               MOVE ZERO  TO  PV-QTY-5                            08539293
085393           END-IF                                                 08539393
085400           MOVE PV-QTY-NUM             TO PC243-TOTAL-PICKED-QTY  08540049
085500         WHEN 'AreaName'                                          08550049
085600           MOVE XML-TEXT(1:XML-LENGTH) TO PC244-AREA-NAME         08560099
085700                                       PC057-IL-AREA-NAME         08570049
085800         WHEN 'TagBarCode'                                        08580049
085900           MOVE XML-TEXT(1:XML-LENGTH) TO PC244-TAG-BAR-CODE-NBR  08590049
086000                                       PC057-IL-TAG-BARCODE       08600049
086010         WHEN 'CaseBarCode'                                       08601099
086020           MOVE XML-TEXT(1:XML-LENGTH) TO PC244-TAG-BAR-CODE-NBR  08602099
086030                                       PC057-IL-TAG-BARCODE       08603099
086100         WHEN 'Date'                                              08610049
086200           MOVE XML-TEXT(1:XML-LENGTH) TO PC244-LAUNCH-DATE       08620049
086300                                       PC057-IL-LAUNCH-DATE       08630049
086400                                       PC245-BOXOPEN-DATE         08640049
086500                                       PC059-BO-BOXOPEN-DATE      08650049
086600                                       PC246-BOXCLOSE-DATE        08660049
086700                                       PC060-BC-BOXCLOSE-DATE     08670049
086800         WHEN 'Time'                                              08680049
086900           MOVE XML-TEXT(1:XML-LENGTH) TO PC244-LAUNCH-TIME       08690049
087000                                       PC057-IL-LAUNCH-TIME       08700049
087100                                       PC245-BOXOPEN-TIME         08710049
087200                                       PC059-BO-BOXOPEN-TIME      08720049
087300                                       PC246-BOXCLOSE-TIME        08730049
087400                                       PC060-BC-BOXCLOSE-TIME     08740049
087401         WHEN 'EventDateTime'                                     08740199
087403           MOVE XML-TEXT(1:XML-LENGTH) TO PV-EVENT-DATE-TIME      08740399
087430           MOVE PV-EVENT-DATE          TO PC244-LAUNCH-DATE       08743099
087440                                          PC057-IL-LAUNCH-DATE    08744099
087441                                          PC245-BOXOPEN-DATE      08744199
087442                                          PC059-BO-BOXOPEN-DATE   08744299
087443                                          PC246-BOXCLOSE-DATE     08744399
087444                                          PC060-BC-BOXCLOSE-DATE  08744499
087445*dmh3/16                                                          08744599
087446                                          PC243-PICKMADE-DATE     08744699
087447                                          PC058-pm-pickmade-DATE  08744799
087448*dmh3/16                                                          08744899
087450           MOVE PV-EVENT-TIME          TO PC244-LAUNCH-TIME       08745099
087460                                          PC057-IL-LAUNCH-TIME    08746099
087461                                          PC245-BOXOPEN-TIME      08746199
087462                                          PC059-BO-BOXOPEN-TIME   08746299
087463                                          PC246-BOXCLOSE-TIME     08746399
087464                                          PC060-BC-BOXCLOSE-TIME  08746499
087465*dmh3/16                                                          08746599
087466                                          PC243-PICKMADE-time     08746699
087467                                          PC058-pm-pickmade-time  08746799
087468*dmh3/16                                                          08746899
087469                                                                  08746999
087544                                                                  08754499
087550         WHEN 'PickerBarCode'                                     08755049
087600           MOVE XML-TEXT(1:XML-LENGTH) TO PC057-IL-PICKER-BARCODE 08760051
087700                                       PC058-PM-PICKER-BARCODE    08770051
087800                                       PC059-BO-PICKER-BARCODE    08780051
087900                                       PC060-BC-PICKER-BARCODE    08790051
087901                                       PV-PICKER-BARCODE          08790199
088000         WHEN OTHER                                               08800049
088001                                                                  08800199
088002*** dmh begin                                                     08800299
088010***        display XML-EVENT '-'                                  08801099
088011***                PV-CURRENT-ATTRIBUTE '-'                       08801199
088012***                XML-TEXT(1:XML-LENGTH)                         08801299
088020***               ' - ' xml-length                                08802099
088030*** dmh end                                                       08803099
088100                                                                  08810087
088200             CONTINUE                                             08820049
088300        END-EVALUATE                                              08830049
088400                                                                  08840049
088500       WHEN 'EXCEPTION'                                           08850049
088600         MOVE '102'           TO PV-ERR-CDE                       08860049
088700         INITIALIZE  PV-UNKNOWN-MSG                               08870057
088800         STRING 'PCKUT071-2100 - UNKNOWN XML EVENT - '            08880057
088900                 XML-EVENT                                        08890057
089000                                 DELIMITED BY SIZE                08900057
089100                            INTO PV-UNKNOWN-MSG                   08910057
089200         PERFORM 5000-WRITE-ERROR-REC                             08920057
089300     END-EVALUATE.                                                08930049
089400                                                                  08940049
089401******************************************************************08940184
089402* write message to tuplder database prior to processing message   08940284
089403* these records are type 'E' and are not errors                   08940384
089404******************************************************************08940484
089410 2200-CAPTURE-MESSAGE.                                            08941084
089411***  DISPLAY 'PCKUT071 - 2200-CAPTURE-MESSAGE          '.         08941186
089412                                                                  08941284
089413     INITIALIZE DCLTUPLDER.                                       08941384
089414     MOVE PV-DC-NBR               TO UPLDER-OPER-UNT-ID.          08941484
089415     MOVE 'E'                     TO UPLDER-UPLD-TRN-CDE.         08941584
089416     MOVE SPACES                  TO UPLDER-ERR-CDE.              08941684
089419     MOVE PA-MQ-MSGS-READ         TO UPLDER-UPLD-SEQ-NBR.         08941984
089420                                                                  08942084
089421     EVALUATE TRUE                                                08942184
089422         WHEN PS-XML-PCKMD                                        08942284
089424              MOVE PC243-DC-NBR       TO  PC058-PM-DC-NBR         08942484
089425                                          UPLDER-OPER-UNT-ID      08942584
089426              MOVE 'PKM'              TO  UPLDER-ERR-CDE          08942684
089427              MOVE PC058-UPLOAD-ERROR-RECORD TO UPLDER-PKT-TXT    08942784
089428                                                                  08942884
089429         WHEN PS-XML-INBLN                                        08942984
089431              MOVE PC244-DC-NBR       TO  PC057-IL-DC-NBR         08943184
089432                                          UPLDER-OPER-UNT-ID      08943284
089433              MOVE 'LCH'              TO  UPLDER-ERR-CDE          08943384
089434              MOVE PC057-UPLOAD-ERROR-RECORD TO UPLDER-PKT-TXT    08943484
089435                                                                  08943584
089436         WHEN PS-XML-BXOPN                                        08943684
089438              MOVE PC245-DC-NBR       TO  PC059-BO-DC-NBR         08943884
089439                                          UPLDER-OPER-UNT-ID      08943984
089440              MOVE 'BXO'              TO  UPLDER-ERR-CDE          08944084
089441              MOVE PC059-UPLOAD-ERROR-RECORD TO UPLDER-PKT-TXT    08944184
089442                                                                  08944284
089443         WHEN PS-XML-BXCLS                                        08944384
089445              MOVE PC246-DC-NBR       TO  PC060-BC-DC-NBR         08944584
089446                                          UPLDER-OPER-UNT-ID      08944684
089447              MOVE 'BXC'              TO  UPLDER-ERR-CDE          08944784
089448              MOVE PC060-UPLOAD-ERROR-RECORD TO UPLDER-PKT-TXT    08944884
089449                                                                  08944984
089450         WHEN OTHER                                               08945084
089451              MOVE 'UNK'              TO  UPLDER-ERR-CDE          08945184
089452              MOVE PV-UNKNOWN-MSG     TO  UPLDER-PKT-TXT          08945284
089453                                                                  08945384
089454     END-EVALUATE.                                                08945484
089455                                                                  08945584
089461     EXEC SQL                                                     08946184
089462       INSERT INTO TUPLDER                                        08946284
089463             (OPER_UNT_ID                                         08946384
089464            , UPLD_TRN_CDE                                        08946484
089465            , ERR_CDE                                             08946584
089466            , PRC_TMST                                            08946684
089467            , UPLD_SEQ_NBR                                        08946784
089468            , PKT_TXT                                             08946884
089469             )                                                    08946984
089470       VALUES                                                     08947084
089471             (:UPLDER-OPER-UNT-ID                                 08947184
089472            , :UPLDER-UPLD-TRN-CDE                                08947284
089473            , :UPLDER-ERR-CDE                                     08947384
089474            , CURRENT TIMESTAMP                                   08947484
089475            , :UPLDER-UPLD-SEQ-NBR                                08947584
089476            , :UPLDER-PKT-TXT                                     08947684
089477             )                                                    08947784
089478     END-EXEC.                                                    08947884
089479                                                                  08947984
089480     EVALUATE TRUE                                                08948084
089481         WHEN SQLCODE = ZERO                                      08948184
089482              ADD 1  TO  PA-CAPTURE-COUNT                         08948285
089483              PERFORM 5020-COMMIT-ERROR                           08948384
089484         WHEN OTHER                                               08948484
089485              MOVE SQLCODE  TO  PV-DISP-SQLCODE                   08948584
089486              MOVE UPLDER-OPER-UNT-ID  TO  PV-DISP-OPER           08948684
089487              DISPLAY 'PCKUT071 - ERROR WRITING TO TUPLDER'       08948784
089488              DISPLAY 'SQLCODE = ' PV-DISP-SQLCODE                08948884
089489              DISPLAY 'UPLDER-OPER-UNT-ID =  ' PV-DISP-OPER       08948984
089490              DISPLAY 'UPLDER-UPLD-TRN-CDE = ' UPLDER-UPLD-TRN-CDE08949084
089491              DISPLAY 'UPLDER-ERR-CDE =      ' UPLDER-ERR-CDE     08949184
089492              DISPLAY 'UPLDER-PRC-TMST =     ' UPLDER-PRC-TMST    08949284
089493              DISPLAY 'UPLDER-PKT-TXT =      ' UPLDER-PKT-TXT     08949384
089494     END-EVALUATE.                                                08949484
089495                                                                  08949584
089496     PERFORM 2250-CHECK-CAPTURE-MESSAGES.                         08949684
089498                                                                  08949884
089499                                                                  08949984
089500******************************************************************08950084
089501* CHECK TO SEE IF MESSAGES HAVE SHOULD BE CAPTURED IN THE RUN     08950184
089502* IF SO ALL MESSAGE WILL BE WRITTEN TO UPLDER AS TYPE E           08950284
089503******************************************************************08950384
089504 2250-CHECK-CAPTURE-MESSAGES.                                     08950484
089505                                                                  08950584
089506     EXEC SQL                                                     08950684
089507         SELECT FUNC_TXT                                          08950784
089508         INTO :KRPRPM-FUNC-TXT                                    08950884
089509         FROM                                                     08950984
089510             TKRPRPM                                              08951084
089511         WHERE                                                    08951184
089520             LOC_ID                   = 90                        08952084
089530         AND INTFC_SYS_CDE            = 'DLX'                     08953084
089540         AND SYS_PRC_FUNC_CDE         = 'DLCAPT'                  08954084
089543         WITH UR                                                  08954384
089544     END-EXEC.                                                    08954484
089545                                                                  08954584
089546     EVALUATE TRUE                                                08954684
089547         WHEN SQLCODE = ZERO                                      08954784
089548             CONTINUE                                             08954884
089549                                                                  08954984
089550         WHEN OTHER                                               08955084
089553             MOVE SQLCODE             TO  PV-DISP-SQLCODE         08955384
089554             MOVE KRPRPM-LOC-ID       TO  PV-DISP-OPER            08955484
089555             DISPLAY ' PCKUT071 - 2250 - '                        08955584
089556                     ' SQLCODE: '         PV-DISP-SQLCODE         08955684
089557                     ' TKRPRPM - 90 - DLCAPT'                     08955784
089582     END-EVALUATE.                                                08958284
089583                                                                  08958384
089587                                                                  08958784
089590******************************************************************08959049
089600* CALL THE APPROPRIATE MODULE TO PROCESS THE RECORD               08960049
089700******************************************************************08970049
089800 2500-CALL-LABOR-MODULE.                                          08980049
089900                                                                  08990049
090000     MOVE '2500-CALL-LABOR-MODULE'     TO PV-PARAGRAPH.           09000049
090100                                                                  09010049
090200*    DISPLAY '2500-CALL-LABOR-MODULE.   '.                        09020049
090300                                                                  09030049
090400     EVALUATE TRUE                                                09040049
090500         WHEN PS-XML-PCKMD                                        09050049
090510                                                                  09051094
090520***           DISPLAY  'PCKUT071 - PICKMADE '                     09052099
090521***           DISPLAY  PC243-COMMAREA                             09052199
090522***           DISPLAY  PC058-UPLOAD-ERROR-RECORD                  09052299
090523***           DISPLAY  '                    '                     09052399
090530                                                                  09053094
090600              MOVE PC-PGM-PCKMD      TO  PV-CALLED-PROGRAM        09060057
090700              CALL PC-PGM-PCKMD      USING PC243-COMMAREA         09070057
090800              MOVE PC243-CRA-RET-CDE TO PV-CRA-RET-CDE            09080049
090900              MOVE PC243-CRA-RET-MSG TO PV-CRA-RET-MSG            09090063
091000                                                                  09100072
091100         WHEN PS-XML-INBLN                                        09110049
091101                                                                  09110194
091110***           DISPLAY  'PCKUT071 - inbound launch '               09111099
091120***           DISPLAY  PC244-COMMAREA                             09112099
091130***           DISPLAY  '                    '                     09113099
091140                                                                  09114094
091200              MOVE PC-PGM-INBLN      TO  PV-CALLED-PROGRAM        09120057
091300              CALL PC-PGM-INBLN      USING PC244-COMMAREA         09130049
091400              MOVE PC244-CRA-RET-CDE TO PV-CRA-RET-CDE            09140049
091500              MOVE PC244-CRA-RET-MSG TO PV-CRA-RET-MSG            09150063
091600                                                                  09160072
091700         WHEN PS-XML-BXOPN                                        09170049
091710                                                                  09171094
091720***           DISPLAY  'PCKUT071 - box open       '               09172099
091730***           DISPLAY  PC245-COMMAREA                             09173099
091740***           DISPLAY  '                    '                     09174099
091750                                                                  09175094
091800              MOVE PC-PGM-BXOPN      TO  PV-CALLED-PROGRAM        09180057
091900              CALL PC-PGM-BXOPN      USING PC245-COMMAREA         09190049
092000              MOVE PC245-CRA-RET-CDE TO PV-CRA-RET-CDE            09200049
092100              MOVE PC245-CRA-RET-MSG TO PV-CRA-RET-MSG            09210063
092200                                                                  09220072
092300         WHEN PS-XML-BXCLS                                        09230049
092310                                                                  09231094
092320****          DISPLAY  'PCKUT071 - box close      '               09232099
092330***           DISPLAY  PC246-COMMAREA                             09233099
092340***           DISPLAY  '                    '                     09234099
092350                                                                  09235094
092400              MOVE PC-PGM-BXCLS      TO  PV-CALLED-PROGRAM        09240057
092500              CALL PC-PGM-BXCLS      USING PC246-COMMAREA         09250049
092600              MOVE PC246-CRA-RET-CDE TO PV-CRA-RET-CDE            09260049
092700              MOVE PC246-CRA-RET-MSG TO PV-CRA-RET-MSG            09270063
092800                                                                  09280067
092900         WHEN OTHER                                               09290049
093300              DISPLAY ' PCKUT071 - 2500-CALL-LABOR '              09330067
093400              ' UNKNOWN MSG:'     PV-MSG                          09340067
093500                                                                  09350095
093700              MOVE '103'           TO PV-ERR-CDE                  09370066
093800              INITIALIZE  PV-UNKNOWN-MSG                          09380057
093900              STRING 'PCKUT071-2500 - CALL-LABOR-MOD - '          09390057
094000                      PS-XML-TYPE-SW ' NO MODULE TO CALL'         09400057
094100                                DELIMITED BY SIZE                 09410057
094200                                 INTO PV-UNKNOWN-MSG              09420057
094300              PERFORM 5000-WRITE-ERROR-REC                        09430049
094400              SET PV-ERROR         TO TRUE                        09440049
094500     END-EVALUATE.                                                09450049
094600                                                                  09460049
094700     IF PV-SUCCESSFUL                                             09470049
094800         ADD 1       TO  PA-UPDATES-PROCESSED                     09480075
094810         MOVE ZEROES TO  PA-CONSECUTIVE-ERRORS                    09481075
094811         EVALUATE TRUE                                            09481183
094812             WHEN PS-XML-PCKMD                                    09481283
094820                  ADD  1  TO  PA-PICKMADE-COUNT                   09482083
094821             WHEN PS-XML-INBLN                                    09482183
094830                  ADD  1  TO  PA-LAUNCH-COUNT                     09483083
094831             WHEN PS-XML-BXOPN                                    09483183
094840                  ADD  1  TO  PA-BOXOPEN-COUNT                    09484083
094841             WHEN PS-XML-BXCLS                                    09484183
094850                  ADD  1  TO  PA-BOXCLOSE-COUNT                   09485083
094851             WHEN OTHER                                           09485183
094860                  ADD  1  TO  PA-UNKNOWN-MSG-CNT                  09486083
094870         END-EVALUATE                                             09487083
094902     ELSE                                                         09490281
094903         EVALUATE TRUE                                            09490383
094904             WHEN PS-XML-PCKMD                                    09490483
094905                  ADD  1  TO  PA-BAD-PICKMADE-COUNT               09490583
094906             WHEN PS-XML-INBLN                                    09490683
094907                  ADD  1  TO  PA-BAD-LAUNCH-COUNT                 09490783
094908             WHEN PS-XML-BXOPN                                    09490883
094909                  ADD  1  TO  PA-BAD-BOXOPEN-COUNT                09490983
094910             WHEN PS-XML-BXCLS                                    09491083
094911                  ADD  1  TO  PA-BAD-BOXCLOSE-COUNT               09491183
094912             WHEN OTHER                                           09491283
094913                  ADD  1  TO  PA-BAD-UNKNOWN-MSG-CNT              09491383
094914         END-EVALUATE                                             09491483
094915         IF  PC243-UNKNOWN-USER  OR                               09491582
094916             PC244-UNKNOWN-USER  OR                               09491682
094917             PC245-UNKNOWN-USER  OR                               09491782
094918             PC246-UNKNOWN-USER                                   09491882
094919             ADD 1       TO  PA-PICK-BAD-USERID                   09491999
094920         ELSE                                                     09492082
094921             ADD 1       TO  PA-CONSECUTIVE-ERRORS                09492181
094930         END-IF                                                   09493081
095300          DISPLAY ' PCKUT071 - 2500-CALL-LABOR '                  09530067
095400                  ' BAD RETURN '                                  09540067
095500                  ' XML-TYPE:'  PS-XML-TYPE-SW                    09550067
095600         IF  PS-XML-PCKMD                                         09560067
095700             DISPLAY ' PCKUT071 - '                               09570067
095800                     ' FUNCTION:'     PC243-FUNCTION              09580067
095900                     ' CALL PGM:'     PV-CALLED-PROGRAM           09590072
096000                     ' RETURN:'       PC243-CALL-RETURN-AREA      09600067
096100             DISPLAY ' PCKUT071 - '                               09610067
096200                     ' DC:'           PC243-DC-NBR                09620067
096300                     ' LOCATION:'     PC243-LOCATION-NM           09630069
096400                     ' ORDER:'        PC243-HDR-ORD-NBR           09640067
096500                     '-'              PC243-HDR-RCVR-SEQ-NBR      09650067
096600                     '-'              PC243-HDR-ORD-LNE-NBR       09660067
096700                     ' STORE:'        PC243-STR-NBR               09670067
096800                     ' USER ID:'      PC243-PICKER-ID             09680067
096810             DISPLAY ' '                                          09681076
096900         END-IF                                                   09690067
097000         IF  PS-XML-INBLN                                         09700067
097100             DISPLAY ' PCKUT071 - '                               09710067
097200                     ' FUNCTION:'     PC244-FUNCTION              09720067
097300                     ' CALL PGM:'     PV-CALLED-PROGRAM           09730072
097400                     ' RETURN:'       PC244-CALL-RETURN-AREA      09740067
097500             DISPLAY ' PCKUT071 - '                               09750067
097600                     ' DC:'           PC244-DC-NBR                09760067
097700                     ' AREA:'         PC244-AREA-NAME             09770070
097800                     ' LBL:'          PC244-TAG-BAR-CODE-NBR      09780067
097900                     ' ORDER:'        PC244-HDR-ORD-NBR           09790067
098000                     '-'              PC244-HDR-RCVR-SEQ-NBR      09800067
098100                     '-'              PC244-HDR-ORD-LNE-NBR       09810067
098200                     ' USER ID:'      PC244-LAUNCH-USER-ID        09820070
098210             DISPLAY ' '                                          09821080
098300         END-IF                                                   09830067
098400         IF  PS-XML-BXOPN                                         09840067
098500             DISPLAY ' PCKUT071 - '                               09850067
098600                     ' FUNCTION:'     PC245-FUNCTION              09860067
098700                     ' CALL PGM:'     PV-CALLED-PROGRAM           09870072
098800                     ' RETURN:'       PC245-CALL-RETURN-AREA      09880067
098900             DISPLAY ' PCKUT071 - '                               09890067
099000                     ' DC:'           PC245-DC-NBR                09900067
099100                     ' LOCATION:'     PC245-LOCATION-NM           09910067
099200                     ' LBL:'          PC245-BOX-BAR-CODE-NBR      09920067
099300                     ' USER ID:'      PC245-BOXOPEN-USER-ID       09930067
099310             DISPLAY ' '                                          09931080
099400         END-IF                                                   09940067
099500         IF  PS-XML-BXCLS                                         09950067
099600             DISPLAY ' PCKUT071 - '                               09960067
099700                     ' FUNCTION:'     PC246-FUNCTION              09970067
099800                     ' CALL PGM:'     PV-CALLED-PROGRAM           09980072
099900                     ' RETURN:'       PC246-CALL-RETURN-AREA      09990067
100000             DISPLAY ' PCKUT071 - '                               10000067
100100                     ' DC:'           PC246-DC-NBR                10010067
100200                     ' LOCATION:'     PC246-LOCATION-NM           10020067
100300                     ' LBL:'          PC246-BOX-BAR-CODE-NBR      10030067
100400                     ' USER ID:'      PC246-BOXCLOSE-USER-ID      10040067
100410             DISPLAY ' '                                          10041080
100500         END-IF                                                   10050067
100600***                                                               10060067
100700*        DISPLAY 'PCKUT071 - RETURN FROM CALLED PGM: '            10070049
100800*                                           PV-CRA-RET-CDE        10080049
100810         IF  PV-UNKNOWN-USER                                      10081079
100900             MOVE '113'           TO PV-ERR-CDE                   10090079
100901         ELSE                                                     10090179
100910             MOVE '112'           TO PV-ERR-CDE                   10091079
100920         END-IF                                                   10092079
100930                                                                  10093079
101000         INITIALIZE  PV-UNKNOWN-MSG                               10100057
101100         STRING 'PCKUT071-2500 - CALL-LABOR-MOD - '               10110057
101200                 PV-CALLED-PROGRAM ' RET-CDE=' PV-CRA-RET-CDE     10120057
101300                 ' MSG='                       PV-CRA-RET-MSG     10130063
101400                                DELIMITED BY SIZE                 10140057
101500                            INTO PV-UNKNOWN-MSG                   10150057
101600         PERFORM 5000-WRITE-ERROR-REC                             10160049
101700     END-IF.                                                      10170049
101800                                                                  10180049
101830                                                                  10183075
101900******************************************************************10190049
102000* XML ERROR                                                       10200049
102100******************************************************************10210049
102200 3000-XML-ERROR.                                                  10220049
102300                                                                  10230049
102400     MOVE '3000-XML-ERROR'             TO PV-PARAGRAPH.           10240049
102500                                                                  10250049
102600     DISPLAY 'PCKUT071 - 3000-XML-ERROR.               '.         10260099
102700                                                                  10270049
102800     PERFORM 9000-EXPLAIN-XML-RESPONSE                            10280049
102900     PERFORM  VARYING XML-LINE-IDX FROM 1 BY 1                    10290049
103000                UNTIL XML-LINE-IDX > XML-RESPONSE-LINES           10300049
103100         DISPLAY XML-MSG(XML-LINE-IDX)                            10310049
103200     END-PERFORM.                                                 10320049
103300                                                                  10330049
103400     MOVE 000             TO PV-ERR-CDE                           10340049
103500     PERFORM 5000-WRITE-ERROR-REC                                 10350049
103600                                                                  10360049
103700     MOVE +4018              TO PV-ABEND-CODE.                    10370049
103800     PERFORM 9500-ABEND.                                          10380049
103900                                                                  10390049
104000******************************************************************10400049
104100* SUCCESSFUL XML PARSE                                            10410049
104200******************************************************************10420049
104300 3100-XML-SUCCESS.                                                10430049
104400                                                                  10440049
104500     MOVE '3100-XML-SUCCESS'           TO PV-PARAGRAPH.           10450049
104600                                                                  10460049
104700*    DISPLAY 'PCKUT071 - 3100-XML-SUCCESS.             '.         10470099
104800                                                                  10480049
104900     ADD +1 TO PA-XML-PARSED.                                     10490049
105000                                                                  10500049
105100***************************************************************** 10510049
105200* MQ SERIES CLOSE QUEUE                                           10520049
105300***************************************************************** 10530049
105400 4100-MQ-CLOSE-QUEUE.                                             10540049
105500                                                                  10550049
105600*    DISPLAY 'PCKUT071 - 4100-MQ-CLOSE-QUEUE.      '.             10560049
105700                                                                  10570049
105800     MOVE '4100-MQ-CLOSE-QUEUE' TO PV-PARAGRAPH.                  10580049
105900                                                                  10590049
106000     MOVE PV-QUE-NAME               TO MQOD-OBJECTNAME.           10600049
106100     MOVE PV-QMGR-NAME              TO MQOD-OBJECTQMGRNAME.       10610049
106200                                                                  10620049
106300     CALL PC-MQCLOSE USING PV-HCONN                               10630049
106400                           PV-HANDLE                              10640049
106500                           MQCO-NONE                              10650049
106600                           PV-COMPLETION-CODE                     10660049
106700                           PV-REASON.                             10670049
106800                                                                  10680049
106900     IF PV-COMPLETION-CODE = MQCC-OK THEN                         10690049
108400         CONTINUE                                                 10840063
108500     ELSE                                                         10850049
108600         MOVE '109'              TO PV-ERR-CDE                    10860049
108700         MOVE PV-COMPLETION-CODE TO PV-DISPLAY-CDE                10870049
108800         MOVE PV-REASON          TO PV-REASON-CDE                 10880049
108900         INITIALIZE  PV-UNKNOWN-MSG                               10890057
109000         STRING 'PCKUT071-4100-MQ-CLOSE -   '                     10900057
109100                'COMPLETION CODE=' PV-DISPLAY-CDE                 10910057
109200                ' REASON CODE='    PV-REASON-CDE                  10920057
109300                                 DELIMITED BY SIZE                10930057
109400                            INTO PV-UNKNOWN-MSG                   10940057
109500         PERFORM 5000-WRITE-ERROR-REC                             10950049
109600         MOVE +4018              TO PV-ABEND-CODE                 10960049
109700         PERFORM 9500-ABEND                                       10970049
109800     END-IF.                                                      10980049
109900                                                                  10990049
110000***************************************************************** 11000049
110100* DISCONNECT FROM QUEUE MANAGER.                                  11010049
110200***************************************************************** 11020049
110300 4500-MQ-DISCONNECT.                                              11030049
110400                                                                  11040049
110500*    DISPLAY 'PCKUT071 - 4500-MQ-DISCONNECT.           '.         11050049
110600                                                                  11060049
110700     MOVE '4500-MQ-DISCONNECT'    TO PV-PARAGRAPH.                11070049
110800                                                                  11080049
110900     IF PV-CON-REASON NOT = MQRC-ALREADY-CONNECTED                11090049
111000         CALL PC-MQDISC USING PV-HCONN                            11100049
111100                              PV-COMPLETION-CODE                  11110049
111200                              PV-REASON                           11120049
111300                                                                  11130049
111400     IF PV-COMPLETION-CODE = MQCC-OK THEN                         11140049
112900         CONTINUE                                                 11290049
113000     ELSE                                                         11300049
113100         MOVE 0                  TO PV-DC-NBR                     11310049
113200         MOVE '110'              TO PV-ERR-CDE                    11320049
113300         MOVE PV-COMPLETION-CODE TO PV-DISPLAY-CDE                11330049
113400         MOVE PV-REASON          TO PV-REASON-CDE                 11340049
113500         INITIALIZE  PV-UNKNOWN-MSG                               11350057
113600         STRING 'PCKUT071-4500-MQ-DISCONECT '                     11360057
113700                'COMPLETION CODE=' PV-DISPLAY-CDE                 11370057
113800                ' REASON CODE='    PV-REASON-CDE                  11380057
113900                                 DELIMITED BY SIZE                11390057
114000                            INTO PV-UNKNOWN-MSG                   11400057
114100         PERFORM 5000-WRITE-ERROR-REC                             11410049
114200         MOVE +4018              TO PV-ABEND-CODE                 11420049
114300         PERFORM 9500-ABEND                                       11430049
114400     END-IF.                                                      11440049
114500                                                                  11450049
114600***************************************************************** 11460049
114700* WRITE ERROR RECORD TO TUPLDER DATABASE                          11470049
114800***************************************************************** 11480049
114900 5000-WRITE-ERROR-REC.                                            11490049
115000*    DISPLAY 'PCKUT071 - 5000-WRITE-ERROR-REC.         '.         11500049
115100                                                                  11510049
115200     INITIALIZE DCLTUPLDER.                                       11520049
115300     MOVE PV-DC-NBR               TO UPLDER-OPER-UNT-ID.          11530049
115400     MOVE 'D'                     TO UPLDER-UPLD-TRN-CDE.         11540049
115500     MOVE PV-ERR-CDE              TO UPLDER-ERR-CDE.              11550049
115600     PERFORM 5010-GET-CURR-TMST.                                  11560049
115700     MOVE PV-CURRENT-TMST         TO UPLDER-PRC-TMST.             11570049
115800     MOVE 0                       TO UPLDER-UPLD-SEQ-NBR.         11580049
115900                                                                  11590049
116000     EVALUATE TRUE                                                11600049
116100         WHEN PS-XML-PCKMD                                        11610049
116300              MOVE PC243-DC-NBR       TO  PC058-PM-DC-NBR         11630052
116400                                          UPLDER-OPER-UNT-ID      11640052
116500              MOVE PC243-CRA-RET-CDE  TO  PC058-PM-RET-CDE        11650053
116600              MOVE PC058-UPLOAD-ERROR-RECORD TO UPLDER-PKT-TXT    11660052
116700                                                                  11670052
116800         WHEN PS-XML-INBLN                                        11680049
117000              MOVE PC244-DC-NBR       TO  PC057-IL-DC-NBR         11700051
117100                                          UPLDER-OPER-UNT-ID      11710051
117200              MOVE PC244-CRA-RET-CDE  TO  PC057-IL-RET-CDE        11720053
117300              MOVE PC057-UPLOAD-ERROR-RECORD TO UPLDER-PKT-TXT    11730051
117400                                                                  11740051
117500         WHEN PS-XML-BXOPN                                        11750049
117700              MOVE PC245-DC-NBR       TO  PC059-BO-DC-NBR         11770052
117800                                          UPLDER-OPER-UNT-ID      11780052
117900              MOVE PC245-CRA-RET-CDE  TO  PC059-BO-RET-CDE        11790053
118000              MOVE PC059-UPLOAD-ERROR-RECORD TO UPLDER-PKT-TXT    11800052
118100                                                                  11810052
118200         WHEN PS-XML-BXCLS                                        11820049
118400              MOVE PC246-DC-NBR       TO  PC060-BC-DC-NBR         11840052
118500                                          UPLDER-OPER-UNT-ID      11850052
118600              MOVE PC246-CRA-RET-CDE  TO  PC060-BC-RET-CDE        11860053
118700              MOVE PC060-UPLOAD-ERROR-RECORD TO UPLDER-PKT-TXT    11870052
118800                                                                  11880052
118900         WHEN OTHER                                               11890049
119000              MOVE PV-UNKNOWN-MSG  TO  UPLDER-PKT-TXT             11900056
119100                                                                  11910052
119200     END-EVALUATE.                                                11920049
119300                                                                  11930049
119400     IF  PV-ERR-CDE  =  '101'  OR                                 11940062
119500         PV-ERR-CDE  =  '102'  OR                                 11950062
119600         PV-ERR-CDE  =  '111'                                     11960067
119700         MOVE PV-UNKNOWN-MSG  TO  UPLDER-PKT-TXT                  11970061
119800     END-IF.                                                      11980062
119900                                                                  11990061
120000     EXEC SQL                                                     12000049
120100       INSERT INTO TUPLDER                                        12010049
120200             (OPER_UNT_ID                                         12020049
120300            , UPLD_TRN_CDE                                        12030049
120400            , ERR_CDE                                             12040049
120500            , PRC_TMST                                            12050049
120600            , UPLD_SEQ_NBR                                        12060049
120700            , PKT_TXT                                             12070049
120800             )                                                    12080049
120900       VALUES                                                     12090049
121000             (:UPLDER-OPER-UNT-ID                                 12100049
121100            , :UPLDER-UPLD-TRN-CDE                                12110049
121200            , :UPLDER-ERR-CDE                                     12120049
121300            , :UPLDER-PRC-TMST                                    12130049
121400            , :UPLDER-UPLD-SEQ-NBR                                12140049
121500            , :UPLDER-PKT-TXT                                     12150049
121600             )                                                    12160049
121700     END-EXEC.                                                    12170049
121800                                                                  12180049
121900     EVALUATE TRUE                                                12190049
122000         WHEN SQLCODE = ZERO                                      12200049
122100              ADD +1                  TO PA-ERRORS-PROCESSED      12210049
122200              PERFORM 5020-COMMIT-ERROR                           12220049
122300         WHEN OTHER                                               12230049
122400              MOVE SQLCODE  TO  PV-DISP-SQLCODE                   12240057
122500              MOVE UPLDER-OPER-UNT-ID  TO  PV-DISP-OPER           12250057
122600              DISPLAY 'PCKUT071 - ERROR WRITING TO TUPLDER'       12260049
122700              DISPLAY 'SQLCODE = ' PV-DISP-SQLCODE                12270057
122800              DISPLAY 'UPLDER-OPER-UNT-ID =  ' PV-DISP-OPER       12280057
122900              DISPLAY 'UPLDER-UPLD-TRN-CDE = ' UPLDER-UPLD-TRN-CDE12290057
123000              DISPLAY 'UPLDER-ERR-CDE =      ' UPLDER-ERR-CDE     12300057
123100              DISPLAY 'UPLDER-PRC-TMST =     ' UPLDER-PRC-TMST    12310057
123200              DISPLAY 'UPLDER-PKT-TXT =      ' UPLDER-PKT-TXT     12320057
123300     END-EVALUATE.                                                12330049
123400                                                                  12340049
123500***************************************************************** 12350049
123600* GET CURRENT TIMESTAMP FOR ERROR RECORD                          12360049
123700***************************************************************** 12370049
123800 5010-GET-CURR-TMST.                                              12380049
123900                                                                  12390049
124000     EXEC SQL                                                     12400049
124100         SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                 12410049
124200     END-EXEC                                                     12420049
124300                                                                  12430049
124400     EVALUATE TRUE                                                12440049
124500         WHEN SQLCODE = ZERO                                      12450049
124600              CONTINUE                                            12460049
124700         WHEN OTHER                                               12470049
124800              MOVE SPACES         TO PV-CURRENT-TMST              12480049
124900     END-EVALUATE.                                                12490049
125000                                                                  12500049
125100                                                                  12510049
125200******************************************************************12520049
125300* COMMIT THE ERROR RECORD                                         12530049
125400******************************************************************12540049
125500 5020-COMMIT-ERROR.                                               12550049
125600                                                                  12560049
125700     EXEC SQL                                                     12570049
125800         COMMIT                                                   12580049
125900     END-EXEC.                                                    12590049
126000                                                                  12600049
126100     EVALUATE TRUE                                                12610049
126200         WHEN SQLCODE = ZERO                                      12620049
126300         WHEN SQLCODE = +100                                      12630049
126400             CONTINUE                                             12640049
126500         WHEN OTHER                                               12650049
126600              DISPLAY 'PCKUT071 - ERROR ON COMMIT TO TUPLDER'     12660049
126700     END-EVALUATE.                                                12670049
126800                                                                  12680049
126900                                                                  12690049
126901******************************************************************12690199
126902* validate the user id is a Kohls userid                         *12690299
126903******************************************************************12690399
126910 7100-KOHLS-USER.                                                 12691099
126920                                                                  12692099
126930***  DISPLAY '7100-KOHLS-USER   '  XLT00024-USR-ID.               12693099
126940                                                                  12694099
126993     EXEC SQL                                                     12699399
126994          SELECT 'Y'                                              12699499
126995            INTO :PS-USER-FOUND-SW                                12699599
126996            FROM  XLT_USR                                         12699699
126997           WHERE  USR_ID  = :XLT00024-USR-ID                      12699799
126998            WITH UR                                               12699899
126999     END-EXEC.                                                    12699999
127000                                                                  12700099
127001***  MOVE  SQLCODE        TO PV-DISP-SQLCODE                      12700199
127002***  DISPLAY '7100-KOHLS-USER   '  PV-DISP-SQLCODE.               12700299
127003                                                                  12700399
127004     EVALUATE TRUE                                                12700499
127005         WHEN SQLCODE = ZERO                                      12700599
127006              SET  PS-USER-FOUND  TO  TRUE                        12700699
127010                                                                  12701099
127011         WHEN SQLCODE = +100                                      12701199
127012              SET  PS-USER-FOUND-NO  TO  TRUE                     12701299
127018                                                                  12701899
127021              PERFORM 7105-TEMP-USER                              12702199
127022                                                                  12702299
127023         WHEN OTHER                                               12702399
127024             MOVE SQLCODE         TO  PV-DISP-SQLCODE             12702499
127025             DISPLAY ' PCKUT071 - 7100 '                          12702599
127026                     ' SQLCODE: '  PV-DISP-SQLCODE                12702699
127027                     ' QUEUE: P2LLABORQ'                          12702799
127028                                                                  12702899
127029             MOVE '106'           TO PV-ERR-CDE                   12702999
127030             MOVE  SQLCODE        TO PV-DISP-SQLCODE              12703099
127031             INITIALIZE  PV-UNKNOWN-MSG                           12703199
127032             STRING 'PCKUT071-7100-KOHLS-USER '                   12703299
127033                    'QUEUE - P2LLABORQ - WSV_CNSMR_QUE '          12703399
127034                    'SQLCODE = ' PV-DISP-SQLCODE                  12703499
127035                                       DELIMITED BY SIZE          12703599
127036                                  INTO PV-UNKNOWN-MSG             12703699
127037             PERFORM 5000-WRITE-ERROR-REC                         12703799
127038             MOVE +4018           TO PV-ABEND-CODE                12703899
127039             PERFORM 9500-ABEND                                   12703999
127061                                                                  12706199
127062     END-EVALUATE.                                                12706299
127063                                                                  12706399
127064                                                                  12706499
127065 7105-TEMP-USER.                                                  12706599
127066                                                                  12706699
127074***  DISPLAY '7105-TEMP-USER    '  DLT00002-TMP-USR-ID.           12707499
127075                                                                  12707599
127076     EXEC SQL                                                     12707699
127077          SELECT  'Y'                                             12707799
127078            INTO  :PS-USER-FOUND-SW                               12707899
127079            FROM   DLT_TMP_EMP                                    12707999
127080           WHERE  TMP_USR_ID       = :DLT00002-TMP-USR-ID         12708099
127081          WITH UR                                                 12708199
127082     END-EXEC                                                     12708299
127083                                                                  12708399
127084***  MOVE  SQLCODE        TO PV-DISP-SQLCODE                      12708499
127085***  DISPLAY '7105-TEMP-USER    '  PV-DISP-SQLCODE.               12708599
127086                                                                  12708699
127087     EVALUATE TRUE                                                12708799
127088         WHEN SQLCODE = ZERO                                      12708899
127089              SET PS-USER-FOUND      TO TRUE                      12708999
127090                                                                  12709099
127095         WHEN SQLCODE = +100                                      12709599
127096              SET PS-USER-FOUND-NO   TO TRUE                      12709699
127099                                                                  12709999
127106         WHEN OTHER                                               12710699
127107             MOVE SQLCODE         TO  PV-DISP-SQLCODE             12710799
127108             DISPLAY ' PCKUT071 - 7105 '                          12710899
127109                     ' SQLCODE: '  PV-DISP-SQLCODE                12710999
127110                     ' QUEUE: P2LLABORQ'                          12711099
127111                                                                  12711199
127112             MOVE '106'           TO PV-ERR-CDE                   12711299
127113             MOVE  SQLCODE        TO PV-DISP-SQLCODE              12711399
127114             INITIALIZE  PV-UNKNOWN-MSG                           12711499
127115             STRING 'PCKUT071-7105-TEMP-USER '                    12711599
127116                    'QUEUE - P2LLABORQ - WSV_CNSMR_QUE '          12711699
127117                    'SQLCODE = ' PV-DISP-SQLCODE                  12711799
127118                                       DELIMITED BY SIZE          12711899
127119                                  INTO PV-UNKNOWN-MSG             12711999
127120             PERFORM 5000-WRITE-ERROR-REC                         12712099
127121             MOVE +4018           TO PV-ABEND-CODE                12712199
127122             PERFORM 9500-ABEND                                   12712299
127146                                                                  12714699
127147     END-EVALUATE.                                                12714799
127148                                                                  12714899
127149                                                                  12714999
127150******************************************************************12715099
127151* write message to tuplder database when the user id is corrected 12715199
127153******************************************************************12715399
127154 7110-CAPTURE-UPDATE.                                             12715499
127156                                                                  12715699
127157     INITIALIZE DCLTUPLDER.                                       12715799
127158     MOVE PV-DC-NBR               TO UPLDER-OPER-UNT-ID.          12715899
127159     MOVE 'D'                     TO UPLDER-UPLD-TRN-CDE.         12715999
127160     MOVE '113'                   TO UPLDER-ERR-CDE.              12716099
127161     MOVE ZERO                    TO UPLDER-UPLD-SEQ-NBR.         12716199
127162     MOVE PV-UPDATE-MSG           TO UPLDER-PKT-TXT.              12716299
127163                                                                  12716399
127164     EVALUATE TRUE                                                12716499
127165         WHEN PS-XML-PCKMD                                        12716599
127166              MOVE PC243-DC-NBR       TO  UPLDER-OPER-UNT-ID      12716699
127169                                                                  12716999
127170         WHEN PS-XML-INBLN                                        12717099
127171              MOVE PC244-DC-NBR       TO  UPLDER-OPER-UNT-ID      12717199
127175                                                                  12717599
127176         WHEN PS-XML-BXOPN                                        12717699
127177              MOVE PC245-DC-NBR       TO  UPLDER-OPER-UNT-ID      12717799
127181                                                                  12718199
127182         WHEN PS-XML-BXCLS                                        12718299
127183              MOVE PC246-DC-NBR       TO  UPLDER-OPER-UNT-ID      12718399
127187                                                                  12718799
127188         WHEN OTHER                                               12718899
127189              MOVE 'UNK'              TO  UPLDER-ERR-CDE          12718999
127190              MOVE PV-UNKNOWN-MSG     TO  UPLDER-PKT-TXT          12719099
127191                                                                  12719199
127192     END-EVALUATE.                                                12719299
127193                                                                  12719399
127194     EXEC SQL                                                     12719499
127195       INSERT INTO TUPLDER                                        12719599
127196             (OPER_UNT_ID                                         12719699
127197            , UPLD_TRN_CDE                                        12719799
127198            , ERR_CDE                                             12719899
127199            , PRC_TMST                                            12719999
127200            , UPLD_SEQ_NBR                                        12720099
127201            , PKT_TXT                                             12720199
127202             )                                                    12720299
127203       VALUES                                                     12720399
127204             (:UPLDER-OPER-UNT-ID                                 12720499
127205            , :UPLDER-UPLD-TRN-CDE                                12720599
127206            , :UPLDER-ERR-CDE                                     12720699
127207            , CURRENT TIMESTAMP                                   12720799
127208            , :UPLDER-UPLD-SEQ-NBR                                12720899
127209            , :UPLDER-PKT-TXT                                     12720999
127210             )                                                    12721099
127211     END-EXEC.                                                    12721199
127212                                                                  12721299
127213     EVALUATE TRUE                                                12721399
127214         WHEN SQLCODE = ZERO                                      12721499
127215              ADD 1  TO  PA-CAPTURE-COUNT                         12721599
127216              PERFORM 5020-COMMIT-ERROR                           12721699
127217         WHEN OTHER                                               12721799
127218              MOVE SQLCODE  TO  PV-DISP-SQLCODE                   12721899
127219              MOVE UPLDER-OPER-UNT-ID  TO  PV-DISP-OPER           12721999
127220              DISPLAY 'PCKUT071 - 7110-CAPTURE-UPDATE     '       12722099
127221              DISPLAY 'SQLCODE = ' PV-DISP-SQLCODE                12722199
127222              DISPLAY 'UPLDER-OPER-UNT-ID =  ' PV-DISP-OPER       12722299
127223              DISPLAY 'UPLDER-UPLD-TRN-CDE = ' UPLDER-UPLD-TRN-CDE12722399
127224              DISPLAY 'UPLDER-ERR-CDE =      ' UPLDER-ERR-CDE     12722499
127225              DISPLAY 'UPLDER-PRC-TMST =     ' UPLDER-PRC-TMST    12722599
127226              DISPLAY 'UPLDER-PKT-TXT =      ' UPLDER-PKT-TXT     12722699
127227     END-EVALUATE.                                                12722799
127228                                                                  12722899
127229******************************************************************12722999
127230*  COMMIT MQ PROCESSING                                           12723049
127240******************************************************************12724049
127300 8500-MQ-COMMIT.                                                  12730049
127400                                                                  12740049
127500     MOVE '8500-MQ-COMMIT'        TO PV-PARAGRAPH.                12750049
127600                                                                  12760049
127700*    DISPLAY 'PCKUT071 - 8500-MQ-COMMIT.   '                      12770049
127800                                                                  12780049
127900     CALL PC-MQCMIT USING PV-HCONN                                12790049
128000                          PV-COMPLETION-CODE                      12800049
128100                          PV-REASON.                              12810049
128200                                                                  12820049
128300     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        12830049
128400        MOVE '111'              TO PV-ERR-CDE                     12840049
128500        MOVE PV-COMPLETION-CODE TO PV-DISPLAY-CDE                 12850049
128600        MOVE PV-REASON          TO PV-REASON-CDE                  12860049
128700        INITIALIZE  PV-UNKNOWN-MSG                                12870060
128800        STRING 'PCKUT071-8500-MQ-COMMIT  - '                      12880060
128900               'COMPLETION CODE=' PV-DISPLAY-CDE                  12890060
129000               ' REASON CODE='    PV-REASON-CDE                   12900060
129100                                  DELIMITED BY SIZE               12910060
129200                             INTO PV-UNKNOWN-MSG                  12920060
129300        PERFORM 5000-WRITE-ERROR-REC                              12930049
129400     ELSE                                                         12940049
129500        ADD 1 TO PA-MQ-COMMITS                                    12950049
131000     END-IF.                                                      13100049
131100                                                                  13110049
131200***************************************************************** 13120049
131300* EOJ AND DISPLAY SUMMARY TOTALS.                                 13130049
131400***************************************************************** 13140049
131500 9300-EOJ.                                                        13150049
131600                                                                  13160049
131700     MOVE '9300-EOJ'              TO PV-PARAGRAPH.                13170049
131800                                                                  13180049
131900     DISPLAY 'PCKUT071 - 9300-EOJ.                  '.            13190049
132000                                                                  13200049
132100     PERFORM 4100-MQ-CLOSE-QUEUE.                                 13210049
132200     PERFORM 4500-MQ-DISCONNECT.                                  13220049
132300                                                                  13230049
132400     DISPLAY SPACES.                                              13240049
132500     DISPLAY '        PCKUT071 SUMMARY STATISTICS             '   13250049
132600     DISPLAY '************************************************'.  13260049
132700     DISPLAY SPACES                                               13270049
132800     MOVE PA-MQ-MSGS-READ         TO PV-DISPLAY-NBR               13280049
132900     DISPLAY ' MQ MESSAGES READ   = ' PV-DISPLAY-NBR              13290049
133000                                                                  13300049
133100     MOVE PA-XML-PARSED               TO PV-DISPLAY-NBR           13310049
133200     DISPLAY ' MQ MESSAGES PARSED = ' PV-DISPLAY-NBR              13320049
133300                                                                  13330049
133400     MOVE PA-UPDATES-PROCESSED        TO PV-DISPLAY-NBR           13340049
133500     DISPLAY ' RECORDS PROCESSED  = ' PV-DISPLAY-NBR              13350049
133600                                                                  13360049
133700     MOVE PA-CONSECUTIVE-ERRORS       TO PV-DISPLAY-NBR           13370075
133701     DISPLAY ' CONSECUTIVE ERRORS = ' PV-DISPLAY-NBR              13370175
133702                                                                  13370275
133703     MOVE PA-PICK-BAD-USERID          TO PV-DISPLAY-NBR           13370399
133704     DISPLAY ' PICK WITH BAD USRID= ' PV-DISPLAY-NBR              13370499
133705                                                                  13370581
133710     MOVE PA-ERRORS-PROCESSED         TO PV-DISPLAY-NBR           13371075
133800     DISPLAY ' ERRORS PROCESSED   = ' PV-DISPLAY-NBR              13380049
133900                                                                  13390049
134000     MOVE PA-MQ-COMMITS               TO PV-DISPLAY-NBR           13400049
134100     DISPLAY ' MQ COMMITS         = ' PV-DISPLAY-NBR              13410049
134200                                                                  13420049
134300     MOVE PA-END-RUN-MSG-CNT          TO PV-DISPLAY-NBR           13430049
134400     DISPLAY ' STOP RUN MSGS      = ' PV-DISPLAY-NBR              13440049
134500                                                                  13450049
134600     DISPLAY SPACES.                                              13460049
134700     DISPLAY '************************************************'.  13470049
134701     DISPLAY SPACES.                                              13470184
134702                                                                  13470284
134710     MOVE  PA-CAPTURE-COUNT           TO PV-DISPLAY-NBR.          13471084
134720     DISPLAY ' CAPTURED MESSAGES  = ' PV-DISPLAY-NBR              13472084
134721             ' TUPLDER TYPE=E'                                    13472184
134730                                                                  13473084
134800     DISPLAY SPACES.                                              13480049
134802     DISPLAY '******    SUCCESSFUL MESSAGES    ***************'.  13480283
134803     DISPLAY SPACES.                                              13480383
134804                                                                  13480483
134810     MOVE  PA-PICKMADE-COUNT          TO PV-DISPLAY-NBR.          13481083
134811     DISPLAY ' PICKMADE MESSAGES  = ' PV-DISPLAY-NBR              13481183
134812                                                                  13481283
134820     MOVE  PA-LAUNCH-COUNT            TO PV-DISPLAY-NBR.          13482083
134821     DISPLAY ' LAUNCH MESSAGES    = ' PV-DISPLAY-NBR              13482183
134822                                                                  13482283
134830     MOVE  PA-BOXOPEN-COUNT           TO PV-DISPLAY-NBR.          13483083
134831     DISPLAY ' BOXOPEN MESSAGES   = ' PV-DISPLAY-NBR              13483183
134832                                                                  13483283
134840     MOVE  PA-BOXCLOSE-COUNT          TO PV-DISPLAY-NBR.          13484083
134841     DISPLAY ' BOXCLOSE MESSAGES  = ' PV-DISPLAY-NBR              13484183
134842                                                                  13484283
134850     MOVE  PA-UNKNOWN-MSG-CNT         TO PV-DISPLAY-NBR.          13485083
134851     DISPLAY ' UNKNOWN MESSAGES   = ' PV-DISPLAY-NBR              13485183
134852                                                                  13485283
134853     DISPLAY SPACES.                                              13485383
134854     DISPLAY '******   UNSUCCESSFUL MESSAGES   ***************'.  13485483
134855     DISPLAY SPACES.                                              13485583
134856                                                                  13485683
134860     MOVE  PA-BAD-PICKMADE-COUNT      TO PV-DISPLAY-NBR.          13486083
134861     DISPLAY ' PICKMADE MESSAGES  = ' PV-DISPLAY-NBR              13486183
134862                                                                  13486283
134870     MOVE  PA-BAD-LAUNCH-COUNT        TO PV-DISPLAY-NBR.          13487083
134871     DISPLAY ' LAUNCH MESSAGES    = ' PV-DISPLAY-NBR              13487183
134872                                                                  13487283
134880     MOVE  PA-BAD-BOXOPEN-COUNT       TO PV-DISPLAY-NBR.          13488083
134881     DISPLAY ' BOXOPEN MESSAGES   = ' PV-DISPLAY-NBR              13488183
134882                                                                  13488283
134890     MOVE  PA-BAD-BOXCLOSE-COUNT      TO PV-DISPLAY-NBR.          13489083
134891     DISPLAY ' BOXCLOSE MESSAGES  = ' PV-DISPLAY-NBR              13489183
134892                                                                  13489283
134893     MOVE  PA-BAD-UNKNOWN-MSG-CNT     TO PV-DISPLAY-NBR.          13489383
134894     DISPLAY ' UNKNOWN MESSAGES   = ' PV-DISPLAY-NBR              13489483
134910                                                                  13491083
134920     DISPLAY SPACES.                                              13492083
134930     DISPLAY '************************************************'.  13493083
134940     DISPLAY SPACES.                                              13494083
134950                                                                  13495083
135000***************************************************************** 13500049
135100* ABEND PROGRAM - CALL ABEND MODULE                               13510049
135200***************************************************************** 13520049
135300 9500-ABEND.                                                      13530049
135400                                                                  13540049
135500     DISPLAY 'PCKUT071 - 9500-ABEND.                   '.         13550049
135600                                                                  13560049
135700     MOVE SQLCODE               TO PV-SQLCODE.                    13570049
135800     DISPLAY ' '.                                                 13580049
135900     DISPLAY '** ABEND INFO  '.                                   13590049
136000     DISPLAY ' '.                                                 13600049
136100     DISPLAY '** PROGRAM       = ' PC-PGM-NAME.                   13610049
136200     DISPLAY '** PARAGRAPH     = ' PV-PARAGRAPH.                  13620049
136300     DISPLAY ' '.                                                 13630049
136400     DISPLAY '** SQLCODE       = ' PV-SQLCODE.                    13640049
136500     DISPLAY '** MQ CMPLTN CDE = ' PV-DISPLAY-CDE                 13650049
136600     DISPLAY '** MQ REASON CDE = ' PV-REASON-CDE                  13660049
136700     DISPLAY ' '.                                                 13670049
136800                                                                  13680049
136900     CALL 'ILBOABN0'  USING PV-ABEND-CODE.                        13690049
137000                                                                  13700049
137100     COPY ISPD002.                                                13710049
137200     COPY ISPD007.                                                13720049
137300     COPY ISPD008.                                                13730049
137400     COPY ISPD009.                                                13740049
