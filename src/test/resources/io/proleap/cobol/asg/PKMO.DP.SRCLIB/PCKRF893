000100 IDENTIFICATION DIVISION.                                         00010002
000200******************************************************************00020002
000300*  TRAILER MANIFESTING PROJECT - AUDIT FUNCTION SUB MENU          00030002
000400******************************************************************00040002
000600 PROGRAM-ID.             PCKRF893.                                00060002
000700 AUTHOR.                 GERMAN BANDA.                            00070002
000800 INSTALLATION.           KOHLS.                                   00080002
000900 DATE-WRITTEN            JULY,2001.                               00090002
001000 DATE-COMPILED.                                                   00100002
001100                                                                  00110002
001200******************************************************************00120002
001300 ENVIRONMENT DIVISION.                                            00130002
001700 DATA DIVISION.                                                   00170002
001900                                                                  00190002
002100 WORKING-STORAGE SECTION.                                         00210002
002200******************************************************************00220002
002300 01  CA-COMMAREA.                                                 00230002
002400     COPY PCWS233.                                                00240002
002500     05  CA-PROGRAM-DATA.                                         00250002
002600         10  CA-SELECTION-X              PIC  X(01)  VALUE SPACE. 00260002
002700         10  CA-SELECTION  REDEFINES  CA-SELECTION-X              00270002
002800                                         PIC  9(01).              00280002
002900             88  CA-VALID-SELECTION                  VALUE        00290002
003000                 1 2 3.                                           00300002
003100             88  CA-SELECTION-ONE                    VALUE 1.     00310002
003200             88  CA-SELECTION-TWO                    VALUE 2.     00320002
003300             88  CA-SELECTION-THREE                  VALUE 3.     00330002
003400                                                                  00340002
003500 01  PC-PROGRAM-CONSTANTS.                                        00350002
003600     05  PC-TRANSFER-DOWN-LENGTH         PIC S9(04)  VALUE +9     00360002
003700                                                     COMP.        00370002
003800     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00380002
003900         'PCKRF893'.                                              00390002
004000     05  PC-PREV-MENU-PROGRAM            PIC  X(08)               00400002
004100                                              VALUE 'PCKRF892'.   00410045
004200     05  PC-TRLR-AUD-SCAN-CARTON         PIC  X(08)               00420016
004300                                              VALUE 'PCKRF894'.   00430016
004400     05  PC-STARTED-TRLR-AUDIT           PIC  X(08)               00440002
004500                                              VALUE 'PCKRF893'.   00450002
004510     05  PC-PRTR-VALIDATION-PGM          PIC  X(08)               00451045
004520                                              VALUE 'DPKCS060'.   00452045
004530     05  PC-TRLR-CLOSE-PROGRAM           PIC  X(08)               00453069
004540                                              VALUE 'PCKRF876'.   00454069
004541     05  PC-REPORT-PGM                   PIC  X(08)               00454169
004542                                              VALUE 'SUKRP002'.   00454269
004560     05  PC-TRLR-AUDIT-REPORT-PROC       PIC  X(07)               00456076
004570                                              VALUE 'SUK9701'.    00457076
004571     05  PC-TRLR-AUDIT-REPORT-JOB        PIC  X(07)               00457176
004580                                              VALUE 'SUK970 '.    00458076
004581     05  PC-TRLR-AUDIT-REPORT-DESC       PIC  X(16)  VALUE        00458150
004582         'TRAILER AUD REPT'.                                      00458250
004590*                                                                 00459050
004600     05  PC-MENU-TRANID                  PIC  X(04)  VALUE 'E892'.00460002
004610     05  PC-CURRENT-TRANID               PIC  X(04)  VALUE 'E893'.00461017
004620*                                                                 00462050
004700     05  PC-REPORT-REQ-SENT-MSG          PIC  X(19)  VALUE        00470045
004800         'REPORT REQUESTED   '.                                   00480045
004810     05  PC-END-OF-SESSION-MSG           PIC  X(19)  VALUE        00481045
004820         'END OF SESSION     '.                                   00482045
004900     05  PC-INVALID-SELECTION-MSG        PIC  X(19)  VALUE        00490002
005000         'INVALID SELECTION  '.                                   00500002
005010     05  PC-TRLR-AUDIT-CLOSE-MSG         PIC  X(19)  VALUE        00501064
005020         'TRLR AUD ALRDY CLSD'.                                   00502065
005100     05  PC-UNRECOGNIZED-PF-KEY-MSG      PIC  X(19)  VALUE        00510002
005200         'UNRECOGNIZED PF KEY'.                                   00520002
005210     05  PC-INVALID-PRINTER-MSG          PIC  X(19)  VALUE        00521045
005220         'INVALID PRINTER    '.                                   00522045
005300     05  PC-ACCESS-NOT-ALLOWED-MSG       PIC  X(19)  VALUE        00530002
005400         'USER NOT AUTHORIZED'.                                   00540002
005500     05  PC-NON-NUMERIC-SELECTION-MSG    PIC  X(19)  VALUE        00550002
005600         'NUMERIC VALUE REQ. '.                                   00560002
005700     05  PC-PRINTER-NUMBER-REQUIRED      PIC  X(19)  VALUE        00570045
005800         'PRINTER NUMBER REQD'.                                   00580045
005900     05  PC-TRANS-UNAVAILABLE-MSG        PIC  X(19)  VALUE        00590002
006000         'TRANS NOT AVAILABLE'.                                   00600002
006100     05  PC-CICS-ABEND-MSG               PIC  X(19)  VALUE        00610002
006200         'CICS ABEND -CALL DP'.                                   00620002
006300     05  PC-CICSAUTH-MSG                 PIC  X(19)  VALUE        00630002
006400         'CICSAUTH BAD RETURN'.                                   00640002
006500     05  PC-UNAVAIL-SELECTION-MSG        PIC X(19)   VALUE        00650002
006600         'SELECTION NOT AVAIL'.                                   00660002
006610     05  PC-STARTED-TRLR-MESS            PIC X(19)   VALUE        00661005
006620         'STARTED TRLR AUDIT '.                                   00662005
006630     05  PC-CLOSED-TRLR-AUD-MSG          PIC X(19)   VALUE        00663027
006640         'CLOSED TRLR AUDIT  '.                                   00664005
006641     05  PC-CLOSED-AUDIT-MESS            PIC X(19)   VALUE        00664109
006642         'INVLD SEL-AUD CLOSD'.                                   00664209
006643     05  PC-DEFAULT-TIMESTAMP            PIC X(26)   VALUE        00664340
006644                                     '9999-09-09-09.09.09.999999'.00664440
006650     05  PC-AUDIT-RLSE                   PIC X(02)   VALUE 'AR'.  00665008
006651     05  PC-AUDIT-KEEP                   PIC X(02)   VALUE 'AK'.  00665108
006652     05  PC-CM                           PIC X(02)   VALUE 'CM'.  00665226
006653     05  PC-01                           PIC X(02)   VALUE '01'.  00665346
006654     05  PC-TEST                         PIC X(01)   VALUE 'T'.   00665447
006655     05  PC-QA                           PIC X(01)   VALUE 'Q'.   00665547
006656                                                                  00665646
006657     05  PC-AUD-CNTL-NBR                 PIC S9(9) COMP VALUE 0.  00665777
006658     05  PC-NULL-IND                     PIC S9(4) COMP VALUE +0. 00665877
006659                                                                  00665977
007000 01  PS-PROGRAM-SWITCHES.                                         00700002
007100     05  PS-ACCESS-ALLOWED-IND           PIC  X(01)  VALUE 'N'.   00710002
007200         88  PS-NO-ACCESS-ALLOWED                    VALUE 'N'.   00720002
007300         88  PS-ACCESS-ALLOWED                       VALUE 'Y'.   00730002
007310     05  PS-ABEND-IND                    PIC  X(01)  VALUE 'N'.   00731048
007320         88  PS-NO-ABEND-IN-PROGRESS                 VALUE 'N'.   00732048
007330         88  PS-ABEND-IN-PROGRESS                    VALUE 'Y'.   00733048
007340     05  PS-INTERNAL-READER-ENQ-DEQ-IND  PIC  X(01)  VALUE 'D'.   00734048
007350         88  PS-INTERNAL-READER-ENQUEUED             VALUE 'E'.   00735048
007360         88  PS-INTERNAL-READER-DEQUEUED             VALUE 'D'.   00736048
007400                                                                  00740002
007500                                                                  00750002
007600 01  PV-PROGRAM-VARIABLES.                                        00760002
007610     05  PV-SYSID                        PIC  X(04)  VALUE SPACE. 00761073
007620     05  PV-TS-ITEM                      PIC S9(04)  VALUE ZERO   00762073
007630                                                     COMP.        00763073
007640     05  PV-SIGN-ON-INFO-LENGTH          PIC S9(04)  VALUE ZERO   00764073
007650                                                     COMP SYNC.   00765073
007700     05  PV-MESSAGE-AREA                 PIC  X(19)  VALUE SPACE. 00770002
007800     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  00780002
007900                                                     COMP SYNC.   00790002
008100     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     00810002
008101                                                     COMP SYNC.   00810146
008102*                                                                 00810244
008103     05  PC-LEAVE-SYSTEM-LENGTH          PIC S9(04)  VALUE +160   00810349
008104                                                     COMP SYNC.   00810449
008110     05  PV-LEAVE-SYSTEM-MESSAGE         PIC X(160)  VALUE SPACES.00811044
008120     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 00812044
008130     05  PV-SYSTEM-ID.                                            00813044
008140         10  FILLER                      PIC  X(04)  VALUE SPACE. 00814044
008150         10  PV-REGION-IND               PIC  X(01).              00815044
008160             88  PV-TEST-CICS                        VALUE 'T'.   00816044
008170             88  PV-QA-CICS                          VALUE 'Q'.   00817044
008180             88  PV-PROD-CICS                        VALUE 'P'.   00818044
008190             88  PV-LEARN-CICS                       VALUE 'L'.   00819044
008191         10  FILLER                      PIC  X(03)  VALUE SPACES.00819144
008192     05  PV-PRINTER-DESTINATION          PIC  X(08)  VALUE SPACES.00819244
008193     05  PV-JOB-DESCRIPTION              PIC  X(16)  VALUE SPACES.00819344
008194     05  PV-JOB-PROC                     PIC  X(07)  VALUE SPACES.00819444
008195     05  PV-JOB-NAME                     PIC  X(07)  VALUE SPACES.00819544
008196     05  PV-RETURN-TRANSID               PIC  X(04)  VALUE SPACES.00819644
008300                                                                  00830002
008310 01  TS-TEMP-STORAGE-QUEUE-INFO.                                  00831015
008320     05  TS-INFO-QUEUE-NAME.                                      00832015
008330         10  TS-INFO-QUEUE-TERMINAL      PIC  X(04)  VALUE SPACE. 00833015
008340         10  FILLER                      PIC  X(04)  VALUE 'INFO'.00834015
008350                                                                  00835015
008360*----------------------------------------------------------------*00836015
008370*  JCL LINES FOR REQUESTING THE COMPLETION/EXCEPTION REPORTS      00837015
008380*----------------------------------------------------------------*00838015
008391 01  JL-JCL-LINE-AREA.                                            00839115
008392     05  JL-JCL-LINE-1           PIC X(80).                       00839215
008393     05  JL-JOB-LINE-PROD.                                        00839315
008394         10  FILLER              PIC X(02)    VALUE               00839415
008395             '//'.                                                00839515
008396         10  JL-PROD-JOB-NAME    PIC X(07)    VALUE SPACE.        00839615
008397         10  FILLER              PIC X(12)    VALUE               00839715
008398             '  JOB KOHLS,'.                                      00839815
008399         10  FILLER              PIC X(1)     VALUE QUOTE.        00839915
008400         10  JL-PROD-JOB-DESC    PIC X(16)    VALUE SPACES.       00840015
008401         10  FILLER              PIC X(1)     VALUE QUOTE.        00840115
008402         10  FILLER              PIC X(19)    VALUE               00840215
008403             ',MSGCLASS=P,CLASS=U'.                               00840315
008404         10  FILLER              PIC X(13)    VALUE SPACES.       00840415
008405     05  JL-JOB-LINE-TEST.                                        00840515
008406         10  FILLER              PIC X(02)    VALUE               00840615
008407             '//'.                                                00840715
008408         10  JL-TEST-JOB-NAME    PIC X(07)    VALUE SPACES.       00840815
008409         10  FILLER              PIC X(01)    VALUE               00840915
008410             'Q'.                                                 00841015
008411         10  FILLER              PIC X(11)    VALUE               00841115
008412             ' JOB KOHLS,'.                                       00841215
008413         10  FILLER              PIC X(1)     VALUE QUOTE.        00841315
008414         10  JL-TEST-JOB-DESC    PIC X(16)    VALUE SPACES.       00841415
008415         10  FILLER              PIC X(1)     VALUE QUOTE.        00841515
008416         10  FILLER              PIC X(19)    VALUE               00841615
008417             ',MSGCLASS=X,CLASS=E'.                               00841715
008418         10  FILLER              PIC X(15)    VALUE SPACES.       00841815
008419     05  JL-JCL-LINE-3.                                           00841915
008420         10  FILLER              PIC X(13)    VALUE               00842015
008421             '/*JOBPARM K=0'.                                     00842115
008422         10  FILLER              PIC X(67)    VALUE SPACES.       00842215
008423     05  JL-JCL-LINE-4-PROD.                                      00842315
008424         10  FILLER              PIC X(39)    VALUE               00842415
008425             '//JOBLIB   DD DSN=PKMO.LOADLIB,DISP=SHR'.           00842515
008426         10  FILLER              PIC X(41)    VALUE SPACES.       00842615
008427     05  JL-JCL-LINE-4-TEST.                                      00842715
008428         10  FILLER              PIC X(39)    VALUE               00842815
008429             '//JOBLIB   DD DSN=TKMA.LOADLIB,DISP=SHR'.           00842915
008430         10  FILLER              PIC X(41)    VALUE SPACES.       00843015
008431     05  JL-JCL-LINE-4-QA.                                        00843115
008432         10  FILLER              PIC X(39)    VALUE               00843215
008433             '//JOBLIB   DD DSN=QKMO.LOADLIB,DISP=SHR'.           00843315
008434         10  FILLER              PIC X(41)    VALUE SPACES.       00843415
008439     05  JL-JCL-LINE-12.                                          00843915
008440         10  FILLER              PIC X(16)    VALUE               00844015
008441             '//PS020    EXEC '.                                  00844115
008442         10  JL-LINE-12-PROC     PIC X(07)    VALUE SPACES.       00844215
008443         10  JL-LINE-12-PROC-T   PIC X(01)    VALUE SPACES.       00844315
008444         10  FILLER              PIC X(55)    VALUE SPACES.       00844415
008445     05  JL-JCL-LINE-13.                                          00844515
008446         10  FILLER              PIC  X(34)  VALUE                00844615
008447             '//JOBOUT01 OUTPUT FORMS=STD,FCB=8S'.                00844715
008448         10  FILLER              PIC  X(17)  VALUE                00844815
008449             ',CLASS=A,COPIES=1'.                                 00844915
008450         10  FILLER              PIC  X(06)  VALUE                00845015
008451             ',DEST='.                                            00845115
008452         10  JL-LINE-13-PRINTER  PIC  X(08)  VALUE SPACES.        00845215
008453         10  FILLER              PIC  X(16)  VALUE SPACE.         00845315
008454*BUILD TRIP CONTROL CARD-SUCC035                                  00845453
008455     05  JL-JCL-LINE-14.                                          00845545
008456         10  FILLER              PIC X(18)    VALUE               00845645
008457             '//S010.SYSUT1 DD *'.                                00845745
008458         10  FILLER              PIC X(62)    VALUE SPACES.       00845845
008459     05  JL-JCL-LINE-15.                                          00845945
008460         10  JL-LINE-15-AUD-CNTL-NBR PIC X(09).                   00846045
008461*TK NUMBER                                                        00846145
008462         10  FILLER              PIC X(01)    VALUE SPACES.       00846245
008463         10  JL-LINE-15-USER-ID  PIC X(08).                       00846345
008466         10  FILLER              PIC X(62)    VALUE SPACES.       00846645
008467     05  JL-JCL-LINE-EOF.                                         00846746
008468         10  FILLER              PIC X(5)     VALUE '/*EOF'.      00846846
008469         10  FILLER              PIC X(75)    VALUE SPACES.       00846946
008470                                                                  00847046
008471 01  TD-TRANSIENT-DATA-AREA.                                      00847146
008472     05  TD-QUEUE-NAME           PIC X(4)     VALUE 'IRTD'.       00847246
008473     05  TD-QUEUE-NAME-LENGTH    PIC S9(4)    VALUE +4            00847346
008474                                 COMP SYNC.                       00847446
008475     05  TD-JCL-LINE             PIC X(80)    VALUE SPACES.       00847546
008476     05  TD-JCL-LINE-LENGTH      PIC S9(4)    VALUE +80           00847646
008477                                 COMP SYNC.                       00847746
008478                                                                  00847846
008479                                                                  00847946
008480 01  SE-SYSTEM-ERROR-MESSAGE.                                     00848046
008481     05  FILLER                  PIC X(43)    VALUE               00848146
008482         'A SYSTEM ERROR HAS OCCURRED - CONTACT DP - '.           00848246
008483     05  FILLER                  PIC X(33)    VALUE               00848346
008484         'PROGRAM RFKCS215       EIBRESP = '.                     00848446
008485     05  SE-CICS-RESPONSE        PIC 9(4)     VALUE ZERO.         00848546
008486     05  FILLER                  PIC X(5)     VALUE SPACES.       00848646
008487     05  FILLER                  PIC X(14)    VALUE               00848746
008488         'ATTEMPTING TO '.                                        00848846
008489     05  SE-ATTEMPTED-ACTION     PIC X(61)    VALUE SPACES.       00848946
008490*----------------------------------------------------------------*00849045
008491*  TEMPORARY STORAGE QUEUE LAYOUT FOR LOGON/UNIT RELATED          00849145
008492*  INFORMATION CAPTURED BY THE NAVIGATOR AT LOGON TIME            00849245
008493*----------------------------------------------------------------*00849345
008494     COPY DPWS026.                                                00849445
008495                                                                  00849545
008496*----------------------------------------------------------------*00849645
008497*  SENDING/RECEIVING AREA FOR THE                                 00849745
008498*  PRINTER VALIDATION ROUTING (DPKCS060)                          00849845
008499*----------------------------------------------------------------*00849945
008500     COPY DPWS072.                                                00850045
008501                                                                  00850145
008502******************************************************************00850202
008510*  LAYOUT FOR THE AUDIT PROCESS SCREENS                           00851002
008600******************************************************************00860002
008700     COPY PCWS045.                                                00870045
008800                                                                  00880002
008810* HELP SCREEN COMMAREA                                            00881058
008820     COPY PCWS192.                                                00882058
008830* HELP SCREEN WORK AREA                                           00883058
008840     COPY PCWS188.                                                00884058
008900******************************************************************00890002
009000*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               00900002
009100******************************************************************00910002
009200     COPY DPWS013.                                                00920058
009300                                                                  00930002
009400******************************************************************00940002
009500*    COPY BOOK FOR THE CICSAUTH SUBROUTINE                        00950002
009600******************************************************************00960002
009700     COPY DPWS008.                                                00970058
009800                                                                  00980002
009900******************************************************************00990002
010000*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 01000002
010100******************************************************************01010002
010200     COPY DPWS010I.                                               01020058
010300                                                                  01030002
010400******************************************************************01040002
010500*  GENERATED DSECT FOR THE PCKM893 MAPSET                         01050002
010600******************************************************************01060002
010700     COPY PCKM893.                                                01070058
010800                                                                  01080002
010900******************************************************************01090002
011000*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   01100002
011100******************************************************************01110002
011200     COPY DPWS015.                                                01120058
011300                                                                  01130002
011400******************************************************************01140002
011500*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      01150002
011600******************************************************************01160002
011700     COPY DFHAID.                                                 01170058
011800                                                                  01180002
011900******************************************************************01190002
012000*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      01200002
012100*  AUDIT TABLE (TSUNAUD)                                          01210002
012200******************************************************************01220002
012300     EXEC SQL                                                     01230002
012400         INCLUDE TSUNAUD                                          01240002
012500     END-EXEC.                                                    01250002
012600                                                                  01260002
012601******************************************************************01260110
012602*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE OUTBND TRIP STATUS 01260210
012603*  TABLE (TSUOBTS)                                                01260310
012604******************************************************************01260410
012605     EXEC SQL                                                     01260510
012606         INCLUDE TSUOBTS                                          01260610
012607     END-EXEC.                                                    01260710
012608                                                                  01260810
012609******************************************************************01260962
012610*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE COMPAMY CONTROL    01261062
012611*  TABLE (TCOCNTL)                                                01261162
012612******************************************************************01261262
012613     EXEC SQL                                                     01261362
012614         INCLUDE TCOCNTL                                          01261462
012615     END-EXEC.                                                    01261562
012616                                                                  01261662
012617******************************************************************01261774
012618*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE AUDIT TRAILER      01261874
012619*  TRIP TABLE (SUT_AUD_TRLR_TRIP)                                 01261974
012620******************************************************************01262074
012621     EXEC SQL                                                     01262174
012622         INCLUDE SUT00004                                         01262274
012623     END-EXEC.                                                    01262374
012624                                                                  01262474
012625******************************************************************01262574
012626*  COMMUNICATIONS AREA FOR DB2                                    01262674
012630******************************************************************01263002
012640     EXEC SQL                                                     01264002
012650         INCLUDE SQLCA                                            01265002
012660     END-EXEC.                                                    01266002
012670                                                                  01267002
012680******************************************************************01268002
012690 LINKAGE SECTION.                                                 01269002
012700******************************************************************01270002
012800 01  DFHCOMMAREA.                                                 01280002
012900     05  FILLER                         OCCURS  1 TO 4072 TIMES   01290002
013000                                      DEPENDING ON EIBCALEN.      01300002
013010         10  FILLER                   PIC X.                      01301002
013020                                                                  01302002
013030******************************************************************01303002
013040 PROCEDURE DIVISION.                                              01304002
013050******************************************************************01305002
013060 0000-PROGRAM-MAINLINE.                                           01306002
013090     MOVE DFHCOMMAREA                TO CA-COMMAREA.              01309002
013100     MOVE PC233-HOST-SAVE-AREA       TO PC045-COMMAREA-REC.       01310002
013200     MOVE LOW-VALUES                 TO PC893AI.                  01320002
013300                                                                  01330002
013400     EVALUATE TRUE                                                01340002
013500         WHEN EIBCALEN = ZERO                                     01350002
013600         WHEN EIBAID = DFHCLEAR                                   01360002
013700         WHEN PC233-INITIALIZE-SCREEN                             01370002
013701              PERFORM 1300-FIND-LOGON-INFO                        01370173
013702              SET PC233-PROCESS-SCREEN TO TRUE                    01370223
013703              IF PC045-AUDIT-INPROCESS                            01370343
013704                 MOVE PC-STARTED-TRLR-MESS                        01370443
013705                                        TO ASTATUSO               01370543
013708              ELSE                                                01370842
013711                 MOVE PC-CLOSED-TRLR-AUD-MSG                      01371143
013712                                        TO ASTATUSO               01371243
013713              END-IF                                              01371342
013720              MOVE PC045-AUDIT-CNTL-NBR TO ACNTLO                 01372003
013800              MOVE PC045-TRLR-SRL-NBR   TO ATRLRO                 01380002
013810              IF PC045-PRINTER-DEST > SPACES                      01381068
013820                 MOVE PC045-PRINTER-DEST TO APRTRO                01382068
013821              ELSE                                                01382173
013822                 PERFORM 4020-GET-DEFAULT-PRINTER                 01382273
013823                 MOVE PC045-PRINTER-DEST TO APRTRO                01382373
013830              END-IF                                              01383068
013900              MOVE PC045-TRLR-SRL-NBR   TO ATRLRO                 01390068
014400              PERFORM 8000-SEND-MAP                               01440002
014500              PERFORM 8200-RETURN-TRANID                          01450002
014501                                                                  01450158
014510         WHEN EIBTRNID = 'Z278'                                   01451058
014520*            RETURNING FROM F1 HELP INFO SCREEN                   01452058
014530             MOVE DFHCOMMAREA         TO PC192-COMMAREA           01453058
014540             MOVE PC192-HOST-SAVE-AREA                            01454058
014550                                      TO CA-COMMAREA              01455058
014560             SET PC233-PROCESS-SCREEN TO TRUE                     01456058
014570             MOVE PC192-HOST-SAVE-MAP TO PC893AO                  01457059
014580             MOVE -1                  TO ASELECTL                 01458059
014590             PERFORM 8000-SEND-MAP                                01459058
014591             PERFORM 8200-RETURN-TRANID                           01459160
014592                                                                  01459258
014600         WHEN EIBAID = DFHENTER                                   01460002
014700              PERFORM 1000-RECEIVE-MAP                            01470002
014800              PERFORM 1100-EDIT-SELECTION                         01480002
014801                                                                  01480158
014810         WHEN EIBAID = DFHPF1                                     01481058
014820             PERFORM 1000-RECEIVE-MAP                             01482060
014830             MOVE PC893AO             TO PC192-HOST-SAVE-MAP      01483059
014840             PERFORM 1200-HELP-SCREEN                             01484058
014850                                                                  01485058
014900                                                                  01490002
015000         WHEN EIBAID = DFHPF3                                     01500002
015010              IF PC045-CLOSE-AUDIT-KEEP                           01501069
015020                 MOVE PC-TRLR-CLOSE-PROGRAM                       01502069
015021                                     TO PV-TRANSFER-PROGRAM       01502169
015030              ELSE                                                01503069
015100                 MOVE PC233-ROOT-PROGRAM                          01510069
015200                                     TO PV-TRANSFER-PROGRAM       01520002
015400              END-IF                                              01540069
015410              PERFORM 2100-XCTL-TO-SELECTED-PROGRAM               01541070
015500         WHEN OTHER                                               01550002
015600              MOVE PC-UNRECOGNIZED-PF-KEY-MSG                     01560002
015700                                     TO AMSGLNO                   01570002
015800              PERFORM 8100-SEND-DATA-ONLY                         01580002
015900              PERFORM 8200-RETURN-TRANID                          01590002
016000     END-EVALUATE.                                                01600002
016100                                                                  01610002
016200     GOBACK.                                                      01620002
016300*                                                                 01630002
016400*                                                                 01640002
016500 1000-RECEIVE-MAP.                                                01650002
016600     EXEC CICS                                                    01660002
016700         RECEIVE MAP    ('PC893A')                                01670002
016800                 MAPSET ('PCKM893')                               01680002
016900                 RESP   (PV-CICS-RESPONSE)                        01690002
017000     END-EXEC.                                                    01700002
017100                                                                  01710002
017200     EVALUATE TRUE                                                01720002
017300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 01730002
017400              PERFORM 1010-RECEIVE-SCREEN-FIELDS                  01740002
017500         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                01750002
017600              CONTINUE                                            01760002
017700         WHEN OTHER                                               01770002
017800              MOVE '1000-RECEIVE-MAP'                             01780002
017900                                     TO DP013-PARAGRAPH           01790002
018000              MOVE 'UNABLE TO RECEIVE MAP'                        01800002
018100                                     TO DP013-MESSAGE-TEXT (1)    01810002
018200              SET DP013-LOGIC-ABEND  TO TRUE                      01820002
018300              SET DP013-NO-ROLLBACK  TO TRUE                      01830002
018400              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              01840002
018500     END-EVALUATE.                                                01850002
018600*                                                                 01860002
018700*                                                                 01870002
018800 1010-RECEIVE-SCREEN-FIELDS.                                      01880002
018900     IF  ASELECTL > ZERO                                          01890002
019000         MOVE ASELECTI               TO CA-SELECTION-X            01900002
019100     END-IF.                                                      01910002
019101                                                                  01910145
019110     IF  APRTRL   > ZERO                                          01911045
019120         MOVE APRTRI                 TO PC045-PRINTER-DEST        01912045
019130     END-IF.                                                      01913045
019200*                                                                 01920002
019300*                                                                 01930002
019400 1100-EDIT-SELECTION.                                             01940002
019500     MOVE CA-SELECTION-X             TO DP010I-UNEDITED-FIELD.    01950002
019600     MOVE 1                          TO DP010I-MAXIMUM-DIGITS.    01960002
019700     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  01970002
019800     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     01980002
019900                                                                  01990002
020010     CALL DP010I-NUMERIC-EDIT-ROUTINE                             02001079
020020                         USING DP010I-NUMERIC-EDIT-AREA           02002079
020100                                                                  02010002
020200     IF  DP010I-ERROR-DETECTED                                    02020002
020300         MOVE PC-NON-NUMERIC-SELECTION-MSG                        02030002
020400                                     TO AMSGLNO                   02040002
020500         PERFORM 8100-SEND-DATA-ONLY                              02050002
020600         PERFORM 8200-RETURN-TRANID                               02060002
020700     ELSE                                                         02070002
020800         MOVE DP010I-NUMERIC-FIELD   TO CA-SELECTION              02080002
020900     END-IF.                                                      02090002
021000                                                                  02100002
021100     EVALUATE TRUE                                                02110002
021200     WHEN CA-VALID-SELECTION                                      02120002
021300         IF PC045-AUDIT-INPROCESS                                 02130043
021400            PERFORM 2000-PROCESS-SELECTION                        02140009
021410         ELSE                                                     02141028
021411*** PRINT REPORTS IS ONLY VALID SELECTION ON A CLOSED AUDIT       02141145
021420            IF CA-SELECTION-THREE                                 02142028
021422               PERFORM 2000-PROCESS-SELECTION                     02142228
021423            ELSE                                                  02142328
021424               MOVE DP015-UNP-NUM-BRT-MDT  TO ASELECTA            02142428
021425               MOVE PC-TRLR-AUDIT-CLOSE-MSG                       02142564
021426                                           TO AMSGLNO             02142628
021427               PERFORM 8100-SEND-DATA-ONLY                        02142728
021428               PERFORM 8200-RETURN-TRANID                         02142828
021440            END-IF                                                02144028
021450         END-IF                                                   02145028
021500     WHEN OTHER                                                   02150002
021600         MOVE DP015-UNP-NUM-BRT-MDT  TO ASELECTA                  02160002
021700         MOVE PC-INVALID-SELECTION-MSG                            02170027
021800                                     TO AMSGLNO                   02180002
021900         PERFORM 8100-SEND-DATA-ONLY                              02190002
022000         PERFORM 8200-RETURN-TRANID                               02200002
022100     END-EVALUATE.                                                02210002
022200*                                                                 02220002
022210 1200-HELP-SCREEN.                                                02221058
022220     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      02222058
022230     MOVE PC-CURRENT-PROGRAM-NAME     TO PC192-PROGRAM-NAME       02223058
022240     COPY PCPD188.                                                02224058
022250     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      02225058
022260     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA     02226058
022270     PERFORM 2150-XCTL-TO-HELP.                                   02227058
022280                                                                  02228058
022290******************************************************************02229073
022291*  FIND THE LOCATION OF THE TERMINAL OR PC AND THE USERID OF THE  02229173
022292*  PERSON THAT IS CURRENTLY LOGGED ON.  IF WE ARE RUNNING IN      02229273
022293*  CICST1, PV-SYSID WILL BE SPACES BECAUSE THE TERMINAL AND       02229373
022294*  APPLICATION REGIONS ARE BOTH CICST1.  IF WE ARE IN PRODUCTION, 02229473
022295*  PV-SYSID WILL NOT BE SPACES BECAUSE OF THE SPLIT REGION        02229573
022296*  PROCESSING.  IN PRODUCTION, THE APPLICATION REGION IS CICSP4,  02229673
022297*  WHILE THE TERMINAL REGION (WHERE WE NEED TO GET OUR REQUESTED  02229773
022298*  INFORMATION) IS CICSP1.                                        02229873
022299******************************************************************02229973
022300 1300-FIND-LOGON-INFO.                                            02230073
022301     MOVE LENGTH OF DP026-SIGN-ON-INFO                            02230173
022302                    TO  PV-SIGN-ON-INFO-LENGTH.                   02230273
022303     MOVE EIBTRMID  TO  TS-INFO-QUEUE-TERMINAL.                   02230373
022304     MOVE +1        TO  PV-TS-ITEM.                               02230473
022305                                                                  02230573
022306     IF PV-SYSID = SPACES                                         02230673
022307         EXEC CICS                                                02230773
022308             READQ TS                                             02230873
022309                 QUEUE  (TS-INFO-QUEUE-NAME)                      02230973
022310                 ITEM   (PV-TS-ITEM)                              02231073
022311                 INTO   (DP026-SIGN-ON-INFO)                      02231173
022312                 RESP   (PV-CICS-RESPONSE)                        02231273
022313         END-EXEC                                                 02231373
022314     ELSE                                                         02231473
022315         EXEC CICS                                                02231573
022316             READQ TS                                             02231673
022317                 QUEUE   (TS-INFO-QUEUE-NAME)                     02231773
022318                 SYSID   (PV-SYSID)                               02231873
022319                 ITEM    (PV-TS-ITEM)                             02231973
022320                 INTO    (DP026-SIGN-ON-INFO)                     02232073
022321                 LENGTH  (PV-SIGN-ON-INFO-LENGTH)                 02232173
022322                 RESP    (PV-CICS-RESPONSE)                       02232273
022323         END-EXEC                                                 02232373
022324     END-IF.                                                      02232473
022325                                                                  02232573
022326     EVALUATE TRUE                                                02232673
022327         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02232773
022328             CONTINUE                                             02232873
022330         WHEN OTHER                                               02233073
022331             MOVE '1300-FIND-LOGON-INFO'                          02233173
022332                 TO DP013-PARAGRAPH                               02233273
022333             MOVE 'UNABLE TO READ LOGON TSQ'                      02233373
022334                 TO DP013-MESSAGE-TEXT (1)                        02233473
022335             SET DP013-CICS-ABEND     TO TRUE                     02233573
022336             SET DP013-NO-ROLLBACK    TO TRUE                     02233673
022337             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               02233773
022340             PERFORM 8100-SEND-DATA-ONLY                          02234073
022341             PERFORM 8200-RETURN-TRANID                           02234173
022342     END-EVALUATE.                                                02234273
022343                                                                  02234373
022344*                                                                 02234473
022350*                                                                 02235002
022400 2000-PROCESS-SELECTION.                                          02240002
022401                                                                  02240154
022410      EVALUATE TRUE                                               02241007
022500         WHEN CA-SELECTION-ONE                                    02250007
022600            MOVE PC-TRLR-AUD-SCAN-CARTON TO PV-TRANSFER-PROGRAM   02260044
022700            PERFORM 5000-GET-DEST-OTBND-TRIP-ID                   02270075
022800            PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                 02280075
022801         WHEN CA-SELECTION-TWO                                    02280107
022802            PERFORM 4000-VALIDATE-PRINTER                         02280257
022804            PERFORM 3000-UPDATE-TSUNAUD                           02280444
022805            MOVE PC-CLOSED-TRLR-AUD-MSG                           02280544
022806                                         TO ASTATUSO              02280644
022807            IF PC045-100-AUDIT-CHECK                              02280744
022808               IF PC045-DEST-TYP-CDE = 'S'                        02280844
022809                  MOVE PC-AUDIT-KEEP TO SUOBTS-TRIP-STAT-CDE      02280944
022810                  PERFORM 2200-INSERT-DTL-REC-TSUOBTS             02281044
022811                  SET PC045-CLOSE-AUDIT-KEEP  TO TRUE             02281144
022812               ELSE                                               02281244
022813                  MOVE PC-AUDIT-RLSE TO SUOBTS-TRIP-STAT-CDE      02281344
022820                  PERFORM 2200-INSERT-DTL-REC-TSUOBTS             02282044
022821                  SET PC045-CLOSE-AUDIT-REL  TO TRUE              02282144
022830               END-IF                                             02283044
022840            END-IF                                                02284044
022842            SET PC045-AUDIT-COMPLETE TO TRUE                      02284251
022843            MOVE PC045-COMMAREA-REC TO PC233-HOST-SAVE-AREA       02284357
022844**UPON CLOSING AN AUDIT, SUBMIT THE REPORT REQUEST                02284457
022845            MOVE PC-TRLR-AUDIT-REPORT-DESC                        02284557
022846                                       TO PV-JOB-DESCRIPTION      02284657
022847            MOVE PC-TRLR-AUDIT-REPORT-PROC                        02284757
022848                                      TO  PV-JOB-PROC             02284857
022849            MOVE PC-TRLR-AUDIT-REPORT-JOB                         02284957
022850                                       TO PV-JOB-NAME             02285057
022851            PERFORM 9000-SUBMIT-REQUEST                           02285157
022910         WHEN CA-SELECTION-THREE                                  02291050
022911***SELECTION TO PRINT REPORTS                                     02291145
022912            PERFORM 4000-VALIDATE-PRINTER                         02291245
022913            MOVE PC-TRLR-AUDIT-REPORT-DESC                        02291350
022914                                       TO PV-JOB-DESCRIPTION      02291450
022915            MOVE PC-TRLR-AUDIT-REPORT-PROC                        02291550
022916                                      TO  PV-JOB-PROC             02291650
022917            MOVE PC-TRLR-AUDIT-REPORT-JOB                         02291750
022918                                       TO PV-JOB-NAME             02291850
022919            PERFORM 9000-SUBMIT-REQUEST                           02291950
023100      END-EVALUATE.                                               02310013
023200*                                                                 02320002
023300*                                                                 02330002
023400 2100-XCTL-TO-SELECTED-PROGRAM.                                   02340002
023401     SET PC233-INITIALIZE-SCREEN       TO  TRUE.                  02340118
023402     MOVE PC-CURRENT-PROGRAM-NAME      TO  PC233-LAST-PROGRAM.    02340218
023403     MOVE PC045-COMMAREA-REC           TO  PC233-HOST-SAVE-AREA.  02340318
023404     MOVE LENGTH OF CA-COMMAREA        TO  PV-COMMAREA-LENGTH.    02340418
023700                                                                  02370002
023800     EXEC CICS                                                    02380002
023900         XCTL                                                     02390002
024000             PROGRAM   (PV-TRANSFER-PROGRAM)                      02400002
024100             COMMAREA  (CA-COMMAREA)                              02410024
024200             LENGTH    (PV-COMMAREA-LENGTH)                       02420002
024300             RESP      (PV-CICS-RESPONSE)                         02430002
024400     END-EXEC.                                                    02440002
024500                                                                  02450002
024600     EVALUATE TRUE                                                02460002
024700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02470002
024800              CONTINUE                                            02480002
024900         WHEN OTHER                                               02490002
025000              MOVE '2100-XCTL-TO-SELECTED-PROGRAM'                02500002
025100                                     TO DP013-PARAGRAPH           02510002
025200              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       02520002
025300                                     TO DP013-MESSAGE-TEXT (1)    02530002
025400              MOVE PV-TRANSFER-PROGRAM                            02540002
025500                                     TO DP013-MESSAGE-TEXT (2)    02550002
025600              SET DP013-CICS-ABEND   TO TRUE                      02560002
025700              SET DP013-NO-ROLLBACK  TO TRUE                      02570002
025800              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              02580002
025900              MOVE PC-TRANS-UNAVAILABLE-MSG                       02590002
026000                                     TO AMSGLNO                   02600002
026100              SET PC233-PROCESS-SCREEN  TO TRUE                   02610002
026200              PERFORM 8100-SEND-DATA-ONLY                         02620002
026300              PERFORM 8200-RETURN-TRANID                          02630002
026400     END-EVALUATE.                                                02640002
026500*                                                                 02650002
026510*                                                                 02651008
026520 2120-XCTL-TO-SELECTED-PROGRAM.                                   02652008
026521     SET  PC233-INITIALIZE-SCREEN       TO  TRUE.                 02652108
026522     MOVE PC-CURRENT-PROGRAM-NAME       TO  PC045-LAST-PROGRAM.   02652208
026523     MOVE PC045-COMMAREA-REC            TO  PC233-HOST-SAVE-AREA. 02652308
026524     MOVE LENGTH OF PC233-COMMON-DATA   TO  PV-COMMAREA-LENGTH.   02652408
026560                                                                  02656008
026570     EXEC CICS                                                    02657008
026580         XCTL                                                     02658008
026590             PROGRAM   (PV-TRANSFER-PROGRAM)                      02659008
026591             COMMAREA  (PC233-COMMON-DATA)                        02659108
026592             LENGTH    (PV-COMMAREA-LENGTH)                       02659208
026593             RESP      (PV-CICS-RESPONSE)                         02659308
026594     END-EXEC.                                                    02659408
026595                                                                  02659508
026596     EVALUATE TRUE                                                02659608
026597         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02659708
026598              CONTINUE                                            02659808
026599         WHEN OTHER                                               02659908
026600              MOVE '2100-XCTL-TO-SELECTED-PROGRAM'                02660008
026601                                     TO DP013-PARAGRAPH           02660108
026602              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       02660208
026603                                     TO DP013-MESSAGE-TEXT (1)    02660308
026604              MOVE PV-TRANSFER-PROGRAM                            02660408
026605                                     TO DP013-MESSAGE-TEXT (2)    02660508
026606              SET DP013-CICS-ABEND   TO TRUE                      02660608
026607              SET DP013-NO-ROLLBACK  TO TRUE                      02660708
026608              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              02660808
026609              MOVE PC-TRANS-UNAVAILABLE-MSG                       02660908
026610                                     TO AMSGLNO                   02661008
026611              SET PC233-PROCESS-SCREEN  TO TRUE                   02661108
026612              PERFORM 8100-SEND-DATA-ONLY                         02661208
026613              PERFORM 8200-RETURN-TRANID                          02661308
026614     END-EVALUATE.                                                02661408
026615*                                                                 02661508
026616 2150-XCTL-TO-HELP.                                               02661658
026617                                                                  02661758
026618     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH       02661858
026619                                                                  02661958
026620     EXEC CICS                                                    02662058
026621         XCTL                                                     02662158
026622             PROGRAM   (PV-TRANSFER-PROGRAM)                      02662258
026623             COMMAREA  (PC192-COMMAREA)                           02662358
026624             LENGTH    (PV-COMMAREA-LENGTH)                       02662458
026625             RESP      (PV-CICS-RESPONSE)                         02662558
026626     END-EXEC.                                                    02662658
026627                                                                  02662758
026628     EVALUATE TRUE                                                02662858
026629         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02662958
026630              CONTINUE                                            02663058
026631         WHEN OTHER                                               02663158
026632             MOVE '2150-XCTL-TO-HELP' TO DP013-PARAGRAPH          02663258
026633             MOVE 'PCKRF893 - UNABLE TO XCTL TO PROGRAM: '        02663358
026634                                      TO DP013-MESSAGE-TEXT (1)   02663458
026635             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   02663558
026636             SET DP013-CICS-ABEND                                 02663658
026637                 DP013-ROLLBACK       TO TRUE                     02663758
026638             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               02663858
026639             MOVE PC-TRANS-UNAVAILABLE-MSG                        02663958
026640                                      TO AMSGLNO                  02664058
026641             SET PC233-PROCESS-SCREEN TO TRUE                     02664158
026642             MOVE -1                  TO ASELECTL                 02664259
026643             PERFORM 8000-SEND-MAP                                02664358
026644             PERFORM 8200-RETURN-TRANID                           02664460
026645     END-EVALUATE.                                                02664558
026646/                                                                 02664658
026647 2200-INSERT-DTL-REC-TSUOBTS.                                     02664708
026648                                                                  02664808
026649     MOVE SPACES                TO  SUOBTS-TRLR-SEAL-ID           02664914
026650                                    SUOBTS-SHIP-DRV-LAST-NM       02665014
026651                                    SUOBTS-SHIP-DRV-FRST-NM       02665114
026652                                    SUOBTS-SHIP-DRV-ID            02665214
026653                                    SUOBTS-TRLR-PRKG-LOC-DESC     02665314
026654                                    SUOBTS-TRLR-PRKG-SLOT-NBR     02665414
026655     MOVE PC045-USERID          TO  SUOBTS-OTBND-STAT-USR-ID.     02665535
026656     MOVE PC045-OPER-UNT-ID     TO  SUOBTS-STAT-OPER-UNT-ID.      02665634
026657     MOVE PC045-DOOR-ID         TO  SUOBTS-DOOR-ID.               02665734
026658     MOVE PC045-DOOR-ID         TO  SUOBTS-DOOR-ID.               02665834
026659     MOVE PC045-OTBND-TRIP-ID   TO  SUOBTS-OTBND-TRIP-ID.         02665934
026660     MOVE PC045-SCAC-CDE        TO  SUOBTS-SHIP-SCAC-CDE.         02666034
026661                                                                  02666134
026662                                                                  02666234
026663     EXEC SQL                                                     02666334
026664          INSERT                                                  02666434
026665          INTO  TSUOBTS                                           02666534
026666               (OTBND_TRIP_ID                                     02666634
026667               ,OTBND_STAT_TMST                                   02666734
026668               ,TRIP_STAT_CDE                                     02666834
026669               ,STAT_OPER_UNT_ID                                  02666908
026670               ,OTBND_STAT_USR_ID                                 02667012
026671               ,DOOR_ID                                           02667114
026672               ,TRLR_SEAL_ID                                      02667214
026680               ,SHIP_SCAC_CDE                                     02668014
026690               ,SHIP_DRV_LAST_NM                                  02669014
026700               ,SHIP_DRV_FRST_NM                                  02670014
026800               ,SHIP_DRV_ID                                       02680014
026900               ,TRLR_PRKG_LOC_DESC                                02690014
027000               ,TRLR_PRKG_SLOT_NBR                                02700014
027100               ,FINCL_POST_TMST)                                  02710041
027200        VALUES                                                    02720008
027300              (:SUOBTS-OTBND-TRIP-ID                              02730034
027400              , CURRENT TIMESTAMP                                 02740008
027410              ,:SUOBTS-TRIP-STAT-CDE                              02741008
027420              ,:SUOBTS-STAT-OPER-UNT-ID                           02742034
027430              ,:SUOBTS-OTBND-STAT-USR-ID                          02743035
027440              ,:SUOBTS-DOOR-ID                                    02744034
027450              ,:SUOBTS-TRLR-SEAL-ID                               02745014
027451              ,:SUOBTS-SHIP-SCAC-CDE                              02745134
027452              ,:SUOBTS-SHIP-DRV-LAST-NM                           02745214
027453              ,:SUOBTS-SHIP-DRV-FRST-NM                           02745314
027454              ,:SUOBTS-SHIP-DRV-ID                                02745414
027455              ,:SUOBTS-TRLR-PRKG-LOC-DESC                         02745514
027456              ,:SUOBTS-TRLR-PRKG-SLOT-NBR                         02745614
027457              ,:PC-DEFAULT-TIMESTAMP)                             02745741
027461     END-EXEC.                                                    02746114
027462                                                                  02746230
027463     EVALUATE TRUE                                                02746330
027464         WHEN SQLCODE = ZERO                                      02746430
027465              CONTINUE                                            02746530
027471         WHEN SQLWARN0 NOT = SPACES                               02747130
027472         WHEN SQLCODE < ZERO                                      02747230
027473         WHEN SQLCODE > ZERO                                      02747330
027474             MOVE '2200-INSERT-DTL-REC-TSUOBTS'                   02747430
027475                 TO DP013-PARAGRAPH                               02747530
027476             MOVE 'INSERT TO TSUOBTS TABLE'                       02747630
027477                 TO DP013-MESSAGE-TEXT (1)                        02747730
027478             MOVE PC045-AUDIT-CNTL-NBR-X                          02747830
027479                 TO DP013-MESSAGE-TEXT (2)                        02747930
027480             MOVE SQLCA            TO DP013-SQLCA                 02748030
027481             MOVE 'TSUOBTS'        TO DP013-DB2-TABLE-NAME (1)    02748130
027482             SET DP013-DB2-ABEND   TO TRUE                        02748230
027483             SET DP013-NO-ROLLBACK TO TRUE                        02748330
027484             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               02748430
027485             MOVE PC-CICS-ABEND-MSG     TO AMSGLNO                02748531
027486             MOVE -1                     TO  ASELECTL             02748659
027487             PERFORM 8100-SEND-DATA-ONLY                          02748730
027488             PERFORM 8200-RETURN-TRANID                           02748830
027489     END-EVALUATE.                                                02748930
027490*                                                                 02749014
027491 3000-UPDATE-TSUNAUD.                                             02749126
027492                                                                  02749226
027493     MOVE PC045-AUDIT-CNTL-NBR TO  SUNAUD-AUD-CNTL-NBR.           02749326
027494                                                                  02749426
027495                                                                  02749526
027496     EXEC SQL                                                     02749626
027497          UPDATE TSUNAUD                                          02749726
027498             SET                                                  02749826
027499                  AUD_STP_TMST       = CURRENT TIMESTAMP          02749926
027500                , AUD_STAT_CDE       = :PC-CM                     02750026
027501           WHERE  AUD_CNTL_NBR       = :SUNAUD-AUD-CNTL-NBR       02750126
027502     END-EXEC.                                                    02750226
027503                                                                  02750326
027504 4000-VALIDATE-PRINTER.                                           02750445
027505*----------------------------------------------------------------*02750545
027506*    VALIDATE PRINTER ID                                          02750645
027507*----------------------------------------------------------------*02750745
027508                                                                  02750871
027509     PERFORM DP026-0000-GET-LOGON-INFO.                           02750971
027510                                                                  02751071
027511     IF PC045-PRINTER-DEST =  SPACES                              02751145
027512         PERFORM 4020-GET-DEFAULT-PRINTER                         02751261
027513     END-IF                                                       02751361
027514                                                                  02751461
027515     IF PC045-PRINTER-DEST =  SPACES                              02751561
027516         MOVE PC-PRINTER-NUMBER-REQUIRED TO  AMSGLNO              02751661
027517         MOVE -1  TO  APRTRL                                      02751761
027518         PERFORM 8100-SEND-DATA-ONLY                              02751861
027519         PERFORM 8200-RETURN-TRANID                               02751961
027520     ELSE                                                         02752061
027521         PERFORM 4010-VALIDATE-PRINTER                            02752161
027522         IF DP072-PRTR-PRTR-TRK-STAT-CDE  EQUAL 'A'               02752261
027523             MOVE PC045-PRINTER-DEST TO PV-PRINTER-DESTINATION    02752361
027524         ELSE                                                     02752461
027525             MOVE PC-INVALID-PRINTER-MSG    TO  AMSGLNO           02752561
027526             MOVE -1                        TO  APRTRL            02752661
027527             PERFORM 8100-SEND-DATA-ONLY                          02752761
027528             PERFORM 8200-RETURN-TRANID                           02752861
027529         END-IF                                                   02752961
027530     END-IF.                                                      02753061
027531***************************************************************** 02753161
027532* 4010-VALIDATE-PRINTER                                         * 02753261
027533* CALLS DPKCS060 TO VALIDATE THE PRINTER ID                     * 02753361
027534***************************************************************** 02753461
027535 4010-VALIDATE-PRINTER.                                           02753561
027536                                                                  02753661
027537     MOVE PC045-PRINTER-DEST         TO DP072-PRINTER-ID.         02753761
027538     MOVE PC-REPORT-PGM              TO DP072-RPT-PGM-NME.        02753861
027539     MOVE PC-01                      TO DP072-RPT-PGM-TYP-ID.     02753961
027540     MOVE DP026-LOCATION-NBR         TO DP072-ORIGIN-OPER-UNT-ID  02754078
027541                                        DP072-OPER-UNT-ID.        02754161
027542     MOVE 1                          TO DP072-ORIGIN-FCLTY-ID     02754261
027543                                        DP072-FCLTY-ID.           02754361
027544     SET DP072-VALIDATE              TO TRUE.                     02754461
027545                                                                  02754561
027546     EXEC CICS                                                    02754661
027547          LINK PROGRAM  (PC-PRTR-VALIDATION-PGM)                  02754761
027548               COMMAREA (DP072-COMM-AREA)                         02754861
027549               RESP     (PV-CICS-RESPONSE)                        02754961
027550     END-EXEC                                                     02755061
027551                                                                  02755161
027552     EVALUATE TRUE                                                02755261
027553         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02755361
027554              MOVE PC045-PRINTER-DEST  TO PV-PRINTER-DESTINATION  02755461
027555         WHEN OTHER                                               02755561
027556              MOVE '4010-VALIDATE-PRINTER'                        02755661
027557                                   TO DP013-PARAGRAPH             02755761
027558              MOVE PV-CICS-RESPONSE                               02755861
027559                                   TO DP013-MESSAGE-TEXT(1)       02755961
027560              SET DP013-LINK-RETURN                               02756061
027561                  DP013-CICS-ABEND                                02756161
027562                  DP013-NO-ROLLBACK TO TRUE                       02756261
027563              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              02756361
027564     END-EVALUATE.                                                02756461
027565                                                                  02756561
027566******************************************************************02756661
027567* 4020-GET-DEFAULT-PRINTER                                       *02756761
027568*    SELECT THE DEFAULT PRINTER FROM THE COMPANY CONTROL TABLE   *02756861
027570******************************************************************02757061
027571 4020-GET-DEFAULT-PRINTER.                                        02757161
027572                                                                  02757261
027573     MOVE DP026-LOCATION-NBR    TO COCNTL-OPER-UNT-ID.            02757378
027574                                                                  02757461
027575     EXEC SQL                                                     02757561
027576            SELECT                                                02757661
027577                    CA_SHIP_PRTR_ID                               02757763
027578            INTO                                                  02757861
027579                   :COCNTL-CA-SHIP-PRTR-ID                        02757963
027580            FROM                                                  02758061
027581                    TCOCNTL                                       02758161
027582            WHERE                                                 02758261
027583                  OPER_UNT_ID     = :COCNTL-OPER-UNT-ID           02758361
027584              AND FCLTY_ID        = 1                             02758461
027585     END-EXEC.                                                    02758561
027586                                                                  02758661
027588     EVALUATE TRUE                                                02758861
027595        WHEN  SQLCODE = ZERO                                      02759561
027597              MOVE COCNTL-CA-SHIP-PRTR-ID                         02759761
027598                                      TO PC045-PRINTER-DEST       02759861
027599        WHEN SQLWARN0 NOT = SPACES                                02759961
027600        WHEN SQLCODE < ZERO                                       02760061
027601        WHEN SQLCODE > ZERO                                       02760161
027602            MOVE '4020-GET-DEFAULT-PRINTER'                       02760261
027603                TO DP013-PARAGRAPH                                02760361
027604            MOVE 'SELECT OF TCOCNTL TABLE'                        02760461
027605                TO DP013-MESSAGE-TEXT (1)                         02760561
027606            MOVE PC045-AUDIT-CNTL-NBR-X                           02760661
027607                TO DP013-MESSAGE-TEXT (2)                         02760761
027608            MOVE SQLCA            TO DP013-SQLCA                  02760861
027609            MOVE 'TCOCNTL'        TO DP013-DB2-TABLE-NAME (1)     02760961
027610            SET DP013-DB2-ABEND   TO TRUE                         02761061
027611            SET DP013-NO-ROLLBACK TO TRUE                         02761161
027612            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                02761261
027613            MOVE PC-CICS-ABEND-MSG     TO AMSGLNO                 02761361
027614            MOVE -1                     TO  ASELECTL              02761461
027615            PERFORM 8100-SEND-DATA-ONLY                           02761561
027616            PERFORM 8200-RETURN-TRANID                            02761661
027617     END-EVALUATE.                                                02761761
027633                                                                  02763361
027634******************************************************************02763474
027636*    SELECT THE DEST-OTBND-TRIP-ID FROM SUT_AUD_TRLR_TRIP TABLE  *02763674
027637******************************************************************02763774
027639 5000-GET-DEST-OTBND-TRIP-ID.                                     02763974
027640                                                                  02764074
027642     MOVE PC045-AUDIT-CNTL-NBR  TO  PC-AUD-CNTL-NBR.              02764276
027643     EXEC SQL                                                     02764374
027644        SELECT  DEST_OTBND_TRIP_ID                                02764477
027646        INTO   :SUT00004-DEST-OTBND-TRIP-ID :PC-NULL-IND          02764677
027648        FROM   SUT_AUD_TRLR_TRIP                                  02764877
027650       WHERE AUD_CNTL_NBR       =  :PC-AUD-CNTL-NBR               02765077
027652         AND ORIG_OTBND_TRIP_ID =  :PC045-OTBND-TRIP-ID           02765277
027653     END-EXEC.                                                    02765374
027654                                                                  02765474
027655     EVALUATE TRUE                                                02765574
027656        WHEN  SQLCODE = ZERO                                      02765674
027657             IF PC-NULL-IND  <  ZEROES                            02765777
027658                 MOVE ZEROES TO               PC045-AUD-TO-TRIP-ID02765877
027661             ELSE                                                 02766174
027662                 MOVE SUT00004-DEST-OTBND-TRIP-ID TO              02766277
027663                                              PC045-AUD-TO-TRIP-ID02766377
027664             END-IF                                               02766474
027665        WHEN  SQLCODE = +100                                      02766574
027666            CONTINUE                                              02766674
027667        WHEN SQLWARN0 NOT = SPACES                                02766774
027668        WHEN SQLCODE < ZERO                                       02766874
027669        WHEN SQLCODE > ZERO                                       02766974
027670            MOVE '5000-GET-DEST-OTBND-TRIP-ID'  TO DP013-PARAGRAPH02767074
027671            MOVE 'SELECT OF AUD TRLR TRIP'                        02767174
027672                                         TO DP013-MESSAGE-TEXT (1)02767274
027673            MOVE PC045-AUDIT-CNTL-NBR-X  TO DP013-MESSAGE-TEXT (2)02767374
027674            MOVE PC045-OTBND-TRIP-ID     TO DP013-MESSAGE-TEXT (3)02767474
027675            MOVE SQLCA             TO DP013-SQLCA                 02767574
027676            MOVE 'AUDTRLR'         TO DP013-DB2-TABLE-NAME (1)    02767674
027677            SET DP013-DB2-ABEND    TO TRUE                        02767774
027678            SET DP013-NO-ROLLBACK  TO TRUE                        02767874
027679            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                02767974
027680            MOVE PC-CICS-ABEND-MSG TO AMSGLNO                     02768074
027681            MOVE -1                     TO  ASELECTL              02768174
027682            PERFORM 8100-SEND-DATA-ONLY                           02768274
027683            PERFORM 8200-RETURN-TRANID                            02768374
027684     END-EVALUATE.                                                02768474
027685                                                                  02768574
027686*                                                                 02768674
027687 8000-SEND-MAP.                                                   02768774
027688     EXEC CICS                                                    02768874
027689         SEND MAP       ('PC893A')                                02768974
027690              MAPSET    ('PCKM893')                               02769074
027691              ERASE                                               02769174
027700              RESP      (PV-CICS-RESPONSE)                        02770002
027800     END-EXEC.                                                    02780002
027900                                                                  02790002
028000     EVALUATE TRUE                                                02800002
028100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02810002
028200              CONTINUE                                            02820002
028300         WHEN OTHER                                               02830002
028400              MOVE '8000-SEND-MAP'   TO DP013-PARAGRAPH           02840002
028500              MOVE 'UNABLE TO SEND MAP'                           02850002
028600                                     TO DP013-MESSAGE-TEXT (1)    02860002
028700              SET DP013-CICS-ABEND   TO TRUE                      02870002
028800              SET DP013-NO-ROLLBACK  TO TRUE                      02880002
028900              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              02890002
029000     END-EVALUATE.                                                02900002
029100*                                                                 02910002
029200*                                                                 02920002
029300 8100-SEND-DATA-ONLY.                                             02930002
029400     MOVE -1 TO ASELECTL.                                         02940002
029500                                                                  02950002
029600     EXEC CICS                                                    02960002
029700         SEND MAP       ('PC893A')                                02970002
029800              MAPSET    ('PCKM893')                               02980002
029900              CURSOR                                              02990002
030000              DATAONLY                                            03000002
030100              RESP      (PV-CICS-RESPONSE)                        03010002
030200     END-EXEC.                                                    03020002
030300                                                                  03030002
030400     EVALUATE TRUE                                                03040002
030500         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03050002
030600              CONTINUE                                            03060002
030700         WHEN OTHER                                               03070002
030800              MOVE '8100-SEND-DATA-ONLY'                          03080002
030900                                     TO DP013-PARAGRAPH           03090002
031000              MOVE 'UNABLE TO SEND DATA'                          03100002
031100                                     TO DP013-MESSAGE-TEXT (1)    03110002
031200              SET DP013-CICS-ABEND   TO TRUE                      03120002
031300              SET DP013-NO-ROLLBACK  TO TRUE                      03130002
031400              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              03140002
031500     END-EVALUATE.                                                03150002
031600*                                                                 03160002
031700*                                                                 03170002
031800 8200-RETURN-TRANID.                                              03180002
031900     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       03190002
032000     EXEC CICS                                                    03200002
032100         RETURN TRANSID   (PC-CURRENT-TRANID)                     03210017
032200                COMMAREA  (CA-COMMAREA)                           03220002
032300                LENGTH    (PV-COMMAREA-LENGTH)                    03230002
032400                RESP      (PV-CICS-RESPONSE)                      03240002
032500     END-EXEC.                                                    03250002
032600                                                                  03260002
032700     EVALUATE TRUE                                                03270002
032800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03280002
032900              CONTINUE                                            03290002
033000         WHEN OTHER                                               03300002
033100              MOVE '8200-RETURN-TRANID'                           03310002
033200                                     TO DP013-PARAGRAPH           03320002
033300              MOVE 'UNABLE TO RETURN TO TRANID'                   03330002
033400                                     TO DP013-MESSAGE-TEXT (1)    03340002
033500              SET DP013-CICS-ABEND   TO TRUE                      03350002
033600              SET DP013-NO-ROLLBACK  TO TRUE                      03360002
033700              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              03370002
033800     END-EVALUATE.                                                03380002
033900*                                                                 03390002
033901*----------------------------------------------------------------*03390144
033902*                                                                *03390244
033903*----------------------------------------------------------------*03390344
033904 9000-SUBMIT-REQUEST.                                             03390444
033905                                                                  03390544
033906     EXEC CICS ASSIGN                                             03390644
033907               APPLID(PV-SYSTEM-ID)                               03390744
033908               USERID(PC045-USERID)                               03390845
033909     END-EXEC.                                                    03390944
033910                                                                  03391044
033911     PERFORM 9500-ENQUEUE-INTERNAL-READER.                        03391144
033912                                                                  03391244
033913*-----------------------------------------------------------------03391344
033914* PROD/LEARN JCL SETUP                                            03391444
033915*     //SUK970   JOB KOHLS,'TRAILER AUDIT',MSGCLASS=P,CLASS=U     03391552
033916*     /*JOBPARM K=O                                               03391644
033917*     //JOBOUT01 OUTPUT FORMS=STD,FCB=8S                          03391744
033918*     //JOBLIB   DD DSN=PKMO.LOADLIB,DISP=SHR                     03391844
033920*     //PS020    EXEC SUK9701                                     03392052
033921*     //S010.SYSUT1 DD *                                          03392144
033922*     XXXXXXXXX                                                   03392244
033923*     //S035.SYSUT1 DD *                                          03392344
033924*     PPPPPPPPI0 C                                                03392444
033925*     //$AUTO    EXEC PGM=$A,COND=(0,LE),PARM='>'                 03392544
033926*     /*EOF                                                       03392644
033927*-----------------------------------------------------------------03392744
033928* TEST JCL SETUP                                                  03392844
033929*     //XXXXXXXQ JOB KOHLS,'TRAILER AUDIT',MSGCLASS=X,CLASS=E     03392952
033930*     //JOBOUT01 OUTPUT FORMS=STD,FCB=8S                          03393044
033931*     //JOBLIB   DD DSN=TKMA.LOADLIB,DISP=SHR                     03393144
033932*     //PS020    EXEC SUK9701T                                    03393252
033933*     //S010.SYSUT1 DD *                                          03393344
033934*     XXXXXXXXX                                                   03393444
033935*     //S035.SYSUT1 DD *                                          03393544
033936*     PPPPPPPPI0 C                                                03393644
033937*     //$AUTO    EXEC PGM=$A,COND=(0,LE),PARM='>'                 03393744
033938*     /*EOF                                                       03393844
033939*-----------------------------------------------------------------03393944
033940                                                                  03394044
033941     IF PV-PROD-CICS  OR                                          03394144
033942        PV-LEARN-CICS                                             03394244
033943          MOVE PV-JOB-NAME            TO  JL-PROD-JOB-NAME        03394344
033944          MOVE PV-JOB-DESCRIPTION     TO  JL-PROD-JOB-DESC        03394444
033945          MOVE JL-JOB-LINE-PROD       TO  JL-JCL-LINE-1           03394544
033946          MOVE JL-JCL-LINE-1          TO  TD-JCL-LINE             03394644
033947          PERFORM 9100-WRITE-TD-LINE                              03394744
033948          MOVE JL-JCL-LINE-3          TO  TD-JCL-LINE             03394844
033949          PERFORM 9100-WRITE-TD-LINE                              03394944
033950*         MOVE PV-PRINTER-DESTINATION TO  JL-LINE-13-PRINTER      03395044
033951          MOVE PC045-PRINTER-DEST     TO  JL-LINE-13-PRINTER      03395145
033952          MOVE JL-JCL-LINE-13         TO  TD-JCL-LINE             03395244
033953          PERFORM 9100-WRITE-TD-LINE                              03395344
033954          MOVE JL-JCL-LINE-4-PROD     TO  TD-JCL-LINE             03395444
033955          PERFORM 9100-WRITE-TD-LINE                              03395544
033956*         MOVE JL-JCL-LINE-11         TO  TD-JCL-LINE             03395644
033957*         PERFORM 9100-WRITE-TD-LINE                              03395744
033958          MOVE PV-JOB-PROC            TO  JL-LINE-12-PROC         03395844
033959          MOVE ' '                    TO  JL-LINE-12-PROC-T       03395944
033960          MOVE JL-JCL-LINE-12         TO  TD-JCL-LINE             03396044
033961          PERFORM 9100-WRITE-TD-LINE                              03396144
033962     ELSE                                                         03396244
033963        IF PV-TEST-CICS                                           03396344
033964           MOVE PC045-USERID           TO  JL-TEST-JOB-NAME       03396445
033965           MOVE PV-JOB-DESCRIPTION     TO  JL-TEST-JOB-DESC       03396544
033966           MOVE JL-JOB-LINE-TEST       TO  JL-JCL-LINE-1          03396644
033967           MOVE JL-JCL-LINE-1          TO  TD-JCL-LINE            03396744
033968           PERFORM 9100-WRITE-TD-LINE                             03396844
033969*          MOVE PV-PRINTER-DESTINATION TO  JL-LINE-13-PRINTER     03396944
033970           MOVE PC045-PRINTER-DEST     TO  JL-LINE-13-PRINTER     03397045
033971           MOVE JL-JCL-LINE-13         TO  TD-JCL-LINE            03397144
033972           PERFORM 9100-WRITE-TD-LINE                             03397244
033973                                                                  03397344
033974           MOVE JL-JCL-LINE-4-TEST     TO  TD-JCL-LINE            03397444
033975           PERFORM 9100-WRITE-TD-LINE                             03397544
033976           MOVE PV-JOB-PROC            TO  JL-LINE-12-PROC        03397644
033977           MOVE PC-TEST                TO  JL-LINE-12-PROC-T      03397744
033978           MOVE JL-JCL-LINE-12         TO  TD-JCL-LINE            03397844
033979           PERFORM 9100-WRITE-TD-LINE                             03397944
033980        ELSE                                                      03398044
033981           IF PV-QA-CICS                                          03398144
033982              MOVE PC045-USERID           TO  JL-TEST-JOB-NAME    03398245
033983              MOVE PV-JOB-DESCRIPTION     TO  JL-TEST-JOB-DESC    03398344
033984              MOVE JL-JOB-LINE-TEST       TO  JL-JCL-LINE-1       03398444
033985              MOVE JL-JCL-LINE-1          TO  TD-JCL-LINE         03398544
033986              PERFORM 9100-WRITE-TD-LINE                          03398644
033987*             MOVE PV-PRINTER-DESTINATION TO  JL-LINE-13-PRINTER  03398744
033988              MOVE PC045-PRINTER-DEST     TO  JL-LINE-13-PRINTER  03398845
033989              MOVE JL-JCL-LINE-13         TO  TD-JCL-LINE         03398944
033990              PERFORM 9100-WRITE-TD-LINE                          03399044
033991                                                                  03399144
033992              MOVE JL-JCL-LINE-4-QA       TO  TD-JCL-LINE         03399244
033993              PERFORM 9100-WRITE-TD-LINE                          03399344
033994              MOVE PV-JOB-PROC            TO  JL-LINE-12-PROC     03399444
033995              MOVE PC-QA                  TO  JL-LINE-12-PROC-T   03399544
033996              MOVE JL-JCL-LINE-12         TO  TD-JCL-LINE         03399644
033997              PERFORM 9100-WRITE-TD-LINE                          03399744
033998           END-IF                                                 03399844
033999        END-IF                                                    03399944
034000     END-IF.                                                      03400044
034001                                                                  03400144
034002     MOVE JL-JCL-LINE-14              TO  TD-JCL-LINE.            03400244
034003     PERFORM 9100-WRITE-TD-LINE.                                  03400344
034004                                                                  03400444
034005     MOVE PC045-AUDIT-CNTL-NBR        TO  JL-LINE-15-AUD-CNTL-NBR.03400545
034007     MOVE PC045-USERID                TO  JL-LINE-15-USER-ID.     03400745
034009     MOVE JL-JCL-LINE-15              TO  TD-JCL-LINE.            03400944
034010     PERFORM 9100-WRITE-TD-LINE.                                  03401044
034011                                                                  03401144
034068                                                                  03406847
034069     MOVE JL-JCL-LINE-EOF             TO  TD-JCL-LINE.            03406944
034070     PERFORM 9100-WRITE-TD-LINE.                                  03407044
034071                                                                  03407144
034072     PERFORM 9600-DEQUEUE-INTERNAL-READER.                        03407244
034073                                                                  03407344
034074     MOVE PC045-COMMAREA-REC TO PC233-HOST-SAVE-AREA              03407467
034075                                                                  03407567
034076     MOVE PC-REPORT-REQ-SENT-MSG       TO  AMSGLNO.               03407645
034077     MOVE -1                           TO  ASELECTL.              03407745
034078     MOVE PC045-PRINTER-DEST           TO APRTRO.                 03407868
034079     PERFORM 8100-SEND-DATA-ONLY.                                 03407944
034080     PERFORM 8200-RETURN-TRANID.                                  03408056
034081                                                                  03408144
034082                                                                  03408244
034083*----------------------------------------------------------------*03408344
034084*  WRITE A JCL LINE TO THE TRANSIENT DATA QUEUE FOR THE INTERNAL *03408444
034085*  READER.  ON ANY ERROR, DEQUEUE THE INTERNAL READER, DELETE    *03408544
034086*  THE TEMPORARY STORAGE QUEUE (TO PREVENT OLD REQUEST           *03408644
034087*  INFORMATION FROM ACCIDENTALLY APPEARING ON A FUTURE REQUEST), *03408744
034088*  FORMAT AND DISPLAY AN ERROR MESSAGE, AND RETURN TO NATIVE     *03408844
034089*  CICS.                                                         *03408944
034090*----------------------------------------------------------------*03409044
034091 9100-WRITE-TD-LINE.                                              03409144
034092     EXEC CICS                                                    03409244
034093         WRITEQ TD                                                03409344
034094             QUEUE(TD-QUEUE-NAME)                                 03409444
034095             FROM(TD-JCL-LINE)                                    03409544
034096             LENGTH(TD-JCL-LINE-LENGTH)                           03409644
034097             RESP(PV-CICS-RESPONSE)                               03409744
034098     END-EXEC.                                                    03409844
034099                                                                  03409944
034100     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    03410044
034101         SET PS-ABEND-IN-PROGRESS TO TRUE                         03410144
034102         STRING 'WRITE TO TRANSIENT DATA QUEUE '                  03410244
034103                                                DELIMITED BY SIZE 03410344
034104                TD-QUEUE-NAME                   DELIMITED BY SIZE 03410444
034105                ' (INTERNAL READER)'            DELIMITED BY SIZE 03410544
034106             INTO SE-ATTEMPTED-ACTION                             03410644
034107         MOVE PV-CICS-RESPONSE TO SE-CICS-RESPONSE                03410744
034108         MOVE SE-SYSTEM-ERROR-MESSAGE TO PV-LEAVE-SYSTEM-MESSAGE  03410844
034109         PERFORM 9600-DEQUEUE-INTERNAL-READER                     03410944
034110         PERFORM 9900-LEAVE-SYSTEM                                03411044
034111     END-IF.                                                      03411144
034112                                                                  03411244
034113                                                                  03411344
034114*----------------------------------------------------------------*03411444
034115*  ENQUEUE THE TRANSIENT DATA QUEUE FOR THE INTERNAL READER.     *03411544
034116*  THIS WILL PREVENT INTERLEAVING OF JCL SUBMITTED CONCURRENTLY  *03411644
034117*  BY MULTIPLE USERS.  IF THE QUEUE IS BUSY, THIS PROGRAM WILL   *03411744
034118*  WAIT TO ENQUEUE IT, BY NOT SPECIFICALLY HANDLING THE QBUSY    *03411844
034119*  CONDITION.  IF ANY OTHER ERRORS OCCUR, DELETE THE TEMPORARY   *03411944
034120*  STORAGE QUEUE (TO PREVENT OLD REQUEST INFORMATION FROM        *03412044
034121*  ACCIDENTALLY APPEARING ON A FUTURE REQUEST), FORMAT AND       *03412144
034122*  DISPLAY AN ERROR MESSAGE, AND RETURN TO NATIVE CICS.          *03412244
034123*----------------------------------------------------------------*03412344
034124 9500-ENQUEUE-INTERNAL-READER.                                    03412444
034125     EXEC CICS                                                    03412544
034126         ENQ                                                      03412644
034127             RESOURCE(TD-QUEUE-NAME)                              03412744
034128             LENGTH(TD-QUEUE-NAME-LENGTH)                         03412844
034129             RESP(PV-CICS-RESPONSE)                               03412944
034130     END-EXEC.                                                    03413044
034131                                                                  03413144
034132     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    03413244
034133         SET PS-ABEND-IN-PROGRESS TO TRUE                         03413344
034134         STRING 'ENQUEUE '            DELIMITED BY SIZE           03413444
034135                TD-QUEUE-NAME         DELIMITED BY SIZE           03413544
034136                ' (INTERNAL READER)'  DELIMITED BY SIZE           03413644
034137             INTO SE-ATTEMPTED-ACTION                             03413744
034138         MOVE PV-CICS-RESPONSE TO SE-CICS-RESPONSE                03413844
034139         MOVE SE-SYSTEM-ERROR-MESSAGE TO PV-LEAVE-SYSTEM-MESSAGE  03413944
034140         PERFORM 9900-LEAVE-SYSTEM                                03414044
034141     END-IF.                                                      03414144
034142                                                                  03414244
034143     SET PS-INTERNAL-READER-ENQUEUED TO TRUE.                     03414344
034144                                                                  03414444
034145                                                                  03414544
034146*----------------------------------------------------------------*03414644
034147*  DEQUEUE THE TRANSIENT DATA QUEUE FOR THE INTERNAL READER.     *03414744
034148*  THIS SHOULD BE DONE FOLLOWING A SUCCESSFUL REPORT REQUEST     *03414844
034149*  SUBMISSION, A CANCELLATION OF THE CURRENT REPORT REQUEST, OR  *03414944
034150*  ANY DETECTED ABENDS.  THIS WILL FREE UP THE INTERNAL READER   *03415044
034151*  FOR THE NEXT USER.  IF ANY ERRORS OCCUR, CHECK TO SEE IF      *03415144
034152*  ANY OTHER ABEND SITUATIONS HAVE ALREADY OCCURRED.  IF SO, DO  *03415244
034153*  NOT FORCE THE ABEND FOR THIS ERROR, AND ALLOW PROGRAM CONTROL *03415344
034154*  TO RETURN TO THE POINT WHERE THE FIRST ABEND OCCURRED, AND    *03415444
034155*  DISPLAY THE MESSAGE RELATING TO THAT ABEND.  IF NOT, DELETE   *03415544
034156*  THE TEMPORARY STORAGE QUEUE (TO PREVENT OLD REQUEST           *03415644
034157*  INFORMATION FROM ACCIDENTALLY APPEARING ON A FUTURE REQUEST), *03415744
034158*  FORMAT AND DISPLAY AN ERROR MESSAGE, AND RETURN TO NATIVE     *03415844
034159*  CICS.                                                         *03415944
034160*----------------------------------------------------------------*03416044
034161 9600-DEQUEUE-INTERNAL-READER.                                    03416144
034162     SET PS-INTERNAL-READER-DEQUEUED TO TRUE.                     03416244
034163                                                                  03416344
034164     EXEC CICS                                                    03416444
034165         DEQ                                                      03416544
034166             RESOURCE(TD-QUEUE-NAME)                              03416644
034167             LENGTH(TD-QUEUE-NAME-LENGTH)                         03416744
034168             RESP(PV-CICS-RESPONSE)                               03416844
034169     END-EXEC.                                                    03416944
034170                                                                  03417044
034171     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    03417144
034172         IF PS-NO-ABEND-IN-PROGRESS                               03417244
034173             SET PS-ABEND-IN-PROGRESS TO TRUE                     03417344
034174             STRING 'DEQUEUE '            DELIMITED BY SIZE       03417444
034175                    TD-QUEUE-NAME         DELIMITED BY SIZE       03417544
034176                    ' (INTERNAL READER)'  DELIMITED BY SIZE       03417644
034177                 INTO SE-ATTEMPTED-ACTION                         03417744
034178             MOVE PV-CICS-RESPONSE TO SE-CICS-RESPONSE            03417844
034179             MOVE SE-SYSTEM-ERROR-MESSAGE TO                      03417944
034180                       PV-LEAVE-SYSTEM-MESSAGE                    03418044
034181             PERFORM 9900-LEAVE-SYSTEM                            03418144
034182         END-IF                                                   03418244
034183     END-IF.                                                      03418344
034184                                                                  03418444
034185*----------------------------------------------------------------*03418548
034186*  EXIT THE SHIPT UNIT REPORT REQUEST SYSTEM, DISPLAYING A       *03418648
034187*  REASON FOR THE PROGRAM ABEND.                                 *03418748
034188*----------------------------------------------------------------*03418848
034189 9900-LEAVE-SYSTEM.                                               03418948
034190     EXEC CICS                                                    03419048
034191         SEND                                                     03419148
034192             FROM(PV-LEAVE-SYSTEM-MESSAGE)                        03419248
034193             LENGTH(PC-LEAVE-SYSTEM-LENGTH)                       03419348
034194             ERASE                                                03419448
034195     END-EXEC.                                                    03419548
034196                                                                  03419648
034197     EXEC CICS                                                    03419748
034198         RETURN                                                   03419848
034199     END-EXEC.                                                    03419948
034200                                                                  03420044
034201*                                                                 03420102
034202 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  03420202
034210     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            03421002
034300     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           03430002
034400     INITIALIZE DP013-SRC-TASK-NUMBER                             03440002
034500                DP013-STACK.                                      03450002
034600     SET DP013-LINK-RETURN           TO TRUE.                     03460002
034700                                                                  03470002
034800     EXEC CICS                                                    03480002
034900         LINK                                                     03490002
035000             PROGRAM   (DP013-NAME)                               03500002
035100             COMMAREA  (DP013-PARAMETERS)                         03510002
035200             LENGTH    (DP013-LENGTH)                             03520002
035300     END-EXEC.                                                    03530002
035310                                                                  03531072
035400*----------------------------------------------------------------*03540072
035500*    GET LOGON INFORMATION FOR NON-ARCHITECTURE PROGRAMS         *03550072
035600*----------------------------------------------------------------*03560072
035700                                                                  03570072
035800     COPY DPPD026.                                                03580072
035900                                                                  03590072
036000*                                                                 03600072
