000100******************************************************************        
000200 IDENTIFICATION DIVISION.                                                 
000300******************************************************************        
000400                                                                          
000500 PROGRAM-ID.    SUKUT175.                                                 
000600 AUTHOR.        DENISE HAHN                                               
000700 INSTALLATION.  KOHLS.                                                    
000800 DATE-WRITTEN   MAY, 2016.                                                
000900 DATE-COMPILED.                                                           
001000                                                                          
001100******************************************************************        
001200*  THIS PROGRAM CREATES AN EXTRACT FILE OF DC SHIPPING DOORS FOR          
001300*  BRICK AND MORTAR STORES.                                               
001301*  WILL CALCULATE CARTON COUNTS FOR OPEN TRAILERS                         
001302*     -  TOTAL CARTONS                                                    
001303*     -  DIVERTED CARTONS                                                 
001304*     -  SCANNED ON CARTONS                                               
001305*  WILL CALCULATE CARTON COUNTS DOORS THAT DO NOT HAVE AN OPEN TRLR       
001306*     -  TOTAL CARTONS                                                    
001307*     -  DIVERTED CARTONS - SINCE THE LAST END DIVERT SET                 
001310*  CREATES AN INPUT FILE FOR SUKRP???                                     
001400******************************************************************        
001500                                                                          
001600******************************************************************        
001700 ENVIRONMENT DIVISION.                                                    
001800******************************************************************        
001900                                                                          
002000 CONFIGURATION SECTION.                                                   
002100                                                                          
002200 SOURCE-COMPUTER.        IBM-3090.                                        
002300 OBJECT-COMPUTER.        IBM-3090.                                        
002400                                                                          
002500 INPUT-OUTPUT SECTION.                                                    
002600                                                                          
002700 FILE-CONTROL.                                                            
002800                                                                          
003300     SELECT OUTPUT-FILE                                                   
003400            ASSIGN TO OUT01.                                              
003410                                                                          
003500******************************************************************        
003600 DATA DIVISION.                                                           
003700******************************************************************        
003800                                                                          
003900 FILE SECTION.                                                            
004700                                                                          
004800 FD  OUTPUT-FILE                                                          
004900     RECORDING MODE IS F                                                  
005000     LABEL RECORDS ARE STANDARD                                           
005100     BLOCK CONTAINS 0 RECORDS.                                            
005200                                                                          
005300 01  OUTPUT-RECORD              PIC X(150).                               
005470                                                                          
005500                                                                          
005600******************************************************************        
005700 WORKING-STORAGE SECTION.                                                 
005800******************************************************************        
005801                                                                          
005810 01  DK-FIELDS.                                                           
005820     05  DK-OTBND-TRIP-ID                   PIC S9(09)  COMP.             
005830                                                                          
005840 01  PROGRAM-VARIABLES.                                                   
005841     05  PV-PARAGRAPH-NAME                  PIC  X(40).                   
005842     05  PV-DB2-OPERATION-ATTEMPTED         PIC  X(40).                   
005843*                                                                         
005844     05  PV-MESSAGE-1                       PIC  X(100).                  
005845     05  PV-MESSAGE-2                       PIC  X(100).                  
005846     05  PV-SQLCODE                         PIC  -999.                    
005847*                                                                         
005848     05 PV-DISP-SUOBTR-OTBND-TRIP-ID        PIC  Z(09).                   
005851     05 PV-DISP-CNTRID-TRLR-SRL-NBR         PIC  Z(09).                   
005852     05 PV-DISP-OTBND-TRIP                  PIC  Z(09).                   
005853*                                                                         
005854     05  PV-DISP-CNDCDR-OPER                PIC  Z(04).                   
005855     05  PV-DISP-CNDRST-STR                 PIC  Z(04).                   
005856     05  PV-DISP-CNDRST-DOOR-ID             PIC  X(04).                   
005857     05  PV-DISP-XLT00010-LOC-NM            PIC  X(20).                   
005858     05  PV-DISP-CNDCDR-DOOR-TYP            PIC  X(02).                   
005859     05  PV-DISP-CNDCDR-DIVERT-N            PIC  Z(09).                   
005860     05  PV-DISP-CNDCDR-DIVERT-L            PIC  X(4).                    
005861*                                                                         
005862     05  PV-STATUS-DATE                     PIC  X(10).                   
005863     05  PV-STATUS-TIME                     PIC  X(08).                   
005864*                                                                         
005865     05  PV-DIVERT-CRTN-CNT                 PIC S9(09) COMP.              
005870     05  PV-SCAN-ON-CNT                     PIC S9(09) COMP.              
005880     05  PV-WRITE-COUNTER                   PIC S9(09) COMP.              
005890     05  PV-DISPLAY-COUNT                   PIC ZZZ,ZZZ,ZZZ.              
005891     05  PV-FETCH-COUNT                     PIC 9(09).                    
005892     05  PV-FETCH-COUNT-DISP                PIC 9(09).                    
005893                                                                          
005894 01  ABEND-CODE                      PIC S9(04)    VALUE +0               
005895                                                   COMP SYNC.             
005896 01  PROGRAM-SWITCHES.                                                    
005897     05  PS-EOF-CURSOR-SW                   PIC X(01) VALUE 'N'.          
005898         88  PS-EOF-CURSOR                            VALUE 'Y'.          
005899         88  PS-EOF-CURSOR-NO                         VALUE 'N'.          
005900     05  PS-OTBND-TRIP-SW                   PIC X(01) VALUE 'N'.          
005901         88  PS-OTBND-TRIP                            VALUE 'Y'.          
005902         88  PS-OTBND-TRIP-NO                         VALUE 'N'.          
005903     05  PS-TRIP-HAS-CUTOFF-SW              PIC X(01) VALUE 'N'.          
005904         88  PS-TRIP-HAS-CUTOFF                       VALUE 'Y'.          
005905         88  PS-TRIP-HAS-CUTOFF-NO                    VALUE 'N'.          
005906                                                                          
005907******************************************************************        
005908* OUTPUT RECORD LAYOUT                                                    
005910******************************************************************        
005920     COPY SURD116.                                                        
005930                                                                          
005940* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
005950* TCNDCDR - DC DOOR DEFINITION TABLE                                      
005960* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
005970     EXEC SQL                                                             
005980          INCLUDE TCNDCDR                                                 
005990     END-EXEC.                                                            
005991                                                                          
005992* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
005993* TCNDRST - DC DOOR TO STORE ASSIGNMENT TABLE                             
005994* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
005995     EXEC SQL                                                             
005996          INCLUDE TCNDRST                                                 
005997     END-EXEC.                                                            
005998                                                                          
005999* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006000* XLT_LOC - LOGISTIC DOMAIN LOCATION DATABASE                             
006010* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006020     EXEC SQL                                                             
006030          INCLUDE XLT00010                                                
006040     END-EXEC.                                                            
006050                                                                          
006060* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006070* TSUCDOT - CARTON DIVERT/OUTBOUND TRIP ASSOCIATION TABLE                 
006080* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006090     EXEC SQL                                                             
006091          INCLUDE TSUCDOT                                                 
006092     END-EXEC.                                                            
006093                                                                          
006094* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006095* TSUOBTR - OUTBOUND TRAILER TRIP TABLE                                   
006096* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006097     EXEC SQL                                                             
006098          INCLUDE TSUOBTR                                                 
006099     END-EXEC.                                                            
006100                                                                          
006110* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006120* TSUOBTS - OUTBOUND TRAILER TRIP STATUS TABLE                            
006130* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006140     EXEC SQL                                                             
006150          INCLUDE TSUOBTS                                                 
006160     END-EXEC.                                                            
006170                                                                          
006180* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006190* TSUCRDV - CARTON DIVERTS FROM CONVEYOR SYSTEM TABLE                     
006191* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006192     EXEC SQL                                                             
006193          INCLUDE TSUCRDV                                                 
006194     END-EXEC.                                                            
006195                                                                          
006196* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006197* TCNTRID - OUTBOUND TRAILER DEFINITION                                   
006198* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006199     EXEC SQL                                                             
006200          INCLUDE TCNTRID                                                 
006201     END-EXEC.                                                            
006202                                                                          
006203* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006204* SUT_OTBND_LOC                                                           
006205* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006206     EXEC SQL                                                             
006207          INCLUDE SUT00027                                                
006208     END-EXEC.                                                            
006209                                                                          
006210* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006211*                                                                         
006212* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006213     EXEC SQL                                                             
006214          INCLUDE SQLCA                                                   
006215     END-EXEC.                                                            
006220                                                                          
006230                                                                          
006240* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006250*                                                                         
006260* SHIPPING DOOR CURSOR - FOR BRICK & MORTAR STORES                        
006270*                                                                         
006280* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006290     EXEC SQL                                                             
006291         DECLARE SHIP-DOOR-STORE-CSR CURSOR FOR                           
006292         SELECT A.OPER_UNT_ID                                             
006293              , B.STR_NBR                                                 
006294              , B.DOOR_ID                                                 
006295              , C.LOC_NM                                                  
006296              , A.DOOR_TYP_CDE                                            
006297              , A.DIVERT_NBR                                              
006298              , A.DIVERT_LOC_ID                                           
006299           FROM TCNDCDR A                                                 
006300              , TCNDRST B                                                 
006301              , XLT_LOC C                                                 
006302         WHERE A.OPER_UNT_ID  =  B.OPER_UNT_ID                            
006310           AND A.DOOR_ID      =  B.DOOR_ID                                
006320           AND A.DOOR_LOC_DESC NOT LIKE '%RE-OPEN%'                       
006330           AND A.DOOR_LOC_DESC NOT LIKE '%UPS%'                           
006340           AND A.DOOR_LOC_DESC NOT LIKE '%VIRTUAL%'                       
006350           AND B.STRT_TMST   <=  CURRENT TIMESTAMP                        
006360           AND B.END_TMST    >=  CURRENT TIMESTAMP                        
006370           AND B.STR_NBR      =  C.LOC_NBR                                
006380           AND C.LOC_TYP_CDE  = 'DS'                                      
006390           AND C.E_BUS_IND    = 'N'                                       
006391         ORDER BY A.OPER_UNT_ID                                           
006392                , B.STR_NBR                                               
006393                , B.DOOR_ID                                               
006394        WITH UR                                                           
006395     END-EXEC.                                                            
006396                                                                          
006400                                                                          
007300*-----------------------------------------------------------------        
007500*  DB2 FORMATTED MESSAGE AREA                                             
007510*-----------------------------------------------------------------        
007700     COPY DPWS004.                                                        
007800                                                                          
018300                                                                          
018400                                                                          
018600 PROCEDURE DIVISION.                                                      
018801                                                                          
018810*-----------------------------------------------------------------        
018820*                                                                         
018840*-----------------------------------------------------------------        
018900 0000-PROGRAM-MAINLINE.                                                   
019400                                                                          
019500     PERFORM 1000-INITIALIZE.                                             
019510                                                                          
019520     DISPLAY '********************************************'.              
019530     DISPLAY '*                                          *'.              
019540     DISPLAY '*                                          *'.              
019600     IF  PS-EOF-CURSOR-NO                                                 
019700         PERFORM 2000-PROCESS-CURSOR                                      
019800           UNTIL PS-EOF-CURSOR                                            
019900     END-IF.                                                              
019910                                                                          
020000     PERFORM 9000-EOJ-ROUTINE.                                            
020113                                                                          
020120     DISPLAY '*                                          *'.              
020130     DISPLAY '*                                          *'.              
020131     DISPLAY '********************************************'.              
020140                                                                          
020200     STOP RUN.                                                            
020300                                                                          
020310                                                                          
020320*-----------------------------------------------------------------        
020330*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                            
020340*    -- OPEN OUTPUT FILE                                                  
020350*    -- OPEN CURSOR                                                       
020360*    -- FETCH CURSOR                                                      
020370*-----------------------------------------------------------------        
020400 1000-INITIALIZE.                                                         
021100                                                                          
021500     OPEN OUTPUT OUTPUT-FILE.                                             
021600                                                                          
021800     PERFORM 7000-OPEN-CURSOR.                                            
021900     PERFORM 7005-FETCH-CURSOR.                                           
022000                                                                          
022010                                                                          
025449*-----------------------------------------------------------------        
025450*  LOOP THROUGH THE RESULTS TABLE.                                        
025451*  FORMAT THE OUTPUT RECORD.  WRITE THE RECORDS THAT MEET CRITERIA.       
025452*-----------------------------------------------------------------        
025460 2000-PROCESS-CURSOR.                                                     
026000                                                                          
026001     INITIALIZE  SU116-EXTRACT-RECORD.                                    
026010     MOVE ZEROES                 TO  PV-DIVERT-CRTN-CNT                   
026030                                     PV-SCAN-ON-CNT.                      
026051     SET  PS-OTBND-TRIP-NO                                                
026052          PS-TRIP-HAS-CUTOFF-NO  TO  TRUE.                                
026095                                                                          
026097     MOVE CNDCDR-OPER-UNT-ID     TO  SU116-OPER-UNT-ID                    
026098                                     SUOBTR-ORGN-OPER-UNT-ID.             
026099     MOVE CNDRST-STR-NBR         TO  SU116-STORE-DEST                     
026100                                     SUOBTR-DEST-OPER-UNT-ID.             
026101     MOVE CNDRST-DOOR-ID         TO  SU116-DOOR-ID                        
026102                                     SUOBTS-DOOR-ID.                      
026103     MOVE XLT00010-LOC-NM        TO  SU116-STORE-NAME.                    
026104     MOVE CNDCDR-DOOR-TYP-CDE    TO  SU116-DOOR-TYPE.                     
026105     MOVE CNDCDR-DIVERT-NBR      TO  SU116-DIVERT-NBR.                    
026106     MOVE CNDCDR-DIVERT-LOC-ID   TO  SU116-DIVERT-LOC-ID.                 
026107*                                                                         
026108* GET CURRENT OPEN TRAILER AT THE DOOR FOR THE STORE                      
026109*                                                                         
026110     PERFORM 3000-GET-CURRENT-TRIP.                                       
026111                                                                          
026119     IF  PS-OTBND-TRIP                                                    
026120         MOVE CNTRID-SCAC-CDE        TO  SU116-SCAC                       
026121         MOVE CNTRID-TRLR-ID         TO  SU116-TRLR-ID                    
026122         MOVE CNTRID-TRLR-SRL-NBR    TO  SU116-TRLR-SRL                   
026123         MOVE SUOBTR-OTBND-TRIP-ID   TO  SU116-TRIP-ID                    
026124         MOVE PV-STATUS-DATE         TO  SU116-STATUS-DATE                
026125         MOVE PV-STATUS-TIME         TO  SU116-STATUS-TIME                
026127     ELSE                                                                 
026128         MOVE ZEROES                 TO  SU116-TRLR-SRL                   
026129                                         SU116-TRIP-ID                    
026130         MOVE SPACES                 TO  SU116-SCAC                       
026131                                         SU116-TRLR-ID                    
026132                                         SU116-STATUS-DATE                
026133                                         SU116-STATUS-TIME                
026135     END-IF.                                                              
026136*                                                                         
026137     IF  PS-OTBND-TRIP                                                    
026138         PERFORM 4000-GET-TRIP-COUNTS                                     
026139     ELSE                                                                 
026140         PERFORM 4100-GET-DOOR-COUNTS                                     
026141     END-IF.                                                              
026142*                                                                         
026147     MOVE PV-DIVERT-CRTN-CNT     TO  SU116-DIVERT-CARTONS.                
026148     MOVE PV-SCAN-ON-CNT         TO  SU116-SCANON-CARTONS.                
026149     ADD  PV-DIVERT-CRTN-CNT                                              
026150      TO  PV-SCAN-ON-CNT                                                  
026151     GIVING                          SU116-TOTAL-CARTONS.                 
026152                                                                          
026153     PERFORM 8000-WRITE-OUTPUT-RECORD.                                    
026160                                                                          
026200     PERFORM 7005-FETCH-CURSOR.                                           
026300                                                                          
026310                                                                          
026311*-----------------------------------------------------------------        
026312*  GET THE CURRENT OUTBOUND TRAILER/TRIP OPENED AT THE DOOR               
026313*  CHECKS FOR DC OPEN AND AUDIT OPEN                                      
026314*-----------------------------------------------------------------        
026315 3000-GET-CURRENT-TRIP.                                                   
026316                                                                          
026317     EXEC SQL                                                             
026318         SELECT                                                           
026319                 A.OTBND_TRIP_ID                                          
026320              ,  B.TRIP_STAT_CDE                                          
026321              ,  DATE(B.OTBND_STAT_TMST)                                  
026322              ,  TIME(B.OTBND_STAT_TMST)                                  
026323              ,  C.SCAC_CDE                                               
026324              ,  C.TRLR_ID                                                
026325              ,  C.TRLR_SRL_NBR                                           
026326           INTO                                                           
026327                :SUOBTR-OTBND-TRIP-ID                                     
026328              , :SUOBTS-TRIP-STAT-CDE                                     
026329              , :PV-STATUS-DATE                                           
026330              , :PV-STATUS-TIME                                           
026331              , :CNTRID-SCAC-CDE                                          
026332              , :CNTRID-TRLR-ID                                           
026333              , :CNTRID-TRLR-SRL-NBR                                      
026334           FROM TSUOBTR A                                                 
026335              , TSUOBTS B                                                 
026336              , TCNTRID C                                                 
026337          WHERE A.ORGN_OPER_UNT_ID     = :SUOBTR-ORGN-OPER-UNT-ID         
026338            AND A.DEST_OPER_UNT_ID     = :SUOBTR-DEST-OPER-UNT-ID         
026339            AND A.OTBND_TRIP_ID        =  B.OTBND_TRIP_ID                 
026340            AND B.DOOR_ID              = :SUOBTS-DOOR-ID                  
026341            AND B.OTBND_STAT_TMST IN                                      
026342               (SELECT MAX(D.OTBND_STAT_TMST)                             
026343                  FROM TSUOBTS D                                          
026344                 WHERE B.OTBND_TRIP_ID =  D.OTBND_TRIP_ID                 
026345                   AND B.DOOR_ID       =  B.DOOR_ID)                      
026346            AND B.TRIP_STAT_CDE       IN ('DO','AO')                      
026347            AND A.TRLR_SRL_NBR        =  C.TRLR_SRL_NBR                   
026348           WITH UR                                                        
026349                                                                          
026350     END-EXEC.                                                            
026351                                                                          
026352     EVALUATE TRUE                                                        
026353         WHEN SQLCODE = ZERO                                              
026354              SET  PS-OTBND-TRIP        TO  TRUE                          
026355         WHEN SQLCODE = +100                                              
026356              SET PS-OTBND-TRIP-NO      TO  TRUE                          
026357                                                                          
026358         WHEN SQLCODE = -811                                              
026359              PERFORM 3005-GET-CURRENT-TRIP-DO                            
026360                                                                          
026361         WHEN SQLWARN0 NOT = SPACES                                       
026362         WHEN SQLCODE < ZERO                                              
026363         WHEN SQLCODE > ZERO                                              
026370             MOVE SQLCODE              TO PV-SQLCODE                      
026371             MOVE CNDCDR-OPER-UNT-ID   TO PV-DISP-CNDCDR-OPER             
026372             MOVE CNDRST-STR-NBR       TO PV-DISP-CNDRST-STR              
026373             MOVE CNDRST-DOOR-ID       TO PV-DISP-CNDRST-DOOR-ID          
026374             MOVE XLT00010-LOC-NM      TO PV-DISP-XLT00010-LOC-NM         
026375             MOVE CNDCDR-DOOR-TYP-CDE  TO PV-DISP-CNDCDR-DOOR-TYP         
026376             MOVE CNDCDR-DIVERT-NBR    TO PV-DISP-CNDCDR-DIVERT-N         
026377             MOVE CNDCDR-DIVERT-LOC-ID TO PV-DISP-CNDCDR-DIVERT-L         
026378*                                                                         
026379              STRING '3000-'                                              
026380                     ' SQL:'   PV-SQLCODE                                 
026381                     ' OPER:'  PV-DISP-CNDCDR-OPER                        
026382                     ' DEST:'  PV-DISP-CNDRST-STR                         
026383                     ' DR:'    PV-DISP-CNDRST-DOOR-ID                     
026384                     ' '       PV-DISP-XLT00010-LOC-NM                    
026385                     ' TYP:'   PV-DISP-CNDCDR-DOOR-TYP                    
026386                     ' DVRT#:' PV-DISP-CNDCDR-DIVERT-N                    
026387                     ' LOC:'   PV-DISP-CNDCDR-DIVERT-L                    
026388                               DELIMITED BY SIZE                          
026389                          INTO PV-MESSAGE-1                               
026390                                                                          
026391              MOVE SUOBTR-OTBND-TRIP-ID                                   
026392                                 TO PV-DISP-SUOBTR-OTBND-TRIP-ID          
026393              MOVE CNTRID-TRLR-SRL-NBR                                    
026394                                 TO PV-DISP-CNTRID-TRLR-SRL-NBR           
026395              STRING '3000-'                                              
026396                     ' SQL:'   PV-SQLCODE                                 
026397                     ' TRIP:'  PV-DISP-SUOBTR-OTBND-TRIP-ID               
026398                     ' STAT:'  SUOBTS-TRIP-STAT-CDE                       
026399                     ' TMST:'  PV-STATUS-DATE '-' PV-STATUS-TIME          
026400                     ' SCAC/TRLR:' CNTRID-SCAC-CDE                        
026401                     '/'           CNTRID-TRLR-ID                         
026402                     ' SRL:'   PV-DISP-CNTRID-TRLR-SRL-NBR                
026403                               DELIMITED BY SIZE                          
026404                          INTO PV-MESSAGE-2                               
026405             DISPLAY PV-MESSAGE-1                                         
026406             DISPLAY PV-MESSAGE-2                                         
026407                                                                          
026408             MOVE '3000-GET-CURRENT-TRIP      '                           
026409                                 TO PV-PARAGRAPH-NAME                     
026410             MOVE 'SELECT CURRENT OPEN TRIP INFO  '                       
026411                                 TO PV-DB2-OPERATION-ATTEMPTED            
026412             PERFORM 9100-SQL-ABEND                                       
026413     END-EVALUATE.                                                        
026414                                                                          
026415                                                                          
026416*-----------------------------------------------------------------        
026417*  GET THE CURRENT OUTBOUND TRAILER/TRIP OPENED AT THE DOOR               
026418*  DO NOT CHECK FOR AUDIT OPEN                                            
026419*-----------------------------------------------------------------        
026420 3005-GET-CURRENT-TRIP-DO.                                                
026421                                                                          
026422     EXEC SQL                                                             
026423         SELECT                                                           
026424                 A.OTBND_TRIP_ID                                          
026425              ,  B.TRIP_STAT_CDE                                          
026426              ,  DATE(B.OTBND_STAT_TMST)                                  
026427              ,  TIME(B.OTBND_STAT_TMST)                                  
026428              ,  C.SCAC_CDE                                               
026429              ,  C.TRLR_ID                                                
026430              ,  C.TRLR_SRL_NBR                                           
026431           INTO                                                           
026432                :SUOBTR-OTBND-TRIP-ID                                     
026433              , :SUOBTS-TRIP-STAT-CDE                                     
026434              , :PV-STATUS-DATE                                           
026435              , :PV-STATUS-TIME                                           
026436              , :CNTRID-SCAC-CDE                                          
026437              , :CNTRID-TRLR-ID                                           
026438              , :CNTRID-TRLR-SRL-NBR                                      
026439           FROM TSUOBTR A                                                 
026440              , TSUOBTS B                                                 
026441              , TCNTRID C                                                 
026442          WHERE A.ORGN_OPER_UNT_ID     = :SUOBTR-ORGN-OPER-UNT-ID         
026443            AND A.DEST_OPER_UNT_ID     = :SUOBTR-DEST-OPER-UNT-ID         
026444            AND A.OTBND_TRIP_ID        =  B.OTBND_TRIP_ID                 
026445            AND B.DOOR_ID              = :SUOBTS-DOOR-ID                  
026446            AND B.OTBND_STAT_TMST IN                                      
026447               (SELECT MAX(D.OTBND_STAT_TMST)                             
026448                  FROM TSUOBTS D                                          
026449                 WHERE B.OTBND_TRIP_ID =  D.OTBND_TRIP_ID                 
026450                   AND B.DOOR_ID       =  B.DOOR_ID)                      
026451            AND B.TRIP_STAT_CDE       IN ('DO')                           
026452            AND A.TRLR_SRL_NBR        =  C.TRLR_SRL_NBR                   
026453           WITH UR                                                        
026454                                                                          
026455     END-EXEC.                                                            
026456                                                                          
026457     EVALUATE TRUE                                                        
026458         WHEN SQLCODE = ZERO                                              
026459              SET  PS-OTBND-TRIP        TO  TRUE                          
026460         WHEN SQLCODE = +100                                              
026461              SET PS-OTBND-TRIP-NO      TO  TRUE                          
026462                                                                          
026463         WHEN SQLWARN0 NOT = SPACES                                       
026464         WHEN SQLCODE < ZERO                                              
026465         WHEN SQLCODE > ZERO                                              
026466             MOVE SQLCODE              TO PV-SQLCODE                      
026467             MOVE CNDCDR-OPER-UNT-ID   TO PV-DISP-CNDCDR-OPER             
026468             MOVE CNDRST-STR-NBR       TO PV-DISP-CNDRST-STR              
026469             MOVE CNDRST-DOOR-ID       TO PV-DISP-CNDRST-DOOR-ID          
026470             MOVE XLT00010-LOC-NM      TO PV-DISP-XLT00010-LOC-NM         
026471             MOVE CNDCDR-DOOR-TYP-CDE  TO PV-DISP-CNDCDR-DOOR-TYP         
026472             MOVE CNDCDR-DIVERT-NBR    TO PV-DISP-CNDCDR-DIVERT-N         
026473             MOVE CNDCDR-DIVERT-LOC-ID TO PV-DISP-CNDCDR-DIVERT-L         
026474*                                                                         
026475              STRING '3005-'                                              
026476                     ' SQL:'   PV-SQLCODE                                 
026477                     ' OPER:'  PV-DISP-CNDCDR-OPER                        
026478                     ' DEST:'  PV-DISP-CNDRST-STR                         
026479                     ' DR:'    PV-DISP-CNDRST-DOOR-ID                     
026480                     ' '       PV-DISP-XLT00010-LOC-NM                    
026481                     ' TYP:'   PV-DISP-CNDCDR-DOOR-TYP                    
026482                     ' DVRT#:' PV-DISP-CNDCDR-DIVERT-N                    
026483                     ' LOC:'   PV-DISP-CNDCDR-DIVERT-L                    
026484                               DELIMITED BY SIZE                          
026485                          INTO PV-MESSAGE-1                               
026486                                                                          
026487              MOVE SUOBTR-OTBND-TRIP-ID                                   
026488                                 TO PV-DISP-SUOBTR-OTBND-TRIP-ID          
026489              MOVE CNTRID-TRLR-SRL-NBR                                    
026490                                 TO PV-DISP-CNTRID-TRLR-SRL-NBR           
026491              STRING '3005-'                                              
026492                     ' SQL:'   PV-SQLCODE                                 
026493                     ' TRIP:'  PV-DISP-SUOBTR-OTBND-TRIP-ID               
026494                     ' STAT:'  SUOBTS-TRIP-STAT-CDE                       
026495                     ' TMST:'  PV-STATUS-DATE '-' PV-STATUS-TIME          
026496                     ' SCAC/TRLR:' CNTRID-SCAC-CDE                        
026497                     '/'           CNTRID-TRLR-ID                         
026498                     ' SRL:'   PV-DISP-CNTRID-TRLR-SRL-NBR                
026499                               DELIMITED BY SIZE                          
026500                          INTO PV-MESSAGE-2                               
026501             DISPLAY PV-MESSAGE-1                                         
026502             DISPLAY PV-MESSAGE-2                                         
026503                                                                          
026504             MOVE '3005-GET-CURRENT-TRIP-DO   '                           
026505                                 TO PV-PARAGRAPH-NAME                     
026506             MOVE 'SELECT CURRENT OPEN TRIP INFO  '                       
026507                                 TO PV-DB2-OPERATION-ATTEMPTED            
026508             PERFORM 9100-SQL-ABEND                                       
026509     END-EVALUATE.                                                        
026510                                                                          
026511                                                                          
026512*-----------------------------------------------------------------        
026513*  IF NO TRAILER IS CURRENTLY OPEN, GET THE LAST CONVEYOR CUTOFF          
026514*  FOR THE DOOR                                                           
026515*-----------------------------------------------------------------        
026516 3010-GET-LAST-CUTOFF.                                                    
026517                                                                          
026518     MOVE CNDCDR-OPER-UNT-ID         TO  SUCDOT-OPER-UNT-ID               
026519     MOVE CNDRST-DOOR-ID             TO  SUCDOT-DOOR-ID                   
026520     MOVE CNDRST-STR-NBR             TO  SUOBTR-DEST-OPER-UNT-ID          
026521                                                                          
026522     EXEC SQL                                                             
026523         SELECT                                                           
026524                  MAX(A.END_DIVERT_TMST)                                  
026525           INTO                                                           
026526                :SUCDOT-END-DIVERT-TMST                                   
026527           FROM                                                           
026528                TSUCDOT A                                                 
026529              , TSUOBTR B                                                 
026530          WHERE A.OPER_UNT_ID          = :SUCDOT-OPER-UNT-ID              
026531            AND A.DOOR_ID              = :SUCDOT-DOOR-ID                  
026532            AND A.OTBND_TRIP_ID        =  B.OTBND_TRIP_ID                 
026533            AND B.DEST_OPER_UNT_ID     = :SUOBTR-DEST-OPER-UNT-ID         
026534           WITH UR                                                        
026535                                                                          
026536     END-EXEC.                                                            
026537                                                                          
026538     EVALUATE TRUE                                                        
026539         WHEN SQLCODE = ZERO                                              
026540             CONTINUE                                                     
026541         WHEN SQLCODE = +100                                              
026542         WHEN SQLCODE = -305                                              
026543              MOVE '0001-01-01-00.00.00.000000'                           
026544                TO  SUCDOT-END-DIVERT-TMST                                
026545                                                                          
026546         WHEN SQLWARN0 NOT = SPACES                                       
026547         WHEN SQLCODE < ZERO                                              
026548         WHEN SQLCODE > ZERO                                              
026549             MOVE SQLCODE              TO PV-SQLCODE                      
026550             MOVE CNDCDR-OPER-UNT-ID   TO PV-DISP-CNDCDR-OPER             
026551             MOVE CNDRST-STR-NBR       TO PV-DISP-CNDRST-STR              
026552             MOVE CNDRST-DOOR-ID       TO PV-DISP-CNDRST-DOOR-ID          
026553             MOVE XLT00010-LOC-NM      TO PV-DISP-XLT00010-LOC-NM         
026554             MOVE CNDCDR-DOOR-TYP-CDE  TO PV-DISP-CNDCDR-DOOR-TYP         
026555             MOVE CNDCDR-DIVERT-NBR    TO PV-DISP-CNDCDR-DIVERT-N         
026556             MOVE CNDCDR-DIVERT-LOC-ID TO PV-DISP-CNDCDR-DIVERT-L         
026557*                                                                         
026558              STRING '3010-'                                              
026559                     ' SQL:'   PV-SQLCODE                                 
026560                     ' OPER:'  PV-DISP-CNDCDR-OPER                        
026561                     ' DEST:'  PV-DISP-CNDRST-STR                         
026562                     ' DR:'    PV-DISP-CNDRST-DOOR-ID                     
026563                     ' '       PV-DISP-XLT00010-LOC-NM                    
026564                     ' TYP:'   PV-DISP-CNDCDR-DOOR-TYP                    
026565                     ' DVRT#:' PV-DISP-CNDCDR-DIVERT-N                    
026566                     ' LOC:'   PV-DISP-CNDCDR-DIVERT-L                    
026567                               DELIMITED BY SIZE                          
026568                          INTO PV-MESSAGE-1                               
026569                                                                          
026570             DISPLAY PV-MESSAGE-1                                         
026571                                                                          
026572             MOVE '3010-GET-LAST-CUTOFF       '                           
026573                                 TO PV-PARAGRAPH-NAME                     
026574             MOVE 'SELECT CURRENT OPEN TRIP INFO  '                       
026575                                 TO PV-DB2-OPERATION-ATTEMPTED            
026576             PERFORM 9100-SQL-ABEND                                       
026577     END-EVALUATE.                                                        
026578                                                                          
026579                                                                          
026580*-----------------------------------------------------------------        
026581*  COUNT THE CARTONS DIVERTED BETWEEN THE TRAILER CUTOFFS                 
026582*-----------------------------------------------------------------        
026583 3020-COUNT-DIVERTS-CUTOFF.                                               
026584                                                                          
026585     EXEC SQL                                                             
026586         SELECT                                                           
026587                 COUNT(*)                                                 
026588           INTO                                                           
026589                :PV-DIVERT-CRTN-CNT                                       
026590           FROM                                                           
026591                TSUCDOT A                                                 
026592              , TSUCRDV B                                                 
026593          WHERE                                                           
026594                A.OTBND_TRIP_ID      = :SUOBTR-OTBND-TRIP-ID              
026595            AND A.OPER_UNT_ID        =  B.OPER_UNT_ID                     
026596            AND A.DOOR_ID            =  B.DOOR_ID                         
026597            AND B.ACTV_CDE           = 'A'                                
026598            AND A.STRT_DIVERT_TMST  <= B.DIVERT_TMST                      
026599            AND A.END_DIVERT_TMST   >= B.DIVERT_TMST                      
026600            AND B.DIVERT_TMST IN                                          
026601                (SELECT MAX(C.DIVERT_TMST)                                
026602                   FROM TSUCRDV C                                         
026603                  WHERE C.SHIPT_UNT_ID  =  B.SHIPT_UNT_ID)                
026604           WITH UR                                                        
026605                                                                          
026606     END-EXEC.                                                            
026607                                                                          
026608     EVALUATE TRUE                                                        
026609         WHEN SQLCODE = ZERO                                              
026610             CONTINUE                                                     
026611         WHEN SQLCODE = +100                                              
026612         WHEN SQLCODE = -305                                              
026613              MOVE ZEROES  TO  PV-DIVERT-CRTN-CNT                         
026614                                                                          
026615         WHEN SQLWARN0 NOT = SPACES                                       
026616         WHEN SQLCODE < ZERO                                              
026617         WHEN SQLCODE > ZERO                                              
026618             MOVE SQLCODE              TO PV-SQLCODE                      
026619             MOVE CNDCDR-OPER-UNT-ID   TO PV-DISP-CNDCDR-OPER             
026620             MOVE CNDRST-STR-NBR       TO PV-DISP-CNDRST-STR              
026621             MOVE CNDRST-DOOR-ID       TO PV-DISP-CNDRST-DOOR-ID          
026622             MOVE XLT00010-LOC-NM      TO PV-DISP-XLT00010-LOC-NM         
026623             MOVE CNDCDR-DOOR-TYP-CDE  TO PV-DISP-CNDCDR-DOOR-TYP         
026624             MOVE CNDCDR-DIVERT-NBR    TO PV-DISP-CNDCDR-DIVERT-N         
026625             MOVE CNDCDR-DIVERT-LOC-ID TO PV-DISP-CNDCDR-DIVERT-L         
026626*                                                                         
026627              STRING '3010-'                                              
026628                     ' SQL:'   PV-SQLCODE                                 
026629                     ' OPER:'  PV-DISP-CNDCDR-OPER                        
026630                     ' DEST:'  PV-DISP-CNDRST-STR                         
026631                     ' DR:'    PV-DISP-CNDRST-DOOR-ID                     
026632                     ' '       PV-DISP-XLT00010-LOC-NM                    
026633                     ' TYP:'   PV-DISP-CNDCDR-DOOR-TYP                    
026634                     ' DVRT#:' PV-DISP-CNDCDR-DIVERT-N                    
026635                     ' LOC:'   PV-DISP-CNDCDR-DIVERT-L                    
026636                               DELIMITED BY SIZE                          
026637                          INTO PV-MESSAGE-1                               
026638*                                                                         
026639              MOVE SUOBTR-OTBND-TRIP-ID  TO PV-DISP-OTBND-TRIP            
026640              STRING '3010-'                                              
026641                     ' TRIP:'  PV-DISP-OTBND-TRIP                         
026642                               DELIMITED BY SIZE                          
026643                          INTO PV-MESSAGE-2                               
026644*                                                                         
026645             DISPLAY PV-MESSAGE-1                                         
026646             DISPLAY PV-MESSAGE-2                                         
026647                                                                          
026648             MOVE '3020-COUNT-DIVERTS-CUTOFF  '                           
026649                                 TO PV-PARAGRAPH-NAME                     
026650             MOVE 'SELECT CURRENT OPEN TRIP INFO  '                       
026651                                 TO PV-DB2-OPERATION-ATTEMPTED            
026652             PERFORM 9100-SQL-ABEND                                       
026653     END-EVALUATE.                                                        
026654                                                                          
026655                                                                          
026656*-----------------------------------------------------------------        
026657*  COUNT THE CARTONS THAT ARE SCANNED ONTO TRAILER                        
026658*-----------------------------------------------------------------        
026659 3030-COUNT-SCAN-ON.                                                      
026660                                                                          
026661     MOVE SUOBTR-OTBND-TRIP-ID    TO  SUT00027-OTBND-TRIP-ID              
026662     MOVE CNDCDR-OPER-UNT-ID      TO  SUT00027-LOC-NBR                    
026663                                                                          
026664     EXEC SQL                                                             
026665         SELECT                                                           
026666                 COUNT(*)                                                 
026667           INTO                                                           
026668                :PV-SCAN-ON-CNT                                           
026669           FROM                                                           
026670                SUT_OTBND_LOC                                             
026671          WHERE                                                           
026672                OTBND_TRIP_ID      = :SUT00027-OTBND-TRIP-ID              
026673            AND LOC_NBR            = :SUT00027-LOC-NBR                    
026674            AND ACTV_CDE           = 'A'                                  
026675            AND SCN_CDE            = 'SHON'                               
026676           WITH UR                                                        
026677                                                                          
026678     END-EXEC.                                                            
026679                                                                          
026680     EVALUATE TRUE                                                        
026681         WHEN SQLCODE = ZERO                                              
026682             CONTINUE                                                     
026683         WHEN SQLCODE = +100                                              
026684         WHEN SQLCODE = -305                                              
026685              MOVE ZEROES  TO  PV-SCAN-ON-CNT                             
026686                                                                          
026687         WHEN SQLWARN0 NOT = SPACES                                       
026688         WHEN SQLCODE < ZERO                                              
026689         WHEN SQLCODE > ZERO                                              
026690             MOVE SQLCODE              TO PV-SQLCODE                      
026691             MOVE CNDCDR-OPER-UNT-ID   TO PV-DISP-CNDCDR-OPER             
026692             MOVE CNDRST-STR-NBR       TO PV-DISP-CNDRST-STR              
026693             MOVE CNDRST-DOOR-ID       TO PV-DISP-CNDRST-DOOR-ID          
026694             MOVE XLT00010-LOC-NM      TO PV-DISP-XLT00010-LOC-NM         
026695             MOVE CNDCDR-DOOR-TYP-CDE  TO PV-DISP-CNDCDR-DOOR-TYP         
026696             MOVE CNDCDR-DIVERT-NBR    TO PV-DISP-CNDCDR-DIVERT-N         
026697             MOVE CNDCDR-DIVERT-LOC-ID TO PV-DISP-CNDCDR-DIVERT-L         
026698*                                                                         
026699              STRING '3030-'                                              
026700                     ' SQL:'   PV-SQLCODE                                 
026701                     ' OPER:'  PV-DISP-CNDCDR-OPER                        
026702                     ' DEST:'  PV-DISP-CNDRST-STR                         
026703                     ' DR:'    PV-DISP-CNDRST-DOOR-ID                     
026704                     ' '       PV-DISP-XLT00010-LOC-NM                    
026705                     ' TYP:'   PV-DISP-CNDCDR-DOOR-TYP                    
026706                     ' DVRT#:' PV-DISP-CNDCDR-DIVERT-N                    
026707                     ' LOC:'   PV-DISP-CNDCDR-DIVERT-L                    
026708                               DELIMITED BY SIZE                          
026709                          INTO PV-MESSAGE-1                               
026710*                                                                         
026711              MOVE SUOBTR-OTBND-TRIP-ID  TO PV-DISP-OTBND-TRIP            
026712              STRING '3030-'                                              
026713                     ' TRIP:'  PV-DISP-OTBND-TRIP                         
026714                               DELIMITED BY SIZE                          
026715                          INTO PV-MESSAGE-2                               
026716*                                                                         
026717             DISPLAY PV-MESSAGE-1                                         
026718             DISPLAY PV-MESSAGE-2                                         
026719                                                                          
026720             MOVE '3030-COUNT-SCAN-ON         '                           
026721                                 TO PV-PARAGRAPH-NAME                     
026722             MOVE 'COUNT SCANNED ON CARTONS       '                       
026723                                 TO PV-DB2-OPERATION-ATTEMPTED            
026724             PERFORM 9100-SQL-ABEND                                       
026725     END-EVALUATE.                                                        
026726                                                                          
026727                                                                          
026728*-----------------------------------------------------------------        
026729*  COUNT THE CARTONS DIVERTED TO DOOR - NO TRAILER ASSIGNED               
026730*-----------------------------------------------------------------        
026731 3040-COUNT-DIVERTS-NO-CUTOFF.                                            
026732                                                                          
026733     MOVE CNDCDR-OPER-UNT-ID         TO  SUCRDV-OPER-UNT-ID               
026734     MOVE CNDRST-DOOR-ID             TO  SUCRDV-DOOR-ID                   
026735     MOVE CNDRST-STR-NBR             TO  SUCRDV-DEST-OPER-UNT-ID          
026736     MOVE CNDCDR-DIVERT-NBR          TO  SUCRDV-DIVERT-NBR                
026737     MOVE CNDCDR-DIVERT-LOC-ID       TO  SUCRDV-DIVERT-LOC-ID             
026738                                                                          
026739     EXEC SQL                                                             
026740         SELECT                                                           
026741                 COUNT(*)                                                 
026742           INTO                                                           
026743                :PV-DIVERT-CRTN-CNT                                       
026744           FROM                                                           
026745                TSUCRDV A                                                 
026746          WHERE                                                           
026747                A.OPER_UNT_ID        = :SUCRDV-OPER-UNT-ID                
026748            AND A.DOOR_ID            = :SUCRDV-DOOR-ID                    
026749            AND A.DEST_OPER_UNT_ID   = :SUCRDV-DEST-OPER-UNT-ID           
026750            AND A.DIVERT_NBR         = :SUCRDV-DIVERT-NBR                 
026751            AND A.DIVERT_LOC_ID      = :SUCRDV-DIVERT-LOC-ID              
026752            AND A.ACTV_CDE           = 'A'                                
026753            AND A.DIVERT_TMST        > :SUCDOT-END-DIVERT-TMST            
026754            AND A.DIVERT_TMST IN                                          
026755                (SELECT MAX(B.DIVERT_TMST)                                
026756                   FROM TSUCRDV B                                         
026757                  WHERE B.SHIPT_UNT_ID  =  A.SHIPT_UNT_ID)                
026758           WITH UR                                                        
026759                                                                          
026760     END-EXEC.                                                            
026761                                                                          
026762     EVALUATE TRUE                                                        
026763         WHEN SQLCODE = ZERO                                              
026764             CONTINUE                                                     
026765         WHEN SQLCODE = +100                                              
026766         WHEN SQLCODE = -305                                              
026767              MOVE ZEROES  TO  PV-DIVERT-CRTN-CNT                         
026768                                                                          
026769         WHEN SQLWARN0 NOT = SPACES                                       
026770         WHEN SQLCODE < ZERO                                              
026771         WHEN SQLCODE > ZERO                                              
026772             MOVE SQLCODE              TO PV-SQLCODE                      
026773             MOVE CNDCDR-OPER-UNT-ID   TO PV-DISP-CNDCDR-OPER             
026774             MOVE CNDRST-STR-NBR       TO PV-DISP-CNDRST-STR              
026775             MOVE CNDRST-DOOR-ID       TO PV-DISP-CNDRST-DOOR-ID          
026776             MOVE XLT00010-LOC-NM      TO PV-DISP-XLT00010-LOC-NM         
026777             MOVE CNDCDR-DOOR-TYP-CDE  TO PV-DISP-CNDCDR-DOOR-TYP         
026778             MOVE CNDCDR-DIVERT-NBR    TO PV-DISP-CNDCDR-DIVERT-N         
026779             MOVE CNDCDR-DIVERT-LOC-ID TO PV-DISP-CNDCDR-DIVERT-L         
026780*                                                                         
026781              STRING '3040-'                                              
026782                     ' SQL:'   PV-SQLCODE                                 
026783                     ' OPER:'  PV-DISP-CNDCDR-OPER                        
026784                     ' DEST:'  PV-DISP-CNDRST-STR                         
026785                     ' DR:'    PV-DISP-CNDRST-DOOR-ID                     
026786                     ' '       PV-DISP-XLT00010-LOC-NM                    
026787                     ' TYP:'   PV-DISP-CNDCDR-DOOR-TYP                    
026788                     ' DVRT#:' PV-DISP-CNDCDR-DIVERT-N                    
026789                     ' LOC:'   PV-DISP-CNDCDR-DIVERT-L                    
026790                               DELIMITED BY SIZE                          
026791                          INTO PV-MESSAGE-1                               
026792*                                                                         
026793              MOVE SUOBTR-OTBND-TRIP-ID  TO PV-DISP-OTBND-TRIP            
026794              STRING '3040-'                                              
026795                     ' TRIP:'  PV-DISP-OTBND-TRIP                         
026796                     ' CDOT-TMST:'  SUCDOT-END-DIVERT-TMST                
026797                               DELIMITED BY SIZE                          
026798                          INTO PV-MESSAGE-2                               
026799*                                                                         
026800             DISPLAY PV-MESSAGE-1                                         
026801             DISPLAY PV-MESSAGE-2                                         
026802                                                                          
026803             MOVE '3040-COUNT-DIVERTS-NO-CUTOFF'                          
026804                                 TO PV-PARAGRAPH-NAME                     
026805             MOVE 'CNT DVRTS SINCE LAST TRLR CUTOFF'                      
026806                                 TO PV-DB2-OPERATION-ATTEMPTED            
026807             PERFORM 9100-SQL-ABEND                                       
026808     END-EVALUATE.                                                        
026809                                                                          
026810                                                                          
026811*-----------------------------------------------------------------        
026812*  CHECK IF THE TRIP HAS DIVERT CUTOFF STARTED                            
026813*-----------------------------------------------------------------        
026814 3050-CHECK-CUTOFFS.                                                      
026815                                                                          
026816     EXEC SQL                                                             
026817         SELECT                                                           
026818                 STRT_DIVERT_TMST                                         
026819           INTO                                                           
026820                :SUCDOT-STRT-DIVERT-TMST                                  
026821           FROM                                                           
026822                TSUCDOT A                                                 
026823          WHERE                                                           
026824                A.OTBND_TRIP_ID      = :SUOBTR-OTBND-TRIP-ID              
026825           WITH UR                                                        
026826                                                                          
026827     END-EXEC.                                                            
026828                                                                          
026829     EVALUATE TRUE                                                        
026830         WHEN SQLCODE = ZERO                                              
026831         WHEN SQLCODE = -811                                              
026832             SET  PS-TRIP-HAS-CUTOFF     TO   TRUE                        
026833         WHEN SQLCODE = +100                                              
026834         WHEN SQLCODE = -305                                              
026835             SET  PS-TRIP-HAS-CUTOFF-NO  TO   TRUE                        
026836                                                                          
026837         WHEN SQLWARN0 NOT = SPACES                                       
026838         WHEN SQLCODE < ZERO                                              
026839         WHEN SQLCODE > ZERO                                              
026840             MOVE SQLCODE              TO PV-SQLCODE                      
026841             MOVE CNDCDR-OPER-UNT-ID   TO PV-DISP-CNDCDR-OPER             
026842             MOVE CNDRST-STR-NBR       TO PV-DISP-CNDRST-STR              
026843             MOVE CNDRST-DOOR-ID       TO PV-DISP-CNDRST-DOOR-ID          
026844             MOVE XLT00010-LOC-NM      TO PV-DISP-XLT00010-LOC-NM         
026845             MOVE CNDCDR-DOOR-TYP-CDE  TO PV-DISP-CNDCDR-DOOR-TYP         
026846             MOVE CNDCDR-DIVERT-NBR    TO PV-DISP-CNDCDR-DIVERT-N         
026847             MOVE CNDCDR-DIVERT-LOC-ID TO PV-DISP-CNDCDR-DIVERT-L         
026848*                                                                         
026849              STRING '3050-'                                              
026850                     ' SQL:'   PV-SQLCODE                                 
026851                     ' OPER:'  PV-DISP-CNDCDR-OPER                        
026852                     ' DEST:'  PV-DISP-CNDRST-STR                         
026853                     ' DR:'    PV-DISP-CNDRST-DOOR-ID                     
026854                     ' '       PV-DISP-XLT00010-LOC-NM                    
026855                     ' TYP:'   PV-DISP-CNDCDR-DOOR-TYP                    
026856                     ' DVRT#:' PV-DISP-CNDCDR-DIVERT-N                    
026857                     ' LOC:'   PV-DISP-CNDCDR-DIVERT-L                    
026858                               DELIMITED BY SIZE                          
026859                          INTO PV-MESSAGE-1                               
026860*                                                                         
026861              MOVE SUOBTR-OTBND-TRIP-ID  TO PV-DISP-OTBND-TRIP            
026862              STRING '3050-'                                              
026863                     ' TRIP:'  PV-DISP-OTBND-TRIP                         
026864                               DELIMITED BY SIZE                          
026865                          INTO PV-MESSAGE-2                               
026866*                                                                         
026867             DISPLAY PV-MESSAGE-1                                         
026868             DISPLAY PV-MESSAGE-2                                         
026869                                                                          
026870             MOVE '3050-CHECK-CUTOFFS         '                           
026871                                 TO PV-PARAGRAPH-NAME                     
026872             MOVE 'CHECK IF CUTOFF HAS BEEN SET   '                       
026873                                 TO PV-DB2-OPERATION-ATTEMPTED            
026874             PERFORM 9100-SQL-ABEND                                       
026875     END-EVALUATE.                                                        
026876                                                                          
026877                                                                          
026878*-----------------------------------------------------------------        
026879*  COUNT THE CARTONS ON TRAILER THAT IS ASSIGNED TO THE DOOR              
026880*-----------------------------------------------------------------        
026881 4000-GET-TRIP-COUNTS.                                                    
026882                                                                          
026883     PERFORM 3050-CHECK-CUTOFFS.                                          
026884     IF  PS-TRIP-HAS-CUTOFF                                               
026885         PERFORM 3020-COUNT-DIVERTS-CUTOFF                                
026886     ELSE                                                                 
026887         PERFORM 3010-GET-LAST-CUTOFF                                     
026888         PERFORM 3040-COUNT-DIVERTS-NO-CUTOFF                             
026889     END-IF.                                                              
026890     PERFORM 3030-COUNT-SCAN-ON.                                          
026891                                                                          
026892                                                                          
026893*-----------------------------------------------------------------        
026894*  COUNT THE CARTONS DIVERTED TO THE DOOR SINCE THE LAST END              
026895*  DIVERT WAS SET                                                         
026896*-----------------------------------------------------------------        
026897 4100-GET-DOOR-COUNTS.                                                    
026898                                                                          
026899     PERFORM 3010-GET-LAST-CUTOFF.                                        
026900     PERFORM 3040-COUNT-DIVERTS-NO-CUTOFF.                                
026901                                                                          
026902                                                                          
026903*-----------------------------------------------------------------        
026904*  OPEN THE CURSOR.                                                       
026910*-----------------------------------------------------------------        
027000 7000-OPEN-CURSOR.                                                        
027300                                                                          
027400     EXEC SQL                                                             
027500          OPEN SHIP-DOOR-STORE-CSR                                        
027600     END-EXEC                                                             
027700                                                                          
027800     EVALUATE TRUE                                                        
027810         WHEN SQLCODE = ZERO                                              
027820              CONTINUE                                                    
027900         WHEN SQLCODE = -904                                              
028000         WHEN SQLCODE = -911                                              
028100              CONTINUE                                                    
028200         WHEN SQLWARN0 NOT = SPACES                                       
028300         WHEN SQLCODE < ZERO                                              
028400         WHEN SQLCODE > ZERO                                              
028410             MOVE SQLCODE              TO PV-SQLCODE                      
028420             MOVE CNDCDR-OPER-UNT-ID   TO PV-DISP-CNDCDR-OPER             
028430             MOVE CNDRST-STR-NBR       TO PV-DISP-CNDRST-STR              
028440             MOVE CNDRST-DOOR-ID       TO PV-DISP-CNDRST-DOOR-ID          
028450             MOVE XLT00010-LOC-NM      TO PV-DISP-XLT00010-LOC-NM         
028460             MOVE CNDCDR-DOOR-TYP-CDE  TO PV-DISP-CNDCDR-DOOR-TYP         
028470             MOVE CNDCDR-DIVERT-NBR    TO PV-DISP-CNDCDR-DIVERT-N         
028471             MOVE CNDCDR-DIVERT-LOC-ID TO PV-DISP-CNDCDR-DIVERT-L         
028472*                                                                         
028473              STRING '7000-'                                              
028474                     ' SQL:'   PV-SQLCODE                                 
028475                     ' OPER:'  PV-DISP-CNDCDR-OPER                        
028476                     ' DEST:'  PV-DISP-CNDRST-STR                         
028477                     ' DR:'    PV-DISP-CNDRST-DOOR-ID                     
028478                     ' '       PV-DISP-XLT00010-LOC-NM                    
028479                     ' TYP:'   PV-DISP-CNDCDR-DOOR-TYP                    
028480                     ' DVRT#:' PV-DISP-CNDCDR-DIVERT-N                    
028481                     ' LOC:'   PV-DISP-CNDCDR-DIVERT-L                    
028482                               DELIMITED BY SIZE                          
028483                          INTO PV-MESSAGE-1                               
028484                                                                          
028506                                                                          
028510             MOVE '7000-OPEN-CURSOR            '                          
028600                                 TO PV-PARAGRAPH-NAME                     
028700             MOVE 'OPEN THE SHIP-DOOR-STORE-CSR'                          
028800                                 TO PV-DB2-OPERATION-ATTEMPTED            
028900             PERFORM 9100-SQL-ABEND                                       
029200     END-EVALUATE.                                                        
029400                                                                          
030200                                                                          
030210*-----------------------------------------------------------------        
030220*  FETCH THE ROW FROM THE RESULTS TABLE USING THE CURSOR.                 
030230*-----------------------------------------------------------------        
030300 7005-FETCH-CURSOR.                                                       
030500                                                                          
030700     EXEC SQL                                                             
030800          FETCH SHIP-DOOR-STORE-CSR                                       
031000           INTO :CNDCDR-OPER-UNT-ID                                       
031100               ,:CNDRST-STR-NBR                                           
031110               ,:CNDRST-DOOR-ID                                           
031120               ,:XLT00010-LOC-NM                                          
031200               ,:CNDCDR-DOOR-TYP-CDE                                      
031300               ,:CNDCDR-DIVERT-NBR                                        
031400               ,:CNDCDR-DIVERT-LOC-ID                                     
032300     END-EXEC.                                                            
032400                                                                          
032500     EVALUATE TRUE                                                        
032600         WHEN SQLCODE = ZERO                                              
032610              ADD  1  TO  PV-FETCH-COUNT                                  
032611                          PV-FETCH-COUNT-DISP                             
032620              IF  PV-FETCH-COUNT-DISP >= 100                              
032630                  DISPLAY 'FETCH: '  PV-FETCH-COUNT                       
032640                  MOVE  ZEROES  TO  PV-FETCH-COUNT-DISP                   
032650              END-IF                                                      
032700             CONTINUE                                                     
032800         WHEN SQLCODE = +100                                              
032900             SET PS-EOF-CURSOR          TO  TRUE                          
033000                                                                          
033100         WHEN SQLWARN0 NOT = SPACES                                       
033200         WHEN SQLCODE < ZERO                                              
033300         WHEN SQLCODE > ZERO                                              
033301             MOVE SQLCODE              TO PV-SQLCODE                      
033320             MOVE CNDRST-STR-NBR       TO PV-DISP-CNDRST-STR              
033330             MOVE CNDRST-DOOR-ID       TO PV-DISP-CNDRST-DOOR-ID          
033340             MOVE XLT00010-LOC-NM      TO PV-DISP-XLT00010-LOC-NM         
033350             MOVE CNDCDR-DOOR-TYP-CDE  TO PV-DISP-CNDCDR-DOOR-TYP         
033360             MOVE CNDCDR-DIVERT-NBR    TO PV-DISP-CNDCDR-DIVERT-N         
033370             MOVE CNDCDR-DIVERT-LOC-ID TO PV-DISP-CNDCDR-DIVERT-L         
033394              STRING '7005-'                                              
033395                     ' SQL:'   PV-SQLCODE                                 
033396                     ' OPER:'  PV-DISP-CNDCDR-OPER                        
033397                     ' DEST:'  PV-DISP-CNDRST-STR                         
033398                     ' DR:'    PV-DISP-CNDRST-DOOR-ID                     
033399                     ' '       PV-DISP-XLT00010-LOC-NM                    
033400                     ' TYP:'   PV-DISP-CNDCDR-DOOR-TYP                    
033401                     ' DVRT#:' PV-DISP-CNDCDR-DIVERT-N                    
033402                     ' LOC:'   PV-DISP-CNDCDR-DIVERT-L                    
033403                               DELIMITED BY SIZE                          
033404                          INTO PV-MESSAGE-1                               
033405             DISPLAY PV-MESSAGE-1                                         
033406                                                                          
033410             MOVE '7005-FETCH-CURSOR          '                           
033500                                 TO PV-PARAGRAPH-NAME                     
033600             MOVE 'FETCH THE SHIP-DOOR-STORE-CSR  '                       
033700                                 TO PV-DB2-OPERATION-ATTEMPTED            
033800             PERFORM 9100-SQL-ABEND                                       
033900     END-EVALUATE.                                                        
034000                                                                          
034120                                                                          
034121*-----------------------------------------------------------------        
034122*  CLOSE THE CURSOR.                                                      
034123*-----------------------------------------------------------------        
034124 7010-CLOSE-CURSOR.                                                       
034125                                                                          
034126     EXEC SQL                                                             
034127          CLOSE SHIP-DOOR-STORE-CSR                                       
034128     END-EXEC                                                             
034129                                                                          
034130     EVALUATE TRUE                                                        
034131         WHEN SQLCODE = ZERO                                              
034132              CONTINUE                                                    
034133         WHEN SQLCODE = -904                                              
034134         WHEN SQLCODE = -911                                              
034135              CONTINUE                                                    
034136         WHEN SQLWARN0 NOT = SPACES                                       
034137         WHEN SQLCODE < ZERO                                              
034138         WHEN SQLCODE > ZERO                                              
034139             MOVE SQLCODE              TO PV-SQLCODE                      
034140             MOVE CNDCDR-OPER-UNT-ID   TO PV-DISP-CNDCDR-OPER             
034141             MOVE CNDRST-STR-NBR       TO PV-DISP-CNDRST-STR              
034142             MOVE CNDRST-DOOR-ID       TO PV-DISP-CNDRST-DOOR-ID          
034143             MOVE XLT00010-LOC-NM      TO PV-DISP-XLT00010-LOC-NM         
034144             MOVE CNDCDR-DOOR-TYP-CDE  TO PV-DISP-CNDCDR-DOOR-TYP         
034145             MOVE CNDCDR-DIVERT-NBR    TO PV-DISP-CNDCDR-DIVERT-N         
034146             MOVE CNDCDR-DIVERT-LOC-ID TO PV-DISP-CNDCDR-DIVERT-L         
034147*                                                                         
034148              STRING '7010-'                                              
034149                     ' SQL:'   PV-SQLCODE                                 
034150                     ' OPER:'  PV-DISP-CNDCDR-OPER                        
034151                     ' DEST:'  PV-DISP-CNDRST-STR                         
034152                     ' DR:'    PV-DISP-CNDRST-DOOR-ID                     
034153                     ' '       PV-DISP-XLT00010-LOC-NM                    
034154                     ' TYP:'   PV-DISP-CNDCDR-DOOR-TYP                    
034155                     ' DVRT#:' PV-DISP-CNDCDR-DIVERT-N                    
034156                     ' LOC:'   PV-DISP-CNDCDR-DIVERT-L                    
034157                               DELIMITED BY SIZE                          
034158                          INTO PV-MESSAGE-1                               
034159                                                                          
034160             MOVE '7010-CLOSE-CURSOR           '                          
034161                                 TO PV-PARAGRAPH-NAME                     
034162             MOVE 'CLOSE THE SHIP-DOOR-STORE-CSR'                         
034163                                 TO PV-DB2-OPERATION-ATTEMPTED            
034164             PERFORM 9100-SQL-ABEND                                       
034165     END-EVALUATE.                                                        
034166                                                                          
034167                                                                          
034168*-----------------------------------------------------------------        
034169*  WRITE THE SHIPMENT-UNIT-RECORD                                         
034170*-----------------------------------------------------------------        
034171 8000-WRITE-OUTPUT-RECORD.                                                
034180                                                                          
034600     WRITE OUTPUT-RECORD                                                  
034700      FROM SU116-EXTRACT-RECORD.                                          
034800     ADD +1 TO PV-WRITE-COUNTER.                                          
035690                                                                          
035700                                                                          
035710*-----------------------------------------------------------------        
035711*  CLOSE OUTPUT FILE.  CLOSE THE CURSOR.                                  
035720*-----------------------------------------------------------------        
035800 9000-EOJ-ROUTINE.                                                        
035900                                                                          
036000     PERFORM 7010-CLOSE-CURSOR.                                           
036100                                                                          
036300     CLOSE OUTPUT-FILE.                                                   
036400                                                                          
036500     MOVE PV-WRITE-COUNTER TO PV-DISPLAY-COUNT.                           
036600     DISPLAY 'TOTAL OUTPUT RECORDS:  ' PV-DISPLAY-COUNT.                  
036700                                                                          
040200                                                                          
040210*-----------------------------------------------------------------        
040220*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL            
040230*  ERROR OR WARNING CODE OCCURS.                                          
040240*-----------------------------------------------------------------        
040300 9100-SQL-ABEND.                                                          
040800     DISPLAY '9100-SQL-ABEND'.                                            
040900     DISPLAY '** ABEND     **'.                                           
041000     DISPLAY '** PROGRAM   ** =  SUKUT175'.                               
041100     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.                      
041200     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.             
041300                                                                          
041400******************************************************************        
041500* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-            
041600* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE                 
041700* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE             
041800* FORMAT.                                                                 
041900******************************************************************        
042000     COPY DPPD004.                                                        
042100                                                                          
042200     MOVE +4013                  TO ABEND-CODE.                           
042300     CALL 'ILBOABN0' USING ABEND-CODE.                                    
042310/                                                                         
