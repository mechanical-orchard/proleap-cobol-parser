       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    ICKUP052.                                                 
       AUTHOR.        R. KELLEN.                                                
       INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
       DATE-WRITTEN.  02/01/2008.                                               
       DATE-COMPILED.                                                           
                                                                                
      *****************************************************************         
      * ICKUP052 - EXPLODE COUNT GROUPING TO COUNT/STORE LEVEL                  
      *****************************************************************         
      *        THIS PROGRAM WILL LOOK FOR USA IC COUNTS IN 5                    
      *        CONDITIONS, THOSE PUT INTO 'SCHEDULED' STATUS 1 DAY AGO,         
      *        THOSE THAT ARE IN 'SETUP PROCESSED' AND ARE DUE TO BE            
      *        EXECUTED IN 2 OR 7 OR 14 DAYS, THOSE THAT ARE CURRENTLY          
      *        OCCURING (AND NOT COMPLETED) AND THOSE THAT HAVE BEEN            
      *        SPECIFIED AS REPEATING ON A DAILY, WEEKLY OR MONTHLY             
      *        PERIOD FOR A SPECIFIED RANGE OF TIME. ALSO COUNTS                
      *        CANCELLED SINCE THE LAST TIME THIS PROGRAM RAN. THOSE IN         
      *        THE FIRST 3 CONDITIONS MUST BE NON-REPEATING AND WILL BE         
      *        WRITTEN TO THE CNT-STORE-EXP-FILE AND THOSE IN CANCELLED         
      *        CONDITION WILL BE WRITTEN TO THE CNT-CAN-COUNT-FILE FILE.        
      *        THE 3 NON-REPEATING COUNTS LISTED ABOVE WILL BE SPECIFIED        
      *        AT A GROUP LEVEL (MAJ CLS,SUB CLS,STYLE,SKU) AND                 
      *        SKU IS DETERMINED IN PROGRAM ICKUP053. THOSE SPECIFIED AS        
      *        IMMEDIATE COUNTS WILL BE PROCESSED IN PROGRAM ICKUP053           
      *        AS IMMEDIATE COUNTS ARE SPECIFIED AT A SKU LEVEL AND             
      *        ICKUP053 PROCESSES COUNTS AT THE SKU LEVEL.                      
      *****************************************************************         
      *                                                                         
      *  TABLES UPDATED ARE:                                                    
      *      ICT_CNT_STUP_STAT - IC COUNT SETUP STATUS                          
      *  FILES READ ARE:                                                        
      *      NONE                                                               
      *****************************************************************         
      * 02/02/06 - R KELLEN         -  WR NO. WR30388                           
      *    - NEW PROGRAM.                                                       
      *      THE PROGRAM PROGRAM THAT USES THE IC COUNT SETUP TABLES TO         
      *      DETERMINE WHICH LOCATIONS ARE TO BE INCLUDED IN                    
      *      AN INVENTORY COUNT AND WRITES A FILE OF COUNT/LOCATIONS            
      *      COMBINATIONS TO BE EXPLODED IN A LATER PROGRAM AND A FILE          
      *      OF CANCELLED COUNTS.                                               
      *                                                                         
      *****************************************************************         
      * 01/14/09 - J KNOKE          -  WR NO. WR33304                           
      *      HILO MODIFICATIONS                                                 
      *        JOINING TINVPAR AND TINCNTL FOR CHECKING INVENTORY               
      * 04/06/09 - R KELLEN         -  WR NO. WR36175                           
      *      CHANGE PGM TO ALLOW COUNTS TO BE SENT 21 DAYS BEFORE STORE         
      *      OPEN FOR TERRITORY, REGION AND DISTRICT LEVEL COUNTS. STORE        
      *      LEVEL COUNTS DO NOT CHECK OPEN DATE.                               
014506* 08/12/11 - COGNIZANT        -  PKE000000008634                          
014506*      MODIFIED PROGRAM IN 8910-CHECK-CPLTD-COUNT PARA. THIS IS           
014506*      DONE TO AVOID COUNTS FROM DOWNLOADING AFTER ITS COMPLETED          
014506*      AT THE STORE.                                                      
115091* 06/15/15 - J HUNTER         -  CHG0115091                               
115091*            UPDATED CURSORS RLSE-CNT-CSR, WNDW-CNT-CSR AND               
115091*            RPET-CNT-NEXT-CSR TO EXCLUDE 'ICC' COUNTS, SINCE             
115091*            RFID COUNTS ONLY NEED TO BE EXPLODED ON THE DAYS             
115091*            THEY ARE TO BE COUNTED.  THIS IS A PERFORMANCE               
115091*            CHANGE TO REDUCE THE AMOUNT OF PROCESSING PERFORMED          
115091*            FOR RFID COUNTS.                                             
117191* 08/12/15 - J HUNTER         -  CHG0117191                               
117191*            UPDATED CURSORS OCCR-CNT-CSR AND RPET-CNT-CSR                
117191*            TO EXCLUDE 'ICC' COUNTS, SINCE RFID COUNTS WILL              
117191*            BE EXPLODED BY THE JAVA APPLICATION.                         
117191*            THIS IS A PERFORMANCE CHANGE TO REDUCE THE AMOUNT            
117191*            OF PROCESSING PERFORMED FOR RFID COUNTS.                     
      *****************************************************************         
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
       INPUT-OUTPUT SECTION.                                                    
                                                                                
       FILE-CONTROL.                                                            
           SELECT CNT-STORE-EXP-FILE         ASSIGN TO OUT01.                   
                                                                                
           SELECT CNT-CAN-COUNT-FILE         ASSIGN TO OUT02.                   
                                                                                
      *****************************************************************         
       DATA DIVISION.                                                           
      *****************************************************************         
       FILE SECTION.                                                            
                                                                                
       FD  CNT-STORE-EXP-FILE                                                   
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS                                             
           DATA RECORD IS CNT-STORE-EXP-REC.                                    
       01  CNT-STORE-EXP-REC          PIC  X(32).                               
                                                                                
       FD  CNT-CAN-COUNT-FILE                                                   
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS                                             
           DATA RECORD IS CNT-CAN-COUNT-REC.                                    
       01  CNT-CAN-COUNT-REC          PIC  X(14).                               
      *                                                                         
       WORKING-STORAGE SECTION.                                                 
      ******************************************************************        
      * PC PROGRAM CONSTANTS                                           *        
      ******************************************************************        
       01  PC-PROGRAM-CONSTANTS.                                                
           05  PC-PROGRAM-NAME                PIC X(08)    VALUE                
                                                 'ICKUP052'.                    
           05  PC-MAXIMUM-RETRY-COUNT         PIC S9(04)   VALUE +2             
                                                           COMP SYNC.           
           05  PC-DEFAULT-TMST                PIC X(26)    VALUE                
               '2007-01-01-00.00.00.000000'.                                    
                                                                                
      ******************************************************************        
      * PV PROGRAM VARIABLES                                           *        
      ******************************************************************        
       01  PV-WORK-VARIABLES.                                                   
           05  PV-RETRIES                     PIC S9(04)   VALUE +0             
                                                           COMP.                
           05  PV-PARAGRAPH-NAME              PIC  X(30)   VALUE SPACES.        
           05  PV-DB2-OPERATION-ATTEMPTED     PIC  X(30)   VALUE SPACES.        
           05  PV-FISCAL-DAY-NBR              PIC  9       VALUE ZERO.          
           05  PV-FISCAL-MONTH-NBR            PIC  99      VALUE ZERO.          
           05  PV-SAVE-DAYS-AHEAD             PIC X(05) VALUE SPACES.           
           05  PV-FISCAL-YEAR-NBR             PIC  X(04)   VALUE SPACES.        
           05  PV-FISCAL-YEAR-NBR-X REDEFINES PV-FISCAL-YEAR-NBR                
                                              PIC 9(4).                         
           05  PV-SQLCODE-DISPLAY             PIC +(8)9    VALUE ZEROES.00830000
           05  PV-EXTR-PRC-TMST-NI         PIC S9(04)  COMP                CL*15
                                                         VALUE ZERO.       CL*15
               88 PV-EXTR-PRC-TMST-IS-NULL VALUE -1.                            
           05  PV-SUGG-EXEC-DTE-NI         PIC S9(04)  COMP                CL*15
                                                         VALUE ZERO.       CL*15
               88 PV-SUGG-EXEC-DTE-IS-NULL VALUE -1.                            
               88 PV-SUGG-EXEC-DTE-NOT-NULL VALUE 0.                            
           05  PV-EXEC-WND-STRT-DTE-NI     PIC S9(04)  COMP                CL*15
                                                         VALUE ZERO.       CL*15
               88 PV-EXEC-WND-STRT-DTE-IS-NULL VALUE -1.                        
               88 PV-EXEC-WND-STRT-DTE-NOT-NULL VALUE 0.                        
           05  PV-EXEC-WND-END-DTE-NI     PIC S9(04)  COMP                 CL*15
                                                         VALUE ZERO.       CL*15
               88 PV-EXEC-WND-END-DTE-IS-NULL VALUE -1.                         
               88 PV-EXEC-WND-END-DTE-NOT-NULL VALUE 0.                         
           05  PV-STD-TM-ZN-CDE-NI        PIC S9(04)  COMP                 CL*15
                                                         VALUE ZERO.       CL*15
               88 PV-STD-TM-ZN-CDE-IS-NULL VALUE -1.                            
               88 PV-STD-TM-ZN-CDE-NOT-NULL VALUE 0.                            
           05  PV-DST-IND-NI              PIC S9(04)  COMP                 CL*15
                                                         VALUE ZERO.       CL*15
               88 PV-DST-IND-IS-NULL VALUE -1.                                  
               88 PV-DST-IND-NOT-NULL VALUE 0.                                  
           05  PV-COMMITS-TAKEN            PIC S9(09)  COMP-3              CL*15
                                                         VALUE ZERO.       CL*15
           05  PV-COMMIT-INTERVAL          PIC S9(09)  COMP-3              CL**4
                                                       VALUE +1500.        CL**4
           05  PV-COMMIT-COUNT             PIC S9(09)  COMP-3              CL**4
                                                         VALUE ZERO.       CL**4
           05  PV-CURRENT-WEEKDAY          PIC 9.                          CL**4
           05  PV-CURRENT-WEEK-NBR         PIC 9.                          CL**4
           05  PV-CURRENT-MONTH-NBR        PIC 99.                         CL**4
           05  PV-CURRENT-YEAR-NBR         PIC 9999.                       CL**4
           05  PV-DECREMENT-1ST            PIC 9.                          CL**4
           05  PV-CURRENT-DATE             PIC X(10).                      CL**4
           05  PV-COMPUTED-DATE            PIC X(10).                      CL**4
           05  PV-WINDOW-PLUS-2-DAYS-DATE  PIC X(10).                      CL**4
           05  PV-WINDOW-PLUS-7-DAYS-DATE  PIC X(10).                      CL**4
           05  PV-WINDOW-PLUS-14-DAYS-DATE PIC X(10).                      CL**4
           05  PV-CURRENT-TMST             PIC X(26).                      CL**4
           05  PV-LOCATION-TMST            PIC X(26).                      CL**4
           05  PV-LAST-RUN-TMST            PIC X(26).                      CL**4
           05  PV-INV-CHECK-FLG            PIC X.                          CL**4
               88  PV-INVENTORY-PERIOD     VALUE 'Y'.                           
               88  PV-NOT-INVENTORY-PERIOD VALUE 'N'.                           
           05  PV-COMPLETED-COUNT-FLG      PIC X.                          CL**4
               88  PV-NOT-COMPLETED-COUNT  VALUE 'N'.                           
               88  PV-COMPLETED-COUNT      VALUE 'Y'.                           
                                                                                
      ******************************************************************        
      * PS PROGRAM SWITCHES                                            *        
      ******************************************************************        
       01  PS-PROGRAM-SWITCHES.                                                 
           05  PS-NO-MORE-RLSE-CNT-SW         PIC  X(01)   VALUE 'N'.           
               88  PS-NO-MORE-RLSE-CNT                     VALUE 'Y'.           
               88  PS-MORE-RLSE-CNT                        VALUE 'N'.           
           05  PS-NO-MORE-WNDW-CNT-SW         PIC  X(01)   VALUE 'N'.           
               88  PS-NO-MORE-WNDW-CNT                     VALUE 'Y'.           
               88  PS-MORE-WNDW-CNT                        VALUE 'N'.           
           05  PS-NO-MORE-OCCR-CNT-SW         PIC  X(01)   VALUE 'N'.           
               88  PS-NO-MORE-OCCR-CNT                     VALUE 'Y'.           
               88  PS-MORE-OCCR-CNT                        VALUE 'N'.           
           05  PS-NO-MORE-TERR-LOC-SW         PIC  X(01)   VALUE 'N'.           
               88  PS-NO-MORE-TERR-LOC                     VALUE 'Y'.           
               88  PS-MORE-TERR-LOC                        VALUE 'N'.           
           05  PS-NO-MORE-REGN-LOC-SW         PIC  X(01)   VALUE 'N'.           
               88  PS-NO-MORE-REGN-LOC                     VALUE 'Y'.           
               88  PS-MORE-REGN-LOC                        VALUE 'N'.           
           05  PS-NO-MORE-DIST-LOC-SW         PIC  X(01)   VALUE 'N'.           
               88  PS-NO-MORE-DIST-LOC                     VALUE 'Y'.           
               88  PS-MORE-DIST-LOC                        VALUE 'N'.           
           05  PS-NO-MORE-DC-LOC-SW           PIC  X(01)   VALUE 'N'.           
               88  PS-NO-MORE-DC-LOC                       VALUE 'Y'.           
               88  PS-MORE-DC-LOC                          VALUE 'N'.           
           05  PS-NO-MORE-CANC-CNT-SW         PIC  X(01)   VALUE 'N'.           
               88  PS-NO-MORE-CANC-CNT                     VALUE 'Y'.           
               88  PS-MORE-CANC-CNT                        VALUE 'N'.           
           05  PS-NO-MORE-RPET-CNT-SW         PIC  X(01)   VALUE 'N'.           
               88  PS-NO-MORE-RPET-CNT                     VALUE 'Y'.           
               88  PS-MORE-RPET-CNT                        VALUE 'N'.           
           05  PS-PROCESS-STOP-SW             PIC  X(01)   VALUE 'N'.           
               88  PS-PROCESS-STOP                         VALUE 'Y'.           
           05  PS-LAST-RUN-TMST-FOUND-SW      PIC  X(01)   VALUE 'N'.           
               88  PS-LAST-RUN-TMST-FOUND                  VALUE 'Y'.           
           05  PS-RPET-CNT-SW                 PIC  X(01)   VALUE 'N'.           
               88  PS-RPET-CNT                             VALUE 'Y'.           
               88  PS-NOT-RPET-CNT                         VALUE 'N'.           
                                                                                
       01  ABEND-CODE                         PIC S9(04)   VALUE +0             
                                                           COMP SYNC.           
           88  ABEND-4003-CTRL-CARD-ERROR        VALUE +4003.                   
           88  ABEND-4013-DB2-ERROR              VALUE +4013.                   
           88  ABEND-4019-CAL-SUB-ERROR          VALUE +4019.                   
           88  ABEND-4020-MQ-ERROR               VALUE +4020.                   
           88  ABEND-4444-FORCED-ABEND           VALUE +4444.                   
                                                                                
       01  DISPLAY-EDITS.                                                       
           05  DI-RLSE-CNTS                 PIC  9(09)  VALUE ZEROS.            
           05  DI-WINDOW-CNTS               PIC  9(09)  VALUE ZEROS.            
           05  DI-CURR-OCCR-CNTS            PIC  9(09)  VALUE ZEROS.            
           05  DI-CANCELLED-CNTS            PIC  9(09)  VALUE ZEROS.            
           05  DI-RPET-CNTS                 PIC  9(09)  VALUE ZEROS.            
           05  DI-RPET-FUT-CNTS             PIC  9(09)  VALUE ZEROS.            
           05  DI-COMMIT-CNTR               PIC  9(09)  VALUE ZEROS.            
                                                                                
      *                                                                         
      *----------------------------------------------------------------         
      * DATE ROUTINE COPY MEMBERS                                               
      *----------------------------------------------------------------         
           COPY DPWS500.                                                        
      *****************************************************************         
      *    OUTPUT COPYBOOKS                                                     
      *****************************************************************         
           COPY ICRD052.                                                        
                                                                                
           COPY ICRD056.                                                        
                                                                                
      *****************************************************************         
      *    DB2 COMMUNICATION AREA                                               
      *****************************************************************         
           COPY DPWS004.                                                        
                                                                                
      *****************************************************************         
      *  XST_LOC TABLE                                                          
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE XST00001                                                
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  XST_DC_LOC_ASGMT  TABLE                                                
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE XST00020                                                
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  XST_DIST_REGN TABLE                                                    
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE XST00004                                                
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  XST_REGN_TERR TABLE                                                    
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE XST00006                                                
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  XST_LOC_DIST TABLE                                                     
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE XST00002                                                
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  TINVPAR TABLE                                                          
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE TINVPAR                                                 
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  TINCNTL TABLE                                                          
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE TINCNTL                                                 
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  ICT_CNT_LOC_GP TABLE                                                   
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE ICT00014                                                
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  ICT_LOC_GP_ASSN TABLE                                                  
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE ICT00015                                                
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  ICT_CNT_STUP_STAT TABLE                                                
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE ICT00019                                                
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  ICT_CNT_STUP TABLE                                                     
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE ICT00010                                                
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  ICT_LOC_CNT_STAT TABLE                                                 
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE ICT00020                                                
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  ICT_CNT_RPET_PARM TABLE                                                
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE ICT00013                                                
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  ICT_CNT_EXTR_PRC TABLE                                                 
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE ICT00007                                                
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  TDTATTR DATE TABLE                                                     
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE TDTATTR                                                 
           END-EXEC.                                                            
                                                                                
           EXEC SQL                                                             
               INCLUDE SQLCA                                                    
           END-EXEC.                                                            
                                                                                
           COPY SQLCA2.                                                         
                                                                                
      *----------------------------------------------------------------         
      *  USA IC COUNTS CURSOR WILL FETCH COUNTS RELEASED THE PREVIOUS           
      *  DAY.                                                                   
      *----------------------------------------------------------------         
           EXEC SQL                                                             
             DECLARE RLSE-CNT-CSR CURSOR FOR                                    
             SELECT A.LOC_HIER_CDE                                              
                   ,A.LOC_HIER_VAL_NBR                                          
                   ,D.EXCL_MDSE_IND                                             
                   ,D.CNT_STUP_ID                                               
                   ,D.SUGG_EXEC_DTE                                             
                   ,D.EXEC_WND_STRT_DTE                                         
                   ,D.EXEC_WND_END_DTE                                          
                   ,D.FS_UPD_IND                                                
             FROM   ICT_CNT_LOC_GP    A                                         
                   ,ICT_LOC_GP_ASSN   B                                         
                   ,ICT_CNT_STUP_STAT C                                         
                   ,ICT_CNT_STUP      D                                         
             WHERE A.LOC_GP_ID     = B.LOC_GP_ID                                
               AND A.LAST_ACTN_CDE = 'A'                                        
               AND D.LAST_ACTN_CDE = 'A'                                        
115091         AND D.CNT_TYP_CDE   = 'USA'                                      
               AND C.CNT_STUP_ID   = D.CNT_STUP_ID                              
               AND B.CNT_STUP_ID   = D.CNT_STUP_ID                              
               AND C.CNT_STAT_CDE  = 'SCH'                                      
      *** GET COUNTS THAT WERE RELEASED (IN 'SCH' STATUS) YESTERDAY             
               AND DAY(DATE(C.LAST_UPD_TMST) - CURRENT_DATE) = -1               
               AND C.LAST_UPD_TMST > :PV-LAST-RUN-TMST                          
               AND C.LAST_UPD_TMST =                                            
      *** GET LATEST ICT_CNT_STUP_STAT ROW                                      
             (SELECT MAX(E.LAST_UPD_TMST)                                       
              FROM ICT_CNT_STUP_STAT  E                                         
              WHERE E.CNT_STUP_ID  = C.CNT_STUP_ID)                             
               AND D.LAST_UPD_TMST =                                            
      *** GET LATEST ICT_CNT_STUP ROW                                           
             (SELECT MAX(I.LAST_UPD_TMST)                                       
              FROM ICT_CNT_STUP       I                                         
              WHERE I.CNT_STUP_ID  = C.CNT_STUP_ID)                             
      *** EXCLUDE REPEATING COUNTS                                              
                AND NOT EXISTS                                                  
                 (SELECT 'Y'                                                    
                  FROM ICT_CNT_RPET_PARM G                                      
                  WHERE G.CNT_STUP_ID  = D.CNT_STUP_ID)                         
               AND A.LAST_UPD_TMST =                                            
      *** GET LATEST ICT_CNT_LOC_GP ROW                                         
             (SELECT MAX(H.LAST_UPD_TMST)                                       
              FROM ICT_CNT_LOC_GP     H                                         
              WHERE H.LOC_GP_ID        = A.LOC_GP_ID                            
                AND H.LOC_HIER_CDE     = A.LOC_HIER_CDE                         
                AND H.LOC_HIER_VAL_NBR = A.LOC_HIER_VAL_NBR)                    
           END-EXEC.                                                            
                                                                                
      *----------------------------------------------------------------         
      *  USA IC COUNTS CURSOR WILL FETCH COUNTS WITHIN 2,7 OR 14 DAYS           
      *----------------------------------------------------------------         
           EXEC SQL                                                             
             DECLARE WNDW-CNT-CSR CURSOR FOR                                    
             SELECT A.LOC_HIER_CDE                                              
                   ,A.LOC_HIER_VAL_NBR                                          
                   ,D.EXCL_MDSE_IND                                             
                   ,D.CNT_STUP_ID                                               
                   ,D.SUGG_EXEC_DTE                                             
                   ,D.EXEC_WND_STRT_DTE                                         
                   ,D.EXEC_WND_END_DTE                                          
                   ,DATE(CURRENT_DATE + 2 DAYS)                                 
                   ,DATE(CURRENT_DATE + 7 DAYS)                                 
                   ,DATE(CURRENT_DATE +14 DAYS)                                 
                   ,D.FS_UPD_IND                                                
                                                                                
             FROM   ICT_CNT_LOC_GP    A                                         
                   ,ICT_LOC_GP_ASSN   B                                         
                   ,ICT_CNT_STUP_STAT C                                         
                   ,ICT_CNT_STUP      D                                         
                                                                                
             WHERE A.LOC_GP_ID      = B.LOC_GP_ID                               
               AND A.LAST_ACTN_CDE  = 'A'                                       
               AND C.CNT_STUP_ID    = D.CNT_STUP_ID                             
               AND B.CNT_STUP_ID    = D.CNT_STUP_ID                             
               AND C.CNT_STAT_CDE  IN ('SCH','PRO')                             
115091         AND D.CNT_TYP_CDE    = 'USA'                                     
      *** THIS CONDITION WILL BE PICKED UP IN RLSE-CNT-CSR                      
      *        AND DAY(DATE(C.LAST_UPD_TMST) - CURRENT_DATE) ^= -1              
      * THIS CONDITION CAN BE CAUSED BY COUNTS PROCESSED IN RLSE-CNT-CSR        
      * AND WE DON'T WANT TO PROCESS THEM AGAIN HERE IN WNDW-CNT-CSR.           
               AND DATE(C.LAST_UPD_TMST) ^= CURRENT_DATE                        
      * THIS CHECKS TO SEE IF THE COUNT IS 2,7 OR 14 DAYS FROM OCCURING         
               AND DATE(EXEC_WND_STRT_DTE) IN                                   
                                          (DATE(CURRENT_DATE + 2 DAYS)          
                                          ,DATE(CURRENT_DATE + 7 DAYS)          
                                          ,DATE(CURRENT_DATE +14 DAYS))         
               AND C.LAST_UPD_TMST  =                                           
      *** GET LATEST ICT_CNT_STUP_STAT ROW                                      
             (SELECT MAX(E.LAST_UPD_TMST)                                       
              FROM ICT_CNT_STUP_STAT  E                                         
              WHERE E.CNT_STUP_ID  = C.CNT_STUP_ID)                             
      *** EXCLUDE REPEATING COUNTS                                              
                AND NOT EXISTS                                                  
               (SELECT 'Y'                                                      
                FROM ICT_CNT_RPET_PARM G                                        
                WHERE G.CNT_STUP_ID  = D.CNT_STUP_ID)                           
               AND A.LAST_UPD_TMST =                                            
      *** GET LATEST ICT_CNT_LOC_GP ROW                                         
             (SELECT MAX(H.LAST_UPD_TMST)                                       
              FROM ICT_CNT_LOC_GP     H                                         
              WHERE H.LOC_GP_ID        = A.LOC_GP_ID                            
                AND H.LOC_HIER_CDE     = A.LOC_HIER_CDE                         
                AND H.LOC_HIER_VAL_NBR = A.LOC_HIER_VAL_NBR)                    
      *** GET LATEST ICT_CNT_STUP ROW                                           
              AND D.LAST_UPD_TMST =                                             
                (SELECT MAX(I.LAST_UPD_TMST)                                    
                 FROM ICT_CNT_STUP       I                                      
                 WHERE I.CNT_STUP_ID  = D.CNT_STUP_ID)                          
           END-EXEC.                                                            
                                                                                
      *----------------------------------------------------------------         
      *  USA IC COUNTS CURSOR WILL FETCH CURRENTLY OCCURING COUNTS.             
      *----------------------------------------------------------------         
           EXEC SQL                                                             
             DECLARE OCCR-CNT-CSR CURSOR FOR                                    
             SELECT A.LOC_HIER_CDE                                              
                   ,A.LOC_HIER_VAL_NBR                                          
                   ,D.EXCL_MDSE_IND                                             
                   ,D.CNT_STUP_ID                                               
                   ,D.SUGG_EXEC_DTE                                             
                   ,D.EXEC_WND_STRT_DTE                                         
                   ,D.EXEC_WND_END_DTE                                          
                   ,D.FS_UPD_IND                                                
             FROM   ICT_CNT_LOC_GP    A                                         
                   ,ICT_LOC_GP_ASSN   B                                         
                   ,ICT_CNT_STUP_STAT C                                         
                   ,ICT_CNT_STUP      D                                         
             WHERE A.LOC_GP_ID     = B.LOC_GP_ID                                
               AND A.LAST_ACTN_CDE  = 'A'                                       
               AND C.CNT_STUP_ID   = D.CNT_STUP_ID                              
               AND B.CNT_STUP_ID   = D.CNT_STUP_ID                              
      *** THE COUNT MUST BE IN SCHEDULED (RELEASED) STATUS OR HAVE BEEN         
      *** PREVIOUSLY 'PROCESSED'.                                               
               AND C.CNT_STAT_CDE  IN ('SCH','PRO')                             
               AND D.EXEC_WND_STRT_DTE      <= CURRENT_DATE                     
               AND D.EXEC_WND_END_DTE       >= CURRENT_DATE                     
               AND D.EXEC_WND_STRT_DTE   IS NOT NULL                            
               AND D.EXEC_WND_END_DTE    IS NOT NULL                            
117191         AND D.CNT_TYP_CDE    = 'USA'                                     
               AND C.LAST_UPD_TMST  =                                           
      *** EXCLUDE REPEATING COUNTS                                              
              (SELECT MAX(E.LAST_UPD_TMST)                                      
              FROM ICT_CNT_STUP_STAT  E                                         
              WHERE E.CNT_STUP_ID  = C.CNT_STUP_ID)                             
                AND NOT EXISTS                                                  
                (SELECT 'Y'                                                     
                 FROM ICT_CNT_RPET_PARM G                                       
                 WHERE G.CNT_STUP_ID  = D.CNT_STUP_ID)                          
               AND A.LAST_UPD_TMST =                                            
      *** GET LATEST ICT_CNT_LOC_GP ROW                                         
             (SELECT MAX(I.LAST_UPD_TMST)                                       
              FROM ICT_CNT_LOC_GP     I                                         
              WHERE I.LOC_GP_ID        = A.LOC_GP_ID                            
                AND I.LOC_HIER_CDE     = A.LOC_HIER_CDE                         
                AND I.LOC_HIER_VAL_NBR = A.LOC_HIER_VAL_NBR)                    
      *** EXCLUDE IF COUNT IS 'CANCELLED'                                       
               AND NOT EXISTS                                                   
                (SELECT 'Y'                                                     
                 FROM ICT_CNT_STUP_STAT  J                                      
                 WHERE J.CNT_STAT_CDE   = 'CAN'                                 
                   AND J.CNT_STUP_ID    = C.CNT_STUP_ID)                        
      *** GET LATEST ICT_CNT_STUP ROW                                           
              AND D.LAST_UPD_TMST =                                             
                (SELECT MAX(K.LAST_UPD_TMST)                                    
                 FROM ICT_CNT_STUP       K                                      
                 WHERE K.CNT_STUP_ID  = D.CNT_STUP_ID)                          
           END-EXEC.                                                            
                                                                                
      *----------------------------------------------------------------         
      *  USA IC COUNTS CURSOR WILL FIND ALL LOCATIONS WITHIN A TERRITORY        
      *----------------------------------------------------------------         
           EXEC SQL                                                             
             DECLARE TERR-LOC-CSR CURSOR FOR                                    
             SELECT   D.LOC_NBR                                                 
               FROM   XST_REGN_TERR A                                           
                     ,XST_DIST_REGN B                                           
                     ,XST_LOC_DIST  C                                           
                     ,XST_LOC       D                                           
               WHERE A.TERR_NBR       = :XST00006-TERR-NBR                      
                 AND A.BEG_DTE       <= CURRENT DATE                            
                 AND (A.END_DTE      >= CURRENT DATE                            
                  OR  A.END_DTE  IS NULL)                                       
                 AND B.REGN_NBR         = A.REGN_NBR                            
                 AND B.BEG_DTE       <= CURRENT DATE                            
                 AND (B.END_DTE      >= CURRENT DATE                            
                  OR  B.END_DTE  IS NULL)                                       
                 AND C.DIST_NBR       = B.DIST_NBR                              
                 AND C.BEG_DTE       <= CURRENT DATE                            
                 AND (C.END_DTE       >  CURRENT DATE                           
                 OR  C.END_DTE  IS NULL)                                        
                 AND D.LOC_NBR          = C.LOC_NBR                             
                 AND D.OPN_DTE       <= CURRENT DATE + 21 DAYS                  
                 AND (D.CLO_DTE      >= CURRENT DATE                            
                 OR  D.CLO_DTE  IS NULL)                                        
      *          AND NOT EXISTS                                                 
      *           (SELECT 'Y'                                                   
      *            FROM ICT_LOC_CNT_STAT  E                                     
      *            WHERE E.LOC_NBR      = C.LOC_NBR                             
      *              AND E.CNT_STAT_CDE = 'COM'                                 
      *              AND E.CNT_STUP_ID  = :ICT00010-CNT-STUP-ID                 
      *              AND NOT EXISTS                                             
      *              (SELECT 'Y'                                                
      *              FROM ICT_CNT_RPET_PARM R                                   
      *              WHERE E.CNT_STUP_ID  = R.CNT_STUP_ID))                     
           END-EXEC.                                                            
      *----------------------------------------------------------------         
      *  USA IC COUNTS CURSOR WILL FIND ALL LOCATIONS WITHIN A REGION.          
      *----------------------------------------------------------------         
           EXEC SQL                                                             
             DECLARE REGN-LOC-CSR CURSOR FOR                                    
             SELECT   C.LOC_NBR                                                 
             FROM   XST_DIST_REGN A                                             
                   ,XST_LOC_DIST  B                                             
                   ,XST_LOC       C                                             
             WHERE A.REGN_NBR       = :XST00004-REGN-NBR                        
               AND A.BEG_DTE       <= CURRENT DATE                              
               AND (A.END_DTE      >= CURRENT DATE                              
                OR  A.END_DTE  IS NULL)                                         
               AND B.BEG_DTE       <= CURRENT DATE                              
               AND B.DIST_NBR       = A.DIST_NBR                                
               AND B.BEG_DTE       <= CURRENT DATE                              
               AND (B.END_DTE      >= CURRENT DATE                              
               OR  B.END_DTE  IS NULL)                                          
               AND C.LOC_NBR        = B.LOC_NBR                                 
               AND C.OPN_DTE       <= CURRENT DATE + 21 DAYS                    
               AND (C.CLO_DTE      >= CURRENT DATE                              
                OR  C.CLO_DTE  IS NULL)                                         
      *        AND NOT EXISTS                                                   
      *         (SELECT 'Y'                                                     
      *          FROM ICT_LOC_CNT_STAT  E                                       
      *          WHERE E.LOC_NBR      = C.LOC_NBR                               
      *            AND E.CNT_STAT_CDE = 'COM'                                   
      *            AND E.CNT_STUP_ID  = :ICT00010-CNT-STUP-ID                   
      *              AND NOT EXISTS                                             
      *              (SELECT 'Y'                                                
      *              FROM ICT_CNT_RPET_PARM R                                   
      *              WHERE E.CNT_STUP_ID  = R.CNT_STUP_ID))                     
           END-EXEC.                                                            
      *----------------------------------------------------------------         
      *  USA IC COUNTS CURSOR WILL FIND ALL LOCATIONS WITHIN A DISTRICT         
      *----------------------------------------------------------------         
           EXEC SQL                                                             
             DECLARE DIST-LOC-CSR CURSOR FOR                                    
             SELECT   B.LOC_NBR                                                 
             FROM   XST_LOC_DIST A                                              
                   ,XST_LOC      B                                              
             WHERE  A.DIST_NBR       = :XST00004-DIST-NBR                       
                AND A.BEG_DTE       <= CURRENT DATE                             
                AND (A.END_DTE      >=  CURRENT DATE                            
                OR  A.END_DTE  IS NULL)                                         
                AND B.LOC_NBR        = A.LOC_NBR                                
                AND B.OPN_DTE       <= CURRENT DATE + 21 DAYS                   
                AND (B.CLO_DTE      >= CURRENT DATE                             
                 OR  B.CLO_DTE  IS NULL)                                        
      *        AND NOT EXISTS                                                   
      *         (SELECT 'Y'                                                     
      *          FROM ICT_LOC_CNT_STAT  E                                       
      *          WHERE E.LOC_NBR      = A.LOC_NBR                               
      *            AND E.CNT_STAT_CDE = 'COM'                                   
      *            AND E.CNT_STUP_ID  = :ICT00010-CNT-STUP-ID                   
      *              AND NOT EXISTS                                             
      *              (SELECT 'Y'                                                
      *              FROM ICT_CNT_RPET_PARM R                                   
      *              WHERE E.CNT_STUP_ID  = R.CNT_STUP_ID))                     
           END-EXEC.                                                            
                                                                                
      *----------------------------------------------------------------         
      *  USA IC COUNTS CURSOR WILL FIND ALL LOCATIONS WITHIN A DC               
      *----------------------------------------------------------------         
           EXEC SQL                                                             
             DECLARE DC-LOC-CSR CURSOR FOR                                      
             SELECT   B.LOC_NBR                                                 
             FROM   XST_DC_LOC_ASGMT A                                          
                   ,XST_LOC      B                                              
             WHERE  A.DC_NBR       = :XST00020-DC-NBR                           
                AND B.LOC_NBR      = A.LOC_NBR                                  
                AND A.EFF_BEG_DTE <= CURRENT DATE                               
      *        AND NOT EXISTS                                                   
      *         (SELECT 'Y'                                                     
      *          FROM ICT_LOC_CNT_STAT  E                                       
      *          WHERE E.LOC_NBR      = A.LOC_NBR                               
      *            AND E.CNT_STAT_CDE = 'COM'                                   
      *            AND E.CNT_STUP_ID  = :ICT00010-CNT-STUP-ID                   
      *              AND NOT EXISTS                                             
      *              (SELECT 'Y'                                                
      *              FROM ICT_CNT_RPET_PARM R                                   
      *              WHERE E.CNT_STUP_ID  = R.CNT_STUP_ID))                     
                                                                                
           END-EXEC.                                                            
      *----------------------------------------------------------------         
      *  USA IC COUNTS CURSOR WILL ALL CANCELLED COUNTS                         
      *----------------------------------------------------------------         
           EXEC SQL                                                             
             DECLARE CANC-CNT-CSR CURSOR FOR                                    
             SELECT A.CNT_STUP_ID                                               
             FROM   ICT_CNT_STUP_STAT A                                         
                   ,ICT_CNT_STUP      B                                         
             WHERE A.CNT_STAT_CDE  = 'CAN'                                      
              AND B.CNT_STUP_ID         = A.CNT_STUP_ID                         
              AND DAY(DATE(A.LAST_UPD_TMST) - CURRENT_DATE) = -1                
              AND A.LAST_UPD_TMST       =                                       
      *** GET LATEST ICT_CNT_STUP_STAT ROW                                      
               (SELECT MAX(C.LAST_UPD_TMST)                                     
                FROM ICT_CNT_STUP_STAT C                                        
                WHERE C.CNT_STUP_ID  = B.CNT_STUP_ID                            
                  AND C.CNT_STAT_CDE = A.CNT_STAT_CDE)                          
              AND B.LAST_UPD_TMST       =                                       
      *** GET LATEST ICT_CNT_STUP ROW                                           
               (SELECT MAX(D.LAST_UPD_TMST)                                     
                FROM ICT_CNT_STUP D                                             
                WHERE D.CNT_STUP_ID  = B.CNT_STUP_ID)                           
                                                                                
           END-EXEC.                                                            
                                                                                
      *----------------------------------------------------------------         
      *  USA IC COUNTS CURSOR WITH ALL REPEAT COUNTS (CURRENT)                  
      *----------------------------------------------------------------         
           EXEC SQL                                                             
             DECLARE RPET-CNT-CSR CURSOR FOR                                    
             SELECT  A.LOC_HIER_CDE                                             
                    ,A.LOC_HIER_VAL_NBR                                         
                    ,D.EXCL_MDSE_IND                                            
                    ,D.CNT_STUP_ID                                              
                    ,E.CNT_FRQ_CDE                                              
                    ,D.FS_UPD_IND                                               
             FROM  ICT_CNT_LOC_GP     A                                         
                  ,ICT_LOC_GP_ASSN    B                                         
                  ,ICT_CNT_STUP_STAT  C                                         
                  ,ICT_CNT_STUP       D                                         
                  ,ICT_CNT_RPET_PARM  E                                         
             WHERE A.LOC_GP_ID          = B.LOC_GP_ID                           
               AND E.CNT_STUP_ID        = D.CNT_STUP_ID                         
               AND C.CNT_STUP_ID        = D.CNT_STUP_ID                         
               AND B.CNT_STUP_ID        = D.CNT_STUP_ID                         
               AND D.LAST_ACTN_CDE      = 'A'                                   
               AND A.LAST_ACTN_CDE      = 'A'                                   
117191         AND D.CNT_TYP_CDE        = 'USA'                                 
               AND E.RPET_WND_STRT_DTE <= CURRENT_DATE                          
               AND E.RPET_WND_END_DTE  >= CURRENT_DATE                          
      *** THE COUNT MUST BE IN SCHEDULED (RELEASED) STATUS OR HAVE BEEN         
      *** PREVIOUSLY 'PROCESSED'.                                               
               AND C.CNT_STAT_CDE     IN ('SCH','PRO')                          
      *** DAILY COUNT                                                           
               AND (E.CNT_FRQ_CDE       = 'DAY'                                 
      *** WEEKLY COUNT                                                          
                OR (E.CNT_FRQ_CDE       = 'WKL'                                 
               AND E.DAY_OF_WK_CDE      = :ICT00013-DAY-OF-WK-CDE)              
      *** MONTHLY COUNT                                                         
                OR (E.CNT_FRQ_CDE       = 'MTH'                                 
               AND E.DAY_OF_WK_CDE      = :ICT00013-DAY-OF-WK-CDE               
               AND E.WK_OF_MN_NBR       = :ICT00013-WK-OF-MN-NBR))              
      *** GET LATEST ICT_CNT_LOC_GP ROW                                         
               AND A.LAST_UPD_TMST      =                                       
             (SELECT MAX(J.LAST_UPD_TMST)                                       
              FROM ICT_CNT_LOC_GP     J                                         
              WHERE J.LOC_GP_ID    = A.LOC_GP_ID                                
                AND J.LOC_HIER_CDE = A.LOC_HIER_CDE                             
                AND J.LOC_HIER_VAL_NBR = A.LOC_HIER_VAL_NBR)                    
      *** GET LATEST ICT_CNT_STUP ROW                                           
               AND D.LAST_UPD_TMST      =                                       
             (SELECT MAX(I.LAST_UPD_TMST)                                       
              FROM ICT_CNT_STUP       I                                         
              WHERE I.CNT_STUP_ID  = D.CNT_STUP_ID)                             
      *** GET LATEST ICT_CNT_RPET_PARM ROW                                      
               AND E.LAST_UPD_TMST      =                                       
             (SELECT MAX(K.LAST_UPD_TMST)                                       
              FROM ICT_CNT_RPET_PARM  K                                         
              WHERE K.CNT_STUP_ID  = D.CNT_STUP_ID)                             
      *** EXCLUDE IF COUNT IS 'CANCELLED'                                       
               AND NOT EXISTS                                                   
                (SELECT 'Y'                                                     
                 FROM ICT_CNT_STUP_STAT  F                                      
                 WHERE F.CNT_STAT_CDE   = 'CAN'                                 
                   AND F.CNT_STUP_ID    = D.CNT_STUP_ID)                        
               AND  C.LAST_UPD_TMST      =                                      
                 (SELECT MAX(M.LAST_UPD_TMST)                                   
                  FROM ICT_CNT_STUP_STAT       M                                
                  WHERE M.CNT_STUP_ID  = D.CNT_STUP_ID)                         
           END-EXEC.                                                            
                                                                                
      *----------------------------------------------------------------         
      *  USA IC COUNTS CURSOR WITH ALL REPEAT COUNTS (FUTURE) TO PUT            
      *  OUT DATA FOR THE NEXT OCCURANCE OF THE COUNT SO THE STORES CAN         
      *  SEE THE COUNT SCHEDULE ON THE NOTIFICATION WEB APP. ONLY WEEKLY        
      *  AND MONTHLY REPEATING COUNTS WILL BE PICKED UP FOR THIS. THE           
      *  DAILY COUNTS WILL BE EXCLUDED.                                         
      *----------------------------------------------------------------         
           EXEC SQL                                                             
             DECLARE RPET-CNT-NEXT-CSR CURSOR FOR                               
             SELECT  A.LOC_HIER_CDE                                             
                    ,A.LOC_HIER_VAL_NBR                                         
                    ,D.EXCL_MDSE_IND                                            
                    ,D.CNT_STUP_ID                                              
                    ,E.CNT_FRQ_CDE                                              
                    ,E.RPET_WND_STRT_DTE                                        
                    ,E.RPET_WND_END_DTE                                         
                    ,D.FS_UPD_IND                                               
             FROM  ICT_CNT_LOC_GP     A                                         
                  ,ICT_LOC_GP_ASSN    B                                         
                  ,ICT_CNT_STUP_STAT  C                                         
                  ,ICT_CNT_STUP       D                                         
                  ,ICT_CNT_RPET_PARM  E                                         
             WHERE A.LOC_GP_ID          = B.LOC_GP_ID                           
               AND E.CNT_STUP_ID        = D.CNT_STUP_ID                         
               AND C.CNT_STUP_ID        = D.CNT_STUP_ID                         
               AND B.CNT_STUP_ID        = D.CNT_STUP_ID                         
               AND A.LAST_ACTN_CDE      = 'A'                                   
               AND D.LAST_ACTN_CDE      = 'A'                                   
115091         AND D.CNT_TYP_CDE        = 'USA'                                 
               AND E.RPET_WND_STRT_DTE <= :PV-COMPUTED-DATE                     
               AND E.RPET_WND_END_DTE  >= :PV-COMPUTED-DATE                     
               AND C.CNT_STAT_CDE     IN ('SCH','PRO')                          
               AND ((E.CNT_FRQ_CDE      = 'WKL'                                 
               AND E.DAY_OF_WK_CDE      = :ICT00013-DAY-OF-WK-CDE)              
                OR (E.CNT_FRQ_CDE       = 'MTH'                                 
               AND E.DAY_OF_WK_CDE      = :ICT00013-DAY-OF-WK-CDE               
               AND E.WK_OF_MN_NBR       = :ICT00013-WK-OF-MN-NBR))              
      *** GET LATEST ICT_CNT_LOC_GP ROW                                         
               AND A.LAST_UPD_TMST      =                                       
             (SELECT MAX(J.LAST_UPD_TMST)                                       
              FROM ICT_CNT_LOC_GP     J                                         
              WHERE J.LOC_GP_ID    = A.LOC_GP_ID                                
                AND J.LOC_HIER_CDE = A.LOC_HIER_CDE                             
                AND J.LOC_HIER_VAL_NBR = A.LOC_HIER_VAL_NBR)                    
      *** GET LATEST ICT_CNT_STUP ROW                                           
               AND D.LAST_UPD_TMST      =                                       
             (SELECT MAX(I.LAST_UPD_TMST)                                       
              FROM ICT_CNT_STUP       I                                         
              WHERE I.CNT_STUP_ID  = D.CNT_STUP_ID)                             
      *** GET LATEST ICT_CNT_RPET_PARM ROW                                      
               AND E.LAST_UPD_TMST      =                                       
             (SELECT MAX(K.LAST_UPD_TMST)                                       
              FROM ICT_CNT_RPET_PARM  K                                         
              WHERE K.CNT_STUP_ID  = D.CNT_STUP_ID)                             
      *** EXCLUDE IF COUNT IS 'CANCELLED'                                       
               AND NOT EXISTS                                                   
                (SELECT 'Y'                                                     
                 FROM ICT_CNT_STUP_STAT  F                                      
                 WHERE F.CNT_STAT_CDE   = 'CAN'                                 
                   AND F.CNT_STUP_ID    = D.CNT_STUP_ID)                        
               AND  C.LAST_UPD_TMST      =                                      
                 (SELECT MAX(M.LAST_UPD_TMST)                                   
                  FROM ICT_CNT_STUP_STAT       M                                
                  WHERE M.CNT_STUP_ID  = D.CNT_STUP_ID)                         
           END-EXEC.                                                            
                                                                                
       PROCEDURE DIVISION.                                                      
      ******************************************************************        
      * 0000-MAIN-MODULE.                                              *        
      *  ==> PROCESSES:                                                *        
      *    - CONTROLS HIGHEST LEVEL FLOW OF PROGRAM                    *        
      ******************************************************************        
       0000-MAIN-MODULE.                                                        
           MOVE '0000-MAIN-MODULE' TO PV-PARAGRAPH-NAME.                        
                                                                                
           PERFORM 1000-INITIALIZATION.                                         
                                                                                
           PERFORM 2000-PROCESS-COUNTS.                                         
                                                                                
           PERFORM 3000-EOJ-PROCESSING.                                         
                                                                                
           STOP RUN.                                                            
                                                                                
      ******************************************************************        
      * 1000-INITIALIZATION.                                           *        
      ******************************************************************        
       1000-INITIALIZATION.                                                     
           MOVE '1000-INITIALIZATION ' TO PV-PARAGRAPH-NAME.                    
           DISPLAY 'EXECUTING TEST VERSION OF ICKUP052'.                        
           PERFORM 8920-SELECT-LAST-RUN-TMST.                                   
           IF PV-EXTR-PRC-TMST-IS-NULL                                          
             MOVE PC-DEFAULT-TMST TO PV-LAST-RUN-TMST                           
           ELSE                                                                 
             MOVE ICT00007-EXTR-PRC-TMST TO PV-LAST-RUN-TMST.                   
           DISPLAY 'LAST RUN WAS -  ' PV-LAST-RUN-TMST.                         
                                                                                
           OPEN OUTPUT CNT-STORE-EXP-FILE                                       
                       CNT-CAN-COUNT-FILE.                                      
                                                                                
           PERFORM 1100-CALENDAR-DAY-OF-WEEK.                                   
                                                                                
       1100-CALENDAR-DAY-OF-WEEK.                                               
           MOVE '1100-CALENDAR-DAY-OF-WEEK' TO PV-PARAGRAPH-NAME.               
           EXEC SQL                                                             
               SET :PV-CURRENT-DATE = CURRENT DATE                              
           END-EXEC.                                                            
                                                                                
           EXEC SQL                                                             
               SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                         
           END-EXEC.                                                            
                                                                                
           MOVE PV-CURRENT-DATE TO DTATTR-KY-DTE.                               
           EXEC SQL                                                             
               SELECT WK_IN_MN_NBR                                              
                     ,DAY_OF_WK_NBR                                             
                     ,FSCL_MN_NBR                                               
                     ,FSCL_YR_NBR                                               
               INTO :DTATTR-WK-IN-MN-NBR                                        
                   ,:DTATTR-DAY-OF-WK-NBR                                       
                   ,:DTATTR-FSCL-MN-NBR                                         
                   ,:DTATTR-FSCL-YR-NBR                                         
               FROM TDTATTR                                                     
               WHERE KY_DTE   = :DTATTR-KY-DTE                                  
           END-EXEC.                                                            
           EVALUATE TRUE                                                        
              WHEN SQLCODE = 0                                                  
                  CONTINUE                                                      
              WHEN OTHER                                                        
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 SELECT WEEK DAY/NBR'                        
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-EVALUATE                                                         
                                                                                
           MOVE DTATTR-DAY-OF-WK-NBR   TO PV-CURRENT-WEEKDAY.                   
           MOVE DTATTR-WK-IN-MN-NBR    TO PV-CURRENT-WEEK-NBR.                  
           MOVE DTATTR-FSCL-MN-NBR     TO PV-CURRENT-MONTH-NBR.                 
           MOVE DTATTR-FSCL-YR-NBR     TO PV-CURRENT-YEAR-NBR.                  
           DISPLAY 'WEEK DAY: '  PV-CURRENT-WEEKDAY.                            
           DISPLAY 'WEEK NBR: '  PV-CURRENT-WEEK-NBR.                           
                                                                                
      *----------------------------------------------------------               
      * 1500-FUTURE-OFFSET-DTE.                                                 
      *     GETS THE FUTURE DATE.                                               
      *----------------------------------------------------------               
       1500-FUTURE-OFFSET-DTE.                                                  
                                                                                
           MOVE PV-CURRENT-DATE TO DPG52-LK-DATE-INPUT.                         
           DISPLAY 'INPUT TO DATE OFFSET ' DPG52-LK-DATE-INPUT.                 
                                                                                
           CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53            
                                                   DPG54 DPG55 DPG56.           
           EVALUATE TRUE                                                        
               WHEN DPG54-NO-ERROR                                              
                   DISPLAY 'DAYS AHEAD NEEDED: ' DPG51-INCR-DECR-DAYS-X         
                   DISPLAY 'RETRIEVING FUTURE OFFSET DATE'                      
               WHEN DPG54-SEVERE-ERROR                                          
                   DISPLAY ' '                                                  
                   DISPLAY '** ABEND ** IN ICKUP052'                            
                   DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'            
                   DISPLAY '** CALLED BY 1500-FUTURE-OFFSET-DTE'                
                   DISPLAY '** ERROR MESSAGE = '                                
                                     DPG54-ERROR-MESSAGE                        
                   DISPLAY '** DPG51 = ' DPG51                                  
                   DISPLAY '** DPG52 = ' DPG52                                  
                   DISPLAY '** DPG53 = ' DPG53                                  
                   DISPLAY '** DPG54 = ' DPG54                                  
                   DISPLAY '** DPG55 = ' DPG55                                  
                   DISPLAY '** DPG56 = ' DPG56                                  
                   MOVE '1500-FUTURE-OFFSET-DTE'                                
                                                 TO PV-PARAGRAPH-NAME           
                   MOVE 'ERROR VALIDATING INPUT DATE'                           
                                 TO PV-DB2-OPERATION-ATTEMPTED                  
                   SET ABEND-4019-CAL-SUB-ERROR  TO TRUE                        
                   DISPLAY DPG54-ERROR-MESSAGE                                  
                   PERFORM 9999-SQL-ABEND                                       
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      * 2000-PROCESS-COUNTS.                                           *        
      *  ==> FINDS ALL LOCATION GROUPS FOR EACH COUNT.                 *        
      ******************************************************************        
       2000-PROCESS-COUNTS.                                                     
      ****************************************************************          
      *** COUNTS THAT WERE RELEASED 1 DAY AGO.                                  
      ****************************************************************          
           MOVE 'N'         TO ICRD052-CLRNC-CHK-IND.                           
           SET  PS-MORE-RLSE-CNT TO TRUE.                                       
           PERFORM 8100-OPEN-RLSE-CNT.                                          
           PERFORM 8110-FETCH-RLSE-CNT.                                         
           PERFORM                                                              
             UNTIL PS-NO-MORE-RLSE-CNT                                          
      *** THIS WILL CAUSE THE CHECK FOR COMPLETED COUNT TO BE DONE              
             SET PS-NOT-RPET-CNT TO TRUE                                        
             MOVE ICT00010-EXEC-WND-STRT-DTE TO ICRD052-EXEC-DTE                
             MOVE 'N' TO ICRD052-RPET-CNT-IND                                   
             PERFORM 2100-PROCESS-RLSD-COUNTS                                   
             IF ICT00010-CNT-STUP-ID NOT = ICT00019-CNT-STUP-ID                 
               MOVE ICT00010-CNT-STUP-ID   TO ICT00019-CNT-STUP-ID              
               PERFORM 8930-INSERT-STUP-PRC-ROW                                 
             END-IF                                                             
             PERFORM 8110-FETCH-RLSE-CNT                                        
           END-PERFORM.                                                         
           PERFORM 8120-CLOSE-RLSE-CNT.                                         
           PERFORM 8000-SQL-COMMIT.                                             
           DISPLAY 'RELEASED COUNT PROCESSING DONE'.                            
                                                                                
      ****************************************************************          
      *** COUNTS THAT ARE IN RELEASED AND SCHEDULED TO HAPPEN IN 2,7 OR         
      *** 14 DAYS.                                                              
      ****************************************************************          
           MOVE 'N'         TO ICRD052-CLRNC-CHK-IND.                           
           PERFORM 8200-OPEN-WNDW-CNT.                                          
           PERFORM 8210-FETCH-WNDW-CNT.                                         
           PERFORM                                                              
             UNTIL PS-NO-MORE-WNDW-CNT                                          
             MOVE 'N' TO ICRD052-RPET-CNT-IND                                   
      *** THIS WILL CAUSE THE CHECK FOR COMPLETED COUNT TO BE DONE              
             SET PS-NOT-RPET-CNT TO TRUE                                        
             MOVE PV-CURRENT-DATE TO ICRD052-EXEC-DTE                           
      *** FIND THE CORRECT DATE TO SET EXEC-DTE TO AS IT COULD ANY ONE          
      *** OF 3.                                                                 
             IF ICT00010-EXEC-WND-STRT-DTE = PV-WINDOW-PLUS-2-DAYS-DATE         
               MOVE PV-WINDOW-PLUS-2-DAYS-DATE TO ICRD052-EXEC-DTE              
             ELSE                                                               
              IF ICT00010-EXEC-WND-STRT-DTE = PV-WINDOW-PLUS-7-DAYS-DATE        
                MOVE PV-WINDOW-PLUS-7-DAYS-DATE TO ICRD052-EXEC-DTE             
              ELSE                                                              
                MOVE PV-WINDOW-PLUS-14-DAYS-DATE TO ICRD052-EXEC-DTE            
              END-IF                                                            
             END-IF                                                             
      ***                                                                       
             PERFORM 2100-PROCESS-RLSD-COUNTS                                   
             IF ICT00010-CNT-STUP-ID NOT = ICT00019-CNT-STUP-ID                 
               MOVE ICT00010-CNT-STUP-ID   TO ICT00019-CNT-STUP-ID              
               PERFORM 8930-INSERT-STUP-PRC-ROW                                 
             END-IF                                                             
             PERFORM 8210-FETCH-WNDW-CNT                                        
           END-PERFORM.                                                         
           PERFORM 8220-CLOSE-WNDW-CNT.                                         
           PERFORM 8000-SQL-COMMIT.                                             
           DISPLAY 'WINDOW COUNT PROCESSING DONE'.                              
                                                                                
      ****************************************************************          
      * COUNTS THAT ARE OCCURRING NOW AND NOT COMPLETED.                        
      ****************************************************************          
           MOVE 'Y'         TO ICRD052-CLRNC-CHK-IND.                           
           PERFORM 8300-OPEN-OCCR-CNT.                                          
           PERFORM 8310-FETCH-OCCR-CNT.                                         
           PERFORM                                                              
             UNTIL PS-NO-MORE-OCCR-CNT                                          
             MOVE 'N' TO ICRD052-RPET-CNT-IND                                   
      *** THIS WILL CAUSE THE CHECK FOR COMPLETED COUNT TO BE DONE              
             SET PS-NOT-RPET-CNT TO TRUE                                        
             MOVE PV-CURRENT-DATE TO ICRD052-EXEC-DTE                           
             PERFORM 2100-PROCESS-RLSD-COUNTS                                   
             IF ICT00010-CNT-STUP-ID NOT = ICT00019-CNT-STUP-ID                 
               MOVE ICT00010-CNT-STUP-ID   TO ICT00019-CNT-STUP-ID              
               PERFORM 8930-INSERT-STUP-PRC-ROW                                 
             END-IF                                                             
             PERFORM 8310-FETCH-OCCR-CNT                                        
           END-PERFORM.                                                         
           PERFORM 8320-CLOSE-OCCR-CNT.                                         
           PERFORM 8000-SQL-COMMIT.                                             
           DISPLAY 'OCCURRING COUNT PROCESSING DONE'.                           
                                                                                
      ****************************************************************          
      *** COUNTS THAT REPEAT ON A DAILY,WEEKLY OR MONTHLY  BASIS                
      *** AND ARE DO TO PROCESS TODAY.                                          
      ****************************************************************          
           MOVE 'N'         TO ICRD052-CLRNC-CHK-IND.                           
           MOVE PV-CURRENT-WEEKDAY  TO ICT00013-DAY-OF-WK-CDE.                  
           MOVE PV-CURRENT-WEEK-NBR TO ICT00013-WK-OF-MN-NBR.                   
           SET PS-MORE-RPET-CNT TO TRUE.                                        
           PERFORM 8850-OPEN-RPET-CNT-CSR.                                      
           PERFORM 8860-FETCH-RPET-CNT-CSR.                                     
           PERFORM                                                              
               UNTIL PS-NO-MORE-RPET-CNT                                        
      *** VALUE WILL BE 'W' OR 'M' OR 'D'                                       
               SET ICRD052-RPET-UPD TO TRUE                                     
               MOVE ICT00013-CNT-FRQ-CDE (1:1) TO ICRD052-RPET-CNT-IND          
      *** BY SETTING THIS SWITCH THE CHECK FOR COMPLETED WILL BE SKIPPED        
             SET PS-RPET-CNT TO TRUE                                            
      *** THERE IS NO SUGGESTED DATE OR BEGIN OR END DATE AS THE                
      *** CURRENT DATE IS USED ON REPEATING COUNTS.                             
             MOVE PV-CURRENT-DATE TO ICT00010-SUGG-EXEC-DTE                     
                                     ICT00010-EXEC-WND-STRT-DTE                 
                                     ICT00010-EXEC-WND-END-DTE                  
             SET PV-SUGG-EXEC-DTE-NOT-NULL TO TRUE                              
             SET PV-EXEC-WND-STRT-DTE-NOT-NULL TO TRUE                          
             SET PV-EXEC-WND-END-DTE-NOT-NULL TO TRUE                           
             MOVE PV-CURRENT-DATE TO ICRD052-EXEC-DTE                           
             MOVE PV-CURRENT-DATE TO PV-COMPUTED-DATE                           
      ***                                                                       
             PERFORM 2100-PROCESS-RLSD-COUNTS                                   
             IF ICT00010-CNT-STUP-ID NOT = ICT00019-CNT-STUP-ID                 
               MOVE ICT00010-CNT-STUP-ID   TO ICT00019-CNT-STUP-ID              
               PERFORM 8930-INSERT-STUP-PRC-ROW                                 
             END-IF                                                             
             PERFORM 8860-FETCH-RPET-CNT-CSR                                    
           END-PERFORM.                                                         
           PERFORM 8870-CLOSE-RPET-CNT-CSR.                                     
           PERFORM 8000-SQL-COMMIT.                                             
           DISPLAY 'REPEAT COUNT PROCESSING DONE'.                              
                                                                                
      ****************************************************************          
      *** COUNTS THAT REPEAT ON A WEEKLY OR MONTHLY BASIS AND                   
      *** PROCESSED YESTERDAY. THIS IS SETTING UP THE NEXT COUNT.               
      ****************************************************************          
           MOVE 'N'         TO ICRD052-CLRNC-CHK-IND.                           
           MOVE PV-CURRENT-WEEKDAY  TO PV-FISCAL-DAY-NBR.                       
           MOVE PV-CURRENT-WEEK-NBR TO ICT00013-WK-OF-MN-NBR.                   
           MOVE PV-CURRENT-MONTH-NBR TO PV-FISCAL-MONTH-NBR.                    
           MOVE PV-CURRENT-YEAR-NBR TO PV-FISCAL-YEAR-NBR-X.                    
TEST  *    DISPLAY 'NEXT RPET DATES - '                                         
TEST  *    DISPLAY 'CURR- ' PV-CURRENT-WEEKDAY                                  
TEST  *             ' - '   PV-CURRENT-WEEK-NBR                                 
TEST  *             ' - '   PV-CURRENT-MONTH-NBR                                
TEST  *             ' - '   PV-CURRENT-YEAR-NBR.                                
      *** THIS LOGIC WILL CALCULATE YESTERDAYS DATE THAT WAS USED IN            
      *** IN A REPEAT COUNT.                                                    
           COMPUTE PV-FISCAL-DAY-NBR = PV-FISCAL-DAY-NBR - 1.                   
           IF PV-FISCAL-DAY-NBR      < 1                                        
             MOVE 7 TO PV-FISCAL-DAY-NBR                                        
             SUBTRACT 1 FROM ICT00013-WK-OF-MN-NBR                              
             IF ICT00013-WK-OF-MN-NBR > 1                                       
               MOVE 4 TO ICT00013-WK-OF-MN-NBR                                  
               SUBTRACT 1 FROM PV-FISCAL-MONTH-NBR                              
               IF PV-FISCAL-MONTH-NBR < 1                                       
                 MOVE 12 TO PV-FISCAL-MONTH-NBR                                 
                 SUBTRACT 1 FROM PV-FISCAL-YEAR-NBR-X.                          
TEST  *    DISPLAY 'YESTERDAYS - ' PV-FISCAL-DAY-NBR                            
TEST  *                 ' - '     ICT00013-WK-OF-MN-NBR                         
TEST  *                 ' - '     PV-FISCAL-MONTH-NBR                           
TEST  *                 ' - '     PV-FISCAL-YEAR-NBR-X                          
      ***                                                                       
           MOVE PV-FISCAL-DAY-NBR TO ICT00013-DAY-OF-WK-CDE.                    
           SET PS-MORE-RPET-CNT TO TRUE.                                        
           MOVE PV-CURRENT-DATE TO PV-COMPUTED-DATE.                            
           PERFORM 8880-OPEN-RPET-CNT-NEXT-CSR.                                 
           PERFORM 8885-FETCH-RPET-CNT-NEXT-CSR.                                
           PERFORM                                                              
               UNTIL PS-NO-MORE-RPET-CNT                                        
               SET ICRD052-RPET-NEW TO TRUE                                     
      *** VALUE WILL BE 'W' OR 'M'                                              
               MOVE ICT00013-CNT-FRQ-CDE (1:1) TO ICRD052-RPET-CNT-IND          
      *** BY SETTING THIS SWITCH THE CHECK FOR COMPLETED WILL BE SKIPPED        
             SET PS-RPET-CNT TO TRUE                                            
      *** THIS LOGIC COMPUTES THE DATE OF THE NEXT REPEAT COUNT TO BE           
      *** USED AS THE EXEC_DTE ON THE ICT_SKU_LOC_CNT TABLE.                    
             IF ICT00013-CNT-FRQ-CDE = 'WKL'                                    
               INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56                   
               SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE                        
               SET  DPG52-LK-DTE-ISO-FMT         TO TRUE                        
               SET  DPG51-INCREMENT-DATE         TO TRUE                        
               MOVE 6 TO DPG51-INCR-DECR-DAYS-9                                 
               MOVE PV-CURRENT-DATE TO DPG52-LK-DATE-INPUT                      
               PERFORM 1500-FUTURE-OFFSET-DTE                                   
               MOVE DPG55-DB2-ISO-DATE-FMT TO DTATTR-KY-DTE                     
             ELSE                                                               
               IF ICT00013-CNT-FRQ-CDE = 'MTH'                                  
                   ADD 1 TO PV-FISCAL-MONTH-NBR                                 
                   IF PV-FISCAL-MONTH-NBR > 12                                  
                     MOVE 1 TO PV-FISCAL-MONTH-NBR                              
                     ADD 1 TO PV-FISCAL-YEAR-NBR-X                              
                   END-IF                                                       
               ELSE                                                             
                 DISPLAY 'BAD SELECT OF NEXT REPEAT CNT - '                     
                          ICT00010-CNT-STUP-ID                                  
               END-IF                                                           
               MOVE ICT00013-WK-OF-MN-NBR  TO DTATTR-FSCL-WK-NBR                
               MOVE ICT00013-DAY-OF-WK-CDE TO DTATTR-DAY-OF-WK-NBR              
               MOVE PV-FISCAL-MONTH-NBR    TO DTATTR-FSCL-MN-NBR                
               PERFORM 8960-CONVERT-DATE                                        
             END-IF                                                             
TEST  *    DISPLAY 'NEXT COUNT - ' ICT00013-CNT-FRQ-CDE                         
TEST  *                     ' - ' PV-FISCAL-DAY-NBR                             
TEST  *                 ' - '     ICT00013-WK-OF-MN-NBR                         
TEST  *                 ' - '     PV-FISCAL-MONTH-NBR                           
TEST  *                 ' - '     PV-FISCAL-YEAR-NBR-X                          
TEST  *                 ' - '     DTATTR-KY-DTE                                 
TEST  *                 ' - '     ICT00013-RPET-WND-END-DTE                     
      ***                                                                       
      *** THERE IS NO SUGGESTED DATE OR BEGIN OR END DATE AS THE                
      *** DATE OF THE NEXT REPEAT COUNT IS USED.                                
             MOVE DTATTR-KY-DTE   TO ICT00010-SUGG-EXEC-DTE                     
                                     ICT00010-EXEC-WND-STRT-DTE                 
                                     ICT00010-EXEC-WND-END-DTE                  
             SET PV-SUGG-EXEC-DTE-NOT-NULL TO TRUE                              
             SET PV-EXEC-WND-STRT-DTE-NOT-NULL TO TRUE                          
             SET PV-EXEC-WND-END-DTE-NOT-NULL TO TRUE                           
             MOVE DTATTR-KY-DTE   TO ICRD052-EXEC-DTE                           
      ***                                                                       
      ***  IF NEXT REPEAT COUNT DATE IS AFTER WINDOW RANGE END DATE,            
      ***  DO NOT SEND.                                                         
             IF DTATTR-KY-DTE <= ICT00013-RPET-WND-END-DTE                      
               PERFORM 2100-PROCESS-RLSD-COUNTS                                 
               IF ICT00010-CNT-STUP-ID NOT = ICT00019-CNT-STUP-ID               
                 MOVE ICT00010-CNT-STUP-ID   TO ICT00019-CNT-STUP-ID            
                 PERFORM 8930-INSERT-STUP-PRC-ROW                               
               END-IF                                                           
             END-IF                                                             
             PERFORM 8885-FETCH-RPET-CNT-NEXT-CSR                               
           END-PERFORM.                                                         
           PERFORM 8890-CLOSE-RPET-CNT-NEXT-CSR.                                
           PERFORM 8000-SQL-COMMIT.                                             
           DISPLAY 'NEXT REPEAT COUNT PROCESSING DONE'.                         
                                                                                
      ****************************************************************          
      *** COUNTS THAT REPEAT ON A WEEKLY OR MONTHLY BASIS AND WILL              
      *** PROCESS IN 2 DAYS.                                                    
      ****************************************************************          
           MOVE 'N'         TO ICRD052-CLRNC-CHK-IND.                           
           MOVE PV-CURRENT-WEEKDAY  TO PV-FISCAL-DAY-NBR.                       
           MOVE PV-CURRENT-WEEK-NBR TO ICT00013-WK-OF-MN-NBR.                   
           MOVE PV-CURRENT-MONTH-NBR TO PV-FISCAL-MONTH-NBR.                    
           MOVE PV-CURRENT-YEAR-NBR TO PV-FISCAL-YEAR-NBR-X.                    
TEST  *    DISPLAY 'NEXT RPET DATES - '                                         
TEST  *    DISPLAY 'CURR- ' PV-CURRENT-WEEKDAY                                  
TEST  *             ' - '   PV-CURRENT-WEEK-NBR                                 
TEST  *             ' - '   PV-CURRENT-MONTH-NBR                                
TEST  *             ' - '   PV-CURRENT-YEAR-NBR.                                
      *** THIS LOGIC WILL CALCULATE CURRENT DATE + 2 DAYS AND IS USED           
      *** IN A REPEAT COUNT.                                                    
           COMPUTE PV-FISCAL-DAY-NBR = PV-FISCAL-DAY-NBR + 2.                   
           IF PV-FISCAL-DAY-NBR      > 7                                        
             COMPUTE PV-FISCAL-DAY-NBR = PV-FISCAL-DAY-NBR - 7                  
             ADD 1 TO ICT00013-WK-OF-MN-NBR                                     
             IF ICT00013-WK-OF-MN-NBR > 4                                       
               MOVE 1 TO ICT00013-WK-OF-MN-NBR                                  
               ADD 1 TO PV-FISCAL-MONTH-NBR                                     
               IF PV-FISCAL-MONTH-NBR > 12                                      
                 MOVE 1 TO PV-FISCAL-MONTH-NBR                                  
                 ADD 1 TO PV-FISCAL-YEAR-NBR-X.                                 
      ***                                                                       
           MOVE PV-FISCAL-DAY-NBR TO ICT00013-DAY-OF-WK-CDE.                    
           SET PS-MORE-RPET-CNT TO TRUE.                                        
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                      
           MOVE 2 TO DPG51-INCR-DECR-DAYS-9.                                    
           MOVE PV-CURRENT-DATE TO DPG52-LK-DATE-INPUT.                         
           SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                           
           SET  DPG52-LK-DTE-ISO-FMT         TO TRUE.                           
           SET  DPG51-INCREMENT-DATE         TO TRUE.                           
           PERFORM 1500-FUTURE-OFFSET-DTE.                                      
           MOVE DPG55-DB2-ISO-DATE-FMT TO DTATTR-KY-DTE                         
                                          PV-COMPUTED-DATE.                     
           MOVE ICT00013-WK-OF-MN-NBR  TO DTATTR-FSCL-WK-NBR.                   
           MOVE ICT00013-DAY-OF-WK-CDE TO DTATTR-DAY-OF-WK-NBR.                 
      *    PERFORM 8960-CONVERT-DATE.                                           
TEST  *    DISPLAY 'NEXT RPET - ' PV-CURRENT-DATE                               
TEST  *                     ' - ' PV-COMPUTED-DATE                              
TEST  *                     ' - ' DTATTR-KY-DTE                                 
TEST  *                     ' - ' PV-FISCAL-DAY-NBR                             
TEST  *                 ' - '     PV-FISCAL-MONTH-NBR                           
TEST  *                 ' - '     PV-FISCAL-YEAR-NBR-X                          
TEST  *                 ' - '     ICT00013-WK-OF-MN-NBR                         
TEST  *                 ' - '     ICT00013-DAY-OF-WK-CDE                        
           PERFORM 8880-OPEN-RPET-CNT-NEXT-CSR.                                 
           PERFORM 8885-FETCH-RPET-CNT-NEXT-CSR.                                
           PERFORM                                                              
               UNTIL PS-NO-MORE-RPET-CNT                                        
               SET ICRD052-RPET-UPD TO TRUE                                     
      *** VALUE WILL BE 'W' OR 'M'                                              
               MOVE ICT00013-CNT-FRQ-CDE (1:1) TO ICRD052-RPET-CNT-IND          
      *** BY SETTING THIS SWITCH THE CHECK FOR COMPLETED WILL BE SKIPPED        
             SET PS-RPET-CNT TO TRUE                                            
      *** THIS LOGIC COMPUTES THE DATE OF THE NEXT REPEAT COUNT TO BE           
      *** USED AS THE EXEC_DTE ON THE ICT_SKU_LOC_CNT TABLE.                    
TEST  *    DISPLAY 'NEXT COUNT1- ' ICT00013-CNT-FRQ-CDE                         
TEST  *                     ' - ' PV-FISCAL-DAY-NBR                             
TEST  *                 ' - '     ICT00013-WK-OF-MN-NBR                         
TEST  *                 ' - '     PV-FISCAL-MONTH-NBR                           
TEST  *                 ' - '     PV-FISCAL-YEAR-NBR-X                          
TEST  *                 ' - '     DTATTR-KY-DTE                                 
TEST  *                 ' - '     PV-COMPUTED-DATE                              
TEST  *                 ' - '     ICT00013-RPET-WND-END-DTE                     
      ***                                                                       
      *** THERE IS NO SUGGESTED DATE OR BEGIN OR END DATE AS THE                
      *** DATE OF THE NEXT REPEAT COUNT IS USED.                                
             MOVE PV-COMPUTED-DATE TO ICT00010-SUGG-EXEC-DTE                    
                                      ICT00010-EXEC-WND-STRT-DTE                
                                      ICT00010-EXEC-WND-END-DTE                 
             SET PV-SUGG-EXEC-DTE-NOT-NULL TO TRUE                              
             SET PV-EXEC-WND-STRT-DTE-NOT-NULL TO TRUE                          
             SET PV-EXEC-WND-END-DTE-NOT-NULL TO TRUE                           
             MOVE PV-COMPUTED-DATE  TO ICRD052-EXEC-DTE                         
             PERFORM 2100-PROCESS-RLSD-COUNTS                                   
             IF ICT00010-CNT-STUP-ID NOT = ICT00019-CNT-STUP-ID                 
               MOVE ICT00010-CNT-STUP-ID   TO ICT00019-CNT-STUP-ID              
               PERFORM 8930-INSERT-STUP-PRC-ROW                                 
             END-IF                                                             
             PERFORM 8885-FETCH-RPET-CNT-NEXT-CSR                               
           END-PERFORM.                                                         
           PERFORM 8890-CLOSE-RPET-CNT-NEXT-CSR.                                
           PERFORM 8000-SQL-COMMIT.                                             
           DISPLAY 'NEXT REPEAT COUNT PART 2 PROCESSING DONE'.                  
                                                                                
      ****************************************************************          
      *** COUNTS THAT HAVE BEEN CANCELLED.                                      
      ****************************************************************          
           PERFORM 8800-OPEN-CANC-CNT-CSR.                                      
           PERFORM 8810-FETCH-CANC-CNT-CSR.                                     
           PERFORM                                                              
               UNTIL PS-NO-MORE-CANC-CNT                                        
             MOVE ICT00019-CNT-STUP-ID TO ICRD056-CNT-STUP-ID                   
             MOVE 0 TO ICRD056-LOC-NBR                                          
      *** THIS IS A CANCEL FOR A COUNT (ALL STORES)                             
             PERFORM 7010-WRITE-CNT-STORE-EXP-FL                                
             PERFORM 8935-INSERT-CAN-PRC-ROW                                    
             PERFORM 8810-FETCH-CANC-CNT-CSR                                    
           END-PERFORM.                                                         
           PERFORM 8820-CLOSE-CANC-CNT-CSR.                                     
           DISPLAY 'CANCELLED COUNT PROCESSING DONE'.                           
                                                                                
      ******************************************************************        
      * 2100-PROCESS-RLSD-COUNTS.                                      *        
      *  ==> FINDS ALL LOCATIONS FOR EACH GROUP SPECIFIED FOR A COUNT  *        
      ******************************************************************        
       2100-PROCESS-RLSD-COUNTS.                                                
TEST  *    DISPLAY '2100 - ' ICT00014-LOC-HIER-CDE.                             
           IF ICT00014-LOC-HIER-CDE = 'TER'                                     
             MOVE ICT00014-LOC-HIER-VAL-NBR TO XST00006-TERR-NBR                
             SET PS-MORE-TERR-LOC TO TRUE                                       
             PERFORM 8400-OPEN-TERR-LOC-CSR                                     
             PERFORM 8410-FETCH-TERR-LOC-CSR                                    
             PERFORM                                                            
               UNTIL PS-NO-MORE-TERR-LOC                                        
               PERFORM 2110-EXPLODE-RLSD-COUNTS                                 
               PERFORM 8410-FETCH-TERR-LOC-CSR                                  
             END-PERFORM                                                        
             PERFORM 8420-CLOSE-TERR-LOC-CSR                                    
           ELSE                                                                 
           IF ICT00014-LOC-HIER-CDE = 'REG'                                     
             MOVE ICT00014-LOC-HIER-VAL-NBR TO  XST00004-REGN-NBR               
             SET PS-MORE-REGN-LOC TO TRUE                                       
             PERFORM 8500-OPEN-REGN-LOC-CSR                                     
             PERFORM 8510-FETCH-REGN-LOC-CSR                                    
             PERFORM                                                            
               UNTIL PS-NO-MORE-REGN-LOC                                        
               PERFORM 2110-EXPLODE-RLSD-COUNTS                                 
               PERFORM 8510-FETCH-REGN-LOC-CSR                                  
             END-PERFORM                                                        
             PERFORM 8520-CLOSE-REGN-LOC-CSR                                    
           ELSE                                                                 
           IF ICT00014-LOC-HIER-CDE = 'DIS'                                     
             MOVE ICT00014-LOC-HIER-VAL-NBR TO  XST00004-DIST-NBR               
             SET PS-MORE-DIST-LOC TO TRUE                                       
             PERFORM 8600-OPEN-DIST-LOC-CSR                                     
             PERFORM 8610-FETCH-DIST-LOC-CSR                                    
             PERFORM                                                            
               UNTIL PS-NO-MORE-DIST-LOC                                        
               PERFORM 2110-EXPLODE-RLSD-COUNTS                                 
               PERFORM 8610-FETCH-DIST-LOC-CSR                                  
             END-PERFORM                                                        
             PERFORM 8620-CLOSE-DIST-LOC-CSR                                    
           ELSE                                                                 
           IF ICT00014-LOC-HIER-CDE = 'DC '                                     
             MOVE ICT00014-LOC-HIER-VAL-NBR TO XST00020-DC-NBR                  
             SET PS-MORE-DC-LOC TO TRUE                                         
             PERFORM 8700-OPEN-DC-LOC-CSR                                       
             PERFORM 8710-FETCH-DC-LOC-CSR                                      
             PERFORM                                                            
               UNTIL PS-NO-MORE-DC-LOC                                          
               PERFORM 2110-EXPLODE-RLSD-COUNTS                                 
               PERFORM 8710-FETCH-DC-LOC-CSR                                    
             END-PERFORM                                                        
             PERFORM 8720-CLOSE-DC-LOC-CSR                                      
           ELSE                                                                 
           IF ICT00014-LOC-HIER-CDE = 'STR'                                     
             MOVE ICT00014-LOC-HIER-VAL-NBR TO XST00001-LOC-NBR                 
             SET PV-INVENTORY-PERIOD TO TRUE                                    
             IF PV-SUGG-EXEC-DTE-IS-NULL                                        
               MOVE PV-CURRENT-DATE TO ICT00010-SUGG-EXEC-DTE                   
               DISPLAY 'SUGGESTED START DATE NULL-  '                           
                 ICT00010-CNT-STUP-ID                                           
             END-IF                                                             
             IF PV-EXEC-WND-STRT-DTE-IS-NULL                                    
               MOVE ICT00010-SUGG-EXEC-DTE TO ICT00010-EXEC-WND-STRT-DTE        
             END-IF                                                             
             IF PV-EXEC-WND-END-DTE-IS-NULL                                     
               MOVE ICT00010-SUGG-EXEC-DTE TO ICT00010-EXEC-WND-END-DTE         
             END-IF                                                             
             PERFORM 2110-EXPLODE-RLSD-COUNTS                                   
           ELSE                                                                 
             DISPLAY 'INVALID COUNT HIERARCHY CODE = '                          
                  ICT00010-CNT-STUP-ID ' - '                                    
                  ICT00014-LOC-HIER-CDE.                                        
                                                                                
      ******************************************************************        
      * 2110-EXPLODE-RLSD-COUNTS.                                      *        
      *  ==> CREATES THE EXPLOSION RECORDS OF COUNT/LOCATION FOR EACH  *        
      *      COUNT.                                                    *        
      ******************************************************************        
       2110-EXPLODE-RLSD-COUNTS.                                                
           MOVE XST00001-LOC-NBR       TO ICT00020-LOC-NBR.                     
           MOVE ICT00010-CNT-STUP-ID   TO ICT00020-CNT-STUP-ID.                 
           SET PV-NOT-COMPLETED-COUNT TO TRUE.                                  
      *** THIS CHECK IS NOT NEEDED ON A REPEATING COUNT                         
             IF PS-NOT-RPET-CNT                                                 
               PERFORM 8910-CHECK-CPLTD-COUNT.                                  
      ***                                                                       
           IF PV-NOT-COMPLETED-COUNT                                            
             MOVE XST00001-LOC-NBR       TO INVPAR-LOC-NBR                      
             SET PV-NOT-INVENTORY-PERIOD TO TRUE                                
             MOVE SPACE TO INVPAR-PLND-INV-DTE                                  
                           INVPAR-PLND-UNIT-BK-DTE                              
             IF ICT00010-FS-UPD-IND  = 'Y'                                      
               IF PS-NOT-RPET-CNT                                               
                 PERFORM 8900-CHECK-FOR-INV                                     
               ELSE                                                             
                 PERFORM 8905-CHECK-FOR-INV-RPET-CNT                            
               END-IF                                                           
             END-IF                                                             
      *** IF A FULL INVENTORY IS PLANNED, A USA COUNT IS NOT TO BE DONE         
             IF PV-NOT-INVENTORY-PERIOD                                         
               MOVE ICT00010-CNT-STUP-ID   TO ICRD052-CNT-STUP-ID               
               MOVE XST00001-LOC-NBR       TO ICRD052-LOC-NBR                   
               MOVE ICT00010-EXCL-MDSE-IND TO ICRD052-EXCL-MDSE-IND             
                                                                                
               PERFORM 7000-WRITE-CNT-STORE-EXP-FL                              
             ELSE                                                               
      *** THIS IS A CANCEL FOR A SPECIFIC STORE COUNT BECAUSE OF A FULL         
      *** INVENTORY SCHEDULED TO OCCUR AT THE STORE AT THE SAME TIME AS         
      *** THE USA COUNT.                                                        
               MOVE ICT00010-CNT-STUP-ID TO ICRD056-CNT-STUP-ID                 
               MOVE XST00001-LOC-NBR     TO ICRD056-LOC-NBR                     
               PERFORM 7010-WRITE-CNT-STORE-EXP-FL                              
             END-IF                                                             
           END-IF.                                                              
      ******************************************************************        
      * 3000-EOJ-PROCESSING.                                           *        
      *  ==> PROCESSES:                                                *        
      *    - CLOSE FILES                                               *        
      *    - DISPLAYS PROCESSING TOTALS                                *        
      *    - TAKES A FINAL COMMIT                                      *        
      ******************************************************************        
       3000-EOJ-PROCESSING.                                                     
           MOVE '3000-EOJ-PROCESSING' TO PV-PARAGRAPH-NAME.                     
                                                                                
           CLOSE CNT-STORE-EXP-FILE                                             
                 CNT-CAN-COUNT-FILE.                                            
                                                                                
           IF PS-LAST-RUN-TMST-FOUND                                            
             PERFORM 8940-UPDATE-LAST-RUN-TMST                                  
           ELSE                                                                 
      **THIS SHOULD ONLY BE USED THE FIRST TIME THIS PGM IS RUN IN PROD         
             PERFORM 8945-INSERT-LAST-RUN-TMST.                                 
           EXEC SQL                                                        CL**5
               COMMIT WORK                                                 CL**5
           END-EXEC.                                                       CL**5
           ADD +1 TO DI-COMMIT-CNTR.                                       CL*16
                                                                                
           PERFORM 9990-DISPLAY-CONTROL-INFO.                                   
                                                                                
                                                                                
      *----------------------------------------------------------               
      * 7000-WRITE-CNT-STORE-EXP-FL.                                            
      *----------------------------------------------------------               
       7000-WRITE-CNT-STORE-EXP-FL.                                             
           WRITE CNT-STORE-EXP-REC                                              
             FROM ICRD052-IC-COUNTS-FILE.                                       
                                                                                
      *----------------------------------------------------------               
      * 7010-WRITE-CNT-STORE-EXP-FL.                                            
      *----------------------------------------------------------               
       7010-WRITE-CNT-STORE-EXP-FL.                                             
           WRITE CNT-CAN-COUNT-REC                                              
             FROM ICRD056-CANC-IC-COUNTS-FILE.                                  
                                                                                
       8000-SQL-COMMIT.                                                         
           MOVE '8000-SQL-COMMIT' TO PV-PARAGRAPH-NAME.                         
                                                                                
           EXEC SQL                                                        CL**5
               COMMIT WORK                                                 CL**5
           END-EXEC.                                                       CL**5
           ADD +1 TO DI-COMMIT-CNTR.                                       CL*16
      *----------------------------------------------------------               
      * 8100-OPEN-RLSE-CNT.                                                     
      *      OPEN THE CURSOR OF RELEASED COUNTS.                                
      *----------------------------------------------------------               
       8100-OPEN-RLSE-CNT.                                                      
                                                                                
           MOVE '8100-OPEN-RLSE-CNT'  TO PV-PARAGRAPH-NAME.                     
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    OPEN RLSE-CNT-CSR                                           
                 END-EXEC                                                       
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 OPEN OF RLSE-CNT CURSOR FOR '               
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8110-FETCH-RLSE-CNT.                                                    
      *      FETCH A RELEASED COUNTS ROW.                                       
      *----------------------------------------------------------               
       8110-FETCH-RLSE-CNT.                                                     
                                                                                
           MOVE '8110-FETCH-RLSE-CNT'  TO PV-PARAGRAPH-NAME.                    
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                   OR                      
                      SQLCODE = 0                       OR                      
                      SQLCODE = +100)                                           
                                                                                
                 EXEC SQL                                                       
                    FETCH RLSE-CNT-CSR                                          
                INTO :ICT00014-LOC-HIER-CDE                                     
                    ,:ICT00014-LOC-HIER-VAL-NBR                                 
                    ,:ICT00010-EXCL-MDSE-IND                                    
                    ,:ICT00010-CNT-STUP-ID                                      
                    ,:ICT00010-SUGG-EXEC-DTE:PV-EXTR-PRC-TMST-NI                
                    ,:ICT00010-EXEC-WND-STRT-DTE:PV-EXEC-WND-STRT-DTE-NI        
                    ,:ICT00010-EXEC-WND-END-DTE:PV-EXEC-WND-END-DTE-NI          
                    ,:ICT00010-FS-UPD-IND                                       
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                    WHEN SQLCODE = -904                                         
                    WHEN SQLCODE = -911                                         
                    WHEN SQLCODE = -913                                         
                        CONTINUE                                                
                    WHEN SQLCODE = ZERO                                         
                        ADD +1 TO DI-RLSE-CNTS                                  
                    WHEN SQLCODE = +100                                         
                        SET PS-NO-MORE-RLSE-CNT    TO TRUE                      
                    WHEN OTHER                                                  
                        SET PS-PROCESS-STOP        TO TRUE                      
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 FETCH OF RLSE-CNT CURSOR'                   
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *-------------------------------------------------------------            
      * 8120-CLOSE-RLSE-CNT.                                                    
      *      CLOSE THE RELEASED COUNTS CURSOR.                                  
      *-------------------------------------------------------------            
       8120-CLOSE-RLSE-CNT.                                                     
                                                                                
           MOVE '8120-CLOSE-RLSE-CNT'  TO PV-PARAGRAPH-NAME.                    
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    CLOSE RLSE-CNT-CSR                                          
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 CLOSE OF RLSE-CNT CURSOR'                   
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8200-OPEN-WNDW-CNT.                                                     
      *      OPEN THE CURSOR OF 2,7,14 DAY COUNTS.                              
      *----------------------------------------------------------               
       8200-OPEN-WNDW-CNT.                                                      
                                                                                
           MOVE '8200-OPEN-WNDW-CNT'  TO PV-PARAGRAPH-NAME.                     
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    OPEN WNDW-CNT-CSR                                           
                 END-EXEC                                                       
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 OPEN OF WNDW-CNT CURSOR FOR '               
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8210-FETCH-WNDW-CNT.                                                    
      *      FETCH A WINDOW COUNTS ROW.                                         
      *----------------------------------------------------------               
       8210-FETCH-WNDW-CNT.                                                     
                                                                                
           MOVE '8210-FETCH-WNDW-CNT'  TO PV-PARAGRAPH-NAME.                    
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                   OR                      
                      SQLCODE = 0                       OR                      
                      SQLCODE = +100)                                           
                                                                                
                 EXEC SQL                                                       
                    FETCH WNDW-CNT-CSR                                          
                INTO :ICT00014-LOC-HIER-CDE                                     
                    ,:ICT00014-LOC-HIER-VAL-NBR                                 
                    ,:ICT00010-EXCL-MDSE-IND                                    
                    ,:ICT00010-CNT-STUP-ID                                      
                    ,:ICT00010-SUGG-EXEC-DTE:PV-EXTR-PRC-TMST-NI                
                    ,:ICT00010-EXEC-WND-STRT-DTE:PV-EXEC-WND-STRT-DTE-NI        
                    ,:ICT00010-EXEC-WND-END-DTE:PV-EXEC-WND-END-DTE-NI          
                    ,:PV-WINDOW-PLUS-2-DAYS-DATE                                
                    ,:PV-WINDOW-PLUS-7-DAYS-DATE                                
                    ,:PV-WINDOW-PLUS-14-DAYS-DATE                               
                    ,:ICT00010-FS-UPD-IND                                       
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                    WHEN SQLCODE = -904                                         
                    WHEN SQLCODE = -911                                         
                    WHEN SQLCODE = -913                                         
                        CONTINUE                                                
                    WHEN SQLCODE = ZERO                                         
                        ADD +1 TO    DI-WINDOW-CNTS                             
                    WHEN SQLCODE = +100                                         
                        SET PS-NO-MORE-WNDW-CNT    TO TRUE                      
                    WHEN OTHER                                                  
                        SET PS-PROCESS-STOP        TO TRUE                      
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 FETCH OF WNDW-CNT CURSOR'                   
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *-------------------------------------------------------------            
      * 8220-CLOSE-WNDW-CNT.                                                    
      *      CLOSE THE WINDOW COUNTS CURSOR.                                    
      *-------------------------------------------------------------            
       8220-CLOSE-WNDW-CNT.                                                     
                                                                                
           MOVE '8220-CLOSE-WNDW-CNT'  TO PV-PARAGRAPH-NAME.                    
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    CLOSE WNDW-CNT-CSR                                          
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 CLOSE OF WNDW-CNT CURSOR'                   
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8300-OPEN-OCCR-CNT.                                                     
      *      OPEN THE CURSOR OF CURRENTLY OCCURING COUNTS.                      
      *----------------------------------------------------------               
       8300-OPEN-OCCR-CNT.                                                      
                                                                                
           MOVE '8300-OPEN-OCCR-CNT'  TO PV-PARAGRAPH-NAME.                     
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    OPEN OCCR-CNT-CSR                                           
                 END-EXEC                                                       
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 OPEN OF OCCR-CNT CURSOR'                    
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8310-FETCH-OCCR-CNT.                                                    
      *      FETCH AN OCCURING COUNTS ROW.                                      
      *----------------------------------------------------------               
       8310-FETCH-OCCR-CNT.                                                     
                                                                                
           MOVE '8310-FETCH-OCCR-CNT'  TO PV-PARAGRAPH-NAME.                    
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                   OR                      
                      SQLCODE = 0                       OR                      
                      SQLCODE = +100)                                           
                                                                                
                 EXEC SQL                                                       
                    FETCH OCCR-CNT-CSR                                          
                INTO :ICT00014-LOC-HIER-CDE                                     
                    ,:ICT00014-LOC-HIER-VAL-NBR                                 
                    ,:ICT00010-EXCL-MDSE-IND                                    
                    ,:ICT00010-CNT-STUP-ID                                      
                    ,:ICT00010-SUGG-EXEC-DTE:PV-EXTR-PRC-TMST-NI                
                    ,:ICT00010-EXEC-WND-STRT-DTE:PV-EXEC-WND-STRT-DTE-NI        
                    ,:ICT00010-EXEC-WND-END-DTE:PV-EXEC-WND-END-DTE-NI          
                    ,:ICT00010-FS-UPD-IND                                       
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                    WHEN SQLCODE = -904                                         
                    WHEN SQLCODE = -911                                         
                    WHEN SQLCODE = -913                                         
                        CONTINUE                                                
                    WHEN SQLCODE = ZERO                                         
                        ADD +1 TO DI-CURR-OCCR-CNTS                             
                    WHEN SQLCODE = +100                                         
                        SET PS-NO-MORE-OCCR-CNT    TO TRUE                      
                    WHEN OTHER                                                  
                        SET PS-PROCESS-STOP        TO TRUE                      
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 FETCH OF OCCR-CNT CURSOR'                   
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *-------------------------------------------------------------            
      * 8320-CLOSE-OCCR-CNT.                                                    
      *      CLOSE THE OCCURING COUNTS CURSOR.                                  
      *-------------------------------------------------------------            
       8320-CLOSE-OCCR-CNT.                                                     
                                                                                
           MOVE '8320-CLOSE-OCCR-CNT'  TO PV-PARAGRAPH-NAME.                    
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    CLOSE OCCR-CNT-CSR                                          
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 CLOSE OF OCCR-CNT CURSOR'                   
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8400-OPEN-TERR-LOC-CSR.                                                 
      *      OPEN THE CURSOR OF LOCATIONS WITHIN A TERRITORY.                   
      *----------------------------------------------------------               
       8400-OPEN-TERR-LOC-CSR.                                                  
                                                                                
           MOVE '8400-OPEN-TERR-LOC-CSR'  TO PV-PARAGRAPH-NAME.                 
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    OPEN TERR-LOC-CSR                                           
                 END-EXEC                                                       
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 OPEN OF TERR-LOC-CSR CURSOR'                
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8410-FETCH-TERR-LOC-CSR.                                                
      *      FETCH A LOCATION WITHIN A TERRITORY.                               
      *----------------------------------------------------------               
       8410-FETCH-TERR-LOC-CSR.                                                 
                                                                                
           MOVE '8410-FETCH-TERR-LOC-CSR'  TO PV-PARAGRAPH-NAME.                
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                   OR                      
                      SQLCODE = 0                       OR                      
                      SQLCODE = +100)                                           
                                                                                
                 EXEC SQL                                                       
                    FETCH TERR-LOC-CSR                                          
                    INTO  :XST00001-LOC-NBR                                     
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                    WHEN SQLCODE = -904                                         
                    WHEN SQLCODE = -911                                         
                    WHEN SQLCODE = -913                                         
                        CONTINUE                                                
                    WHEN SQLCODE = ZERO                                         
                        CONTINUE                                                
                    WHEN SQLCODE = +100                                         
                        SET PS-NO-MORE-TERR-LOC    TO TRUE                      
                    WHEN OTHER                                                  
                        SET PS-PROCESS-STOP        TO TRUE                      
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 FETCH OF TERR-LOC-CSR CURSOR'               
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *-------------------------------------------------------------            
      * 8420-CLOSE-TERR-LOC-CSR.                                                
      *      CLOSE THE TERRITORY LOCATION CURSOR.                               
      *-------------------------------------------------------------            
       8420-CLOSE-TERR-LOC-CSR.                                                 
                                                                                
           MOVE '8420-CLOSE-TERR-LOC-CSR'  TO PV-PARAGRAPH-NAME.                
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    CLOSE TERR-LOC-CSR                                          
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 CLOSE OF TERR-LOC-CSR CURSOR'               
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8500-OPEN-REGN-LOC-CSR.                                                 
      *      OPEN THE CURSOR OF LOCATIONS WITHIN A REGION.                      
      *----------------------------------------------------------               
       8500-OPEN-REGN-LOC-CSR.                                                  
                                                                                
           MOVE '8500-OPEN-REGN-LOC-CSR'  TO PV-PARAGRAPH-NAME.                 
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    OPEN REGN-LOC-CSR                                           
                 END-EXEC                                                       
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 OPEN OF REGN-LOC-CSR CURSOR'                
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8510-FETCH-REGN-LOC-CSR.                                                
      *      FETCH A LOCATION WITHIN A REGION.                                  
      *----------------------------------------------------------               
       8510-FETCH-REGN-LOC-CSR.                                                 
                                                                                
           MOVE '8510-FETCH-REGN-LOC-CSR'  TO PV-PARAGRAPH-NAME.                
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                   OR                      
                      SQLCODE = 0                       OR                      
                      SQLCODE = +100)                                           
                                                                                
                 EXEC SQL                                                       
                    FETCH REGN-LOC-CSR                                          
                    INTO  :XST00001-LOC-NBR                                     
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                    WHEN SQLCODE = -904                                         
                    WHEN SQLCODE = -911                                         
                    WHEN SQLCODE = -913                                         
                        CONTINUE                                                
                    WHEN SQLCODE = ZERO                                         
                        CONTINUE                                                
                    WHEN SQLCODE = +100                                         
                        SET PS-NO-MORE-REGN-LOC    TO TRUE                      
                    WHEN OTHER                                                  
                        SET PS-PROCESS-STOP        TO TRUE                      
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 FETCH OF REGN-LOC-CSR CURSOR'               
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *-------------------------------------------------------------            
      * 8520-CLOSE-REGN-LOC-CSR.                                                
      *      CLOSE THE REGION LOCATION CURSOR.                                  
      *-------------------------------------------------------------            
       8520-CLOSE-REGN-LOC-CSR.                                                 
                                                                                
           MOVE '8520-CLOSE-REGN-LOC-CSR'  TO PV-PARAGRAPH-NAME.                
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    CLOSE REGN-LOC-CSR                                          
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 CLOSE OF REGN-LOC-CSR CURSOR'               
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8600-OPEN-DIST-LOC-CSR.                                                 
      *      OPEN THE CURSOR OF LOCATIONS WITHIN A DISTRICT.                    
      *----------------------------------------------------------               
       8600-OPEN-DIST-LOC-CSR.                                                  
                                                                                
           MOVE '8600-OPEN-DIST-LOC-CSR'  TO PV-PARAGRAPH-NAME.                 
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    OPEN DIST-LOC-CSR                                           
                 END-EXEC                                                       
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 OPEN OF DIST-LOC-CSR CURSOR'                
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8610-FETCH-DIST-LOC-CSR.                                                
      *      FETCH A LOCATION WITHIN A DISTRICT.                                
      *----------------------------------------------------------               
       8610-FETCH-DIST-LOC-CSR.                                                 
                                                                                
           MOVE '8610-FETCH-DIST-LOC-CSR'  TO PV-PARAGRAPH-NAME.                
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                   OR                      
                      SQLCODE = 0                       OR                      
                      SQLCODE = +100)                                           
                                                                                
                 EXEC SQL                                                       
                    FETCH DIST-LOC-CSR                                          
                    INTO  :XST00001-LOC-NBR                                     
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                    WHEN SQLCODE = -904                                         
                    WHEN SQLCODE = -911                                         
                    WHEN SQLCODE = -913                                         
                        CONTINUE                                                
                    WHEN SQLCODE = ZERO                                         
                        CONTINUE                                                
                    WHEN SQLCODE = +100                                         
                        SET PS-NO-MORE-DIST-LOC    TO TRUE                      
                    WHEN OTHER                                                  
                        SET PS-PROCESS-STOP        TO TRUE                      
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 FETCH OF DIST-LOC-CSR CURSOR'               
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *-------------------------------------------------------------            
      * 8620-CLOSE-DIST-LOC-CSR.                                                
      *      CLOSE THE DISTRICT LOCATION CURSOR.                                
      *-------------------------------------------------------------            
       8620-CLOSE-DIST-LOC-CSR.                                                 
                                                                                
           MOVE '8620-CLOSE-DIST-LOC-CSR'  TO PV-PARAGRAPH-NAME.                
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    CLOSE DIST-LOC-CSR                                          
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 CLOSE OF DIST-LOC-CSR CURSOR'               
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8700-OPEN-DC-LOC-CSR.                                                   
      *      OPEN THE CURSOR OF LOCATIONS WITHIN A DC.                          
      *----------------------------------------------------------               
       8700-OPEN-DC-LOC-CSR.                                                    
                                                                                
           MOVE '8700-OPEN-DC-LOC-CSR'  TO PV-PARAGRAPH-NAME.                   
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    OPEN DC-LOC-CSR                                             
                 END-EXEC                                                       
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 OPEN OF DC-LOC-CSR CURSOR'                  
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8710-FETCH-DC-LOC-CSR.                                                  
      *      FETCH A LOCATION WITHIN A DC.                                      
      *----------------------------------------------------------               
       8710-FETCH-DC-LOC-CSR.                                                   
                                                                                
           MOVE '8710-FETCH-DC-LOC-CSR'  TO PV-PARAGRAPH-NAME.                  
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                   OR                      
                      SQLCODE = 0                       OR                      
                      SQLCODE = +100)                                           
                                                                                
                 EXEC SQL                                                       
                    FETCH DC-LOC-CSR                                            
                    INTO  :XST00001-LOC-NBR                                     
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                    WHEN SQLCODE = -904                                         
                    WHEN SQLCODE = -911                                         
                    WHEN SQLCODE = -913                                         
                        CONTINUE                                                
                    WHEN SQLCODE = ZERO                                         
                        CONTINUE                                                
                    WHEN SQLCODE = +100                                         
                        SET PS-NO-MORE-DC-LOC    TO TRUE                        
                    WHEN OTHER                                                  
                        SET PS-PROCESS-STOP        TO TRUE                      
                        DISPLAY 'DC-LOC-CSR ABEND - ' XST00020-DC-NBR           
                                ' - '   ICT00010-CNT-STUP-ID                    
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 FETCH OF DC-LOC-CSR CURSOR'                 
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *-------------------------------------------------------------            
      * 8720-CLOSE-DC-LOC-CSR.                                                  
      *      CLOSE THE DC LOCATION CURSOR.                                      
      *-------------------------------------------------------------            
       8720-CLOSE-DC-LOC-CSR.                                                   
                                                                                
           MOVE '8720-CLOSE-DC-LOC-CSR'  TO PV-PARAGRAPH-NAME.                  
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    CLOSE DC-LOC-CSR                                            
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 CLOSE OF DC-LOC-CSR CURSOR'                 
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8800-OPEN-CANC-CNT-CSR.                                                 
      *      OPEN THE CURSOR OF CANCELLED COUNTS.                               
      *----------------------------------------------------------               
       8800-OPEN-CANC-CNT-CSR.                                                  
                                                                                
           MOVE '8800-OPEN-CANC-CNT-CSR'  TO PV-PARAGRAPH-NAME.                 
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    OPEN CANC-CNT-CSR                                           
                 END-EXEC                                                       
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 OPEN OF CANC-CNT-CSR CURSOR'                
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8810-FETCH-CANC-CNT-CSR.                                                
      *      FETCH A CANCELLED COUNT.                                           
      *----------------------------------------------------------               
       8810-FETCH-CANC-CNT-CSR.                                                 
                                                                                
           MOVE '8810-FETCH-CANC-CNT-CSR'  TO PV-PARAGRAPH-NAME.                
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                   OR                      
                      SQLCODE = 0                       OR                      
                      SQLCODE = +100)                                           
                                                                                
                 EXEC SQL                                                       
                    FETCH CANC-CNT-CSR                                          
                    INTO  :ICT00019-CNT-STUP-ID                                 
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                    WHEN SQLCODE = -904                                         
                    WHEN SQLCODE = -911                                         
                    WHEN SQLCODE = -913                                         
                        CONTINUE                                                
                    WHEN SQLCODE = ZERO                                         
                        ADD +1 TO DI-CANCELLED-CNTS                             
                    WHEN SQLCODE = +100                                         
                        SET PS-NO-MORE-CANC-CNT  TO TRUE                        
                    WHEN OTHER                                                  
                        SET PS-PROCESS-STOP        TO TRUE                      
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 FETCH OF CANC-CNT-CSR CURSOR'               
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *-------------------------------------------------------------            
      * 8820-CLOSE-CANC-CNT-CSR.                                                
      *      CLOSE THE CANCELLED COUNT CURSOR.                                  
      *-------------------------------------------------------------            
       8820-CLOSE-CANC-CNT-CSR.                                                 
                                                                                
           MOVE '8820-CLOSE-CANC-CNT-CSR'  TO PV-PARAGRAPH-NAME.                
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    CLOSE CANC-CNT-CSR                                          
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 CLOSE OF CANC-CNT-CSR CURSOR'               
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8850-OPEN-RPET-CNT-CSR.                                                 
      *      OPEN THE CURSOR OF REPEAT COUNTS.                                  
      *----------------------------------------------------------               
       8850-OPEN-RPET-CNT-CSR.                                                  
                                                                                
           MOVE '8850-OPEN-RPET-CNT-CSR'  TO PV-PARAGRAPH-NAME.                 
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    OPEN RPET-CNT-CSR                                           
                 END-EXEC                                                       
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 OPEN OF RPET-CNT-CSR CURSOR'                
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8860-FETCH-RPET-CNT-CSR.                                                
      *      FETCH A REPEAT COUNT.                                              
      *----------------------------------------------------------               
       8860-FETCH-RPET-CNT-CSR.                                                 
                                                                                
           MOVE '8860-FETCH-RPET-CNT-CSR'  TO PV-PARAGRAPH-NAME.                
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                   OR                      
                      SQLCODE = 0                       OR                      
                      SQLCODE = +100)                                           
                                                                                
                 EXEC SQL                                                       
                    FETCH RPET-CNT-CSR                                          
                    INTO  :ICT00014-LOC-HIER-CDE                                
                         ,:ICT00014-LOC-HIER-VAL-NBR                            
                         ,:ICT00010-EXCL-MDSE-IND                               
                         ,:ICT00010-CNT-STUP-ID                                 
                         ,:ICT00013-CNT-FRQ-CDE                                 
                         ,:ICT00010-FS-UPD-IND                                  
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                    WHEN SQLCODE = -904                                         
                    WHEN SQLCODE = -911                                         
                    WHEN SQLCODE = -913                                         
                        CONTINUE                                                
                    WHEN SQLCODE = ZERO                                         
                        ADD +1 TO DI-RPET-CNTS                                  
                    WHEN SQLCODE = +100                                         
                        SET PS-NO-MORE-RPET-CNT  TO TRUE                        
                    WHEN OTHER                                                  
                        SET PS-PROCESS-STOP        TO TRUE                      
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 FETCH OF RPET-CNT-CSR CURSOR'               
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *-------------------------------------------------------------            
      * 8870-CLOSE-RPET-CNT-CSR.                                                
      *      CLOSE THE REPEAT COUNT CURSOR.                                     
      *-------------------------------------------------------------            
       8870-CLOSE-RPET-CNT-CSR.                                                 
                                                                                
           MOVE '8870-CLOSE-RPET-CNT-CSR'  TO PV-PARAGRAPH-NAME.                
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    CLOSE RPET-CNT-CSR                                          
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 CLOSE OF RPET-CNT-CSR CURSOR'               
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8880-OPEN-RPET-CNT-NEXT-CSR.                                            
      *      OPEN THE CURSOR OF REPEAT COUNTS.                                  
      *----------------------------------------------------------               
       8880-OPEN-RPET-CNT-NEXT-CSR.                                             
                                                                                
           MOVE '8880-OPEN-RPET-CNT-NEXT-CSR'  TO PV-PARAGRAPH-NAME.            
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    OPEN RPET-CNT-NEXT-CSR                                      
                 END-EXEC                                                       
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 OPEN OF RPET-CNT-NEXT-CSR CURSOR'           
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8885-FETCH-RPET-CNT-NEXT-CSR.                                           
      *      FETCH A REPEAT COUNT.                                              
      *----------------------------------------------------------               
       8885-FETCH-RPET-CNT-NEXT-CSR.                                            
                                                                                
           MOVE '8885-FETCH-RPET-CNT-NEXT-CSR'  TO PV-PARAGRAPH-NAME.           
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                   OR                      
                      SQLCODE = 0                       OR                      
                      SQLCODE = +100)                                           
                                                                                
                 EXEC SQL                                                       
                    FETCH RPET-CNT-NEXT-CSR                                     
                    INTO  :ICT00014-LOC-HIER-CDE                                
                         ,:ICT00014-LOC-HIER-VAL-NBR                            
                         ,:ICT00010-EXCL-MDSE-IND                               
                         ,:ICT00010-CNT-STUP-ID                                 
                         ,:ICT00013-CNT-FRQ-CDE                                 
                         ,:ICT00013-RPET-WND-STRT-DTE                           
                         ,:ICT00013-RPET-WND-END-DTE                            
                         ,:ICT00010-FS-UPD-IND                                  
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                    WHEN SQLCODE = -904                                         
                    WHEN SQLCODE = -911                                         
                    WHEN SQLCODE = -913                                         
                        CONTINUE                                                
                    WHEN SQLCODE = ZERO                                         
                        ADD 1 TO DI-RPET-FUT-CNTS                               
                    WHEN SQLCODE = +100                                         
                        SET PS-NO-MORE-RPET-CNT  TO TRUE                        
                    WHEN OTHER                                                  
                        SET PS-PROCESS-STOP        TO TRUE                      
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 FETCH OF RPET-CNT-NEXT-CSR CURSOR'          
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *-------------------------------------------------------------            
      * 8890-CLOSE-RPET-CNT-NEXT-CSR.                                           
      *      CLOSE THE REPEAT COUNT CURSOR.                                     
      *-------------------------------------------------------------            
       8890-CLOSE-RPET-CNT-NEXT-CSR.                                            
                                                                                
           MOVE '8890-CLOSE-RPET-CNT-NEXT-CSR'  TO PV-PARAGRAPH-NAME.           
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    CLOSE RPET-CNT-NEXT-CSR                                     
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 CLOSE OF RPET-CNT-NEXT-CSR CURSOR'          
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *-------------------------------------------------------------            
      * 8900-CHECK-FOR-INV.                                                     
      *      CHECK TO SEE IF A STORE IS CONDUCTING A FULL INVENTORY             
      *-------------------------------------------------------------            
       8900-CHECK-FOR-INV.                                                      
           MOVE '8900-CHECK-FOR-INV' TO PV-PARAGRAPH-NAME.                      
           EXEC SQL                                                             
               SELECT 'Y'                                                       
                    ,PLND_INV_DTE                                               
                    ,PLND_UNIT_BK_DTE                                           
               INTO :PV-INV-CHECK-FLG                                           
                   ,:INVPAR-PLND-INV-DTE                                        
                   ,:INVPAR-PLND-UNIT-BK-DTE                                    
               FROM TINVPAR A                                                   
                   ,TINCNTL B                                                   
               WHERE A.LOC_NBR = :INVPAR-LOC-NBR                                
                 AND ((:ICT00010-EXEC-WND-STRT-DTE BETWEEN                      
                      A.PLND_INV_DTE AND A.PLND_FIN_BK_DTE)                     
                  OR  (:ICT00010-EXEC-WND-END-DTE BETWEEN                       
                      A.PLND_INV_DTE AND A.PLND_FIN_BK_DTE))                    
                 AND A.INV_ID = B.INV_ID                                        
                 AND B.ACTV_IND = 'Y'                                           
                 AND A.ACTL_FIN_BK_DTE = '9999-09-09'                           
                 AND A.LOC_INV_STAT_CDE = 'IN'                                  
                 AND NOT (A.SCAN_INV_IND  = 'Y'                                 
                      AND A.SCHD_PHY_CNT_CDE = 'EI')                            
               FETCH FIRST ROW ONLY                                             
           END-EXEC.                                                            
           EVALUATE TRUE                                                        
              WHEN SQLCODE = 0                                                  
               MOVE 'Y' TO PV-INV-CHECK-FLG                                     
              WHEN SQLCODE = +100                                               
               MOVE 'N' TO PV-INV-CHECK-FLG                                     
              WHEN OTHER                                                        
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 CHECK FOR INV SELECT'                       
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-EVALUATE.                                                        
                                                                                
      *-------------------------------------------------------------            
      * 8905-CHECK-FOR-INV-RPET-CNT.                                            
      *      CHECK TO SEE IF A STORE IS CONDUCTING A FULL INVENTORY             
      *-------------------------------------------------------------            
       8905-CHECK-FOR-INV-RPET-CNT.                                             
           MOVE '8905-CHECK-FOR-INV-RPET-CNT' TO PV-PARAGRAPH-NAME.             
           EXEC SQL                                                             
               SELECT 'Y'                                                       
                    ,PLND_INV_DTE                                               
                    ,PLND_FIN_BK_DTE                                            
               INTO :PV-INV-CHECK-FLG                                           
                   ,:INVPAR-PLND-INV-DTE                                        
                   ,:INVPAR-PLND-UNIT-BK-DTE                                    
               FROM TINVPAR A                                                   
                   ,TINCNTL B                                                   
               WHERE A.LOC_NBR = :INVPAR-LOC-NBR                                
                AND :PV-COMPUTED-DATE BETWEEN                                   
                      A.PLND_INV_DTE AND A.PLND_FIN_BK_DTE                      
                 AND A.INV_ID = B.INV_ID                                        
                 AND B.ACTV_IND = 'Y'                                           
                 AND A.ACTL_FIN_BK_DTE = '9999-09-09'                           
                 AND A.LOC_INV_STAT_CDE = 'IN'                                  
                 AND NOT (A.SCAN_INV_IND  = 'Y'                                 
                      AND A.SCHD_PHY_CNT_CDE = 'EI')                            
               FETCH FIRST ROW ONLY                                             
           END-EXEC.                                                            
           EVALUATE TRUE                                                        
              WHEN SQLCODE = 0                                                  
               MOVE 'Y' TO PV-INV-CHECK-FLG                                     
              WHEN SQLCODE = +100                                               
               MOVE 'N' TO PV-INV-CHECK-FLG                                     
              WHEN OTHER                                                        
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 CHECK FOR INV SELECT'                       
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-EVALUATE.                                                        
                                                                                
      *-------------------------------------------------------------            
      * 8910-CHECK-CPLTD-COUNT.                                                 
      *      CHECK TO SEE IF A COUNT HAS BEEN COMPLETED                         
      *-------------------------------------------------------------            
       8910-CHECK-CPLTD-COUNT.                                                  
           MOVE '8910-CHECK-CPLTD-COUNT' TO PV-PARAGRAPH-NAME.                  
           EXEC SQL                                                             
             SELECT  'Y'                                                        
             INTO :PV-COMPLETED-COUNT-FLG                                       
             FROM   ICT_LOC_CNT_STAT  A                                         
             WHERE A.CNT_STAT_CDE IN                                            
           ('COM','CAN','APP','AUT','INP','REV','REQ','REW','PRC')              
               AND A.LOC_NBR     = :ICT00020-LOC-NBR                            
               AND A.CNT_STUP_ID = :ICT00020-CNT-STUP-ID                        
               AND A.LAST_UPD_TMST =                                            
      *** GET LATEST ICT_LOC_CNT_STAT ROW                                       
             (SELECT MAX(E.LAST_UPD_TMST)                                       
              FROM ICT_LOC_CNT_STAT   E                                         
              WHERE E.CNT_STUP_ID  =  A.CNT_STUP_ID                             
                AND E.LOC_NBR      =  A.LOC_NBR                                 
014506          AND E.CNT_STAT_CDE <> 'UPD')                                    
             FETCH FIRST ROW ONLY                                               
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
              WHEN SQLCODE = 0                                                  
              WHEN SQLCODE = +100                                               
                  CONTINUE                                                      
              WHEN OTHER                                                        
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 CHECK FOR CPLTD COUNT SELECT'               
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-EVALUATE.                                                        
                                                                                
      *-------------------------------------------------------------            
      * 8920-SELECT-LAST-RUN-TMST                                               
      *      GET TIMESTAMP OF LAST RUN OF PROGRAM                               
      *-------------------------------------------------------------            
       8920-SELECT-LAST-RUN-TMST.                                               
           MOVE '8920-SELECT-LAST-RUN-TMST' TO PV-PARAGRAPH-NAME.               
           EXEC SQL                                                             
             SELECT   EXTR_PRC_DTE                                              
                     ,EXTR_PRC_TMST                                             
               INTO :ICT00007-EXTR-PRC-DTE                                      
                   ,:ICT00007-EXTR-PRC-TMST:PV-EXTR-PRC-TMST-NI                 
               FROM   ICT_CNT_EXTR_PRC    A                                     
               WHERE A. EXTR_PRC_TYP_CDE  = 'PRO'                               
           END-EXEC.                                                            
           EVALUATE TRUE                                                        
              WHEN SQLCODE = 0                                                  
                  SET PS-LAST-RUN-TMST-FOUND TO TRUE                            
              WHEN SQLCODE = +100                                               
               MOVE PC-DEFAULT-TMST TO ICT00007-EXTR-PRC-TMST                   
              WHEN OTHER                                                        
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 CHECK LAST RUN TMST'                        
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-EVALUATE.                                                        
                                                                                
      *-------------------------------------------------------------            
      * 8930-INSERT-STUP-PRC-ROW                                                
      *      INSERT SETUP PROCESSED ROW.                                        
      *-------------------------------------------------------------            
       8930-INSERT-STUP-PRC-ROW.                                                
           MOVE '8930-INSERT-STUP-PRC-ROW' TO PV-PARAGRAPH-NAME.                
           EXEC SQL                                                             
             INSERT INTO ICT_CNT_STUP_STAT                                      
             (CNT_STUP_ID                                                       
             ,CNT_STAT_CDE                                                      
             ,LAST_UPD_TMST                                                     
             ,LAST_UPD_USR_ID                                                   
             ,LAST_ACTN_CDE)                                                    
             VALUES                                                             
             (:ICT00019-CNT-STUP-ID                                             
             ,'PRO'                                                             
             ,:PV-CURRENT-TMST                                                  
             ,'SYSTEM'                                                          
             ,'A')                                                              
           END-EXEC.                                                            
           EVALUATE TRUE                                                        
              WHEN SQLCODE = 0                                                  
                  CONTINUE                                                      
              WHEN SQLCODE = -803                                               
      *** THIS CONDITION IS POSSIBLE WHEN A NEW COUNT IS RELEASED               
      *** THE DAY BEFORE IT IS SCHEDULED TO BEGIN. THIS COUNT WILL              
      *** BE PICKED UP BY THE RLSD_CNT CURSOR AND THE OCCR_CNT CURSOR           
      *** AND BE VALID FOR BOTH. THE DUPLICATE RECORDS PRODUCED BY THIS         
      *** PROGRAM WILL BE REDUCED TO 1 BY THE SORT AT THE BEGINNING AT          
      *** JOB ICK053 AND AS LONG AS 1 ROW IS ADDED TO THE                       
      *** ICT_LOC_CNT_STAT TABLE, THEN, THERE IS NO PROBLEM.                    
               DISPLAY 'DUP ICT_CNT_STUP_STAT - ' ICT00019-CNT-STUP-ID          
                                     ' - '   PV-CURRENT-TMST                    
              WHEN OTHER                                                        
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY 'ICT_CNT_STUP_STAT - ' ICT00019-CNT-STUP-ID              
                                     ' - '   ICT00019-CNT-STAT-CDE              
                                     ' - '   PV-CURRENT-TMST                    
               DISPLAY '** ICKUP052 INSERT PROCESSED ROW'                       
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-EVALUATE.                                                        
      *-------------------------------------------------------------            
      * 8935-INSERT-CAN-PRC-ROW                                                 
      *      INSERT SETUP PROCESSED ROW.                                        
      *-------------------------------------------------------------            
       8935-INSERT-CAN-PRC-ROW.                                                 
           MOVE '8935-INSERT-CAN-PRC-ROW' TO PV-PARAGRAPH-NAME.                 
           EXEC SQL                                                             
             INSERT INTO ICT_CNT_STUP_STAT                                      
             (CNT_STUP_ID                                                       
             ,CNT_STAT_CDE                                                      
             ,LAST_UPD_TMST                                                     
             ,LAST_UPD_USR_ID                                                   
             ,LAST_ACTN_CDE)                                                    
             VALUES                                                             
             (:ICT00019-CNT-STUP-ID                                             
             ,'CPR'                                                             
             ,:PV-CURRENT-TMST                                                  
             ,'SYSTEM'                                                          
             ,'A')                                                              
           END-EXEC.                                                            
           EVALUATE TRUE                                                        
              WHEN SQLCODE = 0                                                  
                  CONTINUE                                                      
              WHEN SQLCODE = -803                                               
      *** THIS CONDITION IS POSSIBLE WHEN A NEW COUNT IS RELEASED               
      *** THE DAY BEFORE IT IS SCHEDULED TO BEGIN. THIS COUNT WILL              
      *** BE PICKED UP BY THE RLSD_CNT CURSOR AND THE OCCR_CNT CURSOR           
      *** AND BE VALID FOR BOTH. THE DUPLICATE RECORDS PRODUCED BY THIS         
      *** PROGRAM WILL BE REDUCED TO 1 BY THE SORT AT THE BEGINNING AT          
      *** JOB ICK053 AND AS LONG AS 1 ROW IS ADDED TO THE                       
      *** ICT_LOC_CNT_STAT TABLE, THEN, THERE IS NO PROBLEM.                    
               DISPLAY 'DUP ICT_CNT_STUP_STAT - ' ICT00019-CNT-STUP-ID          
                                     ' - '   PV-CURRENT-TMST                    
              WHEN OTHER                                                        
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY 'ICT_CNT_STUP_STAT - ' ICT00019-CNT-STUP-ID              
                                     ' - '   ICT00019-CNT-STAT-CDE              
                                     ' - '   PV-CURRENT-TMST                    
               DISPLAY '** ICKUP052 INSERT CAN PROCESSED ROW'                   
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-EVALUATE.                                                        
      *-------------------------------------------------------------            
      * 8940-UPDATE-LAST-RUN-TMST                                               
      *      UPDATE LAST RUN TIMESTAMP OF TO ICT_CNT_STUP_STAT TABLE            
      *-------------------------------------------------------------            
       8940-UPDATE-LAST-RUN-TMST.                                               
           MOVE '8940-UPDATE-LAST-RUN-TMST' TO PV-PARAGRAPH-NAME.               
           EXEC SQL                                                             
           UPDATE ICT_CNT_EXTR_PRC                                              
           SET EXTR_PRC_TMST = :PV-CURRENT-TMST                                 
           WHERE EXTR_PRC_TYP_CDE = 'PRO'                                       
             AND EXTR_PRC_DTE     = :ICT00007-EXTR-PRC-DTE                      
           END-EXEC.                                                            
           EVALUATE TRUE                                                        
              WHEN SQLCODE = 0                                                  
                  CONTINUE                                                      
              WHEN OTHER                                                        
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 UPDATE LAST RUN TMST'                       
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-EVALUATE.                                                        
      *-------------------------------------------------------------            
      * 8945-INSERT-LAST-RUN-TMST                                               
      *      INSERT LAST RUN TIMESTAMP OF TO ICT_CNT_STUP_STAT TABLE            
      *-------------------------------------------------------------            
       8945-INSERT-LAST-RUN-TMST.                                               
           MOVE '8945-INSERT-LAST-RUN-TMST' TO PV-PARAGRAPH-NAME.               
           EXEC SQL                                                             
             INSERT INTO ICT_CNT_EXTR_PRC                                       
             (EXTR_PRC_TYP_CDE                                                  
             ,EXTR_PRC_DTE                                                      
             ,EXTR_PRC_TMST)                                                    
             VALUES                                                             
             ('PRO'                                                             
             ,:PV-CURRENT-DATE                                                  
             ,:PV-CURRENT-TMST)                                                 
           END-EXEC.                                                            
           EVALUATE TRUE                                                        
              WHEN SQLCODE = 0                                                  
                  CONTINUE                                                      
              WHEN OTHER                                                        
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 INSERT LAST RUN TMST'                       
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-EVALUATE.                                                        
                                                                                
      *-------------------------------------------------------------            
      * 8960-CONVERT-DATE.                                                      
      *      CONVERTS FISCAL DAY,WEEK, YEAR TO GREG DATE.                       
      *-------------------------------------------------------------            
       8960-CONVERT-DATE.                                                       
           MOVE '8960-CONVERT-DATE' TO PV-PARAGRAPH-NAME.                       
           EXEC SQL                                                             
               SELECT KY_DTE                                                    
               INTO :DTATTR-KY-DTE                                              
               FROM TDTATTR                                                     
               WHERE FSCL_YR_NBR   = :PV-FISCAL-YEAR-NBR                        
                 AND FSCL_MN_NBR   = :DTATTR-FSCL-MN-NBR                        
                 AND WK_IN_MN_NBR  = :DTATTR-FSCL-WK-NBR                        
                 AND DAY_OF_WK_NBR = :DTATTR-DAY-OF-WK-NBR                      
           END-EXEC.                                                            
           EVALUATE TRUE                                                        
              WHEN SQLCODE = 0                                                  
                  CONTINUE                                                      
              WHEN OTHER                                                        
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY '** ICKUP052 SELECT WEEK DATE'                           
                       ' HAD SQLCODE OF ' SQLCODE                               
               DISPLAY 'KEY = ' PV-FISCAL-YEAR-NBR                              
                          ' - ' DTATTR-FSCL-MN-NBR                              
                          ' - ' DTATTR-FSCL-WK-NBR                              
                          ' - ' DTATTR-DAY-OF-WK-NBR                            
               PERFORM 9999-SQL-ABEND                                           
           END-EVALUATE.                                                        
                                                                                
                                                                                
      ******************************************************************        
      * 9990-DISPLAY-CONTROL-INFO.                                     *        
      *  ==> PROCESSES:                                                *        
      *    - DISPLAYS CONTROL INFORMATION AT END OF JOB                *        
      ******************************************************************        
       9990-DISPLAY-CONTROL-INFO.                                               
                                                                                
           DISPLAY '********************************************'.              
           DISPLAY '**** RUN STATISTICS FOR PROGRAM ICKUP052 ***'.              
           DISPLAY '****'.                                                      
           DISPLAY '1 DAY RELEASED COUNTS      :' DI-RLSE-CNTS                  
           DISPLAY 'COUNTS WITHIN 2,7,14 DY WIN:' DI-WINDOW-CNTS                
           DISPLAY 'CURR OCCURING COUNTS       :' DI-CURR-OCCR-CNTS             
           DISPLAY 'REPEAT COUNTS              :' DI-RPET-CNTS                  
           DISPLAY 'REPEAT FUTURE COUNTS       :' DI-RPET-FUT-CNTS              
           DISPLAY 'CANCELLED COUNTS           :' DI-CANCELLED-CNTS             
           DISPLAY 'COMMITS TAKEN              :' DI-COMMIT-CNTR.               
           DISPLAY '****'.                                                      
           DISPLAY '**** RUN STATS END FOR PROGRAM ICKUP052  ***'.              
           DISPLAY '********************************************'.              
                                                                                
      ******************************************************************        
      * 9999-SQL-ABEND.                                                *        
      *  ==> PROCESSES:                                                *        
      *    - PERFORMS ABENDS AFTER UNEXPECTED SQLCODE                  *        
      ******************************************************************        
       9999-SQL-ABEND.                                                          
                                                                                
           MOVE SQLCODE TO PV-SQLCODE-DISPLAY.                                  
                                                                                
           DISPLAY '** ABEND **'.                                               
           DISPLAY 'ICKUP052 - ABEND'.                                          
           DISPLAY 'PARAGRAPH = ' PV-PARAGRAPH-NAME.                            
           DISPLAY 'OPERATION = ' PV-DB2-OPERATION-ATTEMPTED.                   
           DISPLAY 'SQL CODE  = ' PV-SQLCODE-DISPLAY.                           
           PERFORM 9990-DISPLAY-CONTROL-INFO.                                   
                                                                                
           COPY DPPD004.                                                        
           IF ABEND-CODE = 0                                                    
             MOVE +4013 TO ABEND-CODE.                                          
           CALL 'ILBOABN0' USING ABEND-CODE.                                    
