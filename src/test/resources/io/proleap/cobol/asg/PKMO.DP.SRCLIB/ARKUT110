000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             ARKUT110.                                00050000
000600 AUTHOR.                 COGNIZANT.                               00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN.           02-14-2013.                              00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  THIS PROGRAM WILL READ NEW SALES CHECK DETAIL FILE,           *00120060
001300*  NEW POSTING FILE AND SPLIT THE FILES INTO 8 CHUNKS SALES      *00130060
001400*  CHECK DETAIL FILES AND 8 CHUNK POSTING FILES.                 *00140060
001500******************************************************************00150060
001600*  02/17/2013 COGNIZANT - INITAL IMPLEMENTATION.                 *00160060
001700******************************************************************00170060
001800 ENVIRONMENT DIVISION.                                            00180060
001900******************************************************************00190060
002000                                                                  00200060
002100 CONFIGURATION SECTION.                                           00210060
002200                                                                  00220060
002300 SOURCE-COMPUTER.        IBM-3090.                                00230060
002400 OBJECT-COMPUTER.        IBM-3090.                                00240060
002500                                                                  00250060
002600 INPUT-OUTPUT SECTION.                                            00260060
002700                                                                  00270060
002800 FILE-CONTROL.                                                    00280060
002900                                                                  00290060
003000     SELECT NEW-SALES-CHECK-DTL-FILE                              00300060
003100         ASSIGN TO INP01.                                         00310060
003200                                                                  00320060
003300     SELECT NEW-POSTING-TRANS-FILE                                00330060
003400         ASSIGN TO INP02.                                         00340060
003500                                                                  00350060
003600     SELECT SALES-CHK-DTL-FILE-1                                  00360060
003700         ASSIGN TO OUT01.                                         00370060
003800                                                                  00380060
003900     SELECT SALES-CHK-DTL-FILE-2                                  00390060
004000         ASSIGN TO OUT02.                                         00400060
004100                                                                  00410060
004200     SELECT SALES-CHK-DTL-FILE-3                                  00420060
004300         ASSIGN TO OUT03.                                         00430060
004400                                                                  00440060
004500     SELECT SALES-CHK-DTL-FILE-4                                  00450060
004600         ASSIGN TO OUT04.                                         00460060
004700                                                                  00470060
004800     SELECT SALES-CHK-DTL-FILE-5                                  00480060
004900         ASSIGN TO OUT05.                                         00490060
005000                                                                  00500060
005100     SELECT SALES-CHK-DTL-FILE-6                                  00510060
005200         ASSIGN TO OUT06.                                         00520060
005300                                                                  00530060
005400     SELECT SALES-CHK-DTL-FILE-7                                  00540060
005500         ASSIGN TO OUT07.                                         00550060
005600                                                                  00560060
005700     SELECT SALES-CHK-DTL-FILE-8                                  00570060
005800         ASSIGN TO OUT08.                                         00580060
005900                                                                  00590060
006000     SELECT POSTING-TRANS-FILE-1                                  00600060
006100         ASSIGN TO OUT09.                                         00610060
006200                                                                  00620060
006300     SELECT POSTING-TRANS-FILE-2                                  00630060
006400         ASSIGN TO OUT10.                                         00640060
006500                                                                  00650060
006600     SELECT POSTING-TRANS-FILE-3                                  00660060
006700         ASSIGN TO OUT11.                                         00670060
006800                                                                  00680060
006900     SELECT POSTING-TRANS-FILE-4                                  00690060
007000         ASSIGN TO OUT12.                                         00700060
007100                                                                  00710060
007200     SELECT POSTING-TRANS-FILE-5                                  00720060
007300         ASSIGN TO OUT13.                                         00730060
007400                                                                  00740060
007500     SELECT POSTING-TRANS-FILE-6                                  00750060
007600         ASSIGN TO OUT14.                                         00760060
007700                                                                  00770060
007800     SELECT POSTING-TRANS-FILE-7                                  00780060
007900         ASSIGN TO OUT15.                                         00790060
008000                                                                  00800060
008100     SELECT POSTING-TRANS-FILE-8                                  00810060
008200         ASSIGN TO OUT16.                                         00820060
008300                                                                  00830060
008400                                                                  00840060
008500******************************************************************00850060
008600 DATA DIVISION.                                                   00860060
008700******************************************************************00870060
008800                                                                  00880060
008900 FILE SECTION.                                                    00890060
009000                                                                  00900060
009100 FD  NEW-SALES-CHECK-DTL-FILE                                     00910060
009200     RECORDING MODE IS F                                          00920060
009300     LABEL RECORDS ARE STANDARD                                   00930060
009400     BLOCK CONTAINS 0 RECORDS                                     00940060
009500     RECORD CONTAINS 267 CHARACTERS                               00950078
009600     DATA RECORD IS NEW-SLS-CHK-DTL-RECORD.                       00960060
009700                                                                  00970060
009800 01  NEW-SLS-CHK-DTL-RECORD      PIC X(267).                      00980078
009900                                                                  00990060
010000 FD  NEW-POSTING-TRANS-FILE                                       01000060
010100     RECORDING MODE IS F                                          01010060
010200     LABEL RECORDS ARE STANDARD                                   01020060
010300     BLOCK CONTAINS 0 RECORDS                                     01030060
010400     RECORD CONTAINS 188 CHARACTERS                               01040060
010500     DATA RECORD IS NEW-POSTING-TRANS-RECORD.                     01050060
010600                                                                  01060060
010700 01  NEW-POSTING-TRANS-RECORD    PIC X(188).                      01070060
010800                                                                  01080060
010900 FD  SALES-CHK-DTL-FILE-1                                         01090060
011000     RECORDING MODE IS F                                          01100060
011100     LABEL RECORDS ARE STANDARD                                   01110060
011200     BLOCK CONTAINS 0 RECORDS                                     01120060
011300     RECORD CONTAINS 267 CHARACTERS.                              01130078
011400                                                                  01140060
011500 01  SALES-CHK-DTL-RCD-1         PIC X(267).                      01150078
011600                                                                  01160060
011700 FD  SALES-CHK-DTL-FILE-2                                         01170060
011800     RECORDING MODE IS F                                          01180060
011900     LABEL RECORDS ARE STANDARD                                   01190060
012000     BLOCK CONTAINS 0 RECORDS                                     01200060
012100     RECORD CONTAINS 267 CHARACTERS.                              01210078
012200                                                                  01220060
012300 01  SALES-CHK-DTL-RCD-2         PIC X(267).                      01230078
012400                                                                  01240060
012500 FD  SALES-CHK-DTL-FILE-3                                         01250060
012600     RECORDING MODE IS F                                          01260060
012700     LABEL RECORDS ARE STANDARD                                   01270060
012800     BLOCK CONTAINS 0 RECORDS                                     01280060
012900     RECORD CONTAINS 267 CHARACTERS.                              01290078
013000                                                                  01300000
013100 01  SALES-CHK-DTL-RCD-3         PIC X(267).                      01310078
013200                                                                  01320000
013300 FD  SALES-CHK-DTL-FILE-4                                         01330000
013400     RECORDING MODE IS F                                          01340000
013500     LABEL RECORDS ARE STANDARD                                   01350000
013600     BLOCK CONTAINS 0 RECORDS                                     01360000
013700     RECORD CONTAINS 267 CHARACTERS.                              01370078
013800                                                                  01380000
013900 01  SALES-CHK-DTL-RCD-4         PIC X(267).                      01390078
014000                                                                  01400000
014100 FD  SALES-CHK-DTL-FILE-5                                         01410000
014200     RECORDING MODE IS F                                          01420000
014300     LABEL RECORDS ARE STANDARD                                   01430000
014400     BLOCK CONTAINS 0 RECORDS                                     01440000
014500     RECORD CONTAINS 267 CHARACTERS.                              01450078
014600                                                                  01460000
014700 01  SALES-CHK-DTL-RCD-5         PIC X(267).                      01470078
014800                                                                  01480000
014900 FD  SALES-CHK-DTL-FILE-6                                         01490000
015000     RECORDING MODE IS F                                          01500000
015100     LABEL RECORDS ARE STANDARD                                   01510000
015200     BLOCK CONTAINS 0 RECORDS                                     01520000
015300     RECORD CONTAINS 267 CHARACTERS.                              01530078
015400                                                                  01540000
015500 01  SALES-CHK-DTL-RCD-6         PIC X(267).                      01550078
015600                                                                  01560000
015700 FD  SALES-CHK-DTL-FILE-7                                         01570000
015800     RECORDING MODE IS F                                          01580000
015900     LABEL RECORDS ARE STANDARD                                   01590000
016000     BLOCK CONTAINS 0 RECORDS                                     01600000
016100     RECORD CONTAINS 267 CHARACTERS.                              01610078
016200                                                                  01620000
016300 01  SALES-CHK-DTL-RCD-7         PIC X(267).                      01630078
016400                                                                  01640000
016500 FD  SALES-CHK-DTL-FILE-8                                         01650000
016600     RECORDING MODE IS F                                          01660000
016700     LABEL RECORDS ARE STANDARD                                   01670000
016800     BLOCK CONTAINS 0 RECORDS                                     01680000
016900     RECORD CONTAINS 267 CHARACTERS.                              01690078
017000                                                                  01700000
017100 01  SALES-CHK-DTL-RCD-8         PIC X(267).                      01710078
017200                                                                  01720000
017300 FD  POSTING-TRANS-FILE-1                                         01730000
017400     RECORDING MODE IS F                                          01740000
017500     LABEL RECORDS ARE STANDARD                                   01750000
017600     BLOCK CONTAINS 0 RECORDS                                     01760000
017700     RECORD CONTAINS 188 CHARACTERS.                              01770000
017800                                                                  01780000
017900 01  POSTING-TRANS-RECORD-1      PIC X(188).                      01790000
018000                                                                  01800000
018100 FD  POSTING-TRANS-FILE-2                                         01810000
018200     RECORDING MODE IS F                                          01820000
018300     LABEL RECORDS ARE STANDARD                                   01830000
018400     BLOCK CONTAINS 0 RECORDS                                     01840000
018500     RECORD CONTAINS 188 CHARACTERS.                              01850000
018600                                                                  01860000
018700 01  POSTING-TRANS-RECORD-2      PIC X(188).                      01870000
018800                                                                  01880000
018900 FD  POSTING-TRANS-FILE-3                                         01890000
019000     RECORDING MODE IS F                                          01900000
019100     LABEL RECORDS ARE STANDARD                                   01910000
019200     BLOCK CONTAINS 0 RECORDS                                     01920000
019300     RECORD CONTAINS 188 CHARACTERS.                              01930000
019400                                                                  01940000
019500 01  POSTING-TRANS-RECORD-3      PIC X(188).                      01950000
019600                                                                  01960000
019700 FD  POSTING-TRANS-FILE-4                                         01970000
019800     RECORDING MODE IS F                                          01980000
019900     LABEL RECORDS ARE STANDARD                                   01990000
020000     BLOCK CONTAINS 0 RECORDS                                     02000000
020100     RECORD CONTAINS 188 CHARACTERS.                              02010000
020200                                                                  02020000
020300 01  POSTING-TRANS-RECORD-4      PIC X(188).                      02030000
020400                                                                  02040000
020500 FD  POSTING-TRANS-FILE-5                                         02050000
020600     RECORDING MODE IS F                                          02060000
020700     LABEL RECORDS ARE STANDARD                                   02070000
020800     BLOCK CONTAINS 0 RECORDS                                     02080000
020900     RECORD CONTAINS 188 CHARACTERS.                              02090000
021000                                                                  02100000
021100 01  POSTING-TRANS-RECORD-5      PIC X(188).                      02110000
021200                                                                  02120000
021300 FD  POSTING-TRANS-FILE-6                                         02130000
021400     RECORDING MODE IS F                                          02140000
021500     LABEL RECORDS ARE STANDARD                                   02150000
021600     BLOCK CONTAINS 0 RECORDS                                     02160000
021700     RECORD CONTAINS 188 CHARACTERS.                              02170000
021800                                                                  02180000
021900 01  POSTING-TRANS-RECORD-6      PIC X(188).                      02190000
022000                                                                  02200000
022100 FD  POSTING-TRANS-FILE-7                                         02210000
022200     RECORDING MODE IS F                                          02220000
022300     LABEL RECORDS ARE STANDARD                                   02230000
022400     BLOCK CONTAINS 0 RECORDS                                     02240000
022500     RECORD CONTAINS 188 CHARACTERS.                              02250000
022600                                                                  02260000
022700 01  POSTING-TRANS-RECORD-7      PIC X(188).                      02270000
022800                                                                  02280000
022900 FD  POSTING-TRANS-FILE-8                                         02290000
023000     RECORDING MODE IS F                                          02300000
023100     LABEL RECORDS ARE STANDARD                                   02310000
023200     BLOCK CONTAINS 0 RECORDS                                     02320000
023300     RECORD CONTAINS 188 CHARACTERS.                              02330000
023400                                                                  02340000
023500 01  POSTING-TRANS-RECORD-8      PIC X(188).                      02350000
023600                                                                  02360000
023700 WORKING-STORAGE SECTION.                                         02370000
023800                                                                  02380000
023900*                                                                 02390000
024000*  SALES CHECK DETAIL FILE NEW LAYOUT FOR AJB PROCESS             02400000
024100*                                                                 02410000
024200                                                                  02420000
024300     COPY ARRD025.                                                02430000
024400*                                                                 02440000
024500*  POSTING TRANSACTION FILE NEW LAYOUT FOR AJB PROCESS            02450000
024600*                                                                 02460000
024700                                                                  02470000
024800     COPY ARRD026.                                                02480000
024900                                                                  02490000
025000*                                                                 02500054
025100*  AR CONSTANTS                                                   02510054
025200*                                                                 02520054
025300                                                                  02530054
025400     COPY ARWS004.                                                02540054
025500                                                                  02550054
025600*                                                                 02560000
025700*  PARAMETER LIST FOR THE CALENDAR SUBROUTINE (DPKUT500)          02570000
025800*                                                                 02580000
025900                                                                  02590000
026000     COPY DPWS500.                                                02600000
026100                                                                  02610000
026200*                                                                 02620000
026300*  VARIABLES TO FORMAT SQLCA                                      02630000
026400*                                                                 02640000
026500                                                                  02650000
026600     COPY DPWS004.                                                02660000
026700                                                                  02670000
026800 01  ABEND-CODE                  PIC S9(4)    VALUE ZERO          02680000
026900                                              COMP SYNC.          02690000
027000     88  AC-INVLD-DATA-ON-DATASET-ERROR       VALUE +4008.        02700000
027100     88  AC-DB2-ERROR                         VALUE +4013.        02710000
027200                                                                  02720000
027300 01  PS-PROGRAM-SWITCHES.                                         02730000
027400     05  PS-END-OF-SALES-FILE-IND                                 02740000
027500                                 PIC X(1)     VALUE 'N'.          02750000
027600         88  PS-END-OF-SALES-FILE             VALUE 'Y'.          02760000
027700     05  PS-END-OF-TRANS-FILE-IND                                 02770054
027800                                 PIC X(1)     VALUE 'N'.          02780000
027900         88  PS-END-OF-TRANS-FILE             VALUE 'Y'.          02790000
028000     05  PS-END-OF-STORE-CURSOR-IND                               02800000
028100                                 PIC X(1)     VALUE 'N'.          02810000
028200         88  PS-END-OF-STORE-CURSOR           VALUE 'Y'.          02820000
028300     05  PS-EMP-DISC-RCD-IND     PIC X(1).                        02830054
028400         88 PS-PAYMENT-RCD                    VALUE 'P'.          02840000
028500         88 PS-EMPL-DISC-RCD                  VALUE 'E'.          02850000
028600                                                                  02860000
028700 01  PC-PROGRAM-CONSTANTS.                                        02870000
028800     05  PC-NBR-OF-FILES         PIC 9(2)     VALUE 8.            02880000
028900     05  PC-CURRENT-PROGRAM-NAME PIC X(8)     VALUE 'ARKUT110'.   02890000
029000                                                                  02900000
029100 01  PA-PROGRAM-ACCUMULATORS.                                     02910000
029200     05  PA-INPUT-SALES-READ     PIC S9(11)   VALUE 0 COMP-3.     02920000
029300     05  PA-INPUT-POSTING-READ   PIC S9(11)   VALUE 0 COMP-3.     02930054
029400                                                                  02940000
029500 01  PV-PROGRAM-VARIABLES.                                        02950000
029600     05  PV-LAST-DB2-ACTION      PIC X(45)    VALUE SPACES.       02960000
029700         88  PV-STORE-COUNT-ERR               VALUE               02970000
029800             'SELECT COUNT OF STORES - XST_LOC             '.     02980000
029900         88  PV-OPEN-STORE-CURSOR             VALUE               02990000
030000             'OPEN THE STORE CURSOR - XST_LOC              '.     03000000
030100         88  PV-FETCH-STORE-ROW               VALUE               03010000
030200             'FETCH ROW FROM STORE CURSOR - XST_LOC        '.     03020000
030300         88  PV-CLOSE-STORE-CURSOR            VALUE               03030000
030400             'CLOSE THE STORE CURSOR - XST_LOC             '.     03040000
030500     05  PV-DB2-POS-DATE         PIC X(10).                       03050000
030600                                                                  03060000
030700     05  PV-DB2-FORMAT-DATE.                                      03070000
030800         10  PV-DB2-POS-CC       PIC 9(2).                        03080000
030900         10  PV-DB2-POS-YY       PIC 9(2).                        03090000
031000         10  FILLER              PIC X(1)      VALUE '-'.         03100000
031100         10  PV-DB2-POS-MM       PIC 9(2).                        03110000
031200         10  FILLER              PIC X(1)      VALUE '-'.         03120000
031300         10  PV-DB2-POS-DD       PIC 9(2).                        03130000
031400     05  PV-STORE-COUNT          PIC S9(5)     COMP-3             03140000
031500                                               VALUE ZERO.        03150000
031600     05  PV-STORES-PER-FILE      PIC S9(5)     COMP-3             03160000
031700                                               VALUE ZERO.        03170000
031800     05  PV-FILE-NUMBER          PIC 9(2)      VALUE ZERO.        03180000
031900     05  PV-REMAINDER            PIC 9(2)      VALUE ZERO.        03190000
032000     05  PV-STORE-COUNTER        PIC S9(5)     COMP-3             03200000
032100                                               VALUE ZERO.        03210000
032200     05  PV-AMT-COMP             PIC S9(07)V99 COMP-3             03220054
032300                                               VALUE ZERO.        03230000
032400     05  PV-TRAN-TOT             PIC S9(07)V99 COMP-3             03240069
032500                                               VALUE ZERO.        03250069
032600     05  PV-TOT-SALE-AMT-DISP    PIC -9(09).99  VALUE ZEROES.     03260068
032700     05  PV-TOT-RFND-AMT-DISP    PIC -9(09).99  VALUE ZEROES.     03270069
032800     05  PV-TOT-PYMT-AMT-DISP    PIC -9(09).99  VALUE ZEROES.     03280068
032900                                                                  03290000
033000 01  CC-CONTROL-CARD.                                             03300000
033100     05  CC-CONTROL-CARD-DISPLAY.                                 03310000
033200         10  CC-POS-DATE-MDY     PIC 9(8)      VALUE ZERO.        03320000
033300         10  FILLER              REDEFINES CC-POS-DATE-MDY.       03330000
033400             15  CC-POS-MONTH    PIC 9(2).                        03340000
033500             15  CC-POS-DAY      PIC 9(2).                        03350000
033600             15  CC-POS-CENTURY  PIC 9(2).                        03360000
033700             15  CC-POS-YEAR     PIC 9(2).                        03370000
033800     05  FILLER                  PIC X(72)     VALUE SPACES.      03380000
033900                                                                  03390000
034000                                                                  03400000
034100***************************************************************** 03410000
034200*    *** FILE TABLE ***                                         * 03420000
034300*    THIS TABLE IS USED TO SPLIT THE SALES CHECK DETAIL FILE    * 03430000
034400*    AND POSTING FILE INTO NUMBER OF SEPARATE FILES, FOR FASTER * 03440054
034500*    PROCESSING ON SBS.                                         * 03450000
034600*    THE TABLE HAS AN ENTRY FOR EACH CHUNK FILE.  IT WILL       * 03460000
034700*    CONTAIN THE BEGINNING AND ENDING STORE NUMBERS FOR EACH    * 03470000
034800*    FILE.                                                      * 03480000
034900***************************************************************** 03490000
035000                                                                  03500000
035100 01  PT-FILE-TABLE.                                               03510000
035200     05  PT-FILE-ENTRY          OCCURS 8 TIMES                    03520065
035300                                 INDEXED BY PT-FILE-IDX.          03530000
035400         10  PT-BEGIN-STORE      PIC 9(4).                        03540000
035500         10  PT-END-STORE        PIC 9(4).                        03550000
035600                                                                  03560054
035700***************************************************************** 03570000
035800*    *** TRAILER COUNT TABLE ***                                * 03580000
035900*    THIS TABLE IS USED TO STORE TOTAL SALES, REFUND AND        * 03590000
036000*    PAYMENT DOLLAR AMOUNTS WITHIN EACH CHUNK FILE FOR TRAILER  * 03600000
036100*    RECORD PURPOSE                                             * 03610000
036200***************************************************************** 03620000
036300 01  PT-SLS-CHK-TOT-TABLE.                                        03630000
036400     05  PT-SLS-CHK-TOT-ENTRY   OCCURS 8 TIMES.                   03640065
036500         10  PT-TOT-REC-CNT      PIC S9(11) COMP-3    VALUE 0.    03650000
036600         10  PT-TOT-H-REC-CNT    PIC S9(11) COMP-3    VALUE 0.    03660000
036700         10  PT-TOT-S-SALE-AMT   PIC S9(09)V99 COMP-3 VALUE 0.    03670000
036800         10  PT-TOT-S-REFND-AMT  PIC S9(09)V99 COMP-3 VALUE 0.    03680000
036900         10  PT-TOT-S-PAY-AMT    PIC S9(09)V99 COMP-3 VALUE 0.    03690000
037000                                                                  03700000
037100 01  PT-POSTNG-TOT-TABLE.                                         03710000
037200     05  PT-POSTNG-TOT-ENTRY    OCCURS 8 TIMES.                   03720065
037300         10  PT-TRN-REC-CNT      PIC S9(11) COMP-3    VALUE 0.    03730000
037400         10  PT-TOT-P-SALE-AMT   PIC S9(09)V99 COMP-3 VALUE 0.    03740000
037500         10  PT-TOT-P-REFND-AMT  PIC S9(09)V99 COMP-3 VALUE 0.    03750000
037600         10  PT-TOT-P-PYMT-AMT   PIC S9(09)V99 COMP-3 VALUE 0.    03760000
037700*                                                                 03770000
037800*  SQL AND COBOL DECLARATIONS FOR XST_LOC                         03780000
037900*                                                                 03790000
038000                                                                  03800000
038100     EXEC SQL                                                     03810000
038200         INCLUDE XST00001                                         03820000
038300     END-EXEC.                                                    03830000
038400                                                                  03840000
038500*                                                                 03850000
038600*  STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                03860000
038700*                                                                 03870000
038800     EXEC SQL                                                     03880000
038900         INCLUDE SQLCA                                            03890000
039000     END-EXEC.                                                    03900000
039100                                                                  03910000
039200*                                                                 03920000
039300*  CURSOR USED TO RETRIEVE THE STORE NUMBER RANGES.               03930000
039400*                                                                 03940000
039500                                                                  03950000
039600     EXEC SQL                                                     03960000
039700         DECLARE STORE_CURSOR CURSOR FOR                          03970000
039800             SELECT LOC_NBR                                       03980000
039900                 FROM XST_LOC                                     03990000
040000                WHERE ((:PV-DB2-POS-DATE                          04000000
040100                       BETWEEN OPN_DTE AND CLO_DTE) OR            04010000
040200                       (:PV-DB2-POS-DATE >= OPN_DTE AND           04020000
040300                       CLO_DTE IS NULL))                          04030000
040400                  AND LOC_TYP_CDE = 'DS'                          04040000
040500                 ORDER BY LOC_NBR                                 04050000
040600     END-EXEC.                                                    04060000
040700                                                                  04070000
040800******************************************************************04080000
040900 PROCEDURE DIVISION.                                              04090000
041000******************************************************************04100000
041100                                                                  04110000
041200 0000-MAINLINE.                                                   04120000
041300                                                                  04130000
041400     PERFORM 1000-INITIALIZE.                                     04140000
041500                                                                  04150000
041600*  PROCESS SALES RECORD                                           04160006
041700                                                                  04170006
041800     PERFORM 2000-PROCESS-SLS-CHK-TRANS                           04180001
041900       UNTIL PS-END-OF-SALES-FILE.                                04190000
042000                                                                  04200063
042100     IF PA-INPUT-SALES-READ NOT = 0                               04210063
042200       PERFORM 2100-TRAN-TOT-PROCESS                              04220063
042300     END-IF.                                                      04230063
042400                                                                  04240063
042500*  PROCESS POSTING RECORD                                         04250006
042600                                                                  04260006
042700     PERFORM 3000-PROCESS-POSTING-TRANS                           04270001
042800       UNTIL PS-END-OF-TRANS-FILE.                                04280001
042900                                                                  04290000
043000*  WRITE TRAILER RECORD IN EACH SALES CHECK DETAIL FILE AND       04300054
043100*  EACH POSTING FILE                                              04310006
043200                                                                  04320006
043300     PERFORM VARYING PV-FILE-NUMBER FROM 1 BY 1                   04330054
043400             UNTIL PV-FILE-NUMBER > PC-NBR-OF-FILES               04340054
043500       PERFORM 4000-SALES-FILE-TRLR                               04350057
043600       PERFORM 5000-POSTING-FILE-TRLR                             04360057
043700     END-PERFORM.                                                 04370054
043800                                                                  04380006
043900     PERFORM 9000-EOJ-ROUTINE.                                    04390000
044000                                                                  04400000
044100     GOBACK.                                                      04410000
044200******************************************************************04420000
044300*  SET UP FOR PROGRAM PROCESSING BY ACCEPTING, DISPLAYING, AND   *04430000
044400*  VALIDATING THE CONTROL CARD, OPENING ALL FILES, AND READING   *04440000
044500*  THE FIRST ACCOUNTS RECEIVABLE TRANSACTION RECORD.             *04450000
044600******************************************************************04460000
044700                                                                  04470000
044800 1000-INITIALIZE.                                                 04480000
044900                                                                  04490000
045000     ACCEPT CC-CONTROL-CARD.                                      04500054
045100     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - CONTROL CARD = ('       04510054
045200               CC-CONTROL-CARD-DISPLAY  ')'.                      04520054
045300                                                                  04530054
045400     PERFORM 1100-VALIDATE-CONTROL-CARD.                          04540054
045500                                                                  04550054
045600     OPEN INPUT  NEW-SALES-CHECK-DTL-FILE                         04560000
045700                 NEW-POSTING-TRANS-FILE                           04570000
045800          OUTPUT SALES-CHK-DTL-FILE-1                             04580000
045900                 SALES-CHK-DTL-FILE-2                             04590000
046000                 SALES-CHK-DTL-FILE-3                             04600000
046100                 SALES-CHK-DTL-FILE-4                             04610000
046200                 SALES-CHK-DTL-FILE-5                             04620000
046300                 SALES-CHK-DTL-FILE-6                             04630000
046400                 SALES-CHK-DTL-FILE-7                             04640000
046500                 SALES-CHK-DTL-FILE-8                             04650000
046600                 POSTING-TRANS-FILE-1                             04660000
046700                 POSTING-TRANS-FILE-2                             04670000
046800                 POSTING-TRANS-FILE-3                             04680000
046900                 POSTING-TRANS-FILE-4                             04690000
047000                 POSTING-TRANS-FILE-5                             04700000
047100                 POSTING-TRANS-FILE-6                             04710000
047200                 POSTING-TRANS-FILE-7                             04720000
047300                 POSTING-TRANS-FILE-8.                            04730000
047400                                                                  04740000
047500     PERFORM 1200-LOAD-FILE-TABLE.                                04750000
047600                                                                  04760000
047700     PERFORM 7000-READ-SALE-CHECK-FILE.                           04770000
047800                                                                  04780000
047900     PERFORM 7100-READ-POSTING-TRANS-FILE.                        04790000
048000                                                                  04800000
048100******************************************************************04810054
048200*  VALIDATE THE CONTROL CARD.  ENSURE THAT A VALID P.O.S. DATE   *04820054
048300*  HAS BEEN PROVIDED.                                            *04830054
048400******************************************************************04840054
048500                                                                  04850054
048600 1100-VALIDATE-CONTROL-CARD.                                      04860054
048700                                                                  04870054
048800     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              04880054
048900     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     04890054
049000     SET DPG52-LK-DTE-GREG-CC        TO TRUE.                     04900054
049100     MOVE CC-POS-DATE-MDY            TO DPG52-LK-DATE-INPUT.      04910054
049200                                                                  04920054
049300     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    04930054
049400                                             DPG54 DPG55 DPG56.   04940054
049500     IF DPG54-DATE-INVALID                                        04950054
049600        DISPLAY '*** ABEND ***'                                   04960054
049700        DISPLAY '*** PROGRAM = ARKUT110'                          04970054
049800        DISPLAY '*** PARA = 1100-VALIDATE-CONTROL-CARD'           04980054
049900        DISPLAY '*** BAD RESPONSE FROM DATE ROUTINE ***'          04990054
050000        MOVE +4008  TO   ABEND-CODE                               05000054
050100        CALL 'ILBOABN0' USING ABEND-CODE                          05010054
050200     END-IF.                                                      05020054
050300                                                                  05030054
050400******************************************************************05040000
050500*    LOAD THE TABLE OF STORE NUMBER RANGES FOR EACH FILE         *05050000
050600******************************************************************05060000
050700                                                                  05070000
050800 1200-LOAD-FILE-TABLE.                                            05080000
050900                                                                  05090000
051000     MOVE SPACES                     TO PT-FILE-TABLE.            05100000
051100                                                                  05110000
051200     MOVE CC-POS-MONTH               TO PV-DB2-POS-MM.            05120000
051300     MOVE CC-POS-DAY                 TO PV-DB2-POS-DD.            05130000
051400     MOVE CC-POS-YEAR                TO PV-DB2-POS-YY.            05140000
051500     MOVE CC-POS-CENTURY             TO PV-DB2-POS-CC.            05150000
051600     MOVE PV-DB2-FORMAT-DATE         TO PV-DB2-POS-DATE.          05160000
051700                                                                  05170000
051800     EXEC SQL                                                     05180000
051900         SELECT COUNT(*)                                          05190000
052000         INTO :PV-STORE-COUNT                                     05200000
052100         FROM XST_LOC                                             05210000
052200         WHERE ((:PV-DB2-POS-DATE                                 05220000
052300                  BETWEEN OPN_DTE AND CLO_DTE) OR                 05230000
052400                (:PV-DB2-POS-DATE >= OPN_DTE AND                  05240000
052500                  CLO_DTE IS NULL))                               05250000
052600               AND LOC_TYP_CDE = 'DS'                             05260000
052700     END-EXEC.                                                    05270000
052800                                                                  05280000
052900     IF SQLCODE NOT = ZERO                                        05290000
053000        SET PV-STORE-COUNT-ERR       TO TRUE                      05300000
053100        PERFORM 9100-DB2-ERROR                                    05310000
053200     END-IF.                                                      05320000
053300                                                                  05330000
053400     DIVIDE PV-STORE-COUNT BY PC-NBR-OF-FILES                     05340000
053500        GIVING PV-STORES-PER-FILE                                 05350000
053600        REMAINDER PV-REMAINDER                                    05360000
053700     END-DIVIDE.                                                  05370000
053800                                                                  05380000
053900     IF PV-REMAINDER > ZERO                                       05390000
054000        ADD 1 TO PV-STORES-PER-FILE                               05400000
054100     END-IF.                                                      05410000
054200                                                                  05420000
054300     EXEC SQL                                                     05430000
054400        OPEN STORE_CURSOR                                         05440000
054500     END-EXEC.                                                    05450000
054600                                                                  05460000
054700     IF SQLCODE NOT = ZERO                                        05470000
054800        SET PV-OPEN-STORE-CURSOR     TO TRUE                      05480000
054900        PERFORM 9100-DB2-ERROR                                    05490000
055000     END-IF.                                                      05500000
055100                                                                  05510000
055200     PERFORM VARYING PT-FILE-IDX FROM 1 BY 1                      05520000
055300             UNTIL PT-FILE-IDX > PC-NBR-OF-FILES                  05530000
055400                   OR PS-END-OF-STORE-CURSOR                      05540000
055500        PERFORM 1210-FETCH-STORE-CURSOR                           05550000
055600        MOVE XST00001-LOC-NBR TO PT-BEGIN-STORE (PT-FILE-IDX)     05560000
055700        PERFORM VARYING PV-STORE-COUNTER FROM 2 BY 1              05570000
055800                UNTIL PV-STORE-COUNTER > PV-STORES-PER-FILE       05580000
055900                      OR PS-END-OF-STORE-CURSOR                   05590000
056000           PERFORM 1210-FETCH-STORE-CURSOR                        05600000
056100           IF PS-END-OF-STORE-CURSOR                              05610000
056200              CONTINUE                                            05620000
056300           ELSE                                                   05630000
056400              MOVE XST00001-LOC-NBR  TO PT-END-STORE(PT-FILE-IDX) 05640000
056500           END-IF                                                 05650000
056600        END-PERFORM                                               05660000
056700     END-PERFORM.                                                 05670000
056800                                                                  05680000
056900     EXEC SQL                                                     05690000
057000         CLOSE STORE_CURSOR                                       05700000
057100     END-EXEC.                                                    05710000
057200                                                                  05720000
057300     IF SQLCODE NOT = ZERO                                        05730000
057400        SET PV-CLOSE-STORE-CURSOR    TO TRUE                      05740000
057500        PERFORM 9100-DB2-ERROR                                    05750000
057600     END-IF.                                                      05760000
057700                                                                  05770000
057800******************************************************************05780000
057900*  FETCH THE STORE CURSOR.                                       *05790000
058000******************************************************************05800000
058100                                                                  05810000
058200 1210-FETCH-STORE-CURSOR.                                         05820000
058300                                                                  05830000
058400     EXEC SQL                                                     05840000
058500         FETCH STORE_CURSOR                                       05850000
058600             INTO :XST00001-LOC-NBR                               05860000
058700     END-EXEC.                                                    05870000
058800                                                                  05880000
058900     EVALUATE SQLCODE                                             05890000
059000        WHEN ZERO                                                 05900000
059100           CONTINUE                                               05910000
059200        WHEN +100                                                 05920000
059300           SET PS-END-OF-STORE-CURSOR TO TRUE                     05930000
059400        WHEN OTHER                                                05940000
059500           SET PV-FETCH-STORE-ROW    TO TRUE                      05950000
059600           PERFORM 9100-DB2-ERROR                                 05960000
059700     END-EVALUATE.                                                05970000
059800                                                                  05980000
059900                                                                  05990000
060000******************************************************************06000000
060100*  PROCESS SALES TRANSACTION INPUT RECORDS.                      *06010000
060200******************************************************************06020000
060300                                                                  06030000
060400 2000-PROCESS-SLS-CHK-TRANS.                                      06040054
060500                                                                  06050000
060600     EVALUATE TRUE                                                06060054
060700       WHEN AR025-H-RECORD-ID-HEADER                              06070054
060800         IF PA-INPUT-SALES-READ > 1                               06080054
060900            PERFORM 2100-TRAN-TOT-PROCESS                         06090062
061000         END-IF                                                   06100054
061100         SET PT-FILE-IDX TO 1                                     06110000
061200         SEARCH PT-FILE-ENTRY VARYING PT-FILE-IDX                 06120000
061300          AT END                                                  06130000
061400            MOVE PC-NBR-OF-FILES     TO PV-FILE-NUMBER            06140000
061500          WHEN (AR025-H-MERCHANT-ID >= PT-BEGIN-STORE(PT-FILE-IDX)06150000
061600           AND AR025-H-MERCHANT-ID <= PT-END-STORE(PT-FILE-IDX))  06160000
061700            SET PV-FILE-NUMBER       TO PT-FILE-IDX               06170000
061800         END-SEARCH                                               06180000
061900         MOVE ZERO TO PV-AMT-COMP                                 06190054
062000         ADD +1    TO PT-TOT-H-REC-CNT(PV-FILE-NUMBER)            06200054
062100       WHEN AR025-M-RECORD-ID-MDSE                                06210000
062200         MOVE AR025-M-EXT-DOLLAR-AMT TO PV-AMT-COMP               06220000
062300         IF AR025-M-CREDIT                                        06230000
062400            COMPUTE PV-AMT-COMP = PV-AMT-COMP * -1                06240000
062500         END-IF                                                   06250000
062600       WHEN AR025-O-RECORD-ID-OTHER                               06260000
062700         MOVE AR025-O-EXT-DOLLAR-AMT TO PV-AMT-COMP               06270000
062800         IF AR025-O-CREDIT                                        06280000
062900            COMPUTE PV-AMT-COMP = PV-AMT-COMP * -1                06290000
063000         END-IF                                                   06300000
063100       WHEN AR025-T-RECORD-ID-TENDER                              06310000
063200         MOVE AR025-T-EXT-DOLLAR-AMT TO PV-AMT-COMP               06320000
063300         IF AR025-T-CREDIT                                        06330000
063400            COMPUTE PV-AMT-COMP = PV-AMT-COMP * -1                06340000
063500         END-IF                                                   06350000
063600     END-EVALUATE.                                                06360000
063700                                                                  06370000
063800     ADD PV-AMT-COMP                 TO PV-TRAN-TOT.              06380054
063900     PERFORM 7200-WRITE-SLS-CHK-TRANS.                            06390000
064000     PERFORM 7000-READ-SALE-CHECK-FILE.                           06400000
064100                                                                  06410000
064200******************************************************************06420001
064300*  CALCULATES TOTAL AMOUNT FOR EACH TRANSACTION.                 *06430001
064400******************************************************************06440001
064500                                                                  06450001
064600 2100-TRAN-TOT-PROCESS.                                           06460054
064700                                                                  06470054
064800     IF PV-TRAN-TOT > 0                                           06480054
064900        COMPUTE PT-TOT-S-SALE-AMT(PV-FILE-NUMBER) =               06490054
065000                PT-TOT-S-SALE-AMT(PV-FILE-NUMBER) + PV-TRAN-TOT   06500054
065100     ELSE                                                         06510054
065200        COMPUTE PT-TOT-S-REFND-AMT(PV-FILE-NUMBER) =              06520054
065300                PT-TOT-S-REFND-AMT(PV-FILE-NUMBER)+ PV-TRAN-TOT   06530054
065400     END-IF                                                       06540054
065500     MOVE ZERO                       TO  PV-TRAN-TOT.             06550054
065600                                                                  06560054
065700******************************************************************06570001
065800*  PROCESS POSTING TRANSACTION INPUT RECORD.                     *06580001
065900******************************************************************06590001
066000                                                                  06600001
066100 3000-PROCESS-POSTING-TRANS.                                      06610001
066200                                                                  06620001
066300     SET PT-FILE-IDX TO 1.                                        06630001
066400     SEARCH PT-FILE-ENTRY VARYING PT-FILE-IDX                     06640001
066500      AT END                                                      06650001
066600        MOVE PC-NBR-OF-FILES         TO PV-FILE-NUMBER            06660002
066700      WHEN (AR026-MERCHANT-ID >= PT-BEGIN-STORE (PT-FILE-IDX)     06670057
066800       AND AR026-MERCHANT-ID <= PT-END-STORE (PT-FILE-IDX))       06680057
066900        SET PV-FILE-NUMBER           TO PT-FILE-IDX               06690001
067000     END-SEARCH.                                                  06700001
067100                                                                  06710002
067200     PERFORM 7300-WRITE-POSTING-TRANS                             06720002
067300     PERFORM 3100-TOTAL-TRANS-PROCESS                             06730002
067400                                                                  06740001
067500     PERFORM 7100-READ-POSTING-TRANS-FILE.                        06750002
067600                                                                  06760001
067700******************************************************************06770001
067800*  CALCULATES TOTAL AMOUNT FOR DIFFERENT TRAN TYPE               *06780001
067900******************************************************************06790001
068000                                                                  06800001
068100 3100-TOTAL-TRANS-PROCESS.                                        06810054
068200                                                                  06820054
068300     MOVE AR026-AMOUNT     TO PV-AMT-COMP.                        06830064
           IF AR026-EMP-DISC-SRC-CDE NOT = 'P'                          06831077
068400      EVALUATE TRUE                                               06840075
068500       WHEN AR026-TRANS-TYPE = AR004-TRANS-DEBIT-ADJ-CD           06850002
068600       WHEN AR026-TRANS-TYPE = AR004-TRANS-LATE-VOID-CD           06860002
068700       WHEN AR026-TRANS-TYPE = AR004-TRANS-EMPL-DISC-RET-CD       06870002
068800         COMPUTE PT-TOT-P-SALE-AMT(PV-FILE-NUMBER) =              06880002
068900                 PT-TOT-P-SALE-AMT(PV-FILE-NUMBER) + PV-AMT-COMP  06890002
069000       WHEN AR026-TRANS-TYPE = AR004-TRANS-SA-PAY-CR-ADJ-CD       06900002
069100       WHEN AR026-TRANS-TYPE = AR004-TRANS-EMPL-DISC-SLS-CD       06910002
069200         COMPUTE PT-TOT-P-REFND-AMT(PV-FILE-NUMBER) =             06920002
069300                 PT-TOT-P-REFND-AMT(PV-FILE-NUMBER) + PV-AMT-COMP 06930002
069400       WHEN AR026-TRANS-TYPE = AR004-TRANS-STORE-PAYMENT-CD       06940002
069500         COMPUTE PT-TOT-P-PYMT-AMT(PV-FILE-NUMBER) =              06950002
069600                 PT-TOT-P-PYMT-AMT(PV-FILE-NUMBER) + PV-AMT-COMP  06960002
069700      END-EVALUATE                                                06970075
           ELSE                                                         06971075
068400      EVALUATE TRUE                                               06972075
068500       WHEN AR026-TRANS-TYPE = AR004-TRANS-DEBIT-ADJ-CD           06973075
068600       WHEN AR026-TRANS-TYPE = AR004-TRANS-LATE-VOID-CD           06974075
068800         COMPUTE PT-TOT-P-SALE-AMT(PV-FILE-NUMBER) =              06974175
068900                 PT-TOT-P-SALE-AMT(PV-FILE-NUMBER) + PV-AMT-COMP  06974275
068700       WHEN AR026-TRANS-TYPE = AR004-TRANS-EMPL-DISC-RET-CD       06975075
068800         COMPUTE PT-TOT-P-REFND-AMT(PV-FILE-NUMBER) =             06976075
068900                 PT-TOT-P-REFND-AMT(PV-FILE-NUMBER) - PV-AMT-COMP 06977075
069000       WHEN AR026-TRANS-TYPE = AR004-TRANS-SA-PAY-CR-ADJ-CD       06978075
069200         COMPUTE PT-TOT-P-REFND-AMT(PV-FILE-NUMBER) =             06978175
069300                 PT-TOT-P-REFND-AMT(PV-FILE-NUMBER) + PV-AMT-COMP 06978275
069100       WHEN AR026-TRANS-TYPE = AR004-TRANS-EMPL-DISC-SLS-CD       06979075
069200         COMPUTE PT-TOT-P-SALE-AMT(PV-FILE-NUMBER) =              06979175
069300                 PT-TOT-P-SALE-AMT(PV-FILE-NUMBER) - PV-AMT-COMP  06979275
069400       WHEN AR026-TRANS-TYPE = AR004-TRANS-STORE-PAYMENT-CD       06979375
069500         COMPUTE PT-TOT-P-PYMT-AMT(PV-FILE-NUMBER) =              06979475
069600                 PT-TOT-P-PYMT-AMT(PV-FILE-NUMBER) + PV-AMT-COMP  06979575
069700      END-EVALUATE                                                06979675
           END-IF.                                                      06979775
069800                                                                  06980054
069900******************************************************************06990065
070000*  WRITE TRAILER RECORD INTO SALES CHECK DETAIL CHUNK FILES       07000065
070100*  TOTAL PAYMENT AMOUNT IN TRAILER RECORD WILL ALWAYS BE ZERO     07010065
070200*  SINCE THERE WILL NOT BE ANY PAYMENT RECORD IN SALES CHECK FILE 07020065
070300******************************************************************07030065
070400 4000-SALES-FILE-TRLR.                                            07040065
070500                                                                  07050065
070600     INITIALIZE AR025-AR-SALES-CHECK-RECORD.                      07060065
070700                                                                  07070065
070800     IF PT-TOT-S-REFND-AMT(PV-FILE-NUMBER) < 0                    07080074
070900        COMPUTE PT-TOT-S-REFND-AMT(PV-FILE-NUMBER) =              07090074
071000                       PT-TOT-S-REFND-AMT(PV-FILE-NUMBER) * -1    07100074
071100     END-IF                                                       07110074
071200                                                                  07120074
071300     SET AR025-TRAILER               TO TRUE.                     07130065
071400     MOVE PT-TOT-H-REC-CNT(PV-FILE-NUMBER) TO AR025-TOT-H-REC-CNT.07140065
071500     MOVE PT-TOT-S-SALE-AMT(PV-FILE-NUMBER) TO                    07150065
071600                                              AR025-TOT-SALE-AMT. 07160065
071700     MOVE PT-TOT-S-REFND-AMT(PV-FILE-NUMBER) TO                   07170065
071800                                              AR025-TOT-REFND-AMT.07180065
071900     MOVE ZERO                       TO AR025-TOT-PYMT-AMT.       07190065
072000                                                                  07200065
072100     PERFORM  7200-WRITE-SLS-CHK-TRANS.                           07210065
072200                                                                  07220065
072300******************************************************************07230065
072400*  WRITE TRAILER RECORD INTO EACH POSTING FILE                    07240065
072500******************************************************************07250065
072600 5000-POSTING-FILE-TRLR.                                          07260065
072700                                                                  07270065
072800     INITIALIZE AR026-AR-POSTING-RECORD.                          07280065
072900                                                                  07290065
073000     SET AR026-TRAILER               TO TRUE.                     07300065
073100     MOVE PT-TRN-REC-CNT(PV-FILE-NUMBER) TO AR026-TOT-TRN-CNT.    07310065
073200     MOVE PT-TOT-P-SALE-AMT(PV-FILE-NUMBER) TO AR026-TOT-SALE-AMT.07320065
073300     MOVE PT-TOT-P-REFND-AMT(PV-FILE-NUMBER) TO                   07330065
073400                                              AR026-TOT-REFND-AMT.07340065
073500     MOVE PT-TOT-P-PYMT-AMT(PV-FILE-NUMBER) TO AR026-TOT-PYMT-AMT.07350065
073600                                                                  07360065
073700     PERFORM 7300-WRITE-POSTING-TRANS.                            07370065
073800                                                                  07380065
073900******************************************************************07390000
074000*  READ INPUT NEW SALES CHECK FILE.                              *07400000
074100******************************************************************07410000
074200                                                                  07420000
074300 7000-READ-SALE-CHECK-FILE.                                       07430006
074400                                                                  07440006
074500     READ NEW-SALES-CHECK-DTL-FILE                                07450000
074600        INTO AR025-AR-SALES-CHECK-RECORD                          07460000
074700        AT END                                                    07470000
074800           SET PS-END-OF-SALES-FILE  TO TRUE                      07480000
074900        NOT AT END                                                07490054
075000           ADD +1 TO PA-INPUT-SALES-READ                          07500054
075100     END-READ.                                                    07510000
075200                                                                  07520006
075300******************************************************************07530000
075400*  READ INPUT NEW POSTING TRANS FILE.                            *07540000
075500******************************************************************07550000
075600                                                                  07560000
075700 7100-READ-POSTING-TRANS-FILE.                                    07570006
075800                                                                  07580006
075900     READ NEW-POSTING-TRANS-FILE                                  07590000
076000        INTO AR026-AR-POSTING-RECORD                              07600000
076100        AT END                                                    07610000
076200           SET PS-END-OF-TRANS-FILE  TO TRUE                      07620000
076300        NOT AT END                                                07630054
076400           ADD +1 TO PA-INPUT-POSTING-READ                        07640054
076500     END-READ.                                                    07650000
076600                                                                  07660000
076700******************************************************************07670000
076800*  WRITE INTO SALES CHECK DETAIL CHUNK FILES                     *07680000
076900******************************************************************07690000
077000                                                                  07700000
077100 7200-WRITE-SLS-CHK-TRANS.                                        07710000
077200                                                                  07720000
077300     EVALUATE TRUE                                                07730000
077400        WHEN PV-FILE-NUMBER = 1                                   07740000
077500           WRITE SALES-CHK-DTL-RCD-1                              07750000
077600                                FROM AR025-AR-SALES-CHECK-RECORD  07760000
077700        WHEN PV-FILE-NUMBER = 2                                   07770000
077800           WRITE SALES-CHK-DTL-RCD-2                              07780000
077900                                FROM AR025-AR-SALES-CHECK-RECORD  07790000
078000        WHEN PV-FILE-NUMBER = 3                                   07800000
078100           WRITE SALES-CHK-DTL-RCD-3                              07810000
078200                                 FROM AR025-AR-SALES-CHECK-RECORD 07820000
078300        WHEN PV-FILE-NUMBER = 4                                   07830000
078400           WRITE SALES-CHK-DTL-RCD-4                              07840000
078500                                 FROM AR025-AR-SALES-CHECK-RECORD 07850000
078600        WHEN PV-FILE-NUMBER = 5                                   07860000
078700           WRITE SALES-CHK-DTL-RCD-5                              07870000
078800                                 FROM AR025-AR-SALES-CHECK-RECORD 07880000
078900        WHEN PV-FILE-NUMBER = 6                                   07890000
079000           WRITE SALES-CHK-DTL-RCD-6                              07900000
079100                                 FROM AR025-AR-SALES-CHECK-RECORD 07910000
079200        WHEN PV-FILE-NUMBER = 7                                   07920000
079300           WRITE SALES-CHK-DTL-RCD-7                              07930000
079400                                 FROM AR025-AR-SALES-CHECK-RECORD 07940000
079500        WHEN PV-FILE-NUMBER = 8                                   07950000
079600           WRITE SALES-CHK-DTL-RCD-8                              07960000
079700                                 FROM AR025-AR-SALES-CHECK-RECORD 07970000
079800     END-EVALUATE.                                                07980000
079900                                                                  07990054
080000     ADD +1          TO PT-TOT-REC-CNT(PV-FILE-NUMBER).           08000054
080100                                                                  08010000
080200******************************************************************08020000
080300*  WRITE PAYMENT AND EMPLOYEE DISCOUNT RECORDS INTO 8 CHUNK      *08030000
080400*  POSTING FILES                                                 *08040054
080500******************************************************************08050000
080600                                                                  08060000
080700 7300-WRITE-POSTING-TRANS.                                        08070000
080800                                                                  08080000
080900     EVALUATE TRUE                                                08090000
081000        WHEN PV-FILE-NUMBER = 1                                   08100002
081100           WRITE POSTING-TRANS-RECORD-1                           08110002
081200                                 FROM AR026-AR-POSTING-RECORD     08120002
081300        WHEN PV-FILE-NUMBER = 2                                   08130002
081400           WRITE POSTING-TRANS-RECORD-2                           08140000
081500                                 FROM AR026-AR-POSTING-RECORD     08150000
081600        WHEN PV-FILE-NUMBER = 3                                   08160002
081700           WRITE POSTING-TRANS-RECORD-3                           08170000
081800                                 FROM AR026-AR-POSTING-RECORD     08180000
081900        WHEN PV-FILE-NUMBER = 4                                   08190002
082000           WRITE POSTING-TRANS-RECORD-4                           08200000
082100                                 FROM AR026-AR-POSTING-RECORD     08210000
082200        WHEN PV-FILE-NUMBER = 5                                   08220002
082300           WRITE POSTING-TRANS-RECORD-5                           08230000
082400                                 FROM AR026-AR-POSTING-RECORD     08240000
082500        WHEN PV-FILE-NUMBER = 6                                   08250002
082600           WRITE POSTING-TRANS-RECORD-6                           08260000
082700                                 FROM AR026-AR-POSTING-RECORD     08270000
082800        WHEN PV-FILE-NUMBER = 7                                   08280002
082900           WRITE POSTING-TRANS-RECORD-7                           08290000
083000                                 FROM AR026-AR-POSTING-RECORD     08300000
083100        WHEN PV-FILE-NUMBER = 8                                   08310002
083200           WRITE POSTING-TRANS-RECORD-8                           08320000
083300                                 FROM AR026-AR-POSTING-RECORD     08330000
083400     END-EVALUATE.                                                08340000
083500                                                                  08350054
083600     ADD +1 TO PT-TRN-REC-CNT(PV-FILE-NUMBER).                    08360002
083700                                                                  08370000
083800******************************************************************08380054
083900*  PROCESS LAST POSTING IF THE LAST TRANSACTION HAD MERCHANDISE. *08390054
084000*  CLOSE ALL FILES.                                              *08400054
084100******************************************************************08410054
084200                                                                  08420054
084300 9000-EOJ-ROUTINE.                                                08430054
084400                                                                  08440054
084500     DISPLAY '*********************************************'.     08450054
084600     DISPLAY 'INPUT SALES RECORDS READ ' PA-INPUT-SALES-READ.     08460067
084700     DISPLAY 'INPUT POSTING RECORDS READ ' PA-INPUT-POSTING-READ. 08470054
084800     MOVE    PT-TOT-S-SALE-AMT(1)      TO PV-TOT-SALE-AMT-DISP.   08480066
084900     MOVE    PT-TOT-S-REFND-AMT(1)     TO PV-TOT-RFND-AMT-DISP.   08490066
085000     DISPLAY 'SALES CHECK FILE 1 :'.                              08500065
085100     DISPLAY 'TOTAL RECORD COUNT   ' PT-TOT-REC-CNT(1).           08510065
085200     DISPLAY 'H RECORD COUNT       ' PT-TOT-H-REC-CNT(1).         08520065
085300     DISPLAY 'SALE DOLLAR AMOUNT   ' PV-TOT-SALE-AMT-DISP.        08530066
085400     DISPLAY 'REFUND DOLLAR AMOUNT ' PV-TOT-RFND-AMT-DISP.        08540073
085500     MOVE    PT-TOT-S-SALE-AMT(2)      TO PV-TOT-SALE-AMT-DISP.   08550066
085600     MOVE    PT-TOT-S-REFND-AMT(2)     TO PV-TOT-RFND-AMT-DISP.   08560066
085700     DISPLAY 'SALES CHECK FILE 2 :'.                              08570065
085800     DISPLAY 'TOTAL RECORD COUNT   ' PT-TOT-REC-CNT(2).           08580065
085900     DISPLAY 'H RECORD COUNT       ' PT-TOT-H-REC-CNT(2).         08590065
086000     DISPLAY 'SALE DOLLAR AMOUNT   ' PV-TOT-SALE-AMT-DISP.        08600066
086100     DISPLAY 'REFUND DOLLAR AMOUNT ' PV-TOT-RFND-AMT-DISP.        08610073
086200     MOVE    PT-TOT-S-SALE-AMT(3)      TO PV-TOT-SALE-AMT-DISP.   08620066
086300     MOVE    PT-TOT-S-REFND-AMT(3)     TO PV-TOT-RFND-AMT-DISP.   08630066
086400     DISPLAY 'SALES CHECK FILE 3 :'.                              08640065
086500     DISPLAY 'TOTAL RECORD COUNT   ' PT-TOT-REC-CNT(3).           08650065
086600     DISPLAY 'H RECORD COUNT       ' PT-TOT-H-REC-CNT(3).         08660065
086700     DISPLAY 'SALE DOLLAR AMOUNT   ' PV-TOT-SALE-AMT-DISP.        08670066
086800     DISPLAY 'REFUND DOLLAR AMOUNT ' PV-TOT-RFND-AMT-DISP.        08680073
086900     MOVE    PT-TOT-S-SALE-AMT(4)      TO PV-TOT-SALE-AMT-DISP.   08690066
087000     MOVE    PT-TOT-S-REFND-AMT(4)     TO PV-TOT-RFND-AMT-DISP.   08700066
087100     DISPLAY 'SALES CHECK FILE 4 :'.                              08710065
087200     DISPLAY 'TOTAL RECORD COUNT   ' PT-TOT-REC-CNT(4).           08720065
087300     DISPLAY 'H RECORD COUNT       ' PT-TOT-H-REC-CNT(4).         08730065
087400     DISPLAY 'SALE DOLLAR AMOUNT   ' PV-TOT-SALE-AMT-DISP.        08740066
087500     DISPLAY 'REFUND DOLLAR AMOUNT ' PV-TOT-RFND-AMT-DISP.        08750073
087600     MOVE    PT-TOT-S-SALE-AMT(5)      TO PV-TOT-SALE-AMT-DISP.   08760066
087700     MOVE    PT-TOT-S-REFND-AMT(5)     TO PV-TOT-RFND-AMT-DISP.   08770066
087800     DISPLAY 'SALES CHECK FILE 5 :'.                              08780065
087900     DISPLAY 'TOTAL RECORD COUNT   ' PT-TOT-REC-CNT(5).           08790065
088000     DISPLAY 'H RECORD COUNT       ' PT-TOT-H-REC-CNT(5).         08800065
088100     DISPLAY 'SALE DOLLAR AMOUNT   ' PV-TOT-SALE-AMT-DISP.        08810066
088200     DISPLAY 'REFUND DOLLAR AMOUNT ' PV-TOT-RFND-AMT-DISP.        08820073
088300     MOVE    PT-TOT-S-SALE-AMT(6)      TO PV-TOT-SALE-AMT-DISP.   08830066
088400     MOVE    PT-TOT-S-REFND-AMT(6)     TO PV-TOT-RFND-AMT-DISP.   08840066
088500     DISPLAY 'SALES CHECK FILE 6 :'.                              08850065
088600     DISPLAY 'TOTAL RECORD COUNT   ' PT-TOT-REC-CNT(6).           08860065
088700     DISPLAY 'H RECORD COUNT       ' PT-TOT-H-REC-CNT(6).         08870065
088800     DISPLAY 'SALE DOLLAR AMOUNT   ' PV-TOT-SALE-AMT-DISP.        08880066
088900     DISPLAY 'REFUND DOLLAR AMOUNT ' PV-TOT-RFND-AMT-DISP.        08890073
089000     MOVE    PT-TOT-S-SALE-AMT(7)      TO PV-TOT-SALE-AMT-DISP.   08900066
089100     MOVE    PT-TOT-S-REFND-AMT(7)     TO PV-TOT-RFND-AMT-DISP.   08910066
089200     DISPLAY 'SALES CHECK FILE 7 :'.                              08920065
089300     DISPLAY 'TOTAL RECORD COUNT   ' PT-TOT-REC-CNT(7).           08930065
089400     DISPLAY 'H RECORD COUNT       ' PT-TOT-H-REC-CNT(7).         08940065
089500     DISPLAY 'SALE DOLLAR AMOUNT   ' PV-TOT-SALE-AMT-DISP.        08950066
089600     DISPLAY 'REFUND DOLLAR AMOUNT ' PV-TOT-RFND-AMT-DISP.        08960073
089700     MOVE    PT-TOT-S-SALE-AMT(8)      TO PV-TOT-SALE-AMT-DISP.   08970066
089800     MOVE    PT-TOT-S-REFND-AMT(8)     TO PV-TOT-RFND-AMT-DISP.   08980066
089900     DISPLAY 'SALES CHECK FILE 8 :'.                              08990065
090000     DISPLAY 'TOTAL RECORD COUNT   ' PT-TOT-REC-CNT(8).           09000065
090100     DISPLAY 'H RECORD COUNT       ' PT-TOT-H-REC-CNT(8).         09010065
090200     DISPLAY 'SALE DOLLAR AMOUNT   ' PV-TOT-SALE-AMT-DISP.        09020066
090300     DISPLAY 'REFUND DOLLAR AMOUNT ' PV-TOT-RFND-AMT-DISP.        09030073
090400     MOVE    PT-TOT-P-SALE-AMT(1)      TO PV-TOT-SALE-AMT-DISP.   09040066
090500     MOVE    PT-TOT-P-REFND-AMT(1)     TO PV-TOT-RFND-AMT-DISP.   09050066
090600     MOVE    PT-TOT-P-PYMT-AMT(1)      TO PV-TOT-PYMT-AMT-DISP.   09060066
090700     DISPLAY 'POSTING TRANS FILE 1 :'.                            09070065
090800     DISPLAY 'TOTAL RECORD COUNT    ' PT-TRN-REC-CNT(1).          09080065
090900     DISPLAY 'SALE DOLLAR AMOUNT    ' PV-TOT-SALE-AMT-DISP.       09090066
091000     DISPLAY 'REFUND DOLLAR AMOUNT  ' PV-TOT-RFND-AMT-DISP.       09100072
091100     DISPLAY 'PAYMENT DOLLAR AMOUNT ' PV-TOT-PYMT-AMT-DISP.       09110066
091200     MOVE    PT-TOT-P-SALE-AMT(2)      TO PV-TOT-SALE-AMT-DISP.   09120066
091300     MOVE    PT-TOT-P-REFND-AMT(2)     TO PV-TOT-RFND-AMT-DISP.   09130066
091400     MOVE    PT-TOT-P-PYMT-AMT(2)      TO PV-TOT-PYMT-AMT-DISP.   09140066
091500     DISPLAY 'POSTING TRANS FILE 2 :'.                            09150065
091600     DISPLAY 'TOTAL RECORD COUNT    ' PT-TRN-REC-CNT(2).          09160065
091700     DISPLAY 'SALE DOLLAR AMOUNT    ' PV-TOT-SALE-AMT-DISP.       09170066
091800     DISPLAY 'REFUND DOLLAR AMOUNT  ' PV-TOT-RFND-AMT-DISP.       09180072
091900     DISPLAY 'PAYMENT DOLLAR AMOUNT ' PV-TOT-PYMT-AMT-DISP.       09190066
092000     MOVE    PT-TOT-P-SALE-AMT(3)      TO PV-TOT-SALE-AMT-DISP.   09200066
092100     MOVE    PT-TOT-P-REFND-AMT(3)     TO PV-TOT-RFND-AMT-DISP.   09210066
092200     MOVE    PT-TOT-P-PYMT-AMT(3)      TO PV-TOT-PYMT-AMT-DISP.   09220066
092300     DISPLAY 'POSTING TRANS FILE 3 :'.                            09230065
092400     DISPLAY 'TOTAL RECORD COUNT    ' PT-TRN-REC-CNT(3).          09240065
092500     DISPLAY 'SALE DOLLAR AMOUNT    ' PV-TOT-SALE-AMT-DISP.       09250066
092600     DISPLAY 'REFUND DOLLAR AMOUNT  ' PV-TOT-RFND-AMT-DISP.       09260072
092700     DISPLAY 'PAYMENT DOLLAR AMOUNT ' PV-TOT-PYMT-AMT-DISP.       09270066
092800     MOVE    PT-TOT-P-SALE-AMT(4)      TO PV-TOT-SALE-AMT-DISP.   09280066
092900     MOVE    PT-TOT-P-REFND-AMT(4)     TO PV-TOT-RFND-AMT-DISP.   09290066
093000     MOVE    PT-TOT-P-PYMT-AMT(4)      TO PV-TOT-PYMT-AMT-DISP.   09300066
093100     DISPLAY 'POSTING TRANS FILE 4 :'.                            09310065
093200     DISPLAY 'TOTAL RECORD COUNT    ' PT-TRN-REC-CNT(4).          09320065
093300     DISPLAY 'SALE DOLLAR AMOUNT    ' PV-TOT-SALE-AMT-DISP.       09330066
093400     DISPLAY 'REFUND DOLLAR AMOUNT  ' PV-TOT-RFND-AMT-DISP.       09340072
093500     DISPLAY 'PAYMENT DOLLAR AMOUNT ' PV-TOT-PYMT-AMT-DISP.       09350066
093600     MOVE    PT-TOT-P-SALE-AMT(5)      TO PV-TOT-SALE-AMT-DISP.   09360066
093700     MOVE    PT-TOT-P-REFND-AMT(5)     TO PV-TOT-RFND-AMT-DISP.   09370066
093800     MOVE    PT-TOT-P-PYMT-AMT(5)      TO PV-TOT-PYMT-AMT-DISP.   09380066
093900     DISPLAY 'POSTING TRANS FILE 5 :'.                            09390065
094000     DISPLAY 'TOTAL RECORD COUNT    ' PT-TRN-REC-CNT(5).          09400065
094100     DISPLAY 'SALE DOLLAR AMOUNT    ' PV-TOT-SALE-AMT-DISP.       09410066
094200     DISPLAY 'REFUND DOLLAR AMOUNT  ' PV-TOT-RFND-AMT-DISP.       09420072
094300     DISPLAY 'PAYMENT DOLLAR AMOUNT ' PV-TOT-PYMT-AMT-DISP.       09430066
094400     MOVE    PT-TOT-P-SALE-AMT(6)      TO PV-TOT-SALE-AMT-DISP.   09440066
094500     MOVE    PT-TOT-P-REFND-AMT(6)     TO PV-TOT-RFND-AMT-DISP.   09450066
094600     MOVE    PT-TOT-P-PYMT-AMT(6)      TO PV-TOT-PYMT-AMT-DISP.   09460066
094700     DISPLAY 'POSTING TRANS FILE 6 :'.                            09470065
094800     DISPLAY 'TOTAL RECORD COUNT    ' PT-TRN-REC-CNT(6).          09480065
094900     DISPLAY 'SALE DOLLAR AMOUNT    ' PV-TOT-SALE-AMT-DISP.       09490066
095000     DISPLAY 'REFUND DOLLAR AMOUNT  ' PV-TOT-RFND-AMT-DISP.       09500072
095100     DISPLAY 'PAYMENT DOLLAR AMOUNT ' PV-TOT-PYMT-AMT-DISP.       09510066
095200     MOVE    PT-TOT-P-SALE-AMT(7)      TO PV-TOT-SALE-AMT-DISP.   09520066
095300     MOVE    PT-TOT-P-REFND-AMT(7)     TO PV-TOT-RFND-AMT-DISP.   09530066
095400     MOVE    PT-TOT-P-PYMT-AMT(7)      TO PV-TOT-PYMT-AMT-DISP.   09540066
095500     DISPLAY 'POSTING TRANS FILE 7 :'.                            09550065
095600     DISPLAY 'TOTAL RECORD COUNT    ' PT-TRN-REC-CNT(7).          09560065
095700     DISPLAY 'SALE DOLLAR AMOUNT    ' PV-TOT-SALE-AMT-DISP.       09570066
095800     DISPLAY 'REFUND DOLLAR AMOUNT  ' PV-TOT-RFND-AMT-DISP.       09580072
095900     DISPLAY 'PAYMENT DOLLAR AMOUNT ' PV-TOT-PYMT-AMT-DISP.       09590066
096000     MOVE    PT-TOT-P-SALE-AMT(8)      TO PV-TOT-SALE-AMT-DISP.   09600066
096100     MOVE    PT-TOT-P-REFND-AMT(8)     TO PV-TOT-RFND-AMT-DISP.   09610066
096200     MOVE    PT-TOT-P-PYMT-AMT(8)      TO PV-TOT-PYMT-AMT-DISP.   09620066
096300     DISPLAY 'POSTING TRANS FILE 8 :'.                            09630065
096400     DISPLAY 'TOTAL RECORD COUNT    ' PT-TRN-REC-CNT(8).          09640065
096500     DISPLAY 'SALE DOLLAR AMOUNT    ' PV-TOT-SALE-AMT-DISP.       09650066
096600     DISPLAY 'REFUND DOLLAR AMOUNT  ' PV-TOT-RFND-AMT-DISP.       09660072
096700     DISPLAY 'PAYMENT DOLLAR AMOUNT ' PV-TOT-PYMT-AMT-DISP.       09670066
096800     DISPLAY '*********************************************'.     09680054
096900                                                                  09690054
097000     CLOSE NEW-SALES-CHECK-DTL-FILE                               09700054
097100           NEW-POSTING-TRANS-FILE                                 09710054
097200           SALES-CHK-DTL-FILE-1                                   09720054
097300           SALES-CHK-DTL-FILE-2                                   09730054
097400           SALES-CHK-DTL-FILE-3                                   09740054
097500           SALES-CHK-DTL-FILE-4                                   09750054
097600           SALES-CHK-DTL-FILE-5                                   09760054
097700           SALES-CHK-DTL-FILE-6                                   09770054
097800           SALES-CHK-DTL-FILE-7                                   09780054
097900           SALES-CHK-DTL-FILE-8                                   09790054
098000           POSTING-TRANS-FILE-1                                   09800054
098100           POSTING-TRANS-FILE-2                                   09810054
098200           POSTING-TRANS-FILE-3                                   09820054
098300           POSTING-TRANS-FILE-4                                   09830054
098400           POSTING-TRANS-FILE-5                                   09840054
098500           POSTING-TRANS-FILE-6                                   09850054
098600           POSTING-TRANS-FILE-7                                   09860054
098700           POSTING-TRANS-FILE-8.                                  09870054
098800                                                                  09880054
098900******************************************************************09890000
099000*  FORMAT A DB2 ERROR MESSAGE, AND ABEND THE PROGRAM.            *09900000
099100******************************************************************09910000
099200                                                                  09920000
099300 9100-DB2-ERROR.                                                  09930000
099400     DISPLAY '** ABEND **'.                                       09940000
099500     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - SQL ERROR'.             09950000
099600     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - ATTEMPTING TO '         09960000
099700               PV-LAST-DB2-ACTION.                                09970000
099800                                                                  09980000
099900*                                                                 09990000
100000*  ROUTINE TO CONVERT THE SQLCA INTO A READABLE FORMAT, USING     10000000
100100*  THE CALLED MODULE DSNTIAR.                                     10010000
100200*                                                                 10020000
100300                                                                  10030000
100400     COPY DPPD004.                                                10040000
100500                                                                  10050000
100600     SET AC-DB2-ERROR TO TRUE.                                    10060000
100700     CALL 'ILBOABN0' USING ABEND-CODE.                            10070000
100800                                                                  10080000
