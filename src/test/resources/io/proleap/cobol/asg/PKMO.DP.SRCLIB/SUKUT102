000100***************************************************************** 00010011
000200 IDENTIFICATION DIVISION.                                         00020012
000300 PROGRAM-ID.             SUKUT102.                                00030012
000400 AUTHOR.                 PAUL JORGENSEN.                          00040026
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050012
000600 DATE-WRITTEN            OCTOBER, 2008.                           00060026
000700 DATE-COMPILED.                                                   00070012
000800***************************************************************** 00080012
000900*  THIS PROGRAM WILL USE A UNLOAD FILE CONTAINING TRIP ID'S     * 00090027
001000*  FROM TSUOBTS AND CHECK TO SEE IF ANY CARTONS REMAIN ON SUT_  * 00100012
001100*  OTBND_CART, SUT_OTBND_LOC, OR PCT_TRN_CLSN_DTL. IF THERE ARE * 00110012
001200*  CARTONS, THE TRIP WILL NOT BE DELETED.  AN EXTRACT FILE WILL * 00120012
001300*  BE CREATED WHICH WILL BE USED IN THE NEXT STEP OF SUK135.    * 00130012
001400***************************************************************** 00140012
001500 ENVIRONMENT DIVISION.                                            00150012
001600 CONFIGURATION SECTION.                                           00160012
001700                                                                  00170012
001800 SOURCE-COMPUTER.        IBM-3090.                                00180012
001900 OBJECT-COMPUTER.        IBM-3090.                                00190012
002000                                                                  00200012
002100 INPUT-OUTPUT SECTION.                                            00210012
002200 FILE-CONTROL.                                                    00220012
002300*                                                                 00230012
002400     SELECT SU-INPUT-EXTRACT-FILE                                 00240027
002500         ASSIGN TO INP01.                                         00250012
002600*                                                                 00260012
002700     SELECT SU-OUTPUT-EXTRACT-FILE                                00270012
002800         ASSIGN TO OUT01.                                         00280012
002900*                                                                 00290012
003000***************************************************************** 00300012
003100 DATA DIVISION.                                                   00310012
003200 FILE SECTION.                                                    00320012
003300*                                                                 00330012
003400 FD  SU-INPUT-EXTRACT-FILE                                        00340027
003500     RECORDING MODE IS F                                          00350012
003600     BLOCK CONTAINS 0  RECORDS.                                   00360012
003700 01  SU-INPUT-EXTRACT-RECORD         PIC  X(020).                 00370027
003800                                                                  00380012
003900*                                                                 00390012
004000 FD  SU-OUTPUT-EXTRACT-FILE                                       00400012
004100     RECORDING MODE IS F                                          00410012
004200     BLOCK CONTAINS 0  RECORDS.                                   00420012
004300 01  SU-OUTPUT-EXTRACT-RECORD        PIC  X(020).                 00430027
004400                                                                  00440012
004500****************************                                      00450012
004600 WORKING-STORAGE SECTION.                                         00460012
004700*                                                                 00470012
004800 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00480012
004900                                                   COMP SYNC.     00490012
005000*                                                                 00500012
005100 01  PROGRAM-SWITCHES.                                            00510012
005200     05  PS-EOF-SW                   PIC  X(01)    VALUE 'N'.     00520012
005300         88  PS-EOF                                VALUE 'Y'.     00530012
005400         88  PS-NOT-EOF                            VALUE 'N'.     00540012
005410     05  PS-EXISTENCE-TRIP           PIC S9 COMP-3 VALUE ZERO.    00541035
005420         88  PS-TRIP-EXISTS-YES                    VALUE 1.       00542015
005430         88  PS-TRIP-EXISTS-NO                     VALUE ZERO.    00543015
005500                                                                  00550012
005600 01  PC-PROGRAM-CONSTANTS.                                        00560012
005700     05  PC-CURRENT-PROGRAM-NAME    PIC X(08) VALUE  'SUKUT102'.  00570012
005800                                                                  00580012
005900 01  PV-PROGRAM-VARIABLES.                                        00590012
005910     05  PV-DISPLAY-TRIP             PIC  Z(09) VALUE ZEROES.     00591037
005911     05  PV-OTBND-TRIP-ID-MSG.                                    00591137
005920         10  FILLER                  PIC  X(13) VALUE             00592037
005930         'OTBND TRIP = '.                                         00593028
005940         10  PV-OTBND-TRIP-ID        PIC  9(15).                  00594028
006000     05  PV-ABEND-PARAGRAPH          PIC  X(30) VALUE SPACES.     00600012
006100     05  PV-PARAGRAPH-NAME           PIC  X(30) VALUE SPACES.     00610012
006110     05  PV-TABLE-NAME               PIC  X(30) VALUE SPACES.     00611025
006200     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30) VALUE SPACES.     00620012
006210     05  PV-DB2-OPERATION-MSG-1      PIC  X(40) VALUE SPACES.     00621030
006220     05  PV-DB2-OPERATION-MSG-2      PIC  X(40) VALUE SPACES.     00622030
006300                                                                  00630012
006400     05  PV-INPUT-RECS-CNT           PIC  9(09) VALUE ZERO.       00640012
006500     05  PV-OUTPUT-RECS-CNT          PIC  9(09) VALUE ZERO.       00650012
006600     05  PV-BYPASS-CART              PIC  9(09) VALUE ZERO.       00660012
006700     05  PV-BYPASS-LOC               PIC  9(09) VALUE ZERO.       00670012
006800     05  PV-BYPASS-INTRNS            PIC  9(09) VALUE ZERO.       00680012
006900*    05  PV-CART-CNT                 PIC S9(09) VALUE +0 COMP-3.  00690014
007000*    05  PV-LOC-CNT                  PIC S9(09) VALUE +0 COMP-3.  00700014
007100*    05  PV-INTRNS-CNT               PIC S9(09) VALUE +0 COMP-3.  00710014
007200                                                                  00720012
007300******************************************************************00730012
007400*  INPUT AND OUTPUT FILE LAYOUT                                   00740012
007500******************************************************************00750012
007600     COPY SURD054.                                                00760012
007700                                                                  00770012
007800******************************************************************00780012
007900*  DB2 FORMATTED MESSAGE AREA                                     00790012
008000******************************************************************00800012
008100     COPY DPWS004.                                                00810012
008200                                                                  00820012
008300******************************************************************00830012
008400*  COPY BOOK FOR THE SUT_OTBND_CART TABLE                         00840012
008500******************************************************************00850012
008600     EXEC SQL                                                     00860012
008700          INCLUDE SUT00024                                        00870012
008800     END-EXEC.                                                    00880012
008900                                                                  00890012
009000******************************************************************00900012
009100*  COPY BOOK FOR THE SUT_OTBND_LOC TABLE                          00910012
009200******************************************************************00920012
009300     EXEC SQL                                                     00930012
009400          INCLUDE SUT00027                                        00940012
009500     END-EXEC.                                                    00950012
009600                                                                  00960012
009700******************************************************************00970012
009800*  COPY BOOK FOR THE PCT_TRN_CLSN_DTL TABLE                       00980012
009900******************************************************************00990012
010000     EXEC SQL                                                     01000012
010100          INCLUDE PCT00015                                        01010012
010200     END-EXEC.                                                    01020012
010300                                                                  01030012
010400******************************************************************01040012
010500*  DB2 COMMUNICATION AREA                                         01050012
010600******************************************************************01060012
010700     EXEC SQL                                                     01070012
010800         INCLUDE SQLCA                                            01080012
010900     END-EXEC.                                                    01090012
011000                                                                  01100012
011100******************************************************************01110012
011200*  DB2 COMMUNICATION AREA2                                        01120012
011300******************************************************************01130012
011400     COPY SQLCA2.                                                 01140012
011500                                                                  01150012
011600 PROCEDURE DIVISION.                                              01160012
011700******************************************************************01170012
011800**  THIS IS THE MAIN DRIVER FOR THE PROGRAM.                      01180012
011900******************************************************************01190012
012000 0000-MAINLINE-PROCESSING.                                        01200012
012100     PERFORM 1000-INITIALIZATION.                                 01210012
012200                                                                  01220012
012300     PERFORM 2000-PROCESS-TRIP                                    01230012
012400       UNTIL PS-EOF.                                              01240012
012500                                                                  01250012
012510     DISPLAY '                                 '.                 01251038
012600     DISPLAY '# OF INPUT RECORDS ' PV-INPUT-RECS-CNT .            01260012
012700     DISPLAY '                                 '.                 01270012
012800     DISPLAY '# OF TRIPS BYPASSED - OTBND-CART ' PV-BYPASS-CART   01280012
012900     DISPLAY '# OF TRIPS BYPASSED - OTBND-LOC  ' PV-BYPASS-LOC    01290012
013000     DISPLAY '# OF TRIPS BYPASSED - INTRANSIT  ' PV-BYPASS-INTRNS 01300012
013100     DISPLAY '                                 '.                 01310012
013200     DISPLAY '# OF OUTPUT RECORDS ' PV-OUTPUT-RECS-CNT .          01320012
013300                                                                  01330012
013400     DISPLAY '** END OF SUKUT102 **'.                             01340012
013500                                                                  01350012
013600     CLOSE SU-INPUT-EXTRACT-FILE                                  01360027
013700           SU-OUTPUT-EXTRACT-FILE.                                01370012
013800                                                                  01380012
013900     STOP RUN.                                                    01390024
014000                                                                  01400012
014100******************************************************************01410012
014200**  PERFORM THE INITIAL PROCESSING FOR THE PROGRAM.               01420012
014300******************************************************************01430012
014400 1000-INITIALIZATION.                                             01440012
014500                                                                  01450012
014600     OPEN INPUT  SU-INPUT-EXTRACT-FILE                            01460027
014700          OUTPUT SU-OUTPUT-EXTRACT-FILE.                          01470012
014800                                                                  01480012
014900     DISPLAY '** START OF SUKUT102 **'.                           01490012
015000                                                                  01500012
015100     SET  PS-NOT-EOF          TO  TRUE.                           01510012
015200                                                                  01520012
015300     PERFORM 7000-READ-INPUT-FILE.                                01530012
015400                                                                  01540012
015500******************************************************************01550012
015600 2000-PROCESS-TRIP.                                               01560012
015700                                                                  01570012
015710     SET PS-TRIP-EXISTS-NO     TO TRUE                            01571022
015720                                                                  01572016
015800     MOVE SU054-OTBND-TRIP-ID  TO  SUT00024-OTBND-TRIP-ID.        01580012
015900                                                                  01590012
016000     PERFORM 3000-CHECK-OTBND-CART.                               01600012
016100*    IF PV-CART-CNT > 0                                           01610014
016110     IF PS-TRIP-EXISTS-YES                                        01611021
016200         ADD +1  TO PV-BYPASS-CART                                01620012
016210         MOVE SU054-OTBND-TRIP-ID  TO  PV-DISPLAY-TRIP            01621037
016220         DISPLAY ' ' PV-DISPLAY-TRIP '  '                         01622038
016230                 'CANT DELETE TRIP - '                            01623038
016240                 'HAS OUTBOUND CARTONS ATTACHED'                  01624038
016250         DISPLAY ' '                                              01625038
016300     ELSE                                                         01630012
016400         PERFORM 4000-CHECK-OTBND-LOC                             01640012
016500*        IF PV-LOC-CNT > 0                                        01650014
016510         IF PS-TRIP-EXISTS-YES                                    01651021
016600             ADD +1  TO PV-BYPASS-LOC                             01660012
016610             MOVE SU054-OTBND-TRIP-ID  TO  PV-DISPLAY-TRIP        01661037
016620             DISPLAY ' ' PV-DISPLAY-TRIP '  '                     01662037
016621                 'CANT DELETE TRIP - '                            01662138
016630                     'HAS SCON/SCOF CARTONS ATTACHED'             01663037
016640             DISPLAY ' '                                          01664038
016700         ELSE                                                     01670012
016800             PERFORM 5000-CHECK-INTRANSIT                         01680012
016900*            IF PV-INTRNS-CNT > 0                                 01690014
016910             IF PS-TRIP-EXISTS-YES                                01691021
017000                 ADD +1  TO PV-BYPASS-INTRNS                      01700012
017010                 MOVE SU054-OTBND-TRIP-ID  TO  PV-DISPLAY-TRIP    01701037
017020                 DISPLAY ' ' PV-DISPLAY-TRIP '  '                 01702037
017021                 'CANT DELETE TRIP - '                            01702138
017030                         'HAS INTRANSIT ROWS ATTACHED'            01703037
017040                 DISPLAY ' '                                      01704038
017100             ELSE                                                 01710012
017200                 ADD +1  TO PV-OUTPUT-RECS-CNT                    01720012
017300                 PERFORM 8000-WRITE-OUTPUT-REC                    01730012
017400             END-IF                                               01740012
017500         END-IF                                                   01750012
017600     END-IF.                                                      01760012
017700                                                                  01770012
017800     PERFORM 7000-READ-INPUT-FILE.                                01780012
017900                                                                  01790012
018000******************************************************************01800012
018100 3000-CHECK-OTBND-CART.                                           01810012
018200*    INITIALIZE PV-CART-CNT                                       01820016
018300                                                                  01830012
018400     EXEC SQL                                                     01840012
018420         SELECT 1                                                 01842017
018430           INTO :PS-EXISTENCE-TRIP                                01843021
018440*        SELECT COUNT(*)                                          01844021
018450*          INTO :PV-CART-CNT                                      01845021
018700           FROM SUT_OTBND_CART                                    01870012
018800          WHERE OTBND_TRIP_ID  = :SUT00024-OTBND-TRIP-ID          01880012
018810          FETCH FIRST 1 ROWS ONLY                                 01881023
018900     END-EXEC.                                                    01890012
019000                                                                  01900012
019100     EVALUATE TRUE                                                01910012
019200         WHEN SQLCODE = ZEROS                                     01920012
019300         WHEN SQLCODE = +100                                      01930012
019400              CONTINUE                                            01940012
019500                                                                  01950012
019600         WHEN SQLWARN0 NOT = SPACES                               01960012
019700         WHEN SQLCODE < ZERO                                      01970012
019800         WHEN SQLCODE > ZERO                                      01980012
019900             MOVE '3000-CHECK-OTBND-CART'  TO PV-PARAGRAPH-NAME   01990012
019901             MOVE SUT00024-OTBND-TRIP-ID                          01990135
019902                                     TO PV-OTBND-TRIP-ID          01990229
019903             MOVE PV-OTBND-TRIP-ID-MSG                            01990329
019904                                     TO PV-DB2-OPERATION-MSG-1    01990429
019910             MOVE 'SUT_OTBND_CART'   TO PV-TABLE-NAME             01991029
020000             MOVE 'CHECK IF EXISTS   '                            02000025
020010                                     TO PV-DB2-OPERATION-MSG-2    02001033
020200             PERFORM 9100-SQL-ABEND                               02020012
020300     END-EVALUATE.                                                02030012
020400                                                                  02040012
020500******************************************************************02050012
020600 4000-CHECK-OTBND-LOC.                                            02060012
020700*    INITIALIZE PV-LOC-CNT                                        02070019
020800                                                                  02080012
020900     MOVE SU054-OTBND-TRIP-ID  TO  SUT00027-OTBND-TRIP-ID.        02090012
021000                                                                  02100012
021100     EXEC SQL                                                     02110012
021110         SELECT 1                                                 02111018
021120           INTO :PS-EXISTENCE-TRIP                                02112021
021200*        SELECT COUNT(*)                                          02120018
021300*          INTO :PV-LOC-CNT                                       02130018
021400           FROM SUT_OTBND_LOC                                     02140012
021500          WHERE OTBND_TRIP_ID  = :SUT00027-OTBND-TRIP-ID          02150012
021510          FETCH FIRST 1 ROWS ONLY                                 02151023
021600     END-EXEC.                                                    02160012
021700                                                                  02170012
021800     EVALUATE TRUE                                                02180012
021900         WHEN SQLCODE = ZEROS                                     02190012
022000         WHEN SQLCODE = +100                                      02200012
022100              CONTINUE                                            02210012
022200                                                                  02220012
022300         WHEN SQLWARN0 NOT = SPACES                               02230012
022400         WHEN SQLCODE < ZERO                                      02240012
022500         WHEN SQLCODE > ZERO                                      02250012
022600             MOVE '4000-CHECK-OTBND-LOC '                         02260033
022601                                     TO PV-PARAGRAPH-NAME         02260133
022610             MOVE 'SUT_OTBND_LOC'    TO PV-TABLE-NAME             02261033
022620             MOVE SUT00027-OTBND-TRIP-ID                          02262034
022630                                     TO PV-OTBND-TRIP-ID          02263033
022640             MOVE PV-OTBND-TRIP-ID-MSG                            02264033
022650                                     TO PV-DB2-OPERATION-MSG-1    02265033
022700             MOVE 'CHECK IF EXISTS ' TO PV-DB2-OPERATION-MSG-2    02270034
022800             PERFORM 9100-SQL-ABEND                               02280012
022900     END-EVALUATE.                                                02290012
023000                                                                  02300012
023100******************************************************************02310012
023200 5000-CHECK-INTRANSIT.                                            02320012
023300*    INITIALIZE PV-INTRNS-CNT                                     02330019
023400                                                                  02340012
023500     MOVE SU054-OTBND-TRIP-ID  TO  PCT00015-OTBND-TRIP-ID.        02350012
023600                                                                  02360012
023700     EXEC SQL                                                     02370012
023710         SELECT 1                                                 02371019
023720           INTO :PS-EXISTENCE-TRIP                                02372021
023800*        SELECT COUNT(*)                                          02380019
023900*          INTO :PV-INTRNS-CNT                                    02390019
024000           FROM PCT_TRN_CLSN_DTL                                  02400012
024100          WHERE OTBND_TRIP_ID  = :PCT00015-OTBND-TRIP-ID          02410012
024110          FETCH FIRST 1 ROWS ONLY                                 02411023
024200     END-EXEC.                                                    02420012
024300                                                                  02430012
024400     EVALUATE TRUE                                                02440012
024500         WHEN SQLCODE = ZEROS                                     02450012
024600         WHEN SQLCODE = +100                                      02460012
024700              CONTINUE                                            02470012
024800                                                                  02480012
024900         WHEN SQLWARN0 NOT = SPACES                               02490012
025000         WHEN SQLCODE < ZERO                                      02500012
025100         WHEN SQLCODE > ZERO                                      02510012
025200             MOVE '5000-CHECK-INTRANSIT '                         02520034
025201                                     TO PV-PARAGRAPH-NAME         02520134
025210             MOVE 'PCT_TRN_CLSN_DTL' TO PV-TABLE-NAME             02521034
025220             MOVE PCT00015-OTBND-TRIP-ID                          02522034
025230                                     TO PV-OTBND-TRIP-ID          02523034
025240             MOVE PV-OTBND-TRIP-ID-MSG                            02524034
025250                                     TO PV-DB2-OPERATION-MSG-1    02525034
025300             MOVE 'CHECK IF EXISTS ' TO PV-DB2-OPERATION-MSG-2    02530034
025400             PERFORM 9100-SQL-ABEND                               02540012
025500     END-EVALUATE.                                                02550012
025600                                                                  02560012
025700******************************************************************02570012
025800 7000-READ-INPUT-FILE.                                            02580012
025900                                                                  02590012
049100      READ SU-INPUT-EXTRACT-FILE INTO                             04910027
049200          SU054-EXTRACT-RECORD                                    04920002
049300            AT END SET PS-EOF TO TRUE.                            04930002
049400                                                                  04940002
049500      IF PS-EOF                                                   04950004
049600          CONTINUE                                                04960002
049700      ELSE                                                        04970002
049900          ADD +1  TO  PV-INPUT-RECS-CNT                           04990002
051100      END-IF.                                                     05110002
051200                                                                  05120002
054300                                                                  05430002
054310******************************************************************05431002
054400 8000-WRITE-OUTPUT-REC.                                           05440003
054500     WRITE SU-OUTPUT-EXTRACT-RECORD                               05450002
054600       FROM SU054-EXTRACT-RECORD.                                 05460002
054700                                                                  05470002
055000******************************************************************05500002
055100*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    05510002
055200*  ERROR OR WARNING CODE OCCURS.                                  05520002
055300******************************************************************05530002
055310 9100-SQL-ABEND.                                                  05531002
055400     DISPLAY '9100-SQL-ABEND'.                                    05540002
055500     DISPLAY '** ABEND     **'.                                   05550002
055600     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        05560002
055700     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              05570002
055710     DISPLAY '** TABLE     ** = ' PV-TABLE-NAME.                  05571025
055810     DISPLAY '** OPERATIONAL MSG ** = ' PV-DB2-OPERATION-MSG-1.   05581031
055820     DISPLAY '** OPERATIONAL MSG ** = ' PV-DB2-OPERATION-MSG-2.   05582031
055900                                                                  05590002
056000******************************************************************05600002
056100* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    05610002
056200* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         05620002
056300* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     05630002
056400* FORMAT.                                                         05640002
056500******************************************************************05650002
056600     COPY DPPD004.                                                05660002
056700                                                                  05670002
056800     MOVE +4013                  TO ABEND-CODE.                   05680002
056900     CALL 'ILBOABN0' USING ABEND-CODE.                            05690002
057000                                                                  05700002
