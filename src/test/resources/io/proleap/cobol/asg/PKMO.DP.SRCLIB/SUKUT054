000100******************************************************************00010039
000200 IDENTIFICATION DIVISION.                                         00020039
000300******************************************************************00030039
000400                                                                  00040039
000500 PROGRAM-ID.    SUKUT054.                                         00050039
000600 AUTHOR.        DEANNA BRANTNER                                   00060039
000700 INSTALLATION.  KOHLS.                                            00070039
000800 DATE-WRITTEN   FEBRUARY 2002.                                    00080039
000900 DATE-COMPILED.                                                   00090039
001000                                                                  00100039
001100******************************************************************00110039
001200*  THIS PROGRAM WILL TAKE IN AN EXTRACT FILE OF THE TSHUNLO TABLE 00120039
001300*  (PKMT.SU.SHIPMENT.LOC.DELETE) CREATED IN JOB SUK100 AND GO TO  00130039
001400*  TINPKSU, TPKSLIP, TSHPUNT, TSHUUPC, AND TSULBXF TO             00140039
001500*  MAKE THE DATA MORE ACCESSIBLE FOR AD-HOC REPORTING PURPOSES.   00150039
001600*  4/2002 - ADDED ANOTHER OUTPUT FILE SO THAT THERE IS ONLY ONE   00160039
001700*           RECORD FOR EACH CARTON.                               00170039
001710*  10/2003 - REMOVED THE OUT02 FILE FROM THE PROGRAM - WAS NOT    00171040
001720*            BEING USED AND WAS ADDING A COUPLE OF HOURS TO       00172040
001730*            LENGTH OF JOB TO RETAIN.                             00173040
001800******************************************************************00180039
001900******************************************************************00190039
002000 ENVIRONMENT DIVISION.                                            00200039
002100******************************************************************00210039
002200                                                                  00220039
002300 CONFIGURATION SECTION.                                           00230039
002400                                                                  00240039
002500 SOURCE-COMPUTER.        IBM-3090.                                00250039
002600 OBJECT-COMPUTER.        IBM-3090.                                00260039
002700                                                                  00270039
002800 INPUT-OUTPUT SECTION.                                            00280039
002900                                                                  00290039
003000 FILE-CONTROL.                                                    00300039
003100                                                                  00310039
003200     SELECT SHUNLO-INPUT-FILE                                     00320039
003300         ASSIGN TO INP01.                                         00330039
003400                                                                  00340039
003500     SELECT EXTRACT-FILE-OUT                                      00350039
003600         ASSIGN TO OUT01.                                         00360039
003700                                                                  00370039
003800*    SELECT EXTRACT-FILE2-OUT                                     00380040
003900*        ASSIGN TO OUT02.                                         00390040
004000******************************************************************00400039
004100 DATA DIVISION.                                                   00410039
004200******************************************************************00420039
004300                                                                  00430039
004400 FILE SECTION.                                                    00440039
004500                                                                  00450039
004600 FD  SHUNLO-INPUT-FILE                                            00460039
004700     RECORDING MODE IS F                                          00470039
004800     LABEL RECORDS ARE STANDARD                                   00480039
004900     BLOCK CONTAINS 0 RECORDS.                                    00490039
005000                                                                  00500039
005100 01  SHUNLO-INPUT-RECORD              PIC  X(56).                 00510039
005200                                                                  00520039
005300 FD  EXTRACT-FILE-OUT                                             00530039
005400     RECORDING MODE IS F                                          00540039
005500     LABEL RECORDS ARE STANDARD                                   00550039
005600     BLOCK CONTAINS 0 RECORDS.                                    00560039
005700                                                                  00570039
005800 01  EXTRACT-RECORD-OUT               PIC  X(118).                00580039
005900                                                                  00590040
006000*FD  EXTRACT-FILE2-OUT                                            00600040
006100*    RECORDING MODE IS F                                          00610040
006200*    LABEL RECORDS ARE STANDARD                                   00620040
006300*    BLOCK CONTAINS 0 RECORDS.                                    00630040
006400*                                                                 00640040
006500*01  EXTRACT-RECORD2-OUT              PIC  X(150).                00650040
006600                                                                  00660039
006700******************************************************************00670039
006800 WORKING-STORAGE SECTION.                                         00680039
006900******************************************************************00690039
007000 01  DK-DB2-KEYS.                                                 00700039
007100     05 DK-SHIPT-UNT-ID               PIC  S9(18)V COMP-3.        00710039
007200     05 DK-PO-NBR                     PIC  S9(9) COMP.            00720039
007300     05 DK-SEQ-NBR                    PIC  S9(4) COMP.            00730039
007400*                                                                 00740039
007500 01  PC-PROGRAM-CONSTANTS.                                        00750039
007600     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     00760039
007700                                                   COMP SYNC.     00770039
007800     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00780039
007900         'SUKUT054'.                                              00790039
008000     05  PC-CURRENT-OPERATING-COMPANY                             00800039
008100                                     PIC  X(02)    VALUE '03'.    00810039
008200     05  PC-MAX-RETRIES              PIC S9(04)    VALUE +3       00820039
008300                                                   COMP SYNC.     00830039
008400     05  PC-CURRENT-TIMESTAMP        PIC  X(26)    VALUE SPACES.  00840039
008500     05  PC-A                        PIC  X(01)    VALUE 'A'.     00850039
008600     05  PC-B                        PIC  X(01)    VALUE 'B'.     00860039
008700     05  PC-C                        PIC  X(01)    VALUE 'C'.     00870039
008800     05  PC-D                        PIC  X(01)    VALUE 'D'.     00880039
008900                                                                  00890039
009000*-----------------------------------------------------------------00900039
009100*  RECORD LAYOUT FOR THE OUTPUT FILE                              00910039
009200*-----------------------------------------------------------------00920039
009300     COPY SURD020.                                                00930039
009400                                                                  00940039
009500*-----------------------------------------------------------------00950039
009600*  RECORD LAYOUT FOR THE OUTPUT FILE 2                            00960039
009700*-----------------------------------------------------------------00970039
009800*    COPY SURD022.                                                00980040
009900                                                                  00990039
010000*-----------------------------------------------------------------01000039
010100*  DB2 FORMATTED MESSAGE AREA                                     01010039
010200*-----------------------------------------------------------------01020039
010300     COPY DPWS004.                                                01030039
010400                                                                  01040039
010500*-----------------------------------------------------------------01050039
010600*  COMMUNICATIONS AREA FOR DB2                                    01060039
010700*-----------------------------------------------------------------01070039
010800     EXEC SQL                                                     01080039
010900          INCLUDE SQLCA                                           01090039
011000     END-EXEC.                                                    01100039
011100                                                                  01110039
011200*-----------------------------------------------------------------01120039
011300*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE COMPANY CONTROL TAB01130039
011400*-----------------------------------------------------------------01140039
011500     EXEC SQL                                                     01150039
011600          INCLUDE TCOCNTL                                         01160039
011700     END-EXEC.                                                    01170039
011800*-----------------------------------------------------------------01180039
011900*-----------------------------------------------------------------01190039
012000*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE PACKSLIP TABLE     01200039
012100*-----------------------------------------------------------------01210039
012200     EXEC SQL                                                     01220039
012300          INCLUDE TPKSLIP                                         01230039
012400     END-EXEC.                                                    01240039
012500*-----------------------------------------------------------------01250039
012600*-----------------------------------------------------------------01260039
012700*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE TINPKSU  TABLE     01270039
012800*-----------------------------------------------------------------01280039
012900     EXEC SQL                                                     01290039
013000          INCLUDE TINPKSU                                         01300039
013100     END-EXEC.                                                    01310039
013200*-----------------------------------------------------------------01320039
013300*-----------------------------------------------------------------01330039
013400*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE SHIP UNIT TABLE    01340039
013500*-----------------------------------------------------------------01350039
013600     EXEC SQL                                                     01360039
013700          INCLUDE TSHPUNT                                         01370039
013800     END-EXEC.                                                    01380039
013900*-----------------------------------------------------------------01390039
014000*-----------------------------------------------------------------01400039
014100*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE SHIP UPC TABLE     01410039
014200*-----------------------------------------------------------------01420039
014300     EXEC SQL                                                     01430039
014400          INCLUDE TSHUUPC                                         01440039
014500     END-EXEC.                                                    01450039
014600*-----------------------------------------------------------------01460039
014700*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE TSHUNLO TABLE      01470039
014800*-----------------------------------------------------------------01480039
014900     EXEC SQL                                                     01490039
015000          INCLUDE TSHUNLO                                         01500039
015100     END-EXEC.                                                    01510039
015200*-----------------------------------------------------------------01520039
015300*-----------------------------------------------------------------01530039
015400*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE XREF TABLE         01540039
015500*-----------------------------------------------------------------01550039
015600     EXEC SQL                                                     01560039
015700          INCLUDE TSULBXF                                         01570039
015800     END-EXEC.                                                    01580039
015900                                                                  01590039
016000*-----------------------------------------------------------------01600039
016100*  CURSOR FOR THE TSHUUPC TABLE                                   01610039
016200*-----------------------------------------------------------------01620039
016300     EXEC SQL                                                     01630039
016400        DECLARE TSHUUPC-CSR CURSOR FOR                            01640039
016500        SELECT TRN_NBR                                            01650039
016600              ,TRN_LNE_NBR                                        01660039
016700              ,TRN_TYP_CDE                                        01670039
016800              ,UPC_NBR                                            01680039
016900              ,SHPD_QTY                                           01690039
017000        FROM  TSHUUPC                                             01700039
017100        WHERE  SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID                   01710039
017200     END-EXEC.                                                    01720039
017300                                                                  01730039
017400*-----------------------------------------------------------------01740039
017500*  CURSOR FOR THE TSULBXF TABLE                                   01750039
017600*-----------------------------------------------------------------01760039
017700     EXEC SQL                                                     01770039
017800        DECLARE TSULBXF-CSR CURSOR FOR                            01780039
017900        SELECT CART_LBL_TYP_CDE                                   01790039
018000              ,DEST_OPER_UNT_ID                                   01800039
018100        FROM  TSULBXF                                             01810039
018200        WHERE  SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID                   01820039
018300          AND  STAT_CDE      = :PC-A                              01830039
018400     END-EXEC.                                                    01840039
018500                                                                  01850039
018600*-----------------------------------------------------------------01860039
018700 01  ABEND-CODE                      PIC S9(04)    VALUE +0       01870039
018800                                                   COMP SYNC.     01880039
018900                                                                  01890039
019000 01  PS-PROGRAM-SWITCHES.                                         01900039
019100     05  PS-EOF-FILE-SW              PIC  X(01)    VALUE 'N'.     01910039
019200         88  PS-EOF-FILE                           VALUE 'Y'.     01920039
019300         88  PS-MORE-FILE                          VALUE 'N'.     01930039
019400     05  PS-EOF-SHUUPC-SW            PIC  X(01)    VALUE 'N'.     01940039
019500         88  PS-EOF-SHUUPC                         VALUE 'Y'.     01950039
019600         88  PS-MORE-SHUUPC                        VALUE 'N'.     01960039
019700     05  PS-EOF-SULBXF-SW            PIC  X(01)    VALUE 'N'.     01970039
019800         88  PS-EOF-SULBXF                         VALUE 'Y'.     01980039
019900         88  PS-MORE-SULBXF                        VALUE 'N'.     01990039
020000     05  PS-WRITE-OUTPUT-REC-SW      PIC  X(01)    VALUE 'Y'.     02000039
020100         88  PS-WRITE-OUT-RECORD                   VALUE 'Y'.     02010039
020200         88  PS-DONT-WRITE-OUT-RECORD              VALUE 'N'.     02020039
020300                                                                  02030039
020400 01  PV-PROGRAM-VARIABLES.                                        02040039
020500     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  02050039
020600     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  02060039
020700     05  PV-OPEN-COUNTER             PIC S9(04)    VALUE ZERO     02070039
020800                                                   COMP SYNC.     02080039
020900     05  PV-CLOSE-COUNTER            PIC S9(04)    VALUE ZERO     02090039
021000                                                   COMP SYNC.     02100039
021100     05  PV-FETCH-COUNTER            PIC S9(04)    VALUE ZERO     02110039
021200                                                   COMP SYNC.     02120039
021300     05  PV-WRITE-COUNTER            PIC S9(09)    VALUE ZERO     02130039
021400                                                   COMP SYNC.     02140039
021500*    05  PV-WRITE-COUNTER2           PIC S9(09)    VALUE ZERO     02150040
021600*                                                  COMP SYNC.     02160040
021700     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             02170039
021800                                                                  02180039
021900     05  PV-DB2-COUNT                PIC S9(09)    VALUE ZERO     02190039
022000                                                   COMP-3.        02200039
022100**                                                                02210039
022200     05  PV-FILE-CREATE-DATE         PIC X(10).                   02220039
022300*                                                                 02230039
022400     05  PV-PREV-PO-NBR              PIC  S9(9) COMP.             02240039
022500     05  PV-PREV-SEQ-NBR             PIC  S9(4) COMP.             02250039
022600                                                                  02260039
022700 01  SD-SYSTEM-DATE.                                              02270039
022800     05  SD-SYSTEM-DATE-YY           PIC  9(02)      VALUE ZERO.  02280039
022900     05  SD-SYSTEM-DATE-MM           PIC  9(02)      VALUE ZERO.  02290039
023000     05  SD-SYSTEM-DATE-DD           PIC  9(02)      VALUE ZERO.  02300039
023100                                                                  02310039
023200******************************************************************02320039
023300 PROCEDURE DIVISION.                                              02330039
023400******************************************************************02340039
023500                                                                  02350039
023600******************************************************************02360039
023700* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     02370039
023800*      PROGRAM.                                                   02380039
023900******************************************************************02390039
024000 0000-PROGRAM-MAINLINE.                                           02400039
024100                                                                  02410039
024200     PERFORM 1000-INITIALIZE.                                     02420039
024300     IF PS-MORE-FILE                                              02430039
024400         PERFORM 2000-PROCESS-INPUT-RECORDS                       02440039
024500            UNTIL PS-EOF-FILE                                     02450039
024600     END-IF.                                                      02460039
024700     PERFORM 9000-EOJ-ROUTINE.                                    02470039
024800                                                                  02480039
024900     STOP RUN.                                                    02490039
025000                                                                  02500039
025100******************************************************************02510039
025200*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    02520039
025300******************************************************************02530039
025400 1000-INITIALIZE.                                                 02540039
025500                                                                  02550039
025600     OPEN INPUT SHUNLO-INPUT-FILE                                 02560039
025700          OUTPUT EXTRACT-FILE-OUT.                                02570040
025800*         OUTPUT EXTRACT-FILE2-OUT.                               02580040
025900                                                                  02590039
026000     SET PS-MORE-FILE  TO  TRUE.                                  02600039
026100     PERFORM 1100-SELECT-PROCESS-DATE.                            02610039
026200     INITIALIZE SU020-DETAIL-RECORD.                              02620039
026300                                                                  02630039
026400******************************************************************02640039
026500*  SELECT CURRENT DATE FOR EXTRACT CREATE.                        02650039
026600******************************************************************02660039
026700 1100-SELECT-PROCESS-DATE.                                        02670039
026800                                                                  02680039
026900     EXEC SQL                                                     02690039
027000          SELECT CURRENT DATE                                     02700039
027100            INTO :PV-FILE-CREATE-DATE                             02710039
027200            FROM  TCOCNTL                                         02720039
027300     END-EXEC.                                                    02730039
027400                                                                  02740039
027500     EVALUATE TRUE                                                02750039
027600         WHEN SQLCODE = ZERO                                      02760039
027700         WHEN SQLCODE = -811                                      02770039
027800             DISPLAY ' FILE CREATE DATE IS ' PV-FILE-CREATE-DATE  02780039
027900             MOVE PV-FILE-CREATE-DATE  TO SU020-BUILD-DATE        02790039
028000         WHEN SQLWARN0 NOT = SPACES                               02800039
028100         WHEN SQLCODE < ZERO                                      02810039
028200         WHEN SQLCODE > ZERO                                      02820039
028300             MOVE '1100-SELECT-PROCESS-DATE'                      02830039
028400                                 TO PV-PARAGRAPH-NAME             02840039
028500             MOVE 'ATTEMPTING TO SELECT CURRENT DATE              02850039
028600-                 'FROM TCOCNTL' TO PV-DB2-OPERATION-ATTEMPTED    02860039
028700             PERFORM 9100-SQL-ABEND                               02870039
028800     END-EVALUATE.                                                02880039
028900                                                                  02890039
029000******************************************************************02900039
029100*  PROCESS THE INPUT FILE RECORDS.  FORMAT THE OUTPUT RECORD.     02910039
029200******************************************************************02920039
029300 2000-PROCESS-INPUT-RECORDS.                                      02930039
029400                                                                  02940039
029500     PERFORM 7000-READ-SHUNLO.                                    02950039
029600                                                                  02960039
029700*    INITIALIZE SU022-EXTRACT-RECORD.                             02970040
029800*    MOVE PV-FILE-CREATE-DATE  TO SU022-BUILD-DATE.               02980040
029900                                                                  02990039
029910     IF PS-EOF-FILE                                               02991041
029920         CONTINUE                                                 02992041
029930     ELSE                                                         02993041
030000         SET SU020-TSHUNLO        TO TRUE                         03000041
030100         MOVE SHUNLO-SHIPT-UNT-ID TO SU020-SHIPT-UNT-ID           03010041
030200*                                    SU022-SHIPT-UNT-ID.          03020041
030300         MOVE SHUNLO-TRIP-ID      TO SU020-TRIP-ID                03030041
030400*                                    SU022-TRIP-ID.               03040041
030500         MOVE SHUNLO-OPER-UNT-ID  TO SU020-SHNL-OPER-UNT-ID       03050041
030600*                                    SU022-SHNL-OPER-UNT-ID.      03060041
030700         MOVE SHUNLO-SCN-LOC-ID   TO SU020-SCN-LOC-ID             03070041
030800*                                    SU022-SCN-LOC-ID.            03080041
030900         MOVE SHUNLO-CRE-USR-ID   TO SU020-SHNL-CRE-USR-ID        03090041
031000*                                    SU022-SHNL-CRE-USR-ID.       03100041
031100         MOVE SHUNLO-CRE-TMST     TO SU020-SHNL-CRE-TMST          03110041
031200*                                    SU022-SHNL-CRE-TMST.         03120041
031210         PERFORM 2200-RETRIEVE-TINPKSU                            03121041
031300         PERFORM 8000-WRITE-EXTRACT-RECORD                        03130041
031400         INITIALIZE SU020-DETAIL-RECORD                           03140041
031410     END-IF.                                                      03141041
031500                                                                  03150039
031600     IF PS-EOF-FILE                                               03160039
031700         CONTINUE                                                 03170039
031800     ELSE                                                         03180039
031900         PERFORM 2400-RETRIEVE-TSHPUNT                            03190041
032000         PERFORM 2500-OPEN-TSHUUPC-CURSOR                         03200039
032100         IF PS-MORE-SHUUPC                                        03210039
032200             PERFORM 2501-FETCH-TSHUUPC-CURSOR                    03220039
032300                UNTIL PS-EOF-SHUUPC                               03230039
032400         END-IF                                                   03240039
032500         PERFORM 2502-CLOSE-TSHUUPC-CURSOR                        03250039
032600*        PERFORM 8500-WRITE-EXTRACT-RECORD2                       03260040
032700         PERFORM 2700-OPEN-TSULBXF-CURSOR                         03270039
032800         IF PS-MORE-SULBXF                                        03280039
032900             PERFORM 2701-FETCH-TSULBXF-CURSOR                    03290039
033000                UNTIL PS-EOF-SULBXF                               03300039
033100         END-IF                                                   03310039
033200         PERFORM 2702-CLOSE-TSULBXF-CURSOR                        03320039
033300     END-IF.                                                      03330039
033400                                                                  03340039
033500******************************************************************03350039
033600*  RETRIEVE TINPKSU.                                              03360039
033700******************************************************************03370039
033800 2200-RETRIEVE-TINPKSU.                                           03380039
033900     MOVE SHUNLO-SHIPT-UNT-ID TO   DK-SHIPT-UNT-ID.               03390039
034000                                                                  03400039
034100     EXEC SQL                                                     03410039
034200        SELECT PO_NBR                                             03420039
034300              ,SEQ_NBR                                            03430039
034400          INTO :INPKSU-PO-NBR                                     03440039
034500              ,:INPKSU-SEQ-NBR                                    03450039
034600        FROM  TINPKSU                                             03460039
034700        WHERE  SHIPT_UNT_ID    = :DK-SHIPT-UNT-ID                 03470039
034800     END-EXEC.                                                    03480039
034900                                                                  03490039
035000     EVALUATE TRUE                                                03500039
035100       WHEN SQLCODE = ZEROS                                       03510039
035200           SET PS-WRITE-OUT-RECORD  TO TRUE                       03520039
035300           MOVE INPKSU-PO-NBR  TO  SU020-PO-NBR                   03530039
035400*                                  SU022-PO-NBR                   03540040
035500           MOVE INPKSU-SEQ-NBR TO  SU020-SEQ-NBR                  03550039
035600*                                  SU022-SEQ-NBR                  03560040
035700           PERFORM 2300-RETRIEVE-TPKSLIP                          03570039
035900       WHEN SQLCODE = +100                                        03590039
036000           MOVE ZEROES         TO  SU020-PO-NBR                   03600039
036100                                   SU020-SEQ-NBR                  03610039
036200*                                  SU022-PO-NBR                   03620040
036300*                                  SU022-SEQ-NBR                  03630040
036500       WHEN SQLWARN0 NOT = SPACES                                 03650039
036600       WHEN SQLCODE < ZERO                                        03660039
036700       WHEN SQLCODE > ZERO                                        03670039
036800           MOVE '2200-RETRIEVE-TINPKSU '                          03680039
036900                               TO PV-PARAGRAPH-NAME               03690039
037000           MOVE 'SELECT THE PO & SEQ NBR   '                      03700039
037100                               TO PV-DB2-OPERATION-ATTEMPTED      03710039
037200           PERFORM 9100-SQL-ABEND                                 03720039
037300     END-EVALUATE.                                                03730039
037400                                                                  03740039
037500******************************************************************03750039
037600* RETRIEVE TPKSLIP                                                03760039
037700******************************************************************03770039
037800 2300-RETRIEVE-TPKSLIP.                                           03780039
037900     EXEC SQL                                                     03790039
038000        SELECT REC_SEQ_NBR                                        03800039
038100          INTO :PKSLIP-REC-SEQ-NBR                                03810039
038200        FROM  TPKSLIP                                             03820039
038300        WHERE  PO_NBR       = :INPKSU-PO-NBR                      03830039
038400          AND  SEQ_NBR      = :INPKSU-SEQ-NBR                     03840039
038500          AND  VER_STAT_CDE = :PC-A                               03850039
038600     END-EXEC.                                                    03860039
038700                                                                  03870039
038800     EVALUATE TRUE                                                03880039
038900       WHEN SQLCODE = ZEROS                                       03890039
039000       WHEN SQLCODE = -811                                        03900039
039100           MOVE PKSLIP-REC-SEQ-NBR TO SU020-REC-SEQ-NBR           03910039
039200*                                     SU022-REC-SEQ-NBR           03920040
039300       WHEN SQLCODE = +100                                        03930039
039400           MOVE ZEROES             TO SU020-REC-SEQ-NBR           03940039
039500*                                     SU022-REC-SEQ-NBR           03950040
039600       WHEN SQLWARN0 NOT = SPACES                                 03960039
039700       WHEN SQLCODE < ZERO                                        03970039
039800       WHEN SQLCODE > ZERO                                        03980039
039900           MOVE '2300-RETRIEVE-TPKSLIP '                          03990039
040000                               TO PV-PARAGRAPH-NAME               04000039
040100           MOVE 'SELECT THE RCVR SEQ NBR '                        04010039
040200                               TO PV-DB2-OPERATION-ATTEMPTED      04020039
040300           PERFORM 9100-SQL-ABEND                                 04030039
040400     END-EVALUATE.                                                04040039
040500                                                                  04050039
040600******************************************************************04060039
040700*  RETRIEVE TSHPUNT                                               04070039
040800******************************************************************04080039
040900 2400-RETRIEVE-TSHPUNT.                                           04090039
041000     EXEC SQL                                                     04100039
041100        SELECT ORGN_OPER_UNT_ID                                   04110039
041200              ,DEST_OPER_UNT_ID                                   04120039
041300              ,SHIPT_UNT_SRC_ID                                   04130039
041400              ,ACTV_IND                                           04140039
041500              ,CRE_DTE                                            04150039
041600              ,CRE_TM                                             04160039
041700              ,CRE_USR_ID                                         04170039
041800              ,CRE_PGM_NM                                         04180039
041900          INTO :SHPUNT-ORGN-OPER-UNT-ID                           04190039
042000              ,:SHPUNT-DEST-OPER-UNT-ID                           04200039
042100              ,:SHPUNT-SHIPT-UNT-SRC-ID                           04210039
042200              ,:SHPUNT-ACTV-IND                                   04220039
042300              ,:SHPUNT-CRE-DTE                                    04230039
042400              ,:SHPUNT-CRE-TM                                     04240039
042500              ,:SHPUNT-CRE-USR-ID                                 04250039
042600              ,:SHPUNT-CRE-PGM-NM                                 04260039
042700        FROM  TSHPUNT                                             04270039
042800        WHERE  SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID                   04280039
042900     END-EXEC.                                                    04290039
043000                                                                  04300039
043100     EVALUATE TRUE                                                04310039
043200       WHEN SQLCODE = ZEROS                                       04320039
043300           SET SU020-TSHPUNT            TO TRUE                   04330039
043400           MOVE SHPUNT-ORGN-OPER-UNT-ID TO SU020-ORGN-OPER-UNT-ID 04340039
043500*                                          SU022-ORGN-OPER-UNT-ID 04350040
043600           MOVE SHPUNT-DEST-OPER-UNT-ID TO SU020-DEST-OPER-UNT-ID 04360039
043700*                                          SU022-DEST-OPER-UNT-ID 04370040
043800           MOVE SHPUNT-SHIPT-UNT-SRC-ID TO SU020-SHIPT-UNT-SRC-ID 04380039
043900*                                          SU022-SHIPT-UNT-SRC-ID 04390040
044000           MOVE SHPUNT-ACTV-IND         TO SU020-ACTV-IND         04400039
044100           MOVE SHPUNT-CRE-DTE          TO SU020-CRE-DTE          04410039
044200*                                          SU022-CRE-DTE          04420040
044300           MOVE SHPUNT-CRE-TM           TO SU020-CRE-TM           04430039
044400*                                          SU022-CRE-TM           04440040
044500           MOVE SHPUNT-CRE-USR-ID       TO SU020-CRE-USR-ID       04450039
044600*                                          SU022-CRE-USR-ID       04460040
044700           MOVE SHPUNT-CRE-PGM-NM       TO SU020-CRE-PGM-NM       04470039
044800*                                          SU022-CRE-PGM-NM       04480040
044900           PERFORM 8000-WRITE-EXTRACT-RECORD                      04490039
045000           INITIALIZE SU020-DETAIL-RECORD                         04500039
045100       WHEN SQLCODE = +100                                        04510039
045200           MOVE ZEROES                  TO SU020-DEST-OPER-UNT-ID 04520039
045300                                           SU020-ORGN-OPER-UNT-ID 04530039
045400*                                          SU022-ORGN-OPER-UNT-ID 04540040
045500*                                          SU022-DEST-OPER-UNT-ID 04550040
045600           MOVE SPACES                  TO SU020-SHIPT-UNT-SRC-ID 04560039
045700                                           SU020-ACTV-IND         04570039
045800                                           SU020-CRE-DTE          04580039
045900                                           SU020-CRE-TM           04590039
046000                                           SU020-CRE-USR-ID       04600039
046100                                           SU020-CRE-PGM-NM       04610039
046200*                                          SU022-SHIPT-UNT-SRC-ID 04620040
046300*                                          SU022-CRE-DTE          04630040
046400*                                          SU022-CRE-TM           04640040
046500*                                          SU022-CRE-USR-ID       04650040
046600*                                          SU022-CRE-PGM-NM       04660040
046700       WHEN SQLWARN0 NOT = SPACES                                 04670039
046800       WHEN SQLCODE < ZERO                                        04680039
046900       WHEN SQLCODE > ZERO                                        04690039
047000           MOVE '2400-RETRIEVE-TSHPUNT  '                         04700039
047100                               TO PV-PARAGRAPH-NAME               04710039
047200           MOVE 'RETRIEVE INFO FROM TSHPUNT  '                    04720039
047300                               TO PV-DB2-OPERATION-ATTEMPTED      04730039
047400           PERFORM 9100-SQL-ABEND                                 04740039
047500     END-EVALUATE.                                                04750039
047600                                                                  04760039
047700******************************************************************04770039
047800*  OPEN TSHUUPC CURSOR                                            04780039
047900******************************************************************04790039
048000 2500-OPEN-TSHUUPC-CURSOR.                                        04800039
048100     EXEC SQL                                                     04810039
048200        OPEN TSHUUPC-CSR                                          04820039
048300     END-EXEC.                                                    04830039
048400                                                                  04840039
048500     EVALUATE TRUE                                                04850039
048600       WHEN SQLCODE = ZEROS                                       04860039
048700       WHEN SQLCODE = -904                                        04870039
048800       WHEN SQLCODE = -913                                        04880039
048900           SET PS-MORE-SHUUPC TO TRUE                             04890039
049000       WHEN SQLWARN0 NOT = SPACES                                 04900039
049100       WHEN SQLCODE < ZERO                                        04910039
049200       WHEN SQLCODE > ZERO                                        04920039
049300           MOVE '2500-OPEN-TSHUUPC-CURSOR '                       04930039
049400                               TO PV-PARAGRAPH-NAME               04940039
049500           MOVE 'OPEN TSHUUPC CURSOR  '                           04950039
049600                               TO PV-DB2-OPERATION-ATTEMPTED      04960039
049700           PERFORM 9100-SQL-ABEND                                 04970039
049800     END-EVALUATE.                                                04980039
049900                                                                  04990039
050000******************************************************************05000039
050100*  FETCH TSHUUPC CURSOR                                           05010039
050200******************************************************************05020039
050300 2501-FETCH-TSHUUPC-CURSOR.                                       05030039
050400     EXEC SQL                                                     05040039
050500        FETCH TSHUUPC-CSR                                         05050039
050600          INTO :SHUUPC-TRN-NBR                                    05060039
050700              ,:SHUUPC-TRN-LNE-NBR                                05070039
050800              ,:SHUUPC-TRN-TYP-CDE                                05080039
050900              ,:SHUUPC-UPC-NBR                                    05090039
051000              ,:SHUUPC-SHPD-QTY                                   05100039
051100     END-EXEC.                                                    05110039
051200                                                                  05120039
051300     EVALUATE TRUE                                                05130039
051400       WHEN SQLCODE = ZEROS                                       05140039
051500           SET SU020-TSHUUPC            TO TRUE                   05150039
051600           MOVE SHUUPC-TRN-NBR       TO SU020-TRN-NBR             05160039
051700           MOVE SHUUPC-TRN-LNE-NBR   TO SU020-TRN-LNE-NBR         05170039
051800           MOVE SHUUPC-TRN-TYP-CDE   TO SU020-TRN-TYP-CDE         05180039
051900           MOVE SHUUPC-UPC-NBR       TO SU020-UPC-NBR             05190039
052000           MOVE SHUUPC-SHPD-QTY      TO SU020-SHPD-QTY            05200039
052100*          ADD  SHUUPC-SHPD-QTY      TO SU022-SHPD-QTY            05210040
052200           PERFORM 8000-WRITE-EXTRACT-RECORD                      05220039
052300           INITIALIZE SU020-DETAIL-RECORD                         05230039
052400       WHEN SQLCODE = +100                                        05240039
052500            SET PS-EOF-SHUUPC TO TRUE                             05250039
052600       WHEN SQLWARN0 NOT = SPACES                                 05260039
052700       WHEN SQLCODE < ZERO                                        05270039
052800       WHEN SQLCODE > ZERO                                        05280039
052900           MOVE '2501-FETCH-TSHUUPC-CURSOR '                      05290039
053000                               TO PV-PARAGRAPH-NAME               05300039
053100           MOVE 'RETRIEVE INFO FROM TSHUUPC  '                    05310039
053200                               TO PV-DB2-OPERATION-ATTEMPTED      05320039
053300           PERFORM 9100-SQL-ABEND                                 05330039
053400     END-EVALUATE.                                                05340039
053500                                                                  05350039
053600******************************************************************05360039
053700*  CLOSE TSHUUPC CURSOR                                           05370039
053800******************************************************************05380039
053900 2502-CLOSE-TSHUUPC-CURSOR.                                       05390039
054000     EXEC SQL                                                     05400039
054100        CLOSE TSHUUPC-CSR                                         05410039
054200     END-EXEC.                                                    05420039
054300                                                                  05430039
054400     EVALUATE TRUE                                                05440039
054500       WHEN SQLCODE = ZEROS                                       05450039
054600       WHEN SQLCODE = -904                                        05460039
054700       WHEN SQLCODE = -913                                        05470039
054800           CONTINUE                                               05480039
054900       WHEN SQLWARN0 NOT = SPACES                                 05490039
055000       WHEN SQLCODE < ZERO                                        05500039
055100       WHEN SQLCODE > ZERO                                        05510039
055200           MOVE '2502-CLOSE-TSHUUPC-CURSOR '                      05520039
055300                               TO PV-PARAGRAPH-NAME               05530039
055400           MOVE 'CLOSE TSHUUPC CURSOR  '                          05540039
055500                               TO PV-DB2-OPERATION-ATTEMPTED      05550039
055600           PERFORM 9100-SQL-ABEND                                 05560039
055700     END-EVALUATE.                                                05570039
055800                                                                  05580039
055900******************************************************************05590039
056000* OPEN TSULBXF CURSOR                                             05600039
056100******************************************************************05610039
056200 2700-OPEN-TSULBXF-CURSOR.                                        05620039
056300     EXEC SQL                                                     05630039
056400        OPEN TSULBXF-CSR                                          05640039
056500     END-EXEC.                                                    05650039
056600                                                                  05660039
056700     EVALUATE TRUE                                                05670039
056800       WHEN SQLCODE = ZEROS                                       05680039
056900       WHEN SQLCODE = -904                                        05690039
057000       WHEN SQLCODE = -913                                        05700039
057100           SET PS-MORE-SULBXF TO TRUE                             05710039
057200       WHEN SQLWARN0 NOT = SPACES                                 05720039
057300       WHEN SQLCODE < ZERO                                        05730039
057400       WHEN SQLCODE > ZERO                                        05740039
057500           MOVE '2700-OPEN-TSULBXF-CURSOR '                       05750039
057600                               TO PV-PARAGRAPH-NAME               05760039
057700           MOVE 'OPEN TSULBXF CURSOR  '                           05770039
057800                               TO PV-DB2-OPERATION-ATTEMPTED      05780039
057900           PERFORM 9100-SQL-ABEND                                 05790039
058000     END-EVALUATE.                                                05800039
058100                                                                  05810039
058200******************************************************************05820039
058300*  FETCH TSULBXF CURSOR                                           05830039
058400******************************************************************05840039
058500 2701-FETCH-TSULBXF-CURSOR.                                       05850039
058600     EXEC SQL                                                     05860039
058700        FETCH TSULBXF-CSR                                         05870039
058800          INTO :SULBXF-CART-LBL-TYP-CDE                           05880039
058900              ,:SULBXF-DEST-OPER-UNT-ID                           05890039
059000     END-EXEC.                                                    05900039
059100                                                                  05910039
059200     EVALUATE TRUE                                                05920039
059300       WHEN SQLCODE = ZEROS                                       05930039
059400           SET SU020-TSULBXF            TO TRUE                   05940039
059500           MOVE SULBXF-CART-LBL-TYP-CDE TO SU020-CART-LBL-TYP-CDE 05950039
059600           MOVE SULBXF-DEST-OPER-UNT-ID TO SU020-SLBXF-OPER-UNT-ID05960039
059700           PERFORM 8000-WRITE-EXTRACT-RECORD                      05970039
059800           INITIALIZE SU020-DETAIL-RECORD                         05980039
059900       WHEN SQLCODE = +100                                        05990039
060000            SET PS-EOF-SULBXF TO TRUE                             06000039
060100       WHEN SQLWARN0 NOT = SPACES                                 06010039
060200       WHEN SQLCODE < ZERO                                        06020039
060300       WHEN SQLCODE > ZERO                                        06030039
060400           MOVE '2701-FETCH-TSULBXF-CURSOR '                      06040039
060500                               TO PV-PARAGRAPH-NAME               06050039
060600           MOVE 'RETRIEVE INFO FROM TSULBXF  '                    06060039
060700                               TO PV-DB2-OPERATION-ATTEMPTED      06070039
060800           PERFORM 9100-SQL-ABEND                                 06080039
060900     END-EVALUATE.                                                06090039
061000                                                                  06100039
061100******************************************************************06110039
061200*  CLOSE TSULBXF CURSOR                                           06120039
061300******************************************************************06130039
061400 2702-CLOSE-TSULBXF-CURSOR.                                       06140039
061500     EXEC SQL                                                     06150039
061600        CLOSE TSULBXF-CSR                                         06160039
061700     END-EXEC.                                                    06170039
061800                                                                  06180039
061900     EVALUATE TRUE                                                06190039
062000       WHEN SQLCODE = ZEROS                                       06200039
062100       WHEN SQLCODE = -904                                        06210039
062200       WHEN SQLCODE = -913                                        06220039
062300           CONTINUE                                               06230039
062400       WHEN SQLWARN0 NOT = SPACES                                 06240039
062500       WHEN SQLCODE < ZERO                                        06250039
062600       WHEN SQLCODE > ZERO                                        06260039
062700           MOVE '2702-CLOSE-TSULBXF-CURSOR '                      06270039
062800                               TO PV-PARAGRAPH-NAME               06280039
062900           MOVE 'CLOSE TSULBXF CURSOR  '                          06290039
063000                               TO PV-DB2-OPERATION-ATTEMPTED      06300039
063100           PERFORM 9100-SQL-ABEND                                 06310039
063200     END-EVALUATE.                                                06320039
063300                                                                  06330039
063400******************************************************************06340039
063500*  READ THE INPUT TSHUNLO ARCHIVE DATA                            06350039
063600******************************************************************06360039
063700 7000-READ-SHUNLO.                                                06370039
063800     READ SHUNLO-INPUT-FILE INTO DCLTSHUNLO                       06380039
063900        AT END                                                    06390039
064000             SET PS-EOF-FILE  TO TRUE.                            06400039
064100                                                                  06410039
064200                                                                  06420039
064300******************************************************************06430039
064400*  WRITE THE OUTPUT RECORD FILE 1                                 06440039
064500******************************************************************06450039
064600 8000-WRITE-EXTRACT-RECORD.                                       06460039
064700                                                                  06470039
064800     WRITE EXTRACT-RECORD-OUT                                     06480039
064900       FROM SU020-VEND-ARCHIVE-RECORD.                            06490039
065000                                                                  06500039
065100     ADD +1 TO PV-WRITE-COUNTER.                                  06510039
065200*                                                                 06520040
065300******************************************************************06530039
065400*  WRITE THE OUTPUT RECORD FILE 2                                 06540039
065500******************************************************************06550039
065600*8500-WRITE-EXTRACT-RECORD2.                                      06560040
065700*                                                                 06570040
065800*    WRITE EXTRACT-RECORD2-OUT                                    06580040
065900*      FROM SU022-EXTRACT-RECORD.                                 06590040
066000*                                                                 06600040
066100*    ADD +1 TO PV-WRITE-COUNTER2.                                 06610040
066200                                                                  06620039
066300******************************************************************06630039
066400*  CLOSE OUTPUT FILE.  CLOSE THE CURSOR.                          06640039
066500******************************************************************06650039
066600 9000-EOJ-ROUTINE.                                                06660039
066700     CLOSE SHUNLO-INPUT-FILE                                      06670039
066800           EXTRACT-FILE-OUT.                                      06680040
066900*          EXTRACT-FILE2-OUT.                                     06690040
067000                                                                  06700039
067100     MOVE PV-WRITE-COUNTER TO PV-DISPLAY-COUNT.                   06710039
067200     DISPLAY 'TOTAL RECORDS WRITTN TO OUTPUT 1 ' PV-DISPLAY-COUNT.06720039
067300*    MOVE PV-WRITE-COUNTER2 TO PV-DISPLAY-COUNT.                  06730040
067400*    DISPLAY 'TOTAL RECORDS WRITTN TO OUTPUT 2 ' PV-DISPLAY-COUNT.06740040
067500                                                                  06750039
067600******************************************************************06760039
067700*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    06770039
067800*  ERROR OR WARNING CODE OCCURS.                                  06780039
067900******************************************************************06790039
068000 9100-SQL-ABEND.                                                  06800039
068100     DISPLAY '9100-SQL-ABEND'.                                    06810039
068200     DISPLAY '** ABEND     **'.                                   06820039
068300     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        06830039
068400     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              06840039
068500     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     06850039
068600                                                                  06860039
068700*-----------------------------------------------------------------06870039
068800* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    06880039
068900* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         06890039
069000* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     06900039
069100* FORMAT.                                                         06910039
069200*-----------------------------------------------------------------06920039
069300     COPY DPPD004.                                                06930039
069400                                                                  06940039
069500     MOVE +4013                  TO ABEND-CODE.                   06950039
069600     CALL 'ILBOABN0' USING ABEND-CODE.                            06960039
