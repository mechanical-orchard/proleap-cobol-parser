000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    VNKUP023.                                         00020000
000300 AUTHOR.        MIKE BESKE.                                       00030000
000400 DATE-WRITTEN.  JANUARY 2010.                                     00040000
000500***************************************************************** 00050000
000600*  AUTOMATE UPDATE OF VENDOR/DEPT PAYMEMT TERMS ON TVNDAGR      * 00060001
000700*    COBOL II WITH DB2                                          * 00070000
000800***************************************************************** 00080000
000900*  THIS PROGRAM USES A CURSOR WITH CRITERIA TO SELECT THE       * 00090001
001000*  PAYMENT TERMS WHICH NEED TO BE UPDATED.  FURTHER FILTERING   * 00100001
001100*  WILL BE DONE IN THE PROGRAM LOGIC TO CHECK FOR BYPASSED      * 00110001
001200*  DEPARTMENTS.                                                 * 00120001
001210*                                                               * 00121001
001300*  FOR EACH ROW FETCHED THAT MEETS ALL THE UPDATE CRITERIA, THE * 00130001
001400*  CURRENT ROW ON TVNDAGR WILL BE RETIRED AND A NEW ROW WILL BE * 00140001
001500*  INSERTED TO REFLECT THE NEW PAYMENT TERM ID.                 * 00150001
001600*                                                               * 00160001
002100*  FOR EACH ROW INSERTED ON THE TVNDAGR TABLE, IF               * 00210000
002200*  ENT-ID HAS THE VND-IN-RMS-IND = 'Y', A MESSAGE RECORD WILL   * 00220000
002300*  BE FORMATTED AND WRITTEN TO THE OUTPUT FILE.  THIS FILE WILL * 00230000
002400*  BE USED AS INPUT TO PROGRAM VNKUT026 TO PUT MESSAGES TO THE  * 00240000
002500*  RMS SUPPLIER/PARTNER MESSAGE QUEUE.                          * 00250000
002600*                                                               * 00260000
002700***************************************************************** 00270000
002800* INPUT:                                                        * 00280000
002900*  1. LIST OF VENDORS TO BE BYPASSED                            * 00290008
002910*  2. PAYMENT TERMS CURSOR                                      * 00291008
003000*                                                               * 00300000
003100* OUTPUT:                                                       * 00310000
003200*  1. EXTRACT FILE TO CREATE MESSAGES     (COPYBOOK VNWS007)    * 00320000
003300*  2. LIST REPORT                                               * 00330000
003400*                                                               * 00340000
003500* DB2 TABLES:                                                   * 00350000
003600*  1. EXTERNAL ENTITY TABLE               (DCLGEN TEXTENT)      * 00360000
003700*  2. ENTITY NAME TABLE                   (DCLGEN TENTNME)      * 00370000
003800*  3. VENDOR DEPARTMENT TABLE             (DCLGEN TVNDDPT)      * 00380000
003900*  4. VENDOR AGREEMENT TABLE              (DCLGEN TVNDAGR)      * 00390000
004000*  5. PAYMENT TERMS TABLE                 (DCLGEN TPAYTRM)      * 00400000
004100*  6. FREIGHT TERMS TABLE                 (DCLGEN TFRGTRM)      * 00410008
004110*  7. VENDOR CAPABILITY TABLE             (DCLGEN VNT00001)     * 00411008
004200***************************************************************** 00420000
004300* CHANGES MADE:                                                 * 00430000
004400*    DATE  02/05/2010                                           * 00440000
004500*        CHANGE MADE: INITIAL IMPLEMENTATION                    * 00450000
004600*        MADE BY: MIKE BESKE              WR/IR #: WR37922      * 00460000
004700*                                                               * 00470000
004800*    DATE  09/29/2010                                           * 00480000
004900*        CHANGE MADE: ADDED LIST OF VENDOR NUMBERS TO THE       * 00490000
005000*        VENDOR_TERMS_CSR. THE LIST IS FOR PHASE 6 AND PHASE 7  * 00500000
005100*        TO EXTEND THE TERMS OF ACTIVE AND INACTIVE DEPTS       * 00510000
005200*        EFFECTIVE NOVEMBER 28.                                 * 00520000
005300*        MADE BY: MIKE BESKE              WR/IR #: WR39054      * 00530000
005310*                                                               * 00531000
005320*    DATE  05/01/2020                                           * 00532000
005330*        CHANGE MADE: MODIFIED THE PROGRAM TO UPDATE ALL        * 00533001
005340*        TERMS TO NET60, WITH THE EXCEPTION OF CONSUMER DIRECT  * 00534000
005350*        VENDORS, EXCLUDED DEPARTMENTS (BEAUTY) AND THOSE       * 00535001
005360*        ALREADY GREATER THAN 60 DAYS.   ADDED INPUT FILE       * 00536008
005361*        AND ARRAY TO ALLOW A LIST OF VENDORS TO BE BYPASSED.   * 00536113
005362*                                                               * 00536213
005363*        PROGRAM DOC INDICATES NEW IMPLENTATION AT THIS POINT   * 00536313
005364*        BECAUSE THE RETIRED DOC WAS NOT AVAILABLE.             * 00536413
005370*        MADE BY: NANCY EILBES            WR/IR #: CHG0243604   * 00537013
005380*                                                               * 00538000
005400***************************************************************** 00540000
005500 ENVIRONMENT DIVISION.                                            00550000
005600                                                                  00560000
005700 CONFIGURATION SECTION.                                           00570000
005800 SOURCE-COMPUTER. IBM-3090.                                       00580000
005900 OBJECT-COMPUTER. IBM-3090.                                       00590000
006000                                                                  00600000
006100 INPUT-OUTPUT SECTION.                                            00610000
006200 FILE-CONTROL.                                                    00620000
006300     SELECT VENDOR-BYPASS-FILE ASSIGN TO INP01.                   00630007
006310     SELECT VENDOR-MSG-FILE    ASSIGN TO OUT01.                   00631007
006400     SELECT LIST-REPORT        ASSIGN TO RPT01.                   00640000
006500                                                                  00650000
006600 DATA DIVISION.                                                   00660000
006700                                                                  00670000
006800 FILE SECTION.                                                    00680000
006900                                                                  00690000
007000 FD  VENDOR-BYPASS-FILE                                           00700007
007100     RECORDING MODE F                                             00710000
007200     LABEL RECORDS ARE STANDARD                                   00720000
007300     DATA RECORD IS BYPASS-RECORD.                                00730007
007400 01  VENDOR-BYPASS-RECORD        PIC X(80).                       00740007
007410                                                                  00741007
007420 FD  VENDOR-MSG-FILE                                              00742007
007430     RECORDING MODE F                                             00743007
007440     LABEL RECORDS ARE STANDARD                                   00744007
007450     DATA RECORD IS VENDOR-MSG-RECORD.                            00745007
007460 01  VENDOR-MSG-RECORD           PIC X(2262).                     00746007
007500                                                                  00750000
007600 FD  LIST-REPORT                                                  00760000
007700     RECORDING MODE IS F                                          00770000
007800     LABEL RECORDS ARE STANDARD                                   00780000
007900     RECORD CONTAINS 150 CHARACTERS                               00790000
008000     BLOCK CONTAINS 0 RECORDS                                     00800000
008100     DATA RECORD IS LIST-REC.                                     00810000
008200                                                                  00820000
008300 01  LIST-REC                    PIC X(150).                      00830000
008400                                                                  00840000
008500 WORKING-STORAGE SECTION.                                         00850000
008600                                                                  00860000
008700 01  PROGRAM-CONSTANTS.                                           00870000
008800     05  PC-PROGRAM-NAME         PIC  X(08)  VALUE 'VNKUP023'.    00880000
008900                                                                  00890000
009000 01  PC-PROGRAM-COUNTERS                             COMP-3.      00900000
009100     05  PC-PAGE-NBR-DETAIL          PIC S9(05)      VALUE ZERO.  00910000
009200     05  PC-DETAIL-REC-OUT           PIC 9(10)       VALUE ZERO.  00920000
009300                                                                  00930000
009400 01  CP-CONTROL-PRINT.                                            00940000
009500     05  CP-SPACE-CONTROL            PIC S9(01)      VALUE ZEROS. 00950000
009600     05  CP-LINE-MAX-DETAIL          PIC S9(03)      VALUE +053.  00960000
009700     05  CP-LINE-COUNT-DETAIL        PIC S9(03)      VALUE +099.  00970000
009800     05  CP-LINE-MAX-SUMMARY         PIC S9(03)      VALUE +053.  00980000
009900     05  CP-LINE-COUNT-SUMMARY       PIC S9(03)      VALUE +099.  00990000
010000                                                                  01000000
010100 01  PROGRAM-VARIABLES.                                           01010000
010200     05  ENT-ID-BEING-PROCESSED      PIC S9(09)   VALUE +0 COMP.  01020000
010300     05  DEPT-NBR-BEING-PROCESSED    PIC X(03)    VALUE SPACE.    01030000
010400     05  PAY-TRM-ID-BEING-PROCESSED  PIC S9(04)   VALUE +0 COMP.  01040000
010500     05  BYPASS-VND-COUNT            PIC 9(09)    VALUE 0.        01050007
010510     05  INPUT-COUNT                 PIC 9(09)    VALUE 0.        01051007
010600     05  OUTPUT-COUNT                PIC 9(09)    VALUE 0.        01060000
010700     05  UPDATE-COUNT                PIC 9(09)    VALUE 0.        01070000
010800     05  INSERT-COUNT                PIC 9(09)    VALUE 0.        01080000
010900     05  BYPASS-COUNT                PIC 9(09)    VALUE 0.        01090000
011000     05  EXISTS-COUNT                PIC 9(09)    VALUE 0.        01100000
011100     05  REPORT-COUNT                PIC 9(09)    VALUE 0.        01110000
011200     05  BYPASS-RMS-COUNT            PIC 9(09)    VALUE 0.        01120000
011300     05  NO-TERMS-FOUND-COUNT        PIC 9(09)    VALUE 0.        01130000
011400     05  SAVE-VND-IN-RMS-IND         PIC X(1)     VALUE SPACES.   01140000
011500     05  PV-MAX-SEQ-NBR              PIC S9(04) COMP.             01150000
011600     05  PV-FRGT-TERM-ID             PIC S9(04) COMP.             01160000
011700     05  PV-FRGT-SEQ-NBR             PIC S9(04) COMP.             01170000
011800     05  PV-ENT-ID-UNPK              PIC S9(09).                  01180000
011900     05  PV-ENT-ID-NOSIGN            PIC  9(09).                  01190000
012000     05  PV-DUN-NBR                  PIC  X(09).                  01200000
012100     05  PV-ENT-ID                   PIC S9(09) COMP.             01210000
012200     05  PV-VND-IN-RMS-IND           PIC  X(01).                  01220000
012300     05  PV-ENT-NAME-DESC            PIC  X(30).                  01230000
012400     05  PV-VND-STATUS               PIC  X(01).                  01240000
012500     05  PV-DEPT-NBR                 PIC  X(03).                  01250000
012600     05  PV-DEPT-STATUS              PIC  X(01).                  01260000
012700     05  PV-SEQ-NBR                  PIC S9(04) COMP.             01270000
012800     05  PV-CURR-PAY-TRM-ID          PIC S9(04) COMP.             01280000
012900     05  PV-CURR-DISC-DAYS           PIC S9(04) COMP.             01290000
013000     05  PV-DISCOUNT-DAYS-15         PIC S9(04) COMP.             01300000
013100     05  PV-CURR-DISC-PCT            PIC SV9(04) COMP-3.          01310000
013200     05  PV-CURR-DUE-DAYS            PIC S9(04) COMP.             01320000
013300     05  PV-DUE-DAY-15               PIC S9(04) COMP.             01330000
013400     05  PV-CURR-OTHER-TXT           PIC  X(25).                  01340000
013500     05  PV-CURR-FR-DT-TXT           PIC  X(17).                  01350000
013600     05  PV-NEW-PAY-TRM-ID           PIC S9(04) COMP.             01360000
013700     05  PV-NEW-DISC-DAYS            PIC S9(04) COMP.             01370000
013800     05  PV-NEW-DISC-PCT             PIC SV9(04) COMP-3.          01380000
013900     05  PV-NEW-DUE-DAYS             PIC S9(04) COMP.             01390000
014000     05  PV-NEW-OTHER-TXT            PIC  X(25).                  01400000
014100     05  PV-NEW-FR-DT-TXT            PIC  X(17).                  01410000
014200     05  PV-MESSAGE                  PIC  X(35).                  01420000
014210* FOLLOWING WAS LEFT FOR DOCUMENTATION.  LIST WAS ADDED TO THE    01421012
014211* CRITERIA IN THE CURSOR TO EXCLUDE THESE DEPARTMENTS.            01421112
014212     05  PV-BYPASS-DEPTS-CHK         PIC  X(3) VALUE SPACES.      01421212
014220         88  BYPASS-BEAUTY-DEPTS          VALUES '122'            01422000
014230                                               , '203'            01423000
014240                                               , '224'            01424000
014250                                               , '225'            01425000
014260                                               , '316'            01426000
014270                                               , '419'            01427000
014280                                               , '420'            01428000
014290                                               , '422'            01429000
014291                                               , '722'            01429100
014292                                               , '079'            01429200
014293                                               , '080'            01429300
014294                                               , '082'.           01429400
014300                                                                  01430000
014400 01  VENDORS-TO-BYPASS-TBL.                                       01440009
014401     05  VENDORS-TO-BYPASS OCCURS 100 TIMES INDEXED BY IDX1.      01440109
014402         10  BYPASS-VND-ID           PIC X(9) VALUE SPACES.       01440209
014410                                                                  01441005
014411 01  WS-BYPASS-RECORD.                                            01441107
014412     05  INPUT-VND-ID                PIC X(9)     VALUE SPACES.   01441207
014413     05  FILLER                      PIC X(71)    VALUE SPACES.   01441307
014414                                                                  01441407
014420 01  PROGRAM-SWITCHES.                                            01442005
014500     05  END-OF-BYPASS-FILE-SW       PIC X(01)    VALUE 'N'.      01450007
014600         88 NOT-END-OF-BYPASS-FILE                VALUE 'N'.      01460007
014700         88 END-OF-BYPASS-FILE                    VALUE 'Y'.      01470007
014701     05  BYPASS-VENDOR-SW            PIC X(01)    VALUE 'N'.      01470109
014702         88 DO-NOT-BYPASS-VENDOR                  VALUE 'N'.      01470209
014703         88 BYPASS-VENDOR                         VALUE 'Y'.      01470309
014710     05  PS-ENT-ID-FOUND-SW          PIC X(01)    VALUE 'N'.      01471007
014720         88 ENT-ID-NOTFOUND                       VALUE 'N'.      01472007
014730         88 ENT-ID-FOUND                          VALUE 'Y'.      01473007
014800     05  PS-FRGTRM-EXISTS-SW         PIC X(01)    VALUE 'N'.      01480000
014900         88 FRGTRM-FOUND                          VALUE 'N'.      01490000
015000         88 FRGTRM-NOT-FOUND                      VALUE 'Y'.      01500000
015100     05  PS-TVNDAGR-EXPIRE-DONE      PIC X(01)    VALUE 'N'.      01510000
015200         88 TVNDAGR-EXPIRE-DONE                   VALUE 'Y'.      01520000
015300         88 TVNDAGR-EXPIRE-NOT-DONE               VALUE 'N'.      01530000
015400     05  PS-TVNDAGR-INSERT-DONE      PIC X(01)    VALUE 'N'.      01540000
015500         88 TVNDAGR-INSERT-DONE                   VALUE 'Y'.      01550000
015600         88 TVNDAGR-INSERT-NOT-DONE               VALUE 'N'.      01560000
015700     05  PS-END-OF-VENDOR-TERMS-SW   PIC X(01)    VALUE 'N'.      01570000
015800         88 END-OF-VENDOR-TERMS                   VALUE 'Y'.      01580000
015900         88 NOT-END-OF-VENDOR-TERMS               VALUE 'N'.      01590000
016000     05  PS-FOUND-PROG-SPEC-ROWS-SW  PIC X(01)    VALUE 'N'.      01600000
016100         88 NEW-PROG-SPEC-ROWS                    VALUE 'N'.      01610000
016200         88 FOUND-PROG-SPEC-ROWS                  VALUE 'Y'.      01620000
016300     05  PS-END-OF-PROG-SPEC-CSR-SW  PIC X(01)    VALUE 'N'.      01630000
016400         88 END-OF-PROG-SPEC-CSR                  VALUE 'Y'.      01640000
016500         88 NOT-END-OF-PROG-SPEC-CSR              VALUE 'N'.      01650000
016600         88 EMPTY-PROG-SPEC-CSR                   VALUE 'E'.      01660000
016700                                                                  01670000
016800******************************************************************01680000
016900*  STANDARD KOHL'S HEADING LINE FOR A 150 COLUMN REPORT           01690000
017000******************************************************************01700000
017010*                                                                 01701012
017100*    COPY DPWS150.                                                01710012
017200*                                                                 01720012
017300*01  BL-BLANK-LINE                    PIC X(150)  VALUE SPACES.   01730012
017400*                                                                 01740012
017500*01  LR-HEADING-1.                                                01750012
017600*    05  FILLER                      PIC  X(49)      VALUE SPACE. 01760012
017700*    05  FILLER                      PIC  X(50)      VALUE        01770012
017800*        'VENDOR/DEPARTMENT PAYMENT TERMS UPDATE LISTING'.        01780012
017900*    05  FILLER                      PIC  X(51)      VALUE SPACE. 01790012
018000                                                                  01800000
018800 01  LR-HEADING-3.                                                01880000
018900     05  FILLER                      PIC  X(11)      VALUE        01890000
019000         'VENDOR NAME'.                                           01900000
019100     05  FILLER                      PIC  X(15)      VALUE SPACE. 01910000
019200     05  FILLER                      PIC  X(08)      VALUE        01920000
019300         'VENDOR #'.                                              01930000
019400     05  FILLER                      PIC  X(03)      VALUE SPACE. 01940000
019500     05  FILLER                      PIC  X(06)      VALUE        01950000
019600         'DEPT  '.                                                01960000
019700     05  FILLER                      PIC  X(05)      VALUE        01970000
019800         'STAT '.                                                 01980000
019900     05  FILLER                      PIC  X(10)      VALUE        01990000
020000         'CURR ID   '.                                            02000000
020100     05  FILLER                      PIC  X(04)      VALUE SPACE. 02010000
020200     05  FILLER                      PIC  X(10)      VALUE        02020000
020300         'NEW ID    '.                                            02030000
020400     05  FILLER                      PIC  X(02)      VALUE SPACE. 02040000
020500     05  FILLER                      PIC  X(08)      VALUE        02050000
020600         'MESSAGE '.                                              02060000
020700     05  FILLER                      PIC  X(02)      VALUE SPACE. 02070000
020800                                                                  02080000
020900 01  LR1-DETAIL-LINE.                                             02090000
021000     05  LR1-VEND-NAME               PIC  X(25)      VALUE SPACE. 02100000
021100     05  FILLER                      PIC  X(01)      VALUE SPACE. 02110000
021200     05  LR1-VEND-NBR                PIC  X(09)      VALUE SPACE. 02120000
021300     05  FILLER                      PIC  X(02)      VALUE SPACE. 02130000
021400     05  LR1-DEPT-NBR                PIC  X(07)      VALUE SPACE. 02140000
021500     05  FILLER                      PIC  X(01)      VALUE SPACE. 02150000
021600     05  LR1-DEPT-STATUS             PIC  X(01)      VALUE SPACE. 02160000
021700     05  FILLER                      PIC  X(02)      VALUE SPACE. 02170000
021800     05  LR1-CURR-PAY-TRM-ID         PIC  X(05)      VALUE SPACE. 02180000
021900     05  FILLER                      PIC  X(09)      VALUE SPACE. 02190000
022000     05  LR1-NEW-PAY-TRM-ID          PIC  X(05)      VALUE SPACE. 02200000
022100     05  FILLER                      PIC  X(07)      VALUE SPACE. 02210000
022200     05  LR1-MESSAGE                 PIC  X(35)      VALUE SPACE. 02220000
022300                                                                  02230000
022400 01  ERROR-MESSAGES.                                              02240000
022500     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                02250000
022600             '*****   PROGRAM: VNKUP023'.                         02260000
022700     05  AA-PARAGRAPH-LIT.                                        02270000
022800         10  FILLER              PIC  X(17)  VALUE                02280000
022900             '***** PARAGRAPH: '.                                 02290000
023000         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        02300000
023100     05  AA-MESSAGE-LINE.                                         02310000
023200         10  FILLER              PIC  X(06)  VALUE '*****'.       02320000
023300         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        02330000
023400     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                02340000
023500             '*****    DB2 ERROR'.                                02350000
023600     05  AA-DB2-OPERATION-LIT.                                    02360000
023700         10  FILLER              PIC  X(17)  VALUE                02370000
023800             '***** OPERATION: '.                                 02380000
023900         10  AA-DB2-OPERATION.                                    02390000
024000             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        02400000
024100             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        02410000
024200     05  AA-DB2-TABLE-1          PIC  X(18)  VALUE SPACES.        02420000
024300     05  AA-DB2-TABLE-2          PIC  X(18)  VALUE SPACES.        02430000
024400     05  AA-DB2-TABLE-3          PIC  X(18)  VALUE SPACES.        02440000
024500     05  AA-DB2-TABLE-4          PIC  X(18)  VALUE SPACES.        02450000
024600     05  AA-DB2-TABLE-5          PIC  X(18)  VALUE SPACES.        02460000
024700                                                                  02470000
024800 01  ABEND-CODE                    PIC S9(4)  COMP SYNC           02480000
024900                                              VALUE ZEROS.        02490000
025000     88 AP-DB2-ERROR               VALUE +4013.                   02500000
025100                                                                  02510000
025200*--------------------------------------------------------------*  02520000
025300* COPYBOOK FOR VENDOR MESSAGING RECORDS                        *  02530000
025400*--------------------------------------------------------------*  02540000
025500 01  VN007-COMMAREA.                                              02550000
025600     COPY VNWS007.                                                02560000
025700                                                                  02570000
025800*--------------------------------------------------------------*  02580000
025900*  DPWS004 CONTAINS THE FIELDS NECESSARY TO CALL THE SQLCA     *  02590000
026000*  MESSAGE MODULE 'DSNTIAR' AND DISPLAY THE FORMATTED RESULTS. *  02600000
026100*--------------------------------------------------------------*  02610000
026200     COPY DPWS004.                                                02620000
026300                                                                  02630000
026400*---------------------------------------------------------------  02640000
026500*  COMMUNICATIONS AREA2 FOR DB2                                   02650000
026600*---------------------------------------------------------------  02660000
026700     COPY SQLCA2.                                                 02670000
026800                                                                  02680000
026900*---------------------------------------------------------------  02690000
027000*     SQL COMMUNICATIONS AREA DCLGEN                              02700000
027100*---------------------------------------------------------------  02710000
027200     EXEC SQL                                                     02720000
027300         INCLUDE SQLCA                                            02730000
027400     END-EXEC.                                                    02740000
027500                                                                  02750000
027600*---------------------------------------------------------------  02760000
027700*     TEXTENT DCLGEN                                              02770000
027800*---------------------------------------------------------------  02780000
027900     EXEC SQL                                                     02790000
028000         INCLUDE TEXTENT                                          02800000
028100     END-EXEC.                                                    02810000
028200                                                                  02820000
028300*---------------------------------------------------------------  02830000
028400*     ENTITY NAME TABLE                                           02840000
028500*---------------------------------------------------------------  02850000
028600     EXEC SQL                                                     02860000
028700         INCLUDE TENTNME                                          02870000
028800     END-EXEC.                                                    02880000
028900                                                                  02890000
029000*---------------------------------------------------------------  02900000
029100*     VENDOR DEPARTMENT TABLE                                     02910000
029200*---------------------------------------------------------------  02920000
029300     EXEC SQL                                                     02930000
029400         INCLUDE TVNDDPT                                          02940000
029500     END-EXEC.                                                    02950000
029600                                                                  02960000
029700*---------------------------------------------------------------  02970000
029800*     VENDOR AGREEMENT TABLE                                      02980000
029900*---------------------------------------------------------------  02990000
030000     EXEC SQL                                                     03000000
030100         INCLUDE TVNDAGR                                          03010000
030200     END-EXEC.                                                    03020000
030300                                                                  03030000
030400*---------------------------------------------------------------  03040000
030500*     PAYMENT TERMS TABLE                                         03050000
030600*---------------------------------------------------------------  03060000
030700     EXEC SQL                                                     03070000
030800         INCLUDE TPAYTRM                                          03080000
030900     END-EXEC.                                                    03090000
031000                                                                  03100000
031100*---------------------------------------------------------------  03110000
031200*     FREIGHT TERMS TABLE                                         03120000
031300*---------------------------------------------------------------  03130000
031400     EXEC SQL                                                     03140000
031500         INCLUDE TFRGTRM                                          03150000
031600     END-EXEC.                                                    03160000
031700                                                                  03170000
031710*---------------------------------------------------------------  03171000
031720*     VENDOR CAPABILITY TABLE                                     03172000
031730*---------------------------------------------------------------  03173000
031740     EXEC SQL                                                     03174000
031750         INCLUDE VNT00001                                         03175000
031760     END-EXEC.                                                    03176000
031770                                                                  03177000
031800*--------------------------------------------------------------*  03180000
031900*  PAYMENT TERMS CURSOR                                           03190000
031910*  NOTE PAY TERM IDS 76 AND 238 ARE LETTER OF CREDIT AND IMPORT   03191001
031920*  OPEN ACCOUNT, RESPECTIVELY.                                    03192001
032000*--------------------------------------------------------------*  03200000
032100     EXEC SQL                                                     03210000
032200         DECLARE VENDOR_TERMS_CSR CURSOR FOR                      03220000
034800          SELECT A.DUN_NBR                                        03480000
034900                ,A.ENT_ID                                         03490000
035000                ,A.VND_IN_RMS_IND                                 03500000
035100                ,E.ENT_NAME_DESC                                  03510000
035200                ,A.STATUS_CDE                                     03520000
035300                ,B.DEPT_NBR                                       03530000
035400                ,B.VND_DEPT_STAT_CD                               03540000
035500                ,C.SEQ_NBR                                        03550000
035600                ,D.PAY_TERM_ID                                    03560000
035700                ,D.DISCOUNT_DAYS_QTY                              03570000
036300                ,D.DISCOUNT_PCT                                   03630000
036400                ,D.DUE_DAY_QTY                                    03640000
037000                ,D.OTHER_TXT                                      03700000
037100                ,D.DUE_DAY_FR_DTE_TXT                             03710000
037200           FROM TEXTENT A                                         03720000
037300               ,TENTNME E                                         03730000
037400               ,TVNDDPT B                                         03740000
037500               ,TVNDAGR C                                         03750000
037600               ,TPAYTRM D                                         03760000
266900          WHERE A.STATUS_CDE       = 'A'                          26690000
266910            AND A.PRIM_TYP_CDE     = 'M'                          26691001
267000            AND A.ENT_ID           = E.ENT_ID                     26700000
267100            AND E.TYPE_CDE         = '01'                         26710000
267200            AND A.ENT_ID           = B.ENT_ID                     26720000
267300            AND B.ENT_ID           = C.ENT_ID                     26730000
267400            AND B.DEPT_NBR         = C.DEPT_NBR                   26740000
267410            AND B.DEPT_NBR NOT IN ('122','203','224','225',       26741001
267420                '316','419','420','422','722','079','080','082')  26742001
267500            AND B.VND_DEPT_STAT_CD = 'A'                          26750000
267600            AND C.AGRMT_TYP_ID     = '2'                          26760000
267700            AND C.EFFECTIVE_DATE  <= CURRENT DATE                 26770000
267800            AND C.EXPIRATION_DATE >  CURRENT DATE                 26780000
267900            AND C.PAYT_TERM_ID     = D.PAY_TERM_ID                26790000
267910            AND (D.DUE_DAY_QTY      <  60                         26791003
267911                 OR D.DISCOUNT_DAYS_QTY <>  0)                    26791103
267920            AND C.PAYT_TERM_ID     NOT IN (76,238)                26792004
268200            AND C.SEQ_NBR =                                       26820000
268300                  (SELECT MAX(X.SEQ_NBR)                          26830000
268400                     FROM TVNDAGR X                               26840000
268500                    WHERE X.ENT_ID          = C.ENT_ID            26850000
268600                      AND X.DEPT_NBR        = C.DEPT_NBR          26860000
268700                      AND X.AGRMT_TYP_ID    = C.AGRMT_TYP_ID)     26870002
268800            AND NOT EXISTS                                        26880000
268810                  (SELECT 1                                       26881001
268900                     FROM VNT_VND_CPBL Z                          26890001
269000                    WHERE Z.ENT_ID = A.ENT_ID                     26900001
269100                      AND Z.VND_CPBL_CDE = 'CDS'                  26910001
269200                      AND CURRENT DATE BETWEEN Z.EFF_BEG_DTE      26920001
269300                                           AND Z.EFF_END_DTE)     26930001
272000                                                                  27200000
272100        ORDER BY A.DUN_NBR                                        27210000
272200                ,B.DEPT_NBR                                       27220000
272300                ,D.PAY_TERM_ID                                    27230000
272400          WITH UR                                                 27240000
272500     END-EXEC.                                                    27250000
272600                                                                  27260000
272700*---------------------------------------------------------------* 27270000
272800*  PROGRAMS FOR SPECIFIC DEPARTMENT CURSOR                      * 27280000
272900*---------------------------------------------------------------* 27290000
273000     EXEC SQL                                                     27300000
273100         DECLARE PROG_SPEC_DEPT_CSR CURSOR FOR                    27310000
273200         SELECT V.AGRMT_TYP_ID                                    27320000
273300              , V.TYP_CDE                                         27330000
273400              , COALESCE(V.DISCOUNT_PCT,0)                        27340000
273500              , COALESCE(V.EXT_PAY_DAYS_QTY,0)                    27350000
273600              , COALESCE(V.LEADTIME_DAYS_QTY,0)                   27360000
273700              , COALESCE(V.TKT_MKR_IND,'N')                       27370000
273800              , COALESCE(V.BULK_STK_TKT_IND,'N')                  27380000
273900           FROM TVNDAGR V                                         27390000
274000          WHERE V.ENT_ID           = :PV-ENT-ID                   27400000
274100            AND V.DEPT_NBR         = :PV-DEPT-NBR                 27410000
274200            AND ((V.AGRMT_TYP_ID   IN ('4') AND                   27420000
274300                  V.TYP_CDE        IN (1,2,4))                    27430000
274400              OR (V.AGRMT_TYP_ID   IN ('5') AND                   27440000
274500                  V.TYP_CDE        IN (1,7,8,9,10,11,12,13))      27450000
274600              OR (V.AGRMT_TYP_ID   IN ('6') AND                   27460000
274700                  V.TYP_CDE        IN (5)))                       27470000
274800            AND V.EXPIRATION_DATE >  CURRENT_DATE                 27480000
274900            AND V.EFFECTIVE_DATE  <= CURRENT_DATE                 27490000
275000         ORDER BY V.DEPT_NBR                                      27500000
275100                 ,V.AGRMT_TYP_ID                                  27510000
275200                 ,V.TYP_CDE                                       27520000
275300     END-EXEC.                                                    27530000
275400                                                                  27540000
275500 PROCEDURE DIVISION.                                              27550000
275600 A100-MAINLINE-ROUTINE.                                           27560000
275700                                                                  27570000
275800     PERFORM B100-INITIALIZATION.                                 27580000
275900                                                                  27590000
276000     PERFORM B200-PROCESS-VENDOR-TERMS                            27600000
276100       UNTIL END-OF-VENDOR-TERMS.                                 27610000
276200                                                                  27620000
276300     PERFORM B300-END-OF-JOB.                                     27630000
276400                                                                  27640000
276500     GOBACK.                                                      27650000
276600                                                                  27660000
276700*--------------------------------------------------------------*  27670000
276800*    INITIALIZATION PROCESSING                                 *  27680000
276900*--------------------------------------------------------------*  27690000
277000 B100-INITIALIZATION.                                             27700000
277100                                                                  27710000
277200     DISPLAY 'DATE ' FUNCTION CURRENT-DATE(1:8)                   27720000
277300     DISPLAY 'TIME ' FUNCTION CURRENT-DATE(9:6)                   27730000
277400                                                                  27740000
277500     OPEN INPUT  VENDOR-BYPASS-FILE                               27750007
277510     OPEN OUTPUT VENDOR-MSG-FILE                                  27751007
277600                 LIST-REPORT.                                     27760000
277700                                                                  27770000
277710*                                                                 27771012
277800*    MOVE FUNCTION CURRENT-DATE(1:4)  TO DP150-RUN-YEAR.          27780012
277900*    MOVE FUNCTION CURRENT-DATE(5:2)  TO DP150-RUN-MONTH.         27790012
278000*    MOVE FUNCTION CURRENT-DATE(7:2)  TO DP150-RUN-DAY.           27800012
278100*    MOVE FUNCTION CURRENT-DATE(9:2)  TO DP150-RUN-HOUR.          27810012
278200*    MOVE FUNCTION CURRENT-DATE(11:2) TO DP150-RUN-MINUTE.        27820012
278300*    MOVE PC-PROGRAM-NAME             TO DP150-PROGRAM-NAME,      27830012
278400                                                                  27840000
278410     PERFORM Q100-LOAD-BYPASS-TABLE.                              27841007
278420                                                                  27842007
278500     INITIALIZE DCLTEXTENT                                        27850000
278600                DCLTENTNME                                        27860000
278700                DCLTVNDDPT                                        27870000
278800                DCLTVNDAGR                                        27880000
278900                DCLTPAYTRM                                        27890000
279000                DCLTFRGTRM                                        27900001
279010                DCLVNT00001.                                      27901001
279100                                                                  27910000
279200     PERFORM Y100-OPEN-VENDOR-TERMS-CSR.                          27920000
279300                                                                  27930000
279400     PERFORM S100-FETCH-VENDOR-TERMS-CSR.                         27940000
279500                                                                  27950000
279600     IF END-OF-VENDOR-TERMS                                       27960000
279700        DISPLAY '** NO VENDOR TERMS FOUND **'                     27970001
279800     END-IF.                                                      27980000
279900                                                                  27990000
280000*---------------------------------------------------------------* 28000000
280100*  FOR EACH RECORD FETCHED,CHECK IF THE VENDOR IS IN THE BYPASS   28010007
280200*  LIST.  IF NOT, THEN UPDATE (EXPIRE) THE CURR_PAY_TRM_ID ROW ON 28020007
280400*  TVNDAGR FOR THE ENT-ID/DEPT-NBR FETCHED.  NEXT, INSERT A ROW   28040000
280500*  ON TVNDAGR USING THE NEW_PAY_TRM_ID FOR THE ENT-ID/DEPT-NBR    28050000
280600*  FETCHED.  IF THE UPDATE AND INSERT ARE SUCCESSFUL AND THE      28060000
280700*  VND_IN_RMS_IND = 'Y', THEN FORMAT AND WRITE AN OUTPUT RECORD   28070000
280800*  TO BRIDGE THE NEW_PAY_TRM_ID TO RMS SUPPLIER SYSTEM.           28080000
280900*---------------------------------------------------------------- 28090000
281000 B200-PROCESS-VENDOR-TERMS.                                       28100000
281100                                                                  28110000
281430*  NOTE THAT FOR THIS RUN, ALL TERMS ARE BEING SET TO NET 60 DAYS.28143007
281440*  PAYMENT TERM ID 3 IS FOR NET 60.                               28144007
281500     MOVE 3 TO PV-NEW-PAY-TRM-ID.                                 28150001
281600                                                                  28160001
281610     SET IDX1 TO 1.                                               28161007
281620     SET DO-NOT-BYPASS-VENDOR TO TRUE                             28162007
281630                                                                  28163007
281700     SEARCH VENDORS-TO-BYPASS                                     28170009
281710       AT END SET DO-NOT-BYPASS-VENDOR TO TRUE                    28171007
281720       WHEN BYPASS-VND-ID (IDX1) = PV-DUN-NBR                     28172007
281730            SET BYPASS-VENDOR TO TRUE                             28173007
281740     END-SEARCH.                                                  28174007
281750                                                                  28175007
281760     IF BYPASS-VENDOR                                             28176007
281770        CONTINUE                                                  28177007
281780     ELSE                                                         28178007
281800        PERFORM U100-UPDATE-TVNDAGR                               28180007
281900        PERFORM U200-INSERT-TVNDAGR                               28190007
282000                                                                  28200001
282100* COMMENTED BECAUSE THESE ARE EXECUTED IN U200 AFTER THE INSERT   28210011
282200*       IF PV-VND-IN-RMS-IND = 'Y'                                28220011
282400*          PERFORM C100-FORMAT-RMS-MESSAGE                        28240011
282500*          PERFORM W100-WRITE-VENDOR-MSG-RECORD                   28250011
282600*       END-IF                                                    28260011
282700                                                                  28270007
282800        PERFORM C200-BUILD-REPORT-LIST                            28280007
283600     END-IF.                                                      28360001
284200                                                                  28420000
284300     PERFORM S100-FETCH-VENDOR-TERMS-CSR.                         28430000
284400                                                                  28440000
284500*---------------------------------------------------------------* 28450000
284600*  B300-END-OF-JOB.                                               28460000
284700*---------------------------------------------------------------* 28470000
284800 B300-END-OF-JOB.                                                 28480000
284900                                                                  28490000
285000     PERFORM Y200-CLOSE-VENDOR-TERMS-CSR.                         28500000
285100     CLOSE VENDOR-BYPASS-FILE                                     28510007
285110           VENDOR-MSG-FILE                                        28511007
285200           LIST-REPORT.                                           28520000
285300                                                                  28530000
285400     DISPLAY 'BYPASS VENDORS READ.............' BYPASS-VND-COUNT. 28540007
285500     DISPLAY 'CURSOR RECORDS FETCHED..........' INPUT-COUNT.      28550007
285800     DISPLAY 'TVNDAGR ROWS UPDATED............' UPDATE-COUNT.     28580000
285900     DISPLAY 'TVNDAGR ROWS INSERTED...........' INSERT-COUNT.     28590000
286000     DISPLAY 'MESSAGE RECORDS WRITTEN.........' OUTPUT-COUNT.     28600000
286100     DISPLAY 'MESSAGE RECORDS BYPASSED........' BYPASS-RMS-COUNT. 28610000
286200     DISPLAY 'REPORT RECORDS WRITTEN..........' REPORT-COUNT.     28620000
286300                                                                  28630000
286400*---------------------------------------------------------------* 28640000
286500*  MOVES THE COLUMNS FROM THE VENDOR CURSOR INTO THE OUTPUT       28650000
286600*---------------------------------------------------------------* 28660000
286700 C100-FORMAT-RMS-MESSAGE.                                         28670000
286800                                                                  28680000
286900     INITIALIZE VN007-INTERFACE-MESSAGE-PARMS.                    28690000
287000                                                                  28700000
287100     MOVE PV-ENT-ID               TO VN007-ENT-ID.                28710000
287200     MOVE PV-DUN-NBR              TO VN007-VND-NBR.               28720000
287300                                                                  28730000
287400     MOVE PV-DEPT-NBR             TO VN007-DEPT-NBR(1).           28740000
287500     MOVE PV-DEPT-STATUS          TO VN007-VND-DEPT-STAT-CD(1).   28750000
287600     MOVE PV-NEW-PAY-TRM-ID       TO VN007-PAYT-TERM-ID(1).       28760000
287700     PERFORM S400-SELECT-FREIGHT-TERMS.                           28770000
287800     MOVE PV-FRGT-TERM-ID         TO VN007-FRGT-TERM-ID(1).       28780000
287900                                                                  28790000
288000     PERFORM Y300-OPEN-PROGS-SPECIFIC-CSR.                        28800000
288100     PERFORM S300-FETCH-PROGS-SPECIFIC-CSR.                       28810000
288200     SET VN007-DEPT-IND TO 1.                                     28820000
288300     SET NOT-END-OF-PROG-SPEC-CSR TO TRUE.                        28830000
288400     PERFORM N120-MOVE-SPECIFIC-PROGS-DATA                        28840000
288500                  UNTIL END-OF-PROG-SPEC-CSR                      28850000
288600                     OR EMPTY-PROG-SPEC-CSR.                      28860000
288700     PERFORM Y400-CLOSE-PROGS-SPECIFIC-CSR.                       28870000
288800                                                                  28880000
288900     PERFORM P100-POPULATE-NON-NULLS                              28890000
289000                  VARYING VN007-DEPT-IND FROM 1 BY 1              28900000
289100                  UNTIL VN007-DEPT-IND > 10.                      28910000
289200                                                                  28920000
289300*--------------------------------------------------------------*  28930000
289400* BUILDS THE DETAIL RECORD FOR THE DETAIL REPORT               *  28940000
289500*--------------------------------------------------------------*  28950000
289600 C200-BUILD-REPORT-LIST.                                          28960000
289700                                                                  28970000
289800     MOVE PV-ENT-NAME-DESC   TO LR1-VEND-NAME.                    28980000
289900                                                                  28990000
290000     MOVE PV-DUN-NBR         TO LR1-VEND-NBR.                     29000000
290100                                                                  29010000
290200     MOVE PV-DEPT-NBR        TO LR1-DEPT-NBR.                     29020000
290300                                                                  29030000
290400     MOVE PV-DEPT-STATUS     TO LR1-DEPT-STATUS.                  29040000
290500                                                                  29050000
290600     MOVE PV-CURR-PAY-TRM-ID TO LR1-CURR-PAY-TRM-ID.              29060000
290700                                                                  29070000
290800     MOVE PV-NEW-PAY-TRM-ID  TO LR1-NEW-PAY-TRM-ID.               29080000
290900                                                                  29090000
291000     MOVE PV-MESSAGE         TO LR1-MESSAGE.                      29100000
291100                                                                  29110000
291200     PERFORM W300-WRITE-REPORT-LIST-DETAIL.                       29120000
291300                                                                  29130000
291400*---------------------------------------------------------------* 29140000
291500*  POPULATES THE PARTS OF THE VNWS007 COPYBOOK NEEDED TO BUILD    29150000
291600*  THE MESSAGE FOR FETCHED ENT-ID/DEPT-NBR.                       29160000
291700*---------------------------------------------------------------* 29170000
291800 N120-MOVE-SPECIFIC-PROGS-DATA.                                   29180000
291900                                                                  29190000
292000     EVALUATE TRUE                                                29200000
292100         WHEN VNDAGR-AGRMT-TYP-ID = 4                             29210000
292200             EVALUATE TRUE                                        29220000
292300                 WHEN VNDAGR-TYP-CDE = 1                          29230000
292400                    MOVE VNDAGR-LEADTIME-DAYS-QTY TO              29240000
292500                         VN007-PRETKT-LEADTIME-QTY(VN007-DEPT-IND)29250000
292600                    MOVE VNDAGR-TKT-MKR-IND TO                    29260000
292700                         VN007-TKT-MKR-IND(VN007-DEPT-IND)        29270000
292800                    MOVE VNDAGR-BULK-STK-TKT-IND TO               29280000
292900                         VN007-BULK-STK-TKT-IND(VN007-DEPT-IND)   29290000
293000                 WHEN VNDAGR-TYP-CDE = 2                          29300000
293100                    MOVE 'Y' TO VN007-HANGER-IND(VN007-DEPT-IND)  29310000
293200                 WHEN VNDAGR-TYP-CDE = 4                          29320000
293300                    MOVE 'Y' TO                                   29330000
293400                         VN007-PACK-BY-STR-IND(VN007-DEPT-IND)    29340000
293500             END-EVALUATE                                         29350000
293600         WHEN VNDAGR-AGRMT-TYP-ID = 5                             29360000
293700             EVALUATE TRUE                                        29370000
293800                 WHEN VNDAGR-TYP-CDE = 1                          29380000
293900                    MOVE VNDAGR-DISCOUNT-PCT TO                   29390000
294000                         VN007-NSD-DISC-PCT(VN007-DEPT-IND)       29400000
294100                    MOVE VNDAGR-EXT-PAY-DAYS-QTY TO               29410000
294200                         VN007-NSD-EXT-DAYS-QTY(VN007-DEPT-IND)   29420000
294300                 WHEN VNDAGR-TYP-CDE = 7                          29430000
294400                    MOVE VNDAGR-DISCOUNT-PCT TO                   29440000
294500                         VN007-MOS-DISC-PCT(VN007-DEPT-IND)       29450000
294600                 WHEN VNDAGR-TYP-CDE = 8                          29460000
294700                    MOVE VNDAGR-DISCOUNT-PCT TO                   29470000
294800                         VN007-TRD-DISC-PCT(VN007-DEPT-IND)       29480000
294900                 WHEN VNDAGR-TYP-CDE = 9                          29490000
295000                    MOVE VNDAGR-DISCOUNT-PCT TO                   29500000
295100                         VN007-ADV-DISC-PCT(VN007-DEPT-IND)       29510000
295200                 WHEN VNDAGR-TYP-CDE = 10                         29520000
295300                    MOVE VNDAGR-DISCOUNT-PCT TO                   29530000
295400                         VN007-COOP-DISC-PCT(VN007-DEPT-IND)      29540000
295500                 WHEN VNDAGR-TYP-CDE = 11                         29550000
295600                    MOVE VNDAGR-DISCOUNT-PCT TO                   29560000
295700                       VN007-PRFTASST-ADCOOP-PCT(VN007-DEPT-IND)  29570000
295800                 WHEN VNDAGR-TYP-CDE = 12                         29580000
295900                    MOVE VNDAGR-EXT-PAY-DAYS-QTY TO               29590000
296000                         VN007-TBL-TWR-DAYS-QTY(VN007-DEPT-IND)   29600000
296100                 WHEN VNDAGR-TYP-CDE = 13                         29610000
296200                    MOVE VNDAGR-DISCOUNT-PCT TO                   29620000
296300                         VN007-BRDL-DISC-PCT(VN007-DEPT-IND)      29630000
296400             END-EVALUATE                                         29640000
296500         WHEN VNDAGR-AGRMT-TYP-ID = 6                             29650000
296600             EVALUATE TRUE                                        29660000
296700                 WHEN VNDAGR-TYP-CDE = 5                          29670000
296800                    MOVE VNDAGR-LEADTIME-DAYS-QTY TO              29680000
296900                         VN007-SPLIT-LEADTIME-QTY(VN007-DEPT-IND) 29690000
297000                    IF VNDAGR-LEADTIME-DAYS-QTY = ZERO            29700000
297100                       MOVE 'Y' TO                                29710000
297200                            VN007-SPLIT-REQD-IND(VN007-DEPT-IND)  29720000
297300                    ELSE                                          29730000
297400                       IF VNDAGR-LEADTIME-DAYS-QTY > ZERO         29740000
297500                          MOVE 'N' TO                             29750000
297600                           VN007-SPLIT-REQD-IND(VN007-DEPT-IND)   29760000
297700                       END-IF                                     29770000
297800                    END-IF                                        29780000
297900             END-EVALUATE                                         29790000
298000     END-EVALUATE.                                                29800000
298100                                                                  29810000
298200     PERFORM S300-FETCH-PROGS-SPECIFIC-CSR.                       29820000
298300                                                                  29830000
298400*---------------------------------------------------------------* 29840000
298500*  INITIALIZES THE PARTS OF THE VNWS007 COPYBOOK WITH DEFAULT     29850000
298600*  VALUES THAT DO NOT HAVE ACTUAL VALUES FROM THE CURSOR PROCESS. 29860000
298700*---------------------------------------------------------------* 29870000
298800 P100-POPULATE-NON-NULLS.                                         29880000
298900                                                                  29890000
299000     IF VN007-DEPT-NBR(VN007-DEPT-IND) NOT = SPACES               29900000
299100        IF VN007-BULK-STK-TKT-IND(VN007-DEPT-IND) = SPACE         29910000
299200           MOVE 'N' TO VN007-BULK-STK-TKT-IND(VN007-DEPT-IND)     29920000
299300        END-IF                                                    29930000
299400        IF VN007-TKT-MKR-IND(VN007-DEPT-IND) = SPACE              29940000
299500           MOVE 'N' TO VN007-TKT-MKR-IND(VN007-DEPT-IND)          29950000
299600        END-IF                                                    29960000
299700        IF VN007-HANGER-IND(VN007-DEPT-IND) = SPACE               29970000
299800           MOVE 'N' TO VN007-HANGER-IND(VN007-DEPT-IND)           29980000
299900        END-IF                                                    29990000
300000        IF VN007-PACK-BY-STR-IND(VN007-DEPT-IND) = SPACE          30000000
300100           MOVE 'N' TO VN007-PACK-BY-STR-IND(VN007-DEPT-IND)      30010000
300200        END-IF                                                    30020000
300300        IF VN007-SPLIT-REQD-IND(VN007-DEPT-IND) = SPACE           30030000
300400           MOVE 'N' TO VN007-SPLIT-REQD-IND(VN007-DEPT-IND)       30040000
300500        END-IF                                                    30050000
300600     END-IF.                                                      30060000
300700                                                                  30070000
300800*--------------------------------------------------------------*  30080000
300900*  READ THE VENDOR BYPASS INPUT FILE AND LOAD EACH ENTRY       *  30090007
301000*--------------------------------------------------------------*  30100000
301100 Q100-LOAD-BYPASS-TABLE.                                          30110007
301200                                                                  30120000
301201     PERFORM R100-READ-BYPASS-RECORD.                             30120107
301202                                                                  30120207
301203     SET IDX1 TO 1.                                               30120307
301204     PERFORM UNTIL END-OF-BYPASS-FILE                             30120407
301205        MOVE INPUT-VND-ID TO BYPASS-VND-ID (IDX1)                 30120507
301206        PERFORM R100-READ-BYPASS-RECORD                           30120607
301207        SET IDX1 UP BY 1                                          30120707
301208     END-PERFORM.                                                 30120807
301209                                                                  30120907
301210                                                                  30121007
301220*--------------------------------------------------------------*  30122007
301230*  READ THE VENDOR-BYPASS FILE INTO WORKING STORAGE.           *  30123007
301240*--------------------------------------------------------------*  30124007
301250 R100-READ-BYPASS-RECORD.                                         30125007
301260                                                                  30126007
301261     READ VENDOR-BYPASS-FILE   INTO WS-BYPASS-RECORD              30126107
301262         AT END SET END-OF-BYPASS-FILE TO TRUE.                   30126207
301263                                                                  30126307
301264     IF NOT END-OF-BYPASS-FILE                                    30126407
301265        ADD 1 TO BYPASS-VND-COUNT                                 30126507
301266     END-IF.                                                      30126607
301270                                                                  30127007
301280*--------------------------------------------------------------*  30128007
301290*  FETCH VENDOR_TERMS_CSR CURSOR                               *  30129007
301291*--------------------------------------------------------------*  30129107
301292 S100-FETCH-VENDOR-TERMS-CSR.                                     30129207
301293                                                                  30129307
301300     EXEC SQL                                                     30130000
301400       FETCH VENDOR_TERMS_CSR                                     30140000
301500        INTO :PV-DUN-NBR                                          30150000
301600           , :PV-ENT-ID                                           30160000
301700           , :PV-VND-IN-RMS-IND                                   30170000
301800           , :PV-ENT-NAME-DESC                                    30180000
301900           , :PV-VND-STATUS                                       30190000
302000           , :PV-DEPT-NBR                                         30200000
302100           , :PV-DEPT-STATUS                                      30210000
302200           , :PV-SEQ-NBR                                          30220000
302300           , :PV-CURR-PAY-TRM-ID                                  30230000
302400           , :PV-CURR-DISC-DAYS                                   30240000
302600           , :PV-CURR-DISC-PCT                                    30260000
302700           , :PV-CURR-DUE-DAYS                                    30270000
302900           , :PV-CURR-OTHER-TXT                                   30290000
303000           , :PV-CURR-FR-DT-TXT                                   30300000
303700     END-EXEC.                                                    30370000
303800                                                                  30380000
303900     EVALUATE TRUE                                                30390000
304000        WHEN SQLCODE = ZERO                                       30400000
304100          ADD 1 TO INPUT-COUNT                                    30410000
304200        WHEN SQLCODE = +100                                       30420000
304300          SET END-OF-VENDOR-TERMS       TO TRUE                   30430000
304400        WHEN SQLCODE = -904                                       30440000
304500        WHEN SQLCODE = -913                                       30450000
304600        WHEN SQLWARN0 NOT = SPACES                                30460000
304700        WHEN SQLCODE  NOT = ZERO                                  30470000
304800          MOVE 'S100-FETCH-VENDOR-TERMS-CSR' TO AA-PARAGRAPH-NAME 30480000
304900          MOVE 'UNSUCCESSFUL FETCH FROM VENDOR_TERMS_CSR'         30490000
305000                                        TO AA-DB2-OPERATION       30500000
305100          MOVE 'TEXTENT'                TO AA-DB2-TABLE-1         30510000
305200          MOVE 'TENTNME'                TO AA-DB2-TABLE-2         30520000
305300          MOVE 'TVNDDPT'                TO AA-DB2-TABLE-3         30530000
305400          MOVE 'TVNDAGR'                TO AA-DB2-TABLE-4         30540000
305500          MOVE 'TPAYTRM'                TO AA-DB2-TABLE-5         30550000
305600          PERFORM Z900-DB2-ERROR-ROUTINE                          30560000
305700     END-EVALUATE.                                                30570000
305800                                                                  30580000
305900*---------------------------------------------------------------* 30590000
306000*  FETCHES THE PROGRAMS FOR THE FETCHED ENT-ID/DEPT-NBR           30600000
306100*  THIS IS NEEDED TO BUILD THE MESSAGES FOR RMS SUPPLIER.         30610000
306200*---------------------------------------------------------------* 30620000
306300 S300-FETCH-PROGS-SPECIFIC-CSR.                                   30630000
306400                                                                  30640000
306500     EXEC SQL                                                     30650000
306600         FETCH PROG_SPEC_DEPT_CSR                                 30660000
306700          INTO :VNDAGR-AGRMT-TYP-ID                               30670000
306800             , :VNDAGR-TYP-CDE                                    30680000
306900             , :VNDAGR-DISCOUNT-PCT                               30690000
307000             , :VNDAGR-EXT-PAY-DAYS-QTY                           30700000
307100             , :VNDAGR-LEADTIME-DAYS-QTY                          30710000
307200             , :VNDAGR-TKT-MKR-IND                                30720000
307300             , :VNDAGR-BULK-STK-TKT-IND                           30730000
307400     END-EXEC.                                                    30740000
307500                                                                  30750000
307600     EVALUATE TRUE                                                30760000
307700         WHEN SQLCODE = ZEROES                                    30770000
307800             SET FOUND-PROG-SPEC-ROWS TO TRUE                     30780000
307900         WHEN SQLCODE = +100                                      30790000
308000             IF FOUND-PROG-SPEC-ROWS                              30800000
308100                SET END-OF-PROG-SPEC-CSR TO TRUE                  30810000
308200             ELSE                                                 30820000
308300                SET EMPTY-PROG-SPEC-CSR TO TRUE                   30830000
308400             END-IF                                               30840000
308500         WHEN OTHER                                               30850000
308600             MOVE 'S300-FETCH-PROGS-SPECIFIC-CSR'                 30860000
308700                                           TO AA-PARAGRAPH-NAME   30870000
308800             MOVE 'FETCH CURSOR - PROGRAMS SPECIFIC'              30880000
308900                                           TO AA-DB2-OPERATION    30890000
309000             MOVE 'TVNDAGR'                TO AA-DB2-TABLE-1      30900000
309100             MOVE 'TVNDDPT'                TO AA-DB2-TABLE-2      30910000
309500             PERFORM Z900-DB2-ERROR-ROUTINE                       30950000
309600     END-EVALUATE.                                                30960000
309700                                                                  30970000
309800*---------------------------------------------------------------* 30980000
309900*  SELECT THE FREIGHT TERMS ID FOR THE FETCHED ENT-ID/DEPT-NBR.   30990000
310000*  THIS IS NEEDED TO BUILD THE MESSAGES FOR RMS SUPPLIER.         31000000
310100*----------------------------------------------------------------*31010000
310200 S400-SELECT-FREIGHT-TERMS.                                       31020000
310300                                                                  31030000
310400     SET FRGTRM-NOT-FOUND TO TRUE.                                31040000
310500                                                                  31050000
310600     EXEC SQL                                                     31060000
310700        SELECT COALESCE(B.FRGT_TERM_ID,0)                         31070000
310800          INTO :PV-FRGT-TERM-ID                                   31080000
310900          FROM                                                    31090000
311000              (SELECT A.FRGT_TERM_ID                              31100000
311100                     ,A.SEQ_NBR                                   31110000
311200                 FROM TVNDAGR A                                   31120000
311300                WHERE A.ENT_ID           = :PV-ENT-ID             31130000
311400                  AND A.DEPT_NBR         = :PV-DEPT-NBR           31140000
311500                  AND A.AGRMT_TYP_ID     = '1'                    31150000
311600                  AND A.EFFECTIVE_DATE  <= CURRENT DATE           31160000
311700                  AND A.EXPIRATION_DATE >  CURRENT DATE           31170000
311800                  AND A.SEQ_NBR =                                 31180000
311900                      (SELECT MAX(X.SEQ_NBR)                      31190000
312000                         FROM TVNDAGR X                           31200000
312100                        WHERE X.ENT_ID       = A.ENT_ID           31210000
312200                          AND X.DEPT_NBR     = A.DEPT_NBR         31220000
312300                          AND X.AGRMT_TYP_ID = A.AGRMT_TYP_ID))   31230000
312400                                        AS VT1                    31240000
312500        LEFT OUTER JOIN TFRGTRM B                                 31250000
312600             ON B.FRGT_TERM_ID = VT1.FRGT_TERM_ID                 31260000
312700     END-EXEC.                                                    31270000
312800                                                                  31280000
312900     EVALUATE TRUE                                                31290000
313000         WHEN SQLCODE = ZEROES                                    31300000
313100              SET FRGTRM-FOUND TO TRUE                            31310000
313200         WHEN OTHER                                               31320000
313300             MOVE 'S400-SELECT-FREIGHT-TERMS' TO AA-PARAGRAPH-NAME31330000
313400             MOVE 'SELECT'                    TO AA-DB2-OPERATION 31340000
313500             MOVE 'TVNDAGR  '                 TO AA-DB2-TABLE-1   31350000
313600             MOVE 'TFRGTRM  '                 TO AA-DB2-TABLE-2   31360000
314000             PERFORM Z900-DB2-ERROR-ROUTINE                       31400000
314100     END-EVALUATE.                                                31410000
314200                                                                  31420000
314300*---------------------------------------------------------------* 31430000
314400*  UPDATES (EXPIRES) THE CURRENT PAYMENT TERMS ROW ON TVNDAGR     31440000
314500*  FOR THE FETCHED ENT-ID/DEPT-NBR.                               31450000
314600*---------------------------------------------------------------* 31460000
314700 U100-UPDATE-TVNDAGR.                                             31470000
314800                                                                  31480000
314810*     ADD +1 TO UPDATE-COUNT.                                     31481010
314830*     MOVE 'CURR PAYTRMS ROW EXPIRED' TO PV-MESSAGE.              31483010
314900     SET TVNDAGR-EXPIRE-NOT-DONE TO TRUE.                         31490010
315000                                                                  31500010
315100     EXEC SQL                                                     31510010
315200        UPDATE TVNDAGR                                            31520010
315300           SET EXPIRATION_DATE   = CURRENT DATE                   31530010
315400              ,LAST_UPD_ID       = :PC-PROGRAM-NAME               31540010
315500         WHERE ENT_ID            = :PV-ENT-ID                     31550010
315600           AND DEPT_NBR          = :PV-DEPT-NBR                   31560010
315700           AND AGRMT_TYP_ID      = '2'                            31570010
315800           AND SEQ_NBR           = :PV-SEQ-NBR                    31580010
315900     END-EXEC.                                                    31590010
316000                                                                  31600010
316100     EVALUATE TRUE                                                31610010
316200         WHEN SQLCODE = ZEROES                                    31620010
316300              ADD +1 TO UPDATE-COUNT                              31630010
316400              SET TVNDAGR-EXPIRE-DONE TO TRUE                     31640010
316500              MOVE 'CURR PAYTRMS ROW EXPIRED' TO PV-MESSAGE       31650010
316600         WHEN OTHER                                               31660010
316700             MOVE 'U100-UPDATE-TVNDAGR'  TO AA-PARAGRAPH-NAME     31670010
316800             MOVE 'UPDATE'               TO AA-DB2-OPERATION      31680010
316900             MOVE 'TVNDAGR'              TO AA-DB2-TABLE-1        31690010
317400             PERFORM Z900-DB2-ERROR-ROUTINE                       31740010
317500     END-EVALUATE.                                                31750010
317600                                                                  31760000
317700*---------------------------------------------------------------* 31770000
317800*  INSERT A ROW ON TVNDAGR FOR THE NEW PAYMENT TERMS FOR THE      31780000
317900*  FETCHED ENT-ID/DEPT-NBR.                                       31790000
318000*  NOTE:                                                          31800000
318100*  THE MAX SEQUENCE NUMBER WITHIN THE AGRMT_TYP_ID = 2 WILL BE    31810000
318200*  THE 1 + PV-SEQ-NBR FROM THE FETCHED ROW BEING PROCESSED.       31820000
318300*---------------------------------------------------------------* 31830000
318400 U200-INSERT-TVNDAGR.                                             31840000
318500                                                                  31850000
318510*    ADD +1 TO INSERT-COUNT.                                      31851010
318520*    SET TVNDAGR-INSERT-DONE TO TRUE.                             31852010
318600     SET TVNDAGR-INSERT-NOT-DONE TO TRUE.                         31860010
318700                                                                  31870010
318800     COMPUTE PV-MAX-SEQ-NBR = PV-SEQ-NBR + 1.                     31880010
318900                                                                  31890010
319000     EXEC SQL                                                     31900010
319100        INSERT INTO TVNDAGR                                       31910010
319200               ( ENT_ID                                           31920010
319300                ,DEPT_NBR                                         31930010
319400                ,AGRMT_TYP_ID                                     31940010
319500                ,SEQ_NBR                                          31950010
319600                ,EFFECTIVE_DATE                                   31960010
319700                ,EXPIRATION_DATE                                  31970010
319800                ,PROD_STATUS_IND                                  31980010
319900                ,PAYT_TERM_ID                                     31990010
320000                ,LAST_UPD_ID)                                     32000010
320100        VALUES ( :PV-ENT-ID                                       32010010
320200                ,:PV-DEPT-NBR                                     32020010
320300                ,'2'                                              32030010
320400                ,:PV-MAX-SEQ-NBR                                  32040010
320500                , CURRENT DATE                                    32050010
320600                ,'9999-12-31'                                     32060010
320700                ,'A'                                              32070010
320800                ,:PV-NEW-PAY-TRM-ID                               32080010
320900                ,:PC-PROGRAM-NAME)                                32090010
321000     END-EXEC.                                                    32100010
321100                                                                  32110010
321200     EVALUATE TRUE                                                32120010
321300         WHEN SQLCODE = ZEROES                                    32130010
321400              ADD +1 TO INSERT-COUNT                              32140010
321500              SET TVNDAGR-INSERT-DONE TO TRUE                     32150010
321600              MOVE 'NEW PAYTRMS ROW INSERTED' TO PV-MESSAGE       32160010
321700              IF PV-VND-IN-RMS-IND = 'Y'                          32170010
321800                 PERFORM C100-FORMAT-RMS-MESSAGE                  32180010
321900                 PERFORM W100-WRITE-VENDOR-MSG-RECORD             32190010
322000                 MOVE 'NEW PAYTRMS ROW INSERTED' TO PV-MESSAGE    32200010
322100              ELSE                                                32210010
322200                 ADD 1 TO BYPASS-RMS-COUNT                        32220010
322300              END-IF                                              32230010
322400         WHEN SQLCODE = -803                                      32240010
322500              MOVE 'DB2 -803 DUPLICATE PAYTERMS AVOIDED'          32250010
322600                                             TO PV-MESSAGE        32260010
322700         WHEN OTHER                                               32270010
322800             MOVE 'U200-INSERT-TVNDAGR'  TO AA-PARAGRAPH-NAME     32280010
322900             MOVE 'INSERT'               TO AA-DB2-OPERATION      32290010
323000             MOVE 'TVNDAGR'              TO AA-DB2-TABLE-1        32300010
323100             MOVE '       '              TO AA-DB2-TABLE-2        32310010
323200             MOVE '       '              TO AA-DB2-TABLE-3        32320010
323300             MOVE '       '              TO AA-DB2-TABLE-4        32330010
323400             MOVE '       '              TO AA-DB2-TABLE-5        32340010
323500             PERFORM Z900-DB2-ERROR-ROUTINE                       32350010
323600     END-EVALUATE.                                                32360010
323700                                                                  32370000
323800*----------------------------------------------------------------*32380000
323900*  W100-WRITE-VENDOR-MSG-RECORD                                  *32390000
324000*----------------------------------------------------------------*32400000
324100 W100-WRITE-VENDOR-MSG-RECORD.                                    32410000
324200                                                                  32420000
324300     WRITE VENDOR-MSG-RECORD FROM VN007-SENDING-FIELDS.           32430000
324400                                                                  32440000
324500     ADD 1 TO OUTPUT-COUNT.                                       32450000
324600                                                                  32460000
324700*--------------------------------------------------------------*  32470000
324800* WRITE REPORT LIST HEADINGS                                   *  32480000
324900*--------------------------------------------------------------*  32490000
324910*                                                                 32491012
325000*W200-WRITE-REPORT-LIST-HEADING.                                  32500012
325100*                                                                 32510012
325200*    MOVE 1                  TO DP150-REPORT-NUMBER.              32520012
325300*    ADD  1                  TO PC-PAGE-NBR-DETAIL.               32530012
325400*                                                                 32540012
325500*    MOVE PC-PAGE-NBR-DETAIL TO DP150-PAGE-NUMBER.                32550012
325600*                                                                 32560012
325700*    WRITE LIST-REC FROM BL-BLANK-LINE                            32570012
325800*          AFTER ADVANCING PAGE.                                  32580012
325900*                                                                 32590012
326000*    WRITE LIST-REC FROM DP150-STANDRD-HEADER-150-COLS            32600012
326100*          AFTER ADVANCING 1.                                     32610012
326200*                                                                 32620012
326300*    WRITE LIST-REC FROM LR-HEADING-1                             32630012
326400*          AFTER ADVANCING 2.                                     32640012
326500*                                                                 32650012
326600*    WRITE LIST-REC FROM BL-BLANK-LINE                            32660012
326700*          AFTER ADVANCING 1.                                     32670012
326800*                                                                 32680012
326900*    WRITE LIST-REC FROM LR-HEADING-3                             32690012
327000*          AFTER ADVANCING 2.                                     32700012
327100*                                                                 32710012
327200*    WRITE LIST-REC FROM BL-BLANK-LINE                            32720012
327300*          AFTER ADVANCING 1.                                     32730012
327400*                                                                 32740012
327500*    MOVE ZERO TO CP-LINE-COUNT-DETAIL.                           32750012
327600                                                                  32760000
327700*--------------------------------------------------------------*  32770000
327800*  WRITE REPORT LIST DETAIL                                    *  32780000
327900*--------------------------------------------------------------*  32790000
328000 W300-WRITE-REPORT-LIST-DETAIL.                                   32800000
328100                                                                  32810000
328200*    IF (CP-LINE-COUNT-DETAIL > CP-LINE-MAX-DETAIL)               32820012
328300*        PERFORM W200-WRITE-REPORT-LIST-HEADING.                  32830012
328400                                                                  32840000
328500     WRITE LIST-REC FROM LR1-DETAIL-LINE                          32850000
328600         AFTER ADVANCING 1 LINES.                                 32860000
328700*                                                                 32870012
328800*    WRITE LIST-REC FROM BL-BLANK-LINE                            32880012
328900*        AFTER ADVANCING 1 LINE.                                  32890012
329000                                                                  32900000
329100     ADD 1 TO PC-DETAIL-REC-OUT                                   32910000
329200              REPORT-COUNT.                                       32920000
329300*    ADD 2 TO CP-LINE-COUNT-DETAIL.                               32930012
329400                                                                  32940000
329500*--------------------------------------------------------------*  32950000
329600*  OPEN VENDOR_TERMS_CSR CURSOR                                   32960000
329700*--------------------------------------------------------------*  32970000
329800 Y100-OPEN-VENDOR-TERMS-CSR.                                      32980000
329900                                                                  32990000
330000     EXEC SQL                                                     33000000
330100        OPEN VENDOR_TERMS_CSR                                     33010000
330200     END-EXEC.                                                    33020000
330300                                                                  33030000
330400     EVALUATE TRUE                                                33040000
330500        WHEN SQLCODE = ZERO                                       33050000
330600          CONTINUE                                                33060000
330700        WHEN SQLWARN0 NOT = SPACES                                33070000
330800        WHEN SQLCODE  NOT = ZERO                                  33080000
330900          MOVE 'Y100-OPEN-VENDOR-TERMS-CSR' TO AA-PARAGRAPH-NAME  33090000
331000          MOVE 'UNSUCCESSFUL OPEN ON VENDOR_TERMS_CSR'            33100000
331100                                      TO AA-DB2-OPERATION         33110000
331200          MOVE 'TEXTENT'              TO AA-DB2-TABLE-1           33120000
331300          MOVE 'TENTNME'              TO AA-DB2-TABLE-2           33130000
331400          MOVE 'TVNDDPT'              TO AA-DB2-TABLE-3           33140000
331500          MOVE 'TVNDAGR'              TO AA-DB2-TABLE-4           33150000
331600          MOVE 'TPAYTRM'              TO AA-DB2-TABLE-5           33160000
331700          PERFORM Z900-DB2-ERROR-ROUTINE                          33170000
331800     END-EVALUATE.                                                33180000
331900                                                                  33190000
332000*--------------------------------------------------------------*  33200000
332100*   CLOSE VENDOR_TERMS_CSR CURSOR                              *  33210000
332200*--------------------------------------------------------------*  33220000
332300 Y200-CLOSE-VENDOR-TERMS-CSR.                                     33230000
332400                                                                  33240000
332500     EXEC SQL                                                     33250000
332600        CLOSE VENDOR_TERMS_CSR                                    33260000
332700     END-EXEC.                                                    33270000
332800                                                                  33280000
332900     EVALUATE TRUE                                                33290000
333000        WHEN SQLCODE = ZERO                                       33300000
333100          CONTINUE                                                33310000
333200        WHEN SQLWARN0 NOT = SPACES                                33320000
333300        WHEN SQLCODE  NOT = ZERO                                  33330000
333400          MOVE 'Y200-CLOSE-VENDOR-TERMS-CSR' TO AA-PARAGRAPH-NAME 33340000
333500          MOVE 'UNSUCCESSFUL CLOSE ON VENDOR_TERMS_CSR'           33350000
333600                                      TO AA-DB2-OPERATION         33360000
333700          MOVE 'TEXTENT'              TO AA-DB2-TABLE-1           33370000
333800          MOVE 'TENTNME'              TO AA-DB2-TABLE-2           33380000
333900          MOVE 'TVNDDPT'              TO AA-DB2-TABLE-3           33390000
334000          MOVE 'TVNDAGR'              TO AA-DB2-TABLE-4           33400000
334100          MOVE 'TPAYTRM'              TO AA-DB2-TABLE-5           33410000
334200          PERFORM Z900-DB2-ERROR-ROUTINE                          33420000
334300      END-EVALUATE.                                               33430000
334400                                                                  33440000
334500*---------------------------------------------------------------* 33450000
334600*  OPENS THE PROGRAMS FOR THE SPECIFIC DEPARTMENT CURSOR          33460000
334700*---------------------------------------------------------------* 33470000
334800 Y300-OPEN-PROGS-SPECIFIC-CSR.                                    33480000
334900                                                                  33490000
335000     EXEC SQL                                                     33500000
335100         OPEN PROG_SPEC_DEPT_CSR                                  33510000
335200     END-EXEC.                                                    33520000
335300                                                                  33530000
335400     EVALUATE TRUE                                                33540000
335500        WHEN SQLCODE = ZERO                                       33550000
335600          CONTINUE                                                33560000
335700        WHEN SQLWARN0 NOT = SPACES                                33570000
335800        WHEN SQLCODE  NOT = ZERO                                  33580000
335900          MOVE 'Y300-OPEN-PROGS-SPECIFIC-CSR' TO AA-PARAGRAPH-NAME33590000
336000          MOVE 'UNSUCCESSFUL OPEN ON PROG_SPEC_DEPT_CSR'          33600000
336100                                      TO AA-DB2-OPERATION         33610000
336200          MOVE 'TVNDAGR'              TO AA-DB2-TABLE-1           33620000
336300          MOVE 'TVNDDPT'              TO AA-DB2-TABLE-2           33630000
336400          MOVE '       '              TO AA-DB2-TABLE-3           33640000
336500          MOVE '       '              TO AA-DB2-TABLE-4           33650000
336600          MOVE '       '              TO AA-DB2-TABLE-5           33660000
336700          PERFORM Z900-DB2-ERROR-ROUTINE                          33670000
336800     END-EVALUATE.                                                33680000
336900                                                                  33690000
337000*---------------------------------------------------------------* 33700000
337100*  CLOSES THE PROGRAMS FOR THE SPECIFIC DEPARTMENT CURSOR.        33710000
337200*---------------------------------------------------------------* 33720000
337300 Y400-CLOSE-PROGS-SPECIFIC-CSR.                                   33730000
337400                                                                  33740000
337500     EXEC SQL                                                     33750000
337600         CLOSE PROG_SPEC_DEPT_CSR                                 33760000
337700     END-EXEC.                                                    33770000
337800                                                                  33780000
337900     EVALUATE TRUE                                                33790000
338000        WHEN SQLCODE = ZERO                                       33800000
338100          CONTINUE                                                33810000
338200        WHEN SQLWARN0 NOT = SPACES                                33820000
338300        WHEN SQLCODE  NOT = ZERO                                  33830000
338400          MOVE 'Y400-CLOSE-PROGS-SPECIFIC-CSR'                    33840000
338500                                           TO AA-PARAGRAPH-NAME   33850000
338600          MOVE 'UNSUCCESSFUL CLOSE ON PROG_SPEC_DEPT_CSR'         33860000
338700                                      TO AA-DB2-OPERATION         33870000
338800          MOVE 'TVNDAGR'              TO AA-DB2-TABLE-1           33880000
338900          MOVE 'TVNDDPT'              TO AA-DB2-TABLE-2           33890000
339000          MOVE '       '              TO AA-DB2-TABLE-3           33900000
339100          MOVE '       '              TO AA-DB2-TABLE-4           33910000
339200          MOVE '       '              TO AA-DB2-TABLE-5           33920000
339300          PERFORM Z900-DB2-ERROR-ROUTINE                          33930000
339400      END-EVALUATE.                                               33940000
339500                                                                  33950000
339600*--------------------------------------------------------------*  33960000
339700*     DB2 ERROR ROUTINE.                                          33970000
339800*--------------------------------------------------------------*  33980000
339900 Z900-DB2-ERROR-ROUTINE.                                          33990000
340000                                                                  34000000
340100     MOVE PV-ENT-ID TO PV-ENT-ID-UNPK.                            34010000
340200     MOVE PV-ENT-ID-UNPK TO PV-ENT-ID-NOSIGN.                     34020000
340300     DISPLAY 'ENT-ID BEING PROCESSED   = ' PV-ENT-ID-NOSIGN.      34030000
340400     DISPLAY 'DEPT-NBR BEING PROCESSED = ' PV-DEPT-NBR.           34040000
340500     DISPLAY '*** DB2 ERROR '.                                    34050000
340600     DISPLAY AA-DB2-ERROR-LIT.                                    34060000
340700     DISPLAY AA-PROGRAM-LIT.                                      34070000
340800     DISPLAY AA-PARAGRAPH-LIT.                                    34080000
340900     DISPLAY AA-DB2-OPERATION-LIT.                                34090000
341000     DISPLAY AA-DB2-TABLE-1.                                      34100000
341100     DISPLAY AA-DB2-TABLE-2.                                      34110000
341200     DISPLAY AA-DB2-TABLE-3.                                      34120000
341300     DISPLAY AA-DB2-TABLE-4.                                      34130000
341400     DISPLAY AA-DB2-TABLE-5.                                      34140000
341500     SET AP-DB2-ERROR TO TRUE.                                    34150000
341600                                                                  34160000
341700     COPY DPPD004.                                                34170000
341800     CALL 'ILBOABN0' USING ABEND-CODE.                            34180000
