000100 TITLE 'MAINTAIN LEGACY TALLPLN FROM RMS PO SYSTEM'.              00010036
000200 IDENTIFICATION DIVISION.                                         00020036
000300 PROGRAM-ID.    XLKUP010.                                         00030036
000400 AUTHOR.        DENNIS STEFFEN.                                   00040036
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050036
000600 DATE-WRITTEN.  MARCH 2003.                                       00060036
000700 DATE-COMPILED.                                                   00070036
000800******************************************************************00080036
000900* THIS PGM IS PART OF THE INTERFACING BETWEEN RMS PO & LEGACY PO. 00090036
001000******************************************************************00100036
001100 ENVIRONMENT DIVISION.                                            00110036
001200 CONFIGURATION SECTION.                                           00120036
001300 SOURCE-COMPUTER.  IBM-3090.                                      00130036
001400 OBJECT-COMPUTER.  IBM-3090.                                      00140036
001500 DATA DIVISION.                                                   00150036
001600                                                                  00160036
001700 WORKING-STORAGE SECTION.                                         00170036
001800                                                                  00180036
001900 01  PC-PROGRAM-CONSTANTS.                                        00190036
002000     05  PC-SQL-NOT-FOUND             PIC S9(3)  VALUE +100.      00200036
002100 01  PS-PROGRAM-SWITCHES.                                         00210036
002200     05  PS-PROCESS-CONTINUE-SW       PIC X(01)  VALUE 'Y'.       00220036
002300         88  PS-PROCESS-CONTINUE                 VALUE 'Y'.       00230036
002400         88  PS-PROCESS-END                      VALUE 'N'.       00240036
002500     05  PS-EXISTENCE-PO              PIC S9 COMP-3 VALUE ZERO.   00250036
002600         88  PS-PO-EXISTS-YES                       VALUE 1.      00260036
002700         88  PS-PO-EXISTS-NO                        VALUE ZERO.   00270036
002800     05  PS-EXISTENCE-PLAN            PIC S9 COMP-3 VALUE ZERO.   00280036
002900         88  PS-PLAN-EXISTS-YES                     VALUE 1.      00290036
003000         88  PS-PLAN-EXISTS-NO                      VALUE ZERO.   00300036
003100     05  PS-EXISTENCE-PURITM          PIC S9 COMP-3 VALUE ZERO.   00310036
003200         88  PS-PURITM-EXISTS-YES                   VALUE 1.      00320036
003300         88  PS-PURITM-EXISTS-NO                    VALUE ZERO.   00330036
003400     05  PS-PLAN-SW                   PIC X(01)   VALUE 'N'.      00340036
003500         88  PS-PLAN-NOT-FOUND-OK                 VALUE 'Y'.      00350036
003600     05  PS-PACK-YES-SW               PIC X(01)   VALUE SPACE.    00360036
003700         88  PS-PACK-YES                          VALUE 'Y'.      00370036
003800     05  PS-INSERT-TMESTDS-SW         PIC X(01)   VALUE SPACE.    00380036
003900         88  PS-INSERT-TMESTDS-YES                VALUE 'Y'.      00390036
004000         88  PS-INSERT-TMESTDS-NO                 VALUE 'N'.      00400036
004100 01  PV-CRAPOLA.                                                  00410036
004200     05  PV-DISP-SKU                  PIC 9(08)     VALUE ZERO.   00420036
004300     05  PV-DEST-NBR                  PIC 9(04)     VALUE ZERO.   00430036
004400                                                                  00440036
004500 01  DK-KEYS.                                                     00450036
004600     05  DK-PO-NBR                    PIC S9(09) COMP.            00460036
004700     05  DK-PO-LNE-NBR                PIC S9(09) COMP.            00470036
004800     05  DK-PLAN-NBR                  PIC S9(04) COMP.            00480036
004900     05  DK-DEST-NBR                  PIC S9(04) COMP.            00490036
005000     05  DK-STR-NBR                   PIC S9(04) COMP.            00500036
005100     05  DK-SKU-NBR                   PIC S9(8)V COMP-3.          00510036
005200/                                                                 00520036
005300*    NUMERIC EDITING ROUTINE                                      00530036
005400     COPY DPWS010I.                                               00540036
005500/                                                                 00550036
005600*    LEGACY PO HEADER                                             00560036
005700     EXEC SQL                                                     00570036
005800         INCLUDE TPURCHS                                          00580036
005900     END-EXEC.                                                    00590036
006000                                                                  00600036
006100*    LEGACY PO LINES                                              00610036
006200     EXEC SQL                                                     00620036
006300         INCLUDE TPURITM                                          00630036
006400     END-EXEC.                                                    00640036
006500                                                                  00650036
006600*    LEGACY PO PREPACK                                            00660036
006700     EXEC SQL                                                     00670036
006800         INCLUDE TPOPRPK                                          00680036
006900     END-EXEC.                                                    00690036
007000                                                                  00700036
007100*    LEGACY DC ALLOCATIONS                                        00710036
007200     EXEC SQL                                                     00720036
007300         INCLUDE TALLPLN                                          00730036
007400     END-EXEC.                                                    00740036
007500                                                                  00750036
007600*    LEGACY STORE DISTRO                                          00760036
007700     EXEC SQL                                                     00770036
007800         INCLUDE TMESTDS                                          00780036
007900     END-EXEC.                                                    00790036
008000                                                                  00800036
008100*    DOMAIN SKU TABLE                                             00810036
008200     EXEC SQL                                                     00820036
008300         INCLUDE XLT00003                                         00830036
008400     END-EXEC.                                                    00840036
008500                                                                  00850036
008600                                                                  00860036
008700     EXEC SQL                                                     00870036
008800          INCLUDE SQLCA                                           00880036
008900     END-EXEC.                                                    00890036
009000     COPY SQLCA2.                                                 00900036
009100* * *                                                             00910036
009200     EXEC SQL                                                     00920036
009300          DECLARE PACK-CSR CURSOR                                 00930036
009400          FOR SELECT DISTINCT                                     00940036
009500               PO_LNE_NBR                                         00950036
009600              ,PREPK_RATO_QTY                                     00960036
009700          FROM                                                    00970036
009800               TPURITM                                            00980036
009900         WHERE                                                    00990036
010000               PO_NBR         = :DK-PO-NBR                        01000036
010100           AND PO_PREPK_ID    = :POPRPK-PO-PREPK-ID               01010036
010200           AND VER_STATUS_CDE = 'A'                               01020036
010300     END-EXEC.                                                    01030036
010400                                                                  01040036
010500 LINKAGE SECTION.                                                 01050036
010600 01  XLRD011-RECORD.                                              01060036
010700     COPY XLRD011.                                                01070036
010800/                                                                 01080036
010900 PROCEDURE DIVISION USING XLRD011-RECORD.                         01090036
011000                                                                  01100036
011100* 1- GIVEN ARE PO-NBR AND SKU-NBR.  FROM THAT YOU MUST FIND       01110036
011200*    THE LINE FOR THAT ORDER THAT USES THAT SKU IF YOU ARE NOT    01120036
011300*    PROCESSING A PACK. FOR PACKS YOU GO TO TPOPRPK USING THE     01130036
011400*    SKU AND PROCESS THE LINES FOR AN ENTIRE PACK.                01140036
011500* 3- TPURCHS AND TPURITM MUST EXIST                               01150036
011600* 4- TALLPLN MUST EXIST BEFORE ADDING ANY TMESTDS                 01160036
011700* 5- IF XL011-  -LOCATION = 899 JUST EXIT THIS MODULE             01170036
011800                                                                  01180036
011900     INITIALIZE XL011-RETURN-AREA                                 01190036
012000                DK-KEYS                                           01200036
012100                PS-PACK-YES-SW                                    01210036
012200     SET XL011-SUCCESSFUL                                         01220036
012300         PS-PROCESS-CONTINUE        TO TRUE                       01230036
012400                                                                  01240036
012500     EVALUATE XL011-MSG-ID                                        01250036
012600       WHEN 'ORD_LOCATION_ADD'                                    01260036
012610*** PRB0051493 START                                              01261043
012700             IF XL011-LA-LOCATION = 899 OR                        01270042
012710                XL011-LA-LOCATION = 85                            01271042
012720*** PRB0051493 END                                                01272043
012800                 SET PS-PROCESS-END TO TRUE                       01280036
012900             END-IF                                               01290036
013000       WHEN 'ORD_LOC_QTY_CHANGE'                                  01300036
013010*** PRB0051493 START                                              01301043
013100             IF XL011-LQC-LOCATION = 899 OR                       01310042
013110                XL011-LQC-LOCATION = 85                           01311042
013120*** PRB0051493 END                                                01312043
013200                 SET PS-PROCESS-END TO TRUE                       01320036
013300             END-IF                                               01330036
013400       WHEN 'ORD_LOC_ATT_CHANGE'                                  01340038
013410*** PRB0051493 START                                              01341043
013500             IF XL011-LAC-LOCATION = 899 OR                       01350042
013510                XL011-LAC-LOCATION = 85                           01351042
013520*** PRB0051493 END                                                01352043
013600                 SET PS-PROCESS-END TO TRUE                       01360039
013700             END-IF                                               01370039
013800       WHEN 'ORD_LOCATION_DELETE'                                 01380039
013810*** PRB0051493 START                                              01381043
013900             IF XL011-LD-LOCATION = 899 OR                        01390042
013910                XL011-LD-LOCATION = 85                            01391042
013920*** PRB0051493 END                                                01392043
014000                 SET PS-PROCESS-END TO TRUE                       01400039
014100             END-IF                                               01410039
014200     END-EVALUATE.                                                01420039
014220                                                                  01422042
014300     IF PS-PROCESS-CONTINUE                                       01430039
014400*JPL     IF XL011-MSG-ID = 'ORD_LOCATION_ADD'                     01440039
014500***          PERFORM 0500-ZERO-QTY-CHK                            01450039
014600***      END-IF                                                   01460039
014700***      IF PS-PROCESS-CONTINUE                                   01470039
014800         PERFORM 1000-INITIALIZATION                              01480039
014900         IF PS-PROCESS-CONTINUE                                   01490039
015000            PERFORM 2000-PROCESS-MESSAGE                          01500039
015100         END-IF                                                   01510039
015200***      END-IF                                                   01520039
015300     END-IF.                                                      01530039
015400     PERFORM 9999-WRAPUP.                                         01540039
015500                                                                  01550039
015600     GOBACK.                                                      01560039
015700                                                                  01570039
015800 0500-ZERO-QTY-CHK.                                               01580039
015900     MOVE XL011-LA-ORD-QTY        TO DP010I-UNEDITED-FIELD        01590039
016000     MOVE 8                       TO DP010I-MAXIMUM-DIGITS        01600039
016100     MOVE 4                       TO DP010I-MAXIMUM-DECIMALS      01610039
016200     PERFORM 8100-NUMERIC-EDIT                                    01620039
016300     IF PS-PROCESS-CONTINUE                                       01630039
016400         IF DP010I-NUMERIC-FIELD = ZERO                           01640039
016500             MOVE XL011-LA-CNCLD-QTY                              01650039
016600                                  TO DP010I-UNEDITED-FIELD        01660039
016700             MOVE 8               TO DP010I-MAXIMUM-DIGITS        01670039
016800             MOVE 4               TO DP010I-MAXIMUM-DECIMALS      01680039
016900             PERFORM 8100-NUMERIC-EDIT                            01690039
017000             IF PS-PROCESS-CONTINUE                               01700039
017100                 IF DP010I-NUMERIC-FIELD = ZERO                   01710039
017200                     SET PS-PROCESS-END                           01720039
017300                                  TO TRUE                         01730039
017400                 END-IF                                           01740039
017500             END-IF                                               01750039
017600         END-IF                                                   01760039
017700     END-IF.                                                      01770039
017800                                                                  01780039
017900 1000-INITIALIZATION.                                             01790039
018000     IF XL011-DEBUG-YES                                           01800039
018100         DISPLAY 'XLKUP010 - 1000-INITIALIZATION'                 01810039
018200     END-IF                                                       01820039
018300                                                                  01830039
018400     MOVE 'XLKUP010'                  TO XL011-ERROR-PROGRAM.     01840039
018500     MOVE XL011-ORDER-NBR             TO DK-PO-NBR                01850039
018600                                                                  01860039
018700     IF XL011-MSG-ID NOT = 'HDR_DELETE'                           01870039
018800         PERFORM 7000-SELECT-TPURCHS                              01880039
018900         IF PS-PROCESS-CONTINUE                                   01890039
019000             IF PS-PO-EXISTS-NO                                   01900039
019100                 STRING 'NO TPURCHS FOR PO = ' XL011-ORDER-NBR    01910039
019200                     DELIMITED BY SIZE    INTO XL011-ERROR-TEXT   01920039
019300                 SET XL011-SYSTEM-ERROR                           01930039
019400                     PS-PROCESS-END       TO TRUE                 01940039
019500             ELSE                                                 01950039
019600                 PERFORM 1100-DOES-PURITM-EXIST                   01960039
019700             END-IF                                               01970039
019800         END-IF                                                   01980039
019900     END-IF.                                                      01990039
020000     IF XL011-MSG-ID NOT = 'HDR_DELETE'                           02000039
020100       IF PS-PROCESS-CONTINUE                                     02010039
020200         IF PS-PURITM-EXISTS-NO                                   02020039
020300             MOVE DK-SKU-NBR          TO PV-DISP-SKU              02030039
020400             STRING 'NO TPURITM FOR PO / SKU '                    02040039
020500                                           XL011-ORDER-NBR        02050039
020600                                      ' '  PV-DISP-SKU            02060039
020700                 DELIMITED BY SIZE    INTO XL011-ERROR-TEXT       02070039
020800             SET XL011-SYSTEM-ERROR                               02080039
020900                     PS-PROCESS-END    TO TRUE                    02090039
021000         ELSE                                                     02100039
021100             IF PS-PLAN-EXISTS-NO                                 02110039
021200               AND (XL011-MSG-ID = 'ORD_LOC_QTY_CHANGE'           02120039
021300                 OR XL011-MSG-ID = 'ORD_LOC_ATT_CHANGE')          02130039
021400                 MOVE DK-SKU-NBR        TO PV-DISP-SKU            02140039
021500                 STRING 'NO PLAN FOR PO = ' XL011-ORDER-NBR       02150039
021600                        ' SKU = ' PV-DISP-SKU                     02160039
021700                     DELIMITED BY SIZE    INTO XL011-ERROR-TEXT   02170039
021800                 IF XL011-DEBUG-YES                               02180039
021900                    DISPLAY 'XLKUP010 - 7400-FIND-TALLPLN-FOR-SKU'02190039
022000                    DISPLAY 'XLKUP010 - ' DK-SKU-NBR '/'          02200039
022100                             DK-PO-NBR '/' DK-DEST-NBR '/'        02210039
022200                             PURITM-PO-LNE-NBR                    02220039
022300                 END-IF                                           02230039
022400                 SET XL011-SYSTEM-ERROR                           02240039
022500                     PS-PROCESS-END     TO TRUE                   02250039
022600             END-IF                                               02260039
022610* GB 8/12/14 BEGIN                                                02261039
022620* COMMENT OUT FOLLOWING ERROR LOGIC                               02262039
022700*            IF PS-PLAN-EXISTS-YES                                02270039
022800*              AND XL011-MSG-ID = 'ORD_LOCATION_ADD'              02280039
022900*                MOVE DK-SKU-NBR        TO PV-DISP-SKU            02290039
023000*                MOVE DK-DEST-NBR       TO PV-DEST-NBR            02300039
023100*                STRING  'PLAN EXISTS: PO = ' XL011-ORDER-NBR     02310039
023200*                                   ' SKU = ' PV-DISP-SKU         02320039
023300*                                  ' DEST = ' PV-DEST-NBR         02330039
023400*                    DELIMITED BY SIZE    INTO XL011-ERROR-TEXT   02340039
023500*                SET XL011-SYSTEM-ERROR                           02350039
023600*                    PS-PROCESS-END     TO TRUE                   02360039
023700*            END-IF                                               02370039
023710* GB 8/12/14 END                                                  02371039
023800         END-IF                                                   02380039
023900       END-IF                                                     02390039
024000     END-IF.                                                      02400039
024100                                                                  02410039
024200                                                                  02420039
024300 1100-DOES-PURITM-EXIST.                                          02430039
024400                                                                  02440039
024500     IF XL011-DEBUG-YES                                           02450039
024600         DISPLAY 'XLKUP010 - 1100-DOES-PURITM-EXIST'              02460039
024700     END-IF                                                       02470039
024800                                                                  02480039
024900*    LOAD THE KEY FOR THE ITEM NBR LOOKUP                         02490039
025000     EVALUATE XL011-MSG-ID                                        02500039
025100       WHEN 'ORD_LOCATION_ADD'                                    02510039
025200             MOVE XL011-LA-COMP-SKU-NBR   TO DK-SKU-NBR           02520039
025300             MOVE XL011-LA-LOCATION       TO DK-DEST-NBR          02530039
025400             MOVE XL011-LA-PK-SKU-IND     TO PS-PACK-YES-SW       02540039
025500       WHEN 'ORD_LOC_QTY_CHANGE'                                  02550039
025600             MOVE XL011-LQC-COMP-SKU-NBR  TO DK-SKU-NBR           02560039
025700             MOVE XL011-LQC-LOCATION      TO DK-DEST-NBR          02570039
025800             MOVE XL011-LQC-PK-SKU-IND    TO PS-PACK-YES-SW       02580039
025900       WHEN 'ORD_LOC_ATT_CHANGE'                                  02590039
026000             MOVE XL011-LAC-COMP-SKU-NBR  TO DK-SKU-NBR           02600039
026100             MOVE XL011-LAC-LOCATION      TO DK-DEST-NBR          02610039
026200             MOVE XL011-LAC-PK-SKU-IND    TO PS-PACK-YES-SW       02620039
026300       WHEN 'ORD_LOCATION_DELETE'                                 02630039
026400             MOVE XL011-LD-COMP-SKU-NBR   TO DK-SKU-NBR           02640039
026500             MOVE XL011-LD-LOCATION       TO DK-DEST-NBR          02650039
026600             MOVE XL011-LD-PK-SKU-IND     TO PS-PACK-YES-SW       02660039
026700     END-EVALUATE.                                                02670039
026800                                                                  02680039
026900*    IF XL011-PACK-YES                                            02690039
027000*      OR PS-PACK-YES                                             02700039
027100     IF PS-PACK-YES                                               02710039
027200         PERFORM 7500-GET-PACK-ID                                 02720039
027300         IF PS-PROCESS-CONTINUE                                   02730039
027400             PERFORM 7510-OPEN-PACK-CSR                           02740039
027500             IF PS-PROCESS-CONTINUE                               02750039
027600                 PERFORM 7520-FETCH-PACK-CSR                      02760039
027700                 IF PS-PROCESS-CONTINUE                           02770039
027800                     IF SQLCODE = PC-SQL-NOT-FOUND                02780039
027900                         SET PS-PURITM-EXISTS-NO   TO TRUE        02790039
028000                     ELSE                                         02800039
028100                         SET PS-PURITM-EXISTS-YES                 02810039
028200                             PS-PLAN-NOT-FOUND-OK  TO TRUE        02820039
028300                         PERFORM 7410-FIND-TALLPLN-FOR-LINE       02830039
028400                         INITIALIZE PS-PLAN-SW                    02840039
028500                     END-IF                                       02850039
028600                 END-IF                                           02860039
028700             END-IF                                               02870039
028800         END-IF                                                   02880039
028900     ELSE                                                         02890039
029000*    FIND THE TPURITM FOR THE SKU WITHIN THE GIVEN ORDER          02900039
029100         PERFORM 7300-FIND-TPURITM-FOR-SKU                        02910039
029200         IF PS-PURITM-EXISTS-YES                                  02920039
029300*    FIND THE TALLPLN FOR THE SKU WITHIN THE GIVEN ORDER          02930039
029400             PERFORM 7400-FIND-TALLPLN-FOR-SKU                    02940039
029500         END-IF                                                   02950039
029600     END-IF.                                                      02960039
029700                                                                  02970039
029800     IF XL011-SUCCESSFUL                                          02980039
029900         MOVE PURITM-PO-LNE-NBR       TO DK-PO-LNE-NBR            02990039
030000         MOVE ALLPLN-PLAN-NBR         TO DK-PLAN-NBR              03000039
030100     END-IF.                                                      03010039
030200                                                                  03020039
030300/                                                                 03030039
030400 2000-PROCESS-MESSAGE.                                            03040039
030500                                                                  03050039
030600     IF XL011-DEBUG-YES                                           03060039
030700         DISPLAY 'XLKUP010 - 2000-PROCESS-MESSAGE'                03070039
030800     END-IF                                                       03080039
030900                                                                  03090039
031000*    LINE NUMBER AND PLAN HAVE ALREADY BEEN DETERMINED IN PARAGRAP03100039
031100*    1100-DOES-PURITM-EXIST                                       03110039
031200                                                                  03120039
031300     EVALUATE XL011-MSG-ID                                        03130039
031400                                                                  03140039
031500       WHEN 'ORD_LOCATION_ADD'                                    03150039
031501** GB 08/12/14 ADDED PS-PLAN-EXISTS-NO CHECK                      03150141
031502** GB 08/12/14 TO NOT CREATED DUPLICATE TALLPLN ENTRIES           03150241
031510             IF PS-PLAN-EXISTS-NO                                 03151041
031600                PERFORM 3000-CREATE-TALLPLN                       03160041
031700                IF XL011-SUCCESSFUL                               03170041
031800                    SET XL011-LOC-UPD-YES TO TRUE                 03180041
031900                END-IF                                            03190041
032000             END-IF                                               03200041
032100       WHEN 'ORD_LOC_QTY_CHANGE'                                  03210039
032200             PERFORM 2100-UPDATE-LOC-QTY                          03220039
032300                                                                  03230039
032400       WHEN 'ORD_LOC_ATT_CHANGE'                                  03240039
032500             PERFORM 2300-UPDATE-ORD-LOC-ATT                      03250039
032600                                                                  03260039
032700       WHEN 'ORD_LOCATION_DELETE'                                 03270039
032800           PERFORM 2500-DELETE-ALLOC                              03280039
032900           IF XL011-SUCCESSFUL                                    03290039
033000               SET XL011-LOC-UPD-YES TO TRUE                      03300039
033100           END-IF                                                 03310039
033200       WHEN 'HDR_DELETE'                                          03320039
033300           PERFORM 7112-DELETE-TALLPLN-PO                         03330039
033400           IF XL011-SUCCESSFUL                                    03340039
033500               SET XL011-LOC-UPD-YES TO TRUE                      03350039
033600           END-IF                                                 03360039
033700     END-EVALUATE.                                                03370039
033800/                                                                 03380039
033900 2100-UPDATE-LOC-QTY.                                             03390039
034000                                                                  03400039
034100     IF XL011-DEBUG-YES                                           03410039
034200         DISPLAY 'XLKUP010 - 2100-UPDATE-LOC-QTY'                 03420039
034300     END-IF                                                       03430039
034400                                                                  03440039
034500     IF XL011-LQC-PK-SKU-IND = 'Y'                                03450039
034600         PERFORM 2110-PACK-ORD-LOC-QTY                            03460039
034700             UNTIL PS-PROCESS-END                                 03470039
034800         IF XL011-SUCCESSFUL                                      03480039
034900             PERFORM 7530-CLOSE-PACK-CSR                          03490039
035000         END-IF                                                   03500039
035100     ELSE                                                         03510039
035200         MOVE XL011-LQC-ORD-QTY       TO DP010I-UNEDITED-FIELD    03520039
035300         MOVE 8                       TO DP010I-MAXIMUM-DIGITS    03530039
035400         MOVE 4                       TO DP010I-MAXIMUM-DECIMALS  03540039
035500         PERFORM 8100-NUMERIC-EDIT                                03550039
035600         IF PS-PROCESS-CONTINUE                                   03560039
035700             MOVE DP010I-NUMERIC-FIELD                            03570039
035800                                      TO ALLPLN-CURR-SPLIT-QTY    03580039
035900             MOVE XL011-LQC-CNCLD-QTY TO DP010I-UNEDITED-FIELD    03590039
036000             MOVE 8                   TO DP010I-MAXIMUM-DIGITS    03600039
036100             MOVE 4                   TO DP010I-MAXIMUM-DECIMALS  03610039
036200             PERFORM 8100-NUMERIC-EDIT                            03620039
036300             IF PS-PROCESS-CONTINUE                               03630039
036400                MOVE DP010I-NUMERIC-FIELD                         03640039
036500                                      TO ALLPLN-DC-SPLT-CNCLD-QTY 03650039
036600                PERFORM 7120-UPD-TALLPLN-ORD-QTY                  03660039
036601**GB 05/19/14                                                     03660139
036602**GB 05/19/14 ADD UPDATE TO TMESTDS FOR RMS13 DIRECT TO           03660239
036603**            PURCHASE ORDERS                                     03660339
036604                IF PS-PROCESS-CONTINUE                            03660439
036605                   PERFORM 4100-CHECK-TPURCHS                     03660539
036606                   IF PURCHS-DIR-STR-IND = 'Y'                    03660639
036607                      PERFORM 7205-UPDATE-TMESTDS-QTY             03660739
036608                   END-IF                                         03660839
036609                END-IF                                            03660939
036610**GB 05/19/14                                                     03661039
036620             END-IF                                               03662039
036630         END-IF                                                   03663039
036640     END-IF.                                                      03664039
036650                                                                  03665039
036660 2110-PACK-ORD-LOC-QTY.                                           03666039
036670                                                                  03667039
036680     IF XL011-DEBUG-YES                                           03668039
036690         DISPLAY 'XLKUP010 - 2110-PACK-ORD-LOC-QTY'               03669039
036700     END-IF                                                       03670039
036800                                                                  03680039
036900     MOVE XL011-LQC-ORD-QTY           TO DP010I-UNEDITED-FIELD    03690039
037000     MOVE 8                           TO DP010I-MAXIMUM-DIGITS    03700039
037100     MOVE 4                           TO DP010I-MAXIMUM-DECIMALS  03710039
037200     PERFORM 8100-NUMERIC-EDIT                                    03720039
037300     IF PS-PROCESS-CONTINUE                                       03730039
037400         COMPUTE ALLPLN-CURR-SPLIT-QTY =                          03740039
037500                 DP010I-NUMERIC-FIELD *                           03750039
037600                 PURITM-PREPK-RATO-QTY                            03760039
037700         END-COMPUTE                                              03770039
037800         MOVE XL011-LQC-CNCLD-QTY    TO DP010I-UNEDITED-FIELD     03780039
037900         MOVE 8                      TO DP010I-MAXIMUM-DIGITS     03790039
038000         MOVE 4                      TO DP010I-MAXIMUM-DECIMALS   03800039
038100         PERFORM 8100-NUMERIC-EDIT                                03810039
038200         IF PS-PROCESS-CONTINUE                                   03820039
038300            COMPUTE ALLPLN-DC-SPLT-CNCLD-QTY =                    03830039
038400                    DP010I-NUMERIC-FIELD *                        03840039
038500                    PURITM-PREPK-RATO-QTY                         03850039
038600         END-COMPUTE                                              03860039
038700         PERFORM 7120-UPD-TALLPLN-ORD-QTY                         03870039
038800         IF PS-PROCESS-CONTINUE                                   03880039
038900             PERFORM 7520-FETCH-PACK-CSR                          03890039
039000             IF PS-PROCESS-CONTINUE                               03900039
039100                 PERFORM 7410-FIND-TALLPLN-FOR-LINE               03910039
039200             END-IF                                               03920039
039300         END-IF                                                   03930039
039400     END-IF.                                                      03940039
039500                                                                  03950039
039600 2300-UPDATE-ORD-LOC-ATT.                                         03960039
039700                                                                  03970039
039800     IF XL011-DEBUG-YES                                           03980039
039900         DISPLAY 'XLKUP010 - 2300-UPDATE-ORD-LOC-ATT'             03990039
040000     END-IF                                                       04000039
040100                                                                  04010039
040200     IF XL011-LAC-PK-SKU-IND = 'Y'                                04020039
040300         PERFORM 2310-PACK-ORD-LOC-ATT                            04030039
040400             UNTIL PS-PROCESS-END                                 04040039
040500         IF XL011-SUCCESSFUL                                      04050039
040600             PERFORM 7530-CLOSE-PACK-CSR                          04060039
040700         END-IF                                                   04070039
040800     ELSE                                                         04080039
040900         PERFORM 2320-MOVE-AND-UPD-TALLPLN                        04090039
041000     END-IF.                                                      04100039
041100                                                                  04110039
041200 2310-PACK-ORD-LOC-ATT.                                           04120039
041300                                                                  04130039
041400     IF XL011-DEBUG-YES                                           04140039
041500         DISPLAY 'XLKUP010 - 2310-PACK-ORD-LOC-ATT'               04150039
041600     END-IF                                                       04160039
041700                                                                  04170039
041800     PERFORM 2320-MOVE-AND-UPD-TALLPLN                            04180039
041900     IF PS-PROCESS-CONTINUE                                       04190039
042000         PERFORM 7520-FETCH-PACK-CSR                              04200039
042100         IF PS-PROCESS-CONTINUE                                   04210039
042200             PERFORM 7410-FIND-TALLPLN-FOR-LINE                   04220039
042300         END-IF                                                   04230039
042400     END-IF.                                                      04240039
042500                                                                  04250039
042600 2320-MOVE-AND-UPD-TALLPLN.                                       04260039
042700                                                                  04270039
042800     IF XL011-DEBUG-YES                                           04280039
042900         DISPLAY 'XLKUP010 - 2320-MOVE-AND-UPD-TALLPLN'           04290039
043000     END-IF                                                       04300039
043100                                                                  04310039
043200     MOVE XL011-LAC-DC-ALLOC-MULT-QTY                             04320039
043300                                 TO ALLPLN-ALLOC-OUTR-PK-QTY      04330039
043400     MOVE XL011-LAC-STR-ALLOC-MULT-QTY                            04340039
043500                                 TO ALLPLN-ALOC-PACK-QTY          04350039
043600     MOVE XL011-LAC-ALLOC-MD-CDE TO ALLPLN-PK-SIZE-RND-CDE        04360039
043700     IF XL011-LAC-SHTG-PRRT-OPT-CDE = SPACE                       04370039
043800         MOVE 'S'                TO ALLPLN-SHTG-PRRT-OPT-CDE      04380039
043900     ELSE                                                         04390039
044000         MOVE XL011-LAC-SHTG-PRRT-OPT-CDE                         04400039
044100                                 TO ALLPLN-SHTG-PRRT-OPT-CDE      04410039
044200     END-IF                                                       04420039
044300     IF XL011-LAC-OVRG-PRRT-OPT-CDE = SPACE                       04430039
044400         MOVE 'R'                TO ALLPLN-OVRG-PRRT-OPT-CDE      04440039
044500     ELSE                                                         04450039
044600         MOVE XL011-LAC-OVRG-PRRT-OPT-CDE                         04460039
044700                                 TO ALLPLN-OVRG-PRRT-OPT-CDE      04470039
044800     END-IF                                                       04480039
044900     IF XL011-LAC-EXST-SHTG-THRS-IND = SPACE                      04490039
045000         MOVE 'N'                TO ALLPLN-EXST-SHTG-THRS-IND     04500039
045100     ELSE                                                         04510039
045200         MOVE XL011-LAC-EXST-SHTG-THRS-IND                        04520039
045300                                 TO ALLPLN-EXST-SHTG-THRS-IND     04530039
045400     END-IF.                                                      04540039
045500     PERFORM 7130-UPD-TALLPLN-ATTR.                               04550039
045600                                                                  04560039
045700 2500-DELETE-ALLOC.                                               04570039
045800                                                                  04580039
045900     IF XL011-DEBUG-YES                                           04590039
046000         DISPLAY 'XLKUP010 - 2500-DELETE-ALLOC'                   04600039
046100     END-IF                                                       04610039
046200                                                                  04620039
046300     IF XL011-LD-PK-SKU-IND = 'Y'                                 04630039
046400         PERFORM 2510-PACK-DELETE                                 04640039
046500            UNTIL PS-PROCESS-END                                  04650039
046600         IF XL011-SUCCESSFUL                                      04660039
046700             PERFORM 7530-CLOSE-PACK-CSR                          04670039
046800         END-IF                                                   04680039
046900     ELSE                                                         04690039
047000         PERFORM 7110-DELETE-TALLPLN-PLAN                         04700039
047100     END-IF.                                                      04710039
047200*    PERFORM 7210-DELETE-TMESTDS.                                 04720039
047300                                                                  04730039
047400 2510-PACK-DELETE.                                                04740039
047500     IF XL011-DEBUG-YES                                           04750039
047600         DISPLAY 'XLKUP010 - 2510-PACK-DELETE'                    04760039
047700     END-IF                                                       04770039
047800                                                                  04780039
047900     PERFORM 7110-DELETE-TALLPLN-PLAN                             04790039
048000     IF PS-PROCESS-CONTINUE                                       04800039
048100         PERFORM 7520-FETCH-PACK-CSR                              04810039
048200         IF PS-PROCESS-CONTINUE                                   04820039
048300             PERFORM 7410-FIND-TALLPLN-FOR-LINE                   04830039
048400         END-IF                                                   04840039
048500     END-IF.                                                      04850039
048600/                                                                 04860039
048700 3000-CREATE-TALLPLN.                                             04870039
048800                                                                  04880039
048900     IF XL011-DEBUG-YES                                           04890039
049000         DISPLAY 'XLKUP010 - 3000-CREATE-TALLPLN'                 04900039
049100     END-IF                                                       04910039
049200                                                                  04920039
049300     INITIALIZE DCLTALLPLN                                        04930039
049400*    IF XL011-PACK-YES                                            04940039
049500     IF XL011-LA-PK-SKU-IND = 'Y'                                 04950039
049600         PERFORM 3010-CREATE-PACK-TALLPLN                         04960039
049700             UNTIL PS-PROCESS-END                                 04970039
049800         IF XL011-SUCCESSFUL                                      04980039
049900             PERFORM 7530-CLOSE-PACK-CSR                          04990039
050000         END-IF                                                   05000039
050100     ELSE                                                         05010039
050200         MOVE XL011-LA-ORD-QTY        TO DP010I-UNEDITED-FIELD    05020039
050300         MOVE 8                       TO DP010I-MAXIMUM-DIGITS    05030039
050400         MOVE 4                       TO DP010I-MAXIMUM-DECIMALS  05040039
050500         PERFORM 8100-NUMERIC-EDIT                                05050039
050600         IF PS-PROCESS-CONTINUE                                   05060039
050700             MOVE DP010I-NUMERIC-FIELD                            05070039
050800                                      TO ALLPLN-CURR-SPLIT-QTY    05080039
051710             MOVE XL011-LA-CNCLD-QTY  TO DP010I-UNEDITED-FIELD    05171036
051720             MOVE 8                   TO DP010I-MAXIMUM-DIGITS    05172036
051730             MOVE 4                   TO DP010I-MAXIMUM-DECIMALS  05173036
051740             PERFORM 8100-NUMERIC-EDIT                            05174036
051750             IF PS-PROCESS-CONTINUE                               05175036
051760                MOVE DP010I-NUMERIC-FIELD                         05176036
051770                                      TO ALLPLN-DC-SPLT-CNCLD-QTY 05177036
051780                PERFORM 3020-BUILD-AND-INSERT                     05178036
051790             END-IF                                               05179036
051800* * * IF DIRECT STORE                                             05180036
051900             IF XL011-LA-LOC-TYP-CDE = 'S'                        05190036
052000               AND PS-PROCESS-CONTINUE                            05200036
052100                 PERFORM 4000-CREATE-TMESTDS                      05210036
052200             END-IF                                               05220036
052300                                                                  05230036
053300         END-IF                                                   05330036
053400     END-IF.                                                      05340036
053500                                                                  05350036
053600 3010-CREATE-PACK-TALLPLN.                                        05360036
053700                                                                  05370036
053800     IF XL011-DEBUG-YES                                           05380036
053900         DISPLAY 'XLKUP010 - 3010-CREATE-PACK-TALLPLN'            05390036
054000     END-IF                                                       05400036
054100                                                                  05410036
054200     MOVE XL011-LA-ORD-QTY            TO DP010I-UNEDITED-FIELD    05420036
054300     MOVE 8                           TO DP010I-MAXIMUM-DIGITS    05430036
054400     MOVE 4                           TO DP010I-MAXIMUM-DECIMALS  05440036
054500     PERFORM 8100-NUMERIC-EDIT                                    05450036
054600     IF PS-PROCESS-CONTINUE                                       05460036
054700         COMPUTE ALLPLN-CURR-SPLIT-QTY =                          05470036
054800              DP010I-NUMERIC-FIELD *                              05480036
054900              PURITM-PREPK-RATO-QTY                               05490036
055000         END-COMPUTE                                              05500036
055010         MOVE XL011-LA-CNCLD-QTY      TO DP010I-UNEDITED-FIELD    05501036
055020         MOVE 8                       TO DP010I-MAXIMUM-DIGITS    05502036
055030         MOVE 4                       TO DP010I-MAXIMUM-DECIMALS  05503036
055040         PERFORM 8100-NUMERIC-EDIT                                05504036
055050         IF PS-PROCESS-CONTINUE                                   05505036
055060            COMPUTE ALLPLN-DC-SPLT-CNCLD-QTY =                    05506036
055070                    DP010I-NUMERIC-FIELD *                        05507036
055080                    PURITM-PREPK-RATO-QTY                         05508036
055090            END-COMPUTE                                           05509036
055100            PERFORM 3020-BUILD-AND-INSERT                         05510036
055200* * * IF DIRECT STORE                                             05520036
055300            IF XL011-LA-LOC-TYP-CDE = 'S' AND                     05530036
055400               PS-PROCESS-CONTINUE                                05540036
055500                   PERFORM 4000-CREATE-TMESTDS                    05550036
055600            END-IF                                                05560036
055700            IF PS-PROCESS-CONTINUE                                05570036
055800               PERFORM 7520-FETCH-PACK-CSR                        05580036
055900            END-IF                                                05590036
055910         END-IF                                                   05591036
056000     END-IF.                                                      05600036
056100                                                                  05610036
057600 3020-BUILD-AND-INSERT.                                           05760036
057700                                                                  05770036
057800     IF XL011-DEBUG-YES                                           05780036
057900         DISPLAY 'XLKUP010 - 3020-BUILD-AND-INSERT'               05790036
058000         DISPLAY 'XLKUP010 - ' DK-PO-LNE-NBR ' / '                05800036
058100                              XL011-LA-LOCATION                   05810036
058200     END-IF                                                       05820036
058300                                                                  05830036
058400     MOVE DK-PO-NBR                   TO ALLPLN-PO-NBR            05840036
058500     MOVE DK-PO-LNE-NBR               TO ALLPLN-PO-LNE-NBR        05850036
058600     PERFORM 7420-FIND-NEXT-PLAN-NBR.                             05860036
058700     MOVE XL011-LA-STR-ALLOC-MULT-QTY TO ALLPLN-ALOC-PACK-QTY.    05870036
058800     MOVE XL011-LA-DC-ALLOC-MULT-QTY  TO ALLPLN-ALLOC-OUTR-PK-QTY.05880036
058900     MOVE XL011-LA-LOCATION           TO ALLPLN-DEST-NBR          05890036
059000     MOVE 'AC'                        TO ALLPLN-STATUS-CDE        05900036
059100     MOVE ZERO                        TO ALLPLN-DC-SPLIT-QTY      05910036
059200                                         ALLPLN-SPLIT-REQ-ID      05920036
059300                                         ALLPLN-DISTRO-REQ-ID     05930036
059400                                         ALLPLN-DISTRO-KEY-SEQ-NBR05940036
059500                                         ALLPLN-SPLIT-KEY-SEQ-NBR 05950036
059600     MOVE 'XLKUP010'                  TO ALLPLN-SPLIT-CRE-ID      05960036
059700     MOVE '0001-01-01'                TO ALLPLN-SPLIT-UPD-DATE    05970036
059800     MOVE SPACES                      TO ALLPLN-SPLIT-UPD-ID      05980036
059900                                         ALLPLN-DISTRO-CRE-ID     05990036
060000     MOVE XL011-LA-ALLOC-MD-CDE       TO ALLPLN-PK-SIZE-RND-CDE   06000036
060100     IF XL011-LA-SHTG-PRRT-OPT-CDE = SPACE                        06010036
060200         MOVE 'S'                TO ALLPLN-SHTG-PRRT-OPT-CDE      06020036
060300     ELSE                                                         06030036
060400         MOVE XL011-LA-SHTG-PRRT-OPT-CDE                          06040036
060500                                 TO ALLPLN-SHTG-PRRT-OPT-CDE      06050036
060600     END-IF                                                       06060036
060700     IF XL011-LA-OVRG-PRRT-OPT-CDE = SPACE                        06070036
060800         MOVE 'R'                TO ALLPLN-OVRG-PRRT-OPT-CDE      06080036
060900     ELSE                                                         06090036
061000         MOVE XL011-LA-OVRG-PRRT-OPT-CDE                          06100036
061100                                 TO ALLPLN-OVRG-PRRT-OPT-CDE      06110036
061200     END-IF                                                       06120036
061300     IF XL011-LA-EXST-SHTG-THRS-IND = SPACE                       06130036
061400         MOVE 'N'                TO ALLPLN-EXST-SHTG-THRS-IND     06140036
061500     ELSE                                                         06150036
061600         MOVE XL011-LA-EXST-SHTG-THRS-IND                         06160036
061700                                 TO ALLPLN-EXST-SHTG-THRS-IND     06170036
061800     END-IF.                                                      06180036
061900     PERFORM 7100-INSERT-TALLPLN.                                 06190036
062000/                                                                 06200036
062100 4000-CREATE-TMESTDS.                                             06210036
062200                                                                  06220036
062300     IF XL011-DEBUG-YES                                           06230036
062400         DISPLAY 'XLKUP010 - 4000-CREATE-TMESTDS'                 06240036
062500     END-IF                                                       06250036
062600                                                                  06260036
062700     INITIALIZE DCLTMESTDS.                                       06270036
062800     MOVE XL011-ORDER-NBR             TO MESTDS-PO-NBR            06280036
062900                                         DK-PO-NBR                06290036
063000     MOVE PURITM-PO-LNE-NBR           TO MESTDS-PO-LNE-NBR        06300036
063100     MOVE ALLPLN-PLAN-NBR             TO MESTDS-PLAN-NBR          06310036
063200     MOVE DK-DEST-NBR                 TO MESTDS-STR-NBR           06320036
063300     MOVE ALLPLN-CURR-SPLIT-QTY       TO MESTDS-STR-DISTRO-QTY.   06330036
063400*    MOVE                             TO MESTDS-ALLOC-SEQ-CDE     06340036
063500*                                     TO MESTDS-RNK-SEQ-NBR       06350036
063600*                                     TO MESTDS-STR-CNSTR-CDE     06360036
063700*                                     TO MESTDS-STR-CNSTR-QTY.    06370036
063800                                                                  06380036
063900*JPL                                                              06390036
064000     PERFORM 4100-CHECK-TPURCHS.                                  06400036
064100     IF PS-INSERT-TMESTDS-YES                                     06410036
064200         PERFORM 7200-INSERT-TMESTDS                              06420036
064300     END-IF.                                                      06430036
064400                                                                  06440036
064500 4100-CHECK-TPURCHS.                                              06450036
064600                                                                  06460036
064700     SET PS-INSERT-TMESTDS-NO TO TRUE.                            06470036
064800                                                                  06480036
064900     EXEC SQL                                                     06490036
065000         SELECT DIR_STR_IND                                       06500036
065100           INTO :PURCHS-DIR-STR-IND                               06510036
065200           FROM TPURCHS                                           06520036
065300          WHERE PO_NBR          = :DK-PO-NBR                      06530036
065400            AND VER_STATUS_CDE  = 'A'                             06540036
065500     END-EXEC.                                                    06550036
065600                                                                  06560036
065700     MOVE SQLCODE TO XL011-SQLCODE.                               06570036
065800     EVALUATE TRUE                                                06580036
065900       WHEN SQLCODE = ZERO                                        06590036
066000           IF PURCHS-DIR-STR-IND = 'Y'                            06600036
066100               SET PS-INSERT-TMESTDS-YES TO TRUE                  06610036
066200           END-IF                                                 06620036
066300       WHEN SQLCODE = +100                                        06630036
066400           CONTINUE                                               06640036
066500       WHEN OTHER                                                 06650036
066600           SET XL011-SQL-ERROR                                    06660036
066700               PS-PROCESS-END        TO TRUE                      06670036
066800           MOVE '4100-CHECK-TPURCHS' TO XL011-ERROR-PARAGRAPH     06680036
066900           MOVE 'TPURCHS'            TO XL011-DB2-TABLE-NAME(1)   06690036
067000     END-EVALUATE.                                                06700036
067100/                                                                 06710036
067200 7000-SELECT-TPURCHS.                                             06720036
067300                                                                  06730036
067400     IF XL011-DEBUG-YES                                           06740036
067500         DISPLAY 'XLKUP010 - 7000-SELECT-TPURCHS'                 06750036
067600         DISPLAY 'XLKUP010 - DK-PO-NBR = ' DK-PO-NBR              06760036
067700     END-IF                                                       06770036
067800                                                                  06780036
067900     MOVE ZERO                        TO PS-EXISTENCE-PO          06790036
068000                                                                  06800036
068100     EXEC SQL                                                     06810036
068200         SELECT 1                                                 06820036
068300         INTO                                                     06830036
068400             :PS-EXISTENCE-PO                                     06840036
068500         FROM                                                     06850036
068600             TPURCHS                                              06860036
068700         WHERE                                                    06870036
068800             PO_NBR                   = :DK-PO-NBR                06880036
068900         AND VER_STATUS_CDE           = 'A'                       06890036
069000         FETCH FIRST 1 ROWS ONLY                                  06900036
069100     END-EXEC.                                                    06910036
069200                                                                  06920036
069300     MOVE SQLCODE                     TO XL011-SQLCODE            06930036
069400     EVALUATE TRUE                                                06940036
069500         WHEN SQLCODE = ZERO                                      06950036
069600         WHEN SQLCODE = +100                                      06960036
069700             CONTINUE                                             06970036
069800         WHEN OTHER                                               06980036
069900             SET XL011-SQL-ERROR                                  06990036
070000                 PS-PROCESS-END       TO TRUE                     07000036
070100             MOVE '7000-SELECT-TPURCHS'                           07010036
070200                                      TO XL011-ERROR-PARAGRAPH    07020036
070300             MOVE 'TPURCHS'           TO XL011-DB2-TABLE-NAME(1)  07030036
070400     END-EVALUATE.                                                07040036
070500/                                                                 07050036
070600 7100-INSERT-TALLPLN.                                             07060036
070700                                                                  07070036
070800     IF XL011-DEBUG-YES                                           07080036
070900         DISPLAY 'XLKUP010 - 7100-INSERT-TALLPLN'                 07090036
071000         DISPLAY 'XLKUP010 - ' ALLPLN-PO-NBR '/'                  07100036
071100                 ALLPLN-PO-LNE-NBR '/' ALLPLN-PLAN-NBR '/'        07110036
071200                 ALLPLN-DEST-NBR                                  07120036
071300     END-IF                                                       07130036
071400                                                                  07140036
071500     EXEC SQL                                                     07150036
071600         INSERT INTO TALLPLN                                      07160036
071700             (                                                    07170036
071800             PO_NBR                                               07180036
071900            ,PO_LNE_NBR                                           07190036
072000            ,PLAN_NBR                                             07200036
072100            ,CURR_SPLIT_QTY                                       07210036
072200            ,DEST_NBR                                             07220036
072300            ,STATUS_CDE                                           07230036
072400            ,DC_SPLIT_QTY                                         07240036
072500            ,SPLIT_REQ_ID                                         07250036
072600            ,SPLIT_CRE_DATE                                       07260036
072700            ,SPLIT_CRE_ID                                         07270036
072800            ,SPLIT_UPD_DATE                                       07280036
072900            ,SPLIT_UPD_ID                                         07290036
073000            ,DISTRO_REQ_ID                                        07300036
073100            ,DISTRO_CRE_DATE                                      07310036
073200            ,DISTRO_CRE_ID                                        07320036
073300            ,DISTRO_KEY_SEQ_NBR                                   07330036
073400            ,SPLIT_KEY_SEQ_NBR                                    07340036
073500            ,ALOC_PACK_QTY                                        07350036
073600            ,PK_SIZE_RND_CDE                                      07360036
073700            ,ALLOC_OUTR_PK_QTY                                    07370036
073800            ,DC_SPLT_CNCLD_QTY                                    07380036
073900         )                                                        07390036
074000         VALUES                                                   07400036
074100         (                                                        07410036
074200               :ALLPLN-PO-NBR                                     07420036
074300           ,   :ALLPLN-PO-LNE-NBR                                 07430036
074400           ,   :ALLPLN-PLAN-NBR                                   07440036
074500           ,   :ALLPLN-CURR-SPLIT-QTY                             07450036
074600           ,   :ALLPLN-DEST-NBR                                   07460036
074700           ,   :ALLPLN-STATUS-CDE                                 07470036
074800           ,   :ALLPLN-DC-SPLIT-QTY                               07480036
074900           ,   :ALLPLN-SPLIT-REQ-ID                               07490036
075000           ,   CURRENT DATE                                       07500036
075100           ,   :ALLPLN-SPLIT-CRE-ID                               07510036
075200           ,   :ALLPLN-SPLIT-UPD-DATE                             07520036
075300           ,   :ALLPLN-SPLIT-UPD-ID                               07530036
075400           ,   :ALLPLN-DISTRO-REQ-ID                              07540036
075500           ,   CURRENT DATE                                       07550036
075600           ,   :ALLPLN-DISTRO-CRE-ID                              07560036
075700           ,   :ALLPLN-DISTRO-KEY-SEQ-NBR                         07570036
075800           ,   :ALLPLN-SPLIT-KEY-SEQ-NBR                          07580036
075900           ,   :ALLPLN-ALOC-PACK-QTY                              07590036
076000           ,   :ALLPLN-PK-SIZE-RND-CDE                            07600036
076100           ,   :ALLPLN-ALLOC-OUTR-PK-QTY                          07610036
076200           ,   :ALLPLN-DC-SPLT-CNCLD-QTY                          07620036
076300                                                                  07630036
076400             )                                                    07640036
076500        END-EXEC                                                  07650036
076600                                                                  07660036
076700     MOVE SQLCODE                     TO XL011-SQLCODE            07670036
076800     EVALUATE TRUE                                                07680036
076900         WHEN SQLCODE = ZERO                                      07690036
077000         WHEN SQLCODE = -803                                      07700036
077100             CONTINUE                                             07710036
077200         WHEN OTHER                                               07720036
077300            DISPLAY 'XLKUP010 - PROBLEM WHEN INSERTING-START INFO'07730036
077400             DISPLAY 'XLKUP010 - ' ALLPLN-PO-NBR ' / '            07740036
077500                      ALLPLN-PO-LNE-NBR '/' ALLPLN-PLAN-NBR       07750036
077600             DISPLAY 'XLKUP010 - PROBLEM WHEN INSERTING-END INFO' 07760036
077700             SET XL011-SQL-ERROR                                  07770036
077800                 PS-PROCESS-END       TO TRUE                     07780036
077900             MOVE '7100-INSERT-TALLPLN'                           07790036
078000                                      TO XL011-ERROR-PARAGRAPH    07800036
078100             MOVE 'TALLPLN'           TO XL011-DB2-TABLE-NAME(1)  07810036
078200     END-EVALUATE.                                                07820036
078300/                                                                 07830036
078400 7110-DELETE-TALLPLN-PLAN.                                        07840036
078500                                                                  07850036
078600     IF XL011-DEBUG-YES                                           07860036
078700         DISPLAY 'XLKUP010 - 7110-DELETE-TALLPLN-PLAN'            07870036
078800         DISPLAY 'XLKUP010 - ' DK-PO-NBR '/'                      07880036
078900                 DK-PO-LNE-NBR '/' DK-PLAN-NBR                    07890036
079000     END-IF                                                       07900036
079100                                                                  07910036
079200     EXEC SQL                                                     07920036
079300         DELETE                                                   07930036
079400         FROM                                                     07940036
079500             TALLPLN                                              07950036
079600         WHERE                                                    07960036
079700             PO_NBR                   = :DK-PO-NBR                07970036
079800         AND PO_LNE_NBR               = :DK-PO-LNE-NBR            07980036
079900         AND PLAN_NBR                 = :DK-PLAN-NBR              07990036
080000     END-EXEC.                                                    08000036
080100                                                                  08010036
080200     MOVE SQLCODE                     TO XL011-SQLCODE            08020036
080300     EVALUATE TRUE                                                08030036
080400         WHEN SQLCODE = ZERO                                      08040036
080500         WHEN SQLCODE = +100                                      08050036
080600             CONTINUE                                             08060036
080700     WHEN OTHER                                                   08070036
080800         SET XL011-SQL-ERROR                                      08080036
080900             PS-PROCESS-END           TO TRUE                     08090036
081000         MOVE '7110-DELETE-TALLPLN-PLAN' TO XL011-ERROR-PARAGRAPH 08100036
081100         MOVE 'TALLPLN'               TO XL011-DB2-TABLE-NAME(1)  08110036
081200     END-EVALUATE.                                                08120036
081300 7112-DELETE-TALLPLN-PO.                                          08130036
081400                                                                  08140036
081500     IF XL011-DEBUG-YES                                           08150036
081600         DISPLAY 'XLKUP010 - 7112-DELETE-TALLPLN-PO'              08160036
081700         DISPLAY 'XLKUP010 - ' DK-PO-NBR                          08170036
081800     END-IF                                                       08180036
081900                                                                  08190036
082000     EXEC SQL                                                     08200036
082100         DELETE                                                   08210036
082200         FROM                                                     08220036
082300             TALLPLN                                              08230036
082400         WHERE                                                    08240036
082500             PO_NBR                   = :DK-PO-NBR                08250036
082600     END-EXEC.                                                    08260036
082700                                                                  08270036
082800     MOVE SQLCODE                     TO XL011-SQLCODE            08280036
082900     EVALUATE TRUE                                                08290036
083000         WHEN SQLCODE = ZERO                                      08300036
083100         WHEN SQLCODE = +100                                      08310036
083200             CONTINUE                                             08320036
083300     WHEN OTHER                                                   08330036
083400         SET XL011-SQL-ERROR                                      08340036
083500             PS-PROCESS-END           TO TRUE                     08350036
083600         MOVE '7112-DELETE-TALLPLN-PO' TO XL011-ERROR-PARAGRAPH   08360036
083700         MOVE 'TALLPLN'               TO XL011-DB2-TABLE-NAME(1)  08370036
083800     END-EVALUATE.                                                08380036
083900                                                                  08390036
084000 7120-UPD-TALLPLN-ORD-QTY.                                        08400036
084100                                                                  08410036
084200     IF XL011-DEBUG-YES                                           08420036
084300         DISPLAY 'XLKUP010 - 7120-UPD-TALLPLN-ORD-QTY'            08430036
084400         DISPLAY 'XLKUP010 - ' DK-PO-NBR '/'                      08440036
084500                 DK-PO-LNE-NBR '/' DK-PLAN-NBR                    08450036
084600     END-IF                                                       08460036
084700                                                                  08470036
084800     EXEC SQL                                                     08480036
084900         UPDATE TALLPLN                                           08490036
085000         SET CURR_SPLIT_QTY           = :ALLPLN-CURR-SPLIT-QTY    08500036
085100            ,DC_SPLT_CNCLD_QTY        = :ALLPLN-DC-SPLT-CNCLD-QTY 08510037
085200         WHERE                                                    08520036
085300             PO_NBR                   = :DK-PO-NBR                08530036
085400         AND PO_LNE_NBR               = :DK-PO-LNE-NBR            08540036
085500         AND PLAN_NBR                 = :DK-PLAN-NBR              08550036
085600     END-EXEC.                                                    08560036
085700                                                                  08570036
085800     MOVE SQLCODE                     TO XL011-SQLCODE            08580036
085900     EVALUATE TRUE                                                08590036
086000         WHEN SQLCODE = ZERO                                      08600036
086100         WHEN SQLCODE = +100                                      08610036
086200             CONTINUE                                             08620036
086300         WHEN OTHER                                               08630036
086400             SET XL011-SQL-ERROR                                  08640036
086500                 PS-PROCESS-END       TO TRUE                     08650036
086600             MOVE '7120-UPD-TALLPLN-ORD-QTY'                      08660036
086700                                      TO XL011-ERROR-PARAGRAPH    08670036
086800             MOVE 'TALLPLN'           TO XL011-DB2-TABLE-NAME(1)  08680036
086900     END-EVALUATE.                                                08690036
087000/                                                                 08700036
087100 7130-UPD-TALLPLN-ATTR.                                           08710036
087200                                                                  08720036
087300     IF XL011-DEBUG-YES                                           08730036
087400         DISPLAY 'XLKUP010 - 7130-UPD-TALLPLN-ATTR'               08740036
087500         DISPLAY 'XLKUP010 - ' DK-PO-NBR '/'                      08750036
087600                 DK-PO-LNE-NBR '/' DK-PLAN-NBR                    08760036
087700     END-IF                                                       08770036
087800                                                                  08780036
087900     EXEC SQL                                                     08790036
088000         UPDATE TALLPLN                                           08800036
088100         SET ALOC_PACK_QTY            = :ALLPLN-ALOC-PACK-QTY     08810036
088200         ,   ALLOC_OUTR_PK_QTY        = :ALLPLN-ALLOC-OUTR-PK-QTY 08820036
088300         ,   PK_SIZE_RND_CDE          = :ALLPLN-PK-SIZE-RND-CDE   08830036
088400         ,   SHTG_PRRT_OPT_CDE        = :ALLPLN-SHTG-PRRT-OPT-CDE 08840036
088500         ,   OVRG_PRRT_OPT_CDE        = :ALLPLN-OVRG-PRRT-OPT-CDE 08850036
088600         ,   EXST_SHTG_THRS_IND       = :ALLPLN-EXST-SHTG-THRS-IND08860036
088700                                                                  08870036
088800         WHERE                                                    08880036
088900             PO_NBR                   = :DK-PO-NBR                08890036
089000         AND PO_LNE_NBR               = :DK-PO-LNE-NBR            08900036
089100         AND PLAN_NBR                 = :DK-PLAN-NBR              08910036
089200     END-EXEC.                                                    08920036
089300                                                                  08930036
089400     MOVE SQLCODE                     TO XL011-SQLCODE            08940036
089500     EVALUATE TRUE                                                08950036
089600         WHEN SQLCODE = ZERO                                      08960036
089700         WHEN SQLCODE = +100                                      08970036
089800             CONTINUE                                             08980036
089900       WHEN OTHER                                                 08990036
090000             SET XL011-SQL-ERROR                                  09000036
090100                 PS-PROCESS-END       TO TRUE                     09010036
090200             MOVE '7130-UPD-TALLPLN-ATTR'                         09020036
090300                                      TO XL011-ERROR-PARAGRAPH    09030036
090400             MOVE 'TALLPLN'           TO XL011-DB2-TABLE-NAME(1)  09040036
090500     END-EVALUATE.                                                09050036
090600/                                                                 09060036
090700 7200-INSERT-TMESTDS.                                             09070036
090800                                                                  09080036
090900     IF XL011-DEBUG-YES                                           09090036
091000         DISPLAY 'XLKUP010 - 7200-INSERT-TMESTDS'                 09100036
091100         DISPLAY 'XLKUP010 - ' MESTDS-PO-NBR '/'                  09110036
091200                 MESTDS-PO-LNE-NBR '/' MESTDS-PLAN-NBR            09120036
091300                 MESTDS-STR-NBR                                   09130036
091400     END-IF                                                       09140036
091500                                                                  09150036
091600     EXEC SQL                                                     09160036
091700         INSERT INTO TMESTDS                                      09170036
091800             (                                                    09180036
091900             PO_NBR                                               09190036
092000            ,PO_LNE_NBR                                           09200036
092100            ,PLAN_NBR                                             09210036
092200            ,STR_NBR                                              09220036
092300            ,STR_DISTRO_QTY                                       09230036
092400            ,ALLOC_SEQ_CDE                                        09240036
092500            ,RNK_SEQ_NBR                                          09250036
092600            ,STR_CNSTR_CDE                                        09260036
092700            ,STR_CNSTR_QTY                                        09270036
092800         )                                                        09280036
092900         VALUES                                                   09290036
093000         (                                                        09300036
093100               :MESTDS-PO-NBR                                     09310036
093200           ,   :MESTDS-PO-LNE-NBR                                 09320036
093300           ,   :MESTDS-PLAN-NBR                                   09330036
093400           ,   :MESTDS-STR-NBR                                    09340036
093500           ,   :MESTDS-STR-DISTRO-QTY                             09350036
093600           ,   :MESTDS-ALLOC-SEQ-CDE                              09360036
093700           ,   :MESTDS-RNK-SEQ-NBR                                09370036
093800           ,   :MESTDS-STR-CNSTR-CDE                              09380036
093900           ,   :MESTDS-STR-CNSTR-QTY                              09390036
094000             )                                                    09400036
094100        END-EXEC                                                  09410036
094200                                                                  09420036
094300     MOVE SQLCODE                     TO XL011-SQLCODE            09430036
094400     EVALUATE TRUE                                                09440036
094500         WHEN SQLCODE = ZERO                                      09450036
094600         WHEN SQLCODE = -803                                      09460036
094700             CONTINUE                                             09470036
094800         WHEN OTHER                                               09480036
094900             SET XL011-SQL-ERROR                                  09490036
095000                 PS-PROCESS-END       TO TRUE                     09500036
095100             MOVE '7200-INSERT-TMESTDS'                           09510036
095200                                      TO XL011-ERROR-PARAGRAPH    09520036
095300             MOVE 'TMESTDS'           TO XL011-DB2-TABLE-NAME(1)  09530036
095400     END-EVALUATE.                                                09540036
095500/                                                                 09550036
095510 7205-UPDATE-TMESTDS-QTY.                                         09551037
095520                                                                  09552037
095530     IF XL011-DEBUG-YES                                           09553037
095540         DISPLAY 'XLKUP010 - 7205-UPDATE-TMESTDS-QTY'             09554037
095550         DISPLAY 'XLKUP010 - ' DK-PO-NBR '/'                      09555037
095560                 DK-PO-LNE-NBR '/' DK-PLAN-NBR                    09556037
095570     END-IF                                                       09557037
095580                                                                  09558037
095590     EXEC SQL                                                     09559037
095591         UPDATE TMESTDS                                           09559137
095592         SET STR_DISTRO_QTY           = :ALLPLN-CURR-SPLIT-QTY    09559237
095594         WHERE                                                    09559437
095595             PO_NBR                   = :DK-PO-NBR                09559537
095596         AND PO_LNE_NBR               = :DK-PO-LNE-NBR            09559637
095597         AND PLAN_NBR                 = :DK-PLAN-NBR              09559737
095598     END-EXEC.                                                    09559837
095599                                                                  09559937
095600     MOVE SQLCODE                     TO XL011-SQLCODE            09560037
095601     EVALUATE TRUE                                                09560137
095602         WHEN SQLCODE = ZERO                                      09560237
095603         WHEN SQLCODE = +100                                      09560337
095604             CONTINUE                                             09560437
095605         WHEN OTHER                                               09560537
095606             SET XL011-SQL-ERROR                                  09560637
095607                 PS-PROCESS-END       TO TRUE                     09560737
095608             MOVE '7205-UPDATE-TMESTDS-QTY '                      09560837
095609                                      TO XL011-ERROR-PARAGRAPH    09560937
095610             MOVE 'TMESTDS '        TO XL011-DB2-TABLE-NAME(1)    09561037
095611     END-EVALUATE.                                                09561137
095612/                                                                 09561237
095620*7210-DELETE-TMESTDS.                                             09562036
095700*    MOVE '7210-DELETE-TMESTDS'       TO XL011-ERROR-PARAGRAPH    09570036
095800*    EXEC SQL                                                     09580036
095900*        DELETE                                                   09590036
096000*        FROM                                                     09600036
096100*            TMESTDS                                              09610036
096200*        WHERE                                                    09620036
096300*            PO_NBR                   = :DK-PO-NBR                09630036
096400*        AND PO_LNE_NBR               = :DK-PO-LNE-NBR            09640036
096500*        AND PLAN_NBR                 = :DK-PLAN-NBR              09650036
096600*    END-EXEC.                                                    09660036
096700*                                                                 09670036
096800*    MOVE SQLCODE                     TO XL011-SQLCODE            09680036
096900*    MOVE 'TMESTDS'                   TO XL011-DB2-TABLE-NAME(1)  09690036
097000*    EVALUATE TRUE                                                09700036
097100*        WHEN SQLCODE = ZERO                                      09710036
097200*        WHEN SQLCODE = +100                                      09720036
097300*        SET PS-PROCESS-END               TO TRUE                 09730036
097400*      WHEN OTHER                                                 09740036
097500*            SET XL011-SQL-ERROR      TO TRUE                     09750036
097600*    END-EVALUATE.                                                09760036
097700/                                                                 09770036
097800                                                                  09780036
097900 7300-FIND-TPURITM-FOR-SKU.                                       09790036
098000                                                                  09800036
098100     IF XL011-DEBUG-YES                                           09810036
098200         DISPLAY 'XLKUP010 - 7300-FIND-TPURITM-FOR-SKU'           09820036
098300         DISPLAY 'XLKUP010 - ' DK-SKU-NBR '/'                     09830036
098400                 DK-PO-NBR                                        09840036
098500     END-IF                                                       09850036
098600                                                                  09860036
098700     EXEC SQL                                                     09870036
098800     SELECT                                                       09880036
098900            PUR.PO_LNE_NBR                                        09890036
099000     ,      PUR.PREPK_RATO_QTY                                    09900036
099100     INTO                                                         09910036
099200         :PURITM-PO-LNE-NBR                                       09920036
099300     ,   :PURITM-PREPK-RATO-QTY                                   09930036
099400     FROM                                                         09940036
099500         XLT_SKU      SKU                                         09950036
099600     ,   TPURITM      PUR                                         09960036
099700     WHERE                                                        09970036
099800        SKU.SKU_NBR                = :DK-SKU-NBR                  09980036
099900    AND PUR.PO_NBR                 = :DK-PO-NBR                   09990036
100000    AND PUR.PO_PREPK_ID            = 0                            10000036
100100    AND PUR.ITM_NBR                = SKU.ITM_NBR                  10010036
100200    AND PUR.VER_STATUS_CDE         = 'A'                          10020036
100300     END-EXEC.                                                    10030036
100400                                                                  10040036
100500     MOVE SQLCODE                     TO XL011-SQLCODE            10050036
100600     EVALUATE TRUE                                                10060036
100700         WHEN SQLCODE = ZERO                                      10070036
100800         WHEN SQLCODE = -811                                      10080036
100900             SET PS-PURITM-EXISTS-YES TO TRUE                     10090036
101000         WHEN SQLCODE = +100                                      10100036
101100             SET PS-PURITM-EXISTS-NO  TO TRUE                     10110036
101200       WHEN OTHER                                                 10120036
101300             SET XL011-SQL-ERROR                                  10130036
101400                 PS-PROCESS-END       TO TRUE                     10140036
101500             MOVE '7300-FIND-TPURITM-FOR-SKU'                     10150036
101600                                      TO XL011-ERROR-PARAGRAPH    10160036
101700             MOVE 'XLT_SKU'           TO XL011-DB2-TABLE-NAME(1)  10170036
101800             MOVE 'TPURITM'           TO XL011-DB2-TABLE-NAME(2)  10180036
101900     END-EVALUATE.                                                10190036
102000                                                                  10200036
102100 7400-FIND-TALLPLN-FOR-SKU.                                       10210036
102200                                                                  10220036
102300     IF XL011-DEBUG-YES                                           10230036
102400         DISPLAY 'XLKUP010 - 7400-FIND-TALLPLN-FOR-SKU'           10240036
102500         DISPLAY 'XLKUP010 - ' DK-SKU-NBR '/'                     10250036
102600                 DK-PO-NBR '/' DK-DEST-NBR                        10260036
102700         DISPLAY 'XLKUP010 - LINE NO ' PURITM-PO-LNE-NBR          10270036
102800     END-IF                                                       10280036
102900                                                                  10290036
103000     EXEC SQL                                                     10300036
103100     SELECT                                                       10310036
103200            PUR.PO_LNE_NBR                                        10320036
103300     ,      TALL.PLAN_NBR                                         10330036
103400     ,      PUR.PREPK_RATO_QTY                                    10340036
103500     INTO                                                         10350036
103600         :PURITM-PO-LNE-NBR                                       10360036
103700     ,   :ALLPLN-PLAN-NBR                                         10370036
103800     ,   :PURITM-PREPK-RATO-QTY                                   10380036
103900     FROM                                                         10390036
104000         XLT_SKU      SKU                                         10400036
104100     ,   TPURITM      PUR                                         10410036
104200     ,   TALLPLN      TALL                                        10420036
104300     WHERE                                                        10430036
104400        SKU.SKU_NBR                = :DK-SKU-NBR                  10440036
104500    AND PUR.PO_NBR                 = :DK-PO-NBR                   10450036
104600    AND PUR.PO_PREPK_ID            = 0                            10460036
104700    AND PUR.ITM_NBR                = SKU.ITM_NBR                  10470036
104800    AND TALL.PO_NBR                = PUR.PO_NBR                   10480036
104900    AND TALL.PO_LNE_NBR            = PUR.PO_LNE_NBR               10490036
105000    AND PUR.VER_STATUS_CDE         = 'A'                          10500036
105100    AND TALL.DEST_NBR              = :DK-DEST-NBR                 10510036
105200     END-EXEC.                                                    10520036
105300                                                                  10530036
105400     MOVE SQLCODE                     TO XL011-SQLCODE            10540036
105500     EVALUATE TRUE                                                10550036
105600         WHEN SQLCODE = ZERO                                      10560036
105700         WHEN SQLCODE = -811                                      10570036
105800             SET PS-PLAN-EXISTS-YES   TO TRUE                     10580036
105900         WHEN SQLCODE = +100                                      10590036
106000             SET PS-PLAN-EXISTS-NO    TO TRUE                     10600036
106100             IF XL011-DEBUG-YES                                   10610036
106200                DISPLAY 'PLAN DOES NOT EXIST'                     10620036
106300                DISPLAY 'XLKUP010 - 7400-FIND-TALLPLN-FOR-SKU'    10630036
106400                DISPLAY 'XLKUP010 - ' DK-SKU-NBR '/'              10640036
106500                             DK-PO-NBR '/' DK-DEST-NBR            10650036
106600             END-IF                                               10660036
106700       WHEN OTHER                                                 10670036
106800             SET XL011-SQL-ERROR                                  10680036
106900                 PS-PROCESS-END       TO TRUE                     10690036
107000             MOVE '7400-FIND-TALLPLN-FOR-SKU'                     10700036
107100                                      TO XL011-ERROR-PARAGRAPH    10710036
107200             MOVE 'XLT_SKU'           TO XL011-DB2-TABLE-NAME(1)  10720036
107300             MOVE 'TPURITM'           TO XL011-DB2-TABLE-NAME(2)  10730036
107400             MOVE 'TALLPLN'           TO XL011-DB2-TABLE-NAME(3)  10740036
107500     END-EVALUATE.                                                10750036
107600                                                                  10760036
107700 7410-FIND-TALLPLN-FOR-LINE.                                      10770036
107800                                                                  10780036
107900     IF XL011-DEBUG-YES                                           10790036
108000         DISPLAY 'XLKUP010 - 7410-FIND-TALLPLN-FOR-LINE'          10800036
108100         DISPLAY 'XLKUP010 - ' DK-SKU-NBR '/'                     10810036
108200                 DK-PO-NBR '/' DK-DEST-NBR '/' PURITM-PO-LNE-NBR  10820040
108300     END-IF                                                       10830036
108400                                                                  10840036
108500     EXEC SQL                                                     10850036
108600     SELECT                                                       10860036
108700            TALL.PLAN_NBR                                         10870036
108800     INTO                                                         10880036
108900         :ALLPLN-PLAN-NBR                                         10890036
109000     FROM                                                         10900036
109100         TPURITM      PUR                                         10910036
109200     ,   TALLPLN      TALL                                        10920036
109300     WHERE                                                        10930036
109400          PUR.PO_NBR                 = :DK-PO-NBR                 10940036
109500       AND TALL.PO_NBR                = PUR.PO_NBR                10950036
109600       AND PUR.PO_LNE_NBR             = :PURITM-PO-LNE-NBR        10960036
109700       AND TALL.PO_LNE_NBR            = :PURITM-PO-LNE-NBR        10970036
109800       AND PUR.VER_STATUS_CDE         = 'A'                       10980036
109900       AND TALL.DEST_NBR              = :DK-DEST-NBR              10990036
110000     END-EXEC.                                                    11000036
110100                                                                  11010036
110200     MOVE SQLCODE                     TO XL011-SQLCODE            11020036
110300     EVALUATE TRUE                                                11030036
110400         WHEN SQLCODE = ZERO                                      11040036
110500*        WHEN SQLCODE = -811                                      11050036
110600             SET PS-PLAN-EXISTS-YES   TO TRUE                     11060036
110700             MOVE ALLPLN-PLAN-NBR     TO DK-PLAN-NBR              11070036
110800         WHEN SQLCODE = +100                                      11080036
110900             IF PS-PLAN-NOT-FOUND-OK                              11090036
111000                 SET PS-PLAN-EXISTS-NO    TO TRUE                 11100036
111100             ELSE                                                 11110036
111200                 SET XL011-SQL-ERROR                              11120036
111300                     PS-PROCESS-END   TO TRUE                     11130036
111400                 MOVE '7410-FIND-TALLPLN-FOR-LINE'                11140036
111500                                      TO XL011-ERROR-PARAGRAPH    11150036
111600                 MOVE 'TPURITM'       TO XL011-DB2-TABLE-NAME(1)  11160036
111700                 MOVE 'TALLPLN'       TO XL011-DB2-TABLE-NAME(2)  11170036
111800             END-IF                                               11180036
111900         WHEN OTHER                                               11190036
112000             SET XL011-SQL-ERROR                                  11200036
112100                 PS-PROCESS-END       TO TRUE                     11210036
112200             MOVE '7410-FIND-TALLPLN-FOR-LINE'                    11220036
112300                                      TO XL011-ERROR-PARAGRAPH    11230036
112400             MOVE 'TPURITM'           TO XL011-DB2-TABLE-NAME(1)  11240036
112500             MOVE 'TALLPLN'           TO XL011-DB2-TABLE-NAME(2)  11250036
112600     END-EVALUATE.                                                11260036
112700                                                                  11270036
112800 7420-FIND-NEXT-PLAN-NBR.                                         11280036
112900                                                                  11290036
113000     IF XL011-DEBUG-YES                                           11300036
113100         DISPLAY 'XLKUP010 - 7420-FIND-NEXT-PLAN-NBR'             11310036
113200         DISPLAY 'XLKUP010 - ' DK-PO-NBR '/'                      11320036
113300                 DK-PO-LNE-NBR                                    11330036
113400     END-IF                                                       11340036
113500                                                                  11350036
113600     MOVE ZERO                        TO ALLPLN-PLAN-NBR          11360036
113700     EXEC SQL                                                     11370036
113800     SELECT                                                       11380036
113900          MAX ( TALL.PLAN_NBR ) + 1                               11390036
114000     INTO                                                         11400036
114100         :ALLPLN-PLAN-NBR                                         11410036
114200     FROM                                                         11420036
114300         TALLPLN      TALL                                        11430036
114400     WHERE                                                        11440036
114500            TALL.PO_NBR               = :DK-PO-NBR                11450036
114600        AND TALL.PO_LNE_NBR           = :ALLPLN-PO-LNE-NBR        11460036
114700     END-EXEC.                                                    11470036
114800                                                                  11480036
114900     MOVE SQLCODE                     TO XL011-SQLCODE            11490036
115000     EVALUATE TRUE                                                11500036
115100         WHEN SQLCODE = ZERO                                      11510036
115200             CONTINUE                                             11520036
115300*        WHEN SQLCODE = +100                                      11530036
115400*            CONTINUE                                             11540036
115500         WHEN SQLCODE = -305                                      11550036
115600              MOVE +1 TO ALLPLN-PLAN-NBR                          11560036
115700         WHEN OTHER                                               11570036
115800             SET XL011-SQL-ERROR                                  11580036
115900                 PS-PROCESS-END      TO TRUE                      11590036
116000             MOVE '7420-FIND-NEXT-PLAN-NBR'                       11600036
116100                                     TO XL011-ERROR-PARAGRAPH     11610036
116200             MOVE 'TALLPLN'          TO XL011-DB2-TABLE-NAME(1)   11620036
116300     END-EVALUATE.                                                11630036
116400                                                                  11640036
116500 7500-GET-PACK-ID.                                                11650036
116600                                                                  11660036
116700     IF XL011-DEBUG-YES                                           11670036
116800         DISPLAY 'XLKUP010 - 7500-GET-PACK-ID'                    11680036
116900     END-IF                                                       11690036
117000                                                                  11700036
117100     EXEC SQL                                                     11710036
117200     SELECT                                                       11720036
117300          PO_PREPK_ID                                             11730036
117400     INTO                                                         11740036
117500         :POPRPK-PO-PREPK-ID                                      11750036
117600     FROM                                                         11760036
117700         TPOPRPK                                                  11770036
117800     WHERE                                                        11780036
117900            PO_NBR               = :DK-PO-NBR                     11790036
118000        AND PK_SKU_NBR           = :DK-SKU-NBR                    11800036
118100     END-EXEC.                                                    11810036
118200                                                                  11820036
118300     MOVE SQLCODE                     TO XL011-SQLCODE            11830036
118400     EVALUATE TRUE                                                11840036
118500         WHEN SQLCODE = ZERO                                      11850036
118600             CONTINUE                                             11860036
118700         WHEN OTHER                                               11870036
118800             SET XL011-SQL-ERROR                                  11880036
118900                 PS-PROCESS-END      TO TRUE                      11890036
119000             MOVE '7500-GET-PACK-ID' TO XL011-ERROR-PARAGRAPH     11900036
119100             MOVE 'TPOPRPK'          TO XL011-DB2-TABLE-NAME(1)   11910036
119200     END-EVALUATE.                                                11920036
119300                                                                  11930036
119400 7510-OPEN-PACK-CSR.                                              11940036
119500                                                                  11950036
119600     IF XL011-DEBUG-YES                                           11960036
119700         DISPLAY 'XLKUP010 - 7510-OPEN-PACK-CSR'                  11970036
119800     END-IF                                                       11980036
119900                                                                  11990036
120000     EXEC SQL                                                     12000036
120100         OPEN PACK-CSR                                            12010036
120200     END-EXEC.                                                    12020036
120300     MOVE SQLCODE                     TO XL011-SQLCODE            12030036
120400     EVALUATE TRUE                                                12040036
120500         WHEN SQLCODE = ZERO                                      12050036
120600             CONTINUE                                             12060036
120700         WHEN OTHER                                               12070036
120800             SET XL011-SQL-ERROR                                  12080036
120900                 PS-PROCESS-END        TO TRUE                    12090036
121000             MOVE '7510-OPEN-PACK-CSR' TO XL011-ERROR-PARAGRAPH   12100036
121100             MOVE 'TPURITM'            TO XL011-DB2-TABLE-NAME(1) 12110036
121200     END-EVALUATE.                                                12120036
121300 7520-FETCH-PACK-CSR.                                             12130036
121400                                                                  12140036
121500     IF XL011-DEBUG-YES                                           12150036
121600         DISPLAY 'XLKUP010 - 7520-FETCH-PACK-CSR'                 12160036
121700     END-IF                                                       12170036
121800                                                                  12180036
121900     EXEC SQL                                                     12190036
122000          FETCH PACK-CSR                                          12200036
122100       INTO :PURITM-PO-LNE-NBR                                    12210036
122200           ,:PURITM-PREPK-RATO-QTY                                12220036
122300     END-EXEC.                                                    12230036
122400                                                                  12240036
122500     MOVE SQLCODE                     TO XL011-SQLCODE            12250036
122600     EVALUATE TRUE                                                12260036
122700         WHEN SQLCODE = ZERO                                      12270036
122800             MOVE PURITM-PO-LNE-NBR   TO DK-PO-LNE-NBR            12280036
122900         WHEN SQLCODE = +100                                      12290036
123000             SET PS-PROCESS-END         TO TRUE                   12300036
123100         WHEN OTHER                                               12310036
123200             SET XL011-SQL-ERROR                                  12320036
123300                 PS-PROCESS-END         TO TRUE                   12330036
123400             MOVE '7520-FETCH-PACK-CSR' TO XL011-ERROR-PARAGRAPH  12340036
123500             MOVE 'TPURITM'             TO XL011-DB2-TABLE-NAME(1)12350036
123600     END-EVALUATE.                                                12360036
123700 7530-CLOSE-PACK-CSR.                                             12370036
123800                                                                  12380036
123900     IF XL011-DEBUG-YES                                           12390036
124000         DISPLAY 'XLKUP010 - 7530-CLOSE-PACK-CSR'                 12400036
124100     END-IF                                                       12410036
124200                                                                  12420036
124300     EXEC SQL                                                     12430036
124400         CLOSE PACK-CSR                                           12440036
124500     END-EXEC.                                                    12450036
124600     MOVE SQLCODE                     TO XL011-SQLCODE            12460036
124700     EVALUATE TRUE                                                12470036
124800         WHEN SQLCODE = ZERO                                      12480036
124900             CONTINUE                                             12490036
125000         WHEN OTHER                                               12500036
125100             SET XL011-SQL-ERROR                                  12510036
125200                 PS-PROCESS-END        TO TRUE                    12520036
125300             MOVE '7530-CLOSE-PACK-CSR' TO XL011-ERROR-PARAGRAPH  12530036
125400             MOVE 'TPURITM'            TO XL011-DB2-TABLE-NAME(1) 12540036
125500     END-EVALUATE.                                                12550036
125600/                                                                 12560036
125700 8100-NUMERIC-EDIT.                                               12570036
125800                                                                  12580036
125900     IF XL011-DEBUG-YES                                           12590036
126000         DISPLAY 'XLKUP010 - 8100-NUMERIC-EDIT'                   12600036
126100     END-IF                                                       12610036
126200                                                                  12620036
126300     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                      12630036
126400     CALL DP010I-NUMERIC-EDIT-ROUTINE                             12640036
126500          USING DP010I-NUMERIC-EDIT-AREA                          12650036
126600     IF  DP010I-ERROR-DETECTED                                    12660036
126700         MOVE '8100-NUMERIC-EDIT'     TO XL011-ERROR-PARAGRAPH    12670036
126800         STRING 'INVALID NUMBER = ' DP010I-UNEDITED-FIELD         12680036
126900                 DELIMITED BY SIZE    INTO XL011-ERROR-TEXT       12690036
127000         SET XL011-SYSTEM-ERROR                                   12700036
127100             PS-PROCESS-END           TO TRUE                     12710036
127200     END-IF.                                                      12720036
127300/                                                                 12730036
127400 9999-WRAPUP.                                                     12740036
127500                                                                  12750036
127600     IF XL011-DEBUG-YES                                           12760036
127700         DISPLAY 'XLKUP010 - 9999-WRAPUP'                         12770036
127800     END-IF                                                       12780036
127900                                                                  12790036
128000     MOVE SQLCA                       TO XL011-SQLCA.             12800036
