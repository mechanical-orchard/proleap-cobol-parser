000100 TITLE 'OUTBOUND TRAILER STATUS UPDATE'.                          00010005
000200 IDENTIFICATION DIVISION.                                         00020006
000300 PROGRAM-ID.    SUKCS808.                                         00030006
000400 AUTHOR.        JIM HUNTER                                        00040006
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050006
000600 DATE-WRITTEN.  AUGUST 2017.                                      00060006
000700 DATE-COMPILED.                                                   00070006
000800******************************************************************00080006
000900* TRAN S808 FOR WEBSERVICE SHIPOUTBOUNDTRAILER                    00090007
001000******************************************************************00100006
001100* JANUARY, 2019 - JIM HUNTER     CHG0213345                       00110007
001200*    Moving "RESPONSE SUCCESSFUL" message to message text         00120006
001300*    field when the call to get the message fails and the         00130006
001400*    message code = 01044 in paragraph 9910-READ-SYSTEM-MESSAGE.  00140006
001500*    The call failed immediately after CICS was brought up        00150006
001600*    following an IPL in TRKCS131.                                00160006
001700******************************************************************00170006
001800                                                                  00180006
001900 ENVIRONMENT DIVISION.                                            00190006
002000                                                                  00200006
002100 DATA DIVISION.                                                   00210006
002200 WORKING-STORAGE SECTION.                                         00220006
002300                                                                  00230006
002400 01  PC-PROGRAM-CONSTANTS.                                        00240006
002500     05  PC-SUMMARY-PROGRAM       PIC  X(08) VALUE  'SUKCS574'.   00250006
002600     05  PC-SHIP-CNTL-MOD         PIC  X(08) VALUE  'WSKCS306'.   00260006
002700     05  PC-SHIP-CNTL-MOD-LENGTH  PIC S9(4) VALUE +125 COMP SYNC. 00270006
002800                                                                  00280006
002900     05  PC-MSG-VAR-IND           PIC  X(04) VALUE '&VAR'.        00290006
003000     05  PC-TSYMSG-NUMBERS.                                       00300006
003100         10  PC-TSYMSG-00007      PIC  9(05) VALUE  00007.        00310006
003200         10  PC-TSYMSG-01044      PIC  9(05) VALUE  01044.        00320006
003300         10  PC-TSYMSG-01570      PIC  9(05) VALUE  01570.        00330006
003400         10  PC-TSYMSG-02319      PIC  9(05) VALUE  02319.        00340006
003500         10  PC-TSYMSG-02816      PIC  9(05) VALUE  02816.        00350006
003600         10  PC-TSYMSG-02944      PIC  9(05) VALUE  02944.        00360006
003700         10  PC-TSYMSG-02992      PIC  9(05) VALUE  02992.        00370006
003800         10  PC-TSYMSG-03051      PIC  9(05) VALUE  03051.        00380006
003900         10  PC-TSYMSG-03052      PIC  9(05) VALUE  03052.        00390006
004000         10  PC-TSYMSG-03053      PIC  9(05) VALUE  03053.        00400006
004100         10  PC-TSYMSG-03546      PIC  9(05) VALUE  03546.        00410006
004200         10  PC-TSYMSG-03548      PIC  9(05) VALUE  03548.        00420006
004300         10  PC-TSYMSG-03765      PIC  9(05) VALUE  03765.        00430006
004400         10  PC-TSYMSG-03787      PIC  9(05) VALUE  03787.        00440006
004500         10  PC-TSYMSG-03800      PIC  9(05) VALUE  03800.        00450006
004600                                                                  00460006
004700*----------------------------------------------------------------*00470006
004800*  SYSTEM MESSAGES                                               *00480006
004900*----------------------------------------------------------------*00490006
005000*                                                                 00500006
005100*   00007 - REQUIRED ENTRY                                        00510006
005200*   01044 - RESPONSE SUCCESSFUL                                   00520006
005300*   01570 - A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK       00530006
005400*   02319 - INVALID DISTRIBUTION CENTER                           00540006
005500*   02816 - INVALID TRAILER STATUS FOR UPDATE FUNCTION            00550006
005600*   02944 - TRAILER IS EMPTY - F2 TO SHIP TRAILER                 00560006
005700*   02992 - SHIP FUNCTION ONLY VALID FOR SHIP/SHUTTLE TRAILERS    00570006
005800*   03051 - INVALID TRAILER SEAL # ENTERED                        00580006
005900*   03052 - MULTIPLE OUTBOUND TRIPS WITH THIS TRAILER SEAL        00590006
006000*   03053 - OUTBOUND TRIP ID NOT FOUND                            00600006
006100*   03546 - ERROR IN WMS DOWNLOAD MODULE - CONTACT HELP DESK      00610006
006200*   03548 - ERROR OCCURRED TRYING TO DOWNLOAD TRAILER TO WMOS -   00620006
006300*           CALL HELP DESK                                        00630006
006400*   03765 - TRAILER IS EMPTY - PLEASE USE RELEASE TRAILER FUNCTION00640006
006500*   03787 - FUNCTION IS CURRENTLY UNAVAILABLE                     00650006
006600*   03800 - TRAILER SEAL USED ON TRIP &VAR - MUST USE A DIFFERENT 00660006
006700*           SEAL                                                  00670006
006800*----------------------------------------------------------------*00680006
006900                                                                  00690006
007000 01  PV-PROGRAM-VARIABLES.                                        00700006
007100     05  PV-TSYMSG-NUMBER         PIC  9(05) VALUE  0.            00710006
007200     05  PV-SQLCODE               PIC  9(09) VALUE  0.            00720006
007300     05  PV-DISP-TRIP             PIC  9(09) VALUE  0.            00730006
007400     05  PV-DISP-LOC              PIC  9(04) VALUE  0.            00740006
007500     05  PV-DISP-LOC2             PIC  9(04) VALUE  0.            00750006
007600     05  PV-USA-DATE              PIC  X(10) VALUE SPACES.        00760006
007700     05  PV-CICS-MSG-AREA.                                        00770006
007800         10 PV-PROGRAM-NAME       PIC  X(10)  VALUE ' SUKCS808 '. 00780006
007900         10 PV-PARA-NAME          PIC  X(25)  VALUE SPACES.       00790006
008000         10 PV-ERROR-MSG          PIC  X(85)  VALUE SPACES.       00800006
008100     05  PV-COMMAREA-LENGTH       PIC  S9(04) VALUE +0 COMP SYNC. 00810006
008200     05  PV-CICS-RESPONSE         PIC  S9(08) VALUE +0 COMP SYNC. 00820006
008300                                                                  00830006
008400     05  PV-MSG-VAR-LENGTH        PIC S9(04) VALUE +0 COMP SYNC.  00840006
008500     05  PV-MSG-VAR-LEAD-SPACE    PIC S9(04) VALUE +0 COMP SYNC.  00850006
008600     05  PV-CHAR-POS              PIC S9(04) VALUE +0 COMP SYNC.  00860006
008700     05  PV-MSG-VAR-SAVE          PIC  X(70) VALUE SPACE.         00870006
008800     05  PV-MSG-REMAINDER         PIC  X(70) VALUE SPACE.         00880006
008900     05  PV-MSG-VAR-IND           PIC  X(04) VALUE SPACE.         00890006
009000     05  PV-MSG-STRING-PTR        PIC S9(04) VALUE ZERO.          00900006
009100                                                                  00910006
009200 01  PS-PROGRAM-SWITCHES.                                         00920006
009300     05  PS-ERROR-SW                     PIC X(1) VALUE  'N'.     00930006
009400         88  PS-ERROR                             VALUE  'Y'.     00940006
009500         88  PS-NO-ERROR                          VALUE  'N'.     00950006
009600     05  PS-TRAILER-NOT-FOUND-SW         PIC X(1) VALUE  'Y'.     00960006
009700         88  PS-TRAILER-NOT-FOUND                 VALUE  'N'.     00970006
009800         88  PS-TRAILER-FOUND                     VALUE  'Y'.     00980006
009900     05  PS-VALID-STATUS-CHANGE-SW       PIC X(1) VALUE  'N'.     00990006
010000         88  PS-VALID-STATUS-CHANGE               VALUE  'Y'.     01000006
010100         88  PS-NOT-VALID-STATUS-CHANGE           VALUE  'N'.     01010006
010200     05  PS-SUMMARY-SW                   PIC S9(3) COMP-3.        01020006
010300     05  PS-SUMMARY-EXISTS-SW            PIC X(1) VALUE  'Y'.     01030006
010400         88  PS-THERE-ARE-SUMMARIES               VALUE  'Y'.     01040006
010500         88  PS-THERE-ARE-NO-SUMMARIES            VALUE  'N'.     01050006
010600     05  PS-DWNLD-ASN-TO-WMS             PIC X(1) VALUE  'N'.     01060006
010700         88  PS-DWNLD-ASN-TO-WMS-YES              VALUE  'Y'.     01070006
010800         88  PS-DWNLD-ASN-TO-WMS-NO               VALUE  'N'.     01080006
010900                                                                  01090006
011000 01  DK-DB2-KEYS.                                                 01100006
011100     05  DK-CURR-STAT-CDE           PIC  X(02) VALUE SPACES.      01110006
011200     05  DK-NEXT-STAT-CDE           PIC  X(02) VALUE SPACES.      01120006
011300     05  DK-LOC-ID                  PIC S9(04) VALUE ZERO COMP.   01130006
011400                                                                  01140006
011500****************************************************************  01150006
011600* INPUT RECORD.                                                   01160006
011700****************************************************************  01170006
011800     COPY SURD160.                                                01180006
011900                                                                  01190006
012000****************************************************************  01200006
012100* OUTPUT RECORD.                                                  01210006
012200****************************************************************  01220006
012300     COPY SURD161.                                                01230006
012400                                                                  01240006
012500****************************************************************  01250006
012600* COMMAREA TO PASS TO THE SUMMARIZE TRAILER MODULE (SUKCS574)     01260006
012700****************************************************************  01270006
012800     COPY PCWS047.                                                01280006
012900                                                                  01290006
013000****************************************************************  01300006
013100* SHIPMENT CONTROL MODULE COPYBOOK                                01310006
013200****************************************************************  01320006
013300     COPY WSWS004.                                                01330006
013400                                                                  01340006
013500****************************************************************  01350006
013600* INPUT RECORD DESCRIPTION FOR THE SYSTEM MESSAGES FILE           01360006
013700****************************************************************  01370006
013800     COPY DPRD507I.                                               01380006
013900                                                                  01390006
014000****************************************************************  01400006
014100*    DB2 AREA FOR COMMUNICATIONS                                  01410006
014200****************************************************************  01420006
014300     EXEC SQL                                                     01430006
014400          INCLUDE SQLCA                                           01440006
014500     END-EXEC.                                                    01450006
014600                                                                  01460006
014700****************************************************************  01470006
014800*    TSUOBTR - OUTBOUND TRAILER TRIP                            * 01480006
014900****************************************************************  01490006
015000     EXEC SQL                                                     01500006
015100         INCLUDE TSUOBTR                                          01510006
015200     END-EXEC.                                                    01520006
015300                                                                  01530006
015400****************************************************************  01540006
015500*    TSUOBTS - OUTBOUND TRAILER TRIP STATUS                     * 01550006
015600****************************************************************  01560006
015700     EXEC SQL                                                     01570006
015800         INCLUDE TSUOBTS                                          01580006
015900     END-EXEC.                                                    01590006
016000                                                                  01600006
016100****************************************************************  01610006
016200*    TKRPRPM - PARAMATER TABLE                                  * 01620006
016300****************************************************************  01630006
016400     EXEC SQL                                                     01640006
016500         INCLUDE TKRPRPM                                          01650006
016600     END-EXEC.                                                    01660006
016700                                                                  01670006
016800****************************************************************  01680006
016900*    SUT_TRIP_WRKR_AUD - WORKER AUDIT TABLE                       01690006
017000****************************************************************  01700006
017100     EXEC SQL                                                     01710006
017200         INCLUDE SUT00006                                         01720006
017300     END-EXEC.                                                    01730006
017400                                                                  01740006
017500****************************************************************  01750006
017600*    SUT_TRIP_SUM  - TRIP SUMMARY TABLE                           01760006
017700****************************************************************  01770006
017800     EXEC SQL                                                     01780006
017900         INCLUDE SUT00007                                         01790006
018000     END-EXEC.                                                    01800006
018100                                                                  01810006
018200****************************************************************  01820006
018300*    SUT_STAT_ASSN - STATUS CODE ASSOCIATION TABLE                01830006
018400****************************************************************  01840006
018500     EXEC SQL                                                     01850006
018600         INCLUDE SUT00005                                         01860006
018700     END-EXEC.                                                    01870006
018800                                                                  01880006
018900****************************************************************  01890006
019000*    DB2 AREA FOR LOGISTICS LOCATION TABLE - XLT_LOC            * 01900006
019100****************************************************************  01910006
019200     EXEC SQL                                                     01920006
019300         INCLUDE XLT00010                                         01930006
019400     END-EXEC.                                                    01940006
019500                                                                  01950006
019600 LINKAGE SECTION.                                                 01960006
019700                                                                  01970006
019800 01  DFHCOMMAREA.                                                 01980006
019900     05  FILLER                         OCCURS  1 TO 32000 TIMES  01990006
020000                                        DEPENDING ON EIBCALEN.    02000006
020100         10  FILLER                     PIC X.                    02010006
020200                                                                  02020006
020300 PROCEDURE DIVISION.                                              02030006
020400***************************************************************** 02040006
020500* THIS PARAGRAPH CONTROLS THE OVERALL PROCESSING IN THE PROGRAM.* 02050006
020600***************************************************************** 02060006
020700 0000-MAIN-PARAGRAPH.                                             02070006
020800                                                                  02080006
020900     PERFORM 1000-INITIALIZE.                                     02090006
021000     IF EIBCALEN > 0                                              02100006
021100         MOVE DFHCOMMAREA(1:EIBCALEN) TO SU160-INP-SHIP-OUTB-TLR  02110006
021200         PERFORM 1100-CHECK-WEBSERV-AVAIL                         02120006
021300         IF SU160-TRLR-SEAL-ID  NOT EQUAL SPACES                  02130006
021400             PERFORM 1200-VALIDATE-DC-NBR                         02140006
021500             PERFORM 1300-VALIDATE-SEAL                           02150006
021600             PERFORM 1400-VALIDATE-USER-ID                        02160006
021700             PERFORM 2000-GET-OUTBOUND-TRIP                       02170006
021800             PERFORM 2100-EDIT-TRIP-TO-BE-SHIPPED                 02180006
021900             PERFORM 2200-CHECK-FOR-TRIP-SUM                      02190006
022000             IF PS-THERE-ARE-NO-SUMMARIES                         02200006
022100                 PERFORM 2210-CREATE-SUMMARIES                    02210006
022200                 PERFORM 2220-INSERT-WRKR-AUD-SUM                 02220006
022300             END-IF                                               02230006
022400             PERFORM 2300-CHECK-TRLR-UNITS                        02240006
022500             PERFORM 2400-VALIDATE-STATUS-CODE                    02250006
022600             PERFORM 2500-SELECT-ALL-TSUOBTS-FIELDS               02260006
022700             PERFORM 3000-INSERT-NEW-TSUOBTS-STATUS               02270006
022800             PERFORM 3100-INSERT-WORKER-AUDIT                     02280006
022900             PERFORM 3200-CHECK-ASN-TO-WMS-STATUS                 02290006
023000             IF PS-DWNLD-ASN-TO-WMS-YES                           02300006
023100                 PERFORM 3220-CALL-ASN-SHIP-CNTL-MOD              02310006
023200             END-IF                                               02320006
023300         ELSE                                                     02330006
023400             MOVE PC-TSYMSG-03051    TO PV-TSYMSG-NUMBER          02340006
023500*            INVALID TRAILER SEAL # ENTERED                       02350006
023600             MOVE '0000-MAIN-PARAGRAPH       ' TO PV-PARA-NAME    02360006
023700             MOVE SU160-DC-NBR                 TO PV-DISP-LOC     02370006
023800             STRING ' TRAILER SEAL ID REQUIRED'                   02380006
023900                    ' FOR DC ' PV-DISP-LOC                        02390006
024000                    ' USER ' SU160-USER-ID                        02400006
024100                    DELIMITED BY SIZE INTO  PV-ERROR-MSG          02410006
024200             PERFORM 9500-CSSL-LOG                                02420006
024300             PERFORM 9800-ROLLBACK                                02430006
024400             PERFORM 9900-RETURN-TRAN                             02440006
024500         END-IF                                                   02450006
024600     ELSE                                                         02460006
024700         MOVE PC-TSYMSG-00007    TO PV-TSYMSG-NUMBER              02470006
024800*        REQUIRED ENTRY                                           02480006
024900         MOVE ' EIBCALEN = ZERO '         TO PV-ERROR-MSG         02490006
025000         MOVE '0000-MAIN-PARAGRAPH-2    ' TO PV-PARA-NAME         02500006
025100         PERFORM 9500-CSSL-LOG                                    02510006
025200         PERFORM 9900-RETURN-TRAN                                 02520006
025300     END-IF.                                                      02530006
025400                                                                  02540006
025500     MOVE '0000-MAIN-PARAGRAPH-3    ' TO PV-PARA-NAME.            02550006
025600     MOVE SUOBTS-OTBND-TRIP-ID        TO PV-DISP-TRIP.            02560006
025700     MOVE SU160-DC-NBR                TO PV-DISP-LOC.             02570006
025800     STRING ' SHIPPING DONE'                                      02580006
025900                    ' SEAL ' SUOBTS-TRLR-SEAL-ID                  02590006
026000                    ' TRIP ' PV-DISP-TRIP                         02600006
026100                    ' USER ' SU160-USER-ID                        02610006
026200                    ' DC '   PV-DISP-LOC                          02620006
026300                    DELIMITED BY SIZE INTO  PV-ERROR-MSG.         02630006
026400     PERFORM 9500-CSSL-LOG.                                       02640006
026500     MOVE PC-TSYMSG-01044         TO PV-TSYMSG-NUMBER.            02650006
026600*    RESPONSE SUCCESSFUL                                          02660006
026700     PERFORM 9900-RETURN-TRAN.                                    02670006
026800                                                                  02680006
026900***************************************************************   02690006
027000* THIS PARAGRAPH WILL INITIALIZE THE COPYBOOK AREAS.              02700006
027100***************************************************************   02710006
027200 1000-INITIALIZE.                                                 02720006
027300     INITIALIZE SU160-INP-SHIP-OUTB-TLR                           02730006
027400                SU161-OUT-SHIP-OUTB-TLR.                          02740006
027500                                                                  02750006
027600***************************************************************   02760006
027700* THIS PARAGRAPH WILL CALL THE TKRPRPM TABLE TO VALIDATE THAT     02770006
027800* THIS WEBLOGIC CALL HAS BEEN TURNED ON.                          02780006
027900***************************************************************   02790006
028000 1100-CHECK-WEBSERV-AVAIL.                                        02800006
028100                                                                  02810006
028200      EXEC SQL                                                    02820006
028300        SELECT FUNC_TXT                                           02830006
028400          INTO :KRPRPM-FUNC-TXT                                   02840006
028500          FROM TKRPRPM                                            02850006
028600        WHERE LOC_ID            = 90                              02860006
028700          AND INTFC_SYS_CDE     = 'KHL'                           02870006
028800          AND SYS_PRC_FUNC_CDE  = 'STWEB8'                        02880006
028900          AND FUNC_PRC_STAT_CDE = 'AC'                            02890006
029000          AND FUNC_BEG_TMST    <=  CURRENT TIMESTAMP              02900006
029100          AND FUNC_END_TMST    >=  CURRENT TIMESTAMP              02910006
029200          AND FUNC_TXT          = 'Y'                             02920006
029300        WITH UR                                                   02930006
029400      END-EXEC.                                                   02940006
029500                                                                  02950006
029600     EVALUATE TRUE                                                02960006
029700         WHEN SQLCODE = ZERO                                      02970006
029800             CONTINUE                                             02980006
029900         WHEN SQLCODE = +100                                      02990006
030000             MOVE PC-TSYMSG-03787           TO PV-TSYMSG-NUMBER   03000006
030100*            FUNCTION IS CURRENTLY UNAVAILABLE                    03010006
030200             MOVE SU160-DC-NBR              TO PV-DISP-LOC        03020006
030300             STRING 'WEB SERVICE STWEB8 NOT AVLBL'                03030006
030400                    ' DC ' PV-DISP-LOC                            03040006
030500                    ' SEAL ' SU160-TRLR-SEAL-ID                   03050006
030600                    ' USER ' SU160-USER-ID                        03060006
030700                 DELIMITED BY SIZE INTO  PV-ERROR-MSG             03070006
030800             MOVE ' 1100-CHECK-WEBSERV-AVAIL ' TO PV-PARA-NAME    03080006
030900             PERFORM 9500-CSSL-LOG                                03090006
031000             PERFORM 9800-ROLLBACK                                03100006
031100             PERFORM 9900-RETURN-TRAN                             03110006
031200         WHEN SQLCODE NOT = ZERO                                  03120006
031300             MOVE PC-TSYMSG-01570             TO PV-TSYMSG-NUMBER 03130006
031400*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      03140006
031500             MOVE SQLCODE                     TO PV-SQLCODE       03150006
031600             MOVE '1100-CHECK-WEBSERV-AVAIL ' TO PV-PARA-NAME     03160006
031700             MOVE SU160-DC-NBR                TO PV-DISP-LOC      03170006
031800             STRING ' SELECT TKRPRPM = STWEB8 FAILED'             03180006
031900                 ' SQL ' PV-SQLCODE                               03190006
032000                 ' DC '  PV-DISP-LOC                              03200006
032100                 ' SEAL ' SUOBTS-TRLR-SEAL-ID                     03210006
032200                 ' USER ' SU160-USER-ID                           03220006
032300                 DELIMITED BY SIZE INTO  PV-ERROR-MSG             03230006
032400             PERFORM 9500-CSSL-LOG                                03240006
032500             PERFORM 9800-ROLLBACK                                03250006
032600             PERFORM 9900-RETURN-TRAN                             03260006
032700     END-EVALUATE.                                                03270006
032800                                                                  03280006
032900                                                                  03290006
033000***************************************************************** 03300006
033100* VALIDATE DISTRIBUTION NUMBER                                    03310006
033200***************************************************************** 03320006
033300 1200-VALIDATE-DC-NBR.                                            03330006
033400                                                                  03340006
033500     IF SU160-DC-NBR = ZEROES                                     03350006
033600          MOVE PC-TSYMSG-02319           TO PV-TSYMSG-NUMBER      03360006
033700*         INVALID DISTRIBUTION CENTER                             03370006
033800          MOVE '1200-VALIDATE-DC-NBR '   TO PV-PARA-NAME          03380006
033900          MOVE SU160-DC-NBR              TO PV-DISP-LOC           03390006
034000          STRING 'DC NUMBER MUST BE > ZERO - IS '                 03400006
034100                  PV-DISP-LOC                                     03410006
034200                 ' SEAL ' SUOBTS-TRLR-SEAL-ID                     03420006
034300                 ' USER ' SU160-USER-ID                           03430006
034400                  DELIMITED BY SIZE INTO  PV-ERROR-MSG            03440006
034500          PERFORM 9500-CSSL-LOG                                   03450006
034600          PERFORM 9800-ROLLBACK                                   03460006
034700          PERFORM 9900-RETURN-TRAN                                03470006
034800     END-IF.                                                      03480006
034900                                                                  03490006
035000     MOVE SU160-DC-NBR TO PV-DISP-LOC                             03500006
035100                          XLT00010-LOC-NBR.                       03510006
035200                                                                  03520006
035300     EXEC SQL                                                     03530006
035400         SELECT LOC_TYP_CDE                                       03540006
035500         INTO :XLT00010-LOC-TYP-CDE                               03550006
035600         FROM XLT_LOC                                             03560006
035700         WHERE LOC_NBR     = :XLT00010-LOC-NBR                    03570006
035800           AND LOC_TYP_CDE = 'DC'                                 03580006
035900           AND OPN_DTE     < CURRENT DATE + 1 DAY                 03590006
036000           AND CLO_DTE     > CURRENT DATE                         03600006
036100     END-EXEC.                                                    03610006
036200                                                                  03620006
036300     EVALUATE TRUE                                                03630006
036400         WHEN SQLCODE = ZERO                                      03640006
036500             CONTINUE                                             03650006
036600                                                                  03660006
036700         WHEN SQLCODE = +100                                      03670006
036800              MOVE PC-TSYMSG-02319           TO PV-TSYMSG-NUMBER  03680006
036900*             INVALID DISTRIBUTION CENTER                         03690006
037000              MOVE '1200-VALIDATE-DC-NBR '   TO PV-PARA-NAME      03700006
037100              MOVE SQLCODE                   TO PV-SQLCODE        03710006
037200              MOVE SU160-DC-NBR              TO PV-DISP-LOC       03720006
037300              STRING 'DC ' PV-DISP-LOC                            03730006
037400                     ' INVALID ON XLT-LOC '                       03740006
037500                       PV-SQLCODE                                 03750006
037600                     ' SEAL ' SUOBTS-TRLR-SEAL-ID                 03760006
037700                     ' USER ' SU160-USER-ID                       03770006
037800                      DELIMITED BY SIZE INTO  PV-ERROR-MSG        03780006
037900              PERFORM 9500-CSSL-LOG                               03790006
038000              PERFORM 9800-ROLLBACK                               03800006
038100              PERFORM 9900-RETURN-TRAN                            03810006
038200                                                                  03820006
038300         WHEN OTHER                                               03830006
038400             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  03840006
038500*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      03850006
038600             MOVE '1200-VALIDATE-DC-NBR'     TO PV-PARA-NAME      03860006
038700             MOVE SQLCODE                    TO PV-SQLCODE        03870006
038800             MOVE SU160-DC-NBR               TO PV-DISP-LOC       03880006
038900             STRING 'XLT_LOC SELECT FAILED WITH SQL '             03890006
039000                     PV-SQLCODE ' FOR ' PV-DISP-LOC               03900006
039100                     ' SEAL ' SUOBTS-TRLR-SEAL-ID                 03910006
039200                     ' USER ' SU160-USER-ID                       03920006
039300                DELIMITED BY SIZE INTO  PV-ERROR-MSG              03930006
039400             PERFORM 9500-CSSL-LOG                                03940006
039500             PERFORM 9800-ROLLBACK                                03950006
039600             PERFORM 9900-RETURN-TRAN                             03960006
039700     END-EVALUATE.                                                03970006
039800                                                                  03980006
039900***************************************************************   03990006
040000* VALIDATE THAT SEAL NUMBER IS NOT ALREADY USED ON A DIFFERENT    04000006
040100* TRIP ID.                                                        04010006
040200***************************************************************   04020006
040300 1300-VALIDATE-SEAL.                                              04030006
040400                                                                  04040006
040500      MOVE SU160-TRLR-SEAL-ID   TO SUOBTS-TRLR-SEAL-ID.           04050006
040600                                                                  04060006
040700      EXEC SQL                                                    04070006
040800         SELECT  OBTS.OTBND_TRIP_ID                               04080006
040900           INTO :SUOBTS-OTBND-TRIP-ID                             04090006
041000           FROM TSUOBTS OBTS                                      04100006
041100               ,TSUOBTR OBTR                                      04110006
041200          WHERE OBTS.TRLR_SEAL_ID     = :SUOBTS-TRLR-SEAL-ID      04120006
041300            AND OBTS.OTBND_TRIP_ID    = OBTR.OTBND_TRIP_ID        04130006
041400            AND OBTR.TRIP_ACTV_CDE    = 'A'                       04140006
041500            AND OBTS.TRIP_STAT_CDE    = 'DS'                      04150006
041600          WITH UR                                                 04160006
041700      END-EXEC.                                                   04170006
041800                                                                  04180006
041900      EVALUATE TRUE                                               04190006
042000        WHEN SQLCODE = ZERO                                       04200006
042100        WHEN SQLCODE = -811                                       04210006
042200            MOVE PC-TSYMSG-03800         TO PV-TSYMSG-NUMBER      04220006
042300***         TRAILER SEAL USED ON TRIP &VAR - MUST USE A DIFFERENT 04230006
042400***         SEAL                                                  04240006
042500            MOVE SQLCODE    TO PV-SQLCODE                         04250006
042600            MOVE SU160-DC-NBR            TO PV-DISP-LOC           04260006
042700            MOVE SUOBTS-OTBND-TRIP-ID    TO PV-DISP-TRIP          04270006
042800            STRING ' SEAL ALREADY USED ON TRIP '                  04280006
042900                     PV-DISP-TRIP                                 04290006
043000                   ' DC '   PV-DISP-LOC                           04300006
043100                   ' SEAL ' SUOBTS-TRLR-SEAL-ID                   04310006
043200                   ' USER ' SU160-USER-ID                         04320006
043300                   DELIMITED BY SIZE INTO        PV-ERROR-MSG     04330006
043400            MOVE '1300-VALIDATE-SEAL '        TO PV-PARA-NAME     04340006
043500            PERFORM 9500-CSSL-LOG                                 04350006
043600            PERFORM 9800-ROLLBACK                                 04360006
043700            PERFORM 9900-RETURN-TRAN                              04370006
043800        WHEN SQLCODE = 100                                        04380006
043900            CONTINUE                                              04390006
044000        WHEN OTHER                                                04400006
044100            MOVE SQLCODE    TO PV-SQLCODE                         04410006
044200            MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER     04420006
044300*           A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK       04430006
044400            MOVE SU160-DC-NBR            TO PV-DISP-LOC           04440006
044500            STRING ' SELECT TSUOBTS FAILED WITH SQL '             04450006
044600                     PV-SQLCODE                                   04460006
044700                   ' DC '   PV-DISP-LOC                           04470006
044800                   ' SEAL ' SUOBTS-TRLR-SEAL-ID                   04480006
044900                   ' USER ' SU160-USER-ID                         04490006
045000                   DELIMITED BY SIZE INTO        PV-ERROR-MSG     04500006
045100            MOVE ' 2000-GET-OUTBOUND-TRIP ' TO PV-PARA-NAME       04510006
045200            PERFORM 9500-CSSL-LOG                                 04520006
045300            PERFORM 9800-ROLLBACK                                 04530006
045400            PERFORM 9900-RETURN-TRAN                              04540006
045500      END-EVALUATE.                                               04550006
045600                                                                  04560006
045700***************************************************************   04570006
045800* VALIDATE USER ID - IF SPACES, SET IT TO 'KIOSK' DEFAULT.        04580006
045900***************************************************************   04590006
046000 1400-VALIDATE-USER-ID.                                           04600006
046100     IF SU160-USER-ID = SPACES                                    04610006
046200         MOVE 'KIOSK' TO SU160-USER-ID                            04620006
046300     END-IF.                                                      04630006
046400                                                                  04640006
046500***************************************************************   04650006
046600* VALIDATE SEAL NUMBER BY GETTING TRIP ID AND OTHER KEY FIELDS    04660006
046700***************************************************************   04670006
046800 2000-GET-OUTBOUND-TRIP.                                          04680006
046900                                                                  04690006
047000      MOVE SU160-TRLR-SEAL-ID   TO SUOBTS-TRLR-SEAL-ID.           04700006
047100      MOVE SU160-DC-NBR         TO SUOBTS-STAT-OPER-UNT-ID.       04710006
047200                                                                  04720006
047300      EXEC SQL                                                    04730006
047400         SELECT  OBTS.OTBND_TRIP_ID                               04740006
047500                ,OBTR.DEST_OPER_UNT_ID                            04750006
047600                ,OBTR.TRLR_SRL_NBR                                04760006
047700                ,OBTR.DOOR_TYP_CDE                                04770006
047800                ,OBTS.TRIP_STAT_CDE                               04780006
047900                ,OBTS.OTBND_STAT_TMST                             04790006
048000                ,OBTS.STAT_OPER_UNT_ID                            04800006
048100                ,OBTS.DOOR_ID                                     04810006
048200           INTO :SUOBTS-OTBND-TRIP-ID                             04820006
048300               ,:SUOBTR-DEST-OPER-UNT-ID                          04830006
048400               ,:SUOBTR-TRLR-SRL-NBR                              04840006
048500               ,:SUOBTR-DOOR-TYP-CDE                              04850006
048600               ,:SUOBTS-TRIP-STAT-CDE                             04860006
048700               ,:SUOBTS-OTBND-STAT-TMST                           04870006
048800               ,:SUOBTS-STAT-OPER-UNT-ID                          04880006
048900               ,:SUOBTS-DOOR-ID                                   04890006
049000           FROM TSUOBTS OBTS                                      04900006
049100               ,TSUOBTR OBTR                                      04910006
049200          WHERE OBTS.TRLR_SEAL_ID     = :SUOBTS-TRLR-SEAL-ID      04920006
049300            AND OBTS.STAT_OPER_UNT_ID = :SUOBTS-STAT-OPER-UNT-ID  04930006
049400            AND OBTS.OTBND_TRIP_ID    = OBTR.OTBND_TRIP_ID        04940006
049500            AND OBTR.TRIP_ACTV_CDE    = 'A'                       04950006
049600            AND OBTS.OTBND_STAT_TMST  =                           04960006
049700               (SELECT  MAX(OBTS1.OTBND_STAT_TMST)                04970006
049800                  FROM  TSUOBTS OBTS1                             04980006
049900                 WHERE  OBTS1.OTBND_TRIP_ID = OBTS.OTBND_TRIP_ID) 04990006
050000          WITH UR                                                 05000006
050100      END-EXEC.                                                   05010006
050200                                                                  05020006
050300      EVALUATE TRUE                                               05030006
050400        WHEN SQLCODE = ZERO                                       05040006
050500            CONTINUE                                              05050006
050600        WHEN SQLCODE = 100                                        05060006
050700            MOVE PC-TSYMSG-03053         TO PV-TSYMSG-NUMBER      05070006
050800***         OUTBOUND TRIP ID NOT FOUND                            05080006
050900            MOVE SQLCODE    TO PV-SQLCODE                         05090006
051000            MOVE SU160-DC-NBR            TO PV-DISP-LOC           05100006
051100            STRING ' OUTBOUND TRIP ID NOT FOUND '                 05110006
051200                     PV-SQLCODE                                   05120006
051300                   ' DC '   PV-DISP-LOC                           05130006
051400                   ' SEAL ' SUOBTS-TRLR-SEAL-ID                   05140006
051500                   ' USER ' SU160-USER-ID                         05150006
051600                   DELIMITED BY SIZE INTO        PV-ERROR-MSG     05160006
051700            MOVE ' 2000-GET-OUTBOUND-TRIP '   TO PV-PARA-NAME     05170006
051800            PERFORM 9500-CSSL-LOG                                 05180006
051900            PERFORM 9800-ROLLBACK                                 05190006
052000            PERFORM 9900-RETURN-TRAN                              05200006
052100        WHEN SQLCODE NOT = ZERO                                   05210006
052200            MOVE SQLCODE    TO PV-SQLCODE                         05220006
052300            MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER     05230006
052400*           A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK       05240006
052500            MOVE SU160-DC-NBR            TO PV-DISP-LOC           05250006
052600            STRING ' SELECT TSUOBTS FAILED WITH SQL '             05260006
052700                     PV-SQLCODE                                   05270006
052800                   ' DC '   PV-DISP-LOC                           05280006
052900                   ' SEAL ' SUOBTS-TRLR-SEAL-ID                   05290006
053000                   ' USER ' SU160-USER-ID                         05300006
053100                   DELIMITED BY SIZE INTO        PV-ERROR-MSG     05310006
053200            MOVE ' 2000-GET-OUTBOUND-TRIP ' TO PV-PARA-NAME       05320006
053300            PERFORM 9500-CSSL-LOG                                 05330006
053400            PERFORM 9800-ROLLBACK                                 05340006
053500            PERFORM 9900-RETURN-TRAN                              05350006
053600      END-EVALUATE.                                               05360006
053700                                                                  05370006
053800***************************************************************   05380006
053900* VERIFY THAT THE TRIP ID IS READY FOR SHIPPING                   05390006
054000* CURRENT STATUS = 'DC'                                           05400006
054100* DOOR TYPE = 'DS' (SHUTTLE TRAILER) OR 'SH' (SHIPPING TRAILER)   05410006
054200***************************************************************   05420006
054300 2100-EDIT-TRIP-TO-BE-SHIPPED.                                    05430006
054400     IF SUOBTS-TRIP-STAT-CDE  = 'DC'                              05440006
054500         IF SUOBTR-DOOR-TYP-CDE = 'DS' OR 'SH'                    05450006
054600             CONTINUE                                             05460006
054700         ELSE                                                     05470006
054800             MOVE PC-TSYMSG-02992 TO PV-TSYMSG-NUMBER             05480006
054900*            SHIP TRAILER FUNCTION ONLY VALID FOR SHIPPING        05490006
055000*            OR SHUTTLE TRAILERS                                  05500006
055100             MOVE SUOBTS-OTBND-TRIP-ID       TO PV-DISP-TRIP      05510006
055200             MOVE SU160-DC-NBR               TO PV-DISP-LOC       05520006
055300             STRING ' DOOR NOT DS OR SH FOR SEAL '                05530006
055400                     SUOBTS-TRLR-SEAL-ID                          05540006
055500                   ' TRIP ' PV-DISP-TRIP                          05550006
055600                   ' DOOR ' SUOBTR-DOOR-TYP-CDE                   05560006
055700                   ' ' SU160-USER-ID                              05570006
055800                   ' ' PV-DISP-LOC                                05580006
055900                  DELIMITED BY SIZE INTO  PV-ERROR-MSG            05590006
056000             MOVE '2100-EDIT-TRIP-TO-BE-SHIPPED ' TO PV-PARA-NAME 05600006
056100             PERFORM 9500-CSSL-LOG                                05610006
056200             PERFORM 9800-ROLLBACK                                05620006
056300             PERFORM 9900-RETURN-TRAN                             05630006
056400         END-IF                                                   05640006
056500     ELSE                                                         05650006
056600         MOVE PC-TSYMSG-02816         TO PV-TSYMSG-NUMBER         05660006
056700***      INVALID TRAILER STATUS FOR UPDATE FUNCTION               05670006
056800         MOVE SUOBTS-OTBND-TRIP-ID    TO PV-DISP-TRIP             05680006
056900         MOVE SU160-DC-NBR            TO PV-DISP-LOC              05690006
057000         STRING ' TRIP STATUS NOT DC: SEAL '                      05700006
057100                 SUOBTS-TRLR-SEAL-ID                              05710006
057200                ' TRIP ' PV-DISP-TRIP                             05720006
057300                ' STATUS ' SUOBTS-TRIP-STAT-CDE                   05730006
057400                ' '        SU160-USER-ID                          05740006
057500                ' '        PV-DISP-LOC                            05750006
057600                        DELIMITED BY SIZE INTO   PV-ERROR-MSG     05760006
057700         MOVE '2100-EDIT-TRIP-TO-BE-SHIPPED ' TO PV-PARA-NAME     05770006
057800         PERFORM 9500-CSSL-LOG                                    05780006
057900         PERFORM 9800-ROLLBACK                                    05790006
058000         PERFORM 9900-RETURN-TRAN                                 05800006
058100     END-IF.                                                      05810006
058200                                                                  05820006
058300***************************************************************   05830006
058400* CHECK TO SEE IF THE SUMMARY TABLES HAVE BEEN CREATED FOR THE    05840006
058500* TRIP ID.                                                        05850006
058600***************************************************************   05860006
058700 2200-CHECK-FOR-TRIP-SUM.                                         05870006
058800                                                                  05880006
058900     EXEC SQL                                                     05890006
059000         SELECT DISTINCT 1                                        05900006
059100           INTO :PS-SUMMARY-SW                                    05910006
059200           FROM SUT_TRIP_SUM TRIP                                 05920006
059300          WHERE TRIP.OTBND_TRIP_ID  = :SUOBTS-OTBND-TRIP-ID       05930006
059400            AND TRIP.CART_QTY       > 0                           05940006
059500            AND TRIP.CRE_TMST >=                                  05950006
059600                (SELECT MAX(OTBND_STAT_TMST)                      05960006
059700                   FROM TSUOBTS OBTS                              05970006
059800                  WHERE OBTS.OTBND_TRIP_ID  = TRIP.OTBND_TRIP_ID  05980006
059900                    AND TRIP_STAT_CDE = 'DC')                     05990006
060000     END-EXEC                                                     06000006
060100                                                                  06010006
060200     EVALUATE TRUE                                                06020006
060300         WHEN SQLCODE = ZERO                                      06030006
060400             SET PS-THERE-ARE-SUMMARIES TO TRUE                   06040006
060500         WHEN SQLCODE = -305                                      06050006
060600         WHEN SQLCODE = +100                                      06060006
060700             SET PS-THERE-ARE-NO-SUMMARIES TO TRUE                06070006
060800         WHEN SQLCODE NOT = ZERO                                  06080006
060900             MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER    06090006
061000*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      06100006
061100             MOVE SQLCODE                    TO PV-SQLCODE        06110006
061200             MOVE SUOBTS-OTBND-TRIP-ID       TO PV-DISP-TRIP      06120006
061300             MOVE SU160-DC-NBR               TO PV-DISP-LOC       06130006
061400             STRING ' SELECT SUT_TRIP_SUM FAILED SQL '            06140006
061500                     PV-SQLCODE                                   06150006
061600                   ' TRIP ' PV-DISP-TRIP                          06160006
061700                   ' SEAL ' SUOBTS-TRLR-SEAL-ID                   06170006
061800                   ' USER ' SU160-USER-ID                         06180006
061900                   ' DC ' PV-DISP-LOC                             06190006
062000                        DELIMITED BY SIZE INTO   PV-ERROR-MSG     06200006
062100             MOVE '2200-CHECK-FOR-TRIP-SUM ' TO  PV-PARA-NAME     06210006
062200             PERFORM 9500-CSSL-LOG                                06220006
062300             PERFORM 9800-ROLLBACK                                06230006
062400             PERFORM 9900-RETURN-TRAN                             06240006
062500     END-EVALUATE.                                                06250006
062600                                                                  06260006
062700***************************************************************   06270006
062800* IF THE SUMMARY TABLES HAVE NOT BEEN CREATED FOR THE TRIP ID     06280006
062900* CREATE THEM HERE BY LINKING TO SUKCS574.                        06290006
063000***************************************************************   06300006
063100 2210-CREATE-SUMMARIES.                                           06310006
063200                                                                  06320006
063300     INITIALIZE PC047-COMMAREA.                                   06330006
063400     MOVE 'SUKCS808'                  TO PC047-CALLING-PROGRAM.   06340006
063500     MOVE SUOBTS-STAT-OPER-UNT-ID     TO PC047-OPER-UNT-ID.       06350006
063600     MOVE SUOBTS-DOOR-ID              TO PC047-DOOR-ID.           06360006
063700     MOVE SUOBTR-DEST-OPER-UNT-ID     TO PC047-DEST-OPER-UNT-ID.  06370006
063800     MOVE SUOBTS-OTBND-TRIP-ID        TO PC047-OTBND-TRIP-ID.     06380006
063900     MOVE SUOBTR-DOOR-TYP-CDE         TO PC047-DOOR-TYPE-CDE.     06390006
064000                                                                  06400006
064100     MOVE LENGTH OF PC047-COMMAREA    TO PV-COMMAREA-LENGTH.      06410006
064200                                                                  06420006
064300     EXEC CICS                                                    06430006
064400         LINK  PROGRAM   (PC-SUMMARY-PROGRAM)                     06440006
064500               COMMAREA  (PC047-COMMAREA)                         06450006
064600               LENGTH    (PV-COMMAREA-LENGTH)                     06460006
064700               RESP      (PV-CICS-RESPONSE)                       06470006
064800     END-EXEC.                                                    06480006
064900                                                                  06490006
065000     EVALUATE TRUE                                                06500006
065100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06510006
065200             CONTINUE                                             06520006
065300         WHEN OTHER                                               06530006
065400            MOVE PV-CICS-RESPONSE         TO PV-SQLCODE           06540006
065500            MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER     06550006
065600*           A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK       06560006
065700            MOVE PC047-OTBND-TRIP-ID      TO PV-DISP-TRIP         06570006
065800            MOVE SU160-DC-NBR             TO PV-DISP-LOC          06580006
065900            STRING ' SUKCS574 LINK BAD CICS RESPONSE '            06590006
066000                     PV-SQLCODE                                   06600006
066100                   ' SEAL ' SUOBTS-TRLR-SEAL-ID                   06610006
066200                   ' TRIP ID ' PV-DISP-TRIP                       06620006
066300                   ' USER ' SU160-USER-ID                         06630006
066400                   ' DC ' PV-DISP-LOC                             06640006
066500                   DELIMITED BY SIZE INTO     PV-ERROR-MSG        06650006
066600            MOVE ' 2210-CREATE-SUMMARIES ' TO PV-PARA-NAME        06660006
066700            PERFORM 9500-CSSL-LOG                                 06670006
066800            PERFORM 9800-ROLLBACK                                 06680006
066900            PERFORM 9900-RETURN-TRAN                              06690006
067000     END-EVALUATE.                                                06700006
067100                                                                  06710006
067200                                                                  06720006
067300***************************************************************   06730006
067400* IF THIS PROGRAM LINKED TO SUKCS574 TO CREATE THE SUMMARY        06740006
067500* TABLES FOR THE TRIP ID, INSERT A ROW TO THE AUDIT TABLE         06750006
067600* (SUT_TRIP_WRKR_AUD) FOR THIS PROGRAM.                           06760006
067700***************************************************************   06770006
067800 2220-INSERT-WRKR-AUD-SUM.                                        06780006
067900                                                                  06790006
068000     MOVE  SUOBTS-OTBND-TRIP-ID   TO  SUT00006-OTBND-TRIP-ID      06800006
068100     MOVE  SU160-USER-ID          TO  SUT00006-USR-ID.            06810006
068200     MOVE  'SUKC808S'             TO  SUT00006-CRE-BY-PGM-NM.     06820006
068300                                                                  06830006
068400     EXEC SQL                                                     06840006
068500         INSERT  INTO SUT_TRIP_WRKR_AUD                           06850006
068600                (OTBND_TRIP_ID                                    06860006
068700              ,  USR_ID                                           06870006
068800              ,  CRE_TMST                                         06880006
068900              ,  CRE_BY_PGM_NM)                                   06890006
069000         VALUES (:SUT00006-OTBND-TRIP-ID                          06900006
069100              ,  :SUT00006-USR-ID                                 06910006
069200              ,  CURRENT TIMESTAMP                                06920006
069300              ,  :SUT00006-CRE-BY-PGM-NM)                         06930006
069400     END-EXEC.                                                    06940006
069500                                                                  06950006
069600     EVALUATE TRUE                                                06960006
069700         WHEN SQLCODE = ZERO                                      06970006
069800              CONTINUE                                            06980006
069900                                                                  06990006
070000         WHEN OTHER                                               07000006
070100             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  07010006
070200*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      07020006
070300             MOVE SQLCODE                     TO PV-SQLCODE       07030006
070400             MOVE '2220-INSERT-WRKR-AUD-SUM ' TO PV-PARA-NAME     07040006
070500             MOVE SUT00006-OTBND-TRIP-ID      TO PV-DISP-TRIP     07050006
070600             MOVE SU160-DC-NBR                TO PV-DISP-LOC      07060006
070700             STRING ' SUT_TRIP_WRKR_AUD INSERT FAILED '           07070006
070800                             PV-SQLCODE                           07080006
070900                    ' TRIP ' PV-DISP-TRIP                         07090006
071000                    ' USER ' SUT00006-USR-ID                      07100006
071100                    ' SEAL ' SUOBTS-TRLR-SEAL-ID                  07110006
071200                    ' DC ' PV-DISP-LOC                            07120006
071300                    DELIMITED BY SIZE INTO  PV-ERROR-MSG          07130006
071400             PERFORM 9500-CSSL-LOG                                07140006
071500             PERFORM 9800-ROLLBACK                                07150006
071600             PERFORM 9900-RETURN-TRAN                             07160006
071700     END-EVALUATE.                                                07170006
071800                                                                  07180006
071900***************************************************************   07190006
072000* GET THE NUMBER OF UNITS ON THE TRIP AND MAKE SURE THAT THEY     07200006
072100* ARE GREATER THAN ZERO.                                          07210006
072200* 'SH' SHIPPING TRAILERS WILL BE FLAGGED WITH AN ERROR IF THE     07220006
072300* UNIT QTY IS ZERO - THEY NEED TO BE RELEASED IN CICS.            07230006
072400* 'DS' SHUTTLE TRAILERS WILL BE ALLOWED TO SHIP WITH A UNIT QTY   07240006
072500* OF ZERO - IN CICS, THEY ARE SHIPPED UPON CONFIRMATION.          07250006
072600***************************************************************   07260006
072700 2300-CHECK-TRLR-UNITS.                                           07270006
072800                                                                  07280006
072900     EXEC SQL                                                     07290006
073000         SELECT  A.UNT_QTY                                        07300006
073100           INTO :SUT00007-UNT-QTY                                 07310006
073200           FROM  SUT_TRIP_SUM A                                   07320006
073300          WHERE  A.OTBND_TRIP_ID   = :SUOBTS-OTBND-TRIP-ID        07330006
073400            AND  A.CRE_TMST  =                                    07340006
073500                 (SELECT  MAX(B.CRE_TMST)                         07350006
073600                    FROM  SUT_TRIP_SUM B                          07360006
073700                   WHERE  B.OTBND_TRIP_ID   = A.OTBND_TRIP_ID)    07370006
073800     END-EXEC                                                     07380006
073900                                                                  07390006
074000     EVALUATE TRUE                                                07400006
074100         WHEN SQLCODE = ZERO                                      07410006
074200             CONTINUE                                             07420006
074300         WHEN SQLCODE = +100                                      07430006
074400             MOVE ZEROES  TO SUT00007-UNT-QTY                     07440006
074500         WHEN OTHER                                               07450006
074600             MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER    07460006
074700*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      07470006
074800             MOVE SQLCODE                    TO PV-SQLCODE        07480006
074900             MOVE SUOBTS-OTBND-TRIP-ID       TO PV-DISP-TRIP      07490006
075000             MOVE SU160-DC-NBR               TO PV-DISP-LOC       07500006
075100             STRING ' SELECT SUT_TRIP_SUM FAILED FOR TRIP '       07510006
075200                     PV-DISP-TRIP                                 07520006
075300                    ' SEAL ' SUOBTS-TRLR-SEAL-ID                  07530006
075400                    ' SQL ' PV-SQLCODE                            07540006
075500                    ' USER ' SU160-USER-ID                        07550006
075600                    ' DC ' PV-DISP-LOC                            07560006
075700                     DELIMITED BY SIZE INTO  PV-ERROR-MSG         07570006
075800             MOVE '2300-CHECK-TRLR-UNITS  '  TO  PV-PARA-NAME     07580006
075900             PERFORM 9500-CSSL-LOG                                07590006
076000             PERFORM 9800-ROLLBACK                                07600006
076100             PERFORM 9900-RETURN-TRAN                             07610006
076200     END-EVALUATE.                                                07620006
076300                                                                  07630006
076400     IF  (SUT00007-UNT-QTY = ZEROES)                              07640006
076500     AND (SUOBTR-DOOR-TYP-CDE = 'SH')                             07650006
076600         MOVE PC-TSYMSG-02816  TO PV-TSYMSG-NUMBER                07660006
076700*        INVALID TRAILER STATUS FOR UPDATE FUNCTION               07670006
076800         MOVE SUOBTS-OTBND-TRIP-ID       TO PV-DISP-TRIP          07680006
076900         MOVE SU160-DC-NBR               TO PV-DISP-LOC           07690006
077000         STRING ' SH TRLR WITH ZERO UNITS'                        07700006
077100                ' TRIP '  PV-DISP-TRIP                            07710006
077200                ' SEAL ' SUOBTS-TRLR-SEAL-ID                      07720006
077300                ' '  SU160-USER-ID                                07730006
077400                ' ' PV-DISP-LOC                                   07740006
077500                DELIMITED BY SIZE INTO  PV-ERROR-MSG              07750006
077600         MOVE '2300-CHECK-TRLR-UNITS  '  TO  PV-PARA-NAME         07760006
077700         PERFORM 9500-CSSL-LOG                                    07770006
077800         PERFORM 9800-ROLLBACK                                    07780006
077900         PERFORM 9900-RETURN-TRAN                                 07790006
078000     END-IF.                                                      07800006
078100                                                                  07810006
078200***************************************************************   07820006
078300* THIS PARAGRAPH WILL VALIDATE VIA THE SUT_STAT_ASSN TABLE        07830006
078400* THAT THE BEFORE AND AFTER STATUS CODES ARE VALID.               07840006
078500* SINCE BY DEFINITION THIS WEB SERVICE WILL ONLY ALLOW FOR        07850006
078600* CURRENT STATUS CODES OF 'DC' AND IT WILL ONLY SET THE NEW       07860006
078700* STATUS CODE TO 'DS' THIS PARAGRAPH SHOULDN'T BE NECESSARY,      07870006
078800* HOWEVER, IT WILL BE KEPT JUST IN CASE...                        07880006
078900***************************************************************   07890006
079000 2400-VALIDATE-STATUS-CODE.                                       07900006
079100                                                                  07910006
079200     MOVE SUOBTS-TRIP-STAT-CDE       TO DK-CURR-STAT-CDE.         07920006
079300     MOVE 'DS'                       TO DK-NEXT-STAT-CDE.         07930006
079400                                                                  07940006
079500     EXEC SQL                                                     07950006
079600        SELECT CURR_TRIP_STAT_CDE                                 07960006
079700          INTO :SUT00005-CURR-TRIP-STAT-CDE                       07970006
079800          FROM SUT_STAT_ASSN                                      07980006
079900         WHERE CURR_TRIP_STAT_CDE  = :DK-CURR-STAT-CDE            07990006
080000           AND NEXT_TRIP_STAT_CDE  = :DK-NEXT-STAT-CDE            08000006
080100     END-EXEC                                                     08010006
080200                                                                  08020006
080300     EVALUATE TRUE                                                08030006
080400         WHEN SQLCODE = +0                                        08040006
080500             SET PS-VALID-STATUS-CHANGE     TO TRUE               08050006
080600         WHEN SQLCODE = +100                                      08060006
080700             SET PS-NOT-VALID-STATUS-CHANGE TO TRUE               08070006
080800             MOVE PC-TSYMSG-02816           TO PV-TSYMSG-NUMBER   08080006
080900***          INVALID TRAILER STATUS FOR UPDATE FUNCTION           08090006
081000             MOVE SUOBTS-OTBND-TRIP-ID      TO PV-DISP-TRIP       08100006
081100             MOVE SU160-DC-NBR              TO PV-DISP-LOC        08110006
081200             STRING ' ' DK-CURR-STAT-CDE ' TO ' DK-NEXT-STAT-CDE  08120006
081300                   ' STATUS NOT VALID FOR SEAL '                  08130006
081400                    SUOBTS-TRLR-SEAL-ID                           08140006
081500                   ' TRIP ' PV-DISP-TRIP                          08150006
081600                   ' ' SU160-USER-ID                              08160006
081700                   ' ' PV-DISP-LOC                                08170006
081800                        DELIMITED BY SIZE INTO     PV-ERROR-MSG   08180006
081900             MOVE '2400-VALIDATE-STATUS-CODE '  TO PV-PARA-NAME   08190006
082000             PERFORM 9500-CSSL-LOG                                08200006
082100             PERFORM 9800-ROLLBACK                                08210006
082200             PERFORM 9900-RETURN-TRAN                             08220006
082300         WHEN OTHER                                               08230006
082400             MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER    08240006
082500*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      08250006
082600             MOVE SQLCODE                    TO PV-SQLCODE        08260006
082700             MOVE SUOBTS-OTBND-TRIP-ID       TO PV-DISP-TRIP      08270006
082800             MOVE SU160-DC-NBR               TO PV-DISP-LOC       08280006
082900             STRING ' SELECT SUT_STAT_ASSN FAILED SQL '           08290006
083000                      PV-SQLCODE                                  08300006
083100                    ' TRIP ' PV-DISP-TRIP                         08310006
083200                    ' SEAL ' SUOBTS-TRLR-SEAL-ID                  08320006
083300                    ' USER ' SU160-USER-ID                        08330006
083400                    ' DC ' PV-DISP-LOC                            08340006
083500                        DELIMITED BY SIZE INTO    PV-ERROR-MSG    08350006
083600             MOVE '2400-VALIDATE-STATUS-CODE ' TO PV-PARA-NAME    08360006
083700             PERFORM 9500-CSSL-LOG                                08370006
083800             PERFORM 9800-ROLLBACK                                08380006
083900             PERFORM 9900-RETURN-TRAN                             08390006
084000     END-EVALUATE.                                                08400006
084100                                                                  08410006
084200***************************************************************   08420006
084300* THIS PARAGRAPH WILL RETRIEVE ALL OF THE EXISTING VALUES         08430006
084400* FROM THE TSUOBTS TABLE TO PREPARE FOR THE INSERT WITH THE       08440006
084500* NEW STATUS.                                                     08450006
084600***************************************************************   08460006
084700 2500-SELECT-ALL-TSUOBTS-FIELDS.                                  08470006
084800                                                                  08480006
084900     EXEC SQL                                                     08490006
085000         SELECT A.OTBND_TRIP_ID                                   08500006
085100             ,  CHAR(DATE(A.OTBND_STAT_TMST),USA)                 08510006
085200             ,  A.TRIP_STAT_CDE                                   08520006
085300             ,  A.STAT_OPER_UNT_ID                                08530006
085400             ,  A.OTBND_STAT_USR_ID                               08540006
085500             ,  A.DOOR_ID                                         08550006
085600             ,  A.TRLR_SEAL_ID                                    08560006
085700             ,  A.SHIP_SCAC_CDE                                   08570006
085800             ,  A.SHIP_DRV_LAST_NM                                08580006
085900             ,  A.SHIP_DRV_FRST_NM                                08590006
086000             ,  A.SHIP_DRV_ID                                     08600006
086100             ,  A.TRLR_PRKG_LOC_DESC                              08610006
086200             ,  A.TRLR_PRKG_SLOT_NBR                              08620006
086300             ,  A.FINCL_POST_TMST                                 08630006
086400             ,  A.CPCTY_PCT                                       08640006
086500             ,  A.UNUSD_PLLT_QTY                                  08650006
086600             ,  A.LOD_BR_QTY                                      08660006
086700          INTO  :SUOBTS-OTBND-TRIP-ID                             08670006
086800             ,  :PV-USA-DATE                                      08680006
086900             ,  :SUOBTS-TRIP-STAT-CDE                             08690006
087000             ,  :SUOBTS-STAT-OPER-UNT-ID                          08700006
087100             ,  :SUOBTS-OTBND-STAT-USR-ID                         08710006
087200             ,  :SUOBTS-DOOR-ID                                   08720006
087300             ,  :SUOBTS-TRLR-SEAL-ID                              08730006
087400             ,  :SUOBTS-SHIP-SCAC-CDE                             08740006
087500             ,  :SUOBTS-SHIP-DRV-LAST-NM                          08750006
087600             ,  :SUOBTS-SHIP-DRV-FRST-NM                          08760006
087700             ,  :SUOBTS-SHIP-DRV-ID                               08770006
087800             ,  :SUOBTS-TRLR-PRKG-LOC-DESC                        08780006
087900             ,  :SUOBTS-TRLR-PRKG-SLOT-NBR                        08790006
088000             ,  :SUOBTS-FINCL-POST-TMST                           08800006
088100             ,  :SUOBTS-CPCTY-PCT                                 08810006
088200             ,  :SUOBTS-UNUSD-PLLT-QTY                            08820006
088300             ,  :SUOBTS-LOD-BR-QTY                                08830006
088400          FROM  TSUOBTS A                                         08840006
088500         WHERE  A.OTBND_TRIP_ID   = :SUOBTS-OTBND-TRIP-ID         08850006
088600           AND  A.OTBND_STAT_TMST  =                              08860006
088700              (SELECT  MAX(B.OTBND_STAT_TMST)                     08870006
088800                 FROM  TSUOBTS B                                  08880006
088900               WHERE  B.OTBND_TRIP_ID     = A.OTBND_TRIP_ID)      08890006
089000     END-EXEC                                                     08900006
089100                                                                  08910006
089200     EVALUATE TRUE                                                08920006
089300         WHEN SQLCODE = ZERO                                      08930006
089400             CONTINUE                                             08940006
089500         WHEN OTHER                                               08950006
089600             SET PS-NOT-VALID-STATUS-CHANGE TO TRUE               08960006
089700             MOVE PC-TSYMSG-01570           TO PV-TSYMSG-NUMBER   08970006
089800*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      08980006
089900             MOVE SUOBTS-OTBND-TRIP-ID      TO PV-DISP-TRIP       08990006
090000             MOVE SU160-DC-NBR              TO PV-DISP-LOC        09000006
090100             STRING ' SELECT TSUOBTS FAILED SQL '                 09010006
090200                     PV-SQLCODE                                   09020006
090300                    ' TRIP ' PV-DISP-TRIP                         09030006
090400                    ' SEAL ' SUOBTS-TRLR-SEAL-ID                  09040006
090500                    ' USER ' SU160-USER-ID                        09050006
090600                    ' DC ' PV-DISP-LOC                            09060006
090700                        DELIMITED BY SIZE INTO  PV-ERROR-MSG      09070006
090800             MOVE '2500-SELECT-ALL-TSUOBTS-FIELDS '               09080006
090900                                                 TO PV-PARA-NAME  09090006
091000             PERFORM 9500-CSSL-LOG                                09100006
091100             PERFORM 9800-ROLLBACK                                09110006
091200             PERFORM 9900-RETURN-TRAN                             09120006
091300     END-EVALUATE.                                                09130006
091400                                                                  09140006
091500***************************************************************   09150006
091600* THIS PARAGRAPH WILL INSERT A ROW WITH THE NEW STATUS CODE       09160006
091700* TO THE TSUOBTS TABLE.                                           09170006
091800***************************************************************   09180006
091900 3000-INSERT-NEW-TSUOBTS-STATUS.                                  09190006
092000                                                                  09200006
092100     MOVE 'DS'                     TO SUOBTS-TRIP-STAT-CDE.       09210006
092200     MOVE  SU160-USER-ID           TO SUOBTS-OTBND-STAT-USR-ID.   09220006
092300     EXEC SQL                                                     09230006
092400          INSERT INTO TSUOBTS                                     09240006
092500                (OTBND_TRIP_ID                                    09250006
092600              ,  OTBND_STAT_TMST                                  09260006
092700              ,  TRIP_STAT_CDE                                    09270006
092800              ,  STAT_OPER_UNT_ID                                 09280006
092900              ,  OTBND_STAT_USR_ID                                09290006
093000              ,  DOOR_ID                                          09300006
093100              ,  TRLR_SEAL_ID                                     09310006
093200              ,  SHIP_SCAC_CDE                                    09320006
093300              ,  SHIP_DRV_LAST_NM                                 09330006
093400              ,  SHIP_DRV_FRST_NM                                 09340006
093500              ,  SHIP_DRV_ID                                      09350006
093600              ,  TRLR_PRKG_LOC_DESC                               09360006
093700              ,  TRLR_PRKG_SLOT_NBR                               09370006
093800              ,  FINCL_POST_TMST                                  09380006
093900              ,  CPCTY_PCT                                        09390006
094000              ,  UNUSD_PLLT_QTY                                   09400006
094100              ,  LOD_BR_QTY)                                      09410006
094200        VALUES  (:SUOBTS-OTBND-TRIP-ID                            09420006
094300              ,  CURRENT TIMESTAMP                                09430006
094400              ,  :SUOBTS-TRIP-STAT-CDE                            09440006
094500              ,  :SUOBTS-STAT-OPER-UNT-ID                         09450006
094600              ,  :SUOBTS-OTBND-STAT-USR-ID                        09460006
094700              ,  :SUOBTS-DOOR-ID                                  09470006
094800              ,  :SUOBTS-TRLR-SEAL-ID                             09480006
094900              ,  :SUOBTS-SHIP-SCAC-CDE                            09490006
095000              ,  :SUOBTS-SHIP-DRV-LAST-NM                         09500006
095100              ,  :SUOBTS-SHIP-DRV-FRST-NM                         09510006
095200              ,  :SUOBTS-SHIP-DRV-ID                              09520006
095300              ,  :SUOBTS-TRLR-PRKG-LOC-DESC                       09530006
095400              ,  :SUOBTS-TRLR-PRKG-SLOT-NBR                       09540006
095500              ,  :SUOBTS-FINCL-POST-TMST                          09550006
095600              ,  :SUOBTS-CPCTY-PCT                                09560006
095700              ,  :SUOBTS-UNUSD-PLLT-QTY                           09570006
095800              ,  :SUOBTS-LOD-BR-QTY)                              09580006
095900     END-EXEC.                                                    09590006
096000                                                                  09600006
096100     EVALUATE TRUE                                                09610006
096200         WHEN SQLCODE = ZERO                                      09620006
096300             CONTINUE                                             09630006
096400         WHEN OTHER                                               09640006
096500             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  09650006
096600*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      09660006
096700             MOVE SUOBTS-OTBND-TRIP-ID       TO PV-DISP-TRIP      09670006
096800             MOVE SU160-DC-NBR               TO PV-DISP-LOC       09680006
096900             STRING ' INSERT TSUOBTS FAILED SQL '                 09690006
097000                     PV-SQLCODE                                   09700006
097100                   ' TRIP ID ' PV-DISP-TRIP                       09710006
097200                   ' SEAL ' SUOBTS-TRLR-SEAL-ID                   09720006
097300                   ' USER ' SU160-USER-ID                         09730006
097400                   ' DC ' PV-DISP-LOC                             09740006
097500                        DELIMITED BY SIZE INTO  PV-ERROR-MSG      09750006
097600             MOVE '3000-INSERT-NEW-TSUOBTS-STATUS '               09760006
097700                                                  TO PV-PARA-NAME 09770006
097800             PERFORM 9500-CSSL-LOG                                09780006
097900             PERFORM 9800-ROLLBACK                                09790006
098000             PERFORM 9900-RETURN-TRAN                             09800006
098100     END-EVALUATE.                                                09810006
098200                                                                  09820006
098300                                                                  09830006
098400***************************************************************   09840006
098500* THIS PARAGRAPH WILL INSERT INTO THE WORKER DATABASE - WHO       09850006
098600* PERFORMED THE FUNCTION FOR THE UPDATED TRAILER STATUS.          09860006
098700***************************************************************   09870006
098800 3100-INSERT-WORKER-AUDIT.                                        09880006
098900     MOVE  SUOBTS-OTBND-TRIP-ID   TO  SUT00006-OTBND-TRIP-ID.     09890006
099000     MOVE  SU160-USER-ID          TO  SUT00006-USR-ID.            09900006
099100     MOVE  'SUKCS808'             TO  SUT00006-CRE-BY-PGM-NM.     09910006
099200                                                                  09920006
099300     EXEC SQL                                                     09930006
099400         INSERT INTO SUT_TRIP_WRKR_AUD                            09940006
099500                 (OTBND_TRIP_ID                                   09950006
099600              ,  USR_ID                                           09960006
099700              ,  CRE_TMST                                         09970006
099800              ,  CRE_BY_PGM_NM)                                   09980006
099900         VALUES (:SUT00006-OTBND-TRIP-ID                          09990006
100000              ,  :SUT00006-USR-ID                                 10000006
100100              ,  CURRENT TIMESTAMP                                10010006
100200              ,  :SUT00006-CRE-BY-PGM-NM)                         10020006
100300     END-EXEC.                                                    10030006
100400                                                                  10040006
100500     EVALUATE TRUE                                                10050006
100600         WHEN SQLCODE = ZERO                                      10060006
100700              CONTINUE                                            10070006
100800         WHEN OTHER                                               10080006
100900             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  10090006
101000*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      10100006
101100             MOVE SUT00006-OTBND-TRIP-ID     TO PV-DISP-TRIP      10110006
101200             MOVE SU160-DC-NBR               TO PV-DISP-LOC       10120006
101300             STRING ' SUT_TRIP_WRKR_AUD INSERT FAILED '           10130006
101400                             PV-SQLCODE                           10140006
101500                    ' TRIP ' PV-DISP-TRIP                         10150006
101600                    ' USER ' SUT00006-USR-ID                      10160006
101700                    ' SEAL ' SUOBTS-TRLR-SEAL-ID                  10170006
101800                    ' DC ' PV-DISP-LOC                            10180006
101900                    DELIMITED BY SIZE INTO       PV-ERROR-MSG     10190006
102000             MOVE '3100-INSERT-WORKER-AUDIT ' TO PV-PARA-NAME     10200006
102100             PERFORM 9500-CSSL-LOG                                10210006
102200             PERFORM 9800-ROLLBACK                                10220006
102300             PERFORM 9900-RETURN-TRAN                             10230006
102400     END-EVALUATE.                                                10240006
102500                                                                  10250006
102600                                                                  10260006
102700***************************************************************   10270006
102800* CHECK TO SEE IF THE DC IS DOWNLOADING ASN'S TO WMS              10280006
102900***************************************************************   10290006
103000 3200-CHECK-ASN-TO-WMS-STATUS.                                    10300006
103100     SET PS-DWNLD-ASN-TO-WMS-NO       TO TRUE.                    10310006
103200     MOVE SUOBTR-DEST-OPER-UNT-ID     TO DK-LOC-ID.               10320006
103300                                                                  10330006
103400     EXEC SQL                                                     10340006
103500          SELECT  FUNC_TXT                                        10350006
103600          INTO    :KRPRPM-FUNC-TXT                                10360006
103700          FROM  TKRPRPM                                           10370006
103800         WHERE  LOC_ID                   =  :DK-LOC-ID            10380006
103900           AND  SYS_PRC_FUNC_CDE         =  'SASNDN'              10390006
104000           AND  FUNC_PRC_STAT_CDE        =  'AC'                  10400006
104100           AND  INTFC_SYS_CDE            =  'KHL'                 10410006
104200           AND  FUNC_BEG_TMST            <  CURRENT TIMESTAMP     10420006
104300     END-EXEC.                                                    10430006
104400                                                                  10440006
104500     EVALUATE TRUE                                                10450006
104600         WHEN SQLCODE = ZERO                                      10460006
104700             IF KRPRPM-FUNC-TXT = 'Y'                             10470006
104800                 SET PS-DWNLD-ASN-TO-WMS-YES TO TRUE              10480006
104900             END-IF                                               10490006
105000         WHEN SQLCODE = +100                                      10500006
105100             CONTINUE                                             10510006
105200         WHEN OTHER                                               10520006
105300             MOVE PC-TSYMSG-01570         TO PV-TSYMSG-NUMBER     10530006
105400*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      10540006
105500             MOVE SUOBTS-OTBND-TRIP-ID    TO PV-DISP-TRIP         10550006
105600             MOVE DK-LOC-ID               TO PV-DISP-LOC          10560006
105700             STRING ' READ TKRPRPM = SASNDN FAILED WITH '         10570006
105800                             PV-SQLCODE                           10580006
105900                    ' DC '  PV-DISP-LOC                           10590006
106000                    ' TRIP ' PV-DISP-TRIP                         10600006
106100                    ' SEAL ' SUOBTS-TRLR-SEAL-ID                  10610006
106200                    ' USER ' SU160-USER-ID                        10620006
106300                    DELIMITED BY SIZE INTO  PV-ERROR-MSG          10630006
106400             MOVE '3200-CHECK-ASN-TO-WMS-STATUS ' TO PV-PARA-NAME 10640006
106500             PERFORM 9500-CSSL-LOG                                10650006
106600             PERFORM 9800-ROLLBACK                                10660006
106700             PERFORM 9900-RETURN-TRAN                             10670006
106800     END-EVALUATE.                                                10680006
106900                                                                  10690006
107000***************************************************************   10700006
107100* THIS PARAGRAPH CALLS THE ASN SHIPMENT CONTROL MODULE            10710006
107200***************************************************************   10720006
107300 3220-CALL-ASN-SHIP-CNTL-MOD.                                     10730006
107400     INITIALIZE WS004-FIELDS.                                     10740006
107500     SET WS004-SHIP-TRAILER        TO TRUE.                       10750006
107600     MOVE SUOBTS-OTBND-TRIP-ID     TO WS004-OTBND-TRIP-ID.        10760006
107610     MOVE SUOBTR-DEST-OPER-UNT-ID  TO WS004-OPER-UNT-ID.          10761006
107800     SET WS004-SOURCE-SHIP         TO TRUE.                       10780006
107900     MOVE SU160-USER-ID            TO WS004-USER-ID.              10790006
108000     MOVE 'SUKCS808'               TO WS004-CALLING-PROGRAM-NAME. 10800006
108100     MOVE ZEROES                   TO WS004-SRC-TASK-NUMBER.      10810006
108200     MOVE LENGTH OF WS004-FIELDS   TO PV-COMMAREA-LENGTH.         10820006
108300                                                                  10830006
108400     EXEC CICS                                                    10840006
108500         LINK PROGRAM  (PC-SHIP-CNTL-MOD)                         10850006
108600              COMMAREA (WS004-FIELDS)                             10860006
108700              LENGTH   (PV-COMMAREA-LENGTH)                       10870006
108800     END-EXEC.                                                    10880006
108900                                                                  10890006
109000     EVALUATE TRUE                                                10900006
109100         WHEN WS004-SUCCESSFUL                                    10910006
109200             CONTINUE                                             10920006
109300         WHEN WS004-INVALID-SQL                                   10930006
109400         WHEN WS004-DATABASE-BUSY                                 10940006
109500             MOVE PC-TSYMSG-03546  TO PV-TSYMSG-NUMBER            10950006
109600*            ERROR IN WMS DOWNLOAD MODULE - CONTACT HELP DESK     10960006
109700             MOVE WS004-OTBND-TRIP-ID     TO PV-DISP-TRIP         10970006
109800             MOVE WS004-OPER-UNT-ID       TO PV-DISP-LOC2         10980006
109900             MOVE SU160-DC-NBR            TO PV-DISP-LOC          10990006
110000             STRING ' BAD WSKCS306 CODE1= '                       11000006
110100                             WS004-SUCCESS-IND                    11010006
110200                    ' TRIP ' PV-DISP-TRIP                         11020006
110300                    ' DEST ' PV-DISP-LOC2                         11030006
110400                    ' SEAL ' SUOBTS-TRLR-SEAL-ID                  11040006
110500                    ' USER ' SU160-USER-ID                        11050006
110600                    ' DC ' PV-DISP-LOC                            11060006
110700                    DELIMITED BY SIZE INTO  PV-ERROR-MSG          11070006
110800             MOVE '3200-CHECK-ASN-TO-WMS-STATUS ' TO PV-PARA-NAME 11080006
110900             PERFORM 9500-CSSL-LOG                                11090006
111000             PERFORM 9800-ROLLBACK                                11100006
111100             PERFORM 9900-RETURN-TRAN                             11110006
111200         WHEN OTHER                                               11120006
111300             MOVE PC-TSYMSG-03548  TO PV-TSYMSG-NUMBER            11130006
111400*            ERROR OCCURRED TRYING TO DOWNLOAD TRAILER TO WMOS -  11140006
111500*            CALL HELP DESK                                       11150006
111600             MOVE WS004-OTBND-TRIP-ID        TO PV-DISP-TRIP      11160006
111700             MOVE WS004-OPER-UNT-ID          TO PV-DISP-LOC2      11170006
111800             MOVE SU160-DC-NBR               TO PV-DISP-LOC       11180006
111900             STRING ' BAD WSKCS306 CODE2= '                       11190006
112000                             WS004-SUCCESS-IND                    11200006
112100                    ' TRIP ' PV-DISP-TRIP                         11210006
112200                    ' DEST ' PV-DISP-LOC2                         11220006
112300                    ' SEAL ' SUOBTS-TRLR-SEAL-ID                  11230006
112400                    ' DC ' PV-DISP-LOC                            11240006
112500                    ' USER ' SU160-USER-ID                        11250006
112600                    DELIMITED BY SIZE INTO  PV-ERROR-MSG          11260006
112700             MOVE '3200-CHECK-ASN-TO-WMS-STATUS ' TO PV-PARA-NAME 11270006
112800             PERFORM 9500-CSSL-LOG                                11280006
112900             PERFORM 9800-ROLLBACK                                11290006
113000             PERFORM 9900-RETURN-TRAN                             11300006
113100     END-EVALUATE.                                                11310006
113200                                                                  11320006
113300***************************************************************   11330006
113400* THIS PARAGRAPH WILL WRITE ERRORS TO THE CICS LOG.               11340006
113500***************************************************************   11350006
113600 9500-CSSL-LOG.                                                   11360006
113700                                                                  11370006
113800      MOVE LENGTH OF PV-CICS-MSG-AREA  TO PV-COMMAREA-LENGTH.     11380006
113900                                                                  11390006
114000      EXEC CICS                                                   11400006
114100           WRITEQ TD                                              11410006
114200            QUEUE   ('CSSL')                                      11420006
114300             FROM   (PV-CICS-MSG-AREA)                            11430006
114400           LENGTH   (PV-COMMAREA-LENGTH)                          11440006
114500             RESP   (PV-CICS-RESPONSE)                            11450006
114600      END-EXEC.                                                   11460006
114700                                                                  11470006
114800***************************************************************   11480006
114900* ROLLBACK ALL DB2 CHANGES WHEN A PROBLEM IS ENCOUNTERED AND      11490006
115000* THE SHIPPING PROCESS CAN'T BE COMPLETED.                        11500006
115100***************************************************************   11510006
115200 9800-ROLLBACK.                                                   11520006
115300                                                                  11530006
115400     EXEC CICS SYNCPOINT                                          11540006
115500          ROLLBACK                                                11550006
115600     END-EXEC.                                                    11560006
115700                                                                  11570006
115800***************************************************************   11580006
115900* THIS PARAGRAPH WILL RETURN TO THE WEBSERVICE CALLER             11590006
116000* WITH THE RESULTING MESSAGE.                                     11600006
116100***************************************************************   11610006
116200 9900-RETURN-TRAN.                                                11620006
116300                                                                  11630006
116400     MOVE SU160-TRLR-SEAL-ID      TO SU161-TRLR-SEAL-ID.          11640006
116500     MOVE PV-TSYMSG-NUMBER        TO DP507I-MSG-NUMBER            11650006
116600                                     SU161-MSG-ID.                11660006
116700     PERFORM 9910-READ-SYSTEM-MESSAGE.                            11670006
116800     MOVE DP507I-MSG-TEXT(1:70)   TO SU161-MSG-TEXT.              11680006
116900     IF PV-TSYMSG-NUMBER = 03800                                  11690006
117000        PERFORM 9915-SUBSTITUTE-MSG-VAR                           11700006
117100     END-IF.                                                      11710006
117200     MOVE SU161-OUT-SHIP-OUTB-TLR TO DFHCOMMAREA.                 11720006
117300                                                                  11730006
117400     EXEC CICS RETURN                                             11740006
117500     END-EXEC.                                                    11750006
117600                                                                  11760006
117700***************************************************************   11770006
117800* THIS PARAGRAPH WILL GET THE DESCRIPTION FOR THE MESSAGE ID      11780006
117900* BEING RETURNED.                                                 11790006
118000***************************************************************   11800006
118100 9910-READ-SYSTEM-MESSAGE.                                        11810006
118200     EXEC CICS READ                                               11820006
118300               DATASET ('DPSYSMSG')                               11830006
118400               RIDFLD  (DP507I-MSG-NUMBER)                        11840006
118500               INTO    (DP507I-MESSAGES-INPUT-RECORD)             11850006
118600               RESP    (PV-CICS-RESPONSE)                         11860006
118700     END-EXEC.                                                    11870006
118800                                                                  11880006
118900     IF  PV-CICS-RESPONSE NOT = 0                                 11890006
119000         IF DP507I-MSG-NUMBER = 01044                             11900004
119100             MOVE 'RESPONSE SUCCESSFUL'                           11910004
119200                                TO DP507I-MSG-TEXT                11920002
119300         ELSE                                                     11930002
119400             MOVE 'UNABLE TO TRANSLATE MESSAGE NUMBER'            11940002
119500                                TO DP507I-MSG-TEXT                11950002
119600         END-IF                                                   11960002
119700     END-IF.                                                      11970002
119800                                                                  11980000
119900                                                                  11990000
120000***************************************************************   12000000
120100* THIS PARAGRAPH WILL REPLACE &VAR WITH THE TRIP ID IN THE        12010000
120200* SYSTEM MESSAGE BEING RETURNED.                                  12020000
120300***************************************************************   12030000
120400 9915-SUBSTITUTE-MSG-VAR.                                         12040000
120500     MOVE +1               TO PV-MSG-VAR-LEAD-SPACE.              12050000
120600     MOVE SU161-MSG-TEXT   TO PV-MSG-VAR-SAVE.                    12060000
120700     INITIALIZE SU161-MSG-TEXT                                    12070000
120800                PV-MSG-VAR-IND                                    12080000
120900                PV-MSG-STRING-PTR                                 12090000
121000                PV-MSG-REMAINDER.                                 12100000
121100                                                                  12110000
121200     UNSTRING DP507I-MSG-TEXT DELIMITED BY PC-MSG-VAR-IND         12120000
121300         INTO SU161-MSG-TEXT                                      12130000
121400                 DELIMITER IN PV-MSG-VAR-IND                      12140000
121500                 COUNT     IN PV-MSG-STRING-PTR                   12150000
121600              PV-MSG-REMAINDER                                    12160000
121700     END-UNSTRING.                                                12170000
121800                                                                  12180000
121900     IF  PV-MSG-STRING-PTR > ZERO                                 12190000
122000         ADD +1            TO PV-MSG-STRING-PTR                   12200000
122100     ELSE                                                         12210000
122200         MOVE +1           TO PV-MSG-STRING-PTR                   12220000
122300     END-IF.                                                      12230000
122400     IF  PV-MSG-VAR-SAVE > SPACE                                  12240000
122500         IF  PV-MSG-VAR-SAVE(1:1) > SPACE                         12250000
122600             CONTINUE                                             12260000
122700         ELSE                                                     12270000
122800             INSPECT PV-MSG-VAR-SAVE                              12280000
122900                 TALLYING PV-MSG-VAR-LEAD-SPACE                   12290000
123000                 FOR LEADING SPACE                                12300000
123100         END-IF                                                   12310000
123200     ELSE                                                         12320000
123300         MOVE '?'         TO PV-MSG-VAR-SAVE                      12330000
123400     END-IF.                                                      12340000
123500*==> FIND LAST NON-BLANK CHARACTER OF THE MSG VAR.                12350000
123600     MOVE LENGTH OF PV-MSG-VAR-SAVE  TO PV-MSG-VAR-LENGTH.        12360000
123700     PERFORM                                                      12370000
123800         VARYING PV-CHAR-POS                                      12380000
123900         FROM PV-MSG-VAR-LENGTH                                   12390000
124000         BY -1                                                    12400000
124100         UNTIL PV-CHAR-POS < 1                                    12410000
124200           OR PV-MSG-VAR-SAVE(PV-CHAR-POS:1) > SPACE              12420000
124300             CONTINUE                                             12430000
124400     END-PERFORM.                                                 12440000
124500     COMPUTE PV-MSG-VAR-LENGTH =                                  12450000
124600         PV-CHAR-POS - PV-MSG-VAR-LEAD-SPACE + 1.                 12460000
124700     MOVE PV-DISP-TRIP TO SU161-MSG-TEXT(PV-MSG-STRING-PTR:9)     12470000
124800     ADD +9            TO PV-MSG-STRING-PTR.                      12480000
124900     IF  PV-MSG-STRING-PTR < LENGTH OF SU161-MSG-TEXT             12490000
125000         MOVE PV-MSG-REMAINDER                                    12500000
125100                       TO SU161-MSG-TEXT(PV-MSG-STRING-PTR:)      12510000
125200     END-IF.                                                      12520000
