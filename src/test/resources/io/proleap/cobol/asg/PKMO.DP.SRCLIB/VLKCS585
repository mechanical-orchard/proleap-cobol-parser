000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400                                                                  00040001
000500 PROGRAM-ID.                VLKCS585.                             00050001
000600 AUTHOR.                    MICHAEL WALTERS.                      00060001
000700 INSTALLATION.              KOHLS DEPARTMENT STORES.              00070001
000800 DATE-WRITTEN.              06-03-96.                             00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100******************************************************************00110001
001200*  CICS PROGRAM - VLKCS585 - W085                                *00120001
001300*                                                                *00130001
001400*       PO SYSTEM PRETICKET REQUEST CRIT SPEC SCREEN             *00140001
001500*                                                                *00150001
001600*  THIS SCREEN WILL BE USED BY THE BUYING OFFICE AS THE CRITERIA *00160001
001700*  SPECIFICATION SCREEN FOR THE REST OF THE PRETICKET INQUIRE    *00170001
001800*  SYSTEM.                                                       *00180001
001900******************************************************************00190001
263627*---------------------------------------------------------------* 00191065
263627* CHANGED 11/05/2021    BY JIM HUNTER      WR: CHG0263627         00192065
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00193065
263627* MAKING THE CALL DYNAMIC VS STATIC.                              00194065
263627*---------------------------------------------------------------* 00195065
CICS  * CHANGED 11/14/2022    BY JIM HUNTER      WR: CHG0278236         00196066
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00197066
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00198066
CICS  ***************************************************************** 00199066
002000                                                                  00200001
002100 ENVIRONMENT DIVISION.                                            00210001
002400                                                                  00220001
002500 DATA DIVISION.                                                   00230001
002700                                                                  00240001
002800 WORKING-STORAGE SECTION.                                         00250001
002900*                                                                 00260001
003000 01  PV-PROGRAM-VARIABLES.                                        00270001
022100     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      00280001
022200                                                    COMP SYNC.    00290001
022100     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      00300043
022200                                                    COMP.         00310043
014505     05  PV-DATE-ISO.                                             00320045
014600         10  PV-DATE-CC                 PIC  X(02).               00330045
014700         10  PV-DATE-YY                 PIC  X(02).               00340045
014800         10  PV-DATE-DASH1              PIC  X VALUE '-'.         00350045
014900         10  PV-DATE-MM                 PIC  X(02).               00360045
015000         10  PV-DATE-DASH2              PIC  X VALUE '-'.         00370045
015100         10  PV-DATE-DD                 PIC  X(02).               00380045
015200     05  PV-DATE-6BYTE.                                           00390045
015300         10  PV-DATE-YY                 PIC  X(02).               00400045
015400         10  PV-DATE-MM                 PIC  X(02).               00410045
015500         10  PV-DATE-DD                 PIC  X(02).               00420045
015600     05  PV-DATE-USA.                                             00430045
015700         10  PV-DATE-MM                 PIC  X(02).               00440045
015800         10  PV-DATE-SLASH1             PIC  X VALUE '/'.         00450045
015900         10  PV-DATE-DD                 PIC  X(02).               00460045
016000         10  PV-DATE-SLASH2             PIC  X VALUE '/'.         00470045
016100         10  PV-DATE-CC                 PIC  X(02).               00480045
016200         10  PV-DATE-YY                 PIC  X(02).               00490045
016300                                                                  00500045
022201*                                                                 00510001
022202 01  PC-PROGRAM-CONSTANTS.                                        00520001
022203     05  PC-DPT-MDSELV-CDE         PIC  X(03)  VALUE 'DPT'.       00530001
022204     05  PC-OPERCO-NBR             PIC  X(02)  VALUE '03'.        00540001
022205     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'VL585A  '. 00550001
022206     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'VLKM585 '. 00560001
022207     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'VLKCS585'. 00570026
022208     05  PC-PRETICKET-TYP-CDE      PIC S9(04)  COMP               00580026
022209                                               VALUE +1.          00590026
022210     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00600026
022211                                               COMP-3.            00610026
022212     05  PC-SERVICE-AGRMT-CDE      PIC  X(01)  VALUE '4'.         00620026
022213     05  PC-TSYMSG-NUMBERS.                                       00630001
022214         10  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.      00640047
022214         10  PC-TSYMSG-00014       PIC  9(05)  VALUE  00014.      00650047
022215         10  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.      00660001
022216         10  PC-TSYMSG-00095       PIC  9(05)  VALUE  00095.      00670001
022217         10  PC-TSYMSG-00083       PIC  9(05)  VALUE  00083.      00680001
022218         10  PC-TSYMSG-00224       PIC  9(05)  VALUE  00224.      00690004
022219         10  PC-TSYMSG-00308       PIC  9(05)  VALUE  00308.      00700001
022220         10  PC-TSYMSG-00398       PIC  9(05)  VALUE  00398.      00710001
022221         10  PC-TSYMSG-00461       PIC  9(05)  VALUE  00461.      00720001
022222         10  PC-TSYMSG-01418       PIC  9(05)  VALUE  01418.      00730021
022223         10  PC-TSYMSG-01420       PIC  9(05)  VALUE  01420.      00740023
022224         10  PC-TSYMSG-01321       PIC  9(05)  VALUE  01321.      00750009
022225         10  PC-TSYMSG-01322       PIC  9(05)  VALUE  01322.      00760009
022226         10  PC-TSYMSG-01323       PIC  9(05)  VALUE  01323.      00770009
022227         10  PC-TSYMSG-01324       PIC  9(05)  VALUE  01324.      00780001
022228         10  PC-TSYMSG-01331       PIC  9(05)  VALUE  01331.      00790001
022228         10  PC-TSYMSG-01339       PIC  9(05)  VALUE  01339.      00800049
022229         10  PC-TSYMSG-01348       PIC  9(05)  VALUE  01348.      00810001
022230         10  PC-TSYMSG-01349       PIC  9(05)  VALUE  01349.      00820001
022231         10  PC-TSYMSG-01350       PIC  9(05)  VALUE  01350.      00830001
022232         10  PC-TSYMSG-01351       PIC  9(05)  VALUE  01351.      00840001
022233         10  PC-TSYMSG-01352       PIC  9(05)  VALUE  01352.      00850001
022234         10  PC-TSYMSG-01353       PIC  9(05)  VALUE  01353.      00860001
022235         10  PC-TSYMSG-01354       PIC  9(05)  VALUE  01354.      00870001
022236         10  PC-TSYMSG-01388       PIC  9(05)  VALUE  01388.      00880011
022237*                                                                 00890001
022238 01  DK-DB2-KEY-VALUES.                                           00900001
022239     05  DK-PO-NUMBER              PIC S9(09)  COMP.              00910001
000940     05  DK-DMA-NBR                   PIC X(02)  VALUE SPACES.    00920043
000950     05  DK-GMA-NBR                   PIC X(02)  VALUE SPACES.    00930043
022240     05  DK-VENDOR-NAME            PIC  X(30).                    00940001
022241     05  DK-DEPT-NBR               PIC  X(03).                    00950001
022242*                                                                 00960001
022243 01  PS-PROGRAM-SWITCHES.                                         00970001
022244     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        00980001
022245         88  PS-ERROR                          VALUE  'Y'.        00990001
022246         88  PS-NO-ERROR                       VALUE  'N'.        01000001
022247                                                                  01010001
022248 01  PM-PROGRAM-MESSAGES.                                         01020001
022249     05  PM-ABEND-INFO-A.                                         01030001
022250         10  FILLER                PIC X(15)   VALUE              01040001
022251                                   'DP020-SRC-AID: '.             01050001
022252         10  PM-A-SRC-AID          PIC X(02)   VALUE  SPACE.      01060001
022253         10  FILLER                PIC X(19)   VALUE              01070001
022254                                   '. DP020-FK-ACTION: '.         01080001
022255         10  PM-A-FK-ACTION        PIC X(01)   VALUE  SPACE.      01090001
022256         10  FILLER                PIC X(22)   VALUE              01100001
022257                                   '. DP020-FK-DISPN-IND: '.      01110001
022258         10  PM-A-FK-DISPN         PIC X(01)   VALUE  SPACE.      01120001
022259         10  FILLER                PIC X(01)   VALUE '.'.         01130001
022260         10  FILLER                PIC X(19)   VALUE SPACE.       01140001
022261                                                                  01150001
022262                                                                  01160001
022263*----------------------------------------------------------------*01170001
022264*    MAP LAYOUT                                                  *01180001
022265*----------------------------------------------------------------*01190001
022266                                                                  01200001
022267     COPY VLKM585.                                                01210001
022268     EJECT                                                        01220001
022269*----------------------------------------------------------------*01230001
022270*    ATTRIBUTE SETTINGS COPYBOOK.                                *01240001
022271*----------------------------------------------------------------*01250001
022272                                                                  01260001
022273     COPY DPWS015.                                                01270001
022274                                                                  01280001
022275*----------------------------------------------------------------*01290001
022276*    FUNCTION KEYS COPYBOOK                                      *01300001
022277*----------------------------------------------------------------*01310001
022278                                                                  01320001
022279     COPY DPWS016.                                                01330001
022280*---------------------------------------------------------------* 01340006
022290*    COPYBOOK FOR THE CALL TO RACF SECURITY SUBROUTINE          * 01350006
022300*---------------------------------------------------------------* 01360006
022400                                                                  01370006
022500     COPY DPWS008.                                                01380006
022501                                                                  01390006
036600                                                                  01400048
036700*----------------------------------------------------------------*01410048
036800*  WORK AREA PASSED IN CALL TO DPKUT500                          *01420048
036900*----------------------------------------------------------------*01430048
037000     COPY DPWS500.                                                01440048
037100                                                                  01450048
022502 EJECT                                                            01460001
022503******************************************************************01470001
022504** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01480001
022505** SUB-ROUTINE (DPKUT100).                                      **01490001
022506******************************************************************01500001
022507     COPY DPWS010I.                                               01510001
022508 EJECT                                                            01520001
022509******************************************************************01530001
022510** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS            **01540001
022511** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **01550001
022512******************************************************************01560001
022513     COPY DPWS030.                                                01570066
CICS       COPY DPWS930.                                                01571066
022514 EJECT                                                            01580001
022515***************************************************************** 01590001
022516*    STANDARD COMMAREA.                                           01600001
022517***************************************************************** 01610001
022518                                                                  01620001
022519     COPY DPWS020.                                                01630001
022520     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01640001
022521                                                                  01650001
022522***************************************************************** 01660001
022523*    INTER-APPLICATION COMMAREA.                                  01670001
022524***************************************************************** 01680001
022525                                                                  01690001
022526         10  INTER-APPL-COMM-AREA PIC X(200).                     01700001
022527     COPY VLWS005.                                                01710001
022528***************************************************************** 01720001
022529*    SPECIFIC COMMMAREA FOR VLKCS585.                             01730001
022530***************************************************************** 01740001
022531         10  ASC-SPECIFIC-COMMAREA.                               01750001
022532             15  ASC-DEPT-NBR.                                    01760001
022533                 20 ASC-DEPT-NBR-N           PIC  9(03).          01770001
022534             15  ASC-VENDOR-NAME             PIC  X(30).          01780001
022535             15  ASC-PO-NUMBER.                                   01790001
022536                 20 ASC-PO-NUMBER-N          PIC  9(09).          01800001
022537             15  ASC-PO-REQ-NBR              PIC S9(09) COMP.     01810001
022538             15  ASC-ENT-ID                  PIC S9(09) COMP.     01820001
022539             15  ASC-PO-STATUS               PIC  X(1).           01830017
022540                 88 ASC-PO-CANCELLED         VALUE 'C'.           01840018
022541                 88 ASC-PO-CAN-DTE           VALUE 'D'.           01850023
022542                 88 ASC-PTIC-PO              VALUE 'P'.           01860018
022543                 88 ASC-PTIC-PO-VND-PRT      VALUE 'J'.           01870008
022544                 88 ASC-PTIC-PO-VND-NOT      VALUE 'V'.           01880008
022545                 88 ASC-PO-NOT-PRETIC        VALUE 'O'.           01890008
022546                 88 ASC-NO-PO                VALUE 'N'.           01900001
022547             15  ASC-PO-REQ-STATUS           PIC  X(1).           01910017
022548                 88 ASC-NO-PO-REQ            VALUE 'N'.           01920017
022549                 88 ASC-ACTIVE-REQ           VALUE 'A'.           01930017
022550                 88 ASC-COMPLETE-REQ         VALUE 'C'.           01940017
022551                 88 ASC-BOTH-REQ             VALUE 'B'.           01950017
022552             15  ASC-DUPLICATE-SW            PIC  X(1).           01960004
022553                 88 ASC-NOT-A-DUPLICATE      VALUE 'N'.           01970004
022554                 88 ASC-DUPLICATE            VALUE 'Y'.           01980004
022555             15  ASC-CURRENT-DATE            PIC  X(10).          01990023
022555             15  ASC-DATE-LIMIT              PIC  X(10).          02000046
022555             15  ASC-DEFAULT-DATE-LIMIT      PIC  X(10).          02010046
022556     EJECT                                                        02020001
022557*----------------------------------------------------------------*02030001
022558*    ABEND PROCESSING COPYBOOK.                                  *02040001
022559*----------------------------------------------------------------*02050001
022560                                                                  02060001
022561     COPY DPWS013.                                                02070001
022562                                                                  02080001
022563*---------------------------------------------------------------* 02090001
022564*    DB2 AREA FOR COMMUNICATIONS                                * 02100001
022565*---------------------------------------------------------------* 02110001
022566     EXEC SQL                                                     02120001
022567          INCLUDE SQLCA                                           02130001
022568     END-EXEC.                                                    02140001
022569                                                                  02150001
022570*---------------------------------------------------------------* 02160001
022571*    DB2 AREA FOR THE EXTERNAL ENTERPRISE TABLE                 * 02170001
022572*---------------------------------------------------------------* 02180001
022573     EXEC SQL                                                     02190001
022574          INCLUDE TEXTENT                                         02200001
022575     END-EXEC.                                                    02210001
022576                                                                  02220001
022600*---------------------------------------------------------------* 02230001
022700*    DB2 AREA FOR THE ENTERPRISE NAME TABLES                    * 02240001
022800*---------------------------------------------------------------* 02250001
022900     EXEC SQL                                                     02260001
023000          INCLUDE TENTNME                                         02270001
023100     END-EXEC.                                                    02280001
023200                                                                  02290001
023300*---------------------------------------------------------------* 02300001
023400*    DB2 AREA FOR THE WORKER TABLE                              * 02310001
023500*---------------------------------------------------------------* 02320001
023600     EXEC SQL                                                     02330001
023700          INCLUDE TWORKER                                         02340001
023800     END-EXEC.                                                    02350001
023900                                                                  02360001
024000*---------------------------------------------------------------* 02370001
024100*    DB2 AREA FOR THE RESPONSIBILITY AREA TABLE                 * 02380001
024200*---------------------------------------------------------------* 02390001
024300     EXEC SQL                                                     02400001
024400          INCLUDE TRSPBAR                                         02410001
024500     END-EXEC.                                                    02420001
024600                                                                  02430001
024700*---------------------------------------------------------------* 02440001
024800*    DB2 AREA FOR THE MERCHANDISE AREA TABLE                    * 02450001
024900*---------------------------------------------------------------* 02460001
025000     EXEC SQL                                                     02470001
025100          INCLUDE TMDSEAR                                         02480001
025200     END-EXEC.                                                    02490001
025300                                                                  02500001
025400*---------------------------------------------------------------* 02510001
025500*    DB2 AREA FOR THE PURCHASE ORDER AGREEMENT TABLE            * 02520001
025600*---------------------------------------------------------------* 02530001
025700     EXEC SQL                                                     02540001
025800          INCLUDE TPOAGMT                                         02550001
025900     END-EXEC.                                                    02560001
026000                                                                  02570001
026001*---------------------------------------------------------------* 02580008
026002*    DB2 AREA FOR THE VENDOR AGREEMENT TABLE                    * 02590008
026003*---------------------------------------------------------------* 02600008
026004     EXEC SQL                                                     02610008
026005          INCLUDE TVNDAGR                                         02620008
026006     END-EXEC.                                                    02630008
026007                                                                  02640008
026100*---------------------------------------------------------------* 02650001
026200*    DB2 AREA FOR THE PURCHASE ORDER TABLE                      * 02660001
026300*---------------------------------------------------------------* 02670001
026400     EXEC SQL                                                     02680001
026500          INCLUDE TPURCHS                                         02690001
026600     END-EXEC.                                                    02700001
026700                                                                  02710001
026800*---------------------------------------------------------------* 02720001
026900*    DB2 AREA FOR THE PLNSHP TABLE                              * 02730024
027000*---------------------------------------------------------------* 02740001
027100     EXEC SQL                                                     02750001
027200          INCLUDE TPLNSHP                                         02760024
027300     END-EXEC.                                                    02770001
027301                                                                  02780024
027302*---------------------------------------------------------------* 02790024
027303*    DB2 AREA FOR THE PRETICKET REQUEST HEADER TABLE            * 02800024
027304*---------------------------------------------------------------* 02810024
027305     EXEC SQL                                                     02820024
027306          INCLUDE TPTKREQ                                         02830024
027307     END-EXEC.                                                    02840024
027308                                                                  02850001
027309                                                                  02860001
027310                                                                  02870001
027311 EJECT                                                            02880001
027312 LINKAGE SECTION.                                                 02890001
027313                                                                  02900001
027314 01  DFHCOMMAREA.                                                 02910001
027315     05  FILLER                         OCCURS  1 TO 4072 TIMES   02920001
027316                                        DEPENDING ON EIBCALEN.    02930001
027317         10  FILLER                     PIC X.                    02940001
027318                                                                  02950001
027319                                                                  02960001
027320 PROCEDURE DIVISION.                                              02970001
027321***************************************************************** 02980001
027322** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 02990001
027323** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 03000001
027324** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 03010001
027325**                                                             ** 03020001
027326** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 03030001
027327** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 03040001
027328***************************************************************** 03050001
027329 0000-MAIN-MODULE.                                                03060001
027330     INITIALIZE DP030-CICS-API-FIELDS.                            03070001
027331     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03080001
027332     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03090001
027333     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03100001
027334     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03110001
027335     MOVE LENGTH OF VL585AI        TO DP030-MAP-LENGTH (1).       03120001
027336     MOVE PC-CURRENT-PROGRAM-NAME  TO DP013-PROGRAM.              03130015
027337     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03140015
027338     PERFORM 0001-CALL-CICS-ARCH-API.                             03150001
027339*                                                                 03160001
027340     PERFORM 1000-CONTROL-PROCESSING                              03170001
027341*                                                                 03180001
027342     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03190001
027343     PERFORM 0001-CALL-CICS-ARCH-API.                             03200001
027344                                                                  03210001
027345 0001-CALL-CICS-ARCH-API.                                         03220001
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03230066
027347                                    DFHCOMMAREA                   03240066
027348                                    DP030-CICS-API-FIELDS         03250066
027349                                    DP020-STANDARD-COMMAREA       03260066
027350                                    VL585AI.                      03270066
027351*                                                                 03280001
027352     IF  DP030-RC-CALL-SUCCESSFUL                                 03290001
027353         CONTINUE                                                 03300001
027354     ELSE                                                         03310001
027355         SET DP013-NO-ROLLBACK                                    03320001
027356             DP013-XCTL-DISPLAY-RESTART                           03330001
027357             DP013-CICS-ABEND      TO TRUE                        03340001
027358         MOVE 'BEFORE 0000-MAIN-MODULE'                           03350001
027359                                   TO DP013-PARAGRAPH             03360001
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03361066
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03362066
027362         MOVE DP030-RETURN-CODE                                   03390001
027363                                   TO DP013-MESSAGE-TEXT (3)      03400001
027364         PERFORM DP013-0000-PROCESS-ABEND                         03410001
027365     END-IF.                                                      03420001
027366 EJECT                                                            03430001
027367*----------------------------------------------------------------*03440001
027368*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03450001
027369*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *03460001
027370*----------------------------------------------------------------*03470001
027371                                                                  03480001
027372 1000-CONTROL-PROCESSING.                                         03490001
027373                                                                  03500001
027374     EVALUATE TRUE                                                03510001
027375         WHEN DP020-NEXT-ACT-INITIAL                              03520001
027376             INITIALIZE ASC-SPECIFIC-COMMAREA                     03530001
027377             MOVE SPACES TO ASC-PO-NUMBER                         03540001
027378                            ASC-DEPT-NBR                          03550001
027379             PERFORM 4000-BUILD-INITIAL-PANEL                     03560001
027380                                                                  03570001
027381         WHEN DP020-NEXT-ACT-READ-MAP                             03580001
027382             PERFORM 2000-FKEY-PROCESSING                         03590001
027383                                                                  03600001
027384         WHEN DP020-NEXT-ACT-RETURN                               03610001
027385             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03620001
027386             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03630001
027387                                                                  03640001
027388         WHEN OTHER                                               03650001
027389             SET DP013-LOGIC-ABEND                                03660001
027390                 DP013-NO-ROLLBACK TO TRUE                        03670001
027391             MOVE '1000-CONTROL-PROCESSING'                       03680001
027392                                   TO  DP013-PARAGRAPH            03690001
027393             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   03700001
027394                                   TO  DP013-MESSAGE-TEXT(1)      03710001
027395             MOVE DP020-NEXT-APPL-ACTIVITY                        03720001
027396                                   TO DP013-MESSAGE-TEXT(2)       03730001
027397             PERFORM DP013-0000-PROCESS-ABEND                     03740001
027398     END-EVALUATE.                                                03750001
027399                                                                  03760001
027400*----------------------------------------------------------------*03770001
027401* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*03780001
027402* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*03790001
027403* EDITS.                                                         *03800001
027404*----------------------------------------------------------------*03810001
027405                                                                  03820001
027406 2000-FKEY-PROCESSING.                                            03830001
027407                                                                  03840001
027408     EVALUATE TRUE                                                03850001
027409                                                                  03860001
027410         WHEN DP020-SRC-AID = DP016-CLEAR                         03870001
027411             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03880001
027412             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03890001
027413                                                                  03900001
027414         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     03910001
027415             INITIALIZE ASC-SPECIFIC-COMMAREA                     03920001
027416             MOVE SPACES TO ASC-PO-NUMBER                         03930028
027417                            ASC-DEPT-NBR                          03940028
027418             PERFORM 4000-BUILD-INITIAL-PANEL                     03950001
027419             PERFORM 3200-RESET-ATTRIBUTES                        03960001
027420                                                                  03970001
027421         WHEN OTHER                                               03980001
027422             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 03990001
027423             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04000001
027424             IF  PS-NO-ERROR                                      04010001
027425                 SET DP030-CONTINUE-GO TO TRUE                    04020001
027426                 PERFORM 2100-CHECK-FUNCTION-KEY                  04030001
027427             ELSE                                                 04040001
027428                 SET DP030-OVERRIDE-GO TO TRUE                    04050001
027429             END-IF                                               04060001
027430     END-EVALUATE.                                                04070001
027431******************************************************************04080001
027432** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **04090001
027433** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **04100001
027434** FROM THE CICS ARCHITECTURE API.                              **04110001
027435******************************************************************04120001
027436 2100-CHECK-FUNCTION-KEY.                                         04130001
027437                                                                  04140001
027438     EVALUATE TRUE                                                04150001
027439                                                                  04160001
027440*        WHEN THE ADD KEY IS PRESSED                              04170001
027441         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              04180001
027450             EVALUATE TRUE                                        04190001
027451*                WHEN THE PO DOES NOT EXISTS, CANT ADD REQUEST    04200044
027452                 WHEN ASC-NO-PO                                   04210044
027453                     SET PS-ERROR                                 04220018
027454                         DP030-OVERRIDE-GO                        04230018
027455                         DP020-MSG-FATAL   TO TRUE                04240018
027456                     MOVE PC-TSYMSG-00083  TO DP020-MSG-NUMBER    04250044
027457                     MOVE DP015-UNP-ALP-BRT-OFF                   04260018
027458                                           TO APONMBRA            04270018
027459                     MOVE DP015-RED        TO APONMBRC            04280018
027460                     MOVE DP015-REVERSE    TO APONMBRH            04290018
027470                     MOVE -1               TO APONMBRL            04300018
027480                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          04310018
027490                                                                  04320023
027451*                WHEN THE PO HAS BEEN CANCELLED, CANT ADD REQUEST 04330044
027452                 WHEN ASC-PO-CANCELLED                            04340044
027453                     SET PS-ERROR                                 04350044
027454                         DP030-OVERRIDE-GO                        04360044
027455                         DP020-MSG-FATAL   TO TRUE                04370044
027456                     MOVE PC-TSYMSG-01418  TO DP020-MSG-NUMBER    04380044
027457                     MOVE DP015-UNP-ALP-BRT-OFF                   04390044
027458                                           TO APONMBRA            04400044
027459                     MOVE DP015-RED        TO APONMBRC            04410044
027460                     MOVE DP015-REVERSE    TO APONMBRH            04420044
027470                     MOVE -1               TO APONMBRL            04430044
027480                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          04440044
027490                                                                  04450044
027491*                WHEN THE PAST THE PO CANCEL DATE, CAN ADD RQST   04460023
027492                 WHEN ASC-PO-CAN-DTE                              04470023
027493                     SET PS-ERROR                                 04480023
027494                         DP030-OVERRIDE-GO                        04490023
027495                         DP020-MSG-FATAL   TO TRUE                04500023
027496                     MOVE PC-TSYMSG-01420  TO DP020-MSG-NUMBER    04510023
027497                     MOVE DP015-UNP-ALP-BRT-OFF                   04520023
027498                                           TO APONMBRA            04530023
027499                     MOVE DP015-RED        TO APONMBRC            04540023
027500                     MOVE DP015-REVERSE    TO APONMBRH            04550023
027501                     MOVE -1               TO APONMBRL            04560023
027502                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          04570023
027503                                                                  04580018
027504*                WHEN THE PO EXISTS, BUT IS NOT A PRETICKET ORDER 04590001
027505*                CAN'T ADD REQUEST                                04600001
027506                 WHEN ASC-PO-NOT-PRETIC                           04610008
027507                     SET PS-ERROR                                 04620001
027508                         DP030-OVERRIDE-GO                        04630001
027509                         DP020-MSG-FATAL   TO TRUE                04640001
027510                     MOVE PC-TSYMSG-01352  TO DP020-MSG-NUMBER    04650001
027511                     MOVE DP015-UNP-ALP-BRT-OFF                   04660001
027512                                           TO APONMBRA            04670001
027513                     MOVE DP015-RED        TO APONMBRC            04680001
027514                     MOVE DP015-REVERSE    TO APONMBRH            04690001
027520                     MOVE -1               TO APONMBRL            04700001
027530                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          04710001
027540                                                                  04720001
027541                                                                  04730008
027542*                WHEN THE PO EXISTS - IT IS A PRETICKET ORDER,    04740008
027543*                BUT THE VENDOR DOESN'T DO PRETICKETING           04750008
027544                 WHEN ASC-PTIC-PO-VND-NOT                         04760008
027545                     SET PS-ERROR                                 04770008
027546                         DP030-OVERRIDE-GO                        04780008
027547                         DP020-MSG-FATAL   TO TRUE                04790008
027548                     MOVE PC-TSYMSG-01321  TO DP020-MSG-NUMBER    04800008
027549                     MOVE DP015-UNP-ALP-BRT-OFF                   04810008
027550                                           TO APONMBRA            04820008
027551                     MOVE DP015-RED        TO APONMBRC            04830008
027552                     MOVE DP015-REVERSE    TO APONMBRH            04840008
027553                     MOVE -1               TO APONMBRL            04850008
027554                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          04860008
027555                                                                  04870008
027556*                WHEN THE PO EXISTS - IT IS A PRETICKET ORDER,    04880008
027557*                BUT THE VENDOR MAKES THE TICKETS                 04890008
027558                 WHEN ASC-PTIC-PO-VND-PRT                         04900008
027559                     SET PS-ERROR                                 04910008
027560                         DP030-OVERRIDE-GO                        04920008
027561                         DP020-MSG-FATAL   TO TRUE                04930008
027562                     MOVE PC-TSYMSG-01322  TO DP020-MSG-NUMBER    04940008
027563                     MOVE DP015-UNP-ALP-BRT-OFF                   04950008
027564                                           TO APONMBRA            04960008
027565                     MOVE DP015-RED        TO APONMBRC            04970008
027566                     MOVE DP015-REVERSE    TO APONMBRH            04980008
027567                     MOVE -1               TO APONMBRL            04990008
027568                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          05000008
027569                                                                  05010008
027570*   IF IT HAS GOTTEN THIS FAR, IT IS A PRETICKET PO               05020017
027571*                                                                 05030017
027572*                WHEN THE PO ALREADY EXISTS ON AN ACTIVE REQUEST  05040001
027573*                MUST USE "UPDATE'                                05050061
027574                 WHEN ASC-ACTIVE-REQ                              05060001
027575                 WHEN ASC-BOTH-REQ                                05070003
027576                     SET PS-ERROR                                 05080001
027577                         DP030-OVERRIDE-GO                        05090001
027578                         DP020-MSG-FATAL   TO TRUE                05100001
027579                     MOVE PC-TSYMSG-01350  TO DP020-MSG-NUMBER    05110001
027580                     MOVE DP015-UNP-ALP-BRT-OFF                   05120001
027581                                           TO APONMBRA            05130001
027582                     MOVE DP015-RED        TO APONMBRC            05140001
027583                     MOVE DP015-REVERSE    TO APONMBRH            05150001
027584                     MOVE -1               TO APONMBRL            05160001
027590                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          05170001
027600                                                                  05180001
027700*                WHEN THE PO ALREADY EXISTS ON AN COMPLETE REQUEST05190001
027701*                A NEW REQUEST CAN BE "RESUBMIT"ED                05200001
027702                 WHEN ASC-COMPLETE-REQ                            05210001
027703                     PERFORM 2110-PREPARE-INTER-APPL-COMM         05220001
027704                     SET VL005-RESUBMIT-REQ   TO TRUE             05230001
027705                                                                  05240001
027706*                WHEN THE PO DOESNT EXIST ON ANY REQUEST          05250001
027707*                A NEW REQUEST CAN BE ADDED                       05260001
027708                 WHEN ASC-PTIC-PO                                 05270008
027709                     PERFORM 2110-PREPARE-INTER-APPL-COMM         05280001
027710                     SET VL005-ADD-NEW-REQ     TO TRUE            05290001
027720             END-EVALUATE                                         05300001
027730                                                                  05310001
027731*        WHEN THE UPDATE KEY IS PRESSED                           05320001
027732         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              05330001
027733             EVALUATE TRUE                                        05340001
027734*                CANT UPDATE REQUEST WHEN THE PO REQUEST DOESN'T  05350001
027735*                EXISTS (OR IF REQUEST HAS BEEN COMPLETED)        05360001
027738                 WHEN ASC-NO-PO-REQ                               05370037
027739                 WHEN ASC-COMPLETE-REQ                            05380037
027740                     SET PS-ERROR                                 05390001
027750                         DP030-OVERRIDE-GO                        05400001
027760                         DP020-MSG-FATAL   TO TRUE                05410001
027770                     MOVE PC-TSYMSG-01349  TO DP020-MSG-NUMBER    05420001
027780                     MOVE DP015-UNP-ALP-BRT-OFF                   05430001
027790                                           TO APONMBRA            05440001
027800                     MOVE DP015-RED        TO APONMBRC            05450001
027900                     MOVE DP015-REVERSE    TO APONMBRH            05460001
028000                     MOVE -1               TO APONMBRL            05470001
028100                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          05480001
028200                                                                  05490001
028300*                WHEN THE PO ALREADY EXISTS ON AN ACTIVE REQUEST  05500001
028301*                GO AHEAD AND "UPDATE"                            05510001
028302                 WHEN ASC-ACTIVE-REQ                              05520001
028303                     PERFORM 2110-PREPARE-INTER-APPL-COMM         05530005
028304                     SET VL005-UPDATE-REG      TO TRUE            05540005
028305                 WHEN ASC-BOTH-REQ                                05550004
028306                     PERFORM 2110-PREPARE-INTER-APPL-COMM         05560001
028307                     SET VL005-UPDATE-RESUB    TO TRUE            05570003
028308             END-EVALUATE                                         05580001
028309                                                                  05590001
028310                                                                  05600001
028311*        WHEN THE DETAIL KEY IS PRESSED                           05610001
028312         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              05620001
028341             EVALUATE TRUE                                        05630021
128342                 WHEN ASC-NO-PO-REQ                               05640037
128343                     SET PS-ERROR                                 05650037
128344                         DP030-OVERRIDE-GO                        05660037
128345                         DP020-MSG-FATAL   TO TRUE                05670037
128346                     MOVE PC-TSYMSG-01349  TO DP020-MSG-NUMBER    05680037
128347                     MOVE DP015-UNP-ALP-BRT-OFF                   05690037
128348                                           TO APONMBRA            05700037
128349                     MOVE DP015-RED        TO APONMBRC            05710037
128350                     MOVE DP015-REVERSE    TO APONMBRH            05720037
128351                     MOVE -1               TO APONMBRL            05730037
128352                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          05740037
128353                                                                  05750037
128354*                WHEN THE PO ALREADY EXISTS ON A REQUEST          05760001
128355                 WHEN ASC-ACTIVE-REQ                              05770001
128356                 WHEN ASC-COMPLETE-REQ                            05780001
128357                 WHEN ASC-BOTH-REQ                                05790004
128358                     IF ASC-DUPLICATE                             05800004
128359                         SET DP030-OVERRIDE-GO                    05810004
128360                             DP020-MSG-FATAL  TO TRUE             05820004
128361                         MOVE PC-TSYMSG-01388 TO DP020-MSG-NUMBER 05830011
128362                         SET DP030-SET-CURSOR-APPL-1 TO TRUE      05840004
128363                     ELSE                                         05850004
128364                         PERFORM 2110-PREPARE-INTER-APPL-COMM     05860004
128365                     END-IF                                       05870004
128366             END-EVALUATE                                         05880001
128367                                                                  05890001
128368                                                                  05900001
128354*        WHEN THE LIST KEY IS PRESSED                             05910052
028312         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              05920062
128369         WHEN DP020-FK-DISPN-GO (DP020-SRC-AID)                   05930062
128370             PERFORM 2110-PREPARE-INTER-APPL-COMM                 05940062
128371                                                                  05950001
128372         WHEN DP020-SRC-AID = DP016-ENTER                         05960001
128373             CONTINUE                                             05970001
128374                                                                  05980001
128375         WHEN OTHER                                               05990001
128376             SET DP013-NO-ROLLBACK                                06000001
128377                 DP013-XCTL-DISPLAY-RESTART                       06010001
128378                 DP013-CICS-ABEND  TO TRUE                        06020001
128379             MOVE '2100-CHECK-FUNCTION-KEY'                       06030001
128380                                   TO DP013-PARAGRAPH             06040001
128381             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06050001
128382                                   TO DP013-MESSAGE-TEXT (1)      06060001
128383             MOVE 'OR CODE MISSING FROM THIS PROGRAM TO PROCESS:' 06070001
128384                                   TO DP013-MESSAGE-TEXT (2)      06080001
128385             MOVE DP020-SRC-AID    TO PM-A-SRC-AID                06090001
128386             MOVE DP020-FK-ACTION (DP020-SRC-AID)                 06100001
128387                                   TO PM-A-FK-ACTION              06110001
128388             MOVE DP020-FK-DISPN-IND (DP020-SRC-AID)              06120001
128389                                   TO PM-A-FK-DISPN               06130001
128390             MOVE PM-ABEND-INFO-A  TO DP013-MESSAGE-TEXT (3)      06140001
128391             MOVE 'REVIEW PFKEYS SETUP FOR THIS MNEMONIC.'        06150001
128392                                   TO DP013-MESSAGE-TEXT (4)      06160001
128393             PERFORM DP013-0000-PROCESS-ABEND                     06170001
128394     END-EVALUATE.                                                06180001
128395******************************************************************06190001
128396** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **06200001
128397** INTER-APPLICATION COMMAREA.                                  **06210001
128398******************************************************************06220001
128399 2110-PREPARE-INTER-APPL-COMM.                                    06230001
128400     INITIALIZE VL005-INTER-APPL-COMMAREA.                        06240001
128401     MOVE ASC-PO-NUMBER-N          TO VL005-PO-NUMBER.            06250001
128402     MOVE ASC-PO-REQ-NBR           TO VL005-PO-REQ-NBR.           06260001
128403     MOVE ASC-VENDOR-NAME          TO VL005-VENDOR-NAME.          06270001
128404     MOVE ASC-ENT-ID               TO VL005-ENT-ID.               06280001
128405     MOVE ASC-DEPT-NBR             TO VL005-DEPT-NBR.             06290001
           MOVE ASC-DATE-LIMIT           TO VL005-SHIP-BY-DATE.         06300053
128406 EJECT                                                            06310001
128407*----------------------------------------------------------------*06320001
128408* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*06330001
128409* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *06340001
128410* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *06350001
128411*----------------------------------------------------------------*06360001
128412                                                                  06370001
128413 2200-MOVE-SCREEN-TO-COMMAREA.                                    06380001
128414     IF  ADTELMTL > ZERO                                          06390047
128415         MOVE ADTELMTI             TO PV-DATE-USA                 06400053
128415         MOVE CORR PV-DATE-USA     TO PV-DATE-ISO                 06410053
128415         MOVE PV-DATE-ISO          TO ASC-DATE-LIMIT              06420053
128416     ELSE                                                         06430001
128417         IF  ADTELMTF = DP015-ERASE-EOF                           06440047
128415             MOVE SPACES           TO ASC-DATE-LIMIT              06450055
128419         END-IF                                                   06460001
128420     END-IF.                                                      06470001
                                                                        06480055
           IF ASC-DATE-LIMIT  = SPACES                                  06490055
128418         MOVE ASC-DEFAULT-DATE-LIMIT                              06500055
128415                                   TO ASC-DATE-LIMIT              06510055
                                            PV-DATE-ISO                 06520058
               MOVE CORR PV-DATE-ISO     TO PV-DATE-USA                 06530058
128415         MOVE PV-DATE-USA          TO ADTELMTO                    06540058
           END-IF.                                                      06550055
128421                                                                  06560001
128414     IF  ADEPTL   > ZERO                                          06570047
128415         MOVE ADEPTI               TO ASC-DEPT-NBR                06580047
128416     ELSE                                                         06590047
128417         IF  ADEPTF   = DP015-ERASE-EOF                           06600047
128418             MOVE SPACE            TO ASC-DEPT-NBR                06610047
128419         END-IF                                                   06620047
128420     END-IF.                                                      06630047
128421                                                                  06640047
128422     IF  AVNDNMEL > ZERO                                          06650001
128423         MOVE AVNDNMEI             TO ASC-VENDOR-NAME             06660001
128424     ELSE                                                         06670001
128425         IF  AVNDNMEF = DP015-ERASE-EOF                           06680001
128426             MOVE SPACE            TO ASC-VENDOR-NAME             06690001
128427         END-IF                                                   06700001
128428     END-IF.                                                      06710001
128429                                                                  06720001
128430     IF  APONMBRL > ZERO                                          06730001
128431         MOVE APONMBRI             TO ASC-PO-NUMBER               06740001
128432     ELSE                                                         06750001
128433         IF  APONMBRF = DP015-ERASE-EOF                           06760001
128434             MOVE SPACE            TO ASC-PO-NUMBER               06770001
128435         END-IF                                                   06780001
128436     END-IF.                                                      06790001
128437                                                                  06800001
128438*----------------------------------------------------------------*06810001
128439* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *06820001
128440* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *06830001
128441* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*06840001
128442* IN THE DESTINATION PROGRAM, NOT HERE.                          *06850001
128443*----------------------------------------------------------------*06860001
128444                                                                  06870001
128445 3000-EDIT-DATA-IN-COMMAREA.                                      06880008
128446     PERFORM 3200-RESET-ATTRIBUTES.                               06890001
128447                                                                  06900032
128448     IF  ASC-DATE-LIMIT = SPACES                                  06910047
128451         SET PS-ERROR                                             06920046
128452             DP020-MSG-FATAL         TO TRUE                      06930046
128453         MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER          06940047
128454         MOVE DP015-UNP-ALP-BRT-OFF                               06950046
128455                                     TO ADTELMTA                  06960046
128456         MOVE DP015-RED              TO ADTELMTC                  06970046
128457         MOVE DP015-REVERSE          TO ADTELMTH                  06980046
128458         MOVE -1                     TO ADTELMTL                  06990046
128459         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      07000046
128461     ELSE                                                         07010046
               IF ASC-DATE-LIMIT = ASC-DEFAULT-DATE-LIMIT               07020047
                   CONTINUE                                             07030056
               ELSE                                                     07040056
128449             PERFORM 3500-VALIDATE-DATE-LIMIT                     07050047
               END-IF                                                   07060047
128461     END-IF.                                                      07070046
128462*                                                                 07080001
128448     IF  ASC-VENDOR-NAME > SPACES                                 07090046
128449         PERFORM 3100-VALIDATE-VENDOR-NAME                        07100046
128450         IF SQLCODE = +100                                        07110046
128451             SET PS-ERROR                                         07120046
128452                 DP020-MSG-FATAL   TO TRUE                        07130046
128453             MOVE PC-TSYMSG-00398  TO DP020-MSG-NUMBER            07140046
128454             MOVE DP015-UNP-ALP-BRT-OFF                           07150046
128455                                   TO AVNDNMEA                    07160046
128456             MOVE DP015-RED        TO AVNDNMEC                    07170046
128457             MOVE DP015-REVERSE    TO AVNDNMEH                    07180046
128458             MOVE -1               TO AVNDNMEL                    07190046
128459             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07200046
128460         END-IF                                                   07210046
128461     END-IF.                                                      07220046
128462*                                                                 07230046
128463     IF  ASC-DEPT-NBR > SPACES                                    07240001
128464         MOVE ASC-DEPT-NBR         TO DP010I-UNEDITED-FIELD       07250001
128465         MOVE LENGTH OF ASC-DEPT-NBR                              07260001
128466                                   TO DP010I-MAXIMUM-DIGITS       07270001
128467         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     07280001
128468         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  07290001
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07301065
263627              USING DP010I-NUMERIC-EDIT-AREA                      07302065
128470         IF  DP010I-ERROR-DETECTED                                07310001
128471             SET PS-ERROR                                         07320001
128472                 DP020-MSG-FATAL   TO TRUE                        07330001
128473             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07340001
128474             MOVE DP015-UNP-ALP-BRT-OFF                           07350001
128475                                   TO ADEPTA                      07360001
128476             MOVE DP015-RED        TO ADEPTC                      07370001
128477             MOVE DP015-REVERSE    TO ADEPTH                      07380001
128478             MOVE -1               TO ADEPTL                      07390001
128479             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07400001
128480         ELSE                                                     07410001
128481             MOVE DP010I-NUMERIC-FIELD                            07420001
128482                                   TO ASC-DEPT-NBR-N              07430001
128483             PERFORM 3300-CHECK-DEPT-AUTHORIZATION                07440043
128484             IF PV-DB2-COUNT > +0                                 07450043
128485                 CONTINUE                                         07460001
128486             ELSE                                                 07470001
128487                 PERFORM 3400-RACF-ACCESS                         07480006
128488                 IF DP008-ACCESS-ALLOWED                          07490006
128489                     CONTINUE                                     07500006
128490                 ELSE                                             07510006
128491                     SET PS-ERROR                                 07520006
128492                         DP020-MSG-FATAL   TO TRUE                07530006
128493                     MOVE PC-TSYMSG-00014  TO DP020-MSG-NUMBER    07540006
128494                     MOVE DP015-UNP-ALP-BRT-OFF                   07550006
128495                                           TO ADEPTA              07560006
128496                     MOVE DP015-RED        TO ADEPTC              07570006
128497                     MOVE DP015-REVERSE    TO ADEPTH              07580006
128498                     MOVE -1               TO ADEPTL              07590006
128499                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          07600006
128500                 END-IF                                           07610006
128501             END-IF                                               07620001
128502             MOVE ASC-DEPT-NBR     TO ADEPTO                      07630001
128503         END-IF                                                   07640001
128504     END-IF.                                                      07650001
128505                                                                  07660001
128506     IF  ASC-PO-NUMBER > SPACE                                    07670032
128507         MOVE ASC-PO-NUMBER        TO DP010I-UNEDITED-FIELD       07680032
128508         MOVE LENGTH OF ASC-PO-NUMBER TO DP010I-MAXIMUM-DIGITS    07690032
128509         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     07700032
128510         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  07710032
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07721065
263627              USING DP010I-NUMERIC-EDIT-AREA                      07722065
128512         IF  DP010I-ERROR-DETECTED                                07730032
128513             SET PS-ERROR                                         07740032
128514                 DP020-MSG-FATAL   TO TRUE                        07750032
128515             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07760032
128516             MOVE DP015-UNP-ALP-BRT-OFF                           07770032
128517                                   TO APONMBRA                    07780032
128518             MOVE DP015-RED        TO APONMBRC                    07790032
128519             MOVE DP015-REVERSE    TO APONMBRH                    07800032
128520             MOVE -1               TO APONMBRL                    07810032
128521             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07820032
128522         ELSE                                                     07830032
128523             MOVE DP010I-NUMERIC-FIELD                            07840032
128524                                   TO ASC-PO-NUMBER-N             07850032
128525             MOVE ASC-PO-NUMBER    TO APONMBRO                    07860032
128526             SET ASC-NOT-A-DUPLICATE TO TRUE                      07870032
128527             MOVE SPACES          TO ASC-PO-REQ-STATUS            07880032
128528                                     ASC-PO-STATUS                07890032
128529             MOVE ASC-PO-NUMBER-N TO DK-PO-NUMBER                 07900032
128530             MOVE +0              TO ASC-PO-REQ-NBR               07910032
128540                                                                  07920032
128541             SET ASC-NO-PO        TO TRUE                         07930039
128544             SET ASC-NO-PO-REQ    TO TRUE                         07940059
128542             PERFORM 3120-VALIDATE-PO-NUMBER                      07950032
128543                                                                  07960039
128545             PERFORM 3110-VALIDATE-PO-REQ                         07970032
128546                                                                  07980039
                   IF ASC-NO-PO                                         07990059
128547                 MOVE SPACES          TO ASC-DEPT-NBR             08000059
190033                                         AVNDNMEO                 08010059
128547                                         ASC-DEPT-NBR             08020059
128548                 MOVE ASC-DEPT-NBR    TO ADEPTO                   08030060
190034             ELSE                                                 08040059
128547                 PERFORM 3130-GET-PO-VENDOR-NAME                  08050059
128548                 MOVE ASC-DEPT-NBR    TO ADEPTO                   08060059
190033                 MOVE ASC-VENDOR-NAME TO AVNDNMEO                 08070059
190034             END-IF                                               08080059
190034         END-IF                                                   08090059
190035     END-IF.                                                      08100032
190036*                                                                 08110032
190037     IF  ASC-VENDOR-NAME > SPACES                                 08120058
190038     OR  ASC-PO-NUMBER > SPACES                                   08130001
190039     OR  ASC-DEPT-NBR > SPACES                                    08140058
           OR  PS-ERROR                                                 08150058
190040         CONTINUE                                                 08160001
190041     ELSE                                                         08170001
190042         SET PS-ERROR                                             08180001
190043             DP020-MSG-FATAL   TO TRUE                            08190001
190044         MOVE PC-TSYMSG-00308  TO DP020-MSG-NUMBER                08200001
190045         MOVE -1               TO ADEPTL                          08210001
190046         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      08220001
190047     END-IF.                                                      08230001
190048*                                                                 08240001
190049* ONLY THE PO NUMBER MUSTBE ENTERED IF DETAIL OR UPDATE           08250001
190050     IF  (DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)                   08260001
190051     OR   DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)                   08270001
190052     OR   DP020-FK-LOCAL-FUNC-04(DP020-SRC-AID))                  08280001
190053         IF   ASC-PO-NUMBER   = SPACES                            08290001
190054             SET PS-ERROR                                         08300001
190055                 DP020-MSG-FATAL   TO TRUE                        08310001
190056             MOVE PC-TSYMSG-00461  TO DP020-MSG-NUMBER            08320001
190057             MOVE DP015-UNP-ALP-BRT-OFF                           08330001
190058                                   TO APONMBRA                    08340001
190059             MOVE DP015-RED        TO APONMBRC                    08350001
190060             MOVE DP015-REVERSE    TO APONMBRH                    08360001
190061             MOVE -1               TO APONMBRL                    08370001
190062             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08380001
190063         END-IF                                                   08390001
190064     END-IF.                                                      08400001
190065*                                                                 08410001
190066     IF  PS-NO-ERROR                                              08420001
190067         MOVE -1                   TO APONMBRL                    08430029
190068         SET DP030-SET-CURSOR-APPL-1                              08440001
190069                                   TO TRUE                        08450001
190070     END-IF.                                                      08460001
190071******************************************************************08470001
190072** VALIDATES THE EXISTENCE OF THE VENDOR - GET THE ENT-ID       **08480001
190073******************************************************************08490001
190074 3100-VALIDATE-VENDOR-NAME.                                       08500001
190075                                                                  08510001
190076     MOVE ASC-VENDOR-NAME TO DK-VENDOR-NAME.                      08520032
190077                                                                  08530032
190078     EXEC SQL                                                     08540032
190079          SELECT B.ENT_ID                                         08550032
190080          INTO  :ASC-ENT-ID                                       08560041
190081          FROM TENTNME A,                                         08570032
190082               TEXTENT B                                          08580032
190083          WHERE A.ENT_NAME_DESC = :DK-VENDOR-NAME                 08590032
190084            AND B.ENT_ID = A.ENT_ID                               08600032
190085     END-EXEC.                                                    08610032
190086                                                                  08620001
190087     EVALUATE TRUE                                                08630001
190088         WHEN SQLCODE = ZERO                                      08640001
190089         WHEN SQLCODE = +100                                      08650001
190090             CONTINUE                                             08660001
190091         WHEN SQLWARN0 NOT = SPACES                               08670001
190092         WHEN SQLCODE < ZERO                                      08680001
190093         WHEN SQLCODE > ZERO                                      08690001
190094             MOVE '3100-VALIDATE-VENDOR-NAME'                     08700001
190095                               TO DP013-PARAGRAPH                 08710001
190096             MOVE 'SELECT TENTNME'                                08720001
190097                               TO DP013-MESSAGE-TEXT (1)          08730001
190098             MOVE SQLCA        TO DP013-SQLCA                     08740001
190099             MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (1)        08750001
190100             SET DP013-DB2-ABEND                                  08760001
190101                 DP013-XCTL-DISPLAY-RESTART TO TRUE               08770001
190102             PERFORM DP013-0000-PROCESS-ABEND                     08780001
190103     END-EVALUATE.                                                08790001
190104******************************************************************08800001
190105** FIRST CHECK IF THE ENTERED PO HAS AN ACTIVE PO ON THE TABLE  **08810001
190106** STATUS OF "A"CITVE, "R"USH, OR "H"OLD                        **08820001
190107******************************************************************08830001
190108 3110-VALIDATE-PO-REQ.                                            08840001
190109                                                                  08850001
190110     EXEC SQL                                                     08860001
190111          SELECT                                                  08870001
190112                 A.PO_REQ_NBR                                     08880001
190113               , A.ENT_ID                                         08890001
190114               , A.DEPT_NBR                                       08900001
190115               , A.REQ_STAT_CDE                                   08910003
190116          INTO                                                    08920001
190117                :ASC-PO-REQ-NBR                                   08930001
190118              , :ASC-ENT-ID                                       08940001
190119              , :DK-DEPT-NBR                                      08950001
190120              , :PTKREQ-REQ-STAT-CDE                              08960040
190121          FROM TPTKREQ A                                          08970001
190122          WHERE A.PO_NBR = :DK-PO-NUMBER                          08980001
190123            AND A.REQ_STAT_CDE IN ('A','H','R')                   08990001
190124     END-EXEC.                                                    09000001
190125                                                                  09010001
190126     EVALUATE TRUE                                                09020001
190127         WHEN SQLCODE = ZERO                                      09030001
190128             MOVE DK-DEPT-NBR TO ASC-DEPT-NBR                     09040001
190129             SET  ASC-ACTIVE-REQ   TO TRUE                        09050001
190130                                                                  09060001
190131         WHEN SQLCODE = +100                                      09070001
190132             CONTINUE                                             09080003
190133         WHEN SQLWARN0 NOT = SPACES                               09090001
190134         WHEN SQLCODE < ZERO                                      09100001
190135         WHEN SQLCODE > ZERO                                      09110001
190136             MOVE '3110-VALIDATE-PO-REQ'                          09120008
190137                               TO DP013-PARAGRAPH                 09130001
190138             MOVE 'SELECT ACTIVE PRETICKET REQUESTS'              09140008
190139                               TO DP013-MESSAGE-TEXT (1)          09150001
190140             MOVE DK-PO-NUMBER TO DP013-MESSAGE-TEXT (2)          09160008
190141             MOVE SQLCA        TO DP013-SQLCA                     09170001
190142             MOVE 'TPTKREQ '   TO DP013-DB2-TABLE-NAME (1)        09180001
190143             SET DP013-DB2-ABEND                                  09190001
190144                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09200001
190145             PERFORM DP013-0000-PROCESS-ABEND                     09210001
190146     END-EVALUATE.                                                09220001
190147                                                                  09230001
190148*  CHECKS TO SEE IF A REQUEST HAS ALREADY BEEN PROCESSED FOR THIS*09240003
190149*  PO - IF SO, THE ADD WILL HAVE TO BE A RESUBMIT.                09250003
190150                                                                  09260001
190151     EXEC SQL                                                     09270001
190152          SELECT                                                  09280001
190153                 A.PO_REQ_NBR                                     09290004
190154               , A.ENT_ID                                         09300004
190155               , A.DEPT_NBR                                       09310001
190156          INTO                                                    09320001
190157                :PTKREQ-PO-REQ-NBR                                09330004
190158              , :ASC-ENT-ID                                       09340004
190159              , :DK-DEPT-NBR                                      09350001
190160          FROM TPTKREQ A                                          09360001
190161          WHERE A.PO_NBR = :DK-PO-NUMBER                          09370001
190162            AND A.REQ_STAT_CDE NOT IN ('A','H','R')               09380003
190163     END-EXEC.                                                    09390001
190164                                                                  09400001
190165     EVALUATE TRUE                                                09410001
190166         WHEN SQLCODE = ZERO                                      09420001
190167         WHEN SQLCODE = -811                                      09430001
190168             MOVE DK-DEPT-NBR TO ASC-DEPT-NBR                     09440001
190169             IF ASC-ACTIVE-REQ                                    09450003
190170                 SET ASC-BOTH-REQ                                 09460004
190171                     ASC-DUPLICATE    TO TRUE                     09470004
190172             ELSE                                                 09480003
190173*                IF THERE WAS NOT AN ACTIVE REQUEST, THAT MEANS   09490004
190174*                THERE IS ONLY A COMPLETED ONE...MOVE REQ NBR TO  09500004
190175*                THE ASC- FIELD FOR THE INQUIRE KEY.              09510004
190176                 IF DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)        09520007
190177                     MOVE PTKREQ-PO-REQ-NBR                       09530007
190178                          TO ASC-PO-REQ-NBR                       09540007
190179                 END-IF                                           09550007
190180                 SET ASC-COMPLETE-REQ TO TRUE                     09560003
190190                 IF SQLCODE = -811                                09570004
190200                     SET ASC-DUPLICATE TO TRUE                    09580004
190201                 END-IF                                           09590004
190202             END-IF                                               09600003
190203                                                                  09610001
190204** IF NO ACTIVITY WITH THIS PO ON THE PRETICKET REQUEST TABLE,    09620001
190205** CHECK TO MAKE SURE IT IS A VALID PRETICKET/PO NUMBER.          09630001
190206         WHEN SQLCODE = +100                                      09640001
190207             IF ASC-ACTIVE-REQ                                    09650003
190208                 CONTINUE                                         09660003
190209             ELSE                                                 09670003
190210                 SET ASC-NO-PO-REQ  TO TRUE                       09680017
190211             END-IF                                               09690003
190212                                                                  09700001
190213         WHEN SQLWARN0 NOT = SPACES                               09710001
190214         WHEN SQLCODE < ZERO                                      09720001
190215         WHEN SQLCODE > ZERO                                      09730001
190216             MOVE '3110-VALIDATE-PO-REQ'                          09740008
190217                               TO DP013-PARAGRAPH                 09750008
190218             MOVE 'SELECT OTHER PRETICKET REQUESTS'               09760008
190219                               TO DP013-MESSAGE-TEXT (1)          09770008
190220             MOVE DK-PO-NUMBER TO DP013-MESSAGE-TEXT (2)          09780008
190221             MOVE SQLCA        TO DP013-SQLCA                     09790008
190222             MOVE 'TPTKREQ '   TO DP013-DB2-TABLE-NAME (1)        09800008
190223             SET DP013-DB2-ABEND                                  09810008
190224                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09820008
190225             PERFORM DP013-0000-PROCESS-ABEND                     09830008
190226     END-EVALUATE.                                                09840001
190227                                                                  09850001
190228******************************************************************09860001
190229** VALIDATES THE ENTERED PO IS AN ACTIVE PRETICKET PO           **09870001
190230******************************************************************09880001
190231 3120-VALIDATE-PO-NUMBER.                                         09890001
190232                                                                  09900001
190233                                                                  09910001
190234     PERFORM                                                      09920001
190235         WITH TEST AFTER                                          09930001
190236         VARYING PV-RETRY-COUNTER                                 09940001
190237         FROM 1 BY 1                                              09950001
190238         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09960001
190239                   OR (SQLCODE = ZERO)                            09970001
190240                   OR (SQLCODE = +100))                           09980001
190241                                                                  09990001
190242         EXEC SQL                                                 10000034
190243              SELECT                                              10010034
190244                     A.ENT_ID                                     10020034
190245                  ,  A.DEPT_NBR                                   10030034
190246                  ,  A.STATUS_CDE                                 10040034
190247                  ,  B.CAN_IFNOT_SHIP_DTE                         10050034
190248              INTO                                                10060034
190249                    :ASC-ENT-ID                                   10070034
190250                  , :DK-DEPT-NBR                                  10080034
190260                  , :PURCHS-STATUS-CDE                            10090034
190261                  , :PLNSHP-CAN-IFNOT-SHIP-DTE                    10100034
190262              FROM TPURCHS A                                      10110034
190263                 , TPLNSHP B                                      10120034
190264              WHERE A.PO_NBR = :DK-PO-NUMBER                      10130034
190265                AND B.PO_NBR = A.PO_NBR                           10140034
190266                AND A.VER_STATUS_CDE = 'A'                        10150034
190267                AND B.VER_STATUS_CDE = 'A'                        10160034
190268         END-EXEC                                                 10170034
190269                                                                  10180001
190270         EVALUATE TRUE                                            10190034
190280             WHEN SQLCODE = ZERO                                  10200034
190290                 IF PURCHS-STATUS-CDE = 'CA'                      10210034
190300                     SET ASC-PO-CANCELLED TO TRUE                 10220034
190400                 ELSE                                             10230034
190500                     IF PLNSHP-CAN-IFNOT-SHIP-DTE                 10240034
190501                      < ASC-CURRENT-DATE                          10250034
190502                         SET ASC-PO-CAN-DTE TO TRUE               10260034
190503                     ELSE                                         10270034
190504* THE PO EXISTS, NOW CHECK IT IF IS A PRETICKETING PO             10280035
190505                         MOVE DK-DEPT-NBR TO ASC-DEPT-NBR         10290034
190506                         PERFORM 3121-VALIDATE-PO-PRETICKET       10300034
190507                     END-IF                                       10310034
190508                 END-IF                                           10320034
190509                                                                  10330034
190510             WHEN SQLCODE = +100                                  10340034
190512                 SET ASC-NO-PO     TO TRUE                        10350044
190523                                                                  10360034
190524             WHEN SQLWARN0 NOT = SPACES                           10370034
190525             WHEN SQLCODE < ZERO                                  10380034
190526             WHEN SQLCODE > ZERO                                  10390034
190527                 MOVE '3120-VALIDATE-PO-NUMBER'                   10400034
190528                                   TO DP013-PARAGRAPH             10410034
190529                 MOVE 'SELECT PURCHASE ORDER'                     10420034
190530                                   TO DP013-MESSAGE-TEXT (1)      10430034
190531                 MOVE SQLCA        TO DP013-SQLCA                 10440034
190532                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)    10450034
190533                 MOVE DK-PO-NUMBER TO DP013-DB2-TABLE-NAME (2)    10460034
190534                 SET DP013-DB2-ABEND                              10470034
190535                     DP013-XCTL-DISPLAY-RESTART TO TRUE           10480034
190536                 PERFORM DP013-0000-PROCESS-ABEND                 10490034
190537         END-EVALUATE                                             10500034
190538     END-PERFORM.                                                 10510001
190539*                                                                 10520001
190540     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10530001
190541         MOVE '3120-VALIDATE-PO-NUMBER'                           10540017
190542                                   TO DP013-PARAGRAPH             10550001
190543         MOVE 'MAXIMUM RETRIES EXCEEDED SELECTING VND LEAD TIME'  10560001
190544                                   TO DP013-MESSAGE-TEXT (1)      10570001
190545         MOVE SQLCA                TO DP013-SQLCA                 10580001
190546         MOVE 'TPURCHS '           TO DP013-DB2-TABLE-NAME (1)    10590001
190547         SET DP013-DB2-ABEND                                      10600001
190548             DP013-XCTL-DISPLAY-RESTART                           10610001
190549                                   TO TRUE                        10620001
190550         PERFORM DP013-0000-PROCESS-ABEND                         10630001
190551     END-IF.                                                      10640001
190552******************************************************************10650001
190553** VALIDATES THAT THE PO IS A PRETICKET PO                      **10660001
190554******************************************************************10670001
190555 3121-VALIDATE-PO-PRETICKET.                                      10680001
190556                                                                  10690001
190557     EXEC SQL                                                     10700001
190558          SELECT A.PO_NBR                                         10710001
190559          INTO                                                    10720001
190560                :POAGMT-PO-NBR                                    10730001
190561          FROM TPOAGMT A                                          10740001
190562          WHERE A.PO_NBR = :DK-PO-NUMBER                          10750001
190563            AND A.AGRMT_TYP_ID   = :PC-SERVICE-AGRMT-CDE          10760001
190564            AND A.TYP_CDE        = :PC-PRETICKET-TYP-CDE          10770001
190565            AND A.VER_STATUS_CDE = 'A'                            10780001
190566     END-EXEC.                                                    10790001
190567                                                                  10800001
190568     EVALUATE TRUE                                                10810001
190569         WHEN SQLCODE = ZERO                                      10820001
190570             MOVE DK-DEPT-NBR TO ASC-DEPT-NBR                     10830001
190571             PERFORM 3122-CHECK-VENDOR-FILE                       10840017
190572                                                                  10850001
190573* IF THE PO ISN'T A PRETICKET PO, A REQUEST CANNOT BE ADDED       10860001
190574         WHEN SQLCODE = +100                                      10870001
190575             SET ASC-PO-NOT-PRETIC   TO TRUE                      10880008
190576         WHEN SQLWARN0 NOT = SPACES                               10890001
190577         WHEN SQLCODE < ZERO                                      10900001
190578         WHEN SQLCODE > ZERO                                      10910001
190579             MOVE '3121-VALIDATE-PO-PRETICKET'                    10920008
190580                               TO DP013-PARAGRAPH                 10930001
190581             MOVE 'SELECT PO AGREEMENT'                           10940022
190582                               TO DP013-MESSAGE-TEXT (1)          10950001
190583             MOVE DK-PO-NUMBER TO DP013-MESSAGE-TEXT (2)          10960008
190584             MOVE SQLCA        TO DP013-SQLCA                     10970001
190585             MOVE 'TPOAGMT '   TO DP013-DB2-TABLE-NAME (1)        10980022
190586             SET DP013-DB2-ABEND                                  10990001
190587                 DP013-XCTL-DISPLAY-RESTART TO TRUE               11000001
190588             PERFORM DP013-0000-PROCESS-ABEND                     11010001
190589     END-EVALUATE.                                                11020001
190590                                                                  11030032
190591******************************************************************11040008
190592** VALIDATES THAT THE VENDOR IS A PRETICKETING VENDOR            *11050008
190593******************************************************************11060008
190594 3122-CHECK-VENDOR-FILE.                                          11070008
190595                                                                  11080008
190596     EXEC SQL                                                     11090008
190597          SELECT A.TKT_MKR_IND                                    11100008
190598          INTO                                                    11110008
190599                :VNDAGR-TKT-MKR-IND                               11120008
190600          FROM TVNDAGR A                                          11130008
190601          WHERE A.ENT_ID = :ASC-ENT-ID                            11140008
190602            AND A.DEPT_NBR       = :DK-DEPT-NBR                   11150008
190603            AND A.EFFECTIVE_DATE <= CURRENT DATE                  11160013
190604            AND A.EXPIRATION_DATE > CURRENT DATE                  11170013
190605            AND A.AGRMT_TYP_ID   = :PC-SERVICE-AGRMT-CDE          11180008
190606            AND A.TYP_CDE        = :PC-PRETICKET-TYP-CDE          11190008
190607     END-EXEC.                                                    11200008
190608                                                                  11210008
190609     EVALUATE TRUE                                                11220008
190610         WHEN SQLCODE = ZERO                                      11230008
190620* THE VENDOR IS A PRETICKET VENDOR - IF THE TICKET MAKER IND IS   11240008
190630* A "K", KOHLS MAKES THE TICKETS, AND A REQUEST CAN BE CREATED    11250008
190631             IF VNDAGR-TKT-MKR-IND = 'K'                          11260008
190632                 SET ASC-PTIC-PO          TO TRUE                 11270008
190633             ELSE                                                 11280008
190634* IF NOT, THE VENDOR MAKES THE TICKETS, AND A REQUEST CANNOT BE   11290008
190635* CREATED                                                         11300008
190636                 SET ASC-PTIC-PO-VND-PRT  TO TRUE                 11310008
190637             END-IF                                               11320008
190638                                                                  11330008
190639* IF THE PO ISN'T A PRETICKET PO, A REQUEST CANNOT BE ADDED       11340008
190640         WHEN SQLCODE = +100                                      11350008
190641             SET ASC-PTIC-PO-VND-NOT TO TRUE                      11360008
190642         WHEN SQLWARN0 NOT = SPACES                               11370008
190643         WHEN SQLCODE < ZERO                                      11380008
190644         WHEN SQLCODE > ZERO                                      11390008
190645             MOVE '3122-CHECK-VENDOR-FILE'                        11400008
190646                               TO DP013-PARAGRAPH                 11410008
190647             MOVE 'SELECT VENDOR AGREEMENTS'                      11420008
190648                               TO DP013-MESSAGE-TEXT (1)          11430008
190649             MOVE ASC-ENT-ID   TO DP013-MESSAGE-TEXT (2)          11440016
190650             MOVE DK-DEPT-NBR  TO DP013-MESSAGE-TEXT (3)          11450013
190651             MOVE SQLCA        TO DP013-SQLCA                     11460008
190652             MOVE 'TVNDAGR '   TO DP013-DB2-TABLE-NAME (1)        11470008
190653             SET DP013-DB2-ABEND                                  11480008
190654                 DP013-XCTL-DISPLAY-RESTART TO TRUE               11490008
190655             PERFORM DP013-0000-PROCESS-ABEND                     11500008
190656     END-EVALUATE.                                                11510008
190657                                                                  11520032
190658******************************************************************11530032
190659** GETS THE VENDOR NAME FROM THE ENT-ID ON TPURCHS               *11540032
190660******************************************************************11550032
190661 3130-GET-PO-VENDOR-NAME.                                         11560032
190662                                                                  11570032
190663     EXEC SQL                                                     11580032
190664          SELECT ENT_NAME_DESC                                    11590032
190665          INTO :ASC-VENDOR-NAME                                   11600032
190666          FROM TENTNME                                            11610032
190667          WHERE ENT_ID = :ASC-ENT-ID                              11620033
190668            AND TYPE_CDE       = '01'                             11630033
190669     END-EXEC.                                                    11640032
190670                                                                  11650032
190671     EVALUATE TRUE                                                11660032
190672         WHEN SQLCODE = ZERO                                      11670032
190673             CONTINUE                                             11680036
190674                                                                  11690032
190675         WHEN SQLWARN0 NOT = SPACES                               11700032
190676         WHEN SQLCODE < ZERO                                      11710032
190677         WHEN SQLCODE > ZERO                                      11720032
190678             MOVE '3130-GET-PO-VENDOR-NAME'                       11730032
190679                               TO DP013-PARAGRAPH                 11740032
190680             MOVE 'SELECT VENDOR NAME'                            11750032
190681                               TO DP013-MESSAGE-TEXT (1)          11760032
190682             MOVE ASC-ENT-ID   TO DP013-MESSAGE-TEXT (2)          11770032
190683             MOVE SQLCA        TO DP013-SQLCA                     11780032
190684             MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (1)        11790032
190685             SET DP013-DB2-ABEND                                  11800032
190686                 DP013-XCTL-DISPLAY-RESTART TO TRUE               11810032
190687             PERFORM DP013-0000-PROCESS-ABEND                     11820032
190688     END-EVALUATE.                                                11830032
190689******************************************************************11840001
190690** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **11850001
190691** MAP.                                                         **11860001
190692******************************************************************11870001
190693 3200-RESET-ATTRIBUTES.                                           11880001
190694     MOVE DP015-UNP-ALP-NOR-OFF    TO ADEPTA                      11890001
190695                                      AVNDNMEA                    11900001
190695                                      ADTELMTA                    11910051
190696                                      APONMBRA.                   11920001
190697     MOVE DP015-GREEN              TO ADEPTC                      11930001
190698                                      AVNDNMEC                    11940001
190698                                      ADTELMTC                    11950051
190699                                      APONMBRC.                   11960001
190700     MOVE DP015-UNDERLINE          TO ADEPTH                      11970001
190701                                      AVNDNMEH                    11980001
190701                                      ADTELMTH                    11990051
190702                                      APONMBRH.                   12000001
190703*                                                                 12010001
190704*                                                                 12020001
190705******************************************************************12030001
190706*  VALIDATE THAT THE USER IS AUTHORIZED TO DEAL WITH THE DEPT   **12040043
190707* THAT WAS ENTERED.                                               12050001
190708******************************************************************12060001
190709 3300-CHECK-DEPT-AUTHORIZATION.                                   12070043
190710                                                                  12080001
190711     MOVE ASC-DEPT-NBR              TO DK-DEPT-NBR.               12090001
190712                                                                  12100001
190713     EXEC SQL                                                     12110001
190714        SELECT COUNT(*)                                           12120043
190716        INTO   :PV-DB2-COUNT                                      12130043
190718        FROM                                                      12140001
190719               TMDSEAR A                                          12150001
190720              ,TRSPBAR B                                          12160001
190721              ,TWORKER C                                          12170001
190722        WHERE  A.MDSEAR_DKEY = B.MDSEAR_DKEY                      12180001
190723           AND A.MDSELV_CDE  = :PC-DPT-MDSELV-CDE                 12190001
190724           AND A.OPERCO_NBR  = :PC-OPERCO-NBR                     12200001
190725           AND A.DEPT_NBR    = :DK-DEPT-NBR                       12210001
190726           AND B.WORKER_STRT_DTE <= CURRENT DATE                  12220001
190727           AND B.WORKER_END_DTE  >= CURRENT DATE                  12230001
190728           AND B.WORKER_NBR  = C.WORKER_NBR                       12240001
190729           AND A.OPERCO_NBR  = C.OPERCO_NBR                       12250001
190730           AND C.UID_NBR     = :DP020-USERID                      12260001
190731     END-EXEC.                                                    12270001
190732                                                                  12280001
190733     EVALUATE TRUE                                                12290001
190734         WHEN SQLCODE = ZERO                                      12300001
190736         WHEN SQLCODE = +100                                      12310001
190737             CONTINUE                                             12320001
190738                                                                  12330001
190739         WHEN SQLWARN0 NOT = SPACES                               12340001
190740         WHEN SQLCODE < ZERO                                      12350001
190741         WHEN SQLCODE > ZERO                                      12360001
190742             MOVE '3300-VALIDATE-DEPT'                            12370001
190743                               TO DP013-PARAGRAPH                 12380001
190744             MOVE 'SELECT DEFAULT DEPT'                           12390001
190745                               TO DP013-MESSAGE-TEXT (1)          12400001
190746             MOVE SQLCA        TO DP013-SQLCA                     12410001
190747             MOVE 'TWORKER '   TO DP013-DB2-TABLE-NAME (1)        12420001
190748             MOVE 'TMDSEAR '   TO DP013-DB2-TABLE-NAME (2)        12430001
190749             MOVE 'TRSPBAR '   TO DP013-DB2-TABLE-NAME (3)        12440001
190750             SET DP013-DB2-ABEND                                  12450001
190751                 DP013-XCTL-DISPLAY-RESTART TO TRUE               12460001
190752             PERFORM DP013-0000-PROCESS-ABEND                     12470001
190753     END-EVALUATE.                                                12480001
190754                                                                  12490006
018190     IF PV-DB2-COUNT = +0                                         12500043
018200         PERFORM 3310-GET-DMA-GMA                                 12510043
018210         IF SQLCODE = +100                                        12520043
018220             CONTINUE                                             12530043
018230         ELSE                                                     12540043
018240             PERFORM 3320-CHECK-DMA-AUTHORIZATION                 12550043
018250             IF PV-DB2-COUNT = +0                                 12560043
018260                 PERFORM 3330-CHECK-GMA-AUTHORIZATION             12570043
018270             END-IF                                               12580043
018280         END-IF                                                   12590043
018290     END-IF.                                                      12600043
018340                                                                  12610043
      ****************************************************************  12620043
      * GET THE DMA AND GMA NUMBERS FOR THIS DEPARTMENT TO CHECK IF  *  12630043
      * THE USER HAS DMA OR GMA ACCESS                                  12640043
      ****************************************************************  12650043
018350 3310-GET-DMA-GMA.                                                12660043
018360                                                                  12670043
018370     PERFORM                                                      12680043
018380         WITH TEST AFTER                                          12690043
018390         VARYING PV-RETRY-COUNTER                                 12700043
018400         FROM 1 BY 1                                              12710043
018410         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12720043
018420             OR (SQLCODE = +0)                                    12730043
018430             OR (SQLCODE = +100))                                 12740043
018440                                                                  12750043
018450         EXEC SQL                                                 12760043
018460              SELECT GMA_NBR,                                     12770043
018470                     DMA_NBR                                      12780043
018480                INTO :DK-GMA-NBR,                                 12790043
018490                     :DK-DMA-NBR                                  12800043
018500                FROM TMDSEAR                                      12810043
018510               WHERE DEPT_NBR    = :DK-DEPT-NBR                   12820043
018520                 AND MDSELV_CDE  = 'DPT'                          12830043
018530                 AND OPERCO_NBR  = '03'                           12840043
018540                 AND STRT_DTE   <= CURRENT DATE                   12850043
018550                 AND END_DTE    >= CURRENT DATE                   12860043
018560         END-EXEC                                                 12870043
018570                                                                  12880043
018580         EVALUATE TRUE                                            12890043
018590             WHEN SQLCODE = +0                                    12900043
018600             WHEN SQLCODE = +100                                  12910043
018610             WHEN SQLCODE = -904                                  12920043
018620             WHEN SQLCODE = -913                                  12930043
018630                  CONTINUE                                        12940043
018640                                                                  12950043
018650             WHEN SQLWARN0 NOT = SPACES                           12960043
018660             WHEN SQLCODE < +0                                    12970043
018670             WHEN SQLCODE > +0                                    12980043
018680                  MOVE '3310-GET-DMA-GMA'                         12990043
018690                                  TO DP013-PARAGRAPH              13000043
018700                  MOVE 'UNSUCCESSFUL SELECT ON MDSEAR'            13010043
018710                                  TO DP013-MESSAGE-TEXT (1)       13020043
018720                  MOVE SQLCA      TO DP013-SQLCA                  13030043
018730                  MOVE 'TMDSEAR ' TO DP013-DB2-TABLE-NAME (1)     13040043
018740                  SET DP013-DB2-ABEND                             13050043
018750                      DP013-XCTL-DISPLAY-RESTART                  13060043
018760                                  TO TRUE                         13070043
018770                  PERFORM DP013-0000-PROCESS-ABEND                13080043
018780         END-EVALUATE                                             13090043
018790     END-PERFORM.                                                 13100043
018800                                                                  13110043
018810     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13120043
018820         MOVE '3310-GET-DMA-GMA'                                  13130043
018830                                  TO DP013-PARAGRAPH              13140043
018840         MOVE 'MAX RETRIES EXCEEDED ON SELECT ON MDSEAR'          13150043
018850                                  TO DP013-MESSAGE-TEXT (1)       13160043
018860         MOVE SQLCA               TO DP013-SQLCA                  13170043
018870         MOVE 'TMDSEAR '          TO DP013-DB2-TABLE-NAME (1)     13180043
018880         SET DP013-DB2-ABEND                                      13190043
018890             DP013-XCTL-DISPLAY-RESTART                           13200043
018900                                  TO TRUE                         13210043
018910         PERFORM DP013-0000-PROCESS-ABEND                         13220043
018920     END-IF.                                                      13230043
018930                                                                  13240043
      ***************************************************************** 13250043
      * CHECK IF THE USER HAS AUTHORIZATION TO THE DMA FOR THE ENTERED* 13260043
      * DEPARTMENT                                                    * 13270043
      ***************************************************************** 13280043
018940 3320-CHECK-DMA-AUTHORIZATION.                                    13290043
018950                                                                  13300043
018960     PERFORM                                                      13310043
018970         WITH TEST AFTER                                          13320043
018980         VARYING PV-RETRY-COUNTER                                 13330043
018990         FROM 1 BY 1                                              13340043
019000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13350043
019010             OR (SQLCODE = +0)                                    13360043
019020             OR (SQLCODE = +100))                                 13370043
019030                                                                  13380043
019040         EXEC SQL                                                 13390043
019050              SELECT COUNT(*)                                     13400043
019060                INTO :PV-DB2-COUNT                                13410043
019070                FROM TMDSEAR A                                    13420043
019080                    ,TRSPBAR B                                    13430043
019090               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                13440043
019100                 AND A.DMA_NBR    = :DK-DMA-NBR                   13450043
019110                 AND A.MDSELV_CDE  = 'DMA'                        13460043
019120                 AND A.OPERCO_NBR  = '03'                         13470043
019130                 AND B.WORKER_STRT_DTE <= CURRENT DATE            13480043
019140                 AND B.WORKER_END_DTE  >= CURRENT DATE            13490043
019150                 AND B.WORKER_NBR  =                              13500043
019160                    (SELECT WORKER_NBR                            13510043
019170                       FROM TWORKER                               13520043
019180                      WHERE OPERCO_NBR = '03'                     13530043
019190                        AND UID_NBR    = :DP020-USERID)           13540043
019200         END-EXEC                                                 13550043
019210                                                                  13560043
019220         EVALUATE TRUE                                            13570043
019230             WHEN SQLCODE = +0                                    13580043
019240             WHEN SQLCODE = +100                                  13590043
019250             WHEN SQLCODE = -904                                  13600043
019260             WHEN SQLCODE = -913                                  13610043
019270                  CONTINUE                                        13620043
019280                                                                  13630043
019290             WHEN SQLWARN0 NOT = SPACES                           13640043
019300             WHEN SQLCODE < +0                                    13650043
019310             WHEN SQLCODE > +0                                    13660043
019320                  MOVE '3320-CHECK-DMA-AUTHORIZATION'             13670043
019330                                  TO DP013-PARAGRAPH              13680043
019340                  MOVE 'UNSUCCESSFUL COUNT ON WORKER'             13690043
019350                                  TO DP013-MESSAGE-TEXT (1)       13700043
019360                  MOVE SQLCA      TO DP013-SQLCA                  13710043
019370                  MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)     13720043
019380                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     13730043
019390                  SET DP013-DB2-ABEND                             13740043
019400                      DP013-XCTL-DISPLAY-RESTART                  13750043
019410                                  TO TRUE                         13760043
019420                  PERFORM DP013-0000-PROCESS-ABEND                13770043
019430         END-EVALUATE                                             13780043
019440     END-PERFORM.                                                 13790043
019450                                                                  13800043
019460     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13810043
019470         MOVE '3320-CHECK-DMA-AUTHORIZATION'                      13820043
019480                                  TO DP013-PARAGRAPH              13830043
019490         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TWORKER'          13840043
019500                                  TO DP013-MESSAGE-TEXT (1)       13850043
019510         MOVE SQLCA               TO DP013-SQLCA                  13860043
019520         MOVE 'TWORKER '          TO DP013-DB2-TABLE-NAME (1)     13870043
019530         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     13880043
019540         SET DP013-DB2-ABEND                                      13890043
019550             DP013-XCTL-DISPLAY-RESTART                           13900043
019560                                  TO TRUE                         13910043
019570         PERFORM DP013-0000-PROCESS-ABEND                         13920043
019580     END-IF.                                                      13930043
019590                                                                  13940043
      ***************************************************************** 13950043
      * CHECK IF THE USER HAS AUTHORIZATION TO THE GMA FOR THE ENTERED* 13960043
      * DEPARTMENT                                                    * 13970043
      ***************************************************************** 13980043
019600 3330-CHECK-GMA-AUTHORIZATION.                                    13990043
019610                                                                  14000043
019620     PERFORM                                                      14010043
019630         WITH TEST AFTER                                          14020043
019640         VARYING PV-RETRY-COUNTER                                 14030043
019650         FROM 1 BY 1                                              14040043
019660         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14050043
019670             OR (SQLCODE = +0)                                    14060043
019680             OR (SQLCODE = +100))                                 14070043
019690                                                                  14080043
019700         EXEC SQL                                                 14090043
019710              SELECT COUNT(*)                                     14100043
019720                INTO :PV-DB2-COUNT                                14110043
019730                FROM TMDSEAR A                                    14120043
019740                    ,TRSPBAR B                                    14130043
019750               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                14140043
019760                 AND A.GMA_NBR    = :DK-GMA-NBR                   14150043
019770                 AND A.MDSELV_CDE  = 'GMA'                        14160043
019780                 AND A.OPERCO_NBR  = '03'                         14170043
019790                 AND B.WORKER_STRT_DTE <= CURRENT DATE            14180043
019800                 AND B.WORKER_END_DTE  >= CURRENT DATE            14190043
019810                 AND B.WORKER_NBR  =                              14200043
019820                    (SELECT WORKER_NBR                            14210043
019830                       FROM TWORKER                               14220043
019840                      WHERE OPERCO_NBR = '03'                     14230043
019850                        AND UID_NBR    = :DP020-USERID)           14240043
019860         END-EXEC                                                 14250043
019870                                                                  14260043
019880         EVALUATE TRUE                                            14270043
019890             WHEN SQLCODE = +0                                    14280043
019900             WHEN SQLCODE = +100                                  14290043
019910             WHEN SQLCODE = -904                                  14300043
019920             WHEN SQLCODE = -913                                  14310043
019930                  CONTINUE                                        14320043
019940                                                                  14330043
019950             WHEN SQLWARN0 NOT = SPACES                           14340043
019960             WHEN SQLCODE < +0                                    14350043
019970             WHEN SQLCODE > +0                                    14360043
019980                  MOVE '3330-CHECK-GMA-AUTHORIZATION'             14370043
019990                                  TO DP013-PARAGRAPH              14380043
020000                  MOVE 'UNSUCCESSFUL COUNT ON WORKER'             14390043
020010                                  TO DP013-MESSAGE-TEXT (1)       14400043
020020                  MOVE SQLCA      TO DP013-SQLCA                  14410043
020030                  MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)     14420043
020040                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     14430043
020050                  SET DP013-DB2-ABEND                             14440043
020060                      DP013-XCTL-DISPLAY-RESTART                  14450043
020070                                  TO TRUE                         14460043
020080                  PERFORM DP013-0000-PROCESS-ABEND                14470043
020090         END-EVALUATE                                             14480043
020100     END-PERFORM.                                                 14490043
020110                                                                  14500043
020120     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        14510043
020130         MOVE '3330-CHECK-GMA-AUTHORIZATION'                      14520043
020140                                  TO DP013-PARAGRAPH              14530043
020150         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TWORKER'          14540043
020160                                  TO DP013-MESSAGE-TEXT (1)       14550043
020170         MOVE SQLCA               TO DP013-SQLCA                  14560043
020180         MOVE 'TWORKER '          TO DP013-DB2-TABLE-NAME (1)     14570043
020190         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     14580043
020200         SET DP013-DB2-ABEND                                      14590043
020210             DP013-XCTL-DISPLAY-RESTART                           14600043
020220                                  TO TRUE                         14610043
020230         PERFORM DP013-0000-PROCESS-ABEND                         14620043
020240     END-IF.                                                      14630043
020250                                                                  14640043
190755*----------------------------------------------------------------*14650043
190756*    DETERMINE IF USER HAS RACF ACCESS TO UPDATE THE FUNCTION     14660043
190757*----------------------------------------------------------------*14670043
190758 3400-RACF-ACCESS.                                                14680043
190759                                                                  14690043
190760      MOVE 'F'                           TO DP008-RESOURCE-TYPE   14700043
190770      MOVE 'VLPTKUPD'                    TO DP008-RESOURCE-NAME   14710043
190780      SET DP008-ACCESS-TYPE-READ         TO TRUE                  14720043
190790                                                                  14730043
190800      EXEC CICS                                                   14740043
190900         LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                 14750043
191000              COMMAREA (DP008-SECURITY-COMMAREA)                  14760043
191100              LENGTH (DP008-SECURITY-COMMAREA-LENGTH)             14770043
191200      END-EXEC                                                    14780043
191300                                                                  14790043
191400      IF DP008-CALL-SUCCESSFUL                                    14800043
191500         CONTINUE                                                 14810043
191600     ELSE                                                         14820043
191700         MOVE '4330-RACF-ACCESS'                                  14830043
191800                               TO DP013-PARAGRAPH                 14840043
191900          MOVE 'UNABLE TO ACCESS CICS'                            14850043
192000                               TO DP013-MESSAGE-TEXT (1)          14860043
192100          MOVE SQLCA                 TO DP013-SQLCA               14870043
192200          SET DP013-DB2-ABEND                                     14880043
192300              DP013-XCTL-DISPLAY-RESTART                          14890043
192400                               TO TRUE                            14900043
192500          PERFORM DP013-0000-PROCESS-ABEND                        14910043
192501      END-IF.                                                     14920043
207900*----------------------------------------------------------------*14930045
208000*    VALIDATE THE USER-ENTERED DATE LIMIT                        *14940045
208200*----------------------------------------------------------------*14950045
208400 3500-VALIDATE-DATE-LIMIT.                                        14960045
210300     INITIALIZE DPG51 DPG52 DPG53                                 14970064
210400                DPG54 DPG55 DPG56.                                14980064
208900                                                                  14990045
209000     SET DPG51-ACTUAL-CALENDAR-ONLY                               15000045
209100                                  TO TRUE.                        15010045
209200                                                                  15020045
210000     MOVE ASC-DATE-LIMIT              TO DPG52-LK-DATE-INPUT.     15030045
210100     SET DPG52-LK-DTE-ISO-FMT         TO TRUE.                    15040045
210200                                                                  15050045
210300     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    15060064
210400                                             DPG54 DPG55 DPG56.   15070064
210500                                                                  15080045
210600     EVALUATE TRUE                                                15090045
210700         WHEN DPG54-NO-ERROR                                      15100045
213300             CONTINUE                                             15110045
392229                                                                  15120045
392230         WHEN DPG54-DATE-INVALID                                  15130045
392231*            DISPLAY INVALID DATE ERROR MESSAGE                   15140045
392232             SET DP030-SET-CURSOR-APPL-1  TO TRUE                 15150045
392233             MOVE PC-TSYMSG-01339         TO DP020-MSG-NUMBER     15160045
392234             MOVE -1                      TO ADTELMTL             15170045
392235             MOVE DP015-REVERSE           TO ADTELMTH             15180045
392236             MOVE DP015-RED               TO ADTELMTC             15190045
392237             SET DP020-MSG-FATAL                                  15200045
392238                 PS-ERROR                 TO TRUE                 15210045
                                                                        15220046
392239         WHEN OTHER                                               15230045
392240             SET DP013-LOGIC-ABEND TO TRUE                        15240045
392241             SET DP013-NO-ROLLBACK TO TRUE                        15250045
392242             MOVE '3000-EDIT-DATA-IN-COMMAREA'                    15260045
392243                                   TO DP013-PARAGRAPH             15270045
392244             MOVE 'ERROR CALLING DPKUT500 DATE ROUTINE'           15280045
392245                                   TO DP013-MESSAGE-TEXT(1)       15290045
392246             MOVE DPG54-ERROR-MESSAGE                             15300045
392247                                   TO DP013-MESSAGE-TEXT(2)       15310045
392248             PERFORM DP013-0000-PROCESS-ABEND                     15320045
392249     END-EVALUATE.                                                15330045
392250                                                                  15340045
192502*                                                                 15350043
192503*----------------------------------------------------------------*15360043
192504*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *15370001
192505*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *15380001
192506*  IT HERE.                                                      *15390001
192507*----------------------------------------------------------------*15400001
192508 4000-BUILD-INITIAL-PANEL.                                        15410001
192509     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        15420001
192510     MOVE -1                       TO APONMBRL.                   15430031
192511     PERFORM 4100-GET-DEFAULT-DEPT.                               15440001
192512     PERFORM 4200-GET-CURRENT-DATE.                               15450023
192513     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        15460001
192514*                                                                 15470001
192515*                                                                 15480001
192516******************************************************************15490001
192517** GETS THE DEFAULT DEPT - IF THERE IS ONE AND ONLY ONE DEPT.   **15500001
192518* IF THERE IS MORE THAN ONE, THE FIELD WILL BE LEFT BLANK.        15510001
192519******************************************************************15520001
192520 4100-GET-DEFAULT-DEPT.                                           15530001
192521                                                                  15540001
192522     EXEC SQL                                                     15550001
192523        SELECT                                                    15560001
192524               A.DEPT_NBR                                         15570001
192525        INTO                                                      15580001
192526               :MDSEAR-DEPT-NBR                                   15590001
192527        FROM                                                      15600001
192528               TMDSEAR A                                          15610001
192529              ,TRSPBAR B                                          15620001
192530              ,TWORKER C                                          15630001
192531        WHERE  A.MDSEAR_DKEY = B.MDSEAR_DKEY                      15640001
192532           AND A.MDSELV_CDE  = :PC-DPT-MDSELV-CDE                 15650001
192533           AND A.OPERCO_NBR  = :PC-OPERCO-NBR                     15660001
192534           AND B.WORKER_STRT_DTE <= CURRENT DATE                  15670001
192535           AND B.WORKER_END_DTE  >= CURRENT DATE                  15680001
192536           AND B.WORKER_NBR  = C.WORKER_NBR                       15690001
192537           AND A.OPERCO_NBR  = C.OPERCO_NBR                       15700001
192538           AND C.UID_NBR     = :DP020-USERID                      15710001
192539     END-EXEC.                                                    15720001
192540                                                                  15730001
192541     EVALUATE TRUE                                                15740001
192542         WHEN SQLCODE = ZERO                                      15750001
192543             MOVE MDSEAR-DEPT-NBR    TO ASC-DEPT-NBR              15760001
192544                                                                  15770001
192545         WHEN SQLCODE = -811                                      15780001
192546         WHEN SQLCODE = +100                                      15790001
192547             MOVE SPACES             TO ASC-DEPT-NBR              15800001
192548                                                                  15810001
192549         WHEN SQLWARN0 NOT = SPACES                               15820001
192550         WHEN SQLCODE < ZERO                                      15830001
192551         WHEN SQLCODE > ZERO                                      15840001
192552             MOVE '4100-GET-DEFAULT-DEPT'                         15850001
192553                               TO DP013-PARAGRAPH                 15860001
192554             MOVE 'SELECT DEFAUTL DEPT'                           15870001
192555                               TO DP013-MESSAGE-TEXT (1)          15880001
192556             MOVE SQLCA        TO DP013-SQLCA                     15890001
192557             MOVE 'TWORKER '   TO DP013-DB2-TABLE-NAME (1)        15900001
192558             MOVE 'TMDSEAR '   TO DP013-DB2-TABLE-NAME (2)        15910001
192559             MOVE 'TRSPBAR '   TO DP013-DB2-TABLE-NAME (3)        15920001
192560             SET DP013-DB2-ABEND                                  15930001
192561                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15940001
192562             PERFORM DP013-0000-PROCESS-ABEND                     15950001
192563     END-EVALUATE.                                                15960001
192564*                                                                 15970023
192565*                                                                 15980023
192566******************************************************************15990023
192567** GETS THE CURRENT DATE.                                         16000023
192568******************************************************************16010023
192569 4200-GET-CURRENT-DATE.                                           16020023
192570                                                                  16030023
192571     EXEC SQL                                                     16040023
192572        SET :ASC-CURRENT-DATE = CURRENT DATE                      16050023
192573     END-EXEC.                                                    16060023
192574                                                                  16070023
192575     EVALUATE TRUE                                                16080023
192576         WHEN SQLCODE = ZERO                                      16090023
192577             CONTINUE                                             16100023
192578         WHEN OTHER                                               16110023
192579             MOVE '4200-GET-CURRENT-DATE'                         16120023
192580                               TO DP013-PARAGRAPH                 16130023
192581             MOVE SQLCA        TO DP013-SQLCA                     16140023
192582             SET DP013-DB2-ABEND                                  16150023
192583                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16160023
192584             PERFORM DP013-0000-PROCESS-ABEND                     16170023
192585     END-EVALUATE.                                                16180023
208300                                                                  16190045
207900*----------------------------------------------------------------*16200045
208000*    GET THE DEFAULT DATE LIMIT -- CURRENT DATE MINUS 30 DAYS    *16210045
208200*----------------------------------------------------------------*16220045
208500                                                                  16230045
210300     INITIALIZE DPG51 DPG52 DPG53                                 16240064
210400                DPG54 DPG55 DPG56.                                16250064
208900                                                                  16260045
209000     SET DPG51-ACTUAL-CALENDAR-ONLY                               16270045
209100         DPG51-DECREMENT-DATE         TO TRUE.                    16280045
209200                                                                  16290045
209500     MOVE 30  TO DPG51-INCR-DECR-DAYS-9                           16300045
209900                                                                  16310045
210000     MOVE ASC-CURRENT-DATE            TO DPG52-LK-DATE-INPUT.     16320045
210100     SET DPG52-LK-DTE-ISO-FMT         TO TRUE.                    16330045
210200                                                                  16340045
210300     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    16350064
210400                                             DPG54 DPG55 DPG56.   16360064
210500                                                                  16370045
210600     EVALUATE TRUE                                                16380045
210700         WHEN DPG54-NO-ERROR                                      16390045
213300             MOVE DPG55-DB2-ISO-DATE-FMT  TO ASC-DATE-LIMIT       16400045
213300                                          ASC-DEFAULT-DATE-LIMIT  16410047
392229                                                                  16420045
392239         WHEN OTHER                                               16430045
392240             SET DP013-LOGIC-ABEND TO TRUE                        16440045
392241             SET DP013-NO-ROLLBACK TO TRUE                        16450045
392242             MOVE '4200-GET-CURRENT-DATE'                         16460046
392243                                   TO DP013-PARAGRAPH             16470045
392244             MOVE 'ERROR CALLING DPKUT500 DATE ROUTINE'           16480045
392245                                   TO DP013-MESSAGE-TEXT(1)       16490045
392246             MOVE 'TO GET THE DEFAULT DATE LIMIT'                 16500046
392247                                   TO DP013-MESSAGE-TEXT(2)       16510045
392246             MOVE DPG54-ERROR-MESSAGE                             16520046
392247                                   TO DP013-MESSAGE-TEXT(3)       16530046
392248             PERFORM DP013-0000-PROCESS-ABEND                     16540046
392249     END-EVALUATE.                                                16550046
392250                                                                  16560046
192586*                                                                 16570001
192587*----------------------------------------------------------------*16580001
192588*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *16590001
192589*----------------------------------------------------------------*16600001
192590 4400-MOVE-COMMAREA-TO-SCREEN.                                    16610001
192591     MOVE ASC-DEPT-NBR             TO ADEPTO.                     16620001
192592     MOVE ASC-VENDOR-NAME          TO AVNDNMEO.                   16630001
192593     MOVE ASC-PO-NUMBER            TO APONMBRO.                   16640001
192593     MOVE ASC-DATE-LIMIT           TO PV-DATE-ISO.                16650053
192593     MOVE CORR PV-DATE-ISO         TO PV-DATE-USA.                16660054
192593     MOVE PV-DATE-USA              TO ADTELMTO.                   16670053
192594 EJECT                                                            16680001
192595*----------------------------------------------------------------*16690001
192596*    ABEND PROCESSOR MODULE                                      *16700001
192597*----------------------------------------------------------------*16710001
192598                                                                  16720001
192599     COPY DPPD013.                                                16730001
