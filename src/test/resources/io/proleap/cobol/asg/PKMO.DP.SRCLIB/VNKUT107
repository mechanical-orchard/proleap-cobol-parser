000100 IDENTIFICATION DIVISION.                                         00010099
000200 PROGRAM-ID.     VNKUT107.                                        00020099
000300 AUTHOR.         MIKE BESKE.                                      00030099
000400 DATE-WRITTEN.   JUNE 2005.                                       00040099
000500*************************************************************     00050099
000600*    COBOL 2 WITH DB2 SQL                                   *     00060099
000700*                                                           *     00070099
000800*   VENDOR RECAP/EXCEPTION REPORTS EXTRACT PROGRAM          *     00080099
000900*                                                           *     00090099
001000*   PROGRAM OVERVIEW: THIS PROGRAM EXTRACTS LEGACY VENDOR   *     00100099
001100*   DATA NEEDED TO CREATE THE FILES THAT WILL BE USED TO    *     00110099
001200*   CREATE THE VARIOUS VENDOR RECAP/EXCEPTION REPORTS.      *     00120099
001300*                                                           *     00130099
001400*                                                           *     00140099
001500*   DB2 TABLES:                                             *     00150099
001600*  1. EXTERNAL ENTERPRISE TABLE                 (TEXTENT)   *     00160099
001700*  2. EXTERNAL ENTERPRISE NAME TABLE            (TENTNME)   *     00170099
001800*  3. VENDOR DEPARTMENT TABLE                   (TVNDDPT)   *     00180099
001900*  4. MERCHANDISE AREA TABLE                    (TMDSEAR)   *     00190099
002000*  5. RESPONSIBILITY AREA TABLE                 (TRSPBAR)   *     00200099
002100*  6. VENDOR AGREEMENT TABLE                    (TVNDAGR)   *     00210099
002200*  7. VENDOR PAYMENT TERMS TABLE                (TPAYTRM)   *     00220099
002300*  8. VENDOR INCENTIVE TYPE TABLE               (TINCTYP)   *     00230099
002400*  9. AP TRANCODE TABLE                         (TTRNCDE)   *     00240099
002500* 10. AP CONTROL TABLE                          (TAPCNTL)   *     00250099
002600* 11. KOHLS DATE ATTRIBUTE TABLE                (TDTATTR)   *     00260099
002700* 12. VENDOR ANALYSIS DEPARTMENT TABLE          (TVADPT )   *     00270099
002701* 13. SERVICE TYPE                              (TSERTYP)   *     00280099
002710* 14. VENDOR CAPABILITIES TABLE            (VNT_VND_CPBL)   *     00290099
002800*                                                           *     00300099
002900*   OUTPUT:                                                 *     00310099
003000*  1. EXTRACT-FILE                              (VNRD006)   *     00320099
CHG605*  2. MERCH-VNDR-FILE                           (VNRD007)   *     00330099
003200*************************************************************     00340099
003300*   CHANGES:                                                *     00350099
003400* CHANGE LOG:                                               *     00360099
003500* DATE  04/13/2006                                          *     00370099
003600*     CHANGE MADE: INITIAL VERSION CREATED.                 *     00380099
003700*     MADE BY: MIKE BESKE              WR/IR #: WR30346     *     00390099
003800*                                                           *     00400099
003810* DATE  10/15/2008                                          *     00410099
003820*     CHANGE MADE: Added 2nd output file for Direct Ship    *     00420099
003821*                  Vendor Terms.                            *     00430099
003830*     MADE BY: Scott Kruschka          WR/IR #: WR35285     *     00440099
003840*                                                           *     00450099
003850* DATE  06/09/2009                                          *     00460099
003860*     CHANGE MADE: ADDED LOGIC TO PARAGRAPHS M100- AND M200-*     00470099
003870*     TO POPULATE THE NEW COPYBOOK FIELD                    *     00480099
003871*     VN007-PRFT-DISCOUNT-PCT SO THAT THE PROFIT ASSIST/AD  *     00490099
003872*     COOP DISCOUNT PERCENTAGE WOULD BE INCLUDED IN THE     *     00500099
003873*     DIRECT SHIP OUTPUT FILE.  ALSO DECLARED THE NEW FIELD *     00510099
003874*     PV-PRFT-DISCOUNT-PCT AND ADDED THE REPORT COLUMN      *     00520099
003875*     HEADING Prft Asst % TO THE PC-DIRECT-SHIP-HEADER.     *     00530099
003880*     MADE BY: KRYSTEN LEROY           WR/IR #: WR36729     *     00540099
003890*                                                           *     00550099
003891* DATE  01/20/2017                                                00560099
003892*  CHANGE MADE: The program was writing consumer direct vendorsto 00570099
003893*  the file even after they had expired. Changed SQL in S900- para00580099
003894*  to include EFF_END_DTE >= CURRENT DATE. Verified that the      00590099
003895*  sample vendors given by the business were no longer written to 00600099
003896*  the output file OUT02. Tagged using CHG437.                    00610099
003897*  MADE BY: SRINATH(COGNIZANT)      WR/IR #: CHG0160437           00620099
003900*************************************************************     00630099
004000/                                                                 00640099
004100 ENVIRONMENT DIVISION.                                            00650099
004200 CONFIGURATION SECTION.                                           00660099
004300 INPUT-OUTPUT SECTION.                                            00670099
004400 FILE-CONTROL.                                                    00680099
004500                                                                  00690099
004600     SELECT EXTRACT-FILE           ASSIGN TO UT-S-OUT01.          00700099
CHG605     SELECT MERCH-VNDR-FILE        ASSIGN TO UT-S-OUT02.          00710099
004700                                                                  00720099
004800 DATA DIVISION.                                                   00730099
004900 FILE SECTION.                                                    00740099
005000 FD  EXTRACT-FILE                                                 00750099
005100     RECORDING MODE IS F                                          00760099
005200     LABEL RECORDS ARE STANDARD                                   00770099
005300     BLOCK CONTAINS 0 RECORDS                                     00780099
005400     DATA RECORD IS EXTRACT-RECORD.                               00790099
005500 01  EXTRACT-RECORD              PIC X(382).                      00800099
005600                                                                  00810099
005670                                                                  00820099
CHG605 FD  MERCH-VNDR-FILE                                              00830099
CHG605     RECORDING MODE IS F                                          00840099
CHG605     LABEL RECORDS ARE STANDARD                                   00850099
CHG605     BLOCK CONTAINS 0 RECORDS                                     00860099
CHG605     DATA RECORD IS MERCH-VNDR-RECORD.                            00870099
CHG605 01  MERCH-VNDR-RECORD           PIC X(200).                      00880099
005680                                                                  00890099
005700 WORKING-STORAGE SECTION.                                         00900099
005800                                                                  00910099
005900 01  PROGRAM-WORKAREA.                                            00920099
006000     05  FILLER                  PIC  X(30)           VALUE       00930099
006100         '** BEGINING OF VNKUT107 W/S **'.                        00940099
006200                                                                  00950099
006300     05  PV-CURRENT-PARAGRAPH    PIC  X(30)           VALUE SPACE.00960099
006400     05  PV-PROGRAM-NAME         PIC  X(08)           VALUE       00970099
006500         'VNKUT107'.                                              00980099
006600     05  PV-MAX-RETRIES          PIC S9(04)    COMP   VALUE +3.   00990099
006700     05  PV-RETRY-COUNTER        PIC S9(04)    COMP   VALUE +0.   01000099
006800     05  INPUT-COUNT             PIC 9(09)            VALUE  0.   01010099
006900     05  OUTPUT-COUNT            PIC 9(09)            VALUE  0.   01020099
CHG605     05  MERCH-VNDR-COUNT        PIC 9(09)            VALUE  0.   01030099
007000                                                                  01040099
007100     05  PV-RCPT-GRO-COST-AMT    PIC S9(11)V9(2) COMP-3.          01050099
007200     05  PV-ENT-ID               PIC S9(9) COMP.                  01060099
007300     05  PV-ENT-ID-UNPK          PIC S9(9)            VALUE ZEROS.01070099
007400     05  PV-ENT-ID-9X            PIC  X(9)            VALUE SPACE.01080099
007500     05  ASC-PAYT-TERM-ID-DESC   PIC  X(28).                      01090099
007600     05  PV-EDIT-PAYT-TERM-ID    PIC  ZZ9.                        01100099
007700     05  PV-CRE-DATE             PIC  X(10)           VALUE SPACE.01110099
007710     05  PV-PREV-VENDOR          PIC  S9(9) COMP      VALUE 0.    01120099
007720     05  PV-NEW-STR-DAYS-QTY     PIC  -9(4).                      01130099
007730     05  PV-NEW-DISCOUNT-PCT     PIC  -99.99.                     01140099
007740     05  PV-MOS-DISCOUNT-PCT     PIC  -99.99.                     01150099
007750     05  PV-TRD-DISCOUNT-PCT     PIC  -99.99.                     01160099
007760     05  PV-BRD-DISCOUNT-PCT     PIC  -99.99.                     01170099
007770     05  PV-COOP-DISCOUNT-PCT    PIC  -99.99.                     01180099
007771     05  PV-PRFT-DISCOUNT-PCT    PIC  -99.99.                     01190099
007772     05  PV-CHRG-PCT-IND         PIC  X(01) VALUE SPACE.          01200099
007773     05  PV-RTV-RA-REQD-IND      PIC  X(01) VALUE SPACE.          01210099
007774     05  PV-RTV-NO-RA-REQD-IND   PIC  X(01) VALUE SPACE.          01220099
007775     05  PV-DEBIT-DESTROY-IND    PIC  X(01) VALUE SPACE.          01230099
007776     05  PV-MARKOUT-IND          PIC  X(01) VALUE SPACE.          01240099
007777     05  PV-VND-AUTH-ID          PIC  X(10) VALUE SPACE.          01250099
007780     05  PV-RATE-HNDLG-FEE       PIC  X(08) VALUE SPACES.         01260099
007790     05  PV-RATE-HNDLG-FEE-R1 REDEFINES PV-RATE-HNDLG-FEE.        01270099
007791         10  PV-CHRG-PCT         PIC  -99.99.                     01280099
007792         10  FILLER              PIC  X(02).                      01290099
007793     05  PV-RATE-HNDLG-FEE-R2 REDEFINES PV-RATE-HNDLG-FEE.        01300099
007794         10  PV-CHRG-AMT         PIC  -9999.99.                   01310099
007800                                                                  01320099
007900     05  PV-CURRENT-DATE         PIC  X(06)           VALUE SPACE.01330099
008000     05  PV-CURRENT-DATE-RED REDEFINES PV-CURRENT-DATE.           01340099
008100         10  PV-CURRENT-DATE-YY  PIC  X(02).                      01350099
008200         10  PV-CURRENT-DATE-MM  PIC  X(02).                      01360099
008300         10  PV-CURRENT-DATE-DD  PIC  X(02).                      01370099
008400     05  PV-CURRENT-DT           PIC  X(10)           VALUE SPACE.01380099
008500     05  PV-CURRENT-DT-RED REDEFINES PV-CURRENT-DT.               01390099
008600         10  PV-CURRENT-CC       PIC  X(02).                      01400099
008700         10  PV-CURRENT-YY       PIC  X(02).                      01410099
008800         10  PV-CURRENT-DASH1    PIC  X(01).                      01420099
008900         10  PV-CURRENT-MM       PIC  X(02).                      01430099
009000         10  PV-CURRENT-DASH2    PIC  X(01).                      01440099
009100         10  PV-CURRENT-DD       PIC  X(02).                      01450099
009200                                                                  01460099
009300     05  PV-CURRENT-TIME.                                         01470099
009400         10  PV-CURRENT-HOUR     PIC  9(02)           VALUE 0.    01480099
009500         10  PV-CURRENT-MINUTE   PIC  9(02)           VALUE 0.    01490099
009600         10  FILLER              PIC  9(02)           VALUE 0.    01500099
009700                                                                  01510099
009710 01  PROGRAM-CONSTANTS.                                           01520099
009720     05  PC-PCT                  PIC  X(01) VALUE '%'.            01530099
009730     05  PC-CHRG                 PIC  X(01) VALUE '$'.            01540099
009740                                                                  01550099
009800 01  PROGRAM-SWITCHES-SUBS.                                       01560099
009900     05  PV-MORE-DATA-SW         PIC  X(01)           VALUE 'N'.  01570099
010000         88  NO-MORE-DATA        VALUE 'Y'.                       01580099
010100         88  MORE-DATA           VALUE 'N'.                       01590099
010200     05  PS-EOF-INCENT-CSR-SW    PIC X(01)  VALUE 'N'.            01600099
010300         88  PS-EOF-INCENT-CSR              VALUE 'Y'.            01610099
010400     05  PS-EOF-OFFINVCE-CSR-SW  PIC X(01)  VALUE 'N'.            01620099
010500         88  PS-EOF-OFFINVCE-CSR            VALUE 'Y'.            01630099
010510     05  PS-CDS-VENDOR-FOUND-SW  PIC X      VALUE 'N'.            01640099
010520         88  PS-CDS-VENDOR-FOUND            VALUE 'Y'.            01650099
010530         88  PS-CDS-VENDOR-NOT-FOUND        VALUE 'N'.            01660099
CHG605     05  PS-MDS-VENDOR-FOUND-SW  PIC X      VALUE 'N'.            01670099
CHG605         88  PS-MDS-VENDOR-FOUND            VALUE 'Y'.            01680099
CHG605         88  PS-MDS-VENDOR-NOT-FOUND        VALUE 'N'.            01690099
010600                                                                  01700099
010700 01  DN-DB2-NULL-INDICATORS.                                      01710099
010800     05  DN-DISCOUNT-PCT              PIC S9(04) VALUE +0         01720099
010900                                                  COMP.           01730099
011000     05  DN-EXT-PAY-DAYS-QTY          PIC S9(04) VALUE +0         01740099
011100                                                  COMP.           01750099
011200                                                                  01760099
011300 01  PC-COLUMN-HEADERS.                                           01770099
011400     05  FILLER                       PIC X(50)  VALUE            01780099
011500     'GMA,DMA,VNDNME,ENTID,VNDNBR,DPTNBR,DPTNME,DPTNEW,V'.        01790099
011600     05  FILLER                       PIC X(50)  VALUE            01800099
011700     'NDNEW,DPTSTAT,VNDSTAT,GMAFIRST,GMALAST,DMAFIRST,DM'.        01810099
011800     05  FILLER                       PIC X(50)  VALUE            01820099
011900     'ALAST,GROCOST,TERMS,PAYDAYS,NEWPCT,MOSPCT,TRDPCT,B'.        01830099
012000     05  FILLER                       PIC X(50)  VALUE            01840099
012100     'RDPCT,COOPPCT,PRFTPCT,TBLDAYS,BRDLPCT,LATEPCT,BYR,'.        01850099
012200     05  FILLER                       PIC X(32)  VALUE            01860099
012300     'BYRFIRST,BYRLAST,OFFTRN1,OFFPCT1'.                          01870099
012400     05  FILLER                       PIC X(50)  VALUE            01880099
012500     ',OFFFRQ1,OFFDISC1,OFFRTV1,OFFTRN2,OFFPCT2,OFFFRQ2,'.        01890099
012600     05  FILLER                       PIC X(50)  VALUE            01900099
012700     'OFFDISC2,OFFRTV2,OFFTRN3,OFFPCT3,OFFFRQ3,OFFDISC3,'.        01910099
012800     05  FILLER                       PIC X(50)  VALUE            01920099
012900     'OFFRTV3,OFFTRN4,OFFPCT4,OFFFRQ4,OFFDISC4,OFFRTV4,'.         01930099
012901                                                                  01940099
013000                                                                  01950099
CHG605 01  PC-MERCH-VNDR-HEADER.                                        01960099
CHG605     05  FILLER                       PIC X(50)  VALUE            01970099
CHG605     'Vendor Name,Vendor ID,Dept,Pay Terms,NSD Days,NSD '.        01980099
CHG605     05  FILLER                       PIC X(50)  VALUE            01990099
CHG605     '%,MOS %,TRD %,Broadcast %,Co-op %,Prft Asst %,Rate'.        02000099
CHG605     05  FILLER                       PIC X(50)  VALUE            02010099
CHG605     '/Handling Fee,$ or %,RTV RA Req,RTV No RA Req,Debi'.        02020099
CHG605     05  FILLER                       PIC X(50)  VALUE            02030099
CHG605     'it & Destroy,Markout,Auth ID                      '.        02040099
CHG605                                                                  02050099
013900*  W/S COPYBOOK FOR POPD001 PAYMENT TERMS FORMAT ROUTINE.         02060099
014000                                                                  02070099
014100     COPY POWS020.                                                02080099
014200                                                                  02090099
014300*  OUTPUT RECORD AREA                                             02100099
014400                                                                  02110099
014500     COPY VNRD006.                                                02120099
014600                                                                  02130099
014610*  OUTPUT RECORD AREA FOR MERCHANDISE VENDORS                     02140099
014620                                                                  02150099
014630     COPY VNRD007.                                                02160099
014640                                                                  02170099
014700*----------------------------------------------------------------*02180099
014800*  EXTERNAL ENTERPRISE TABLE                                     *02190099
014900*----------------------------------------------------------------*02200099
015000     EXEC SQL                                                     02210099
015100          INCLUDE TEXTENT                                         02220099
015200     END-EXEC.                                                    02230099
015300                                                                  02240099
015400*----------------------------------------------------------------*02250099
015500*  EXTERNAL ENTERPRISE NAME TABLE                                *02260099
015600*----------------------------------------------------------------*02270099
015700     EXEC SQL                                                     02280099
015800          INCLUDE TENTNME                                         02290099
015900     END-EXEC.                                                    02300099
016000                                                                  02310099
016100*----------------------------------------------------------------*02320099
016200*  VENDOR DEPARTMENT TABLE                                       *02330099
016300*----------------------------------------------------------------*02340099
016400     EXEC SQL                                                     02350099
016500          INCLUDE TVNDDPT                                         02360099
016600     END-EXEC.                                                    02370099
016700                                                                  02380099
016800*----------------------------------------------------------------*02390099
016900*  MERCHANDISE AREA TABLE                                        *02400099
017000*----------------------------------------------------------------*02410099
017100     EXEC SQL                                                     02420099
017200          INCLUDE TMDSEAR                                         02430099
017300     END-EXEC.                                                    02440099
017400                                                                  02450099
017500*----------------------------------------------------------------*02460099
017600*  RESPONSIBILITY AREA TABLE                                     *02470099
017700*----------------------------------------------------------------*02480099
017800     EXEC SQL                                                     02490099
017900          INCLUDE TRSPBAR                                         02500099
018000     END-EXEC.                                                    02510099
018100                                                                  02520099
018200*----------------------------------------------------------------*02530099
018300*  VENDOR AGREEMENT TABLE                                        *02540099
018400*----------------------------------------------------------------*02550099
018500     EXEC SQL                                                     02560099
018600          INCLUDE TVNDAGR                                         02570099
018700     END-EXEC.                                                    02580099
018800                                                                  02590099
018900*----------------------------------------------------------------*02600099
019000*  VENDOR PAYMENT TERMS TABLE                                    *02610099
019100*----------------------------------------------------------------*02620099
019200     EXEC SQL                                                     02630099
019300          INCLUDE TPAYTRM                                         02640099
019400     END-EXEC.                                                    02650099
019500                                                                  02660099
019600*----------------------------------------------------------------*02670099
019700*  VENDOR INCENTIVE TYPE TABLE                                   *02680099
019800*----------------------------------------------------------------*02690099
019900     EXEC SQL                                                     02700099
020000          INCLUDE TINCTYP                                         02710099
020100     END-EXEC.                                                    02720099
020200                                                                  02730099
020300*----------------------------------------------------------------*02740099
020400*  AP TRANCODE TABLE                                             *02750099
020500*----------------------------------------------------------------*02760099
020600     EXEC SQL                                                     02770099
020700          INCLUDE TTRNCDE                                         02780099
020800     END-EXEC.                                                    02790099
020900                                                                  02800099
021000*----------------------------------------------------------------*02810099
021100*  AP CONTROL TABLE                                              *02820099
021200*----------------------------------------------------------------*02830099
021300     EXEC SQL                                                     02840099
021400          INCLUDE TAPCNTL                                         02850099
021500     END-EXEC.                                                    02860099
021600                                                                  02870099
021700*----------------------------------------------------------------*02880099
021800*  KOHLS DATE ATTRIBUTE TABLE                                    *02890099
021900*----------------------------------------------------------------*02900099
022000     EXEC SQL                                                     02910099
022100          INCLUDE TDTATTR                                         02920099
022200     END-EXEC.                                                    02930099
022300                                                                  02940099
022400*----------------------------------------------------------------*02950099
022500*  VENDOR ANALYSIS DEPARTMENT TABLE                              *02960099
022600*----------------------------------------------------------------*02970099
022700     EXEC SQL                                                     02980099
022800          INCLUDE TVADPT                                          02990099
022900     END-EXEC.                                                    03000099
023000                                                                  03010099
023010*---------------------------------------------------------------* 03020099
023020* SERVICE TYPE TABLE                                            * 03030099
023030*---------------------------------------------------------------* 03040099
023040     EXEC SQL                                                     03050099
023050          INCLUDE TSERTYP                                         03060099
023060     END-EXEC.                                                    03070099
023070                                                                  03080099
023080*---------------------------------------------------------------* 03090099
023090* VENDOR CAPABILITIES TABLE                                     * 03100099
023091*---------------------------------------------------------------* 03110099
023092     EXEC SQL                                                     03120099
023093          INCLUDE VNT00001                                        03130099
023094     END-EXEC.                                                    03140099
023095                                                                  03150099
023100*----------------------------------------------------------------*03160099
023200*    SQL COMMUNICATIONS AREA DCLGEN                               03170099
023300*----------------------------------------------------------------*03180099
023400     EXEC SQL                                                     03190099
023500         INCLUDE SQLCA                                            03200099
023600     END-EXEC.                                                    03210099
023700                                                                  03220099
023800*----------------------------------------------------------------*03230099
023900* VENDOR_DATA_CSR WILL FETCH ALL OF THE MERCHANDISE VENDORS THAT *03240099
024000* HAVE DEPARTMENTS WITH GMM/DMM ASSOCIATED WITH THEM.            *03250099
024100*----------------------------------------------------------------*03260099
024200     EXEC SQL                                                     03270099
024300       DECLARE VENDOR_DATA_CSR CURSOR FOR                         03280099
024400         SELECT M.GMA_NBR                                         03290099
024500               ,M.DMA_NBR                                         03300099
024600               ,M.BYR_NBR                                         03310099
024700               ,A.VND_DEPT_STAT_CD                                03320099
024800               ,C.ENT_NAME_DESC                                   03330099
024900               ,B.ENT_ID                                          03340099
025000               ,B.DUN_NBR                                         03350099
025100               ,B.STATUS_CDE                                      03360099
025200               ,DATE(B.CRE_TMST)                                  03370099
025300               ,A.DEPT_NBR                                        03380099
025400               ,A.CRE_DTE                                         03390099
025500               ,M.MDSEAR_DESC                                     03400099
025600          FROM  TVNDDPT A                                         03410099
025700               ,TMDSEAR M                                         03420099
025800               ,TEXTENT B                                         03430099
025900               ,TENTNME C                                         03440099
026000         WHERE  A.ENT_ID       = B.ENT_ID                         03450099
026100           AND  B.ENT_ID       = C.ENT_ID                         03460099
026200           AND  C.TYPE_CDE     = '01'                             03470099
026300           AND  A.DEPT_NBR     = M.DEPT_NBR                       03480099
026400           AND  M.MDSELV_CDE   = 'DPT'                            03490099
026500           AND  M.OPERCO_NBR   = '03'                             03500099
026610           AND  CURRENT DATE BETWEEN M.STRT_DTE AND M.END_DTE     03510099
026700     END-EXEC.                                                    03520099
026800                                                                  03530099
026900*----------------------------------------------------------------*03540099
027000* DISCOUNT_CSR WILL FIND ALL OF THE DISCOUNTS FOR THE VENDOR/    *03550099
027100* DEPARTMENT BEING PROCESSED.                                    *03560099
027200*----------------------------------------------------------------*03570099
027300     EXEC SQL                                                     03580099
027400       DECLARE DISCOUNT_CSR CURSOR FOR                            03590099
027500         SELECT E.TYP_CDE                                         03600099
027600               ,E.DISCOUNT_PCT                                    03610099
027700               ,E.EXT_PAY_DAYS_QTY                                03620099
027800           FROM TVNDAGR E                                         03630099
027900               ,TINCTYP F                                         03640099
028000          WHERE E.TYP_CDE           = F.INCENTIVE_ID              03650099
028100            AND E.ENT_ID            = :EXTENT-ENT-ID              03660099
028200            AND E.DEPT_NBR          = :VNDDPT-DEPT-NBR            03670099
028300            AND E.AGRMT_TYP_ID      = '5'                         03680099
028410            AND E.EFFECTIVE_DATE   <= CURRENT DATE                03690099
028500            AND E.EXPIRATION_DATE  >  CURRENT DATE                03700099
028600     END-EXEC.                                                    03710099
028700                                                                  03720099
028800*----------------------------------------------------------------*03730099
028900* OFFINVCE_CSR WILL FIND ALL OF THE OFF INVOICE DATA FOR THE     *03740099
029000* VENDOR/DEPARTMENT BEING PROCESSED.                             *03750099
029100*----------------------------------------------------------------*03760099
029200     EXEC SQL                                                     03770099
029300       DECLARE OFFINVCE_CSR CURSOR FOR                            03780099
029400          SELECT A.AP_TRN_CDE                                     03790099
029500                ,A.DISCOUNT_PCT                                   03800099
029600                ,A.PSTG_FRQ_CDE                                   03810099
029700                ,A.DED_DISC_IND                                   03820099
029800                ,A.DED_RTV_IND                                    03830099
029900            FROM TVNDAGR A                                        03840099
030000                ,TTRNCDE B                                        03850099
030100           WHERE A.AP_TRN_CDE     = B.AP_TRN_CDE                  03860099
030200             AND A.AGRMT_TYP_ID   = '6'                           03870099
030300             AND A.TYP_CDE        = 6                             03880099
030400             AND (CURRENT DATE BETWEEN A.EFFECTIVE_DATE AND       03890099
030500                                       A.EXPIRATION_DATE          03900099
030600                  OR A.EFFECTIVE_DATE > CURRENT DATE)             03910099
030700             AND B.EFF_STRT_DTE =                                 03920099
030800                 (SELECT MIN(T.EFF_STRT_DTE)                      03930099
030900                    FROM TTRNCDE T                                03940099
031000                   WHERE T.AP_TRN_CDE  = B.AP_TRN_CDE             03950099
031100                     AND (A.EFFECTIVE_DATE  BETWEEN T.EFF_STRT_DTE03960099
031200                                                AND T.EFF_END_DTE 03970099
031300                      OR  (A.EFFECTIVE_DATE < T.EFF_STRT_DTE AND  03980099
031400                           A.EFFECTIVE_DATE < T.EFF_END_DTE)))    03990099
031500             AND A.ENT_ID         = :EXTENT-ENT-ID                04000099
031600             AND A.DEPT_NBR       = :VNDDPT-DEPT-NBR              04010099
031700     END-EXEC.                                                    04020099
031800                                                                  04030099
031900*----------------------------------------------------------------*04040099
032000*  ABEND DATA AREAS                                              *04050099
032100*----------------------------------------------------------------*04060099
032200 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          04070099
032300                                             COMP SYNC.           04080099
032400     88  AC-BAD-DATA                         VALUE +4003.         04090099
032500     88  AC-DB2-ERROR                        VALUE +4013.         04100099
032600     88  AC-DATE-ERROR                       VALUE +4019.         04110099
032700                                                                  04120099
032800                                                                  04130099
032900 01  ABEND-AREAS.                                                 04140099
033000     05  AA-ABEND-LIT            PIC  X(40)  VALUE                04150099
033100             '*****       ABEND'.                                 04160099
033200     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                04170099
033300             '*****   PROGRAM: VNKUT107'.                         04180099
033400     05  AA-PARAGRAPH-LIT.                                        04190099
033500         10  FILLER              PIC  X(17)  VALUE                04200099
033600             '***** PARAGRAPH: '.                                 04210099
033700         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        04220099
033800     05  AA-MESSAGE-LINE.                                         04230099
033900         10  FILLER              PIC  X(06)  VALUE '*****'.       04240099
034000         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        04250099
034100     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                04260099
034200             '*****    DB2 ERROR'.                                04270099
034300     05  AA-DB2-OPERATION-LIT.                                    04280099
034400         10  FILLER              PIC  X(17)  VALUE                04290099
034500             '***** OPERATION: '.                                 04300099
034600         10  AA-DB2-OPERATION.                                    04310099
034700             15  AA-DB2-OP-1     PIC  X(50)  VALUE SPACES.        04320099
034800             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        04330099
034900     05  AA-DB2-TABLE-1          PIC  X(12)  VALUE SPACES.        04340099
035000     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        04350099
035100     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        04360099
035200     05  AA-DB2-TABLE-4          PIC  X(08)  VALUE SPACES.        04370099
035300                                                                  04380099
035400     COPY DPWS004.                                                04390099
035500                                                                  04400099
035600 01  FILLER                      PIC  X(25)  VALUE                04410099
035700     '** END OF VNKUT107 W/S **'.                                 04420099
035800                                                                  04430099
035900 PROCEDURE DIVISION.                                              04440099
036000                                                                  04450099
036100***************************************************************** 04460099
036200*  MAIN DRIVER PARAGRAPH                                          04470099
036300***************************************************************** 04480099
036400 A100-MAIN.                                                       04490099
036500                                                                  04500099
036600     MOVE 'A100-MAIN'            TO   PV-CURRENT-PARAGRAPH.       04510099
036700                                                                  04520099
036800     PERFORM B100-BEGIN-PROGRAM.                                  04530099
036900                                                                  04540099
037000     PERFORM B200-PROCESS-VENDOR-DATA UNTIL NO-MORE-DATA.         04550099
037100                                                                  04560099
037200     PERFORM B300-END-PROGRAM.                                    04570099
037300                                                                  04580099
037400     GOBACK.                                                      04590099
037500                                                                  04600099
037600***************************************************************** 04610099
037700*  PROGRAM INITIALIZATION                                         04620099
037800***************************************************************** 04630099
037900 B100-BEGIN-PROGRAM.                                              04640099
038000                                                                  04650099
038100     MOVE 'B100-BEGIN-PROGRAM'   TO   PV-CURRENT-PARAGRAPH.       04660099
038200                                                                  04670099
038300     DISPLAY '**********************************************'.    04680099
038400     DISPLAY '**        VNKUT107 STARTING NOW!!!!         **'.    04690099
038500     DISPLAY '**********************************************'.    04700099
038600                                                                  04710099
038700     ACCEPT PV-CURRENT-DATE FROM DATE.                            04720099
038800     MOVE '20'               TO PV-CURRENT-CC.                    04730099
038900     MOVE '-'                TO PV-CURRENT-DASH1                  04740099
039000                                PV-CURRENT-DASH2.                 04750099
039100     MOVE PV-CURRENT-DATE-YY TO PV-CURRENT-YY.                    04760099
039200     MOVE PV-CURRENT-DATE-MM TO PV-CURRENT-MM.                    04770099
039300     MOVE PV-CURRENT-DATE-DD TO PV-CURRENT-DD.                    04780099
039400     DISPLAY 'PV-CURRENT-DATE = ' PV-CURRENT-DT.                  04790099
039500                                                                  04800099
039600     OPEN OUTPUT EXTRACT-FILE                                     04810099
CHG605                 MERCH-VNDR-FILE.                                 04820099
039700                                                                  04830099
039800     MOVE PC-COLUMN-HEADERS TO VN006-COL-AREA.                    04840099
039900     WRITE EXTRACT-RECORD FROM VN006-VENDOR-REPORT-REC.           04850099
040000     ADD 1 TO OUTPUT-COUNT.                                       04860099
040010                                                                  04870099
040050                                                                  04880099
CHG605     MOVE PC-MERCH-VNDR-HEADER  TO VN007-COL-AREA.                04890099
CHG605     WRITE MERCH-VNDR-RECORD  FROM VN007-VENDOR-REPORT-REC.       04900099
CHG605     ADD 1 TO MERCH-VNDR-COUNT.                                   04910099
040050                                                                  04920099
040100     INITIALIZE VN006-REPT-AREA                                   04930099
CHG605                VN007-REPT-AREA.                                  04940099
040200                                                                  04950099
040300     INITIALIZE DCLTEXTENT                                        04960099
040400                DCLTENTNME                                        04970099
040500                DCLTVNDDPT                                        04980099
040600                DCLTMDSEAR                                        04990099
040700                DCLTRSPBAR                                        05000099
040800                DCLTVNDAGR                                        05010099
040900                DCLTPAYTRM                                        05020099
041000                DCLTINCTYP                                        05030099
041100                DCLTTRNCDE                                        05040099
041200                DCLTAPCNTL                                        05050099
041300                DCLTDTATTR                                        05060099
041400                DCLTVADPT                                         05070099
041401                DCLTSERTYP                                        05080099
041410                DCLVNT00001.                                      05090099
041500                                                                  05100099
041600     PERFORM S100-SELECT-BGN-END-DATES.                           05110099
041700     PERFORM Y100-OPEN-VENDOR-DATA-CSR.                           05120099
041800     PERFORM R100-FETCH-VENDOR-DATA.                              05130099
041900                                                                  05140099
042000***************************************************************** 05150099
042100*  PROCESS ALL OF THE RETURNED ROWS UNTIL THERE IS NO MORE DATA   05160099
042200***************************************************************** 05170099
042300 B200-PROCESS-VENDOR-DATA.                                        05180099
042400                                                                  05190099
042500     MOVE 'B200-PROCESS-VENDOR-DATA' TO   PV-CURRENT-PARAGRAPH.   05200099
042600                                                                  05210099
042700     PERFORM M100-MOVE-VENDOR-DATA.                               05220099
042700     PERFORM S905-SELECT-MDS-VENDOR.                              05230099
CHG605         IF PS-MDS-VENDOR-FOUND                                   05240099
CHG605            MOVE SPACES TO PV-RATE-HNDLG-FEE                      05250099
CHG605            PERFORM S910-SELECT-CDS-RATE-CHARGE                   05260099
CHG605            PERFORM S920-SELECT-PURCHASE-TERMS                    05270099
CHG605            PERFORM M200-MOVE-MDS-VENDOR-DATA                     05280099
CHG605         END-IF.                                                  05290099
042800     PERFORM R100-FETCH-VENDOR-DATA.                              05300099
042900                                                                  05310099
043000***************************************************************** 05320099
043100*  END OF PROCESSING.  CLOSE FILE.  DISPLAY COUNTS.               05330099
043200***************************************************************** 05340099
043300 B300-END-PROGRAM.                                                05350099
043400                                                                  05360099
043500     MOVE 'B300-END-PROGRAM'     TO   PV-CURRENT-PARAGRAPH.       05370099
043600                                                                  05380099
043700     PERFORM Y200-CLOSE-VENDOR-DATA-CSR.                          05390099
043800     CLOSE  EXTRACT-FILE                                          05400099
CHG605            MERCH-VNDR-FILE.                                      05410099
043900                                                                  05420099
044000     DISPLAY '***** VNKUT107 COUNTS *****'.                       05430099
044100     DISPLAY 'RECORDS FETCHED  = ' INPUT-COUNT.                   05440099
044200     DISPLAY 'RECORDS WRITTEN  = ' OUTPUT-COUNT.                  05450099
CHG605     DISPLAY 'MDS RECS WRITTEN = ' MERCH-VNDR-COUNT.              05460099
044300     DISPLAY '***************************'.                       05470099
044400                                                                  05480099
044500***************************************************************** 05490099
044600*  MOVE THE VENDOR DATA TO THE EXTRACT RECORD.  WRITE OUT         05500099
044700*  THE EXTRACT RECORD.                                            05510099
044800***************************************************************** 05520099
044900 M100-MOVE-VENDOR-DATA.                                           05530099
045000                                                                  05540099
045100     MOVE 'M100-MOVE-VENDOR-DATA' TO PV-CURRENT-PARAGRAPH.        05550099
045200                                                                  05560099
045300     MOVE ','  TO VN006-FILLER-1 VN006-FILLER-2 VN006-FILLER-3    05570099
045400                  VN006-FILLER-4 VN006-FILLER-5 VN006-FILLER-6    05580099
045500                  VN006-FILLER-7 VN006-FILLER-8 VN006-FILLER-9    05590099
045600               VN006-FILLER-10 VN006-FILLER-11 VN006-FILLER-12    05600099
045700               VN006-FILLER-13 VN006-FILLER-14 VN006-FILLER-15    05610099
045800               VN006-FILLER-16 VN006-FILLER-17 VN006-FILLER-18    05620099
045900               VN006-FILLER-19 VN006-FILLER-20 VN006-FILLER-21    05630099
046000               VN006-FILLER-22 VN006-FILLER-23 VN006-FILLER-24    05640099
046100               VN006-FILLER-25 VN006-FILLER-26 VN006-FILLER-27    05650099
046200               VN006-FILLER-28 VN006-FILLER-29 VN006-FILLER-35.   05660099
046300*    MOVE SPACE TO VN006-FILLER-35.                               05670099
046400                                                                  05680099
046500     MOVE MDSEAR-GMA-NBR          TO VN006-GMA-NBR.               05690099
046600     MOVE MDSEAR-DMA-NBR          TO VN006-DMA-NBR.               05700099
046700     MOVE MDSEAR-BYR-NBR          TO VN006-BYR-NBR.               05710099
046800     MOVE ENTNME-ENT-NAME-DESC    TO VN006-ENT-NAME-DESC.         05720099
046900     INSPECT VN006-ENT-NAME-DESC  REPLACING ALL ',' BY ' '.       05730099
047000     MOVE EXTENT-ENT-ID           TO PV-ENT-ID-UNPK.              05740099
047100     MOVE PV-ENT-ID-UNPK          TO VN006-ENT-ID.                05750099
047200     MOVE EXTENT-STATUS-CDE       TO VN006-STATUS-CDE.            05760099
047300     MOVE EXTENT-DUN-NBR          TO VN006-DUN-NBR.               05770099
047400     MOVE VNDDPT-DEPT-NBR         TO VN006-DEPT-NBR.              05780099
047500     MOVE VNDDPT-VND-DEPT-STAT-CD TO VN006-VND-DEPT-STAT-CD.      05790099
047600     MOVE MDSEAR-DESC             TO VN006-DESC.                  05800099
047700     INSPECT VN006-DESC           REPLACING ALL ',' BY ' '.       05810099
047800                                                                  05820099
047900     IF PV-CRE-DATE >= DTATTR-FSCL-WK-BEG-DTE AND                 05830099
048000                    <= DTATTR-FSCL-WK-END-DTE                     05840099
048100        SET VN006-NEW-VNDR-ADD     TO TRUE                        05850099
048200     ELSE                                                         05860099
048300        SET VN006-NOT-NEW-VNDR-ADD TO TRUE                        05870099
048400     END-IF.                                                      05880099
048500     IF VNDDPT-CRE-DTE >= DTATTR-FSCL-WK-BEG-DTE AND              05890099
048600                       <= DTATTR-FSCL-WK-END-DTE                  05900099
048700        SET VN006-NEW-DEPT-ADD     TO TRUE                        05910099
048800     ELSE                                                         05920099
048900        SET VN006-NOT-NEW-DEPT-ADD TO TRUE                        05930099
049000     END-IF.                                                      05940099
049100                                                                  05950099
049200     PERFORM S200-SELECT-YTD-GRO-RCPT-COST.                       05960099
049300     PERFORM S300-SELECT-GMM-NAME.                                05970099
049400     PERFORM S400-SELECT-DMM-NAME.                                05980099
049500     PERFORM S450-SELECT-BYR-NAME.                                05990099
049600     PERFORM S500-SELECT-PAYMENT-TERMS.                           06000099
049700     PERFORM S600-SELECT-DISCOUNTS.                               06010099
049800     PERFORM S700-SELECT-OFF-INVOICE-DATA.                        06020099
049900     PERFORM S800-SELECT-LATE-SHIP-PCT.                           06030099
049910                                                                  06040099
049920     MOVE VN006-NEW-STR-DAYS-QTY  TO PV-NEW-STR-DAYS-QTY.         06050099
049930     MOVE VN006-NEW-DISCOUNT-PCT  TO PV-NEW-DISCOUNT-PCT.         06060099
049940     MOVE VN006-MOS-DISCOUNT-PCT  TO PV-MOS-DISCOUNT-PCT.         06070099
049950     MOVE VN006-TRD-DISCOUNT-PCT  TO PV-TRD-DISCOUNT-PCT.         06080099
049960     MOVE VN006-BRD-DISCOUNT-PCT  TO PV-BRD-DISCOUNT-PCT.         06090099
049970     MOVE VN006-COOP-DISCOUNT-PCT TO PV-COOP-DISCOUNT-PCT.        06100099
049980     MOVE VN006-PRFT-DISCOUNT-PCT TO PV-PRFT-DISCOUNT-PCT.        06110099
050000                                                                  06120099
050100     WRITE EXTRACT-RECORD FROM VN006-VENDOR-REPORT-REC.           06130099
050200     ADD 1 TO OUTPUT-COUNT.                                       06140099
050300     INITIALIZE VN006-REPT-AREA.                                  06150099
050400                                                                  06160099
050410***************************************************************** 06170099
050420*  MOVE THE MDS VENDOR DATA TO THE EXTRACT RECORD.  WRITE OUT     06180099
050430*  THE EXTRACT RECORD.                                            06190099
050440***************************************************************** 06200099
050450 M200-MOVE-MDS-VENDOR-DATA.                                       06210099
050460                                                                  06220099
050470     MOVE 'M200-MOVE-MDS-VENDOR-DATA' TO PV-CURRENT-PARAGRAPH.    06230099
050480                                                                  06240099
050490     MOVE ','  TO VN007-FILLER-1 VN007-FILLER-2 VN007-FILLER-3    06250099
050491                  VN007-FILLER-4 VN007-FILLER-5 VN007-FILLER-6    06260099
050492                  VN007-FILLER-7 VN007-FILLER-8 VN007-FILLER-9    06270099
050493                  VN007-FILLER-10 VN007-FILLER-11 VN007-FILLER-12 06280099
050494                  VN007-FILLER-13 VN007-FILLER-14 VN007-FILLER-15 06290099
050495                  VN007-FILLER-16 VN007-FILLER-17                 06300099
050502                                                                  06310099
050505     MOVE ENTNME-ENT-NAME-DESC    TO VN007-ENT-NAME-DESC.         06320099
050506     INSPECT VN007-ENT-NAME-DESC  REPLACING ALL ',' BY ' '.       06330099
050508     MOVE EXTENT-DUN-NBR          TO VN007-DUN-NBR.               06340099
050511     MOVE VNDDPT-DEPT-NBR         TO VN007-DEPT-NBR.              06350099
050512     MOVE ASC-PAYT-TERM-ID-DESC   TO VN007-PYMNT-TERMS-DESC.      06360099
050513     MOVE PV-NEW-STR-DAYS-QTY     TO VN007-NEW-STR-DAYS-QTY.      06370099
050514     MOVE PV-NEW-DISCOUNT-PCT     TO VN007-NEW-DISCOUNT-PCT.      06380099
050515     MOVE PV-MOS-DISCOUNT-PCT     TO VN007-MOS-DISCOUNT-PCT.      06390099
050516     MOVE PV-TRD-DISCOUNT-PCT     TO VN007-TRD-DISCOUNT-PCT.      06400099
050517     MOVE PV-BRD-DISCOUNT-PCT     TO VN007-BRD-DISCOUNT-PCT.      06410099
050518     MOVE PV-COOP-DISCOUNT-PCT    TO VN007-COOP-DISCOUNT-PCT.     06420099
050519     MOVE PV-PRFT-DISCOUNT-PCT    TO VN007-PRFT-DISCOUNT-PCT.     06430099
050520     MOVE PV-RATE-HNDLG-FEE       TO VN007-RATE-HNDLG-FEE.        06440099
050521     MOVE PV-CHRG-PCT-IND         TO VN007-CHRG-PCT-IND.          06450099
050530     MOVE PV-RTV-RA-REQD-IND      TO VN007-RTV-RA-REQD-IND.       06460099
050531     MOVE PV-RTV-NO-RA-REQD-IND   TO VN007-RTV-NO-RA-REQD-IND.    06470099
050532     MOVE PV-DEBIT-DESTROY-IND    TO VN007-DEBIT-DESTROY-IND.     06480099
050533     MOVE PV-MARKOUT-IND          TO VN007-MARKOUT-IND.           06490099
050534     MOVE PV-VND-AUTH-ID          TO VN007-VND-AUTH-ID.           06500099
050537                                                                  06510099
050538     WRITE MERCH-VNDR-RECORD FROM VN007-VENDOR-REPORT-REC.        06520099
050539     ADD 1 TO MERCH-VNDR-COUNT.                                   06530099
050540     INITIALIZE VN007-REPT-AREA.                                  06540099
050541                                                                  06550099
050550******************************************************************06560099
050600*  RETRIEVES THE VENDOR DATA FROM VENDOR LEGACY SYSTEM.           06570099
050700******************************************************************06580099
050800 R100-FETCH-VENDOR-DATA.                                          06590099
050900                                                                  06600099
051000     MOVE 'R100-FETCH-VENDOR-DATA' TO PV-CURRENT-PARAGRAPH.       06610099
051100                                                                  06620099
051200     EXEC SQL                                                     06630099
051300         FETCH VENDOR_DATA_CSR                                    06640099
051400         INTO :MDSEAR-GMA-NBR                                     06650099
051500             ,:MDSEAR-DMA-NBR                                     06660099
051600             ,:MDSEAR-BYR-NBR                                     06670099
051700             ,:VNDDPT-VND-DEPT-STAT-CD                            06680099
051800             ,:ENTNME-ENT-NAME-DESC                               06690099
051900             ,:EXTENT-ENT-ID                                      06700099
052000             ,:EXTENT-DUN-NBR                                     06710099
052100             ,:EXTENT-STATUS-CDE                                  06720099
052200             ,:PV-CRE-DATE                                        06730099
052300             ,:VNDDPT-DEPT-NBR                                    06740099
052400             ,:VNDDPT-CRE-DTE                                     06750099
052500             ,:MDSEAR-DESC                                        06760099
052600     END-EXEC.                                                    06770099
052700                                                                  06780099
052800     EVALUATE TRUE                                                06790099
052900         WHEN SQLCODE = ZERO                                      06800099
053000              ADD 1 TO INPUT-COUNT                                06810099
053100                                                                  06820099
053200         WHEN SQLCODE = +100                                      06830099
053300              SET NO-MORE-DATA TO TRUE                            06840099
053400                                                                  06850099
053500         WHEN SQLWARN0 NOT = SPACES                               06860099
053600         WHEN SQLCODE  NOT = ZERO                                 06870099
053700             MOVE 'R100-FETCH-VENDOR-DATA'                        06880099
053800                                           TO AA-PARAGRAPH-NAME   06890099
053900             MOVE 'UNSUCCESSFUL FETCH WITH VENDOR_DATA_CSR'       06900099
054000                                           TO AA-DB2-OPERATION    06910099
054100             MOVE 'TVNDDPT'                TO AA-DB2-TABLE-1      06920099
054200             MOVE 'TMDSEAR'                TO AA-DB2-TABLE-2      06930099
054300             MOVE 'TEXTENT'                TO AA-DB2-TABLE-3      06940099
054400             MOVE 'TENTNME'                TO AA-DB2-TABLE-4      06950099
054500             PERFORM Z998-DB2-ABEND                               06960099
054600     END-EVALUATE.                                                06970099
054700                                                                  06980099
054800******************************************************************06990099
054900*  RETRIEVES THE DISCOUNTS FOR THE VENDOR/DEPT BEING PROCESSED.   07000099
055000******************************************************************07010099
055100 R200-FETCH-DISCOUNT-CSR.                                         07020099
055200                                                                  07030099
055300     MOVE 'R200-FETCH-DISCOUNT-CSR' TO PV-CURRENT-PARAGRAPH.      07040099
055400                                                                  07050099
055500     EXEC SQL                                                     07060099
055600      FETCH  DISCOUNT_CSR                                         07070099
055700       INTO :VNDAGR-TYP-CDE                                       07080099
055800           ,:VNDAGR-DISCOUNT-PCT                                  07090099
055900              :DN-DISCOUNT-PCT                                    07100099
056000           ,:VNDAGR-EXT-PAY-DAYS-QTY                              07110099
056100              :DN-EXT-PAY-DAYS-QTY                                07120099
056200     END-EXEC.                                                    07130099
056300                                                                  07140099
056400     EVALUATE TRUE                                                07150099
056500         WHEN SQLCODE = ZERO                                      07160099
056600             CONTINUE                                             07170099
056700                                                                  07180099
056800         WHEN SQLCODE = +100                                      07190099
056900             SET PS-EOF-INCENT-CSR      TO TRUE                   07200099
057000                                                                  07210099
057100         WHEN SQLWARN0 NOT = SPACES                               07220099
057200         WHEN SQLCODE  NOT = ZERO                                 07230099
057300             MOVE 'R200-FETCH-DISCOUNT-CSR      '                 07240099
057400                                           TO AA-PARAGRAPH-NAME   07250099
057500             MOVE 'UNSUCCESSFUL FETCH OF DISCOUNT_CSR         '   07260099
057600                                           TO AA-DB2-OPERATION    07270099
057700             MOVE 'TVNDAGR'                TO AA-DB2-TABLE-1      07280099
057800             MOVE 'TINCTYP'                TO AA-DB2-TABLE-2      07290099
057900             MOVE '       '                TO AA-DB2-TABLE-3      07300099
058000             MOVE '       '                TO AA-DB2-TABLE-4      07310099
058100             PERFORM Z998-DB2-ABEND                               07320099
058200     END-EVALUATE.                                                07330099
058300                                                                  07340099
058400******************************************************************07350099
058500*  RETRIEVES THE OFF INVOICE DATA FOR THE VENDOR/DEPT BEING       07360099
058600*  PROCESSED.                                                     07370099
058700******************************************************************07380099
058800 R300-FETCH-OFFINVCE-CSR.                                         07390099
058900                                                                  07400099
059000     MOVE 'R300-FETCH-OFFINVCE-CSR' TO PV-CURRENT-PARAGRAPH.      07410099
059100                                                                  07420099
059200     EXEC SQL                                                     07430099
059300      FETCH  OFFINVCE_CSR                                         07440099
059400       INTO  :VNDAGR-AP-TRN-CDE                                   07450099
059500           , :VNDAGR-DISCOUNT-PCT                                 07460099
059600           , :VNDAGR-PSTG-FRQ-CDE                                 07470099
059700           , :VNDAGR-DED-DISC-IND                                 07480099
059800           , :VNDAGR-DED-RTV-IND                                  07490099
059900     END-EXEC.                                                    07500099
060000                                                                  07510099
060100     EVALUATE TRUE                                                07520099
060200         WHEN SQLCODE = ZERO                                      07530099
060300             CONTINUE                                             07540099
060400                                                                  07550099
060500         WHEN SQLCODE = +100                                      07560099
060600             SET PS-EOF-OFFINVCE-CSR    TO TRUE                   07570099
060700                                                                  07580099
060800         WHEN SQLWARN0 NOT = SPACES                               07590099
060900         WHEN SQLCODE  NOT = ZERO                                 07600099
061000             MOVE 'R300-FETCH-OFFINVCE-CSR      '                 07610099
061100                                           TO AA-PARAGRAPH-NAME   07620099
061200             MOVE 'UNSUCCESSFUL FETCH OF OFFINVCE_CSR         '   07630099
061300                                           TO AA-DB2-OPERATION    07640099
061400             MOVE 'TVNDAGR'                TO AA-DB2-TABLE-1      07650099
061500             MOVE 'TTRNCDE'                TO AA-DB2-TABLE-2      07660099
061600             MOVE '       '                TO AA-DB2-TABLE-3      07670099
061700             MOVE '       '                TO AA-DB2-TABLE-4      07680099
061800             PERFORM Z998-DB2-ABEND                               07690099
061900     END-EVALUATE.                                                07700099
062000                                                                  07710099
062100******************************************************************07720099
062200*  SELECTS THE FISCAL WEEK AND YTD BEGIN AND END DATES FROM THE   07730099
062300*  TDTATTR TABLE.                                                 07740099
062400******************************************************************07750099
062500 S100-SELECT-BGN-END-DATES.                                       07760099
062600                                                                  07770099
062700     MOVE 'S100-SELECT-BGN-END-DATES' TO PV-CURRENT-PARAGRAPH.    07780099
062800                                                                  07790099
062900     EXEC SQL                                                     07800099
063000         SELECT B.FSCL_YR_BEG_DTE                                 07810099
063100              , B.FSCL_YR_END_DTE                                 07820099
063200              , B.FSCL_WK_BEG_DTE                                 07830099
063300              , B.FSCL_WK_END_DTE                                 07840099
063400           INTO :DTATTR-FSCL-YR-BEG-DTE                           07850099
063500              , :DTATTR-FSCL-YR-END-DTE                           07860099
063600              , :DTATTR-FSCL-WK-BEG-DTE                           07870099
063700              , :DTATTR-FSCL-WK-END-DTE                           07880099
063800           FROM TDTATTR  B                                        07890099
063910          WHERE B.KY_DTE          = :PV-CURRENT-DT                07900099
064000     END-EXEC.                                                    07910099
064100                                                                  07920099
064200     EVALUATE TRUE                                                07930099
064300         WHEN SQLCODE = ZERO                                      07940099
064400            DISPLAY 'DTATTR-FSCL-YR-BEG-DTE= '                    07950099
064500                     DTATTR-FSCL-YR-BEG-DTE                       07960099
064600            DISPLAY 'DTATTR-FSCL-YR-END-DTE= '                    07970099
064700                     DTATTR-FSCL-YR-END-DTE                       07980099
064800            DISPLAY 'DTATTR-FSCL-WK-BEG-DTE= '                    07990099
064900                     DTATTR-FSCL-WK-BEG-DTE                       08000099
065000            DISPLAY 'DTATTR-FSCL-WK-END-DTE= '                    08010099
065100                     DTATTR-FSCL-WK-END-DTE                       08020099
065200                                                                  08030099
065300         WHEN SQLCODE = +100                                      08040099
065400         WHEN SQLWARN0 NOT = SPACES                               08050099
065500         WHEN SQLCODE  NOT = ZERO                                 08060099
065600             MOVE 'S100-SELECT-BGN-END-DATES'                     08070099
065700                                           TO AA-PARAGRAPH-NAME   08080099
065800             MOVE 'UNSUCCESSFUL SELECT OF FISCAL BEG/END DATES'   08090099
065900                                           TO AA-DB2-OPERATION    08100099
066000             MOVE 'TDTATTR'                TO AA-DB2-TABLE-1      08110099
066100             MOVE '       '                TO AA-DB2-TABLE-2      08120099
066200             MOVE '       '                TO AA-DB2-TABLE-3      08130099
066300             MOVE '       '                TO AA-DB2-TABLE-4      08140099
066400             PERFORM Z998-DB2-ABEND                               08150099
066500     END-EVALUATE.                                                08160099
066600                                                                  08170099
066700******************************************************************08180099
066800*  SELECTS THE YTD GROSS RECEIPT COST FROM THE TVADPT TABLE FOR   08190099
066900*  THE VENDOR/DEPT BEING PROCESSED.                               08200099
067000******************************************************************08210099
067100 S200-SELECT-YTD-GRO-RCPT-COST.                                   08220099
067200                                                                  08230099
067300     MOVE 'S200-SELECT-YTD-GRO-RCPT-COST' TO PV-CURRENT-PARAGRAPH.08240099
067400                                                                  08250099
067500     EXEC SQL                                                     08260099
067600      SELECT SUM(VA.RCPT_GRO_COST_AMT)                            08270099
067700       INTO :PV-RCPT-GRO-COST-AMT                                 08280099
067800        FROM TVADPT VA                                            08290099
067900       WHERE VA.ENT_ID   = :EXTENT-ENT-ID                         08300099
068000         AND VA.DEPT_NBR = :VNDDPT-DEPT-NBR                       08310099
068100         AND VA.FSCL_MN_END_DTE BETWEEN :DTATTR-FSCL-YR-BEG-DTE   08320099
068200                                    AND :DTATTR-FSCL-YR-END-DTE   08330099
068300     END-EXEC.                                                    08340099
068400                                                                  08350099
068500     EVALUATE TRUE                                                08360099
068600         WHEN SQLCODE = ZERO                                      08370099
068700              MOVE PV-RCPT-GRO-COST-AMT TO                        08380099
068800                   VN006-RCPT-GRO-COST-AMT                        08390099
068900                                                                  08400099
069000         WHEN SQLCODE = +100                                      08410099
069100         WHEN SQLCODE = -305                                      08420099
069200              MOVE ZERO TO VN006-RCPT-GRO-COST-AMT                08430099
069300                                                                  08440099
069400         WHEN SQLWARN0 NOT = SPACES                               08450099
069500         WHEN SQLCODE  NOT = ZERO                                 08460099
069600             MOVE 'S200-SELECT-YTD-GRO-RCPT-COST'                 08470099
069700                                           TO AA-PARAGRAPH-NAME   08480099
069800             MOVE 'UNSUCCESSFUL SELECT OF YTD GROSS RCPT COST '   08490099
069900                                           TO AA-DB2-OPERATION    08500099
070000             MOVE 'TVADPT '                TO AA-DB2-TABLE-1      08510099
070100             MOVE '       '                TO AA-DB2-TABLE-2      08520099
070200             MOVE '       '                TO AA-DB2-TABLE-3      08530099
070300             MOVE '       '                TO AA-DB2-TABLE-4      08540099
070400             PERFORM Z998-DB2-ABEND                               08550099
070500     END-EVALUATE.                                                08560099
070600                                                                  08570099
070700******************************************************************08580099
070800*  SELECTS THE GMM NAME FROM THE TRSPBAR TABLE.                   08590099
070900******************************************************************08600099
071000 S300-SELECT-GMM-NAME.                                            08610099
071100                                                                  08620099
071200     MOVE 'S300-SELECT-GMM-NAME         ' TO PV-CURRENT-PARAGRAPH.08630099
071300                                                                  08640099
071400     EXEC SQL                                                     08650099
071500       SELECT B.WORKER_FIR_NAME                                   08660099
071600            , B.WORKER_LAST_NAME                                  08670099
071700         INTO :VN006-GMM-WORKER-FIR-NAME                          08680099
071800            , :VN006-GMM-WORKER-LAST-NAME                         08690099
071900         FROM TMDSEAR A                                           08700099
072000            , TRSPBAR B                                           08710099
072100         WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                      08720099
072200           AND A.GMA_NBR     = :MDSEAR-GMA-NBR                    08730099
072300           AND A.MDSELV_CDE  = 'GMA'                              08740099
072400           AND B.RSPLVL_CDE  = 'GMM'                              08750099
072500           AND A.OPERCO_NBR  = '03'                               08760099
072810           AND CURRENT DATE  BETWEEN A.STRT_DTE AND A.END_DTE     08770099
072820           AND CURRENT DATE  BETWEEN B.WORKER_STRT_DTE            08780099
072830                                 AND B.WORKER_END_DTE             08790099
072900     END-EXEC.                                                    08800099
073000                                                                  08810099
073100     EVALUATE TRUE                                                08820099
073200         WHEN SQLCODE = ZERO                                      08830099
073300              IF VN006-GMM-WORKER-LAST-NAME = 'MISCELLANEOUS'     08840099
073400                 MOVE 'MISC         ' TO VN006-GMM-WORKER-FIR-NAME08850099
073500              END-IF                                              08860099
073600                                                                  08870099
073700         WHEN SQLCODE = +100                                      08880099
073800              MOVE SPACE TO VN006-GMM-WORKER-FIR-NAME             08890099
073900                            VN006-GMM-WORKER-LAST-NAME            08900099
074000                                                                  08910099
074100         WHEN SQLWARN0 NOT = SPACES                               08920099
074200         WHEN SQLCODE  NOT = ZERO                                 08930099
074300             MOVE 'S300-SELECT-GMM-NAME         '                 08940099
074400                                           TO AA-PARAGRAPH-NAME   08950099
074500             MOVE 'UNSUCCESSFUL SELECT OF GMM NAME            '   08960099
074600                                           TO AA-DB2-OPERATION    08970099
074700             MOVE 'TMDSEAR'                TO AA-DB2-TABLE-1      08980099
074800             MOVE 'TRSPBAR'                TO AA-DB2-TABLE-2      08990099
074900             MOVE '       '                TO AA-DB2-TABLE-3      09000099
075000             MOVE '       '                TO AA-DB2-TABLE-4      09010099
075100             PERFORM Z998-DB2-ABEND                               09020099
075200     END-EVALUATE.                                                09030099
075300                                                                  09040099
075400******************************************************************09050099
075500*  SELECTS THE DMM NAME FROM THE TRSPBAR TABLE.                   09060099
075600******************************************************************09070099
075700 S400-SELECT-DMM-NAME.                                            09080099
075800                                                                  09090099
075900     MOVE 'S400-SELECT-DMM-NAME         ' TO PV-CURRENT-PARAGRAPH.09100099
076000                                                                  09110099
076100     EXEC SQL                                                     09120099
076200       SELECT B.WORKER_FIR_NAME                                   09130099
076300            , B.WORKER_LAST_NAME                                  09140099
076400         INTO :VN006-DMM-WORKER-FIR-NAME                          09150099
076500            , :VN006-DMM-WORKER-LAST-NAME                         09160099
076600         FROM TMDSEAR A                                           09170099
076700            , TRSPBAR B                                           09180099
076800         WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                      09190099
076900           AND A.DMA_NBR     = :MDSEAR-DMA-NBR                    09200099
077000           AND B.RSPLVL_CDE  = 'DMM'                              09210099
077100           AND A.OPERCO_NBR  = '03'                               09220099
077410           AND CURRENT DATE  BETWEEN A.STRT_DTE AND A.END_DTE     09230099
077420           AND CURRENT DATE  BETWEEN B.WORKER_STRT_DTE            09240099
077430                                 AND B.WORKER_END_DTE             09250099
                 FETCH FIRST 1 ROW ONLY                                 09251099
077500     END-EXEC.                                                    09260099
077600                                                                  09270099
077700     EVALUATE TRUE                                                09280099
077800         WHEN SQLCODE = ZERO                                      09290099
077900              IF VN006-DMM-WORKER-LAST-NAME = 'MISCELLANEOUS'     09300099
078000                 MOVE 'MISC         ' TO VN006-DMM-WORKER-FIR-NAME09310099
078100              END-IF                                              09320099
078200                                                                  09330099
078300         WHEN SQLCODE = +100                                      09340099
078400              MOVE SPACE TO VN006-DMM-WORKER-FIR-NAME             09350099
078500                            VN006-DMM-WORKER-LAST-NAME            09360099
078600                                                                  09370099
078700         WHEN SQLWARN0 NOT = SPACES                               09380099
078800         WHEN SQLCODE  NOT = ZERO                                 09390099
078900             MOVE 'S400-SELECT-DMM-NAME         '                 09400099
079000                                           TO AA-PARAGRAPH-NAME   09410099
079100             MOVE 'UNSUCCESSFUL SELECT OF DMM NAME            '   09420099
079200                                           TO AA-DB2-OPERATION    09430099
079300             MOVE 'TMDSEAR'                TO AA-DB2-TABLE-1      09440099
079400             MOVE 'TRSPBAR'                TO AA-DB2-TABLE-2      09450099
079500             MOVE '       '                TO AA-DB2-TABLE-3      09460099
079600             MOVE '       '                TO AA-DB2-TABLE-4      09470099
079700             PERFORM Z998-DB2-ABEND                               09480099
079800     END-EVALUATE.                                                09490099
079900                                                                  09500099
080000******************************************************************09510099
080100*  SELECTS THE BYR NAME FROM THE TRSPBAR TABLE.                   09520099
080200******************************************************************09530099
080300 S450-SELECT-BYR-NAME.                                            09540099
080400                                                                  09550099
080500     MOVE 'S450-SELECT-BYR-NAME         ' TO PV-CURRENT-PARAGRAPH.09560099
080600                                                                  09570099
080700     EXEC SQL                                                     09580099
080800       SELECT B.WORKER_FIR_NAME                                   09590099
080900            , B.WORKER_LAST_NAME                                  09600099
081000         INTO :VN006-BYR-WORKER-FIR-NAME                          09610099
081100            , :VN006-BYR-WORKER-LAST-NAME                         09620099
081200         FROM TMDSEAR A                                           09630099
081300            , TRSPBAR B                                           09640099
081400         WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                      09650099
081500           AND A.DMA_NBR     = :MDSEAR-DMA-NBR                    09660099
081600           AND A.BYR_NBR     = :MDSEAR-BYR-NBR                    09670099
081700           AND A.DEPT_NBR    = :VNDDPT-DEPT-NBR                   09680099
081800           AND B.RSPLVL_CDE  = 'BYR'                              09690099
081900           AND A.OPERCO_NBR  = '03'                               09700099
082210           AND CURRENT DATE  BETWEEN A.STRT_DTE AND A.END_DTE     09710099
082220           AND CURRENT DATE  BETWEEN B.WORKER_STRT_DTE            09720099
082230                                 AND B.WORKER_END_DTE             09730099
                 FETCH FIRST 1 ROW ONLY                                 09731099
082300     END-EXEC.                                                    09740099
082400                                                                  09750099
082500     EVALUATE TRUE                                                09760099
082600         WHEN SQLCODE = ZERO                                      09770099
082700              IF VN006-BYR-WORKER-LAST-NAME = 'MISCELLANEOUS'     09780099
082800                 MOVE 'MISC         ' TO VN006-BYR-WORKER-FIR-NAME09790099
082900              END-IF                                              09800099
083000                                                                  09810099
083100         WHEN SQLCODE = +100                                      09820099
083200              MOVE SPACE TO VN006-BYR-WORKER-FIR-NAME             09830099
083300                            VN006-BYR-WORKER-LAST-NAME            09840099
083400                                                                  09850099
083500         WHEN SQLWARN0 NOT = SPACES                               09860099
083600         WHEN SQLCODE  NOT = ZERO                                 09870099
083700             MOVE 'S450-SELECT-BYR-NAME         '                 09880099
083800                                           TO AA-PARAGRAPH-NAME   09890099
083900             MOVE 'UNSUCCESSFUL SELECT OF BYR NAME            '   09900099
084000                                           TO AA-DB2-OPERATION    09910099
084100             MOVE 'TMDSEAR'                TO AA-DB2-TABLE-1      09920099
084200             MOVE 'TRSPBAR'                TO AA-DB2-TABLE-2      09930099
084300             MOVE '       '                TO AA-DB2-TABLE-3      09940099
084400             MOVE '       '                TO AA-DB2-TABLE-4      09950099
084500             PERFORM Z998-DB2-ABEND                               09960099
084600     END-EVALUATE.                                                09970099
084700                                                                  09980099
084800******************************************************************09990099
084900*  SELECTS THE PAYMENT TERMS FROM THE TPAYTRM TABLE.              10000099
085000******************************************************************10010099
085100 S500-SELECT-PAYMENT-TERMS.                                       10020099
085200                                                                  10030099
085300     MOVE 'S500-SELECT-PAYMENT-TERMS    ' TO PV-CURRENT-PARAGRAPH.10040099
085400                                                                  10050099
085500     EXEC SQL                                                     10060099
085600      SELECT B.PAY_TERM_ID                                        10070099
085700            ,B.DISCOUNT_DAYS_QTY                                  10080099
085800            ,B.DISCOUNT_PCT                                       10090099
085900            ,B.DUE_DAY_QTY                                        10100099
086000            ,B.DUE_DAY_FR_DTE_TXT                                 10110099
086100            ,B.OTHER_TXT                                          10120099
086200       INTO  :PAYTRM-PAY-TERM-ID                                  10130099
086300            ,:PAYTRM-DISCOUNT-DAYS-QTY                            10140099
086400            ,:PAYTRM-DISCOUNT-PCT                                 10150099
086500            ,:PAYTRM-DUE-DAY-QTY                                  10160099
086600            ,:PAYTRM-DUE-DAY-FR-DTE-TXT                           10170099
086700            ,:PAYTRM-OTHER-TXT                                    10180099
086800       FROM TVNDAGR A                                             10190099
086900           ,TPAYTRM B                                             10200099
087000      WHERE A.PAYT_TERM_ID     = B.PAY_TERM_ID                    10210099
087100        AND A.ENT_ID           = :EXTENT-ENT-ID                   10220099
087200        AND A.DEPT_NBR         = :VNDDPT-DEPT-NBR                 10230099
087300        AND A.AGRMT_TYP_ID     = '2'                              10240099
087510        AND A.EFFECTIVE_DATE  <= CURRENT DATE                     10250099
087520        AND A.EXPIRATION_DATE >  CURRENT DATE                     10260099
087600        AND A.SEQ_NBR =                                           10270099
087700                  (SELECT MAX(X.SEQ_NBR)                          10280099
087800                     FROM TVNDAGR X                               10290099
087900                    WHERE X.ENT_ID          = A.ENT_ID            10300099
088000                      AND X.DEPT_NBR        = A.DEPT_NBR          10310099
088100                      AND X.AGRMT_TYP_ID    = A.AGRMT_TYP_ID)     10320099
088200     END-EXEC.                                                    10330099
088300                                                                  10340099
088400     EVALUATE TRUE                                                10350099
088500         WHEN SQLCODE = ZERO                                      10360099
088600             MOVE SPACE                 TO ASC-PAYT-TERM-ID-DESC  10370099
088700             MOVE PAYTRM-PAY-TERM-ID    TO PV-EDIT-PAYT-TERM-ID   10380099
088800             PERFORM T100-FORMAT-TERMS                            10390099
088900             MOVE ASC-PAYT-TERM-ID-DESC TO VN006-PYMNT-TERMS-DESC 10400099
089000                                                                  10410099
089100         WHEN SQLCODE = +100                                      10420099
089200             MOVE SPACE                 TO VN006-PYMNT-TERMS-DESC 10430099
089300                                                                  10440099
089400         WHEN SQLWARN0 NOT = SPACES                               10450099
089500         WHEN SQLCODE  NOT = ZERO                                 10460099
089600             MOVE 'S500-SELECT-PAYMENT-TERMS    '                 10470099
089700                                           TO AA-PARAGRAPH-NAME   10480099
089800             MOVE 'UNSUCCESSFUL SELECT OF PAYMENT TERMS       '   10490099
089900                                           TO AA-DB2-OPERATION    10500099
090000             MOVE 'TVNDAGR'                TO AA-DB2-TABLE-1      10510099
090100             MOVE 'TPAYTRM'                TO AA-DB2-TABLE-2      10520099
090200             MOVE '       '                TO AA-DB2-TABLE-3      10530099
090300             MOVE '       '                TO AA-DB2-TABLE-4      10540099
090400             PERFORM Z998-DB2-ABEND                               10550099
090500     END-EVALUATE.                                                10560099
090600                                                                  10570099
090700******************************************************************10580099
090800*  SELECTS THE DISCOUNTS FOR THE VENDOR/DEPT NUMBER BEING         10590099
090900*  PROCESSED FROM THE TVNDAGR TABLE.                              10600099
091000******************************************************************10610099
091100 S600-SELECT-DISCOUNTS.                                           10620099
091200                                                                  10630099
091300     MOVE 'S600-SELECT-DISCOUNTS        ' TO PV-CURRENT-PARAGRAPH.10640099
091400                                                                  10650099
091500     MOVE 'N'                        TO PS-EOF-INCENT-CSR-SW.     10660099
091600     PERFORM Y150-OPEN-DISCOUNT-CSR.                              10670099
091700                                                                  10680099
091800     PERFORM R200-FETCH-DISCOUNT-CSR.                             10690099
091900                                                                  10700099
092000     PERFORM UNTIL PS-EOF-INCENT-CSR                              10710099
092100        EVALUATE TRUE                                             10720099
092200           WHEN VNDAGR-TYP-CDE = 1                                10730099
092300             IF DN-DISCOUNT-PCT = -1                              10740099
092400                MOVE ZERO            TO VN006-NEW-DISCOUNT-PCT    10750099
092500             ELSE                                                 10760099
092600                COMPUTE VN006-NEW-DISCOUNT-PCT =                  10770099
092700                        VNDAGR-DISCOUNT-PCT * 100                 10780099
092800             END-IF                                               10790099
092900             IF DN-EXT-PAY-DAYS-QTY = -1                          10800099
093000                MOVE ZERO            TO VN006-NEW-STR-DAYS-QTY    10810099
093100             ELSE                                                 10820099
093200                MOVE VNDAGR-EXT-PAY-DAYS-QTY                      10830099
093300                                     TO VN006-NEW-STR-DAYS-QTY    10840099
093400             END-IF                                               10850099
093500           WHEN VNDAGR-TYP-CDE = 7                                10860099
093600             IF DN-DISCOUNT-PCT = -1                              10870099
093700                MOVE ZERO            TO VN006-MOS-DISCOUNT-PCT    10880099
093800             ELSE                                                 10890099
093900                COMPUTE VN006-MOS-DISCOUNT-PCT =                  10900099
094000                        VNDAGR-DISCOUNT-PCT * 100                 10910099
094100             END-IF                                               10920099
094200           WHEN VNDAGR-TYP-CDE = 8                                10930099
094300             IF DN-DISCOUNT-PCT = -1                              10940099
094400                MOVE ZERO            TO VN006-TRD-DISCOUNT-PCT    10950099
094500             ELSE                                                 10960099
094600                COMPUTE VN006-TRD-DISCOUNT-PCT =                  10970099
094700                        VNDAGR-DISCOUNT-PCT * 100                 10980099
094800             END-IF                                               10990099
094900           WHEN VNDAGR-TYP-CDE = 9                                11000099
095000             IF DN-DISCOUNT-PCT = -1                              11010099
095100                MOVE ZERO            TO VN006-BRD-DISCOUNT-PCT    11020099
095200             ELSE                                                 11030099
095300                COMPUTE VN006-BRD-DISCOUNT-PCT =                  11040099
095400                        VNDAGR-DISCOUNT-PCT * 100                 11050099
095500             END-IF                                               11060099
095600           WHEN VNDAGR-TYP-CDE = 10                               11070099
095700             IF DN-DISCOUNT-PCT = -1                              11080099
095800                MOVE ZERO            TO VN006-COOP-DISCOUNT-PCT   11090099
095900             ELSE                                                 11100099
096000                COMPUTE VN006-COOP-DISCOUNT-PCT =                 11110099
096100                        VNDAGR-DISCOUNT-PCT * 100                 11120099
096200             END-IF                                               11130099
096300           WHEN VNDAGR-TYP-CDE = 11                               11140099
096400             IF DN-DISCOUNT-PCT = -1                              11150099
096500                MOVE ZERO            TO VN006-PRFT-DISCOUNT-PCT   11160099
096600             ELSE                                                 11170099
096700                COMPUTE VN006-PRFT-DISCOUNT-PCT =                 11180099
096800                        VNDAGR-DISCOUNT-PCT * 100                 11190099
096900             END-IF                                               11200099
097000           WHEN VNDAGR-TYP-CDE = 12                               11210099
097100             IF DN-EXT-PAY-DAYS-QTY = -1                          11220099
097200                MOVE ZERO            TO VN006-TBL-TWR-DAYS-QTY    11230099
097300             ELSE                                                 11240099
097400                MOVE VNDAGR-EXT-PAY-DAYS-QTY                      11250099
097500                                     TO VN006-TBL-TWR-DAYS-QTY    11260099
097600             END-IF                                               11270099
097700           WHEN VNDAGR-TYP-CDE = 13                               11280099
097800             IF DN-DISCOUNT-PCT = -1                              11290099
097900                MOVE ZERO            TO VN006-BRDL-DISCOUNT-PCT   11300099
098000             ELSE                                                 11310099
098100                COMPUTE VN006-BRDL-DISCOUNT-PCT =                 11320099
098200                        VNDAGR-DISCOUNT-PCT * 100                 11330099
098300             END-IF                                               11340099
098400           WHEN OTHER                                             11350099
098500             CONTINUE                                             11360099
098600        END-EVALUATE                                              11370099
098700        PERFORM R200-FETCH-DISCOUNT-CSR                           11380099
098800     END-PERFORM.                                                 11390099
098900                                                                  11400099
099000     PERFORM Y250-CLOSE-DISCOUNT-CSR.                             11410099
099100                                                                  11420099
099200******************************************************************11430099
099300*  SELECTS THE OFF INVOICE DATA FOR THE VENDOR/DEPT NUMBER BEING  11440099
099400*  PROCESSED FROM THE TVNDAGR TABLE.                              11450099
099500******************************************************************11460099
099600 S700-SELECT-OFF-INVOICE-DATA.                                    11470099
099700                                                                  11480099
099800     MOVE 'S700-SELECT-OFF-INVOICE-DATA ' TO PV-CURRENT-PARAGRAPH.11490099
099900                                                                  11500099
100000     SET VN006-INDX TO 1.                                         11510099
100100     PERFORM UNTIL VN006-INDX > 4                                 11520099
100200        MOVE SPACE TO  VN006-AP-TRN-CDE   (VN006-INDX)            11530099
100300                       VN006-PSTG-FRQ-CDE (VN006-INDX)            11540099
100400                       VN006-DED-DISC-IND (VN006-INDX)            11550099
100500                       VN006-DED-RTV-IND  (VN006-INDX)            11560099
100600        MOVE +0    TO  VN006-DISCOUNT-PCT (VN006-INDX)            11570099
100700        MOVE ','   TO  VN006-FILLER-30 (VN006-INDX)               11580099
100800                       VN006-FILLER-31 (VN006-INDX)               11590099
100900                       VN006-FILLER-32 (VN006-INDX)               11600099
101000                       VN006-FILLER-33 (VN006-INDX)               11610099
101100                       VN006-FILLER-34 (VN006-INDX)               11620099
101200        SET VN006-INDX UP BY 1                                    11630099
101300     END-PERFORM.                                                 11640099
101400                                                                  11650099
101500     MOVE 'N'                        TO PS-EOF-OFFINVCE-CSR-SW.   11660099
101600     PERFORM Y160-OPEN-OFFINVCE-CSR.                              11670099
101700                                                                  11680099
101800     PERFORM R300-FETCH-OFFINVCE-CSR.                             11690099
101900                                                                  11700099
102000     PERFORM UNTIL PS-EOF-OFFINVCE-CSR                            11710099
102100        EVALUATE VNDAGR-AP-TRN-CDE                                11720099
102200            WHEN 49                                               11730099
102300               MOVE VNDAGR-AP-TRN-CDE   TO                        11740099
102400                               VN006-AP-TRN-CDE  (1)              11750099
102500               COMPUTE VN006-DISCOUNT-PCT(1) =                    11760099
102600                               VNDAGR-DISCOUNT-PCT * 100          11770099
102700               MOVE VNDAGR-PSTG-FRQ-CDE TO                        11780099
102800                               VN006-PSTG-FRQ-CDE(1)              11790099
102900               MOVE VNDAGR-DED-DISC-IND TO                        11800099
103000                               VN006-DED-DISC-IND(1)              11810099
103100               MOVE VNDAGR-DED-RTV-IND  TO                        11820099
103200                               VN006-DED-RTV-IND (1)              11830099
103300            WHEN 88                                               11840099
103400               MOVE VNDAGR-AP-TRN-CDE   TO                        11850099
103500                               VN006-AP-TRN-CDE  (2)              11860099
103600               COMPUTE VN006-DISCOUNT-PCT(2) =                    11870099
103700                               VNDAGR-DISCOUNT-PCT * 100          11880099
103800               MOVE VNDAGR-PSTG-FRQ-CDE TO                        11890099
103900                               VN006-PSTG-FRQ-CDE(2)              11900099
104000               MOVE VNDAGR-DED-DISC-IND TO                        11910099
104100                               VN006-DED-DISC-IND(2)              11920099
104200               MOVE VNDAGR-DED-RTV-IND  TO                        11930099
104300                               VN006-DED-RTV-IND (2)              11940099
104400            WHEN 89                                               11950099
104500               MOVE VNDAGR-AP-TRN-CDE   TO                        11960099
104600                               VN006-AP-TRN-CDE  (3)              11970099
104700               COMPUTE VN006-DISCOUNT-PCT(3) =                    11980099
104800                               VNDAGR-DISCOUNT-PCT * 100          11990099
104900               MOVE VNDAGR-PSTG-FRQ-CDE TO                        12000099
105000                               VN006-PSTG-FRQ-CDE(3)              12010099
105100               MOVE VNDAGR-DED-DISC-IND TO                        12020099
105200                               VN006-DED-DISC-IND(3)              12030099
105300               MOVE VNDAGR-DED-RTV-IND  TO                        12040099
105400                               VN006-DED-RTV-IND (3)              12050099
105500            WHEN 90                                               12060099
105600               EVALUATE VNDAGR-PSTG-FRQ-CDE                       12070099
105700                 WHEN 'IV'                                        12080099
105800                    CONTINUE                                      12090099
105900**                  COMPUTE VN006-COOP-DISCOUNT-PCT =             12100099
106000**                             VNDAGR-DISCOUNT-PCT * 100          12110099
106100*                   MOVE SPACE TO VN006-AP-TRN-CDE  (4)           12120099
106200*                   MOVE +0    TO VN006-DISCOUNT-PCT(4)           12130099
106300*                   MOVE SPACE TO VN006-PSTG-FRQ-CDE(4)           12140099
106400*                   MOVE SPACE TO VN006-DED-DISC-IND(4)           12150099
106500*                   MOVE SPACE TO VN006-DED-RTV-IND (4)           12160099
106600                 WHEN OTHER                                       12170099
106700                    MOVE VNDAGR-AP-TRN-CDE   TO                   12180099
106800                               VN006-AP-TRN-CDE  (4)              12190099
106900                    COMPUTE VN006-DISCOUNT-PCT(4) =               12200099
107000                               VNDAGR-DISCOUNT-PCT * 100          12210099
107100                    MOVE VNDAGR-PSTG-FRQ-CDE TO                   12220099
107200                               VN006-PSTG-FRQ-CDE(4)              12230099
107300                    MOVE VNDAGR-DED-DISC-IND TO                   12240099
107400                               VN006-DED-DISC-IND(4)              12250099
107500                    MOVE VNDAGR-DED-RTV-IND  TO                   12260099
107600                               VN006-DED-RTV-IND (4)              12270099
107700               END-EVALUATE                                       12280099
107800            WHEN OTHER                                            12290099
107900               CONTINUE                                           12300099
108000        END-EVALUATE                                              12310099
108100        PERFORM R300-FETCH-OFFINVCE-CSR                           12320099
108200     END-PERFORM.                                                 12330099
108300                                                                  12340099
108400     PERFORM Y260-CLOSE-OFFINVCE-CSR.                             12350099
108500                                                                  12360099
108600******************************************************************12370099
108700*  SELECTS THE LATE SHIP CHARGE PCT FOR THE VENDOR/DEPARTMENT     12380099
108800*  BEING PROCESSED.                                               12390099
108900******************************************************************12400099
109000 S800-SELECT-LATE-SHIP-PCT.                                       12410099
109100                                                                  12420099
109200     MOVE 'S800-SELECT-LATE-SHIP-PCT    ' TO PV-CURRENT-PARAGRAPH.12430099
109300                                                                  12440099
109400     EXEC SQL                                                     12450099
109500      SELECT COALESCE(A.CHRG_PCT,0)                               12460099
109600       INTO  :VNDAGR-CHRG-PCT                                     12470099
109700       FROM TVNDAGR A                                             12480099
109800      WHERE A.ENT_ID       = :EXTENT-ENT-ID                       12490099
109900        AND A.DEPT_NBR     = :VNDDPT-DEPT-NBR                     12500099
110000        AND A.AGRMT_TYP_ID = '1'                                  12510099
110100        AND A.SEQ_NBR =                                           12520099
110200                  (SELECT MAX(X.SEQ_NBR)                          12530099
110300                     FROM TVNDAGR X                               12540099
110400                    WHERE X.ENT_ID       = A.ENT_ID               12550099
110500                      AND X.DEPT_NBR     = A.DEPT_NBR             12560099
110600                      AND X.AGRMT_TYP_ID = A.AGRMT_TYP_ID)        12570099
110700     END-EXEC.                                                    12580099
110800                                                                  12590099
110900     EVALUATE TRUE                                                12600099
111000         WHEN SQLCODE = ZERO                                      12610099
111100             COMPUTE VN006-LATE-SHIP-CHARGE-PCT =                 12620099
111200                     VNDAGR-CHRG-PCT * 100                        12630099
111300                                                                  12640099
111400         WHEN SQLCODE = +100                                      12650099
111500             MOVE +0          TO VN006-LATE-SHIP-CHARGE-PCT       12660099
111600                                                                  12670099
111700         WHEN SQLWARN0 NOT = SPACES                               12680099
111800         WHEN SQLCODE  NOT = ZERO                                 12690099
111900             MOVE 'S800-SELECT-LAST-SHIP-PCT    '                 12700099
112000                                           TO AA-PARAGRAPH-NAME   12710099
112100             MOVE 'UNSUCCESSFUL SELECT OF LATE SHIP CHARGE PCT'   12720099
112200                                           TO AA-DB2-OPERATION    12730099
112300             MOVE 'TVNDAGR'                TO AA-DB2-TABLE-1      12740099
112400             MOVE '       '                TO AA-DB2-TABLE-2      12750099
112500             MOVE '       '                TO AA-DB2-TABLE-3      12760099
112600             MOVE '       '                TO AA-DB2-TABLE-4      12770099
112700             PERFORM Z998-DB2-ABEND                               12780099
112800     END-EVALUATE.                                                12790099
112900                                                                  12800099
CHG605******************************************************************12810099
CHG605*  SELECT USED TO DETERMINE IF THE VENDOR IS MERCHANDISE VENDOR.  12820099
CHG605******************************************************************12830099
CHG605 S905-SELECT-MDS-VENDOR.                                          12840099
CHG605                                                                  12850099
CHG605     MOVE 'S905-SELECT-MDS-VENDOR       ' TO PV-CURRENT-PARAGRAPH.12860099
CHG605                                                                  12870099
CHG605     EXEC SQL                                                     12880099
CHG605      SELECT E.DUN_NBR  AS VENDOR_ID                              12890099
CHG605            ,E.ENT_ID   AS ENT_ID                                 12900099
CHG605       INTO  :EXTENT-DUN-NBR                                      12910099
CHG605            ,:EXTENT-ENT-ID                                       12920099
CHG605        FROM TEXTENT E                                            12930099
CHG605            ,TENTNME N                                            12940099
CHG605      WHERE E.ENT_ID = :EXTENT-ENT-ID                             12950099
CHG605        AND N.ENT_ID          = E.ENT_ID                          12960099
CHG605        AND E.PRIM_TYP_CDE    = 'M'                               12970099
CHG605        AND N.TYPE_CDE        = '01'                              12980099
CHG605        AND E.STATUS_CDE      = 'A'                               12990099
CHG605     END-EXEC.                                                    13000099
CHG605                                                                  13010099
CHG605     EVALUATE TRUE                                                13020099
CHG605         WHEN SQLCODE = ZERO                                      13030099
CHG605               SET PS-MDS-VENDOR-FOUND     TO TRUE                13040099
CHG605         WHEN SQLCODE = +100                                      13050099
CHG605             SET PS-MDS-VENDOR-NOT-FOUND TO TRUE                  13060099
CHG605                                                                  13070099
CHG605         WHEN OTHER                                               13080099
CHG605             DISPLAY 'VENDOR ID - ' EXTENT-ENT-ID                 13090099
CHG605             MOVE 'S905-SELECT-MDS-VENDOR       '                 13100099
CHG605                                           TO AA-PARAGRAPH-NAME   13110099
CHG605             MOVE 'UNSUCCESSFUL SELECT FROM VNT_VND_CPBL      '   13120099
CHG605                                           TO AA-DB2-OPERATION    13130099
CHG605             MOVE 'VNT_VND_CPBL'           TO AA-DB2-TABLE-1      13140099
CHG605             MOVE SPACES                   TO AA-DB2-TABLE-2      13150099
CHG605                                              AA-DB2-TABLE-3      13160099
CHG605                                              AA-DB2-TABLE-4      13170099
CHG605             PERFORM Z998-DB2-ABEND                               13180099
CHG605     END-EVALUATE.                                                13190099
113040                                                                  13200099
113041******************************************************************13210099
113042*  SELECTS THE RATE OR CHARGE FOR MERCHANDISE VENDORS.            13220099
113043******************************************************************13230099
113044 S910-SELECT-CDS-RATE-CHARGE.                                     13240099
113045                                                                  13250099
113046     MOVE 'S910-SELECT-CDS-RATE-CHARGE  ' TO PV-CURRENT-PARAGRAPH.13260099
113047                                                                  13270099
113048     EXEC SQL                                                     13280099
113049      SELECT A.ENT_ID                                             13290099
113050            ,A.DEPT_NBR                                           13300099
113051            ,A.TYP_CDE                                            13310099
113052            ,A.CHRG_PCT                                           13320099
113053            ,A.CHRG_AMT                                           13330099
113054            ,B.SERVICE_NAME                                       13340099
113055       INTO  :VNDAGR-ENT-ID                                       13350099
113056            ,:VNDAGR-DEPT-NBR                                     13360099
113057            ,:VNDAGR-TYP-CDE                                      13370099
113058            ,:VNDAGR-CHRG-PCT                                     13380099
113059            ,:VNDAGR-CHRG-AMT                                     13390099
113060            ,:SERTYP-SERVICE-NAME                                 13400099
113061       FROM TVNDAGR A                                             13410099
113062           ,TSERTYP B                                             13420099
113063      WHERE A.ENT_ID = :EXTENT-ENT-ID                             13430099
113064        AND A.DEPT_NBR = :VNDDPT-DEPT-NBR                         13440099
113065        AND A.AGRMT_TYP_ID = '4'                                  13450099
113066        AND A.TYP_CDE = 10                                        13460099
113067        AND A.TYP_CDE = B.SERVICE_ID                              13470099
113070        AND CURRENT DATE >= A.EFFECTIVE_DATE                      13480099
113071        AND CURRENT DATE < A.EXPIRATION_DATE                      13490099
113072     END-EXEC.                                                    13500099
113073                                                                  13510099
113074     EVALUATE TRUE                                                13520099
113075         WHEN SQLCODE = ZERO                                      13530099
113076             IF VNDAGR-CHRG-PCT NUMERIC AND                       13540099
113077                VNDAGR-CHRG-PCT > 0                               13550099
113078                 MOVE PC-PCT TO PV-CHRG-PCT-IND                   13560099
113079                 COMPUTE PV-CHRG-PCT = VNDAGR-CHRG-PCT * 100      13570099
113080             ELSE                                                 13580099
113081                 IF VNDAGR-CHRG-AMT NUMERIC AND                   13590099
113082                    VNDAGR-CHRG-AMT > 0                           13600099
113083                     MOVE PC-CHRG TO PV-CHRG-PCT-IND              13610099
113084                     MOVE VNDAGR-CHRG-AMT TO PV-CHRG-AMT          13620099
113085                 ELSE                                             13630099
113086                     MOVE SPACE TO PV-CHRG-PCT-IND                13640099
113087                     MOVE 'NO DATA ' TO PV-RATE-HNDLG-FEE         13650099
113088                 END-IF                                           13660099
113089             END-IF                                               13670099
113090                                                                  13680099
113091         WHEN SQLCODE = +100                                      13690099
113092             MOVE SPACE TO PV-CHRG-PCT-IND                        13700099
113093             MOVE 'NO DATA ' TO PV-RATE-HNDLG-FEE                 13710099
113094                                                                  13720099
113095         WHEN OTHER                                               13730099
113096             DISPLAY 'VENDOR ID - ' EXTENT-ENT-ID                 13740099
113097             MOVE 'S910-SELECT-CDS-RATE-CHARGE  '                 13750099
113098                                           TO AA-PARAGRAPH-NAME   13760099
113099             MOVE 'UNSUCCESSFUL SELECT FOR RATE/CHARGE        '   13770099
113100                                           TO AA-DB2-OPERATION    13780099
113101             MOVE 'TVNDAGR'                TO AA-DB2-TABLE-1      13790099
113102             MOVE 'TSERTYP'                TO AA-DB2-TABLE-2      13800099
113103             MOVE SPACES                   TO AA-DB2-TABLE-3      13810099
113104                                              AA-DB2-TABLE-4      13820099
113105             PERFORM Z998-DB2-ABEND                               13830099
113106     END-EVALUATE.                                                13840099
113107                                                                  13850099
113108******************************************************************13860099
113109*  SELECTS THE PURCHASE TERMS FOR THE VENDOR/DEPARTMENT BEING     13870099
113110*  PROCESSED.                                                     13880099
113111******************************************************************13890099
113112 S920-SELECT-PURCHASE-TERMS.                                      13900099
113113                                                                  13910099
113114     MOVE 'S920-SELECT-PURCHASE-TERMS   ' TO PV-CURRENT-PARAGRAPH.13920099
113115                                                                  13930099
113116     EXEC SQL                                                     13940099
113117      SELECT COALESCE(RTV_RA_REQD_IND,'N')                        13950099
113118            ,COALESCE(RTV_NO_RA_REQD_IND,'N')                     13960099
113119            ,COALESCE(DEBIT_DESTROY_IND,'N')                      13970099
113120            ,COALESCE(MARKOUT_IND,'N')                            13980099
113121            ,COALESCE(VND_AUTH_ID,'          ')                   13990099
113122       INTO  :VNDAGR-RTV-RA-REQD-IND                              14000099
113123            ,:VNDAGR-RTV-NO-RA-REQD-IND                           14010099
113124            ,:VNDAGR-DEBIT-DESTROY-IND                            14020099
113125            ,:VNDAGR-MARKOUT-IND                                  14030099
113126            ,:VNDAGR-VND-AUTH-ID                                  14040099
113127       FROM TVNDAGR A                                             14050099
113128      WHERE A.ENT_ID       = :EXTENT-ENT-ID                       14060099
113129        AND A.DEPT_NBR     = :VNDDPT-DEPT-NBR                     14070099
113130        AND A.AGRMT_TYP_ID = '3'                                  14080099
113131        AND A.SEQ_NBR =                                           14090099
113132                  (SELECT MAX(X.SEQ_NBR)                          14100099
113133                     FROM TVNDAGR X                               14110099
113134                    WHERE X.ENT_ID       = A.ENT_ID               14120099
113135                      AND X.DEPT_NBR     = A.DEPT_NBR             14130099
113136                      AND X.AGRMT_TYP_ID = A.AGRMT_TYP_ID)        14140099
113137     END-EXEC.                                                    14150099
113138                                                                  14160099
113139     EVALUATE TRUE                                                14170099
113140         WHEN SQLCODE = ZERO                                      14180099
113141             MOVE VNDAGR-RTV-RA-REQD-IND   TO PV-RTV-RA-REQD-IND  14190099
113142             MOVE VNDAGR-RTV-NO-RA-REQD-IND TO                    14200099
113143                                            PV-RTV-NO-RA-REQD-IND 14210099
113144             MOVE VNDAGR-DEBIT-DESTROY-IND TO PV-DEBIT-DESTROY-IND14220099
113145             MOVE VNDAGR-MARKOUT-IND       TO PV-MARKOUT-IND      14230099
113146             MOVE VNDAGR-VND-AUTH-ID       TO PV-VND-AUTH-ID      14240099
113147                                                                  14250099
113148         WHEN SQLCODE = +100                                      14260099
113149             MOVE SPACES TO PV-RTV-RA-REQD-IND                    14270099
113150                            PV-RTV-NO-RA-REQD-IND                 14280099
113151                            PV-DEBIT-DESTROY-IND                  14290099
113152                            PV-MARKOUT-IND                        14300099
113153                            PV-VND-AUTH-ID                        14310099
113154                                                                  14320099
113155         WHEN SQLWARN0 NOT = SPACES                               14330099
113156         WHEN SQLCODE  NOT = ZERO                                 14340099
113157             MOVE 'S920-SELECT-PURCHASE-TERMS   '                 14350099
113158                                           TO AA-PARAGRAPH-NAME   14360099
113159             MOVE 'UNSUCCESSFUL SELECT OF PURCHASE TERMS      '   14370099
113160                                           TO AA-DB2-OPERATION    14380099
113161             MOVE 'TVNDAGR'                TO AA-DB2-TABLE-1      14390099
113162             MOVE '       '                TO AA-DB2-TABLE-2      14400099
113163             MOVE '       '                TO AA-DB2-TABLE-3      14410099
113164             MOVE '       '                TO AA-DB2-TABLE-4      14420099
113165             PERFORM Z998-DB2-ABEND                               14430099
113166     END-EVALUATE.                                                14440099
113167                                                                  14450099
113168                                                                  14460099
113169***************************************************************** 14470099
113170*  FORMATS THE PAYMENT TERMS DESCRIPTION.                         14480099
113200***************************************************************** 14490099
113300 T100-FORMAT-TERMS.                                               14500099
113400                                                                  14510099
113500     COPY POPD001.                                                14520099
113600                                                                  14530099
113700***************************************************************** 14540099
113800*  OPENS THE VENDOR_DATA CURSOR.                                  14550099
113900***************************************************************** 14560099
114000 Y100-OPEN-VENDOR-DATA-CSR.                                       14570099
114100                                                                  14580099
114200     MOVE 'Y100-OPEN-VENDOR-DATA-CSR' TO PV-CURRENT-PARAGRAPH.    14590099
114300                                                                  14600099
114400     EXEC SQL                                                     14610099
114500         OPEN VENDOR_DATA_CSR                                     14620099
114600     END-EXEC.                                                    14630099
114700                                                                  14640099
114800     EVALUATE TRUE                                                14650099
114900         WHEN SQLCODE = ZERO                                      14660099
115000              CONTINUE                                            14670099
115100                                                                  14680099
115200         WHEN SQLWARN0 NOT = SPACES                               14690099
115300         WHEN SQLCODE  NOT = ZERO                                 14700099
115400             MOVE 'Y100-OPEN-VENDOR-DATA-CSR'                     14710099
115500                                           TO AA-PARAGRAPH-NAME   14720099
115600             MOVE 'UNSUCCESSFUL OPEN ON VENDOR_DATA_CSR'          14730099
115700                                           TO AA-DB2-OPERATION    14740099
115800             MOVE 'TVNDDPT'                TO AA-DB2-TABLE-1      14750099
115900             MOVE 'TMDSEAR'                TO AA-DB2-TABLE-2      14760099
116000             MOVE 'TEXTENT'                TO AA-DB2-TABLE-3      14770099
116100             MOVE 'TENTNME'                TO AA-DB2-TABLE-4      14780099
116200             PERFORM Z998-DB2-ABEND                               14790099
116300     END-EVALUATE.                                                14800099
116400                                                                  14810099
116500***************************************************************** 14820099
116600*  OPENS THE DISCOUNT CURSOR.                                     14830099
116700***************************************************************** 14840099
116800 Y150-OPEN-DISCOUNT-CSR.                                          14850099
116900                                                                  14860099
117000     MOVE 'Y150-OPEN-DISCOUNT-CSR' TO PV-CURRENT-PARAGRAPH.       14870099
117100                                                                  14880099
117200     EXEC SQL                                                     14890099
117300         OPEN DISCOUNT_CSR                                        14900099
117400     END-EXEC.                                                    14910099
117500                                                                  14920099
117600     EVALUATE TRUE                                                14930099
117700         WHEN SQLCODE = ZERO                                      14940099
117800              CONTINUE                                            14950099
117900                                                                  14960099
118000         WHEN SQLWARN0 NOT = SPACES                               14970099
118100         WHEN SQLCODE  NOT = ZERO                                 14980099
118200             MOVE 'Y150-OPEN-DISCOUNT-CSR'                        14990099
118300                                           TO AA-PARAGRAPH-NAME   15000099
118400             MOVE 'UNSUCCESSFUL OPEN ON DISCOUNT_CSR'             15010099
118500                                           TO AA-DB2-OPERATION    15020099
118600             MOVE 'TVNDAGR'                TO AA-DB2-TABLE-1      15030099
118700             MOVE 'TINCTYP'                TO AA-DB2-TABLE-2      15040099
118800             MOVE '       '                TO AA-DB2-TABLE-3      15050099
118900             MOVE '       '                TO AA-DB2-TABLE-4      15060099
119000             PERFORM Z998-DB2-ABEND                               15070099
119100     END-EVALUATE.                                                15080099
119200                                                                  15090099
119300***************************************************************** 15100099
119400*  OPENS THE OFF INVOICE CURSOR.                                  15110099
119500***************************************************************** 15120099
119600 Y160-OPEN-OFFINVCE-CSR.                                          15130099
119700                                                                  15140099
119800     MOVE 'Y160-OPEN-OFFINVCE-CSR' TO PV-CURRENT-PARAGRAPH.       15150099
119900                                                                  15160099
120000     EXEC SQL                                                     15170099
120100         OPEN OFFINVCE_CSR                                        15180099
120200     END-EXEC.                                                    15190099
120300                                                                  15200099
120400     EVALUATE TRUE                                                15210099
120500         WHEN SQLCODE = ZERO                                      15220099
120600              CONTINUE                                            15230099
120700                                                                  15240099
120800         WHEN SQLWARN0 NOT = SPACES                               15250099
120900         WHEN SQLCODE  NOT = ZERO                                 15260099
121000             MOVE 'Y160-OPEN-OFFINVCE-CSR'                        15270099
121100                                           TO AA-PARAGRAPH-NAME   15280099
121200             MOVE 'UNSUCCESSFUL OPEN ON OFFINVCE_CSR'             15290099
121300                                           TO AA-DB2-OPERATION    15300099
121400             MOVE 'TVNDAGR'                TO AA-DB2-TABLE-1      15310099
121500             MOVE 'TTRNCDE'                TO AA-DB2-TABLE-2      15320099
121600             MOVE '       '                TO AA-DB2-TABLE-3      15330099
121700             MOVE '       '                TO AA-DB2-TABLE-4      15340099
121800             PERFORM Z998-DB2-ABEND                               15350099
121900     END-EVALUATE.                                                15360099
122000                                                                  15370099
122100******************************************************************15380099
122200*  CLOSES THE VENDOR_DATA CURSOR.                                 15390099
122300******************************************************************15400099
122400 Y200-CLOSE-VENDOR-DATA-CSR.                                      15410099
122500                                                                  15420099
122600     MOVE 'Y200-CLOSE-VENDOR-DATA-CSR' TO PV-CURRENT-PARAGRAPH.   15430099
122700                                                                  15440099
122800       EXEC SQL                                                   15450099
122900           CLOSE VENDOR_DATA_CSR                                  15460099
123000       END-EXEC.                                                  15470099
123100                                                                  15480099
123200       EVALUATE TRUE                                              15490099
123300           WHEN SQLCODE = ZERO                                    15500099
123400                CONTINUE                                          15510099
123500                                                                  15520099
123600           WHEN SQLWARN0 NOT = SPACES                             15530099
123700           WHEN SQLCODE  NOT = ZERO                               15540099
123800               MOVE 'Y200-CLOSE-VENDOR-DATA-CSR'                  15550099
123900                                         TO AA-PARAGRAPH-NAME     15560099
124000               MOVE 'UNSUCCESSFUL CLOSE ON VENDOR_DATA_CSR'       15570099
124100                                         TO AA-DB2-OPERATION      15580099
124200               MOVE 'TVNDDPT'            TO AA-DB2-TABLE-1        15590099
124300               MOVE 'TMDSEAR'            TO AA-DB2-TABLE-2        15600099
124400               MOVE 'TEXTENT'            TO AA-DB2-TABLE-3        15610099
124500               MOVE 'TENTNME'            TO AA-DB2-TABLE-4        15620099
124600               PERFORM Z998-DB2-ABEND                             15630099
124700       END-EVALUATE.                                              15640099
124800                                                                  15650099
124900******************************************************************15660099
125000*  CLOSES THE DISCOUNT CURSOR.                                    15670099
125100******************************************************************15680099
125200 Y250-CLOSE-DISCOUNT-CSR.                                         15690099
125300                                                                  15700099
125400     MOVE 'Y250-CLOSE-DISCOUNT-CSR' TO PV-CURRENT-PARAGRAPH.      15710099
125500                                                                  15720099
125600       EXEC SQL                                                   15730099
125700           CLOSE DISCOUNT_CSR                                     15740099
125800       END-EXEC.                                                  15750099
125900                                                                  15760099
126000       EVALUATE TRUE                                              15770099
126100           WHEN SQLCODE = ZERO                                    15780099
126200                CONTINUE                                          15790099
126300                                                                  15800099
126400           WHEN SQLWARN0 NOT = SPACES                             15810099
126500           WHEN SQLCODE  NOT = ZERO                               15820099
126600               MOVE 'Y250-CLOSE-DISCOUNT-CSR'                     15830099
126700                                         TO AA-PARAGRAPH-NAME     15840099
126800               MOVE 'UNSUCCESSFUL CLOSE ON DISCOUNT_CSR'          15850099
126900                                         TO AA-DB2-OPERATION      15860099
127000               MOVE 'TVNDAGR'            TO AA-DB2-TABLE-1        15870099
127100               MOVE 'TINCTYP'            TO AA-DB2-TABLE-2        15880099
127200               MOVE '       '            TO AA-DB2-TABLE-3        15890099
127300               MOVE '       '            TO AA-DB2-TABLE-4        15900099
127400               PERFORM Z998-DB2-ABEND                             15910099
127500       END-EVALUATE.                                              15920099
127600                                                                  15930099
127700******************************************************************15940099
127800*  CLOSES THE OFF INVOICE CURSOR.                                 15950099
127900******************************************************************15960099
128000 Y260-CLOSE-OFFINVCE-CSR.                                         15970099
128100                                                                  15980099
128200     MOVE 'Y260-CLOSE-OFFINVCE-CSR' TO PV-CURRENT-PARAGRAPH.      15990099
128300                                                                  16000099
128400       EXEC SQL                                                   16010099
128500           CLOSE OFFINVCE_CSR                                     16020099
128600       END-EXEC.                                                  16030099
128700                                                                  16040099
128800       EVALUATE TRUE                                              16050099
128900           WHEN SQLCODE = ZERO                                    16060099
129000                CONTINUE                                          16070099
129100                                                                  16080099
129200           WHEN SQLWARN0 NOT = SPACES                             16090099
129300           WHEN SQLCODE  NOT = ZERO                               16100099
129400               MOVE 'Y260-CLOSE-OFFINVCE-CSR'                     16110099
129500                                         TO AA-PARAGRAPH-NAME     16120099
129600               MOVE 'UNSUCCESSFUL CLOSE ON OFFINVCE_CSR'          16130099
129700                                         TO AA-DB2-OPERATION      16140099
129800               MOVE 'TVNDAGR'            TO AA-DB2-TABLE-1        16150099
129900               MOVE 'TTRNCDE'            TO AA-DB2-TABLE-2        16160099
130000               MOVE '       '            TO AA-DB2-TABLE-3        16170099
130100               MOVE '       '            TO AA-DB2-TABLE-4        16180099
130200               PERFORM Z998-DB2-ABEND                             16190099
130300       END-EVALUATE.                                              16200099
130400                                                                  16210099
130500***************************************************************** 16220099
130600*  ABEND ROUTINE FOR DB2 ERRORS                                   16230099
130700***************************************************************** 16240099
130800 Z998-DB2-ABEND.                                                  16250099
130900                                                                  16260099
131000     CLOSE  EXTRACT-FILE                                          16270099
131000            MERCH-VNDR-FILE.                                      16280099
131100                                                                  16290099
131200     DISPLAY AA-ABEND-LIT.                                        16300099
131300     DISPLAY AA-DB2-ERROR-LIT.                                    16310099
131400     DISPLAY AA-PROGRAM-LIT.                                      16320099
131500     DISPLAY AA-PARAGRAPH-LIT.                                    16330099
131600     DISPLAY AA-DB2-OPERATION-LIT.                                16340099
131700     DISPLAY AA-DB2-TABLE-1.                                      16350099
131800     DISPLAY AA-DB2-TABLE-2.                                      16360099
131900     DISPLAY AA-DB2-TABLE-3.                                      16370099
132000     DISPLAY AA-DB2-TABLE-4.                                      16380099
132100     SET AC-DB2-ERROR TO TRUE.                                    16390099
132200                                                                  16400099
132300     COPY DPPD004.                                                16410099
132400                                                                  16420099
132500     CALL 'ILBOABN0' USING ABEND-CODE.                            16430099
