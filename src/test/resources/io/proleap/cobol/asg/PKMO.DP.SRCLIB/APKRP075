000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     APKRP075.                                        00020000
000300 AUTHOR.         ROBIN BERNOSKI.                                  00030000
000400 DATE-WRITTEN.   07/10/1998.                                      00040000
000500 DATE-COMPILED.                                                   00050000
000600*************************************************************     00060000
000700*    COBOL 2 WITH SQL                                       *     00070000
000800*       --- IMPORT ACOUNT ACTIVITY AND BALANCE REPORT---    *     00080000
000900*                                                           *     00090000
001000*    THIS PROGRAM PRODUCES THE WEEKLY IMPORT ACCOUNT        *     00100000
001100*    ACTIVITY AND BALANCE BY PO REPORT.                     *     00110000
001200*                                                           *     00120000
001300*                                                           *     00130000
001400* INPUT:                                                    *     00140000
001600*  1. IMPORT BALANCE TABLE             (TIMPBAL)            *     00160000
001700*  2. AP CONTROL TABLE                 (TAPCNTL)            *     00170000
001800*  3. PURCHASE ORDER TABLE             (TPURCHS)            *     00180000
001900*  4. EXTERNAL ENTITY ID TABLE         (TEXTENT)            *     00190000
002000*  5. EXTERNAL ENTERPRISE NAME         (TENTNME)            *     00200000
002100*                                                           *     00210000
002200* OUTPUT:                                                   *     00220000
002300*  1. IMPORT ACCOUNT ACTIVITY AND BALANCE BY PO REPORT      *     00230000
002400*  2. IMPORT ACCOUNT ACTIVITY EXCEPTION REPORT              *     00240000
002500*                                                           *     00250000
002600*************************************************************     00260000
002700*---------------------------------------------------------------* 00270000
002800*                                                               * 00280000
002900* CHANGE LOG:                                                   * 00290000
003000* 12/08/1999 JILL JUEL                       WR/IR #: WR6041    * 00300000
003100*            - MODIFIED THE CHECK ON THE DATE ROUTINE TO        * 00310000
003200*              CONFORM WITH Y2K STANDARDS BY ADDING             * 00320000
003300*              DPG54-WARNING-ERROR.                             * 00330000
003400*                                                               * 00340000
003500* 07/13/2001 MIKE BESKE                      WR/IR #: WR21973   * 00350000
003600*            - ADDED AN ADDITIONAL WHERE CONDITION TO THE CURSOR* 00360000
003700*              TO NOT INCLUDE GL ACCOUNT NUMBERS 10311 & 20115. * 00370000
003800*                                                               * 00380000
003900* 11/04/2002 CHANGE MADE:                                       * 00390000
004000*            COLBY DATING PROJ  REPLACED TACCTYP WITH PFI00002. * 00400000
004100*            CHANGED BY: MIKE BESKE          WR/IR #: WR23750   * 00410000
004200*                                                               * 00420000
004300*   02/10/2003                                                  * 00430000
004400*      CHANGED CALL TO PEOPLESOFT TABLE TO USE NEW ALIAS        * 00440000
004500*      NAMING STANDARD.                                         * 00450000
004600*   MADE BY: L SCHALLHORN                 WR#: 23417            * 00460000
004700*                                                               * 00470000
004800*   08/31/2004                                                  * 00480000
004900*      INCREASED THE SIZE OF THE BOP, EOP, DEBIT AND CREDIT     * 00490000
005000*      AMOUNT DISPLAY FIELDS ON THE REPORT TO PREVENT TRUNCATION* 00500000
005100*   MADE BY: MIKE BESKE                   IR#: P000686962       * 00510000
005200*                                                               * 00520000
005300*   09/05/2011                                                  * 00530000
005400*      CHANGE MADE: MODIFED AS A PART OF PEOPLESOFT FINANCIALS  * 00540000
005500*      UPGRADE TO VERSION 9.                                    * 00550000
005600*      - CHANGED TO USE INPUT PS_GL_ACCOUNT_TBL EXTRACT INSTEAD * 00560000
005700*        OF DIRECTLY USING THE DATABASE.                        * 00570000
005800*      - DELETED PFI00002 DCLGEN.                               * 00580000
005900*      - ADDED NEW PARAS R200, C300, C400                       * 00590000
005910*      - CHANGES ARE DONE IN PARAS B100-, E100-, S200- AND B300-* 00600000
005912*   MADE BY: GURUNANAK PATIL              WR/IR #: WR37038      * 00610000
005920*                                                               * 00610101
      *   03/04/2019                                                  * 00611008
      *      CHANGE MADE: DELETING THE INP01 FILE UT-S-INP01 GL UNLOAD* 00612005
      *      ACCOUNT FILE AND INTRODUCING THE NEWLY CREATED DB2       * 00612101
      *      ACCOUNT TABLE APT_ACCT_TBL AS PART OF PEOPLESOFT ERP     * 00613008
      *      MIGRATION.                                               * 00614008
      *   MADE BY: COGNIZANT                    WR/IR #: CHG0220043   * 00619007
      *                                                               * 00620001
006000*---------------------------------------------------------------* 00630000
006100   EJECT                                                          00640000
006200 ENVIRONMENT DIVISION.                                            00650000
006300 CONFIGURATION SECTION.                                           00660000
006400 SOURCE-COMPUTER.    IBM-3090.                                    00670000
006500 OBJECT-COMPUTER.    IBM-3090.                                    00680000
006600                                                                  00690000
006700 INPUT-OUTPUT SECTION.                                            00700000
006800 FILE-CONTROL.                                                    00710000
006900                                                                  00720000
007100     SELECT IMPORT-ACCT-RPT-FILE   ASSIGN TO UT-S-RPT01.          00740000
007200     SELECT IMPORT-EXCEPT-RPT-FILE ASSIGN TO UT-S-RPT02.          00750000
007300 EJECT                                                            00760000
007400 DATA DIVISION.                                                   00770000
007500 FILE SECTION.                                                    00780000
007600                                                                  00790000
008500 FD  IMPORT-ACCT-RPT-FILE                                         00880000
008600     RECORDING MODE IS F                                          00890000
008700     LABEL RECORDS ARE STANDARD                                   00900000
008800     BLOCK CONTAINS 0 RECORDS                                     00910000
008900     DATA RECORD IS IMPORT-ACCT-RPT-REC.                          00920000
009000 01  IMPORT-ACCT-RPT-REC.                                         00930000
009100     05  FILLER                           PIC  X(200).            00940000
009200                                                                  00950000
009300 FD  IMPORT-EXCEPT-RPT-FILE                                       00960000
009400     RECORDING MODE IS F                                          00970000
009500     LABEL RECORDS ARE STANDARD                                   00980000
009600     BLOCK CONTAINS 0 RECORDS                                     00990000
009700     DATA RECORD IS IMPORT-EXCEPT-RPT-REC.                        01000000
009800 01  IMPORT-EXCEPT-RPT-REC.                                       01010000
009900     05  FILLER                           PIC  X(132).            01020000
010000 EJECT                                                            01030000
010100 WORKING-STORAGE SECTION.                                         01040000
010200                                                                  01050000
010300 01  PV-PROGRAM-VARIABLES.                                        01060000
010400     05  FILLER                  PIC  X(30)  VALUE                01070000
010500         '** BEGINING OF APKRP075 W/S **'.                        01080000
010600     05  PV-CURRENT-PARAGRAPH    PIC  X(35).                      01090000
010700     05  PV-PROGRAM-NAME         PIC  X(08)  VALUE 'APKRP075'.    01100000
010800     05  PV-CURRENT-DATE.                                         01110000
010900         10  PV-CURRENT-YEAR     PIC  9(02)  VALUE ZEROS.         01120000
011000         10  PV-CURRENT-MONTH    PIC  9(02)  VALUE ZEROS.         01130000
011100         10  PV-CURRENT-DAY      PIC  9(02)  VALUE ZEROS.         01140000
011200     05  PV-NEXT-PERIOD          PIC  9(02)  VALUE ZEROS.         01150000
011300     05  PV-CURRENT-TIME.                                         01160000
011400         10  PV-CURRENT-HOUR     PIC  9(02)  VALUE ZEROS.         01170000
011500         10  PV-CURRENT-MINUTE   PIC  9(02)  VALUE ZEROS.         01180000
011600         10  FILLER              PIC  9(02)  VALUE ZEROS.         01190000
011700     05  PV-HOLD-VARIABLES.                                       01200000
011800         10  PV-HOLD-ACCT-NBR    PIC  X(07)  VALUE SPACES.        01210000
011900         10  PV-HOLD-PO-NBR      PIC  S9(09) VALUE ZEROS          01220000
012000                                                   COMP.          01230000
012100         10  PV-HOLD-BOP-TOT     PIC  S9(09)V99  VALUE ZEROS.     01240000
012200         10  PV-HOLD-DEBIT-TOT   PIC  9(09)V99  VALUE ZEROS.      01250000
012300         10  PV-HOLD-CREDIT-TOT  PIC  9(09)V99  VALUE ZEROS.      01260000
012400         10  PV-HOLD-EOP-TOT     PIC  S9(09)V99  VALUE ZEROS.     01270000
012500         10  PV-HOLD-0-30-TOT    PIC  9(09)V99  VALUE ZEROS.      01280000
012600         10  PV-HOLD-31-60-TOT   PIC  9(09)V99  VALUE ZEROS.      01290000
012700         10  PV-HOLD-61-90-TOT   PIC  9(09)V99  VALUE ZEROS.      01300000
012800         10  PV-HOLD-91-120-TOT  PIC  9(09)V99  VALUE ZEROS.      01310000
012900         10  PV-HOLD-OVR120-TOT  PIC  9(09)V99  VALUE ZEROS.      01320000
013000         10  PV-HOLD-H2-DATE.                                     01330000
013100             15  HOLD-YEAR       PIC  X(04)  VALUE SPACES.        01340000
013200             15  FILLER          PIC  X(01)  VALUE SPACES.        01350000
013300             15  HOLD-MONTH      PIC  X(02)  VALUE SPACES.        01360000
013400             15  FILLER          PIC  X(01)  VALUE SPACES.        01370000
013500             15  HOLD-DAY        PIC  X(02)  VALUE SPACES.        01380000
013600         10  PV-HOLD-OTB.                                         01390000
013700             15  HOLD-OTB-CENT   PIC  X(02)  VALUE SPACES.        01400000
013800             15  HOLD-OTB-YEAR   PIC  X(02)  VALUE SPACES.        01410000
013900     05  PV-GL-ACCT-VARIABLES.                                    01420000
013905         10  PV-GL-ACCT-DESCR    PIC  X(30)  VALUE SPACES.        01450006
013910                                                                  01480000
014000 01  CALENDAR-OTB-PERIOD.                                         01490000
014100     05  CO-OTB-PERIOD           PIC X(06)   VALUE SPACES.        01500000
014200                                                                  01510000
014300 01  PS-PROGRAM-SWITCHES.                                         01520000
014400     05  PS-OUT-OF-IMPORTS-SW    PIC X(01) VALUE 'N'.             01530000
014500         88  OUT-OF-IMPORTS                VALUE 'Y'.             01540000
014600         88  MORE-IMPORTS                  VALUE 'N'.             01550000
014700     05  PS-DATE-SW              PIC X(01) VALUE 'N'.             01560000
014800         88  VALID-DATE                    VALUE 'Y'.             01570000
014900         88  NOT-VALID-DATE                VALUE 'N'.             01580000
015000     05  PS-END-OF-BAL-CSR-SW    PIC X(01) VALUE 'N'.             01590000
015100         88  NEW-BAL-CSR                   VALUE 'N'.             01600000
015200         88  END-OF-BAL-CSR                VALUE 'Y'.             01610000
015300     05  PS-EMPTY-TABLE-SW       PIC X(01) VALUE 'N'.             01620000
015400         88  EMPTY-TABLE                   VALUE 'Y'.             01630000
015500         88  MORE-TABLE-CONTENTS           VALUE 'N'.             01640000
015600     05  PS-END-OF-IMPBAL-CSR-SW PIC X(01) VALUE 'N'.             01650000
015700         88  NEW-IMPBAL-CSR                VALUE 'N'.             01660000
015800         88  FOUND-IMPBAL                  VALUE 'F'.             01670000
015900         88  END-OF-IMPBAL-CSR             VALUE 'Y'.             01680000
016000         88  EMPTY-IMPBAL-CSR              VALUE 'E'.             01690000
016100     05  PS-DATE-TYPE            PIC X(01) VALUE 'N'.             01700000
016200         88 GOOD-DATE                      VALUE 'Y'.             01710000
016300         88 BAD-DATE                       VALUE 'N'.             01720000
016400                                                                  01760000
016500 01  PS-PROGRAM-CONSTANTS.                                        01770000
016600     05  PC-MAX-IND              PIC  9(02)  VALUE  14.           01780000
016700     05  PC-MAX-FP-TO-REPORT     PIC  9(02)  VALUE  13.           01790000
016800                                                                  01800000
016900 01 AP-DATE.                                                      01810000
017000     05  APCNTL-CUR-END-DTE      PIC X(10) VALUE SPACES.          01820000
017100                                                                  01830000
017200 01  PC-PROGRAM-COUNTERS.                                         01840000
017300     05  PC-RETRY-MAX            PIC S9(04)  VALUE 3              01850000
017400                                             COMP SYNC.           01860000
017500     05  PC-RETRY-COUNT          PIC S9(04)  VALUE ZEROS          01870000
017600                                             COMP SYNC.           01880000
017700     05  PC-MAX-LINES            PIC S9(03)  VALUE +60            01890000
017800                                             COMP-3.              01900000
017900     05  PC-LINE-COUNT           PIC S9(03)  VALUE +99            01910000
018000                                             COMP-3.              01920000
018100     05  PC-PAGE-COUNT           PIC S9(05)  VALUE ZEROS          01930000
018200                                             COMP-3.              01940000
018300     05  PC-EXCEPT-LINE-COUNT    PIC S9(03)  VALUE +99            01950000
018400                                             COMP-3.              01960000
018500     05  PC-EXCEPT-PAGE-COUNT    PIC S9(05)  VALUE ZEROS          01970000
018600                                             COMP-3.              01980000
018700     05  PC-EXCEPT-MAX-LINES     PIC S9(03)  VALUE +60            01990000
018800                                             COMP-3.              02000000
018900     05  PC-IMPORT-BAL-COUNT     PIC S9(05)  VALUE ZERO           02010000
019000                                             COMP-3.              02020000
019100     05  PC-EXCEPTION-COUNT      PIC S9(05)  VALUE ZERO           02030000
019200                                             COMP-3.              02040000
019300                                                                  02090000
019400 EJECT                                                            02100000
019500*----------------------------------------------------------------*02110000
019600*  STANDARD HEADER LAYOUT - IMPORT REPORT                        *02120000
019700*----------------------------------------------------------------*02130000
019800     COPY DPWS200O.                                               02140000
019900                                                                  02150000
020000*----------------------------------------------------------------*02160000
020100*  STANDARD HEADER LAYOUT - EXCEPTION REPORT                     *02170000
020200*----------------------------------------------------------------*02180000
020300     COPY DPWS132O.                                               02190000
020400                                                                  02200000
020500*----------------------------------------------------------------*02210000
020600* WORKING STORAGE FOR DATE ROUTINE                                02220000
020700*----------------------------------------------------------------*02230000
020800     COPY DPWS500.                                                02240000
020900 EJECT                                                            02250000
021500                                                                  02310000
021600 01  H1-IMPORT-ACCT-HEADER1.                                      02320000
021700     05  FILLER                  PIC  X(76) VALUE SPACES.         02330000
021800     05  FILLER                  PIC  X(125) VALUE                02340000
021900         'IMPORT ACCOUNT ACTIVITY AND BALANCE BY PO REPORT'.      02350000
022000                                                                  02360000
022100 01  H2-IMPORT-ACCT-HEADER2.                                      02370000
022200     05  FILLER                  PIC  X(85) VALUE SPACES.         02380000
022300     05  FILLER                  PIC  X(18) VALUE                 02390000
022400         'FOR THE WEEK ENDED'.                                    02400000
022500     05  FILLER                  PIC  X(01) VALUE SPACES.         02410000
022600     05  H2-MONTH                PIC  X(02) VALUE SPACES.         02420000
022700     05  FILLER                  PIC  X(01) VALUE '/'.            02430000
022800     05  H2-DAY                  PIC  X(02) VALUE SPACES.         02440000
022900     05  FILLER                  PIC  X(01) VALUE '/'.            02450000
023000     05  H2-YEAR                 PIC  X(04) VALUE SPACES.         02460000
023100     05  FILLER                  PIC  X(86) VALUE SPACES.         02470000
023200                                                                  02480000
023300 01  DH1-IMPORT-ACCT-DETAIL-HEADER1.                              02490000
023400     05  FILLER                  PIC   X(01) VALUE SPACES.        02500000
023500     05  FILLER                  PIC   X(07) VALUE 'ACCOUNT'.     02510000
023600     05  FILLER                  PIC   X(01) VALUE SPACES.        02520000
023700     05  DH1-ACCOUNT-NBR         PIC   X(07) VALUE SPACES.        02530000
023800     05  FILLER                  PIC   X(01) VALUE SPACES.        02540000
023900     05  FILLER                  PIC   X(01) VALUE '-'.           02550000
024000     05  FILLER                  PIC   X(01) VALUE SPACES.        02560000
024100     05  DH1-ACCOUNT-DESC        PIC   X(113) VALUE SPACES.       02570000
024200                                                                  02580000
024300 01  DH2-IMPORT-DETAIL-HEADER2.                                   02590000
024400     05  FILLER                  PIC   X(09) VALUE SPACES.        02600000
024500     05  FILLER                  PIC   X(08) VALUE 'PURCHASE'.    02610000
024600     05  FILLER                  PIC   X(33) VALUE SPACES.        02620000
024700     05  FILLER                  PIC   X(03) VALUE 'OTB'.         02630000
024800     05  FILLER                  PIC   X(37) VALUE SPACES.        02640000
024900     05  FILLER                  PIC   X(06) VALUE 'AMOUNT'.      02650000
025000     05  FILLER                  PIC   X(57) VALUE SPACES.        02660000
025100     05  FILLER                  PIC   X(18) VALUE                02670000
025200                                       'AGE OF OPEN DEBITS'.      02680000
025300     05  FILLER                  PIC   X(07) VALUE SPACES.        02690000
025400                                                                  02700000
025500 01  DH3-IMPORT-DETAIL-HEADER3.                                   02710000
025600     05  FILLER                  PIC   X(10) VALUE SPACES.        02720000
025700     05  FILLER                  PIC   X(05) VALUE 'ORDER'.       02730000
025800     05  FILLER                  PIC   X(13) VALUE SPACES.        02740000
025900     05  FILLER                  PIC   X(06) VALUE 'VENDOR'.      02750000
026000     05  FILLER                  PIC   X(15) VALUE SPACES.        02760000
026100     05  FILLER                  PIC   X(05) VALUE 'MONTH'.       02770000
026200     05  FILLER                  PIC   X(07) VALUE SPACES.        02780000
026300     05  FILLER                  PIC   X(11) VALUE 'BOP BALANCE'. 02790000
026400     05  FILLER                  PIC   X(11) VALUE SPACES.        02800000
026500     05  FILLER                  PIC   X(05) VALUE 'DEBIT'.       02810000
026600     05  FILLER                  PIC   X(11) VALUE SPACES.        02820000
026700     05  FILLER                  PIC   X(06) VALUE 'CREDIT'.      02830000
026800     05  FILLER                  PIC   X(07) VALUE SPACES.        02840000
026900     05  FILLER                  PIC   X(11) VALUE 'EOP BALANCE'. 02850000
027000     05  FILLER                  PIC   X(09) VALUE SPACES.        02860000
027100     05  FILLER                  PIC   X(04) VALUE '0-30'.        02870000
027200     05  FILLER                  PIC   X(09) VALUE SPACES.        02880000
027300     05  FILLER                  PIC   X(05) VALUE '31-60'.       02890000
027400     05  FILLER                  PIC   X(09) VALUE SPACES.        02900000
027500     05  FILLER                  PIC   X(05) VALUE '61-90'.       02910000
027600     05  FILLER                  PIC   X(09) VALUE SPACES.        02920000
027700     05  FILLER                  PIC   X(06) VALUE '91-120'.      02930000
027800     05  FILLER                  PIC   X(09) VALUE SPACES.        02940000
027900     05  FILLER                  PIC   X(04) VALUE '120+'.        02950000
028000     05  FILLER                  PIC   X(08) VALUE SPACES.        02960000
028100                                                                  02970000
028200 01  DL-IMPORT-ACCT-DETAIL-LINE.                                  02980000
028300     05  FILLER                  PIC   X(08)   VALUE SPACES.      02990000
028400     05  DL-PO                   PIC   9(09)   VALUE ZEROS.       03000000
028500     05  FILLER                  PIC   X(03)   VALUE SPACES.      03010000
028600     05  DL-VENDOR               PIC   X(25)   VALUE SPACES.      03020000
028700     05  FILLER                  PIC   X(04)   VALUE SPACES.      03030000
028800     05  DL-OTB-MONTH            PIC   X(03)   VALUE SPACES.      03040000
028900     05  DL-SPLIT                PIC   X(01)   VALUE SPACES.      03050000
029000     05  DL-OTB-YEAR             PIC   X(02)   VALUE SPACES.      03060000
029100     05  FILLER                  PIC   X(03)   VALUE SPACES.      03070000
029200     05  DL-BOP-BAL              PIC   ----------.99 VALUE SPACES.03080000
029300     05  FILLER                  PIC   X(04)   VALUE SPACES.      03090000
029400     05  DL-DEBIT                PIC   ZZZZZZZZZZ.99 VALUE SPACES.03100000
029500     05  FILLER                  PIC   X(04)   VALUE SPACES.      03110000
029600     05  DL-CREDIT               PIC   ZZZZZZZZZZ.99 VALUE SPACES.03120000
029700     05  FILLER                  PIC   X(04)   VALUE SPACES.      03130000
029800     05  DL-EOP-BAL              PIC   ----------.99 VALUE SPACES.03140000
029900     05  FILLER                  PIC   X(04)   VALUE SPACES.      03150000
030000     05  DL-0-30                 PIC   ZZZZZZZ.99 VALUE SPACES.   03160000
030100     05  FILLER                  PIC   X(04)   VALUE SPACES.      03170000
030200     05  DL-31-60                PIC   ZZZZZZZ.99 VALUE SPACES.   03180000
030300     05  FILLER                  PIC   X(04)   VALUE SPACES.      03190000
030400     05  DL-61-90                PIC   ZZZZZZZ.99 VALUE SPACES.   03200000
030500     05  FILLER                  PIC   X(05)   VALUE SPACES.      03210000
030600     05  DL-91-120               PIC   ZZZZZZZ.99 VALUE SPACES.   03220000
030700     05  FILLER                  PIC   X(03)   VALUE SPACES.      03230000
030800     05  DL-OVER-120             PIC   ZZZZZZZ.99 VALUE SPACES.   03240000
030900     05  FILLER                  PIC   X(03)   VALUE SPACES.      03250000
031000                                                                  03260000
031100 01  SL-IMPORT-ACCT-SUMMARY-LINE.                                 03270000
031200     05  FILLER                  PIC   X(16)   VALUE SPACES.      03280000
031300     05  FILLER                  PIC   X(06)   VALUE 'TOTALS'.    03290000
031400     05  FILLER                  PIC   X(36)   VALUE SPACES.      03300000
031500     05  SL-BOP-BAL-TOT          PIC   ----------.99 VALUE SPACES.03310000
031600     05  FILLER                  PIC   X(04)   VALUE SPACES.      03320000
031700     05  SL-DEBIT-TOT            PIC   ZZZZZZZZZZ.99 VALUE SPACES.03330000
031800     05  FILLER                  PIC   X(04)   VALUE SPACES.      03340000
031900     05  SL-CREDIT-TOT           PIC   ZZZZZZZZZZ.99 VALUE SPACES.03350000
032000     05  FILLER                  PIC   X(04)   VALUE SPACES.      03360000
032100     05  SL-EOP-BAL-TOT          PIC   ----------.99 VALUE SPACES.03370000
032200     05  FILLER                  PIC   X(02)   VALUE SPACES.      03380000
032300     05  SL-0-30                 PIC   ZZZZZZZZZ.99 VALUE SPACES. 03390000
032400     05  FILLER                  PIC   X(02)   VALUE SPACES.      03400000
032500     05  SL-31-60                PIC   ZZZZZZZZZ.99 VALUE SPACES. 03410000
032600     05  FILLER                  PIC   X(02)   VALUE SPACES.      03420000
032700     05  SL-61-90                PIC   ZZZZZZZZZ.99 VALUE SPACES. 03430000
032800     05  FILLER                  PIC   X(03)   VALUE SPACES.      03440000
032900     05  SL-91-120               PIC   ZZZZZZZZZ.99 VALUE SPACES. 03450000
033000     05  FILLER                  PIC   X(01)   VALUE SPACES.      03460000
033100     05  SL-OVER-120             PIC   ZZZZZZZZZ.99 VALUE SPACES. 03470000
033200                                                                  03480000
033300 01  H1-EXCEPTION-HEADER1.                                        03490000
033400     05  FILLER                  PIC  X(46) VALUE SPACES.         03500000
033500     05  FILLER                  PIC  X(71) VALUE                 03510000
033600         'IMPORT ACCOUNT ACTIVITY EXCEPTION REPORT'.              03520000
033700                                                                  03530000
033800 01  H2-EXCEPTION-HEADER2.                                        03540000
033900     05  FILLER                  PIC  X(52) VALUE SPACES.         03550000
034000     05  FILLER                  PIC  X(18) VALUE                 03560000
034100         'FOR THE WEEK ENDED'.                                    03570000
034200     05  FILLER                  PIC  X(01) VALUE SPACES.         03580000
034300     05  H2-EXCEPT-MO            PIC  X(02) VALUE SPACES.         03590000
034400     05  FILLER                  PIC  X(01) VALUE '/'.            03600000
034500     05  H2-EXCEPT-DAY           PIC  X(02) VALUE SPACES.         03610000
034600     05  FILLER                  PIC  X(01) VALUE '/'.            03620000
034700     05  H2-EXCEPT-YEAR          PIC  X(04) VALUE SPACES.         03630000
034800     05  FILLER                  PIC  X(51) VALUE SPACES.         03640000
034900                                                                  03650000
035000 01  DH1-EXCEPTION-DETAIL-HEADER1.                                03660000
035100     05  FILLER                  PIC   X(24) VALUE SPACES.        03670000
035200     05  FILLER                  PIC   X(07) VALUE 'ACCOUNT'.     03680000
035300     05  FILLER                  PIC   X(15) VALUE SPACES.        03690000
035400     05  FILLER                  PIC   X(08) VALUE 'PURCHASE'.    03700000
035500     05  FILLER                  PIC   X(26) VALUE SPACES.        03710000
035600     05  FILLER                  PIC   X(15) VALUE                03720000
035700                                       'DESCRIPTION OF'.          03730000
035800     05  FILLER                  PIC   X(29) VALUE SPACES.        03740000
035900                                                                  03750000
036000 01  DH2-EXCEPTION-DETAIL-HEADER2.                                03760000
036100     05  FILLER                  PIC   X(25) VALUE SPACES.        03770000
036200     05  FILLER                  PIC   X(06) VALUE 'NUMBER'.      03780000
036300     05  FILLER                  PIC   X(16) VALUE SPACES.        03790000
036400     05  FILLER                  PIC   X(05) VALUE 'ORDER'.       03800000
036500     05  FILLER                  PIC   X(30) VALUE SPACES.        03810000
036600     05  FILLER                  PIC   X(15) VALUE 'EXCEPTION'.   03820000
036700     05  FILLER                  PIC   X(32) VALUE SPACES.        03830000
036800                                                                  03840000
036900 01  EDL-EXCEPTION-DETAIL-LINE.                                   03850000
037000     05  FILLER                  PIC   X(24)   VALUE SPACES.      03860000
037100     05  EDL-ACCOUNT-NBR         PIC   X(07)   VALUE SPACES.      03870000
037200     05  FILLER                  PIC   X(15)   VALUE SPACES.      03880000
037300     05  EDL-PO                  PIC   9(09)   VALUE ZEROS.       03890000
037400     05  FILLER                  PIC   X(15)   VALUE SPACES.      03900000
037500     05  EDL-EXCEPT-DESC         PIC   X(55)   VALUE SPACES.      03910000
037600     05  FILLER                  PIC   X(05)   VALUE SPACES.      03920000
037700                                                                  03930000
037800 01  EDL-EXCEPTION-DETAIL-LINE2.                                  03940000
037900     05  FILLER                  PIC   X(46)   VALUE SPACES.      03950000
038000     05  EDL2-NO-EXCEPT          PIC   X(26)   VALUE SPACES.      03960000
038100     05  FILLER                  PIC   X(60)   VALUE SPACES.      03970000
038200 EJECT                                                            03980000
038300*----------------------------------------------------------------*03990000
038400*  COMMUNICATIONS AREA2 FOR DB2                                  *04000000
038500*----------------------------------------------------------------*04010000
038600     COPY SQLCA2.                                                 04020000
038700                                                                  04030000
038800                                                                  04040000
038900     EXEC SQL                                                     04050000
039000          INCLUDE SQLCA                                           04060000
039100     END-EXEC.                                                    04070000
039200 EJECT                                                            04080000
039300*----------------------------------------------------------------*04090000
039400*  ACCOUNTS PAYABLE IMPORT BALANCE TABLE                         *04100000
039500*----------------------------------------------------------------*04110000
039600     EXEC SQL                                                     04120000
039700          INCLUDE TIMPBAL                                         04130000
039800     END-EXEC.                                                    04140000
039900 EJECT                                                            04150000
040000*----------------------------------------------------------------*04160000
040100*  ACCOUNTS PAYABLE CONTROL TABLE                                *04170000
040200*----------------------------------------------------------------*04180000
040300     EXEC SQL                                                     04190000
040400          INCLUDE TAPCNTL                                         04200000
040500     END-EXEC.                                                    04210000
040600 EJECT                                                            04220000
040700*----------------------------------------------------------------*04230000
040800*  ACCOUNTS PAYABLE PURCHASE ORDER TABLE                         *04240000
040900*----------------------------------------------------------------*04250000
041000     EXEC SQL                                                     04260000
041100          INCLUDE TPURCHS                                         04270000
041200     END-EXEC.                                                    04280000
041300 EJECT                                                            04290000
041400*----------------------------------------------------------------*04300000
041500*  EXTERNAL ENTERPRISE NAME TABLE                                *04310000
041600*----------------------------------------------------------------*04320000
041700     EXEC SQL                                                     04330000
041800          INCLUDE TENTNME                                         04340000
041900     END-EXEC.                                                    04350000
042000 EJECT                                                            04360000
042100*----------------------------------------------------------------*04370000
042200*  EXTERNAL ENTITY ID TABLE                                      *04380000
042300*----------------------------------------------------------------*04390000
042400     EXEC SQL                                                     04400000
042500          INCLUDE TEXTENT                                         04410000
042600     END-EXEC.                                                    04420000
042700 EJECT                                                            04430000
      *----------------------------------------------------------------*04431001
      *  ACCOUNT TABLE AP_ACCT_TBL                                     *04432001
      *----------------------------------------------------------------*04433001
           EXEC SQL                                                     04434001
                INCLUDE APT00002                                        04435001
           END-EXEC.                                                    04436001
       EJECT                                                            04437001
042800*----------------------------------------------------------------*04440000
042900*   IMPORT_BAL_CSR GETS ALL ROWS ON THE TIMPBAL TABLE EXCEPT     *04450000
043000*   PERD_END_DTE.                                                *04460000
043100*----------------------------------------------------------------*04470000
043200     EXEC SQL                                                     04480000
043300       DECLARE IMPORT_BAL_CSR CURSOR FOR                          04490000
043400         SELECT                                                   04500000
043500             IM.PO_NBR                                            04510000
043600            ,IM.GL_ACCT_NBR                                       04520000
043700            ,IM.BOP_BAL_AMT                                       04530000
043800            ,IM.EOP_BAL_AMT                                       04540000
043900            ,IM.DR_ACTVY_AMT                                      04550000
044000            ,IM.CR_ACTVY_AMT                                      04560000
044100            ,IM.AGE_30DAY_AMT                                     04570000
044200            ,IM.AGE_60DAY_AMT                                     04580000
044300            ,IM.AGE_90DAY_AMT                                     04590000
044400            ,IM.AGE_120DAY_AMT                                    04600000
044500            ,IM.AGE_OVR_120DAY_AMT                                04610000
044600         FROM                                                     04620000
044700             TIMPBAL IM                                           04630000
044800         WHERE                                                    04640000
044900             PERD_END_DTE      = :APCNTL-CUR-END-DTE              04650000
045000         AND IM.GL_ACCT_NBR NOT IN ('10311','20115')              04660000
045100         ORDER BY GL_ACCT_NBR                                     04670000
045200                 ,PO_NBR                                          04680000
045300     END-EXEC.                                                    04690000
045400 EJECT                                                            04700000
045500*----------------------------------------------------------------*04710000
045600*  ABEND DATA AREAS                                              *04720000
045700*----------------------------------------------------------------*04730000
045800 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          04740000
045900                                             COMP SYNC.           04750000
046000     88  AC-BAD-DATA                         VALUE +4003.         04760000
046100     88  AC-DB2-ERROR                        VALUE +4013.         04770000
046200                                                                  04780000
046300     88  AC-DATE-ERROR                       VALUE +4019.         04790000
046400                                                                  04800000
046500 01  ABEND-AREAS.                                                 04810000
046600     05  AA-ABEND-LIT            PIC  X(40)  VALUE                04820000
046700             '*****       ABEND'.                                 04830000
046800     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                04840000
046900             '*****   PROGRAM: APKRP075'.                         04850000
047000     05  AA-PARAGRAPH-LIT.                                        04860000
047100         10  FILLER              PIC  X(17)  VALUE                04870000
047200             '***** PARAGRAPH: '.                                 04880000
047300         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        04890000
047400     05  AA-MESSAGE-LINE.                                         04900000
047500         10  FILLER              PIC  X(06)  VALUE '*****'.       04910000
047600         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        04920000
047700     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                04930000
047800             '*****    DB2 ERROR'.                                04940000
047900     05  AA-DB2-OPERATION-LIT.                                    04950000
048000         10  FILLER              PIC  X(17)  VALUE                04960000
048100             '***** OPERATION: '.                                 04970000
048200         10  AA-DB2-OPERATION.                                    04980000
048300             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        04990000
048400             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        05000000
048500     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        05010000
048600     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        05020000
048700     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        05030000
048800     05  AA-DB2-TABLE-4          PIC  X(08)  VALUE SPACES.        05040000
048900     05  AA-DB2-TABLE-5          PIC  X(08)  VALUE SPACES.        05050000
049000                                                                  05060000
049100                                                                  05070000
049200     COPY DPWS004.                                                05080000
049300 01  FILLER                      PIC  X(25)  VALUE                05090000
049400     '** END OF APKRP075 W/S **'.                                 05100000
049500                                                                  05110000
049600 EJECT                                                            05120000
049700 PROCEDURE DIVISION.                                              05130000
049800 A100-MAIN.                                                       05140000
049900                                                                  05150000
050000     MOVE 'A100-MAIN' TO PV-CURRENT-PARAGRAPH.                    05160000
050100                                                                  05170000
050200     PERFORM B100-INITIALIZE.                                     05180000
050300                                                                  05190000
050400     PERFORM B200-PROCESS-INFO                                    05200000
050500         UNTIL OUT-OF-IMPORTS.                                    05210000
050600                                                                  05220000
050700     PERFORM B300-END-PROGRAM.                                    05230000
050800                                                                  05240000
050900     GOBACK.                                                      05250000
051000                                                                  05260000
051100                                                                  05270000
051200 EJECT                                                            05280000
051300*                                                                 05290000
051400*----------------------------------------------------------------*05300000
051500*    INITIALIZATION PROCESSING                                   *05310000
051600*    CALLED FROM A100-MAIN                                       *05320000
051700*----------------------------------------------------------------*05330000
051800*                                                                 05340000
051900 B100-INITIALIZE.                                                 05350000
052000                                                                  05360000
052100     MOVE 'B100-INITIALIZE' TO PV-CURRENT-PARAGRAPH.              05370000
052200                                                                  05380000
052500     OPEN OUTPUT IMPORT-ACCT-RPT-FILE                             05410000
052600                 IMPORT-EXCEPT-RPT-FILE.                          05420000
052700                                                                  05430000
052800     INITIALIZE DCLTIMPBAL                                        05450000
052900                DCLTEXTENT                                        05460000
053000                DCLTENTNME                                        05470000
053100                DCLTAPCNTL                                        05480000
053200                DCLTPURCHS.                                       05490000
053300                                                                  05500000
053400     EXEC SQL                                                     05510000
053500        SELECT  CURR_WK_END_DTE                                   05520000
053600          INTO  :APCNTL-CUR-END-DTE                               05530000
053700          FROM  TAPCNTL                                           05540000
053800     END-EXEC.                                                    05550000
053900                                                                  05560000
054000     ACCEPT PV-CURRENT-DATE FROM DATE.                            05570000
054100     MOVE PV-CURRENT-MONTH            TO DP200O-RUN-MONTH.        05580000
054200     MOVE PV-CURRENT-DAY              TO DP200O-RUN-DAY.          05590000
054300     MOVE PV-CURRENT-YEAR             TO DP200O-RUN-YEAR.         05600000
054400                                                                  05610000
054500     MOVE PV-CURRENT-MONTH            TO DP132O-RUN-MONTH.        05620000
054600     MOVE PV-CURRENT-DAY              TO DP132O-RUN-DAY.          05630000
054700     MOVE PV-CURRENT-YEAR             TO DP132O-RUN-YEAR.         05640000
054800                                                                  05650000
054900     ACCEPT PV-CURRENT-TIME FROM TIME.                            05660000
055000     MOVE PV-CURRENT-HOUR             TO DP200O-RUN-HOUR.         05670000
055100     MOVE PV-CURRENT-MINUTE           TO DP200O-RUN-MINUTE.       05680000
055200     MOVE PV-PROGRAM-NAME             TO DP200O-PROGRAM-NAME.     05690000
055300     MOVE 1                           TO DP200O-REPORT-NUMBER.    05700000
055400                                                                  05710000
055500     MOVE PV-CURRENT-HOUR             TO DP132O-RUN-HOUR.         05720000
055600     MOVE PV-CURRENT-MINUTE           TO DP132O-RUN-MINUTE.       05730000
055700     MOVE PV-PROGRAM-NAME             TO DP132O-PROGRAM-NAME.     05740000
055800     MOVE 1                           TO DP132O-REPORT-NUMBER.    05750000
055900                                                                  05760000
056000     MOVE APCNTL-CUR-END-DTE          TO PV-HOLD-H2-DATE.         05770000
056100     MOVE HOLD-MONTH                  TO H2-MONTH.                05780000
056200     MOVE HOLD-DAY                    TO H2-DAY.                  05790000
056300     MOVE HOLD-YEAR                   TO H2-YEAR.                 05800000
056400                                                                  05810000
056500     MOVE HOLD-MONTH                  TO H2-EXCEPT-MO.            05820000
056600     MOVE HOLD-DAY                    TO H2-EXCEPT-DAY.           05830000
056700     MOVE HOLD-YEAR                   TO H2-EXCEPT-YEAR.          05840000
056800                                                                  05850000
056900     PERFORM Y100-OPEN-IMPORT-BAL-CSR.                            05860000
057000     PERFORM R100-FETCH-IMPORT-BAL                                05870000
057100        IF EMPTY-IMPBAL-CSR THEN                                  05880000
057200           MOVE PV-CURRENT-PARAGRAPH                              05890000
057300                               TO AA-PARAGRAPH-NAME               05900000
057400           MOVE 'UNSUCCESSFUL INITIAL OPEN OF CURSOR'             05910000
057500                               TO AA-DB2-OPERATION                05920000
057600           MOVE 'TIMPBAL'      TO AA-DB2-TABLE-1                  05930000
057700           DISPLAY 'PO-NBR = ' PV-HOLD-PO-NBR                     05940000
057800           PERFORM Z998-DB2-ABEND                                 05950000
057900        END-IF.                                                   05960000
058000                                                                  05970000
058100     MOVE IMPBAL-PO-NBR      TO PV-HOLD-PO-NBR.                   06100000
058200     MOVE IMPBAL-GL-ACCT-NBR TO PV-HOLD-ACCT-NBR.                 06110000
058300                                                                  06120000
058400     PERFORM S100-GET-VENDOR-INFO.                                06130000
058500     PERFORM S200-GET-ACCT-DESCRIPTION.                           06140000
058600     PERFORM E100-PREPARE-ACCT-DETAIL.                            06150000
058700     PERFORM E200-PREPARE-IMPORT-DETAIL.                          06160000
058800                                                                  06170000
058900     PERFORM R100-FETCH-IMPORT-BAL.                               06180000
059000                                                                  06190000
059100 EJECT                                                            06200000
059200                                                                  06210000
059300                                                                  06220000
059400*                                                                 06230000
059500*----------------------------------------------------------------*06240000
059600*    PROCESSES THE INFORMATION RECEIVED FROM THE FETCH.          *06250000
059700*    CALLED FROM A100-MAIN                                       *06260000
059800*----------------------------------------------------------------*06270000
059900*                                                                 06280000
060000 B200-PROCESS-INFO.                                               06290000
060100                                                                  06300000
060200     MOVE 'B200-PROCESS-INFO' TO PV-CURRENT-PARAGRAPH.            06310000
060300                                                                  06320000
060400     IF (IMPBAL-GL-ACCT-NBR = PV-HOLD-ACCT-NBR) AND               06330000
060500        (IMPBAL-PO-NBR      = PV-HOLD-PO-NBR)                     06340000
060600        PERFORM Z999-ABEND                                        06350000
060700     ELSE                                                         06360000
060800        IF IMPBAL-GL-ACCT-NBR = PV-HOLD-ACCT-NBR THEN             06370000
060900           MOVE IMPBAL-GL-ACCT-NBR TO PV-HOLD-ACCT-NBR            06380000
061000           MOVE IMPBAL-PO-NBR      TO PV-HOLD-PO-NBR              06390000
061100                                                                  06400000
061200           PERFORM S100-GET-VENDOR-INFO                           06410000
061300           PERFORM E200-PREPARE-IMPORT-DETAIL                     06420000
061400        ELSE                                                      06430000
061500           PERFORM D300-DETERMINE-IMPORT-TOTALS                   06440000
061600                                                                  06450000
061700           MOVE IMPBAL-GL-ACCT-NBR TO PV-HOLD-ACCT-NBR            06460000
061800           MOVE IMPBAL-PO-NBR      TO PV-HOLD-PO-NBR              06470000
061900                                                                  06480000
062000           PERFORM S100-GET-VENDOR-INFO                           06490000
062100           PERFORM S200-GET-ACCT-DESCRIPTION                      06500000
062200           PERFORM E100-PREPARE-ACCT-DETAIL                       06510000
062300           PERFORM E200-PREPARE-IMPORT-DETAIL                     06520000
062400        END-IF                                                    06530000
062500     END-IF.                                                      06540000
062600                                                                  06550000
062700     INITIALIZE PV-HOLD-PO-NBR.                                   06560000
062800     PERFORM R100-FETCH-IMPORT-BAL.                               06570000
062900                                                                  06580000
063000 EJECT                                                            06590000
063100                                                                  06600000
063200 EJECT                                                            06610000
063300*                                                                 06620000
063400*----------------------------------------------------------------*06630000
063500*    ENDING PROCESSING: DISPLAYS COUNT OF IMPORTS AND CLOSES     *06640000
063600*    THE CURSOR AND FILES.                                       *06650000
063700*    CALLED FROM A100-MAIN                                       *06660000
063800*----------------------------------------------------------------*06670000
063900*                                                                 06680000
064000 B300-END-PROGRAM.                                                06690000
064100                                                                  06700000
064200     MOVE 'B300-END-PROGRAM' TO PV-CURRENT-PARAGRAPH.             06710000
064300                                                                  06720000
064500     DISPLAY 'PROGRAM NAME = APKRP075'                            06730000
064510     DISPLAY '**********************************************'     06820000
064600     DISPLAY 'IMPORTS PROCESSED = ' PC-IMPORT-BAL-COUNT.          06830000
064700     DISPLAY 'NUMBER OF EXCEPTIONS = ' PC-EXCEPTION-COUNT.        06840000
064800     DISPLAY '**********************************************'     06850000
064900                                                                  06860000
065000     PERFORM D300-DETERMINE-IMPORT-TOTALS.                        06870000
065100                                                                  06880000
065200     IF PC-EXCEPTION-COUNT = 0 THEN                               06890000
065300        PERFORM W600-WRITE-EXCEPTION-HEADER                       06900000
065400        MOVE 'NO EXCEPTIONS FOR THIS RUN' TO EDL2-NO-EXCEPT       06910000
065500        WRITE IMPORT-EXCEPT-RPT-REC FROM                          06920000
065600                     EDL-EXCEPTION-DETAIL-LINE2 AFTER 2           06930000
065700     END-IF.                                                      06940000
065800                                                                  06950000
065900     PERFORM Y110-CLOSE-IMPORT-BAL-CSR.                           06960000
066000                                                                  06970000
066100     CLOSE IMPORT-ACCT-RPT-FILE                                   06980000
066200           IMPORT-EXCEPT-RPT-FILE.                                06990003
066310                                                                  07010000
066400*                                                                 07020000
066500*----------------------------------------------------------------*07030000
066600*  TOTALS OF ALL AMOUNT FIELDS.                                   07040000
066700*  CALLED FROM E200-PREPARE-IMPORT-DETAIL                        *07050000
066800*----------------------------------------------------------------*07060000
066900*                                                                 07070000
067000 C100-GET-TOTALS.                                                 07080000
067100                                                                  07090000
067200     MOVE 'C100-GET-TOTALS' TO PV-CURRENT-PARAGRAPH.              07100000
067300                                                                  07110000
067400     ADD IMPBAL-BOP-BAL-AMT     TO PV-HOLD-BOP-TOT.               07120000
067500     ADD IMPBAL-DR-ACTVY-AMT    TO PV-HOLD-DEBIT-TOT.             07130000
067600     ADD IMPBAL-CR-ACTVY-AMT    TO PV-HOLD-CREDIT-TOT.            07140000
067700     ADD IMPBAL-EOP-BAL-AMT     TO PV-HOLD-EOP-TOT.               07150000
067800     ADD IMPBAL-AGE-30DAY-AMT   TO PV-HOLD-0-30-TOT.              07160000
067900     ADD IMPBAL-AGE-60DAY-AMT   TO PV-HOLD-31-60-TOT.             07170000
068000     ADD IMPBAL-AGE-90DAY-AMT   TO PV-HOLD-61-90-TOT.             07180000
068100     ADD IMPBAL-AGE-120DAY-AMT  TO PV-HOLD-91-120-TOT.            07190000
068200     ADD IMPBAL-AGE-OVR-120DAY-AMT TO PV-HOLD-OVR120-TOT.         07200000
068300                                                                  07210000
068400                                                                  07220000
068500*                                                                 07230000
068600*----------------------------------------------------------------*07240000
068700*    USING THE CALENDAR ROUTINE TO GET THE 3-CHARACTER           *07250000
068800*    ABREVIATION.                                                *07260000
068900*----------------------------------------------------------------*07270000
069000*                                                                 07280000
069100 C200-INIT-FISCAL-ARRAY.                                          07290000
069200                                                                  07300000
069300     MOVE SPACES                    TO PS-DATE-SW.                07310000
069400     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         07320000
069500     ACCEPT DPG51-SYSTEM-DATE       FROM DATE.                    07330000
069600                                                                  07340000
069700     SET DPG52-LK-DTE-FISC-PRD-CC      TO TRUE.                   07350000
069800     SET DPG51-FISCAL-JAN-DEC-F2       TO TRUE.                   07360000
069900     SET DPG51-DO-NOT-INCR-DECR-DATE   TO TRUE.                   07370000
070000                                                                  07380000
070100     MOVE CALENDAR-OTB-PERIOD          TO DPG52-LK-DATE-INPUT.    07390000
070200                                                                  07400000
070300     PERFORM D200-DATE-ROUTINE.                                   07410000
070400                                                                  07420000
070500     IF VALID-DATE                                                07430000
070600         MOVE DPG56-FISCAL-PERIOD-NAME-ABBR3 TO DL-OTB-MONTH      07440000
070700     ELSE                                                         07450000
070800         DISPLAY 'CALENDAR-OTB-PERIOD ' CALENDAR-OTB-PERIOD       07460000
070900         MOVE 'C200-INIT-FISCAL-ARRAY' TO  AA-PARAGRAPH-NAME      07470000
071000         MOVE 'BAD DATE CONVERSION FOR CURRENT DATE'              07480000
071100                                    TO AA-MESSAGE                 07490000
071200         SET AC-DATE-ERROR          TO TRUE                       07500000
071300         PERFORM Z999-ABEND                                       07510000
071400     END-IF.                                                      07520000
071500                                                                  07530000
072100*----------------------------------------------------------------*08390000
072101*    PRODUCES THE EXCEPTION REPORT BASED ON THE GIVEN CRITERIA   *08400000
072102*    IN PREVIOUS PARAGRAPHS.                                     *08410000
072110*    CALLED FROM B100-INITIALIZE                                 *08420000
072200*                B200-PROCESS-INFO                               *08430000
072300*----------------------------------------------------------------*08440000
072400*                                                                 08450000
072500 D100-DEVELOP-EXCEPTION-REPORT.                                   08460000
072600                                                                  08470000
072700     MOVE 'D100-EXCEPTION-REPORT' TO PV-CURRENT-PARAGRAPH.        08480000
072800                                                                  08490000
072900*    IF PC-EXCEPTION-COUNT > 0 THEN                               08500000
073000      MOVE IMPBAL-GL-ACCT-NBR      TO EDL-ACCOUNT-NBR             08510000
073100      MOVE IMPBAL-PO-NBR           TO EDL-PO                      08520000
073200      MOVE 'PURCHASE ORDER WITH ACTIVITY OR BALANCE AND NO AGING' 08530000
073300                               TO EDL-EXCEPT-DESC                 08540000
073400*    ELSE                                                         08550000
073500*       MOVE 'NO EXCEPTIONS FOR THIS RUN' TO EDL-EXCEPT-DESC      08560000
073600*    END-IF.                                                      08570000
073700                                                                  08580000
073800     PERFORM W700-WRITE-EXCEPTION-DETAIL.                         08590000
073900                                                                  08600000
074000                                                                  08610000
074100******************************************************************08620000
074200*    CALLS THE DATE ROUTINE MODULE.                              *08630000
074300******************************************************************08640000
074400 D200-DATE-ROUTINE.                                               08650000
074500                                                                  08660000
074600         MOVE SPACES               TO                             08670000
074700                                   DPG53-LK-CMPR-DATE-FORMAT-CODE 08680000
074800         MOVE SPACES               TO DPG53-LK-CMPR-DATE-INPUT    08690000
074900         MOVE ZEROS                TO DPG51-INCR-DECR-BUS-DAYS-9  08700000
075000         MOVE ZEROS                TO DPG51-INCR-DECR-DAYS-9      08710000
075100                                                                  08720000
075200     CALL DP500-KOHLS-CALENDAR-ROUTINE                            08730000
075300         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               08740000
075400                                                                  08750000
075500     IF (DPG54-SEVERE-ERROR OR                                    08760000
075600         DPG54-WARNING-ERROR)                                     08770000
075700         SET NOT-VALID-DATE TO TRUE                               08780000
075800     ELSE                                                         08790000
075900         SET VALID-DATE TO TRUE                                   08800000
076000     END-IF.                                                      08810000
076100                                                                  08820000
076200 EJECT                                                            08830000
076300*                                                                 08840000
076400*----------------------------------------------------------------*08850000
076500*    MOVES DATA TOTALS FROM THE HOLD VARIABLES.                  *08860000
076600*    CALLED FROM B200-PROCESS-INFO.                              *08870000
076700*----------------------------------------------------------------*08880000
076800*                                                                 08890000
076900 D300-DETERMINE-IMPORT-TOTALS.                                    08900000
077000                                                                  08910000
077100     MOVE 'D300-DETERMINE-IMPORT-TOTALS' TO PV-CURRENT-PARAGRAPH. 08920000
077200                                                                  08930000
077300     MOVE PV-HOLD-BOP-TOT     TO SL-BOP-BAL-TOT.                  08940000
077400     MOVE PV-HOLD-DEBIT-TOT   TO SL-DEBIT-TOT.                    08950000
077500     MOVE PV-HOLD-CREDIT-TOT  TO SL-CREDIT-TOT.                   08960000
077600     MOVE PV-HOLD-EOP-TOT     TO SL-EOP-BAL-TOT.                  08970000
077700     MOVE PV-HOLD-0-30-TOT    TO SL-0-30.                         08980000
077800     MOVE PV-HOLD-31-60-TOT   TO SL-31-60.                        08990000
077900     MOVE PV-HOLD-61-90-TOT   TO SL-61-90.                        09000000
078000     MOVE PV-HOLD-91-120-TOT  TO SL-91-120.                       09010000
078100     MOVE PV-HOLD-OVR120-TOT  TO SL-OVER-120.                     09020000
078200                                                                  09030000
078300     INITIALIZE PV-HOLD-BOP-TOT                                   09040000
078400                PV-HOLD-DEBIT-TOT                                 09050000
078500                PV-HOLD-CREDIT-TOT                                09060000
078600                PV-HOLD-EOP-TOT                                   09070000
078700                PV-HOLD-0-30-TOT                                  09080000
078800                PV-HOLD-31-60-TOT                                 09090000
078900                PV-HOLD-61-90-TOT                                 09100000
079000                PV-HOLD-91-120-TOT                                09110000
079100                PV-HOLD-OVR120-TOT.                               09120000
079200                                                                  09130000
079300     PERFORM W400-WRITE-TOTALS.                                   09140000
079400                                                                  09150000
079500                                                                  09160000
079600*                                                                 09170000
079700*----------------------------------------------------------------*09180000
079800*    MOVES THE ACCOUNT NUMBER AND DESCRIPTION TO THE REPORT.     *09190000
079900*    CALLED FROM B100-INITIALIZE                                 *09200000
080000*----------------------------------------------------------------*09210000
080100 E100-PREPARE-ACCT-DETAIL.                                        09220000
080200                                                                  09230000
080300     MOVE 'E100-PREPARE-ACCT-DETAIL' TO PV-CURRENT-PARAGRAPH.     09240000
080400                                                                  09250000
080500     MOVE IMPBAL-GL-ACCT-NBR      TO DH1-ACCOUNT-NBR.             09260000
080600     MOVE PV-GL-ACCT-DESCR        TO DH1-ACCOUNT-DESC.            09270000
080700                                                                  09280000
080800     PERFORM W200-WRITE-ACCT-IMPRT-HEADER.                        09290000
080900     PERFORM W300-WRITE-IMPRT-DETAIL-HEADER.                      09300000
081000                                                                  09310000
081100                                                                  09320000
081200 EJECT                                                            09330000
081300*                                                                 09340000
081400*----------------------------------------------------------------*09350000
081500*    MOVES DATA FROM THE DB2 TABLE AREAS TO THE REPORT.          *09360000
081600*    CALLED FROM B100-INITIALIZE                                 *09370000
081700*                B200-PROCESS-INFO                               *09380000
081800*----------------------------------------------------------------*09390000
081900*                                                                 09400000
082000 E200-PREPARE-IMPORT-DETAIL.                                      09410000
082100                                                                  09420000
082200     MOVE 'E200-PREPARE-IMPORT-DETAIL' TO PV-CURRENT-PARAGRAPH.   09430000
082300                                                                  09440000
082400     MOVE IMPBAL-PO-NBR           TO DL-PO.                       09450000
082500     MOVE ENTNME-ENT-NAME-DESC    TO DL-VENDOR.                   09460000
082600                                                                  09470000
082700     IF GOOD-DATE                                                 09480000
082800        MOVE PURCHS-OTB-PER-NBR   TO CO-OTB-PERIOD                09490000
082900        PERFORM C200-INIT-FISCAL-ARRAY                            09500000
083000        MOVE PURCHS-OTB-PER-NBR   TO PV-HOLD-OTB                  09510000
083100        MOVE '-'                  TO DL-SPLIT                     09520000
083200        MOVE HOLD-OTB-YEAR        TO DL-OTB-YEAR                  09530000
083300     ELSE                                                         09540000
083400        IF BAD-DATE                                               09550000
083500           MOVE PURCHS-OTB-PER-NBR      TO DL-OTB-MONTH           09560000
083600           MOVE '*'                     TO DL-SPLIT               09570000
083700           MOVE PURCHS-OTB-PER-NBR      TO DL-OTB-YEAR            09580000
083800        END-IF                                                    09590000
083900     END-IF.                                                      09600000
084000                                                                  09610000
084100     MOVE IMPBAL-BOP-BAL-AMT      TO DL-BOP-BAL.                  09620000
084200     MOVE IMPBAL-DR-ACTVY-AMT     TO DL-DEBIT.                    09630000
084300     MOVE IMPBAL-CR-ACTVY-AMT     TO DL-CREDIT.                   09640000
084400     MOVE IMPBAL-EOP-BAL-AMT      TO DL-EOP-BAL.                  09650000
084500     MOVE IMPBAL-AGE-30DAY-AMT    TO DL-0-30.                     09660000
084600     MOVE IMPBAL-AGE-60DAY-AMT    TO DL-31-60.                    09670000
084700     MOVE IMPBAL-AGE-90DAY-AMT    TO DL-61-90.                    09680000
084800     MOVE IMPBAL-AGE-120DAY-AMT   TO DL-91-120.                   09690000
084900     MOVE IMPBAL-AGE-OVR-120DAY-AMT TO DL-OVER-120.               09700000
085000                                                                  09710000
085100     PERFORM C100-GET-TOTALS.                                     09720000
085200     PERFORM W500-WRITE-IMPRT-DETAIL.                             09730000
085300                                                                  09740000
085400     IF (IMPBAL-BOP-BAL-AMT    = IMPBAL-EOP-BAL-AMT) AND          09750000
085500        (IMPBAL-AGE-30DAY-AMT  = 0) AND                           09760000
085600        (IMPBAL-AGE-60DAY-AMT  = 0) AND                           09770000
085700        (IMPBAL-AGE-90DAY-AMT  = 0) AND                           09780000
085800        (IMPBAL-AGE-120DAY-AMT = 0) AND                           09790000
085900        (IMPBAL-AGE-OVR-120DAY-AMT = 0) THEN                      09800000
086000          ADD 1 TO PC-EXCEPTION-COUNT                             09810000
086100          PERFORM D100-DEVELOP-EXCEPTION-REPORT                   09820000
086200     END-IF.                                                      09830000
086300                                                                  09840000
086400                                                                  09850000
086500 EJECT                                                            09860000
086600*                                                                 09870000
086700*----------------------------------------------------------------*09880000
086800*    RETRIEVES THE ITEMS ON THE IMPORT BALANCE TABLE.            *09890000
086900*    NOTE:  A NOT FOUND CONDITION IN THIS INSTANCE SIMPLY        *09900000
087000*           RESULTS IN THE OUT OF IMPORTS SWITCH BEING SET.      *09910000
087100*    CALLED FROM B100-INITIALIZE                                 *09920000
087200*                E200-PREPARE-IMPORT-DETAIL                      *09930000
087300*----------------------------------------------------------------*09940000
087400*                                                                 09950000
087500 R100-FETCH-IMPORT-BAL.                                           09960000
087600                                                                  09970000
087700     MOVE 'R100-FETCH-IMPORT-BAL' TO PV-CURRENT-PARAGRAPH.        09980000
087800                                                                  09990000
087900     PERFORM WITH TEST AFTER                                      10000000
088000             VARYING PC-RETRY-COUNT FROM 1 BY 1                   10010000
088100             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX OR             10020000
088200                     SQLCODE = ZERO OR                            10030000
088300                     SQLCODE = +100                               10040000
088400                                                                  10050000
088500             EXEC SQL                                             10060000
088600                 FETCH IMPORT_BAL_CSR                             10070000
088700                 INTO                                             10080000
088800                     :IMPBAL-PO-NBR                               10090000
088900                    ,:IMPBAL-GL-ACCT-NBR                          10100000
089000                    ,:IMPBAL-BOP-BAL-AMT                          10110000
089100                    ,:IMPBAL-EOP-BAL-AMT                          10120000
089200                    ,:IMPBAL-DR-ACTVY-AMT                         10130000
089300                    ,:IMPBAL-CR-ACTVY-AMT                         10140000
089400                    ,:IMPBAL-AGE-30DAY-AMT                        10150000
089500                    ,:IMPBAL-AGE-60DAY-AMT                        10160000
089600                    ,:IMPBAL-AGE-90DAY-AMT                        10170000
089700                    ,:IMPBAL-AGE-120DAY-AMT                       10180000
089800                    ,:IMPBAL-AGE-OVR-120DAY-AMT                   10190000
089900             END-EXEC                                             10200000
090000                                                                  10210000
090100             EVALUATE TRUE                                        10220000
090200                 WHEN SQLCODE = ZERO                              10230000
090300                 WHEN SQLCODE = +100                              10240000
090400                 WHEN SQLCODE = -904                              10250000
090500                 WHEN SQLCODE = -913                              10260000
090600                      CONTINUE                                    10270000
090700                                                                  10280000
090800                 WHEN SQLWARN0 NOT = SPACES                       10290000
090900                 WHEN SQLCODE  NOT = ZERO                         10300000
091000                     MOVE PV-CURRENT-PARAGRAPH                    10310000
091100                                         TO AA-PARAGRAPH-NAME     10320000
091200                     MOVE                                         10330000
091300                      'UNSUCCESSFUL FETCH WITH IMPORT_BAL_CSR'    10340000
091400                                         TO AA-DB2-OPERATION      10350000
091500                     MOVE 'TIMPBAL'      TO AA-DB2-TABLE-1        10360000
091600                     MOVE SPACES         TO AA-DB2-TABLE-2        10370000
091700                                            AA-DB2-TABLE-3        10380000
091800                                            AA-DB2-TABLE-4        10390000
091900                                            AA-DB2-TABLE-5        10400000
092000                     PERFORM Z998-DB2-ABEND                       10410000
092100             END-EVALUATE                                         10420000
092200     END-PERFORM.                                                 10430000
092300                                                                  10440000
092400     IF PC-RETRY-COUNT > PC-RETRY-MAX                             10450000
092500         MOVE PV-CURRENT-PARAGRAPH                                10460000
092600                             TO AA-PARAGRAPH-NAME                 10470000
092700         MOVE 'MAX RETRIES EXCEEDED ON FETCH FOR IMPORT_BAL_CSR'  10480000
092800                             TO AA-DB2-OPERATION                  10490000
092900         MOVE 'TIMPBAL'      TO AA-DB2-TABLE-1                    10500000
093000         MOVE SPACES         TO AA-DB2-TABLE-2                    10510000
093100                                AA-DB2-TABLE-3                    10520000
093200                                AA-DB2-TABLE-4                    10530000
093300                                AA-DB2-TABLE-5                    10540000
093400         PERFORM Z998-DB2-ABEND                                   10550000
093500     END-IF.                                                      10560000
093600                                                                  10570000
093700     EVALUATE TRUE                                                10580000
093800         WHEN SQLCODE = ZEROS                                     10590000
093900              ADD 1 TO PC-IMPORT-BAL-COUNT                        10600000
094000              SET FOUND-IMPBAL    TO TRUE                         10610000
094100         WHEN SQLCODE = +100                                      10620000
094200              IF FOUND-IMPBAL                                     10630000
094300                 SET END-OF-IMPBAL-CSR TO TRUE                    10640000
094400                 MOVE ALL '9' TO IMPBAL-GL-ACCT-NBR               10650000
094500                 SET OUT-OF-IMPORTS TO TRUE                       10660000
094600              ELSE                                                10670000
094700                 SET EMPTY-IMPBAL-CSR TO TRUE                     10680000
094800              END-IF                                              10690000
094900                                                                  10700000
095000     END-EVALUATE.                                                10710000
095100 EJECT                                                            10720000
095200                                                                  10730000
095210*                                                                 10740000
095500*----------------------------------------------------------------*10890000
095600*  RETRIEVES VENDOR DATA FOR PO BEING PROCESSED.                 *10900000
095700*  CALLED FROM E200-PREPARE-IMPORT-DETAIL                        *10910000
095800*----------------------------------------------------------------*10920000
095900*                                                                 10930000
096000 S100-GET-VENDOR-INFO.                                            10940000
096100                                                                  10950000
096200     MOVE 'S100-GET-VENDOR-INFO' TO PV-CURRENT-PARAGRAPH.         10960000
096300                                                                  10970000
096400     EXEC SQL                                                     10980000
096500         SELECT  NM.ENT_NAME_DESC                                 10990000
096600                ,PR.OTB_PER_NBR                                   11000000
096700         INTO    :ENTNME-ENT-NAME-DESC                            11010000
096800                ,:PURCHS-OTB-PER-NBR                              11020000
096900         FROM    TPURCHS PR                                       11030000
097000                ,TEXTENT EX                                       11040000
097100                ,TENTNME NM                                       11050000
097200         WHERE   PR.PO_NBR   = :PV-HOLD-PO-NBR                    11060000
097300           AND   PR.ENT_ID   = EX.ENT_ID                          11070000
097400           AND   EX.ENT_ID   = NM.ENT_ID                          11080000
097500           AND   PR.ENT_ID   = NM.ENT_ID                          11090000
097600           AND   PR.VER_STATUS_CDE = 'A'                          11100000
097700           AND   EX.STATUS_CDE = 'A'                              11110000
097800           AND   NM.TYPE_CDE = '01'                               11120000
097900     END-EXEC.                                                    11130000
098000                                                                  11140000
098100     EVALUATE TRUE                                                11150000
098200         WHEN SQLCODE = ZERO                                      11160000
098300             SET GOOD-DATE TO TRUE                                11170000
098400             CONTINUE                                             11180000
098500                                                                  11190000
098600         WHEN SQLCODE = +100                                      11200000
098700             MOVE '* NO VENDOR NAME FOUND * '                     11210000
098800                                 TO ENTNME-ENT-NAME-DESC          11220000
098900             MOVE SPACES         TO EXTENT-DUN-NBR                11230000
099000             MOVE SPACES         TO DL-OTB-MONTH                  11240000
099100             MOVE '*******'      TO PURCHS-OTB-PER-NBR            11250000
099200             SET BAD-DATE TO TRUE                                 11260000
099300                                                                  11270000
099400         WHEN SQLWARN0 NOT = SPACES                               11280000
099500         WHEN SQLCODE  NOT = ZERO                                 11290000
099600             DISPLAY 'PO NUMBER = ' PV-HOLD-PO-NBR                11300000
099700             MOVE 'S100-GET-VENDOR-INFO'                          11310000
099800                                 TO AA-PARAGRAPH-NAME             11320000
099900             MOVE 'UNSUCCESSFUL SELECT'                           11330000
100000                                 TO AA-DB2-OPERATION              11340000
100100             MOVE 'TPURCHS'               TO AA-DB2-TABLE-1       11350000
100200             MOVE 'TEXTENT'               TO AA-DB2-TABLE-2       11360000
100300             MOVE 'TENTNME'               TO AA-DB2-TABLE-3       11370000
100400             INITIALIZE                      AA-DB2-TABLE-4       11380000
100500             PERFORM Z998-DB2-ABEND                               11390000
100600     END-EVALUATE.                                                11400000
100700                                                                  11410000
100800*                                                                 11420000
100900*----------------------------------------------------------------*11430000
101000*  RETRIEVES GL ACCOUNT DESCRIPTION.                             *11440000
101100*  CALLED FROM B100-INITIALIZE                                   *11450000
101200*              B200-PROCESS-INFO                                 *11460000
101300*----------------------------------------------------------------*11470000
101400*                                                                 11480000
101500 S200-GET-ACCT-DESCRIPTION.                                       11490000
101600                                                                  11500000
101700     MOVE 'S200-GET-ACCT-DESCRIPTION' TO PV-CURRENT-PARAGRAPH.    11510000
101800                                                                  11520000
101810     INITIALIZE PV-GL-ACCT-VARIABLES.                             11530000
101820                                                                  11540000
101900     EXEC SQL                                                     11550000
102000         SELECT A.DESCR                                           11560000
102100           INTO :PV-GL-ACCT-DESCR                                 11570000
102200           FROM APT_ACCT_TBL A                                    11580001
102300          WHERE A.ACCOUNT = :IMPBAL-GL-ACCT-NBR                   11590000
102400          AND   A.EFFDT =                                         11600000
102500                (SELECT MAX(A1.EFFDT)                             11610000
102600                 FROM APT_ACCT_TBL A1                             11620001
102700                 WHERE A1.ACCOUNT = A.ACCOUNT                     11630000
102800                 AND   A1.EFFDT  <= CURRENT DATE)                 11640000
102900     END-EXEC.                                                    11650000
103000                                                                  11660000
103100     EVALUATE TRUE                                                11670000
103200         WHEN SQLCODE = ZERO                                      11680000
103300              CONTINUE                                            11690000
               WHEN SQLCODE = +100                                      11701002
103500              MOVE 'DESCRIPTION UNAVAILABLE' TO PV-GL-ACCT-DESCR  11710000
               WHEN OTHER                                               11711005
                   DISPLAY 'PO NUMBER = ' PV-HOLD-PO-NBR                11713001
                   MOVE 'S200-GET-ACCT-DESCRIPTION'                     11714001
                                       TO AA-PARAGRAPH-NAME             11715001
                   MOVE 'UNSUCCESSFUL SELECT'                           11716001
                                       TO AA-DB2-OPERATION              11717001
                   MOVE 'APT_ACCT_TBL'          TO AA-DB2-TABLE-1       11718001
                   MOVE SPACES                  TO AA-DB2-TABLE-2       11719001
                   MOVE SPACES                  TO AA-DB2-TABLE-3       11719101
                   MOVE SPACES                  TO AA-DB2-TABLE-4       11719203
                   PERFORM Z998-DB2-ABEND                               11719301
103600     END-EVALUATE.                                                11720000
103700*                                                                 11730000
103800*----------------------------------------------------------------*11740000
103900*  WRITES THE HEADING OF THE IMPORT REPORT.                      *11750000
104000*  CALLED FROM W200-WRITE-ACCT-IMPRT-HEADER                      *11760000
104100*              W400-WRITE-TOTALS                                 *11770000
104200*              W500-WRITE-IMPRT-DETAIL                           *11780000
104300*----------------------------------------------------------------*11790000
104400*                                                                 11800000
104500 W100-WRITE-IMPRT-HEADING.                                        11810000
104600                                                                  11820000
104700     MOVE 'W100-WRITE-IMPRT-HEADING' TO                           11830000
104800                                       PV-CURRENT-PARAGRAPH.      11840000
104900                                                                  11850000
105000     ADD 1                            TO PC-PAGE-COUNT.           11860000
105100     MOVE PC-PAGE-COUNT               TO DP200O-PAGE-NUMBER.      11870000
105200                                                                  11880000
105300     WRITE IMPORT-ACCT-RPT-REC                                    11890000
105400           FROM DP200O-STANDRD-HEADER-200-COLS AFTER PAGE.        11900000
105500                                                                  11910000
105600     WRITE IMPORT-ACCT-RPT-REC FROM H1-IMPORT-ACCT-HEADER1        11920000
105700                                       AFTER 2.                   11930000
105800     WRITE IMPORT-ACCT-RPT-REC FROM H2-IMPORT-ACCT-HEADER2        11940000
105900                                       AFTER 2.                   11950000
106000     MOVE 5 TO PC-LINE-COUNT.                                     11960000
106100                                                                  11970000
106200*----------------------------------------------------------------*11980000
106300*  WRITES THE ACCOUNT DETAIL OF THE IMPORT REPORT.               *11990000
106400*  CALLED FROM E100-PREPARE-ACCT-DETAIL                          *12000000
106500*----------------------------------------------------------------*12010000
106600*                                                                 12020000
106700 W200-WRITE-ACCT-IMPRT-HEADER.                                    12030000
106800                                                                  12040000
106900     MOVE 'W200-WRITE-ACCT-IMPRT-HEADER' TO                       12050000
107000                                       PV-CURRENT-PARAGRAPH.      12060000
107100                                                                  12070000
107200     IF PC-LINE-COUNT > PC-MAX-LINES                              12080000
107300         PERFORM W100-WRITE-IMPRT-HEADING                         12090000
107400     END-IF.                                                      12100000
107500                                                                  12110000
107600     WRITE IMPORT-ACCT-RPT-REC FROM                               12120000
107700                      DH1-IMPORT-ACCT-DETAIL-HEADER1 AFTER 2.     12130000
107800     ADD 1  TO PC-LINE-COUNT.                                     12140000
107900                                                                  12150000
108000*                                                                 12160000
108100*----------------------------------------------------------------*12170000
108200*  WRITES THE IMPORT ACCOUNT DETAIL HEADERS.                     *12180000
108300*  CALLED FROM E100-PREPARE-ACCT-DETAIL                          *12190000
108400*----------------------------------------------------------------*12200000
108500*                                                                 12210000
108600 W300-WRITE-IMPRT-DETAIL-HEADER.                                  12220000
108700                                                                  12230000
108800     MOVE 'W300-WRITE-DETAIL-HEADER' TO PV-CURRENT-PARAGRAPH.     12240000
108900                                                                  12250000
109000     IF PC-LINE-COUNT > PC-MAX-LINES                              12260000
109100         PERFORM W100-WRITE-IMPRT-HEADING                         12270000
109200     END-IF.                                                      12280000
109300                                                                  12290000
109400     WRITE IMPORT-ACCT-RPT-REC FROM DH2-IMPORT-DETAIL-HEADER2     12300000
109500                                       AFTER 2.                   12310000
109600                                                                  12320000
109700     WRITE IMPORT-ACCT-RPT-REC FROM DH3-IMPORT-DETAIL-HEADER3     12330000
109800                                              AFTER 1.            12340000
109900     ADD 3  TO PC-LINE-COUNT.                                     12350000
110000                                                                  12360000
110100*                                                                 12370000
110200*----------------------------------------------------------------*12380000
110300*  WRITES THE IMPORT ACCOUNT REPORT TOTALS.                      *12390000
110400*  CALLED FROM D300-DETERMINE-IMPORT-TOTALS                      *12400000
110500*----------------------------------------------------------------*12410000
110600*                                                                 12420000
110700 W400-WRITE-TOTALS.                                               12430000
110800                                                                  12440000
110900     MOVE 'W400-WRITE-TOTALS' TO PV-CURRENT-PARAGRAPH.            12450000
111000                                                                  12460000
111100     IF PC-LINE-COUNT > PC-MAX-LINES                              12470000
111200         PERFORM W100-WRITE-IMPRT-HEADING                         12480000
111300     END-IF.                                                      12490000
111400                                                                  12500000
111500     WRITE IMPORT-ACCT-RPT-REC FROM SL-IMPORT-ACCT-SUMMARY-LINE   12510000
111600                                    AFTER 2.                      12520000
111700     ADD 2  TO PC-LINE-COUNT.                                     12530000
111800                                                                  12540000
111900*                                                                 12550000
112000*----------------------------------------------------------------*12560000
112100*  WRITES THE IMPORT ACCOUNT DETAIL INFORMATION.                 *12570000
112200*  CALLED FROM E200-PREPARE-IMPORT-DETAIL                        *12580000
112300*----------------------------------------------------------------*12590000
112400*                                                                 12600000
112500 W500-WRITE-IMPRT-DETAIL.                                         12610000
112600                                                                  12620000
112700     MOVE 'W500-WRITE-IMPRT-DETAIL' TO PV-CURRENT-PARAGRAPH.      12630000
112800                                                                  12640000
112900     IF PC-LINE-COUNT > PC-MAX-LINES                              12650000
113000         PERFORM W100-WRITE-IMPRT-HEADING                         12660000
113100         PERFORM W300-WRITE-IMPRT-DETAIL-HEADER                   12670000
113200     END-IF.                                                      12680000
113300                                                                  12690000
113400     WRITE IMPORT-ACCT-RPT-REC FROM DL-IMPORT-ACCT-DETAIL-LINE    12700000
113500                                    AFTER 1.                      12710000
113600                                                                  12720000
113700     ADD 1  TO PC-LINE-COUNT.                                     12730000
113800                                                                  12740000
113900*                                                                 12750000
114000*----------------------------------------------------------------*12760000
114100*  WRITES THE EXCEPTION REPORT HEADER INFORMATION.               *12770000
114200*  CALLED FROM B100-INITIALIZE                                   *12780000
114300*              W700-WRITE-EXCEPTION-DETAIL                       *12790000
114400*----------------------------------------------------------------*12800000
114500*                                                                 12810000
114600 W600-WRITE-EXCEPTION-HEADER.                                     12820000
114700                                                                  12830000
114800     MOVE 'W600-WRITE-EXCEPTION-HEADER' TO                        12840000
114900                                       PV-CURRENT-PARAGRAPH.      12850000
115000                                                                  12860000
115100     ADD 1                            TO PC-EXCEPT-PAGE-COUNT.    12870000
115200     MOVE PC-EXCEPT-PAGE-COUNT        TO DP132O-PAGE-NUMBER.      12880000
115300                                                                  12890000
115400     WRITE IMPORT-EXCEPT-RPT-REC                                  12900000
115500           FROM DP132O-STANDRD-HEADER-132-COLS AFTER PAGE.        12910000
115600                                                                  12920000
115700     WRITE IMPORT-EXCEPT-RPT-REC FROM H1-EXCEPTION-HEADER1        12930000
115800                                       AFTER 2.                   12940000
115900     WRITE IMPORT-EXCEPT-RPT-REC FROM H2-EXCEPTION-HEADER2        12950000
116000                                       AFTER 1.                   12960000
116100     WRITE IMPORT-EXCEPT-RPT-REC FROM                             12970000
116200                         DH1-EXCEPTION-DETAIL-HEADER1 AFTER 2.    12980000
116300     WRITE IMPORT-EXCEPT-RPT-REC FROM                             12990000
116400                         DH2-EXCEPTION-DETAIL-HEADER2 AFTER 1.    13000000
116500     MOVE 8 TO PC-EXCEPT-LINE-COUNT.                              13010000
116600                                                                  13020000
116700*                                                                 13030000
116800*----------------------------------------------------------------*13040000
116900*  WRITES THE EXCEPTION REPORT DETAIL INFORMATION.               *13050000
117000*  CALLED FROM D100-DEVELOP-EXCEPTION-REPORT                     *13060000
117100*----------------------------------------------------------------*13070000
117200*                                                                 13080000
117300 W700-WRITE-EXCEPTION-DETAIL.                                     13090000
117400                                                                  13100000
117500     MOVE 'W700-WRITE-EXCEPTION-DETAIL' TO PV-CURRENT-PARAGRAPH.  13110000
117600                                                                  13120000
117700     IF PC-EXCEPT-LINE-COUNT > PC-EXCEPT-MAX-LINES                13130000
117800         PERFORM W600-WRITE-EXCEPTION-HEADER                      13140000
117900     END-IF.                                                      13150000
118000                                                                  13160000
118100     WRITE IMPORT-EXCEPT-RPT-REC FROM EDL-EXCEPTION-DETAIL-LINE   13170000
118200                                       AFTER 2.                   13180000
118300     ADD 2  TO PC-EXCEPT-LINE-COUNT.                              13190000
118400*                                                                 13200000
118500*----------------------------------------------------------------*13210000
118600*    OPENS THE IMPORT BALANCE CURSOR.                            *13220000
118700*    CALLED FROM B100-INITIALIZE                                 *13230000
118800*----------------------------------------------------------------*13240000
118900*                                                                 13250000
119000 Y100-OPEN-IMPORT-BAL-CSR.                                        13260000
119100                                                                  13270000
119200     MOVE 'Y100-OPEN-IMPORT-BAL-CSR' TO PV-CURRENT-PARAGRAPH.     13280000
119300                                                                  13290000
119400     PERFORM WITH TEST AFTER                                      13300000
119500             VARYING PC-RETRY-COUNT FROM 1 BY 1                   13310000
119600             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX OR             13320000
119700                     SQLCODE = ZERO OR                            13330000
119800                     SQLCODE = +100                               13340000
119900                                                                  13350000
120000             EXEC SQL                                             13360000
120100                 OPEN IMPORT_BAL_CSR                              13370000
120200             END-EXEC                                             13380000
120300                                                                  13390000
120400             EVALUATE TRUE                                        13400000
120500                 WHEN SQLCODE = ZERO                              13410000
120600                 WHEN SQLCODE = +100                              13420000
120700                 WHEN SQLCODE = -904                              13430000
120800                 WHEN SQLCODE = -913                              13440000
120900                      CONTINUE                                    13450000
121000                                                                  13460000
121100                 WHEN SQLWARN0 NOT = SPACES                       13470000
121200                 WHEN SQLCODE  NOT = ZERO                         13480000
121300                     MOVE PV-CURRENT-PARAGRAPH                    13490000
121400                                         TO AA-PARAGRAPH-NAME     13500000
121500                     MOVE 'UNSUCCESSFUL OPEN ON IMPORT_BAL_CSR'   13510000
121600                                         TO AA-DB2-OPERATION      13520000
121700                     MOVE 'TIMPBAL'      TO AA-DB2-TABLE-1        13530000
121800                     MOVE SPACES         TO AA-DB2-TABLE-2        13540000
121900                     MOVE SPACES         TO AA-DB2-TABLE-3        13550000
122000                                            AA-DB2-TABLE-4        13560000
122100                                            AA-DB2-TABLE-5        13570000
122200                     PERFORM Z998-DB2-ABEND                       13580000
122300             END-EVALUATE                                         13590000
122400     END-PERFORM.                                                 13600000
122500                                                                  13610000
122600     IF PC-RETRY-COUNT > PC-RETRY-MAX                             13620000
122700         MOVE PV-CURRENT-PARAGRAPH                                13630000
122800                             TO AA-PARAGRAPH-NAME                 13640000
122900         MOVE 'MAX RETRIES EXCEEDED ON OPEN FOR IMPORT_BAL_CSR'   13650000
123000                             TO AA-DB2-OPERATION                  13660000
123100         MOVE 'TIMPBAL'      TO AA-DB2-TABLE-1                    13670000
123200         MOVE SPACES         TO AA-DB2-TABLE-2                    13680000
123300         MOVE SPACES         TO AA-DB2-TABLE-3                    13690000
123400                                AA-DB2-TABLE-4                    13700000
123500                                AA-DB2-TABLE-5                    13710000
123600         PERFORM Z998-DB2-ABEND                                   13720000
123700     END-IF.                                                      13730000
123800                                                                  13740000
123900*                                                                 13750000
124000*----------------------------------------------------------------*13760000
124100*    CLOSES THE IMPORT BALANCE CURSOR.                           *13770000
124200*    CALLED FROM B300-END-PROGRAM                                *13780000
124300*----------------------------------------------------------------*13790000
124400*                                                                 13800000
124500 Y110-CLOSE-IMPORT-BAL-CSR.                                       13810000
124600                                                                  13820000
124700     MOVE 'Y110-CLOSE-IMPORT-BAL-CSR' TO PV-CURRENT-PARAGRAPH.    13830000
124800                                                                  13840000
124900     PERFORM WITH TEST AFTER                                      13850000
125000             VARYING PC-RETRY-COUNT FROM 1 BY 1                   13860000
125100             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX OR             13870000
125200                     SQLCODE = ZERO OR                            13880000
125300                     SQLCODE = +100                               13890000
125400                                                                  13900000
125500             EXEC SQL                                             13910000
125600                 CLOSE IMPORT_BAL_CSR                             13920000
125700             END-EXEC                                             13930000
125800                                                                  13940000
125900             EVALUATE TRUE                                        13950000
126000                 WHEN SQLCODE = ZERO                              13960000
126100                 WHEN SQLCODE = -904                              13970000
126200                 WHEN SQLCODE = -913                              13980000
126300                      CONTINUE                                    13990000
126400                                                                  14000000
126500                 WHEN SQLWARN0 NOT = SPACES                       14010000
126600                 WHEN SQLCODE  NOT = ZERO                         14020000
126700                     MOVE PV-CURRENT-PARAGRAPH                    14030000
126800                                         TO AA-PARAGRAPH-NAME     14040000
126900                     MOVE 'UNSUCCESSFUL CLOSE ON IMPORT_BAL_CSR'  14050000
127000                                         TO AA-DB2-OPERATION      14060000
127100                     MOVE 'TIMPBAL'      TO AA-DB2-TABLE-1        14070000
127200                     MOVE SPACES         TO AA-DB2-TABLE-2        14080000
127300                     MOVE SPACES         TO AA-DB2-TABLE-3        14090000
127400                                            AA-DB2-TABLE-4        14100000
127500                                            AA-DB2-TABLE-5        14110000
127600                     PERFORM Z998-DB2-ABEND                       14120000
127700             END-EVALUATE                                         14130000
127800     END-PERFORM.                                                 14140000
127900                                                                  14150000
128000     IF PC-RETRY-COUNT > PC-RETRY-MAX                             14160000
128100         MOVE PV-CURRENT-PARAGRAPH                                14170000
128200                             TO AA-PARAGRAPH-NAME                 14180000
128300         MOVE 'MAX RETRIES EXCEEDED ON CLOSE FOR IMPORT_BAL_CSR'  14190000
128400                             TO AA-DB2-OPERATION                  14200000
128500         MOVE 'TIMPBAL'      TO AA-DB2-TABLE-1                    14210000
128600         MOVE SPACES         TO AA-DB2-TABLE-2                    14220000
128700         MOVE SPACES         TO AA-DB2-TABLE-3                    14230000
128800                                AA-DB2-TABLE-4                    14240000
128900                                AA-DB2-TABLE-5                    14250000
129000         PERFORM Z998-DB2-ABEND                                   14260000
129100     END-IF.                                                      14270000
129200                                                                  14280000
129300 EJECT                                                            14290000
129400*                                                                 14300000
129500*----------------------------------------------------------------*14310000
129600*    ABEND ROUTINE FOR DB2 ERRORS                                *14320000
129700*----------------------------------------------------------------*14330000
129800*                                                                 14340000
129900 Z998-DB2-ABEND.                                                  14350000
130000                                                                  14360000
130100     CLOSE IMPORT-ACCT-RPT-FILE                                   14370000
130200           IMPORT-EXCEPT-RPT-FILE .                               14380003
130300     DISPLAY AA-ABEND-LIT.                                        14400000
130400     DISPLAY AA-DB2-ERROR-LIT.                                    14410000
130500     DISPLAY AA-PROGRAM-LIT.                                      14420000
130600     DISPLAY AA-PARAGRAPH-LIT.                                    14430000
130700     DISPLAY AA-DB2-OPERATION-LIT.                                14440000
130800     DISPLAY AA-DB2-TABLE-1.                                      14450000
130900     DISPLAY AA-DB2-TABLE-2.                                      14460000
131000     DISPLAY AA-DB2-TABLE-3.                                      14470000
131100     DISPLAY AA-DB2-TABLE-4.                                      14480000
131200     SET AC-DB2-ERROR TO TRUE.                                    14490000
131300                                                                  14500000
131400     COPY DPPD004.                                                14510000
131500                                                                  14520000
131600     CALL 'ILBOABN0' USING ABEND-CODE.                            14530000
131700 EJECT                                                            14540000
131800*                                                                 14550000
131900*----------------------------------------------------------------*14560000
132000*    ABEND ROUTINE                                               *14570000
132100*----------------------------------------------------------------*14580000
132200*                                                                 14590000
132300 Z999-ABEND.                                                      14600000
132400                                                                  14610000
132500     CLOSE IMPORT-ACCT-RPT-FILE                                   14620000
132600           IMPORT-EXCEPT-RPT-FILE.                                14630003
132700     DISPLAY AA-ABEND-LIT.                                        14650000
132800     DISPLAY AA-PROGRAM-LIT.                                      14660000
132900     DISPLAY AA-PARAGRAPH-LIT.                                    14670000
133000     DISPLAY AA-MESSAGE-LINE.                                     14680000
133100     CALL 'ILBOABN0' USING ABEND-CODE.                            14690000
