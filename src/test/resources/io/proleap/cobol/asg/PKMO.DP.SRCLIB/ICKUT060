000100 IDENTIFICATION DIVISION.                                         00010030
000200 PROGRAM-ID.      ICKUT060.                                       00020030
000300 AUTHOR.          MARGARET MORRISON.                              00030030
000400 DATE-WRITTEN.    APRIL 2008.                                     00040030
000500                                                                  00050030
000600*--------------------------------------------------------------*  00060030
000700* DESCRIPTION:                                                 *  00070030
000800*      THIS PROGRAM WILL CALCULATE ONHANDS COUNT VARIANCE      *  00080030
000900*      ADJUSTMENT AMOUNTS TO BE SENT TO FASHION SALES.         *  00090030
001000*                                                              *  00100030
001100* INPUTS:                                                      *  00110030
001200*      YES                                                     *  00120030
001300*                                                              *  00130030
001400* OUTPUTS:                                                     *  00140030
001500*      YES                                                     *  00150030
001600*--------------------------------------------------------------*  00160030
001700*--------------------------------------------------------------*  00170030
001800* HISTORY LOG:                                                    00180030
001900*--------------------------------------------------------------*  00190030
002000* DATE:        04/2008                                            00200030
002100* WR/IR#:      WR30388(USA INVENTORY COUNTS)                      00210030
002200* PROGRAMMER:  MARGARET MORRISON                                  00220030
002300* DESCRIPTION: INITIAL PROGRAM WRITE.                             00230030
002400*--------------------------------------------------------------*  00240030
080703* DATE:  07/03/2008                                               00250030
080704* WR/IR#:  WR30388                                                00260030
080705* PROGRAMMER: DAVID WELLER                                        00270030
080706* DESCRIPTION:  SET RELATED SIGN FIELD FOR FS035-ADJ-QTY          00280030
080707*          TO FS035-ACTN-NEG OR FS035-ACTN-PLS.                   00290030
080708*          USE ABSOLUTE VALUE IN FS035-ADJ-QTY FIELD ITSELF.      00300030
111890*--------------------------------------------------------------*  00310037
111890* 05/21/2015 CHANGED BY:  JIM HUNTER        CHG0111890            00320038
111890* DESCRIPTION: CHANGED FOR RFID PROJECT.  ADDING CNT-TYP-CDE      00330037
111890*              TO INPUT FILE.  IF IT IS 'ICC' MOVE 'RFID' TO      00340037
111890*              OUTPUT BATCH NUMBER, ELSE CONTINUE TO MOVE '9988'  00350037
111890*              FOR USA.                                           00360037
111890*              THE BATCH NBR WILL BE USED IN FASHION PROGRAMS TO  00370037
111890*              DISTINGUISH RFID COUNTS FROM USA COUNTS ON THE     00380037
111890*              FASHION REPORTS.                                   00390037
111890*--------------------------------------------------------------*  00391040
C32847* 03/03/2016 CHANGED BY:  COGNIZANT         CHG0132847            00392040
C32847* DESCRIPTION: CHANGED THE FORMULA TO CALCULATE                   00393040
C32847*              PV-ADJ-QTY-AUT-APP AND PV-ADJ-QTY-REV.             00394041
080709*--------------------------------------------------------------*  00400030
080710 ENVIRONMENT DIVISION.                                            00410030
080720*--------------------------------------------------------------*  00420030
080730 CONFIGURATION SECTION.                                           00430030
080740 SOURCE-COMPUTER.        IBM-3090.                                00440030
080750 OBJECT-COMPUTER.        IBM-3090.                                00450030
080760                                                                  00460030
080770 INPUT-OUTPUT SECTION.                                            00470030
080780                                                                  00480030
080790 FILE-CONTROL.                                                    00490030
080800                                                                  00500030
080900     SELECT ICRD061-UPD-COUNTS-FILE                               00510030
081000         ASSIGN TO INP01.                                         00520030
081100                                                                  00530030
081200     SELECT FSRD035-FS-ADJUST-FILE                                00540030
081300         ASSIGN TO OUT01.                                         00550030
081400                                                                  00560030
081500******************************************************************00570030
081600 DATA DIVISION.                                                   00580030
081700******************************************************************00590030
081800                                                                  00600030
081900 FILE SECTION.                                                    00610030
082000                                                                  00620030
082100 FD  ICRD061-UPD-COUNTS-FILE                                      00630030
082200     RECORDING MODE IS F                                          00640030
082300     LABEL RECORDS ARE STANDARD                                   00650030
082400     BLOCK CONTAINS 0 RECORDS.                                    00660030
082500                                                                  00670030
082600 01  ICRD061-UPD-COUNTS-RECORD       PIC X(100).                  00680030
082700                                                                  00690030
082800 FD  FSRD035-FS-ADJUST-FILE                                       00700030
082900     RECORDING MODE IS F                                          00710030
083000     LABEL RECORDS ARE STANDARD                                   00720030
083100     BLOCK CONTAINS 0 RECORDS.                                    00730030
083200                                                                  00740030
083300 01  FSRD035-FS-ADJUST-RECORD        PIC X(200).                  00750030
083400                                                                  00760030
083500 WORKING-STORAGE SECTION.                                         00770030
083600*--------------------------------------------------------------*  00780030
083700* PS - PROGRAM SWITCHES                                           00790030
083800*--------------------------------------------------------------*  00800030
083900 01  PS-PROGRAM-SWITCHES.                                         00810030
084000     05  PS-END-OF-FILE-SW           PIC  X(001).                 00820030
084100         88  PS-END-OF-FILE                       VALUE 'Y'.      00830030
084200         88  PS-END-OF-FILE-NO                    VALUE 'N'.      00840030
084300                                                                  00850030
084400*--------------------------------------------------------------*  00860030
084500* PROGRAM CONSTANTS                                               00870030
084600*--------------------------------------------------------------*  00880030
084700 01  PC-PROGRAM-CONSTANTS.                                        00890030
084800     05  PC-PROGRAM-NAME          PIC X(08) VALUE 'ICKUT060'.     00900030
084900     05  PC-MAX-RETRIES           PIC 9(9)  VALUE 5.              00910030
085000     05  PC-AUT                   PIC X(03) VALUE 'AUT'.          00920030
085100     05  PC-APP                   PIC X(03) VALUE 'APP'.          00930030
085200     05  PC-REV                   PIC X(03) VALUE 'REV'.          00940030
085300     05  PC-SYSTEM                PIC X(06) VALUE 'SYSTEM'.       00950030
085400                                                                  00960030
085500*--------------------------------------------------------------*  00970030
085600* PV- PROGRAM VARIABLES                                           00980030
085700*--------------------------------------------------------------*  00990030
085800 01  PV-PROGRAM-VARAIBLES.                                        01000030
085900     05  PV-PARAGRAPH-NAME        PIC X(40)   VALUE SPACES.       01010030
086000     05  PD-DB2-OPERATION         PIC X(15)   VALUE SPACES.       01020030
086100                                                                  01030030
086200     05  PV-SQL-SUB               PIC S9(09)  VALUE 0  COMP.      01040030
086300     05  PV-RETRY                 PIC 9999    VALUE 0  COMP.      01050030
086400     05  PV-ABEND-CODE            PIC 9999    VALUE 0  COMP.      01060030
086500     05  PV-CALC-DB2-DATE         PIC  X(10)  VALUE SPACES.       01070030
086600     05  PV-CALC-NBR-DAYS         PIC  9(05)  VALUE 0.            01080030
086700     05  PV-SUM-ONHAND            PIC S9(09)  VALUE +0 COMP.      01090030
086800     05  PV-SUM-SCANNED           PIC S9(09)  VALUE +0 COMP.      01100030
086900     05  PV-SUM-SLD-QTY           PIC S9(09)  VALUE +0 COMP.      01110030
087000     05  PV-SUM-RET-QTY           PIC S9(09)  VALUE +0 COMP.      01120030
087100     05  PV-XFER-IN-QTY           PIC S9(09)  VALUE +0 COMP.      01130030
087200     05  PV-XFER-OUT-QTY          PIC S9(09)  VALUE +0 COMP.      01140030
087300                                                                  01150030
087400     05  PV-ADJ-QTY-AUT-APP       PIC S9(09)  VALUE +0 COMP.      01160030
087500     05  PV-ADJ-QTY-REV           PIC S9(09)  VALUE +0 COMP.      01170030
087600     05  PV-ADJ-QTY               PIC S9(09)  VALUE +0 COMP.      01180030
087700                                                                  01190030
087800     05  PV-CURRENT-TMST          PIC X(26)   VALUE SPACES.       01200030
087900     05  PV-CURRENT-DATE          PIC X(10)   VALUE SPACES.       01210030
088000     05  PV-SALES-DATE            PIC X(10)   VALUE SPACES.       01220030
088100     05  PV-EXEC-TMST             PIC X(26)   VALUE SPACES.       01230030
088200                                                                  01240030
088300     05  PV-TIMEZONE-TMST         PIC X(26)   VALUE SPACES.       01250030
088400                                                                  01260030
088500     05  PV-THRS-HIER-VAL         PIC S9(04)  VALUE +0 COMP.      01270030
088600                                                                  01280030
088700*--------------------------------------------------------------*  01290030
088800* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         01300030
088900*--------------------------------------------------------------*  01310030
089000     COPY DPWS004.                                                01320030
089100                                                                  01330030
089200*--------------------------------------------------------------*  01340030
089300* DATE ROUTINE COPY MEMBERS                                       01350030
089400*--------------------------------------------------------------*  01360030
089500     COPY DPWS500.                                                01370030
089600                                                                  01380030
089700*--------------------------------------------------------------*  01390030
089800* DB2 ABEND COPYBOOK                                              01400030
089900*--------------------------------------------------------------*  01410030
090000     COPY DPWS900.                                                01420030
090100                                                                  01430030
090200*--------------------------------------------------------------*  01440030
090300* DB2 MESSAGE AREA                                                01450030
090400*--------------------------------------------------------------*  01460030
090500     COPY SQLCA2.                                                 01470030
090600                                                                  01480030
090700*--------------------------------------------------------------*  01490030
090800* PROGRAM COUNTERS                                                01500030
090900*--------------------------------------------------------------*  01510030
091000 01  PV-PROGRAM-COUNTERS         COMP-3.                          01520030
091100     05  PV-NUMBER-OF-RETRIES     PIC 9(9) VALUE 0.               01530030
091200     05  PV-INPUT-CNT             PIC 9(9) VALUE 0.               01540030
091300     05  PV-CNT-SINCE-COMMIT      PIC 9(9) VALUE 0.               01550030
091400     05  PV-FS-REC-CNT            PIC 9(9) VALUE 0.               01560030
091500     05  PV-SELECT-ITM-NBR-CNT    PIC 9(9) VALUE 0.               01570030
091600                                                                  01580030
091700*--------------------------------------------------------------*  01590030
091800* ERROR HANDLING                                                  01600030
091900*--------------------------------------------------------------*  01610030
092000 01  PV-MISC-ABEND-FIELDS.                                        01620030
092100     05  PV-OPERATION-MSG-1      PIC X(40) VALUE SPACES.          01630030
092200     05  PV-OPERATION-MSG-2      PIC X(40) VALUE SPACES.          01640030
092300     05  PV-DB2-OPERATION        PIC X(30) VALUE SPACES.          01650030
092400                                                                  01660030
092500 01  ABEND-CODE                  PIC S9(4) VALUE 0  COMP SYNC.    01670030
092600     88  ABEND-4003-CTRL-CARD-ERROR        VALUE +4003.           01680030
092700     88  ABEND-4013-DB2-ERROR              VALUE +4013.           01690030
092800     88  ABEND-4019-CAL-SUB-ERROR          VALUE +4019.           01700030
092900     88  ABEND-4020-MQ-ERROR               VALUE +4020.           01710030
093000     88  ABEND-4444-FORCED-ABEND           VALUE +4444.           01720030
093100     88  ABEND-4008                        VALUE +4008.           01730030
093200     88  ABEND-4005                        VALUE +4005.           01740030
093300                                                                  01750030
093800                                                                  01760030
093900************************************************************      01770030
094000*    FASHION SALES ADJUSTMENTS FILE LAYOUT                        01780030
094100************************************************************      01790030
094200     COPY FSRD035.                                                01800030
094300                                                                  01810030
094400************************************************************      01820030
094500*    USA INVENTORY COUNTS UPDATED APPROVED COMPLETED COUNTS       01830030
094600*    FILE LAYOUT.                                                 01840030
094700************************************************************      01850030
094800     COPY ICRD061.                                                01860030
094900                                                                  01870030
095000******************************************************************01880030
095100* TABLE DECLARATIONS FOR TSKST                                    01890030
095200******************************************************************01900030
095300     EXEC SQL                                                     01910030
095400         INCLUDE TSKST                                            01920030
095500     END-EXEC.                                                    01930030
095600                                                                  01940030
095700******************************************************************01950030
095800* TABLE DECLARATIONS FOR TSKXREF                                  01960030
095900******************************************************************01970030
096000     EXEC SQL                                                     01980030
096100         INCLUDE TSKXREF                                          01990030
096200     END-EXEC.                                                    02000030
096300                                                                  02010030
096400*--------------------------------------------------------------*  02020030
096500* DB2 COMMUNICATIONS AREA                                         02030030
096600*--------------------------------------------------------------*  02040030
096700     EXEC SQL                                                     02050030
096800       INCLUDE SQLCA                                              02060030
096900     END-EXEC.                                                    02070030
097000                                                                  02080030
097100                                                                  02090030
097200 LINKAGE SECTION.                                                 02100030
097300                                                                  02110030
097400*--------------------------------------------------------------*  02120030
097500 PROCEDURE DIVISION.                                              02130030
097600*--------------------------------------------------------------*  02140030
097700 0000-MAINLINE.                                                   02150030
097800                                                                  02160030
097900     PERFORM 1000-INITIALIZATION.                                 02170030
098000                                                                  02180030
098100     PERFORM 2000-PROCESS-COUNTS                                  02190030
098200       UNTIL PS-END-OF-FILE.                                      02200030
098300                                                                  02210030
098400     PERFORM 9000-COMMIT.                                         02220030
098500                                                                  02230030
098600     PERFORM 9999-WRAPUP.                                         02240030
098700                                                                  02250030
098800     GOBACK.                                                      02260030
098900                                                                  02270030
099000*0000-EXIT.                                                       02280030
099100                                                                  02290030
099200*--------------------------------------------------------------*  02300030
099300* 1000-INITIALIZATION.                                            02310030
099400*     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      02320030
099500*     FILES, READS CONTROL CARDS, AND PROCESSES ANY INPUT FILE    02330030
099600*     PARAMETERS IT MAY NEED.                                     02340030
099700*--------------------------------------------------------------*  02350030
099800 1000-INITIALIZATION.                                             02360030
099900     DISPLAY ' '.                                                 02370030
100000     DISPLAY '*********************************************'.     02380030
100100     DISPLAY '   START OF PROGRAM NAME: ' PC-PROGRAM-NAME.        02390030
100200     DISPLAY '*********************************************'.     02400030
100300     DISPLAY ' '.                                                 02410030
100400                                                                  02420030
100500     OPEN INPUT  ICRD061-UPD-COUNTS-FILE                          02430030
100600          OUTPUT FSRD035-FS-ADJUST-FILE.                          02440030
100700                                                                  02450030
100800     INITIALIZE FS035-ADJUSTMENT-RECORD.                          02460030
100900                                                                  02470030
101000     INITIALIZE PV-ADJ-QTY-AUT-APP,                               02480030
101100                PV-ADJ-QTY-REV,                                   02490030
101200                PV-ADJ-QTY.                                       02500030
101300                                                                  02510030
101400     SET PS-END-OF-FILE-NO TO TRUE.                               02520030
101500                                                                  02530030
101600     EXEC SQL                                                     02540030
101700         SET :PV-CURRENT-DATE = CURRENT DATE                      02550030
101800     END-EXEC.                                                    02560030
101900                                                                  02570030
102000     EXEC SQL                                                     02580030
102100         SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                 02590030
102200     END-EXEC.                                                    02600030
102300                                                                  02610030
102400     PERFORM 2100-READ-INPUT-FILE.                                02620030
102500                                                                  02630030
102600*1000-EXIT.                                                       02640030
102700                                                                  02650030
102800*--------------------------------------------------------------*  02660030
102900* 2000-PROCESS-COUNTS.                                         *  02670030
103000*  PROCESS COMPLETED COUNTS                                    *  02680030
103100*--------------------------------------------------------------*  02690030
103200 2000-PROCESS-COUNTS.                                             02700030
103300                                                                  02710030
104000     PERFORM 2200-CALC-ADJUST.                                    02720030
104100                                                                  02730030
104200     PERFORM 2100-READ-INPUT-FILE.                                02740030
104300                                                                  02750030
104400*--------------------------------------------------------------*  02760030
104500* 2100-READ-INPUT-FILE.                                        *  02770030
104600*  READ THE INPUT FILE                                         *  02780030
104700*--------------------------------------------------------------*  02790030
104800 2100-READ-INPUT-FILE.                                            02800030
104900                                                                  02810030
105600     READ ICRD061-UPD-COUNTS-FILE                                 02820030
105700         INTO ICRD061-UPDATED-COUNTS-RECORD                       02830030
105800         AT END                                                   02840030
105900           SET PS-END-OF-FILE TO TRUE.                            02850030
106000                                                                  02860030
106100     IF PS-END-OF-FILE                                            02870030
106200        DISPLAY '* NO MORE COUNTS TO PROCESS *'                   02880030
106300     ELSE                                                         02890030
106400         ADD +1 TO PV-INPUT-CNT                                   02900030
106500     END-IF.                                                      02910030
106600                                                                  02920030
106700*--------------------------------------------------------------*  02930030
106800* 2200-CALC-ADJUST.                                            *  02940030
106900*  CALCULATE ADJUSTMENTS BASED ON STATUS TYPE FOR FASHION SALES*  02950030
107000*--------------------------------------------------------------*  02960030
107100 2200-CALC-ADJUST.                                                02970030
107800                                                                  02980030
107900     EVALUATE ICRD061-CNT-STAT-CDE                                02990030
108000         WHEN PC-AUT                                              03000030
108100         WHEN PC-APP                                              03010030
108200             PERFORM 2210-CALC-FOR-AUT-APP                        03020030
108300         WHEN PC-REV                                              03030030
108400             PERFORM 2220-CALC-FOR-REV                            03040030
108500     END-EVALUATE.                                                03050030
108600                                                                  03060030
108700     IF PV-ADJ-QTY = ZERO                                         03070030
108800        CONTINUE                                                  03080030
108900     ELSE                                                         03090030
109000         PERFORM 2300-SELECT-ITM-NBR                              03100030
109100         PERFORM 3000-POPULATE-FS-REC-FIELDS                      03110030
109200         PERFORM 3010-WRITE-FS-OUTPUT-REC                         03120030
109300     END-IF.                                                      03130030
109400                                                                  03140030
109500*--------------------------------------------------------------*  03150030
109600* 2210-CALC-FOR-AUT-APP.                                       *  03160030
109700*  CALCULATE ADJUSTMENTS FOR AUTO APPROVED AND APPROVED COUNTS.*  03170030
109800*--------------------------------------------------------------*  03180030
109900 2210-CALC-FOR-AUT-APP.                                           03190030
110000                                                                  03200030
110700     INITIALIZE PV-ADJ-QTY-AUT-APP,                               03210030
110800                PV-ADJ-QTY.                                       03220030
110900                                                                  03230030
C32847     COMPUTE PV-ADJ-QTY-AUT-APP =                                 03240041
C32847         (ICRD061-SCANNED-UNT-QTY - ICRD061-START-ONHAND-QTY) +   03250041
C32847         (ICRD061-SALES-QTY - ICRD061-RETURNS-QTY)                03260040
111300                                                                  03270030
111400     MOVE PV-ADJ-QTY-AUT-APP TO PV-ADJ-QTY.                       03280030
111500                                                                  03290030
111600*--------------------------------------------------------------*  03300030
111700* 2220-CALC-FOR-REV.                                           *  03310030
111800*  CALCULATE ADJUSTMENTS FOR REVERSALS.                        *  03320030
111900*--------------------------------------------------------------*  03330030
112000 2220-CALC-FOR-REV.                                               03340030
112100                                                                  03350030
112800     INITIALIZE PV-ADJ-QTY-REV,                                   03360030
112900                PV-ADJ-QTY.                                       03370030
113000                                                                  03380030
C32847     COMPUTE PV-ADJ-QTY-REV =                                     03390041
C32847        ((ICRD061-SCANNED-UNT-QTY - ICRD061-START-ONHAND-QTY) +   03400041
C32847         (ICRD061-SALES-QTY - ICRD061-RETURNS-QTY)) * -1.         03410040
113400                                                                  03420030
113500     MOVE PV-ADJ-QTY-REV TO PV-ADJ-QTY.                           03430030
113600                                                                  03440030
113700*--------------------------------------------------------------*  03450030
113800* 2300-SELECT-ITM-NBR.                                         *  03460030
113900*  SELECT ITEM NUMBER.                                         *  03470030
114000*--------------------------------------------------------------*  03480030
114100 2300-SELECT-ITM-NBR.                                             03490030
114200                                                                  03500030
114900     PERFORM                                                      03510030
115000        WITH TEST AFTER                                           03520030
115100        VARYING PV-RETRY  FROM 1 BY 1                             03530030
115200          UNTIL (PV-RETRY > PC-MAX-RETRIES                        03540030
115300             OR (SQLCODE = +100 OR +0))                           03550030
115400                                                                  03560030
115500     EXEC SQL                                                     03570030
115600      SELECT  B.ITM_NBR                                           03580030
115700      INTO  :SKXREF-ITM-NBR                                       03590030
115800                                                                  03600030
116000      FROM TSKXREF  B                                             03610030
116100                                                                  03620030
116200      WHERE B.SKU        = :ICRD061-SKU-NBR                       03630030
116500      WITH UR                                                     03640030
116600     END-EXEC                                                     03650030
116700                                                                  03660030
116800       MOVE SQLCODE TO PV-SQL-SUB                                 03670030
116900     EVALUATE TRUE                                                03680030
117000         WHEN SQLCODE = ZERO                                      03690030
117100             ADD +1 TO PV-SELECT-ITM-NBR-CNT                      03700030
117200         WHEN SQLCODE = -904                                      03710030
117300         WHEN SQLCODE = -911                                      03720030
117400         WHEN SQLCODE = -913                                      03730030
117500             CONTINUE                                             03740030
117600         WHEN SQLCODE = +100                                      03750030
117700             MOVE ZERO TO SKXREF-ITM-NBR                          03760030
117800         WHEN OTHER                                               03770030
117900              DISPLAY '*2300 BLOWING UP ON BAD SQL-'              03780030
118000                 '* SELECT KEY-',                                 03790030
118100                  ICRD061-SKU-NBR,                                03800030
118200                  ICRD061-LOC-NBR,                                03810030
118300                  ICRD061-CNT-STUP-ID,                            03820030
118400                 ' SQL CODE -', PV-SQL-SUB, '**'                  03830030
118500              MOVE '2300-SELECT-ITM-NBR'                          03840030
118600                  TO PV-PARAGRAPH-NAME                            03850030
118700             MOVE 'ERROR ON SELECT OF ITEM NUMBER '               03860030
118800                  TO PV-DB2-OPERATION                             03870030
118900             PERFORM 9900-SQL-ABEND                               03880030
119000         END-EVALUATE                                             03890030
119100     END-PERFORM.                                                 03900030
119200                                                                  03910030
119300     IF PV-RETRY GREATER PC-MAX-RETRIES                           03920030
119400       DISPLAY '*2300 BLOWING UP ON RETRIES ON SELECT-'           03930030
119500        PV-RETRY '**'                                             03940030
119600               '* SELECT KEY-',                                   03950030
119700                  ICRD061-SKU-NBR,                                03960030
119800                  ICRD061-LOC-NBR,                                03970030
119900                  ICRD061-CNT-STUP-ID,                            03980030
120000               ' SQL CODE -', PV-SQL-SUB, '**'                    03990030
120100        MOVE '2300-SELECT-ITM-NBR     '                           04000030
120200                 TO PV-PARAGRAPH-NAME                             04010030
120300        MOVE 'ERROR ON SELECT OF ITEM NUMBER'                     04020030
120400                 TO PV-DB2-OPERATION                              04030030
120500        PERFORM 9900-SQL-ABEND                                    04040030
120600     END-IF.                                                      04050030
120700                                                                  04060030
120800******************************************************************04070030
120900* POPULATE RECORD FOR FASHION SALES.                              04080030
121000******************************************************************04090030
121100 3000-POPULATE-FS-REC-FIELDS.                                     04100030
121200                                                                  04110030
122300     MOVE SKXREF-ITM-NBR            TO  FS035-ITM-NBR.            04120030
122400     MOVE ICRD061-LOC-NBR           TO  FS035-LOC-NBR.            04130030
122401     SET FS035-OH-ADJ TO TRUE.                                    04140030
122402     IF PV-ADJ-QTY < +0                                           04150030
122403         SET FS035-ACTN-NEG TO TRUE                               04160030
122404         COMPUTE FS035-ADJ-QTY = PV-ADJ-QTY * -1                  04170030
122405     ELSE                                                         04180030
122406         SET FS035-ACTN-PLS TO TRUE                               04190030
122407         MOVE PV-ADJ-QTY                TO  FS035-ADJ-QTY.        04200030
111890     IF ICRD061-CNT-TYP-CDE = 'ICC'                               04210037
111890         MOVE 'RFID'                TO  FS035-BTCH-NBR            04220037
111890     ELSE                                                         04230037
               MOVE '9988'                TO  FS035-BTCH-NBR            04240036
111890     END-IF.                                                      04250037
122409     MOVE SPACE                     TO  FS035-UNT-BKG-IND.        04260030
122410     MOVE PC-PROGRAM-NAME           TO  FS035-ADJ-SRC-PGM-NM.     04270030
122420                                                                  04280030
122430******************************************************************04290030
122440*  WRITE RECORD FOR FASHION SALES FILE.                         * 04300030
122450******************************************************************04310030
122460 3010-WRITE-FS-OUTPUT-REC.                                        04320030
122470                                                                  04330030
122900     WRITE FSRD035-FS-ADJUST-RECORD FROM                          04340030
123000       FS035-ADJUSTMENT-RECORD.                                   04350030
123100                                                                  04360030
123200     ADD +1 TO PV-FS-REC-CNT.                                     04370030
123300                                                                  04380030
123400     INITIALIZE FS035-ADJUSTMENT-RECORD.                          04390030
123500                                                                  04400030
123600*--------------------------------------------------------------*  04410030
123700* 9000-COMMIT.                                                    04420030
123800*--------------------------------------------------------------*  04430030
123900 9000-COMMIT.                                                     04440030
124000                                                                  04450030
124100     MOVE '9000-COMMIT' TO PV-PARAGRAPH-NAME.                     04460030
124200                                                                  04470030
124300     PERFORM                                                      04480030
124400         WITH TEST AFTER                                          04490030
124500         VARYING PV-NUMBER-OF-RETRIES                             04500030
124600         FROM 1 BY 1                                              04510030
124700         UNTIL (PV-NUMBER-OF-RETRIES GREATER PC-MAX-RETRIES       04520030
124800                OR SQLCODE = 0)                                   04530030
124900                                                                  04540030
125000         EXEC SQL                                                 04550030
125100             COMMIT                                               04560030
125200         END-EXEC                                                 04570030
125300                                                                  04580030
125400         EVALUATE TRUE                                            04590030
125500           WHEN SQLCODE = -904                                    04600030
125600           WHEN SQLCODE = -911                                    04610030
125700           WHEN SQLCODE = -913                                    04620030
125800             CONTINUE                                             04630030
125900           WHEN SQLCODE = 0                                       04640030
126000             MOVE ZERO TO PV-CNT-SINCE-COMMIT                     04650030
126100           WHEN OTHER                                             04660030
126200             MOVE 'ERROR ON COMMMIT' TO                           04670030
126300                  PV-DB2-OPERATION                                04680030
126400             PERFORM 9900-SQL-ABEND                               04690030
126500         END-EVALUATE                                             04700030
126600     END-PERFORM.                                                 04710030
126700                                                                  04720030
126800     IF PV-NUMBER-OF-RETRIES GREATER PC-MAX-RETRIES               04730030
126900         MOVE 'COMMIT RETRIES EXCEEDED' TO PV-DB2-OPERATION       04740030
127000         PERFORM 9900-SQL-ABEND                                   04750030
127100     END-IF.                                                      04760030
127200                                                                  04770030
127300*--------------------------------------------------------------*  04780030
127400* 9900-SQL-ABEND.                                                 04790030
127500*     SQL ABEND ROUTINE.                                          04800030
127600*--------------------------------------------------------------*  04810030
127700 9900-SQL-ABEND.                                                  04820030
127800                                                                  04830030
127900     DISPLAY '** ABEND     **'.                                   04840030
128000     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                04850030
128100     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              04860030
128200     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               04870030
128300                                                                  04880030
128400     COPY DPPD004.                                                04890030
128500     SET ABEND-4013-DB2-ERROR TO TRUE.                            04900030
128600     CALL 'ILBOABN0' USING ABEND-CODE.                            04910030
128700                                                                  04920030
128800*9900-EXIT.                                                       04930030
128900                                                                  04940030
129000*--------------------------------------------------------------*  04950030
129100* 9999-WRAPUP.                                                    04960030
129200*     END OF PROGRAM ROUTINE.  CLOSES ALL FILES AND DISPLAYS      04970030
129300*     DATA COUNTS FROM THE PROGRAM.                               04980030
129400*--------------------------------------------------------------*  04990030
129500 9999-WRAPUP.                                                     05000030
129600                                                                  05010030
129700     CLOSE ICRD061-UPD-COUNTS-FILE                                05020030
129800           FSRD035-FS-ADJUST-FILE.                                05030030
129900                                                                  05040030
130000     DISPLAY '********************************************'.      05050030
130100     DISPLAY '**** SUMMARY OF PROGRAM ICKUT060         ***'.      05060030
130200     DISPLAY '********************************************'.      05070030
130300     DISPLAY 'TOTAL INPUT RECORDS READ    :' PV-INPUT-CNT.        05080030
130400     DISPLAY 'TOTAL FS RECORDS WRITTEN    :' PV-FS-REC-CNT.       05090030
130500     DISPLAY 'TOTAL SELECTS FOR ITM NBR   :'                      05100030
130600                                            PV-SELECT-ITM-NBR-CNT.05110030
130700     DISPLAY '********************************************'.      05120030
130800     DISPLAY '*********************************************'.     05130030
130900     DISPLAY '       END OF PROGRAM: ' PC-PROGRAM-NAME.           05140030
131000     DISPLAY '*********************************************'.     05150030
131100     DISPLAY ' '.                                                 05160030
131200                                                                  05170030
131300*9999-EXIT.                                                       05180030
131400                                                                  05190030
