000100 IDENTIFICATION DIVISION.                                                 
000200 TITLE 'ADD/UPDATE PO AUDIT EXCEPTION'.                                   
000300 PROGRAM-ID.    SUKCS585.                                                 
000400 AUTHOR.        DENNIS STEFFEN.                                           
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
000600 DATE-WRITTEN.  WINTER 2001.                                              
000700 DATE-COMPILED.                                                           
000900*----------------------------------------------------------------*        
001500*    CHANGES                                                     *        
      *    MADE BY: SHOBHIT BAIJAL       PR#5148D                      *        
      *    DATE:    10/07/2013                                         *        
      *                                                                *        
      *    NEW PACKAGING TYPE 'RF' WAS ADDED FOR RFID AUDITS AND LOGIC *        
      *    TO POPULATE RFID ERRORS.                                    *        
      *    CHANGES CAN BE FOUND WITH *SB 10/07/13                      *        
001600*----------------------------------------------------------------*        
263968* CHANGED 11/15/2021    BY JIM HUNTER      WR: CHG0263968                 
263968* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263968* MAKING THE CALL DYNAMIC VS STATIC.                                      
001130*                                                                         
001110* CHANGED 01/09/2023    BY JEAN KURK       WR: CHG0278099                 
001120* CHANGE CALL OF DPKCS030 TO BE DYNAMIC                                   
263968*---------------------------------------------------------------*         
000800                                                                          
000900 ENVIRONMENT DIVISION.                                                    
001000 DATA DIVISION.                                                           
001100 WORKING-STORAGE SECTION.                                                 
001200                                                                          
001300 01  DK-DB2-KEYS.                                                         
001400     15  DK-PO-NBR                    PIC S9(09) COMP.                    
001500     15  DK-PO-LINE-NBR               PIC S9(09) COMP.                    
001600     15  DK-PREPACK-ID                PIC S9(04) COMP.                    
001700     15  DK-OPER-UNT-ID               PIC S9(04) COMP.                    
001800                                                                          
001900     05  DK-LNE-NBR-FROM              PIC S9(09) COMP VALUE ZERO.         
002000     05  DK-LNE-NBR-TO                PIC S9(09) COMP VALUE ZERO.         
002100     05  DK-PREPK-FROM                PIC S9(04) COMP VALUE ZERO.         
002200     05  DK-PREPK-TO                  PIC S9(04) COMP VALUE ZERO.         
002300     05  DK-OPER-FROM                 PIC S9(04) COMP VALUE ZERO.         
002400     05  DK-OPER-TO                   PIC S9(04) COMP VALUE ZERO.         
002500                                                                          
002600 01  PV-PROGRAM-VARIABLES.                                                
002700     05  PV-SAVE-FUNCTION-SW          PIC  X(01).                         
002800     05  PV-LOCATION.                                                     
002900         10  FILLER                      PIC  X(01)  VALUE '0'.           
003000         10  PV-DP020-LOCATION           PIC  X(03)  VALUE '000'.         
003100     05  PV-LOCATION-N REDEFINES PV-LOCATION                              
003200                                         PIC  9(04).                      
002700     05  PV-OPER-UNT-DISPLAY          PIC X(04)  VALUE SPACES.            
003300     05  PV-CICS-RESPONSE             PIC S9(04)  VALUE ZERO.             
003400     05  PV-DISPLAY-TASK              PIC 9(05).                          
003500     05  PV-AUD-COUNTERS.                                                 
003600         10  PV-A-COUNT               PIC S9(3) COMP-3                    
003700                                             VALUE ZERO.                  
003800         10  PV-D-COUNT               PIC S9(3) COMP-3                    
003900                                             VALUE ZERO.                  
004000         10  PV-N-COUNT               PIC S9(3) COMP-3                    
004100                                             VALUE ZERO.                  
004200         10  PV-S-COUNT               PIC S9(3) COMP-3                    
004300                                             VALUE ZERO.                  
      *SB 10/07/13 - BEGIN PR#5148D                                             
004200         10  PV-R-COUNT               PIC S9(3) COMP-3                    
004300                                             VALUE ZERO.                  
004200         10  PV-Q-COUNT               PIC S9(3) COMP-3                    
004300                                             VALUE ZERO.                  
      *SB 10/07/13 - END PR#5148D                                               
004400         10  PV-SPACE-COUNT           PIC S9(3) COMP-3                    
004500                                          VALUE ZERO.                     
004600         10  PV-CRAP-COUNT            PIC S9(3) COMP-3                    
004700                                          VALUE ZERO.                     
004800                                                                          
004900 01  PC-PROGRAM-CONSTANTS.                                                
005000     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'SU585A'.           
005100     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'SUKM585 '.         
005200     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'SUKCS585'.         
005300     05  PC-LIST-QUEUE-SEQ         PIC  9(01)  VALUE  1.                  
005400                                                                          
005500     05  PC-TSYMSG-NUMBERS.                                               
005600         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.          
005700         10  PC-TSYMSG-00007            PIC  9(05)  VALUE 00007.          
005800         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.          
005900         10  PC-TSYMSG-00016            PIC  9(05)  VALUE 00016.          
006000         10  PC-TSYMSG-00034            PIC  9(05)  VALUE 00034.          
006100         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.          
006200         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.          
006300         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.          
006400         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.          
006500         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.          
006600         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.          
006700         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.          
006800         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.          
006900         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.          
007000         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.          
007100         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.          
007200         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.          
007300         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.          
007400         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.          
007500         10  PC-TSYMSG-00973            PIC  9(05)  VALUE 00973.          
007600         10  PC-TSYMSG-02176            PIC  9(05)  VALUE 02176.          
007700         10  PC-TSYMSG-02843            PIC  9(05)  VALUE 02843.          
007800         10  PC-TSYMSG-02844            PIC  9(05)  VALUE 02844.          
007900         10  PC-TSYMSG-02858            PIC  9(05)  VALUE 02858.          
008000         10  PC-TSYMSG-02859            PIC  9(05)  VALUE 02859.          
008100         10  PC-TSYMSG-02860            PIC  9(05)  VALUE 02860.          
008200         10  PC-TSYMSG-02861            PIC  9(05)  VALUE 02861.          
008300         10  PC-TSYMSG-02862            PIC  9(05)  VALUE 02862.          
008400         10  PC-TSYMSG-02864            PIC  9(05)  VALUE 02864.          
008500         10  PC-TSYMSG-02865            PIC  9(05)  VALUE 02865.          
008600         10  PC-TSYMSG-02866            PIC  9(05)  VALUE 02866.          
008700         10  PC-TSYMSG-02867            PIC  9(05)  VALUE 02867.          
008800         10  PC-TSYMSG-02868            PIC  9(05)  VALUE 02868.          
008900         10  PC-TSYMSG-02869            PIC  9(05)  VALUE 02869.          
009000         10  PC-TSYMSG-02892            PIC  9(05)  VALUE 02892.          
      *SB 10/07/13 - BEGIN PR#5148D                                             
009000         10  PC-TSYMSG-03737            PIC  9(05)  VALUE 03737.          
      *SB 10/07/13 - END PR#5148D                                               
009100         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.          
009200*                                                                         
009300 01  PM-CICSAUTH-MESSAGE.                                                 
009400     05  FILLER                       PIC  X(36)     VALUE                
009500         'INVALID RETURN CODE FROM CICSAUTH - '.                          
009600     05  PM-CM-RETURN-CODE            PIC  9(04).                         
009700                                                                          
009800                                                                          
009900 01  PS-PROGRAM-SWITCHES.                                                 
010000     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.                
010100         88  PS-ERROR                          VALUE  'Y'.                
010200         88  PS-NO-ERROR                       VALUE  'N'.                
010300     05  PS-CURSOR-SW              PIC  X(01)  VALUE  'N'.                
010400         88  PS-END-OF-CURSOR                  VALUE  'Y'.                
010500         88  PS-NOT-END-OF-CURSOR              VALUE  'N'.                
010600     05  PS-AUDIT-FOUND-SW         PIC  X(01)  VALUE  'N'.                
010700         88  PS-AUDIT-FOUND                    VALUE  'Y'.                
010800         88  PS-AUDIT-NOT-FOUND                VALUE  'N'.                
010900     05  PS-COMMAREA-SW               PIC X(01)  VALUE 'N'.               
011000         88  PS-COMMAREA-VALID                   VALUE 'Y'.               
011100         88  PS-COMMAREA-NOT-VALID               VALUE 'N'.               
011200                                                                          
011300 01  PM-PROGRAM-MESSAGES.                                                 
011400     05  PM-ABEND-INFO-A.                                                 
011500         10  FILLER                PIC X(15)   VALUE                      
011600                                   'DP020-SRC-AID: '.                     
011700         10  PM-A-SRC-AID          PIC X(02)   VALUE  SPACE.              
011800         10  FILLER                PIC X(19)   VALUE                      
011900                                   '. DP020-FK-ACTION: '.                 
012000         10  PM-A-FK-ACTION        PIC X(01)   VALUE  SPACE.              
012100         10  FILLER                PIC X(22)   VALUE                      
012200                                   '. DP020-FK-DISPN-IND: '.              
012300         10  PM-A-FK-DISPN         PIC X(01)   VALUE  SPACE.              
012400         10  FILLER                PIC X(01)   VALUE '.'.                 
012500         10  FILLER                PIC X(19)   VALUE SPACE.               
012600                                                                          
012700                                                                          
012800*    MAP LAYOUT                                                  *        
012900     COPY SUKM585.                                                        
013000 01  MR-OCCURS-LAYOUT                   REDEFINES  SU585AO.               
013100     05  FILLER                         PIC X(077).                       
013200     05  MR-SCROLL-AREA                 OCCURS 21 TIMES                   
013300                                         INDEXED BY MR-IDX.               
013400         10  MR-SELECTL                 PIC S9(04) COMP.                  
013500         10  MR-SELECTA                 PIC  X(01).                       
013600         10  MR-SELECTF REDEFINES MR-SELECTA                              
013700                                        PIC  X(01).                       
013800         10  MR-SELECTC                 PIC  X(01).                       
013900         10  MR-SELECTH                 PIC  X(01).                       
014000         10  MR-SELECT                  PIC  X(01).                       
014100                                                                          
014200                                                                          
014300         10  MR-LOCATION-L              PIC S9(04) COMP.                  
014400         10  MR-LOCATION-A              PIC  X(01).                       
014500         10  MR-LOCATION-C              PIC  X(01).                       
014600         10  MR-LOCATION-H              PIC  X(01).                       
014700         10  MR-LOCATION                PIC  X(15).                       
014800/                                                                         
014900*    RACF                                                                 
015000     COPY DPWS008.                                                        
015100*    ATTRIBUTE SETTINGS                                                   
015200     COPY DPWS015.                                                        
015300                                                                          
015400*    FUNCTION KEYS                                                        
015500                                                                          
015600     COPY DPWS016.                                                        
015700/                                                                         
015800** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **        
015900** SUB-ROUTINE (DPKUT100).                                      **        
016000     COPY DPWS010I.                                                       
016100/                                                                         
016300** PARAMETERS FOR CALLING CICS ARCHITECTURE API                 **        
016400     COPY DPWS030.                                                        
016400     COPY DPWS930.                                                        
016500/                                                                         
016600*     SELECTION QUEUE RECORD                                              
016700     COPY SUWS022.                                                        
016800/                                                                         
016900*    STANDARD COMMAREA.                                                   
017000     COPY DPWS020.                                                        
017100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                        
017200                                                                          
017300*    INTER-APPLICATION COMMAREA.                                          
017400                                                                          
017500         10  INTER-APPL-COMM-AREA PIC X(200).                             
017600     COPY SUWS020.                                                        
017700     COPY SUWS021.                                                        
017800         10  ASC-SPECIFIC-COMMAREA.                                       
017900             15  ASC-ACCESS-SW               PIC X(01).                   
018000                 88  ASC-ACCESS-ALLOWED          VALUE 'Y'.               
018100                 88  ASC-ACCESS-DENIED           VALUE 'N'.               
018200             15  ASC-FUNCTION-SW                PIC  X(01).               
018300                 88 ASC-ADD-FUNCTION                VALUE 'A'.            
018400                 88 ASC-UPD-FUNCTION                VALUE 'U'.            
018500                 88 ASC-NULL-FUNCTION               VALUE 'N'.            
018600             15  ASC-UPDATE-PENDING-SW          PIC  X(01).               
018700                 88 ASC-UPDATE-PENDING              VALUE 'P'.            
018800                 88 ASC-UPDATE-CONFIRMED            VALUE 'C'.            
018900                 88 ASC-UPDATE-NOT-PENDING          VALUE SPACE.          
019000             15  ASC-USE-SELECTION-QUEUE-IND                              
019100                                            PIC X(01).                    
019200                 88  ASC-USE-SELECTION-QUEUE    VALUE 'Y'.                
019300             15  ASC-SEL-QUEUE-NAME         PIC X(08).                    
019400             15  ASC-NUMBER-OF-TS-ITEMS     PIC S9(05) COMP-3.            
019500             15  ASC-LIST-QUEUE-NAME.                                     
019600                 20  ASC-LIST-TERM-ID        PIC X(4).                    
019700                 20  ASC-LIST-TASK-NUMBER    PIC S9(5) COMP-3.            
019800                 20  ASC-LIST-SEQ            PIC 9.                       
019900             15  ASC-NUMBER-OF-SELECTED-ITEMS                             
020000                                            PIC S9(09) COMP-3.            
020100             15  ASC-ITEM-SUB                 PIC S9(04)  COMP            
020200                                                          SYNC.           
020300             15  ASC-SEL-SUB                PIC S9(04) COMP.              
020400             15  ASC-SEL-ITEM               PIC S9(04) COMP.              
020500             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).                 
020600                 88  ASC-UPDATE-TSQ                VALUE 'Y'.             
020700                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.             
020800             15  ASC-SAVE-SRC-AID     PIC 9(02).                          
020900             15  ASC-SAVE-OPER-UNT-ID-N PIC S9(04) COMP.                  
021000             15  ASC-SAVE-AUDIT-TYPE  PIC X(01).                          
021100             15  ASC-PKGNG-CDE        PIC X(01).                          
021200             15  ASC-PKGNG-DESC       PIC X(15).                          
021300             15  ASC-MAP-TABLE OCCURS 21 TIMES                            
021400                              INDEXED BY ASC-MAP-IDX.                     
021500                 20  ASC-AUDIT-TYPE          PIC X(01).                   
021600                 20  ASC-OPER-UNT-ID         PIC X(04).                   
021700                 20  ASC-OPER-UNT-ID-N REDEFINES ASC-OPER-UNT-ID          
021800                                             PIC 9(04).                   
021900                 20  ASC-STORE-NAME          PIC X(10).                   
022000                 20  ASC-LOCATION            PIC X(14).                   
022100                                                                          
022200             15  ASC-PO-NBR                  PIC X(09).                   
022300             15  ASC-PO-NBR-N REDEFINES ASC-PO-NBR                        
022400                                             PIC 9(09).                   
022500             15  ASC-PO-LINE-NBR             PIC X(04).                   
022600             15  ASC-PO-LINE-NBR-N REDEFINES ASC-PO-LINE-NBR              
022700                                             PIC 9(04).                   
022800             15  ASC-PREPACK-ID              PIC X(04).                   
022900             15  ASC-PREPACK-ID-N REDEFINES ASC-PREPACK-ID                
023000                                             PIC 9(04).                   
023100             15  ASC-FROM-DATE        PIC X(10).                          
023200             15  ASC-TO-DATE          PIC X(10).                          
023300*SWITCHES                                                                 
023400             15  ASC-ACTION-SW          PIC X(03).                        
023500                 88  ASC-ADD            VALUE 'ADD'.                      
023600                 88  ASC-DELETE         VALUE 'DEL'.                      
023700                 88  ASC-UPDATE         VALUE 'UPD'.                      
023800                                                                          
023900             15  FILLER              PIC X(50).                           
024000                                                                          
      *SB 10/07/13 - BEGIN PR#5148D                                             
024100*    RFID SUBROUTINE VARIABLES                                            
024200     COPY SUWS093.                                                        
      *SB 10/07/13 - END PR#5148D                                               
                                                                                
024100*    ABEND PROCESSING                                                     
024200     COPY DPWS013.                                                        
024300                                                                          
024400*    DATE ROUTINE WORK AREA                                               
024500     COPY DPWS500.                                                        
024600                                                                          
024700*    PO AUDIT EXCEPTION TABLE                                             
024800     EXEC SQL                                                             
024900          INCLUDE SUT00014                                                
025000     END-EXEC.                                                            
025100                                                                          
024700*    XLT DOMAIN LOCATION TABLE                                            
024800     EXEC SQL                                                             
024900          INCLUDE XLT00010                                                
025000     END-EXEC.                                                            
025100                                                                          
025700*    PO MASTER                                                            
025800     EXEC SQL                                                             
025900          INCLUDE TPURCHS                                                 
026000     END-EXEC.                                                            
026100                                                                          
026200*    PO LINE MASTER                                                       
026300     EXEC SQL                                                             
026400          INCLUDE TPURITM                                                 
026500     END-EXEC.                                                            
026600                                                                          
026700*    PO MASTER PRE-PACK TABLE                                             
026800     EXEC SQL                                                             
026900          INCLUDE TPOPRPK                                                 
027000     END-EXEC.                                                            
027100                                                                          
027200*  COMMUNICATION AREAS FOR DB2                                            
027300*                                                                         
027400     EXEC SQL                                                             
027500         INCLUDE SQLCA                                                    
027600     END-EXEC.                                                            
027700/                                                                         
027800*  USED FOR THE ADD FUNCTION                                              
027900     EXEC SQL                                                             
028000         DECLARE LOCATION-ADD-CSR CURSOR FOR                              
028100         SELECT                                                           
028200               0                            AS STORE                      
028300             , 'ALL DCS   '                 AS NAME                       
028500                FROM SYSIBM.SYSDUMMY1                                     
028600                                                                          
028700         UNION                                                            
028800                                                                          
028900          SELECT                                                          
029000                 STR.LOC_NBR               AS STORE                       
029100             ,   STR.LOC_10_ABBR_NM        AS NAME                        
029300            FROM  XLT_LOC STR                                             
029400          WHERE                                                           
029500                 STR.LOC_TYP_CDE           = 'DC'                         
029600            AND  STR.OPN_DTE               < CURRENT DATE +1 DAY          
029600            AND  STR.CLO_DTE               = '9999-09-09'                 
029700            AND  STR.E_BUS_IND             = 'N'                          
029800                                                                          
030500            ORDER BY STORE                                                
030600     END-EXEC.                                                            
030700                                                                          
030800*  USED FOR THE ADD FUNCTION                                              
030900     EXEC SQL                                                             
031000         DECLARE LOCATION-UPD-CSR CURSOR FOR                              
031100          SELECT                                                          
031200                 STR.LOC_NBR               AS STORE                       
031300             ,   STR.LOC_10_ABBR_NM        AS NAME                        
031500            FROM  XLT_LOC STR                                             
031600          WHERE                                                           
031700                 STR.LOC_TYP_CDE           = 'DC'                         
031800            AND  STR.OPN_DTE               < CURRENT DATE +1 DAY          
031800            AND  STR.CLO_DTE               = '9999-09-09'                 
031900            AND  STR.E_BUS_IND             = 'N'                          
032000                                                                          
032700            ORDER BY STORE                                                
032800     END-EXEC.                                                            
032900                                                                          
033000*----------------------------------------------------------------*        
033300 LINKAGE SECTION.                                                         
033400                                                                          
033500 01  DFHCOMMAREA.                                                         
033600     05  FILLER                         OCCURS  1 TO 4072 TIMES           
033700                                        DEPENDING ON EIBCALEN.            
033800         10  FILLER                     PIC X.                            
033900                                                                          
034000                                                                          
034100 PROCEDURE DIVISION.                                                      
034200 0000-MAIN-MODULE.                                                        
034300     INITIALIZE DP030-CICS-API-FIELDS.                                    
034400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.               
034500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.                  
034600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).                 
034700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                               
034800     MOVE LENGTH OF SU585AI        TO DP030-MAP-LENGTH (1).               
034900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).             
035000     PERFORM 0001-CALL-CICS-ARCH-API.                                     
035100*                                                                         
035200     PERFORM 1000-CONTROL-PROCESSING                                      
035300*                                                                         
035400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).             
035500     PERFORM 0001-CALL-CICS-ARCH-API.                                     
035600                                                                          
035700 0001-CALL-CICS-ARCH-API.                                                 
035800*    CALL 'DPKCS030' USING DFHEIBLK                                       
035800     CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
035900                           DFHCOMMAREA                                    
036000                           DP030-CICS-API-FIELDS                          
036100                           DP020-STANDARD-COMMAREA                        
036200                           SU585AI.                                       
036300*                                                                         
036400     IF  DP030-RC-CALL-SUCCESSFUL                                         
036500         CONTINUE                                                         
036600     ELSE                                                                 
036700         SET DP013-NO-ROLLBACK                                            
036800             DP013-XCTL-DISPLAY-RESTART                                   
036900             DP013-CICS-ABEND      TO TRUE                                
037000         MOVE 'BEFORE 0000-MAIN-MODULE'                                   
037100                                   TO DP013-PARAGRAPH                     
037200*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX        
037300*             'T LINE'             TO DP013-MESSAGE-TEXT (2)              
037200         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
037300-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
037400         MOVE DP030-RETURN-CODE                                           
037500                                   TO DP013-MESSAGE-TEXT (3)              
037600         PERFORM DP013-0000-PROCESS-ABEND                                 
037700     END-IF.                                                              
037800/                                                                         
037900*----------------------------------------------------------------*        
038000*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *        
038100*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *        
038200*----------------------------------------------------------------*        
038300                                                                          
038400 1000-CONTROL-PROCESSING.                                                 
038500                                                                          
038600     EVALUATE TRUE                                                        
038700         WHEN DP020-NEXT-ACT-INITIAL                                      
038800              MOVE EIBTRMID               TO ASC-LIST-TERM-ID             
038900              MOVE DP020-SRC-TASK-NUMBER  TO ASC-LIST-TASK-NUMBER         
039000              MOVE PC-LIST-QUEUE-SEQ      TO ASC-LIST-SEQ                 
039100              PERFORM 1100-PROCESS-INTER-APPL-COMM                        
039200                                                                          
039300              IF  PS-COMMAREA-NOT-VALID                                   
039400                  SET DP020-NEXT-ACT-APPL-ERROR                           
039500                                    TO TRUE                               
039600              ELSE                                                        
039700                  PERFORM 30023-UPDATE-RACF                               
039800                  PERFORM 3200-RESET-ATTRIBUTES                           
039900                  PERFORM 4000-BUILD-INITIAL-PANEL                        
040000              END-IF                                                      
040100                                                                          
040200         WHEN DP020-NEXT-ACT-RETURN                                       
040300             MOVE ASC-FUNCTION-SW     TO PV-SAVE-FUNCTION-SW              
040400             INITIALIZE ASC-SPECIFIC-COMMAREA                             
040500             MOVE PV-SAVE-FUNCTION-SW TO ASC-FUNCTION-SW                  
040600             PERFORM 3200-RESET-ATTRIBUTES                                
040700             PERFORM 4000-BUILD-INITIAL-PANEL                             
040800                                                                          
040900         WHEN DP020-NEXT-ACT-READ-MAP                                     
041000             PERFORM 2000-FKEY-PROCESSING                                 
041100                                                                          
041200         WHEN OTHER                                                       
041300             SET DP013-LOGIC-ABEND                                        
041400                 DP013-NO-ROLLBACK TO TRUE                                
041500             MOVE '1000-CONTROL-PROCESSING'                               
041600                                   TO  DP013-PARAGRAPH                    
041700             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'           
041800                                   TO  DP013-MESSAGE-TEXT(1)              
041900             MOVE DP020-NEXT-APPL-ACTIVITY                                
042000                                   TO DP013-MESSAGE-TEXT(2)               
042100             PERFORM DP013-0000-PROCESS-ABEND                             
042200     END-EVALUATE.                                                        
042300/                                                                         
042400 1100-PROCESS-INTER-APPL-COMM.                                            
042500                                                                          
042600     SET PS-COMMAREA-VALID         TO TRUE.                               
042700                                                                          
042800     INITIALIZE ASC-SPECIFIC-COMMAREA.                                    
042900                                                                          
043000     EVALUATE DP020-INT-APPL-FORMAT-IND                                   
043100     WHEN '1'                                                             
043200*           ADD FROM CRIT-SPEC                                            
043300         SET ASC-ADD-FUNCTION         TO TRUE                             
043400*           (THIS DETERMINES WHICH CURSOR TO USE)                         
043500         MOVE SU020-PO-NBR            TO ASC-PO-NBR-N                     
043600         MOVE SU020-PKGNG-DESC        TO ASC-PKGNG-DESC                   
043700         MOVE SU020-PO-LINE-NBR       TO ASC-PO-LINE-NBR-N                
043800         MOVE SU020-PREPACK-ID        TO ASC-PREPACK-ID-N                 
043900         MOVE SU020-SHIP-FROM-DATE    TO ASC-FROM-DATE                    
044000         MOVE SU020-SHIP-TO-DATE      TO ASC-TO-DATE                      
044100     WHEN '3'                                                             
044200*           UPDATE FROM CRIT-SPEC                                         
044300         SET ASC-UPD-FUNCTION         TO TRUE                             
044400*           (THIS DETERMINES WHICH CURSOR TO USE)                         
044500         MOVE SU020-PO-NBR            TO ASC-PO-NBR-N                     
044600         MOVE SU020-PO-LINE-NBR       TO ASC-PO-LINE-NBR-N                
044700         MOVE SU020-PREPACK-ID        TO ASC-PREPACK-ID-N                 
044800         MOVE SU020-PKGNG-DESC        TO ASC-PKGNG-DESC                   
044900         MOVE SU020-SHIP-FROM-DATE    TO ASC-FROM-DATE                    
045000         MOVE SU020-SHIP-TO-DATE      TO ASC-TO-DATE                      
045100     WHEN '4'                                                             
045200*           ADD FROM LIST                                                 
045300             IF SU021-NUMBER-OF-SELECTED-ITEMS = ZERO                     
045400                 SET DP020-NEXT-ACT-APPL-ERROR                            
045500                     DP030-OVERRIDE-GO                                    
045600                     DP020-MSG-WARNING                                    
045700                     PS-ERROR                                             
045800                     PS-COMMAREA-NOT-VALID                                
045900                                   TO TRUE                                
046000                 MOVE PC-TSYMSG-00057                                     
046100                                   TO DP020-MSG-NUMBER                    
046200             ELSE                                                         
046300                 SET ASC-ADD-FUNCTION TO TRUE                             
046400                 SET ASC-USE-SELECTION-QUEUE                              
046500                     DP030-SET-CURSOR-APPL-1                              
046600                                   TO TRUE                                
046700                 MOVE SU021-NUMBER-OF-SELECTED-ITEMS                      
046800                                   TO ASC-NUMBER-OF-SELECTED-ITEMS        
046900                 MOVE SU021-NUMBER-OF-TS-ITEMS                            
047000                                   TO ASC-NUMBER-OF-TS-ITEMS              
047100                 MOVE SU021-SEL-QUEUE-NAME                                
047200                                   TO ASC-SEL-QUEUE-NAME                  
047300                 PERFORM 1120-PREPARE-LIST-ENTRY                          
047400                 MOVE SU021-AUDIT-TYPE  TO ASC-SAVE-AUDIT-TYPE            
047500                 MOVE SU021-PKGNG-DESC TO ASC-PKGNG-DESC                  
047600                 MOVE SU021-SHIP-FROM-DATE TO ASC-FROM-DATE               
047700                 MOVE SU021-SHIP-TO-DATE TO ASC-TO-DATE                   
047800             END-IF                                                       
047900                                                                          
048000     WHEN '5'                                                             
048100*           UPDATE FROM LIST                                              
048200           IF SU021-NUMBER-OF-SELECTED-ITEMS > 0                          
048300              SET ASC-UPD-FUNCTION TO TRUE                                
048400              SET ASC-USE-SELECTION-QUEUE TO TRUE                         
048500              MOVE SU021-NUMBER-OF-SELECTED-ITEMS                         
048600                                   TO ASC-NUMBER-OF-SELECTED-ITEMS        
048700              MOVE SU021-NUMBER-OF-TS-ITEMS                               
048800                                   TO ASC-NUMBER-OF-TS-ITEMS              
048900              MOVE SU021-SEL-QUEUE-NAME                                   
049000                                   TO ASC-SEL-QUEUE-NAME                  
049100              MOVE 'UPD' TO  ASC-ACTION-SW                                
049200              PERFORM 1120-PREPARE-LIST-ENTRY                             
049300           ELSE                                                           
049400               MOVE PC-TSYMSG-00057       TO DP020-MSG-NUMBER             
049500               SET  PS-COMMAREA-NOT-VALID TO TRUE                         
049600           END-IF                                                         
049700                                                                          
049800     WHEN OTHER                                                           
049900             MOVE PC-TSYMSG-00148  TO DP020-MSG-NUMBER                    
050000             SET PS-ERROR                                                 
050100                 PS-COMMAREA-NOT-VALID                                    
050200                 DP020-MSG-FATAL                                          
050300                 DP020-NEXT-ACT-APPL-ERROR                                
050400                                   TO TRUE                                
050500                                                                          
050600     END-EVALUATE.                                                        
050700                                                                          
050800 1120-PREPARE-LIST-ENTRY.                                                 
050900                                                                          
051000     MOVE SU022-MAX-ITEMS          TO ASC-SEL-SUB.                        
051100     MOVE ZERO                     TO ASC-SEL-ITEM.                       
051200                                                                          
051300     PERFORM 1150-GET-NEXT-SELECTED-ITEM.                                 
051400                                                                          
051500 1150-GET-NEXT-SELECTED-ITEM.                                             
051600     ADD +1                        TO ASC-SEL-SUB.                        
051700                                                                          
051800     SET ASC-UPDATE-TSQ TO TRUE.                                          
051900                                                                          
052000     IF  ASC-SEL-SUB > SU022-MAX-ITEMS                                    
052100         ADD +1                    TO ASC-SEL-ITEM                        
052200         MOVE +1                   TO ASC-SEL-SUB                         
052300     END-IF.                                                              
052400                                                                          
052500     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                        
052600         PERFORM 9100-READ-SEL-QUEUE                                      
052700         IF  SU022-ITEM (ASC-SEL-SUB) > ZERO                              
052800             MOVE SU022-PO-NBR (ASC-SEL-SUB)                              
052900                                      TO ASC-PO-NBR-N                     
053000                                         SU021-PO-NBR                     
053100             MOVE SU022-PO-LNE-NBR (ASC-SEL-SUB)                          
053200                                      TO ASC-PO-LINE-NBR-N                
053300                                         SU021-PO-LINE-NBR                
053400             MOVE SU022-PREPACK-ID (ASC-SEL-SUB)                          
053500                                      TO ASC-PREPACK-ID-N                 
053600                                         SU021-PREPACK-ID                 
053700                                                                          
053800             MOVE SU022-OPER-UNT-ID (ASC-SEL-SUB)                         
053900                                      TO ASC-OPER-UNT-ID                  
054000                                         (ASC-SEL-SUB)                    
054100                                         SU021-OPER-UNT-ID                
054200             SET SU022-INQ (ASC-SEL-SUB)                                  
054300                                  TO TRUE                                 
054400                                                                          
054500             PERFORM 9200-REWRITE-SEL-QUEUE                               
054600         ELSE                                                             
054700             SUBTRACT +1 FROM ASC-SEL-SUB                                 
054800*            --- BOTTOM OF LIST ---                                       
054900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER                    
055000             SET DP020-MSG-INFORMATIONAL                                  
055100                                   TO TRUE                                
055200         END-IF                                                           
055300     ELSE                                                                 
055400         SUBTRACT +1 FROM ASC-SEL-ITEM                                    
055500         MOVE SU022-MAX-ITEMS      TO ASC-SEL-SUB                         
055600         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER                    
055700         SET DP020-MSG-INFORMATIONAL                                      
055800                                   TO TRUE                                
055900     END-IF.                                                              
056000                                                                          
056100 1160-GET-PREV-SELECTED-ITEM.                                             
056200                                                                          
056300     SUBTRACT 1                  FROM ASC-SEL-SUB.                        
056400     IF  ASC-SEL-SUB < 1                                                  
056500         SUBTRACT +1             FROM ASC-SEL-ITEM                        
056600         MOVE SU022-MAX-ITEMS         TO ASC-SEL-SUB                      
056700     END-IF.                                                              
056800                                                                          
056900                                                                          
057000     IF  ASC-SEL-ITEM > ZERO                                              
057100         PERFORM 9100-READ-SEL-QUEUE                                      
057200         MOVE SU022-PO-NBR (ASC-SEL-SUB)                                  
057300                                      TO ASC-PO-NBR-N                     
057400         MOVE SU022-PO-LNE-NBR (ASC-SEL-SUB)                              
057500                                      TO ASC-PO-LINE-NBR-N                
057600         MOVE SU022-PREPACK-ID (ASC-SEL-SUB)                              
057700                                      TO ASC-PREPACK-ID-N                 
058000         MOVE SU022-OPER-UNT-ID (ASC-SEL-SUB)                             
058100                                      TO ASC-OPER-UNT-ID                  
058200                                         (ASC-SEL-SUB)                    
058300     ELSE                                                                 
058400         MOVE +1                      TO ASC-SEL-ITEM                     
058500                                         ASC-SEL-SUB                      
058600*        --- TOP OF LIST ---                                              
058700         MOVE PC-TSYMSG-00069         TO DP020-MSG-NUMBER                 
058800         SET DP020-MSG-INFORMATIONAL  TO TRUE                             
058900     END-IF.                                                              
059000                                                                          
059100*----------------------------------------------------------------*        
059200* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*        
059300* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*        
059400* EDITS.                                                         *        
059500*----------------------------------------------------------------*        
059600                                                                          
059700 2000-FKEY-PROCESSING.                                                    
059800                                                                          
059900     EVALUATE TRUE                                                        
060000                                                                          
060100         WHEN DP020-SRC-AID = DP016-CLEAR                                 
060200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
060300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
060400                                                                          
060500         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                             
060600             MOVE ASC-FUNCTION-SW     TO PV-SAVE-FUNCTION-SW              
060700*            INITIALIZE ASC-SPECIFIC-COMMAREA                             
060800             MOVE PV-SAVE-FUNCTION-SW TO ASC-FUNCTION-SW                  
060900             PERFORM 3200-RESET-ATTRIBUTES                                
061000             PERFORM 4000-BUILD-INITIAL-PANEL                             
061100         WHEN DP020-SRC-AID = DP016-ENTER                                 
061200                                                                          
061300*  REPAINT THE SCREEN IF ANY PARMS HAVE CHANGED                           
061400                                                                          
061500                 PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                     
061600                 PERFORM 3001-NUMERIC-CHECK                               
061700                 PERFORM 3200-RESET-ATTRIBUTES                            
061800                 PERFORM 4000-BUILD-INITIAL-PANEL                         
061900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     
062000                 SET DP030-CONTINUE-GO TO TRUE                            
062100                                                                          
062200         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)                     
062300             PERFORM 1150-GET-NEXT-SELECTED-ITEM                          
062400             PERFORM 3200-RESET-ATTRIBUTES                                
062500             PERFORM 4000-BUILD-INITIAL-PANEL                             
062600                                                                          
062700         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)                     
062800             PERFORM 1160-GET-PREV-SELECTED-ITEM                          
062900             PERFORM 3200-RESET-ATTRIBUTES                                
063000             PERFORM 4000-BUILD-INITIAL-PANEL                             
063100                                                                          
063200         WHEN OTHER                                                       
063300             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                         
063400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
063500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
063600             IF  PS-NO-ERROR                                              
063700                 SET DP030-CONTINUE-GO TO TRUE                            
063800                 PERFORM 2100-CHECK-FUNCTION-KEY                          
063900             ELSE                                                         
064000                 SET DP030-OVERRIDE-GO TO TRUE                            
064100             END-IF                                                       
064200     END-EVALUATE.                                                        
064300******************************************************************        
064400** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **        
064500** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **        
064600** FROM THE CICS ARCHITECTURE API.                              **        
064700******************************************************************        
064800 2100-CHECK-FUNCTION-KEY.                                                 
064900                                                                          
065000     IF DP020-FK-CONFIRM (DP020-SRC-AID)                                  
065100*        (F2 CONFIRM KEY)                                                 
065200         IF ASC-UPDATE-PENDING                                            
065300             MOVE DP020-SRC-AID       TO ASC-SAVE-SRC-AID                 
065400*         (CHANGE THE CONFIRM KEY TO BE FUNC-03)                          
065500             SET DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)                   
065600                 ASC-UPDATE-CONFIRMED                                     
065700                                      TO TRUE                             
065800         ELSE                                                             
065900             MOVE PC-TSYMSG-00016     TO DP020-MSG-NUMBER                 
066000             SET DP020-MSG-WARNING                                        
066100                 PS-ERROR                                                 
066200                                      TO TRUE                             
066300         END-IF                                                           
066400     END-IF                                                               
066500                                                                          
066600     IF PS-ERROR                                                          
066700         CONTINUE                                                         
066800     ELSE                                                                 
066900     EVALUATE TRUE                                                        
067000         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                      
067100             PERFORM 3000A-EDIT-FOR-ADD                                   
067200             IF PS-NO-ERROR                                               
067300                 PERFORM 5000-ADD                                         
067400             END-IF                                                       
067500             IF PS-NO-ERROR                                               
067600                 MOVE -1              TO APOL                             
067700                 SET DP030-SET-CURSOR-APPL-1                              
067800                                      TO TRUE                             
067900                 MOVE PC-TSYMSG-00034 TO DP020-MSG-NUMBER                 
068000                 SET DP020-MSG-INFORMATIONAL                              
068100                                      TO TRUE                             
068200             END-IF                                                       
068300                                                                          
068400         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)                      
068500             IF ASC-UPDATE-CONFIRMED                                      
068600*                (F2 CONFIRM KEY WAS PRESSED)                             
068700                     PERFORM 30022-FUNC03-RACF                            
068800                     PERFORM 3000B-EDIT-FOR-UPDATE                        
068900                     IF PS-NO-ERROR                                       
069000                         PERFORM 6000-UPDATE                              
069100                         MOVE ASC-FUNCTION-SW                             
069200                                      TO PV-SAVE-FUNCTION-SW              
069300*                        INITIALIZE ASC-SPECIFIC-COMMAREA                 
069400                         MOVE PV-SAVE-FUNCTION-SW                         
069500                                      TO ASC-FUNCTION-SW                  
069600                         PERFORM 4000-BUILD-INITIAL-PANEL                 
069700                     END-IF                                               
069800                                                                          
069900                 IF PS-NO-ERROR                                           
070000                     MOVE -1          TO APOL                             
070100                     SET DP030-SET-CURSOR-APPL-1                          
070200                                      TO TRUE                             
070300                     MOVE PC-TSYMSG-00059 TO DP020-MSG-NUMBER             
070400                     SET DP020-MSG-INFORMATIONAL                          
070500                                      TO TRUE                             
070600                 END-IF                                                   
070700             ELSE                                                         
070800                 SET ASC-UPDATE-PENDING TO TRUE                           
070900                     MOVE -1          TO MR-SELECTL (1)                   
071000                     SET DP030-SET-CURSOR-APPL-1                          
071100                                      TO TRUE                             
071200                     MOVE PC-TSYMSG-02176 TO DP020-MSG-NUMBER             
071300                     SET DP020-MSG-INFORMATIONAL                          
071400                                      TO TRUE                             
071500             END-IF                                                       
071600                                                                          
071700         WHEN DP020-FK-DISPN-GO (DP020-SRC-AID)                           
071800             PERFORM 2110-PREPARE-INTER-APPL-COMM                         
071900                                                                          
072000         WHEN DP020-SRC-AID = DP016-ENTER                                 
072100             CONTINUE                                                     
072200*            MOVE -1                  TO APOL                             
072300*            SET DP030-SET-CURSOR-APPL-1                                  
072400*                                     TO TRUE                             
072500*            PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
072600                                                                          
072700*  REPAINT THE SCREEN IF ANY PARMS HAVE CHANGED                           
072800*                        MOVE ASC-FUNCTION-SW                             
072900*                                     TO PV-SAVE-FUNCTION-SW              
073000*                        INITIALIZE ASC-SPECIFIC-COMMAREA                 
073100*                        MOVE PV-SAVE-FUNCTION-SW                         
073200*                                     TO ASC-FUNCTION-SW                  
073300*                        PERFORM 4000-BUILD-INITIAL-PANEL                 
073400                                                                          
073500         WHEN OTHER                                                       
073600             SET DP013-NO-ROLLBACK                                        
073700                 DP013-XCTL-DISPLAY-RESTART                               
073800                 DP013-CICS-ABEND  TO TRUE                                
073900             MOVE '2100-CHECK-FUNCTION-KEY'                               
074000                                   TO DP013-PARAGRAPH                     
074100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'              
074200                                   TO DP013-MESSAGE-TEXT (1)              
074300             MOVE 'OR CODE MISSING FROM THIS PROGRAM TO PROCESS:'         
074400                                   TO DP013-MESSAGE-TEXT (2)              
074500             MOVE DP020-SRC-AID    TO PM-A-SRC-AID                        
074600             MOVE DP020-FK-ACTION (DP020-SRC-AID)                         
074700                                   TO PM-A-FK-ACTION                      
074800             MOVE DP020-FK-DISPN-IND (DP020-SRC-AID)                      
074900                                   TO PM-A-FK-DISPN                       
075000             MOVE PM-ABEND-INFO-A  TO DP013-MESSAGE-TEXT (3)              
075100             MOVE 'REVIEW PFKEYS SETUP FOR THIS MNEMONIC.'                
075200                                   TO DP013-MESSAGE-TEXT (4)              
075300             PERFORM DP013-0000-PROCESS-ABEND                             
075400     END-EVALUATE                                                         
075500     END-IF.                                                              
075600                                                                          
075700******************************************************************        
075800** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **        
075900** INTER-APPLICATION COMMAREA.                                  **        
076000******************************************************************        
076100 2110-PREPARE-INTER-APPL-COMM.                                            
076400                                                                          
076500     MOVE ASC-SAVE-AUDIT-TYPE         TO SU021-AUDIT-TYPE                 
076600     MOVE ASC-PO-NBR-N                TO SU021-PO-NBR                     
076700     MOVE ASC-SAVE-OPER-UNT-ID-N      TO SU021-OPER-UNT-ID                
076800     MOVE ASC-PKGNG-CDE               TO SU021-PKGNG-CDE                  
076900     MOVE ASC-PKGNG-DESC              TO SU021-PKGNG-DESC                 
077000     MOVE ASC-PO-LINE-NBR-N           TO SU021-PO-LINE-NBR                
077100     MOVE ASC-PREPACK-ID-N            TO SU021-PREPACK-ID.                
077200     MOVE ASC-TO-DATE                 TO SU021-SHIP-TO-DATE               
077300     MOVE ASC-FROM-DATE               TO SU021-SHIP-FROM-DATE.            
077400/                                                                         
077500 2200-MOVE-SCREEN-TO-COMMAREA.                                            
077600     IF  APOL > ZERO                                                      
077700         MOVE APOI                TO ASC-PO-NBR                           
077800     ELSE                                                                 
077900         IF APOF = DP015-ERASE-EOF                                        
078000             MOVE SPACES           TO ASC-PO-NBR                          
078100                                      APKGTYPO                            
078200         END-IF                                                           
078300     END-IF                                                               
078400                                                                          
078500     IF  ALINEL > ZERO                                                    
078600         MOVE ALINEI              TO ASC-PO-LINE-NBR                      
078700     ELSE                                                                 
078800         IF ALINEF = DP015-ERASE-EOF                                      
078900             MOVE SPACE            TO ASC-PO-LINE-NBR                     
079000         END-IF                                                           
079100     END-IF                                                               
079200                                                                          
079300     IF  APREPKL > ZERO                                                   
079400         MOVE APREPKI             TO ASC-PREPACK-ID                       
079500     ELSE                                                                 
079600         IF APREPKF = DP015-ERASE-EOF                                     
079700             MOVE SPACE            TO ASC-PREPACK-ID                      
079800         END-IF                                                           
079900     END-IF.                                                              
080000                                                                          
080100     PERFORM VARYING MR-IDX FROM 1 BY 1                                   
080200                      UNTIL MR-IDX > 21                                   
080300         SET ASC-MAP-IDX              TO MR-IDX                           
080400         IF  MR-SELECTL (MR-IDX) > ZERO                                   
080500             MOVE MR-SELECT (MR-IDX)  TO ASC-AUDIT-TYPE                   
080600                                         (ASC-MAP-IDX)                    
080700         ELSE                                                             
080800             IF MR-SELECTF (MR-IDX) = DP015-ERASE-EOF                     
080900                MOVE SPACE            TO ASC-AUDIT-TYPE                   
081000                                            (ASC-MAP-IDX)                 
081100             END-IF                                                       
081200         END-IF                                                           
081300     END-PERFORM.                                                         
081400/                                                                         
081500 3000-EDIT-DATA-IN-COMMAREA.                                              
081600     SET PS-NO-ERROR               TO TRUE.                               
081700     PERFORM 3200-RESET-ATTRIBUTES.                                       
081800                                                                          
081900*    TRANSFERING TO LIST SCREEN SO ADD/UPDATE SHOULD BE CANCELLED         
082000     EVALUATE TRUE                                                        
082100         WHEN ASC-ADD-FUNCTION                                            
082200              PERFORM 3000A-EDIT-FOR-ADD                                  
082300         WHEN ASC-UPD-FUNCTION                                            
082400              PERFORM 3000B-EDIT-FOR-UPDATE                               
082500     END-EVALUATE.                                                        
082600                                                                          
082700 3000A-EDIT-FOR-ADD.                                                      
082800                                                                          
082900     PERFORM 3001-NUMERIC-CHECK.                                          
083000                                                                          
083100     IF DK-PO-NBR = ZERO                                                  
083200         MOVE -1                      TO APOL                             
083300         MOVE DP015-RED               TO APOC                             
083400         MOVE PC-TSYMSG-00007         TO DP020-MSG-NUMBER                 
083500         SET DP020-MSG-FATAL                                              
083600             DP030-SET-CURSOR-APPL-1                                      
083700             PS-ERROR                 TO TRUE                             
083800     ELSE                                                                 
083900         PERFORM 7030-SELECT-TPURCHS                                      
084000         MOVE ASC-PKGNG-DESC          TO APKGTYPO                         
084100     END-IF.                                                              
084200                                                                          
084300     IF DK-PO-NBR > ZERO AND PS-NO-ERROR                                  
084400         EVALUATE TRUE                                                    
084500         WHEN ASC-PO-LINE-NBR-N = ZERO                                    
084600                   AND ASC-PREPACK-ID-N = ZERO                            
084700             CONTINUE                                                     
084800         WHEN ASC-PREPACK-ID-N > ZERO                                     
084900                  AND ASC-PO-LINE-NBR-N > ZERO                            
085000             MOVE -1              TO ALINEL                               
085100             MOVE DP015-RED       TO ALINEC                               
085200                                     APREPKC                              
085300             MOVE PC-TSYMSG-00973 TO DP020-MSG-NUMBER                     
085400             SET DP020-MSG-FATAL                                          
085500                 DP030-SET-CURSOR-APPL-1                                  
085600                 PS-ERROR         TO TRUE                                 
085700         WHEN ASC-PO-LINE-NBR-N > ZERO                                    
085800             IF ASC-PKGNG-CDE = 'M' OR 'I' OR ' '                         
085900                 MOVE -1              TO ALINEL                           
086000                 MOVE DP015-RED       TO ALINEC                           
086100                 MOVE PC-TSYMSG-02859 TO DP020-MSG-NUMBER                 
086200                 SET DP020-MSG-FATAL                                      
086300                     DP030-SET-CURSOR-APPL-1                              
086400                     PS-ERROR         TO TRUE                             
086500             ELSE                                                         
086600                 PERFORM 7040-SELECT-TPURITM                              
086700             END-IF                                                       
086800         WHEN ASC-PREPACK-ID-N > ZERO                                     
086900             IF ASC-PKGNG-CDE = 'M' OR 'I'                                
087000                 PERFORM 7050-SELECT-POPRPK                               
087100             ELSE                                                         
087200                 MOVE -1              TO APREPKL                          
087300                 MOVE DP015-RED       TO APREPKC                          
087400                 MOVE PC-TSYMSG-02860 TO DP020-MSG-NUMBER                 
087500                 SET DP020-MSG-FATAL                                      
087600                     DP030-SET-CURSOR-APPL-1                              
087700                     PS-ERROR         TO TRUE                             
087800             END-IF                                                       
087900         END-EVALUATE                                                     
088000     END-IF.                                                              
088100                                                                          
088200     IF PS-NO-ERROR                                                       
088300*        (THE FIRST OCCURRENCE IS ALWAYS 'ALL DC'S')                      
088400         INITIALIZE PV-AUD-COUNTERS                                       
088500         PERFORM 3000A1-SCAN-AUDIT-TYPES                                  
088600              VARYING ASC-MAP-IDX FROM 1 BY 1                             
088700                  UNTIL ASC-MAP-IDX > 21                                  
088800     END-IF.                                                              
088900                                                                          
089000     IF PS-NO-ERROR                                                       
089100         IF ASC-AUDIT-TYPE (1) = 'A' OR 'N' OR                            
      *SB 10/07/13 - BEGIN PR#5148D                                             
                                       'R' OR 'Q'                               
      *SB 10/07/13 - END PR#5148D                                               
089200*            YOU MUST CHOOSE BETWEEN ALL AND INDIVIDUAL DCS               
089300             IF PV-SPACE-COUNT = 20                                       
089400                 CONTINUE                                                 
089500             ELSE                                                         
089600                 MOVE -1              TO MR-SELECTL(1)                    
089700                 MOVE DP015-RED       TO MR-SELECTC(1)                    
089800                 MOVE PC-TSYMSG-02869 TO DP020-MSG-NUMBER                 
089900                 SET DP020-MSG-FATAL                                      
090000                     DP030-SET-CURSOR-APPL-1                              
090100                     PS-ERROR         TO TRUE                             
090200             END-IF                                                       
090300         ELSE                                                             
090400*            ALL-DCS WAS BLANK THEN YOU MUST CHOOSE ANOTHER DC            
090500             IF PV-SPACE-COUNT = 21                                       
090600                 MOVE -1              TO MR-SELECTL(1)                    
090700                 MOVE DP015-RED       TO MR-SELECTC(1)                    
090800                 MOVE PC-TSYMSG-02868 TO DP020-MSG-NUMBER                 
090900                 SET DP020-MSG-FATAL                                      
091000                     DP030-SET-CURSOR-APPL-1                              
091100                     PS-ERROR         TO TRUE                             
091200             END-IF                                                       
091300                 CONTINUE                                                 
091400         END-IF                                                           
091500     END-IF.                                                              
091600                                                                          
091700     IF PS-NO-ERROR                                                       
091800         PERFORM 3008-PREEXISTING-EXCEPTIONS                              
091900         IF PS-AUDIT-FOUND                                                
092000             MOVE -1                  TO APOL                             
092100             MOVE DP015-RED           TO APOC                             
092200             SET DP020-MSG-FATAL                                          
092300                 DP030-SET-CURSOR-APPL-1                                  
092400                 PS-ERROR             TO TRUE                             
092500             MOVE PC-TSYMSG-02864     TO DP020-MSG-NUMBER                 
092600         END-IF                                                           
092700     END-IF.                                                              
                                                                                
      *SB 10/07/13 - BEGIN PR#5148D                                             
           IF PS-NO-ERROR                                                       
               IF (ASC-AUDIT-TYPE (1) = 'R' AND PV-SPACE-COUNT = 20) OR         
                   PV-R-COUNT > 0                                               
                  PERFORM 3500-DETERMINE-IF-RFID                                
                  VARYING ASC-MAP-IDX FROM 2 BY 1                               
                          UNTIL ASC-MAP-IDX > 21                                
               END-IF                                                           
           END-IF.                                                              
      *SB 10/07/13 - END PR#5148D                                               
092800                                                                          
092900 3000A1-SCAN-AUDIT-TYPES.                                                 
093000                                                                          
093100     EVALUATE ASC-AUDIT-TYPE (ASC-MAP-IDX)                                
093200         WHEN 'D'                                                         
093300             SET MR-IDX               TO ASC-MAP-IDX                      
093400             MOVE -1                  TO MR-SELECTL(MR-IDX)               
093500             MOVE DP015-RED           TO MR-SELECTC(MR-IDX)               
093600             MOVE PC-TSYMSG-00005     TO DP020-MSG-NUMBER                 
093700             ADD 1                    TO PV-D-COUNT                       
093800             SET DP020-MSG-FATAL                                          
093900                 DP030-SET-CURSOR-APPL-1                                  
094000                 PS-ERROR             TO TRUE                             
094100         WHEN 'A'                                                         
094200             ADD 1                    TO PV-A-COUNT                       
094300         WHEN 'N'                                                         
094400             ADD 1                    TO PV-N-COUNT                       
      *SB 10/07/13 - BEGIN PR#5148D                                             
094300         WHEN 'R'                                                         
094400             ADD 1                    TO PV-R-COUNT                       
094300         WHEN 'Q'                                                         
094400             ADD 1                    TO PV-Q-COUNT                       
      *SB 10/07/13 - END PR#5148D                                               
094500         WHEN 'S'                                                         
094600             ADD 1                    TO PV-S-COUNT                       
094700             SET MR-IDX               TO ASC-MAP-IDX                      
094800             MOVE -1                  TO MR-SELECTL(MR-IDX)               
094900             MOVE DP015-RED           TO MR-SELECTC(MR-IDX)               
095000             MOVE PC-TSYMSG-00005     TO DP020-MSG-NUMBER                 
095100             ADD 1                    TO PV-D-COUNT                       
095200             SET DP020-MSG-FATAL                                          
095300                 DP030-SET-CURSOR-APPL-1                                  
095400                 PS-ERROR             TO TRUE                             
095500         WHEN SPACE                                                       
095600             ADD 1                    TO PV-SPACE-COUNT                   
095700         WHEN OTHER                                                       
095800             ADD 1                    TO PV-CRAP-COUNT                    
095900             SET MR-IDX               TO ASC-MAP-IDX                      
096000             MOVE -1                  TO MR-SELECTL(MR-IDX)               
096100             MOVE DP015-RED           TO MR-SELECTC(MR-IDX)               
096200             MOVE PC-TSYMSG-00005     TO DP020-MSG-NUMBER                 
096300             SET DP020-MSG-FATAL                                          
096400                 DP030-SET-CURSOR-APPL-1                                  
096500                 PS-ERROR             TO TRUE                             
096600     END-EVALUATE.                                                        
096700                                                                          
096800/                                                                         
096900 3000B-EDIT-FOR-UPDATE.                                                   
097000                                                                          
097100     PERFORM 3001-NUMERIC-CHECK.                                          
097200                                                                          
097300     IF DK-PO-NBR = ZERO                                                  
097400         MOVE -1                      TO APOL                             
097500         MOVE DP015-RED               TO APOC                             
097600         MOVE PC-TSYMSG-00007         TO DP020-MSG-NUMBER                 
097700         SET DP020-MSG-FATAL                                              
097800             DP030-SET-CURSOR-APPL-1                                      
097900             PS-ERROR                 TO TRUE                             
098000     ELSE                                                                 
098100         PERFORM 7030-SELECT-TPURCHS                                      
098200         MOVE ASC-PKGNG-DESC          TO APKGTYPO                         
098300                                         SU020-PKGNG-DESC                 
098400     END-IF.                                                              
098500                                                                          
098600     IF DK-PO-NBR > ZERO AND PS-NO-ERROR                                  
098700         EVALUATE TRUE                                                    
098800         WHEN ASC-PO-LINE-NBR-N = ZERO                                    
098900                   AND ASC-PREPACK-ID-N = ZERO                            
099000             CONTINUE                                                     
099100         WHEN ASC-PREPACK-ID-N > ZERO                                     
099200                  AND ASC-PO-LINE-NBR-N > ZERO                            
099300             MOVE -1              TO ALINEL                               
099400             MOVE DP015-RED       TO ALINEC                               
099500                                     APREPKC                              
099600             MOVE PC-TSYMSG-00973 TO DP020-MSG-NUMBER                     
099700             SET DP020-MSG-FATAL                                          
099800                 DP030-SET-CURSOR-APPL-1                                  
099900                 PS-ERROR         TO TRUE                                 
100000         WHEN ASC-PO-LINE-NBR-N > ZERO                                    
100100             IF ASC-PKGNG-CDE = 'M' OR 'I' OR ' '                         
100200                 MOVE -1              TO ALINEL                           
100300                 MOVE DP015-RED       TO ALINEC                           
100400                 MOVE PC-TSYMSG-02859 TO DP020-MSG-NUMBER                 
100500                 SET DP020-MSG-FATAL                                      
100600                     DP030-SET-CURSOR-APPL-1                              
100700                     PS-ERROR         TO TRUE                             
100800             ELSE                                                         
100900                 PERFORM 7040-SELECT-TPURITM                              
101000             END-IF                                                       
101100         WHEN ASC-PREPACK-ID-N > ZERO                                     
101200             IF ASC-PKGNG-CDE = 'M' OR 'I'                                
101300                 PERFORM 7050-SELECT-POPRPK                               
101400             ELSE                                                         
101500                 MOVE -1              TO APREPKL                          
101600                 MOVE DP015-RED       TO APREPKC                          
101700                 MOVE PC-TSYMSG-02860 TO DP020-MSG-NUMBER                 
101800                 SET DP020-MSG-FATAL                                      
101900                     DP030-SET-CURSOR-APPL-1                              
102000                     PS-ERROR         TO TRUE                             
102100             END-IF                                                       
102200         END-EVALUATE                                                     
102300     END-IF.                                                              
102400                                                                          
102500     IF PS-NO-ERROR                                                       
102600         INITIALIZE PV-AUD-COUNTERS                                       
102700         PERFORM 3000B1-SCAN-AUDIT-TYPES                                  
102800              VARYING ASC-MAP-IDX FROM 1 BY 1                             
102900                  UNTIL ASC-MAP-IDX > 21                                  
103000     END-IF.                                                              
103100                                                                          
103200     IF PS-NO-ERROR                                                       
103300         IF PV-SPACE-COUNT = 21                                           
103400             MOVE -1                  TO MR-SELECTL(1)                    
103500             MOVE DP015-RED           TO MR-SELECTC(1)                    
103600             MOVE PC-TSYMSG-02868 TO DP020-MSG-NUMBER                     
103700             SET DP020-MSG-FATAL                                          
103800                 DP030-SET-CURSOR-APPL-1                                  
103900                 PS-ERROR             TO TRUE                             
104000         END-IF                                                           
104100     END-IF.                                                              
                                                                                
      *SB 10/07/13 - BEGIN PR#5148D                                             
           IF PS-NO-ERROR                                                       
              IF PV-R-COUNT > 0                                                 
                 PERFORM 3500-DETERMINE-IF-RFID                                 
                 VARYING ASC-MAP-IDX FROM 1 BY 1                                
                         UNTIL ASC-MAP-IDX > 21                                 
              END-IF                                                            
           END-IF.                                                              
      *SB 10/07/13 - END PR#5148D                                               
104200                                                                          
104300 3000B1-SCAN-AUDIT-TYPES.                                                 
104400                                                                          
104500     EVALUATE ASC-AUDIT-TYPE (ASC-MAP-IDX)                                
104600         WHEN 'D'                                                         
104700             ADD 1                    TO PV-D-COUNT                       
104800         WHEN 'A'                                                         
104900             ADD 1                    TO PV-A-COUNT                       
105000         WHEN 'N'                                                         
105100             ADD 1                    TO PV-N-COUNT                       
      *SB 10/07/13 - BEGIN PR#5148D                                             
105000         WHEN 'R'                                                         
105100             ADD 1                    TO PV-R-COUNT                       
105000         WHEN 'Q'                                                         
105100             ADD 1                    TO PV-Q-COUNT                       
      *SB 10/07/13 - END PR#5148D                                               
105200         WHEN 'S'                                                         
105300             ADD 1                    TO PV-S-COUNT                       
105400             SET MR-IDX               TO ASC-MAP-IDX                      
105500             MOVE -1                  TO MR-SELECTL(MR-IDX)               
105600             MOVE DP015-RED           TO MR-SELECTC(MR-IDX)               
105700             MOVE PC-TSYMSG-00005     TO DP020-MSG-NUMBER                 
105800             SET DP020-MSG-FATAL                                          
105900                 DP030-SET-CURSOR-APPL-1                                  
106000                 PS-ERROR             TO TRUE                             
106100         WHEN SPACE                                                       
106200             ADD 1                    TO PV-SPACE-COUNT                   
106300         WHEN OTHER                                                       
106400             ADD 1                    TO PV-CRAP-COUNT                    
106500             SET MR-IDX               TO ASC-MAP-IDX                      
106600             MOVE -1                  TO MR-SELECTL(MR-IDX)               
106700             MOVE DP015-RED           TO MR-SELECTC(MR-IDX)               
106800             MOVE PC-TSYMSG-00005     TO DP020-MSG-NUMBER                 
106900             SET DP020-MSG-FATAL                                          
107000                 DP030-SET-CURSOR-APPL-1                                  
107100                 PS-ERROR             TO TRUE                             
107200     END-EVALUATE.                                                        
107300                                                                          
107400 3001-NUMERIC-CHECK.                                                      
107500     MOVE ASC-PO-NBR                  TO DP010I-UNEDITED-FIELD            
107600     MOVE +9                          TO DP010I-MAXIMUM-DIGITS            
107700     MOVE ZERO                        TO DP010I-MAXIMUM-DECIMALS          
107800     SET DP010I-NEGATIVE-NOT-ALLOWED  TO TRUE                             
107900                                                                          
263968     CALL DP010I-NUMERIC-EDIT-ROUTINE                                     
263968          USING DP010I-NUMERIC-EDIT-AREA                                  
108100                                                                          
108200     IF DP010I-NO-ERROR-DETECTED                                          
108300         MOVE DP010I-NUMERIC-FIELD                                        
108400                                      TO DK-PO-NBR                        
108500                                         ASC-PO-NBR-N                     
108600     ELSE                                                                 
108700         MOVE -1                      TO APOL                             
108800         MOVE DP015-RED               TO APOC                             
108900         MOVE PC-TSYMSG-00008         TO DP020-MSG-NUMBER                 
109000         SET DP020-MSG-FATAL                                              
109100             DP030-SET-CURSOR-APPL-1                                      
109200             PS-ERROR                 TO TRUE                             
109300     END-IF.                                                              
109400                                                                          
109500     MOVE ASC-PO-LINE-NBR             TO DP010I-UNEDITED-FIELD            
109600     MOVE +4                          TO DP010I-MAXIMUM-DIGITS            
109700     MOVE ZERO                        TO DP010I-MAXIMUM-DECIMALS          
109800     SET DP010I-NEGATIVE-NOT-ALLOWED  TO TRUE                             
109900                                                                          
263968     CALL DP010I-NUMERIC-EDIT-ROUTINE                                     
263968          USING DP010I-NUMERIC-EDIT-AREA                                  
110100                                                                          
110200     IF DP010I-NO-ERROR-DETECTED                                          
110300         MOVE DP010I-NUMERIC-FIELD                                        
110400                                      TO DK-PO-LINE-NBR                   
110500                                         ASC-PO-LINE-NBR-N                
110600     ELSE                                                                 
110700         MOVE -1                      TO ALINEL                           
110800         MOVE DP015-RED               TO ALINEC                           
110900         MOVE PC-TSYMSG-00008         TO DP020-MSG-NUMBER                 
111000         SET DP020-MSG-FATAL                                              
111100             DP030-SET-CURSOR-APPL-1                                      
111200             PS-ERROR                 TO TRUE                             
111300     END-IF.                                                              
111400                                                                          
111500     MOVE ASC-PREPACK-ID              TO DP010I-UNEDITED-FIELD            
111600     MOVE +4                          TO DP010I-MAXIMUM-DIGITS            
111700     MOVE ZERO                        TO DP010I-MAXIMUM-DECIMALS          
111800     SET DP010I-NEGATIVE-NOT-ALLOWED  TO TRUE                             
111900                                                                          
263968     CALL DP010I-NUMERIC-EDIT-ROUTINE                                     
263968          USING DP010I-NUMERIC-EDIT-AREA                                  
112100                                                                          
112200     IF DP010I-NO-ERROR-DETECTED                                          
112300         MOVE DP010I-NUMERIC-FIELD                                        
112400                                      TO DK-PREPACK-ID                    
112500                                         ASC-PREPACK-ID-N                 
112600     ELSE                                                                 
112700         MOVE -1                      TO APREPKL                          
112800         MOVE DP015-RED               TO APREPKC                          
112900         MOVE PC-TSYMSG-00008         TO DP020-MSG-NUMBER                 
113000         SET DP020-MSG-FATAL                                              
113100             DP030-SET-CURSOR-APPL-1                                      
113200             PS-ERROR                 TO TRUE                             
113300     END-IF.                                                              
113400                                                                          
113500                                                                          
113600 30021-FUNC01-RACF.                                                       
113700     MOVE 'SUAUDPOA'                  TO DP008-FUNCTION-NAME              
113800     PERFORM 8000-CALL-RACF.                                              
113900     IF DP008-ACCESS-ALLOWED                                              
114000         CONTINUE                                                         
114100     ELSE                                                                 
114200         MOVE -1                      TO APOL                             
114300         SET DP020-MSG-FATAL                                              
114400             DP030-SET-CURSOR-APPL-1                                      
114500             PS-ERROR                 TO TRUE                             
114600             MOVE PC-TSYMSG-02866     TO DP020-MSG-NUMBER                 
114700     END-IF.                                                              
114800                                                                          
114900 30022-FUNC03-RACF.                                                       
115000     MOVE 'SUAUDPOU'                  TO DP008-FUNCTION-NAME              
115100     PERFORM 8000-CALL-RACF.                                              
115200     IF DP008-ACCESS-ALLOWED                                              
115300         CONTINUE                                                         
115400     ELSE                                                                 
115500         MOVE -1                      TO APOL                             
115600         SET DP020-MSG-FATAL                                              
115700             DP030-SET-CURSOR-APPL-1                                      
115800             PS-ERROR                 TO TRUE                             
115900             MOVE PC-TSYMSG-02867     TO DP020-MSG-NUMBER                 
116000     END-IF.                                                              
116100                                                                          
116200 30023-UPDATE-RACF.                                                       
116300     MOVE 'SUAUDPOU'                  TO DP008-FUNCTION-NAME              
116400     PERFORM 8000-CALL-RACF.                                              
116500     IF DP008-ACCESS-ALLOWED                                              
116600         SET  ASC-ACCESS-ALLOWED           TO TRUE                        
116700     ELSE                                                                 
116800         SET  ASC-ACCESS-DENIED            TO TRUE                        
116900     END-IF.                                                              
117000                                                                          
117100 3003-EDIT-PO-NBR.                                                        
117200     MOVE ASC-PO-NBR                  TO DP010I-UNEDITED-FIELD            
117300     MOVE +9                          TO DP010I-MAXIMUM-DIGITS            
117400     MOVE ZERO                        TO DP010I-MAXIMUM-DECIMALS          
117500     SET DP010I-NEGATIVE-NOT-ALLOWED  TO TRUE                             
117600                                                                          
263968     CALL DP010I-NUMERIC-EDIT-ROUTINE                                     
263968          USING DP010I-NUMERIC-EDIT-AREA                                  
117800                                                                          
117900     IF DP010I-NO-ERROR-DETECTED                                          
118000         MOVE DP010I-NUMERIC-FIELD                                        
118100                                      TO DK-PO-NBR                        
118200                                         ASC-PO-NBR-N                     
118300     ELSE                                                                 
118400         MOVE -1                      TO APOL                             
118500         MOVE DP015-RED               TO APOC                             
118600         MOVE PC-TSYMSG-00008         TO DP020-MSG-NUMBER                 
118700         SET DP020-MSG-FATAL                                              
118800             DP030-SET-CURSOR-APPL-1                                      
118900             PS-ERROR                 TO TRUE                             
119000     END-IF.                                                              
119400                                                                          
119500 3004-EDIT-PO-LINE-NBR.                                                   
119600     MOVE ASC-PO-LINE-NBR             TO DP010I-UNEDITED-FIELD            
119700     MOVE +9                          TO DP010I-MAXIMUM-DIGITS            
119800     MOVE ZERO                        TO DP010I-MAXIMUM-DECIMALS          
119900     SET DP010I-NEGATIVE-NOT-ALLOWED  TO TRUE                             
120000                                                                          
263968     CALL DP010I-NUMERIC-EDIT-ROUTINE                                     
263968          USING DP010I-NUMERIC-EDIT-AREA                                  
120200                                                                          
120300     IF DP010I-NO-ERROR-DETECTED                                          
120400         MOVE DP010I-NUMERIC-FIELD                                        
120500                                      TO DK-PO-LINE-NBR                   
120600                                         ASC-PO-LINE-NBR-N                
120700     ELSE                                                                 
120800         MOVE -1                      TO ALINEL                           
120900         MOVE DP015-RED               TO ALINEC                           
121000         MOVE PC-TSYMSG-00008         TO DP020-MSG-NUMBER                 
121100         SET DP020-MSG-FATAL                                              
121200             DP030-SET-CURSOR-APPL-1                                      
121300             PS-ERROR                 TO TRUE                             
121400     END-IF.                                                              
121500                                                                          
122800 3006-EDIT-PREPACK.                                                       
122900     MOVE ASC-PREPACK-ID              TO DP010I-UNEDITED-FIELD            
123000     MOVE +4                          TO DP010I-MAXIMUM-DIGITS            
123100     MOVE ZERO                        TO DP010I-MAXIMUM-DECIMALS          
123200     SET DP010I-NEGATIVE-NOT-ALLOWED  TO TRUE                             
123300                                                                          
263968     CALL DP010I-NUMERIC-EDIT-ROUTINE                                     
263968          USING DP010I-NUMERIC-EDIT-AREA                                  
123500                                                                          
123600     IF DP010I-NO-ERROR-DETECTED                                          
123700         MOVE DP010I-NUMERIC-FIELD    TO DK-PREPACK-ID                    
123800                                         ASC-PREPACK-ID-N                 
123900     ELSE                                                                 
124000         MOVE -1                      TO APREPKL                          
124100         MOVE DP015-RED               TO APREPKC                          
124200         MOVE PC-TSYMSG-00008         TO DP020-MSG-NUMBER                 
124300         SET DP020-MSG-FATAL                                              
124400             DP030-SET-CURSOR-APPL-1                                      
124500             PS-ERROR                 TO TRUE                             
124600     END-IF.                                                              
124700                                                                          
124900                                                                          
125000 3008-PREEXISTING-EXCEPTIONS.                                             
125100* CHECK ALL DC'S MARKED.  IF 'ALL-DCS' IS MARKED THEN IGNORE THE          
125200* REST.  THERE CANNOT BE ANY PREEXISTING ROWS FOR THE DC'S MARKED         
125300     PERFORM 30081-SET-KEYS.                                              
125400     PERFORM VARYING ASC-MAP-IDX FROM 1 BY 1                              
125500                    UNTIL ASC-MAP-IDX > 21                                
125600         IF ASC-AUDIT-TYPE (1) = 'A' OR 'N' OR                            
      *SB 10/07/13 - BEGIN PR#5148D                                             
                                       'R' OR 'Q'                               
      *SB 10/07/13 - END PR#5148D                                               
125700             MOVE ZEROES              TO DK-OPER-FROM                     
125800             MOVE 9999                TO DK-OPER-TO                       
125900             PERFORM 7060-SELECT-SUT-PO-AUD-EXC                           
126000             SET ASC-MAP-IDX          TO 21                               
126100         ELSE                                                             
126200             IF ASC-AUDIT-TYPE (ASC-MAP-IDX) = 'A' OR 'N' OR              
      *SB 10/07/13 - BEGIN PR#5148D                                             
                                                     'R' OR 'Q'                 
      *SB 10/07/13 - END PR#5148D                                               
126300                 MOVE ASC-OPER-UNT-ID-N (ASC-MAP-IDX)                     
126400                                      TO DK-OPER-FROM                     
126500                                         DK-OPER-TO                       
126600                 PERFORM 7060-SELECT-SUT-PO-AUD-EXC                       
126700             END-IF                                                       
126800         END-IF                                                           
126900     END-PERFORM.                                                         
127000                                                                          
127100 30081-SET-KEYS.                                                          
127200                                                                          
127300     MOVE ASC-PO-LINE-NBR-N           TO DK-PO-LINE-NBR                   
127400     MOVE ASC-PREPACK-ID-N            TO DK-PREPACK-ID.                   
129100/                                                                         
129200******************************************************************        
129300** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **        
129400** MAP.                                                         **        
129500******************************************************************        
129600 3200-RESET-ATTRIBUTES.                                                   
129700     MOVE DP015-UNP-NUM-NOR-OFF       TO APOA                             
129800                                         ALINEA                           
129900                                         APREPKA                          
130000                                                                          
130100     MOVE DP015-GREEN                 TO APOC                             
130200                                         ALINEC                           
130300                                         APREPKC                          
130400                                                                          
130500     MOVE DP015-UNDERLINE             TO APOH                             
130600                                         ALINEH                           
130700                                         APREPKH.                         
130800                                                                          
130900     PERFORM VARYING MR-IDX FROM 1 BY 1 UNTIL MR-IDX > 21                 
131000         MOVE DP015-GREEN             TO MR-SELECTC(MR-IDX)               
131100     END-PERFORM.                                                         
131200                                                                          
      *SB 10/07/13 - BEGIN PR#5148D                                             
       3500-DETERMINE-IF-RFID.                                                  
                                                                                
           SET SU093-PO-LEVEL-CHECK            TO TRUE.                         
           SET SU093-RFID-STR-CHK-NEEDED-NO    TO TRUE.                         
           SET SU093-CHECK-BY-DEPT-SUBCLS-YES  TO TRUE.                         
           SET SU093-CHECK-BY-DC               TO TRUE.                         
                                                                                
           MOVE ASC-PO-NBR-N                   TO SU093-KEY-PO.                 
                                                                                
           IF (ASC-ADD-FUNCTION AND ASC-AUDIT-TYPE (1) = 'R') OR                
               ASC-AUDIT-TYPE (ASC-MAP-IDX) = 'R'                               
              MOVE ASC-OPER-UNT-ID (ASC-MAP-IDX)                                
                                               TO SU093-KEY-OPER-UNT-ID         
              CALL SU093-RFID-PGM           USING DFHEIBLK                      
                                                  SU093-COMMAREA                
                                                  SU093-ITEM-COMMAREA           
                                                                                
              EVALUATE TRUE                                                     
                WHEN SU093-SUCCESSFUL                                           
                  IF SU093-RFID-YES                                             
                     CONTINUE                                                   
      *              MOVE PC-RFID    TO ASC-RFID-DISPLAYED                      
      *              EVALUATE TRUE                                              
      *                WHEN SU093-VNDR-DPT-RFID-COMPLI-YES                      
      *                     MOVE PC-C TO ASC-VNDR-DISPLAYED                     
      *                WHEN SU093-VNDR-DPT-RFID-TAGS-YES                        
      *                     MOVE PC-T TO ASC-VNDR-DISPLAYED                     
      *                WHEN OTHER                                               
      *                     MOVE PC-N TO ASC-VNDR-DISPLAYED                     
      *               END-EVALUATE                                              
                 ELSE                                                           
                      IF ASC-ADD-FUNCTION AND ASC-AUDIT-TYPE (1) = 'R'          
                         MOVE -1              TO MR-SELECTL(1)                  
                         MOVE DP015-RED       TO MR-SELECTC(1)                  
                      ELSE                                                      
                         SET MR-IDX           TO ASC-MAP-IDX                    
                         MOVE -1              TO MR-SELECTL(MR-IDX)             
                         MOVE DP015-RED       TO MR-SELECTC(MR-IDX)             
                      END-IF                                                    
                      MOVE PC-TSYMSG-03737 TO DP020-MSG-NUMBER                  
                      SET  DP020-MSG-FATAL                                      
                           DP030-SET-CURSOR-APPL-1                              
                           PS-ERROR         TO TRUE                             
                 END-IF                                                         
              WHEN OTHER                                                        
                   MOVE '3500-DETERMINE-IF-RFID' TO DP013-PARAGRAPH             
                   MOVE 'PROBLEM WITH RETURN FROM SUKUT149'                     
                                              TO DP013-MESSAGE-TEXT (1)         
                   SET DP013-CICS-ABEND       TO TRUE                           
                   SET DP013-NO-ROLLBACK      TO TRUE                           
                   PERFORM DP013-0000-PROCESS-ABEND                             
             END-EVALUATE                                                       
           END-IF.                                                              
      *SB 10/07/13 - END PR#5148D                                               
131500/                                                                         
131600 4000-BUILD-INITIAL-PANEL.                                                
131700     SET DP030-SET-CURSOR-APPL-1      TO TRUE                             
132000     MOVE -1                          TO APOL.                            
132100                                                                          
132200     PERFORM 4010-OPEN-CURSOR.                                            
132300     PERFORM 4020-FETCH                                                   
132400                                                                          
132500     PERFORM VARYING ASC-MAP-IDX                                          
132600                 FROM 1 BY 1 UNTIL ASC-MAP-IDX > 21                       
132700                 OR PS-END-OF-CURSOR                                      
132800         IF  XLT00010-LOC-NBR  = ZERO                                     
132900              MOVE 'ALL'              TO ASC-OPER-UNT-ID                  
132900                                         (ASC-MAP-IDX)                    
132900                                         PV-OPER-UNT-DISPLAY              
132800         ELSE                                                             
132800             MOVE XLT00010-LOC-NBR    TO ASC-OPER-UNT-ID-N                
132900                                         (ASC-MAP-IDX)                    
132900                                         PV-OPER-UNT-DISPLAY              
132800         END-IF                                                           
133000         MOVE XLT00010-LOC-10-ABBR-NM TO ASC-STORE-NAME                   
133200                                          (ASC-MAP-IDX)                   
133300         STRING PV-OPER-UNT-DISPLAY                                       
133400             '-'                                                          
133500             XLT00010-LOC-10-ABBR-NM                                      
133600            DELIMITED BY SIZE            INTO ASC-LOCATION                
133700                                             (ASC-MAP-IDX)                
133800         IF ASC-UPD-FUNCTION AND ASC-PO-NBR > ZERO                        
133900             PERFORM 4001-AUDIT-TYPE                                      
134000             IF SQLCODE = ZERO                                            
134100                 MOVE SUT00014-AUD-TYP-CDE                                
134200                                      TO ASC-AUDIT-TYPE                   
134300                                         (ASC-MAP-IDX)                    
134400             ELSE                                                         
134500                 MOVE SPACES          TO ASC-AUDIT-TYPE                   
134600                                         (ASC-MAP-IDX)                    
134700             END-IF                                                       
134800         END-IF                                                           
134900                                                                          
135000         PERFORM 4020-FETCH                                               
135100     END-PERFORM.                                                         
135200                                                                          
135300     PERFORM 4030-CLOSE-CURSOR.                                           
135400                                                                          
136200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                                
136300     IF ASC-ADD-FUNCTION                                                  
136400         MOVE DP015-ASK-DRK-OFF       TO ADELETEA                         
136500         MOVE SPACES                  TO ADELETEO                         
136600     ELSE                                                                 
136700         MOVE DP015-ASK-NOR-OFF       TO ADELETEA                         
136800         MOVE 'D=DELETE'              TO ADELETEO                         
136900     END-IF.                                                              
137000                                                                          
137100 4001-AUDIT-TYPE.                                                         
137200     MOVE ASC-PO-NBR                  TO DK-PO-NBR                        
137300     MOVE ASC-PO-LINE-NBR             TO DK-PO-LINE-NBR                   
137400     MOVE ASC-PREPACK-ID              TO DK-PREPACK-ID                    
137500                                                                          
137600     IF ASC-PO-NBR > ZERO                                                 
137700         EVALUATE TRUE                                                    
137800         WHEN ASC-PREPACK-ID > ZERO                                       
137900             PERFORM 7020-SELECT-AUD-PPK                                  
138000         WHEN ASC-PO-LINE-NBR > ZERO                                      
138100             PERFORM 7010-SELECT-AUD-LNE                                  
138200         WHEN OTHER                                                       
138300             PERFORM 7000-SELECT-AUD-PO                                   
138400         END-EVALUATE                                                     
138500     END-IF.                                                              
138600                                                                          
138700 4010-OPEN-CURSOR.                                                        
138800                                                                          
138900     IF ASC-ADD-FUNCTION                                                  
139000         EXEC SQL                                                         
139100             OPEN LOCATION-ADD-CSR                                        
139200         END-EXEC                                                         
139300     ELSE                                                                 
139400         EXEC SQL                                                         
139500             OPEN LOCATION-UPD-CSR                                        
139600         END-EXEC                                                         
139700     END-IF                                                               
139800                                                                          
139900     EVALUATE TRUE                                                        
140000         WHEN SQLCODE = ZERO                                              
140100             CONTINUE                                                     
140200         WHEN SQLCODE = -904                                              
140300         WHEN SQLCODE = -911                                              
140400         WHEN SQLCODE = -913                                              
140500             PERFORM 9900-SOFT-ABORT                                      
140600         WHEN SQLWARN0 NOT = SPACES                                       
140700         WHEN SQLCODE < ZERO                                              
140800         WHEN SQLCODE > ZERO                                              
140900             MOVE '4010-OPEN-CURSOR'                                      
141000                                   TO DP013-PARAGRAPH                     
141100             MOVE 'OPEN TRAILER STATUS CURSOR - '                         
141200                                   TO DP013-MESSAGE-TEXT (1)              
141300             MOVE SQLCA        TO DP013-SQLCA                             
141400             MOVE 'XLT_LOC '   TO DP013-DB2-TABLE-NAME (1)                
141500             SET DP013-DB2-ABEND                                          
141600                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
141700             PERFORM DP013-0000-PROCESS-ABEND                             
141800     END-EVALUATE.                                                        
141900                                                                          
142000                                                                          
142100 4020-FETCH.                                                              
142200                                                                          
142300     IF ASC-ADD-FUNCTION                                                  
142400         EXEC SQL                                                         
142500             FETCH LOCATION-ADD-CSR                                       
142600             INTO                                                         
142700                 :XLT00010-LOC-NBR                                        
142800             ,   :XLT00010-LOC-10-ABBR-NM                                 
143000         END-EXEC                                                         
143100     ELSE                                                                 
143200         EXEC SQL                                                         
143300             FETCH LOCATION-UPD-CSR                                       
143400             INTO                                                         
142700                 :XLT00010-LOC-NBR                                        
142800             ,   :XLT00010-LOC-10-ABBR-NM                                 
143800         END-EXEC                                                         
143900     END-IF                                                               
144000                                                                          
144100     EVALUATE TRUE                                                        
144200         WHEN SQLCODE = ZERO                                              
144300              CONTINUE                                                    
144400         WHEN SQLCODE = +100                                              
144500             SET PS-END-OF-CURSOR     TO TRUE                             
144600         WHEN SQLCODE = -904                                              
144700         WHEN SQLCODE = -911                                              
144800         WHEN SQLCODE = -913                                              
144900             PERFORM 9900-SOFT-ABORT                                      
145000         WHEN SQLWARN0 NOT = SPACE                                        
145100         WHEN SQLCODE NOT = ZERO                                          
145200              MOVE '4020-FETCH-CURSOR'                                    
145300                               TO DP013-PARAGRAPH                         
145400              MOVE 'FETCH MESSAGE CURSOR'                                 
145500                               TO DP013-MESSAGE-TEXT (1)                  
145600              MOVE SQLCA       TO DP013-SQLCA                             
145700              SET DP013-DB2-ABEND                                         
145800                               TO TRUE                                    
145900              PERFORM DP013-0000-PROCESS-ABEND                            
146000     END-EVALUATE.                                                        
146100                                                                          
146200 4030-CLOSE-CURSOR.                                                       
146300                                                                          
146400     IF ASC-ADD-FUNCTION                                                  
146500         EXEC SQL                                                         
146600             CLOSE LOCATION-ADD-CSR                                       
146700         END-EXEC                                                         
146800     ELSE                                                                 
146900         EXEC SQL                                                         
147000             CLOSE LOCATION-UPD-CSR                                       
147100         END-EXEC                                                         
147200     END-IF                                                               
147300*                                                                         
147400     EVALUATE TRUE                                                        
147500         WHEN SQLCODE = ZERO                                              
147600             CONTINUE                                                     
147700         WHEN SQLCODE = -904                                              
147800         WHEN SQLCODE = -911                                              
147900         WHEN SQLCODE = -913                                              
148000             PERFORM 9900-SOFT-ABORT                                      
148100         WHEN SQLWARN0 NOT = SPACES                                       
148200         WHEN SQLCODE < ZERO                                              
148300         WHEN SQLCODE > ZERO                                              
148400             MOVE '4030-CLOSE-CURSOR'                                     
148500                               TO DP013-PARAGRAPH                         
148600             MOVE 'CLOSE CURSOR '                                         
148700                               TO DP013-MESSAGE-TEXT (1)                  
148800             MOVE SQLCA        TO DP013-SQLCA                             
148900             MOVE 'XLT_LOC '   TO DP013-DB2-TABLE-NAME (1)                
149000             SET DP013-DB2-ABEND                                          
149100                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
149200             PERFORM DP013-0000-PROCESS-ABEND                             
149300     END-EVALUATE.                                                        
149400                                                                          
149500*----------------------------------------------------------------*        
149600*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *        
149700*----------------------------------------------------------------*        
149800 4400-MOVE-COMMAREA-TO-SCREEN.                                            
149900                                                                          
150000     MOVE ASC-PO-NBR-N                TO APOO                             
150100*                                        SU021-PO-NBR                     
150200     MOVE ASC-PO-LINE-NBR-N           TO ALINEO                           
150300*                                        SU021-PO-LINE-NBR                
150400     MOVE ASC-PREPACK-ID-N            TO APREPKO                          
150500*                                        SU021-PREPACK-ID                 
150600     MOVE ASC-PKGNG-DESC              TO APKGTYPO                         
150700*                                        SU021-PKGNG-DESC                 
150800                                                                          
150900     IF  ASC-ACCESS-ALLOWED                                               
151000         CONTINUE                                                         
151100     ELSE                                                                 
151200         MOVE DP015-ASK-NOR-OFF   TO APOA                                 
151300                                     ALINEA                               
151400                                     APREPKA                              
151500                                     APKGTYPA                             
151600         MOVE DP015-HL-OFF        TO APOH                                 
151700                                     ALINEH                               
151800                                     APREPKH                              
151900                                     APKGTYPH                             
152000         MOVE DP015-BLUE          TO APOC                                 
152100                                     ALINEC                               
152200                                     APREPKC                              
152300                                     APKGTYPC                             
152400     END-IF.                                                              
152500                                                                          
152600     PERFORM VARYING ASC-MAP-IDX FROM 1 BY 1 UNTIL                        
152700                     ASC-MAP-IDX > 21                                     
152800         SET MR-IDX                   TO ASC-MAP-IDX                      
152900         IF ASC-OPER-UNT-ID (ASC-MAP-IDX) = SPACES                        
153000             CONTINUE                                                     
153100         ELSE                                                             
153200             SET MR-IDX               TO ASC-MAP-IDX                      
153300         END-IF                                                           
153400                                                                          
153500             MOVE ASC-LOCATION (ASC-MAP-IDX)                              
153600                                      TO MR-LOCATION (MR-IDX)             
153700                                                                          
153800             MOVE ASC-AUDIT-TYPE (ASC-MAP-IDX)                            
153900                                      TO MR-SELECT  (MR-IDX)              
154000                                                                          
154001         EVALUATE TRUE                                                    
154010         WHEN MR-LOCATION (MR-IDX) = SPACES OR LOW-VALUES                 
154020             MOVE DP015-ASK-NOR-OFF   TO MR-SELECTA (MR-IDX)              
154030             MOVE DP015-HL-OFF        TO MR-SELECTH (MR-IDX)              
154040             MOVE DP015-BLUE          TO MR-SELECTC (MR-IDX)              
154100         WHEN ASC-ACCESS-ALLOWED                                          
154200             MOVE DP015-UNP-ALP-NOR-OFF                                   
154300                                      TO MR-SELECTA (MR-IDX)              
154400             MOVE DP015-UNDERLINE     TO MR-SELECTH (MR-IDX)              
154500         WHEN OTHER                                                       
154600             MOVE DP015-ASK-NOR-OFF   TO MR-SELECTA (MR-IDX)              
154700             MOVE DP015-HL-OFF        TO MR-SELECTH (MR-IDX)              
154800             MOVE DP015-BLUE          TO MR-SELECTC (MR-IDX)              
154900         END-EVALUATE                                                     
155000     END-PERFORM.                                                         
155100/                                                                         
155200 5000-ADD.                                                                
155300     IF ASC-AUDIT-TYPE (1) = 'A' OR 'N' OR                                
      *SB 10/07/13 - BEGIN PR#5148D                                             
                                   'R' OR 'Q'                                   
      *SB 10/07/13 - END PR#5148D                                               
155400         PERFORM VARYING ASC-MAP-IDX FROM 2 BY 1                          
155500                 UNTIL ASC-MAP-IDX > 21                                   
155600             IF ASC-OPER-UNT-ID-N (ASC-MAP-IDX) > ZERO                    
155700                 MOVE ASC-OPER-UNT-ID-N (ASC-MAP-IDX)                     
155800                                      TO SUT00014-OPER-UNT-ID             
155900                 MOVE ASC-AUDIT-TYPE (1)                                  
156000                                      TO SUT00014-AUD-TYP-CDE             
156100                 PERFORM 7100-INSERT-CHOSEN-DC                            
156200             END-IF                                                       
156300         END-PERFORM                                                      
156400     ELSE                                                                 
156500         PERFORM VARYING ASC-MAP-IDX FROM 2 BY 1                          
156600                 UNTIL ASC-MAP-IDX > 21                                   
156700             IF ASC-OPER-UNT-ID-N (ASC-MAP-IDX) > ZERO                    
156800                 AND ASC-AUDIT-TYPE (ASC-MAP-IDX) = 'A' OR 'N' OR         
      *SB 10/07/13 - BEGIN PR#5148D                                             
                                                          'R' OR 'Q'            
      *SB 10/07/13 - END PR#5148D                                               
156900                     MOVE ASC-OPER-UNT-ID-N (ASC-MAP-IDX)                 
157000                                      TO SUT00014-OPER-UNT-ID             
157100                     MOVE ASC-AUDIT-TYPE (ASC-MAP-IDX)                    
157200                                      TO SUT00014-AUD-TYP-CDE             
157300                     PERFORM 7100-INSERT-CHOSEN-DC                        
157400             END-IF                                                       
157500         END-PERFORM                                                      
157600     END-IF.                                                              
157700/                                                                         
157800 6000-UPDATE.                                                             
157900     PERFORM VARYING ASC-MAP-IDX FROM 1 BY 1                              
158000             UNTIL ASC-MAP-IDX > 21                                       
158100         EVALUATE ASC-AUDIT-TYPE (ASC-MAP-IDX)                            
158200         WHEN 'A'                                                         
158300         WHEN 'N'                                                         
      *SB 10/07/13 - BEGIN PR#5148D                                             
158300         WHEN 'R'                                                         
158300         WHEN 'Q'                                                         
      *SB 10/07/13 - END PR#5148D                                               
158400             PERFORM 6100-UPDATE-SELECTED                                 
158500         WHEN 'D'                                                         
158600             PERFORM 6200-DELETE-SELECTED                                 
158700         END-EVALUATE                                                     
158800     END-PERFORM.                                                         
158900                                                                          
159000*    THIS SETS F2 BACK TO ITS ORIGINAL VALUE OF 'CONFIRM'                 
159100     SET DP020-FK-CONFIRM (ASC-SAVE-SRC-AID) TO TRUE                      
159200                                                                          
159300     SET ASC-UPDATE-NOT-PENDING       TO TRUE.                            
159400                                                                          
159500 6100-UPDATE-SELECTED.                                                    
159600                                                                          
159700     MOVE ASC-OPER-UNT-ID (ASC-MAP-IDX)                                   
159800                                      TO DK-OPER-UNT-ID                   
159900     MOVE ASC-AUDIT-TYPE (ASC-MAP-IDX)                                    
160000                                      TO SUT00014-AUD-TYP-CDE             
160100     PERFORM 7150-UPDATE-CHOSEN-DC                                        
160200                                                                          
160300     IF SQLCODE = +100                                                    
160400         MOVE DK-OPER-UNT-ID          TO SUT00014-OPER-UNT-ID             
160500         PERFORM 7100-INSERT-CHOSEN-DC                                    
160600     END-IF.                                                              
160700                                                                          
160800 6200-DELETE-SELECTED.                                                    
160900     MOVE ASC-OPER-UNT-ID (ASC-MAP-IDX)                                   
161000                                      TO DK-OPER-UNT-ID.                  
161100     PERFORM 7200-DELETE-CHOSEN-DC.                                       
161200/                                                                         
161300 7000-SELECT-AUD-PO.                                                      
161400     EXEC SQL                                                             
161500         SELECT AUD.AUD_TYP_CDE                                           
161600         INTO                                                             
161700             :SUT00014-AUD-TYP-CDE                                        
161800         FROM SUT_PO_AUD_EXC AUD                                          
161900         WHERE                                                            
162000             AUD.PO_NBR       = :DK-PO-NBR                                
162100         AND AUD.PO_LNE_NBR   = 0                                         
162200         AND AUD.PO_PREPK_ID  = 0                                         
162300         AND AUD.OPER_UNT_ID  = :XLT00010-LOC-NBR                         
162400     END-EXEC.                                                            
162500                                                                          
162600     EVALUATE TRUE                                                        
162700         WHEN SQLCODE = ZERO                                              
162800         WHEN SQLCODE = +100                                              
162900              CONTINUE                                                    
163000         WHEN SQLCODE = -904                                              
163100         WHEN SQLCODE = -911                                              
163200         WHEN SQLCODE = -913                                              
163300             PERFORM 9900-SOFT-ABORT                                      
163400         WHEN SQLWARN0 NOT = SPACE                                        
163500         WHEN SQLCODE NOT = ZERO                                          
163600              MOVE '7000-SELECT-AUD-PO'                                   
163700                               TO DP013-PARAGRAPH                         
163800              MOVE 'SELECT AUDIT ROW'                                     
163900                               TO DP013-MESSAGE-TEXT (1)                  
164000              MOVE SQLCA       TO DP013-SQLCA                             
164100              SET DP013-DB2-ABEND                                         
164200                               TO TRUE                                    
164300              PERFORM DP013-0000-PROCESS-ABEND                            
164400     END-EVALUATE.                                                        
164500                                                                          
164600 7010-SELECT-AUD-LNE.                                                     
164700     EXEC SQL                                                             
164800         SELECT AUD.AUD_TYP_CDE                                           
164900         INTO                                                             
165000             :SUT00014-AUD-TYP-CDE                                        
165100         FROM SUT_PO_AUD_EXC AUD                                          
165200         WHERE                                                            
165300             AUD.PO_NBR       = :DK-PO-NBR                                
165400         AND AUD.PO_LNE_NBR   = :DK-PO-LINE-NBR                           
165500         AND AUD.PO_PREPK_ID  = 0                                         
165600         AND AUD.OPER_UNT_ID  = :XLT00010-LOC-NBR                         
165700     END-EXEC.                                                            
165800                                                                          
165900     EVALUATE TRUE                                                        
166000         WHEN SQLCODE = ZERO                                              
166100         WHEN SQLCODE = +100                                              
166200              CONTINUE                                                    
166300         WHEN SQLCODE = -904                                              
166400         WHEN SQLCODE = -911                                              
166500         WHEN SQLCODE = -913                                              
166600             PERFORM 9900-SOFT-ABORT                                      
166700         WHEN SQLWARN0 NOT = SPACE                                        
166800         WHEN SQLCODE NOT = ZERO                                          
166900              MOVE '7010-SELECT-AUD-LNE'                                  
167000                               TO DP013-PARAGRAPH                         
167100              MOVE 'SELECT AUDIT ROW'                                     
167200                               TO DP013-MESSAGE-TEXT (1)                  
167300              MOVE SQLCA       TO DP013-SQLCA                             
167400              SET DP013-DB2-ABEND                                         
167500                               TO TRUE                                    
167600              PERFORM DP013-0000-PROCESS-ABEND                            
167700     END-EVALUATE.                                                        
167800                                                                          
167900 7020-SELECT-AUD-PPK.                                                     
168000                                                                          
168100     EXEC SQL                                                             
168200         SELECT AUD.AUD_TYP_CDE                                           
168300         INTO                                                             
168400             :SUT00014-AUD-TYP-CDE                                        
168500         FROM SUT_PO_AUD_EXC AUD                                          
168600         WHERE                                                            
168700             AUD.PO_NBR       = :DK-PO-NBR                                
168800         AND AUD.PO_LNE_NBR   = 0                                         
168900         AND AUD.PO_PREPK_ID  = :DK-PREPACK-ID                            
169000         AND AUD.OPER_UNT_ID  = :XLT00010-LOC-NBR                         
169100     END-EXEC.                                                            
169200                                                                          
169300     EVALUATE TRUE                                                        
169400         WHEN SQLCODE = ZERO                                              
169500         WHEN SQLCODE = +100                                              
169600              CONTINUE                                                    
169700         WHEN SQLCODE = -904                                              
169800         WHEN SQLCODE = -911                                              
169900         WHEN SQLCODE = -913                                              
170000             PERFORM 9900-SOFT-ABORT                                      
170100         WHEN SQLWARN0 NOT = SPACE                                        
170200         WHEN SQLCODE NOT = ZERO                                          
170300              MOVE '7020-SELECT-AUD-PPK'                                  
170400                               TO DP013-PARAGRAPH                         
170500              MOVE 'SELECT AUDIT ROW'                                     
170600                               TO DP013-MESSAGE-TEXT (1)                  
170700              MOVE SQLCA       TO DP013-SQLCA                             
170800              SET DP013-DB2-ABEND                                         
170900                               TO TRUE                                    
171000              PERFORM DP013-0000-PROCESS-ABEND                            
171100     END-EVALUATE.                                                        
171200                                                                          
171300 7030-SELECT-TPURCHS.                                                     
171400     EXEC SQL                                                             
171500         SELECT                                                           
171600             VER_NBR                                                      
171700         ,   PO_TYP_CDE                                                   
171800         ,   PKGNG_CDE                                                    
171900         ,   CASE PKGNG_CDE                                               
172000                 WHEN 'M' THEN                                            
172100                     'PRE-PACK'                                           
172200                 WHEN 'I' THEN                                            
172300                     'PRE-PACK'                                           
172400                 WHEN ' ' THEN                                            
172500                     'PACK-BY-STORE'                                      
172600             ELSE                                                         
172700                 'BULK/CASEPACK'                                          
172800             END                                                          
172900         INTO                                                             
173000             :PURCHS-VER-NBR                                              
173100         ,   :PURCHS-PO-TYP-CDE                                           
173200         ,   :ASC-PKGNG-CDE                                               
173300         ,   :ASC-PKGNG-DESC                                              
173400         FROM TPURCHS PO                                                  
173500         WHERE                                                            
173600             PO.PO_NBR          = :DK-PO-NBR                              
173700         AND                                                              
173800             PO.VER_STATUS_CDE  = 'A'                                     
173900     END-EXEC.                                                            
174000                                                                          
174100     EVALUATE TRUE                                                        
174200         WHEN SQLCODE = ZERO                                              
174300             CONTINUE                                                     
174400         WHEN SQLCODE = +100                                              
174500             MOVE SPACES              TO ASC-PKGNG-DESC                   
174600             MOVE -1                  TO APOL                             
174700             MOVE DP015-RED           TO APOC                             
174800             SET DP020-MSG-FATAL                                          
174900                 DP030-SET-CURSOR-APPL-1                                  
175000                 PS-ERROR             TO TRUE                             
175100             MOVE PC-TSYMSG-02858     TO DP020-MSG-NUMBER                 
175200                                                                          
175300         WHEN SQLCODE = -904                                              
175400         WHEN SQLCODE = -911                                              
175500         WHEN SQLCODE = -913                                              
175600             PERFORM 9900-SOFT-ABORT                                      
175700                                                                          
175800         WHEN SQLWARN0 NOT = SPACES                                       
175900         WHEN SQLCODE < +0                                                
176000         WHEN SQLCODE > ZERO                                              
176100             MOVE '7030-SELECT-TPUCHS'                                    
176200                                      TO DP013-PARAGRAPH                  
176300             MOVE 'SELECT PURCHASE ORDER'                                 
176400                                      TO DP013-MESSAGE-TEXT (1)           
176500             MOVE SQLCA               TO DP013-SQLCA                      
176600             MOVE 'TPURCHS'           TO DP013-DB2-TABLE-NAME (1)         
176700             SET DP013-DB2-ABEND      TO TRUE                             
176800             SET DP013-XCTL-DISPLAY-RESTART                               
176900                                      TO TRUE                             
177000             PERFORM DP013-0000-PROCESS-ABEND                             
177100     END-EVALUATE.                                                        
177200                                                                          
177300 7040-SELECT-TPURITM.                                                     
177400                                                                          
177500     EXEC SQL                                                             
177600         SELECT                                                           
177700             ITM.PO_LNE_NBR                                               
177800         INTO                                                             
177900             :PURITM-PO-LNE-NBR                                           
178000         FROM TPURITM ITM                                                 
178100         WHERE                                                            
178200             ITM.PO_NBR          = :DK-PO-NBR                             
178300         AND ITM.PO_LNE_NBR      = :DK-PO-LINE-NBR                        
178400         AND ITM.VER_STATUS_CDE  = 'A'                                    
178500     END-EXEC.                                                            
178600                                                                          
178700     EVALUATE TRUE                                                        
178800         WHEN SQLCODE = ZERO                                              
178900             CONTINUE                                                     
179000         WHEN SQLCODE = +100                                              
179100             MOVE -1                  TO ALINEL                           
179200             MOVE DP015-RED           TO ALINEC                           
179300             SET DP020-MSG-FATAL                                          
179400                 DP030-SET-CURSOR-APPL-1                                  
179500                 PS-ERROR             TO TRUE                             
179600             MOVE PC-TSYMSG-02861     TO DP020-MSG-NUMBER                 
179700                                                                          
179800         WHEN SQLCODE = -904                                              
179900         WHEN SQLCODE = -911                                              
180000         WHEN SQLCODE = -913                                              
180100             PERFORM 9900-SOFT-ABORT                                      
180200                                                                          
180300         WHEN SQLWARN0 NOT = SPACES                                       
180400         WHEN SQLCODE < +0                                                
180500         WHEN SQLCODE > ZERO                                              
180600             MOVE '7040-SELECT-TPURITM'                                   
180700                                      TO DP013-PARAGRAPH                  
180800             MOVE 'SELECT PURCHASE ORDER'                                 
180900                                      TO DP013-MESSAGE-TEXT (1)           
181000             MOVE SQLCA               TO DP013-SQLCA                      
181100             MOVE 'TPURITM'           TO DP013-DB2-TABLE-NAME (1)         
181200             SET DP013-DB2-ABEND      TO TRUE                             
181300             SET DP013-XCTL-DISPLAY-RESTART                               
181400                                      TO TRUE                             
181500             PERFORM DP013-0000-PROCESS-ABEND                             
181600     END-EVALUATE.                                                        
181700                                                                          
181800                                                                          
181900 7050-SELECT-POPRPK.                                                      
182000                                                                          
182100     EXEC SQL                                                             
182200         SELECT                                                           
182300             PK.PO_PREPK_ID                                               
182400         INTO                                                             
182500             :POPRPK-PO-PREPK-ID                                          
182600         FROM  TPOPRPK PK                                                 
182700         WHERE                                                            
182800               PK.PO_NBR           = :DK-PO-NBR                           
182900           AND PK.PO_PREPK_ID      = :DK-PREPACK-ID                       
183000           AND PK.PREPK_STAT_CDE   = 'A'                                  
183100     END-EXEC.                                                            
183200                                                                          
183300     EVALUATE TRUE                                                        
183400         WHEN SQLCODE = ZERO                                              
183500             CONTINUE                                                     
183600         WHEN SQLCODE = +100                                              
183700             MOVE -1                  TO APREPKL                          
183800             MOVE DP015-RED           TO APREPKC                          
183900             SET DP020-MSG-FATAL                                          
184000                 DP030-SET-CURSOR-APPL-1                                  
184100                 PS-ERROR             TO TRUE                             
184200             MOVE PC-TSYMSG-02862     TO DP020-MSG-NUMBER                 
184300                                                                          
184400         WHEN SQLCODE = -904                                              
184500         WHEN SQLCODE = -911                                              
184600         WHEN SQLCODE = -913                                              
184700             PERFORM 9900-SOFT-ABORT                                      
184800                                                                          
184900         WHEN SQLWARN0 NOT = SPACES                                       
185000         WHEN SQLCODE < +0                                                
185100         WHEN SQLCODE > ZERO                                              
185200             MOVE '7030-SELECT-TPOPRPK'                                   
185300                                      TO DP013-PARAGRAPH                  
185400             MOVE 'SELECT PRE-PACK'                                       
185500                                      TO DP013-MESSAGE-TEXT (1)           
185600             MOVE SQLCA               TO DP013-SQLCA                      
185700             MOVE 'TPOPRPK'           TO DP013-DB2-TABLE-NAME (1)         
185800             SET DP013-DB2-ABEND                                          
185900                                      TO TRUE                             
186000             SET DP013-XCTL-DISPLAY-RESTART                               
186100                                      TO TRUE                             
186200             PERFORM DP013-0000-PROCESS-ABEND                             
186300     END-EVALUATE.                                                        
186400/                                                                         
186500 7060-SELECT-SUT-PO-AUD-EXC.                                              
186600                                                                          
186700     EXEC SQL                                                             
186800        SELECT                                                            
186900             AUD.PO_NBR                                                   
187000         ,   AUD.PO_LNE_NBR                                               
187100         ,   AUD.PO_PREPK_ID                                              
187200         ,   AUD.OPER_UNT_ID                                              
187300          INTO                                                            
187400             :SUT00014-PO-NBR                                             
187500         ,   :SUT00014-PO-LNE-NBR                                         
187600         ,   :SUT00014-PO-PREPK-ID                                        
187700         ,   :SUT00014-OPER-UNT-ID                                        
187800          FROM  SUT_PO_AUD_EXC    AUD                                     
187900         WHERE                                                            
188000             AUD.PO_NBR          = :DK-PO-NBR                             
188100         AND AUD.PO_LNE_NBR      = :DK-PO-LINE-NBR                        
188200         AND AUD.PO_PREPK_ID     = :DK-PREPACK-ID                         
188300         AND AUD.OPER_UNT_ID     BETWEEN :DK-OPER-FROM                    
188400                                 AND :DK-OPER-TO                          
188500                                                                          
188600     END-EXEC.                                                            
188700                                                                          
188800     EVALUATE TRUE                                                        
188900         WHEN SQLCODE = ZERO                                              
189000         WHEN SQLCODE = -811                                              
189100             SET PS-AUDIT-FOUND       TO TRUE                             
189200         WHEN SQLCODE = +100                                              
189300             SET PS-AUDIT-NOT-FOUND   TO TRUE                             
189400                                                                          
189500         WHEN SQLCODE = -904                                              
189600         WHEN SQLCODE = -911                                              
189700         WHEN SQLCODE = -913                                              
189800             PERFORM 9900-SOFT-ABORT                                      
189900                                                                          
190000         WHEN SQLWARN0 NOT = SPACES                                       
190100         WHEN SQLCODE < +0                                                
190200         WHEN SQLCODE > ZERO                                              
190300             MOVE '7060-SELECT-TPOPRPK'                                   
190400                             TO DP013-PARAGRAPH                           
190500             MOVE 'SELECT SUT_PO_AUD_EXC'                                 
190600                             TO DP013-MESSAGE-TEXT (1)                    
190700             MOVE SQLCA      TO DP013-SQLCA                               
190800             SET DP013-DB2-ABEND                                          
190900                             TO TRUE                                      
191000             SET DP013-XCTL-DISPLAY-RESTART                               
191100                             TO TRUE                                      
191200             PERFORM DP013-0000-PROCESS-ABEND                             
191300     END-EVALUATE.                                                        
191400                                                                          
191500 7100-INSERT-CHOSEN-DC.                                                   
191600     EXEC SQL                                                             
191700     INSERT INTO                                                          
191800         SUT_PO_AUD_EXC                                                   
191900         (                                                                
192000             PO_NBR                                                       
192100            ,PO_LNE_NBR                                                   
192200            ,PO_PREPK_ID                                                  
192300            ,OPER_UNT_ID                                                  
192400            ,AUD_TYP_CDE                                                  
192500            ,CRE_TMST                                                     
192600            ,LAST_UPD_TMST                                                
192700            ,LAST_UPD_BY_USR_ID                                           
192800         )                                                                
192900         VALUES                                                           
193000         (                                                                
193100             :DK-PO-NBR                                                   
193200         ,   :DK-PO-LINE-NBR                                              
193300         ,   :DK-PREPACK-ID                                               
193400         ,   :SUT00014-OPER-UNT-ID                                        
193500         ,   :SUT00014-AUD-TYP-CDE                                        
193600         ,   CURRENT TIMESTAMP                                            
193700         ,   '9999-09-09-09.09.09.999999'                                 
193800         ,   :DP020-USERID                                                
193900         )                                                                
194000     END-EXEC.                                                            
194100                                                                          
194200     EVALUATE TRUE                                                        
194300         WHEN SQLCODE = ZERO                                              
194400             CONTINUE                                                     
194500         WHEN SQLCODE = -803                                              
194600             SET PS-AUDIT-FOUND       TO TRUE                             
194700                                                                          
194800         WHEN SQLCODE = -904                                              
194900         WHEN SQLCODE = -911                                              
195000         WHEN SQLCODE = -913                                              
195100             PERFORM 9900-SOFT-ABORT                                      
195200                                                                          
195300         WHEN SQLWARN0 NOT = SPACES                                       
195400         WHEN SQLCODE < ZERO                                              
195500         WHEN SQLCODE > ZERO                                              
195600             MOVE '7100-INSERT-CHOSEN-DC'                                 
195700                             TO DP013-PARAGRAPH                           
195800             MOVE 'INSERT SUT_PO_AUD_EXC'                                 
195900                             TO DP013-MESSAGE-TEXT (1)                    
196000             MOVE SQLCA      TO DP013-SQLCA                               
196100             SET DP013-DB2-ABEND                                          
196200                             TO TRUE                                      
196300             SET DP013-XCTL-DISPLAY-RESTART                               
196400                             TO TRUE                                      
196500             PERFORM DP013-0000-PROCESS-ABEND                             
196600     END-EVALUATE.                                                        
196700                                                                          
196800 7110-SELECT-CHOSEN-DC.                                                   
196900                                                                          
197000     EXEC SQL                                                             
197100        SELECT                                                            
197200             AUD.PO_NBR                                                   
197300         ,   AUD.PO_LNE_NBR                                               
197400         ,   AUD.PO_PREPK_ID                                              
197500         ,   AUD.OPER_UNT_ID                                              
197600          INTO                                                            
197700             :SUT00014-PO-NBR                                             
197800         ,   :SUT00014-PO-LNE-NBR                                         
197900         ,   :SUT00014-PO-PREPK-ID                                        
198000         ,   :SUT00014-OPER-UNT-ID                                        
198100          FROM  SUT_PO_AUD_EXC    AUD                                     
198200         WHERE                                                            
198300             AUD.PO_NBR          = :DK-PO-NBR                             
198400         AND AUD.PO_LNE_NBR      = :DK-PO-LINE-NBR                        
198500         AND AUD.PO_PREPK_ID     = :DK-PREPACK-ID                         
198600         AND AUD.OPER_UNT_ID     = :DK-OPER-UNT-ID                        
198700                                                                          
198800     END-EXEC.                                                            
198900                                                                          
199000     EVALUATE TRUE                                                        
199100         WHEN SQLCODE = ZERO                                              
199200         WHEN SQLCODE = -811                                              
199300             CONTINUE                                                     
199400         WHEN SQLCODE = +100                                              
199500             SET ASC-UPDATE-NOT-PENDING                                   
199600                                      TO TRUE                             
199700                                                                          
199800         WHEN SQLCODE = -904                                              
199900         WHEN SQLCODE = -911                                              
200000         WHEN SQLCODE = -913                                              
200100             PERFORM 9900-SOFT-ABORT                                      
200200                                                                          
200300         WHEN SQLWARN0 NOT = SPACES                                       
200400         WHEN SQLCODE < +0                                                
200500         WHEN SQLCODE > ZERO                                              
200600             MOVE '7110-SELECT-CHOSEN-DC'                                 
200700                             TO DP013-PARAGRAPH                           
200800             MOVE 'SELECT SUT_PO_AUD_EXC'                                 
200900                             TO DP013-MESSAGE-TEXT (1)                    
201000             MOVE SQLCA      TO DP013-SQLCA                               
201100             SET DP013-DB2-ABEND                                          
201200                             TO TRUE                                      
201300             SET DP013-XCTL-DISPLAY-RESTART                               
201400                             TO TRUE                                      
201500             PERFORM DP013-0000-PROCESS-ABEND                             
201600     END-EVALUATE.                                                        
201700                                                                          
201800 7150-UPDATE-CHOSEN-DC.                                                   
201900     EXEC SQL                                                             
202000         UPDATE SUT_PO_AUD_EXC                                            
202100             SET AUD_TYP_CDE        = :SUT00014-AUD-TYP-CDE               
202200             ,   LAST_UPD_TMST      = CURRENT TIMESTAMP                   
202300             ,   LAST_UPD_BY_USR_ID = :DP020-USERID                       
202400     WHERE                                                                
202500                 PO_NBR          = :DK-PO-NBR                             
202600         AND     PO_LNE_NBR      = :DK-PO-LINE-NBR                        
202700         AND     PO_PREPK_ID     = :DK-PREPACK-ID                         
202800         AND     OPER_UNT_ID     = :DK-OPER-UNT-ID                        
202900     END-EXEC.                                                            
203000                                                                          
203100     EVALUATE TRUE                                                        
203200         WHEN SQLCODE = ZERO                                              
203300         WHEN SQLCODE = +100                                              
203400             CONTINUE                                                     
203500                                                                          
203600         WHEN SQLCODE = -904                                              
203700         WHEN SQLCODE = -911                                              
203800         WHEN SQLCODE = -913                                              
203900             PERFORM 9900-SOFT-ABORT                                      
204000                                                                          
204100         WHEN SQLWARN0 NOT = SPACES                                       
204200         WHEN SQLCODE < +0                                                
204300         WHEN SQLCODE > ZERO                                              
204400             MOVE '7150-UPDATE-CHOSEN-DC'                                 
204500                             TO DP013-PARAGRAPH                           
204600             MOVE 'SELECT SUT_PO_AUD_EXC'                                 
204700                             TO DP013-MESSAGE-TEXT (1)                    
204800             MOVE SQLCA      TO DP013-SQLCA                               
204900             SET DP013-DB2-ABEND                                          
205000                             TO TRUE                                      
205100             SET DP013-XCTL-DISPLAY-RESTART                               
205200                             TO TRUE                                      
205300             PERFORM DP013-0000-PROCESS-ABEND                             
205400     END-EVALUATE.                                                        
205500                                                                          
205600 7200-DELETE-CHOSEN-DC.                                                   
205700     EXEC SQL                                                             
205800         DELETE                                                           
205900         FROM SUT_PO_AUD_EXC                                              
206000     WHERE                                                                
206100                 PO_NBR          = :DK-PO-NBR                             
206200         AND     PO_LNE_NBR      = :DK-PO-LINE-NBR                        
206300         AND     PO_PREPK_ID     = :DK-PREPACK-ID                         
206400         AND     OPER_UNT_ID     = :DK-OPER-UNT-ID                        
206500     END-EXEC.                                                            
206600                                                                          
206700     EVALUATE TRUE                                                        
206800         WHEN SQLCODE = ZERO                                              
206900         WHEN SQLCODE = +100                                              
207000             CONTINUE                                                     
207100                                                                          
207200         WHEN SQLCODE = -904                                              
207300         WHEN SQLCODE = -911                                              
207400         WHEN SQLCODE = -913                                              
207500             PERFORM 9900-SOFT-ABORT                                      
207600                                                                          
207700         WHEN SQLWARN0 NOT = SPACES                                       
207800         WHEN SQLCODE < +0                                                
207900         WHEN SQLCODE > ZERO                                              
208000             MOVE '7200-DELETE-CHOSEN-DC'                                 
208100                             TO DP013-PARAGRAPH                           
208200             MOVE 'SELECT SUT_PO_AUD_EXC'                                 
208300                             TO DP013-MESSAGE-TEXT (1)                    
208400             MOVE SQLCA      TO DP013-SQLCA                               
208500             SET DP013-DB2-ABEND                                          
208600                             TO TRUE                                      
208700             SET DP013-XCTL-DISPLAY-RESTART                               
208800                             TO TRUE                                      
208900             PERFORM DP013-0000-PROCESS-ABEND                             
209000     END-EVALUATE.                                                        
209100/                                                                         
209200 8000-CALL-RACF.                                                          
209300      SET DP008-RSRC-TYPE-FUNC           TO TRUE                          
209400      SET DP008-ACCESS-TYPE-USE          TO TRUE                          
209500                                                                          
209600     EXEC CICS                                                            
209700        LINK PROGRAM  (DP008-SECURITY-SUBROUTINE)                         
209800             COMMAREA (DP008-SECURITY-COMMAREA)                           
209900             LENGTH   (DP008-SECURITY-COMMAREA-LENGTH)                    
210000             RESP     (PV-CICS-RESPONSE)                                  
210100     END-EXEC.                                                            
210200                                                                          
210300     IF PV-CICS-RESPONSE = DFHRESP (NORMAL)                               
210400        IF DP008-CALL-SUCCESSFUL                                          
210500           CONTINUE                                                       
210600        ELSE                                                              
210700           MOVE DP008-ERROR-CODE TO PM-CM-RETURN-CODE                     
210800           MOVE PM-CICSAUTH-MESSAGE TO DP013-MESSAGE-TEXT(1)              
210900           SET DP013-CICS-ABEND TO TRUE                                   
211000           SET DP013-NO-ROLLBACK TO TRUE                                  
211100           MOVE '8000-CHECK-RACF' TO DP013-PARAGRAPH                      
211200           PERFORM DP013-0000-PROCESS-ABEND                               
211300        END-IF                                                            
211400     ELSE                                                                 
211500        MOVE 'CALL RACF SECURITY PROGRAM' TO DP013-MESSAGE-TEXT(1)        
211600        SET DP013-CICS-ABEND TO TRUE                                      
211700        SET DP013-NO-ROLLBACK TO TRUE                                     
211800        MOVE '8000-CHECK-RACF' TO DP013-PARAGRAPH                         
211900        PERFORM DP013-0000-PROCESS-ABEND                                  
212000     END-IF.                                                              
212100/                                                                         
212200 9100-READ-SEL-QUEUE.                                                     
212300                                                                          
212400     EXEC CICS                                                            
212500         READQ TS                                                         
212600             QUEUE (ASC-SEL-QUEUE-NAME)                                   
212700             INTO  (SU022-SELECT-RECORD)                                  
212800             ITEM  (ASC-SEL-ITEM)                                         
212900             RESP  (PV-CICS-RESPONSE)                                     
213000     END-EXEC.                                                            
213100                                                                          
213200     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)  OR                           
213300         PV-CICS-RESPONSE = DFHRESP(QIDERR)                               
213400         CONTINUE                                                         
213500     ELSE                                                                 
213600         SET DP013-LOGIC-ABEND                                            
213700             DP013-NO-ROLLBACK     TO TRUE                                
213800         MOVE '9100-READ-SEL-QUEUE'                                       
213900                                   TO DP013-PARAGRAPH                     
214000         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'           
214100                                   TO DP013-MESSAGE-TEXT (1)              
214200         PERFORM DP013-0000-PROCESS-ABEND                                 
214300     END-IF.                                                              
214400                                                                          
214500                                                                          
214600*----------------------------------------------------------------*        
214700* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *        
214800*----------------------------------------------------------------*        
214900 9200-REWRITE-SEL-QUEUE.                                                  
215000     EXEC CICS                                                            
215100          WRITEQ TS                                                       
215200              QUEUE  (ASC-SEL-QUEUE-NAME)                                 
215300              FROM   (SU022-SELECT-RECORD)                                
215400              ITEM   (ASC-SEL-ITEM)                                       
215500              RESP   (PV-CICS-RESPONSE)                                   
215600              REWRITE                                                     
215700     END-EXEC.                                                            
215800                                                                          
215900     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)  OR                           
216000        (PV-CICS-RESPONSE = DFHRESP(QIDERR))                              
216100            CONTINUE                                                      
216200     ELSE                                                                 
216300         SET DP013-CICS-ABEND                                             
216400             DP013-NO-ROLLBACK     TO TRUE                                
216500         MOVE '9200-REWRITE-SEL-QUEUE'                                    
216600                                   TO DP013-PARAGRAPH                     
216700         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'           
216800                                   TO DP013-MESSAGE-TEXT (1)              
216900         PERFORM DP013-0000-PROCESS-ABEND                                 
217000     END-IF.                                                              
217200                                                                          
217300                                                                          
217400 9900-SOFT-ABORT.                                                         
217500     SET PS-ERROR         TO TRUE.                                        
217600     SET DP020-MSG-FATAL  TO TRUE.                                        
217700     MOVE 'THROUGH SOFT-ABORT PARA'                                       
217800                            TO DP013-MESSAGE-TEXT (1)                     
217900     MOVE PC-TSYMSG-00551 TO DP020-MSG-NUMBER.                            
218000     SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                                
218100                                                                          
218200     MOVE 'PROGRAM EXIT CALL' TO DP013-MESSAGE-TEXT (1).                  
218300     PERFORM 0001-CALL-CICS-ARCH-API.                                     
218400                                                                          
218500*----------------------------------------------------------------*        
218600*    ABEND PROCESSOR MODULE                                      *        
218700*----------------------------------------------------------------*        
218800                                                                          
218900     COPY DPPD013.                                                        
