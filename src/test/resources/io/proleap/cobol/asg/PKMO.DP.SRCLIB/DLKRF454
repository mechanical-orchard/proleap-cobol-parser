000100 TITLE 'LABOR SYSTEM - INDIRECT CODE LIST'.                       00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300                                                                  00030000
000400 PROGRAM-ID.             DLKRF454.                                00040000
000500 AUTHOR.                 DENNIS STEFFEN.                          00050000
000600 INSTALLATION.           KOHLS.                                   00060000
000700 DATE-WRITTEN.           FEBRUARY 2004.                           00070000
000800 DATE-COMPILED.                                                   00080000
000810*----------------------------------------------------------------*00081000
000820* CHANGED 11/04/2021    BY JIM HUNTER      WR: CHG0263627         00082001
000830* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00083001
000840* MAKING THE CALL DYNAMIC VS STATIC.                              00084001
000850*----------------------------------------------------------------*00085001
000860 ENVIRONMENT DIVISION.                                            00086001
000870 DATA DIVISION.                                                   00087001
000880                                                                  00088001
000890 WORKING-STORAGE SECTION.                                         00089001
000900*                                                                 00090001
001000 01  PC-PROGRAM-CONSTANTS.                                        00100001
001100     05  PC-TRANID                    PIC  X(04)  VALUE 'D454'.   00110001
001200     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'DLKRF454'. 00120001
001300                                                                  00130001
001400* ERROR MESSAGES                                                 *00140001
001500     05  PC-UNRECOGNIZED-PF-KEY-MSG   PIC X(19) VALUE             00150001
001600         'UNRECOGNIZED PF KEY'.                                   00160001
001700     05  PC-ENTER-THROUGH-MENU-MSG    PIC X(19) VALUE             00170001
001800         'ENTER THROUGH MENU '.                                   00180001
001900     05  PC-TRANS-UNAVAILABLE-MSG     PIC X(19) VALUE             00190001
002000         'TRANS NOT AVAILABLE'.                                   00200001
002100     05  PC-INVALID-SELECTION-MSG     PIC X(19)  VALUE            00210001
002200         'INVALID SELECTION  '.                                   00220001
002300     05  PC-NON-NUMERIC-SELECTION-MSG PIC X(19)  VALUE            00230001
002400         'NUMERIC VALUE REQ. '.                                   00240001
002500                                                                  00250001
002600 01  PS-PROGRAM-SWITCHES.                                         00260001
002700     05  PS-ERROR-SW                  PIC  X(01)  VALUE 'N'.      00270001
002800         88  PS-ERRORS-YES                        VALUE 'Y'.      00280001
002900         88  PS-ERRORS-NO                         VALUE 'N'.      00290001
003000     05  PS-CODE-CSR-SW               PIC X(01) VALUE 'N'.        00300001
003100         88  PS-END-CODE-CSR-NO                 VALUE 'N'.        00310001
003200         88  PS-END-CODE-CSR-YES                VALUE 'Y'.        00320001
003300     05  PS-SCREEN-FULL-SW            PIC X(01) VALUE 'N'.        00330001
003400         88  PS-SCREEN-FULL-YES                 VALUE 'Y'.        00340001
003500         88  PS-SCREEN-FULL-NO                  VALUE 'N'.        00350001
003600     05  PS-BROWSE-SW                 PIC X(01) VALUE 'F'.        00360001
003700         88  PS-BROWSE-FWD                      VALUE 'F'.        00370001
003800         88  PS-BROWSE-BKWD                     VALUE 'B'.        00380001
003900     05  PS-SEARCH-SW                 PIC X(01) VALUE 'N'.        00390001
004000         88  PS-NOT-FOUND                       VALUE 'N'.        00400001
004100         88  PS-IS-FOUND                        VALUE 'Y'.        00410001
004200     05  PS-PROCESS-METHOD-SW         PIC X(01) VALUE 'N'.        00420001
004300         88  PS-CONFIRM                         VALUE 'C'.        00430001
004400         88  PS-TEAM-PROMPT                     VALUE 'T'.        00440001
004500         88  PS-NO-FLAGS                        VALUE 'N'.        00450001
004600     05  PS-CREATE-NEW-USER-SW        PIC X(01) VALUE 'N'.        00460001
004700         88  PS-CREATE-NEW-USER-NO              VALUE 'N'.        00470001
004800         88  PS-CREATE-NEW-USER-YES             VALUE 'Y'.        00480001
004900/                                                                 00490001
005000 01  DN-NULL-INDICATORS.                                          00500001
005100     05  DN-KOHLS-NULL-IND            PIC S9(04)  VALUE ZERO      00510001
005200                                                     COMP SYNC.   00520001
005300     05  DN-TEMP-NULL-IND             PIC S9(04)  VALUE ZERO      00530001
005400                                                     COMP SYNC.   00540001
005500 01  PV-PROGRAM-VARIABLES.                                        00550001
005600                                                                  00560001
005700     05  PV-CODE-SUB                  PIC S9(03) COMP-3           00570001
005800                                               VALUE ZERO.        00580001
005900     05  PV-PAGE-SUB                  PIC S9(03) COMP-3           00590001
006000                                               VALUE ZERO.        00600001
006100     05  PV-LINE-SUB                  PIC S9(03) COMP-3           00610001
006200                                               VALUE ZERO.        00620001
006300     05  PV-PAGE-PTR                  PIC S9(03) COMP-3           00630001
006400                                               VALUE ZERO.        00640001
006500     05  PV-LINE-PTR                  PIC S9(03) COMP-3           00650001
006600                                               VALUE ZERO.        00660001
006700     05  PV-SELECTION                 PIC 99   VALUE ZERO.        00670001
006800     05  PV-TEAM-COUNT                PIC S9(05) COMP-3           00680001
006900                                               VALUE ZERO.        00690001
007000                                                                  00700001
007100     05  PV-DISP-NBR                  PIC 9(09) VALUE ZERO.       00710001
007200     05  PV-UNSTRING-COUNT            PIC S9(03) COMP-3.          00720001
007300     05  PV-POINTER                   PIC S9(03) COMP-3.          00730001
007400     05  PV-TALLY                     PIC S9(03) COMP-3.          00740001
007500     05  PV-TOT-QTY                   PIC S9(7) COMP-3.           00750001
007600                                                                  00760001
007700     05  PV-COMMAREA-LENGTH           PIC S9(04)  VALUE +0        00770001
007800                                                     COMP SYNC.   00780001
007900     05  PV-MESSAGE-AREA              PIC  X(19)  VALUE SPACE.    00790001
008000     05  PV-CICS-RESPONSE             PIC S9(09)  VALUE ZEROS     00800001
008100                                                     COMP SYNC.   00810001
008200     05  PV-TRANSFER-PROGRAM          PIC  X(08)  VALUE SPACE.    00820001
008300     05  PV-USERID                    PIC X(08) VALUE SPACES.     00830001
008400     05  PV-DUMMY-USERID              PIC X(08) VALUE SPACES.     00840001
008500     05  PV-TMST                      PIC X(26) VALUE SPACES.     00850001
008600     05  PV-LABOR-CURRENT-TIMESTAMP   PIC X(26) VALUE SPACES.     00860001
008700     05  PV-DISPLAY-SQLCODE           PIC  9(04)  VALUE ZERO.     00870001
008800     05  PV-KEYED-USERID.                                         00880001
008900         10  PV-KEYED-USERID-1-2      PIC X(02) VALUE  SPACES.    00890001
009000             88 PV-KEYED-USERID-KOHLS VALUE 'TK', 'TC', 'TV'.     00900001
009100         10  FILLER                   PIC X(06) VALUE  SPACES.    00910001
009200                                                                  00920001
009300 01  PV-LOG-MSG.                                                  00930001
009400     05  FILLER                       PIC X(12) VALUE             00940001
009500         ' D454 ERROR '.                                          00950001
009600     05  FILLER                       PIC X(06) VALUE             00960001
009700         'USER= '.                                                00970001
009800     05  PV-LOG-USER-ID               PIC X(08) VALUE SPACES.     00980001
009900     05  FILLER                       PIC X(10) VALUE             00990001
010000         ' SQLCODE= '.                                            01000001
010100     05  PV-SQLCODE                   PIC -9(03).                 01010001
010200     05  FILLER                       PIC X(06) VALUE             01020001
010300         ' ERR= '.                                                01030001
010400     05  PV-ERROR-NBR                 PIC 9(03) VALUE ZERO.       01040001
010500                                                                  01050004
010600* COMMAREA FOR DLKRF SCREENS                                      01060001
010700     COPY DLWS010.                                                01070001
010710                                                                  01071004
010800* FULL SCREEN MESSAGES                                            01080001
010900     COPY DLWS012.                                                01090001
011000                                                                  01100004
011100* COMMAREA FOR XLKUT067                                           01110001
011200     COPY XLWS067.                                                01120001
011300                                                                  01130004
011400* COMMAREA FOR XLKUP003                                           01140001
011500     COPY XLWS072.                                                01150001
011600                                                                  01160004
011700* COMMAREA FOR DLKUT001                                           01170001
011800     COPY DLWS003.                                                01180001
011900                                                                  01190004
012000* COMMAREA FOR DLKUP002                                           01200001
012100     COPY DLWS005.                                                01210001
012200                                                                  01220004
012300* COMMAREA FOR DLKUP003                                           01230001
012400     COPY DLWS007.                                                01240001
012500                                                                  01250004
012600*    DLKCS410 COMMAREA                                            01260001
012700*    COPY DLWS016.                                                01270001
012800                                                                  01280001
012900*  MAP LAYOUT                                                     01290001
013000     COPY DLKM454.                                                01300001
013010                                                                  01301004
013100 01  PV-CODES-TABLE.                                              01310001
013200     05  PV-CODE OCCURS 8 TIMES.                                  01320001
013300         10  PV-CODE-NBR              PIC 9(02).                  01330001
013400         10  PV-CODE-DESC             PIC X(015).                 01340001
013500                                                                  01350004
013600* HELP SCREEN COMMAREA                                            01360001
013700     COPY PCWS192.                                                01370001
013710                                                                  01371004
013800* HELP SCREEN WORK AREA                                           01380001
013900     COPY PCWS188.                                                01390001
014000                                                                  01400004
014100*  NUMERIC EDITS                                                  01410001
014200     COPY DPWS010I.                                               01420001
014300*                                                                 01430001
014400     COPY DPWS026.                                                01440001
014410                                                                  01441004
014500*  KOHL'S STANDARD ATTRIBUTES                                     01450001
014600     COPY DPWS015.                                                01460001
014700                                                                  01470001
014800*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      01480001
014900     COPY DFHAID.                                                 01490001
015000                                                                  01500001
015100*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               01510001
015200     COPY DPWS013.                                                01520001
015300                                                                  01530004
015400     EXEC SQL                                                     01540001
015500         INCLUDE TKRPRPM                                          01550001
015600     END-EXEC                                                     01560001
015700                                                                  01570001
015800*    DLT_INDIR_LBR_CDE                                            01580001
015900     EXEC SQL                                                     01590001
016000         INCLUDE DLT00007                                         01600001
016100     END-EXEC                                                     01610001
016200                                                                  01620001
016300*    DLT_TEM_ASGMT                                                01630001
016400     EXEC SQL                                                     01640001
016500         INCLUDE DLT00003                                         01650001
016600     END-EXEC.                                                    01660001
016700                                                                  01670001
016800*    DLT_RDPR_USR_LSTG                                            01680001
016900     EXEC SQL                                                     01690001
017000         INCLUDE DLT00009                                         01700001
017100     END-EXEC.                                                    01710001
017200                                                                  01720001
017300*    USED FOR INITIAL SCREEN AND SCROLLING FORWARDS               01730001
017400     EXEC SQL                                                     01740001
017500         DECLARE CODE-CSR CURSOR FOR                              01750001
017600         SELECT                                                   01760001
017700             RF_INDIR_LBR_DESC                                    01770001
017800         ,   CNFRMN_REQD_IND                                      01780001
017900         ,   TEM_PRMPT_IND                                        01790001
018000         ,   RF_SRT_SEQ_NBR                                       01800001
018100         ,   INDIR_LBR_CDE                                        01810001
018200         FROM                                                     01820001
018300             DLT_INDIR_LBR_CDE                                    01830001
018400         WHERE                                                    01840001
018500             ACTV_IND = 'Y'                                       01850001
018600         AND RF_SRT_SEQ_NBR > 0                                   01860001
018700         ORDER BY RF_SRT_SEQ_NBR                                  01870001
018800         WITH UR                                                  01880001
018900     END-EXEC                                                     01890001
019000                                                                  01900001
019100     EXEC SQL                                                     01910001
019200         INCLUDE SQLCA                                            01920001
019300     END-EXEC.                                                    01930001
019400                                                                  01940001
019500 LINKAGE SECTION.                                                 01950001
019600 01  DFHCOMMAREA.                                                 01960001
019700     05  FILLER                         OCCURS  1 TO 4072 TIMES   01970001
019800                                      DEPENDING ON EIBCALEN.      01980001
019900         10  FILLER                   PIC X.                      01990001
020000                                                                  02000004
020100 PROCEDURE DIVISION.                                              02010001
020200 0000-PROGRAM-MAINLINE.                                           02020001
020300                                                                  02030001
020400     INITIALIZE DL010-COMMAREA                                    02040001
020500     MOVE DFHCOMMAREA                 TO DL010-COMMAREA           02050001
020600                                                                  02060001
020700     EVALUATE TRUE                                                02070001
020800         WHEN EIBCALEN = ZERO                                     02080001
020900             MOVE PC-ENTER-THROUGH-MENU-MSG                       02090001
021000                                      TO PV-MESSAGE-AREA          02100001
021100             PERFORM 8110-RETURN                                  02110001
021200                                                                  02120001
021300         WHEN EIBTRNID = 'Z278'                                   02130001
021400             MOVE DFHCOMMAREA         TO PC192-COMMAREA           02140001
021500             MOVE PC192-HOST-SAVE-AREA                            02150001
021600                                      TO DL010-COMMAREA           02160001
021700             SET DL010-PROCESS-SCREEN TO TRUE                     02170001
021800             MOVE PC192-HOST-SAVE-MAP TO DL454AO                  02180001
021900             PERFORM 8000-SEND-MAP                                02190001
022000             PERFORM 8100-RETURN-TRANID                           02200001
022100                                                                  02210001
022200         WHEN DL010-INITIALIZE-SCREEN                             02220001
022300         WHEN EIBAID = DFHCLEAR                                   02230001
022400             SET DL010-PROCESS-SCREEN                             02240001
022500                 PS-BROWSE-FWD        TO TRUE                     02250001
022600             PERFORM 1000-INITIALIZE                              02260001
022700                                                                  02270001
022800             IF PS-ERRORS-NO                                      02280001
022900                 MOVE 1               TO DL010-PAGE-SUB           02290001
023000                 PERFORM 3000-BUILD-SCREEN                        02300001
023100                     VARYING DL010-LINE-SUB FROM 1 BY 1           02310001
023200                     UNTIL PS-SCREEN-FULL-YES                     02320001
023300                        OR DL010-CODE-SEQ                         02330001
023400                             (DL010-PAGE-SUB, DL010-LINE-SUB)     02340001
023500                                     = ZEROES                     02350001
023600                 PERFORM 3200-MOVE-TBL-TO-MAP                     02360001
023700             END-IF                                               02370001
023800                                                                  02380001
023900             MOVE '    F7/F8-SCROLL   '       TO AMSGLNO          02390001
024000             PERFORM 8000-SEND-MAP                                02400001
024100             PERFORM 8100-RETURN-TRANID                           02410001
024200                                                                  02420001
024300         WHEN EIBAID = DFHPF2                                     02430001
024400             IF DL010-WAIT-FOR-CONFIRM                            02440001
024500                 PERFORM 8020-RECEIVE-MAP                         02450001
024600                 PERFORM 1500-EDIT-SELECTION                      02460001
024700                 IF PS-ERRORS-NO                                  02470001
024800                     SET DL010-UPDATE-CONFIRMED                   02480001
024900                                      TO TRUE                     02490001
025000                     PERFORM 2000-PROCESS                         02500001
025100                     PERFORM 8000-SEND-MAP                        02510001
025200                     PERFORM 8100-RETURN-TRANID                   02520001
025300                 ELSE                                             02530001
025400                     PERFORM 8000-SEND-MAP                        02540001
025500                     PERFORM 8100-RETURN-TRANID                   02550001
025600             ELSE                                                 02560001
025700                 PERFORM 8020-RECEIVE-MAP                         02570001
025800                 MOVE PC-UNRECOGNIZED-PF-KEY-MSG                  02580001
025900                                      TO AMSGLNO                  02590001
026000                 PERFORM 8000-SEND-MAP                            02600001
026100                 PERFORM 8100-RETURN-TRANID                       02610001
026200             END-IF                                               02620001
026300                                                                  02630001
026400         WHEN EIBAID = DFHPF3                                     02640001
026500             MOVE DL010-MENU-PROGRAM  TO PV-TRANSFER-PROGRAM      02650001
026600             PERFORM 8200-XCTL                                    02660001
026700                                                                  02670001
026800         WHEN EIBAID = DFHPF7                                     02680001
026900*            SCROLL BACKWARD                                      02690001
027000             SET PS-BROWSE-BKWD       TO TRUE                     02700001
027100             MOVE 1                   TO PV-CODE-SUB              02710001
027200                                                                  02720001
027300*            POSITION TO THE PREVIOUS PAGE                        02730001
027400             SUBTRACT 1             FROM DL010-PAGE-SUB           02740001
027500             IF DL010-PAGE-SUB < 1                                02750001
027600                 MOVE 1               TO DL010-PAGE-SUB           02760001
027700             END-IF                                               02770001
027800                                                                  02780001
027900             PERFORM 3000-BUILD-SCREEN                            02790001
028000                 VARYING DL010-LINE-SUB                           02800001
028100                 FROM 1 BY 1                                      02810001
028200                 UNTIL PS-SCREEN-FULL-YES                         02820001
028300                    OR DL010-LINE-SUB > 8                         02830003
028400             PERFORM 3200-MOVE-TBL-TO-MAP                         02840001
028500                                                                  02850001
028600             PERFORM 8000-SEND-MAP                                02860001
028700             PERFORM 8100-RETURN-TRANID                           02870001
028800                                                                  02880001
028900         WHEN EIBAID = DFHPF8                                     02890001
029000*            SCROLL FORWARD                                       02900001
029100             SET PS-BROWSE-FWD        TO TRUE                     02910001
029200             MOVE 1                   TO PV-CODE-SUB              02920001
029300                                                                  02930001
029400*            POSITION TO THE NEXT PAGE                            02940001
029500             ADD 1                    TO DL010-PAGE-SUB           02950001
029600             IF DL010-PAGE-SUB > DL010-PAGE-COUNT                 02960001
029700                 MOVE DL010-PAGE-COUNT TO DL010-PAGE-SUB          02970001
029800             END-IF                                               02980001
029900                                                                  02990001
030000             PERFORM 3000-BUILD-SCREEN                            03000001
030100                 VARYING DL010-LINE-SUB                           03010001
030200                 FROM 1 BY 1                                      03020001
030300                 UNTIL PS-SCREEN-FULL-YES                         03030001
030400                 OR DL010-CODE-SEQ                                03040001
030500                             (DL010-PAGE-SUB, DL010-LINE-SUB)     03050001
030600                                     = ZEROES                     03060001
030700             PERFORM 3200-MOVE-TBL-TO-MAP                         03070001
030800                                                                  03080001
030900             PERFORM 8000-SEND-MAP                                03090001
031000             PERFORM 8100-RETURN-TRANID                           03100001
031100                                                                  03110001
031200         WHEN EIBAID = DFHENTER                                   03120001
031300*                                                                 03130001
031400             PERFORM 8020-RECEIVE-MAP                             03140001
031500             PERFORM 1500-EDIT-SELECTION                          03150001
031600             IF PS-ERRORS-NO                                      03160001
031700                 PERFORM 2000-PROCESS                             03170001
031800                 PERFORM 8000-SEND-MAP                            03180001
031900                 PERFORM 8100-RETURN-TRANID                       03190001
032000                                                                  03200001
032100             ELSE                                                 03210001
032200                 PERFORM 8010-SEND-DATA-ONLY                      03220001
032300                 PERFORM 8100-RETURN-TRANID                       03230001
032400             END-IF                                               03240001
032500                                                                  03250001
032600         WHEN EIBAID = DFHPF1                                     03260001
032700             PERFORM 8020-RECEIVE-MAP                             03270001
032800             MOVE DL454AO             TO PC192-HOST-SAVE-MAP      03280001
032900             PERFORM 1200-HELP-SCREEN                             03290001
033000                                                                  03300001
033100         WHEN OTHER                                               03310001
033200             PERFORM 8020-RECEIVE-MAP                             03320001
033300             MOVE PC-UNRECOGNIZED-PF-KEY-MSG                      03330001
033400                                      TO AMSGLNO                  03340001
033500             PERFORM 8000-SEND-MAP                                03350001
033600             PERFORM 8100-RETURN-TRANID                           03360001
033700     END-EVALUATE.                                                03370001
033800                                                                  03380001
033900     GOBACK.                                                      03390001
034000                                                                  03400001
034100 1000-INITIALIZE.                                                 03410001
034200                                                                  03420001
034300*    SEE WHO IS SIGNED ON                                         03430001
034400     PERFORM DP026-0000-GET-LOGON-INFO                            03440001
034500     MOVE DP026-USERID                TO DL010-USERID             03450001
034600                                         AUSERO                   03460001
034700                                                                  03470001
034800     MOVE PC-TRANID                   TO DL010-TRAN-ID            03480001
034900                                                                  03490001
035000     MOVE SPACES                      TO ACODE1O                  03500001
035100                                         ACODE2O                  03510001
035200                                         ACODE3O                  03520001
035210                                         ACODE4O                  03521004
035220                                         ACODE5O                  03522004
035230                                         ACODE6O                  03523004
035240                                         ACODE7O                  03524004
035250                                         ACODE8O                  03525004
035300                                         ADESC1O                  03530001
035400                                         ADESC2O                  03540001
035500                                         ADESC3O                  03550001
035510                                         ADESC4O                  03551004
035520                                         ADESC5O                  03552004
035530                                         ADESC6O                  03553004
035540                                         ADESC7O                  03554004
035550                                         ADESC8O                  03555004
035600                                         AMSGLNO                  03560001
035700                                                                  03570001
035800     INITIALIZE DL010-SCROLL-TABLE                                03580001
035900     PERFORM 1100-SETUP-NAME-CURSOR.                              03590001
036000                                                                  03600001
036100     IF PS-ERRORS-NO                                              03610001
036200         PERFORM 1300-BUILD-SCROLL-TABLE                          03620001
036300             VARYING DL010-PAGE-SUB                               03630001
036400                 FROM 1 BY 1                                      03640001
036500                 UNTIL DL010-PAGE-SUB > 5                         03650004
036600             AFTER DL010-LINE-SUB                                 03660001
036700                 FROM 1 BY 1                                      03670001
036800                 UNTIL PS-END-CODE-CSR-YES                        03680001
036900                 OR DL010-LINE-SUB > 8                            03690004
037000                                                                  03700001
037100         PERFORM 7020-CLOSE-CODE-CSR                              03710001
037200     END-IF.                                                      03720001
037300                                                                  03730001
037400                                                                  03740001
037500 1100-SETUP-NAME-CURSOR.                                          03750001
037600     INITIALIZE PV-CODES-TABLE.                                   03760001
037700     MOVE 1                           TO PV-CODE-SUB              03770001
037800                                                                  03780001
037900     PERFORM 7000-OPEN-CODE-CSR                                   03790001
038000     IF PS-ERRORS-YES                                             03800001
038100         MOVE 1                       TO PV-ERROR-NBR             03810001
038200                                         DL010-ERROR-NBR          03820001
038300         PERFORM 9903-WRITE-CICS-LOG                              03830001
038400         MOVE 6                       TO DL010-PGM-MSG-NBR        03840001
038500         PERFORM 8210-XCTL-ERROR-SCREEN                           03850001
038600     END-IF.                                                      03860001
038700                                                                  03870001
038800     IF PS-ERRORS-NO                                              03880001
038900     PERFORM 7010-FETCH-CODE-CSR                                  03890001
039000     IF PS-END-CODE-CSR-YES                                       03900001
039100         MOVE 2                       TO PV-ERROR-NBR             03910001
039200                                         DL010-ERROR-NBR          03920001
039300         PERFORM 9903-WRITE-CICS-LOG                              03930001
039400         MOVE '100-SETUP-NAME-CURSOR'                             03940001
039500                                  TO DL010-PARAGRAPH              03950001
039600         MOVE 'DLKRF454 - CURSOR IS EMPTY'                        03960001
039700                                  TO DL010-MESSAGE-TEXT(1)        03970001
039800         MOVE SQLCA                   TO DL010-SQLCA              03980001
039900         MOVE 'DLT_TEM_ASGMT'         TO DL010-DB2-TABLE-NAME(1)  03990001
040000         MOVE 6                       TO DL010-PGM-MSG-NBR        04000001
040100         PERFORM 8210-XCTL-ERROR-SCREEN                           04010001
040200     END-IF                                                       04020001
040300     END-IF.                                                      04030001
040400                                                                  04040001
040500 1200-HELP-SCREEN.                                                04050001
040600     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      04060001
040700     MOVE 'DLKRF454'                  TO PC192-PROGRAM-NAME       04070001
040800     COPY PCPD188.                                                04080001
040900     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      04090001
041000     MOVE DL010-COMMAREA              TO PC192-HOST-SAVE-AREA     04100001
041100     PERFORM 8220-XCTL-TO-HELP.                                   04110001
041200                                                                  04120004
041300 1300-BUILD-SCROLL-TABLE.                                         04130001
041400     MOVE DL010-PAGE-SUB              TO DL010-PAGE-NBR           04140001
041500                                          (DL010-PAGE-SUB)        04150001
041600                                                                  04160001
041700     MOVE DLT00007-RF-INDIR-LBR-DESC  TO DL010-CODE-DESC          04170001
041800                    (DL010-PAGE-SUB, DL010-LINE-SUB)              04180001
041900     MOVE DLT00007-RF-SRT-SEQ-NBR     TO DL010-CODE-SEQ           04190001
042000                    (DL010-PAGE-SUB, DL010-LINE-SUB)              04200001
042100     MOVE DLT00007-CNFRMN-REQD-IND    TO DL010-CONFIRM-SW         04210001
042200                    (DL010-PAGE-SUB, DL010-LINE-SUB)              04220001
042300     MOVE DLT00007-TEM-PRMPT-IND      TO DL010-TEM-PROMPT-SW      04230001
042400                    (DL010-PAGE-SUB, DL010-LINE-SUB)              04240001
042500     MOVE DLT00007-INDIR-LBR-CDE      TO DL010-INDIR-LBR-CDE      04250001
042600                    (DL010-PAGE-SUB, DL010-LINE-SUB)              04260001
042700                                                                  04270001
042800     IF DL010-LINE-SUB = 1                                        04280001
042900         ADD 1                        TO DL010-PAGE-COUNT         04290001
043000     END-IF                                                       04300001
043100                                                                  04310001
043200     PERFORM 7010-FETCH-CODE-CSR.                                 04320001
043300/                                                                 04330001
043400 1500-EDIT-SELECTION.                                             04340001
043500     MOVE SPACES                      TO AMSGLNO                  04350001
043600     PERFORM 1501-EDIT-USER.                                      04360001
043700                                                                  04370001
043800     MOVE ASELECTI                    TO DP010I-UNEDITED-FIELD    04380001
043900     MOVE 2                           TO DP010I-MAXIMUM-DIGITS    04390001
044000     MOVE 0                           TO DP010I-MAXIMUM-DECIMALS  04400001
044100     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     04410001
044200                                                                  04420001
044300     CALL DP010I-NUMERIC-EDIT-ROUTINE                             04430001
044400          USING DP010I-NUMERIC-EDIT-AREA.                         04440001
044500                                                                  04450001
044600     IF  DP010I-ERROR-DETECTED                                    04460001
044700         SET PS-ERRORS-YES            TO TRUE                     04470001
044800         MOVE PC-NON-NUMERIC-SELECTION-MSG                        04480001
044900                                      TO AMSGLNO                  04490001
045000         MOVE -1                      TO ASELECTL                 04500001
045100     ELSE                                                         04510001
045200         MOVE DP010I-NUMERIC-FIELD    TO ASELECTO                 04520001
045300                                         PV-SELECTION             04530001
045400     END-IF.                                                      04540001
045500                                                                  04550001
045600     SET PS-NOT-FOUND                 TO TRUE                     04560001
045700     PERFORM 1510-SEARCH-CODES                                    04570001
045800             VARYING PV-PAGE-SUB                                  04580001
045900                 FROM 1 BY 1                                      04590001
046000                 UNTIL PV-PAGE-SUB > 5                            04600004
046100             AFTER PV-LINE-SUB                                    04610001
046200                 FROM 1 BY 1                                      04620001
046300                 UNTIL DL010-CODE-SEQ (PV-PAGE-SUB, PV-LINE-SUB)  04630001
046400                               = ZERO                             04640001
046500                 OR PV-LINE-SUB > 8                               04650004
046600                                                                  04660001
046700     IF PS-NOT-FOUND                                              04670001
046800         SET PS-ERRORS-YES            TO TRUE                     04680001
046900         MOVE -1                      TO ASELECTL                 04690001
047000         MOVE PC-INVALID-SELECTION-MSG                            04700001
047100                                      TO AMSGLNO                  04710001
047200     END-IF.                                                      04720001
047300                                                                  04730001
047400 1501-EDIT-USER.                                                  04740001
047500     IF AUSERL > ZERO                                             04750001
047600         MOVE AUSERI                  TO DL010-KEYED-USERID       04760001
047700     ELSE                                                         04770001
047800         MOVE SPACES                  TO DL010-KEYED-USERID       04780001
047900         SET PS-ERRORS-YES            TO TRUE                     04790001
048000     END-IF.                                                      04800001
048100                                                                  04810001
048200     IF PS-ERRORS-NO                                              04820001
048300         PERFORM 8600-CALL-XLKUT067                               04830001
048400         EVALUATE TRUE                                            04840001
048500         WHEN XL067-SUCCESSFUL AND NOT XL067-USER-NOT-FOUND       04850001
048600             PERFORM 7050-DUMMY-USERID                            04860001
048700             IF DL010-KEYED-USERID = PV-DUMMY-USERID              04870001
048800                 SET PS-ERRORS-YES    TO TRUE                     04880001
048900                 MOVE 'INVALID ENTRY' TO AMSGLNO                  04890001
049000                 MOVE -1              TO AUSERL                   04900001
049100             END-IF                                               04910001
049200                                                                  04920001
049300         WHEN XL067-USER-NOT-FOUND                                04930001
049400             SET PS-ERRORS-YES        TO TRUE                     04940001
049500             MOVE 'INVALID ENTRY'     TO AMSGLNO                  04950001
049600             MOVE -1                  TO AUSERL                   04960001
049700             PERFORM 8010-SEND-DATA-ONLY                          04970001
049800             PERFORM 8100-RETURN-TRANID                           04980001
049900                                                                  04990001
050000         END-EVALUATE                                             05000001
050100     END-IF.                                                      05010001
050200                                                                  05020001
050300     IF PS-ERRORS-NO                                              05030001
050400         PERFORM 1520-CHECK-IF-NEW-USER                           05040001
050500     END-IF.                                                      05050001
050600                                                                  05060001
050700 1510-SEARCH-CODES.                                               05070001
050800     IF PV-SELECTION = DL010-CODE-SEQ                             05080001
050900                     (PV-PAGE-SUB, PV-LINE-SUB)                   05090001
051000         SET PS-IS-FOUND              TO TRUE                     05100001
051100         MOVE PV-PAGE-SUB             TO PV-PAGE-PTR              05110001
051200         MOVE PV-LINE-SUB             TO PV-LINE-PTR              05120001
051300     END-IF.                                                      05130001
051400                                                                  05140001
051500 1520-CHECK-IF-NEW-USER.                                          05150001
051600     MOVE DL010-KEYED-USERID TO PV-KEYED-USERID.                  05160001
051700     IF PV-KEYED-USERID-KOHLS                                     05170001
051800         SET PS-CREATE-NEW-USER-YES       TO TRUE                 05180001
051900         PERFORM 7100-SELECT-RDPR-USR                             05190001
052000     ELSE                                                         05200001
052100         SET PS-CREATE-NEW-USER-NO        TO TRUE                 05210001
052200     END-IF.                                                      05220001
052300                                                                  05230001
052400     IF PS-CREATE-NEW-USER-YES                                    05240001
052500*        THE SWITCH COULD BE TURNED OFF IN PARA 7100              05250001
052600         INITIALIZE XL072-EAI-EXPORT-COMMAREA                     05260001
052700                                                                  05270001
052800         SET XL072-PC-APP-ID      TO TRUE                         05280001
052900         MOVE 'DC LABOR'          TO XL072-EVNT-OBJ-TXT           05290001
053000         MOVE 'ASSOCIATE ADD'     TO XL072-EVNT-OBJ-ACTN-TXT      05300001
053100                                                                  05310001
053200         MOVE DL010-USERID        TO XL072-CRE-BY-USR-ID          05320001
053300         MOVE 'DLKRF454'          TO XL072-CRE-PGM-NM             05330001
053400         MOVE 'N/A'               TO XL072-DTL-COPYBOOK-NM        05340001
053500         MOVE DL010-OPER-UNT-ID   TO XL072-EVNT-KY-1-NBR          05350001
053600         MOVE DL010-KEYED-USERID  TO XL072-EVNT-KY-1-TXT          05360001
053700         MOVE XL067-LAST-NAME     TO XL072-EVNT-KY-2-TXT          05370001
053800         MOVE XL067-FIRST-NAME    TO XL072-EVNT-KY-3-TXT          05380001
053900                                                                  05390001
054000         SET XL072-COMMIT-UPDATE  TO TRUE                         05400001
054100         MOVE 'DLKRF454'          TO XL072-ORIG-CALLING-PGM-NM    05410001
054200                                                                  05420001
054300         PERFORM 8410-CALL-XLKUP033                               05430001
054400                                                                  05440001
054500     END-IF.                                                      05450001
054600/                                                                 05460001
054700 2000-PROCESS.                                                    05470001
054800                                                                  05480001
054900     IF DL010-UPDATE-CONFIRMED                                    05490001
055300                                                                  05530001
055400         SET PS-NOT-FOUND                 TO TRUE                 05540001
055500         PERFORM 1510-SEARCH-CODES                                05550001
055600             VARYING PV-PAGE-SUB                                  05560001
055700                 FROM 1 BY 1                                      05570001
055800                 UNTIL PV-PAGE-SUB > 5                            05580004
055900             AFTER PV-LINE-SUB                                    05590001
056000                 FROM 1 BY 1                                      05600001
056100                 UNTIL DL010-CODE-SEQ (PV-PAGE-SUB, PV-LINE-SUB)  05610001
056200                               = ZERO                             05620001
056300                 OR PV-LINE-SUB > 8                               05630004
056400     END-IF.                                                      05640001
056500                                                                  05650001
056600                                                                  05660001
056700     PERFORM 2100-EVALUATE-PARM-FLAGS.                            05670001
056800                                                                  05680001
056900 2100-EVALUATE-PARM-FLAGS.                                        05690001
057000                                                                  05700001
057100     SET PS-NO-FLAGS                  TO TRUE                     05710001
057200     EVALUATE TRUE                                                05720001
057300     WHEN DL010-TEM-PROMPT-SW (PV-PAGE-PTR, PV-LINE-PTR)  = 'Y'   05730001
057400         SET PS-TEAM-PROMPT           TO TRUE                     05740001
057500*        IS THE WORKER ATTACHED TO AN ASSIGNMENT NOW?             05750001
057600         PERFORM 8300-CALL-DLKUT001                               05760001
057700         IF DL003-ASGMT-FOUND                                     05770001
057800*            XCTL TO DLKRF455 TO APPLY THE CODE                   05780001
057900             MOVE PV-PAGE-PTR         TO DL010-PAGE-SUB           05790001
058000             MOVE PV-LINE-PTR         TO DL010-LINE-SUB           05800001
058100             MOVE DL003-ASGMT-START-DTE                           05810001
058200                                      TO DL010-ASGMT-STRT-DTE     05820001
058300             MOVE DL003-ASGMT-NBR-TXT TO DL010-ASGMT-NBR-TXT      05830001
058400             MOVE DL003-ASGMT-NBR-SEQ-NBR                         05840001
058500                                      TO DL010-ASGMT-NBR-SEQ-NBR  05850001
058600             MOVE DL003-TEM-ASGMT-SEQ-NBR                         05860001
058700                                      TO DL010-TEM-ASGMT-SEQ-NBR  05870001
058800             MOVE 'DLKRF455'          TO PV-TRANSFER-PROGRAM      05880001
058900             SET DL010-INITIALIZE-SCREEN                          05890001
059000                                      TO TRUE                     05900001
059100             PERFORM 8200-XCTL                                    05910001
059200         ELSE                                                     05920001
059300*            CALL XLKUP033  TO UPDATE EVENT EXPORT TABLES         05930001
059400             PERFORM 4000-SETUP-INDIRECT-LABOR                    05940001
059500             PERFORM 8410-CALL-XLKUP033                           05950001
059600             MOVE 'SUCCESSFUL'  TO AMSGLNO                        05960001
059700             IF XL072-EVNT-KY-1-TXT = 'IWORK'                     05970001
059800                 MOVE 'IWORK2' TO XL072-EVNT-KY-1-TXT             05980001
059900                 MOVE PV-LABOR-CURRENT-TIMESTAMP TO               05990001
060000                               XL072-EVNT-KY-1-TMST               06000001
060100                 PERFORM 8410-CALL-XLKUP033                       06010001
060200             END-IF                                               06020001
060300             IF XL072-EVNT-KY-1-TXT = 'IPAWRK'                    06030001
060400                 MOVE 'IPAWK2' TO XL072-EVNT-KY-1-TXT             06040001
060500                 MOVE PV-LABOR-CURRENT-TIMESTAMP TO               06050001
060600                               XL072-EVNT-KY-1-TMST               06060001
060700                 PERFORM 8410-CALL-XLKUP033                       06070001
060800             END-IF                                               06080001
060900         END-IF                                                   06090001
061000                                                                  06100001
061100     WHEN DL010-CONFIRM-SW (PV-PAGE-PTR, PV-LINE-PTR) = 'Y'       06110001
061200         IF DL010-UPDATE-CONFIRMED                                06120001
061300             SET DL010-PROCESS-SCREEN TO TRUE                     06130001
061400*            IS THE WORKER ATTACHED TO AN ASSIGNMENT NOW?         06140001
061500             PERFORM 8300-CALL-DLKUT001                           06150001
061600             IF DL003-ASGMT-FOUND                                 06160001
061700                 PERFORM 2200-PUNCH-OUT                           06170001
061800                 MOVE 'SUCCESSFUL'  TO AMSGLNO                    06180001
061900             ELSE                                                 06190001
062000*                CALL XLKUP033  TO UPDATE EVENT EXPORT TABLES     06200001
062100                 PERFORM 4000-SETUP-INDIRECT-LABOR                06210001
062200                 PERFORM 8410-CALL-XLKUP033                       06220001
062300                 MOVE 'SUCCESSFUL'                                06230001
062400                                      TO AMSGLNO                  06240001
062500                 IF XL072-EVNT-KY-1-TXT = 'IWORK'                 06250001
062600                     MOVE 'IWORK2' TO XL072-EVNT-KY-1-TXT         06260001
062700                     MOVE PV-LABOR-CURRENT-TIMESTAMP TO           06270001
062800                                   XL072-EVNT-KY-1-TMST           06280001
062900                     PERFORM 8410-CALL-XLKUP033                   06290001
063000                 END-IF                                           06300001
063100                 IF XL072-EVNT-KY-1-TXT = 'IPAWRK'                06310001
063200                     MOVE 'IPAWK2' TO XL072-EVNT-KY-1-TXT         06320001
063300                     MOVE PV-LABOR-CURRENT-TIMESTAMP TO           06330001
063400                                   XL072-EVNT-KY-1-TMST           06340001
063500                     PERFORM 8410-CALL-XLKUP033                   06350001
063600                 END-IF                                           06360001
063700             END-IF                                               06370001
063800         ELSE                                                     06380001
063900             SET PS-CONFIRM           TO TRUE                     06390001
064000*            WAIT FOR CONFIRM                                     06400001
064100             MOVE '    F2-CONFIRM     '                           06410001
064200                                      TO AMSGLNO                  06420001
064300             MOVE -1                  TO AUSERL                   06430001
064400             SET DL010-WAIT-FOR-CONFIRM                           06440001
064500                                      TO TRUE                     06450001
064600             PERFORM 8000-SEND-MAP                                06460001
064700             PERFORM 8100-RETURN-TRANID                           06470001
064800         END-IF                                                   06480001
064900                                                                  06490001
065000     WHEN DL010-CONFIRM-SW (PV-PAGE-PTR, PV-LINE-PTR) = 'N'       06500001
065100*        IS THE WORKER ATTACHED TO AN ASSIGNMENT NOW?             06510001
065200         PERFORM 8300-CALL-DLKUT001                               06520001
065300         IF DL003-ASGMT-FOUND                                     06530001
065400             PERFORM 2200-PUNCH-OUT                               06540001
065500             MOVE 'SUCCESSFUL'  TO AMSGLNO                        06550001
065600         ELSE                                                     06560001
065700*            CALL XLKUP033                                        06570001
065800             PERFORM 4000-SETUP-INDIRECT-LABOR                    06580001
065900             PERFORM 8410-CALL-XLKUP033                           06590001
066000             MOVE 'SUCCESSFUL'  TO AMSGLNO                        06600001
066100             IF XL072-EVNT-KY-1-TXT = 'IWORK'                     06610001
066200                 MOVE 'IWORK2' TO XL072-EVNT-KY-1-TXT             06620001
066300                 MOVE PV-LABOR-CURRENT-TIMESTAMP TO               06630001
066400                               XL072-EVNT-KY-1-TMST               06640001
066500                 PERFORM 8410-CALL-XLKUP033                       06650001
066600             END-IF                                               06660001
066700             IF XL072-EVNT-KY-1-TXT = 'IPAWRK'                    06670001
066800                 MOVE 'IPAWK2' TO XL072-EVNT-KY-1-TXT             06680001
066900                 MOVE PV-LABOR-CURRENT-TIMESTAMP TO               06690001
067000                               XL072-EVNT-KY-1-TMST               06700001
067100                 PERFORM 8410-CALL-XLKUP033                       06710001
067200             END-IF                                               06720001
067300         END-IF                                                   06730001
067400     END-EVALUATE.                                                06740001
067500                                                                  06750001
067600 2200-PUNCH-OUT.                                                  06760001
067700     INITIALIZE DL005-ASGMT-COMMAREA                              06770001
067800     SET DL005-BY-ASGMT-NBR           TO TRUE                     06780001
067900     SET DL005-END-FROM-ASGMT         TO TRUE                     06790001
068000     SET DL005-DO-NOT-COMMIT-UPDATE   TO TRUE                     06800001
068100     MOVE DL003-ASGMT-START-DTE       TO DL005-KEY-START-DTE      06810001
068200     MOVE DL003-ASGMT-NBR-TXT         TO DL005-KEY-NBR-TXT        06820001
068300     MOVE DL003-ASGMT-NBR-SEQ-NBR     TO DL005-KEY-NBR-SEQ-NBR    06830001
068400     MOVE DL003-TEM-ASGMT-SEQ-NBR     TO                          06840001
068500                                     DL005-KEY-TEM-ASGMT-SEQ-NBR  06850001
068600     MOVE DL010-KEYED-USERID          TO DL005-KEY-USER-ID        06860001
068700     MOVE DL010-USERID                TO DL005-KEY-ADD-BY-USER-ID 06870001
068800     MOVE DL003-USR-TYPE-CDE          TO DL005-KEY-USR-TYPE-CDE   06880001
068900     MOVE 'DLKRF454'                  TO DL005-ORIG-CALLING-PGM-NM06890001
069000                                         DL005-KEY-LVE-PGM-NM     06900001
069100     IF DL010-CODE-DESC(PV-PAGE-PTR, PV-LINE-PTR) (1:5) =         06910001
069200                                 'ISTOP'                          06920001
069300         SET DL005-KEY-LVE-RSN-SSTOP  TO TRUE                     06930001
069400     ELSE                                                         06940001
069500         SET DL005-KEY-LVE-RSN-AMOVE  TO TRUE                     06950001
069600     END-IF                                                       06960001
069700                                                                  06970001
069800     PERFORM 8620-CALL-DLKUP002.                                  06980001
069900     PERFORM 4000-SETUP-INDIRECT-LABOR                            06990001
070000     PERFORM 8410-CALL-XLKUP033.                                  07000001
070100     IF XL072-EVNT-KY-1-TXT = 'IWORK'                             07010001
070200         MOVE 'IWORK2' TO XL072-EVNT-KY-1-TXT                     07020001
070300         MOVE PV-LABOR-CURRENT-TIMESTAMP TO                       07030001
070400                               XL072-EVNT-KY-1-TMST               07040001
070500         PERFORM 8410-CALL-XLKUP033                               07050001
070600     END-IF.                                                      07060001
070700     IF XL072-EVNT-KY-1-TXT = 'IPAWRK'                            07070001
070800         MOVE 'IPAWK2' TO XL072-EVNT-KY-1-TXT                     07080001
070900         MOVE PV-LABOR-CURRENT-TIMESTAMP TO                       07090001
071000                       XL072-EVNT-KY-1-TMST                       07100001
071100         PERFORM 8410-CALL-XLKUP033                               07110001
071200     END-IF.                                                      07120001
071300                                                                  07130001
071400 3000-BUILD-SCREEN.                                               07140001
071500                                                                  07150001
071600     PERFORM 3100-MOVE-TO-SCREEN.                                 07160001
071700                                                                  07170001
071800 3100-MOVE-TO-SCREEN.                                             07180001
071900                                                                  07190001
072000     MOVE DL010-CODE-SEQ (DL010-PAGE-SUB, DL010-LINE-SUB)         07200001
072100                                      TO PV-CODE-NBR(PV-CODE-SUB).07210001
072200     MOVE DL010-CODE-DESC (DL010-PAGE-SUB, DL010-LINE-SUB)        07220001
072300                                      TO PV-CODE-DESC(PV-CODE-SUB)07230001
072400                                                                  07240001
072500     ADD 1                            TO PV-CODE-SUB.             07250001
072600     IF PV-CODE-SUB > 8                                           07260002
072700         SET PS-SCREEN-FULL-YES       TO TRUE                     07270001
072800     END-IF.                                                      07280001
072900                                                                  07290001
073000 3200-MOVE-TBL-TO-MAP.                                            07300001
073100                                                                  07310001
073200     MOVE DL010-KEYED-USERID          TO AUSERO                   07320001
073300     MOVE PV-CODE-NBR  (1)            TO ACODE1O                  07330001
073400     MOVE PV-CODE-DESC (1)            TO ADESC1O                  07340001
073500     MOVE PV-CODE-NBR  (2)            TO ACODE2O                  07350001
073600     MOVE PV-CODE-DESC (2)            TO ADESC2O                  07360001
073700     MOVE PV-CODE-NBR  (3)            TO ACODE3O                  07370001
073800     MOVE PV-CODE-DESC (3)            TO ADESC3O.                 07380001
073810     MOVE PV-CODE-NBR  (4)            TO ACODE4O                  07381002
073820     MOVE PV-CODE-DESC (4)            TO ADESC4O.                 07382002
073830     MOVE PV-CODE-NBR  (5)            TO ACODE5O                  07383002
073840     MOVE PV-CODE-DESC (5)            TO ADESC5O.                 07384002
073850     MOVE PV-CODE-NBR  (6)            TO ACODE6O                  07385002
073860     MOVE PV-CODE-DESC (6)            TO ADESC6O.                 07386002
073870     MOVE PV-CODE-NBR  (7)            TO ACODE7O                  07387002
073880     MOVE PV-CODE-DESC (7)            TO ADESC7O.                 07388002
073890     MOVE PV-CODE-NBR  (8)            TO ACODE8O                  07389002
073891     MOVE PV-CODE-DESC (8)            TO ADESC8O.                 07389102
073900/                                                                 07390001
074000 4000-SETUP-INDIRECT-LABOR.                                       07400001
074100     INITIALIZE XL072-EAI-EXPORT-COMMAREA                         07410001
074200                                                                  07420001
074300     SET XL072-PC-APP-ID          TO TRUE.                        07430001
074400     MOVE 'DC LABOR'              TO XL072-EVNT-OBJ-TXT           07440001
074500     MOVE 'INDIRECT LABOR'        TO XL072-EVNT-OBJ-ACTN-TXT      07450001
074600     IF DL010-KEYED-USERID = SPACES OR LOW-VALUES                 07460001
074700         MOVE DL010-USERID        TO XL072-CRE-BY-USR-ID          07470001
074800     ELSE                                                         07480001
074900         MOVE DL010-KEYED-USERID  TO XL072-CRE-BY-USR-ID          07490001
075000     END-IF.                                                      07500001
075100     MOVE 'DLKRF454'              TO XL072-CRE-PGM-NM.            07510001
075200     MOVE DL010-OPER-UNT-ID       TO XL072-EVNT-KY-1-NBR.         07520001
075300     MOVE 'N/A'                   TO XL072-DTL-COPYBOOK-NM        07530001
075400                                                                  07540001
075500     MOVE DL010-INDIR-LBR-CDE(PV-PAGE-PTR, PV-LINE-PTR)           07550001
075600                                  TO XL072-EVNT-KY-1-TXT          07560001
075700     SET XL072-COMMIT-UPDATE      TO TRUE.                        07570001
075800     MOVE 'DLKRF454'              TO XL072-ORIG-CALLING-PGM-NM.   07580001
075900                                                                  07590001
076000     EXEC SQL                                                     07600001
076100         SET :XL072-EVNT-KY-1-TMST = CURRENT TIMESTAMP            07610001
076200           , :PV-LABOR-CURRENT-TIMESTAMP =                        07620001
076300              CURRENT TIMESTAMP + 1 SECOND                        07630001
076400     END-EXEC.                                                    07640001
076500                                                                  07650004
076600 7000-OPEN-CODE-CSR.                                              07660001
076700                                                                  07670001
076800     SET PS-SCREEN-FULL-NO            TO TRUE                     07680001
076900     EXEC SQL                                                     07690001
077000         OPEN CODE-CSR                                            07700001
077100     END-EXEC.                                                    07710001
077200                                                                  07720001
077300     EVALUATE TRUE                                                07730001
077400         WHEN SQLCODE = ZERO                                      07740001
077500             CONTINUE                                             07750001
077600         WHEN SQLCODE = -180                                      07760001
077700             SET PS-END-CODE-CSR-YES                              07770001
077800                 PS-ERRORS-YES        TO TRUE                     07780001
077900         WHEN SQLCODE = -904                                      07790001
078000         WHEN SQLCODE = -913                                      07800001
078100         WHEN SQLCODE = -911                                      07810001
078200             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID           07820001
078300             MOVE SQLCODE             TO PV-SQLCODE               07830001
078400             MOVE 3                   TO PV-ERROR-NBR             07840001
078500                                         DL010-ERROR-NBR          07850001
078600             PERFORM 9903-WRITE-CICS-LOG                          07860001
078700             PERFORM 9000-SOFT-ABORT                              07870001
078800             PERFORM 8210-XCTL-ERROR-SCREEN                       07880001
078900         WHEN SQLWARN0 NOT = SPACES                               07890001
079000         WHEN SQLCODE NOT EQUAL ZERO                              07900001
079100             MOVE 4                   TO PV-ERROR-NBR             07910001
079200                                         DL010-ERROR-NBR          07920001
079300             PERFORM 9903-WRITE-CICS-LOG                          07930001
079400             MOVE '7000-OPEN-CODE-CSR'                            07940001
079500                                      TO DL010-PARAGRAPH          07950001
079600             MOVE 'DLKRF454 - OPEN NAME CURSOR'                   07960001
079700                                      TO DL010-MESSAGE-TEXT(1)    07970001
079800             MOVE SQLCA               TO DL010-SQLCA              07980001
079900             MOVE 'DLT_TEM_ASGMT'     TO DL010-DB2-TABLE-NAME(1)  07990001
080000             SET DL010-ABEND          TO TRUE                     08000001
080100             MOVE 3                   TO DL010-PGM-MSG-NBR        08010001
080200             PERFORM 8210-XCTL-ERROR-SCREEN                       08020001
080300                                                                  08030001
080400     END-EVALUATE.                                                08040001
080500                                                                  08050001
080600 7010-FETCH-CODE-CSR.                                             08060001
080700     EXEC SQL                                                     08070001
080800         FETCH CODE-CSR                                           08080001
080900         INTO                                                     08090001
081000             :DLT00007-RF-INDIR-LBR-DESC                          08100001
081100         ,   :DLT00007-CNFRMN-REQD-IND                            08110001
081200         ,   :DLT00007-TEM-PRMPT-IND                              08120001
081300         ,   :DLT00007-RF-SRT-SEQ-NBR                             08130001
081400         ,   :DLT00007-INDIR-LBR-CDE                              08140001
081500     END-EXEC.                                                    08150001
081600                                                                  08160001
081700     EVALUATE TRUE                                                08170001
081800         WHEN SQLCODE = ZERO                                      08180001
081900             CONTINUE                                             08190001
082000         WHEN SQLCODE = +100                                      08200001
082100         WHEN SQLCODE = -180                                      08210001
082200             SET PS-END-CODE-CSR-YES  TO TRUE                     08220001
082300         WHEN SQLCODE = -904                                      08230001
082400         WHEN SQLCODE = -913                                      08240001
082500         WHEN SQLCODE = -911                                      08250001
082600             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID           08260001
082700             MOVE SQLCODE             TO PV-SQLCODE               08270001
082800             MOVE 5                   TO PV-ERROR-NBR             08280001
082900                                         DL010-ERROR-NBR          08290001
083000             PERFORM 9903-WRITE-CICS-LOG                          08300001
083100             PERFORM 9000-SOFT-ABORT                              08310001
083200             PERFORM 8210-XCTL-ERROR-SCREEN                       08320001
083300         WHEN SQLWARN0 NOT = SPACES                               08330001
083400         WHEN SQLCODE NOT EQUAL ZERO                              08340001
083500             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID           08350001
083600             MOVE 6                   TO PV-ERROR-NBR             08360001
083700                                         DL010-ERROR-NBR          08370001
083800             PERFORM 9903-WRITE-CICS-LOG                          08380001
083900             MOVE '7010-FETCH-CODE-CSR'                           08390001
084000                                      TO DL010-PARAGRAPH          08400001
084100             MOVE 'DLKRF454 - FETCH NAME CURSOR'                  08410001
084200                                      TO DL010-MESSAGE-TEXT(1)    08420001
084300             MOVE SQLCA               TO DL010-SQLCA              08430001
084400             MOVE 'DLT_TEM_ASGMT'     TO DL010-DB2-TABLE-NAME(1)  08440001
084500             SET DL010-ABEND          TO TRUE                     08450001
084600             MOVE 3                   TO DL010-PGM-MSG-NBR        08460001
084700             PERFORM 8210-XCTL-ERROR-SCREEN                       08470001
084800                                                                  08480001
084900     END-EVALUATE.                                                08490001
085000                                                                  08500001
085100 7020-CLOSE-CODE-CSR.                                             08510001
085200     EXEC SQL                                                     08520001
085300         CLOSE CODE-CSR                                           08530001
085400     END-EXEC.                                                    08540001
085500                                                                  08550001
085600     EVALUATE TRUE                                                08560001
085700         WHEN SQLCODE = ZERO                                      08570001
085800             CONTINUE                                             08580001
085900         WHEN SQLCODE = -904                                      08590001
086000         WHEN SQLCODE = -913                                      08600001
086100         WHEN SQLCODE = -911                                      08610001
086200             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID           08620001
086300             MOVE SQLCODE             TO PV-SQLCODE               08630001
086400             MOVE 7                   TO PV-ERROR-NBR             08640001
086500                                         DL010-ERROR-NBR          08650001
086600             PERFORM 9903-WRITE-CICS-LOG                          08660001
086700             PERFORM 9000-SOFT-ABORT                              08670001
086800             PERFORM 8210-XCTL-ERROR-SCREEN                       08680001
086900         WHEN SQLWARN0 NOT = SPACES                               08690001
087000         WHEN SQLCODE NOT EQUAL ZERO                              08700001
087100             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID           08710001
087200             MOVE 8                   TO PV-ERROR-NBR             08720001
087300                                         DL010-ERROR-NBR          08730001
087400             PERFORM 9903-WRITE-CICS-LOG                          08740001
087500             MOVE '7020-CLOSE-CODE-CSR'                           08750001
087600                                      TO DL010-PARAGRAPH          08760001
087700             MOVE 'DLKRF454 - FETCH NAME CURSOR'                  08770001
087800                                      TO DL010-MESSAGE-TEXT(1)    08780001
087900             MOVE SQLCA               TO DL010-SQLCA              08790001
088000             MOVE 'DLT_TEM_ASGMT'     TO DL010-DB2-TABLE-NAME(1)  08800001
088100             SET DL010-ABEND          TO TRUE                     08810001
088200             MOVE 3                   TO DL010-PGM-MSG-NBR        08820001
088300             PERFORM 8210-XCTL-ERROR-SCREEN                       08830001
088400                                                                  08840001
088500             CONTINUE                                             08850001
088600     END-EVALUATE.                                                08860001
088700                                                                  08870004
088800 7050-DUMMY-USERID.                                               08880001
088900     EXEC SQL                                                     08890001
089000         SELECT FUNC_TXT                                          08900001
089100         INTO :PV-DUMMY-USERID                                    08910001
089200         FROM                                                     08920001
089300             TKRPRPM                                              08930001
089400         WHERE                                                    08940001
089500             FUNC_TXT                 = :DL010-KEYED-USERID       08950001
089600             AND                                                  08960001
089700             INTFC_SYS_CDE            = 'DLX'                     08970001
089800             AND                                                  08980001
089900             SYS_PRC_FUNC_CDE         = 'DLPLDU'                  08990001
090000             AND                                                  09000001
090100             FUNC_PRC_STAT_CDE        = 'AC'                      09010001
090200             AND                                                  09020001
090300             CURRENT TIMESTAMP BETWEEN                            09030001
090400             FUNC_BEG_TMST AND FUNC_END_TMST                      09040001
090500     END-EXEC.                                                    09050001
090600                                                                  09060001
090700     EVALUATE TRUE                                                09070001
090800         WHEN SQLCODE = ZERO                                      09080001
090900             CONTINUE                                             09090001
091000         WHEN SQLCODE = +100                                      09100001
091100             MOVE SPACES                    TO PV-DUMMY-USERID    09110001
091200         WHEN SQLCODE = -904                                      09120001
091300         WHEN SQLCODE = -913                                      09130001
091400         WHEN SQLCODE = -911                                      09140001
091500             MOVE DL010-KEYED-USERID        TO PV-LOG-USER-ID     09150001
091600             MOVE SQLCODE                   TO PV-SQLCODE         09160001
091700             MOVE 9                         TO PV-ERROR-NBR       09170001
091800                                         DL010-ERROR-NBR          09180001
091900             PERFORM 9903-WRITE-CICS-LOG                          09190001
092000             PERFORM 9000-SOFT-ABORT                              09200001
092100             PERFORM 8210-XCTL-ERROR-SCREEN                       09210001
092200         WHEN SQLWARN0 NOT = SPACES                               09220001
092300         WHEN SQLCODE NOT EQUAL ZERO                              09230001
092400             MOVE 10                  TO PV-ERROR-NBR             09240001
092500                                         DL010-ERROR-NBR          09250001
092600             PERFORM 9903-WRITE-CICS-LOG                          09260001
092700             MOVE '7050-DUMMY-USERID' TO DL010-PARAGRAPH          09270001
092800             MOVE 'DLKRF450 - OPEN NAME CURSOR'                   09280001
092900                                      TO DL010-MESSAGE-TEXT(1)    09290001
093000             MOVE SQLCA               TO DL010-SQLCA              09300001
093100             MOVE 'DLT_TEM_ASGMT'     TO DL010-DB2-TABLE-NAME(1)  09310001
093200             SET DL010-ABEND          TO TRUE                     09320001
093300             MOVE 3                   TO DL010-PGM-MSG-NBR        09330001
093400             PERFORM 8210-XCTL-ERROR-SCREEN                       09340001
093500                                                                  09350001
093600     END-EVALUATE.                                                09360001
093700                                                                  09370004
093800 7100-SELECT-RDPR-USR.                                            09380001
093900                                                                  09390001
094000*    IF THE USER HAS NEVER BEEN A PART OF AN ASSIGNMENT,HE IS NEW 09400001
094100                                                                  09410001
094200     EXEC SQL                                                     09420001
094300     SELECT 'N'                                                   09430001
094400     INTO :PS-CREATE-NEW-USER-SW                                  09440001
094500     FROM                                                         09450001
094600         DLT_RDPR_USR_LSTG                                        09460001
094700     WHERE                                                        09470001
094800             USR_ID       = :DL010-KEYED-USERID                   09480001
094900         AND LOC_NBR      = :DL010-OPER-UNT-ID                    09490001
095000         FETCH FIRST 1 ROW ONLY                                   09500001
095100     END-EXEC.                                                    09510001
095200                                                                  09520001
095300     EVALUATE TRUE                                                09530001
095400         WHEN SQLCODE = ZERO                                      09540001
095500         WHEN SQLCODE = +100                                      09550001
095600             CONTINUE                                             09560001
095700         WHEN SQLCODE = -904                                      09570001
095800         WHEN SQLCODE = -913                                      09580001
095900         WHEN SQLCODE = -911                                      09590001
096000             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID           09600001
096100             MOVE SQLCODE             TO PV-SQLCODE               09610001
096200             MOVE 11                  TO PV-ERROR-NBR             09620001
096300                                         DL010-ERROR-NBR          09630001
096400             PERFORM 9903-WRITE-CICS-LOG                          09640001
096500             PERFORM 9000-SOFT-ABORT                              09650001
096600             PERFORM 8210-XCTL-ERROR-SCREEN                       09660001
096700         WHEN SQLWARN0 NOT = SPACES                               09670001
096800         WHEN SQLCODE NOT EQUAL ZERO                              09680001
096900             MOVE 12                  TO PV-ERROR-NBR             09690001
097000                                         DL010-ERROR-NBR          09700001
097100             PERFORM 9903-WRITE-CICS-LOG                          09710001
097200             MOVE '7100-SELECT-RDPR-USR '                         09720001
097300                                      TO DL010-PARAGRAPH          09730001
097400             MOVE 'DLKRF454 - DETERMINE NEW USER'                 09740001
097500                                      TO DL010-MESSAGE-TEXT(1)    09750001
097600             MOVE SQLCA               TO DL010-SQLCA              09760001
097700             MOVE 'DLT_TEM_ASGMT'     TO DL010-DB2-TABLE-NAME(1)  09770001
097800             SET DL010-ABEND          TO TRUE                     09780001
097900             MOVE 3                   TO DL010-PGM-MSG-NBR        09790001
098000             PERFORM 8210-XCTL-ERROR-SCREEN                       09800001
098100                                                                  09810001
098200     END-EVALUATE.                                                09820001
098300                                                                  09830004
098400 8000-SEND-MAP.                                                   09840001
098500                                                                  09850001
098600     EXEC CICS                                                    09860001
098700         SEND MAP       ('DL454A')                                09870001
098800              MAPSET    ('DLKM454')                               09880001
098900              ERASE                                               09890001
099000              RESP      (PV-CICS-RESPONSE)                        09900001
099100     END-EXEC.                                                    09910001
099200                                                                  09920001
099300     EVALUATE TRUE                                                09930001
099400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 09940001
099500             CONTINUE                                             09950001
099600         WHEN OTHER                                               09960001
099700             MOVE '8000-SEND-MAP'     TO DP013-PARAGRAPH          09970001
099800             MOVE 'DLKRF454 - UNABLE TO SEND MAP'                 09980001
099900                                      TO DP013-MESSAGE-TEXT (1)   09990001
100000             SET DP013-CICS-ABEND                                 10000001
100100                 DP013-ROLLBACK       TO TRUE                     10010001
100200             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               10020001
100300     END-EVALUATE.                                                10030001
100400                                                                  10040001
100500 8010-SEND-DATA-ONLY.                                             10050001
100600                                                                  10060001
100700     EXEC CICS                                                    10070001
100800         SEND MAP       ('DL454A')                                10080001
100900              MAPSET    ('DLKM454')                               10090001
101000              CURSOR                                              10100001
101100              DATAONLY                                            10110001
101200              RESP      (PV-CICS-RESPONSE)                        10120001
101300     END-EXEC.                                                    10130001
101400                                                                  10140001
101500     EVALUATE TRUE                                                10150001
101600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 10160001
101700             CONTINUE                                             10170001
101800         WHEN OTHER                                               10180001
101900             MOVE '8010-SEND-DATA-ONLY'                           10190001
102000                                      TO DP013-PARAGRAPH          10200001
102100             MOVE 'DLKRF454 - UNABLE TO SEND DATA'                10210001
102200                                      TO DP013-MESSAGE-TEXT (1)   10220001
102300             SET DP013-CICS-ABEND                                 10230001
102400                 DP013-ROLLBACK       TO TRUE                     10240001
102500             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               10250001
102600     END-EVALUATE.                                                10260001
102700                                                                  10270001
102800 8020-RECEIVE-MAP.                                                10280001
102900                                                                  10290001
103000     EXEC CICS                                                    10300001
103100         RECEIVE MAP    ('DL454A')                                10310001
103200                 MAPSET ('DLKM454')                               10320001
103300                 RESP   (PV-CICS-RESPONSE)                        10330001
103400     END-EXEC.                                                    10340001
103500                                                                  10350001
103600     EVALUATE TRUE                                                10360001
103700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 10370001
103800             CONTINUE                                             10380001
103900         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                10390001
104000             CONTINUE                                             10400001
104100         WHEN OTHER                                               10410001
104200            MOVE '8020-RECEIVE-MAP'      TO DP013-PARAGRAPH       10420001
104300            MOVE 'DLKRF454 - UNABLE TO RECEIVE MAP'               10430001
104400                                         TO DP013-MESSAGE-TEXT (1)10440001
104500            SET DP013-LOGIC-ABEND        TO TRUE                  10450001
104600            SET DP013-ROLLBACK           TO TRUE                  10460001
104700            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                10470001
104800     END-EVALUATE.                                                10480001
104900                                                                  10490001
105000 8100-RETURN-TRANID.                                              10500001
105100                                                                  10510001
105200     MOVE LENGTH OF DL010-COMMAREA    TO PV-COMMAREA-LENGTH       10520001
105300     EXEC CICS                                                    10530001
105400         RETURN TRANSID  (PC-TRANID)                              10540001
105500                COMMAREA (DL010-COMMAREA)                         10550001
105600                LENGTH   (PV-COMMAREA-LENGTH)                     10560001
105700                RESP     (PV-CICS-RESPONSE)                       10570001
105800     END-EXEC.                                                    10580001
105900                                                                  10590001
106000     EVALUATE TRUE                                                10600001
106100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 10610001
106200             CONTINUE                                             10620001
106300         WHEN OTHER                                               10630001
106400             MOVE '8100-RETURN-TRANIND' TO DP013-PARAGRAPH        10640001
106500             MOVE 'DLKRF454 - UNABLE TO RETURN TO TRANID'         10650001
106600                 TO DP013-MESSAGE-TEXT (1)                        10660001
106700             SET DP013-CICS-ABEND       TO TRUE                   10670001
106800             SET DP013-ROLLBACK         TO TRUE                   10680001
106900             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               10690001
107000     END-EVALUATE.                                                10700001
107100                                                                  10710001
107200 8110-RETURN.                                                     10720001
107300                                                                  10730001
107400     EXEC CICS                                                    10740001
107500         SEND FROM (PV-MESSAGE-AREA)                              10750001
107600              LENGTH (19)                                         10760001
107700              ERASE                                               10770001
107800     END-EXEC.                                                    10780001
107900                                                                  10790001
108000     EXEC CICS                                                    10800001
108100         RETURN                                                   10810001
108200     END-EXEC.                                                    10820001
108300                                                                  10830001
108400 8200-XCTL.                                                       10840001
108500     SET DL010-INITIALIZE-SCREEN      TO TRUE.                    10850001
108600     MOVE PC-CURRENT-PROGRAM-NAME     TO DL010-LAST-PROGRAM       10860001
108800     MOVE LENGTH OF DL010-COMMAREA    TO PV-COMMAREA-LENGTH       10880001
108900                                                                  10890001
109000     EXEC CICS                                                    10900001
109100         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    10910001
109200               COMMAREA  (DL010-COMMAREA)                         10920001
109300               LENGTH    (PV-COMMAREA-LENGTH)                     10930001
109400               RESP      (PV-CICS-RESPONSE)                       10940001
109500     END-EXEC.                                                    10950001
109600                                                                  10960001
109700     EVALUATE TRUE                                                10970001
109800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 10980001
109900             CONTINUE                                             10990001
110000         WHEN OTHER                                               11000001
110100             MOVE '8200-XCTL'         TO DP013-PARAGRAPH          11010001
110200             MOVE 'DLKRF454 - UNABLE TO XCTL TO PROGRAM: '        11020001
110300                                      TO DP013-MESSAGE-TEXT (1)   11030001
110400             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   11040001
110500             SET DP013-CICS-ABEND                                 11050001
110600                 DP013-ROLLBACK       TO TRUE                     11060001
110700             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               11070001
110800             MOVE PC-TRANS-UNAVAILABLE-MSG                        11080001
110900                                      TO AMSGLNO                  11090001
111000             SET DL010-PROCESS-SCREEN TO TRUE                     11100001
111200             PERFORM 8000-SEND-MAP                                11120001
111300             PERFORM 8100-RETURN-TRANID                           11130001
111400     END-EVALUATE.                                                11140001
111500                                                                  11150001
111600 8210-XCTL-ERROR-SCREEN.                                          11160001
111700                                                                  11170001
111800     IF NOT DL010-ABEND                                           11180001
111900         SET DL010-INITIALIZE-SCREEN  TO TRUE                     11190001
112000     END-IF                                                       11200001
112100     MOVE DFHEIBLK                    TO DL010-DFHEIBLK.          11210001
112200     MOVE PC-CURRENT-PROGRAM-NAME     TO DL010-LAST-PROGRAM.      11220001
112300     MOVE LENGTH OF DL010-COMMAREA    TO PV-COMMAREA-LENGTH       11230001
112400     MOVE 'DLKRF456'                  TO PV-TRANSFER-PROGRAM      11240001
112500     IF DL010-PGM-MSG-NBR = ZERO                                  11250001
112600*        UNDEFINED ERROR                                          11260001
112700         MOVE 1                       TO DL010-PGM-MSG-NBR        11270001
112800     END-IF                                                       11280001
112900*                                                                 11290001
113000     EXEC CICS                                                    11300001
113100         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    11310001
113200               COMMAREA  (DL010-COMMAREA)                         11320001
113300               LENGTH    (PV-COMMAREA-LENGTH)                     11330001
113400               RESP      (PV-CICS-RESPONSE)                       11340001
113500     END-EXEC.                                                    11350001
113600                                                                  11360001
113700     EVALUATE TRUE                                                11370001
113800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 11380001
113900             CONTINUE                                             11390001
114000         WHEN OTHER                                               11400001
114100             MOVE '8200-XCTL'                                     11410001
114200                                      TO DP013-PARAGRAPH          11420001
114300             MOVE 'DLKRF454 - UNABLE TO XCTL TO PROGRAM: '        11430001
114400                                      TO DP013-MESSAGE-TEXT (1)   11440001
114500             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   11450001
114600             SET DP013-CICS-ABEND                                 11460001
114700                 DP013-ROLLBACK       TO TRUE                     11470001
114800             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               11480001
114900             MOVE PC-TRANS-UNAVAILABLE-MSG                        11490001
115000                                      TO AMSGLNO                  11500001
115100             SET DL010-PROCESS-SCREEN TO TRUE                     11510001
115200             PERFORM 8000-SEND-MAP                                11520001
115300             PERFORM 8100-RETURN-TRANID                           11530001
115400     END-EVALUATE.                                                11540001
115500/                                                                 11550001
115600*                                                                 11560001
115700 8220-XCTL-TO-HELP.                                               11570001
115800                                                                  11580001
115900     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH       11590001
116000                                                                  11600001
116100     EXEC CICS                                                    11610001
116200         XCTL                                                     11620001
116300             PROGRAM   (PV-TRANSFER-PROGRAM)                      11630001
116400             COMMAREA  (PC192-COMMAREA)                           11640001
116500             LENGTH    (PV-COMMAREA-LENGTH)                       11650001
116600             RESP      (PV-CICS-RESPONSE)                         11660001
116700     END-EXEC.                                                    11670001
116800                                                                  11680001
116900     EVALUATE TRUE                                                11690001
117000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 11700001
117100              CONTINUE                                            11710001
117200         WHEN OTHER                                               11720001
117300             MOVE '8220-XCTL-TO-HELP' TO DP013-PARAGRAPH          11730001
117400             MOVE 'DLKRF454 - UNABLE TO XCTL TO PROGRAM: '        11740001
117500                                      TO DP013-MESSAGE-TEXT (1)   11750001
117600             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   11760001
117700             SET DP013-CICS-ABEND                                 11770001
117800                 DP013-ROLLBACK       TO TRUE                     11780001
117900             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               11790001
118000             MOVE PC-TRANS-UNAVAILABLE-MSG                        11800001
118100                                      TO AMSGLNO                  11810001
118200             SET DL010-PROCESS-SCREEN TO TRUE                     11820001
118300             PERFORM 8000-SEND-MAP                                11830001
118400             PERFORM 8100-RETURN-TRANID                           11840001
118500     END-EVALUATE.                                                11850001
118700 8300-CALL-DLKUT001.                                              11870001
118800     INITIALIZE DL003-ASGMT-COMMAREA                              11880001
118900     SET DL003-BY-USER-KEY            TO TRUE                     11890001
119000     MOVE DL010-KEYED-USERID          TO DL003-KEY-USER-ID        11900001
119100                                                                  11910001
119200     MOVE 'DLKRF454'                  TO DL003-ORIG-CALLING-PGM-NM11920001
119300                                                                  11930001
119400     CALL DL003-USER-PGM USING DFHEIBLK                           11940001
119500                               DL003-COMMAREA                     11950001
119600                               DL003-ASGMT-COMMAREA               11960001
119700                                                                  11970001
119800     EVALUATE TRUE                                                11980001
119900         WHEN DL003-SUCCESSFUL                                    11990001
120000             CONTINUE                                             12000001
120100         WHEN DL003-SQL-ERROR                                     12010001
120200         WHEN DL003-INVALID-ACCESS                                12020001
120300             MOVE '8300-CALL-DLKUT001' TO DP013-PARAGRAPH         12030001
120400             MOVE 'DLKRF454 - DB2 ERROR IN PROGRAM: '             12040001
120500                                      TO DP013-MESSAGE-TEXT (1)   12050001
120600             MOVE 'DLKUT001'          TO DP013-MESSAGE-TEXT (2)   12060001
120700             SET DP013-CICS-ABEND                                 12070001
120800                 DP013-ROLLBACK       TO TRUE                     12080001
120900             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               12090001
121000             MOVE PC-TRANS-UNAVAILABLE-MSG                        12100001
121100                                      TO AMSGLNO                  12110001
121200             SET DL010-PROCESS-SCREEN TO TRUE                     12120001
121300             MOVE -1                  TO ASELECTL                 12130001
121400             PERFORM 8000-SEND-MAP                                12140001
121500             PERFORM 8100-RETURN-TRANID                           12150001
121600         WHEN OTHER                                               12160001
121700             MOVE '8300-CALL-DLKUT001' TO DP013-PARAGRAPH         12170001
121800             MOVE 'DLKRF454 - UNDETERMINED ERROR IN PGM: '        12180001
121900                                      TO DP013-MESSAGE-TEXT (1)   12190001
122000             MOVE 'DLKUT001'          TO DP013-MESSAGE-TEXT (2)   12200001
122100             SET DP013-CICS-ABEND                                 12210001
122200                 DP013-ROLLBACK       TO TRUE                     12220001
122300             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               12230001
122400             MOVE PC-TRANS-UNAVAILABLE-MSG                        12240001
122500                                      TO AMSGLNO                  12250001
122600             SET DL010-PROCESS-SCREEN TO TRUE                     12260001
122700             MOVE -1                  TO ASELECTL                 12270001
122800             PERFORM 8000-SEND-MAP                                12280001
122900             PERFORM 8100-RETURN-TRANID                           12290001
123000     END-EVALUATE.                                                12300001
123100                                                                  12310004
123200 8410-CALL-XLKUP033.                                              12320001
123300                                                                  12330001
123400     CALL XL072-USER-PGM USING DFHEIBLK                           12340001
123500                               XL072-COMMAREA                     12350001
123600                               XL072-EAI-EXPORT-COMMAREA          12360001
123700                                                                  12370001
123800                                                                  12380001
123900     EVALUATE TRUE                                                12390001
124000         WHEN XL072-SUCCESSFUL                                    12400001
124100             CONTINUE                                             12410001
124200         WHEN XL072-SQL-ERROR                                     12420001
124300             MOVE 13                  TO PV-ERROR-NBR             12430001
124400                                         DL010-ERROR-NBR          12440001
124500             MOVE DL010-USERID        TO PV-LOG-USER-ID           12450001
124600             MOVE XL072-EAI-DB-SQLCODE TO PV-SQLCODE              12460001
124700             PERFORM 9903-WRITE-CICS-LOG                          12470001
124800             MOVE '8410-CALL-XLKUP033'                            12480001
124900                                      TO DL010-PARAGRAPH          12490001
125000             MOVE 'DLKRF454 - END ASSIGNMENT'                     12500001
125100                                      TO DL010-MESSAGE-TEXT(1)    12510001
125200             MOVE XL072-SQL-ERROR-PARA                            12520001
125300                                      TO DL010-MESSAGE-TEXT(2)    12530001
125400             MOVE XL072-SQLCA         TO DL010-SQLCA              12540001
125500             SET DL010-ABEND          TO TRUE                     12550001
125600             MOVE 3                   TO DL010-PGM-MSG-NBR        12560001
125700             PERFORM 8210-XCTL-ERROR-SCREEN                       12570001
125800         WHEN XL072-INVALID-ACCESS                                12580001
125900             MOVE '8410-CALL-XLKUP033' TO DP013-PARAGRAPH         12590001
126000             MOVE 'DLKRF454 - DB2 ERROR IN PROGRAM: '             12600001
126100                                      TO DP013-MESSAGE-TEXT (1)   12610001
126200             MOVE 'XLKUP033'          TO DP013-MESSAGE-TEXT (2)   12620001
126300             SET DP013-CICS-ABEND                                 12630001
126400                 DP013-ROLLBACK       TO TRUE                     12640001
126500             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               12650001
126600             MOVE PC-TRANS-UNAVAILABLE-MSG                        12660001
126700                                      TO AMSGLNO                  12670001
126800             SET DL010-PROCESS-SCREEN TO TRUE                     12680001
126900             MOVE -1                  TO AUSERL                   12690001
127000             PERFORM 8000-SEND-MAP                                12700001
127100             PERFORM 8100-RETURN-TRANID                           12710001
127200         WHEN OTHER                                               12720001
127300             MOVE '8410-CALL-XLKUP033' TO DP013-PARAGRAPH         12730001
127400             MOVE 'DLKRF454 - UNDETERMINED ERROR IN PGM: '        12740001
127500                                      TO DP013-MESSAGE-TEXT (1)   12750001
127600             MOVE 'XLKUP033'          TO DP013-MESSAGE-TEXT (2)   12760001
127700             SET DP013-CICS-ABEND                                 12770001
127800                 DP013-ROLLBACK       TO TRUE                     12780001
127900             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               12790001
128000             MOVE PC-TRANS-UNAVAILABLE-MSG                        12800001
128100                                      TO AMSGLNO                  12810001
128200             SET DL010-PROCESS-SCREEN TO TRUE                     12820001
128300             MOVE -1                  TO AUSERL                   12830001
128400             PERFORM 8000-SEND-MAP                                12840001
128500             PERFORM 8100-RETURN-TRANID                           12850001
128600     END-EVALUATE.                                                12860001
128700                                                                  12870001
139300                                                                  13930004
139400 8600-CALL-XLKUT067.                                              13940001
139500                                                                  13950001
139600     INITIALIZE XL067-USER-COMMAREA.                              13960001
139700     SET XL067-BY-USER-ID                                         13970001
139800         XL067-SELECT-BOTH-USERS      TO TRUE.                    13980001
139900     MOVE DL010-KEYED-USERID          TO XL067-KEY-USER-ID        13990001
140000                                                                  14000001
140100     MOVE 'DLKRF454'                  TO XL067-ORIG-CALLING-PGM-NM14010001
140200                                                                  14020001
140300     CALL XL067-USER-PGM USING DFHEIBLK                           14030001
140400                               XL067-COMMAREA                     14040001
140500                               XL067-USER-COMMAREA                14050001
140600                                                                  14060001
140700     EVALUATE TRUE                                                14070001
140800         WHEN XL067-SUCCESSFUL                                    14080001
140900             CONTINUE                                             14090001
141000         WHEN XL067-SQL-ERROR                                     14100001
141100         WHEN XL067-INVALID-ACCESS                                14110001
141200             MOVE '8600-LINK-XLKUT067' TO DP013-PARAGRAPH         14120001
141300             MOVE 'DLKRF454 - DB2 ERROR IN PROGRAM: '             14130001
141400                                      TO DP013-MESSAGE-TEXT (1)   14140001
141500             MOVE 'XLKUT067'          TO DP013-MESSAGE-TEXT (2)   14150001
141600             SET DP013-CICS-ABEND                                 14160001
141700                 DP013-ROLLBACK       TO TRUE                     14170001
141800             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               14180001
141900             MOVE PC-TRANS-UNAVAILABLE-MSG                        14190001
142000                                      TO AMSGLNO                  14200001
142100             SET DL010-PROCESS-SCREEN TO TRUE                     14210001
142200             PERFORM 8000-SEND-MAP                                14220001
142300             PERFORM 8100-RETURN-TRANID                           14230001
142400         WHEN OTHER                                               14240001
142500             MOVE '8600-LINK-XLKUT067' TO DP013-PARAGRAPH         14250001
142600             MOVE 'DLKRF454 - UNDETERMINED ERROR IN PGM: '        14260001
142700                                      TO DP013-MESSAGE-TEXT (1)   14270001
142800             MOVE 'XLKUT067'          TO DP013-MESSAGE-TEXT (2)   14280001
142900             SET DP013-CICS-ABEND                                 14290001
143000                 DP013-ROLLBACK       TO TRUE                     14300001
143100             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               14310001
143200             MOVE PC-TRANS-UNAVAILABLE-MSG                        14320001
143300                                      TO AMSGLNO                  14330001
143400             SET DL010-PROCESS-SCREEN TO TRUE                     14340001
143500             PERFORM 8000-SEND-MAP                                14350001
143600             PERFORM 8100-RETURN-TRANID                           14360001
143700     END-EVALUATE.                                                14370001
143800                                                                  14380004
143900 8620-CALL-DLKUP002.                                              14390001
144000                                                                  14400001
144100     CALL DL005-USER-PGM USING DFHEIBLK                           14410001
144200                               DL005-COMMAREA                     14420001
144300                               DL005-ASGMT-COMMAREA               14430001
144400                                                                  14440001
144500     EVALUATE TRUE                                                14450001
144600         WHEN DL005-SUCCESSFUL                                    14460001
144700             CONTINUE                                             14470001
144800         WHEN DL005-SQL-ERROR                                     14480001
144900             MOVE 15                  TO PV-ERROR-NBR             14490001
145000                                         DL010-ERROR-NBR          14500001
145100             MOVE DL010-USERID        TO PV-LOG-USER-ID           14510001
145200             MOVE DL005-ASGMT-SQLCODE TO PV-SQLCODE               14520001
145300             PERFORM 9903-WRITE-CICS-LOG                          14530001
145400             MOVE '3100-ADD-TO-ASSIGNMENT'                        14540001
145500                                      TO DL010-PARAGRAPH          14550001
145600             MOVE 'DLKRF454 - END ASSIGNMENT'                     14560001
145700                                      TO DL010-MESSAGE-TEXT(1)    14570001
145800             MOVE DL005-SQL-ERROR-PARA                            14580001
145900                                      TO DL010-MESSAGE-TEXT(2)    14590001
146000             MOVE DL005-SQLCA         TO DL010-SQLCA              14600001
146100             SET DL010-ABEND          TO TRUE                     14610001
146200             MOVE 3                   TO DL010-PGM-MSG-NBR        14620001
146300             PERFORM 8210-XCTL-ERROR-SCREEN                       14630001
146400         WHEN DL005-INVALID-ACCESS                                14640001
146500             MOVE '8610-CALL-DLKUT001' TO DP013-PARAGRAPH         14650001
146600             MOVE 'DLKRF454 - DB2 ERROR IN PROGRAM: '             14660001
146700                                      TO DP013-MESSAGE-TEXT (1)   14670001
146800             MOVE 'DLKUP002'          TO DP013-MESSAGE-TEXT (2)   14680001
146900             SET DP013-CICS-ABEND                                 14690001
147000                 DP013-ROLLBACK       TO TRUE                     14700001
147100             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               14710001
147200             MOVE PC-TRANS-UNAVAILABLE-MSG                        14720001
147300                                      TO AMSGLNO                  14730001
147400             SET DL010-PROCESS-SCREEN TO TRUE                     14740001
147500             MOVE -1                  TO AUSERL                   14750001
147600             PERFORM 8000-SEND-MAP                                14760001
147700             PERFORM 8100-RETURN-TRANID                           14770001
147800         WHEN OTHER                                               14780001
147900             MOVE '8620-CALL-DLKUP002' TO DP013-PARAGRAPH         14790001
148000             MOVE 'DLKRF454 - UNDETERMINED ERROR IN PGM: '        14800001
148100                                      TO DP013-MESSAGE-TEXT (1)   14810001
148200             MOVE 'DLKUP002'          TO DP013-MESSAGE-TEXT (2)   14820001
148300             SET DP013-CICS-ABEND                                 14830001
148400                 DP013-ROLLBACK       TO TRUE                     14840001
148500             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               14850001
148600             MOVE PC-TRANS-UNAVAILABLE-MSG                        14860001
148700                                      TO AMSGLNO                  14870001
148800             SET DL010-PROCESS-SCREEN TO TRUE                     14880001
148900             MOVE -1                  TO AUSERL                   14890001
149000             PERFORM 8000-SEND-MAP                                14900001
149100             PERFORM 8100-RETURN-TRANID                           14910001
149200     END-EVALUATE.                                                14920001
149300                                                                  14930004
149400 9000-SOFT-ABORT.                                                 14940001
149500                                                                  14950001
149600     EXEC CICS                                                    14960001
149700         SYNCPOINT ROLLBACK                                       14970001
149800     END-EXEC.                                                    14980001
149900                                                                  14990001
150000     MOVE 2                           TO DL010-PGM-MSG-NBR        15000001
150100     MOVE SQLCODE                     TO DL010-SQLCODE            15010001
150200     MOVE SQLCA                       TO DL010-SQLCA              15020001
150300     MOVE 'D454'                      TO DL010-TRAN-ID            15030001
150400     PERFORM 8210-XCTL-ERROR-SCREEN.                              15040001
150500                                                                  15050001
150600                                                                  15060001
150700 9903-WRITE-CICS-LOG.                                             15070001
150800                                                                  15080001
150900     MOVE SQLCODE                     TO PV-SQLCODE               15090001
151000                                                                  15100001
151100     EXEC CICS                                                    15110001
151200         WRITEQ TD                                                15120001
151300             QUEUE  ('CSSL')                                      15130001
151400             FROM   (PV-LOG-MSG)                                  15140001
151500             RESP   (PV-CICS-RESPONSE)                            15150001
151600     END-EXEC.                                                    15160001
151700                                                                  15170001
151800 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  15180001
151900                                                                  15190001
152000     MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.           15200001
152100     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          15210001
152200     INITIALIZE DP013-SRC-TASK-NUMBER                             15220001
152300                DP013-STACK.                                      15230001
152400     SET DP013-LINK-RETURN            TO TRUE.                    15240001
152500                                                                  15250001
152600     EXEC CICS                                                    15260001
152700         LINK                                                     15270001
152800             PROGRAM   (DP013-NAME)                               15280001
152900             COMMAREA  (DP013-PARAMETERS)                         15290001
153000             LENGTH    (DP013-LENGTH)                             15300001
153100     END-EXEC.                                                    15310001
153200                                                                  15320004
153300*    TERMINAL INFO                                                15330001
153400     COPY DPPD026.                                                15340001
153500                                                                  15350001
153800                                                                  15380001
