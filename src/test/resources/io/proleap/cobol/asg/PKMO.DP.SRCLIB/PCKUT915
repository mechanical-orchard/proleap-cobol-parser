000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    PCKUT915.                                         00020001
000300 AUTHOR.        RON KRIER.                                        00030000
000400 INSTALLATION.  KOHLS.                                            00040000
000500 DATE-WRITTEN   NOVEMBER, 2019.                                   00050001
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800* ************************************************************** *00080000
000900* * PCKUT915 - THIS PROGRAM WILL READ AN INPUT FILE TO GET     * *00090001
001000* *            SKU NUMBERS TO THEN CHECK THE SUMMARY OF THE    * *00100001
001100* *            SE DATA ON THE PCT_TRN_CLSN_DTL TABLE TO        * *00110001
001200* *            COMPARE TO THE SE ON THE PCT_TRN_CLSN_BAL       * *00120001
001300* *            TABLE - LOOKING FOR THOSE ENTRIES THAT DO       * *00130001
001400* *            NOT BALANCE.                                    * *00140001
001500* *                                                            * *00150000
001600* * PURPOSE:                                                   * *00160000
001700* * WE HAVE HAD MULTIPLE INCIDENTS OPENED RECENTLY ABOUT       * *00170001
001800* * AN INBALANCE BETWEEN THE DETAIL AND THE BALANCE TABLE SO   * *00180001
001900* * WANT TO SEE HOW BAD THIS IS BY WRITING THIS PROGRAM AND    * *00190001
002000* * CHECKING RANDOM SKU'S.  ALSO, WE HAVE HAD SOME INCIDENTS   * *00200001
002100* * OF NEGATIVE BALANCE ENTRIES WHICH ALSO DID NOT MATCH UP    * *00210001
002200* * TO THE SUMMARY OF THE DETAIL ROWS.                         * *00220001
002300* *                                                            * *00230001
002400* * THIS PROGRAM WILL SIMPLY DISPLAY THOSE SKU/STORE ENTRIES   * *00240001
002500* * THAT ARE OUT OF BALANCE.  WE WILL NEED TO DETERMINE WHAT   * *00250001
002600* * TO DO TO GET THEM BACK INTO BALANCE.                       * *00260001
002700* *                                                            * *00270001
002800* * FOR THOSE STORE/SKU ENTRIES THAT ARE OUT OF BALANCE, THE   * *00280013
002900* * PROGRAM WILL WRITE AN OUTPUT RECORD IN THE FORMAT OF       * *00290013
003000* * PCRD080 WHICH CAN BE TAKEN INTO PROGRAM PCKUP951 TO        * *00300013
003100* * UPDATE THE BALANCE TABLE TO GET IT IN SYNC WITH THE        * *00310013
003200* * DETAIL ENTRIES.                                            * *00320013
003300* *                                                            * *00330013
003400* * FYI - THIS PROGRAM WAS COPIED FROM SUKUT931                * *00340001
003500* ************************************************************** *00350000
003600 ENVIRONMENT DIVISION.                                            00360000
003700 CONFIGURATION SECTION.                                           00370000
003800 SOURCE-COMPUTER.        IBM-3090.                                00380000
003900 OBJECT-COMPUTER.        IBM-3090.                                00390000
004000                                                                  00400000
004100 INPUT-OUTPUT SECTION.                                            00410000
004200 FILE-CONTROL.                                                    00420000
004300                                                                  00430000
004400     SELECT INPUT-FILE                    ASSIGN TO IN01.         00440000
004500                                                                  00450013
004600     SELECT OUTPUT-FILE                   ASSIGN TO OUT01.        00460013
004700                                                                  00470000
004800******************************************************************00480000
004900 DATA DIVISION.                                                   00490000
005000 FILE SECTION.                                                    00500000
005100                                                                  00510000
005200 FD  INPUT-FILE                                                   00520000
005300     RECORDING MODE IS F                                          00530000
005400     LABEL RECORDS ARE STANDARD                                   00540000
005500     BLOCK CONTAINS 0 RECORDS.                                    00550000
005600 01  INPUT-RECORD                    PIC  X(80).                  00560000
005700                                                                  00570000
005800 FD  OUTPUT-FILE                                                  00580013
005900     RECORDING MODE IS F                                          00590013
006000     LABEL RECORDS ARE STANDARD                                   00600013
006100     BLOCK CONTAINS 0 RECORDS.                                    00610013
006200                                                                  00620013
006300 01  OUTPUT-RECORD                   PIC  X(50).                  00630013
006400                                                                  00640013
006500                                                                  00650000
006600 WORKING-STORAGE SECTION.                                         00660000
006700                                                                  00670000
006800 01  PC-PROGRAM-CONSTANTS.                                        00680000
006900     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'PCKUT915'.  00690001
007000     05  PC-PGM-PROGRESS-DESC.                                    00700000
007100         10  PC-ORD-SKU-ADD          PIC X(20) VALUE              00710000
007200             'ORD_SKU_ADD         '.                              00720000
007300     05  PC-ABEND-INFO.                                           00730000
007400         10  PC-ABEND                PIC X(11) VALUE              00740000
007500                                               '** ABEND **'.     00750000
007600         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00760000
007700                                               '- PARA       : '. 00770000
007800         10  PC-ABEND-MSG-DISPLAY-PARA                            00780000
007900                                     PIC X(15) VALUE              00790000
008000                                               '  CALLED PARA: '. 00800000
008100         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00810000
008200                                               '  FOR ABEND# : '. 00820000
008300         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00830000
008400                                               '- ERROR IS   : '. 00840000
008500         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00850000
008600         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              00860000
008700                                               '- ACTION     : '. 00870000
008800     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 5000.        00880000
008900     05  PC-1                        PIC 9(04) VALUE 0001.        00890000
009000     05  PC-2                        PIC 9(04) VALUE 0002.        00900000
009100     05  PC-3                        PIC 9(04) VALUE 0003.        00910000
009200     05  PC-4                        PIC 9(04) VALUE 0004.        00920000
009300     05  PC-5                        PIC 9(04) VALUE 0005.        00930000
009400     05  PC-6                        PIC 9(04) VALUE 0006.        00940000
009500     05  PC-7                        PIC 9(04) VALUE 0007.        00950000
009600     05  PC-8                        PIC 9(04) VALUE 0008.        00960000
009700                                                                  00970000
009800 01  PS-PROGRAM-SWITCHES.                                         00980000
009900     05  PS-INPUT-EOF-SW             PIC X(01) VALUE 'N'.         00990000
010000         88  PS-INPUT-EOF                      VALUE 'Y'.         01000000
010100         88  PS-INPUT-NOT-EOF                  VALUE 'N'.         01010000
010200     05  PS-INPUT-MATCH-SW           PIC X(01) VALUE 'N'.         01020000
010300         88  PS-INPUT-MATCH                    VALUE 'Y'.         01030000
010400         88  PS-INPUT-NOT-MATCH                VALUE 'N'.         01040000
010500     05  PS-WRITE-FROM-SW            PIC X(01) VALUE 'N'.         01050000
010600         88  PS-WRITE-FROM-INPUT               VALUE 'I'.         01060000
010700         88  PS-WRITE-FROM-CURSOR              VALUE 'C'.         01070000
010800     05  PS-END-OF-BAL-CSR-SW        PIC X(01) VALUE 'N'.         01080000
010900         88  PS-END-OF-BAL-CSR                 VALUE 'Y'.         01090000
011000     05  PS-END-OF-DTL-CSR-SW        PIC X(01) VALUE 'N'.         01100000
011100         88  PS-END-OF-DTL-CSR                 VALUE 'Y'.         01110000
011200     05  PS-CURSOR-HAS-DATA-SW       PIC X(01) VALUE 'N'.         01120000
011300         88  PS-CURSOR-HAS-DATA                VALUE 'Y'.         01130000
011400         88  PS-CURSOR-HAS-NO-DATA             VALUE 'N'.         01140000
011500     05  PS-TABLE-LOOP-DONE-SW       PIC X(01) VALUE 'N'.         01150000
011600         88  PS-TABLE-LOOP-DONE                VALUE 'Y'.         01160000
011700         88  PS-TABLE-LOOP-NOT-DONE            VALUE 'N'.         01170000
011800     05  PS-OPEN-SW                  PIC X(01) VALUE 'N'.         01180000
011900         88  PS-OPEN-DID-WORK                  VALUE 'Y'.         01190000
012000         88  PS-OPEN-DID-NOT-WORK              VALUE 'N'.         01200000
012100     05  PS-PO-ON-TPURCHS-SW         PIC X(01) VALUE 'Y'.         01210000
012200         88  PS-PO-ON-TPURCHS                  VALUE 'Y'.         01220000
012300         88  PS-PO-NOT-ON-TPURCHS              VALUE 'N'.         01230000
012400     05  PS-PO-PREV-PACK-PO-SW       PIC X(01) VALUE 'N'.         01240000
012500         88  PS-PO-NOT-PREV-PACK-PO            VALUE 'N'.         01250000
012600         88  PS-PO-PREV-PACK-PO                VALUE 'Y'.         01260000
012700     05  PS-PO-SKU-ON-TPURITM-SW     PIC X(01) VALUE 'Y'.         01270000
012800         88  PS-PO-SKU-ON-TPURITM              VALUE 'Y'.         01280000
012900         88  PS-PO-SKU-NOT-ON-TPURITM          VALUE 'N'.         01290000
013000     05  PS-PO-ON-TPOPRPK-SW         PIC X(01) VALUE 'Y'.         01300000
013100         88  PS-PO-ON-TPOPRPK                  VALUE 'Y'.         01310000
013200         88  PS-PO-NOT-ON-TPOPRPK              VALUE 'N'.         01320000
013300     05  PS-SKU-ON-XLT-SKU-SW        PIC X(01) VALUE 'Y'.         01330000
013400         88  PS-SKU-ON-XLT-SKU                 VALUE 'Y'.         01340000
013500         88  PS-SKU-NOT-ON-XLT-SKU             VALUE 'N'.         01350000
013600     05  PS-SKU-ON-XLT-PK-SW         PIC X(01) VALUE 'Y'.         01360000
013700         88  PS-SKU-ON-XLT-PK                  VALUE 'Y'.         01370000
013800         88  PS-SKU-NOT-ON-XLT-PK              VALUE 'N'.         01380000
013900     05  PS-PO-IS-PREPACK-SW         PIC X(01) VALUE 'Y'.         01390000
014000         88  PS-PO-IS-PREPACK                  VALUE 'Y'.         01400000
014100         88  PS-PO-IS-NOT-PREPACK              VALUE 'N'.         01410000
014200     05  PS-PO-IS-UPDATED-SW         PIC X(01) VALUE 'Y'.         01420000
014300         88  PS-PO-IS-UPDATED                  VALUE 'Y'.         01430000
014400         88  PS-PO-IS-NOT-UPDATED              VALUE 'N'.         01440000
014500     05  PS-SKU-TBL-SW               PIC X(04) VALUE 'SKU '.      01450000
014600         88  PS-SKU-ON-XLT-SKU-TBL             VALUE 'SKU '.      01460000
014700         88  PS-SKU-ON-XLT-PK-TBL              VALUE 'PACK'.      01470000
014800         88  PS-SKU-ON-BOTH-TBL                VALUE 'BOTH'.      01480000
014900         88  PS-SKU-NOT-FOUND                  VALUE 'NFND'.      01490000
015000     05  PS-BAL-FOUND-SW             PIC X(01) VALUE 'Y'.         01500002
015100         88  PS-BAL-FOUND                      VALUE 'Y'.         01510001
015200         88  PS-BAL-NOT-FOUND                  VALUE 'N'.         01520001
015300                                                                  01530000
015400 01  PV-PROGRAM-VARIABLES.                                        01540000
015500     05  PV-PREV-INTR-UPC-ID         PIC S9(9) COMP.              01550000
015600     05  PV-LONG-INTR-UPC-ID         PIC S9(10) COMP.             01560009
015700     05  PV-PREV-LOC-NBR             PIC S9(4) COMP.              01570000
015800     05  PV-PREV-OTBND-TRIP-ID       PIC S9(9) COMP.              01580000
015900     05  PV-PREV-DISP-UPC-ID         PIC  9(9) VALUE 0.           01590000
016000     05  PV-PREV-DISP-LOC-NBR        PIC  9(4) VALUE 0.           01600000
016100     05  PV-DISP-INTR-UPC-ID         PIC  9(10) VALUE 0.          01610009
016200     05  PV-SKU-INTR-UPC-ID          PIC S9(9) COMP.              01620000
016300     05  PV-DISP-LOC-NBR             PIC  9(4) VALUE 0.           01630000
016400     05  PV-DISP-OTBND-TRIP-ID       PIC  9(9) VALUE 0.           01640000
016500     05  PV-INPUT-READ               PIC  9(9) VALUE 0.           01650000
016600     05  PV-INPUT-CHECK-CNT          PIC  9(9) VALUE 0.           01660000
016700     05  PV-INPUT-MATCHED            PIC  9(9) VALUE 0.           01670000
016800     05  PV-INPUT-MATCHED-SECONDS    PIC  9(9) VALUE 0.           01680000
016900     05  PV-MATCHED-DTL-NOT-WRITTEN  PIC  9(9) VALUE 0.           01690000
017000     05  PV-OUTPUT-BAL-WRITTEN       PIC  9(9) VALUE 0.           01700000
017100     05  PV-OUTPUT-DTL-WRITTEN       PIC  9(9) VALUE 0.           01710000
017200     05  PV-OUTPUT-OBTR-WRITTEN      PIC  9(9) VALUE 0.           01720000
017300     05  PV-OUTPUT-SKU-WRITTEN       PIC  9(9) VALUE 0.           01730000
017400     05  PV-OUTPUT-FROM-INPUT        PIC  9(9) VALUE 0.           01740000
017500     05  PV-OUTPUT-WRITTEN           PIC  9(9) VALUE 0.           01750014
017600     05  PV-DIFF-FOUND               PIC  9(9) VALUE 0.           01760000
017700     05  PV-DISPLAY-FIELD            PIC  9(9) VALUE 0.           01770000
017800     05  PV-DISPLAY-FIELD2           PIC  9(9) VALUE 0.           01780000
017900     05  PV-DISPLAY-FIELD3           PIC  9(4) VALUE 0.           01790000
018000     05  PV-DISPLAY-FIELD4           PIC  9(5) VALUE 0.           01800000
018100     05  PV-RECS-WITH-MATCHES-CNT    PIC  9(9) VALUE 0.           01810000
018200     05  PV-TABLE-ROW-SELECT-CNT     PIC  9(9) VALUE 0.           01820000
018300     05  PV-EXTRACT-WRITTEN-CNT      PIC  9(9) VALUE 0.           01830000
018400     05  PV-DTL-CHECK-CNT            PIC  9(9) VALUE 0.           01840001
018500     05  PV-DTL-CHECK-MATCH-CNT      PIC  9(9) VALUE 0.           01850001
018600     05  PV-DTL-CHECK-UNMATCH-CNT    PIC  9(9) VALUE 0.           01860001
018700     05  PV-BAL-NOT-FOUND-CNT        PIC  9(9) VALUE 0.           01870001
018800     05  PV-BAL-NO-DTL-FOUND-CNT     PIC  9(9) VALUE 0.           01880021
018900     05  PV-BAL-NO-DTL-OPEN-CNT      PIC  9(9) VALUE 0.           01890021
019000     05  PV-DISP-DTL-QTY             PIC  ZZZ,ZZ9-.               01900001
019100     05  PV-DISP-BAL-QTY             PIC  ZZZ,ZZ9-.               01910001
019200                                                                  01920002
019300     05  DP-OUT-CNT                  PIC ZZZ,ZZZ,ZZ9              01930002
019400                                               VALUE ZERO.        01940002
019500                                                                  01950000
019600     05  PV-NULL-IND                 PIC S9(4) VALUE ZEROS        01960000
019700                                               COMP SYNC.         01970000
019800                                                                  01980000
019900     05  PV-SPACE-CNTR               PIC 9(04) VALUE 0.           01990000
020000     05  PV-CHAR-CNTR                PIC 9(04) VALUE 0.           02000000
020100     05  PV-CONVERSION-FIELD-9       PIC 9(08) VALUE 0.           02010000
020200                                                                  02020000
020300     05  PV-CC-TIMESTAMP             PIC X(26) VALUE SPACES.      02030000
020400     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACES.      02040000
020500     05  PV-DB2-OPERATION-MSG-1      PIC X(79) VALUE SPACES.      02050000
020600     05  PV-DB2-TABLE-NAME           PIC X(18) VALUE SPACES.      02060000
020700     05  PV-DISPLAY-NTH-MULTIPLE     PIC 9(9)  VALUE 0.           02070000
020800     05  PV-DISPLAY-NTH-REMAINDER    PIC 9(9)  VALUE 0.           02080000
020900     05  PV-SQLCODE                  PIC +999  VALUE ZERO.        02090000
021000                                                                  02100000
021100     05  PV-EVENT-TMST              PIC  X(26).                   02110000
021200     05  FILLER REDEFINES     PV-EVENT-TMST.                      02120000
021300         10 PV-TMST-CC              PIC  9(02).                   02130000
021400         10 PV-TMST-YY              PIC  9(02).                   02140000
021500         10 FILLER                  PIC  X(01).                   02150000
021600         10 PV-TMST-MM              PIC  9(02).                   02160000
021700         10 FILLER                  PIC  X(01).                   02170000
021800         10 PV-TMST-DD              PIC  9(02).                   02180000
021900         10 FILLER                  PIC  X(01).                   02190000
022000         10 PV-TMST-HH              PIC  9(02).                   02200000
022100         10 FILLER                  PIC  X(01).                   02210000
022200         10 PV-TMST-MN              PIC  9(02).                   02220000
022300         10 FILLER                  PIC  X(01).                   02230000
022400         10 PV-TMST-SS              PIC  9(02).                   02240000
022500         10 FILLER                  PIC  X(07).                   02250000
022600                                                                  02260000
022700                                                                  02270000
022800 01  IR-INPUT-RECORD.                                             02280001
022900     05  IR-SKU-NBR                  PIC  9(8).                   02290001
023000     05  IR-FILLER                   PIC  X(72).                  02300001
023100                                                                  02310001
023200 01  DK-DATA-KEY-FIELDS.                                          02320000
023300     05  DK-INTR-UPC-ID              PIC  S9(9)  COMP    VALUE 0. 02330001
023400     05  DK-LOC-NBR                  PIC  S9(4)  COMP    VALUE 0. 02340001
023500     05  DK-OTBND-TRIP-ID            PIC  S9(9)  COMP    VALUE 0. 02350001
023600     05  DK-SKU-INTR-UPC-ID          PIC  S9(9)  COMP    VALUE 0. 02360001
023700     05  DK-SKU-NBR                  PIC  S9(8)V COMP-3  VALUE 0. 02370001
023800                                                                  02380000
023900 01  DM-UNBALANCE-MESSAGE.                                        02390001
024000     05  FILLER                      PIC X(01) VALUE SPACE.       02400001
024100     05  FILLER                      PIC X(22) VALUE              02410011
024200         'UNBALANCE COND - SKU: '.                                02420011
024300     05  DMU-SKU                     PIC 99999999.                02430001
024400     05  FILLER                      PIC X(06) VALUE              02440011
024500         ' STR: '.                                                02450011
024600     05  DMU-STORE                   PIC 9999.                    02460001
024700     05  FILLER                      PIC X(08) VALUE              02470001
024800         ' DTL Q: '.                                              02480001
024900     05  DMU-DTL-QTY                 PIC ZZZ,ZZ9-.                02490001
025000     05  FILLER                      PIC X(08) VALUE              02500001
025100         ' BAL Q: '.                                              02510001
025200     05  DMU-BAL-QTY                 PIC ZZZ,ZZ9-.                02520001
025300     05  FILLER                      PIC X(13) VALUE              02530011
025400         ' INT UPC ID: '.                                         02540011
025500     05  DMU-INTERNAL-UPC            PIC 9999999999.              02550001
025600     05  FILLER                      PIC X(05) VALUE              02560011
025700         ' ON: '.                                                 02570011
025800     05  DMU-LAST-UPDATE-DTE         PIC X(10).                   02580010
025900                                                                  02590010
026000 01  DM-BAL-NOT-FOUND-MESSAGE.                                    02600010
026100     05  FILLER                      PIC X(01) VALUE SPACE.       02610010
026200     05  FILLER                      PIC X(23) VALUE              02620010
026300         'BAL NOT FOUND CONDITION'.                               02630010
026400     05  FILLER                      PIC X(08) VALUE              02640010
026500         ' - SKU: '.                                              02650010
026600     05  DMNF-SKU                     PIC 99999999.               02660010
026700     05  FILLER                      PIC X(08) VALUE              02670010
026800         ' STORE: '.                                              02680010
026900     05  DMNF-STORE                   PIC 9999.                   02690010
027000     05  FILLER                      PIC X(08) VALUE              02700010
027100         ' DTL Q: '.                                              02710010
027200     05  DMNF-DTL-QTY                 PIC ZZZ,ZZ9-.               02720010
027300     05  FILLER                      PIC X(15) VALUE              02730010
027400         ' INTERNAL UPC: '.                                       02740010
027500     05  DMNF-INTERNAL-UPC            PIC 9999999999.             02750010
027600                                                                  02760021
027700 01  DM-DTL-NOT-FOUND-MESSAGE.                                    02770021
027800     05  FILLER                      PIC X(01) VALUE SPACE.       02780021
027900     05  FILLER                      PIC X(23) VALUE              02790021
028000         'DTL NOT FOUND CONDITION'.                               02800021
028100     05  FILLER                      PIC X(08) VALUE              02810021
028200         ' - SKU: '.                                              02820021
028300     05  DMDNF-SKU                    PIC 99999999.               02830021
028400     05  FILLER                      PIC X(08) VALUE              02840021
028500         ' STORE: '.                                              02850021
028600     05  DMDNF-STORE                  PIC 9999.                   02860021
028700     05  FILLER                      PIC X(08) VALUE              02870021
028800         ' BAL Q: '.                                              02880021
028900     05  DMDNF-BAL-QTY                PIC ZZZ,ZZ9-.               02890021
029000     05  FILLER                      PIC X(15) VALUE              02900021
029100         ' INTERNAL UPC: '.                                       02910021
029200     05  DMDNF-INTERNAL-UPC           PIC 9999999999.             02920021
029300     05  FILLER                      PIC X(05) VALUE              02930021
029400         ' ON: '.                                                 02940021
029500     05  DMDNF-LAST-UPDATE-DTE         PIC X(10).                 02950021
029600                                                                  02960021
029700                                                                  02970000
029800 01  ABEND-CODE                      PIC S9(04)                   02980000
029900                                               VALUE ZEROES       02990000
030000                                               COMP SYNC.         03000000
030100                                                                  03010000
030200*---------------------------------------------------------------* 03020000
030300*  DB2 FORMATTED MESSAGE AREA                                     03030000
030400*---------------------------------------------------------------* 03040000
030500     COPY DPWS004.                                                03050000
030600                                                                  03060000
030700                                                                  03070000
030800*---------------------------------------------------------------* 03080014
030900*  PCRD080 COPYBOOK - FILE TO PASS TO PCKUP951                    03090014
031000*---------------------------------------------------------------* 03100014
031100     COPY PCRD080.                                                03110014
031200                                                                  03120014
031300                                                                  03130014
031400*---------------------------------------------------------------* 03140000
031500*    DB2 AREA FOR XLT_SKU                                       * 03150000
031600*---------------------------------------------------------------* 03160000
031700     EXEC SQL                                                     03170000
031800          INCLUDE XLT00003                                        03180000
031900     END-EXEC.                                                    03190000
032000                                                                  03200000
032100*---------------------------------------------------------------* 03210000
032200*    DB2 AREA FOR PCT_TRN_CLSN_BAL                              * 03220000
032300*---------------------------------------------------------------* 03230000
032400     EXEC SQL                                                     03240000
032500          INCLUDE PCT00014                                        03250000
032600     END-EXEC.                                                    03260000
032700                                                                  03270000
032800*---------------------------------------------------------------* 03280000
032900*    DB2 AREA FOR PCT_TRN_CLSN_DTL                              * 03290000
033000*---------------------------------------------------------------* 03300000
033100     EXEC SQL                                                     03310000
033200          INCLUDE PCT00015                                        03320000
033300     END-EXEC.                                                    03330000
033400                                                                  03340000
033500*---------------------------------------------------------------* 03350000
033600*    DB2 AREA FOR COMMUNICATIONS                                * 03360000
033700*---------------------------------------------------------------* 03370000
033800     EXEC SQL                                                     03380000
033900          INCLUDE SQLCA                                           03390000
034000     END-EXEC.                                                    03400000
034100                                                                  03410000
034200*---------------------------------------------------------------* 03420000
034300*  PCT_TRN_CLS_DTL CURSOR                                         03430000
034400*---------------------------------------------------------------* 03440000
034500     EXEC SQL                                                     03450000
034600          DECLARE DTL-CSR CURSOR FOR                              03460000
034700          SELECT B.INTR_UPC_ID                                    03470001
034800               , B.LOC_NBR                                        03480001
034900               , SUM(B.TRN_CLSN_PRCG_QTY)                         03490006
035000            FROM XLT_SKU A                                        03500001
035100               , PCT_TRN_CLSN_DTL B                               03510001
035200            WHERE A.SKU_NBR = :DK-SKU-NBR                         03520001
035300              AND B.INTR_UPC_ID = A.INTR_UPC_ID                   03530001
035400              AND B.TRN_CLSN_CDE = 'SE'                           03540001
035500              AND NOT B.TRN_TYP_CDE IN ('NS','UM','MM','AM','SM') 03550001
035600            GROUP BY B.INTR_UPC_ID, B.LOC_NBR                     03560007
035700            ORDER BY B.INTR_UPC_ID                                03570007
035800                   , B.LOC_NBR                                    03580001
035900     END-EXEC.                                                    03590000
036000                                                                  03600000
036100*---------------------------------------------------------------* 03610021
036200*  PCT_TRN_CLS_BAL QTY <> 0 AND NO DETAIL FOUND                   03620021
036300*---------------------------------------------------------------* 03630021
036400     EXEC SQL                                                     03640021
036500          DECLARE BAL-NO-DTL-CSR CURSOR FOR                       03650021
036600          SELECT B.INTR_UPC_ID                                    03660021
036700               , B.LOC_NBR                                        03670021
036800               , B.TRN_CLSN_QTY                                   03680021
036900               , B.LAST_UPD_DTE                                   03690021
037000            FROM XLT_SKU A                                        03700021
037100               , PCT_TRN_CLSN_BAL B                               03710021
037200            WHERE A.SKU_NBR = :DK-SKU-NBR                         03720021
037300              AND B.INTR_UPC_ID = A.INTR_UPC_ID                   03730021
037400              AND B.TRN_CLSN_CDE = 'SE'                           03740021
037500              AND NOT B.TRN_CLSN_QTY = 0                          03750021
037600              AND NOT EXISTS                                      03760021
037700                  (SELECT *                                       03770021
037800                     FROM PCT_TRN_CLSN_DTL C                      03780021
037900                    WHERE C.INTR_UPC_ID = B.INTR_UPC_ID           03790021
038000                      AND C.LOC_NBR = B.LOC_NBR                   03800021
038100                      AND C.TRN_CLSN_CDE = B.TRN_CLSN_CDE         03810021
038200                      AND NOT C.TRN_TYP_CDE IN                    03820022
038300                          ('NS','UM','MM','AM','SM'))             03830021
038400            ORDER BY B.INTR_UPC_ID                                03840021
038500                   , B.LOC_NBR                                    03850021
038600     END-EXEC.                                                    03860021
038700                                                                  03870021
038800                                                                  03880021
038900 PROCEDURE DIVISION.                                              03890019
039000                                                                  03900000
039100 0000-PROGRAM-MAINLINE.                                           03910000
039200                                                                  03920000
039300     PERFORM 1000-INITIALIZE.                                     03930000
039400                                                                  03940000
039500     PERFORM 2000-PROCESS-INPUT-FILE                              03950000
039600         UNTIL PS-INPUT-EOF.                                      03960000
039700                                                                  03970000
039800     CLOSE INPUT-FILE.                                            03980000
039900     CLOSE OUTPUT-FILE.                                           03990014
040000                                                                  04000000
040100     MOVE PV-INPUT-READ TO PV-DISPLAY-FIELD.                      04010000
040200     DISPLAY 'INPUT RECORDS READ          :  ' PV-DISPLAY-FIELD.  04020000
040300                                                                  04030000
040400     MOVE PV-DTL-CHECK-CNT TO PV-DISPLAY-FIELD.                   04040001
040500     DISPLAY 'DETAIL CURSOR ROWS CHECKED  :  ' PV-DISPLAY-FIELD.  04050001
040600                                                                  04060001
040700     MOVE PV-DTL-CHECK-MATCH-CNT TO PV-DISPLAY-FIELD.             04070001
040800     DISPLAY 'DETAIL CURSOR ROWS MATCHED  :  ' PV-DISPLAY-FIELD.  04080001
040900                                                                  04090001
041000     MOVE PV-DTL-CHECK-UNMATCH-CNT TO PV-DISPLAY-FIELD.           04100001
041100     DISPLAY 'DETAIL CURSOR ROWS UNMATCHED:  ' PV-DISPLAY-FIELD.  04110001
041200                                                                  04120001
041300     MOVE PV-BAL-NOT-FOUND-CNT TO PV-DISPLAY-FIELD.               04130001
041400     DISPLAY 'BALANCE ROW NOT FOUND       :  ' PV-DISPLAY-FIELD.  04140001
041500                                                                  04150014
041600     MOVE PV-BAL-NO-DTL-OPEN-CNT  TO PV-DISPLAY-FIELD.            04160021
041700     DISPLAY 'BAL NO DETAIL CURSOR OPEN   :  ' PV-DISPLAY-FIELD.  04170021
041800                                                                  04180021
041900     MOVE PV-BAL-NO-DTL-FOUND-CNT TO PV-DISPLAY-FIELD.            04190021
042000     DISPLAY 'BAL ENTRY <> 0 AND NO DETAIL:  ' PV-DISPLAY-FIELD.  04200021
042100                                                                  04210021
042200     MOVE PV-OUTPUT-WRITTEN TO PV-DISPLAY-FIELD.                  04220021
042300     DISPLAY 'OUTPUT RECORDS WRITTEN      :  ' PV-DISPLAY-FIELD.  04230021
042400                                                                  04240001
042500     STOP RUN.                                                    04250000
042600                                                                  04260000
042700                                                                  04270000
042800* ************************************************************** *04280000
042900* * INITIALIZATIONS                                            * *04290000
043000* ************************************************************** *04300000
043100 1000-INITIALIZE.                                                 04310000
043200                                                                  04320000
043300     DISPLAY 'START OF PCKUT915'.                                 04330001
043400                                                                  04340001
043500     OPEN  INPUT  INPUT-FILE.                                     04350000
043600     OPEN  OUTPUT OUTPUT-FILE.                                    04360014
043700                                                                  04370000
043800     MOVE ',' TO PC080-COMMA-01                                   04380014
043900                 PC080-COMMA-02                                   04390014
044000                 PC080-COMMA-03                                   04400014
044100                 PC080-COMMA-04                                   04410014
044200                 PC080-COMMA-05.                                  04420014
044300                                                                  04430014
044400     PERFORM 9050-READ-INPUT-FILE.                                04440000
044500                                                                  04450000
044600 2000-PROCESS-INPUT-FILE.                                         04460000
044700                                                                  04470000
044800     MOVE IR-SKU-NBR  TO DK-SKU-NBR.                              04480001
044900     PERFORM 3000-GET-DATA.                                       04490001
045000                                                                  04500019
045100     PERFORM 9050-READ-INPUT-FILE.                                04510000
045200                                                                  04520000
045300 3000-GET-DATA.                                                   04530000
045400                                                                  04540000
045500*    DISPLAY 'PERFORMING 3000-GET-DATA'.                          04550017
045600                                                                  04560016
045700     PERFORM 3100-OPEN-DTL-CSR.                                   04570001
045800                                                                  04580000
045900     MOVE 'N' TO PS-END-OF-DTL-CSR-SW.                            04590001
046000     PERFORM 3200-PROCESS-CSR                                     04600000
046100       UNTIL  PS-END-OF-DTL-CSR.                                  04610001
046200                                                                  04620000
046300     PERFORM 3400-CLOSE-DTL-CSR.                                  04630001
046400                                                                  04640000
046500     PERFORM 4100-OPEN-BAL-NO-DTL-CSR.                            04650021
046600                                                                  04660021
046700     MOVE 'N' TO PS-END-OF-BAL-CSR-SW.                            04670021
046800     PERFORM 4200-PROCESS-BAL-NO-DTL-CSR                          04680021
046900       UNTIL  PS-END-OF-BAL-CSR.                                  04690021
047000                                                                  04700021
047100     PERFORM 4400-CLOSE-BAL-NO-DTL-CSR.                           04710021
047200                                                                  04720021
047300 3100-OPEN-DTL-CSR.                                               04730001
047400                                                                  04740000
047500*    DISPLAY 'PERFORMING 3100-OPEN-DTL-CSR'.                      04750017
047600                                                                  04760016
047700     EXEC SQL                                                     04770000
047800         OPEN DTL-CSR                                             04780001
047900     END-EXEC.                                                    04790000
048000                                                                  04800000
048100     EVALUATE TRUE                                                04810000
048200         WHEN SQLCODE = ZERO                                      04820000
048300             CONTINUE                                             04830000
048400         WHEN SQLWARN0 NOT = SPACE                                04840000
048500         WHEN SQLCODE < ZERO                                      04850000
048600         WHEN SQLCODE > ZERO                                      04860000
048700          DISPLAY 'SKU NUMBER:  ' IR-SKU-NBR                      04870001
048800          MOVE '3100-OPEN-DTL-CSR'                                04880001
048900                             TO PV-PARAGRAPH-NAME                 04890000
049000          MOVE 'OPEN DTL-CSR'                                     04900001
049100                             TO PV-DB2-OPERATION-MSG-1            04910000
049200          MOVE 'PCT_TRN_CLSN_DTL'                                 04920001
049300                             TO PV-DB2-TABLE-NAME                 04930000
049400          PERFORM 9999-DB2-ABEND                                  04940000
049500     END-EVALUATE.                                                04950000
049600                                                                  04960000
049700 3200-PROCESS-CSR.                                                04970000
049800                                                                  04980000
049900*    DISPLAY 'PERFORMING 3200-PROCESS-CSR'.                       04990017
050000                                                                  05000016
050100     PERFORM 3300-FETCH-DTL-CSR.                                  05010001
050200                                                                  05020000
050300     IF  PS-END-OF-DTL-CSR                                        05030001
050400         CONTINUE                                                 05040000
050500     ELSE                                                         05050000
050600         SET PS-BAL-FOUND TO TRUE                                 05060001
050700         PERFORM 3500-SELECT-BAL                                  05070001
050800         IF  PS-BAL-NOT-FOUND                                     05080001
050900             ADD +1 TO PV-DTL-CHECK-CNT                           05090001
051000                       PV-BAL-NOT-FOUND-CNT                       05100001
051100             MOVE IR-SKU-NBR TO DMNF-SKU                          05110001
051200             MOVE PCT00015-INTR-UPC-ID TO                         05120001
051300                  PV-LONG-INTR-UPC-ID                             05130009
051400             MOVE PV-LONG-INTR-UPC-ID TO                          05140009
051500                  DMNF-INTERNAL-UPC                               05150001
051600             MOVE PCT00015-LOC-NBR TO                             05160001
051700                  PV-DISP-LOC-NBR                                 05170001
051800                  DMNF-STORE                                      05180001
051900             MOVE PCT00015-TRN-CLSN-PRCG-QTY TO                   05190001
052000                  PV-DISP-DTL-QTY                                 05200001
052100                  DMNF-DTL-QTY                                    05210001
052200             DISPLAY DM-BAL-NOT-FOUND-MESSAGE                     05220001
052300         ELSE                                                     05230001
052400             IF  PCT00014-TRN-CLSN-QTY =                          05240001
052500                 PCT00015-TRN-CLSN-PRCG-QTY                       05250001
052600                 ADD +1 TO PV-DTL-CHECK-CNT                       05260001
052700                           PV-DTL-CHECK-MATCH-CNT                 05270001
052800             ELSE                                                 05280001
052900                 ADD +1 TO PV-DTL-CHECK-CNT                       05290001
053000                           PV-DTL-CHECK-UNMATCH-CNT               05300001
053100                 MOVE IR-SKU-NBR TO DMU-SKU                       05310001
053200                 MOVE PCT00015-INTR-UPC-ID TO                     05320001
053300                      PV-LONG-INTR-UPC-ID                         05330009
053400                      PC080-INTR-UPC-ID-KEY                       05340015
053500                 MOVE PV-LONG-INTR-UPC-ID TO                      05350009
053600                      DMU-INTERNAL-UPC                            05360001
053700                      PC080-INTR-UPC-ID                           05370015
053800                 MOVE PCT00015-LOC-NBR TO                         05380001
053900                      PV-DISP-LOC-NBR                             05390001
054000                      DMU-STORE                                   05400001
054100                      PC080-LOC-NBR                               05410015
054200                 MOVE PCT00015-TRN-CLSN-PRCG-QTY TO               05420001
054300                      PV-DISP-DTL-QTY                             05430001
054400                      DMU-DTL-QTY                                 05440001
054500                 MOVE PCT00014-TRN-CLSN-QTY TO                    05450001
054600                      PV-DISP-BAL-QTY                             05460001
054700                      DMU-BAL-QTY                                 05470001
054800                 MOVE PCT00014-LAST-UPD-DTE TO                    05480010
054900                      DMU-LAST-UPDATE-DTE                         05490010
055000                 DISPLAY DM-UNBALANCE-MESSAGE                     05500001
055100                 MOVE 'SE'                  TO                    05510014
055200                      PC080-TRN-CLSN-CDE                          05520014
055300                 MOVE '2000-01-01'          TO                    05530015
055400                      PC080-PURGE-DATE                            05540014
055500                 PERFORM 9000-WRITE-OUTPUT                        05550015
055600             END-IF                                               05560001
055700         END-IF                                                   05570001
055800     END-IF.                                                      05580000
055900                                                                  05590000
056000 3300-FETCH-DTL-CSR.                                              05600001
056100                                                                  05610000
056200*    DISPLAY 'PERFORMING 3300-FETCH-DTL-CSR'.                     05620017
056300                                                                  05630016
056400     EXEC SQL                                                     05640000
056500         FETCH  DTL-CSR                                           05650001
056600          INTO  :PCT00015-INTR-UPC-ID                             05660001
056700             ,  :PCT00015-LOC-NBR                                 05670001
056800             ,  :PCT00015-TRN-CLSN-PRCG-QTY                       05680001
056900     END-EXEC.                                                    05690000
057000                                                                  05700000
057100     EVALUATE TRUE                                                05710000
057200         WHEN SQLCODE = ZERO                                      05720000
057300             CONTINUE                                             05730000
057400         WHEN SQLCODE = +100                                      05740000
057500             SET PS-END-OF-DTL-CSR    TO  TRUE                    05750001
057600         WHEN SQLWARN0 NOT = SPACE                                05760000
057700         WHEN SQLCODE < ZERO                                      05770000
057800         WHEN SQLCODE > ZERO                                      05780000
057900          DISPLAY 'SKU NUMBER:  ' IR-SKU-NBR                      05790001
058000          MOVE PCT00015-INTR-UPC-ID TO PV-LONG-INTR-UPC-ID        05800009
058100          MOVE PV-LONG-INTR-UPC-ID TO PV-DISP-INTR-UPC-ID         05810009
058200          MOVE DK-LOC-NBR     TO PV-DISP-LOC-NBR                  05820000
058300          DISPLAY 'INTR UPC ID: ' PV-DISP-INTR-UPC-ID             05830000
058400          DISPLAY 'LOC NBR    : ' PV-DISP-LOC-NBR                 05840000
058500          MOVE '3300-FETCH-DTL-CSR'                               05850001
058600                             TO PV-PARAGRAPH-NAME                 05860000
058700          MOVE 'FETCH DTL-CSR'                                    05870001
058800                             TO PV-DB2-OPERATION-MSG-1            05880000
058900          MOVE 'PCT_TRN_CLSN_DTL'                                 05890001
059000                             TO PV-DB2-TABLE-NAME                 05900000
059100          PERFORM 9999-DB2-ABEND                                  05910000
059200     END-EVALUATE.                                                05920000
059300                                                                  05930000
059400 3400-CLOSE-DTL-CSR.                                              05940001
059500                                                                  05950000
059600     EXEC SQL                                                     05960000
059700         CLOSE DTL-CSR                                            05970001
059800     END-EXEC.                                                    05980000
059900                                                                  05990000
060000     EVALUATE TRUE                                                06000000
060100         WHEN SQLCODE = ZERO                                      06010000
060200             CONTINUE                                             06020000
060300         WHEN SQLWARN0 NOT = SPACE                                06030000
060400         WHEN SQLCODE < ZERO                                      06040000
060500         WHEN SQLCODE > ZERO                                      06050000
060600          DISPLAY 'SKU NUMBER:  ' IR-SKU-NBR                      06060001
060700          MOVE PCT00015-INTR-UPC-ID TO PV-LONG-INTR-UPC-ID        06070009
060800          MOVE PV-LONG-INTR-UPC-ID TO PV-DISP-INTR-UPC-ID         06080009
060900          MOVE DK-LOC-NBR     TO PV-DISP-LOC-NBR                  06090000
061000          DISPLAY 'INTR UPC ID: ' PV-DISP-INTR-UPC-ID             06100000
061100          DISPLAY 'LOC NBR    : ' PV-DISP-LOC-NBR                 06110000
061200          MOVE '3400-CLOSE-DTL-CSR'                               06120001
061300                             TO PV-PARAGRAPH-NAME                 06130000
061400          MOVE 'CLOSE DTL-CSR'                                    06140001
061500                             TO PV-DB2-OPERATION-MSG-1            06150000
061600          MOVE 'PCT_TRN_CLSN_DTL'                                 06160001
061700                             TO PV-DB2-TABLE-NAME                 06170000
061800          PERFORM 9999-DB2-ABEND                                  06180000
061900     END-EVALUATE.                                                06190000
062000                                                                  06200000
062100 3500-SELECT-BAL.                                                 06210001
062200                                                                  06220001
062300*    DISPLAY 'PERFORMING 3500-SELECT-BAL'.                        06230017
062400                                                                  06240016
062500     MOVE PCT00015-INTR-UPC-ID TO                                 06250001
062600          PCT00014-INTR-UPC-ID.                                   06260001
062700     MOVE PCT00015-LOC-NBR     TO                                 06270001
062800          PCT00014-LOC-NBR.                                       06280001
062900                                                                  06290001
063000     EXEC SQL                                                     06300001
063100         SELECT TRN_CLSN_QTY                                      06310001
063200              , LAST_UPD_DTE                                      06320010
063300           INTO :PCT00014-TRN-CLSN-QTY                            06330001
063400              , :PCT00014-LAST-UPD-DTE                            06340010
063500           FROM  PCT_TRN_CLSN_BAL                                 06350001
063600          WHERE INTR_UPC_ID = :PCT00014-INTR-UPC-ID               06360001
063700            AND LOC_NBR     = :PCT00014-LOC-NBR                   06370001
063800            AND TRN_CLSN_CDE = 'SE'                               06380001
063900     END-EXEC.                                                    06390001
064000                                                                  06400001
064100     EVALUATE TRUE                                                06410001
064200         WHEN SQLCODE = ZERO                                      06420001
064300              CONTINUE                                            06430001
064400         WHEN SQLCODE = +100                                      06440001
064500              SET PS-BAL-NOT-FOUND TO TRUE                        06450001
064600         WHEN SQLWARN0 NOT = SPACE                                06460001
064700         WHEN SQLCODE < ZERO                                      06470001
064800         WHEN SQLCODE > ZERO                                      06480001
064900          MOVE PCT00014-INTR-UPC-ID TO PV-LONG-INTR-UPC-ID        06490009
065000          MOVE PV-LONG-INTR-UPC-ID TO PV-DISP-INTR-UPC-ID         06500009
065100          MOVE DK-LOC-NBR     TO PV-DISP-LOC-NBR                  06510001
065200          DISPLAY 'INTR UPC ID: ' PV-DISP-INTR-UPC-ID             06520001
065300          DISPLAY 'LOC NBR    : ' PV-DISP-LOC-NBR                 06530001
065400          MOVE '3500-SELECT-BAL'                                  06540001
065500                             TO PV-PARAGRAPH-NAME                 06550001
065600          MOVE 'SELECT PCT_TRN_CLSN_BAL'                          06560001
065700                             TO PV-DB2-OPERATION-MSG-1            06570001
065800          MOVE 'PCT_TRN_CLSN_BAL'                                 06580001
065900                             TO PV-DB2-TABLE-NAME                 06590001
066000          PERFORM 9999-DB2-ABEND                                  06600001
066100     END-EVALUATE.                                                06610001
066200                                                                  06620001
066300 4100-OPEN-BAL-NO-DTL-CSR.                                        06630021
066400                                                                  06640021
066500*    DISPLAY 'PERFORMING 4100-OPEN-BAL-NO-DTL-CSR'.               06650021
066600                                                                  06660021
066700     ADD +1 TO PV-BAL-NO-DTL-OPEN-CNT.                            06670021
066800                                                                  06680021
066900     EXEC SQL                                                     06690021
067000         OPEN BAL-NO-DTL-CSR                                      06700021
067100     END-EXEC.                                                    06710021
067200                                                                  06720021
067300     EVALUATE TRUE                                                06730021
067400         WHEN SQLCODE = ZERO                                      06740021
067500             CONTINUE                                             06750021
067600         WHEN SQLWARN0 NOT = SPACE                                06760021
067700         WHEN SQLCODE < ZERO                                      06770021
067800         WHEN SQLCODE > ZERO                                      06780021
067900          DISPLAY 'SKU NUMBER:  ' IR-SKU-NBR                      06790021
068000          MOVE '4100-OPEN-BAL-NO-DTL-CSR'                         06800021
068100                             TO PV-PARAGRAPH-NAME                 06810021
068200          MOVE 'OPEN BAL-NO-DTL-CSR'                              06820021
068300                             TO PV-DB2-OPERATION-MSG-1            06830021
068400          MOVE 'PCT_TRN_CLSN_BAL'                                 06840021
068500                             TO PV-DB2-TABLE-NAME                 06850021
068600          PERFORM 9999-DB2-ABEND                                  06860021
068700     END-EVALUATE.                                                06870021
068800                                                                  06880021
068900 4200-PROCESS-BAL-NO-DTL-CSR.                                     06890021
069000                                                                  06900021
069100*    DISPLAY 'PERFORMING 4200-PROCESS-BAL-NO-DTL-CSR'.            06910021
069200                                                                  06920021
069300     PERFORM 4300-FETCH-BAL-NO-DTL-CSR.                           06930021
069400                                                                  06940021
069500     IF  PS-END-OF-BAL-CSR                                        06950021
069600         CONTINUE                                                 06960021
069700     ELSE                                                         06970021
069800         ADD +1 TO PV-BAL-NO-DTL-FOUND-CNT                        06980023
069900         MOVE IR-SKU-NBR TO DMDNF-SKU                             06990021
070000         MOVE PCT00014-INTR-UPC-ID TO                             07000021
070100              PV-LONG-INTR-UPC-ID                                 07010021
070110              PC080-INTR-UPC-ID-KEY                               07011024
070200         MOVE PV-LONG-INTR-UPC-ID TO                              07020021
070300              DMDNF-INTERNAL-UPC                                  07030021
070400              PC080-INTR-UPC-ID                                   07040021
070500         MOVE PCT00014-LOC-NBR TO                                 07050021
070600              PV-DISP-LOC-NBR                                     07060021
070700              DMDNF-STORE                                         07070021
070800              PC080-LOC-NBR                                       07080021
070900         MOVE PCT00014-TRN-CLSN-QTY TO                            07090021
071000              PV-DISP-BAL-QTY                                     07100021
071100              DMDNF-BAL-QTY                                       07110021
071200         MOVE PCT00014-LAST-UPD-DTE TO                            07120021
071300              DMDNF-LAST-UPDATE-DTE                               07130021
071400         DISPLAY DM-DTL-NOT-FOUND-MESSAGE                         07140021
071500         MOVE 'SE'                  TO                            07150021
071600              PC080-TRN-CLSN-CDE                                  07160021
071700         MOVE '2000-01-01'          TO                            07170021
071800              PC080-PURGE-DATE                                    07180021
071900         PERFORM 9000-WRITE-OUTPUT                                07190021
072000     END-IF.                                                      07200021
072100                                                                  07210021
072200 4300-FETCH-BAL-NO-DTL-CSR.                                       07220021
072300                                                                  07230021
072400*    DISPLAY 'PERFORMING 4300-FETCH-BAL-NO-DTL-CSR'.              07240021
072500                                                                  07250021
072600     EXEC SQL                                                     07260021
072700         FETCH  BAL-NO-DTL-CSR                                    07270021
072800          INTO  :PCT00014-INTR-UPC-ID                             07280021
072900             ,  :PCT00014-LOC-NBR                                 07290021
073000             ,  :PCT00014-TRN-CLSN-QTY                            07300021
073100             ,  :PCT00014-LAST-UPD-DTE                            07310021
073200     END-EXEC.                                                    07320021
073300                                                                  07330021
073400     EVALUATE TRUE                                                07340021
073500         WHEN SQLCODE = ZERO                                      07350021
073600             CONTINUE                                             07360021
073700         WHEN SQLCODE = +100                                      07370021
073800             SET PS-END-OF-BAL-CSR    TO  TRUE                    07380021
073900         WHEN SQLWARN0 NOT = SPACE                                07390021
074000         WHEN SQLCODE < ZERO                                      07400021
074100         WHEN SQLCODE > ZERO                                      07410021
074200          DISPLAY 'SKU NUMBER:  ' IR-SKU-NBR                      07420021
074300          MOVE PCT00014-INTR-UPC-ID TO PV-LONG-INTR-UPC-ID        07430021
074400          MOVE PV-LONG-INTR-UPC-ID TO PV-DISP-INTR-UPC-ID         07440021
074500          MOVE DK-LOC-NBR     TO PV-DISP-LOC-NBR                  07450021
074600          DISPLAY 'INTR UPC ID: ' PV-DISP-INTR-UPC-ID             07460021
074700          DISPLAY 'LOC NBR    : ' PV-DISP-LOC-NBR                 07470021
074800          MOVE '4300-FETCH-BAL-NO-DTL-CSR'                        07480021
074900                             TO PV-PARAGRAPH-NAME                 07490021
075000          MOVE 'FETCH BAL-NO-DTL-CSR'                             07500021
075100                             TO PV-DB2-OPERATION-MSG-1            07510021
075200          MOVE 'PCT_TRN_CLSN_BAL'                                 07520021
075300                             TO PV-DB2-TABLE-NAME                 07530021
075400          PERFORM 9999-DB2-ABEND                                  07540021
075500     END-EVALUATE.                                                07550021
075600                                                                  07560021
075700 4400-CLOSE-BAL-NO-DTL-CSR.                                       07570021
075800                                                                  07580021
075900     EXEC SQL                                                     07590021
076000         CLOSE BAL-NO-DTL-CSR                                     07600022
076100     END-EXEC.                                                    07610021
076200                                                                  07620021
076300     EVALUATE TRUE                                                07630021
076400         WHEN SQLCODE = ZERO                                      07640021
076500             CONTINUE                                             07650021
076600         WHEN SQLWARN0 NOT = SPACE                                07660021
076700         WHEN SQLCODE < ZERO                                      07670021
076800         WHEN SQLCODE > ZERO                                      07680021
076900          DISPLAY 'SKU NUMBER:  ' IR-SKU-NBR                      07690021
077000          MOVE PCT00014-INTR-UPC-ID TO PV-LONG-INTR-UPC-ID        07700021
077100          MOVE PV-LONG-INTR-UPC-ID TO PV-DISP-INTR-UPC-ID         07710021
077200          MOVE DK-LOC-NBR     TO PV-DISP-LOC-NBR                  07720021
077300          DISPLAY 'INTR UPC ID: ' PV-DISP-INTR-UPC-ID             07730021
077400          DISPLAY 'LOC NBR    : ' PV-DISP-LOC-NBR                 07740021
077500          MOVE '4400-CLOSE-BAL-NO-DTL-CSR'                        07750021
077600                             TO PV-PARAGRAPH-NAME                 07760021
077700          MOVE 'CLOSE BAL-NO-DTL-CSR'                             07770021
077800                             TO PV-DB2-OPERATION-MSG-1            07780021
077900          MOVE 'PCT_TRN_CLSN_BAL'                                 07790021
078000                             TO PV-DB2-TABLE-NAME                 07800021
078100          PERFORM 9999-DB2-ABEND                                  07810021
078200     END-EVALUATE.                                                07820021
078300 9000-WRITE-OUTPUT.                                               07830015
078400                                                                  07840015
078500*    DISPLAY 'PERFORMING 9000-WRITE-OUTPUT'.                      07850017
078600                                                                  07860016
078700     WRITE OUTPUT-RECORD                                          07870015
078800      FROM PC080-INTRNST-PURGE-REC.                               07880015
078900                                                                  07890015
079000     ADD  1  TO  PV-OUTPUT-WRITTEN.                               07900015
079100                                                                  07910015
079200 9050-READ-INPUT-FILE.                                            07920015
079300                                                                  07930000
079400*    DISPLAY 'EXECUTING 9050-READ-INPUT-FILE'.                    07940018
079500*    DISPLAY 'READ COUNT IS:  '  PV-INPUT-READ.                   07950018
079600                                                                  07960016
079700     READ INPUT-FILE                                              07970000
079800          INTO IR-INPUT-RECORD                                    07980001
079900          AT END                                                  07990000
080000              SET PS-INPUT-EOF TO TRUE.                           08000000
080100                                                                  08010000
080200     IF PS-INPUT-EOF                                              08020000
080300         CONTINUE                                                 08030000
080400     ELSE                                                         08040000
080500         ADD +1 TO PV-INPUT-READ                                  08050000
080600                   PV-INPUT-CHECK-CNT                             08060000
080700         IF  PV-INPUT-CHECK-CNT = 200                             08070020
080800             MOVE PV-INPUT-READ TO                                08080000
080900                  DP-OUT-CNT                                      08090000
081000             DISPLAY 'PROGRAM PROGRESS READS: '                   08100000
081100                     DP-OUT-CNT                                   08110000
081200             MOVE +0 TO PV-INPUT-CHECK-CNT                        08120000
081300         END-IF                                                   08130000
081400     END-IF.                                                      08140000
081500                                                                  08150000
081600                                                                  08160000
081700* ************************************************************** *08170000
081800* * DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT *08180000
081900* * AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN          * *08190000
082000* * SQL ERROR OR WARNING CODE OCCURS.                          * *08200000
082100* ************************************************************** *08210000
082200 9999-DB2-ABEND.                                                  08220000
082300                                                                  08230000
082400     DISPLAY PC-CURRENT-PROGRAM-NAME                              08240000
082500             ' 9999-DB2-ABEND'.                                   08250000
082600     DISPLAY PC-CURRENT-PROGRAM-NAME                              08260000
082700             ' ** ABEND           **'.                            08270000
082800     DISPLAY PC-CURRENT-PROGRAM-NAME                              08280000
082900             ' ** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.       08290000
083000     DISPLAY PC-CURRENT-PROGRAM-NAME                              08300000
083100             ' ** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME.       08310000
083200     DISPLAY PC-CURRENT-PROGRAM-NAME                              08320000
083300             ' ** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.  08330000
083400                                                                  08340000
083500     DISPLAY PC-CURRENT-PROGRAM-NAME                              08350000
083600             ' ** SQLCODE         ** = ' SQLCODE.                 08360000
083700     MOVE SQLCODE TO PV-SQLCODE.                                  08370000
083800     DISPLAY PC-CURRENT-PROGRAM-NAME                              08380000
083900             ' ** PV-SQLCODE      ** = ' PV-SQLCODE '.'.          08390000
084000                                                                  08400000
084100     DISPLAY PC-CURRENT-PROGRAM-NAME                              08410000
084200             ' ** SQLWARN0        ** = ' SQLWARN0 '.'.            08420000
084300                                                                  08430000
084400                                                                  08440000
084500*----------------------------------------------------------------*08450000
084600* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *08460000
084700* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *08470000
084800* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *08480000
084900* FORMAT.                                                        *08490000
085000*----------------------------------------------------------------*08500000
085100     COPY DPPD004.                                                08510000
085200                                                                  08520000
085300                                                                  08530000
085400*----------------------------------------------------------------*08540000
085500* CALL ABEND                                                     *08550000
085600*----------------------------------------------------------------*08560000
085700     MOVE +4013                  TO ABEND-CODE.                   08570000
085800     CALL 'ILBOABN0' USING ABEND-CODE.                            08580000
085900*                                                                 08590000
