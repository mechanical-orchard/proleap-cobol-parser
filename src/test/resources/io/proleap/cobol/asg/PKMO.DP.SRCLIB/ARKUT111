000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             ARKUT111.                                00050000
000600 AUTHOR.                 COGNIZANT.                               00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN.           JUNE 2014.                               00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
002100******************************************************************00120000
002101*  06/04/2014 COGNIZANT - SPLIT THE FILE INTO TWO FILES.          00130000
002101*       ONE FILE PROCESS THRU SBS & AJB                           00140000
002101*       OTHER FILE PROCESS THRU EXISTING PROCESS                  00150000
002103******************************************************************00160000
CFEES *  02/01/2017 BARB SCHULTZ - INCREASED THE RECORD SIZE OF THE     00161003
CFEES *       INPUT FILE AND SBS FILE TO 385 FOR THE SALES TAX          00162003
CFEES *       COMPLIANCE PROJECT.                                       00163003
CFEES ******************************************************************00164003
CFEES ******************************************************************00170003
002118 ENVIRONMENT DIVISION.                                            00180000
002119******************************************************************00190000
002120                                                                  00200000
002121 CONFIGURATION SECTION.                                           00210000
002122                                                                  00220000
002123 SOURCE-COMPUTER.        IBM-3090.                                00230000
002124 OBJECT-COMPUTER.        IBM-3090.                                00240000
002125                                                                  00250000
002130 INPUT-OUTPUT SECTION.                                            00260000
002140                                                                  00270000
002150 FILE-CONTROL.                                                    00280000
002160                                                                  00290000
002170     SELECT AR-TRANSACTION-FILE                                   00300000
002180         ASSIGN TO INP01.                                         00310000
002190                                                                  00320000
002500     SELECT AR-TRANS-FILE-SBS                                     00330000
002600         ASSIGN TO OUT01.                                         00340000
002700                                                                  00350000
002200     SELECT AR-TRANS-FILE-COSA                                    00360000
002300         ASSIGN TO OUT02.                                         00370000
002400                                                                  00380000
005200******************************************************************00390000
005300 DATA DIVISION.                                                   00400000
005400******************************************************************00410000
005500                                                                  00420000
005600 FILE SECTION.                                                    00430000
005700                                                                  00440000
005800 FD  AR-TRANSACTION-FILE                                          00450000
005900     RECORDING MODE IS F                                          00460000
006000     LABEL RECORDS ARE STANDARD                                   00470000
006100     BLOCK CONTAINS 0 RECORDS                                     00480000
CFEES      RECORD CONTAINS 385 CHARACTERS                               00490001
006300     DATA RECORD IS AT-AR-TRANSACTION-RECORD.                     00500000
006400                                                                  00510000
CFEES  01  AT-AR-TRANSACTION-RECORD    PIC X(385).                      00520001
000132                                                                  00530000
008400 FD  AR-TRANS-FILE-SBS                                            00540000
008500     RECORDING MODE IS F                                          00550000
008600     LABEL RECORDS ARE STANDARD                                   00560000
008700     BLOCK CONTAINS 0 RECORDS                                     00570000
CFEES      RECORD CONTAINS 385 CHARACTERS.                              00580001
008900                                                                  00590000
CFEES  01  AR-TRANS-RECORD-SBS         PIC X(385).                      00600001
014800                                                                  00610000
007600 FD  AR-TRANS-FILE-COSA                                           00620000
007700     RECORDING MODE IS F                                          00630000
007800     LABEL RECORDS ARE STANDARD                                   00640000
007900     BLOCK CONTAINS 0 RECORDS                                     00650000
008000     RECORD CONTAINS 385 CHARACTERS.                              00660002
008100                                                                  00670000
008200 01  AR-TRANS-RECORD-COSA        PIC X(385).                      00680002
008300                                                                  00690000
014900 WORKING-STORAGE SECTION.                                         00700000
015000                                                                  00710000
015100*                                                                 00720000
015200*  ACCOUNTS RECEIVABLE TRANSACTION FILE RECORD LAYOUT             00730000
015300*                                                                 00740000
015400                                                                  00750000
015500     COPY ARRD001.                                                00760000
015600                                                                  00770000
019800 01  PS-PROGRAM-SWITCHES.                                         00780000
019900     05  PS-END-OF-TRANS-FILE-IND      PIC X(01)    VALUE 'N'.    00790000
020100         88  PS-END-OF-TRANS-FILE                   VALUE 'Y'.    00800000
000189     05  PS-POS-STORE-COND             PIC X(01)    VALUE 'N'.    00810000
000190         88  PS-ONE-POS-STR-TRAN                    VALUE 'N'.    00820000
000191         88  PS-RANGE-POS-STR-TRAN                  VALUE 'Y'.    00830000
000189     05  PS-POS-TRAN-LIMIT             PIC X(01)    VALUE 'N'.    00840000
000190         88  PS-NO-COUNT                            VALUE 'N'.    00850000
000191         88  PS-COUNT                               VALUE 'Y'.    00860000
022900                                                                  00870000
023000 01  PC-PROGRAM-CONSTANTS.                                        00880000
023200     05  PC-CURRENT-PROGRAM-NAME       PIC X(08)    VALUE         00890000
023200                                                   'ARKUT111'.    00900000
022900                                                                  00910000
023000 01  PV-PROGRAM-VARIABLES.                                        00920000
028000     05  PV-SAVE-AREA.                                            00930000
028100         10  PV-SAVE-TRANS-DATE        PIC 9(06)    VALUE ZERO.   00940000
028200         10  PV-SAVE-TRANS-TIME        PIC 9(04)    VALUE ZERO.   00950000
029700         10  PV-SAVE-STORE-NMBR        PIC 9(04)    VALUE ZERO.   00960000
028300         10  PV-SAVE-TERM-NUM          PIC X(04)    VALUE SPACES. 00970000
028400         10  PV-SAVE-TRANS-NUM         PIC X(04)    VALUE SPACES. 00980000
028500         10  PV-SAVE-TNDR-SEQ-NBR      PIC S9(04)   VALUE ZERO    00990000
028600                                                    COMP.         01000000
028700         10  PV-SAVE-TRANS-SOURCE      PIC X(01)    VALUE SPACES. 01010000
028600         10  PV-SAVE-ORD-NBR           PIC X(40)    VALUE SPACES. 01020000
028700                                                                  01030000
030800     05  PV-ECOMM-TRN-CNTR       PIC 9(4)     VALUE ZERO.         01040000
030800     05  PV-POS-STR-TRN-CNTR     PIC 9(4)     VALUE ZERO.         01050000
024400     05  PV-INPUT-RCDS-READ      PIC S9(11)   VALUE 0 COMP-3.     01060000
024400     05  PV-SBS-FILE-COUNT       PIC S9(11)   VALUE 0 COMP-3.     01070000
024400     05  PV-COSA-FILE-COUNT      PIC S9(11)   VALUE 0 COMP-3.     01080000
025500                                                                  01090000
000156 01  CC-PARAMETERS.                                               01100000
000157     05  CC-STORE1                    PIC 9(04)    VALUE ZEROES.  01110000
000157     05  FILLER                       PIC X(01)    VALUE SPACE.   01120000
000161     05  CC-STORE2                    PIC 9(04)    VALUE ZEROES.  01130000
000157     05  FILLER                       PIC X(01)    VALUE SPACE.   01140000
000161     05  CC-POS-CNT-LIMIT             PIC 9(04)    VALUE ZEROES.  01150000
000161     05  FILLER REDEFINES CC-POS-CNT-LIMIT.                       01160000
000161         10 CC-POS-CNT-LIMIT-X        PIC X(04).                  01170000
000157     05  FILLER                       PIC X(01)    VALUE SPACE.   01180000
000162     05  CC-ECOMM-STORE               PIC 9(04)    VALUE ZEROES.  01190000
000157     05  FILLER                       PIC X(01)    VALUE SPACE.   01200000
000162     05  CC-ECOMM-CNT-LIMIT           PIC 9(04)    VALUE ZEROES.  01210000
000157     05  FILLER                       PIC X(61)    VALUE SPACE.   01220000
000163                                                                  01230000
052360******************************************************************01240000
052370 PROCEDURE DIVISION.                                              01250000
052380******************************************************************01260000
052390                                                                  01270000
052400 0000-MAINLINE.                                                   01280000
052500                                                                  01290000
052600     PERFORM 1000-INITIALIZE.                                     01300000
052700                                                                  01310000
           EVALUATE TRUE                                                01320000
077300        WHEN PS-ONE-POS-STR-TRAN AND PS-COUNT                     01330000
      * FEW TRANS FROM ONE POS STORE + FEW ECOMM TRANS                  01340000
                PERFORM 2000-ONE-POS-STR-CNT                            01350000
                 UNTIL PS-END-OF-TRANS-FILE                             01360000
077300        WHEN PS-ONE-POS-STR-TRAN AND PS-NO-COUNT                  01370000
      * ALL TRANS FROM ONE POS STORE + LARGER ECOMM TRANS               01380000
                PERFORM 2100-ONE-POS-STR-ALL                            01390000
                 UNTIL PS-END-OF-TRANS-FILE                             01400000
077300        WHEN PS-RANGE-POS-STR-TRAN AND PS-NO-COUNT                01410000
      * ALL TRANS FROM RANGE OF POS STORES + LARGER ECOMM TRANS         01420000
                PERFORM 2200-RNG-POS-STR-TRAN                           01430000
                 UNTIL PS-END-OF-TRANS-FILE                             01440000
079600     END-EVALUATE.                                                01450000
053000                                                                  01460000
053100     PERFORM 9000-EOJ-ROUTINE.                                    01470000
053200                                                                  01480000
053300     GOBACK.                                                      01490000
053400******************************************************************01500000
053500*  OPEN INOUT AND OUTPUT FILES, ACCEPT CC PARAMAETERS FROM       *01510000
053600*  JCL, VALIDATE WHETHER TRANSACTIONS FROM ONE POS STORE OR      *01520000
053700*  RANGE OF POS STORES AND WHETHER ALL TRANSACTIONS OR SOME COUNT*01530000
053800*  TO BE WRITTEN TO SBS FILE.                                    *01540000
053900******************************************************************01550000
054100 1000-INITIALIZE.                                                 01560000
054200                                                                  01570000
054900     OPEN INPUT  AR-TRANSACTION-FILE                              01580000
055000          OUTPUT AR-TRANS-FILE-COSA                               01590000
055100                 AR-TRANS-FILE-SBS.                               01600000
056600                                                                  01610000
027300     ACCEPT CC-PARAMETERS     FROM SYSIN.                         01620000
027400                                                                  01630000
           IF CC-STORE1 = ZERO                                          01640000
             SET PS-ONE-POS-STR-TRAN TO TRUE                            01650000
           ELSE                                                         01660000
             SET PS-RANGE-POS-STR-TRAN TO TRUE                          01670000
           END-IF.                                                      01680000
                                                                        01690000
           IF CC-POS-CNT-LIMIT-X = ' ALL'                               01700000
             SET PS-NO-COUNT  TO TRUE                                   01710000
           ELSE                                                         01720000
             SET PS-COUNT TO TRUE                                       01730000
           END-IF.                                                      01740000
                                                                        01750000
056700     PERFORM 4000-READ-TRANSACTION-FILE.                          01760000
076870                                                                  01770000
076880******************************************************************01780000
076890* FEW TRANSACTIONS FROM ONE POS STORE + FEW ECOMM TRANSACTIONS   *01790000
076890* PASS TO SBS FILE AND REMAINING TRANSACTIONS PASS TO COSA FILE  *01800000
076900******************************************************************01810000
077100 2000-ONE-POS-STR-CNT.                                            01820000
077200                                                                  01830000
           EVALUATE TRUE                                                01840000
077300        WHEN AR001-STORE-NUMBER = CC-STORE2 AND                   01850000
077300             PV-POS-STR-TRN-CNTR <= CC-POS-CNT-LIMIT              01860000
                 PERFORM 2300-POS-STR-TRANS                             01870000
077300        WHEN AR001-STORE-NUMBER = CC-ECOMM-STORE AND              01880000
077300             PV-ECOMM-TRN-CNTR <= CC-ECOMM-CNT-LIMIT              01890000
                 PERFORM 2400-ECOMM-STR-TRANS                           01900000
077300        WHEN OTHER                                                01910000
                 PERFORM 5100-WRITE-COSA-FILE                           01920000
079600     END-EVALUATE.                                                01930000
077200                                                                  01940000
079800     PERFORM 4100-SAVE-TRAN-KEYS.                                 01950000
079800     PERFORM 4000-READ-TRANSACTION-FILE.                          01960000
077200                                                                  01970000
076880******************************************************************01980000
076890* ALL TRANSACTIONS FROM ONE POS STORE + FEW ECOMM TRANSACTIONS   *01990000
076890* PASS TO SBS FILE AND REMAINING TRANSACTIONS PASS TO COSA FILE  *02000000
076900******************************************************************02010000
077100 2100-ONE-POS-STR-ALL.                                            02020000
077200                                                                  02030000
           EVALUATE TRUE                                                02040000
077300        WHEN AR001-STORE-NUMBER = CC-STORE2                       02050000
077400          PERFORM 5000-WRITE-SBS-FILE                             02060000
077300        WHEN AR001-STORE-NUMBER = CC-ECOMM-STORE AND              02070000
077300             PV-ECOMM-TRN-CNTR <= CC-ECOMM-CNT-LIMIT              02080000
                 PERFORM 2400-ECOMM-STR-TRANS                           02090000
077300        WHEN OTHER                                                02100000
                 PERFORM 5100-WRITE-COSA-FILE                           02110000
079600     END-EVALUATE.                                                02120000
077200                                                                  02130000
079800     PERFORM 4100-SAVE-TRAN-KEYS.                                 02140000
079800     PERFORM 4000-READ-TRANSACTION-FILE.                          02150000
077200                                                                  02160000
076880******************************************************************02170000
076890* ALL TRANSACTIONS FROM RANGE OF POS STORES + FEW ECOMM TRANS    *02180000
076890* PASS TO SBS FILE AND REMAINING TRANSACTIONS PASS TO COSA FILE  *02190000
076900******************************************************************02200000
077100 2200-RNG-POS-STR-TRAN.                                           02210000
 77200                                                                  02220000
           EVALUATE TRUE                                                02230000
077300        WHEN AR001-STORE-NUMBER >= CC-STORE1 AND                  02240000
077300             AR001-STORE-NUMBER <= CC-STORE2                      02250000
077400           PERFORM 5000-WRITE-SBS-FILE                            02260000
077300        WHEN AR001-STORE-NUMBER = CC-ECOMM-STORE AND              02270000
077300             PV-ECOMM-TRN-CNTR <= CC-ECOMM-CNT-LIMIT              02280000
                 PERFORM 2400-ECOMM-STR-TRANS                           02290000
077300        WHEN OTHER                                                02300000
                 PERFORM 5100-WRITE-COSA-FILE                           02310000
079600     END-EVALUATE.                                                02320000
077200                                                                  02330000
079800     PERFORM 4100-SAVE-TRAN-KEYS.                                 02340000
079800     PERFORM 4000-READ-TRANSACTION-FILE.                          02350000
077200                                                                  02360000
080000******************************************************************02370000
080100*  PROCESS TRANSACTIONS FOR ONE POS STORE TRANSACTIONS WITH       02380000
080100*  COUNTER LIMIT                                                  02390000
080200******************************************************************02400000
080400 2300-POS-STR-TRANS.                                              02410000
080500                                                                  02420000
077700     IF AR001-TRANSACTION-DATE    = PV-SAVE-TRANS-DATE   AND      02430000
077800        AR001-TRANSACTION-TIME    = PV-SAVE-TRANS-TIME   AND      02440000
077900        AR001-STORE-NUMBER        = PV-SAVE-STORE-NMBR   AND      02450000
078000        AR001-TERMINAL-NUMBER     = PV-SAVE-TERM-NUM     AND      02460000
078100        AR001-TRANSACTION-NUMBER  = PV-SAVE-TRANS-NUM    AND      02470000
078200        AR001-TNDR-SEQ-NBR        = PV-SAVE-TNDR-SEQ-NBR AND      02480000
078300        AR001-TRANSACTION-SOURCE  = PV-SAVE-TRANS-SOURCE AND      02490000
JPGFX3        AR001-ORD-NBR             = PV-SAVE-ORD-NBR               02500000
077400        PERFORM 5000-WRITE-SBS-FILE                               02510000
           ELSE                                                         02520000
              IF PV-POS-STR-TRN-CNTR < CC-POS-CNT-LIMIT                 02530000
077400           PERFORM 5000-WRITE-SBS-FILE                            02540000
              ELSE                                                      02550000
                 PERFORM 5100-WRITE-COSA-FILE                           02560000
              END-IF                                                    02570000
              ADD 1                   TO PV-POS-STR-TRN-CNTR            02580000
           END-IF.                                                      02590000
                                                                        02600000
080000******************************************************************02610000
080100*  PROCESS ECOMM STORE TRANSACTIONS                               02620000
080200******************************************************************02630000
080400 2400-ECOMM-STR-TRANS.                                            02640000
080500                                                                  02650000
077700     IF AR001-TRANSACTION-DATE    = PV-SAVE-TRANS-DATE   AND      02660000
077800        AR001-TRANSACTION-TIME    = PV-SAVE-TRANS-TIME   AND      02670000
077900        AR001-STORE-NUMBER        = PV-SAVE-STORE-NMBR   AND      02680000
078000        AR001-TERMINAL-NUMBER     = PV-SAVE-TERM-NUM     AND      02690000
078100        AR001-TRANSACTION-NUMBER  = PV-SAVE-TRANS-NUM    AND      02700000
078200        AR001-TNDR-SEQ-NBR        = PV-SAVE-TNDR-SEQ-NBR AND      02710000
078300        AR001-TRANSACTION-SOURCE  = PV-SAVE-TRANS-SOURCE AND      02720000
078200        AR001-ORD-NBR             = PV-SAVE-ORD-NBR               02730000
077400        PERFORM 5000-WRITE-SBS-FILE                               02740000
           ELSE                                                         02750000
              IF PV-ECOMM-TRN-CNTR < CC-ECOMM-CNT-LIMIT                 02760000
077400           PERFORM 5000-WRITE-SBS-FILE                            02770000
              ELSE                                                      02780000
                 PERFORM 5100-WRITE-COSA-FILE                           02790000
              END-IF                                                    02800000
              ADD 1                   TO PV-ECOMM-TRN-CNTR              02810000
           END-IF.                                                      02820000
                                                                        02830000
185400******************************************************************02840000
185500*  READ AN ACCOUNTS RECEIVABLE TRANSACTION RECORD.               *02850000
185600******************************************************************02860000
185800 4000-READ-TRANSACTION-FILE.                                      02870000
185700                                                                  02880000
185900     READ AR-TRANSACTION-FILE                                     02890000
186000         INTO AR001-AR-TRANSACTION-RECORD                         02900000
186100         AT END                                                   02910000
186200             SET PS-END-OF-TRANS-FILE TO TRUE                     02920000
186300         NOT AT END                                               02930000
186400             ADD +1 TO PV-INPUT-RCDS-READ                         02940000
186500     END-READ.                                                    02950000
186600                                                                  02960000
185400******************************************************************02970000
185500*  SAVE PREVIOUS TRANSACTION RECORD KEYS                         *02980000
185600******************************************************************02990000
185800 4100-SAVE-TRAN-KEYS.                                             03000000
185700                                                                  03010000
           MOVE AR001-TRANSACTION-DATE   TO PV-SAVE-TRANS-DATE.         03020000
           MOVE AR001-TRANSACTION-TIME   TO PV-SAVE-TRANS-TIME.         03030000
           MOVE AR001-STORE-NUMBER       TO PV-SAVE-STORE-NMBR.         03040000
           MOVE AR001-TERMINAL-NUMBER    TO PV-SAVE-TERM-NUM.           03050000
           MOVE AR001-TRANSACTION-NUMBER TO PV-SAVE-TRANS-NUM.          03060000
           MOVE AR001-TNDR-SEQ-NBR       TO PV-SAVE-TNDR-SEQ-NBR.       03070000
           MOVE AR001-TRANSACTION-SOURCE TO PV-SAVE-TRANS-SOURCE.       03080000
           MOVE AR001-ORD-NBR            TO PV-SAVE-ORD-NBR.            03090000
186600                                                                  03100000
080000******************************************************************03110000
080100*  WRITE SBS FILE.                                                03120000
080200******************************************************************03130000
080400 5000-WRITE-SBS-FILE.                                             03140000
080500                                                                  03150000
191200     WRITE AR-TRANS-RECORD-SBS                                    03160000
191300                         FROM AR001-AR-TRANSACTION-RECORD.        03170000
191400     ADD +1 TO PV-SBS-FILE-COUNT.                                 03180000
191600                                                                  03190000
191700******************************************************************03200000
191800*  WRITE COSA FILE.                                               03210000
191900******************************************************************03220000
080400 5100-WRITE-COSA-FILE.                                            03230000
080500                                                                  03240000
191200     WRITE AR-TRANS-RECORD-COSA                                   03250000
191300                         FROM AR001-AR-TRANSACTION-RECORD.        03260000
191400     ADD +1 TO PV-COSA-FILE-COUNT.                                03270000
192700                                                                  03280000
204300******************************************************************03290000
204400*  PROCESS LAST POSTING IF THE LAST TRANSACTION HAD MERCHANDISE. *03300000
204500*  CLOSE ALL FILES.                                              *03310000
204600******************************************************************03320000
204800 9000-EOJ-ROUTINE.                                                03330000
204900                                                                  03340000
206000     CLOSE AR-TRANSACTION-FILE                                    03350000
206100           AR-TRANS-FILE-COSA                                     03360000
206200           AR-TRANS-FILE-SBS.                                     03370000
208000                                                                  03380000
208300     DISPLAY 'PROGRAM - ' PC-CURRENT-PROGRAM-NAME.                03390000
208300     DISPLAY 'RECORDS IN INPUT FILE   = ' PV-INPUT-RCDS-READ.     03400000
208400     DISPLAY 'RECORDS IN FILE 1(SBS)  = ' PV-SBS-FILE-COUNT.      03410000
208400     DISPLAY 'RECORDS IN FILE 2(COSA) = ' PV-COSA-FILE-COUNT.     03420000
210700                                                                  03430000
