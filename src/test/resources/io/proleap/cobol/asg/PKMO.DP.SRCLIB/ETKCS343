000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    ETKCS343.                                         00040000
000500 AUTHOR.        TESS BESTE.                                       00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  02-23-95.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900*-----------------------------------------------------------------00090000
001000*    E343 - INBOUND EDI DOCS ON HOLD SELECTION                    00100000
001100*                                                                 00110000
001200* THIS PROGRAM ALLOWS THE USER TO ENTER SELECTION CRITERIA TO BE  00120000
001300* USED BY A LIST PROGRAM TO DETERMINE WHICH EDI DOCUMENTS ON HOLD 00130000
001400* SHOULD BE LISTED.                                               00140000
001500*                                                                 00150000
001600* THE SELECTION CRITERIA ENTERED ARE EDITED BEFORE BEING PASSED   00160000
001700* TO THE LIST PROGRAM.                                            00170000
001800*                                                                 00180000
001900*----------------------------------------------------------------*00190000
001910* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00191002
001920*            - CHANGE CALL OF DPKUT100 TO                       * 00192002
001930*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00193002
001940*              MAKING THE CALL DYNAMIC VS STATIC                * 00194002
001950*                                                               * 00195002
001960*---------------------------------------------------------------* 00196002
CICS  *  CHANGED 10/28/2022    BY BARB SCHULTZ    WR: CHG0277210      * 00198003
CICS  *                                                               * 00199003
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00199103
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00199203
001950*                                                               * 00199303
001960*---------------------------------------------------------------* 00199403
002000                                                                  00200000
002100                                                                  00210000
002200                                                                  00220000
002300 ENVIRONMENT DIVISION.                                            00230000
002400                                                                  00240000
002500                                                                  00250000
002600                                                                  00260000
002700 DATA DIVISION.                                                   00270000
002800                                                                  00280000
002900                                                                  00290000
003000 WORKING-STORAGE SECTION.                                         00300000
003100*                                                                 00310000
003200 01  PC-PROGRAM-CONSTANTS.                                        00320000
003300     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'ET343A  '. 00330000
003400     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'ETKM343 '. 00340000
003500     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'ETKCS343'. 00350000
003600     05  PC-TSYMSG-NUMBERS.                                       00360000
003700         10  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.      00370000
003800         10  PC-TSYMSG-00551       PIC  9(05)  VALUE  00551.      00380000
003900         10  PC-TSYMSG-00958       PIC  9(05)  VALUE  00958.      00390000
004000         10  PC-TSYMSG-00962       PIC  9(05)  VALUE  00962.      00400000
004100         10  PC-TSYMSG-00963       PIC  9(05)  VALUE  00963.      00410000
004200         10  PC-TSYMSG-00973       PIC  9(05)  VALUE  00973.      00420000
004300     05  PC-OPERCO-NBR             PIC  X(02)  VALUE  '03'.       00430000
004400     05  PC-RSPLVL-CDE-BUYER       PIC  X(03)  VALUE  'BYR'.      00440000
004500                                                                  00450000
004600 01  PS-PROGRAM-SWITCHES.                                         00460000
004700     05  PS-ERROR-SW               PIC  X      VALUE  'N'.        00470000
004800         88  PS-ERROR                          VALUE  'Y'.        00480000
004900         88  PS-NO-ERROR                       VALUE  'N'.        00490000
005000                                                                  00500000
005100                                                                  00510000
005200*----------------------------------------------------------------*00520000
005300*    MAP LAYOUT                                                  *00530000
005400*----------------------------------------------------------------*00540000
005500                                                                  00550000
005600     COPY ETKM343.                                                00560000
005700                                                                  00570000
005800*----------------------------------------------------------------*00580000
005900*    ATTRIBUTE SETTINGS COPYBOOK.                                *00590000
006000*----------------------------------------------------------------*00600000
006100                                                                  00610000
006200     COPY DPWS015.                                                00620000
006300                                                                  00630000
006400*----------------------------------------------------------------*00640000
006500*    FUNCTION KEYS COPYBOOK                                      *00650000
006600*----------------------------------------------------------------*00660000
006700                                                                  00670000
006800     COPY DPWS016.                                                00680000
006900                                                                  00690000
007000*----------------------------------------------------------------*00700000
007100*    COPY BOOK FOR NUMERIC EDIT SUBROUTINE (DPKUT100) PARAMETER  *00710000
007200*    LIST.                                                       *00720000
007300*----------------------------------------------------------------*00730000
007400                                                                  00740000
007500     COPY DPWS010I.                                               00750000
007600                                                                  00760000
007700******************************************************************00770000
CICS  ** PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.            **00780004
008000******************************************************************00800000
008100                                                                  00810000
008200     COPY DPWS030.                                                00820000
CICS       COPY DPWS930.                                                00821003
008300                                                                  00830000
008400***************************************************************** 00840000
008500*    STANDARD COMMAREA.                                           00850000
008600***************************************************************** 00860000
008700                                                                  00870000
008800     COPY DPWS020.                                                00880000
008900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                00890000
009000                                                                  00900000
009100***************************************************************** 00910000
009200*    INTER-APPLICATION COMMAREA.                                  00920000
009300***************************************************************** 00930000
009400                                                                  00940000
009500         10  INTER-APPL-COMM-AREA PIC X(200).                     00950000
009600     COPY ETWS345.                                                00960000
009700                                                                  00970000
009800***************************************************************** 00980000
009900*    SPECIFIC COMMMAREA FOR ETKCS343.                             00990000
010000***************************************************************** 01000000
010100         10  ASC-SPECIFIC-COMMAREA.                               01010000
010200             15  ASC-BYR-LAST-NAME           PIC  X(18).          01020000
010300             15  ASC-BYR-FIRST-NAME          PIC  X(12).          01030000
010400             15  ASC-DEPT-NBR                PIC  X(03).          01040000
010500             15  ASC-DEPT-NBR-N              REDEFINES            01050000
010600                 ASC-DEPT-NBR                PIC  9(03).          01060000
010700             15  ASC-WORKER-NBR              PIC S9(06) COMP-3.   01070000
010800         10  FILLER                          PIC  X(2828).        01080000
010900                                                                  01090000
011000*----------------------------------------------------------------*01100000
011100*    ABEND PROCESSING COPYBOOK.                                  *01110000
011200*----------------------------------------------------------------*01120000
011300                                                                  01130000
011400     COPY DPWS013.                                                01140000
011500                                                                  01150000
011600*---------------------------------------------------------------* 01160000
011700*    DB2 AREA FOR RESPONSIBLE AREA TABLE                        * 01170000
011800*---------------------------------------------------------------* 01180000
011900     EXEC SQL                                                     01190000
012000          INCLUDE TRSPBAR                                         01200000
012100     END-EXEC.                                                    01210000
012200                                                                  01220000
012300*---------------------------------------------------------------* 01230000
012400*    DB2 AREA FOR COMMUNICATIONS                                * 01240000
012500*---------------------------------------------------------------* 01250000
012600     EXEC SQL                                                     01260000
012700          INCLUDE SQLCA                                           01270000
012800     END-EXEC.                                                    01280000
012900                                                                  01290000
013000                                                                  01300000
013100 EJECT                                                            01310000
013200 LINKAGE SECTION.                                                 01320000
013300                                                                  01330000
013400 01  DFHCOMMAREA.                                                 01340000
013500     05  FILLER                         OCCURS  1 TO 4072 TIMES   01350000
013600                                        DEPENDING ON EIBCALEN.    01360000
013700         10  FILLER                     PIC X.                    01370000
013800                                                                  01380000
013900                                                                  01390000
014000 PROCEDURE DIVISION.                                              01400000
014100*-----------------------------------------------------------------01410000
014200* THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM.     01420000
014300* THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API      01430000
014400* MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.                01440000
014500*                                                                 01450000
014600* THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE      01460000
014700* LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.           01470000
014800*-----------------------------------------------------------------01480000
014900                                                                  01490000
015000 0000-MAIN-MODULE.                                                01500000
015100                                                                  01510000
015200     INITIALIZE DP030-CICS-API-FIELDS.                            01520000
015300     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       01530000
015400     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          01540000
015500     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         01550000
015600     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       01560000
015700     MOVE LENGTH OF ET343AI        TO DP030-MAP-LENGTH (1).       01570000
015800     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     01580000
015900     PERFORM 0001-CALL-CICS-ARCH-API.                             01590000
016000*                                                                 01600000
016100     PERFORM 1000-CONTROL-PROCESSING.                             01610000
016200*                                                                 01620000
016300     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     01630000
016400     PERFORM 0001-CALL-CICS-ARCH-API.                             01640000
016500                                                                  01650000
016600 0001-CALL-CICS-ARCH-API.                                         01660000
016700                                                                  01670000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      01680003
016900                                    DFHCOMMAREA                   01690003
017000                                    DP030-CICS-API-FIELDS         01700003
017100                                    DP020-STANDARD-COMMAREA       01710003
017200                                    ET343AI.                      01720003
017300*                                                                 01730000
017400     IF  DP030-RC-CALL-SUCCESSFUL                                 01740000
017500         CONTINUE                                                 01750000
017600     ELSE                                                         01760000
017700         SET DP013-NO-ROLLBACK                                    01770000
017800             DP013-XCTL-DISPLAY-RESTART                           01780000
017900             DP013-CICS-ABEND      TO TRUE                        01790000
CICS           MOVE '0001-CALL-CICS-ARCH-API'                           01800003
018100                                   TO DP013-PARAGRAPH             01810000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O01820003
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      01830003
018400         MOVE DP030-RETURN-CODE                                   01840000
018500                                   TO DP013-MESSAGE-TEXT (3)      01850000
018600         PERFORM DP013-0000-PROCESS-ABEND                         01860000
018700     END-IF.                                                      01870000
018800                                                                  01880000
018900                                                                  01890000
019000*----------------------------------------------------------------*01900000
019100*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *01910000
019200*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *01920000
019300*----------------------------------------------------------------*01930000
019400                                                                  01940000
019500 1000-CONTROL-PROCESSING.                                         01950000
019600                                                                  01960000
019700     EVALUATE TRUE                                                01970000
019800         WHEN DP020-NEXT-ACT-INITIAL                              01980000
019900             PERFORM 4000-BUILD-INITIAL-PANEL                     01990000
020000                                                                  02000000
020100         WHEN DP020-NEXT-ACT-READ-MAP                             02010000
020200             PERFORM 2000-FKEY-PROCESSING                         02020000
020300                                                                  02030000
020400         WHEN DP020-NEXT-ACT-RETURN                               02040000
020500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02050000
020600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02060000
020700                                                                  02070000
020800         WHEN OTHER                                               02080000
020900             SET DP013-LOGIC-ABEND                                02090000
021000                 DP013-NO-ROLLBACK TO TRUE                        02100000
021100             MOVE '1000-CONTROL-PROCESSING'                       02110000
021200                                   TO  DP013-PARAGRAPH            02120000
021300             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   02130000
021400                                   TO  DP013-MESSAGE-TEXT(1)      02140000
021500             MOVE DP020-NEXT-APPL-ACTIVITY                        02150000
021600                                   TO DP013-MESSAGE-TEXT(2)       02160000
021700             PERFORM DP013-0000-PROCESS-ABEND                     02170000
021800     END-EVALUATE.                                                02180000
021900                                                                  02190000
022000                                                                  02200000
022100*-----------------------------------------------------------------02210000
022200* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS 02220000
022300* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF 02230000
022400* EDITS.                                                          02240000
022500*-----------------------------------------------------------------02250000
022600                                                                  02260000
022700 2000-FKEY-PROCESSING.                                            02270000
022800                                                                  02280000
022900     EVALUATE TRUE                                                02290000
023000                                                                  02300000
023100         WHEN DP020-SRC-AID = DP016-CLEAR                         02310000
023200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02320000
023300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02330000
023400                                                                  02340000
023500         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     02350000
023600             PERFORM 4000-BUILD-INITIAL-PANEL                     02360000
023700                                                                  02370000
023800         WHEN OTHER                                               02380000
023900             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 02390000
024000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02400000
024100             IF  PS-NO-ERROR                                      02410000
024200                 SET DP030-CONTINUE-GO TO TRUE                    02420000
024300                 PERFORM 2100-CHECK-FUNCTION-KEY                  02430000
024400             ELSE                                                 02440000
024500                 SET DP030-OVERRIDE-GO TO TRUE                    02450000
024600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             02460000
024700             END-IF                                               02470000
024800     END-EVALUATE.                                                02480000
024900                                                                  02490000
025000                                                                  02500000
025100*----------------------------------------------------------------*02510000
025200* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *02520000
025300* FIRST. NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED    *02530000
025400* FROM THE CICS ARCHITECTURE API.                                *02540000
025500*----------------------------------------------------------------*02550000
025600                                                                  02560000
025700 2100-CHECK-FUNCTION-KEY.                                         02570000
025800     EVALUATE TRUE                                                02580000
025900         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 02590000
026000             PERFORM 2110-PREPARE-INTER-APPL-COMM                 02600000
026100                                                                  02610000
026200         WHEN DP020-SRC-AID = DP016-ENTER                         02620000
026300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02630000
026400                                                                  02640000
026500         WHEN OTHER                                               02650000
026600             SET DP013-NO-ROLLBACK                                02660000
026700                 DP013-XCTL-DISPLAY-RESTART                       02670000
026800                 DP013-CICS-ABEND  TO TRUE                        02680000
026900             MOVE '2100-CHECK-FUNCTION-KEY'                       02690000
027000                                   TO DP013-PARAGRAPH             02700000
027100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      02710000
027200                                   TO DP013-MESSAGE-TEXT (1)      02720000
027300             PERFORM DP013-0000-PROCESS-ABEND                     02730000
027400     END-EVALUATE.                                                02740000
027500                                                                  02750000
027600                                                                  02760000
027700*-----------------------------------------------------------------02770000
027800* MOVE DATA NEEDED BY THE DESTINATION PROGRAM(S) INTO THE INTER-  02780000
027900* APPLICATION COMMAREA.                                           02790000
028000*-----------------------------------------------------------------02800000
028100                                                                  02810000
028200 2110-PREPARE-INTER-APPL-COMM.                                    02820000
028300                                                                  02830000
028400     INITIALIZE ET345-INTER-APPL-COMM-AREA.                       02840000
028500                                                                  02850000
028600     MOVE ASC-DEPT-NBR       TO ET345-DEPT-NBR.                   02860000
028700     MOVE ASC-WORKER-NBR     TO ET345-WORKER-NBR.                 02870000
028800                                                                  02880000
028900                                                                  02890000
029000*-----------------------------------------------------------------02900000
029100* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN 02910000
029200* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE   02920000
029300* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.               02930000
029400*-----------------------------------------------------------------02940000
029500                                                                  02950000
029600 2200-MOVE-SCREEN-TO-COMMAREA.                                    02960000
029700                                                                  02970000
029800     IF  ABYRLNML > ZERO                                          02980000
029900         MOVE ABYRLNMI       TO ASC-BYR-LAST-NAME                 02990000
030000     ELSE                                                         03000000
030100         IF  ABYRLNMF = DP015-ERASE-EOF                           03010000
030200             MOVE SPACE      TO ASC-BYR-LAST-NAME                 03020000
030300         END-IF                                                   03030000
030400     END-IF.                                                      03040000
030500                                                                  03050000
030600     IF  ABYRFNML > ZERO                                          03060000
030700         MOVE ABYRFNMI       TO ASC-BYR-FIRST-NAME                03070000
030800     ELSE                                                         03080000
030900         IF  ABYRFNMF = DP015-ERASE-EOF                           03090000
031000             MOVE SPACE      TO ASC-BYR-FIRST-NAME                03100000
031100         END-IF                                                   03110000
031200     END-IF.                                                      03120000
031300                                                                  03130000
031400     IF  ADPTNBRL > ZERO                                          03140000
031500         MOVE ADPTNBRI       TO ASC-DEPT-NBR                      03150000
031600     ELSE                                                         03160000
031700         IF  ADPTNBRF = DP015-ERASE-EOF                           03170000
031800             MOVE SPACE      TO ASC-DEPT-NBR                      03180000
031900         END-IF                                                   03190000
032000     END-IF.                                                      03200000
032100                                                                  03210000
032200                                                                  03220000
032300 3000-EDIT-DATA-IN-COMMAREA.                                      03230000
032400                                                                  03240000
032500     PERFORM 3200-RESET-ATTRIBUTES.                               03250000
032600                                                                  03260000
032700*    *------------------------------------------------------------03270000
032800*    * DEPARTMENT NUMBER AND BUYER NAME CANNOT BOTH BE ENTERED.   03280000
032900*    *------------------------------------------------------------03290000
033000                                                                  03300000
033100     IF   ASC-DEPT-NBR       NOT = SPACE                          03310000
033200     AND (ASC-BYR-LAST-NAME  NOT = SPACE                          03320000
033300     OR   ASC-BYR-FIRST-NAME NOT = SPACE)                         03330000
033400         SET  PS-ERROR                                            03340000
033500              DP020-MSG-FATAL TO TRUE                             03350000
033600*        ---- ONLY 1 MAY BE SELECTED ----                         03360000
033700         MOVE PC-TSYMSG-00973           TO DP020-MSG-NUMBER       03370000
033800         IF ASC-BYR-LAST-NAME NOT = SPACE                         03380000
033900             MOVE DP015-UNP-ALP-BRT-OFF TO ABYRLNMA               03390000
034000             MOVE DP015-RED             TO ABYRLNMC               03400000
034100             MOVE DP015-REVERSE         TO ABYRLNMH               03410000
034200             MOVE -1                    TO ABYRLNML               03420000
034300         END-IF                                                   03430000
034400         IF ASC-BYR-FIRST-NAME NOT = SPACE                        03440000
034500             MOVE DP015-UNP-ALP-BRT-OFF TO ABYRFNMA               03450000
034600             MOVE DP015-RED             TO ABYRFNMC               03460000
034700             MOVE DP015-REVERSE         TO ABYRFNMH               03470000
034800             IF ASC-BYR-LAST-NAME = SPACE                         03480000
034900                 MOVE -1                TO ABYRFNML               03490000
035000             END-IF                                               03500000
035100         END-IF                                                   03510000
035200         MOVE DP015-UNP-ALP-BRT-OFF     TO ADPTNBRA               03520000
035300         MOVE DP015-RED                 TO ADPTNBRC               03530000
035400         MOVE DP015-REVERSE             TO ADPTNBRH               03540000
035500     ELSE                                                         03550000
035600*        *--------------------------------------------------------03560000
035700*        * EDIT THE DEPARTMENT NUMBER. IT IS OPTIONAL. IF ENTERED,03570000
035800*        * IT MUST CONTAIN A 3-DIGIT NUMBER.                      03580000
035900*        *--------------------------------------------------------03590000
036000                                                                  03600000
036100         IF ASC-DEPT-NBR = SPACE                                  03610000
036200             CONTINUE                                             03620000
036300         ELSE                                                     03630000
036400             MOVE ASC-DEPT-NBR          TO DP010I-UNEDITED-FIELD  03640000
036500             MOVE LENGTH OF ASC-DEPT-NBR                          03650000
036600                                        TO DP010I-MAXIMUM-DIGITS  03660000
036700             MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS03670000
036800             SET  DP010I-NEGATIVE-NOT-ALLOWED TO TRUE             03680000
036910             CALL DP010I-NUMERIC-EDIT-ROUTINE                     03691001
036920                         USING DP010I-NUMERIC-EDIT-AREA           03692001
037000                                                                  03700000
037100             IF DP010I-ERROR-DETECTED                             03710000
037200                 SET  PS-ERROR                                    03720000
037300                      DP020-MSG-FATAL TO TRUE                     03730000
037400*                ---- MUST BE NUMERIC ----                        03740000
037500                 MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER  03750000
037600                 MOVE DP015-UNP-ALP-BRT-OFF  TO ADPTNBRA          03760000
037700                 MOVE DP015-RED              TO ADPTNBRC          03770000
037800                 MOVE DP015-REVERSE          TO ADPTNBRH          03780000
037900                 MOVE -1                     TO ADPTNBRL          03790000
038000             ELSE                                                 03800000
038100                 MOVE DP010I-NUMERIC-FIELD TO ASC-DEPT-NBR-N      03810000
038200             END-IF                                               03820000
038300         END-IF                                                   03830000
038400                                                                  03840000
038500*        *--------------------------------------------------------03850000
038600*        * EDIT THE BUYER NAME. IT IS OPTIONAL. IF ENTERED, EITHER03860000
038700*        * FULL NAME (FIRST AND LAST) OR LAST NAME ONLY MAY BE    03870000
038800*        * ENTERED. THE ENTERED NAME MUST BE A VALID BUYER NAME.  03880000
038900*        *--------------------------------------------------------03890000
039000                                                                  03900000
039100         IF ASC-BYR-FIRST-NAME = SPACE                            03910000
039200             IF ASC-BYR-LAST-NAME = SPACE                         03920000
039300                 MOVE ZERO TO ASC-WORKER-NBR                      03930000
039400             ELSE                                                 03940000
039500                 PERFORM Z810-GET-WORKER-FOR-LAST-NAME            03950000
039600                 EVALUATE TRUE                                    03960000
039700                     WHEN SQLCODE = 0                             03970000
039800                         MOVE RSPBAR-WORKER-NBR TO ASC-WORKER-NBR 03980000
039900                     WHEN SQLCODE = +100                          03990000
040000                         SET  PS-ERROR                            04000000
040100                              DP020-MSG-FATAL TO TRUE             04010000
040200*                        ---- BUYER NAME DOES NOT EXIST ----      04020000
040300                         MOVE PC-TSYMSG-00962                     04030000
040400                                               TO DP020-MSG-NUMBER04040000
040500                         MOVE DP015-UNP-ALP-BRT-OFF  TO ABYRLNMA  04050000
040600                         MOVE DP015-RED              TO ABYRLNMC  04060000
040700                         MOVE DP015-REVERSE          TO ABYRLNMH  04070000
040800                         MOVE -1                     TO ABYRLNML  04080000
040900                     WHEN SQLCODE = -811                          04090000
041000                         SET  PS-ERROR                            04100000
041100                              DP020-MSG-FATAL TO TRUE             04110000
041200*                        ---- MULTIPLE BUYERS FOUND, ENTER ----   04120000
041300*                        ---- FIRST NAME ALSO              ----   04130000
041400                         MOVE PC-TSYMSG-00963  TO DP020-MSG-NUMBER04140000
041500                         MOVE DP015-UNP-ALP-BRT-OFF  TO ABYRFNMA  04150000
041600                         MOVE DP015-RED              TO ABYRFNMC  04160000
041700                         MOVE DP015-REVERSE          TO ABYRFNMH  04170000
041800                         MOVE -1               TO ABYRFNML        04180000
041900                                                                  04190000
042000                     WHEN OTHER                                   04200000
042100                         SET  PS-ERROR                            04210000
042200                              DP020-MSG-WARNING TO TRUE           04220000
042300*                        ---- WAIT 15 SECONDS, THEN RETRY ----    04230000
042400                         MOVE PC-TSYMSG-00551  TO DP020-MSG-NUMBER04240000
042500                         MOVE -1               TO ABYRLNML        04250000
042600                 END-EVALUATE                                     04260000
042700         ELSE                                                     04270000
042800             IF ASC-BYR-LAST-NAME = SPACE                         04280000
042900                 SET  PS-ERROR                                    04290000
043000                      DP020-MSG-FATAL TO TRUE                     04300000
043100*                --- LAST NAME MUST BE ENTERED WITH FIRST NAME ---04310000
043200                 MOVE PC-TSYMSG-00958        TO DP020-MSG-NUMBER  04320000
043300                 MOVE DP015-UNP-ALP-BRT-OFF  TO ABYRLNMA          04330000
043400                 MOVE DP015-RED              TO ABYRLNMC          04340000
043500                 MOVE DP015-REVERSE          TO ABYRLNMH          04350000
043600                 MOVE -1                     TO ABYRLNML          04360000
043700             ELSE                                                 04370000
043800                 PERFORM Z820-GET-WORKER-FOR-FULL-NAME            04380000
043900                 EVALUATE TRUE                                    04390000
044000                     WHEN SQLCODE = 0                             04400000
044100                         MOVE RSPBAR-WORKER-NBR TO ASC-WORKER-NBR 04410000
044200                     WHEN SQLCODE = +100                          04420000
044300                         SET  PS-ERROR                            04430000
044400                              DP020-MSG-FATAL TO TRUE             04440000
044500*                        ---- BUYER NAME DOES NOT EXIST ----      04450000
044600                         MOVE PC-TSYMSG-00962  TO DP020-MSG-NUMBER04460000
044700                         MOVE DP015-UNP-ALP-BRT-OFF  TO ABYRLNMA  04470000
044800                                                        ABYRFNMA  04480000
044900                         MOVE DP015-RED              TO ABYRLNMC  04490000
045000                                                        ABYRFNMC  04500000
045100                         MOVE DP015-REVERSE          TO ABYRLNMH  04510000
045200                                                        ABYRFNMH  04520000
045300                         MOVE -1                     TO ABYRLNML  04530000
045400                     WHEN SQLCODE = -811                          04540000
045500                         SET  PS-ERROR                            04550000
045600                              DP020-MSG-FATAL TO TRUE             04560000
045700*                        ---- MULTIPLE BUYERS FOUND, ENTER ----   04570000
045800*                        ---- FIRST NAME ALSO              ----   04580000
045900                         MOVE PC-TSYMSG-00963  TO DP020-MSG-NUMBER04590000
046000                         MOVE DP015-UNP-ALP-BRT-OFF  TO ABYRFNMA  04600000
046100                         MOVE DP015-RED              TO ABYRFNMC  04610000
046200                         MOVE DP015-REVERSE          TO ABYRFNMH  04620000
046300                         MOVE -1               TO ABYRFNML        04630000
046400                                                                  04640000
046500                     WHEN OTHER                                   04650000
046600                         SET  PS-ERROR                            04660000
046700                              DP020-MSG-WARNING TO TRUE           04670000
046800*                        ---- WAIT 15 SECONDS, THEN RETRY ----    04680000
046900                         MOVE PC-TSYMSG-00551  TO DP020-MSG-NUMBER04690000
047000                         MOVE -1               TO ABYRLNML        04700000
047100                 END-EVALUATE                                     04710000
047200             END-IF                                               04720000
047300         END-IF                                                   04730000
047400     END-IF.                                                      04740000
047500                                                                  04750000
047600     IF PS-NO-ERROR                                               04760000
047700         MOVE -1                        TO ABYRLNML               04770000
047800     END-IF.                                                      04780000
047900     SET DP030-SET-CURSOR-APPL-1 TO TRUE.                         04790000
048000                                                                  04800000
048100                                                                  04810000
048200*-----------------------------------------------------------------04820000
048300* MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE    04830000
048400* MAP.                                                            04840000
048500*-----------------------------------------------------------------04850000
048600                                                                  04860000
048700 3200-RESET-ATTRIBUTES.                                           04870000
048800                                                                  04880000
048900     MOVE DP015-UNP-ALP-NOR-OFF TO ABYRLNMA                       04890000
049000                                   ABYRFNMA                       04900000
049100                                   ADPTNBRA.                      04910000
049200                                                                  04920000
049300     MOVE DP015-GREEN           TO ABYRLNMC                       04930000
049400                                   ABYRFNMC                       04940000
049500                                   ADPTNBRC.                      04950000
049600                                                                  04960000
049700     MOVE DP015-UNDERLINE       TO ABYRLNMH                       04970000
049800                                   ABYRFNMH                       04980000
049900                                   ADPTNBRH.                      04990000
050000                                                                  05000000
050100                                                                  05010000
050200*----------------------------------------------------------------*05020000
050300*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *05030000
050400*  IT HERE.                                                      *05040000
050500*----------------------------------------------------------------*05050000
050600                                                                  05060000
050700 4000-BUILD-INITIAL-PANEL.                                        05070000
050800                                                                  05080000
050900     PERFORM 3200-RESET-ATTRIBUTES.                               05090000
051000                                                                  05100000
051100     MOVE -1 TO ABYRLNML.                                         05110000
051200     SET DP030-SET-CURSOR-APPL-1 TO TRUE.                         05120000
051300                                                                  05130000
051400     INITIALIZE ASC-SPECIFIC-COMMAREA.                            05140000
051500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        05150000
051600                                                                  05160000
051700                                                                  05170000
051800*----------------------------------------------------------------*05180000
051900*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *05190000
052000*----------------------------------------------------------------*05200000
052100                                                                  05210000
052200 4400-MOVE-COMMAREA-TO-SCREEN.                                    05220000
052300                                                                  05230000
052400     MOVE ASC-BYR-LAST-NAME   TO ABYRLNMO.                        05240000
052500     MOVE ASC-BYR-FIRST-NAME  TO ABYRFNMO.                        05250000
052600     MOVE ASC-DEPT-NBR        TO ADPTNBRO.                        05260000
052700                                                                  05270000
052800                                                                  05280000
052900 Z810-GET-WORKER-FOR-LAST-NAME.                                   05290000
053000                                                                  05300000
053100     EXEC SQL                                                     05310000
053200         SELECT DISTINCT WORKER_NBR                               05320000
053300         INTO  :RSPBAR-WORKER-NBR                                 05330000
053400         FROM   TRSPBAR                                           05340000
053500         WHERE  OPERCO_NBR       = :PC-OPERCO-NBR                 05350000
053600           AND  WORKER_LAST_NAME = :ASC-BYR-LAST-NAME             05360000
053700           AND  RSPLVL_CDE       = :PC-RSPLVL-CDE-BUYER           05370000
053800           AND  CURRENT DATE BETWEEN WORKER_STRT_DTE              05380000
053900                                 AND WORKER_END_DTE               05390000
054000     END-EXEC.                                                    05400000
054100                                                                  05410000
054200     EVALUATE TRUE                                                05420000
054300         WHEN SQLCODE = ZERO                                      05430000
054400         WHEN SQLCODE = +100                                      05440000
054500         WHEN SQLCODE = -811                                      05450000
054600         WHEN SQLCODE = -904                                      05460000
054700         WHEN SQLCODE = -913                                      05470000
054800             CONTINUE                                             05480000
054900         WHEN SQLWARN0 NOT = SPACE                                05490000
055000         WHEN SQLCODE  NOT = ZERO                                 05500000
055100              MOVE 'Z810-GET-WORKER-FOR-LAST-NAME'                05510000
055200                           TO  DP013-PARAGRAPH                    05520000
055300              MOVE 'SELECT FROM TRSPBAR'                          05530000
055400                           TO  DP013-MESSAGE-TEXT (1)             05540000
055500              MOVE SQLCA   TO  DP013-SQLCA                        05550000
055600              SET DP013-DB2-ABEND                                 05560000
055700                           TO  TRUE                               05570000
055800              PERFORM DP013-0000-PROCESS-ABEND                    05580000
055900     END-EVALUATE.                                                05590000
056000                                                                  05600000
056100                                                                  05610000
056200 Z820-GET-WORKER-FOR-FULL-NAME.                                   05620000
056300                                                                  05630000
056400     EXEC SQL                                                     05640000
056500         SELECT DISTINCT WORKER_NBR                               05650000
056600         INTO  :RSPBAR-WORKER-NBR                                 05660000
056700         FROM   TRSPBAR                                           05670000
056800         WHERE  OPERCO_NBR        = :PC-OPERCO-NBR                05680000
056900           AND  WORKER_LAST_NAME  = :ASC-BYR-LAST-NAME            05690000
057000           AND  WORKER_FIR_NAME   = :ASC-BYR-FIRST-NAME           05700000
057100           AND  RSPLVL_CDE        = :PC-RSPLVL-CDE-BUYER          05710000
057200           AND  CURRENT DATE BETWEEN WORKER_STRT_DTE              05720000
057300                                 AND WORKER_END_DTE               05730000
057400     END-EXEC.                                                    05740000
057500                                                                  05750000
057600     EVALUATE TRUE                                                05760000
057700         WHEN SQLCODE = ZERO                                      05770000
057800         WHEN SQLCODE = +100                                      05780000
057900         WHEN SQLCODE = -811                                      05790000
058000         WHEN SQLCODE = -904                                      05800000
058100         WHEN SQLCODE = -913                                      05810000
058200             CONTINUE                                             05820000
058300         WHEN SQLWARN0 NOT = SPACE                                05830000
058400         WHEN SQLCODE  NOT = ZERO                                 05840000
058500              MOVE 'Z820-GET-WORKER-FOR-FULL-NAME'                05850000
058600                           TO  DP013-PARAGRAPH                    05860000
058700              MOVE 'SELECT FROM TRSPBAR'                          05870000
058800                           TO  DP013-MESSAGE-TEXT (1)             05880000
058900              MOVE SQLCA   TO  DP013-SQLCA                        05890000
059000              SET DP013-DB2-ABEND                                 05900000
059100                           TO  TRUE                               05910000
059200              PERFORM DP013-0000-PROCESS-ABEND                    05920000
059300     END-EVALUATE.                                                05930000
059400                                                                  05940000
059500                                                                  05950000
059600*----------------------------------------------------------------*05960000
059700*    ABEND PROCESSOR MODULE                                      *05970000
059800*----------------------------------------------------------------*05980000
059900                                                                  05990000
060000     COPY DPPD013.                                                06000000
