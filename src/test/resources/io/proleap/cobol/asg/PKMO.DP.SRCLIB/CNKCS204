000100 IDENTIFICATION DIVISION.                                         11/02/93
000200 PROGRAM-ID.    CNKCS204.                                         CNKCS204
000300 AUTHOR.        TOM RUSKA. (G&R).                                    LV001
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          CNKCS204
000500 DATE-WRITTEN.  05-13-93.                                         CNKCS204
000600 DATE-COMPILED.                                                   CNKCS204
000700                                                                  CNKCS204
000800*---------------------------------------------------------------* CNKCS204
000900*    Y204 - DEPARTMENT/CLASS FACILITY LOCATION LIST             * CNKCS204
001000*                                                               * CNKCS204
001100*    THIS PROGRAM GENERATES A LIST OF FACILITY LOCATIONS        * CNKCS204
001200*    ASSIGNED TO DEPARTMENT CLASSES.                            * CNKCS204
001300*    RECORDS CAN BE SELECTED FOR UPDATE AND DELETE.  ADD IS ALSO* CNKCS204
001400*    ALLOWED.  THE APPROPRIATE PROGRAM IS INVOKED WHEN THE      * CNKCS204
001500*    OPERATOR SELECTS ONE OR MORE ITEMS AND PRESSES A FUNCTION  * CNKCS204
001600*    KEY.  NO SELECTION IS NECESSARY TO ADD A LOCATION.         * CNKCS204
001700*                                                               * CNKCS204
001800*---------------------------------------------------------------* CNKCS204
263455* CHANGED 11/02/2021    BY JIM HUNTER      WR: CHG0263455                 
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263455* MAKING THE CALL DYNAMIC VS STATIC.                                      
263455*----------------------------------------------------------------*        
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
001900                                                                  CNKCS204
002000 ENVIRONMENT DIVISION.                                            CNKCS204
002100 DATA DIVISION.                                                   CNKCS204
002200/                                                                 CNKCS204
002300 WORKING-STORAGE SECTION.                                         CNKCS204
002400                                                                  CNKCS204
002500 01  DK-DB2-KEYS.                                                 CNKCS204
002600     05  DK-OPER-UNT-ID                 PIC  S9(04) COMP.            CL**3
002700     05  DK-FCLTY-ID                    PIC  S9(04) COMP.            CL**3
002800     05  DK-FCLTY-ID-LOW                PIC  S9(04) COMP.            CL**8
002900     05  DK-FCLTY-ID-HIGH               PIC  S9(04) COMP.            CL**8
003000     05  DK-AREA-ID-LOW                 PIC  X(06).                  CL**3
003100     05  DK-AREA-ID-HIGH                PIC  X(06).                  CL**3
003200     05  DK-TYPE-LOW                    PIC  X(02).               CNKCS204
003300     05  DK-TYPE-HIGH                   PIC  X(02).               CNKCS204
003400     05  DK-DEPT-NBR-LOW                PIC  X(03).                  CL**3
003500     05  DK-DEPT-NBR-HIGH               PIC  X(03).                  CL**3
003600                                                                  CNKCS204
003700 01  DN-DB2-NULL-INDICATORS.                                      CNKCS204
003800     05  DN-FCLTY-AREA-ID               PIC S9(04) VALUE +0          CL**3
003900                                                    COMP.         CNKCS204
004000 01  PC-PROGRAM-CONSTANTS.                                        CNKCS204
004100     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         CNKCS204
004200                                                    'CN204A  '.   CNKCS204
004300     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         CNKCS204
004400                                                    'CNKM204 '.   CNKCS204
004500     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         CNKCS204
004600                                                    'CNKCS204'.   CNKCS204
004700     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      CNKCS204
004800     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      CNKCS204
004900     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    CNKCS204
005000     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +11     CNKCS204
005100                                                    COMP SYNC.    CNKCS204
005200     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      CNKCS204
005300                                                    COMP SYNC.    CNKCS204
005400     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         CNKCS204
005500                                                    +1000000      CNKCS204
005600                                                    COMP-3.       CNKCS204
005700     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      CNKCS204
005800                                                    COMP SYNC.    CNKCS204
005900     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      CNKCS204
006000                                                    COMP-3.       CNKCS204
006100     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    CNKCS204
006200     05  PC-ADD                         PIC  X(03)  VALUE 'ADD'.  CNKCS204
006300     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  CNKCS204
006400     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  CNKCS204
006500     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  CNKCS204
006600     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  CNKCS204
006700                                                                  CNKCS204
006800     05  PC-TSYMSG-NUMBERS.                                       CNKCS204
006900         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  CNKCS204
007000         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  CNKCS204
007100         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  CNKCS204
007200         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  CNKCS204
007300         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  CNKCS204
007400         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  CNKCS204
007500         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  CNKCS204
007600         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  CNKCS204
007700         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  CNKCS204
007800         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  CNKCS204
007900         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  CNKCS204
008000         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  CNKCS204
008100         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  CNKCS204
008200                                                                  CNKCS204
008300 01  PS-PROGRAM-SWITCHES.                                         CNKCS204
008400     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    CNKCS204
008500         88  PS-NO-ERROR                            VALUE 'Y'.    CNKCS204
008600         88  PS-ERROR                               VALUE 'N'.    CNKCS204
008700     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    CNKCS204
008800         88  PS-COMMAREA-VALID                      VALUE 'Y'.    CNKCS204
008900         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    CNKCS204
009000     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    CNKCS204
009100         88  PS-DONE                                VALUE 'Y'.    CNKCS204
009200         88  PS-NOT-DONE                            VALUE 'N'.    CNKCS204
009300                                                                  CNKCS204
009400 01  PV-PROGRAM-VARIABLES.                                        CNKCS204
009500     05  PV-SUB                         PIC S9(04)  VALUE +0      CNKCS204
009600                                                    COMP SYNC.    CNKCS204
009700     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      CNKCS204
009800                                                    COMP SYNC.    CNKCS204
009900     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      CNKCS204
010000                                                    COMP-3.       CNKCS204
010100     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      CNKCS204
010200                                                    COMP-3.       CNKCS204
010300     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      CNKCS204
010400                                                    COMP-3.       CNKCS204
010500     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      CNKCS204
010600                                                    COMP-3.       CNKCS204
010700     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      CNKCS204
010800                                                    COMP-3.       CNKCS204
010900     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      CNKCS204
011000                                                    COMP-3.       CNKCS204
011100     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      CNKCS204
011200                                                    COMP-3.       CNKCS204
011300     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      CNKCS204
011400                                                    COMP SYNC.    CNKCS204
011500     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      CNKCS204
011600                                                    COMP SYNC.    CNKCS204
011700     05  PV-ITEM                        PIC S9(04)  VALUE +0      CNKCS204
011800                                                    COMP SYNC.    CNKCS204
011900     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      CNKCS204
012000                                                    COMP SYNC.    CNKCS204
012100     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      CNKCS204
012200                                                    COMP SYNC.    CNKCS204
012300     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      CNKCS204
012400                                                    COMP SYNC.    CNKCS204
012500     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      CNKCS204
012600                                                    COMP SYNC.    CNKCS204
012700     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      CNKCS204
012800                                                    COMP SYNC.    CNKCS204
012900     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      CNKCS204
013000                                                    COMP SYNC.    CNKCS204
013100     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      CNKCS204
013200                                                    COMP SYNC.    CNKCS204
013300     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      CNKCS204
013400                                                    COMP SYNC.    CNKCS204
013500     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      CNKCS204
013600                                                    COMP SYNC.    CNKCS204
013700     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      CNKCS204
013800                                                    COMP SYNC.    CNKCS204
013900     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      CNKCS204
014000                                                    COMP SYNC.    CNKCS204
014100     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      CNKCS204
014200                                                    COMP SYNC.    CNKCS204
014300     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      CNKCS204
014400                                                    COMP SYNC.    CNKCS204
014500                                                                  CNKCS204
014600*---------------------------------------------------------------* CNKCS204
014700*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * CNKCS204
014800*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * CNKCS204
014900*   APPLICATION-SPECIFIC COMMAREA.                              * CNKCS204
015000*---------------------------------------------------------------* CNKCS204
015100 01  LQW-LIST-QUEUE-WORK-AREA.                                    CNKCS204
015200     05  LQW-BLOCK-MODIFIED             PIC X(01)   VALUE SPACE.  CNKCS204
015300     05  LQW-ITEM-ENTRIES               OCCURS 11 TIMES           CNKCS204
015400                                        INDEXED BY LQW-IDX.       CNKCS204
015500         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       CNKCS204
015600         10  LQW-TEMP-SELECTED-SW       PIC X(01).                CNKCS204
015700         10  LQW-SELECTED-SW            PIC X(01).                CNKCS204
015800             88  LQW-SELECT                         VALUE 'S'.    CNKCS204
015900             88  LQW-DESELECT                       VALUE ' '.    CNKCS204
016000         10  LQW-ACTION                 PIC X(03).                CNKCS204
016100         10  LQW-FCLTY-ID               PIC 9(04).                   CL**8
016200         10  LQW-DEPT-NBR               PIC X(03).                   CL**3
016300         10  LQW-CL-NBR                 PIC X(02).                   CL**3
016400         10  LQW-RANK                   PIC 9(01).                CNKCS204
016500         10  LQW-AREA-ID                PIC X(06).                   CL**3
016600         10  LQW-TYPE                   PIC X(02).                CNKCS204
016700         10  LQW-DESC                   PIC X(30).                CNKCS204
016800         10  LQW-OPER-UNT-ID            PIC 9(04).                   CL**7
016900                                                                  CNKCS204
017000/                                                                 CNKCS204
017100*---------------------------------------------------------------* CNKCS204
017200*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * CNKCS204
017300*---------------------------------------------------------------* CNKCS204
017400     COPY CNWS005.                                                   CL*13
017500                                                                  CNKCS204
017600/                                                                 CNKCS204
017700*---------------------------------------------------------------* CNKCS204
017800*    MAP LAYOUT                                                 * CNKCS204
017900*---------------------------------------------------------------* CNKCS204
018000                                                                  CNKCS204
018100     COPY CNKM204.                                                CNKCS204
018200                                                                  CNKCS204
018300 01  MR-OCCURS-LAYOUT                   REDEFINES  CN204AO.       CNKCS204
018400     05  FILLER                         PIC X(48).                CNKCS204
018500                                                                  CNKCS204
018600     05  MR-OPERL                       PIC S9(04) COMP.             CL**3
018700     05  MR-OPERA                       PIC X(01).                   CL**3
018800     05  MR-OPERC                       PIC X(01).                   CL**3
018900     05  MR-OPERH                       PIC X(01).                   CL**3
019000     05  MR-OPER                        PIC X(04).                   CL**3
019100                                                                  CNKCS204
019200     05  MR-FCLTYL                      PIC S9(04) COMP.             CL**3
019300     05  MR-FCLTYA                      PIC X(01).                   CL**3
019400     05  MR-FCLTYC                      PIC X(01).                   CL**3
019500     05  MR-FCLTYH                      PIC X(01).                   CL**3
019600     05  MR-FCLTY                       PIC X(04).                   CL**3
019700                                                                     CL**3
019800     05  MR-FDESCL                      PIC S9(04) COMP.          CNKCS204
019900     05  MR-FDESCA                      PIC X(01).                CNKCS204
020000     05  MR-FDESCC                      PIC X(01).                CNKCS204
020100     05  MR-FDESCH                      PIC X(01).                CNKCS204
020200     05  MR-FDESC                       PIC X(25).                CNKCS204
020300                                                                  CNKCS204
020400     05  MR-SCROLL-AREA                 OCCURS 11 TIMES.          CNKCS204
020500         10  MR-SELECTL                 PIC S9(04) COMP.          CNKCS204
020600         10  MR-SELECTA                 PIC X(01).                CNKCS204
020700         10  MR-SELECTC                 PIC X(01).                CNKCS204
020800         10  MR-SELECTH                 PIC X(01).                CNKCS204
020900         10  MR-SELECT                  PIC X(01).                CNKCS204
021000                                                                  CNKCS204
021100         10  MR-ACTIONL                 PIC S9(04) COMP.          CNKCS204
021200         10  MR-ACTIONA                 PIC X(01).                CNKCS204
021300         10  MR-ACTIONC                 PIC X(01).                CNKCS204
021400         10  MR-ACTIONH                 PIC X(01).                CNKCS204
021500         10  MR-ACTION                  PIC X(03).                CNKCS204
021600                                                                     CL**8
021700         10  MR-FACL                    PIC S9(04) COMP.             CL**8
021800         10  MR-FACA                    PIC X(01).                   CL**8
021900         10  MR-FACC                    PIC X(01).                   CL**8
022000         10  MR-FACH                    PIC X(01).                   CL**8
022100         10  MR-FCLTY-ID                PIC X(04).                   CL**8
022200                                                                     CL**8
022300         10  MR-DEPT-NBRL               PIC S9(04) COMP.             CL**3
022400         10  MR-DEPT-NBRA               PIC X(01).                   CL**3
022500         10  MR-DEPT-NBRC               PIC X(01).                   CL**3
022600         10  MR-DEPT-NBRH               PIC X(01).                   CL**3
022700         10  MR-DEPT-NBR                PIC X(03).                   CL**3
022800                                                                  CNKCS204
022900         10  MR-CL-NBRL                 PIC S9(04) COMP.             CL**3
023000         10  MR-CL-NBRA                 PIC X(01).                   CL**3
023100         10  MR-CL-NBRC                 PIC X(01).                   CL**3
023200         10  MR-CL-NBRH                 PIC X(01).                   CL**3
023300         10  MR-CL-NBR                  PIC X(02).                   CL**3
023400                                                                  CNKCS204
023500         10  MR-RANKL                   PIC S9(04) COMP.          CNKCS204
023600         10  MR-RANKA                   PIC X(01).                CNKCS204
023700         10  MR-RANKC                   PIC X(01).                CNKCS204
023800         10  MR-RANKH                   PIC X(01).                CNKCS204
023900         10  MR-RANK-X.                                           CNKCS204
024000             15  MR-RANK                PIC 9.                    CNKCS204
024100                                                                  CNKCS204
024200         10  MR-LOCL                    PIC S9(04) COMP.          CNKCS204
024300         10  MR-LOCA                    PIC X(01).                CNKCS204
024400         10  MR-LOCC                    PIC X(01).                CNKCS204
024500         10  MR-LOCH                    PIC X(01).                CNKCS204
024600         10  MR-AREA-ID                 PIC X(06).                   CL**3
024700                                                                  CNKCS204
024800         10  MR-TYPEL                   PIC S9(04) COMP.          CNKCS204
024900         10  MR-TYPEA                   PIC X(01).                CNKCS204
025000         10  MR-TYPEC                   PIC X(01).                CNKCS204
025100         10  MR-TYPEH                   PIC X(01).                CNKCS204
025200         10  MR-TYPE                    PIC X(02).                CNKCS204
025300                                                                  CNKCS204
025400         10  MR-DESCL                   PIC S9(04) COMP.          CNKCS204
025500         10  MR-DESCA                   PIC X(01).                CNKCS204
025600         10  MR-DESCC                   PIC X(01).                CNKCS204
025700         10  MR-DESCH                   PIC X(01).                CNKCS204
025800         10  MR-DESC                    PIC X(30).                CNKCS204
025900                                                                  CNKCS204
026000/                                                                 CNKCS204
026100*---------------------------------------------------------------* CNKCS204
026200*    ATTRIBUTE SETTINGS COPYBOOK.                               * CNKCS204
026300*---------------------------------------------------------------* CNKCS204
026400     COPY DPWS015.                                                CNKCS204
026500                                                                  CNKCS204
026600/                                                                 CNKCS204
026700*---------------------------------------------------------------* CNKCS204
026800*    FUNCTION KEYS COPYBOOK.                                    * CNKCS204
026900*---------------------------------------------------------------* CNKCS204
027000     COPY DPWS016.                                                CNKCS204
027100                                                                  CNKCS204
027200/                                                                 CNKCS204
027300*---------------------------------------------------------------* CNKCS204
027400*    NUMERIC EDIT LAYOUT.                                       * CNKCS204
027500*---------------------------------------------------------------* CNKCS204
027600     COPY DPWS010I.                                               CNKCS204
027700                                                                  CNKCS204
027800/                                                                 CNKCS204
027900*---------------------------------------------------------------* CNKCS204
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          *         
028100*---------------------------------------------------------------* CNKCS204
028200     COPY DPWS030.                                                CNKCS204
CICS       COPY DPWS930.                                                        
028300                                                                  CNKCS204
028400/                                                                 CNKCS204
028500*---------------------------------------------------------------* CNKCS204
028600*    STANDARD COMMAREA.                                         * CNKCS204
028700*---------------------------------------------------------------* CNKCS204
028800                                                                  CNKCS204
028900     COPY DPWS020.                                                CNKCS204
029000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                CNKCS204
029100                                                                  CNKCS204
029200*---------------------------------------------------------------* CNKCS204
029300* INTER-APPLICATION COMMAREA.                                   * CNKCS204
029400*   CNWS001 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * CNKCS204
029500*             SPEC SCREEN.                                      * CNKCS204
029600*   CNWS003 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * CNKCS204
029700*             THIS LIST PROGRAM FOR A LOCAL-GO FUNCTION.        * CNKCS204
029800*---------------------------------------------------------------* CNKCS204
029900                                                                  CNKCS204
030000         10  INTER-APPL-COMM-AREA       PIC X(200).               CNKCS204
030100     COPY CNWS001.                                                   CL*13
030200     COPY CNWS003.                                                   CL*13
030300*---------------------------------------------------------------* CNKCS204
030400*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * CNKCS204
030500*---------------------------------------------------------------* CNKCS204
030600         10  ASC-SPECIFIC-COMMAREA.                               CNKCS204
030700             15  ASC-LIST-KEYS.                                   CNKCS204
030800                 20  ASC-KEY-OPER-UNT-ID   PIC S9(04) COMP.          CL**8
030900                 20  ASC-KEY-FCLTY-ID      PIC S9(04) COMP.          CL**8
031000                 20  ASC-KEY-FCLTY-ID-LOW  PIC S9(04) COMP.          CL**8
031100                 20  ASC-KEY-FCLTY-ID-HIGH PIC S9(04) COMP.          CL**8
031200                 20  ASC-KEY-AREA-ID-LOW   PIC X(06).                CL**8
031300                 20  ASC-KEY-AREA-ID-HIGH  PIC X(06).                CL**8
031400                 20  ASC-KEY-TYPE-LOW      PIC X(02).                CL**8
031500                 20  ASC-KEY-TYPE-HIGH     PIC X(02).                CL**8
031600                 20  ASC-KEY-DEPT-NBR-LOW  PIC X(03).                CL**8
031700                 20  ASC-KEY-DEPT-NBR-HIGH PIC X(03).                CL**3
031800             15  ASC-SEL-UNASSIGNED     PIC X(01).                CNKCS204
031900             15  ASC-BLOCK-ENTRIES      OCCURS 2 TIMES.           CNKCS204
032000                 20  ASC-BLOCK-MODIFIED-SW                        CNKCS204
032100                                        PIC  X(01).               CNKCS204
032200                     88  ASC-BLOCK-NOT-MODIFIED    VALUE 'N'.     CNKCS204
032300                     88  ASC-BLOCK-MODIFIED        VALUE 'Y'.     CNKCS204
032400                                                                  CNKCS204
032500                 20  ASC-ITEM-ARRAY.                              CNKCS204
032600                     25  ASC-ITEM-ENTRIES OCCURS 11 TIMES.        CNKCS204
032700                         30  ASC-LIST-ITEM-NUMBER                 CNKCS204
032800                                        PIC S9(09) COMP-3.        CNKCS204
032900                         30  ASC-TEMP-SELECTED-SW                 CNKCS204
033000                                        PIC X(01).                CNKCS204
033100                             88  ASC-VALID-SELECT  VALUE ' '      CNKCS204
033200                                                         'S'      CNKCS204
033300                                                         'B'      CNKCS204
033400                                                         'E'.     CNKCS204
033500                             88  ASC-TEMP-NO-SELECT               CNKCS204
033600                                                   VALUE ' '.     CNKCS204
033700                             88  ASC-TEMP-SELECT   VALUE 'S'.     CNKCS204
033800                             88  ASC-TEMP-BEGIN    VALUE 'B'.     CNKCS204
033900                             88  ASC-TEMP-END      VALUE 'E'.     CNKCS204
034000                         30  ASC-SELECTED-SW                      CNKCS204
034100                                        PIC X(01).                CNKCS204
034200                             88  ASC-NO-SELECT     VALUE ' '.     CNKCS204
034300                             88  ASC-SELECT        VALUE 'S'.     CNKCS204
034400                             88  ASC-BEGIN         VALUE 'B'.     CNKCS204
034500                             88  ASC-END           VALUE 'E'.     CNKCS204
034600                         30  ASC-ACTION   PIC X(03).                 CL**3
034700                         30  ASC-FCLTY-ID PIC 9(04).                 CL**8
034800                         30  ASC-DEPT-NBR PIC X(03).                 CL**3
034900                         30  ASC-CL-NBR   PIC X(02).                 CL**3
035000                         30  ASC-RANK     PIC 9(01).                 CL**3
035100                         30  ASC-AREA-ID  PIC X(06).                 CL**3
035200                         30  ASC-TYPE     PIC X(02).                 CL**3
035300                         30  ASC-DESC     PIC X(30).                 CL**3
035400                         30  ASC-OPER-UNT-ID                         CL**3
035500                                          PIC 9(04).                 CL**3
035600                                                                  CNKCS204
035700             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     CNKCS204
035800             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     CNKCS204
035900             15  ASC-NUMBER-OF-ITEMS-READ                         CNKCS204
036000                                        PIC S9(09) COMP-3.        CNKCS204
036100             15  ASC-NUMBER-OF-SELECTED-ITEMS                     CNKCS204
036200                                        PIC S9(09) COMP-3.        CNKCS204
036300             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        CNKCS204
036400             15  ASC-ITEM-AT-TOP-OF-PANEL                         CNKCS204
036500                                        PIC S9(09) COMP-3.        CNKCS204
036600             15  ASC-ITEM-AT-BOT-OF-PANEL                         CNKCS204
036700                                        PIC S9(09) COMP-3.        CNKCS204
036800             15  ASC-HIGHEST-BLOCK-WRITTEN                        CNKCS204
036900                                        PIC S9(04) COMP SYNC.     CNKCS204
037000             15  ASC-START-OF-SELECTED-RANGE                      CNKCS204
037100                                        PIC S9(09) COMP-3.        CNKCS204
037200             15  ASC-END-OF-SELECTED-RANGE                        CNKCS204
037300                                        PIC S9(09) COMP-3.        CNKCS204
037400             15  ASC-ITEMS-LEFT-INDICATOR                         CNKCS204
037500                                        PIC X(01).                CNKCS204
037600                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     CNKCS204
037700                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     CNKCS204
037800             15  ASC-TEMP-QUEUE-UPDATE-SW                         CNKCS204
037900                                        PIC X(01).                CNKCS204
038000                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     CNKCS204
038100                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     CNKCS204
038200             15  ASC-LIST-QUEUE-NAME.                             CNKCS204
038300                 20  ASC-LIST-TERM-ID   PIC X(04).                CNKCS204
038400                 20  ASC-LIST-TASK-NUMBER                         CNKCS204
038500                                        PIC S9(05) COMP-3.        CNKCS204
038600                 20  ASC-LIST-SEQ       PIC 9(01).                CNKCS204
038700             15  ASC-SEL-QUEUE-NAME.                              CNKCS204
038800                 20  ASC-SEL-TERM-ID    PIC X(04).                CNKCS204
038900                 20  ASC-SEL-TASK-NUMBER                          CNKCS204
039000                                        PIC S9(05) COMP-3.        CNKCS204
039100                 20  ASC-SEL-SEQ        PIC 9(01).                CNKCS204
039200                                                                  CNKCS204
039300             15  ASC-CURSOR-SW          PIC X(01).                CNKCS204
039400                 88  ASC-NO-CURSOR                 VALUE 'Z'.     CNKCS204
039500                 88  ASC-TYPE-CURSOR               VALUE 'S'.     CNKCS204
039600                 88  ASC-LOC-CURSOR                VALUE 'N'.     CNKCS204
039700                 88  ASC-DESC-CURSOR               VALUE 'T'.     CNKCS204
039800             15  ASC-START-ITEM-REQUEST.                          CNKCS204
039900                 20  ASC-START-ITEM-REQUEST-N                     CNKCS204
040000                                        PIC 9(07).                CNKCS204
040100             15  ASC-FCLTY-NME          PIC X(25).                   CL**3
040200                                                                  CNKCS204
040300/                                                                 CNKCS204
040400*---------------------------------------------------------------* CNKCS204
040500*    ABEND PROCESSING COPYBOOK.                                 * CNKCS204
040600*---------------------------------------------------------------* CNKCS204
040700     COPY DPWS013.                                                CNKCS204
040800                                                                  CNKCS204
040900/                                                                 CNKCS204
041000*---------------------------------------------------------------* CNKCS204
041100*    DB2 AREA FOR THE DEPT/CLASS FACILITY LOCATION TABLE        * CNKCS204
041200*---------------------------------------------------------------* CNKCS204
041300     EXEC SQL                                                     CNKCS204
041400          INCLUDE TDCFAAS                                            CL*12
041500     END-EXEC.                                                    CNKCS204
041600                                                                  CNKCS204
041700/                                                                 CNKCS204
041800*---------------------------------------------------------------* CNKCS204
041900*    DB2 AREA FOR THE FACILITY LOCATION TYPE TABLE              * CNKCS204
042000*---------------------------------------------------------------* CNKCS204
042100     EXEC SQL                                                     CNKCS204
042200          INCLUDE TFLAREA                                            CL**3
042300     END-EXEC.                                                    CNKCS204
042400                                                                  CNKCS204
042500/                                                                 CNKCS204
042600*---------------------------------------------------------------* CNKCS204
042700*    COMMAREA USED TO CALL XLKUT071                            *  CNKCS204
042800*---------------------------------------------------------------* CNKCS204
042900     COPY XLWS071.                                                CNKCS204
043000                                                                  CNKCS204
043100/                                                                 CNKCS204
043200*---------------------------------------------------------------* CNKCS204
043300*    DB2 AREA FOR COMMUNICATIONS                                * CNKCS204
043400*---------------------------------------------------------------* CNKCS204
043500     EXEC SQL                                                     CNKCS204
043600          INCLUDE SQLCA                                           CNKCS204
043700     END-EXEC.                                                    CNKCS204
043800                                                                  CNKCS204
043900/                                                                 CNKCS204
044000*---------------------------------------------------------------* CNKCS204
044100*    DEPT-CL-NBR-CSR FOR SELECT OF ALL LOCATIONS WITHIN STORE   *    CL**3
044200*---------------------------------------------------------------* CNKCS204
044300                                                                  CNKCS204
044400     EXEC SQL                                                     CNKCS204
044500          DECLARE DEPT-CL-NBR-CSR CURSOR FOR                         CL**3
044600           SELECT OPER_UNT_ID                                        CL*11
044700                 ,FCLTY_ID                                           CL*11
044800                 ,DEPT_NBR                                           CL**9
044900                 ,CL_NBR                                             CL**3
045000                 ,RANK_NBR                                        CNKCS204
045100                 ,FCLTY_AREA_ID                                      CL**3
045200                 ,FCLTY_LOC_TYP_CDE                                  CL**4
045300             FROM TDCFAAS                                            CL*12
045400            WHERE OPER_UNT_ID = :DK-OPER-UNT-ID                      CL**3
045500              AND FCLTY_ID           BETWEEN :DK-FCLTY-ID-LOW        CL**8
045600                                         AND :DK-FCLTY-ID-HIGH       CL**8
045700              AND VALUE (FCLTY_AREA_ID, '######')                    CL**3
045800                                     BETWEEN :DK-AREA-ID-LOW         CL**3
045900                                         AND :DK-AREA-ID-HIGH        CL**3
046000              AND DEPT_NBR           BETWEEN :DK-DEPT-NBR-LOW        CL**3
046100                                         AND :DK-DEPT-NBR-HIGH       CL**3
046200              AND FCLTY_LOC_TYP_CDE  BETWEEN :DK-TYPE-LOW            CL**5
046300                                         AND :DK-TYPE-HIGH        CNKCS204
046400         ORDER BY FCLTY_ID                                           CL**8
046500                 ,DEPT_NBR                                           CL**8
046600                 ,CL_NBR                                             CL**3
046700                 ,FCLTY_LOC_TYP_CDE                                  CL**5
046800                 ,RANK_NBR                                        CNKCS204
046900     END-EXEC.                                                    CNKCS204
047000                                                                  CNKCS204
047100/                                                                 CNKCS204
047200 LINKAGE SECTION.                                                 CNKCS204
047300                                                                  CNKCS204
047400 01  DFHCOMMAREA.                                                 CNKCS204
047500     05  FILLER                         OCCURS  1 TO 4072 TIMES   CNKCS204
047600                                        DEPENDING ON EIBCALEN.    CNKCS204
047700         10  FILLER                     PIC X.                    CNKCS204
047800                                                                  CNKCS204
047900/                                                                 CNKCS204
048000 PROCEDURE DIVISION.                                              CNKCS204
048100*---------------------------------------------------------------* CNKCS204
048200*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * CNKCS204
048300*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * CNKCS204
048400*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * CNKCS204
048500*---------------------------------------------------------------* CNKCS204
048600 0000-MAIN-MODULE.                                                CNKCS204
048700                                                                  CNKCS204
048800     INITIALIZE DP030-CICS-API-FIELDS.                            CNKCS204
048900                                                                  CNKCS204
049000     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       CNKCS204
049100     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          CNKCS204
049200     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         CNKCS204
049300                                                                  CNKCS204
049400     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       CNKCS204
049500                                                                  CNKCS204
049600     MOVE LENGTH OF CN204AI        TO DP030-MAP-LENGTH (1).       CNKCS204
049700     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     CNKCS204
049800                                                                  CNKCS204
049900     PERFORM 0001-CALL-CICS-ARCH-API.                             CNKCS204
050000     PERFORM 1000-CONTROL-PROCESSING                              CNKCS204
050100                                                                  CNKCS204
050200     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     CNKCS204
050300     PERFORM 0001-CALL-CICS-ARCH-API.                             CNKCS204
050400                                                                  CNKCS204
050500*---------------------------------------------------------------* CNKCS204
050600*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * CNKCS204
050700*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * CNKCS204
050800*---------------------------------------------------------------* CNKCS204
050900 0001-CALL-CICS-ARCH-API.                                         CNKCS204
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
051100                                    DFHCOMMAREA                           
051200                                    DP030-CICS-API-FIELDS                 
051300                                    DP020-STANDARD-COMMAREA               
051400                                    CN204AI.                              
051500                                                                  CNKCS204
051600     IF  DP030-RC-CALL-SUCCESSFUL                                 CNKCS204
051700         CONTINUE                                                 CNKCS204
051800     ELSE                                                         CNKCS204
051900         SET DP013-NO-ROLLBACK                                    CNKCS204
052000             DP013-XCTL-DISPLAY-RESTART                           CNKCS204
052100             DP013-CICS-ABEND      TO TRUE                        CNKCS204
052200         MOVE '0001-CALL-CICS-ARCH-API'                           CNKCS204
052300                                   TO DP013-PARAGRAPH             CNKCS204
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
052600         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      CNKCS204
052700         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS204
052800     END-IF.                                                      CNKCS204
052900                                                                  CNKCS204
053000*----------------------------------------------------------------*CNKCS204
053100* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *CNKCS204
053200* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *CNKCS204
053300*                                                                *CNKCS204
053400* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *CNKCS204
053500*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *CNKCS204
053600*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *CNKCS204
053700*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *CNKCS204
053800*----------------------------------------------------------------*CNKCS204
053900                                                                  CNKCS204
054000 1000-CONTROL-PROCESSING.                                         CNKCS204
054100                                                                  CNKCS204
054200     EVALUATE TRUE                                                CNKCS204
054300         WHEN DP020-NEXT-ACT-INITIAL                              CNKCS204
054400             INITIALIZE ASC-SPECIFIC-COMMAREA                     CNKCS204
054500             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            CNKCS204
054600                                      ASC-SEL-TERM-ID             CNKCS204
054700             MOVE DP020-SRC-TASK-NUMBER                           CNKCS204
054800                                   TO ASC-LIST-TASK-NUMBER        CNKCS204
054900                                      ASC-SEL-TASK-NUMBER         CNKCS204
055000             MOVE PC-LIST-QUEUE-SEQ                               CNKCS204
055100                                   TO ASC-LIST-SEQ                CNKCS204
055200             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 CNKCS204
055300             PERFORM 1100-PROCESS-INTER-APPL-COMM                 CNKCS204
055400                                                                  CNKCS204
055500***-----$TEMPLATE NOTE$-------------------------------------------CNKCS204
055600*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,CNKCS204
055700*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  CNKCS204
055800*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.CNKCS204
055900***---------------------------------------------------------------CNKCS204
056000             IF  PS-COMMAREA-NOT-VALID                            CNKCS204
056100***              MOVE PC-TSYMSG-99901                             CNKCS204
056200***                                TO DP020-MSG-NUMBER            CNKCS204
056300***              SET DP020-MSG-FATAL                              CNKCS204
056400***                                TO TRUE                        CNKCS204
056500                 SET DP020-NEXT-ACT-APPL-ERROR                    CNKCS204
056600                                   TO TRUE                        CNKCS204
056700             ELSE                                                 CNKCS204
056800                 PERFORM 4000-BUILD-INITIAL-PANEL                 CNKCS204
056900             END-IF                                               CNKCS204
057000                                                                  CNKCS204
057100         WHEN DP020-NEXT-ACT-READ-MAP                             CNKCS204
057200             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        CNKCS204
057300                                   TO PV-TOP-ITEM                 CNKCS204
057400             PERFORM 2000-PROCESS-PANEL                           CNKCS204
057500                                                                  CNKCS204
057600         WHEN DP020-NEXT-ACT-RETURN                               CNKCS204
057700             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        CNKCS204
057800                                   TO PV-TOP-ITEM                 CNKCS204
057900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    CNKCS204
058000             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 CNKCS204
058100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS204
058200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   CNKCS204
058300                                                                  CNKCS204
058400         WHEN OTHER                                               CNKCS204
058500             SET DP013-LOGIC-ABEND TO TRUE                        CNKCS204
058600             SET DP013-NO-ROLLBACK TO TRUE                        CNKCS204
058700             MOVE '1000-CONTROL-PROCESSING'                       CNKCS204
058800                                   TO DP013-PARAGRAPH             CNKCS204
058900             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    CNKCS204
059000                                   TO DP013-MESSAGE-TEXT(1)       CNKCS204
059100             PERFORM DP013-0000-PROCESS-ABEND                     CNKCS204
059200     END-EVALUATE.                                                CNKCS204
059300                                                                  CNKCS204
059400/                                                                 CNKCS204
059500*----------------------------------------------------------------*CNKCS204
059600* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *CNKCS204
059700*----------------------------------------------------------------*CNKCS204
059800                                                                  CNKCS204
059900 1100-PROCESS-INTER-APPL-COMM.                                    CNKCS204
060000                                                                  CNKCS204
060100     SET PS-COMMAREA-VALID         TO TRUE.                       CNKCS204
060200     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     CNKCS204
060300                                                                  CNKCS204
060400     IF DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT           CNKCS204
060500        MOVE CN001-OPER-UNT-ID     TO DK-OPER-UNT-ID                 CL**3
060600                                      ASC-KEY-OPER-UNT-ID            CL**3
060700        MOVE CN001-FCLTY-ID        TO DK-FCLTY-ID-LOW                CL**8
060800                                      DK-FCLTY-ID-HIGH               CL**8
060900                                      DK-FCLTY-ID                    CL**8
061000                                      ASC-KEY-FCLTY-ID-LOW           CL**8
061100                                      ASC-KEY-FCLTY-ID-HIGH          CL**8
061200                                      ASC-KEY-FCLTY-ID               CL**8
061300        MOVE CN001-AREA-ID         TO DK-AREA-ID-LOW                 CL**3
061400                                      DK-AREA-ID-HIGH                CL**3
061500                                      ASC-KEY-AREA-ID-LOW            CL**3
061600                                      ASC-KEY-AREA-ID-HIGH           CL**3
061700        MOVE CN001-LOC-TYPE        TO DK-TYPE-LOW                 CNKCS204
061800                                      DK-TYPE-HIGH                CNKCS204
061900                                      ASC-KEY-TYPE-LOW            CNKCS204
062000                                      ASC-KEY-TYPE-HIGH           CNKCS204
062100        MOVE CN001-DEPT-NBR        TO DK-DEPT-NBR-LOW                CL**3
062200                                      DK-DEPT-NBR-HIGH               CL**3
062300                                      ASC-KEY-DEPT-NBR-LOW           CL**3
062400                                      ASC-KEY-DEPT-NBR-HIGH          CL**3
062500        MOVE CN001-SEL-UNASSIGNED  TO ASC-SEL-UNASSIGNED          CNKCS204
062600     END-IF.                                                      CNKCS204
062700                                                                  CNKCS204
062800/                                                                 CNKCS204
062900*----------------------------------------------------------------*CNKCS204
063000* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *CNKCS204
063100* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *CNKCS204
063200* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *CNKCS204
063300* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *CNKCS204
063400* FUNCTION KEYS CAN GET THIS FAR.                                *CNKCS204
063500*----------------------------------------------------------------*CNKCS204
063600                                                                  CNKCS204
063700 2000-PROCESS-PANEL.                                              CNKCS204
063800     EVALUATE TRUE                                                CNKCS204
063900         WHEN DP020-SRC-AID = DP016-CLEAR                         CNKCS204
064000             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    CNKCS204
064100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   CNKCS204
064200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS204
064300                                                                  CNKCS204
064400         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    CNKCS204
064500             MOVE ASC-KEY-OPER-UNT-ID                                CL**3
064600                                   TO DK-OPER-UNT-ID                 CL**3
064700             MOVE ASC-KEY-FCLTY-ID-LOW                               CL**8
064800                                   TO DK-FCLTY-ID-LOW                CL**8
064900             MOVE ASC-KEY-FCLTY-ID-HIGH                              CL**8
065000                                   TO DK-FCLTY-ID-HIGH               CL**8
065100             MOVE ASC-KEY-FCLTY-ID TO DK-FCLTY-ID                    CL**8
065200             MOVE ASC-KEY-AREA-ID-LOW                                CL**3
065300                                   TO DK-AREA-ID-LOW                 CL**3
065400             MOVE ASC-KEY-AREA-ID-HIGH                               CL**3
065500                                   TO DK-AREA-ID-HIGH                CL**3
065600             MOVE ASC-KEY-TYPE-LOW TO DK-TYPE-LOW                 CNKCS204
065700             MOVE ASC-KEY-TYPE-HIGH                               CNKCS204
065800                                   TO DK-TYPE-HIGH                CNKCS204
065900             MOVE ASC-KEY-DEPT-NBR-LOW                               CL**8
066000                                   TO DK-DEPT-NBR-LOW                CL**8
066100             MOVE ASC-KEY-DEPT-NBR-HIGH                              CL**3
066200                                   TO DK-DEPT-NBR-HIGH               CL**3
066300             PERFORM 2050-DELETE-LIST-QUEUE                       CNKCS204
066400             PERFORM 4000-BUILD-INITIAL-PANEL                     CNKCS204
066500                                                                  CNKCS204
066600         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    CNKCS204
066700             PERFORM 2140-DESELECT-ALL-ITEMS                      CNKCS204
066800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS204
066900                                                                  CNKCS204
067000         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  CNKCS204
067100             PERFORM 2150-SELECT-ALL-ITEMS                        CNKCS204
067200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS204
067300                                                                  CNKCS204
067400         WHEN OTHER                                               CNKCS204
067500             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 CNKCS204
067600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   CNKCS204
067700             IF  PS-NO-ERROR                                      CNKCS204
067800                 SET DP030-CONTINUE-GO TO TRUE                    CNKCS204
067900                 PERFORM 2100-CHECK-FUNCTION-KEY                  CNKCS204
068000             ELSE                                                 CNKCS204
068100                 SET DP030-OVERRIDE-GO TO TRUE                    CNKCS204
068200             END-IF                                               CNKCS204
068300     END-EVALUATE.                                                CNKCS204
068400                                                                  CNKCS204
068500/                                                                 CNKCS204
068600*----------------------------------------------------------------*CNKCS204
068700*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *CNKCS204
068800*----------------------------------------------------------------*CNKCS204
068900 2050-DELETE-LIST-QUEUE.                                          CNKCS204
069000                                                                  CNKCS204
069100     EXEC CICS                                                    CNKCS204
069200         DELETEQ TS                                               CNKCS204
069300           QUEUE (ASC-LIST-QUEUE-NAME)                            CNKCS204
069400            RESP (PV-CICS-RESP)                                   CNKCS204
069500     END-EXEC.                                                    CNKCS204
069600                                                                  CNKCS204
069700     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       CNKCS204
069800        (PV-CICS-RESP = DFHRESP(QIDERR))                          CNKCS204
069900         CONTINUE                                                 CNKCS204
070000     ELSE                                                         CNKCS204
070100         SET DP013-CICS-ABEND      TO TRUE                        CNKCS204
070200         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS204
070300                                                                  CNKCS204
070400         MOVE '2050-DELETE-LIST-QUEUE'                            CNKCS204
070500                                   TO DP013-PARAGRAPH             CNKCS204
070600         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    CNKCS204
070700                                   TO DP013-MESSAGE-TEXT (1)      CNKCS204
070800         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS204
070900     END-IF.                                                      CNKCS204
071000                                                                  CNKCS204
071100     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  CNKCS204
071200                                                                  CNKCS204
071300/                                                                 CNKCS204
071400*----------------------------------------------------------------*CNKCS204
071500* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*CNKCS204
071600* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *CNKCS204
071700* CICS ARCHITECTURE API.                                         *CNKCS204
071800*----------------------------------------------------------------*CNKCS204
071900 2100-CHECK-FUNCTION-KEY.                                         CNKCS204
072000                                                                  CNKCS204
072100     EVALUATE TRUE                                                CNKCS204
072200         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  CNKCS204
072300             IF  ASC-NUMBER-OF-SELECTED-ITEMS = ZERO              CNKCS204
072400                 SET ASC-NO-TSQ-UPDATE TO TRUE                    CNKCS204
072500             END-IF                                               CNKCS204
072600             INITIALIZE CN003-INTER-APPL-COMMAREA                 CNKCS204
072700             MOVE ASC-KEY-OPER-UNT-ID                                CL**3
072800                                   TO CN003-OPER-UNT-ID              CL**3
072900             MOVE ASC-KEY-FCLTY-ID TO CN003-FCLTY-ID                 CL**3
073000             MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    CNKCS204
073100                                 TO CN003-NUMBER-OF-SELECTED-ITEMSCNKCS204
073200             PERFORM 5000-PREPARE-SEL-QUEUE                       CNKCS204
073300                                                                  CNKCS204
073400         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  CNKCS204
073500             MOVE +1               TO PV-TOP-ITEM                 CNKCS204
073600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS204
073700                                                                  CNKCS204
073800         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   CNKCS204
073900             PERFORM 2110-BROWSE-BACKWARD                         CNKCS204
074000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS204
074100                                                                  CNKCS204
074200         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   CNKCS204
074300             PERFORM 2120-BROWSE-FORWARD                          CNKCS204
074400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS204
074500                                                                  CNKCS204
074600         WHEN DP020-SRC-AID = DP016-ENTER                         CNKCS204
074700             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   CNKCS204
074800             IF  PS-ERROR                                         CNKCS204
074900                 CONTINUE                                         CNKCS204
075000             ELSE                                                 CNKCS204
075100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             CNKCS204
075200             END-IF                                               CNKCS204
075300                                                                  CNKCS204
075400         WHEN OTHER                                               CNKCS204
075500             SET DP013-NO-ROLLBACK                                CNKCS204
075600                 DP013-XCTL-DISPLAY-RESTART                       CNKCS204
075700                 DP013-CICS-ABEND  TO TRUE                        CNKCS204
075800             MOVE '2100-CHECK-FUNCTION-KEY'                       CNKCS204
075900                                   TO DP013-PARAGRAPH             CNKCS204
076000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      CNKCS204
076100                                   TO DP013-MESSAGE-TEXT (1)      CNKCS204
076200             PERFORM DP013-0000-PROCESS-ABEND                     CNKCS204
076300     END-EVALUATE.                                                CNKCS204
076400                                                                  CNKCS204
076500/                                                                 CNKCS204
076600*----------------------------------------------------------------*CNKCS204
076700*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *CNKCS204
076800*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *CNKCS204
076900*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *CNKCS204
077000*    MESSAGE.                                                    *CNKCS204
077100*----------------------------------------------------------------*CNKCS204
077200                                                                  CNKCS204
077300 2110-BROWSE-BACKWARD.                                            CNKCS204
077400                                                                  CNKCS204
077500     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    CNKCS204
077600         GIVING PV-TOP-ITEM.                                      CNKCS204
077700                                                                  CNKCS204
077800     IF  ((PV-TOP-ITEM < +1)                                      CNKCS204
077900       OR (PV-TOP-ITEM = +1))                                     CNKCS204
078000         MOVE +1                   TO PV-TOP-ITEM                 CNKCS204
078100*        -- TOP OF LIST --                                        CNKCS204
078200         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            CNKCS204
078300         SET DP020-MSG-INFORMATIONAL                              CNKCS204
078400                                   TO TRUE                        CNKCS204
078500     END-IF.                                                      CNKCS204
078600                                                                  CNKCS204
078700/                                                                 CNKCS204
078800*----------------------------------------------------------------*CNKCS204
078900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *CNKCS204
079000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *CNKCS204
079100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *CNKCS204
079200*----------------------------------------------------------------*CNKCS204
079300                                                                  CNKCS204
079400 2120-BROWSE-FORWARD.                                             CNKCS204
079500                                                                  CNKCS204
079600     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              CNKCS204
079700         GIVING PV-TOP-ITEM.                                      CNKCS204
079800                                                                  CNKCS204
079900     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   CNKCS204
080000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            CNKCS204
080100                                   TO PV-TOP-ITEM                 CNKCS204
080200*        -- BOTTOM OF LIST --                                     CNKCS204
080300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            CNKCS204
080400         SET DP020-MSG-INFORMATIONAL                              CNKCS204
080500                                   TO TRUE                        CNKCS204
080600     ELSE                                                         CNKCS204
080700         COMPUTE PV-BOTTOM-ITEM =                                 CNKCS204
080800             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 CNKCS204
080900         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            CNKCS204
081000*            -- BOTTOM OF LIST --                                 CNKCS204
081100             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            CNKCS204
081200             SET DP020-MSG-INFORMATIONAL                          CNKCS204
081300                                   TO TRUE                        CNKCS204
081400         END-IF                                                   CNKCS204
081500     END-IF.                                                      CNKCS204
081600                                                                  CNKCS204
081700/                                                                 CNKCS204
081800*----------------------------------------------------------------*CNKCS204
081900*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *CNKCS204
082000*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *CNKCS204
082100*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *CNKCS204
082200*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *CNKCS204
082300*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *CNKCS204
082400*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *CNKCS204
082500*----------------------------------------------------------------*CNKCS204
082600                                                                  CNKCS204
082700 2130-CHECK-FOR-JUMP-BROWSE.                                      CNKCS204
082800                                                                  CNKCS204
082900     SET PS-NO-ERROR               TO TRUE.                       CNKCS204
083000     IF (ASC-START-ITEM-REQUEST = SPACE)                          CNKCS204
083100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            CNKCS204
083200                                   TO PV-TOP-ITEM                 CNKCS204
083300     ELSE                                                         CNKCS204
083400         MOVE ASC-START-ITEM-REQUEST                              CNKCS204
083500                                   TO DP010I-UNEDITED-FIELD       CNKCS204
083600         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       CNKCS204
083700         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     CNKCS204
083800         SET DP010I-NEGATIVE-NOT-ALLOWED                          CNKCS204
083900                                   TO TRUE                        CNKCS204
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263455              USING DP010I-NUMERIC-EDIT-AREA                              
084100                                                                  CNKCS204
084200         IF  NOT DP010I-ERROR-DETECTED                            CNKCS204
084300             MOVE DP010I-NUMERIC-FIELD                            CNKCS204
084400                                   TO ASC-START-ITEM-REQUEST-N    CNKCS204
084500             IF  ASC-START-ITEM-REQUEST-N > ZERO                  CNKCS204
084600                 IF  ASC-START-ITEM-REQUEST-N >                   CNKCS204
084700                                          ASC-NUMBER-OF-ITEMS-READCNKCS204
084800                     MOVE SPACE TO ASC-START-ITEM-REQUEST         CNKCS204
084900                     COMPUTE PV-TOP-ITEM =                        CNKCS204
085000                             ASC-NUMBER-OF-ITEMS-READ             CNKCS204
085100                             - PC-ITEMS-PER-PANEL + 1             CNKCS204
085200                     IF  PV-TOP-ITEM < +1                         CNKCS204
085300                         MOVE +1   TO PV-TOP-ITEM                 CNKCS204
085400                         MOVE PC-TSYMSG-00070                     CNKCS204
085500                                   TO DP020-MSG-NUMBER            CNKCS204
085600                         SET DP020-MSG-INFORMATIONAL              CNKCS204
085700                                   TO TRUE                        CNKCS204
085800                     END-IF                                       CNKCS204
085900                 ELSE                                             CNKCS204
086000                     MOVE ASC-START-ITEM-REQUEST-N                CNKCS204
086100                                   TO PV-TOP-ITEM                 CNKCS204
086200                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      CNKCS204
086300                     COMPUTE PV-BOTTOM-ITEM =                     CNKCS204
086400                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     CNKCS204
086500                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READCNKCS204
086600*                        -- BOTTOM OF LIST --                     CNKCS204
086700                         MOVE PC-TSYMSG-00070                     CNKCS204
086800                                   TO DP020-MSG-NUMBER            CNKCS204
086900                         SET DP020-MSG-INFORMATIONAL              CNKCS204
087000                                   TO TRUE                        CNKCS204
087100                     END-IF                                       CNKCS204
087200                 END-IF                                           CNKCS204
087300             ELSE                                                 CNKCS204
087400*                --- VALUE OUT OF RANGE ----                      CNKCS204
087500                 MOVE PC-TSYMSG-00101                             CNKCS204
087600                                   TO DP020-MSG-NUMBER            CNKCS204
087700                 MOVE -1           TO ASTRTITL                    CNKCS204
087800                 SET DP030-SET-CURSOR-APPL-1                      CNKCS204
087900                                   TO TRUE                        CNKCS204
088000                 MOVE DP015-REVERSE                               CNKCS204
088100                                   TO ASTRTITH                    CNKCS204
088200                 MOVE DP015-RED    TO ASTRTITC                    CNKCS204
088300                 MOVE DP015-UNP-NUM-BRT-MDT                       CNKCS204
088400                                   TO ASTRTITA                    CNKCS204
088500                 SET DP020-MSG-FATAL                              CNKCS204
088600                                   TO TRUE                        CNKCS204
088700                 SET PS-ERROR      TO TRUE                        CNKCS204
088800             END-IF                                               CNKCS204
088900                                                                  CNKCS204
089000         ELSE                                                     CNKCS204
089100             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            CNKCS204
089200             MOVE -1               TO ASTRTITL                    CNKCS204
089300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  CNKCS204
089400             MOVE DP015-REVERSE    TO ASTRTITH                    CNKCS204
089500             MOVE DP015-RED        TO ASTRTITC                    CNKCS204
089600             MOVE DP015-UNP-NUM-BRT-MDT                           CNKCS204
089700                                   TO ASTRTITA                    CNKCS204
089800             SET DP020-MSG-FATAL   TO TRUE                        CNKCS204
089900             SET PS-ERROR          TO TRUE                        CNKCS204
090000         END-IF                                                   CNKCS204
090100     END-IF.                                                      CNKCS204
090200                                                                  CNKCS204
090300/                                                                 CNKCS204
090400*----------------------------------------------------------------*CNKCS204
090500*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *CNKCS204
090600*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *CNKCS204
090700*----------------------------------------------------------------*CNKCS204
090800 2140-DESELECT-ALL-ITEMS.                                         CNKCS204
090900                                                                  CNKCS204
091000     MOVE +1                       TO ASC-BLK-SUB.                CNKCS204
091100                                                                  CNKCS204
091200     PERFORM 2141-CLEAR-SELECTED-INDS                             CNKCS204
091300         VARYING ASC-ITEM-SUB                                     CNKCS204
091400         FROM 1 BY 1                                              CNKCS204
091500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 CNKCS204
091600                                                                  CNKCS204
091700     ADD +1                        TO ASC-BLK-SUB.                CNKCS204
091800                                                                  CNKCS204
091900     PERFORM 2141-CLEAR-SELECTED-INDS                             CNKCS204
092000         VARYING ASC-ITEM-SUB                                     CNKCS204
092100         FROM 1 BY 1                                              CNKCS204
092200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 CNKCS204
092300                                                                  CNKCS204
092400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               CNKCS204
092500                                   TO PV-LIST-ITEM-NUMBER.        CNKCS204
092600                                                                  CNKCS204
092700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            CNKCS204
092800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    CNKCS204
092900                                                                  CNKCS204
093000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     CNKCS204
093100        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      CNKCS204
093200         MOVE +1                   TO ASC-BLK-SUB                 CNKCS204
093300                                                                  CNKCS204
093400         PERFORM 5100-WRITE-TEMP-STORAGE                          CNKCS204
093500                                                                  CNKCS204
093600         MOVE +1                   TO PV-BLOCK-NUMBER             CNKCS204
093700                                                                  CNKCS204
093800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         CNKCS204
093900             PV-FIRST-BLOCK-IN-ARRAY - 1                          CNKCS204
094000                                                                  CNKCS204
094100         PERFORM                                                  CNKCS204
094200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       CNKCS204
094300                                                                  CNKCS204
094400             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS204
094500                                                                  CNKCS204
094600             PERFORM 2141-CLEAR-SELECTED-INDS                     CNKCS204
094700                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 CNKCS204
094800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          CNKCS204
094900                                                                  CNKCS204
095000             PERFORM 5100-WRITE-TEMP-STORAGE                      CNKCS204
095100                                                                  CNKCS204
095200             ADD +1                TO PV-BLOCK-NUMBER             CNKCS204
095300                                                                  CNKCS204
095400         END-PERFORM                                              CNKCS204
095500                                                                  CNKCS204
095600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         CNKCS204
095700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     CNKCS204
095800                                                                  CNKCS204
095900         PERFORM                                                  CNKCS204
096000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       CNKCS204
096100                   ASC-HIGHEST-BLOCK-WRITTEN                      CNKCS204
096200                                                                  CNKCS204
096300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          CNKCS204
096400                                   TO PV-BLOCK-NUMBER             CNKCS204
096500                                                                  CNKCS204
096600             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS204
096700                                                                  CNKCS204
096800             PERFORM 2141-CLEAR-SELECTED-INDS                     CNKCS204
096900                 VARYING ASC-ITEM-SUB                             CNKCS204
097000                 FROM 1 BY 1                                      CNKCS204
097100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          CNKCS204
097200                                                                  CNKCS204
097300             PERFORM 5100-WRITE-TEMP-STORAGE                      CNKCS204
097400                                                                  CNKCS204
097500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      CNKCS204
097600                                                                  CNKCS204
097700         END-PERFORM                                              CNKCS204
097800                                                                  CNKCS204
097900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             CNKCS204
098000                                   TO PV-BLOCK-NUMBER             CNKCS204
098100                                                                  CNKCS204
098200         PERFORM 4410-READ-TEMP-STORAGE                           CNKCS204
098300     END-IF.                                                      CNKCS204
098400                                                                  CNKCS204
098500                                                                  CNKCS204
098600     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMSCNKCS204
098700     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.CNKCS204
098800     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  CNKCS204
098900                                                                  CNKCS204
099000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        CNKCS204
099100                                                                  CNKCS204
099200/                                                                 CNKCS204
099300*----------------------------------------------------------------*CNKCS204
099400*    MARK EACH ITEM AS BEING NOT SELECTED.                       *CNKCS204
099500*----------------------------------------------------------------*CNKCS204
099600                                                                  CNKCS204
099700 2141-CLEAR-SELECTED-INDS.                                        CNKCS204
099800                                                                  CNKCS204
099900     IF  ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)          CNKCS204
100000             NOT EQUAL ZERO                                       CNKCS204
100100         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          CNKCS204
100200             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          CNKCS204
100300                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    CNKCS204
100400                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  CNKCS204
100500                                   TO TRUE                        CNKCS204
100600         END-IF                                                   CNKCS204
100700     END-IF.                                                      CNKCS204
100800                                                                  CNKCS204
100900/                                                                 CNKCS204
101000*----------------------------------------------------------------*CNKCS204
101100*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *CNKCS204
101200*  FOR ALL ITEMS.                                                *CNKCS204
101300*----------------------------------------------------------------*CNKCS204
101400                                                                  CNKCS204
101500 2150-SELECT-ALL-ITEMS.                                           CNKCS204
101600                                                                  CNKCS204
101700     MOVE +1                       TO ASC-BLK-SUB.                CNKCS204
101800                                                                  CNKCS204
101900     PERFORM 2151-SET-SELECTED-INDS                               CNKCS204
102000         VARYING ASC-ITEM-SUB                                     CNKCS204
102100         FROM 1 BY 1                                              CNKCS204
102200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 CNKCS204
102300                                                                  CNKCS204
102400     ADD +1                        TO ASC-BLK-SUB.                CNKCS204
102500                                                                  CNKCS204
102600     PERFORM 2151-SET-SELECTED-INDS                               CNKCS204
102700         VARYING ASC-ITEM-SUB                                     CNKCS204
102800         FROM 1 BY 1                                              CNKCS204
102900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 CNKCS204
103000                                                                  CNKCS204
103100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               CNKCS204
103200                                   TO PV-LIST-ITEM-NUMBER.        CNKCS204
103300                                                                  CNKCS204
103400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            CNKCS204
103500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    CNKCS204
103600                                                                  CNKCS204
103700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     CNKCS204
103800        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    CNKCS204
103900         MOVE +1                   TO ASC-BLK-SUB                 CNKCS204
104000                                                                  CNKCS204
104100         PERFORM 5100-WRITE-TEMP-STORAGE                          CNKCS204
104200                                                                  CNKCS204
104300         MOVE +1                   TO PV-BLOCK-NUMBER             CNKCS204
104400                                                                  CNKCS204
104500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         CNKCS204
104600             PV-FIRST-BLOCK-IN-ARRAY - 1                          CNKCS204
104700                                                                  CNKCS204
104800         PERFORM                                                  CNKCS204
104900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       CNKCS204
105000                                                                  CNKCS204
105100             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS204
105200                                                                  CNKCS204
105300             PERFORM 2151-SET-SELECTED-INDS                       CNKCS204
105400                 VARYING ASC-ITEM-SUB                             CNKCS204
105500                 FROM 1 BY 1                                      CNKCS204
105600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          CNKCS204
105700                                                                  CNKCS204
105800             PERFORM 5100-WRITE-TEMP-STORAGE                      CNKCS204
105900                                                                  CNKCS204
106000             ADD +1                TO PV-BLOCK-NUMBER             CNKCS204
106100         END-PERFORM                                              CNKCS204
106200                                                                  CNKCS204
106300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         CNKCS204
106400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     CNKCS204
106500                                                                  CNKCS204
106600         PERFORM                                                  CNKCS204
106700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       CNKCS204
106800                   ASC-HIGHEST-BLOCK-WRITTEN                      CNKCS204
106900                                                                  CNKCS204
107000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          CNKCS204
107100                                   TO PV-BLOCK-NUMBER             CNKCS204
107200                                                                  CNKCS204
107300             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS204
107400                                                                  CNKCS204
107500             PERFORM 2151-SET-SELECTED-INDS                       CNKCS204
107600                 VARYING ASC-ITEM-SUB                             CNKCS204
107700                 FROM 1 BY 1                                      CNKCS204
107800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          CNKCS204
107900                                                                  CNKCS204
108000             PERFORM 5100-WRITE-TEMP-STORAGE                      CNKCS204
108100                                                                  CNKCS204
108200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      CNKCS204
108300         END-PERFORM                                              CNKCS204
108400                                                                  CNKCS204
108500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             CNKCS204
108600                                   TO PV-BLOCK-NUMBER             CNKCS204
108700                                                                  CNKCS204
108800         PERFORM 4410-READ-TEMP-STORAGE                           CNKCS204
108900     END-IF.                                                      CNKCS204
109000                                                                  CNKCS204
109100                                                                  CNKCS204
109200     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             CNKCS204
109300          ASC-NUMBER-OF-SELECTED-ITEMS.                           CNKCS204
109400                                                                  CNKCS204
109500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        CNKCS204
109600                                                                  CNKCS204
109700/                                                                 CNKCS204
109800*----------------------------------------------------------------*CNKCS204
109900*    MARK EACH ITEM AS BEING SELECTED.                           *CNKCS204
110000*----------------------------------------------------------------*CNKCS204
110100                                                                  CNKCS204
110200 2151-SET-SELECTED-INDS.                                          CNKCS204
110300                                                                  CNKCS204
110400     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           CNKCS204
110500             NOT EQUAL ZERO                                       CNKCS204
110600         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             CNKCS204
110700             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             CNKCS204
110800                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        CNKCS204
110900                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  CNKCS204
111000                                   TO TRUE                        CNKCS204
111100         END-IF                                                   CNKCS204
111200     END-IF.                                                      CNKCS204
111300                                                                  CNKCS204
111400/                                                                 CNKCS204
111500*----------------------------------------------------------------*CNKCS204
111600*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *CNKCS204
111700*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *CNKCS204
111800*----------------------------------------------------------------*CNKCS204
111900 2200-MOVE-SCREEN-TO-COMMAREA.                                    CNKCS204
112000                                                                  CNKCS204
112100     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             CNKCS204
112200     MOVE +1                       TO PV-SUB.                     CNKCS204
112300                                                                  CNKCS204
112400     PERFORM 3100-SET-SUBSCRIPTS.                                 CNKCS204
112500                                                                  CNKCS204
112600     IF  ASTRTITL > ZERO                                          CNKCS204
112700         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      CNKCS204
112800     ELSE                                                         CNKCS204
112900         IF  ASTRTITF = DP015-ERASE-EOF                           CNKCS204
113000             INITIALIZE ASC-START-ITEM-REQUEST                    CNKCS204
113100         END-IF                                                   CNKCS204
113200     END-IF.                                                      CNKCS204
113300                                                                  CNKCS204
113400     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          CNKCS204
113500         VARYING PV-SUB                                           CNKCS204
113600         FROM 1 BY 1                                              CNKCS204
113700         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      CNKCS204
113800                                                                  CNKCS204
113900/                                                                 CNKCS204
114000*----------------------------------------------------------------*CNKCS204
114100*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *CNKCS204
114200*----------------------------------------------------------------*CNKCS204
114300 2210-MOVE-LINES-TO-COMMAREA.                                     CNKCS204
114400                                                                  CNKCS204
114500     IF  MR-SELECTL (PV-SUB) > ZERO                               CNKCS204
114600         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     CNKCS204
114700                                   TO TRUE                        CNKCS204
114800         MOVE MR-SELECT (PV-SUB)   TO ASC-TEMP-SELECTED-SW        CNKCS204
114900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      CNKCS204
115000     ELSE                                                         CNKCS204
115100         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                CNKCS204
115200             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         CNKCS204
115300             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        CNKCS204
115400                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      CNKCS204
115500         END-IF                                                   CNKCS204
115600     END-IF.                                                      CNKCS204
115700                                                                  CNKCS204
115800     ADD +1                        TO ASC-ITEM-SUB.               CNKCS204
115900                                                                  CNKCS204
116000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        CNKCS204
116100         ADD +1                    TO ASC-BLK-SUB                 CNKCS204
116200         MOVE +1                   TO ASC-ITEM-SUB                CNKCS204
116300     END-IF.                                                      CNKCS204
116400                                                                  CNKCS204
116500/                                                                 CNKCS204
116600*----------------------------------------------------------------*CNKCS204
116700*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *CNKCS204
116800*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *CNKCS204
116900*----------------------------------------------------------------*CNKCS204
117000 3000-EDIT-DATA-IN-COMMAREA.                                      CNKCS204
117100                                                                  CNKCS204
117200     SET PS-NO-ERROR               TO TRUE.                       CNKCS204
117300                                                                  CNKCS204
117400     PERFORM 3200-RESET-ATTRIBUTES.                               CNKCS204
117500                                                                  CNKCS204
117600     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     CNKCS204
117700**                                                                CNKCS204
117800* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              CNKCS204
117900* EDITTING IS DONE FROM THE BOTTOM UP.                            CNKCS204
118000**                                                                CNKCS204
118100     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       CNKCS204
118200         ASC-ITEMS-DISPLAYED - 1.                                 CNKCS204
118300                                                                  CNKCS204
118400     PERFORM 3100-SET-SUBSCRIPTS.                                 CNKCS204
118500     PERFORM 3300-EDIT-SELECTIONS                                 CNKCS204
118600         VARYING PV-SUB                                           CNKCS204
118700         FROM PV-SUB BY -1                                        CNKCS204
118800         UNTIL PV-SUB < +1                                        CNKCS204
118900                                                                  CNKCS204
119000     IF  PS-NO-ERROR                                              CNKCS204
119100         PERFORM 3400-CHECK-RANGE-SEQUENCE                        CNKCS204
119200     END-IF.                                                      CNKCS204
119300                                                                  CNKCS204
119400     IF  ((PS-NO-ERROR)                                           CNKCS204
119500       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   CNKCS204
119600       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    CNKCS204
119700             PERFORM 3500-MARK-RANGE-AS-SELECTED                  CNKCS204
119800     END-IF.                                                      CNKCS204
119900                                                                  CNKCS204
120000/                                                                 CNKCS204
120100*----------------------------------------------------------------*CNKCS204
120200*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *CNKCS204
120300*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*CNKCS204
120400*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *CNKCS204
120500*                                                                *CNKCS204
120600*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *CNKCS204
120700*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *CNKCS204
120800*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *CNKCS204
120900*    US IN THE 2ND BLOCK OF THE ARRAY.                           *CNKCS204
121000*----------------------------------------------------------------*CNKCS204
121100                                                                  CNKCS204
121200 3100-SET-SUBSCRIPTS.                                             CNKCS204
121300                                                                  CNKCS204
121400     COMPUTE ASC-ITEM-SUB =                                       CNKCS204
121500         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        CNKCS204
121600                                                                  CNKCS204
121700     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         CNKCS204
121800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            CNKCS204
121900                                                                  CNKCS204
122000         MOVE PC-MAX-BLOCKS-IN-ARRAY                              CNKCS204
122100                                   TO ASC-BLK-SUB                 CNKCS204
122200     ELSE                                                         CNKCS204
122300         MOVE +1                   TO ASC-BLK-SUB                 CNKCS204
122400     END-IF.                                                      CNKCS204
122500                                                                  CNKCS204
122600*----------------------------------------------------------------*CNKCS204
122700*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *CNKCS204
122800*----------------------------------------------------------------*CNKCS204
122900                                                                  CNKCS204
123000 3200-RESET-ATTRIBUTES.                                           CNKCS204
123100                                                                  CNKCS204
123200     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   CNKCS204
123300     MOVE DP015-GREEN              TO ASTRTITC.                   CNKCS204
123400     MOVE DP015-UNDERLINE          TO ASTRTITH.                   CNKCS204
123500                                                                  CNKCS204
123600     IF DP020-NEXT-ACT-RETURN                                     CNKCS204
123700         PERFORM                                                  CNKCS204
123800             VARYING PV-SUB                                       CNKCS204
123900             FROM 1 BY 1                                          CNKCS204
124000             UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                   CNKCS204
124100             MOVE DP015-UNP-ALP-NOR-OFF                           CNKCS204
124200                                   TO MR-SELECTA (PV-SUB)         CNKCS204
124300             MOVE DP015-GREEN      TO MR-SELECTC (PV-SUB)         CNKCS204
124400             MOVE DP015-UNDERLINE  TO MR-SELECTH (PV-SUB)         CNKCS204
124500         END-PERFORM                                              CNKCS204
124600     ELSE                                                         CNKCS204
124700         PERFORM                                                  CNKCS204
124800             VARYING PV-SUB                                       CNKCS204
124900             FROM 1 BY 1                                          CNKCS204
125000             UNTIL PV-SUB > PC-ITEMS-PER-PANEL                    CNKCS204
125100             MOVE DP015-UNP-ALP-NOR-OFF                           CNKCS204
125200                                   TO MR-SELECTA (PV-SUB)         CNKCS204
125300             MOVE DP015-GREEN      TO MR-SELECTC (PV-SUB)         CNKCS204
125400             MOVE DP015-UNDERLINE  TO MR-SELECTH (PV-SUB)         CNKCS204
125500         END-PERFORM                                              CNKCS204
125600     END-IF.                                                      CNKCS204
125700                                                                  CNKCS204
125800*----------------------------------------------------------------*CNKCS204
125900*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *CNKCS204
126000*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *CNKCS204
126100*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *CNKCS204
126200*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *CNKCS204
126300*----------------------------------------------------------------*CNKCS204
126400 3300-EDIT-SELECTIONS.                                            CNKCS204
126500                                                                  CNKCS204
126600     EVALUATE TRUE                                                CNKCS204
126700         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     CNKCS204
126800             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         CNKCS204
126900                 CONTINUE                                         CNKCS204
127000                                                                  CNKCS204
127100         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         CNKCS204
127200             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        CNKCS204
127300                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMSCNKCS204
127400                 MOVE ASC-TEMP-SELECTED-SW                        CNKCS204
127500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   CNKCS204
127600                                   TO ASC-SELECTED-SW             CNKCS204
127700                                     (ASC-BLK-SUB ASC-ITEM-SUB)   CNKCS204
127800             END-IF                                               CNKCS204
127900                                                                  CNKCS204
128000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     CNKCS204
128100                 = SPACE                                          CNKCS204
128200             EVALUATE TRUE                                        CNKCS204
128300                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       CNKCS204
128400                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMSCNKCS204
128500                     MOVE SPACE    TO ASC-SELECTED-SW             CNKCS204
128600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   CNKCS204
128700                                                                  CNKCS204
128800                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        CNKCS204
128900                     MOVE ZERO     TO ASC-START-OF-SELECTED-RANGE CNKCS204
129000                     MOVE SPACE    TO ASC-SELECTED-SW             CNKCS204
129100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   CNKCS204
129200                                                                  CNKCS204
129300                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          CNKCS204
129400                     MOVE ZERO     TO ASC-END-OF-SELECTED-RANGE   CNKCS204
129500                     MOVE SPACE    TO ASC-SELECTED-SW             CNKCS204
129600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   CNKCS204
129700             END-EVALUATE                                         CNKCS204
129800                                                                  CNKCS204
129900         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           CNKCS204
130000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            CNKCS204
130100                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    CNKCS204
130200             END-IF                                               CNKCS204
130300             PERFORM 3310-EDIT-RANGE                              CNKCS204
130400                                                                  CNKCS204
130500         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             CNKCS204
130600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            CNKCS204
130700                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    CNKCS204
130800             END-IF                                               CNKCS204
130900             PERFORM 3310-EDIT-RANGE                              CNKCS204
131000                                                                  CNKCS204
131100         WHEN OTHER                                               CNKCS204
131200             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            CNKCS204
131300             SET DP020-MSG-FATAL   TO TRUE                        CNKCS204
131400             MOVE -1               TO MR-SELECTL (PV-SUB)         CNKCS204
131500             SET DP030-SET-CURSOR-APPL-1                          CNKCS204
131600                                   TO TRUE                        CNKCS204
131700             MOVE DP015-RED        TO MR-SELECTC (PV-SUB)         CNKCS204
131800             MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB)         CNKCS204
131900             SET PS-ERROR          TO TRUE                        CNKCS204
132000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            CNKCS204
132100                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     CNKCS204
132200                 MOVE SPACE        TO ASC-SELECTED-SW             CNKCS204
132300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   CNKCS204
132400             END-IF                                               CNKCS204
132500     END-EVALUATE.                                                CNKCS204
132600                                                                  CNKCS204
132700     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             CNKCS204
132800     SUBTRACT +1 FROM ASC-ITEM-SUB.                               CNKCS204
132900                                                                  CNKCS204
133000     IF  ASC-ITEM-SUB < 1                                         CNKCS204
133100         SUBTRACT +1 FROM ASC-BLK-SUB                             CNKCS204
133200         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                CNKCS204
133300     END-IF.                                                      CNKCS204
133400                                                                  CNKCS204
133500*----------------------------------------------------------------*CNKCS204
133600*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *CNKCS204
133700*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *CNKCS204
133800*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *CNKCS204
133900*  THE ENDING.                                                   *CNKCS204
134000*----------------------------------------------------------------*CNKCS204
134100 3310-EDIT-RANGE.                                                 CNKCS204
134200                                                                  CNKCS204
134300     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                CNKCS204
134400         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   CNKCS204
134500             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)CNKCS204
134600                                   TO ASC-SELECTED-SW             CNKCS204
134700                                        (ASC-BLK-SUB ASC-ITEM-SUB)CNKCS204
134800             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE CNKCS204
134900         ELSE                                                     CNKCS204
135000             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     CNKCS204
135100                 CONTINUE                                         CNKCS204
135200             ELSE                                                 CNKCS204
135300*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        CNKCS204
135400                 MOVE PC-TSYMSG-00054                             CNKCS204
135500                                   TO DP020-MSG-NUMBER            CNKCS204
135600                 SET DP020-MSG-FATAL                              CNKCS204
135700                                   TO TRUE                        CNKCS204
135800                 MOVE -1           TO MR-SELECTL (PV-SUB)         CNKCS204
135900                 SET DP030-SET-CURSOR-APPL-1                      CNKCS204
136000                                   TO TRUE                        CNKCS204
136100                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         CNKCS204
136200                 MOVE DP015-UNDERLINE                             CNKCS204
136300                                   TO MR-SELECTH (PV-SUB)         CNKCS204
136400                 SET PS-ERROR      TO TRUE                        CNKCS204
136500             END-IF                                               CNKCS204
136600         END-IF                                                   CNKCS204
136700     ELSE                                                         CNKCS204
136800         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     CNKCS204
136900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS204
137000                                   TO ASC-SELECTED-SW             CNKCS204
137100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   CNKCS204
137200             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   CNKCS204
137300         ELSE                                                     CNKCS204
137400             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       CNKCS204
137500                 CONTINUE                                         CNKCS204
137600             ELSE                                                 CNKCS204
137700*                -- ONLY ONE END-OF-RANGE ALLOWED --              CNKCS204
137800                 MOVE PC-TSYMSG-00055                             CNKCS204
137900                                   TO DP020-MSG-NUMBER            CNKCS204
138000                 SET DP020-MSG-FATAL                              CNKCS204
138100                                   TO TRUE                        CNKCS204
138200                 MOVE -1           TO MR-SELECTL (PV-SUB)         CNKCS204
138300                 SET DP030-SET-CURSOR-APPL-1                      CNKCS204
138400                                   TO TRUE                        CNKCS204
138500                 SET PS-ERROR      TO TRUE                        CNKCS204
138600             END-IF                                               CNKCS204
138700         END-IF                                                   CNKCS204
138800     END-IF.                                                      CNKCS204
138900                                                                  CNKCS204
139000*----------------------------------------------------------------*CNKCS204
139100*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *CNKCS204
139200*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *CNKCS204
139300*----------------------------------------------------------------*CNKCS204
139400 3400-CHECK-RANGE-SEQUENCE.                                       CNKCS204
139500                                                                  CNKCS204
139600     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       CNKCS204
139700       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      CNKCS204
139800       AND  ASC-START-OF-SELECTED-RANGE >                         CNKCS204
139900                                         ASC-END-OF-SELECTED-RANGECNKCS204
140000*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                CNKCS204
140100         MOVE PC-TSYMSG-00052      TO DP020-MSG-NUMBER            CNKCS204
140200         SET DP020-MSG-FATAL       TO TRUE                        CNKCS204
140300         SET PS-ERROR              TO TRUE                        CNKCS204
140400         PERFORM 3410-POSITION-AT-ERROR                           CNKCS204
140500     END-IF.                                                      CNKCS204
140600                                                                  CNKCS204
140700*----------------------------------------------------------------*CNKCS204
140800*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *CNKCS204
140900*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *CNKCS204
141000*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *CNKCS204
141100*----------------------------------------------------------------*CNKCS204
141200 3410-POSITION-AT-ERROR.                                          CNKCS204
141300                                                                  CNKCS204
141400     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       CNKCS204
141500                                                                  CNKCS204
141600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 CNKCS204
141700                    - PV-TOP-ITEM + 1.                            CNKCS204
141800                                                                  CNKCS204
141900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      CNKCS204
142000         CONTINUE                                                 CNKCS204
142100     ELSE                                                         CNKCS204
142200         MOVE -1                   TO MR-SELECTL (PV-SUB)         CNKCS204
142300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         CNKCS204
142400         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         CNKCS204
142500     END-IF.                                                      CNKCS204
142600                                                                  CNKCS204
142700     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   CNKCS204
142800                    - PV-TOP-ITEM + 1.                            CNKCS204
142900                                                                  CNKCS204
143000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      CNKCS204
143100         CONTINUE                                                 CNKCS204
143200     ELSE                                                         CNKCS204
143300         MOVE -1                   TO MR-SELECTL (PV-SUB)         CNKCS204
143400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         CNKCS204
143500         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         CNKCS204
143600     END-IF.                                                      CNKCS204
143700                                                                  CNKCS204
143800/                                                                 CNKCS204
143900*----------------------------------------------------------------*CNKCS204
144000*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *CNKCS204
144100*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *CNKCS204
144200*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *CNKCS204
144300*----------------------------------------------------------------*CNKCS204
144400                                                                  CNKCS204
144500 3500-MARK-RANGE-AS-SELECTED.                                     CNKCS204
144600                                                                  CNKCS204
144700     MOVE +1                       TO ASC-BLK-SUB.                CNKCS204
144800                                                                  CNKCS204
144900     PERFORM 3510-MARK-SELECTED-INDS                              CNKCS204
145000         VARYING ASC-ITEM-SUB                                     CNKCS204
145100         FROM 1 BY 1                                              CNKCS204
145200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 CNKCS204
145300                                                                  CNKCS204
145400     ADD +1                        TO ASC-BLK-SUB.                CNKCS204
145500                                                                  CNKCS204
145600     PERFORM 3510-MARK-SELECTED-INDS                              CNKCS204
145700         VARYING ASC-ITEM-SUB                                     CNKCS204
145800         FROM 1 BY 1                                              CNKCS204
145900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 CNKCS204
146000                                                                  CNKCS204
146100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               CNKCS204
146200                                   TO PV-LIST-ITEM-NUMBER.        CNKCS204
146300                                                                  CNKCS204
146400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            CNKCS204
146500         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         CNKCS204
146600               PC-ITEMS-PER-PANEL).                               CNKCS204
146700                                                                  CNKCS204
146800     MOVE ASC-START-OF-SELECTED-RANGE                             CNKCS204
146900                                   TO PV-START-OF-SELECTED-RANGE. CNKCS204
147000                                                                  CNKCS204
147100     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            CNKCS204
147200         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  CNKCS204
147300               PC-ITEMS-PER-PANEL).                               CNKCS204
147400                                                                  CNKCS204
147500     MOVE ASC-END-OF-SELECTED-RANGE                               CNKCS204
147600                                   TO PV-END-OF-SELECTED-RANGE.   CNKCS204
147700                                                                  CNKCS204
147800     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             CNKCS204
147900         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    CNKCS204
148000               PC-ITEMS-PER-PANEL).                               CNKCS204
148100                                                                  CNKCS204
148200     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             CNKCS204
148300         PV-FIRST-BLOCK-IN-ARRAY + 1.                             CNKCS204
148400                                                                  CNKCS204
148500     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    CNKCS204
148600        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        CNKCS204
148700         MOVE +1                   TO ASC-BLK-SUB                 CNKCS204
148800         PERFORM 5100-WRITE-TEMP-STORAGE                          CNKCS204
148900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         CNKCS204
149000             PV-FIRST-BLOCK-IN-ARRAY - 1                          CNKCS204
149100                                                                  CNKCS204
149200         PERFORM                                                  CNKCS204
149300             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      CNKCS204
149400                   PV-PREV-BLOCK-IN-ARRAY                         CNKCS204
149500             MOVE PV-FIRST-BLOCK-IN-RANGE                         CNKCS204
149600                                   TO PV-BLOCK-NUMBER             CNKCS204
149700             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS204
149800             PERFORM 3510-MARK-SELECTED-INDS                      CNKCS204
149900                 VARYING ASC-ITEM-SUB                             CNKCS204
150000                 FROM 1 BY 1                                      CNKCS204
150100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          CNKCS204
150200             PERFORM 5100-WRITE-TEMP-STORAGE                      CNKCS204
150300             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     CNKCS204
150400         END-PERFORM                                              CNKCS204
150500                                                                  CNKCS204
150600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         CNKCS204
150700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     CNKCS204
150800         PERFORM                                                  CNKCS204
150900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       CNKCS204
151000                   PV-LAST-BLOCK-IN-RANGE                         CNKCS204
151100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          CNKCS204
151200                                   TO PV-BLOCK-NUMBER             CNKCS204
151300             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS204
151400             PERFORM 3510-MARK-SELECTED-INDS                      CNKCS204
151500                 VARYING ASC-ITEM-SUB                             CNKCS204
151600                 FROM 1 BY 1                                      CNKCS204
151700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          CNKCS204
151800             PERFORM 5100-WRITE-TEMP-STORAGE                      CNKCS204
151900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      CNKCS204
152000         END-PERFORM                                              CNKCS204
152100                                                                  CNKCS204
152200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             CNKCS204
152300                                   TO PV-BLOCK-NUMBER             CNKCS204
152400         PERFORM 4410-READ-TEMP-STORAGE                           CNKCS204
152500     END-IF.                                                      CNKCS204
152600                                                                  CNKCS204
152700     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE CNKCS204
152800                                      ASC-END-OF-SELECTED-RANGE.  CNKCS204
152900                                                                  CNKCS204
153000/                                                                 CNKCS204
153100*----------------------------------------------------------------*CNKCS204
153200* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *CNKCS204
153300*----------------------------------------------------------------*CNKCS204
153400                                                                  CNKCS204
153500 3510-MARK-SELECTED-INDS.                                         CNKCS204
153600                                                                  CNKCS204
153700     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) >         CNKCS204
153800         ASC-START-OF-SELECTED-RANGE)                             CNKCS204
153900     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =         CNKCS204
154000         ASC-START-OF-SELECTED-RANGE)                             CNKCS204
154100                                                                  CNKCS204
154200         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     CNKCS204
154300             ASC-END-OF-SELECTED-RANGE)                           CNKCS204
154400         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     CNKCS204
154500             ASC-END-OF-SELECTED-RANGE)                           CNKCS204
154600                                                                  CNKCS204
154700             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          CNKCS204
154800                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   CNKCS204
154900                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   CNKCS204
155000                                   TO TRUE                        CNKCS204
155100                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              CNKCS204
155200                                   TO TRUE                        CNKCS204
155300                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMSCNKCS204
155400             END-IF                                               CNKCS204
155500         END-IF                                                   CNKCS204
155600     END-IF.                                                      CNKCS204
155700                                                                  CNKCS204
155800/                                                                 CNKCS204
155900*----------------------------------------------------------------*CNKCS204
156000*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *CNKCS204
156100*    INITIALIZE ALL COUNTERS AND FLAGS.                          *CNKCS204
156200*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *CNKCS204
156300*    DISPLAY THE PANEL TO USER.                                  *CNKCS204
156400*----------------------------------------------------------------*CNKCS204
156500                                                                  CNKCS204
156600 4000-BUILD-INITIAL-PANEL.                                        CNKCS204
156700                                                                  CNKCS204
156800     INITIALIZE ASC-BLOCK-ENTRIES (1)                             CNKCS204
156900                ASC-BLOCK-ENTRIES (2).                            CNKCS204
157000                                                                  CNKCS204
157100     MOVE +1                       TO ASC-BLK-SUB.                CNKCS204
157200                                                                  CNKCS204
157300     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       CNKCS204
157400                                                                  CNKCS204
157500     MOVE +0                       TO ASC-ITEM-SUB                CNKCS204
157600                                      ASC-NUMBER-OF-ITEMS-READ    CNKCS204
157700                                      ASC-NUMBER-OF-SELECTED-ITEMSCNKCS204
157800                                      ASC-HIGHEST-BLOCK-WRITTEN   CNKCS204
157900                                      ASC-START-OF-SELECTED-RANGE CNKCS204
158000                                      ASC-END-OF-SELECTED-RANGE   CNKCS204
158100                                      ASC-ITEM-AT-TOP-OF-PANEL.   CNKCS204
158200                                                                  CNKCS204
158300     PERFORM 4100-PREPARE-CURSOR.                                 CNKCS204
158400                                                                  CNKCS204
158500     PERFORM 4010-OPEN-CURSOR.                                    CNKCS204
158600                                                                  CNKCS204
158700     PERFORM 4300-READ-ITEMS-FROM-DB.                             CNKCS204
158800                                                                  CNKCS204
158900     PERFORM 4020-CLOSE-CURSOR.                                   CNKCS204
159000                                                                  CNKCS204
159100     MOVE +1                       TO PV-TOP-ITEM.                CNKCS204
159200                                                                  CNKCS204
159300     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          CNKCS204
159400         SET DP020-NEXT-ACT-APPL-ERROR                            CNKCS204
159500                                   TO TRUE                        CNKCS204
159600         SET DP020-MSG-FATAL       TO TRUE                        CNKCS204
159700         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            CNKCS204
159800     ELSE                                                         CNKCS204
159900         MOVE -1                   TO MR-SELECTL (1)              CNKCS204
160000         SET DP030-SET-CURSOR-APPL-1                              CNKCS204
160100                                   TO TRUE                        CNKCS204
160200         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     CNKCS204
160300     END-IF.                                                      CNKCS204
160400                                                                  CNKCS204
160500/                                                                 CNKCS204
160600*----------------------------------------------------------------*CNKCS204
160700* OPEN THE FACILITY CURSOR.                                      *CNKCS204
160800*----------------------------------------------------------------*CNKCS204
160900                                                                  CNKCS204
161000 4010-OPEN-CURSOR.                                                CNKCS204
161100                                                                  CNKCS204
161200     PERFORM                                                      CNKCS204
161300         WITH TEST AFTER                                          CNKCS204
161400         VARYING PV-RETRY-COUNTER                                 CNKCS204
161500         FROM 1 BY 1                                              CNKCS204
161600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS204
161700            OR (SQLCODE = +0))                                    CNKCS204
161800                                                                  CNKCS204
161900         EXEC SQL                                                 CNKCS204
162000             OPEN DEPT-CL-NBR-CSR                                    CL**3
162100         END-EXEC                                                 CNKCS204
162200                                                                  CNKCS204
162300         EVALUATE TRUE                                            CNKCS204
162400             WHEN SQLCODE = +0                                    CNKCS204
162500                  CONTINUE                                        CNKCS204
162600             WHEN SQLCODE = -904                                  CNKCS204
162700             WHEN SQLCODE = -913                                  CNKCS204
162800                  CONTINUE                                        CNKCS204
162900             WHEN SQLWARN0 NOT = SPACE                            CNKCS204
163000             WHEN SQLCODE  NOT = +0                               CNKCS204
163100                  MOVE '4010-OPEN-CURSOR'                         CNKCS204
163200                                   TO DP013-PARAGRAPH             CNKCS204
163300                  MOVE 'OPEN DEPT-CL-NBR-CSR CURSOR'                 CL**3
163400                                   TO DP013-MESSAGE-TEXT (1)      CNKCS204
163500                  MOVE SQLCA       TO DP013-SQLCA                 CNKCS204
163600                  MOVE 'TFLAREA'   TO DP013-DB2-TABLE-NAME (1)       CL**3
163700                  SET DP013-DB2-ABEND                             CNKCS204
163800                                   TO TRUE                        CNKCS204
163900                  PERFORM DP013-0000-PROCESS-ABEND                CNKCS204
164000         END-EVALUATE                                             CNKCS204
164100     END-PERFORM.                                                 CNKCS204
164200                                                                  CNKCS204
164300     IF  PV-SQL-SUB > PC-MAX-RETRIES                              CNKCS204
164400         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             CNKCS204
164500         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              CNKCS204
164600                                   TO DP013-MESSAGE-TEXT (1)      CNKCS204
164700         MOVE SQLCA                TO DP013-SQLCA                 CNKCS204
164800         SET DP013-DB2-ABEND       TO TRUE                        CNKCS204
164900         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS204
165000     END-IF.                                                      CNKCS204
165100                                                                  CNKCS204
165200/                                                                 CNKCS204
165300*----------------------------------------------------------------*CNKCS204
165400* CLOSE THE FACILITY CURSOR.                                     *CNKCS204
165500*----------------------------------------------------------------*CNKCS204
165600                                                                  CNKCS204
165700 4020-CLOSE-CURSOR.                                               CNKCS204
165800                                                                  CNKCS204
165900     EXEC SQL                                                     CNKCS204
166000         CLOSE DEPT-CL-NBR-CSR                                       CL**3
166100     END-EXEC.                                                    CNKCS204
166200                                                                  CNKCS204
166300     EVALUATE TRUE                                                CNKCS204
166400         WHEN SQLCODE = +0                                        CNKCS204
166500              CONTINUE                                            CNKCS204
166600         WHEN SQLWARN0 NOT = SPACE                                CNKCS204
166700         WHEN SQLCODE  NOT = +0                                   CNKCS204
166800              MOVE '4020-CLOSE-CURSOR'                            CNKCS204
166900                                   TO DP013-PARAGRAPH             CNKCS204
167000              MOVE 'CLOSE DEPT-CL-NBR-CSR CURSOR'                    CL**3
167100                                   TO DP013-MESSAGE-TEXT (1)      CNKCS204
167200              MOVE SQLCA           TO DP013-SQLCA                 CNKCS204
167300              MOVE 'TFLAREA'       TO DP013-DB2-TABLE-NAME (1)       CL**3
167400              SET DP013-DB2-ABEND  TO TRUE                        CNKCS204
167500              PERFORM DP013-0000-PROCESS-ABEND                    CNKCS204
167600     END-EVALUATE.                                                CNKCS204
167700                                                                  CNKCS204
167800/                                                                 CNKCS204
167900*----------------------------------------------------------------*CNKCS204
168000*    DEPENDING ON WHAT WAS PASSED IN THE COMMAREA, SETUP THE     *CNKCS204
168100*    DB2 KEYS IN PREPARATION FOR THE OPEN CURSROR.               *CNKCS204
168200*----------------------------------------------------------------*CNKCS204
168300                                                                  CNKCS204
168400 4100-PREPARE-CURSOR.                                             CNKCS204
168500                                                                  CNKCS204
168600     IF DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT           CNKCS204
168700        IF CN001-FCLTY-ID > ZEROES                                   CL**8
168800           MOVE CN001-FCLTY-ID        TO DK-FCLTY-ID-LOW             CL**8
168900                                         DK-FCLTY-ID-HIGH            CL**8
169000                                         DK-FCLTY-ID                 CL**8
169100        ELSE                                                         CL**8
169200           MOVE ZEROES                TO DK-FCLTY-ID-LOW             CL**8
169300                                         DK-FCLTY-ID                 CL**8
169400           MOVE 9999                  TO DK-FCLTY-ID-HIGH            CL**8
169500        END-IF                                                       CL**8
169600        IF CN001-AREA-ID > SPACES                                    CL**3
169700           MOVE CN001-AREA-ID         TO DK-AREA-ID-LOW              CL**3
169800                                         DK-AREA-ID-HIGH             CL**3
169900        ELSE                                                      CNKCS204
170000           IF CN001-SEL-UNASSIGNED = 'Y'                          CNKCS204
170100              MOVE '######'           TO DK-AREA-ID-LOW              CL**3
170200                                         DK-AREA-ID-HIGH             CL**3
170300           ELSE                                                   CNKCS204
170400              MOVE SPACES             TO DK-AREA-ID-LOW              CL**3
170500              MOVE '999999'           TO DK-AREA-ID-HIGH             CL**3
170600           END-IF                                                 CNKCS204
170700        END-IF                                                    CNKCS204
170800        IF CN001-LOC-TYPE > SPACES                                CNKCS204
170900           MOVE CN001-LOC-TYPE        TO DK-TYPE-LOW              CNKCS204
171000                                         DK-TYPE-HIGH             CNKCS204
171100        ELSE                                                      CNKCS204
171200           MOVE SPACES                TO DK-TYPE-LOW              CNKCS204
171300           MOVE '99'                  TO DK-TYPE-HIGH             CNKCS204
171400        END-IF                                                    CNKCS204
171500        IF CN001-DEPT-NBR > SPACES                                   CL**3
171600           MOVE CN001-DEPT-NBR        TO DK-DEPT-NBR-LOW             CL**3
171700                                         DK-DEPT-NBR-HIGH            CL**3
171800        ELSE                                                      CNKCS204
171900           MOVE SPACES                TO DK-DEPT-NBR-LOW             CL**3
172000           MOVE '999'                 TO DK-DEPT-NBR-HIGH            CL**3
172100        END-IF                                                    CNKCS204
172200     ELSE                                                         CNKCS204
172300        IF ASC-KEY-FCLTY-ID-LOW > ZEROES                             CL**8
172400           MOVE ASC-KEY-FCLTY-ID-LOW  TO DK-FCLTY-ID-LOW             CL**8
172500        ELSE                                                         CL**8
172600           MOVE ZEROES                TO DK-FCLTY-ID-LOW             CL**8
172700        END-IF                                                       CL**8
172800        IF ASC-KEY-FCLTY-ID-HIGH > ZEROES                            CL**8
172900           MOVE ASC-KEY-FCLTY-ID-HIGH TO DK-FCLTY-ID-HIGH            CL**8
173000        ELSE                                                         CL**8
173100           MOVE 9999                  TO DK-FCLTY-ID-HIGH            CL**8
173200        END-IF                                                       CL**8
173300        IF ASC-KEY-AREA-ID-LOW > SPACES                              CL**3
173400           MOVE ASC-KEY-AREA-ID-LOW   TO DK-AREA-ID-LOW              CL**3
173500        ELSE                                                      CNKCS204
173600           MOVE SPACES                TO DK-AREA-ID-LOW              CL**3
173700        END-IF                                                    CNKCS204
173800        IF ASC-KEY-AREA-ID-HIGH > SPACES                             CL**3
173900           MOVE ASC-KEY-AREA-ID-HIGH TO DK-AREA-ID-HIGH              CL**3
174000        ELSE                                                      CNKCS204
174100           MOVE '999999'              TO DK-AREA-ID-HIGH             CL**3
174200        END-IF                                                    CNKCS204
174300        IF ASC-KEY-TYPE-LOW > SPACES                              CNKCS204
174400           MOVE ASC-KEY-TYPE-LOW      TO DK-TYPE-LOW              CNKCS204
174500        ELSE                                                      CNKCS204
174600           MOVE SPACES                TO DK-TYPE-LOW              CNKCS204
174700        END-IF                                                    CNKCS204
174800        IF ASC-KEY-TYPE-HIGH > SPACES                             CNKCS204
174900           MOVE ASC-KEY-TYPE-HIGH     TO DK-TYPE-HIGH             CNKCS204
175000        ELSE                                                      CNKCS204
175100           MOVE '99'                  TO DK-TYPE-HIGH             CNKCS204
175200        END-IF                                                    CNKCS204
175300        IF ASC-KEY-DEPT-NBR-LOW > SPACES                             CL**3
175400           MOVE ASC-KEY-DEPT-NBR-LOW  TO DK-DEPT-NBR-LOW             CL**3
175500        ELSE                                                      CNKCS204
175600           MOVE SPACES                TO DK-DEPT-NBR-LOW             CL**3
175700        END-IF                                                    CNKCS204
175800        IF ASC-KEY-DEPT-NBR-HIGH > SPACES                            CL**3
175900           MOVE ASC-KEY-DEPT-NBR-HIGH TO DK-DEPT-NBR-HIGH            CL**3
176000        ELSE                                                      CNKCS204
176100           MOVE '999'                 TO DK-DEPT-NBR-HIGH            CL**3
176200        END-IF                                                    CNKCS204
176300     END-IF.                                                      CNKCS204
176400                                                                  CNKCS204
176500/                                                                 CNKCS204
176600*----------------------------------------------------------------*CNKCS204
176700*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *CNKCS204
176800*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *CNKCS204
176900*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *CNKCS204
177000*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *CNKCS204
177100*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *CNKCS204
177200*                                                                *CNKCS204
177300*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *CNKCS204
177400*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *CNKCS204
177500*    UPON INITIALIZATION.                                        *CNKCS204
177600*----------------------------------------------------------------*CNKCS204
177700                                                                  CNKCS204
177800 4300-READ-ITEMS-FROM-DB.                                         CNKCS204
177900                                                                  CNKCS204
178000     PERFORM 4320-GET-STORE-INFORMATION.                             CL**3
178100                                                                  CNKCS204
178200     PERFORM                                                      CNKCS204
178300         VARYING PV-READ-COUNT                                    CNKCS204
178400         FROM 1 BY 1                                              CNKCS204
178500         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    CNKCS204
178600            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         CNKCS204
178700                                                                  CNKCS204
178800         PERFORM 4310-FETCH                                       CNKCS204
178900                                                                  CNKCS204
179000         IF  ASC-ITEMS-LEFT-ON-DB                                 CNKCS204
179100             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                CNKCS204
179200                 ADD +1            TO ASC-ITEM-SUB                CNKCS204
179300             ELSE                                                 CNKCS204
179400                 ADD +1            TO ASC-BLK-SUB                 CNKCS204
179500                 MOVE +1           TO ASC-ITEM-SUB                CNKCS204
179600                                                                  CNKCS204
179700                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         CNKCS204
179800                     MOVE +1       TO ASC-BLK-SUB                 CNKCS204
179900                     SET ASC-BLOCK-MODIFIED (1)                   CNKCS204
180000                                   TO TRUE                        CNKCS204
180100                     PERFORM 5100-WRITE-TEMP-STORAGE              CNKCS204
180200                     MOVE ASC-BLOCK-ENTRIES                       CNKCS204
180300                               (PC-MAX-BLOCKS-IN-ARRAY)           CNKCS204
180400                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) CNKCS204
180500                     ADD +1        TO ASC-BLK-SUB                 CNKCS204
180600                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   CNKCS204
180700                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      CNKCS204
180800                                   TO TRUE                        CNKCS204
180900                 END-IF                                           CNKCS204
181000             END-IF                                               CNKCS204
181100             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    CNKCS204
181200             MOVE ASC-NUMBER-OF-ITEMS-READ                        CNKCS204
181300                                   TO ASC-LIST-ITEM-NUMBER        CNKCS204
181400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  CNKCS204
181500             MOVE DCFAAS-FCLTY-ID  TO ASC-FCLTY-ID                   CL*12
181600                                       (ASC-BLK-SUB ASC-ITEM-SUB)    CL**8
181700             MOVE DCFAAS-DEPT-NBR  TO ASC-DEPT-NBR                   CL*12
181800                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS204
181900             MOVE DCFAAS-CL-NBR TO ASC-CL-NBR                        CL*12
182000                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS204
182100             MOVE DCFAAS-RANK-NBR  TO ASC-RANK                       CL*12
182200                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS204
182300             IF DN-FCLTY-AREA-ID = -1                                CL**3
182400                MOVE SPACES        TO ASC-AREA-ID                    CL**3
182500                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS204
182600                                      ASC-DESC                    CNKCS204
182700                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS204
182800             ELSE                                                 CNKCS204
182900                MOVE DCFAAS-FCLTY-AREA-ID                            CL*12
183000                                   TO ASC-AREA-ID                    CL**3
183100                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS204
183200                PERFORM 4330-SELECT-TFLAREA                          CL**3
183300                MOVE FLAREA-FCLTY-AREA-DESC                          CL**3
183400                                   TO ASC-DESC                    CNKCS204
183500                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS204
183600             END-IF                                               CNKCS204
183700             MOVE DCFAAS-FCLTY-LOC-TYP-CDE                           CL*12
183800                                   TO ASC-TYPE                    CNKCS204
183900                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS204
184000         END-IF                                                   CNKCS204
184100         MOVE ASC-KEY-OPER-UNT-ID  TO ASC-OPER-UNT-ID                CL**3
184200                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS204
184300     END-PERFORM.                                                 CNKCS204
184400                                                                  CNKCS204
184500     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          CNKCS204
184600         MOVE +1                   TO ASC-BLK-SUB                 CNKCS204
184700         PERFORM 5100-WRITE-TEMP-STORAGE                          CNKCS204
184800         ADD +1                    TO ASC-BLK-SUB                 CNKCS204
184900         PERFORM 5100-WRITE-TEMP-STORAGE                          CNKCS204
185000                                                                  CNKCS204
185100         MOVE 1                    TO ASC-BLK-SUB                 CNKCS204
185200                                      PV-BLOCK-NUMBER             CNKCS204
185300         PERFORM 4410-READ-TEMP-STORAGE                           CNKCS204
185400         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             CNKCS204
185500             MOVE 2                TO ASC-BLK-SUB                 CNKCS204
185600                                      PV-BLOCK-NUMBER             CNKCS204
185700             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS204
185800         END-IF                                                   CNKCS204
185900     END-IF.                                                      CNKCS204
186000                                                                  CNKCS204
186100/                                                                 CNKCS204
186200*----------------------------------------------------------------*CNKCS204
186300*    FETCH THE DEPT/CLASS FACILITY CURSOR.                       *CNKCS204
186400*----------------------------------------------------------------*CNKCS204
186500                                                                  CNKCS204
186600 4310-FETCH.                                                      CNKCS204
186700                                                                  CNKCS204
186800     EXEC SQL                                                     CNKCS204
186900         FETCH DEPT-CL-NBR-CSR                                       CL**3
187000          INTO :DCFAAS-OPER-UNT-ID                                   CL*12
187100              ,:DCFAAS-FCLTY-ID                                      CL*12
187200              ,:DCFAAS-DEPT-NBR                                      CL*12
187300              ,:DCFAAS-CL-NBR                                        CL*12
187400              ,:DCFAAS-RANK-NBR                                      CL*12
187500              ,:DCFAAS-FCLTY-AREA-ID                                 CL*12
187600                 :DN-FCLTY-AREA-ID                                   CL**3
187700              ,:DCFAAS-FCLTY-LOC-TYP-CDE                             CL*12
187800     END-EXEC.                                                    CNKCS204
187900                                                                  CNKCS204
188000     EVALUATE TRUE                                                CNKCS204
188100         WHEN SQLCODE = +0                                        CNKCS204
188200              CONTINUE                                            CNKCS204
188300         WHEN SQLCODE = +100                                      CNKCS204
188400              SET ASC-NO-ITEMS-LEFT-ON-DB                         CNKCS204
188500                                   TO TRUE                        CNKCS204
188600         WHEN SQLWARN0 NOT = SPACE                                CNKCS204
188700         WHEN SQLCODE < +0                                        CNKCS204
188800         WHEN SQLCODE > +0                                        CNKCS204
188900              MOVE '4310-FETCH-CURSOR'                            CNKCS204
189000                                   TO DP013-PARAGRAPH             CNKCS204
189100              MOVE 'FETCH DEPT/CLASS CURSOR'                      CNKCS204
189200                                   TO DP013-MESSAGE-TEXT (1)      CNKCS204
189300              MOVE SQLCA           TO DP013-SQLCA                 CNKCS204
189400              MOVE 'TDCFAAS'       TO DP013-DB2-TABLE-NAME (1)       CL*12
189500              SET DP013-DB2-ABEND  TO TRUE                        CNKCS204
189600              PERFORM DP013-0000-PROCESS-ABEND                    CNKCS204
189700     END-EVALUATE.                                                CNKCS204
189800                                                                  CNKCS204
189900/                                                                 CNKCS204
190000                                                                  CNKCS204
190100                                                                  18470003
190200****************************************************************  18480003
190300*    THIS PARAGRAPH RETRIEVES THE STORE INFORMATION.           *  18490003
190400*                                                              *  18500003
190500****************************************************************  18510003
190600                                                                  18520003
190700 4320-GET-STORE-INFORMATION.                                      18530003
190800                                                                  18540003
190900     INITIALIZE XL071-COMMAREA.                                   18550003
191000     MOVE DK-OPER-UNT-ID TO XL071-LOCATION-NUMBER.                18560003
191100                                                                  18570003
191200     CALL XL071-LOCATION-MODULE USING                             18580003
191300                                DFHEIBLK                          18590003
191400                                XL071-COMMAREA                    18600003
191500                                XL071-COMMAREA-REC.               18610003
191600                                                                  18620003
191700     EVALUATE TRUE                                                18630003
191800         WHEN XL071-NO-ERRORS                                     18640003
191900         WHEN XL071-DC-ASGMT-NOT-FND                              18650003
192000              MOVE XL071-LOC-NM TO ASC-FCLTY-NME                  18660003
192100                                                                  18670003
192200         WHEN XL071-LOC-NOT-FOUND                                 18680003
192300              MOVE SPACES       TO ASC-FCLTY-NME                  18690003
192400                                                                  18700003
192500         WHEN OTHER                                               18710003
192600              MOVE '4320-GET-STORE-INFORMATION'                   18720003
192700                                  TO DP013-PARAGRAPH              18730003
192710              STRING 'SELECT STORE NUMBER - '                             
192720                      XL071-LOCATION-NUMBER                               
192730                     ' - BAD RETURN CODE FROM XLKUT071 - '                
192740                      XL071-RETURN-CODE                                   
192750                      DELIMITED BY SIZE                                   
192760                      INTO DP013-MESSAGE-TEXT (1)                         
192770              STRING 'BAD SQLCODE - '                                     
192780                      XL071-SQLCODE                                       
192790                     ' - '                                                
192791                      XL071-DB2-TABLE                                     
192792                      DELIMITED BY SIZE                                   
192793                      INTO DP013-MESSAGE-TEXT (2)                         
192794              MOVE XL071-SQLCA     TO DP013-SQLCA                         
192795              MOVE XL071-DB2-TABLE TO DP013-DB2-TABLE-NAME (1)            
193400              MOVE XL071-SQLCODE TO SQLCODE                       18800003
193700              SET DP013-DB2-ABEND                                 18830003
193800                  DP013-XCTL-DISPLAY-RESTART TO TRUE              18840003
193900              PERFORM DP013-0000-PROCESS-ABEND                    18850003
194000                                                                  18860003
194100     END-EVALUATE.                                                18870003
194200/                                                                 CNKCS204
194300*----------------------------------------------------------------*CNKCS204
194400*    READ FACILITY LOCATION TABLE                                *CNKCS204
194500*----------------------------------------------------------------*CNKCS204
194600                                                                  CNKCS204
194700 4330-SELECT-TFLAREA.                                                CL**3
194800                                                                  CNKCS204
194900     PERFORM                                                      CNKCS204
195000         WITH TEST AFTER                                          CNKCS204
195100         VARYING PV-RETRY-COUNTER                                 CNKCS204
195200         FROM 1 BY 1                                              CNKCS204
195300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS204
195400            OR  (SQLCODE = +0))                                   CNKCS204
195500                                                                  CNKCS204
195600         EXEC SQL                                                 CNKCS204
195700             SELECT FCLTY_AREA_DESC                                  CL**3
195800              INTO :FLAREA-FCLTY-AREA-DESC                           CL**3
195900              FROM TFLAREA                                           CL**3
196000             WHERE OPER_UNT_ID   = :DCFAAS-OPER-UNT-ID               CL*12
196100               AND FCLTY_ID      = :DCFAAS-FCLTY-ID                  CL*12
196200               AND FCLTY_AREA_ID = :DCFAAS-FCLTY-AREA-ID             CL*12
196300         END-EXEC                                                 CNKCS204
196400                                                                  CNKCS204
196500         EVALUATE TRUE                                            CNKCS204
196600             WHEN SQLCODE = +0                                    CNKCS204
196700             WHEN SQLCODE = -904                                  CNKCS204
196800             WHEN SQLCODE = -913                                  CNKCS204
196900                  CONTINUE                                        CNKCS204
197000             WHEN SQLWARN0 NOT = SPACE                            CNKCS204
197100             WHEN SQLCODE < +0                                    CNKCS204
197200             WHEN SQLCODE > +0                                    CNKCS204
197300                  MOVE '4330-SELECT-TFLAREA'                         CL**3
197400                                   TO DP013-PARAGRAPH             CNKCS204
197500                  MOVE 'SELECT ON TFLAREA'                           CL**3
197600                                   TO DP013-MESSAGE-TEXT (1)      CNKCS204
197700                  MOVE SQLCA       TO DP013-SQLCA                 CNKCS204
197800                  MOVE 'TFLAREA'   TO DP013-DB2-TABLE-NAME (1)       CL**3
197900                  SET DP013-DB2-ABEND                             CNKCS204
198000                      DP013-XCTL-DISPLAY-RESTART                  CNKCS204
198100                                   TO TRUE                        CNKCS204
198200                  PERFORM DP013-0000-PROCESS-ABEND                CNKCS204
198300         END-EVALUATE                                             CNKCS204
198400     END-PERFORM.                                                 CNKCS204
198500                                                                  CNKCS204
198600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS204
198700         MOVE '4330-SELECT-TFLAREA'                                  CL**3
198800                                   TO DP013-PARAGRAPH             CNKCS204
198900         MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                   CNKCS204
199000                                   TO DP013-MESSAGE-TEXT (1)      CNKCS204
199100         MOVE 'ON TABLE TFLAREA '  TO DP013-MESSAGE-TEXT (2)         CL**3
199200         MOVE SQLCA                TO DP013-SQLCA                 CNKCS204
199300         SET DP013-DB2-ABEND                                      CNKCS204
199400             DP013-XCTL-DISPLAY-RESTART                           CNKCS204
199500                                   TO TRUE                        CNKCS204
199600         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS204
199700     END-IF.                                                      CNKCS204
199800                                                                  CNKCS204
199900/                                                                 CNKCS204
200000*----------------------------------------------------------------*CNKCS204
200100* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *CNKCS204
200200*----------------------------------------------------------------*CNKCS204
200300                                                                  CNKCS204
200400 4400-MOVE-COMMAREA-TO-SCREEN.                                    CNKCS204
200500                                                                  CNKCS204
200600     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             CNKCS204
200700         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          CNKCS204
200800         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          CNKCS204
200900             MOVE +1               TO ASC-BLK-SUB                 CNKCS204
201000             PERFORM 5100-WRITE-TEMP-STORAGE                      CNKCS204
201100             ADD +1                TO ASC-BLK-SUB                 CNKCS204
201200             PERFORM 5100-WRITE-TEMP-STORAGE                      CNKCS204
201300             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             CNKCS204
201400                 GIVING PV-BLOCK-NUMBER                           CNKCS204
201500                 REMAINDER PV-REMAINDER                           CNKCS204
201600             IF  PV-REMAINDER > ZERO                              CNKCS204
201700                 ADD +1            TO PV-BLOCK-NUMBER             CNKCS204
201800             END-IF                                               CNKCS204
201900             MOVE +1               TO ASC-BLK-SUB                 CNKCS204
202000             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS204
202100             ADD +1                TO ASC-BLK-SUB                 CNKCS204
202200                                      PV-BLOCK-NUMBER             CNKCS204
202300             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS204
202400     END-IF.                                                      CNKCS204
202500                                                                  CNKCS204
202600     MOVE +1                       TO ASC-BLK-SUB.                CNKCS204
202700                                                                  CNKCS204
202800     COMPUTE ASC-ITEM-SUB =                                       CNKCS204
202900         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              CNKCS204
203000         + PC-ITEMS-PER-PANEL).                                   CNKCS204
203100                                                                  CNKCS204
203200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        CNKCS204
203300         ADD +1                    TO ASC-BLK-SUB                 CNKCS204
203400         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            CNKCS204
203500     END-IF.                                                      CNKCS204
203600                                                                  CNKCS204
203700     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           CNKCS204
203800         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                CNKCS204
203900                                                                  CNKCS204
204000     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        CNKCS204
204100     PERFORM 4420-FORMAT-LIST-LINES                               CNKCS204
204200         VARYING PV-SUB                                           CNKCS204
204300         FROM PC-ITEMS-PER-PANEL BY -1                            CNKCS204
204400         UNTIL PV-SUB < +1.                                       CNKCS204
204500                                                                  CNKCS204
204600     COMPUTE ASC-ITEMS-DISPLAYED =                                CNKCS204
204700         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          CNKCS204
204800                                                                  CNKCS204
204900     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    CNKCS204
205000                                      ASTRTITO.                   CNKCS204
205100                                                                  CNKCS204
205200     MOVE ASC-KEY-OPER-UNT-ID      TO MR-OPER.                       CL**3
205300     MOVE ASC-KEY-FCLTY-ID         TO MR-FCLTY.                      CL**3
205400     MOVE ASC-FCLTY-NME            TO MR-FDESC.                      CL**3
205500                                                                  CNKCS204
205600     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    CNKCS204
205700     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    CNKCS204
205800     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            CNKCS204
205900                                   TO ASELITO.                    CNKCS204
206000                                                                  CNKCS204
206100     IF  DP020-MSG-NUMBER-X = SPACE                               CNKCS204
206200         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  CNKCS204
206300*            --- MORE ITEMS TO DISPLAY ----                       CNKCS204
206400             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            CNKCS204
206500             SET DP020-MSG-INFORMATIONAL                          CNKCS204
206600                                   TO TRUE                        CNKCS204
206700         END-IF                                                   CNKCS204
206800     END-IF.                                                      CNKCS204
206900                                                                  CNKCS204
207000*----------------------------------------------------------------*CNKCS204
207100*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *CNKCS204
207200*----------------------------------------------------------------*CNKCS204
207300                                                                  CNKCS204
207400 4410-READ-TEMP-STORAGE.                                          CNKCS204
207500                                                                  CNKCS204
207600     EXEC CICS                                                    CNKCS204
207700         READQ TS                                                 CNKCS204
207800             QUEUE (ASC-LIST-QUEUE-NAME)                          CNKCS204
207900             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               CNKCS204
208000             ITEM  (PV-BLOCK-NUMBER)                              CNKCS204
208100             RESP  (PV-CICS-RESP)                                 CNKCS204
208200     END-EXEC.                                                    CNKCS204
208300                                                                  CNKCS204
208400     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       CNKCS204
208500       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     CNKCS204
208600         CONTINUE                                                 CNKCS204
208700     ELSE                                                         CNKCS204
208800         SET DP013-CICS-ABEND      TO TRUE                        CNKCS204
208900         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS204
209000         MOVE '4410-READ-TEMP-STORAGE'                            CNKCS204
209100                                   TO DP013-PARAGRAPH             CNKCS204
209200         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      CNKCS204
209300                                   TO DP013-MESSAGE-TEXT(1)       CNKCS204
209400         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS204
209500     END-IF.                                                      CNKCS204
209600                                                                  CNKCS204
209700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      CNKCS204
209800                                   TO TRUE.                       CNKCS204
209900                                                                  CNKCS204
210000     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         CNKCS204
210100         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               CNKCS204
210200     END-IF.                                                      CNKCS204
210300                                                                  CNKCS204
210400/                                                                 CNKCS204
210500*----------------------------------------------------------------*CNKCS204
210600*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *CNKCS204
210700*----------------------------------------------------------------*CNKCS204
210800                                                                  CNKCS204
210900 4420-FORMAT-LIST-LINES.                                          CNKCS204
211000                                                                  CNKCS204
211100     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      CNKCS204
211200         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                CNKCS204
211300         MOVE DP015-ASK-DRK-OFF    TO MR-SELECTA (PV-SUB)         CNKCS204
211400         MOVE SPACES               TO MR-OPER                        CL**3
211500                                      MR-FCLTY                       CL**3
211600                                      MR-FDESC                    CNKCS204
211700         MOVE SPACE                TO MR-SELECT  (PV-SUB)         CNKCS204
211800                                      MR-ACTION  (PV-SUB)         CNKCS204
211900                                      MR-FCLTY-ID (PV-SUB)           CL**8
212000                                      MR-DEPT-NBR (PV-SUB)           CL**8
212100                                      MR-CL-NBR  (PV-SUB)            CL**3
212200                                      MR-RANK-X  (PV-SUB)         CNKCS204
212300                                      MR-AREA-ID  (PV-SUB)           CL**3
212400                                      MR-TYPE    (PV-SUB)         CNKCS204
212500                                      MR-DESC    (PV-SUB)         CNKCS204
212600     ELSE                                                         CNKCS204
212700         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      CNKCS204
212800                                                   > SPACE        CNKCS204
212900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS204
213000                                   TO MR-SELECT  (PV-SUB)         CNKCS204
213100         ELSE                                                     CNKCS204
213200             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      CNKCS204
213300                                   TO MR-SELECT  (PV-SUB)         CNKCS204
213400         END-IF                                                   CNKCS204
213500                                                                  CNKCS204
213600         IF  DP030-SET-CURSOR-TRAILER                             CNKCS204
213700             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)CNKCS204
213800                 > SPACE)                                         CNKCS204
213900               OR (PV-SUB = 1))                                   CNKCS204
214000                SET DP030-SET-CURSOR-APPL-1 TO TRUE               CNKCS204
214100                MOVE -1            TO MR-SELECTL (PV-SUB)         CNKCS204
214200             END-IF                                               CNKCS204
214300         END-IF                                                   CNKCS204
214400                                                                  CNKCS204
214500         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           CNKCS204
214600             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           CNKCS204
214700                                   TO MR-ACTION (PV-SUB)          CNKCS204
214800             MOVE ASC-FCLTY-ID (ASC-BLK-SUB ASC-ITEM-SUB)            CL**8
214900                                   TO MR-FCLTY-ID (PV-SUB)           CL**8
215000             MOVE ASC-DEPT-NBR (ASC-BLK-SUB ASC-ITEM-SUB)            CL**8
215100                                   TO MR-DEPT-NBR (PV-SUB)           CL**8
215200             MOVE ASC-CL-NBR (ASC-BLK-SUB ASC-ITEM-SUB)              CL**3
215300                                   TO MR-CL-NBR (PV-SUB)             CL**3
215400             MOVE ASC-RANK (ASC-BLK-SUB ASC-ITEM-SUB)             CNKCS204
215500                                   TO MR-RANK (PV-SUB)            CNKCS204
215600             MOVE ASC-AREA-ID (ASC-BLK-SUB ASC-ITEM-SUB)             CL**3
215700                                   TO MR-AREA-ID (PV-SUB)            CL**3
215800             MOVE ASC-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)             CNKCS204
215900                                   TO MR-TYPE (PV-SUB)            CNKCS204
216000             MOVE ASC-DESC (ASC-BLK-SUB ASC-ITEM-SUB)             CNKCS204
216100                                   TO MR-DESC (PV-SUB)            CNKCS204
216200         END-IF                                                   CNKCS204
216300     END-IF.                                                      CNKCS204
216400                                                                  CNKCS204
216500     SUBTRACT +1 FROM ASC-ITEM-SUB.                               CNKCS204
216600                                                                  CNKCS204
216700     IF  ASC-ITEM-SUB < + 1                                       CNKCS204
216800         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                CNKCS204
216900         MOVE +1                   TO ASC-BLK-SUB                 CNKCS204
217000     END-IF.                                                      CNKCS204
217100                                                                  CNKCS204
217200/                                                                 CNKCS204
217300*----------------------------------------------------------------*CNKCS204
217400*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *CNKCS204
217500*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *CNKCS204
217600*  ISSUE A WARNING.                                              *CNKCS204
217700*----------------------------------------------------------------*CNKCS204
217800 4430-CHECK-FOR-BEGIN-AND-END.                                    CNKCS204
217900                                                                  CNKCS204
218000     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       CNKCS204
218100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     CNKCS204
218200*            -- NO END-OF-RANGE SPECFIED ---                      CNKCS204
218300             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            CNKCS204
218400             SET DP020-MSG-WARNING TO TRUE                        CNKCS204
218500             PERFORM 4431-POSITION-AT-WARNING                     CNKCS204
218600         END-IF                                                   CNKCS204
218700     ELSE                                                         CNKCS204
218800         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     CNKCS204
218900*            -- NO BEGINNING-OF-RANGE SPECFIED ---                CNKCS204
219000             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            CNKCS204
219100             SET DP020-MSG-WARNING TO TRUE                        CNKCS204
219200             PERFORM 4431-POSITION-AT-WARNING                     CNKCS204
219300         END-IF                                                   CNKCS204
219400     END-IF.                                                      CNKCS204
219500                                                                  CNKCS204
219600/                                                                 CNKCS204
219700*----------------------------------------------------------------*CNKCS204
219800*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *CNKCS204
219900*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *CNKCS204
220000*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *CNKCS204
220100*  POSITION THE CURSOR THERE.                                    *CNKCS204
220200*----------------------------------------------------------------*CNKCS204
220300 4431-POSITION-AT-WARNING.                                        CNKCS204
220400                                                                  CNKCS204
220500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 CNKCS204
220600                    - PV-TOP-ITEM + 1.                            CNKCS204
220700                                                                  CNKCS204
220800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      CNKCS204
220900         CONTINUE                                                 CNKCS204
221000     ELSE                                                         CNKCS204
221100         SET DP030-SET-CURSOR-APPL-1                              CNKCS204
221200                                   TO TRUE                        CNKCS204
221300         MOVE -1                   TO MR-SELECTL (PV-SUB)         CNKCS204
221400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         CNKCS204
221500         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         CNKCS204
221600     END-IF.                                                      CNKCS204
221700                                                                  CNKCS204
221800     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   CNKCS204
221900                    - PV-TOP-ITEM + 1.                            CNKCS204
222000                                                                  CNKCS204
222100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      CNKCS204
222200         CONTINUE                                                 CNKCS204
222300     ELSE                                                         CNKCS204
222400         SET DP030-SET-CURSOR-APPL-1                              CNKCS204
222500                                   TO TRUE                        CNKCS204
222600         MOVE -1                   TO MR-SELECTL (PV-SUB)         CNKCS204
222700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         CNKCS204
222800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         CNKCS204
222900     END-IF.                                                      CNKCS204
223000                                                                  CNKCS204
223100/                                                                 CNKCS204
223200*----------------------------------------------------------------*CNKCS204
223300* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *CNKCS204
223400* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *CNKCS204
223500* FOR THE SELECTED ITEMS QUEUE.                                  *CNKCS204
223600*                                                                *CNKCS204
223700* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *CNKCS204
223800* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *CNKCS204
223900* THE ARRAY IS FULL.                                             *CNKCS204
224000*----------------------------------------------------------------*CNKCS204
224100                                                                  CNKCS204
224200 5000-PREPARE-SEL-QUEUE.                                          CNKCS204
224300                                                                  CNKCS204
224400     MOVE +1                       TO ASC-BLK-SUB.                CNKCS204
224500     PERFORM 5100-WRITE-TEMP-STORAGE.                             CNKCS204
224600     ADD +1                        TO ASC-BLK-SUB.                CNKCS204
224700     PERFORM 5100-WRITE-TEMP-STORAGE.                             CNKCS204
224800                                                                  CNKCS204
224900     MOVE ASC-SEL-QUEUE-NAME       TO CN003-SEL-QUEUE-NAME.       CNKCS204
225000     PERFORM 6010-DELETE-SEL-QUEUE.                               CNKCS204
225100                                                                  CNKCS204
225200     IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                      CNKCS204
225300         SET ASC-UPDATE-TSQ        TO TRUE                        CNKCS204
225400     END-IF.                                                      CNKCS204
225500                                                                  CNKCS204
225600     SET CN005-IDX                 TO 1.                          CNKCS204
225700     MOVE ZERO                     TO CN003-NUMBER-OF-TS-ITEMS.   CNKCS204
225800     INITIALIZE CN005-SELECTED-ITEM-ARRAY.                        CNKCS204
225900                                                                  CNKCS204
226000     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           CNKCS204
226100             VARYING PV-ITEM                                      CNKCS204
226200             FROM 1 BY 1                                          CNKCS204
226300             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     CNKCS204
226400                                                                  CNKCS204
226500     IF  CN005-IDX > 1                                            CNKCS204
226600         PERFORM 5205-WRITE-SEL-QUEUE                             CNKCS204
226700         ADD +1                    TO CN003-NUMBER-OF-TS-ITEMS    CNKCS204
226800     END-IF.                                                      CNKCS204
226900                                                                  CNKCS204
227000/                                                                 CNKCS204
227100*----------------------------------------------------------------*CNKCS204
227200*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *CNKCS204
227300*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *CNKCS204
227400*----------------------------------------------------------------*CNKCS204
227500                                                                  CNKCS204
227600 5100-WRITE-TEMP-STORAGE.                                         CNKCS204
227700                                                                  CNKCS204
227800     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     CNKCS204
227900                                   TO PV-LIST-ITEM-NUMBER.        CNKCS204
228000     COMPUTE PV-BLOCK-NUMBER =                                    CNKCS204
228100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    CNKCS204
228200                                                                  CNKCS204
228300     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             CNKCS204
228400     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             CNKCS204
228500         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      CNKCS204
228600             PERFORM 5105-REWRITE-ASC-LISTQ                       CNKCS204
228700         END-IF                                                   CNKCS204
228800     ELSE                                                         CNKCS204
228900         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       CNKCS204
229000         ASC-HIGHEST-BLOCK-WRITTEN + 1                            CNKCS204
229100         PERFORM 5110-WRITE-ASC-LISTQ                             CNKCS204
229200         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   CNKCS204
229300     END-IF.                                                      CNKCS204
229400                                                                  CNKCS204
229500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      CNKCS204
229600                                   TO TRUE.                       CNKCS204
229700                                                                  CNKCS204
229800/                                                                 CNKCS204
229900*----------------------------------------------------------------*CNKCS204
230000*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *CNKCS204
230100*  SPECIFIC COMMAREA.                                            *CNKCS204
230200*----------------------------------------------------------------*CNKCS204
230300 5105-REWRITE-ASC-LISTQ.                                          CNKCS204
230400                                                                  CNKCS204
230500     EXEC CICS                                                    CNKCS204
230600         WRITEQ TS                                                CNKCS204
230700             QUEUE (ASC-LIST-QUEUE-NAME)                          CNKCS204
230800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               CNKCS204
230900             ITEM  (PV-BLOCK-NUMBER)                              CNKCS204
231000             REWRITE                                              CNKCS204
231100             RESP  (PV-CICS-RESP)                                 CNKCS204
231200     END-EXEC.                                                    CNKCS204
231300                                                                  CNKCS204
231400     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           CNKCS204
231500         CONTINUE                                                 CNKCS204
231600     ELSE                                                         CNKCS204
231700         SET DP013-CICS-ABEND      TO TRUE                        CNKCS204
231800         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS204
231900         MOVE '5105-REWRITE-ASC-LISTQ'                            CNKCS204
232000                                   TO DP013-PARAGRAPH             CNKCS204
232100         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     CNKCS204
232200                                   TO DP013-MESSAGE-TEXT(1)       CNKCS204
232300         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS204
232400     END-IF.                                                      CNKCS204
232500                                                                  CNKCS204
232600/                                                                 CNKCS204
232700*----------------------------------------------------------------*CNKCS204
232800*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *CNKCS204
232900*  SPECIFIC COMMAREA.                                            *CNKCS204
233000*----------------------------------------------------------------*CNKCS204
233100 5110-WRITE-ASC-LISTQ.                                            CNKCS204
233200                                                                  CNKCS204
233300     EXEC CICS                                                    CNKCS204
233400         WRITEQ TS                                                CNKCS204
233500             QUEUE (ASC-LIST-QUEUE-NAME)                          CNKCS204
233600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               CNKCS204
233700             ITEM  (PV-BLOCK-NUMBER)                              CNKCS204
233800             RESP  (PV-CICS-RESP)                                 CNKCS204
233900     END-EXEC.                                                    CNKCS204
234000                                                                  CNKCS204
234100     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      CNKCS204
234200         SET DP013-CICS-ABEND      TO TRUE                        CNKCS204
234300         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS204
234400         MOVE '5110-WRITE-ASC-LISTQ'                              CNKCS204
234500                                   TO DP013-PARAGRAPH             CNKCS204
234600         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           CNKCS204
234700                                   TO DP013-MESSAGE-TEXT(1)       CNKCS204
234800         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS204
234900     END-IF.                                                      CNKCS204
235000                                                                  CNKCS204
235100/                                                                 CNKCS204
235200*----------------------------------------------------------------*CNKCS204
235300* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *CNKCS204
235400* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *CNKCS204
235500*----------------------------------------------------------------*CNKCS204
235600                                                                  CNKCS204
235700 5200-FILL-SEL-QUEUE-RECORD.                                      CNKCS204
235800                                                                  CNKCS204
235900     PERFORM 6112-READ-LIST-QUEUE.                                CNKCS204
236000                                                                  CNKCS204
236100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       CNKCS204
236200         PERFORM                                                  CNKCS204
236300         VARYING LQW-IDX                                          CNKCS204
236400         FROM 1 BY 1                                              CNKCS204
236500         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            CNKCS204
236600           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          CNKCS204
236700                                                                  CNKCS204
236800             IF  LQW-SELECT (LQW-IDX)                             CNKCS204
236900                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              CNKCS204
237000                                   TO CN005-ITEM      (CN005-IDX) CNKCS204
237100                 MOVE LQW-DEPT-NBR (LQW-IDX)                         CL**3
237200                                   TO CN005-DEPT-NBR  (CN005-IDX)    CL**3
237300                 MOVE LQW-CL-NBR  (LQW-IDX)                          CL**3
237400                                   TO CN005-CL-NBR    (CN005-IDX)    CL**3
237500                 MOVE LQW-RANK    (LQW-IDX)                       CNKCS204
237600                                   TO CN005-RANK      (CN005-IDX) CNKCS204
237700                 MOVE LQW-TYPE    (LQW-IDX)                       CNKCS204
237800                                   TO CN005-TYPE      (CN005-IDX) CNKCS204
237900                 MOVE LQW-OPER-UNT-ID (LQW-IDX)                      CL**3
238000                                TO CN005-OPER-UNT-ID  (CN005-IDX)    CL**3
238100                 MOVE LQW-FCLTY-ID (LQW-IDX)                         CL**3
238200                                   TO CN005-FCLTY-ID  (CN005-IDX)    CL**3
238300                 MOVE SPACE        TO CN005-ACTION-SW (CN005-IDX) CNKCS204
238400                 SET CN005-IDX UP BY 1                            CNKCS204
238500                 IF  CN005-IDX > CN005-MAX-ITEMS                  CNKCS204
238600                     PERFORM 5205-WRITE-SEL-QUEUE                 CNKCS204
238700                     ADD +1        TO CN003-NUMBER-OF-TS-ITEMS    CNKCS204
238800                     INITIALIZE CN005-SELECTED-ITEM-ARRAY         CNKCS204
238900                     SET CN005-IDX TO 1                           CNKCS204
239000                 END-IF                                           CNKCS204
239100             END-IF                                               CNKCS204
239200         END-PERFORM                                              CNKCS204
239300     END-IF.                                                      CNKCS204
239400                                                                  CNKCS204
239500/                                                                 CNKCS204
239600*----------------------------------------------------------------*CNKCS204
239700*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *CNKCS204
239800*----------------------------------------------------------------*CNKCS204
239900                                                                  CNKCS204
240000 5205-WRITE-SEL-QUEUE.                                            CNKCS204
240100                                                                  CNKCS204
240200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            CNKCS204
240300                                   TO CN005-SELECTED-ITEMS.       CNKCS204
240400                                                                  CNKCS204
240500     EXEC CICS                                                    CNKCS204
240600          WRITEQ TS                                               CNKCS204
240700              QUEUE (ASC-SEL-QUEUE-NAME)                          CNKCS204
240800              FROM  (CN005-TS-SEL-REC)                            CNKCS204
240900              ITEM  (PV-SEL-QUEUE-ITEM)                           CNKCS204
241000              RESP  (PV-CICS-RESP)                                CNKCS204
241100     END-EXEC.                                                    CNKCS204
241200                                                                  CNKCS204
241300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          CNKCS204
241400         CONTINUE                                                 CNKCS204
241500     ELSE                                                         CNKCS204
241600         SET DP013-CICS-ABEND      TO TRUE                        CNKCS204
241700         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS204
241800         MOVE '5205-WRITE-SEL-QUEUE'                              CNKCS204
241900                                   TO DP013-PARAGRAPH             CNKCS204
242000         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          CNKCS204
242100                                   TO DP013-MESSAGE-TEXT(1)       CNKCS204
242200         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS204
242300     END-IF.                                                      CNKCS204
242400                                                                  CNKCS204
242500/                                                                 CNKCS204
242600*----------------------------------------------------------------*CNKCS204
242700*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *CNKCS204
242800*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *CNKCS204
242900*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *CNKCS204
243000*  THE USER.                                                     *CNKCS204
243100*----------------------------------------------------------------*CNKCS204
243200 6000-REFRESH-PANEL-FROM-TEMP.                                    CNKCS204
243300                                                                  CNKCS204
243400     IF  ASC-UPDATE-TSQ                                           CNKCS204
243500         SET ASC-NO-TSQ-UPDATE     TO TRUE                        CNKCS204
243600         MOVE ZERO                 TO PV-SAVE-ITEM                CNKCS204
243700                                      PV-SEL-QUEUE-ITEM           CNKCS204
243800         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        CNKCS204
243900                                   TO PV-HOLD-SELECTED-ITEMS      CNKCS204
244000         PERFORM 6100-UPDATE-TSQ                                  CNKCS204
244100             UNTIL PV-ITEMS-PROCESSED >                           CNKCS204
244200                                     ASC-NUMBER-OF-SELECTED-ITEMS CNKCS204
244300         PERFORM 6010-DELETE-SEL-QUEUE                            CNKCS204
244400         INITIALIZE ASC-BLOCK-ENTRIES (1)                         CNKCS204
244500                    ASC-BLOCK-ENTRIES (2)                         CNKCS204
244600     END-IF.                                                      CNKCS204
244700                                                                  CNKCS204
244800/                                                                 CNKCS204
244900*----------------------------------------------------------------*CNKCS204
245000*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *CNKCS204
245100*----------------------------------------------------------------*CNKCS204
245200 6010-DELETE-SEL-QUEUE.                                           CNKCS204
245300                                                                  CNKCS204
245400     EXEC CICS                                                    CNKCS204
245500         DELETEQ TS                                               CNKCS204
245600             QUEUE (ASC-SEL-QUEUE-NAME)                           CNKCS204
245700             RESP  (PV-CICS-RESP)                                 CNKCS204
245800     END-EXEC.                                                    CNKCS204
245900                                                                  CNKCS204
246000     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      CNKCS204
246100         (PV-CICS-RESP = DFHRESP(QIDERR)))                        CNKCS204
246200         CONTINUE                                                 CNKCS204
246300     ELSE                                                         CNKCS204
246400         SET DP013-CICS-ABEND      TO TRUE                        CNKCS204
246500         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS204
246600         MOVE '6010-DELETE-SEL-QUEUE'                             CNKCS204
246700                                   TO DP013-PARAGRAPH             CNKCS204
246800         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         CNKCS204
246900                                   TO DP013-MESSAGE-TEXT (1)      CNKCS204
247000         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS204
247100     END-IF.                                                      CNKCS204
247200                                                                  CNKCS204
247300/                                                                 CNKCS204
247400*----------------------------------------------------------------*CNKCS204
247500*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *CNKCS204
247600*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *CNKCS204
247700*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *CNKCS204
247800*    THE TEMP QUEUE.                                             *CNKCS204
247900*----------------------------------------------------------------*CNKCS204
248000                                                                  CNKCS204
248100 6100-UPDATE-TSQ.                                                 CNKCS204
248200                                                                  CNKCS204
248300     ADD 1                         TO PV-SEL-QUEUE-ITEM.          CNKCS204
248400     PERFORM 6105-READ-SEL-QUEUE.                                 CNKCS204
248500                                                                  CNKCS204
248600     PERFORM                                                      CNKCS204
248700         VARYING CN005-IDX                                        CNKCS204
248800         FROM 1 BY 1                                              CNKCS204
248900         UNTIL ((PV-ITEMS-PROCESSED >                             CNKCS204
249000                              PV-HOLD-SELECTED-ITEMS)             CNKCS204
249100         OR (CN005-IDX GREATER THAN CN005-MAX-ITEMS))             CNKCS204
249200         IF  CN005-ACTION-SW (CN005-IDX) > SPACE                  CNKCS204
249300             PERFORM 6110-PROCESS-ITEMS                           CNKCS204
249400         END-IF                                                   CNKCS204
249500         ADD +1                    TO PV-ITEMS-PROCESSED          CNKCS204
249600     END-PERFORM.                                                 CNKCS204
249700                                                                  CNKCS204
249800     PERFORM 6111-WRITE-LIST-QUEUE.                               CNKCS204
249900                                                                  CNKCS204
250000/                                                                 CNKCS204
250100*----------------------------------------------------------------*CNKCS204
250200*    READ THE LIST QUEUE RECORD.                                 *CNKCS204
250300*----------------------------------------------------------------*CNKCS204
250400                                                                  CNKCS204
250500 6105-READ-SEL-QUEUE.                                             CNKCS204
250600                                                                  CNKCS204
250700     EXEC CICS                                                    CNKCS204
250800          READQ TS                                                CNKCS204
250900              QUEUE (ASC-SEL-QUEUE-NAME)                          CNKCS204
251000              INTO  (CN005-TS-SEL-REC)                            CNKCS204
251100              ITEM  (PV-SEL-QUEUE-ITEM)                           CNKCS204
251200              RESP  (PV-CICS-RESP)                                CNKCS204
251300     END-EXEC.                                                    CNKCS204
251400                                                                  CNKCS204
251500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          CNKCS204
251600         CONTINUE                                                 CNKCS204
251700     ELSE                                                         CNKCS204
251800         SET DP013-CICS-ABEND      TO TRUE                        CNKCS204
251900         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS204
252000         MOVE '6105-READ-SEL-QUEUE'                               CNKCS204
252100                                   TO DP013-PARAGRAPH             CNKCS204
252200         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           CNKCS204
252300                                   TO DP013-MESSAGE-TEXT(1)       CNKCS204
252400         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS204
252500     END-IF.                                                      CNKCS204
252600                                                                  CNKCS204
252700/                                                                 CNKCS204
252800*----------------------------------------------------------------*CNKCS204
252900*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*CNKCS204
253000*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*CNKCS204
253100*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *CNKCS204
253200*----------------------------------------------------------------*CNKCS204
253300                                                                  CNKCS204
253400 6110-PROCESS-ITEMS.                                              CNKCS204
253500                                                                  CNKCS204
253600     COMPUTE PV-ITEM = 1 + ((CN005-ITEM (CN005-IDX) - 1)          CNKCS204
253700                     / PC-ITEMS-PER-PANEL).                       CNKCS204
253800                                                                  CNKCS204
253900     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           CNKCS204
254000         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          CNKCS204
254100             PERFORM 6111-WRITE-LIST-QUEUE                        CNKCS204
254200         END-IF                                                   CNKCS204
254300         MOVE PV-ITEM              TO PV-SAVE-ITEM                CNKCS204
254400                                                                  CNKCS204
254500         PERFORM 6112-READ-LIST-QUEUE                             CNKCS204
254600         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               CNKCS204
254700             CONTINUE                                             CNKCS204
254800         END-IF                                                   CNKCS204
254900     END-IF.                                                      CNKCS204
255000                                                                  CNKCS204
255100     COMPUTE PV-SUB = (CN005-ITEM (CN005-IDX)                     CNKCS204
255200                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              CNKCS204
255300                                                                  CNKCS204
255400     SET LQW-DESELECT (PV-SUB)     TO TRUE.                       CNKCS204
255500     MOVE LQW-SELECTED-SW (PV-SUB) TO LQW-TEMP-SELECTED-SW        CNKCS204
255600                                     (PV-SUB).                    CNKCS204
255700     EVALUATE TRUE                                                CNKCS204
255800         WHEN CN005-INQ (CN005-IDX)                               CNKCS204
255900              MOVE PC-INQ          TO LQW-ACTION (PV-SUB)         CNKCS204
256000                                                                  CNKCS204
256100         WHEN CN005-UPD (CN005-IDX)                               CNKCS204
256200              MOVE PC-UPD          TO LQW-ACTION (PV-SUB)         CNKCS204
256300                                                                  CNKCS204
256400         WHEN CN005-DEL (CN005-IDX)                               CNKCS204
256500              MOVE PC-DEL          TO LQW-ACTION (PV-SUB)         CNKCS204
256600                                                                  CNKCS204
256700         WHEN CN005-ERR (CN005-IDX)                               CNKCS204
256800              MOVE PC-ERR          TO LQW-ACTION (PV-SUB)         CNKCS204
256900     END-EVALUATE.                                                CNKCS204
257000                                                                  CNKCS204
257100     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                CNKCS204
257200                                                                  CNKCS204
257300/                                                                 CNKCS204
257400*----------------------------------------------------------------*CNKCS204
257500*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *CNKCS204
257600*----------------------------------------------------------------*CNKCS204
257700                                                                  CNKCS204
257800 6111-WRITE-LIST-QUEUE.                                           CNKCS204
257900                                                                  CNKCS204
258000     EXEC CICS                                                    CNKCS204
258100         WRITEQ TS                                                CNKCS204
258200             QUEUE (ASC-LIST-QUEUE-NAME)                          CNKCS204
258300             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     CNKCS204
258400             ITEM  (PV-SAVE-ITEM)                                 CNKCS204
258500             REWRITE                                              CNKCS204
258600             RESP  (PV-CICS-RESP)                                 CNKCS204
258700     END-EXEC.                                                    CNKCS204
258800                                                                  CNKCS204
258900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          CNKCS204
259000         CONTINUE                                                 CNKCS204
259100     ELSE                                                         CNKCS204
259200         SET DP013-CICS-ABEND      TO TRUE                        CNKCS204
259300         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS204
259400         MOVE '6111-WRITE-LIST-QUEUE'                             CNKCS204
259500                                   TO DP013-PARAGRAPH             CNKCS204
259600         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  CNKCS204
259700                                   TO DP013-MESSAGE-TEXT(1)       CNKCS204
259800         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS204
259900     END-IF.                                                      CNKCS204
260000                                                                  CNKCS204
260100/                                                                 CNKCS204
260200*----------------------------------------------------------------*CNKCS204
260300*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*CNKCS204
260400*----------------------------------------------------------------*CNKCS204
260500                                                                  CNKCS204
260600 6112-READ-LIST-QUEUE.                                            CNKCS204
260700                                                                  CNKCS204
260800     EXEC CICS                                                    CNKCS204
260900         READQ TS                                                 CNKCS204
261000             QUEUE (ASC-LIST-QUEUE-NAME)                          CNKCS204
261100             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     CNKCS204
261200             ITEM  (PV-ITEM)                                      CNKCS204
261300             RESP  (PV-CICS-RESP)                                 CNKCS204
261400     END-EXEC.                                                    CNKCS204
261500                                                                  CNKCS204
261600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          CNKCS204
261700         CONTINUE                                                 CNKCS204
261800     ELSE                                                         CNKCS204
261900         SET DP013-CICS-ABEND      TO TRUE                        CNKCS204
262000         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS204
262100         MOVE '6112-READ-LIST-QUEUE'                              CNKCS204
262200                                   TO DP013-PARAGRAPH             CNKCS204
262300         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    CNKCS204
262400                                   TO DP013-MESSAGE-TEXT(1)       CNKCS204
262500         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS204
262600     END-IF.                                                      CNKCS204
262700                                                                  CNKCS204
262800/                                                                 CNKCS204
262900*----------------------------------------------------------------*CNKCS204
263000*    ABEND PROCESSOR MODULE                                      *CNKCS204
263100*----------------------------------------------------------------*CNKCS204
263200                                                                  CNKCS204
263300     COPY DPPD013.                                                CNKCS204
