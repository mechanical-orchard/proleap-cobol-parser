/* REXX */                                                                      
/* RMKRX012 - Prepare Infopac Summary XREF records for all dynamic    */        
/*      distribution types tied to the Store ASM file for store and   */        
/*      district roles with multiple people fulfilling it, and only   */        
/*      a single cross reference type that is applicable related to   */        
/*      a store location.                                             */        
/**********************************************************************/        
/* Set values for constants.                                          */        
/**********************************************************************/        
CURRPGM = ' RMKRX012 - '                                                        
STORASM_FILE_END_OF_FILE = 'Y'                                                  
STORASM_FILE_NOT_END_OF_FILE = 'N'                                              
COMMENT_LINE = '*'                                                              
XREF_TYPE_PERS_OPS = 'PERS/OP'                                                  
XREF_TYPE_AREA_SUPERVISOR = 'AA     '                                           
XREF_TYPE_STORE_ADMIN = 'STRADM '                                               
XREF_TYPE_DIST_ADMIN = 'DISTADM'                                                
XREF_TYPE_CFH = 'CFH    '                                                       
XREF_TYPE_LP_SUPERVISOR = 'LPS    '                                             
XREF_TYPE_LP_OFFICER    = 'LPO    '                                             
XREF_TYPE_LP_MANAGER    = 'LPM    '                                             
                                                                                
/**********************************************************************/        
/* Initialize local variables.                                        */        
/**********************************************************************/        
STORASM_FILE_EOF = STORASM_FILE_NOT_END_OF_FILE                                 
                                                                                
/**********************************************************************/        
/* Program mainline.                                                  */        
/**********************************************************************/        
SAY CURRPGM                                                                     
CALL READ_STORASM_RECORD                                                        
DO WHILE (STORASM_FILE_EOF = STORASM_FILE_NOT_END_OF_FILE)                      
    PARSE PULL INP01_RECORD                                                     
    IF (SUBSTR(INP01_RECORD,1,1) ^= COMMENT_LINE) THEN DO                       
        STORASM_USERID = SUBSTR(INP01_RECORD,2,8)                               
        STORASM_STORE_NBR = SUBSTR(INP01_RECORD,69,4)                           
        STORASM_XREF_TYPE = SUBSTR(INP01_RECORD,52,7)                           
        STORASM_RECIPIENT_NAME = SUBSTR(INP01_RECORD,10,30)                     
        IF (STORASM_XREF_TYPE = XREF_TYPE_PERS_OPS) THEN DO                     
            SUM_XREF_RECORD = STORASM_XREF_TYPE || '  ' ||,                     
                              LEFT(STORASM_STORE_NBR,10) ||,                    
                              STORASM_USERID || '            ' ||,              
                              '                    ' ||,                        
                              STORASM_RECIPIENT_NAME                            
            CALL WRITE_SUM_XREF_RECORD                                          
        END                                                                     
        IF (STORASM_XREF_TYPE = XREF_TYPE_AREA_SUPERVISOR) THEN DO              
            SUM_XREF_RECORD = STORASM_XREF_TYPE || '  ' ||,                     
                              LEFT(STORASM_STORE_NBR,10) ||,                    
                              STORASM_USERID || '            ' ||,              
                              '                    ' ||,                        
                              STORASM_RECIPIENT_NAME                            
            CALL WRITE_SUM_XREF_RECORD                                          
        END                                                                     
        IF (STORASM_XREF_TYPE = XREF_TYPE_STORE_ADMIN) THEN DO                  
            SUM_XREF_RECORD = STORASM_XREF_TYPE || '  ' ||,                     
                              LEFT(STORASM_STORE_NBR,10) ||,                    
                              STORASM_USERID || '            ' ||,              
                              '                    ' ||,                        
                              STORASM_RECIPIENT_NAME                            
            CALL WRITE_SUM_XREF_RECORD                                          
        END                                                                     
        IF (STORASM_XREF_TYPE = XREF_TYPE_DIST_ADMIN) THEN DO                   
            SUM_XREF_RECORD = STORASM_XREF_TYPE || '  ' ||,                     
                              LEFT(STORASM_STORE_NBR,10) ||,                    
                              STORASM_USERID || '            ' ||,              
                              '                    ' ||,                        
                              STORASM_RECIPIENT_NAME                            
            CALL WRITE_SUM_XREF_RECORD                                          
        END                                                                     
        IF (STORASM_XREF_TYPE = XREF_TYPE_CFH) THEN DO                          
            SUM_XREF_RECORD = STORASM_XREF_TYPE || '  ' ||,                     
                              LEFT(STORASM_STORE_NBR,10) ||,                    
                              STORASM_USERID || '            ' ||,              
                              '                    ' ||,                        
                              STORASM_RECIPIENT_NAME                            
            CALL WRITE_SUM_XREF_RECORD                                          
        END                                                                     
        IF (STORASM_XREF_TYPE = XREF_TYPE_LP_SUPERVISOR) THEN DO                
            SUM_XREF_RECORD = STORASM_XREF_TYPE || '  ' ||,                     
                              LEFT(STORASM_STORE_NBR,10) ||,                    
                              STORASM_USERID || '            ' ||,              
                              '                    ' ||,                        
                              STORASM_RECIPIENT_NAME                            
            CALL WRITE_SUM_XREF_RECORD                                          
        END                                                                     
        IF (STORASM_XREF_TYPE = XREF_TYPE_LP_OFFICER) THEN DO                   
            SUM_XREF_RECORD = STORASM_XREF_TYPE || '  ' ||,                     
                              LEFT(STORASM_STORE_NBR,10) ||,                    
                              STORASM_USERID || '            ' ||,              
                              '                    ' ||,                        
                              STORASM_RECIPIENT_NAME                            
            CALL WRITE_SUM_XREF_RECORD                                          
        END                                                                     
        IF (STORASM_XREF_TYPE = XREF_TYPE_LP_MANAGER) THEN DO                   
            SUM_XREF_RECORD = STORASM_XREF_TYPE || '  ' ||,                     
                              LEFT(STORASM_STORE_NBR,10) ||,                    
                              STORASM_USERID || '            ' ||,              
                              '                    ' ||,                        
                              STORASM_RECIPIENT_NAME                            
            CALL WRITE_SUM_XREF_RECORD                                          
        END                                                                     
    END                                                                         
    CALL READ_STORASM_RECORD                                                    
END                                                                             
                                                                                
"EXECIO 0 DISKR INP01 (FINIS"                                                   
"EXECIO 0 DISKR OUT01 (FINIS"                                                   
EXIT 0                                                                          
/* ----------------------------------------------------------------- */         
/* Subroutines                                                       */         
/* ----------------------------------------------------------------- */         
/* ----------------------------------------------------------------- */         
/* READ_STORASM_RECORD                                               */         
/*                                                                   */         
/* Read an Infopac store ASM record.                                 */         
/* ----------------------------------------------------------------- */         
READ_STORASM_RECORD:                                                            
    "EXECIO 1 DISKR INP01"              /* read one record           */         
    IF RC = 2 THEN                                                              
        STORASM_FILE_EOF = STORASM_FILE_END_OF_FILE                             
    RETURN                                                                      
/* ----------------------------------------------------------------- */         
/* WRITE_SUM_XREF_RECORD                                             */         
/*                                                                   */         
/* Write an Infopac Summary XREF record.                             */         
/* ----------------------------------------------------------------- */         
WRITE_SUM_XREF_RECORD:                                                          
    OUT01_RECORD = LEFT(SUM_XREF_RECORD,150)                                    
    PUSH OUT01_RECORD                                                           
    "EXECIO 1 DISKW OUT01"                                                      
    RETURN                                                                      
