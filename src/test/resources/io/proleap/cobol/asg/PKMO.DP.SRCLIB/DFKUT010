       ID DIVISION.                                                     00010099
                                                                        00011099
       PROGRAM-ID.         DFKUT010.                                    00020099
       AUTHOR.             GEORGETTE RAHN.                              00030099
       INSTALLATION.       KOHL CORPORATION.                            00040099
       DATE-WRITTEN.       JUNE 1998.                                   00050099
       DATE-COMPILED.                                                   00060099
      ***************************************************************** 00070099
      *                                                               * 00080099
      *        THIS PROGRAM READS THE DAILY SALES FILE PREPARED BY    * 00090099
      *                                                               * 00100099
      *        MERCHANDISE LEDGER AND CREATES A FILE THAT WILL BE     * 00110099
      *                                                               * 00120099
      *        LOADED TO THE DB2 DAILY SALES DATA BASE.               * 00130099
      *                                                               * 00140099
      *              FILES:                                           * 00150099
      *            ML022 - MERCHANDISE LEDGER DAILY SALES             * 00160099
      *            DF005 - DB2 DAILY SALES FILE                       * 00170099
      *                                                               * 00180099
      ***************************************************************** 00180199
      *   CHANGES:                                                      00181099
      *                                                                 00182099
      *   09/01/98   INITIAL VERSION                                    00183099
      *                                                                 00184099
      *   02/12/04   STEVEN NOWAK     WR# 26583                         00185099
      *              REC CHANGE FOR OUTPUT FROM 23 TO 25 BYTES          00185199
      *              CHANGE TO TABLE TDADPTS AND COPYBOOK               00185299
      *              DFRD005. RECOMPILE TO PULL IN CHANGES.             00185399
      *                                                                 00186099
      ***************************************************************** 00200099
                                                                        00210099
       ENVIRONMENT DIVISION.                                            00220099
       CONFIGURATION SECTION.                                           00230099
                                                                        00231099
       SOURCE-COMPUTER.        IBM-370.                                 00240099
       OBJECT-COMPUTER.        IBM-370.                                 00250099
                                                                        00251099
       INPUT-OUTPUT SECTION.                                            00260099
       FILE-CONTROL.                                                    00270099
                                                                        00271099
           SELECT DAILY-SALES-ML-FILE                                   00280099
               ASSIGN TO INP01.                                         00290099
                                                                        00300099
           SELECT DAILY-CORRECTIONS-ML-FILE                             00310099
               ASSIGN TO INP02.                                         00320099
                                                                        00330099
           SELECT DAILY-LAST-WEEK-DB2-FILE                              00340099
               ASSIGN TO OUT01.                                         00350099
                                                                        00360099
           SELECT DAILY-PREV-WEEK-DB2-FILE                              00370099
               ASSIGN TO OUT02.                                         00380099
                                                                        00390099
           SELECT DAILY-SALES-REPORT                                    00400099
               ASSIGN TO RPT01.                                         00410099
                                                                        00420099
       DATA DIVISION.                                                   00430099
       FILE SECTION.                                                    00440099
                                                                        00450099
       FD  DAILY-SALES-ML-FILE                                          00460099
           RECORDING MODE IS F                                          00470099
           LABEL RECORDS ARE STANDARD                                   00480099
           RECORD CONTAINS  80 CHARACTERS                               00490099
           BLOCK  CONTAINS  0 RECORDS                                   00500099
           DATA RECORD IS SALES-RECORD.                                 00510099
                                                                        00520099
       01  SALES-RECORD                PIC X(80).                       00530099
                                                                        00540099
       FD  DAILY-CORRECTIONS-ML-FILE                                    00550099
           RECORDING MODE IS F                                          00560099
           LABEL RECORDS ARE STANDARD                                   00570099
           RECORD CONTAINS  80 CHARACTERS                               00580099
           BLOCK  CONTAINS  0 RECORDS                                   00590099
           DATA RECORD IS CORRECTIONS-RECORD.                           00600099
                                                                        00610099
       01  CORRECTIONS-RECORD          PIC X(80).                       00620099
                                                                        00630099
       FD  DAILY-LAST-WEEK-DB2-FILE                                     00640099
           RECORDING MODE IS F                                          00650099
           LABEL RECORDS ARE STANDARD                                   00660099
           RECORD CONTAINS  25 CHARACTERS                               00670099
           BLOCK  CONTAINS  0 RECORDS                                   00680099
           DATA RECORD IS DF005O-RECORD.                                00690099
                                                                        00700099
       01  DF005O-RECORD               PIC X(25).                       00710099
                                                                        00720099
       FD  DAILY-PREV-WEEK-DB2-FILE                                     00730099
           RECORDING MODE IS F                                          00740099
           LABEL RECORDS ARE STANDARD                                   00750099
           RECORD CONTAINS  25 CHARACTERS                               00760099
           BLOCK  CONTAINS  0 RECORDS                                   00770099
           DATA RECORD IS DF005-RECORD.                                 00780099
                                                                        00790099
       01  DF005-REC                   PIC X(25).                       00800099
                                                                        00810099
       FD  DAILY-SALES-REPORT                                           00820099
           RECORDING MODE IS F                                          00830099
           LABEL RECORDS ARE OMITTED                                    00840099
           RECORD CONTAINS 132 CHARACTERS                               00850099
           DATA RECORD IS PRINT-LINE.                                   00860099
                                                                        00870099
       01  PRINT-LINE                  PIC X(132).                      00880099
       EJECT                                                            00890099
       WORKING-STORAGE SECTION.                                         00900099
                                                                        00910099
       01  PROGRAM-CONSTANTS.                                           00920099
           05  FILLER                      PIC X(25)        VALUE       00930099
               'WORKING STOREAGE BEGINS'.                               00940099
           05  PC-LINE-MAX                 PIC S9(4) COMP-3 VALUE +56.  00950099
           05  PC-DAY-MAX                  PIC S9(4) COMP-3 VALUE +7.   00960099
           05  PC-1                        PIC S9           VALUE +1.   00970099
           05  PC-2                        PIC S9           VALUE +2.   00980099
           05  PC-3                        PIC S9           VALUE +3.   00990099
           05  PC-4                        PIC S9           VALUE +4.   01000099
           05  PC-5                        PIC S9           VALUE +5.   01010099
           05  PC-6                        PIC S9           VALUE +6.   01020099
           05  PC-7                        PIC S9           VALUE +7.   01030099
           05  PC-W                        PIC X            VALUE 'W'.  01040099
           05  PC-Y                        PIC X            VALUE 'Y'.  01050099
           05  PC-CORRECTION-HEADING       PIC X(40)        VALUE       01060099
               'DAILY SALES HISTORY CORRECTION UPDATES'.                01070099
           05  PC-TOTAL-HEADING            PIC X(40)        VALUE       01080099
               'DAILY SALES HISTORY UPDATE TOTALS'.                     01090099
                                                                        01100099
       01  PROGRAM-SWITCHES.                                            01110099
           05  PS-SALES-EOF                PIC X            VALUE 'N'.  01120099
           05  PS-CORRECTIONS-EOF          PIC X            VALUE 'N'.  01130099
                                                                        01140099
       01  PROGRAM-VARIABLES.                                           01150099
           05  PV-DAY-X                    PIC X            VALUE SPACE.01160099
           05  PV-DAY            REDEFINES PV-DAY-X                     01170099
                                           PIC 9.                       01180099
           05  PV-TOT-TOTAL-WTD            PIC S9(13)V99    VALUE ZEROS.01190099
           05  PV-TOT-CORRECTS-WTD         PIC S9(13)V99    VALUE ZEROS.01200099
           05  PV-TOT-SALES-WTD            PIC S9(13)V99    VALUE ZEROS.01210099
           05  PV-TOT-SALES-DAY            OCCURS 7 TIMES               01220099
                                           PIC S9(09)V99    VALUE ZEROS.01230099
           05  PV-PAGE-COUNT               PIC S9(03)       VALUE ZEROS.01240099
           05  PV-LINE-COUNT               PIC S9(03)       VALUE +90.  01250099
           05  PV-LINES                    PIC S9(03)       VALUE ZEROS.01260099
           05  PV-ABEND-CODE               PIC S9(4) COMP   VALUE ZEROS.01270099
               88  AC-BAD-FILE-WRITE       VALUE +4001.                 01280099
               88  AC-BAD-INPUT-DATA       VALUE +4003.                 01290099
               88  AC-TABLE-OVERFLOW       VALUE +4004.                 01300099
               88  AC-BAD-DATA             VALUE +4008.                 01310099
               88  AC-DB2-ERROR            VALUE +4013.                 01320099
               88  AC-DATE-ERROR           VALUE +4019.                 01321099
           05  PV-TEST-STORE.                                           01322099
               10  FILLER                  PIC X            VALUE ZERO. 01322199
               10  PV-TEST-STORE-4         PIC X(04)        VALUE ZERO. 01322299
           05  PV-TEST-STORE-NUM           PIC S9(4)        VALUE ZERO. 01322399
           05  PV-CPU-DATE.                                             01323099
               10  PV-CPU-YEAR             PIC XX.                      01324099
               10  PV-CPU-MONTH            PIC XX.                      01325099
               10  PV-CPU-DAY              PIC XX.                      01326099
           05  PV-CPU-TIME.                                             01327099
               10  PV-CPU-HOUR             PIC XX.                      01328099
               10  PV-CPU-MINUTE           PIC XX.                      01329099
           05  PV-WEEK-BEGIN-DTE.                                       01330099
               10  PV-WB-CCYY              PIC 9(04).                   01340099
               10  FILLER                  PIC X(01).                   01350099
               10  PV-WB-MM                PIC 9(02).                   01360099
               10  FILLER                  PIC X(01).                   01370099
               10  PV-WB-DD                PIC 9(02).                   01380099
           05  PV-STORE-SALES-INFO.                                     01390099
               10  PV-STORE-WTD            PIC S9(9)V99    COMP-3       01400099
                                                      VALUE ZEROES.     01410099
               10  PV-DAILY-SALES          OCCURS 7 TIMES               01420099
                                           INDEXED BY PV-DAY-INX.       01430099
                   15  PV-DAYS-SALES       PIC S9(07)V99   COMP-3       01440099
                                                      VALUE ZEROES.     01450099
        EJECT                                                           01460099
      **********************************************************        01470099
      *                    HEADINGS                            *        01480099
      **********************************************************        01490099
           COPY DPWS132.                                                01500099
      *                                                                 01510099
       01  HEAD-LN2.                                                    01520099
           05  FILLER          PIC X(46)   VALUE SPACES.                01530099
           05  HEAD-LN2-FILLER PIC X(40)   VALUE                        01540099
               'WEEKLY UPDATE OF DAILY SALES HISTORY'.                  01550099
      *                                                                 01560099
       01  HEAD-LN3.                                                    01570099
           05  FILLER          PIC X(16)   VALUE '        STORE'.       01580099
           05  FILLER          PIC X(14)   VALUE '       SUNDAY'.       01590099
           05  FILLER          PIC X(14)   VALUE '       MONDAY'.       01600099
           05  FILLER          PIC X(14)   VALUE '      TUESDAY'.       01610099
           05  FILLER          PIC X(14)   VALUE '    WEDNESDAY'.       01620099
           05  FILLER          PIC X(14)   VALUE '     THURSDAY'.       01630099
           05  FILLER          PIC X(14)   VALUE '       FRIDAY'.       01640099
           05  FILLER          PIC X(14)   VALUE '     SATURDAY'.       01650099
           05  FILLER          PIC X(17)   VALUE '  TOTAL FOR WEEK'.    01660099
      *                                                                 01670099
       01  PC-CORRECTION-HEADING-2.                                     01680099
           05  FILLER          PIC X(16)   VALUE '        STORE'.       01690099
           05  FILLER          PIC X(14)   VALUE '      AMOUNT  '.      01700099
           05  FILLER          PIC X(11)   VALUE '    DATE'.            01710099
           05  FILLER          PIC X(05)   VALUE 'DEPT'.                01720099
           05  FILLER          PIC X(14)   VALUE '      AMOUNT  '.      01721099
           05  FILLER          PIC X(11)   VALUE '    DATE'.            01722099
           05  FILLER          PIC X(05)   VALUE 'DEPT'.                01723099
           05  FILLER          PIC X(14)   VALUE '      AMOUNT  '.      01724099
           05  FILLER          PIC X(11)   VALUE '    DATE'.            01724199
           05  FILLER          PIC X(05)   VALUE 'DEPT'.                01724299
           05  FILLER          PIC X(17)   VALUE '  WEEK''S TOTAL'.     01724399
      *                                                                 01724499
       01  DETAIL-LN                       VALUE SPACES.                01724599
           05  DET-STORE.                                               01724699
               10  FILLER              PIC X.                           01724799
               10  DET-STORE-NO        PIC XXXX.                        01724899
               10  FILLER              PIC X.                           01724999
               10  DET-STORE-NAME      PIC X(10).                       01725099
               10  FILLER              PIC X.                           01726099
           05  DET-DAY-SALES           OCCURS 7 TIMES                   01727099
                                       INDEXED BY DET-DAY-INX           01728099
                                       PIC ZZ,ZZZ,ZZZ.ZZ-.              01729099
           05  DET-TOTAL-FOR-WEEK      PIC ZZ,ZZZ,ZZZ,ZZZ.99-.          01730099
                                                                        01740099
       01  CORRECT-LINE                VALUE SPACES.                    01750099
           05  COR-STORE.                                               01760099
               10  FILLER              PIC X.                           01770099
               10  COR-STORE-NO        PIC XXXX.                        01780099
               10  FILLER              PIC X.                           01790099
               10  COR-STORE-NAME      PIC X(10).                       01800099
               10  FILLER              PIC X.                           01810099
           05  FILLER                  OCCURS 3 TIMES                   01820099
                                       INDEXED BY COR-DAY-INX.          01830099
               10  COR-DAY-SALES       PIC ZZ,ZZZ,ZZZ.99-.              01840099
               10  FILLER              PIC X.                           01850099
               10  COR-DAY-DATE        PIC X(10).                       01860099
               10  FILLER              PIC X.                           01870099
               10  COR-DAY-DEPT        PIC X(03).                       01880099
               10  FILLER              PIC X.                           01890099
           05  COR-TOTAL-FOR-WEEK      PIC ZZ,ZZZ,ZZZ,ZZZ.99-.          01900099
                                                                        01910099
       01  TOTAL-LN                    VALUE SPACES.                    01920099
           05  FILLER                  PIC X(46).                       01930099
           05  TOTAL-DAY-OF-WEEK       PIC X(10).                       01940099
           05  TOTAL-AMOUNT-X.                                          01950099
               10  TOTAL-AMOUNT        PIC Z,ZZZ,ZZZ,ZZZ,ZZZ.99-.       01960099
      *                                                                 01970099
       EJECT                                                            01980099
      ******************************************************************01990099
      *    MERCHANDISE LEDGER DAILY SALES RECORD LAYOUT                 02000099
      ******************************************************************02010099
           COPY MLRD022.                                                02020099
       EJECT                                                            02030099
      ******************************************************************02040099
      *    DB2 DAILY SALES RECORD LAYOUT                                02050099
      ******************************************************************02060099
           COPY DFRD005.                                                02070099
       EJECT                                                            02080099
      ******************************************************************02090099
      *    DATE VALIDATION CALLING PARAMETER LIST                       02100099
      ******************************************************************02110099
           COPY DPWS500.                                                02120099
       EJECT                                                            02130099
      *   STORE LAYOUT                                                  02140099
           EXEC SQL                                                     02150099
              INCLUDE XST00001                                          02160099
           END-EXEC.                                                    02170099
      *                                                                 02180099
      *   DB2 COMMUNICATION AREA                                        02190099
           EXEC SQL                                                     02200099
              INCLUDE SQLCA                                             02210099
           END-EXEC.                                                    02220099
      *                                                                 02230099
      *   DB2 COMMUNICATION AREA2                                       02240099
           COPY SQLCA2.                                                 02250099
      *                                                                 02260099
           EJECT                                                        02270099
       PROCEDURE DIVISION.                                              02280099
                                                                        02290099
       0000-DRIVER.                                                     02300099
                                                                        02310099
           PERFORM 9000-INITIALIZATION THRU 9009-EXIT.                  02320099
                                                                        02330099
           PERFORM 4000-PROCESS-SALES THRU 4009-EXIT                    02340099
                     UNTIL PS-SALES-EOF EQUAL PC-Y.                     02350099
                                                                        02360099
           PERFORM 5000-PRINT-REPORT THRU 5009-EXIT.                    02370099
                                                                        02370199
           PERFORM 5700-PRINT-SALES-TOTALS THRU 5709-EXIT.              02370299
                                                                        02370399
           PERFORM 9100-INITIALIZE-CORRECTIONS THRU 9109-EXIT.          02370499
                                                                        02370599
           PERFORM 4100-PROCESS-CORRECTIONS THRU 4109-EXIT              02370699
                     UNTIL PS-CORRECTIONS-EOF EQUAL PC-Y.               02370799
                                                                        02370899
           PERFORM 5100-PRINT-CORRECTIONS-REPORT THRU 5109-EXIT.        02370999
                                                                        02371099
           PERFORM 9500-EOF-PROCESSING THRU 9509-EXIT.                  02372099
                                                                        02373099
           STOP RUN.                                                    02374099
       EJECT                                                            02375099
      ***************************************************************** 02376099
      *               PROCESS SALES TRANSACTIONS                      * 02377099
      *     DUE TO COSA PROJECT OPENING UP THE SALES DATE TO BE THE   * 02378099
      *     ACTUAL TRANSACTION DATE, THE LATE SALES FROM PREVIOUS     * 02379099
      *     WEEKS MUST BE PUT THROUGH WITH THE CORRECTIONS AS THEY    * 02380099
      *     INSERT/UPDATE INTO THE TDADPTS TABLE THUS AVOIDING THE    * 02390099
      *     POSSIBLITY OF DUPLICATE KEYS.  GEORGETTE GILPIN 6/29/99   * 02400099
      ***************************************************************** 02410099
                                                                        02420099
       4000-PROCESS-SALES.                                              02430099
                                                                        02440099
           IF  ML022-SALE-STORE-NBR EQUAL PV-TEST-STORE                 02450099
               CONTINUE                                                 02460099
           ELSE                                                         02470099
               PERFORM 5000-PRINT-REPORT THRU 5009-EXIT                 02480099
               MOVE ML022-SALE-STORE-NBR TO PV-TEST-STORE               02481099
                                            XST00001-LOC-NBR            02481199
               PERFORM 9200-READ-STOR-MASTER THRU 9209-EXIT.            02482099
                                                                        02483099
           IF  ML022-SALE-EXTD-RTL-AMT EQUAL ZEROES                     02484099
               CONTINUE                                                 02485099
           ELSE                                                         02486099
               PERFORM 4500-BUILD-DF005   THRU 4509-EXIT                02487099
               MOVE ML022-SALE-EXTD-RTL-AMT TO DF005-SLS-AMT            02488099
               ADD  ML022-SALE-EXTD-RTL-AMT TO PV-TOT-SALES-WTD         02489099
               IF  DF005-KY-DTE LESS THAN PV-WEEK-BEGIN-DTE             02490099
                   PERFORM 7100-WRITE-RCD THRU 7109-EXIT                02490199
               ELSE                                                     02490299
                   PERFORM 7000-WRITE-RCD THRU 7009-EXIT.               02490399
                                                                        02490499
           PERFORM 6000-READ-SALES THRU 6009-EXIT.                      02490599
                                                                        02490699
       4009-EXIT.                                                       02490799
           EXIT.                                                        02490899
           EJECT                                                        02490999
      ***************************************************************** 02491099
      *              PROCESS SALES CORRECTIONS TRANSACTIONS           * 02492099
      ***************************************************************** 02493099
                                                                        02494099
       4100-PROCESS-CORRECTIONS.                                        02495099
                                                                        02496099
           IF  ML022-SALE-STORE-NBR EQUAL PV-TEST-STORE                 02497099
               CONTINUE                                                 02498099
           ELSE                                                         02499099
               MOVE PV-STORE-WTD             TO COR-TOTAL-FOR-WEEK      02500099
               PERFORM 5100-PRINT-CORRECTIONS-REPORT THRU 5109-EXIT     02510099
               MOVE ZEROES                   TO PV-STORE-WTD            02520099
               SET COR-DAY-INX               TO PC-1                    02530099
               MOVE PC-2                     TO PV-LINES                02540099
               MOVE ML022-SALE-STORE-NBR     TO PV-TEST-STORE           02550099
                                                XST00001-LOC-NBR        02551099
               PERFORM 9200-READ-STOR-MASTER THRU 9209-EXIT             02560099
               MOVE SPACES                   TO CORRECT-LINE            02570099
               MOVE PV-TEST-STORE-4          TO COR-STORE-NO            02580099
               MOVE XST00001-LOC-10-ABBR-NM  TO COR-STORE-NAME.         02590099
                                                                        02600099
           IF  COR-DAY-INX GREATER THAN PC-3                            02610099
               PERFORM 5100-PRINT-CORRECTIONS-REPORT THRU 5109-EXIT     02620099
               SET COR-DAY-INX TO PC-1                                  02630099
               MOVE SPACES     TO CORRECT-LINE.                         02640099
                                                                        02650099
           IF  ML022-SALE-EXTD-RTL-AMT EQUAL ZEROES                     02660099
               CONTINUE                                                 02670099
           ELSE                                                         02680099
               PERFORM 4500-BUILD-DF005   THRU 4509-EXIT                02690099
               MOVE ML022-SALE-EXTD-RTL-AMT TO DF005-SLS-CORR-AMT       02700099
               ADD  ML022-SALE-EXTD-RTL-AMT TO PV-TOT-CORRECTS-WTD      02710099
               IF  DF005-KY-DTE LESS THAN PV-WEEK-BEGIN-DTE             02711099
                   PERFORM 7100-WRITE-RCD THRU 7109-EXIT                02712099
               ELSE                                                     02713099
                   PERFORM 7000-WRITE-RCD THRU 7009-EXIT.               02714099
                                                                        02730099
           MOVE DF005-SLS-CORR-AMT TO COR-DAY-SALES (COR-DAY-INX).      02731099
           MOVE DF005-KY-DTE       TO COR-DAY-DATE  (COR-DAY-INX).      02731199
           MOVE DF005-DEPT-NBR     TO COR-DAY-DEPT  (COR-DAY-INX).      02731299
           SET  COR-DAY-INX        UP BY PC-1.                          02731399
                                                                        02731499
           PERFORM 6100-READ-CORRECTIONS  THRU 6109-EXIT.               02731599
                                                                        02731699
       4109-EXIT.                                                       02731799
           EXIT.                                                        02731899
           EJECT                                                        02731999
      ***************************************************************** 02732099
      *                BUILD DF005 RECORD                             * 02733099
      ***************************************************************** 02734099
                                                                        02735099
       4500-BUILD-DF005.                                                02736099
                                                                        02737099
           MOVE ML022-SALE-STORE-NBR    TO DF005-STR-NBR.               02738099
           MOVE ML022-SALE-DEPT-NBR     TO DF005-DEPT-NBR.              02739099
           MOVE ML022-SALE-FIN-LIAB-DTE TO DF005-KY-DTE.                02740099
           MOVE ZEROES                  TO DF005-SLS-CORR-AMT           02750099
                                           DF005-SLS-AMT.               02760099
           MOVE ML022-SALE-FSCL-DAY     TO PV-DAY-X .                   02770099
           ADD ML022-SALE-EXTD-RTL-AMT  TO PV-STORE-WTD                 02780099
                                           PV-TOT-TOTAL-WTD             02790099
                                           PV-DAYS-SALES (PV-DAY)       02800099
                                           PV-TOT-SALES-DAY (PV-DAY).   02810099
                                                                        02820099
       4509-EXIT.                                                       02830099
           EXIT.                                                        02840099
           EJECT                                                        02850099
      ***************************************************************** 02860099
      *          PRINT SALES REPORT ONE STORE AT A TIME               * 02870099
      ***************************************************************** 02880099
                                                                        02890099
       5000-PRINT-REPORT.                                               02900099
                                                                        02910099
           IF  PV-LINE-COUNT GREATER THAN PC-LINE-MAX                   02920099
               PERFORM 5600-PRINT-HEADING THRU 5609-EXIT.               02930099
                                                                        02940099
           MOVE PV-TEST-STORE-4 TO DET-STORE-NO.                        02950099
           MOVE XST00001-LOC-10-ABBR-NM TO DET-STORE-NAME.              02960099
           SET PV-DAY-INX TO PC-1.                                      02970099
           SET DET-DAY-INX TO PC-1.                                     02980099
           PERFORM UNTIL DET-DAY-INX GREATER THAN PC-DAY-MAX            02990099
                MOVE PV-DAYS-SALES (PV-DAY-INX)                         03000099
                  TO DET-DAY-SALES (DET-DAY-INX)                        03010099
                MOVE ZEROES TO PV-DAYS-SALES (PV-DAY-INX)               03020099
                SET PV-DAY-INX UP BY PC-1                               03030099
                SET DET-DAY-INX UP BY PC-1                              03040099
           END-PERFORM.                                                 03050099
                                                                        03060099
           MOVE PV-STORE-WTD TO DET-TOTAL-FOR-WEEK.                     03070099
           MOVE ZEROES       TO PV-STORE-WTD.                           03080099
                                                                        03090099
           MOVE DETAIL-LN TO PRINT-LINE.                                03100099
           MOVE PC-2      TO PV-LINES.                                  03110099
           PERFORM 5900-WRITE-PRINTER THRU 5909-EXIT.                   03120099
                                                                        03130099
           ADD PC-2 TO PV-LINE-COUNT.                                   03140099
                                                                        03150099
       5009-EXIT.                                                       03160099
           EXIT.                                                        03170099
                                                                        03180099
      ***************************************************************** 03190099
      *          PRINT CORRECTIONS REPORT                             * 03200099
      ***************************************************************** 03210099
                                                                        03220099
       5100-PRINT-CORRECTIONS-REPORT.                                   03230099
                                                                        03240099
           IF  PV-LINE-COUNT GREATER THAN PC-LINE-MAX                   03250099
               PERFORM 5600-PRINT-HEADING THRU 5609-EXIT.               03260099
                                                                        03270099
           IF  PS-CORRECTIONS-EOF EQUAL PC-Y                            03280099
               MOVE PV-STORE-WTD TO COR-TOTAL-FOR-WEEK.                 03290099
                                                                        03300099
           MOVE CORRECT-LINE TO PRINT-LINE.                             03310099
           PERFORM 5900-WRITE-PRINTER THRU 5909-EXIT.                   03320099
           INITIALIZE CORRECT-LINE.                                     03321099
                                                                        03330099
           ADD PV-LINES      TO PV-LINE-COUNT.                          03340099
           MOVE PC-1         TO PV-LINES.                               03350099
                                                                        03360099
       5109-EXIT.                                                       03370099
           EXIT.                                                        03380099
           EJECT                                                        03390099
      ***************************************************************** 03400099
      *          PRINT REPORT HEADINGS                                * 03410099
      ***************************************************************** 03420099
                                                                        03430099
       5600-PRINT-HEADING.                                              03440099
                                                                        03450099
           MOVE PC-4          TO PV-LINE-COUNT.                         03460099
           ADD  PC-1          TO PV-PAGE-COUNT.                         03470099
           MOVE PV-PAGE-COUNT TO DP132-PAGE-NUMBER.                     03480099
                                                                        03490099
           WRITE PRINT-LINE FROM DP132-STANDRD-HEADER-132-COLS          03500099
              AFTER ADVANCING PAGE.                                     03510099
                                                                        03520099
           MOVE HEAD-LN2 TO PRINT-LINE.                                 03530099
           MOVE PC-1     TO PV-LINES.                                   03540099
           PERFORM 5900-WRITE-PRINTER THRU 5909-EXIT.                   03550099
                                                                        03560099
           MOVE HEAD-LN3 TO PRINT-LINE.                                 03570099
           MOVE PC-2     TO PV-LINES.                                   03580099
           PERFORM 5900-WRITE-PRINTER THRU 5909-EXIT.                   03590099
                                                                        03600099
       5609-EXIT.                                                       03610099
           EXIT.                                                        03620099
           EJECT                                                        03630099
      ***************************************************************** 03640099
      *       PRINT SALES TOTALS ON REPORT                            * 03650099
      ***************************************************************** 03660099
                                                                        03670099
       5700-PRINT-SALES-TOTALS.                                         03680099
                                                                        03690099
           MOVE PC-4   TO PV-LINE-COUNT.                                03700099
           MOVE ZEROES TO PV-PAGE-COUNT.                                03710099
           ADD  PC-1   TO DP132-REPORT-NUMBER.                          03720099
           MOVE PC-1   TO DP132-PAGE-NUMBER.                            03730099
                                                                        03740099
           WRITE PRINT-LINE FROM DP132-STANDRD-HEADER-132-COLS          03750099
              AFTER ADVANCING PAGE.                                     03760099
                                                                        03770099
           MOVE HEAD-LN2 TO PRINT-LINE.                                 03780099
           MOVE PC-1     TO PV-LINES.                                   03790099
           PERFORM 5900-WRITE-PRINTER THRU 5909-EXIT.                   03800099
                                                                        03810099
           MOVE PV-TOT-SALES-DAY (PC-1) TO TOTAL-AMOUNT.                03820099
           MOVE 'SUNDAY'                TO TOTAL-DAY-OF-WEEK.           03830099
           MOVE TOTAL-LN                TO PRINT-LINE.                  03840099
           MOVE PC-2                    TO PV-LINES.                    03850099
           PERFORM 5900-WRITE-PRINTER THRU 5909-EXIT.                   03860099
                                                                        03870099
           MOVE PV-TOT-SALES-DAY (PC-2) TO TOTAL-AMOUNT.                03880099
           MOVE 'MONDAY'                TO TOTAL-DAY-OF-WEEK.           03890099
           MOVE TOTAL-LN                TO PRINT-LINE.                  03900099
           MOVE PC-2                    TO PV-LINES.                    03910099
           PERFORM 5900-WRITE-PRINTER THRU 5909-EXIT.                   03920099
                                                                        03930099
           MOVE PV-TOT-SALES-DAY (PC-3) TO TOTAL-AMOUNT.                03940099
           MOVE 'TUESDAY'               TO TOTAL-DAY-OF-WEEK.           03950099
           MOVE TOTAL-LN                TO PRINT-LINE.                  03960099
           MOVE PC-2                    TO PV-LINES.                    03970099
           PERFORM 5900-WRITE-PRINTER THRU 5909-EXIT.                   03980099
                                                                        03990099
           MOVE PV-TOT-SALES-DAY (PC-4) TO TOTAL-AMOUNT.                04000099
           MOVE 'WEDNESDAY'             TO TOTAL-DAY-OF-WEEK.           04010099
           MOVE TOTAL-LN                TO PRINT-LINE.                  04020099
           MOVE PC-2                    TO PV-LINES.                    04030099
           PERFORM 5900-WRITE-PRINTER THRU 5909-EXIT.                   04040099
                                                                        04050099
           MOVE PV-TOT-SALES-DAY (PC-5) TO TOTAL-AMOUNT.                04060099
           MOVE 'THURSDAY'              TO TOTAL-DAY-OF-WEEK.           04070099
           MOVE TOTAL-LN                TO PRINT-LINE.                  04080099
           MOVE PC-2                    TO PV-LINES.                    04090099
           PERFORM 5900-WRITE-PRINTER THRU 5909-EXIT.                   04100099
                                                                        04110099
           MOVE PV-TOT-SALES-DAY (PC-6) TO TOTAL-AMOUNT.                04120099
           MOVE 'FRIDAY'                TO TOTAL-DAY-OF-WEEK.           04130099
           MOVE TOTAL-LN                TO PRINT-LINE.                  04140099
           MOVE PC-2                    TO PV-LINES.                    04150099
           PERFORM 5900-WRITE-PRINTER THRU 5909-EXIT.                   04160099
                                                                        04170099
           MOVE PV-TOT-SALES-DAY (PC-7) TO TOTAL-AMOUNT.                04180099
           MOVE 'SATURDAY'              TO TOTAL-DAY-OF-WEEK.           04190099
           MOVE TOTAL-LN                TO PRINT-LINE.                  04200099
           MOVE PC-2                    TO PV-LINES.                    04210099
           PERFORM 5900-WRITE-PRINTER THRU 5909-EXIT.                   04220099
                                                                        04230099
           MOVE ALL '-'                 TO TOTAL-AMOUNT-X.              04240099
           MOVE SPACES                  TO TOTAL-DAY-OF-WEEK.           04250099
           MOVE TOTAL-LN                TO PRINT-LINE.                  04260099
           MOVE PC-2                    TO PV-LINES.                    04270099
           PERFORM 5900-WRITE-PRINTER THRU 5909-EXIT.                   04280099
                                                                        04290099
           MOVE PV-TOT-SALES-WTD        TO TOTAL-AMOUNT.                04300099
           MOVE 'ALL DAYS'              TO TOTAL-DAY-OF-WEEK.           04310099
           MOVE TOTAL-LN                TO PRINT-LINE.                  04320099
           MOVE PC-2                    TO PV-LINES.                    04330099
           PERFORM 5900-WRITE-PRINTER THRU 5909-EXIT.                   04340099
                                                                        04350099
           MOVE +99    TO PV-LINE-COUNT.                                04360099
           MOVE SPACES TO PV-TEST-STORE.                                04370099
                                                                        04380099
       5709-EXIT.                                                       04390099
           EXIT.                                                        04400099
                                                                        04410099
      ***************************************************************** 04420099
      *       PRINT TOTALS ON REPORT                                  * 04430099
      ***************************************************************** 04440099
                                                                        04450099
       5800-PRINT-TOTALS.                                               04460099
                                                                        04470099
           MOVE PC-4          TO PV-LINE-COUNT.                         04480099
           MOVE PC-1          TO PV-PAGE-COUNT.                         04490099
           ADD  PC-1          TO DP132-REPORT-NUMBER.                   04500099
           MOVE PV-PAGE-COUNT TO DP132-PAGE-NUMBER.                     04510099
                                                                        04520099
           WRITE PRINT-LINE FROM DP132-STANDRD-HEADER-132-COLS          04530099
              AFTER ADVANCING PAGE.                                     04540099
                                                                        04550099
           MOVE HEAD-LN2 TO PRINT-LINE.                                 04560099
           MOVE PC-1     TO PV-LINES.                                   04570099
           PERFORM 5900-WRITE-PRINTER THRU 5909-EXIT.                   04571099
                                                                        04572099
           MOVE PV-TOT-CORRECTS-WTD     TO TOTAL-AMOUNT.                04573099
           MOVE 'CORRECTIONS'           TO TOTAL-DAY-OF-WEEK.           04574099
           MOVE TOTAL-LN                TO PRINT-LINE.                  04575099
           MOVE PC-2                    TO PV-LINES.                    04576099
           PERFORM 5900-WRITE-PRINTER THRU 5909-EXIT.                   04577099
                                                                        04578099
           MOVE PV-TOT-SALES-WTD        TO TOTAL-AMOUNT.                04579099
           MOVE 'SALES '                TO TOTAL-DAY-OF-WEEK.           04580099
           MOVE TOTAL-LN                TO PRINT-LINE.                  04581099
           MOVE PC-2                    TO PV-LINES.                    04581199
           PERFORM 5900-WRITE-PRINTER THRU 5909-EXIT.                   04581299
                                                                        04581399
           MOVE ALL '-'                 TO TOTAL-AMOUNT-X.              04581499
           MOVE SPACES                  TO TOTAL-DAY-OF-WEEK.           04581599
           MOVE TOTAL-LN                TO PRINT-LINE.                  04581699
           MOVE PC-2                    TO PV-LINES.                    04581799
           PERFORM 5900-WRITE-PRINTER THRU 5909-EXIT.                   04581899
                                                                        04581999
           MOVE PV-TOT-TOTAL-WTD        TO TOTAL-AMOUNT.                04582099
           MOVE 'TOTAL  '               TO TOTAL-DAY-OF-WEEK.           04583099
           MOVE TOTAL-LN                TO PRINT-LINE.                  04584099
           MOVE PC-2                    TO PV-LINES.                    04585099
           PERFORM 5900-WRITE-PRINTER THRU 5909-EXIT.                   04585199
                                                                        04585299
       5809-EXIT.                                                       04585399
           EXIT.                                                        04585499
      ***************************************************************** 04585599
      *    COMMON PARAGRAPH FOR WRITING TO THE PRINTER                * 04585699
      ***************************************************************** 04585799
                                                                        04585899
       5900-WRITE-PRINTER.                                              04585999
                                                                        04586099
           WRITE PRINT-LINE                                             04587099
              AFTER ADVANCING PV-LINES.                                 04588099
                                                                        04589099
       5909-EXIT.                                                       04590099
           EXIT.                                                        04600099
           EJECT                                                        04610099
      ***************************************************************** 04620099
      *               READ ML DAILY SALES FILE                        * 04630099
      ***************************************************************** 04640099
                                                                        04650099
       6000-READ-SALES.                                                 04660099
                                                                        04670099
           READ DAILY-SALES-ML-FILE INTO ML022-SALE-RECORD              04680099
               AT END                                                   04690099
                 MOVE PC-Y TO PS-SALES-EOF.                             04700099
                                                                        04710099
       6009-EXIT.                                                       04720099
           EXIT.                                                        04730099
                                                                        04740099
      ***************************************************************** 04750099
      *               READ ML DAILY CORRECTIONS FILE                  * 04760099
      ***************************************************************** 04770099
                                                                        04780099
       6100-READ-CORRECTIONS.                                           04790099
                                                                        04800099
           READ DAILY-CORRECTIONS-ML-FILE INTO ML022-SALE-RECORD        04810099
               AT END                                                   04820099
                 MOVE PC-Y TO PS-CORRECTIONS-EOF.                       04830099
                                                                        04840099
       6109-EXIT.                                                       04850099
           EXIT.                                                        04860099
           EJECT                                                        04870099
      ***************************************************************** 04880099
      *                    WRITE THIS WEEK'S RECORDS                  * 04890099
      ***************************************************************** 04900099
                                                                        04910099
       7000-WRITE-RCD.                                                  04920099
                                                                        04930099
           WRITE DF005O-RECORD FROM DF005-RECORD                        04940099
               INVALID KEY                                              04950099
               DISPLAY 'DFKUT010 - ***********************************' 04960099
               DISPLAY 'DFKUT010 - INVALID KEY ON WRITE TO OUT01 FILE'  04970099
               DISPLAY 'DFKUT010 - ***********************************' 04980099
               PERFORM 9600-PROGRAM-ABEND.                              04990099
                                                                        05000099
       7009-EXIT.                                                       05010099
           EXIT.                                                        05020099
                                                                        05030099
      ***************************************************************** 05040099
      *                    WRITE LAST WEEK'S RECORDS                  * 05050099
      ***************************************************************** 05060099
                                                                        05070099
       7100-WRITE-RCD.                                                  05080099
                                                                        05090099
           WRITE DF005-REC FROM DF005-RECORD                            05100099
               INVALID KEY                                              05110099
               DISPLAY 'DFKUT010 - ***********************************' 05120099
               DISPLAY 'DFKUT010 - INVALID KEY ON WRITE TO OUT02 FILE'  05130099
               DISPLAY 'DFKUT010 - ***********************************' 05140099
               PERFORM 9600-PROGRAM-ABEND.                              05150099
                                                                        05160099
       7109-EXIT.                                                       05170099
           EXIT.                                                        05180099
           EJECT                                                        05190099
       9000-INITIALIZATION.                                             05200099
                                                                        05210099
           ACCEPT PV-CPU-DATE FROM DATE.                                05220099
           MOVE PV-CPU-YEAR   TO DP132-RUN-YEAR.                        05230099
           MOVE PV-CPU-DAY    TO DP132-RUN-DAY.                         05240099
           MOVE PV-CPU-MONTH  TO DP132-RUN-MONTH.                       05250099
           IF  PV-CPU-YEAR GREATER THAN 80                              05260099
               ADD 1900 TO DP132-RUN-YEAR                               05270099
           ELSE                                                         05280099
               ADD 2000 TO DP132-RUN-YEAR.                              05290099
           ACCEPT PV-CPU-TIME FROM TIME.                                05300099
           MOVE PV-CPU-HOUR   TO DP132-RUN-HOUR.                        05310099
           MOVE PV-CPU-MINUTE TO DP132-RUN-MINUTE.                      05320099
           MOVE 'DFKUT010'    TO DP132-PROGRAM-NAME.                    05330099
           ADD  PC-1          TO DP132-REPORT-NUMBER.                   05340099
                                                                        05350099
                                                                        05360099
           INITIALIZE DPG51                                             05370099
                      DPG52                                             05380099
                      DPG53                                             05390099
                      DPG54                                             05400099
                      DPG55                                             05410099
                      DPG56.                                            05420099
                                                                        05420199
           MOVE DP132-RUN-DATE           TO DPG52-LK-DATE-INPUT.        05420299
           SET DPG52-LK-DTE-GREG-CC-FMT  TO TRUE.                       05420399
           SET DPG51-FISCAL-454-CALENDAR TO TRUE.                       05420499
           SET DPG51-DECREMENT-DATE      TO TRUE.                       05420599
           MOVE PC-7                     TO DPG51-INCR-DECR-DAYS-9.     05420699
           CALL DP500-KOHLS-CALENDAR-ROUTINE USING                      05420799
                                             DPG51                      05420899
                                             DPG52                      05420999
                                             DPG53                      05421099
                                             DPG54                      05422099
                                             DPG55                      05423099
                                             DPG56.                     05424099
                                                                        05425099
           EVALUATE TRUE                                                05426099
               WHEN DPG54-SEVERE-ERROR                                  05427099
               WHEN DPG54-DATE-INVALID                                  05428099
                   DISPLAY '** ABEND **'                                05429099
                   DISPLAY '** PROGRAM = DFKUT010'                      05429199
                   DISPLAY '** CALENDAR ROUTINE ERROR'                  05429299
                   DISPLAY 'DPG54-RETURN-FLAGS = ' DPG54-RETURN-FLAGS   05429399
                   DISPLAY 'DPG54-ERROR-MESSAGE = ' DPG54-ERROR-MESSAGE 05429499
                   DISPLAY 'DPG52-LK-DATE-INPUT = ' DPG52-LK-DATE-INPUT 05429599
                   SET  AC-DATE-ERROR TO TRUE                           05429699
                   CALL 'ILBOABN0' USING PV-ABEND-CODE                  05429799
           END-EVALUATE.                                                05429899
                                                                        05429999
           MOVE DPG55-1ST-DAY-OF-WEEK TO PV-WEEK-BEGIN-DTE.             05430099
           DISPLAY 'DFKUT010 - ************************'.               05431099
           DISPLAY 'DFKUT010 - LAST WEEK BEGIN DATE'.                   05432099
           DISPLAY 'DFKUT010 - ' PV-WEEK-BEGIN-DTE.                     05433099
           DISPLAY 'DFKUT010 - ************************'.               05434099
                                                                        05435099
           OPEN  INPUT DAILY-SALES-ML-FILE                              05436099
                       DAILY-CORRECTIONS-ML-FILE                        05437099
                OUTPUT DAILY-LAST-WEEK-DB2-FILE                         05438099
                       DAILY-PREV-WEEK-DB2-FILE                         05439099
                       DAILY-SALES-REPORT.                              05440099
                                                                        05450099
           PERFORM 6000-READ-SALES THRU 6009-EXIT.                      05460099
           MOVE ML022-SALE-STORE-NBR TO PV-TEST-STORE                   05470099
                                        XST00001-LOC-NBR.               05471099
           PERFORM 9200-READ-STOR-MASTER THRU 9209-EXIT.                05480099
                                                                        05490099
       9009-EXIT.                                                       05500099
           EXIT.                                                        05510099
                                                                        05520099
       9100-INITIALIZE-CORRECTIONS.                                     05530099
                                                                        05540099
           PERFORM 6100-READ-CORRECTIONS  THRU 6109-EXIT.               05550099
                                                                        05560099
           IF  PS-CORRECTIONS-EOF EQUAL PC-Y                            05570099
               GO TO 9109-EXIT.                                         05580099
                                                                        05581099
           MOVE ML022-SALE-STORE-NBR     TO PV-TEST-STORE               05582099
                                            XST00001-LOC-NBR.           05582199
           PERFORM 9200-READ-STOR-MASTER THRU 9209-EXIT.                05583099
           MOVE PV-TEST-STORE-4          TO COR-STORE-NO.               05584099
           MOVE XST00001-LOC-10-ABBR-NM  TO COR-STORE-NAME.             05584199
           ADD  PC-1                     TO DP132-REPORT-NUMBER.        05584299
           MOVE PC-CORRECTION-HEADING    TO HEAD-LN2-FILLER.            05584399
           MOVE PC-CORRECTION-HEADING-2  TO HEAD-LN3.                   05584499
           SET  COR-DAY-INX              TO PC-1.                       05584599
                                                                        05584699
       9109-EXIT.                                                       05584799
           EXIT.                                                        05584899
                                                                        05584999
       9200-READ-STOR-MASTER.                                           05585099
                                                                        05586099
      *   STORE DB2 SELECT                                              05587099
           EXEC SQL                                                     05588099
              SELECT LOC_10_ABBR_NM                                     05589099
               INTO :XST00001-LOC-10-ABBR-NM                            05590099
                FROM XST_LOC                                            05600099
               WHERE LOC_TYP_CDE = 'DS' AND                             05620099
                     LOC_NBR = :XST00001-LOC-NBR                        05630099
           END-EXEC.                                                    05640099
                                                                        05650099
           IF SQLCODE < ZERO                                            05660099
               DISPLAY 'SELECT UNSUCCESSFUL FOR STORE TABLE XST_LOC'    05670099
               GO TO 9900-SQL-ERROR.                                    05680099
                                                                        05690099
           IF (SQLCODE > ZERO                                           05700099
           AND SQLCODE NOT EQUAL +100)                                  05710099
            OR SQLWARN0 EQUAL PC-W                                      05720099
               DISPLAY 'SELECT WARNING FOR STORE TABLE TSTR00'          05730099
               GO TO 9800-SQL-WARNING.                                  05740099
                                                                        05750099
       9209-EXIT.                                                       05760099
           EXIT.                                                        05770099
                                                                        05780099
       9500-EOF-PROCESSING.                                             05790099
                                                                        05800099
           MOVE PC-TOTAL-HEADING   TO HEAD-LN2-FILLER.                  05810099
           PERFORM 5800-PRINT-TOTALS THRU 5809-EXIT.                    05820099
                                                                        05830099
           CLOSE DAILY-SALES-ML-FILE                                    05840099
                 DAILY-CORRECTIONS-ML-FILE                              05850099
                 DAILY-SALES-REPORT                                     05860099
                 DAILY-PREV-WEEK-DB2-FILE                               05870099
                 DAILY-LAST-WEEK-DB2-FILE.                              05880099
                                                                        05890099
       9509-EXIT.                                                       05900099
           EXIT.                                                        05910099
                                                                        05920099
       9600-PROGRAM-ABEND.                                              05930099
           DISPLAY 'DFKUT010 - ABORTING'.                               05940099
           SET AC-BAD-FILE-WRITE TO TRUE.                               05950099
           CALL 'ILBOABN0' USING PV-ABEND-CODE.                         05960099
                                                                        05970099
       9800-SQL-WARNING.                                                05980099
           MOVE SQLCODE    TO SQLCODE2.                                 05990099
           MOVE SQLERRD(3) TO SQLERRD3.                                 06000099
           DISPLAY '** ABEND **       ** = SQLWARNING'.                 06010099
           DISPLAY '** PROGRAM        ** = DFKUT010'.                   06020099
           DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  06030099
           DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  06040099
           DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                  06050099
           DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                  06060099
           DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                  06070099
           DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                  06080099
           DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                  06090099
           DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                  06100099
           DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                  06110099
           DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                  06120099
                                                                        06130099
           SET AC-DB2-ERROR TO TRUE.                                    06140099
           CALL 'ILBOABN0' USING PV-ABEND-CODE.                         06150099
                                                                        06160099
       9900-SQL-ERROR.                                                  06170099
           MOVE SQLCODE    TO SQLCODE2.                                 06180099
           MOVE SQLERRD(3) TO SQLERRD3.                                 06190099
           DISPLAY '** ABEND **       ** = SQLWARNING'.                 06200099
           DISPLAY '** PROGRAM        ** = DFKUT010'.                   06210099
           DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  06220099
           DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  06230099
           DISPLAY '** SQLERRM        ** = ' SQLERRM.                   06240099
           DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  06250099
                                                                        06260099
           SET AC-DB2-ERROR TO TRUE.                                    06270099
           CALL 'ILBOABN0' USING PV-ABEND-CODE.                         06280099
