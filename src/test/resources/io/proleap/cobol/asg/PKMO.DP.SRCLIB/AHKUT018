000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    AHKUT018.                                         00020000
000300 AUTHOR.        CHERI MASTEL.                                     00030000
000400 INSTALLATION.  KOHLS.                                            00040000
000500 DATE-WRITTEN   AUG, 1997.                                        00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800******************************************************************00080009
000900*   AHKUT018.  "ARCHIVE HISTORY" PROJECT.  EXTRACT PROGRAM.      *00090009
001000*                                                                *00100009
001100*   PURPOSE:                                                     *00110009
001200*   THIS PROGRAM CREATES AN EXTRACT FILE FROM: TINVCTM.          *00120009
001300*   THIS EXTRACT FILE CONSISTS OF ROWS ELIGIBLE TO BE:           *00130009
001400*   1) LOADED TO THE "ARCHIVE/HISTORY" VERSIONS OF THE TABLES.   *00140009
001500*   2) DELETED FROM THE OPERATIONAL VERSIONS OF THE TABLES.      *00150009
001600*                                                                *00160009
001700*   PROCESSING OVERVIEW:                                         *00170009
001800*   THIS PROGRAM READS A "DRIVER" FILE. FOR EACH RECORD READ,    *00180009
001900*   1) INCREMENT COUNT OF RECORDS READ.                          *00190009
002000*   2) ATTEMPT TO FIND RELATED ROW(S) ON THE TABLE.              *00200009
002100*      2.A) IF NO MATCH(ES):                                     *00210009
002200*           2.A.1) PROCESSING CONTINUES                          *00220009
002300*           2.A.2) DO NOT PERFORM ERROR/REPORTING ROUTINES;      *00230009
002400*                  THIS SYSTEM DOES NOT CLEANSE DATA NOR REPORT  *00240009
002500*                  ON UNCLEAN DATA.  IT SIMPLY MIGRATES          *00250009
002600*                  CONDITIONS OCCURRING IN OPERATIONAL           *00260009
002700*                  TABLES OVER TO THE ARCHIVE/HISTORY TABLES.    *00270009
002800*      2.B) IF MATCH(ES):                                        *00280009
002900*           2.B.1) INCREMENT COUNT OF ROW(S) FOUND.              *00290009
003000*           2.B.2) WRITE THESE ROW(S) TO THE EXTRACT FILE.       *00300009
003100*           2.B.3) INCREMENT COUNT OF RECORDS WRITTEN.           *00310009
003200*           2.B.4) DO NOT REMOVE THE ROW(S) FROM THE TABLE       *00320009
003300*                  AT THIS TIME.  THEY WILL BE REMOVED IN OTHER  *00330009
003400*                  PROCESSING, AFTER HAVING BEEN LOADED TO THE   *00340009
003500*                  ARCHIVE/HISTORY TABLE.                        *00350009
003600*   3) EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT       *00360009
003700*      RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST     *00370009
003800*      WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.     *00380009
003810*----------------------------------------------------------------*00381012
003820*  CHANGE LOG:                                                   *00382012
003830* 06/19/07                                                       *00383015
003840*     MATCH BY DC PROJECT.                                       *00384012
003850*     INCREASED SIZE OF INPUT FILE FROM 186 TO 189.  THIS WAS    *00385012
003860*     NEEDED TO ALLOW FOR THE 2 NEW FIELDS IN THE AHRD001        *00386012
003870*     COPYBOOK: DC-NBR AND MTCH-LVL-CDE.                         *00387012
003880* MADE BY: MICHELE RINDFLEISCH                 WR# 32804         *00388014
003890*----------------------------------------------------------------*00389012
003900******************************************************************00390009
004000 ENVIRONMENT DIVISION.                                            00400000
004100 CONFIGURATION SECTION.                                           00410000
004200 SOURCE-COMPUTER.        IBM-3090.                                00420000
004300 OBJECT-COMPUTER.        IBM-3090.                                00430000
004400                                                                  00440000
004500 INPUT-OUTPUT SECTION.                                            00450000
004600 FILE-CONTROL.                                                    00460000
004700                                                                  00470000
004800     SELECT IN-DRIVER-FILE                ASSIGN TO IN01.         00480000
004900     SELECT OUT-EXTRACT-FILE              ASSIGN TO OUT01.        00490000
005000                                                                  00500000
005100******************************************************************00510000
005200 DATA DIVISION.                                                   00520000
005300 FILE SECTION.                                                    00530000
005400                                                                  00540000
005500 FD  IN-DRIVER-FILE                                               00550000
005600     RECORDING MODE IS F                                          00560000
005700     LABEL RECORDS ARE STANDARD                                   00570000
005800     BLOCK CONTAINS 0 RECORDS.                                    00580000
005900 01  IN-DRIVER-RECORD                PIC  X(189).                 00590012
006000                                                                  00600000
006100**** TINVCTM:                                                     00610000
006200 FD  OUT-EXTRACT-FILE                                             00620000
006300     RECORDING MODE IS F                                          00630000
006400     LABEL RECORDS ARE STANDARD                                   00640000
006500     BLOCK CONTAINS 0 RECORDS.                                    00650000
006600 01  OUT-EXTRACT-RECORD              PIC  X(076).                 00660011
006700                                                                  00670000
006800                                                                  00680000
006900                                                                  00690000
007000 WORKING-STORAGE SECTION.                                         00700000
007100                                                                  00710000
007200 01  PC-PROGRAM-CONSTANTS.                                        00720000
007300     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'AHKUT018'.  00730000
007400     05  PC-PGM-PROGRESS-DESC.                                    00740000
007500         10  PC-BEGINNING            PIC X(09) VALUE 'BEGINNING'. 00750000
007600         10  PC-CONTINUING           PIC X(10) VALUE              00760000
007700                                               'CONTINUING'.      00770000
007800         10  PC-ENDING               PIC X(06) VALUE 'ENDING'.    00780000
007900         10  PC-ABENDING             PIC X(08) VALUE 'ABENDING'.  00790000
008000     05  PC-ABEND-INFO.                                           00800000
008100         10  PC-ABEND                PIC X(11) VALUE              00810000
008200                                               '** ABEND **'.     00820000
008300         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00830000
008400                                               '- PARA       : '. 00840000
008500         10  PC-ABEND-MSG-DISPLAY-PARA                            00850000
008600                                     PIC X(15) VALUE              00860000
008700                                               '  CALLED PARA: '. 00870000
008800         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00880000
008900                                               '  FOR ABEND# : '. 00890000
009000         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00900000
009100                                               '- ERROR IS   : '. 00910000
009200         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00920000
009300         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              00930000
009400                                               '- ACTION     : '. 00940000
009500     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 100000.      00950004
009600                                                                  00960000
009700 01  PS-PROGRAM-SWITCHES.                                         00970000
009800     05  PS-IN-DRIVER-EOF-SW         PIC X(01) VALUE 'N'.         00980000
009900         88  PS-IN-DRIVER-EOF                  VALUE 'Y'.         00990000
010000         88  PS-IN-DRIVER-NOT-EOF              VALUE 'N'.         01000000
010100     05  PS-CURSOR-HAS-DATA-SW       PIC X(01) VALUE 'N'.         01010000
010200         88  PS-CURSOR-HAS-DATA                VALUE 'Y'.         01020000
010300         88  PS-CURSOR-HAS-NO-DATA             VALUE 'N'.         01030000
010400     05  PS-TABLE-LOOP-DONE-SW       PIC X(01) VALUE 'N'.         01040000
010500         88  PS-TABLE-LOOP-DONE                VALUE 'Y'.         01050000
010600         88  PS-TABLE-LOOP-NOT-DONE            VALUE 'N'.         01060000
010700                                                                  01070000
010800 01  PV-PROGRAM-VARIABLES.                                        01080000
010900     05  PV-PAYT-REQ-SEQ-NBR-COMP    PIC S9(9) VALUE 0 COMP.      01090000
011000     05  PV-PAYT-REQ-SEQ-NBR-NUM     PIC  9(9) VALUE 0.           01100002
011100     05  PV-IN-DRIVER-RECS-READ-CNT  PIC  9(9) VALUE 0.           01110000
011200     05  PV-RECS-WITH-MATCHES-CNT    PIC  9(9) VALUE 0.           01120000
011300     05  PV-TABLE-ROW-SELECT-CNT     PIC  9(9) VALUE 0.           01130000
011400     05  PV-EXTRACT-WRITTEN-CNT      PIC  9(9) VALUE 0.           01140000
011500                                                                  01150000
011600     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACES.      01160000
011700     05  PV-DB2-OPERATION-MSG-1      PIC X(79) VALUE SPACES.      01170000
011800     05  PV-DB2-TABLE-NAME           PIC X(18) VALUE SPACES.      01180000
011900     05  PV-DISPLAY-NTH-MULTIPLE     PIC 9(9)  VALUE 0.           01190000
012000     05  PV-DISPLAY-NTH-REMAINDER    PIC 9(9)  VALUE 0.           01200000
012100     05  PV-SQLCODE                  PIC +999  VALUE ZERO.        01210000
012200                                                                  01220000
012300     05  PV-TMST                     PIC X(26) VALUE SPACES.      01230000
012400     05  PV-TIMESTAMP-DETAIL                                      01240000
012500         REDEFINES                                                01250000
012600         PV-TMST.                                                 01260000
012700         10  PV-TIMESTAMP-19.                                     01270000
012800             15  PV-TMS-DATE.                                     01280000
012900                 20  PV-TMS-YEAR.                                 01290000
013000                     25  PV-TMS-CC   PIC X(02).                   01300000
013100                     25  PV-TMS-YY   PIC X(02).                   01310000
013200                 20  FILLER          PIC X(01).                   01320000
013300                 20  PV-TMS-MONTH    PIC X(02).                   01330000
013400                 20  FILLER          PIC X(01).                   01340000
013500                 20  PV-TMS-DAY      PIC X(02).                   01350000
013600             15  FILLER              PIC X(01).                   01360000
013700             15  PV-TMS-HOUR         PIC X(02).                   01370000
013800             15  FILLER              PIC X(01).                   01380000
013900             15  PV-TMS-MINUTE       PIC X(02).                   01390000
014000             15  FILLER              PIC X(01).                   01400000
014100             15  PV-TMS-SECOND       PIC X(02).                   01410000
014200         10  FILLER                  PIC X(01).                   01420000
014300         10  PV-TMS-MSECOND          PIC X(06).                   01430000
014400                                                                  01440000
014500 01  DM-DISPLAY-MESSAGE.                                          01450000
014600     05  DM-01-10.                                                01460000
014700         10  DM-PROGRAM              PIC X(08) VALUE SPACE.       01470000
014800         10  FILLER                  PIC X(02) VALUE ': '.        01480000
014900     05  DM-11-80.                                                01490000
015000         10  FILLER                  PIC X(37) VALUE              01500000
015100                        'SELECT ROWS MATCHING TO DRIVER FILE, '.  01510000
015200         10  FILLER                  PIC X(30) VALUE              01520000
015300                        'CREATING TINVCTM EXTRACT FILE.'.         01530000
015400         10  FILLER                  PIC X(01) VALUE SPACE.       01540000
015500         10  FILLER                  PIC X(01) VALUE ALL '*'.     01550000
015600     05  DM-81-120.                                               01560000
015700         10  FILLER                  PIC X(40) VALUE ALL '*'.     01570000
015800                                                                  01580000
015900 01  DP-DISPLAY-PROGRESS-MSG.                                     01590000
016000     05  DP-PROGRAM                  PIC X(08) VALUE SPACE.       01600000
016100     05  FILLER                      PIC X(02) VALUE SPACE.       01610000
016200     05  DP-STATUS-DESCRIPTION       PIC X(10) VALUE SPACE.       01620000
016300     05  FILLER                      PIC X(04) VALUE ' AT '.      01630000
016400     05  DP-TIMESTAMP-19             PIC X(19) VALUE SPACE.       01640000
016500     05  FILLER                      PIC X(03) VALUE '.  '.       01650000
016600     05  FILLER                      PIC X(03) VALUE              01660000
016700                                         'IN:'.                   01670000
016800     05  DP-IN-CNT                   PIC ZZZ,ZZZ,ZZ9              01680000
016900                                               VALUE ZERO.        01690000
017000     05  FILLER                      PIC X(02) VALUE ', '.        01700000
017100*    05  FILLER                      PIC X(16) VALUE              01710000
017200*                                        'DRIVER W/ROW(S):'.      01720000
017300*    05  DP-MATCHES-FOUND-CNT        PIC ZZZ,ZZZ,ZZ9              01730000
017400*                                              VALUE ZERO.        01740000
017500*    05  FILLER                      PIC X(02) VALUE ', '.        01750000
017600     05  FILLER                      PIC X(14) VALUE              01760000
017700                                         'ROWS SELECTED:'.        01770000
017800     05  DP-ROWS-SELECTED-CNT        PIC ZZZ,ZZZ,ZZ9              01780000
017900                                               VALUE ZERO.        01790000
018000     05  FILLER                      PIC X(02) VALUE ', '.        01800000
018100     05  FILLER                      PIC X(04) VALUE              01810000
018200                                         'OUT:'.                  01820000
018300     05  DP-OUT-CNT                  PIC ZZZ,ZZZ,ZZ9              01830000
018400                                               VALUE ZERO.        01840000
018500     05  FILLER                      PIC X(01) VALUE '.'.         01850000
018600                                                                  01860000
018700 01  ABEND-CODE                      PIC S9(04)                   01870000
018800                                               VALUE ZEROES       01880000
018900                                               COMP SYNC.         01890000
019000                                                                  01900000
019100*---------------------------------------------------------------* 01910000
019200*  DB2 FORMATTED MESSAGE AREA                                     01920000
019300*---------------------------------------------------------------* 01930000
019400     COPY DPWS004.                                                01940000
019500                                                                  01950000
019600                                                                  01960000
019700*---------------------------------------------------------------* 01970000
019800*  AHRD001  - RECORD LAYOUT FOR DRIVER FILE, INPUT.             * 01980007
019900*---------------------------------------------------------------* 01990000
020000     COPY AHRD001.                                                02000007
020100                                                                  02010000
020200                                                                  02020000
020300*---------------------------------------------------------------* 02030000
020400*    DB2 AREA FOR TINVCTM                                       * 02040000
020500*---------------------------------------------------------------* 02050000
020600     EXEC SQL                                                     02060000
020700          INCLUDE TINVCTM                                         02070000
020800     END-EXEC.                                                    02080000
020900                                                                  02090000
021000*---------------------------------------------------------------* 02100000
021100*    DB2 AREA FOR COMMUNICATIONS                                * 02110000
021200*---------------------------------------------------------------* 02120000
021300     EXEC SQL                                                     02130000
021400          INCLUDE SQLCA                                           02140000
021500     END-EXEC.                                                    02150000
021600                                                                  02160000
021700*---------------------------------------------------------------* 02170000
021800*    DEFINE CURSOR FOR TINVCTM :                                * 02180000
021900*    PULL ALL AVAILABLE COLUMNS, SO EXTRACT FILE WILL CONTAIN   * 02190000
022000*    ALL DATA TO POPULATE "ARCHIVE HISTORY" COPY OF THIS TABLE. * 02200000
022100*---------------------------------------------------------------* 02210000
022200     EXEC SQL                                                     02220000
022300          DECLARE TABLE-CURSOR CURSOR FOR                         02230000
022400           SELECT PO_NBR                                          02240011
022500                 ,INVC_ID                                         02250011
022600                 ,TERM_SEQ_NBR                                    02260011
022700                 ,TERM_TYP_CDE                                    02270000
022800                 ,TERM_BASIS_DTE_CDE                              02280000
022900                 ,EFF_DTE                                         02290000
023000                 ,DISC_PCT                                        02300000
023100                 ,DISC_AMT                                        02310000
023200                 ,DISC_DUE_DTE                                    02320000
023300                 ,DISC_DUE_DAY_QTY                                02330000
023400                 ,NET_DUE_DTE                                     02340000
023500                 ,NET_DUE_DAY_QTY                                 02350000
023600                 ,EXTD_DAYS_QTY                                   02360000
023700           FROM   TINVCTM                                         02370000
023800          WHERE   PO_NBR  = :AH001-B-PO-NBR                       02380011
023900            AND   INVC_ID = :AH001-B-INVC-ID                      02390011
024000            FOR  FETCH ONLY                                       02400000
024100           WITH  UR                                               02410000
024200     END-EXEC.                                                    02420000
024300                                                                  02430000
024400                                                                  02440000
024500 PROCEDURE DIVISION.                                              02450000
024600********************                                              02460000
024700                                                                  02470000
024800 0000-PROGRAM-MAINLINE.                                           02480000
024900                                                                  02490000
025000     PERFORM 1000-INITIALIZE.                                     02500000
025100                                                                  02510000
025200     SET PS-IN-DRIVER-NOT-EOF TO TRUE.                            02520000
025300     PERFORM 2000-PROCESS-DRIVER-FILE                             02530000
025400         UNTIL PS-IN-DRIVER-EOF.                                  02540000
025500                                                                  02550000
025600     PERFORM 6000-EOJ-ROUTINE.                                    02560000
025700     STOP RUN.                                                    02570000
025800                                                                  02580000
025900                                                                  02590000
026000******************************************************************02600009
026100*   INITIALIZATIONS                                              *02610009
026200******************************************************************02620009
026300 1000-INITIALIZE.                                                 02630000
026400                                                                  02640000
026500     MOVE PC-CURRENT-PROGRAM-NAME TO DM-PROGRAM.                  02650000
026600     DISPLAY DM-DISPLAY-MESSAGE.                                  02660000
026700                                                                  02670000
026800     MOVE PC-BEGINNING              TO DP-STATUS-DESCRIPTION.     02680000
026900     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02690000
027000                                                                  02700000
027100     PERFORM 9000-OPEN-IN-DRIVER-FILE.                            02710000
027200     PERFORM 9700-OPEN-OUT-EXTRACT-FILE.                          02720000
027300                                                                  02730000
027400                                                                  02740000
027500******************************************************************02750009
027600*   1) GET NEXT RECORD FROM DRIVER FILE, AND                     *02760009
027700*      1A- POPULATE KEY (WHERE CLAUSE) FOR TABLE CURSOR          *02770009
027800*      1B- OPEN TABLE CURSOR                                     *02780009
027900*      1C- LOOP THRU TABLE CURSOR TO EXTRACT ALL                 *02790009
028000*          ROWS FOR THIS INPUT DRIVER RECORD                     *02800009
028100*      2) FOR EACH ROW,                                          *02810009
028200*         2A- INCREMENT COUNTS                                   *02820009
028300*         2B- WRITE EXTRACT RECORD                               *02830009
028400*      1D- CLOSE TABLE CURSOR                                    *02840009
028500******************************************************************02850009
028600 2000-PROCESS-DRIVER-FILE.                                        02860000
028700                                                                  02870000
028800     PERFORM 9050-READ-IN-DRIVER-FILE.                            02880000
028900     IF PS-IN-DRIVER-EOF                                          02890000
029000         CONTINUE                                                 02900000
029100     ELSE                                                         02910000
029200         PERFORM 2100-CHECK-PGM-PROGRESS                          02920000
029300         SET PS-TABLE-LOOP-NOT-DONE   TO TRUE                     02930000
029400         SET PS-CURSOR-HAS-NO-DATA    TO TRUE                     02940000
029500         PERFORM 9100-OPEN-TABLE-CURSOR                           02950000
029600         PERFORM 3000-EXTRACT-ROWS-FROM-TABLE                     02960000
029700             UNTIL PS-TABLE-LOOP-DONE                             02970000
029800         PERFORM 9190-CLOSE-TABLE-CURSOR                          02980000
029900     END-IF.                                                      02990000
030000                                                                  03000000
030100                                                                  03010000
030200******************************************************************03020009
030300*      EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT       *03030009
030400*      RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST     *03040009
030500*      WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.     *03050009
030600******************************************************************03060009
030700 2100-CHECK-PGM-PROGRESS.                                         03070000
030800     DIVIDE    PV-IN-DRIVER-RECS-READ-CNT                         03080000
030900         BY        PC-HOW-OFTEN-TO-DISPLAY                        03090001
031000         GIVING    PV-DISPLAY-NTH-MULTIPLE                        03100001
031100         REMAINDER PV-DISPLAY-NTH-REMAINDER.                      03110001
031200                                                                  03120000
031300     IF PV-DISPLAY-NTH-REMAINDER = ZERO                           03130000
031400         MOVE PC-CONTINUING         TO DP-STATUS-DESCRIPTION      03140000
031500         PERFORM 6200-DISPLAY-PGM-PROGRESS                        03150000
031600     END-IF.                                                      03160000
031700                                                                  03170000
031800                                                                  03180000
031900******************************************************************03190009
032000*   EXTRACT ROWS FROM TABLE, FOR THE CURRENT DRIVER RECORD       *03200009
032100******************************************************************03210009
032200 3000-EXTRACT-ROWS-FROM-TABLE.                                    03220000
032300     INITIALIZE DCLTINVCTM.                                       03230000
032400     PERFORM 9150-FETCH-TABLE-CURSOR.                             03240000
032500     IF PS-TABLE-LOOP-DONE                                        03250000
032600         CONTINUE                                                 03260000
032700     ELSE                                                         03270000
032800         PERFORM 9750-WRITE-EXTRACT-RECORD                        03280000
032900     END-IF.                                                      03290000
033000                                                                  03300000
033100                                                                  03310000
033200******************************************************************03320009
033300*   DISPLAY END OF RUN MESSAGE, CLOSE THE OUTPUT FILES           *03330009
033400******************************************************************03340009
033500 6000-EOJ-ROUTINE.                                                03350000
033600                                                                  03360000
033700     PERFORM 9090-CLOSE-IN-DRIVER-FILE.                           03370000
033800     PERFORM 9790-CLOSE-OUT-EXTRACT-FILE.                         03380000
033900                                                                  03390000
034000     MOVE PC-ENDING                 TO DP-STATUS-DESCRIPTION.     03400000
034100     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           03410000
034200                                                                  03420000
034300                                                                  03430000
034400******************************************************************03440009
034500*   DISPLAY PROGRAM PROGRESS.                                    *03450009
034600******************************************************************03460009
034700 6200-DISPLAY-PGM-PROGRESS.                                       03470000
034800                                                                  03480000
034900     EXEC SQL                                                     03490000
035000          SET :PV-TMST = CURRENT TIMESTAMP                        03500000
035100     END-EXEC.                                                    03510000
035200                                                                  03520000
035300     MOVE PC-CURRENT-PROGRAM-NAME   TO DP-PROGRAM.                03530000
035400     MOVE PV-TIMESTAMP-19           TO DP-TIMESTAMP-19.           03540000
035500     MOVE PV-IN-DRIVER-RECS-READ-CNT                              03550000
035600                                    TO DP-IN-CNT.                 03560000
035700*    MOVE PV-RECS-WITH-MATCHES-CNT  TO DP-MATCHES-FOUND-CNT.      03570000
035800     MOVE PV-TABLE-ROW-SELECT-CNT   TO DP-ROWS-SELECTED-CNT.      03580000
035900     MOVE PV-EXTRACT-WRITTEN-CNT    TO DP-OUT-CNT.                03590000
036000                                                                  03600000
036100     DISPLAY DP-DISPLAY-PROGRESS-MSG.                             03610000
036200                                                                  03620000
036300                                                                  03630000
036400******************************************************************03640009
036500*   FILE AND DB2 TABLE ACCESS PARAGRAPHS.                        *03650009
036600*   90XX- INPUT:  DRIVER FILE                                    *03660009
036700*   91XX- INPUT:  TABLE CURSOR                                   *03670009
036800*   97XX- OUTPUT: TABLE EXTRACT                                  *03680009
036900******************************************************************03690009
037000                                                                  03700000
037100******************************************************************03710009
037200*   OPEN  INPUT DRIVER FILE                                      *03720009
037300******************************************************************03730009
037400 9000-OPEN-IN-DRIVER-FILE.                                        03740000
037500     OPEN  INPUT  IN-DRIVER-FILE.                                 03750000
037600                                                                  03760000
037700                                                                  03770000
037800******************************************************************03780009
037900*   READ  INPUT DRIVER FILE OF ELIGIBLE DATA TO EXTRACT          *03790009
038000******************************************************************03800009
038100 9050-READ-IN-DRIVER-FILE.                                        03810000
038200     READ IN-DRIVER-FILE                                          03820000
038300          INTO AH001-DRIVER-RECORD-LAYOUT                         03830007
038400          AT END                                                  03840000
038500              SET PS-IN-DRIVER-EOF TO TRUE.                       03850000
038600                                                                  03860000
038700     IF PS-IN-DRIVER-EOF                                          03870000
038800         CONTINUE                                                 03880000
038900     ELSE                                                         03890000
039000         ADD +1 TO PV-IN-DRIVER-RECS-READ-CNT                     03900000
039100     END-IF.                                                      03910000
039200                                                                  03920000
039300                                                                  03930000
039400******************************************************************03940009
039500*   CLOSE INPUT DRIVER FILE                                      *03950009
039600******************************************************************03960009
039700 9090-CLOSE-IN-DRIVER-FILE.                                       03970000
039800     CLOSE IN-DRIVER-FILE.                                        03980000
039900                                                                  03990000
040000                                                                  04000000
040100******************************************************************04010009
040200*   OPEN  TABLE CURSOR                                           *04020009
040300******************************************************************04030009
040400 9100-OPEN-TABLE-CURSOR.                                          04040000
040500     EXEC SQL                                                     04050000
040600          OPEN TABLE-CURSOR                                       04060000
040700     END-EXEC.                                                    04070000
040800                                                                  04080000
040900     EVALUATE TRUE                                                04090000
041000         WHEN SQLCODE = ZERO                                      04100000
041100              ADD +1 TO PV-RECS-WITH-MATCHES-CNT                  04110000
041200              SET PS-CURSOR-HAS-DATA TO TRUE                      04120000
041300         WHEN SQLCODE = +100                                      04130000
041400              SET PS-TABLE-LOOP-DONE TO TRUE                      04140000
041500         WHEN SQLWARN0 NOT EQUAL SPACE                            04150000
041600         WHEN SQLCODE  NOT EQUAL ZERO                             04160000
041700              MOVE '9100-OPEN-TABLE-CURSOR'                       04170000
041800                                 TO PV-PARAGRAPH-NAME             04180000
041900              MOVE 'OPEN TABLE CURSOR'                            04190000
042000                                 TO PV-DB2-OPERATION-MSG-1        04200000
042100              MOVE 'TINVCTM'     TO PV-DB2-TABLE-NAME             04210000
042200              PERFORM 9999-DB2-ABEND                              04220000
042300     END-EVALUATE.                                                04230000
042400                                                                  04240000
042500                                                                  04250000
042600******************************************************************04260009
042700*   FETCH TABLE CURSOR                                           *04270009
042800******************************************************************04280009
042900 9150-FETCH-TABLE-CURSOR.                                         04290000
043000     EXEC SQL                                                     04300000
043100         FETCH TABLE-CURSOR                                       04310000
043200          INTO  :INVCTM-PO-NBR                                    04320011
043300               ,:INVCTM-INVC-ID                                   04330011
043400               ,:INVCTM-TERM-SEQ-NBR                              04340011
043500               ,:INVCTM-TERM-TYP-CDE                              04350011
043600               ,:INVCTM-TERM-BASIS-DTE-CDE                        04360011
043700               ,:INVCTM-EFF-DTE                                   04370011
043800               ,:INVCTM-DISC-PCT                                  04380011
043900               ,:INVCTM-DISC-AMT                                  04390011
044000               ,:INVCTM-DISC-DUE-DTE                              04400011
044100               ,:INVCTM-DISC-DUE-DAY-QTY                          04410011
044200               ,:INVCTM-NET-DUE-DTE                               04420011
044300               ,:INVCTM-NET-DUE-DAY-QTY                           04430011
044400               ,:INVCTM-EXTD-DAYS-QTY                             04440011
044500     END-EXEC.                                                    04450011
044600                                                                  04460011
044700     EVALUATE TRUE                                                04470011
044800         WHEN SQLCODE = ZERO                                      04480011
044900              ADD +1                 TO PV-TABLE-ROW-SELECT-CNT   04490011
045000              SET PS-CURSOR-HAS-DATA TO TRUE                      04500011
045100         WHEN SQLCODE = +100                                      04510011
045200              SET PS-TABLE-LOOP-DONE TO TRUE                      04520011
045300         WHEN SQLWARN0 NOT EQUAL SPACE                            04530011
045400         WHEN SQLCODE NOT EQUAL ZERO                              04540011
045500              MOVE '9150-FETCH-TABLE-CURSOR'                      04550011
045600                                 TO PV-PARAGRAPH-NAME             04560011
045700              MOVE 'FETCH TABLE CURSOR'                           04570011
045800                                 TO PV-DB2-OPERATION-MSG-1        04580011
045900              MOVE 'TINVCTM'     TO PV-DB2-TABLE-NAME             04590011
046000              PERFORM 9999-DB2-ABEND                              04600011
046100     END-EVALUATE.                                                04610011
046200                                                                  04620011
046300                                                                  04630011
046400******************************************************************04640011
046500*   CLOSE TABLE CURSOR                                           *04650011
046600******************************************************************04660011
046700 9190-CLOSE-TABLE-CURSOR.                                         04670011
046800     EXEC SQL                                                     04680011
046900          CLOSE TABLE-CURSOR                                      04690011
047000     END-EXEC.                                                    04700011
047100                                                                  04710011
047200     EVALUATE TRUE                                                04720011
047300         WHEN SQLCODE = ZERO                                      04730011
047400              CONTINUE                                            04740011
047500         WHEN SQLWARN0 NOT EQUAL SPACE                            04750011
047600         WHEN SQLCODE NOT EQUAL ZERO                              04760011
047700              MOVE '9190-CLOSE-TABLE-CURSOR'                      04770011
047800                                 TO PV-PARAGRAPH-NAME             04780011
047900              MOVE 'CLOSE TABLE CURSOR'                           04790011
048000                                 TO PV-DB2-OPERATION-MSG-1        04800011
048100              MOVE 'TINVCTM'     TO PV-DB2-TABLE-NAME             04810011
048200              PERFORM 9999-DB2-ABEND                              04820011
048300     END-EVALUATE.                                                04830011
048400                                                                  04840011
048500                                                                  04850011
048600******************************************************************04860011
048700*   OPEN OUTPUT EXTRACT FILE                                     *04870011
048800******************************************************************04880011
048900 9700-OPEN-OUT-EXTRACT-FILE.                                      04890011
049000     OPEN OUTPUT OUT-EXTRACT-FILE.                                04900011
049100                                                                  04910011
049200                                                                  04920011
049300******************************************************************04930011
049400*   WRITE A RECORD TO THE TABLE EXTRACT FILE                     *04940011
049500******************************************************************04950011
049600 9750-WRITE-EXTRACT-RECORD.                                       04960011
049700     WRITE  OUT-EXTRACT-RECORD  FROM  DCLTINVCTM.                 04970011
049800     ADD +1 TO PV-EXTRACT-WRITTEN-CNT.                            04980011
049900                                                                  04990011
050000                                                                  05000011
050100******************************************************************05010011
050200*   CLOSE OUTPUT EXTRACT FILE                                    *05020011
050300******************************************************************05030011
050400 9790-CLOSE-OUT-EXTRACT-FILE.                                     05040011
050500     CLOSE OUT-EXTRACT-FILE.                                      05050011
050600                                                                  05060011
050700                                                                  05070011
050800******************************************************************05080011
050900*   DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT *05090011
051000*   AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN            *05100011
051100*   SQL ERROR OR WARNING CODE OCCURS.                            *05110011
051200******************************************************************05120011
051300 9999-DB2-ABEND.                                                  05130011
051400                                                                  05140011
051500     DISPLAY PC-CURRENT-PROGRAM-NAME                              05150011
051600             ' 9999-DB2-ABEND'.                                   05160011
051700     DISPLAY PC-CURRENT-PROGRAM-NAME                              05170011
051800             ' ** ABEND           **'.                            05180011
051900     DISPLAY PC-CURRENT-PROGRAM-NAME                              05190011
052000             ' ** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.       05200011
052100     DISPLAY PC-CURRENT-PROGRAM-NAME                              05210011
052200             ' ** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME.       05220011
052300     DISPLAY PC-CURRENT-PROGRAM-NAME                              05230011
052400             ' ** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.  05240011
052500                                                                  05250011
052600     DISPLAY PC-CURRENT-PROGRAM-NAME                              05260011
052700             ' ** SQLCODE         ** = ' SQLCODE.                 05270011
052800     MOVE SQLCODE TO PV-SQLCODE.                                  05280011
052900     DISPLAY PC-CURRENT-PROGRAM-NAME                              05290011
053000             ' ** PV-SQLCODE      ** = ' PV-SQLCODE '.'.          05300011
053100                                                                  05310011
053200     DISPLAY PC-CURRENT-PROGRAM-NAME                              05320011
053300             ' ** SQLWARN0        ** = ' SQLWARN0 '.'.            05330011
053400                                                                  05340011
053500                                                                  05350011
053600*----------------------------------------------------------------*05360011
053700* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *05370011
053800* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *05380011
053900* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *05390011
054000* FORMAT.                                                        *05400011
054100*----------------------------------------------------------------*05410011
054200     COPY DPPD004.                                                05420011
054300                                                                  05430011
054400     MOVE PC-ABENDING               TO DP-STATUS-DESCRIPTION.     05440011
054500     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           05450011
054600     PERFORM 9090-CLOSE-IN-DRIVER-FILE.                           05460011
054700     PERFORM 9790-CLOSE-OUT-EXTRACT-FILE.                         05470011
054800                                                                  05480011
054900*----------------------------------------------------------------*05490011
055000* CALL ABEND                                                     *05500011
055100*----------------------------------------------------------------*05510011
055200     MOVE +4013                  TO ABEND-CODE.                   05520011
055300     CALL 'ILBOABN0' USING ABEND-CODE.                            05530011
055400*                                                                 05540011
