000100 IDENTIFICATION DIVISION.                                         00010027
000200 PROGRAM-ID.     APKUT040.                                        00020027
000300 AUTHOR.         M WILKINSON.                                     00030027
000400*DATE-WRITTEN.   NOV 14, 1996.                                    00040027
000500*DATE-COMPILED.                                                   00050027
000600*************************************************************     00060027
000700*    COBOL 2                                                *     00070027
000800*                                                           *     00080027
000900*    BUMP INVOICE EXTRACT AGAINST THE RECEIVING EXTRACT.    *     00090027
001000*    THERE ARE 3 REASONS THIS IS NECESSARY:                 *     00100027
001100*    1. TO REDUCE THE NUMBER OF RECEIVING RECORDS.  ONLY    *     00110027
001200*       THOSE RECEIVING RECORDS WHERE AN INVOICE WITH A     *     00120027
001300*       MATCHING PO/MATCH LOC IS FOUND WILL BE RE-WRITTEN.  *     00130032
001400*    2. TO POPULATE THE VENDOR NAME AND NUMBER FIELDS ON    *     00140027
001500*       THE RECEIVING RECORD WITH THE CORRESPONDING FIELDS  *     00150027
001600*       FROM THE INVOICE RECORD WITH THE MATCHING PO NUMBER *     00160027
001700*       (AND STORE NUMBER WHEN APPROPRIATE).                *     00170027
001800*    3. TO MODIFY THE STORE NUMBER TO ZERO ON THE RECEIVING *     00180027
001900*       RECORDS WHERE THE MATCHING INVOICES ARE BULK.       *     00190027
002000*                                                           *     00200027
002100*************************************************************     00210027
002200*                                                           *     00220027
002300* INPUT                                                     *     00230027
002400* INP01   -  INVOICE FILE - SORTED INTO PO/STORE SEQUENCE   *     00240027
002500* INP02   -  RECEIVING EXTRACT - SORTED INTO PO/STORE SEQ   *     00250027
002600*                                                           *     00260027
002700* OUTPUT                                                    *     00270027
002800* OUT01   -  UPDATED RECEIVING EXTRACT RECORDS              *     00280027
002900* OUT02   -  UNMATCHED RECEIVING EXTRACT RECORDS            *     00290031
003000*                                                           *     00300027
003100*************************************************************     00310027
003200* CHANGE LOG:                                               *     00320027
003300*                                                           *     00330027
003400* 11/14/96  INITIAL VERSION.                                      00340030
003500*                                                                 00350030
003600* 01/16/98  RECOMPILED DUE TO ADDITIONAL FIELD IN COPYBOOK        00360030
003700*           APRD060.                                              00370030
003800*           BY:  MARK BURNSIDE                   WR# 4164         00380030
003900* 02/16/05  RECOMPILED DUE TO CHANGE TO COPYBOOK APRD021.         00390030
004000*           BY:  NANCY EILBES                    WR# 28327        00400030
004100*                                                                 00410030
004200* DATE  03/11/2007                                                00420037
004300*     CHANGE MADE: MATCH BY DC PROJECT                            00430030
004400*     CHANGED ALL REFERENCES OF AP060-STR-NBR TO AP060-MTCH-LOC-  00440030
004500*     NBR.  BY USING THE MATCH LOC NUMBER TO UPDATE THE RECEIVING 00450030
004600*     RECORD TO KEEP THE FILES IN SYNCH, THE BUMP FOR INVOICE TO  00460030
004700*     RECEIVER FILE WILL BE MAINTAINED.  ADDED A SECOND OUTPUT    00470030
004800*     FILE FOR THE UNMATCH RECEIVER RECORDS (APRD021).  NEW PARA  00480030
004900*     W200- IS PERFORMED BEFORE THE READS OF THE RECEIVER FILE    00490030
005000*     IN UNMATCHED SITUATIONS.                                    00500030
005100*     MADE BY: MIKE BESKE              WR/IR #: WR21578           00510030
004100*                                                                 00511038
004200* DATE  05/11/2021                                                00512039
005000*     RECOMPILE FOR UPDATED APWS008 COPYBOOK                      00513038
005100*     MADE BY: JEAN KURK               WR/IR #: CHG0256545        00514038
005200*                                                                 00520030
005300******************************************************************00530030
005400                                                                  00540030
005500 ENVIRONMENT DIVISION.                                            00550030
005600                                                                  00560030
005700 INPUT-OUTPUT SECTION.                                            00570030
005800                                                                  00580030
005900 FILE-CONTROL.                                                    00590030
006000     SELECT INVOICES-FILE      ASSIGN    TO UT-S-INP01.           00600030
006100     SELECT RECEIV-FILE        ASSIGN    TO UT-S-INP02.           00610030
006200     SELECT RECEIV-OUT-FILE    ASSIGN    TO UT-S-OUT01.           00620030
006300     SELECT RECEIV-OUT-FILE2   ASSIGN    TO UT-S-OUT02.           00630030
006400 DATA DIVISION.                                                   00640030
006500                                                                  00650030
006600 FILE SECTION.                                                    00660030
006700 FD  INVOICES-FILE                                                00670030
006800         LABEL RECORDS  ARE STANDARD                              00680030
006900         RECORDING MODE IS  F                                     00690030
007000         DATA RECORD    IS  INVOICE-RECORD.                       00700030
007100                                                                  00710030
007200 01  INVOICE-RECORD                PIC X(175).                    00720030
007300                                                                  00730030
007400 FD  RECEIV-FILE                                                  00740030
007500         LABEL RECORDS  ARE STANDARD                              00750030
007600         RECORDING MODE IS  F                                     00760030
007700         DATA RECORD    IS  RECEIV-IN.                            00770030
007800                                                                  00780030
007900 01  RECEIV-IN                     PIC X(090).                    00790030
008000                                                                  00800030
008100 FD  RECEIV-OUT-FILE                                              00810030
008200         LABEL RECORDS  ARE STANDARD                              00820030
008300         RECORDING MODE IS  F                                     00830030
008400         DATA RECORD    IS  RECEIV-OUT-REC.                       00840030
008500                                                                  00850030
008600 01  RECEIV-OUT-REC                PIC X(090).                    00860030
008700                                                                  00870030
008800 FD  RECEIV-OUT-FILE2                                             00880030
008900         LABEL RECORDS  ARE STANDARD                              00890030
009000         RECORDING MODE IS  F                                     00900030
009100         DATA RECORD    IS  RECEIV-OUT-REC2.                      00910030
009200                                                                  00920030
009300 01  RECEIV-OUT-REC2               PIC X(090).                    00930030
009400                                                                  00940030
009500/                                                                 00950030
009600 WORKING-STORAGE SECTION.                                         00960030
009700                                                                  00970030
009800 01  FILLER                        PIC X(25) VALUE                00980030
009900                             'WS FOR APKUT040 BEGINS==>'.         00990030
010000 01  ABEND-CODE                    PIC S9(4) COMP SYNC            01000030
010100                                             VALUE ZEROS.         01010030
010200 01  PV-ABEND-FIELDS.                                             01020030
010300     05  PV-ABEND-PROGRAM             PIC X(8)  VALUE 'APKUT040'. 01030030
010400     05  PV-ABEND-SQLCODE             PIC X(4)  VALUE SPACES.     01040030
010500     05  PV-ABEND-PARAGRAPH           PIC X(50) VALUE SPACES.     01050030
010600     05  PV-ABEND-OPERATION           PIC X(50) VALUE SPACES.     01060030
010700     05  PV-ABEND-STRUCTURE-1         PIC X(8)  VALUE SPACES.     01070030
010800     05  PV-ABEND-STRUCTURE-2         PIC X(8)  VALUE SPACES.     01080030
010900     05  PV-ABEND-STRUCTURE-3         PIC X(8)  VALUE SPACES.     01090030
011000     05  PV-ABEND-STRUCTURE-4         PIC X(8)  VALUE SPACES.     01100030
011100     05  PV-ABEND-STATUS              PIC XX    VALUE SPACES.     01110030
011200                                                                  01120030
011300 01  PV-WORK-AREA.                                                01130030
011400     05  PV-PROGRAM-NAME         PIC X(08)     VALUE 'APKUT040'.  01140030
011500     05  PV-INVOICE-IN-REC-CNT   PIC 9(09)     VALUE 0.           01150030
011600     05  PV-RECEIV-IN-REC-CNT    PIC 9(09)     VALUE 0.           01160030
011700     05  PV-RECEIV-OUT-REC-CNT   PIC 9(09)     VALUE 0.           01170030
011800     05  PV-RECEIV-OUT-REC-CNT2  PIC 9(09)     VALUE 0.           01180030
011900*                                                                 01190030
012000 01  PV-SWITCHES.                                                 01200030
012100     05  END-OF-INVOICE-SW       PIC X(01) VALUE 'N'.             01210030
012200         88  END-OF-INVOICES               VALUE 'Y'.             01220030
012300         88  NOT-END-OF-INVOICES           VALUE 'N'.             01230030
012400     05  END-OF-RECEIV-SW        PIC X(01) VALUE 'N'.             01240030
012500         88  END-OF-RECEIV                 VALUE 'Y'.             01250030
012600         88  NOT-END-OF-RECEIV             VALUE 'N'.             01260030
012700                                                                  01270030
012800 01  FILLER                      PIC X(35)  VALUE                 01280030
012900     'BEGINNING OF AP060 INPUT FILE    **'.                       01290030
013000     COPY APRD060.                                                01300030
013100                                                                  01310030
013200 01  FILLER                      PIC X(35)  VALUE                 01320030
013300     'BEGINNING OF AP021 INPUT FILE    **'.                       01330030
013400     COPY APRD021.                                                01340030
013500                                                                  01350030
013600 01  FILLER                      PIC X(35)  VALUE                 01360030
013700     'END OF AP WORK RECORD AREA       **'.                       01370030
013800                                                                  01380030
013900 01  FILLER                        PIC X(25) VALUE                01390030
014000          '<====PV FOR APKUT040 ENDS'.                            01400030
014100                                                                  01410030
014200*LINKAGE SECTION.                                                 01420030
014300                                                                  01430030
014400                                                                  01440030
014500 PROCEDURE DIVISION.                                              01450030
014600                                                                  01460030
014700 A100-MAINLINE.                                                   01470030
014800                                                                  01480030
014900     PERFORM H100-HOUSEKEEPING.                                   01490030
015000                                                                  01500030
015100     PERFORM B100-PROCESSING                                      01510030
015200        UNTIL END-OF-INVOICES.                                    01520034
015300                                                                  01530030
015400     IF NOT-END-OF-RECEIV                                         01540035
015500        PERFORM B400-PROCESS-RECEIVING                            01550036
015600           UNTIL END-OF-RECEIV                                    01560035
015700     END-IF.                                                      01570035
015800                                                                  01580035
015900     PERFORM Z900-END-OF-JOB.                                     01590030
016000                                                                  01600030
016100     GOBACK.                                                      01610030
016200        EJECT                                                     01620030
016300                                                                  01630030
016400 B100-PROCESSING.                                                 01640030
016500     MOVE 'B100-PROCESSING  '    TO PV-ABEND-PARAGRAPH.           01650030
016600                                                                  01660030
016700     IF NOT END-OF-RECEIV                                         01670030
016800        IF AP060-PO-NBR =  AP021-PO-NBR                           01680030
016900           IF AP060-MTCH-LOC-NBR = 0                              01690030
017000              PERFORM B200-PROCESS-BULK                           01700030
017100                 UNTIL END-OF-RECEIV   OR                         01710030
017200                      (AP060-PO-NBR NOT = AP021-PO-NBR)           01720030
017300              PERFORM R100-READ-INVOICE                           01730030
017400           ELSE                                                   01740030
017500              IF AP060-MTCH-LOC-NBR = AP021-STR-NBR               01750030
017600                 PERFORM B300-PROCESS-BY-STORE                    01760030
017700                    UNTIL END-OF-RECEIV OR                        01770030
017800                         (AP060-PO-NBR NOT = AP021-PO-NBR)  OR    01780030
017900                         (AP060-PO-NBR     = AP021-PO-NBR AND     01790030
018000                          AP060-MTCH-LOC-NBR NOT = AP021-STR-NBR) 01800030
018100                 PERFORM R100-READ-INVOICE                        01810030
018200              ELSE                                                01820030
018300                 IF AP060-MTCH-LOC-NBR > AP021-STR-NBR            01830030
018400                    PERFORM W200-WRITE-UNMATCHED-RCV              01840030
018500                    PERFORM R200-READ-RECEIV                      01850030
018600                 ELSE                                             01860030
018700                    PERFORM R100-READ-INVOICE                     01870030
018800                 END-IF                                           01880030
018900              END-IF                                              01890030
019000           END-IF                                                 01900030
019100        ELSE                                                      01910030
019200           IF AP060-PO-NBR > AP021-PO-NBR                         01920030
019300              PERFORM W200-WRITE-UNMATCHED-RCV                    01930030
019400              PERFORM R200-READ-RECEIV                            01940030
019500           ELSE                                                   01950030
019600              PERFORM R100-READ-INVOICE                           01960030
019700           END-IF                                                 01970030
019800        END-IF                                                    01980030
019900     ELSE                                                         01990030
020000        PERFORM R100-READ-INVOICE                                 02000030
020100     END-IF.                                                      02010030
020200                                                                  02020030
020300 B200-PROCESS-BULK.                                               02030030
020400                                                                  02040030
020500**  THE BULK PROCESS WILL REWRITE THE RECEIVER RECORD AND         02050030
020600**  CHANGE THE STORE NUMBER TO ZERO                               02060030
020700                                                                  02070030
020800     MOVE AP060-VENDOR-NAME   TO AP021-VENDOR-NAME.               02080030
020900     MOVE AP060-VENDOR-NUMBER TO AP021-VENDOR-NBR.                02090030
021000     MOVE ZEROS               TO AP021-STR-NBR.                   02100030
021100     PERFORM W100-WRITE-UPDATED.                                  02110030
021200                                                                  02120030
021300     PERFORM R200-READ-RECEIV.                                    02130030
021400                                                                  02140030
021500 B300-PROCESS-BY-STORE.                                           02150030
021600                                                                  02160030
021700**  THE BY STORE PROCESS WILL REWRITE THE RECEIVER RECORD         02170030
021800**  THAT MATCH THE PO STORE                                       02180030
021900                                                                  02190030
022000     MOVE AP060-VENDOR-NAME   TO AP021-VENDOR-NAME.               02200030
022100     MOVE AP060-VENDOR-NUMBER TO AP021-VENDOR-NBR.                02210030
022200                                                                  02220030
022300     PERFORM W100-WRITE-UPDATED.                                  02230030
022400     PERFORM R200-READ-RECEIV.                                    02240030
022500                                                                  02250030
022600 B400-PROCESS-RECEIVING.                                          02260036
022700                                                                  02270035
022800**  THERE ARE NO MORE INVOICES TO BUMP AGAINST THE RECEIVER FILE  02280035
022900**  SO THE REMAINING RECEIVERS ARE WRITTEN TO THE UNMATCHED FILE. 02290035
023000                                                                  02300035
023100     PERFORM W200-WRITE-UNMATCHED-RCV.                            02310035
023200     PERFORM R200-READ-RECEIV.                                    02320035
023300                                                                  02330035
023400 H100-HOUSEKEEPING.                                               02340035
023500*                                                                 02350035
023600***************************************************************** 02360035
023700*    OPEN FILES                                                   02370035
023800***************************************************************** 02380035
023900*                                                                 02390035
024000     MOVE 'H100-HOUSEKEEPING' TO PV-ABEND-PARAGRAPH.              02400035
024100                                                                  02410035
024200     SET NOT-END-OF-INVOICES     TO TRUE.                         02420035
024300     SET NOT-END-OF-RECEIV       TO TRUE.                         02430035
024400                                                                  02440035
024500     OPEN INPUT  INVOICES-FILE                                    02450035
024600                 RECEIV-FILE                                      02460035
024700          OUTPUT RECEIV-OUT-FILE                                  02470035
024800                 RECEIV-OUT-FILE2.                                02480035
024900                                                                  02490035
025000     PERFORM R100-READ-INVOICE.                                   02500035
025100     PERFORM R200-READ-RECEIV.                                    02510035
025200                                                                  02520035
025300 R100-READ-INVOICE.                                               02530035
025400*                                                                 02540035
025500***************************************************************** 02550035
025600*     READ THE SELECTED INVOICE FILE                              02560035
025700***************************************************************** 02570035
025800*                                                                 02580035
025900     MOVE 'R100-READ-INVOICE' TO PV-ABEND-PARAGRAPH.              02590035
026000                                                                  02600035
026100     IF NOT END-OF-INVOICES                                       02610035
026200        READ INVOICES-FILE INTO AP060-INVOICE-EXTRACT             02620035
026300          AT END  SET END-OF-INVOICES TO TRUE.                    02630035
026400                                                                  02640035
026500     IF NOT END-OF-INVOICES                                       02650035
026600        ADD 1 TO PV-INVOICE-IN-REC-CNT.                           02660035
026700                                                                  02670035
026800 R200-READ-RECEIV.                                                02680035
026900*                                                                 02690035
027000***************************************************************** 02700035
027100*     READ THE DUMPED RECEIV BATCH MATCH FILE                     02710035
027200***************************************************************** 02720035
027300*                                                                 02730035
027400     MOVE 'R200-READ-RECEIV  ' TO PV-ABEND-PARAGRAPH.             02740035
027500                                                                  02750035
027600     IF NOT END-OF-RECEIV                                         02760035
027700        READ RECEIV-FILE INTO AP021-RECORD                        02770035
027800          AT END  SET END-OF-RECEIV TO TRUE.                      02780035
027900                                                                  02790035
028000     IF NOT END-OF-RECEIV                                         02800035
028100        ADD 1 TO PV-RECEIV-IN-REC-CNT.                            02810035
028200                                                                  02820035
028300 W100-WRITE-UPDATED.                                              02830035
028400*                                                                 02840035
028500***************************************************************** 02850035
028600*     WRITE THE DUMPED BATCH MATCH FILE    - BULK                 02860035
028700***************************************************************** 02870035
028800*                                                                 02880035
028900     MOVE 'W100-WRITE-UPDATED' TO PV-ABEND-PARAGRAPH.             02890035
029000                                                                  02900035
029100     WRITE RECEIV-OUT-REC  FROM AP021-RECORD.                     02910035
029200                                                                  02920035
029300     ADD 1 TO PV-RECEIV-OUT-REC-CNT.                              02930035
029400                                                                  02940035
029500 W200-WRITE-UNMATCHED-RCV.                                        02950035
029600*                                                                 02960035
029700***************************************************************** 02970035
029800*     WRITE THE UNMATCHED RECEIVER FILE                           02980035
029900***************************************************************** 02990035
030000*                                                                 03000035
030100     MOVE 'W200-WRITE-UNMATCHED-RCV' TO PV-ABEND-PARAGRAPH.       03010035
030200                                                                  03020035
030300     WRITE RECEIV-OUT-REC2 FROM AP021-RECORD.                     03030035
030400                                                                  03040035
030500     ADD 1 TO PV-RECEIV-OUT-REC-CNT2.                             03050035
030600                                                                  03060035
030700 Z900-END-OF-JOB.                                                 03070035
030800*                                                                 03080035
030900***************************************************************** 03090035
031000*     CLOSE OUTPUT FILES,      REPORT ON NECESSARY TOTALS         03100035
031100***************************************************************** 03110035
031200*                                                                 03120035
031300     MOVE 'Z900-END-OF-JOB  ' TO PV-ABEND-PARAGRAPH.              03130035
031400                                                                  03140035
031500     DISPLAY '************************************************'.  03150035
031600     DISPLAY 'TOTAL INVOICE  RECORDS READ    = '                  03160035
031700              PV-INVOICE-IN-REC-CNT.                              03170035
031800     DISPLAY 'TOTAL AP021 RECDIS RECS READ   = '                  03180035
031900              PV-RECEIV-IN-REC-CNT.                               03190035
032000     DISPLAY '************************************************'.  03200035
032100     DISPLAY 'TOTAL AP021 RECDIS RECORDS OUT = '                  03210035
032200              PV-RECEIV-OUT-REC-CNT.                              03220035
032300     DISPLAY 'TOTAL AP021 UNMATCHED RECS OUT = '                  03230035
032400              PV-RECEIV-OUT-REC-CNT2.                             03240035
032500     DISPLAY '************************************************'.  03250035
032600                                                                  03260035
032700     DISPLAY ' PROGRAM APKUT040 ENDS NORMALLY '.                  03270035
032800                                                                  03280035
032900     CLOSE       INVOICES-FILE                                    03290035
033000                 RECEIV-FILE                                      03300035
033100                 RECEIV-OUT-FILE                                  03310035
033200                 RECEIV-OUT-FILE2.                                03320035
033300                                                                  03330035
033400 Z999-ABEND.                                                      03340035
033500*                                                                 03350035
033600***************************************************************** 03360035
033700*     PROCESS ABENDS                                              03370035
033800***************************************************************** 03380035
033900*                                                                 03390035
034000                                                                  03400035
034100     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 03410035
034200     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               03420035
034300     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               03430035
034400                                                                  03440035
034500     CALL 'ILBOABN0' USING ABEND-CODE.                            03450035
