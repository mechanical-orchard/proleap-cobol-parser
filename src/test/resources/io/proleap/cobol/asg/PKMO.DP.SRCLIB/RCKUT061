000100 IDENTIFICATION DIVISION.                                         00010005
000200******************************************************************00020005
000300*  WORK ORDER INSTRUCTION MODULE                                  00030005
000400******************************************************************00040005
000500                                                                  00050005
000600 PROGRAM-ID.        RCKUT061.                                     00060005
000700 AUTHOR.            DENNIS STEFFEN - OMNI RESOURCES.              00070005
000800 INSTALLATION.      KOHLS.                                        00080005
000900 DATE-WRITTEN       MAY 1998.                                     00090005
001000 DATE-COMPILED.                                                   00100005
001100                                                                  00110005
001200 ENVIRONMENT DIVISION.                                            00120005
001300 CONFIGURATION SECTION.                                           00130005
001400 SOURCE-COMPUTER.   IBM-3090.                                     00140005
001500 OBJECT-COMPUTER.   IBM-3090.                                     00150005
001700                                                                  00170005
001800 DATA DIVISION.                                                   00180005
001900 WORKING-STORAGE SECTION.                                         00190005
002000                                                                  00200005
002100 01  ABEND-CODE                       PIC S9(04)  COMP SYNC       00210005
002200                                                    VALUE ZERO.   00220005
002300 01  PS-PROGRAM-SWITCHES.                                         00230005
002400     05  PS-EOF-TWKORIN-SW            PIC X(01) VALUE 'N'.        00240011
002500         88  PS-EOF-TWKORIN                         VALUE 'Y'.    00250005
002600         88  PS-NOT-EOF-TWKORIN                     VALUE 'N'.    00260005
002610     05  PS-EOF-TWKORIN-VRFY-SW       PIC X(01) VALUE 'N'.        00261011
002620         88  PS-EOF-TWKORIN-VRFY                    VALUE 'Y'.    00262011
002630         88  PS-NOT-EOF-TWKORIN-VRFY                VALUE 'N'.    00263011
002640     05  PS-EOF-TWKORIN-VRFY0-SW      PIC X(01) VALUE 'N'.        00264011
002650         88  PS-EOF-TWKORIN-VRFY0                   VALUE 'Y'.    00265011
002660         88  PS-NOT-EOF-TWKORIN-VRFY0               VALUE 'N'.    00266011
002700     05  PS-ERROR-SW                  PIC X(01) VALUE 'N'.        00270005
002800         88  PS-NO-ERROR                            VALUE 'N'.    00280005
002900         88  PS-ERROR                               VALUE 'Y'.    00290005
003000     05  PS-CSR-OPEN-SW               PIC X(01) VALUE 'N'.        00300005
003100         88  PS-WKORIN-CSR-CLOSED                   VALUE 'N'.    00310005
003200         88  PS-WKORIN-CSR-OPEN                     VALUE 'Y'.    00320005
003210     05  PS-TWKORIN-CURSOR-SW         PIC X(01)  VALUE 'N'.       00321011
003220         88  PS-EOF-TWKORIN-CSR                  VALUE 'Y'.       00322011
003230     05  PS-TWKORIN-ZERO-SW           PIC X(01)  VALUE 'N'.       00323011
003240         88  PS-EOF-TWKORIN-ZERO                 VALUE 'Y'.       00324011
003300                                                                  00330005
003400 01  PC-PROGRAM-CONSTANTS.                                        00340005
003500     05  PC-DEFAULT-TMST              PIC  X(26)  VALUE           00350005
003600         '9999-09-09-09.09.09.999999'.                            00360005
003610     05  PC-DEFAULT-TMST2             PIC  X(26)  VALUE           00361014
003620         '9999-09-09-09.09.09.000000'.                            00362014
003700                                                                  00370005
003800 01  PV-PROGRAM-VARIABLES.                                        00380011
003900     05  PV-TWKORIN-COUNTER           PIC S9(7) COMP-3            00390005
004000                                                VALUE ZERO.       00400005
004010     05  PV-PRC-FCLTY-AREA-ID         PIC  X(06)  VALUE SPACES.   00401011
004100/                                                                 00410005
004200     COPY RCWS033.                                                00420018
004300/                                                                 00430005
004400     EXEC SQL                                                     00440005
004500         INCLUDE TWKORIN                                          00450005
004600     END-EXEC.                                                    00460005
004700/                                                                 00470005
004800     EXEC SQL                                                     00480005
004900         INCLUDE TFLAREA                                          00490005
005000     END-EXEC.                                                    00500005
005100/                                                                 00510005
005110******************************************************************00511011
005120*  TWKORIN CURSOR - FOR LINE NUMBER OTHER THAN ZERO              *00512011
005130******************************************************************00513011
005200     EXEC SQL                                                     00520005
005210     DECLARE TWKORIN-CSR CURSOR WITH HOLD FOR                     00521011
005211        SELECT                                                    00521111
005212               STRT_TMST                                          00521211
005213              ,STOP_TMST                                          00521311
005214              ,PRC_FCLTY_AREA_ID                                  00521411
005215              ,SCREEN_SEQ_NBR                                     00521511
005216        FROM   TWKORIN                                            00521611
005217        WHERE ORD_NBR            = :RC033-PO-NBR                  00521711
005218          AND RCVR_SEQ_NBR       = :RC033-REC-SEQ-NBR             00521811
005219          AND ORD_LNE_NBR        = :RC033-PO-LNE-NBR              00521911
005220          AND WORK_ORD_SEQ_NBR   = 1                              00522011
005222          AND VER_STATUS_CDE     = 'A'                            00522211
005223        ORDER BY SCREEN_SEQ_NBR                                   00522311
005224         WITH UR                                                  00522419
005225                                                                  00522511
005226     END-EXEC.                                                    00522611
005227/                                                                 00522711
005228******************************************************************00522811
005229*  TWKORIN CURSOR - FOR LINE NUMBER = ZERO                       *00522911
005230******************************************************************00523011
005231     EXEC SQL                                                     00523111
005232     DECLARE WKORIN0-CSR CURSOR WITH HOLD FOR                     00523211
005233        SELECT STRT_TMST                                          00523311
005234              ,STOP_TMST                                          00523411
005235              ,PRC_FCLTY_AREA_ID                                  00523511
005236              ,SCREEN_SEQ_NBR                                     00523611
005237        FROM   TWKORIN                                            00523711
005238        WHERE ORD_NBR            = :RC033-PO-NBR                  00523811
005239          AND RCVR_SEQ_NBR       = :RC033-REC-SEQ-NBR             00523911
005240          AND ORD_LNE_NBR        = 0                              00524011
005241          AND WORK_ORD_SEQ_NBR   = 1                              00524111
005242          AND VER_STATUS_CDE     = 'A'                            00524211
005243        ORDER BY SCREEN_SEQ_NBR                                   00524311
005244         WITH UR                                                  00524419
005245                                                                  00524511
005246     END-EXEC.                                                    00524611
005247/                                                                 00524711
005250     EXEC SQL                                                     00525011
005300     DECLARE WKORIN-CSR CURSOR FOR                                00530005
005400         SELECT WO_INSTR_SEQ_NBR                                  00540005
005500             ,  PRC_FCLTY_AREA_ID                                 00550005
005600             ,  OPER_UNT_ID                                       00560005
005700             ,  FCLTY_ID                                          00570005
005800         FROM                                                     00580005
005900             TWKORIN A                                            00590005
006000         WHERE                                                    00600005
006100             ORD_NBR                  = :RC033-PO-NBR             00610005
006200         AND RCVR_SEQ_NBR             = :RC033-REC-SEQ-NBR        00620005
006300         AND ORD_LNE_NBR              = :RC033-PO-LNE-NBR         00630005
006310         AND VER_STATUS_CDE           = 'A'                       00631017
006400         ORDER BY WO_INSTR_SEQ_NBR DESC                           00640005
006410          WITH UR                                                 00641019
006500                                                                  00650005
006600     END-EXEC.                                                    00660005
006700/                                                                 00670005
006800     EXEC SQL                                                     00680005
006900         INCLUDE SQLCA                                            00690005
007000     END-EXEC.                                                    00700005
007100                                                                  00710005
007200     COPY SQLCA2.                                                 00720005
007300 LINKAGE SECTION.                                                 00730005
007400 01  CA-INPUT-REC                     PIC X(302).                 00740010
007500/                                                                 00750005
007600 PROCEDURE DIVISION USING CA-INPUT-REC.                           00760005
007700                                                                  00770005
007800 0000-PROGRAM-MAINLINE.                                           00780005
007900                                                                  00790005
008000     PERFORM 1000-INITIALIZE.                                     00800005
008100                                                                  00810005
008200     IF RC033-CHECK-EXIST                                         00820005
008300         CONTINUE                                                 00830005
008400     ELSE                                                         00840005
008500         IF RC033-GET-WO-INST                                     00850005
008510             IF RC033-VERIFICATION                                00851011
008520                PERFORM 4000-FIND-PROC-AREA                       00852011
008530             ELSE                                                 00853011
008600                PERFORM 2000-PROCESS-TWKORIN                      00860011
008700                    UNTIL PS-EOF-TWKORIN OR PS-ERROR              00870011
008710                IF  RC033-RETURN-P2L-AREA  >  SPACES              00871011
008720                    CONTINUE                                      00872011
008730                ELSE                                              00873011
008740                    MOVE  RC033-RETURN-LAST-AREA                  00874011
008750                      TO  RC033-RETURN-P2L-AREA                   00875011
008760                END-IF                                            00876011
008770             END-IF                                               00877011
008800         ELSE                                                     00880005
008900             PERFORM 3000-VALIDATE-PRC-AREA                       00890005
009000         END-IF                                                   00900005
009100     END-IF.                                                      00910005
009200                                                                  00920005
009300     PERFORM 9000-EOJ-ROUTINE.                                    00930005
009400                                                                  00940005
009500 0000-GOBACK.                                                     00950005
009600     GOBACK.                                                      00960005
009700/                                                                 00970005
009800 1000-INITIALIZE.                                                 00980005
009900                                                                  00990005
010000     MOVE CA-INPUT-REC                TO RC033-FIELDS.            01000005
010100                                                                  01010005
010200* INITIALIZE SWITCHES TO MAKE PROGRAM RE-ENTRANT                  01020005
010300     SET RC033-CALL-SUCCESSFUL                                    01030005
010400         PS-WKORIN-CSR-CLOSED                                     01040005
010500         PS-NOT-EOF-TWKORIN           TO TRUE.                    01050005
010600                                                                  01060005
010700     MOVE SPACES                      TO RC033-RETURN-LAST-AREA   01070005
010800                                                                  01080005
010900     EVALUATE TRUE                                                01090005
011000         WHEN RC033-CHECK-EXIST                                   01100005
011100             PERFORM 7100-CHECK-WO-EXISTS                         01110005
011200         WHEN RC033-GET-WO-INST                                   01120005
011300             EVALUATE TRUE                                        01130005
011400                 WHEN RC033-USE-ZERO-LVL                          01140005
011500                     MOVE ZERO        TO RC033-PO-LNE-NBR         01150005
011600                 WHEN RC033-USE-LINE-LVL                          01160005
011700                     PERFORM 1100-VALIDATE-INSTRUCTIONS           01170005
011800                     IF PV-TWKORIN-COUNTER = ZERO                 01180005
011900                         MOVE ZERO    TO RC033-PO-LNE-NBR         01190005
012000                     END-IF                                       01200005
012100                 WHEN OTHER                                       01210005
012200                     SET RC033-WO-INST-LVL-INVALID                01220005
012300                         PS-ERROR     TO TRUE                     01230005
012400             END-EVALUATE                                         01240005
012500                                                                  01250005
012600         WHEN RC033-VALIDATE-PRC-AREA                             01260005
012700             IF RC033-PRC-AREA-TO-CHECK > SPACES                  01270005
012800                 AND RC033-OPER-UNT-ID > ZERO                     01280005
012900                 AND RC033-FCLTY-ID > ZERO                        01290005
013000                 CONTINUE                                         01300005
013100             ELSE                                                 01310005
013200                 SET RC033-PRC-AREA-INVALID                       01320005
013300                 PS-ERROR             TO TRUE                     01330005
013400             END-IF                                               01340005
013500         WHEN OTHER                                               01350005
013600             SET RC033-FUNC-CODE-INVALID                          01360005
013700                 PS-ERROR             TO TRUE                     01370005
013800     END-EVALUATE.                                                01380005
013900                                                                  01390005
014000     IF RC033-GET-WO-INST AND RC033-BYPASS-CHECK-EXIST            01400005
014100                          AND PS-NO-ERROR                         01410005
014110         IF RC033-VERIFICATION                                    01411011
014120            CONTINUE                                              01412011
014130         ELSE                                                     01413011
014200            PERFORM 7000-OPEN-WKORIN-CSR                          01420011
014300            IF SQLCODE = ZERO                                     01430011
014400                PERFORM 7010-FETCH-WKORIN-CSR                     01440011
014500            END-IF                                                01450011
014510         END-IF                                                   01451011
014600     END-IF.                                                      01460005
014700                                                                  01470005
014800 1100-VALIDATE-INSTRUCTIONS.                                      01480005
014900                                                                  01490005
015000     MOVE ZERO                        TO PV-TWKORIN-COUNTER       01500005
015100     EXEC SQL                                                     01510005
015200         SELECT COUNT (*)                                         01520005
015300     INTO                                                         01530005
015400          :PV-TWKORIN-COUNTER                                     01540005
015500     FROM TWKORIN                                                 01550005
015600     WHERE                                                        01560005
015700             ORD_NBR                  = :RC033-PO-NBR             01570005
015800         AND RCVR_SEQ_NBR             = :RC033-REC-SEQ-NBR        01580005
015900         AND ORD_LNE_NBR              = :RC033-PO-LNE-NBR         01590005
016000         AND WORK_ORD_SEQ_NBR         = 1                         01600005
016100         AND OPER_UNT_ID              = :RC033-OPER-UNT-ID        01610005
016200         AND FCLTY_ID                 = :RC033-FCLTY-ID           01620005
016300         AND VER_STATUS_CDE           = 'A'                       01630005
016400         AND (STRT_TMST                = :PC-DEFAULT-TMST         01640015
016410          OR  STRT_TMST                = :PC-DEFAULT-TMST2)       01641015
016420        WITH UR                                                   01642019
016500     END-EXEC.                                                    01650005
016600                                                                  01660005
016700     EVALUATE TRUE                                                01670005
016800         WHEN SQLCODE = ZERO                                      01680005
016900         WHEN SQLCODE = +100                                      01690005
017000         WHEN SQLCODE = -305                                      01700005
017010*                                                                 01701021
017100             CONTINUE                                             01710020
017200         WHEN SQLCODE < ZERO                                      01720020
017300         WHEN SQLCODE > ZERO                                      01730020
017400         WHEN SQLWARN0 NOT = SPACES                               01740020
017500             MOVE '1100-VALIDATE-INSTRUCTIONS' TO RC033-PARA      01750020
017600             PERFORM 9200-SQL-ERROR                               01760020
017700     END-EVALUATE.                                                01770020
017800/                                                                 01780020
017900 2000-PROCESS-TWKORIN.                                            01790020
018000                                                                  01800020
018100     MOVE WKORIN-PRC-FCLTY-AREA-ID    TO RC033-PRC-AREA-TO-CHECK  01810020
018200     PERFORM 3000-VALIDATE-PRC-AREA                               01820020
018300                                                                  01830020
018400     IF  RC033-RETURN-LAST-AREA  =  SPACES                        01840020
018410         MOVE WKORIN-PRC-FCLTY-AREA-ID                            01841020
018420                                      TO RC033-RETURN-LAST-AREA   01842020
019300     END-IF                                                       01930020
019400                                                                  01940020
019500     EVALUATE TRUE                                                01950020
019600         WHEN RC033-RETURN-P2L-AREA > SPACES                      01960020
019700          AND RC033-RETURN-FCSE-AREA > SPACES                     01970020
019800              SET PS-EOF-TWKORIN        TO TRUE                   01980020
019900         WHEN FLAREA-PRC-AREA-GP-CDE = 'PL'                       01990020
020000          AND RC033-RETURN-P2L-AREA = SPACES                      02000020
020100              MOVE WKORIN-PRC-FCLTY-AREA-ID                       02010020
020200                                      TO RC033-RETURN-P2L-AREA    02020020
020700     END-EVALUATE.                                                02070020
020800                                                                  02080020
020900     PERFORM 7010-FETCH-WKORIN-CSR.                               02090020
021000/                                                                 02100020
021100 3000-VALIDATE-PRC-AREA.                                          02110020
021200                                                                  02120020
021300     MOVE SPACES                      TO FLAREA-PRC-AREA-GP-CDE   02130020
021400     EXEC SQL                                                     02140020
021500         SELECT                                                   02150020
021600             PRC_AREA_GP_CDE                                      02160020
021700         INTO                                                     02170020
021800            :FLAREA-PRC-AREA-GP-CDE                               02180020
021900         FROM TFLAREA                                             02190020
022000     WHERE                                                        02200020
022100             OPER_UNT_ID              = :RC033-OPER-UNT-ID        02210020
022200         AND FCLTY_ID                 = :RC033-FCLTY-ID           02220020
022300         AND FCLTY_AREA_ID            = :RC033-PRC-AREA-TO-CHECK  02230020
022310        WITH UR                                                   02231020
022400     END-EXEC.                                                    02240020
022500                                                                  02250020
022600     EVALUATE TRUE                                                02260020
022700         WHEN SQLCODE = ZERO                                      02270020
022800             MOVE FLAREA-PRC-AREA-GP-CDE                          02280020
022900                                      TO RC033-RETURN-GP-CDE      02290020
023000         WHEN SQLCODE = +100                                      02300020
023100             CONTINUE                                             02310020
023200         WHEN SQLCODE < ZERO                                      02320020
023300         WHEN SQLCODE > ZERO                                      02330020
023400         WHEN SQLWARN0 NOT = SPACES                               02340020
023500             MOVE '3000-VALIDATE-PRC-AREA'                        02350020
023600                                      TO RC033-PARA               02360020
023700             PERFORM 9200-SQL-ERROR                               02370020
023800     END-EVALUATE.                                                02380020
023900/                                                                 02390020
023910 4000-FIND-PROC-AREA.                                             02391020
023911                                                                  02391120
023912     PERFORM 4100-OPEN-TWKORIN.                                   02391220
023913     PERFORM 4300-FETCH-TWKORIN-LOOP.                             02391320
023914                                                                  02391420
023915 4100-OPEN-TWKORIN.                                               02391520
023922                                                                  02392220
023923     EXEC SQL                                                     02392320
023924         OPEN TWKORIN-CSR                                         02392420
023925     END-EXEC.                                                    02392520
023926                                                                  02392620
023927     EVALUATE TRUE                                                02392720
023928         WHEN SQLCODE = +0                                        02392820
023931              CONTINUE                                            02393120
023932         WHEN SQLCODE < ZERO                                      02393220
023933         WHEN SQLCODE > ZERO                                      02393320
023934         WHEN SQLWARN0 NOT = SPACES                               02393420
023935             MOVE '4100-OPEN-TWKORIN'                             02393520
023936                                      TO RC033-PARA               02393620
023937             PERFORM 9200-SQL-ERROR                               02393720
023947     END-EVALUATE.                                                02394720
023957                                                                  02395720
023958 4200-CLOSE-TWKORIN.                                              02395820
023965                                                                  02396520
023966     EXEC SQL                                                     02396620
023967         CLOSE TWKORIN-CSR                                        02396720
023968     END-EXEC                                                     02396820
023969                                                                  02396920
023970     EVALUATE TRUE                                                02397020
023971         WHEN SQLCODE = 0                                         02397120
023972             CONTINUE                                             02397220
023973         WHEN SQLCODE < ZERO                                      02397320
023974         WHEN SQLCODE > ZERO                                      02397420
023975         WHEN SQLWARN0 NOT = SPACES                               02397520
023976             MOVE '4200-CLOSE-TWKORIN'                            02397620
023977                                      TO RC033-PARA               02397720
023978             PERFORM 9200-SQL-ERROR                               02397820
023990     END-EVALUATE.                                                02399020
023991                                                                  02399120
023996 4300-FETCH-TWKORIN-LOOP.                                         02399620
023997                                                                  02399720
023998     MOVE 'N' TO PS-TWKORIN-CURSOR-SW.                            02399820
023999     MOVE 'N' TO PS-TWKORIN-ZERO-SW.                              02399920
024000                                                                  02400020
024001     PERFORM 4400-FETCH-TWKORIN.                                  02400120
024002                                                                  02400220
024003     IF  PS-EOF-TWKORIN-CSR                                       02400320
024004     OR  WKORIN-STRT-TMST = PC-DEFAULT-TMST                       02400420
024005         PERFORM 4200-CLOSE-TWKORIN                               02400520
024006         PERFORM 4600-OPEN-WKORIN0-CURSOR                         02400620
024007         PERFORM 4800-FETCH-TWKORIN-ZERO                          02400720
024008         IF  WKORIN-STRT-TMST = PC-DEFAULT-TMST                   02400820
024009             MOVE WKORIN-PRC-FCLTY-AREA-ID TO                     02400920
024010                                          RC033-RETURN-P2L-AREA   02401020
024011                                          RC033-RETURN-FCSE-AREA  02401120
024012                                          RC033-RETURN-LAST-AREA  02401220
024013*                     PV-PRC-FCLTY-AREA-ID                        02401320
024014             MOVE 'N' TO PS-TWKORIN-ZERO-SW                       02401420
024015             PERFORM 4700-CLOSE-WKORIN0                           02401520
024016         ELSE                                                     02401620
024017             MOVE WKORIN-PRC-FCLTY-AREA-ID TO                     02401720
024018                      PV-PRC-FCLTY-AREA-ID                        02401820
024019             PERFORM 4800-FETCH-TWKORIN-ZERO                      02401920
024020                 UNTIL PS-EOF-TWKORIN-ZERO                        02402020
024021             PERFORM 4700-CLOSE-WKORIN0                           02402120
024022             MOVE PV-PRC-FCLTY-AREA-ID TO RC033-RETURN-P2L-AREA   02402220
024023                                          RC033-RETURN-FCSE-AREA  02402320
024024                                          RC033-RETURN-LAST-AREA  02402420
024025     ELSE                                                         02402520
024026         MOVE WKORIN-PRC-FCLTY-AREA-ID TO PV-PRC-FCLTY-AREA-ID    02402620
024027         PERFORM 4400-FETCH-TWKORIN                               02402720
024028             UNTIL PS-EOF-TWKORIN-CSR                             02402820
024029         MOVE PV-PRC-FCLTY-AREA-ID     TO RC033-RETURN-P2L-AREA   02402920
024030                                          RC033-RETURN-FCSE-AREA  02403020
024031                                          RC033-RETURN-LAST-AREA  02403120
024032         PERFORM 4200-CLOSE-TWKORIN                               02403220
024033     END-IF.                                                      02403320
024034                                                                  02403420
024035 4400-FETCH-TWKORIN.                                              02403520
024036                                                                  02403620
024037     EXEC SQL                                                     02403720
024038          FETCH TWKORIN-CSR                                       02403820
024039             INTO :WKORIN-STRT-TMST                               02403920
024040                 ,:WKORIN-STOP-TMST                               02404020
024041                 ,:WKORIN-PRC-FCLTY-AREA-ID                       02404120
024042                 ,:WKORIN-SCREEN-SEQ-NBR                          02404220
024043     END-EXEC.                                                    02404320
024044                                                                  02404420
024045     EVALUATE TRUE                                                02404520
024046         WHEN SQLCODE = +0                                        02404620
024063              IF  WKORIN-STRT-TMST = PC-DEFAULT-TMST2             02406320
024064                  MOVE PC-DEFAULT-TMST TO                         02406420
024065                       WKORIN-STRT-TMST                           02406520
024066              END-IF                                              02406620
024067              IF  WKORIN-STOP-TMST = PC-DEFAULT-TMST2             02406720
024068                  MOVE PC-DEFAULT-TMST TO                         02406820
024069                       WKORIN-STOP-TMST                           02406920
024070              END-IF                                              02407020
024071              PERFORM 4500-CHECK-DATES                            02407120
024072         WHEN SQLCODE = +100                                      02407220
024073              SET PS-EOF-TWKORIN-CSR TO TRUE                      02407320
024074         WHEN SQLCODE < ZERO                                      02407420
024075         WHEN SQLCODE > ZERO                                      02407520
024076         WHEN SQLWARN0 NOT = SPACES                               02407620
024077              MOVE '4400-FETCH-TWKORIN'                           02407720
024078                                       TO RC033-PARA              02407820
024079              PERFORM 9200-SQL-ERROR                              02407920
024080     END-EVALUATE.                                                02408020
024081                                                                  02408120
024082 4500-CHECK-DATES.                                                02408220
024083     IF  WKORIN-STRT-TMST NOT EQUAL PC-DEFAULT-TMST               02408320
024084         IF  WKORIN-STOP-TMST NOT EQUAL PC-DEFAULT-TMST           02408420
024085             MOVE WKORIN-PRC-FCLTY-AREA-ID TO                     02408520
024086                        PV-PRC-FCLTY-AREA-ID                      02408620
024087         ELSE                                                     02408720
024088             MOVE WKORIN-PRC-FCLTY-AREA-ID TO                     02408820
024089                        PV-PRC-FCLTY-AREA-ID                      02408920
024090             SET PS-EOF-TWKORIN-CSR TO TRUE                       02409020
024091         END-IF                                                   02409120
024092     ELSE                                                         02409220
024093         SET PS-EOF-TWKORIN-CSR TO TRUE                           02409320
024094     END-IF.                                                      02409420
024095/                                                                 02409520
024096 4600-OPEN-WKORIN0-CURSOR.                                        02409620
024097                                                                  02409720
024098     EXEC SQL                                                     02409820
024099         OPEN WKORIN0-CSR                                         02409920
024100     END-EXEC.                                                    02410020
024101                                                                  02410120
024108     EVALUATE TRUE                                                02410820
024109         WHEN SQLCODE = +0                                        02410920
024110              CONTINUE                                            02411020
024111         WHEN SQLCODE < ZERO                                      02411120
024112         WHEN SQLCODE > ZERO                                      02411220
024113         WHEN SQLWARN0 NOT = SPACES                               02411320
024114             MOVE '4600-OPEN-WKORIN0'                             02411420
024115                                      TO RC033-PARA               02411520
024116             PERFORM 9200-SQL-ERROR                               02411620
024117     END-EVALUATE.                                                02411720
024126                                                                  02412620
024127 4700-CLOSE-WKORIN0.                                              02412720
024134                                                                  02413420
024135     EXEC SQL                                                     02413520
024136         CLOSE WKORIN0-CSR                                        02413620
024137     END-EXEC.                                                    02413720
024138                                                                  02413820
024139     EVALUATE TRUE                                                02413920
024140         WHEN SQLCODE = +0                                        02414020
024141              CONTINUE                                            02414120
024142         WHEN SQLCODE < ZERO                                      02414220
024143         WHEN SQLCODE > ZERO                                      02414320
024144         WHEN SQLWARN0 NOT = SPACES                               02414420
024145             MOVE '4700-CLOSE-WKORIN0'                            02414520
024146                                      TO RC033-PARA               02414620
024147             PERFORM 9200-SQL-ERROR                               02414720
024148     END-EVALUATE.                                                02414820
024164                                                                  02416420
024165 4800-FETCH-TWKORIN-ZERO.                                         02416520
024166     EXEC SQL                                                     02416620
024167          FETCH WKORIN0-CSR                                       02416720
024168             INTO :WKORIN-STRT-TMST                               02416820
024169                 ,:WKORIN-STOP-TMST                               02416920
024170                 ,:WKORIN-PRC-FCLTY-AREA-ID                       02417020
024171                 ,:WKORIN-SCREEN-SEQ-NBR                          02417120
024172     END-EXEC.                                                    02417220
024173                                                                  02417320
024174     EVALUATE TRUE                                                02417420
024175         WHEN SQLCODE = +0                                        02417520
024192              IF  WKORIN-STRT-TMST = PC-DEFAULT-TMST2             02419220
024193                  MOVE PC-DEFAULT-TMST TO                         02419320
024194                       WKORIN-STRT-TMST                           02419420
024195              END-IF                                              02419520
024196              IF  WKORIN-STOP-TMST = PC-DEFAULT-TMST2             02419620
024197                  MOVE PC-DEFAULT-TMST TO                         02419720
024198                       WKORIN-STOP-TMST                           02419820
024199              END-IF                                              02419920
024200              PERFORM 4900-CHECK-DATES                            02420020
024201         WHEN SQLCODE = +100                                      02420120
024202              SET PS-EOF-TWKORIN-ZERO TO TRUE                     02420220
024203         WHEN SQLCODE < ZERO                                      02420320
024204         WHEN SQLCODE > ZERO                                      02420420
024205         WHEN SQLWARN0 NOT = SPACES                               02420520
024206             MOVE '4800-FETCH-TWKORIN'                            02420620
024207                                      TO RC033-PARA               02420720
024208             PERFORM 9200-SQL-ERROR                               02420820
024209     END-EVALUATE.                                                02420920
024210                                                                  02421020
024211 4900-CHECK-DATES.                                                02421120
024212     IF  WKORIN-STRT-TMST NOT EQUAL PC-DEFAULT-TMST               02421220
024213         IF  WKORIN-STOP-TMST NOT EQUAL PC-DEFAULT-TMST           02421320
024214             MOVE WKORIN-PRC-FCLTY-AREA-ID TO                     02421420
024215                        PV-PRC-FCLTY-AREA-ID                      02421520
024216         ELSE                                                     02421620
024217             MOVE WKORIN-PRC-FCLTY-AREA-ID TO                     02421720
024218                        PV-PRC-FCLTY-AREA-ID                      02421820
024219             SET PS-EOF-TWKORIN-CSR TO TRUE                       02421920
024220         END-IF                                                   02422020
024221     ELSE                                                         02422120
024222         SET PS-EOF-TWKORIN-CSR TO TRUE                           02422220
024223     END-IF.                                                      02422320
024224*                                                                 02422420
024225/                                                                 02422520
024226 7000-OPEN-WKORIN-CSR.                                            02422620
024227     EXEC SQL                                                     02422720
024230         OPEN WKORIN-CSR                                          02423020
024300     END-EXEC.                                                    02430020
024400                                                                  02440020
024500     EVALUATE TRUE                                                02450020
024600         WHEN SQLCODE = ZERO                                      02460020
024700             SET PS-WKORIN-CSR-OPEN   TO TRUE                     02470020
024800         WHEN SQLCODE < ZERO                                      02480020
024900         WHEN SQLCODE > ZERO                                      02490020
025000         WHEN SQLWARN0 NOT = SPACES                               02500020
025100             MOVE '7000-OPEN-WKORIN-CSR'                          02510020
025200                                      TO RC033-PARA               02520020
025300             PERFORM 9200-SQL-ERROR                               02530020
025400     END-EVALUATE.                                                02540020
025500/                                                                 02550020
025600 7010-FETCH-WKORIN-CSR.                                           02560020
025700     EXEC SQL                                                     02570020
025800         FETCH WKORIN-CSR                                         02580020
025900         INTO                                                     02590020
026000             :WKORIN-WO-INSTR-SEQ-NBR                             02600020
026100           , :WKORIN-PRC-FCLTY-AREA-ID                            02610020
026200           , :WKORIN-OPER-UNT-ID                                  02620020
026300           , :WKORIN-FCLTY-ID                                     02630020
026400     END-EXEC.                                                    02640020
026500                                                                  02650020
026600     EVALUATE TRUE                                                02660020
026700         WHEN SQLCODE = ZERO                                      02670020
026800             MOVE WKORIN-OPER-UNT-ID  TO RC033-OPER-UNT-ID        02680020
026900             MOVE WKORIN-FCLTY-ID     TO RC033-FCLTY-ID           02690020
027000             MOVE WKORIN-PRC-FCLTY-AREA-ID                        02700020
027100                                      TO RC033-PRC-AREA-TO-CHECK  02710020
027200         WHEN SQLCODE = +100                                      02720020
027300             SET PS-EOF-TWKORIN       TO TRUE                     02730020
027400         WHEN SQLCODE < ZERO                                      02740020
027500         WHEN SQLCODE > ZERO                                      02750020
027600         WHEN SQLWARN0 NOT = SPACES                               02760020
027700             MOVE '7010-FETCH-WKORIN-CSR'                         02770020
027800                                      TO RC033-PARA               02780020
027900             PERFORM 9200-SQL-ERROR                               02790020
028000     END-EVALUATE.                                                02800020
028100/                                                                 02810020
028200 7020-CLOSE-WKORIN-CSR.                                           02820020
028300     EXEC SQL                                                     02830020
028400         CLOSE WKORIN-CSR                                         02840020
028500     END-EXEC.                                                    02850020
028600                                                                  02860020
028700     EVALUATE TRUE                                                02870020
028800         WHEN SQLCODE = ZERO                                      02880020
028900             CONTINUE                                             02890020
029000         WHEN SQLCODE < ZERO                                      02900020
029100         WHEN SQLCODE > ZERO                                      02910020
029200         WHEN SQLWARN0 NOT = SPACES                               02920020
029300             MOVE '7020-CLOSE-WKORIN-CSR'                         02930020
029400                                      TO RC033-PARA               02940020
029500             PERFORM 9200-SQL-ERROR                               02950020
029600     END-EVALUATE.                                                02960020
029700/                                                                 02970020
029701 7100-CHECK-WO-EXISTS.                                            02970120
029702     MOVE ZERO                        TO PV-TWKORIN-COUNTER       02970220
029703     EXEC SQL                                                     02970320
029704         SELECT COUNT(*)                                          02970420
029705         INTO                                                     02970520
029706          :PV-TWKORIN-COUNTER                                     02970620
029707         FROM                                                     02970720
029708             TWKORIN                                              02970820
029709         WHERE                                                    02970920
029710             ORD_NBR                  = :RC033-PO-NBR             02971020
029711         AND RCVR_SEQ_NBR             = :RC033-REC-SEQ-NBR        02971120
029712         AND ORD_LNE_NBR              > :RC033-PO-LNE-NBR         02971220
029713         AND VER_STATUS_CDE           = 'A'                       02971320
029714     END-EXEC.                                                    02971420
029715                                                                  02971520
029716     EVALUATE TRUE                                                02971620
029717         WHEN SQLCODE = ZERO                                      02971720
029718           IF PV-TWKORIN-COUNTER > 0                              02971820
029719             SET RC033-WO-EXISTS        TO TRUE                   02971920
029720             SET RC033-USE-LINE-LVL     TO TRUE                   02972020
029721           ELSE                                                   02972120
029722             PERFORM 7150-CHECK-WO-EXISTS-ZERO-LVL                02972220
029723           END-IF                                                 02972320
029724         WHEN SQLCODE < ZERO                                      02972420
029725         WHEN SQLCODE > ZERO                                      02972520
029726         WHEN SQLWARN0 NOT = SPACES                               02972620
029727             MOVE '7100-CHECK-WO-EXISTS' TO RC033-PARA            02972720
029728             PERFORM 9200-SQL-ERROR                               02972820
029729     END-EVALUATE.                                                02972920
029730                                                                  02973020
029731                                                                  02973120
029732 7150-CHECK-WO-EXISTS-ZERO-LVL.                                   02973220
029733     MOVE ZERO                        TO PV-TWKORIN-COUNTER       02973320
029734     EXEC SQL                                                     02973420
029735         SELECT COUNT(*)                                          02973520
029736         INTO                                                     02973620
029737          :PV-TWKORIN-COUNTER                                     02973720
029738         FROM                                                     02973820
029739             TWKORIN                                              02973920
029740         WHERE                                                    02974020
029741             ORD_NBR                  = :RC033-PO-NBR             02974120
029742         AND RCVR_SEQ_NBR             = :RC033-REC-SEQ-NBR        02974220
029743         AND ORD_LNE_NBR              = 0                         02974320
029744         AND VER_STATUS_CDE           = 'A'                       02974420
029745        WITH UR                                                   02974520
029746     END-EXEC.                                                    02974620
029747                                                                  02974720
029748     EVALUATE TRUE                                                02974820
029749         WHEN SQLCODE = ZERO                                      02974920
029750           IF PV-TWKORIN-COUNTER > 0                              02975020
029751             SET RC033-WO-EXISTS        TO TRUE                   02975120
029752             SET RC033-USE-ZERO-LVL     TO TRUE                   02975220
029753           ELSE                                                   02975320
029754             SET RC033-WO-NOT-EXISTS    TO TRUE                   02975420
029755           END-IF                                                 02975520
029772         WHEN SQLCODE < ZERO                                      02977220
029773         WHEN SQLCODE > ZERO                                      02977320
029774         WHEN SQLWARN0 NOT = SPACES                               02977420
029775             MOVE '7150-CHECK-WO-EXISTS-ZERO-LVL' TO RC033-PARA   02977520
029776             PERFORM 9200-SQL-ERROR                               02977620
029780     END-EVALUATE.                                                02978020
032500/                                                                 03250020
032600 9000-EOJ-ROUTINE.                                                03260020
032700                                                                  03270020
032800     IF PS-EOF-TWKORIN                                            03280020
032900         IF RC033-RETURN-P2L-AREA = SPACES                        03290020
033000             MOVE RC033-RETURN-LAST-AREA                          03300020
033100                                      TO RC033-RETURN-P2L-AREA    03310020
033200         END-IF                                                   03320020
033300         IF RC033-RETURN-FCSE-AREA = SPACES                       03330020
033400             MOVE RC033-RETURN-LAST-AREA                          03340020
033500                                      TO RC033-RETURN-FCSE-AREA   03350020
033600         END-IF                                                   03360020
033700     END-IF.                                                      03370020
033800                                                                  03380020
033900     MOVE RC033-FIELDS                TO CA-INPUT-REC             03390020
034000     IF PS-WKORIN-CSR-OPEN                                        03400020
034100         PERFORM 7020-CLOSE-WKORIN-CSR                            03410020
034200     END-IF.                                                      03420020
034300                                                                  03430020
034400 9200-SQL-ERROR.                                                  03440020
034500                                                                  03450020
034600     MOVE SQLCODE                     TO RC033-SQLCODE            03460020
034700     MOVE SQLCA                       TO RC033-SQLCA              03470020
034800     SET RC033-DB2-ERROR              TO TRUE.                    03480020
034900     MOVE RC033-FIELDS                TO CA-INPUT-REC             03490020
035000     GO TO 0000-GOBACK.                                           03500020
035100                                                                  03510020
