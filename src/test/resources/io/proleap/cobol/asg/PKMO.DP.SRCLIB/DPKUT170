         PRINT GEN                                                      00010000
*.********************************************************************* 00020000
*.                 KOHL'S DEPARTMENT STORES                           * 00030000
*.                                                                    * 00040000
*.*MODIFICATION HISTORY --------------------------------------------- * 00050000
*.   - DATE -   - PROGRAMMER -            - DESCRIPTION -             * 00060000
*.   03/12/98     D.DREW                    WRITE PROGRAM             * 00070000
*.                                                                    * 00080000
*.                                                                    * 00090000
*.*PROGRAM LOCATION ------------------------------------------------- * 00100000
*.         SOURCE LIBRARY: PKMO.DP.SRCLIB                             * 00110000
*.          LOAD  LIBRARY: PKMO.LOADLIB                               * 00120000
*.                                                                    * 00130000
*.*FUNCTION OF PROGRAM:                                               * 00131000
*.             PROGRAM CALLED FROM A FORTRAN/COBOL PROGRAM TO:        * 00131100
*.               1) READ A 1 BYTE FIELD AND RETURN A 8 BYTE FIELD     * 00131200
*.                  WITH BIT POSITIONS SET TO Y OR N                  * 00131300
*.               3) READ A 8 BYTE FIELD AN SET THE BITS IN THE 1 BYTE * 00131400
*.                  FIELD BASED ON Y OR N OR BLANKS                   * 00131500
*.                                                                    * 00131600
*.                                                                    * 00131700
*.*LIST OF ABEND AND/OR RETURN CODES - (COMPLETE IF APPLICABLE) ----- * 00131800
*.      CODES         CAUSES AND REMEDIES                             * 00131900
*.                                                                    * 00132000
*.      0000          OK                                              * 00133000
*.      4000          NEED 4 PARMS                                    * 00134000
*.      4001          CODE NOT  "C"  OR  "D"                          * 00135000
*.      4002          8 BYTE FIELD NOT Y,N OR BLANKS                  * 00136000
*.      4003          8 BYTE FIELD ALL BLANKS FOR CHANGE              * 00137000
*.                                                                    * 00138000
*.*LINKAGE EDITOR ATTRIBUTES AND CONSIDERATIONS --------------------- * 00139000
*.     NORMAL LKED ATTRIBUTES.                                        * 00140000
*.            NONE                                                    * 00150000
*.                                                                    * 00160000
*.    PLACE IN "PKMO.LOADLIB"                                         * 00170000
*. ENTRY POINTS:                                                      * 00180000
*.    DPKUT170                                                        * 00190000
*.                                                                    * 00200000
*.                                                                    * 00210000
*.*HOW TO USE:  (LIST JCL, CONTROL CARDS, ETC*) --------------------- * 00220000
*.                                                                    * 00230000
*.                                                                    * 00240000
*. DOCUMENTATION FOR PRINTING FOLLOWS:                                * 00250000
*.                                                                    * 00260000
*********************************************************************** 00270000
*                                                                       00280000
*                                                                       00290000
* PARMS REQUIRED:                                                       00300000
*                                                                       00310000
*           COBOL                                  FORTRAN              00320000
*    ------------------------                 -----------------------   00330000
*    01 BYTE     PIC X(1)                     CHARACTER*1 BYTE          00340000
*    01 BITS     PIC X(8)                     CHARACTER*8 BITS          00350000
*    01 CODE     PIC X(1)                     CHARACTER*1 CODE          00360000
*    01 LASTRC   PIC 9(8) COMP SYNC.          INTEGER*4  LASTRC         00370000
*                                                                       00380000
*                                                                       00390000
*                                                                       00400000
* SAMPLE COBOL CALL:                                                    00410000
*      CALL 'DPKUT170' USING BYTE,BIT,CODE,LASTRC.                      00420000
*                                                                       00430000
*********************************************************************** 00440000
DPKUT170 $PROLOG R12                                                    00450000
DPKUT170 AMODE 31                                                       00460000
DPKUT170 RMODE 24                                                       00470000
         L     R2,0(R1)           R2 = BYTE FIELD                       00480000
         TM    0(R1),LASTPARM     LAST PARM ??                          00490000
         BO    BBB005             YES - SET ERROR                       00500000
         L     R3,4(R1)           R3 = BITS FIELD                       00510000
         TM    4(R1),LASTPARM     LAST PARM ??                          00520000
         BO    BBB005             YES - SET ERROR                       00530000
         L     R4,8(R1)           R4 = CODE FIELD                       00540000
         TM    8(R1),LASTPARM     LAST PARM ??                          00550000
         BO    BBB005             YES - SET ERROR                       00560000
         L     R5,12(R1)          R5 = RETURN CODE FIELD                00570000
         TM    12(R1),LASTPARM    LAST PARM ??                          00580000
         BO    ENTRY010           START THE PROCESSING                  00590000
BBB005   EQU   *                  ALL PARMS PASSED ??                   00600000
         L     R15,=F'4000'       ERROR ?????                           00610000
         B     REALEOJ            RETURN                                00620000
         EJECT                                                          00630000
*********************************************************************** 00640000
*        CHECK PARMS                                                  * 00650000
*********************************************************************** 00660000
ENTRY010 DS    0H                                                       00670000
*                                                                       00680000
*        CLEAR RETURN CODE FIELD                                        00690000
*                                                                       00700000
         MVC   0(4,R5),=F'0'     ZERO USER RETURN CODE FIELD            00710000
*                                                                       00720000
*        CHECK CODE FOR C OR D                                          00730000
*                                                                       00740000
         CLI   0(R4),C'C'         CHANGE ???                            00750000
         BE    ENTRY020           YES - CONTINUE                        00760000
         CLI   0(R4),C'D'         DISPLAY ??                            00770000
         BE    ENTRY030           YES - CONTINUE                        00780000
         MVC   0(4,R5),=F'4001'   ERROR ?????                           00790000
         B     EOJ1               RETURN                                00800000
         EJECT                                                          00810000
*******************************************************************     00820000
*        CHANGE THE BITS BASED ON Y,N OR BLANKS IN THE 8 BYTES          00830000
*******************************************************************     00840000
ENTRY020 DS    0H                                                       00850000
*                                                                       00860000
*        CHECK BITS FOR Y , N OR BLANKS                                 00870000
*                                                                       00880000
AAA020   LR    R6,R3              SET R6 TO FIRST BIT FIELD             00890000
         LA    R7,8               SET TO MAX LENGTH                     00900000
BBB020   CLI   0(R6),C' '         LOOKING FOR BLANK                     00910000
         BE    CCC020             FOUND IT                              00920000
         CLI   0(R6),C'Y'         LOOKING FOR "Y"                       00930000
         BE    CCC020             FOUND IT                              00940000
         CLI   0(R6),C'N'         LOOKING FOR "Y"                       00950000
         BE    CCC020             FOUND IT                              00960000
         MVC   0(4,R5),=F'4002'   ERROR ?????                           00970000
         B     EOJ1               RETURN                                00980000
CCC020   LA    R6,1(R6)           BUMP                                  00990000
         BCT   R7,BBB020          TRY FOR NEXT                          01000000
         CLC   0(8,R3),=C'        ' ALL BLANKS - MUST BE IN ERROR       01010000
         BNE   CHKNEXT1           Y OR N - OK                           01020000
         MVC   0(4,R5),=F'4003'   ERROR ?????                           01030000
         B     EOJ1               RETURN                                01040000
*                                                                       01050000
CHKNEXT1 CLI   0(R3),C' '         IS THIS BYTE BLANKS                   01060000
         BE    CHKNEXT2           YES - LEAVE BIT ALONE                 01070000
         CLI   0(R3),C'Y'         TURN THIS BIT ON                      01080000
         BNE   CHKNO1             NO - GO TURN OFF                      01090000
         OI    0(R2),BIT1ON       TURN IT ON                            01100000
         B     CHKNEXT2           GO TO NEXT BIT                        01110000
CHKNO1   NI    0(R2),BIT1OFF      TURN IT OFF                           01120000
CHKNEXT2 CLI   1(R3),C' '         IS THIS BYTE BLANKS                   01130000
         BE    CHKNEXT3           YES - LEAVE BIT ALONE                 01140000
         CLI   1(R3),C'Y'         TURN THIS BIT ON                      01150000
         BNE   CHKNO2             NO - GO TURN OFF                      01160000
         OI    0(R2),BIT2ON       TURN IT ON                            01170000
         B     CHKNEXT3           GO TO NEXT BIT                        01180000
CHKNO2   NI    0(R2),BIT2OFF      TURN IT OFF                           01190000
CHKNEXT3 CLI   2(R3),C' '         IS THIS BYTE BLANKS                   01200000
         BE    CHKNEXT4           YES - LEAVE BIT ALONE                 01210000
         CLI   2(R3),C'Y'         TURN THIS BIT ON                      01220000
         BNE   CHKNO3             NO - GO TURN OFF                      01230000
         OI    0(R2),BIT3ON       TURN IT ON                            01240000
         B     CHKNEXT4           GO TO NEXT BIT                        01250000
CHKNO3   NI    0(R2),BIT3OFF      TURN IT OFF                           01260000
CHKNEXT4 CLI   3(R3),C' '         IS THIS BYTE BLANKS                   01270000
         BE    CHKNEXT5           YES - LEAVE BIT ALONE                 01280000
         CLI   3(R3),C'Y'         TURN THIS BIT ON                      01290000
         BNE   CHKNO4             NO - GO TURN OFF                      01300000
         OI    0(R2),BIT4ON       TURN IT ON                            01310000
         B     CHKNEXT5           GO TO NEXT BIT                        01320000
CHKNO4   NI    0(R2),BIT4OFF      TURN IT OFF                           01330000
CHKNEXT5 CLI   4(R3),C' '         IS THIS BYTE BLANKS                   01340000
         BE    CHKNEXT6           YES - LEAVE BIT ALONE                 01350000
         CLI   4(R3),C'Y'         TURN THIS BIT ON                      01360000
         BNE   CHKNO5             NO - GO TURN OFF                      01370000
         OI    0(R2),BIT5ON       TURN IT ON                            01380000
         B     CHKNEXT6           GO TO NEXT BIT                        01390000
CHKNO5   NI    0(R2),BIT5OFF      TURN IT OFF                           01400000
CHKNEXT6 CLI   5(R3),C' '         IS THIS BYTE BLANKS                   01410000
         BE    CHKNEXT7           YES - LEAVE BIT ALONE                 01420000
         CLI   5(R3),C'Y'         TURN THIS BIT ON                      01430000
         BNE   CHKNO6             NO - GO TURN OFF                      01440000
         OI    0(R2),BIT6ON       TURN IT ON                            01450000
         B     CHKNEXT7           GO TO NEXT BIT                        01460000
CHKNO6   NI    0(R2),BIT6OFF      TURN IT OFF                           01470000
CHKNEXT7 CLI   6(R3),C' '         IS THIS BYTE BLANKS                   01480000
         BE    CHKNEXT8           YES - LEAVE BIT ALONE                 01490000
         CLI   6(R3),C'Y'         TURN THIS BIT ON                      01500000
         BNE   CHKNO7             NO - GO TURN OFF                      01510000
         OI    0(R2),BIT7ON       TURN IT ON                            01520000
         B     CHKNEXT8           GO TO NEXT BIT                        01530000
CHKNO7   NI    0(R2),BIT7OFF      TURN IT OFF                           01540000
CHKNEXT8 CLI   7(R3),C' '         IS THIS BYTE BLANKS                   01550000
         BE    EXIT020            YES - LEAVE BIT ALONE                 01560000
         CLI   7(R3),C'Y'         TURN THIS BIT ON                      01570000
         BNE   CHKNO8             NO - GO TURN OFF                      01580000
         OI    0(R2),BIT8ON       TURN IT ON                            01590000
         B     EXIT020            ALL DONE                              01600000
CHKNO8   NI    0(R2),BIT8OFF      TURN IT OFF                           01610000
*                                                                       01620000
EXIT020  EQU   *                                                        01630000
         B     EOJ2                                                     01640000
         EJECT                                                          01650000
*******************************************************************     01660000
*        DISPLAY THE BITS                                         *     01670000
*******************************************************************     01680000
ENTRY030 DS    0H                                                       01690000
         MVI   0(R3),C'Y'         SET FIRST BYTE TO Y                   01700000
         MVC   1(7,R3),0(R3)      SET REST OF FIELD TO Y                01710000
CHK001   TM    0(R2),BIT1ON       IS THIS BIT ON ????                   01720000
         BO    CHK002             IT'S ON - GO CHECK NEXT               01730000
         MVI   0(R3),C'N'         SET TO NO                             01740000
CHK002   TM    0(R2),BIT2ON       IS THIS BIT ON ????                   01750000
         BO    CHK003             IT'S ON - GO CHECK NEXT               01760000
         MVI   1(R3),C'N'         SET TO NO                             01770000
CHK003   TM    0(R2),BIT3ON       IS THIS BIT ON ????                   01780000
         BO    CHK004             IT'S ON - GO CHECK NEXT               01790000
         MVI   2(R3),C'N'         SET TO NO                             01800000
CHK004   TM    0(R2),BIT4ON       IS THIS BIT ON ????                   01810000
         BO    CHK005             IT'S ON - GO CHECK NEXT               01820000
         MVI   3(R3),C'N'         SET TO NO                             01830000
CHK005   TM    0(R2),BIT5ON       IS THIS BIT ON ????                   01840000
         BO    CHK006             IT'S ON - GO CHECK NEXT               01850000
         MVI   4(R3),C'N'         SET TO NO                             01860000
CHK006   TM    0(R2),BIT6ON       IS THIS BIT ON ????                   01870000
         BO    CHK007             IT'S ON - GO CHECK NEXT               01880000
         MVI   5(R3),C'N'         SET TO NO                             01890000
CHK007   TM    0(R2),BIT7ON       IS THIS BIT ON ????                   01900000
         BO    CHK008             IT'S ON - GO CHECK NEXT               01910000
         MVI   6(R3),C'N'         SET TO NO                             01920000
CHK008   TM    0(R2),BIT8ON       IS THIS BIT ON ????                   01930000
         BO    EXIT030            IT'S ON - ALL DONE                    01940000
         MVI   7(R3),C'N'         SET TO NO                             01950000
EXIT030  EQU   *                                                        01960000
         B     EOJ2               GO TO EOJ                             01970000
         EJECT                                                          01980000
*********************************************************************   01990000
*        END OF JOB PROCESSING                                      *   02000000
*********************************************************************   02010000
EOJ1     L     R15,0(R5)          SET RETURN CODE TO REAL ERROR ####    02020000
         B     REALEOJ                                                  02030000
*                                                                       02040000
EOJ2     XR    R15,R15            ZERO RETURN CODE                      02050000
         B     REALEOJ                                                  02060000
*                                                                       02070000
REALEOJ  $EPILOG ,                RETURN TO CALLER                      02080000
         EJECT                                                          02090000
*********************************************************************** 02100000
*        WORK AREA                                                    * 02110000
*********************************************************************** 02120000
         LTORG                                                          02130000
LASTPARM EQU   X'80'                                                    02140000
BIT1ON   EQU   X'80'                                                    02150000
BIT2ON   EQU   X'40'                                                    02160000
BIT3ON   EQU   X'20'                                                    02170000
BIT4ON   EQU   X'10'                                                    02180000
BIT5ON   EQU   X'08'                                                    02190000
BIT6ON   EQU   X'04'                                                    02200000
BIT7ON   EQU   X'02'                                                    02210000
BIT8ON   EQU   X'01'                                                    02220000
BIT1OFF  EQU   X'7F'                                                    02230000
BIT2OFF  EQU   X'BF'                                                    02240000
BIT3OFF  EQU   X'DF'                                                    02250000
BIT4OFF  EQU   X'EF'                                                    02260000
BIT5OFF  EQU   X'F7'                                                    02270000
BIT6OFF  EQU   X'FB'                                                    02280000
BIT7OFF  EQU   X'FD'                                                    02290000
BIT8OFF  EQU   X'FE'                                                    02300000
         END                                                            02310000
