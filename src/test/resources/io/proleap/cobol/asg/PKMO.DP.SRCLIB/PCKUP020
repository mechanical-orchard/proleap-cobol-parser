000200***************************************************************** 00020000
000300 IDENTIFICATION DIVISION.                                         00030000
000400***************************************************************** 00040000
000500 PROGRAM-ID.    PCKUP020.                                         00050000
000600 AUTHOR.        EKTA AGRAWAL.                                     00060000
000700 INSTALLATION.  KOHLS.                                            00070000
000800 DATE-WRITTEN.  JUNE 2010.                                        00080000
000900 DATE-COMPILED.                                                   00090000
001000***************************************************************** 00100000
001100*  THIS PROGRAM EXTRACTS THE SUMMARZIED RECORDS FROM THE        * 00110000
001200*  RECIEVER LINE DETAIL TABLE FOR THE PULL NUMBER AND THE PULL  * 00120000
001210*  LINE NUMBER AND WRITES IT TO THE OUTPUT FILE.                * 00121000
001400***************************************************************** 00140000
001500 ENVIRONMENT DIVISION.                                            00150000
001600 INPUT-OUTPUT SECTION.                                            00160000
001700                                                                  00170000
001800 FILE-CONTROL.                                                    00180000
001900                                                                  00190000
002000     SELECT RCVR-LNE-DTL-FILE                                     00200000
002100         ASSIGN TO OUT01.                                         00210000
002101                                                                  00210100
002300***************************************************************** 00230000
002400 DATA DIVISION.                                                   00240000
002500***************************************************************** 00250000
002600 FILE SECTION.                                                    00260000
002700                                                                  00270000
002800 FD  RCVR-LNE-DTL-FILE                                            00280000
002900     RECORDING MODE IS F                                          00290000
003000     BLOCK CONTAINS 0 RECORDS                                     00300000
003100     LABEL RECORDS ARE STANDARD.                                  00310000
003200                                                                  00320000
003300 01 RCVR-LNE-DTL-RECORD    PIC X(107).                            00330000
003400                                                                  00340000
003500***************************************************************** 00350000
003600 WORKING-STORAGE SECTION.                                         00360000
003700                                                                  00370000
003800 01  PS-PROGRAM-SWITCHES.                                         00380000
003900     05  PS-END-OF-CSR-SW             PIC  X(01) VALUE 'N'.       00390000
004000         88  PS-END-OF-RCVR-LNE-DTL-CSR          VALUE 'Y'.       00400000
004100         88  PS-NOT-END-OF-RCVR-LNE-DTL-CSR      VALUE 'N'.       00410000
004200                                                                  00420000
004300 01  PV-PROGRAM-VARIABLES.                                        00430000
004400     05  PV-RECORDS-EXTRACTED         PIC  9(09) VALUE  0.        00440000
004500     05  PV-RECORDS-WRITTEN           PIC  9(09) VALUE  0.        00450000
004510     05  PV-SQLCODE                   PIC  S9(04).                00451000
004600     05  PV-MAX-WRKD-UNT-TMST         PIC  X(26).                 00460000
004610     05  PV-SUM-UNT-QTY               PIC  S9(9) COMP.            00461000
004611     05  PV-SUM-CART-QTY              PIC  S9(9) COMP.            00461100
004630     05  PV-SUM-EXTD-RTL-AMT          PIC  S9(9)V9(2) COMP-3.     00463000
004640     05  PV-REFORMAT-TMST.                                        00464000
004650         10 PV-REFORMAT-TMST-DATE.                                00465000
004651            20 PV-REFORMAT-TMST-DTE-CY  PIC X(04) VALUE SPACES.   00465100
004660            20 FILLER                   PIC X(01) VALUE '-'.      00466000
004670            20 PV-REFORMAT-TMST-DTE-MM  PIC X(02) VALUE SPACES.   00467000
004680            20 FILLER                   PIC X(01) VALUE '-'.      00468000
004690            20 PV-REFORMAT-TMST-DTE-DD  PIC X(02) VALUE SPACES.   00469000
004691         10 PV-REFORMAT-TMST-TIME    PIC X(16) VALUE SPACES.      00469100
004700                                                                  00470000
004800 01  PV-ABEND-FIELDS.                                             00480000
004900     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         00490000
005000                                                 COMP SYNC.       00500000
005100     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'PCKUP020'.00510000
005200     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00520000
005300     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    00530000
005400     05  PV-DB2-TABLE-NAME            PIC  X(20) VALUE SPACES.    00540000
005410     05  PV-ABEND-SQL-CDE             PIC  X(4).                  00541000
005500     05  PV-ABEND-PULL-NBR            PIC  9(9).                  00550000
005510     05  PV-ABEND-PULL-LNE-NBR        PIC  9(9).                  00551000
005520     05  PV-ABEND-OPER-UNT-ID         PIC  9(4).                  00552000
005600                                                                  00560000
005700***********************************************************       00570000
005800*  COPYBOOK USED FOR THE RCVR-LNE-DTL-FILE  OUTPUT FILE   *       00580000
005900***********************************************************       00590000
006000     COPY PCWS261.                                                00600000
006100                                                                  00610000
006200***********************************************************       00620000
006300*  USED FOR DB2 ERROR MESSAGE BUILDING                    *       00630000
006400***********************************************************       00640000
006500     COPY DPWS004.                                                00650000
006600                                                                  00660000
006700***********************************************************       00670000
006800*  DB2 SQL COMMUNICATION AREA                             *       00680000
006900***********************************************************       00690000
007000     EXEC SQL                                                     00700000
007100          INCLUDE SQLCA                                           00710000
007200     END-EXEC.                                                    00720000
007300                                                                  00730000
008001***********************************************************       00800100
008002*  PCT_RCVR_LNE_DTL TABLE                                 *       00800200
008003***********************************************************       00800300
008004     EXEC SQL                                                     00800400
008005          INCLUDE PCT00007                                        00800500
008006     END-EXEC.                                                    00800600
008007                                                                  00800700
008094*---------------------------------------------------------------* 00809400
008095*  CURSOR TO SUM RCVR-LNE-DTL RECORDS                           * 00809500
008096*---------------------------------------------------------------* 00809600
008097     EXEC SQL                                                     00809700
008098          DECLARE RCVR_LNE_DTL_CSR CURSOR FOR                     00809800
008099           SELECT  PO_NBR                                         00809900
008100                  ,PO_LNE_NBR                                     00810000
008101                  ,MAX(WRKD_UNT_TMST)                             00810100
008102                  ,OPER_UNT_ID                                    00810200
008103                  ,SHFT_NBR                                       00810300
008104                  ,SUM(UNT_QTY)                                   00810400
008105                  ,SUM(CART_QTY)                                  00810500
008106                  ,SUM(EXTD_RTL_AMT)                              00810600
008107           FROM PCT_RCVR_LNE_DTL                                  00810711
008108           WHERE RCVR_SEQ_NBR = 0                                 00810800
008109             AND ACTN_CDE = 'V'                                   00810900
008110             AND PRCG_AREA_CDE = 'REPLEN'                         00811000
008111           GROUP BY PO_NBR, PO_LNE_NBR, OPER_UNT_ID, SHFT_NBR     00811100
008112     END-EXEC                                                     00811200
008120***************************************************************** 00812000
008200 PROCEDURE DIVISION.                                              00820000
008300***************************************************************** 00830000
008400     DISPLAY '**** BEGINNING PCKUP020 ****'.                      00840000
008500     DISPLAY '****************************************'.          00850000
008600     DISPLAY ' '.                                                 00860000
008700     PERFORM 0100-INITIALIZATION.                                 00870000
008800                                                                  00880000
008820                                                                  00882000
008830     PERFORM 1000-PROCESS-RCVR-LNE-DTL.                           00883000
008895                                                                  00889500
008896* CLOSE OUTPUT FILE                                               00889600
008897                                                                  00889700
008898     CLOSE RCVR-LNE-DTL-FILE.                                     00889810
008900                                                                  00890000
009300     DISPLAY 'NO. OF RCVR REC EXTRACTED==>' PV-RECORDS-EXTRACTED. 00930000
009400     DISPLAY 'NO. OF RCVR REC WRITTEN==>'   PV-RECORDS-WRITTEN.   00940000
009500     DISPLAY ' '.                                                 00950000
009600     DISPLAY '****************************************'.          00960000
009610                                                                  00961000
010100     DISPLAY '****  END OF PCKUP020  ****'.                       01010000
010200                                                                  01020000
010300     STOP RUN.                                                    01030000
010400                                                                  01040000
010500******************************************************************01050000
010600 0100-INITIALIZATION.                                             01060000
010700******************************************************************01070000
010800     MOVE '0100-INITIALIZATION        ' TO PV-ABEND-PARAGRAPH.    01080000
010900                                                                  01090000
011000     OPEN OUTPUT RCVR-LNE-DTL-FILE.                               01100010
011200                                                                  01120000
011210******************************************************************01121000
011300 1000-PROCESS-RCVR-LNE-DTL.                                       01130000
011400******************************************************************01140000
011401                                                                  01140100
011402* OPEN RCVR_LNE_DTL_CSR                                           01140200
011403     PERFORM 0200-OPEN-RCVR-LNE-DTL-CSR.                          01140300
011404                                                                  01140400
011405* FETCH RCVR_LNE_DTL_CSR UNTILL END OF TABLE                      01140500
011406                                                                  01140600
011407     SET PS-NOT-END-OF-RCVR-LNE-DTL-CSR TO TRUE.                  01140700
011408     PERFORM 0300-FETCH-RCVR-LNE-DTL-CSR                          01140800
011409           UNTIL PS-END-OF-RCVR-LNE-DTL-CSR.                      01140900
011410                                                                  01141000
011411* CLOSE RCVR_LNE_DTL_CSR                                          01141100
011412                                                                  01141200
011413     PERFORM 0500-CLOSE-RCVR-LNE-DTL-CSR.                         01141300
011414                                                                  01141400
011432******************************************************************01143200
011433 0200-OPEN-RCVR-LNE-DTL-CSR.                                      01143300
011434******************************************************************01143400
011435                                                                  01143500
011436         EXEC SQL                                                 01143600
011437              OPEN RCVR_LNE_DTL_CSR                               01143700
011440         END-EXEC                                                 01144000
011450                                                                  01145000
011460                                                                  01146000
011470         EVALUATE TRUE                                            01147000
011480             WHEN SQLCODE = ZERO                                  01148000
011490                 CONTINUE                                         01149000
011491             WHEN SQLWARN0 NOT = SPACES                           01149100
011492             WHEN SQLCODE < ZERO                                  01149200
011493             WHEN SQLCODE > ZERO                                  01149300
011494                 MOVE '0200-OPEN-RCVR-LNE-DTL-CSR'                01149400
011495                                          TO PV-ABEND-PARAGRAPH   01149500
011496                 MOVE 'OPEN'              TO PV-ABEND-OPERATION   01149600
011498                 MOVE SQLCODE             TO PV-SQLCODE           01149800
011499                 MOVE 'PCT_RCVR_LNE_DTL'  TO PV-DB2-TABLE-NAME    01149900
011500                 PERFORM 9900-DB2-ABEND                           01150000
011502         END-EVALUATE.                                            01150200
011503                                                                  01150300
011504******************************************************************01150400
011506 0300-FETCH-RCVR-LNE-DTL-CSR.                                     01150600
011507******************************************************************01150700
011509                                                                  01150900
011510     INITIALIZE DCLPCT00007                                       01151000
011511                PV-MAX-WRKD-UNT-TMST                              01151100
011512                PV-SUM-UNT-QTY                                    01151200
011513                PV-SUM-CART-QTY                                   01151300
011514                PV-SUM-EXTD-RTL-AMT.                              01151400
011515                                                                  01151500
011516     EXEC SQL                                                     01151600
011517        FETCH RCVR_LNE_DTL_CSR                                    01151700
011518        INTO   :PCT00007-PO-NBR                                   01151800
011519              ,:PCT00007-PO-LNE-NBR                               01151900
011520              ,:PV-MAX-WRKD-UNT-TMST                              01152000
011521              ,:PCT00007-OPER-UNT-ID                              01152100
011522              ,:PCT00007-SHFT-NBR                                 01152200
011523              ,:PV-SUM-UNT-QTY                                    01152300
011524              ,:PV-SUM-CART-QTY                                   01152400
011525              ,:PV-SUM-EXTD-RTL-AMT                               01152500
011526     END-EXEC.                                                    01152600
011527                                                                  01152700
011528     EVALUATE TRUE                                                01152800
011529       WHEN SQLCODE = ZEROS                                       01152900
011530            ADD 1 TO PV-RECORDS-EXTRACTED                         01153000
011531       WHEN SQLCODE = +100                                        01153100
011532                SET PS-END-OF-RCVR-LNE-DTL-CSR TO TRUE            01153200
011533       WHEN OTHER                                                 01153300
011534             MOVE '0300-FETCH-RCVR-LNE-DTL-CSR'                   01153400
011535                                          TO PV-ABEND-PARAGRAPH   01153500
011536             MOVE 'FETCH'                 TO PV-ABEND-OPERATION   01153600
011537             MOVE SQLCODE                 TO PV-SQLCODE           01153700
011538             MOVE 'PCT_RCVR_LNE_DTL'      TO PV-DB2-TABLE-NAME    01153800
011539             MOVE PCT00007-PO-NBR         TO PV-ABEND-PULL-NBR    01153900
011540             MOVE PCT00007-PO-LNE-NBR     TO PV-ABEND-PULL-LNE-NBR01154000
011541             MOVE PCT00007-OPER-UNT-ID    TO PV-ABEND-OPER-UNT-ID 01154100
011542             PERFORM 9900-DB2-ABEND                               01154200
011545     END-EVALUATE.                                                01154500
011546                                                                  01154600
011547     IF PS-NOT-END-OF-RCVR-LNE-DTL-CSR                            01154700
011548        PERFORM 0400-WRITE-RCVR-LNE-DTL-FILE                      01154800
011553     END-IF.                                                      01155300
011554                                                                  01155400
020500******************************************************************02050000
020600 0400-WRITE-RCVR-LNE-DTL-FILE.                                    02060000
020700******************************************************************02070000
020710                                                                  02071000
020721     INITIALIZE PC261-RCVR-LNE-RECORD.                            02072100
020722                                                                  02072200
020725     MOVE PV-MAX-WRKD-UNT-TMST          TO PV-REFORMAT-TMST.      02072500
020730     MOVE PCT00007-PO-NBR               TO PC261-PO-NBR.          02073000
020731     MOVE +0                            TO PC261-RCVR-SEQ-NBR.    02073100
020732     MOVE PCT00007-PO-LNE-NBR           TO PC261-PO-LNE-NBR.      02073200
020733     MOVE 'W'                           TO PC261-ACTN-CDE.        02073300
020734     MOVE PV-REFORMAT-TMST              TO PC261-WRKD-UNT-TMST.   02073400
020735     MOVE PV-REFORMAT-TMST-DATE         TO PC261-BUS-DTE.         02073500
020736     MOVE PCT00007-OPER-UNT-ID          TO PC261-OPER-UNT-ID.     02073600
020737     MOVE PCT00007-SHFT-NBR             TO PC261-SHFT-NBR.        02073700
020738     MOVE PV-SUM-UNT-QTY                TO PC261-UNT-QTY.         02073800
020739     MOVE PV-SUM-CART-QTY               TO PC261-CART-QTY.        02073900
020740     MOVE 'REPLEN'                      TO PC261-PRCG-AREA-CDE.   02074000
020741     MOVE PV-SUM-EXTD-RTL-AMT           TO PC261-EXTD-RTL-AMT.    02074100
020742                                                                  02074200
020743     WRITE RCVR-LNE-DTL-RECORD FROM PC261-RCVR-LNE-RECORD.        02074300
020744                                                                  02074400
020745     ADD 1 TO PV-RECORDS-WRITTEN.                                 02074500
020746                                                                  02074600
020747******************************************************************02074700
020748 0500-CLOSE-RCVR-LNE-DTL-CSR.                                     02074800
020749******************************************************************02074900
020750                                                                  02075000
020751         EXEC SQL                                                 02075100
020752             CLOSE RCVR_LNE_DTL_CSR                               02075200
020753         END-EXEC                                                 02075300
020754                                                                  02075400
020755         EVALUATE TRUE                                            02075500
020756             WHEN SQLCODE = ZERO                                  02075600
020757                 CONTINUE                                         02075700
020758             WHEN SQLWARN0 NOT = SPACES                           02075800
020759             WHEN SQLCODE < ZERO                                  02075900
020760             WHEN SQLCODE > ZERO                                  02076000
020761             MOVE '0500-CLOSE-RCVR-LNE-DTL-CSR'                   02076100
020762                                          TO PV-ABEND-PARAGRAPH   02076200
020763             MOVE 'CLOSE'                 TO PV-ABEND-OPERATION   02076300
020764             MOVE SQLCODE                 TO PV-SQLCODE           02076400
020765             MOVE 'PCT_RCVR_LNE_DTL'      TO PV-DB2-TABLE-NAME    02076500
020766             PERFORM 9900-DB2-ABEND                               02076600
020767         END-EVALUATE.                                            02076700
020768                                                                  02076800
020882******************************************************************02088200
020883 9900-DB2-ABEND.                                                  02088300
020884******************************************************************02088400
020890*    MOVE '9900-DB2-ABEND             ' TO PV-ABEND-PARAGRAPH.    02089000
020900                                                                  02090000
021000     DISPLAY '*** DB2 ERROR '.                                    02100000
021100     DISPLAY '*** SQLCODE       = ' PV-SQLCODE.                   02110000
021110     DISPLAY '*** OPERATION     = ' PV-ABEND-OPERATION.           02111000
021200     DISPLAY '*** PROGRAM       = ' PV-ABEND-PROGRAM.             02120000
021300     DISPLAY '*** PARAGRAPH     = ' PV-ABEND-PARAGRAPH.           02130000
021400     DISPLAY '*** TABLE NAME    = ' PV-DB2-TABLE-NAME.            02140000
021500     DISPLAY '*** PULL NUMBER   = ' PV-ABEND-PULL-NBR.            02150000
021510     DISPLAY '*** PULL LINE NUM = ' PV-ABEND-PULL-LNE-NBR.        02151000
021520     DISPLAY '*** OPER UNIT ID  = ' PV-ABEND-OPER-UNT-ID.         02152000
021600                                                                  02160000
021700     COPY DPPD004.                                                02170000
021800                                                                  02180000
021900     MOVE +4013 TO PV-ABEND-CODE.                                 02190000
022000     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02200000
