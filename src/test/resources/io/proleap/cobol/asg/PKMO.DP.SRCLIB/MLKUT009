       IDENTIFICATION DIVISION.                                                 
                                                                                
       PROGRAM-ID.    MLKUT009                                                  
       AUTHOR.        SCOTT JACKSON.                                            
       INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
       DATE-WRITTEN.  03-20-98.                                                 
       DATE-COMPILED.                                                           
                                                                                
      ******************************************************************        
      *  CHANGE HISTORY                                                         
      *                                                                         
      *  2012-06-03 : RONNA MCDONALD.  MOVE THE 'COPY' STATEMENT                
      *                                OVER FROM POSITION 7 TO 12               
      *                                THEN RECOMPILED                          
      ******************************************************************        
      * THIS PROGRAM WILL SUM THE COST AND RETAIL AMOUNTS ON A FILE             
      * OF TRANSACTIONS IN KDM2810 (MTD PURCHASE FILE) FORMAT.                  
      ******************************************************************        
       ENVIRONMENT DIVISION.                                                    
                                                                                
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER.        IBM-3090.                                        
       OBJECT-COMPUTER.        IBM-3090.                                        
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
           SELECT EXTRACT-FILE            ASSIGN TO INP01.                      
      *    SELECT SUMMED-RECORD           ASSIGN TO OUT01.                      
      *                                                                         
      *                                                                         
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *                                                                         
       FD  EXTRACT-FILE                                                         
           RECORDING  MODE IS F.                                                
       01  EXTRACT-DATA-RECORD            PIC X(100).                           
      *                                                                         
      *FD  SUMMED-RECORD                                                        
      *    RECORDING  MODE IS F.                                                
      *01  OUTPUT-RECORD                  PIC X(100).                           
      *                                                                         
      *                                                                         
       WORKING-STORAGE SECTION.                                                 
      *                                                                         
       01 PS-MORE-DATA-RECORDS-SW         PIC X     VALUE 'N'.                  
          88 PS-END-OF-DATA                         VALUE 'Y'.                  
      *                                                                         
       01 HOLD-RECORD.                                                          
           05  HR-TRAN-CODE           PIC X(02)    VALUE SPACES.                
           05  FILLER                 PIC X(46)    VALUE SPACES.                
           05  HR-MERCH-AMT    PIC S9(5)V99 COMP-3  VALUE ZEROES.               
           05  HR-DISC-AMT     PIC S9(5)V99 COMP-3  VALUE ZEROES.               
           05  HR-FREIGHT-AMT  PIC S9(5)V99 COMP-3  VALUE ZEROES.               
           05  HR-NET-COST-AMT PIC S9(5)V99 COMP-3  VALUE ZEROES.               
           05  HR-RETAIL-AMT   PIC S9(5)V99 COMP-3  VALUE ZEROES.               
           05  FILLER                 PIC X(32)    VALUE SPACES.                
       01 PRINT-RECORD.                                                         
           05  PR-TRAN-CODE           PIC X(02)    VALUE SPACES.                
           05  FILLER                 PIC X(46)    VALUE SPACES.                
           05  PR-MERCH-AMT           PIC -ZZZZZZZZZ9.99 VALUE ZEROES.          
           05  FILLER                 PIC X(03)    VALUE SPACES.                
           05  PR-DISC-AMT            PIC -ZZZZZZZZZ9.99 VALUE ZEROES.          
           05  FILLER                 PIC X(03)    VALUE SPACES.                
           05  PR-FREIGHT-AMT         PIC -ZZZZZZZZZ9.99 VALUE ZEROES.          
           05  FILLER                 PIC X(03)    VALUE SPACES.                
           05  PR-NET-COST-AMT        PIC -ZZZZZZZZZ9.99 VALUE ZEROES.          
           05  FILLER                 PIC X(03)    VALUE SPACES.                
           05  PR-RETAIL-AMT          PIC -ZZZZZZZZZ9.99 VALUE ZEROES.          
           05  FILLER                 PIC X(73)    VALUE SPACES.                
       01  PA-PROGRAM-ACCUMULATOR.                                              
      ****  PA-PURCHASE                                                         
           05  PA-10-MERCH-AMT         PIC S9(10)V99   VALUE ZEROES.            
           05  PA-10-MERCH-AMT-DISP    PIC -ZZZZZZZZZ9.99 VALUE ZEROES.         
           05  PA-10-DISC-AMT          PIC S9(10)V99   VALUE ZEROES.            
           05  PA-10-DISC-AMT-DISP     PIC -ZZZZZZZZZ9.99 VALUE ZEROES.         
           05  PA-10-FREIGHT-AMT       PIC S9(10)V99   VALUE ZEROES.            
           05  PA-10-FREIGHT-AMT-DISP  PIC -ZZZZZZZZZ9.99 VALUE ZEROES.         
           05  PA-10-NET-COST-AMT      PIC S9(10)V99   VALUE ZEROES.            
           05  PA-10-NET-COST-AMT-DISP PIC -ZZZZZZZZZ9.99 VALUE ZEROES.         
           05  PA-10-RETAIL-AMT        PIC S9(10)V99   VALUE ZEROES.            
           05  PA-10-RETAIL-AMT-DISP   PIC -ZZZZZZZZZ9.99 VALUE ZEROES.         
      ****  PA-TRANSFER-FROM                                                    
           05  PA-30-RETAIL-TOTAL    PIC S9(10)V99 VALUE ZEROES.                
           05  PA-30-RETAIL-TOTAL-DISP PIC -ZZZZZZZZZ9.99 VALUE ZEROES.         
      ****  PA-TRANSFER-TO.                                                     
           05  PA-31-RETAIL-TOTAL    PIC S9(10)V99 VALUE ZEROES.                
           05  PA-31-RETAIL-TOTAL-DISP PIC -ZZZZZZZZZ9.99 VALUE ZEROES.         
      ****  PA-MARKDOWN.                                                        
           05  PA-40-RETAIL-AMT      PIC S9(10)V99  VALUE ZEROES.               
           05  PA-40-RETAIL-AMT-DISP PIC -ZZZZZZZZZ9.99 VALUE ZEROES.           
      ****  PA-MARKON.                                                          
           05  PA-50-RETAIL-AMT      PIC S9(10)V99   VALUE ZEROES.              
           05  PA-50-RETAIL-AMT-DISP PIC -ZZZZZZZZZ9.99 VALUE ZEROES.           
      ****  PA-ADJ.                                                             
           05  PA-80-AT-RETAIL       PIC S9(10)V99   VALUE ZEROES.              
           05  PA-80-AT-RETAIL-DISP  PIC -ZZZZZZZZZ9.99 VALUE ZEROES.           
                                                                                
       01 DISPLAY-LINES                   PIC X(100)   VALUE SPACES.            
       01 RECORD-COUNT                    PIC 9(12)   VALUE ZEROES.             
       01 MARKDOWN-NUMERIC                PIC 9(04)   VALUE ZEROES.             
      *                                                                         
      *****************************************************************         
      *  OUTPUT RECORD FORMAT                                         *         
      *****************************************************************         
           COPY MLWS051.                                                        
      *                                                                         
       PROCEDURE DIVISION.                                                      
      *                                                                         
           OPEN INPUT  EXTRACT-FILE.                                            
      *         OUTPUT SUMMED-RECORD.                                           
      *                                                                         
           INITIALIZE HOLD-RECORD.                                              
           PERFORM 4100-READ-EDIT-FILE.                                         
      *                                                                         
      *    DISPLAY '          MERCH-AMT ', 'DISC-AMT ' , 'FREIGHT-AMT ',        
      *            'NETCOST-AMT ', 'RETAIL-AMT'.                                
      *                                                                         
           PERFORM 2100-PROCESS-PURCHASE-RECORD                                 
               UNTIL PS-END-OF-DATA.                                            
      *                                                                         
      *    MOVE 'PURCHASE RECORD SUMMED FIELDS' TO DISPLAY-LINES.               
      *    WRITE OUTPUT-RECORD FROM DISPLAY-LINES.                              
      *    MOVE 'CODE  MERCH-AMT     DISC-AMT    FREIGHT       NET-COST'        
      *                                         TO DISPLAY-LINES.               
      *    WRITE OUTPUT-RECORD FROM DISPLAY-LINES.                              
           MOVE PA-10-MERCH-AMT        TO PA-10-MERCH-AMT-DISP                  
           MOVE PA-10-DISC-AMT         TO PA-10-DISC-AMT-DISP                   
           MOVE PA-10-FREIGHT-AMT      TO PA-10-FREIGHT-AMT-DISP                
           MOVE PA-10-NET-COST-AMT     TO PA-10-NET-COST-AMT-DISP               
           MOVE PA-10-RETAIL-AMT       TO PA-10-RETAIL-AMT-DISP                 
           MOVE PA-30-RETAIL-TOTAL     TO PA-30-RETAIL-TOTAL-DISP               
           MOVE PA-31-RETAIL-TOTAL     TO PA-31-RETAIL-TOTAL-DISP               
           MOVE PA-40-RETAIL-AMT       TO PA-40-RETAIL-AMT-DISP                 
           MOVE PA-50-RETAIL-AMT       TO PA-50-RETAIL-AMT-DISP                 
           DISPLAY 'RECORDS PROCESSED  ', RECORD-COUNT                          
           DISPLAY '                                           '                
           DISPLAY 'PURCHASE MERCH-AMT ', PA-10-MERCH-AMT-DISP                  
           DISPLAY 'PURCHASE DISCT-AMT ', PA-10-DISC-AMT-DISP                   
           DISPLAY 'PURCHASE FRGHT-AMT ', PA-10-FREIGHT-AMT-DISP                
           DISPLAY 'PURCHASE NCOST-AMT ', PA-10-NET-COST-AMT-DISP               
           DISPLAY 'PURCHASE RTAIL-AMT ', PA-10-RETAIL-AMT-DISP                 
           DISPLAY '                                           '                
           DISPLAY 'TRANS FROM RETAIL  ', PA-30-RETAIL-TOTAL-DISP               
           DISPLAY '                                           '                
           DISPLAY 'TRANS  TO  RETAIL  ', PA-31-RETAIL-TOTAL-DISP               
           DISPLAY '                                           '                
           DISPLAY 'MARKDOWN-RETAIL    ',  PA-40-RETAIL-AMT-DISP                
           DISPLAY '                                           '                
           DISPLAY 'MARKON RETAIL      ',  PA-50-RETAIL-AMT-DISP.               
     **    MOVE PA-MERCH-AMT            TO PR-MERCH-AMT.                        
      *    MOVE PA-FREIGHT-AMT          TO PR-FREIGHT-AMT.                      
      *    MOVE PA-DISC-AMT             TO PR-DISC-AMT.                         
      *    MOVE PA-NET-COST-AMT         TO PR-NET-COST-AMT.                     
      *    MOVE PA-RETAIL-AMT           TO PR-RETAIL-AMT.                       
      *                                                                         
      *    PERFORM 5000-WRITE-OUTPUT-RECORD.                                    
      *                                                                         
           CLOSE EXTRACT-FILE.                                                  
      *          SUMMED-RECORD.                                                 
           STOP RUN.                                                            
      *                                                                         
      *                                                                         
      ******************************************************************        
      *  MOVE PURCHASE RECORD TO INPUT & FORMATTED OUTPUT LAYOUT                
      ******************************************************************        
      *                                                                         
       2100-PROCESS-PURCHASE-RECORD.                                    MLKUP002
      *                                                                         
      *    EVALUATE HR-TRAN-CODE                                                
           IF HR-TRAN-CODE = '10'                                               
               MOVE HOLD-RECORD           TO D090-PURCH-JRNL                    
               ADD D090-MERCH-AMT         TO PA-10-MERCH-AMT                    
               ADD D090-DISC-AMT          TO PA-10-DISC-AMT                     
               ADD D090-FREIGHT-AMT       TO PA-10-FREIGHT-AMT                  
               ADD D090-NET-COST-AMT      TO PA-10-NET-COST-AMT                 
               ADD D090-RETAIL-AMT        TO PA-10-RETAIL-AMT                   
           END-IF                                                               
           IF HR-TRAN-CODE = '30'                                               
               MOVE HOLD-RECORD           TO D090-TRANSFER-FROM-REC             
               COMPUTE PA-30-RETAIL-TOTAL = PA-30-RETAIL-TOTAL +                
                  (D090-TRANS-UNITS * D090-RETAIL-PER-UN)                       
           END-IF                                                               
           IF HR-TRAN-CODE = '31'                                               
               MOVE HOLD-RECORD           TO D090-TRANSFER-TO-REC               
               COMPUTE PA-31-RETAIL-TOTAL = PA-31-RETAIL-TOTAL +                
                  (D090-UNITS-TRANSFER * D090-RETAIL-PER)                       
           END-IF                                                               
           IF HR-TRAN-CODE = '40'                                               
               MOVE HOLD-RECORD           TO D090-MKDWN-REC                     
               MOVE D090-MKDWN-QTY        TO MARKDOWN-NUMERIC                   
               COMPUTE PA-40-RETAIL-AMT  = PA-40-RETAIL-AMT +                   
               ((D090-MKDWN-OPRICE - D090-MKDWN-NPRICE) *                       
                (MARKDOWN-NUMERIC))                                             
           END-IF                                                               
           IF HR-TRAN-CODE = '50'                                               
               MOVE HOLD-RECORD           TO D090-MARKON                        
               COMPUTE PA-50-RETAIL-AMT  = PA-50-RETAIL-AMT +                   
               ((D090-NEW-PRICE - D090-OLD-PRICE) * (D090-MKON-QTY))            
           END-IF.                                                              
      *    WHEN '80'                                                            
      *        MOVE HOLD-RECORD           TO D090-ADJ-REC.                      
      *        05  PA-80-AT-RETAIL    PIC S9(10)V99   VALUE ZEROES.             
      *                                   TO PA-80-AT-RETAIL.                   
      *                                   TO PA-80-AT-COST.                     
      *    ADD  HR-MERCH-AMT          TO PA-MERCH-AMT.                          
      *    ADD  HR-DISC-AMT           TO PA-DISC-AMT.                           
      *    ADD  HR-FREIGHT-AMT        TO PA-FREIGHT-AMT.                        
      *    ADD  HR-NET-COST-AMT       TO PA-NET-COST-AMT.                       
      *    ADD  HR-RETAIL-AMT         TO PA-RETAIL-AMT.                         
           PERFORM 4100-READ-EDIT-FILE.                                         
                                                                                
      *                                                                         
      ***************************************************************           
      * READ A RECORD FROM THE WEEKLY EDIT INPUT FILE                           
      ******************************************************************        
       4100-READ-EDIT-FILE.                                                     
      *                                                                         
           READ EXTRACT-FILE INTO HOLD-RECORD                                   
                 AT END MOVE 'Y' TO PS-MORE-DATA-RECORDS-SW.                    
      *                                                                         
           IF PS-END-OF-DATA                                                    
               CONTINUE                                                         
           ELSE                                                                 
               ADD 1      TO RECORD-COUNT.                                      
      *                                                                         
      ******************************************************************        
      * 5000-WRITE-OUTPUT-RECORD  AND ACCUMULATE OUTPUT COUNTS                  
      ******************************************************************        
      *                                                                         
      *5000-WRITE-OUTPUT-RECORD.                                                
      *                                                                         
      *     DISPLAY PRINT-RECORD.                                               
      *     WRITE OUTPUT-RECORD FROM PRINT-RECORD.                              
