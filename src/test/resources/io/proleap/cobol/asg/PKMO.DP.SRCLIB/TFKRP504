      ******************************************************************00010018
       IDENTIFICATION DIVISION.                                         00020018
      ******************************************************************00030018
                                                                        00040018
       PROGRAM-ID.             TFKRP504.                                00050018
       AUTHOR.                 JACK KRAMER.                             00060018
       INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070018
       DATE-WRITTEN            APRIL 1998.                              00080018
       DATE-COMPILED.                                                   00090018
                                                                        00100018
      ******************************************************************00110018
      *   THIS PROGRAM PRODUCES A REPORT OF TRANSFERS RECEIVED AT RTV   00120018
      *  LOCATIONS DURING THE PREVIOUS FISCAL PERIOD. THE REPORT IS     00130018
      *  SORTED BY STORE WITHIN DISTRICT WITHIN RTV LOCATION WITH       00140018
      *  TOTALS FOR DISTRICT AND COMPANY FOR EACH RTV.                  00150018
      *  THE REPORT SHOWS NUMBER OF TRANSFERS RECEIVED, NUMBER OF       00160018
      *  TRASNFERS WITH DISCREPANCIES, AND VARIANCE PERCENT; NUMBER OF  00170018
      *  UNITS RECEIVED, NUMBER OF UNITS VARIANCE, AND VARIANCE PERCENT;00180018
      *  AND DOLLARS RECEIVED, DOLLARS VARIANCE, AND VARIANCE PERCENT.  00190018
      ******************************************************************00200018
100404** 10/04/2004 CHANGED BY: RAY GRAF                                00201018
100404**     EXPAND STORE NUMBER. MAKE DOMAIN COMPLIANT.                00202018
010209** 01/02/2009 CHANGED BY: DAVE WELLER                             00202121
010209**     EXPAND DISTRICT NUMBER.                                    00202221
      ***************************************************************** 00203018
                                                                        00210018
      ******************************************************************00220018
       ENVIRONMENT DIVISION.                                            00230018
      ******************************************************************00240018
                                                                        00250018
       CONFIGURATION SECTION.                                           00260018
                                                                        00270018
       SOURCE-COMPUTER.        IBM-3090.                                00280018
       OBJECT-COMPUTER.        IBM-3090.                                00290018
                                                                        00300018
       INPUT-OUTPUT SECTION.                                            00310018
                                                                        00320018
       FILE-CONTROL.                                                    00330018
                                                                        00340018
           SELECT TRANSFER-REPORT-FILE                                  00350018
               ASSIGN TO RPT01.                                         00360018
                                                                        00370018
           SELECT PROCESS-DATES-FILE                                    00380018
               ASSIGN TO INP01.                                         00390018
                                                                        00400018
           SELECT RTV-XFER-FILE                                         00410018
               ASSIGN TO INP02.                                         00420018
      *                                                                 00430018
      ******************************************************************00440018
       DATA DIVISION.                                                   00450018
      ******************************************************************00460018
                                                                        00470018
       FILE SECTION.                                                    00480018
                                                                        00490018
       FD  TRANSFER-REPORT-FILE                                         00500018
           LABEL RECORDS ARE STANDARD                                   00510018
           RECORDING MODE IS F                                          00520018
           BLOCK CONTAINS 0 RECORDS                                     00530018
           RECORD CONTAINS 132 CHARACTERS                               00540018
           DATA RECORD IS TRANSFER-REPORT-RECORD.                       00550018
                                                                        00560018
       01  TRANSFER-REPORT-RECORD PIC X(132).                           00570018
                                                                        00580018
       FD  PROCESS-DATES-FILE                                           00590018
           LABEL RECORDS ARE STANDARD                                   00600018
           RECORDING MODE IS F                                          00610018
           BLOCK CONTAINS 0 RECORDS                                     00620018
           RECORD CONTAINS 16 CHARACTERS.                               00630018
                                                                        00640018
       01  PROCESS-DATES-RECORD            PIC X(16).                   00650018
                                                                        00660018
       FD  RTV-XFER-FILE                                                00670018
           LABEL RECORDS ARE STANDARD                                   00680018
           RECORDING MODE IS F                                          00690018
           BLOCK CONTAINS 0 RECORDS                                     00700018
           RECORD CONTAINS 60 CHARACTERS                                00710018
           DATA RECORD IS RTV-XFER-RECORD.                              00720018
                                                                        00730018
       01  RTV-XFER-RECORD                 PIC X(60).                   00740018
      *                                                                 00750018
       WORKING-STORAGE SECTION.                                         00760018
                                                                        00770018
      *                                                                 00780018
      *  STANDARD REPORT HEADER FOR A 132 COLUMN REPORT                 00790018
           COPY DPWS132O.                                               00800018
      *                                                                 00810018
      *----------------------------------------------------------------*00820018
      *  DATE VALIDATION CALLING PARAMETER LIST                        *00830018
      *----------------------------------------------------------------*00840018
           COPY DPWS500.                                                00850018
      *                                                                 00860018
      *----------------------------------------------------------------*00870018
      *  RECORD LAYOUT FOR THE PROCESS DATES FILE                       00880018
      *----------------------------------------------------------------*00890018
           COPY TFRD029.                                                00900018
      *                                                                 00910018
      *----------------------------------------------------------------*00920018
      *  RECORD LAYOUT FOR THE RTV TRANSFER DISCREPANCY FILE            00930018
      *----------------------------------------------------------------*00940018
           COPY TFRD043.                                                00950018
      *                                                                 00960018
           EJECT                                                        00970018
      *                                                                 00980018
       01  ABEND-CODE                  PIC S9(4)    VALUE ZERO          00990018
                                       COMP SYNC.                       01000018
                                                                        01010018
       01  PS-PROGRAM-SWITCHES.                                         01020018
           05  PS-FIRST-TIME-SW        PIC X(01)    VALUE 'Y'.          01030018
               88  PS-FIRST-TIME                    VALUE 'Y'.          01040018
               88  PS-NOT-FIRST-TIME                VALUE 'N'.          01050018
           05  PS-ITEMS-READ-SW        PIC  X(01)   VALUE 'N'.          01060018
               88  PS-ITEMS-READ                    VALUE 'Y'.          01070018
               88  PS-NO-ITEMS-READ                 VALUE 'N'.          01080018
           05  PS-END-OF-DATA-SW       PIC  X(01)   VALUE 'N'.          01090018
               88  PS-END-OF-DATA                   VALUE 'Y'.          01100018
               88  PS-NOT-END-OF-DATA               VALUE 'N'.          01110018
                                                                        01120018
       01  PC-PROGRAM-CONSTANTS.                                        01130018
           05  PC-PROGRAM-NAME         PIC X(08)    VALUE 'TFKRP504'.   01140018
           05  PC-DIST-LITERAL           PIC  X(04)  VALUE 'DIST'.      01150018
           05  PC-TOTAL-LITERAL          PIC  X(05)  VALUE 'TOTAL'.     01160018
           05  PC-RTV-LITERAL            PIC  X(07)  VALUE 'RTV'.       01170018
           05  PC-GRAND-LITERAL          PIC  X(07)  VALUE 'GRAND'.     01180018
           05  PC-PAGE-MAX               PIC  S9(03) VALUE  +60.        01190018
           05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3      01200018
                                                           COMP-3.      01210018
                                                                        01220018
       01  PV-PROGRAM-VARIABLES.                                        01230018
           05  PV-RETRY-COUNT          PIC S9(4)    VALUE ZERO          01240018
                                       COMP SYNC.                       01250018
           05  PV-PAGE-COUNT           PIC 9(5)    VALUE ZERO.          01260018
           05  PV-LINE-COUNT           PIC S9(4)   VALUE +90.           01270018
           05  PV-DATE.                                                 01280018
               10  PV-MONTH            PIC 9(02).                       01290018
               10  FILLER              PIC X(01)   VALUE '/'.           01300018
               10  PV-DAY              PIC 9(02).                       01310018
               10  FILLER              PIC X(01)   VALUE '/'.           01320018
               10  PV-CENTURY          PIC 9(02).                       01330018
               10  PV-YEAR             PIC 9(02).                       01340018
           05  PV-POINTER              PIC S9(03)  VALUE +0 COMP-3.     01350018
           05  PV-CHARACTER-COUNT      PIC S9(03)  VALUE +0 COMP-3.     01360018
           05  PV-PARAGRAPH-NAME       PIC X(30)   VALUE SPACE.         01370018
           05  PV-DB2-OPERATION        PIC X(30)   VALUE SPACE.         01380018
           05  PV-TYPE-DESC            PIC X(50)   VALUE SPACE.         01390018
           05  PV-VARIANCE           PIC S9(05)V9999 VALUE ZERO COMP-3. 01400018
           05  PV-DIST-XFERS           PIC S9(06)    VALUE ZERO COMP-3. 01410018
           05  PV-DIST-UNITS           PIC S9(08)    VALUE ZERO COMP-3. 01420018
           05  PV-DIST-DOLLARS-RCVD    PIC S9(09)V99 VALUE ZERO COMP-3. 01430018
           05  PV-DIST-DOLLARS-XFER    PIC S9(09)V99 VALUE ZERO COMP-3. 01431018
           05  PV-DIST-DSCP-XFERS      PIC S9(06)    VALUE ZERO COMP-3. 01440018
           05  PV-DIST-DSCP-UNITS      PIC S9(08)    VALUE ZERO COMP-3. 01450018
           05  PV-COMP-XFERS           PIC S9(06)    VALUE ZERO COMP-3. 01470018
           05  PV-COMP-UNITS           PIC S9(08)    VALUE ZERO COMP-3. 01480018
           05  PV-COMP-DOLLARS-RCVD    PIC S9(09)V99 VALUE ZERO COMP-3. 01490018
           05  PV-COMP-DOLLARS-XFER    PIC S9(09)V99 VALUE ZERO COMP-3. 01491018
           05  PV-COMP-DSCP-XFERS      PIC S9(06)    VALUE ZERO COMP-3. 01500018
           05  PV-COMP-DSCP-UNITS      PIC S9(08)    VALUE ZERO COMP-3. 01510018
           05  PV-WORK-DOLLARS         PIC S9(09)V99 VALUE ZERO COMP-3. 01520018
       01  HV-HOLD-VARIABLES.                                           01530018
           05  HV-DISTRICT-NMBR        PIC X(04)    VALUE SPACE.        01540021
           05  HV-RTV-NBR              PIC 9(04)    VALUE ZERO.         01550018
                                                                        01560018
       01  BLANK-LINE                  PIC X(132)   VALUE SPACES.       01570018
                                                                        01580018
       01  END-OF-REPORT-LINE.                                          01590018
           05  FILLER                  PIC X(52)    VALUE SPACES.       01600018
           05  FILLER                  PIC X(26)    VALUE               01610018
               '   *** END OF REPORT ***'.                              01620018
           05  FILLER                  PIC X(54)    VALUE SPACES.       01630018
                                                                        01640018
       01  NO-DATA-LINE.                                                01650018
           05  FILLER                  PIC X(35)    VALUE SPACES.       01660018
           05  FILLER                  PIC X(45)    VALUE               01670018
               '****  NO DATA TO PROCESS FOR THIS REPORT  ***'.         01680018
                                                                        01690018
       01  CD-CURRENT-DATE.                                             01700018
           05  CD-CURRENT-YEAR         PIC 9(2)     VALUE ZERO.         01710018
           05  CD-CURRENT-MONTH        PIC 9(2)     VALUE ZERO.         01720018
           05  CD-CURRENT-DAY          PIC 9(2)     VALUE ZERO.         01730018
                                                                        01740018
       01  CT-CURRENT-TIME.                                             01750018
           05  CT-CURRENT-HOUR         PIC 9(2)     VALUE ZERO.         01760018
           05  CT-CURRENT-MINUTE       PIC 9(2)     VALUE ZERO.         01770018
           05  FILLER                  PIC 9(4)     VALUE ZERO.         01780018
                                                                        01790018
       01  HL2-HEADING-LINE-2.                                          01800018
           05  FILLER                  PIC X(39)  VALUE SPACE.          01810018
           05  HL2-TITLE               PIC X(93)    VALUE               01820018
             'TRANSFER DISCREPANCY REPORT - TRANSFERS RECEIVED BY RTV'. 01830018
                                                                        01840018
       01  HL3-HEADING-LINE-3.                                          01850018
           05  FILLER                  PIC X(01)    VALUE SPACES.       01860018
100404*    05  HL3-RTV-NBR             PIC 9(03)    VALUE ZERO.         01870019
100404     05  HL3-RTV-NBR             PIC 9(04)    VALUE ZERO.         01871019
           05  FILLER                  PIC X(01)    VALUE SPACES.       01880018
           05  HL3-RTV-NAME            PIC X(30)    VALUE SPACES.       01890018
           05  FILLER                  PIC X(14)    VALUE SPACES.       01900018
           05  FILLER                  PIC X(11)    VALUE               01910018
               'FOR PERIOD'.                                            01920018
           05  HL3-FROM-DATE           PIC X(10)  VALUE SPACES.         01930018
           05  FILLER                  PIC X(04)  VALUE ' TO '.         01940018
           05  HL3-TO-DATE             PIC X(10)  VALUE SPACES.         01950018
                                                                        01960018
       01  HL4-HEADING-LINE-4.                                          01970018
           05  FILLER                  PIC X(18)  VALUE SPACE.          01980018
           05  FILLER                  PIC X(09)  VALUE                 01990018
                                       'NUMBER'.                        02000018
           05  FILLER                  PIC X(10)  VALUE                 02010018
                                       'TRNSFRS'.                       02020018
           05  FILLER                  PIC X(14)  VALUE                 02030018
                                       'TRNSFRS'.                       02040018
           05  FILLER                  PIC X(11)  VALUE                 02050018
                                       'NUMBER'.                        02060018
           05  FILLER                  PIC X(10)  VALUE                 02070018
                                       'NUMBER'.                        02080018
           05  FILLER                  PIC X(45)  VALUE                 02090018
                                       'UNITS'.                         02100018
           05  FILLER                  PIC X(08)  VALUE                 02101018
                                       'NET'.                           02102018
           05  FILLER                  PIC X(08)  VALUE                 02110018
                                       'DOLLARS'.                       02120018
                                                                        02130018
       01  HL5-HEADING-LINE-5.                                          02140018
           05  FILLER                  PIC X(18)  VALUE                 02150018
                                       '---- STORE ----'.               02160018
           05  FILLER                  PIC X(11)  VALUE                 02170018
                                       'TRNSFRS'.                       02180018
           05  FILLER                  PIC X(07)  VALUE                 02190018
                                       'WITH'.                          02200018
           05  FILLER                  PIC X(16)  VALUE                 02210018
                                       'VARIANCE'.                      02220018
           05  FILLER                  PIC X(11)  VALUE                 02230018
                                       'UNITS'.                         02240018
           05  FILLER                  PIC X(07)  VALUE                 02250018
                                       'UNITS'.                         02260018
           05  FILLER                  PIC X(15)  VALUE                 02270018
                                       'VARIANCE'.                      02280018
           05  FILLER                  PIC X(16)  VALUE                 02290018
                                       'DOLLARS'.                       02300018
           05  FILLER                  PIC X(14)  VALUE                 02301018
                                       'DOLLARS'.                       02302018
           05  FILLER                  PIC X(09)  VALUE                 02310018
                                       'DOLLARS'.                       02320018
           05  FILLER                  PIC X(08)  VALUE                 02330018
                                       'VARIANCE'.                      02340018
                                                                        02350018
       01  HL6-HEADING-LINE-6.                                          02360018
           05  FILLER                  PIC X(19)  VALUE                 02370018
                                       'NBR     NAME   '.               02380018
           05  FILLER                  PIC X(08)  VALUE                 02390018
                                       'RCVD'.                          02400018
           05  FILLER                  PIC X(10)  VALUE                 02410018
                                       'DSCRPNCY'.                      02420018
           05  FILLER                  PIC X(13)  VALUE                 02430018
                                       'PERCENT'.                       02440018
           05  FILLER                  PIC X(11)  VALUE                 02450018
                                       'RECEIVED'.                      02460018
           05  FILLER                  PIC X(10)  VALUE                 02470018
                                       'VARIANCE'.                      02480018
           05  FILLER                  PIC X(12)  VALUE                 02490018
                                       'PERCENT'.                       02500018
           05  FILLER                  PIC X(17)  VALUE                 02510018
                                       'TRANSFERED'.                    02511018
           05  FILLER                  PIC X(14)  VALUE                 02512018
                                       'RECEIVED'.                      02520018
           05  FILLER                  PIC X(11)  VALUE                 02530018
                                       'VARIANCE'.                      02540018
           05  FILLER                  PIC X(07)  VALUE                 02550018
                                       'PERCENT'.                       02560018
                                                                        02570018
       01  HL7-HEADING-LINE-7.                                          02580018
           05  FILLER                  PIC X(18)  VALUE                 02590018
                                       '---------------'.               02600018
           05  FILLER                  PIC X(09)  VALUE                 02610018
                                       '-------'.                       02620018
           05  FILLER                  PIC X(10)  VALUE                 02630018
                                       '--------'.                      02640018
           05  FILLER                  PIC X(13)  VALUE                 02650018
                                       '-------'.                       02660018
           05  FILLER                  PIC X(11)  VALUE                 02670018
                                       '--------'.                      02680018
           05  FILLER                  PIC X(10)  VALUE                 02690018
                                       '--------'.                      02700018
           05  FILLER                  PIC X(12)  VALUE                 02710018
                                       '-------'.                       02720018
           05  FILLER                  PIC X(17)  VALUE                 02721018
                                       '----------'.                    02722018
           05  FILLER                  PIC X(14)  VALUE                 02730018
                                       '--------'.                      02740018
           05  FILLER                  PIC X(10)  VALUE                 02750018
                                       '--------'.                      02760018
           05  FILLER                  PIC X(08)  VALUE                 02770018
                                       '--------'.                      02780018
                                                                        02790018
       01  DL1-DETAIL-LINE-1.                                           02800018
           05  DL1-STORE-INFO.                                          02810018
100404*        10  DL1-STR-NBR         PIC 9(03).                       02820019
100404         10  DL1-STR-NBR         PIC 9(04).                       02821019
100404*        10  FILLER              PIC X(02)  VALUE SPACES.         02830019
100404         10  FILLER              PIC X(01)  VALUE SPACES.         02831019
               10  DL1-STR-NAME        PIC X(10).                       02840018
           05  DL1-TOTALS REDEFINES DL1-STORE-INFO.                     02850018
               10  DL1-RTV-LIT.                                         02860018
                   15  DL1-DIST-LIT    PIC X(04).                       02870018
                   15  FILLER          PIC X(01).                       02880018
                   15  DL1-DISTRICT    PIC X(04).                       02890021
               10  FILLER              PIC X(01).                       02900021
               10  DL1-TOTAL-LIT       PIC X(05).                       02910018
           05  FILLER                  PIC X(03)  VALUE SPACES.         02920018
           05  DL1-XFERS-RCVD          PIC ZZZ,ZZ9 BLANK WHEN ZERO.     02930018
           05  FILLER                  PIC X(03)  VALUE SPACE.          02940018
           05  DL1-DSCP-XFERS          PIC ZZZ,ZZ9 BLANK WHEN ZERO.     02950018
           05  FILLER                  PIC X(02)  VALUE SPACE.          02960018
           05  DL1-XFERS-VAR           PIC ZZZ9.99.                     02970018
           05  FILLER                  PIC X(04)  VALUE SPACE.          02980018
           05  DL1-UNITS-RCVD          PIC ZZ,ZZZ,ZZ9 BLANK WHEN ZERO.  02990018
           05  FILLER                  PIC X(01)  VALUE SPACES.         03000018
           05  DL1-DSCP-UNITS          PIC ZZ,ZZZ,ZZ9 BLANK WHEN ZERO.  03010018
           05  FILLER                  PIC X(02)  VALUE SPACE.          03020018
           05  DL1-UNITS-VAR           PIC ZZZ9.99.                     03030018
           05  FILLER                  PIC X(01)  VALUE SPACE.          03040018
           05  DL1-DOLLARS-XFER        PIC ZZZ,ZZZ,ZZ9.99               03050018
                                                   BLANK WHEN ZERO.     03060018
           05  FILLER                  PIC X(01)  VALUE SPACE.          03061018
           05  DL1-DOLLARS-RCVD        PIC ZZZ,ZZZ,ZZ9.99               03062018
                                                   BLANK WHEN ZERO.     03063018
           05  FILLER                  PIC X(01)  VALUE SPACES.         03070018
           05  DL1-DSCP-DOLLARS        PIC ZZ,ZZZ,ZZ9.99-               03080018
                                                   BLANK WHEN ZERO.     03090018
           05  FILLER                  PIC X(01)  VALUE SPACE.          03100018
           05  DL1-DOLLARS-VAR         PIC ZZZ9.99-.                    03110018
                                                                        03120018
      *---------------------------------------------------------------* 03121019
100404*    DB2 AREA FOR XST_LOC TABLE                                 * 03122019
      *---------------------------------------------------------------* 03123019
           EXEC SQL                                                     03124019
100404          INCLUDE XST00001                                        03125019
           END-EXEC.                                                    03126019
                                                                        03190018
           EXEC SQL                                                     03200018
               INCLUDE SQLCA                                            03210018
           END-EXEC.                                                    03220018
      *                                                                 03230018
      *  EXTENSION TO THE SQL COMMUNICATIONS AREA FOR EDITING           03240018
      *  SQL CODES FOR DISPLAY                                          03250018
      *                                                                 03260018
           COPY SQLCA2.                                                 03270018
                                                                        03280018
      ******************************************************************03290018
       PROCEDURE DIVISION.                                              03300018
      ******************************************************************03310018
       0000-MAINLINE.                                                   03320018
           PERFORM 1000-INITIALIZE.                                     03330018
           PERFORM 2000-PROCESS-DETAIL-FILE.                            03340018
                                                                        03350018
           IF PS-FIRST-TIME                                             03360018
               PERFORM 9000-PRINT-HEADINGS                              03370018
               WRITE TRANSFER-REPORT-RECORD                             03380018
                   FROM NO-DATA-LINE                                    03390018
                   AFTER ADVANCING 2                                    03400018
           END-IF.                                                      03410018
                                                                        03420018
           WRITE TRANSFER-REPORT-RECORD                                 03430018
               FROM END-OF-REPORT-LINE                                  03440018
               AFTER ADVANCING 2.                                       03450018
           CLOSE TRANSFER-REPORT-FILE                                   03460018
                 PROCESS-DATES-FILE                                     03470018
                 RTV-XFER-FILE.                                         03480018
           STOP RUN.                                                    03490018
                                                                        03500018
      ******************************************************************03510018
      *  SET UP FOR PROGRAM PROCESSING BY OPENING ALL FILES, READ THE   03520018
      *  PROCESS DATES FILE OF THE STANDARD REPORT HEADER,              03530018
      *  READING FIRST RECORD, PRINT HEADINGS.                          03540018
      ******************************************************************03550018
                                                                        03560018
       1000-INITIALIZE.                                                 03570018
           OPEN OUTPUT TRANSFER-REPORT-FILE                             03580018
                INPUT  PROCESS-DATES-FILE                               03590018
                       RTV-XFER-FILE.                                   03600018
           ACCEPT CD-CURRENT-DATE FROM DATE.                            03610018
           MOVE CD-CURRENT-YEAR TO DP132O-RUN-YEAR.                     03620018
           MOVE CD-CURRENT-MONTH TO DP132O-RUN-MONTH.                   03630018
           MOVE CD-CURRENT-DAY TO DP132O-RUN-DAY.                       03640018
           MOVE +90 TO PV-LINE-COUNT.                                   03650018
                                                                        03660018
           ACCEPT CT-CURRENT-TIME FROM TIME.                            03670018
           MOVE CT-CURRENT-HOUR TO DP132O-RUN-HOUR.                     03680018
           MOVE CT-CURRENT-MINUTE TO DP132O-RUN-MINUTE.                 03690018
           MOVE PC-PROGRAM-NAME TO DP132O-PROGRAM-NAME.                 03700018
           MOVE 1 TO DP132O-REPORT-NUMBER.                              03710018
           READ PROCESS-DATES-FILE                                      03720018
               INTO TF029-PROCESS-DATES-RECORD                          03730018
           END-READ.                                                    03740018
           DISPLAY 'TF029-PROCESS-DATES-RECORD = '                      03750018
               TF029-PROCESS-DATES-RECORD.                              03760018
           MOVE TF029-PROCESS-START-MONTH    TO PV-MONTH.               03770018
           MOVE TF029-PROCESS-START-DAY      TO PV-DAY.                 03780018
           MOVE TF029-PROCESS-START-YEAR     TO PV-YEAR.                03790018
           MOVE TF029-PROCESS-START-CENTURY  TO PV-CENTURY.             03800018
           MOVE PV-DATE                      TO HL3-FROM-DATE.          03810018
           MOVE TF029-PROCESS-END-MONTH      TO PV-MONTH.               03820018
           MOVE TF029-PROCESS-END-DAY        TO PV-DAY.                 03830018
           MOVE TF029-PROCESS-END-YEAR       TO PV-YEAR.                03840018
           MOVE TF029-PROCESS-END-CENTURY    TO PV-CENTURY.             03850018
           MOVE PV-DATE                      TO HL3-TO-DATE.            03860018
      ******************************************************************03870018
      * PROCESS TRANSFERS BY TYPE DETAIL FILE                           03880018
      ******************************************************************03890018
       2000-PROCESS-DETAIL-FILE.                                        03900018
           PERFORM                                                      03910018
               UNTIL PS-END-OF-DATA                                     03920018
               PERFORM 2100-READ-DETAIL                                 03930018
                                                                        03940018
               IF  PS-NOT-END-OF-DATA                                   03950018
                   PERFORM 3000-PROCESS-DETAIL                          03960018
               END-IF                                                   03970018
           END-PERFORM.                                                 03980018
           IF PS-ITEMS-READ                                             03990018
               PERFORM 6000-NEW-DISTRICT                                04000018
               PERFORM 7100-RTV-TOTAL                                   04010018
           END-IF.                                                      04020018
                                                                        04030018
       EJECT                                                            04040018
      *----------------------------------------------------------------*04050018
      *    READ THE TRANSFERS BY TYPE FILE                             *04060018
      *----------------------------------------------------------------*04070018
       2100-READ-DETAIL.                                                04080018
                                                                        04090018
           READ RTV-XFER-FILE                                           04100018
               INTO TF043-RTV-TRANSFER-RECORD                           04110018
                   AT END                                               04120018
                       SET PS-END-OF-DATA        TO  TRUE               04130018
           END-READ.                                                    04140018
      *----------------------------------------------------------------*04150018
      *    PROCESS THE DETAIL DATA                                      04160018
      *----------------------------------------------------------------*04170018
       3000-PROCESS-DETAIL.                                             04180018
           IF PS-FIRST-TIME                                             04190018
100404         MOVE TF043-RCV-STR-NBR        TO XST00001-LOC-NBR        04200019
                                                HV-RTV-NBR              04210018
                                                HL3-RTV-NBR             04220018
               PERFORM 5200-GET-STORE-NAME                              04230018
100404         MOVE XST00001-LOC-NM          TO HL3-RTV-NAME            04240019
               MOVE TF043-DISTRICT-NBR       TO HV-DISTRICT-NMBR        04250018
               SET PS-NOT-FIRST-TIME                                    04260018
                   PS-ITEMS-READ             TO TRUE                    04270018
           END-IF.                                                      04280018
           IF TF043-RCV-STR-NBR NOT = HV-RTV-NBR                        04290018
               PERFORM 7000-NEW-RTV                                     04300018
           END-IF.                                                      04310018
           IF TF043-DISTRICT-NBR NOT = HV-DISTRICT-NMBR                 04320018
               PERFORM 6000-NEW-DISTRICT                                04330018
           END-IF.                                                      04340018
           MOVE SPACES                       TO DL1-DETAIL-LINE-1.      04350018
100404     MOVE TF043-FR-STR-NBR             TO XST00001-LOC-NBR        04360019
                                                DL1-STR-NBR.            04370018
           PERFORM 5200-GET-STORE-NAME.                                 04380018
100404     MOVE XST00001-LOC-10-ABBR-NM      TO DL1-STR-NAME.           04390019
           MOVE TF043-XFERS-RCVD             TO DL1-XFERS-RCVD.         04400018
           MOVE TF043-XFERS-WITH-DISCREP     TO DL1-DSCP-XFERS.         04410018
           IF TF043-XFERS-RCVD > 0 AND TF043-XFERS-WITH-DISCREP > 0     04420018
               COMPUTE PV-VARIANCE ROUNDED =                            04430018
                 (TF043-XFERS-WITH-DISCREP / TF043-XFERS-RCVD)          04440018
               MULTIPLY 100 BY PV-VARIANCE                              04450018
               MOVE PV-VARIANCE              TO DL1-XFERS-VAR           04460018
           END-IF.                                                      04470018
           MOVE TF043-UNITS-RCVD             TO DL1-UNITS-RCVD.         04480018
           MOVE TF043-UNITS-VARIANCE         TO DL1-DSCP-UNITS.         04490018
           IF TF043-UNITS-RCVD > 0 AND TF043-UNITS-VARIANCE > 0         04500018
               COMPUTE PV-VARIANCE ROUNDED =                            04510018
                 (TF043-UNITS-VARIANCE / TF043-UNITS-RCVD)              04520018
               MULTIPLY 100 BY PV-VARIANCE                              04530018
               MOVE PV-VARIANCE              TO DL1-UNITS-VAR           04540018
           END-IF.                                                      04550018
           MOVE TF043-DOLLARS-RCVD           TO DL1-DOLLARS-RCVD.       04560018
           MOVE TF043-DOLLARS-XFER           TO DL1-DOLLARS-XFER.       04561018
           COMPUTE PV-WORK-DOLLARS =                                    04571018
              TF043-DOLLARS-RCVD - TF043-DOLLARS-XFER.                  04580018
           MOVE PV-WORK-DOLLARS              TO DL1-DSCP-DOLLARS.       04581018
           IF PV-WORK-DOLLARS     NOT = ZERO AND                        04582018
              TF043-DOLLARS-XFER  NOT = ZERO                            04583018
               COMPUTE PV-VARIANCE ROUNDED =                            04590018
                 (PV-WORK-DOLLARS / TF043-DOLLARS-XFER)                 04600018
               MULTIPLY 100 BY PV-VARIANCE                              04610018
               MOVE PV-VARIANCE              TO DL1-DOLLARS-VAR         04620018
           END-IF.                                                      04630018
           IF PV-LINE-COUNT > PC-PAGE-MAX                               04640018
               PERFORM 9000-PRINT-HEADINGS                              04650018
           END-IF.                                                      04660018
           WRITE TRANSFER-REPORT-RECORD                                 04670018
               FROM DL1-DETAIL-LINE-1                                   04680018
               AFTER ADVANCING 1.                                       04690018
           ADD +1                           TO PV-LINE-COUNT.           04700018
           ADD  TF043-XFERS-RCVD            TO PV-DIST-XFERS.           04710018
           ADD  TF043-XFERS-WITH-DISCREP    TO PV-DIST-DSCP-XFERS.      04720018
           ADD  TF043-UNITS-RCVD            TO PV-DIST-UNITS.           04730018
           ADD  TF043-UNITS-VARIANCE        TO PV-DIST-DSCP-UNITS.      04740018
           ADD  TF043-DOLLARS-RCVD          TO PV-DIST-DOLLARS-RCVD.    04750018
           ADD  TF043-DOLLARS-XFER          TO PV-DIST-DOLLARS-XFER.    04760018
      *----------------------------------------------------------------*04770018
      *    GET THE STORE 10 CHARACTER ABBREVIATED NAME.                 04780018
      *----------------------------------------------------------------*04790018
       5200-GET-STORE-NAME.                                             04800018
           PERFORM WITH TEST AFTER                                      04810018
               VARYING PV-RETRY-COUNT FROM 1 BY 1                       04820018
                 UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                  04830018
                    OR SQLCODE = ZERO                                   04840018
                    OR SQLCODE = +100                                   04850018
               EXEC SQL                                                 04860018
100404             SELECT LOC_NM                                        04870019
100404                   ,LOC_10_ABBR_NM                                04880019
100404                 INTO :XST00001-LOC-NM                            04890019
100404                     ,:XST00001-LOC-10-ABBR-NM                    04900019
100404                 FROM XST_LOC                                     04910019
100404                 WHERE LOC_NBR = :XST00001-LOC-NBR                04920019
               END-EXEC                                                 04930018
               EVALUATE TRUE                                            04940018
                   WHEN SQLCODE = ZERO                                  04941020
                   WHEN SQLCODE = -904                                  04950018
                   WHEN SQLCODE = -913                                  04960018
                       CONTINUE                                         04970018
                   WHEN SQLCODE = +100                                  04980018
100404                 MOVE 'INVALID STORE'       TO XST00001-LOC-NM    04990019
                   WHEN OTHER                                           05000019
                       MOVE '5200-GET-STORE-NAME' TO PV-PARAGRAPH-NAME  05030018
                       MOVE 'READ THE STORE TABLE' TO PV-DB2-OPERATION  05040018
                       PERFORM 9100-SQL-ERROR                           05050018
               END-EVALUATE                                             05080018
           END-PERFORM.                                                 05090018
                                                                        05100018
           IF PV-RETRY-COUNT > PC-MAX-RETRIES                           05110018
               MOVE '5200-GET-STORE-NAME' TO PV-PARAGRAPH-NAME          05120018
               MOVE 'READ THE STORE TABLE' TO PV-DB2-OPERATION          05130018
               PERFORM 9100-SQL-ERROR                                   05140018
           END-IF.                                                      05150018
      *----------------------------------------------------------------*05160018
      *  PRINT THE DISTRICT TOTAL LINE.                                *05170018
      *----------------------------------------------------------------*05180018
       6000-NEW-DISTRICT.                                               05190018
           MOVE SPACES                       TO DL1-DETAIL-LINE-1.      05200018
           MOVE PC-DIST-LITERAL              TO DL1-DIST-LIT.           05210018
           MOVE PC-TOTAL-LITERAL             TO DL1-TOTAL-LIT.          05220018
           MOVE HV-DISTRICT-NMBR             TO DL1-DISTRICT.           05230018
           MOVE PV-DIST-XFERS                TO DL1-XFERS-RCVD.         05240018
           MOVE PV-DIST-UNITS                TO DL1-UNITS-RCVD.         05250018
           MOVE PV-DIST-DOLLARS-XFER         TO DL1-DOLLARS-XFER.       05260018
           MOVE PV-DIST-DOLLARS-RCVD         TO DL1-DOLLARS-RCVD.       05261018
           MOVE PV-DIST-DSCP-XFERS           TO DL1-DSCP-XFERS.         05270018
           MOVE PV-DIST-DSCP-UNITS           TO DL1-DSCP-UNITS.         05280018
           IF PV-DIST-XFERS > 0 AND PV-DIST-DSCP-XFERS > 0              05300018
               COMPUTE PV-VARIANCE ROUNDED =                            05310018
                 (PV-DIST-DSCP-XFERS / PV-DIST-XFERS)                   05320018
               MULTIPLY 100 BY PV-VARIANCE                              05330018
               MOVE PV-VARIANCE              TO DL1-XFERS-VAR           05340018
           END-IF.                                                      05350018
           IF PV-DIST-UNITS > 0 AND PV-DIST-DSCP-UNITS > 0              05360018
               COMPUTE PV-VARIANCE ROUNDED =                            05370018
                 (PV-DIST-DSCP-UNITS / PV-DIST-UNITS)                   05380018
               MULTIPLY 100 BY PV-VARIANCE                              05390018
               MOVE PV-VARIANCE              TO DL1-UNITS-VAR           05400018
           END-IF.                                                      05410018
           COMPUTE PV-WORK-DOLLARS =                                    05472018
              PV-DIST-DOLLARS-RCVD - PV-DIST-DOLLARS-XFER.              05473018
           MOVE PV-WORK-DOLLARS              TO DL1-DSCP-DOLLARS.       05474018
           IF PV-WORK-DOLLARS       NOT = ZERO AND                      05475018
              PV-DIST-DOLLARS-XFER  NOT = ZERO                          05476018
               COMPUTE PV-VARIANCE ROUNDED =                            05477018
                 (PV-WORK-DOLLARS / PV-DIST-DOLLARS-XFER)               05478018
               MULTIPLY 100 BY PV-VARIANCE                              05479018
               MOVE PV-VARIANCE              TO DL1-DOLLARS-VAR         05479118
           END-IF.                                                      05479218
           WRITE TRANSFER-REPORT-RECORD                                 05480018
               FROM DL1-DETAIL-LINE-1                                   05490018
               AFTER ADVANCING 2.                                       05500018
           WRITE TRANSFER-REPORT-RECORD                                 05510018
               FROM BLANK-LINE                                          05520018
               AFTER ADVANCING 2.                                       05530018
           ADD +4                           TO PV-LINE-COUNT.           05540018
           ADD  PV-DIST-XFERS               TO PV-COMP-XFERS.           05550018
           ADD  PV-DIST-DSCP-XFERS          TO PV-COMP-DSCP-XFERS.      05560018
           ADD  PV-DIST-UNITS               TO PV-COMP-UNITS.           05570018
           ADD  PV-DIST-DSCP-UNITS          TO PV-COMP-DSCP-UNITS.      05580018
           ADD  PV-DIST-DOLLARS-RCVD        TO PV-COMP-DOLLARS-RCVD.    05590018
           ADD  PV-DIST-DOLLARS-XFER        TO PV-COMP-DOLLARS-XFER.    05591018
           MOVE ZEROES                      TO PV-DIST-XFERS            05610018
                                               PV-DIST-DSCP-XFERS       05620018
                                               PV-DIST-UNITS            05630018
                                               PV-DIST-DSCP-UNITS       05640018
                                               PV-DIST-DOLLARS-RCVD     05650018
                                               PV-DIST-DOLLARS-XFER.    05660018
           MOVE TF043-DISTRICT-NBR       TO HV-DISTRICT-NMBR.           05670018
                                                                        05680018
      *----------------------------------------------------------------*05690018
      *  PRINT THE COMPANY TOTAL LINE FOR THIS RTV                     *05700018
      *----------------------------------------------------------------*05710018
       7000-NEW-RTV.                                                    05720018
           PERFORM 6000-NEW-DISTRICT.                                   05730018
           PERFORM 7100-RTV-TOTAL.                                      05740018
100404     MOVE TF043-RCV-STR-NBR            TO XST00001-LOC-NBR        05750019
                                                HV-RTV-NBR              05760018
                                                HL3-RTV-NBR             05770018
           PERFORM 5200-GET-STORE-NAME.                                 05780018
100404     MOVE XST00001-LOC-NM              TO HL3-RTV-NAME.           05790019
      *----------------------------------------------------------------*05800018
      *  PRINT THE COMPANY TOTAL LINE FOR THIS RTV                     *05810018
      *----------------------------------------------------------------*05820018
       7100-RTV-TOTAL.                                                  05830018
           MOVE SPACES                       TO DL1-DETAIL-LINE-1.      05840018
           MOVE PC-RTV-LITERAL               TO DL1-RTV-LIT.            05850018
           MOVE PC-TOTAL-LITERAL             TO DL1-TOTAL-LIT.          05860018
           MOVE PV-COMP-XFERS                TO DL1-XFERS-RCVD.         05870018
           MOVE PV-COMP-UNITS                TO DL1-UNITS-RCVD.         05880018
           MOVE PV-COMP-DOLLARS-XFER         TO DL1-DOLLARS-XFER.       05890018
           MOVE PV-COMP-DOLLARS-RCVD         TO DL1-DOLLARS-RCVD.       05891018
           MOVE PV-COMP-DSCP-XFERS           TO DL1-DSCP-XFERS.         05900018
           MOVE PV-COMP-DSCP-UNITS           TO DL1-DSCP-UNITS.         05910018
           IF PV-COMP-XFERS > 0 AND PV-COMP-DSCP-XFERS > 0              05930018
               COMPUTE PV-VARIANCE ROUNDED =                            05940018
                 (PV-COMP-DSCP-XFERS / PV-COMP-XFERS)                   05950018
               MULTIPLY 100 BY PV-VARIANCE                              05960018
               MOVE PV-VARIANCE              TO DL1-XFERS-VAR           05970018
           END-IF.                                                      05980018
           IF PV-COMP-UNITS > 0 AND PV-COMP-DSCP-UNITS > 0              05990018
               COMPUTE PV-VARIANCE ROUNDED =                            06000018
                 (PV-COMP-DSCP-UNITS / PV-COMP-UNITS)                   06010018
               MULTIPLY 100 BY PV-VARIANCE                              06020018
               MOVE PV-VARIANCE              TO DL1-UNITS-VAR           06030018
           END-IF.                                                      06040018
           COMPUTE PV-WORK-DOLLARS =                                    06041018
              PV-COMP-DOLLARS-RCVD - PV-COMP-DOLLARS-XFER.              06042018
           MOVE PV-WORK-DOLLARS              TO DL1-DSCP-DOLLARS.       06043018
           IF PV-WORK-DOLLARS       NOT = ZERO AND                      06044018
              PV-COMP-DOLLARS-XFER  NOT = ZERO                          06045018
               COMPUTE PV-VARIANCE ROUNDED =                            06046018
                 (PV-WORK-DOLLARS / PV-COMP-DOLLARS-XFER)               06047018
               MULTIPLY 100 BY PV-VARIANCE                              06048018
               MOVE PV-VARIANCE              TO DL1-DOLLARS-VAR         06049018
           END-IF.                                                      06049118
           IF PV-LINE-COUNT > PC-PAGE-MAX - 6                           06110018
               PERFORM 9000-PRINT-HEADINGS                              06120018
           END-IF.                                                      06130018
           WRITE TRANSFER-REPORT-RECORD                                 06140018
               FROM DL1-DETAIL-LINE-1                                   06150018
               AFTER ADVANCING 1.                                       06160018
           MOVE ZEROES                      TO PV-COMP-XFERS            06170018
                                               PV-COMP-DSCP-XFERS       06180018
                                               PV-COMP-UNITS            06190018
                                               PV-COMP-DSCP-UNITS       06200018
                                               PV-COMP-DOLLARS-XFER     06210018
                                               PV-COMP-DOLLARS-RCVD     06211018
                                               PV-PAGE-COUNT.           06230018
           MOVE +90                         TO PV-LINE-COUNT.           06240018
      ******************************************************************06250018
      *  PRINT REPORT HEADINGS                                          06260018
      ******************************************************************06270018
                                                                        06280018
       9000-PRINT-HEADINGS.                                             06290018
           ADD 1 TO PV-PAGE-COUNT.                                      06300018
           MOVE 9             TO PV-LINE-COUNT.                         06310018
           MOVE PV-PAGE-COUNT TO DP132O-PAGE-NUMBER.                    06320018
           WRITE TRANSFER-REPORT-RECORD                                 06330018
               FROM DP132O-STANDRD-HEADER-132-COLS                      06340018
               AFTER ADVANCING PAGE.                                    06350018
           WRITE TRANSFER-REPORT-RECORD                                 06360018
               FROM HL2-HEADING-LINE-2                                  06370018
               AFTER ADVANCING 1.                                       06380018
           WRITE TRANSFER-REPORT-RECORD                                 06390018
               FROM HL3-HEADING-LINE-3                                  06400018
               AFTER ADVANCING 1.                                       06410018
           WRITE TRANSFER-REPORT-RECORD                                 06420018
               FROM HL4-HEADING-LINE-4                                  06430018
               AFTER ADVANCING 2.                                       06440018
           WRITE TRANSFER-REPORT-RECORD                                 06450018
               FROM HL5-HEADING-LINE-5                                  06460018
               AFTER ADVANCING 1.                                       06470018
           WRITE TRANSFER-REPORT-RECORD                                 06480018
               FROM HL6-HEADING-LINE-6                                  06490018
               AFTER ADVANCING 1.                                       06500018
           WRITE TRANSFER-REPORT-RECORD                                 06510018
               FROM HL7-HEADING-LINE-7                                  06520018
               AFTER ADVANCING 1.                                       06530018
           WRITE TRANSFER-REPORT-RECORD                                 06540018
               FROM BLANK-LINE                                          06550018
               AFTER ADVANCING 1.                                       06560018
      ******************************************************************06570018
      *  FORMAT A DB2 ERROR MESSAGE, RELEASE ALL LOCKS, AND ABEND THE  *06580018
      *  PROGRAM.                                                      *06590018
      ******************************************************************06600018
       9100-SQL-ERROR.                                                  06610018
           MOVE SQLCODE TO SQLCODE2.                                    06620018
           MOVE SQLERRD(3) TO SQLERRD3.                                 06630018
           DISPLAY '** ABEND **'.                                       06640018
           DISPLAY 'TFKRP504 - SQL ERROR'.                              06650018
           DISPLAY '       SQLCODE = ' SQLCODE2.                        06660018
           DISPLAY '      SQLWARN0 = ' SQLWARN0.                        06670018
           DISPLAY '      SQLWARN1 = ' SQLWARN1.                        06680018
           DISPLAY '      SQLWARN2 = ' SQLWARN2.                        06690018
           DISPLAY '      SQLWARN3 = ' SQLWARN3.                        06700018
           DISPLAY '      SQLWARN4 = ' SQLWARN4.                        06710018
           DISPLAY '      SQLWARN5 = ' SQLWARN5.                        06720018
           DISPLAY '      SQLWARN6 = ' SQLWARN6.                        06730018
           DISPLAY '      SQLWARN7 = ' SQLWARN7.                        06740018
           DISPLAY 'ROWS PROCESSED = ' SQLERRD3.                        06750018
           DISPLAY                    '** PARAGRAPH ** = '              06760018
                                       PV-PARAGRAPH-NAME.               06770018
           DISPLAY                    '** OPERATION ** = '              06780018
                                       PV-DB2-OPERATION.                06790018
                                                                        06800018
           EXEC SQL                                                     06810018
               COMMIT                                                   06820018
           END-EXEC.                                                    06830018
                                                                        06840018
           MOVE +4013 TO ABEND-CODE.                                    06850018
           CALL 'ILBOABN0' USING ABEND-CODE.                            06860018
                                                                        06870018
