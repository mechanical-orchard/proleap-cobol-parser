000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             SUKRF509.                                00050000
000600 AUTHOR.                 MICHAEL WALTERS.                         00060000
000700 INSTALLATION.           KOHLS.                                   00070000
000800 DATE-WRITTEN            SEPTEMBER, 1997.                         00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200* THIS PROGRAM DISPLAYS THE CARTON AUDIT ASSOCIATE LOCATION       00120000
001300* SCREEN.                                                         00130000
001400******************************************************************00140000
263968*---------------------------------------------------------------* 00141018
263968* CHANGED 11/16/2021    BY JIM HUNTER      WR: CHG0263968         00142018
263968* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00143018
263968* MAKING THE CALL DYNAMIC VS STATIC.                              00144018
263968*---------------------------------------------------------------* 00145018
001500                                                                  00150000
001600******************************************************************00160000
001700 ENVIRONMENT DIVISION.                                            00170000
001800******************************************************************00180000
001900                                                                  00190000
002000******************************************************************00200000
002100 DATA DIVISION.                                                   00210000
002200******************************************************************00220000
002300                                                                  00230000
002400******************************************************************00240000
002500 WORKING-STORAGE SECTION.                                         00250000
002600******************************************************************00260000
002700 01  CA-COMMAREA.                                                 00270000
002800     COPY SUWS006.                                                00280004
002900    05  CA-PROGRAM-COMMAREA.                                      00290000
003000         10   CA-100-CHECK               PIC  X(01)  VALUE SPACE. 00300000
003100         10   CA-SPOT-CHECK              PIC  X(01)  VALUE SPACE. 00310000
003110         10   CA-REWORK                  PIC  X(01)  VALUE SPACE. 00311000
003200         10   CA-NEW-AUDIT-CNTL-NBR-X    PIC  X(09)  VALUE SPACE. 00320000
003300         10   CA-NEW-AUDIT-CNTL-NBR  REDEFINES                    00330000
003400              CA-NEW-AUDIT-CNTL-NBR-X    PIC  9(09).              00340000
003500*                                                                 00350000
003600 01  DK-DB2-KEYS.                                                 00360000
003700     05  DK-AUDIT-CNTL-NBR               PIC S9(09) COMP.         00370000
003701     05  DK-OPER-UNT-ID                  PIC S9(04) COMP.         00370100
003800*                                                                 00380000
003900 01  PC-PROGRAM-CONSTANTS.                                        00390000
004000     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00400000
004100         'SUKRF509'.                                              00410000
004200     05  PC-RETURN-PGM                   PIC  X(08)  VALUE        00420000
004300         'SUKRF508'.                                              00430000
004400     05  PC-RANDOM-NBR-GENERATOR         PIC  X(08)  VALUE        00440000
004500         'DPKUT902'.                                              00450000
004600     05  PC-AUDIT-STATUS-SCREEN          PIC  X(08)  VALUE        00460000
004700         'SUKRF510'.                                              00470000
004800     05  PC-OPEN-CARTON-SCREEN           PIC  X(08)  VALUE        00480000
004900         'SUKRF511'.                                              00490000
004910     05  PC-COMMON-CARTON-CLOSE-PGM      PIC  X(08)  VALUE        00491005
004920         'SUKCS769'.                                              00492005
005000     05  PC-CURRENT-TRANID               PIC  X(04)  VALUE 'S509'.00500000
005010     05  PC-CHECK-IN-PGM                 PIC  X(08)  VALUE        00501000
005020         'SUKRF502'.                                              00502000
005021     05  PC-PREV-FAILED-AUDIT-PGM        PIC X(08)   VALUE        00502100
005022         'SUKRF535'.                                              00502200
005030     05  PC-AUDIT-NO-LONGER-NEEDED-MSG   PIC  X(19)  VALUE        00503000
005040         'AUDIT COMPLETE     '.                                   00504000
005041     05  PC-TRANS-UNAVAILABLE-MSG        PIC  X(19)  VALUE        00504105
005042         'TRANS NOT AVAILABLE'.                                   00504205
005043     05  PC-CCC-PARM-ERR-MSG             PIC  X(19)  VALUE        00504312
005044         'PARM ERROR-SUKCS769'.                                   00504412
005045     05  PC-CCC-DB2-ERR-MSG              PIC  X(19)  VALUE        00504512
005046         'DB2  ERROR-SUKCS769'.                                   00504612
005047     05  PC-CCC-MQ-ERR-MSG               PIC  X(19)  VALUE        00504712
005048         'MQ   ERROR-SUKCS769'.                                   00504812
005049     05  PC-CCC-OTHR-ERR-MSG             PIC  X(19)  VALUE        00504912
005050         'OTHR ERROR-SUKCS769'.                                   00505012
005051     05  PC-CCC-PGM-LINK-ERR             PIC  X(19)  VALUE        00505110
005052         'LINK ERR - SUKCS769'.                                   00505212
005053     05  PC-DEFAULT-START-TMST           PIC  X(26)  VALUE        00505300
005060         '9999-09-09-09.09.09.999999'.                            00506000
005070     05  PC-AUDIT-FAILURE-MSG            PIC  X(19)  VALUE        00507000
005080         'AUD FAILURE CHECKED'.                                   00508000
005090     05  PC-F                            PIC X(01) VALUE 'F'.     00509000
005100                                                                  00510000
005200                                                                  00520000
005300 01  PS-PROGRAM-SWITCHES.                                         00530000
005310     05  PS-SYSTEM-AUDIT-FOUND-SW       PIC X(01)    VALUE 'N'.   00531000
005320         88  PS-SYSTEM-AUDIT-NOT-FOUND               VALUE 'N'.   00532000
005330         88  PS-SYSTEM-AUDIT-FOUND                   VALUE 'Y'.   00533000
005400     05  PS-ACCESS-ALLOWED-IND           PIC  X(01)  VALUE 'N'.   00540000
005500         88  PS-NO-ACCESS-ALLOWED                    VALUE 'N'.   00550000
005600         88  PS-ACCESS-ALLOWED                       VALUE 'Y'.   00560000
005700     05  PS-AUDIT-NBR-IND                PIC  X(01)  VALUE 'N'.   00570000
005800         88  PS-AUDIT-NBR-NOT-EXISTS                 VALUE 'N'.   00580000
005900         88  PS-AUDIT-NBR-EXISTS                     VALUE 'Y'.   00590000
006000     05  PS-ERRORS-SW                    PIC X(01)   VALUE 'N'.   00600000
006100         88  PS-ERRORS-NO                            VALUE 'N'.   00610000
006200         88  PS-ERRORS-YES                           VALUE 'Y'.   00620000
006210     05  PS-FAILED-AUDIT-SW              PIC  X(01)  VALUE 'N'.   00621000
006220         88  PS-FAILED-AUDITS                        VALUE 'Y'.   00622000
006240         88  PS-NO-FAILED-AUDITS                     VALUE 'N'.   00624000
006300                                                                  00630000
006400 01  PV-PROGRAM-VARIABLES.                                        00640000
006500     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE ZERO   00650000
006600                                                     COMP SYNC.   00660000
006700     05  PV-SYSID                        PIC  X(04)  VALUE SPACE. 00670000
006800     05  PV-MESSAGE-AREA                 PIC  X(19)  VALUE SPACE. 00680000
006900     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  00690000
007000                                                     COMP SYNC.   00700000
007100     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 00710000
007200     05  PV-OPER-UNT-ID                  PIC S9(04)  VALUE ZEROS  00720000
007300                                                     COMP.        00730000
007400     05  PV-FCLTY-ID                     PIC S9(04)  VALUE ZEROS  00740000
007500                                                     COMP.        00750000
007600     05  PV-TS-ITEM                      PIC S9(04)  VALUE ZERO   00760000
007700                                                     COMP.        00770000
007800     05  PV-SIGN-ON-INFO-LENGTH          PIC S9(04)  VALUE ZERO   00780000
007900                                                     COMP SYNC.   00790000
007910     05  PV-LIMIT-DAYS                   PIC S9(09) COMP.         00791000
007920     05  PV-DISPLAY-PO-NBR               PIC S9(09).              00792000
007930     05  PV-DISPLAY-PREPK-ID             PIC S9(04).              00793000
007940     05  PV-DISPLAY-PO-LINE-NBR          PIC S9(09).              00794000
007950     05  PV-DISPLAY-LOC-NBR              PIC S9(05).              00795004
008000*                                                                 00800000
008100 01  TS-TEMP-STORAGE-QUEUE-INFO.                                  00810000
008200     05  TS-INFO-QUEUE-NAME.                                      00820000
008300         10  TS-INFO-QUEUE-TERMINAL      PIC  X(04)  VALUE SPACE. 00830000
008400         10  FILLER                      PIC  X(04)  VALUE 'INFO'.00840000
008500                                                                  00850000
008600******************************************************************00860000
008700*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      00870000
008800******************************************************************00880000
008900     COPY DFHAID.                                                 00890000
009000                                                                  00900000
009700******************************************************************00970000
009800*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                00980000
009900******************************************************************00990000
010000     COPY DPWS013.                                                01000004
010100                                                                  01010000
010200******************************************************************01020000
010300*    COPY BOOK FOR THE CICSAUTH SUBROUTINE                        01030000
010400******************************************************************01040000
010500     COPY DPWS008.                                                01050004
010610/                                                                 01061005
010620******************************************************************01062005
010630*    COMMON CARTON CLOSE COMMUNICATION AREA                       01063005
010640******************************************************************01064005
010650     COPY SUWS091.                                                01065005
010660/                                                                 01066005
010700******************************************************************01070000
010800*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 01080000
010900*****************************************************************.01090000
011000     COPY DPWS010I.                                               01100004
011100                                                                  01110000
011200******************************************************************01120000
011300*  RANDOM NUMBER AREA.                                            01130000
011400******************************************************************01140000
011500     COPY DPWS902.                                                01150004
011600                                                                  01160000
011700******************************************************************01170000
011800*  GENERATED DSECT FOR THE SUKM509 MAPSET                         01180000
011900******************************************************************01190000
012000     COPY SUKM509.                                                01200004
012100                                                                  01210000
012200******************************************************************01220000
012300*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   01230000
012400******************************************************************01240000
012500     COPY DPWS015.                                                01250004
012600                                                                  01260000
012610*----------------------------------------------------------------*01261001
012620* HELP SCREEN COMMAREA                                            01262001
012630     COPY PCWS192.                                                01263001
012640*----------------------------------------------------------------*01264001
012650* HELP SCREEN WORK AREA                                           01265001
012660     COPY PCWS188.                                                01266001
012670                                                                  01267001
012700                                                                  01270000
012800******************************************************************01280000
012900*  TEMPORARY STORAGE QUEUE LAYOUT FOR LOGON/UNIT RELATED          01290000
013000*  INFORMATION CAPTURED BY THE NAVIGATOR AT LOGON TIME            01300000
013100******************************************************************01310000
013200     COPY DPWS026.                                                01320004
013300                                                                  01330000
013400******************************************************************01340000
013500*  COPY BOOK CONTAINING ERROR/WARNING/INFORMATIONAL MESSAGES      01350000
013600*  TO BE DISPLAYED ON THE LRT                                     01360000
013700******************************************************************01370000
013800     COPY SUWS005.                                                01380004
013900                                                                  01390000
013910******************************************************************01391000
013920*  COPY BOOK USED IN CHECK IN PROCESSING                          01392000
013930*  MOVED TO CA-HOST-SAVE-AREA AND PASSED ALONG CARTON AUDIT AND   01393000
013940*  PASSED BACK TO THE CHECK-IN PROGRAM (SUKRF502)                 01394000
013950******************************************************************01395000
013960     COPY SUWS001.                                                01396004
013970                                                                  01397000
014000******************************************************************01400000
014100*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      01410000
014200*  AUDIT TABLE (TSUNAUD)                                          01420000
014300******************************************************************01430000
014400     EXEC SQL                                                     01440000
014500         INCLUDE TSUNAUD                                          01450000
014600     END-EXEC.                                                    01460000
014700                                                                  01470000
014710******************************************************************01471000
014720*    DB2 AREA FOR THE PO AUDIT REQUEST TABLE (SUT_PO_AUD_REQ)   * 01472000
014730******************************************************************01473000
014740     EXEC SQL                                                     01474000
014750         INCLUDE SUT00015                                         01475000
014760     END-EXEC.                                                    01476000
014770                                                                  01477000
014771******************************************************************01477100
014772*    DB2 AREA FOR AUDIT PARM TABLE (SUT_PO_AUD_PARM)            * 01477200
014773******************************************************************01477300
014774     EXEC SQL                                                     01477400
014775         INCLUDE SUT00017                                         01477500
014776     END-EXEC.                                                    01477600
014777                                                                  01477700
014780******************************************************************01478000
014790*    DB2 AREA FOR THE LOGISTICS DOMAIN LOCATION MASTER TABLE      01479004
014791******************************************************************01479100
014792     EXEC SQL                                                     01479200
014793         INCLUDE XLT00010                                         01479304
014794     END-EXEC.                                                    01479400
014795                                                                  01479500
014800******************************************************************01480000
014900*  COMMUNICATIONS AREA FOR DB2                                    01490000
015000******************************************************************01500000
015100     EXEC SQL                                                     01510000
015200         INCLUDE SQLCA                                            01520000
015300     END-EXEC.                                                    01530000
015400                                                                  01540000
015500******************************************************************01550000
015600 LINKAGE SECTION.                                                 01560000
015700******************************************************************01570000
015800 01  DFHCOMMAREA.                                                 01580000
015900     05  FILLER                         OCCURS  1 TO 4072 TIMES   01590000
016000                                        DEPENDING ON EIBCALEN.    01600000
016100         10  FILLER                     PIC X.                    01610000
016200                                                                  01620000
016300                                                                  01630000
016400******************************************************************01640000
016500 PROCEDURE DIVISION.                                              01650000
016600******************************************************************01660000
016700 0000-PROGRAM-MAINLINE.                                           01670000
016800     MOVE DFHCOMMAREA  TO  CA-COMMAREA.                           01680000
016900     MOVE LOW-VALUES   TO  SU509AI.                               01690000
017000                                                                  01700000
017100     EVALUATE TRUE                                                01710000
017110****************************************************************  01711002
017120* DPKRF278 IS THE PGM FOR THE HELP SCREEN.                        01712002
017130****************************************************************  01713002
017140         WHEN EIBTRNID = 'Z278'                                   01714002
017150             MOVE DFHCOMMAREA          TO PC192-COMMAREA          01715002
017160             MOVE PC192-HOST-SAVE-AREA TO CA-COMMAREA             01716002
017170             SET SU006-PROCESS-SCREEN  TO TRUE                    01717002
017180             SET SU006-PROCESS-SCREEN                             01718002
017190                 SU006-AUD-FAIL-SCRN-CKED-YES TO TRUE             01719002
017191             MOVE PC-AUDIT-FAILURE-MSG TO  AMSGLNO                01719102
017192             MOVE SU006-AUDIT-CNTL-NBR TO ACNTLO                  01719202
017193             PERFORM 8000-SEND-MAP                                01719302
017194             PERFORM 8200-RETURN-TRANID                           01719402
017195                                                                  01719502
017200         WHEN EIBCALEN = ZERO                                     01720000
017300         WHEN EIBAID = DFHCLEAR                                   01730000
017400         WHEN SU006-INITIALIZE-SCREEN                             01740000
017500             INITIALIZE CA-PROGRAM-COMMAREA                       01750000
017510             IF SU006-LAST-PROGRAM = PC-PREV-FAILED-AUDIT-PGM     01751000
017511                SET SU006-PROCESS-SCREEN                          01751100
017520                    SU006-AUD-FAIL-SCRN-CKED-YES TO TRUE          01752000
017521                 MOVE PC-AUDIT-FAILURE-MSG TO  AMSGLNO            01752100
017522                 MOVE SU006-AUDIT-CNTL-NBR TO ACNTLO              01752200
017523                 PERFORM 8000-SEND-MAP                            01752300
017524                 PERFORM 8200-RETURN-TRANID                       01752400
017525             ELSE                                                 01752500
017600                SET SU006-PROCESS-SCREEN                          01760000
017610                    SU006-AUD-FAIL-SCRN-CKED-NO TO TRUE           01761000
017700                INITIALIZE   SU006-AUDIT-CNTL-NBR-X               01770000
017800                             SU006-AUDIT-TYPE                     01780000
017900                             SU006-AUDIT-STATUS                   01790000
017910                IF EIBTRNID = 'S502'                              01791000
017920                   MOVE SU006-HOST-SAVE-AREA TO SU001-COMMON-DATA 01792000
017970                END-IF                                            01797000
018000                   PERFORM 8000-SEND-MAP                          01800000
018100                   PERFORM 8200-RETURN-TRANID                     01810000
018110             END-IF                                               01811000
018200                                                                  01820000
018300         WHEN EIBAID = DFHENTER                                   01830000
018400             PERFORM 1200-RECEIVE-MAP                             01840000
018500             MOVE SPACES TO AMSGLNO                               01850000
018600             PERFORM 1300-EDIT-SELECTION                          01860000
018700                                                                  01870000
018800*        F2 TO CONTINUE AN AUDIT                                  01880000
018900*                                                                 01890000
019000*        IF A NEW AUDIT HAS BEEN CREATED, F2 WILL TAKE THE USER   01900000
019100*          DIRECTLY INTO THE "OPEN CARTON" SCREEN                 01910000
019200*                                                                 01920000
019300*        IF THE AUDIT NUMBER WAS NOT CREATE (THE USER ENTERED IT) 01930000
019400*          VALIDATE AN AUDIT EXISTS WITH THIS CONTROL NUMBER AND  01940000
019500*          GO TO THE THE AUDIT STATUS SCREEN                      01950000
019600         WHEN EIBAID = DFHPF2                                     01960000
019700             PERFORM 1200-RECEIVE-MAP                             01970000
019800             IF SU006-AUDIT-CNTL-NBR > 0                          01980000
019900                PERFORM 1300-EDIT-SELECTION                       01990000
020000                                                                  02000000
020100*            IF CONTINUE WITH A NEW AUDIT CNTL NUMBER,            02010000
020200*            INSERT THE NEW AUDIT TO THE DB2 TABLES.......        02020000
020300                IF SU006-AUDIT-CNTL-NBR = CA-NEW-AUDIT-CNTL-NBR   02030000
020400                    PERFORM 3510-INSERT-TSUNAUD                   02040000
020500*            OTHERWISE VALIDATE THE NUMBERS EXISTENCE AND         02050000
020600*            GO TO THE AUDIT STATUS SCREEN TO CONTINUE THE        02060000
020700*            EXISTING NUMBER.                                     02070000
020800                ELSE                                              02080000
020900                    PERFORM 3000-VALIDATE-AUDIT-NBR               02090000
021000                    IF PS-AUDIT-NBR-EXISTS                        02100000
021010                        IF PS-SYSTEM-AUDIT-FOUND AND              02101000
021020                           (SUNAUD-AUD-STRT-TMST =                02102000
021030                                           PC-DEFAULT-START-TMST) 02103000
021040                            PERFORM 3550-UPDATE-TSUNAUD           02104000
021100                            MOVE PC-OPEN-CARTON-SCREEN            02110000
021101                                           TO PV-TRANSFER-PROGRAM 02110100
021102                        ELSE                                      02110200
021110                            MOVE PC-AUDIT-STATUS-SCREEN           02111000
021200                                           TO PV-TRANSFER-PROGRAM 02120000
021210                        END-IF                                    02121000
021300                        PERFORM 2100-XCTL-TO-SELECTED-PROGRAM     02130000
021400* DMH - 3/19/03 - BEGIN                                           02140003
021700                    ELSE                                          02170003
021710                        MOVE PM-AUDIT-NOT-FOUND-MSG               02171003
021711                                            TO AMSGLNO            02171103
021712* DMH - 3/19/03 - END                                             02171203
021720                    END-IF                                        02172003
021800                END-IF                                            02180000
021900             ELSE                                                 02190000
022000                MOVE PM-CREATE-CNTL-NBR-MSG TO AMSGLNO            02200000
022100             END-IF                                               02210000
022200                                                                  02220000
022300*        F4 TO CREATE A NEW AUDIT                                 02230000
022400         WHEN EIBAID = DFHPF4                                     02240000
022500             PERFORM 1200-RECEIVE-MAP                             02250000
022600             PERFORM 3500-CREATE-AUDIT-NBR                        02260000
022610             IF SU006-LAST-PROGRAM = PC-CHECK-IN-PGM              02261000
022620                MOVE SU006-HOST-SAVE-AREA TO SU001-COMMON-DATA    02262000
022630                MOVE SU006-AUDIT-CNTL-NBR TO SU001-AUDIT-CNTL-NBR 02263000
022640                MOVE SU001-COMMON-DATA TO SU006-HOST-SAVE-AREA    02264000
022650             END-IF                                               02265000
022660                                                                  02266000
022700                                                                  02270000
022800         WHEN EIBAID = DFHPF3                                     02280000
022810             MOVE SU006-HOST-SAVE-AREA TO SU001-COMMON-DATA       02281000
022820             IF SU001-LAST-PROGRAM = PC-CHECK-IN-PGM              02282000
022870                MOVE PC-CHECK-IN-PGM TO  PV-TRANSFER-PROGRAM      02287000
022880                PERFORM 2200-XCTL-TO-SELECTED-PROGRAM             02288000
022890             ELSE                                                 02289000
022891               MOVE PC-RETURN-PGM         TO  PV-TRANSFER-PROGRAM 02289100
022892               PERFORM 2100-XCTL-TO-SELECTED-PROGRAM              02289200
022893             END-IF                                               02289300
022894                                                                  02289400
023131         WHEN EIBAID = DFHPF1                                     02313101
023132              PERFORM 1400-HELP-SCREEN                            02313201
023133                                                                  02313301
023140                                                                  02314001
023200         WHEN OTHER                                               02320000
023300             MOVE PM-UNRECOGNIZED-PF-KEY-MSG  TO  AMSGLNO         02330000
023400                                                                  02340000
023500     END-EVALUATE.                                                02350000
023600                                                                  02360000
023700     PERFORM 8100-SEND-DATA-ONLY.                                 02370000
023800     PERFORM 8200-RETURN-TRANID.                                  02380000
023900                                                                  02390000
024000     GOBACK.                                                      02400000
024100*                                                                 02410000
024200*                                                                 02420000
024300 1200-RECEIVE-MAP.                                                02430000
024400     EXEC CICS                                                    02440000
024500         RECEIVE                                                  02450000
024600             MAP     ('SU509A')                                   02460000
024700             MAPSET  ('SUKM509')                                  02470000
024800             RESP    (PV-CICS-RESPONSE)                           02480000
024900     END-EXEC.                                                    02490000
025000                                                                  02500000
025100     EVALUATE TRUE                                                02510000
025200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02520000
025300              PERFORM 1210-RECEIVE-SCREEN-FIELDS                  02530000
025400         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                02540000
025500              CONTINUE                                            02550000
025600         WHEN OTHER                                               02560000
025700              MOVE '1200-RECEIVE-MAP'                             02570000
025800                                     TO DP013-PARAGRAPH           02580000
025900              MOVE 'UNABLE TO RECEIVE MAP'                        02590000
026000                                     TO DP013-MESSAGE-TEXT (1)    02600000
026100              SET DP013-LOGIC-ABEND  TO TRUE                      02610000
026200              SET DP013-NO-ROLLBACK  TO TRUE                      02620000
026300              PERFORM 9999-WRITE-CICS-LOG-MSG                     02630000
026400     END-EVALUATE.                                                02640000
026500*                                                                 02650000
026600 1210-RECEIVE-SCREEN-FIELDS.                                      02660000
026700*    THE AUDIT NUMBER CHANGED.  MOVE THE NEW VALUE TO THE         02670000
026800*    COMMAREA, AND SET THE FLAG TO SAY IT ISN'T A NEW AUDIT       02680000
026900     IF  ACNTLL > ZERO                                            02690000
026910         IF SU006-AUDIT-CNTL-NBR-X NOT EQUAL ACNTLI               02691000
026920            SET SU006-AUD-FAIL-SCRN-CKED-NO TO TRUE               02692000
026930         END-IF                                                   02693000
027000         MOVE ACNTLI  TO SU006-AUDIT-CNTL-NBR-X                   02700000
027100     END-IF.                                                      02710000
027200*                                                                 02720000
027300     IF  A100L    > ZERO                                          02730000
027400         MOVE A100I     TO  CA-100-CHECK                          02740000
027500     END-IF.                                                      02750000
027600*                                                                 02760000
027700     IF  ASPOTL   > ZERO                                          02770000
027800         MOVE ASPOTI    TO  CA-SPOT-CHECK                         02780000
027900     END-IF.                                                      02790000
028000*                                                                 02800000
028010     IF  AREWRKL  > ZERO                                          02801000
028020         MOVE AREWRKI   TO  CA-REWORK                             02802000
028030     END-IF.                                                      02803000
028040*                                                                 02804000
028100**************************************************************    02810000
028200* EDIT ALL ENTERABLE FIELDS (OPERATING UNIT ID, AND SELECT)  *    02820000
028300**************************************************************    02830000
028400 1300-EDIT-SELECTION.                                             02840000
028500     SET PS-ERRORS-NO                   TO TRUE                   02850000
028600*    IF BOTH OPTIONS ARE SELECTED SEND MESSAGE - SELECT ONE.      02860000
028700     IF  CA-100-CHECK > SPACE                                     02870000
028800     AND CA-SPOT-CHECK > SPACES                                   02880000
028900         MOVE PM-ONLY-ONE-SELECTION-MSG TO  AMSGLNO               02890000
029000         MOVE -1                        TO A100L                  02900000
029100         SET PS-ERRORS-YES              TO TRUE                   02910000
029400     END-IF.                                                      02940000
029500                                                                  02950000
029510     IF  CA-100-CHECK > SPACE                                     02951000
029520     AND CA-REWORK > SPACES                                       02952000
029530         MOVE PM-ONLY-ONE-SELECTION-MSG TO  AMSGLNO               02953000
029540         MOVE -1                        TO A100L                  02954000
029550         SET PS-ERRORS-YES              TO TRUE                   02955000
029560     END-IF.                                                      02956000
029570                                                                  02957000
029590     IF  CA-SPOT-CHECK > SPACES                                   02959000
029591     AND CA-REWORK > SPACE                                        02959100
029592         MOVE PM-ONLY-ONE-SELECTION-MSG TO  AMSGLNO               02959200
029593         MOVE -1                        TO A100L                  02959300
029594         SET PS-ERRORS-YES              TO TRUE                   02959400
029595     END-IF.                                                      02959500
029596                                                                  02959600
029600*    IF THE USER IS CREATING A NEW AUDIT, THEY MUST               02960000
029700*    SELECT ONE OF THE TYPE OPTIONS.                              02970000
029800     IF  CA-100-CHECK = SPACE                                     02980000
029900     AND CA-SPOT-CHECK = SPACES                                   02990000
029910     AND CA-REWORK = SPACES                                       02991000
030000     AND SU006-AUDIT-CNTL-NBR = CA-NEW-AUDIT-CNTL-NBR             03000000
030100         MOVE PM-SELECT-TYPE-MSG        TO  AMSGLNO               03010000
030200         SET PS-ERRORS-YES              TO TRUE                   03020000
030300         MOVE -1                        TO A100L                  03030000
030400*        PERFORM 8100-SEND-DATA-ONLY                              03040000
030500*        PERFORM 8200-RETURN-TRANID                               03050000
030600     END-IF.                                                      03060000
030700                                                                  03070000
030800*    CHECK TO MAKE SURE THE ENTERED AUDIT CNTL NUMBER IS NUMERIC  03080000
030900     MOVE SU006-AUDIT-CNTL-NBR-X     TO DP010I-UNEDITED-FIELD.    03090000
031000     MOVE 9                          TO DP010I-MAXIMUM-DIGITS.    03100000
031100     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  03110000
031200     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     03120000
031300                                                                  03130000
263968     CALL DP010I-NUMERIC-EDIT-ROUTINE                             03141018
263968          USING DP010I-NUMERIC-EDIT-AREA.                         03142018
031500                                                                  03150000
031600     IF  DP010I-ERROR-DETECTED                                    03160000
031700         MOVE PM-NUMERIC-VALUE-REQUIRED-MSG                       03170000
031800                                     TO AMSGLNO                   03180000
031900         MOVE -1                     TO ACNTLL                    03190000
032000         SET PS-ERRORS-YES              TO TRUE                   03200000
032100*        PERFORM 8100-SEND-DATA-ONLY                              03210000
032200*        PERFORM 8200-RETURN-TRANID                               03220000
032300     ELSE                                                         03230000
032400         MOVE DP010I-NUMERIC-FIELD   TO SU006-AUDIT-CNTL-NBR      03240000
032500     END-IF.                                                      03250000
032600                                                                  03260000
032610*    CHECK FOR E-COMMERCE LOCATION AND SET COMMAREA SWITCH        03261000
032620     PERFORM 3300-CHECK-ECOMMERCE-LOCATION                        03262000
032660                                                                  03266000
032670     SET PS-SYSTEM-AUDIT-NOT-FOUND TO TRUE.                       03267000
032680     SET SU006-MANUAL-GENERATED-AUDIT TO TRUE.                    03268000
032690                                                                  03269000
032691     IF SU006-AUDIT-CNTL-NBR NOT = CA-NEW-AUDIT-CNTL-NBR          03269100
032692         PERFORM 3200-SELECT-AUDIT                                03269200
032693     END-IF.                                                      03269300
032694                                                                  03269400
032695**                                                                03269500
032696** FOR A SYTEM GENERATED AUDIT, IF THE STATUS CDE IS 'N', THE     03269600
032697** AUDIT IS NO LONGER NEEDED, AND A MESSAGE IS SENT TO THE SCREEN 03269700
032698** IF THERE IS A DIFFERENT STATUS, THE FAILED AUDIT STATUS SCREEN 03269800
032699** IS CALLED AND WILL DISPLAY FAILED AUDIT INFORMATION.           03269900
032700     IF PS-SYSTEM-AUDIT-FOUND                                     03270000
032701        MOVE 'S'        TO ASPOTO                                 03270100
032702                           CA-SPOT-CHECK                          03270200
032703        MOVE SPACES     TO CA-100-CHECK                           03270300
032704                           CA-REWORK                              03270400
032705                           AREWRKO                                03270500
032706                           A100O                                  03270600
032707        MOVE DP015-ASK-NOR-OFF          TO ASPOTA                 03270700
032708        MOVE DP015-ASK-NOR-OFF          TO A100A                  03270800
032709        MOVE DP015-ASK-NOR-OFF          TO AREWRKA                03270900
032710        IF SUT00015-AUD-STAT-CDE = 'N'                            03271000
032711           PERFORM 3250-LINK-COMMON-CARTON-CLOSE                  03271105
032712           IF ( SU091-SUCCESS )                                   03271205
032713               MOVE PC-AUDIT-NO-LONGER-NEEDED-MSG TO AMSGLNO      03271305
032715               MOVE -1                            TO ACNTLL       03271505
032716               SET PS-ERRORS-YES                  TO TRUE         03271605
032717           ELSE                                                   03271705
032719               MOVE -1                            TO ACNTLL       03271907
032720               SET PS-ERRORS-YES                  TO TRUE         03272007
032721               EVALUATE TRUE                                      03272112
032722                  WHEN SU091-PARAMETER-ERROR                      03272212
032723                      MOVE PC-CCC-PARM-ERR-MSG    TO AMSGLNO      03272312
032724                  WHEN SU091-DB2-ERROR                            03272412
032725                      MOVE PC-CCC-DB2-ERR-MSG     TO AMSGLNO      03272512
032726                  WHEN SU091-MQ-ERROR                             03272612
032727                      MOVE PC-CCC-MQ-ERR-MSG      TO AMSGLNO      03272712
032728                  WHEN SU091-OTHER-ERROR                          03272812
032729                      MOVE PC-CCC-OTHR-ERR-MSG    TO AMSGLNO      03272912
032730               END-EVALUATE                                       03273012
032731           END-IF                                                 03273112
032732           PERFORM 8100-SEND-DATA-ONLY                            03273212
032733           PERFORM 8200-RETURN-TRANID                             03273312
032734        ELSE                                                      03273412
032735           IF (SUT00015-AUD-STAT-CDE = 'I') AND                   03273512
032736                                     SU006-AUD-FAIL-SCRN-CKED-NO  03273612
032737              PERFORM 3400-SELECT-FAILED                          03273712
032738              IF PS-FAILED-AUDITS                                 03273812
032739                 MOVE PC-PREV-FAILED-AUDIT-PGM                    03273912
032740                                     TO PV-TRANSFER-PROGRAM       03274012
032741                 PERFORM 2100-XCTL-TO-SELECTED-PROGRAM            03274112
032742              END-IF                                              03274212
032743           END-IF                                                 03274312
032744        END-IF                                                    03274412
032745     END-IF.                                                      03274512
032750*    SET APPROPRIATE COMMAREA FIELD                               03275000
032751*** CHANGES FOR RFID AUDIT PROJECT                                03275116
032752     IF SU006-SYSTEM-GENERATED-AUDIT                              03275217
032753         MOVE SUT00015-RWRK-AUD-CNTL-NBR                          03275317
032754                            TO SU006-RFID-AUDIT-CNTL-NBR          03275417
032755         IF SU006-RFID-AUDIT-CNTL-NBR > 0                         03275517
032756           SET SU006-QC-AND-RFID-AUD TO TRUE                      03275617
032757           SET SU006-QC-AUDIT TO TRUE                             03275717
032758         ELSE                                                     03275817
032759           IF SUT00015-PKGNG-TYP-CDE = 'RF'                       03275917
032760             SET SU006-RFID-AUDIT TO TRUE                         03276017
032770             SET SU006-RFID-AUD-ONLY TO TRUE                      03277017
032780           ELSE                                                   03278017
032790             SET SU006-QC-AUDIT TO TRUE                           03279017
032791             SET SU006-QC-AUD-ONLY TO TRUE                        03279117
032792           END-IF                                                 03279217
032793         END-IF                                                   03279317
032794     END-IF.                                                      03279417
032795*** CHANGES FOR RFID AUDIT PROJECT                                03279517
032796     IF  CA-100-CHECK > SPACE                                     03279617
032900     AND SU006-AUDIT-CNTL-NBR = CA-NEW-AUDIT-CNTL-NBR             03290000
033000         SET SU006-100-AUDIT-CHECK        TO TRUE                 03300000
033100     ELSE                                                         03310000
033200     IF  CA-SPOT-CHECK > SPACE                                    03320000
033300     AND SU006-AUDIT-CNTL-NBR = CA-NEW-AUDIT-CNTL-NBR             03330000
033400         SET SU006-SPOT-AUDIT-CHECK       TO TRUE                 03340000
033500     END-IF.                                                      03350000
033501     IF  CA-REWORK > SPACE                                        03350100
033502     AND SU006-AUDIT-CNTL-NBR = CA-NEW-AUDIT-CNTL-NBR             03350200
033503         SET SU006-REWORK-AUDIT-CHECK  TO TRUE                    03350300
033504     END-IF.                                                      03350400
033600     IF PS-ERRORS-YES                                             03360000
033700         PERFORM 8100-SEND-DATA-ONLY                              03370000
033800         PERFORM 8200-RETURN-TRANID                               03380000
033900     ELSE                                                         03390000
034000         MOVE -1                     TO ACNTLL                    03400000
034100     END-IF.                                                      03410000
034200*                                                                 03420000
034201 1400-HELP-SCREEN.                                                03420101
034202     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      03420201
034203     MOVE 'SUKRF509'                  TO PC192-PROGRAM-NAME       03420301
034204     COPY PCPD188.                                                03420401
034205     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      03420501
034206     PERFORM 4200-XCTL-TO-HELP.                                   03420601
034207                                                                  03420701
034210*                                                                 03421001
034300 2100-XCTL-TO-SELECTED-PROGRAM.                                   03430000
034400     SET SU006-INITIALIZE-SCREEN                                  03440000
034410         SU006-AUD-FAIL-SCRN-CKED-NO TO TRUE.                     03441000
034500     MOVE LENGTH OF CA-COMMAREA    TO  PV-COMMAREA-LENGTH.        03450000
034600     MOVE PC-CURRENT-PROGRAM-NAME  TO  SU006-LAST-PROGRAM.        03460000
034700                                                                  03470000
034800     EXEC CICS                                                    03480000
034900         XCTL                                                     03490000
035000             PROGRAM   (PV-TRANSFER-PROGRAM)                      03500000
035100             COMMAREA  (CA-COMMAREA)                              03510000
035200             LENGTH    (PV-COMMAREA-LENGTH)                       03520000
035300             RESP      (PV-CICS-RESPONSE)                         03530000
035400     END-EXEC.                                                    03540000
035500                                                                  03550000
035600     EVALUATE TRUE                                                03560000
035700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03570000
035800              CONTINUE                                            03580000
035900         WHEN OTHER                                               03590000
036000              MOVE '2100-XCTL-TO-SELECTED-PROGRAM'                03600000
036100                                     TO DP013-PARAGRAPH           03610000
036200              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       03620000
036300                                     TO DP013-MESSAGE-TEXT (1)    03630000
036400              MOVE PV-TRANSFER-PROGRAM                            03640000
036500                                     TO DP013-MESSAGE-TEXT (2)    03650000
036600              MOVE 'SUKRF508'        TO  SU006-LAST-PROGRAM       03660000
036700              SET DP013-CICS-ABEND   TO TRUE                      03670000
036800              SET DP013-NO-ROLLBACK  TO TRUE                      03680000
036900              PERFORM 9999-WRITE-CICS-LOG-MSG                     03690000
037000              MOVE PM-TRANS-NOT-AVAILABLE-MSG                     03700000
037100                                     TO AMSGLNO                   03710000
037200              SET SU006-PROCESS-SCREEN TO TRUE                    03720000
037300              PERFORM 8100-SEND-DATA-ONLY                         03730000
037400              PERFORM 8200-RETURN-TRANID                          03740000
037500     END-EVALUATE.                                                03750000
037600                                                                  03760000
037610*                                                                 03761000
037620 2200-XCTL-TO-SELECTED-PROGRAM.                                   03762000
037630     SET SU001-INITIALIZE-SCREEN   TO  TRUE.                      03763000
037640     MOVE LENGTH OF SU001-COMMON-DATA TO  PV-COMMAREA-LENGTH.     03764000
037650     MOVE PC-CURRENT-PROGRAM-NAME  TO  SU001-LAST-PROGRAM.        03765000
037660                                                                  03766000
037670     EXEC CICS                                                    03767000
037680         XCTL                                                     03768000
037690             PROGRAM   (PV-TRANSFER-PROGRAM)                      03769000
037691             COMMAREA  (SU001-COMMON-DATA)                        03769100
037692             LENGTH    (PV-COMMAREA-LENGTH)                       03769200
037693             RESP      (PV-CICS-RESPONSE)                         03769300
037694     END-EXEC.                                                    03769400
037695                                                                  03769500
037696     EVALUATE TRUE                                                03769600
037697         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03769700
037698              CONTINUE                                            03769800
037699         WHEN OTHER                                               03769900
037700              MOVE '2200-XCTL-TO-SELECTED-PROGRAM'                03770000
037701                                     TO DP013-PARAGRAPH           03770100
037702              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       03770200
037703                                     TO DP013-MESSAGE-TEXT (1)    03770300
037704              MOVE PV-TRANSFER-PROGRAM                            03770400
037705                                     TO DP013-MESSAGE-TEXT (2)    03770500
037706              MOVE 'SUKRF509'        TO  SU006-LAST-PROGRAM       03770600
037707              SET DP013-CICS-ABEND   TO TRUE                      03770700
037708              SET DP013-NO-ROLLBACK  TO TRUE                      03770800
037709              PERFORM 9999-WRITE-CICS-LOG-MSG                     03770900
037710              MOVE PM-TRANS-NOT-AVAILABLE-MSG                     03771000
037711                                     TO AMSGLNO                   03771100
037712              SET SU006-PROCESS-SCREEN TO TRUE                    03771200
037713              PERFORM 8100-SEND-DATA-ONLY                         03771300
037714              PERFORM 8200-RETURN-TRANID                          03771400
037715     END-EVALUATE.                                                03771500
037716                                                                  03771600
037720****************************************************************  03772000
037800* 3000-VALIDATE-AUDIT-NBR                                      *  03780000
037900*      CHECK THE USER ENTERED AUDIT CONTROL NUMBER - VALIDATE  *  03790000
038000*      EXISTENCE BY GETTING THE AUDIT STATUS                   *  03800000
038100****************************************************************  03810000
038200 3000-VALIDATE-AUDIT-NBR.                                         03820000
038300                                                                  03830000
038400     INITIALIZE DCLTSUNAUD.                                       03840000
038500                                                                  03850000
038600     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              03860000
038700                                                                  03870000
038800     EXEC SQL                                                     03880000
038900         SELECT  AUD_TYP_CDE                                      03890000
039000              ,  AUD_STAT_CDE                                     03900000
039100              ,  PRC_FCLTY_AREA_ID                                03910000
039110              ,  AUD_STRT_TMST                                    03911000
039200           INTO  :SUNAUD-AUD-TYP-CDE                              03920000
039300             ,   :SUNAUD-AUD-STAT-CDE                             03930000
039400             ,   :SUNAUD-PRC-FCLTY-AREA-ID                        03940000
039410             ,   :SUNAUD-AUD-STRT-TMST                            03941000
039500           FROM  TSUNAUD                                          03950000
039600          WHERE  AUD_CNTL_NBR      =  :DK-AUDIT-CNTL-NBR          03960000
039700     END-EXEC.                                                    03970000
039800                                                                  03980000
039900     EVALUATE TRUE                                                03990000
040000*        IF THE AUDIT NUMBER EXISTS, SET THE APPROPRIATE FLAG,    04000000
040100*        AND MOVE THE TYPE AND STATUS ONLY IF THE USER IS NOT     04010000
040200*        TRING TO CREATE A NEW AUDIT (IF SO THE TYPE AND STATUS   04020000
040300*        WILL BE DEFAULTS)                                        04030000
040400         WHEN SQLCODE = ZERO                                      04040000
040500             SET PS-AUDIT-NBR-EXISTS  TO TRUE                     04050000
040600             IF SU006-AUDIT-CNTL-NBR = CA-NEW-AUDIT-CNTL-NBR      04060000
040700                 CONTINUE                                         04070000
040800             ELSE                                                 04080000
040900                 MOVE SUNAUD-AUD-TYP-CDE  TO SU006-AUDIT-TYPE     04090000
041000                 MOVE SUNAUD-AUD-STAT-CDE TO SU006-AUDIT-STATUS   04100000
041100                 MOVE SUNAUD-PRC-FCLTY-AREA-ID                    04110000
041200                                          TO SU006-PRCS-AREA      04120000
041300             END-IF                                               04130000
041400         WHEN SQLCODE = +100                                      04140000
041500             SET PS-AUDIT-NBR-NOT-EXISTS TO TRUE                  04150000
041600         WHEN SQLWARN0 NOT = SPACES                               04160000
041700         WHEN SQLCODE < ZERO                                      04170000
041800         WHEN SQLCODE > ZERO                                      04180000
041900             MOVE '3000-VALIDATE-AUDIT-NBR.'                      04190000
042000                 TO DP013-PARAGRAPH                               04200000
042100             MOVE 'SELECT OF TSUNAUD TABLE'                       04210000
042200                 TO DP013-MESSAGE-TEXT (1)                        04220000
042300             MOVE SU006-AUDIT-CNTL-NBR-X                          04230000
042400                 TO DP013-MESSAGE-TEXT (2)                        04240000
042500             MOVE SQLCA            TO DP013-SQLCA                 04250000
042600             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    04260000
042700             SET DP013-DB2-ABEND   TO TRUE                        04270000
042800             SET DP013-NO-ROLLBACK TO TRUE                        04280000
042900             PERFORM 9999-WRITE-CICS-LOG-MSG                      04290000
043000             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               04300000
043100             MOVE -1                     TO  ACNTLL               04310000
043200             PERFORM 8100-SEND-DATA-ONLY                          04320000
043300             PERFORM 8200-RETURN-TRANID                           04330000
043400     END-EVALUATE.                                                04340000
043500                                                                  04350000
043510                                                                  04351000
043520 3200-SELECT-AUDIT.                                               04352000
043530                                                                  04353000
043540     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              04354000
043550                                                                  04355000
043551     EXEC SQL                                                     04355100
043552       SELECT PO_NBR                                              04355200
043553           ,  PO_LNE_NBR                                          04355300
043554           ,  PO_PREPK_ID                                         04355400
043556           ,  DAYS(CURRENT DATE) - (B.CK_AFT_DAY_QTY + 1)         04355600
043557           ,  AUD_STAT_CDE                                        04355700
043558           ,  COALESCE(RWRK_AUD_CNTL_NBR,0)                       04355817
043559           ,  A.PKGNG_TYP_CDE                                     04355913
043560       INTO   :SUT00015-PO-NBR                                    04356013
043561           ,  :SUT00015-PO-LNE-NBR                                04356113
043562           ,  :SUT00015-PO-PREPK-ID                               04356213
043563           ,  :PV-LIMIT-DAYS                                      04356313
043564           ,  :SUT00015-AUD-STAT-CDE                              04356413
043565           ,  :SUT00015-RWRK-AUD-CNTL-NBR                         04356513
043566           ,  :SUT00015-PKGNG-TYP-CDE                             04356613
043567       FROM   SUT_PO_AUD_REQ A                                    04356713
043568           ,  SUT_PO_AUD_PARM B                                   04356813
043569       WHERE  A.AUD_CNTL_NBR  = :DK-AUDIT-CNTL-NBR                04356913
043570         AND  A.VND_RNKG_CDE  = B.VND_RNKG_CDE                    04357013
043571         AND  A.PKGNG_TYP_CDE = B.PKGNG_TYP_CDE                   04357113
043572         AND  A.EFF_BEG_TMST  = B.EFF_BEG_TMST                    04357213
043580     END-EXEC.                                                    04358013
043601                                                                  04360100
043602     EVALUATE TRUE                                                04360200
043603         WHEN SQLCODE = ZERO                                      04360300
043604             SET PS-SYSTEM-AUDIT-FOUND TO TRUE                    04360400
043605             SET SU006-SYSTEM-GENERATED-AUDIT TO TRUE             04360500
043606                                                                  04360600
043607         WHEN SQLCODE = +100                                      04360700
043608             SET PS-SYSTEM-AUDIT-NOT-FOUND TO TRUE                04360800
043609                                                                  04360900
043610         WHEN SQLWARN0 NOT = SPACES                               04361000
043611         WHEN SQLCODE < ZERO                                      04361100
043612         WHEN SQLCODE > ZERO                                      04361200
043613             MOVE '3200-SELECT-AUDIT'                             04361300
043614                 TO DP013-PARAGRAPH                               04361400
043615             MOVE 'SELECT OF SUT_PO_AUD_REQ'                      04361500
043616                 TO DP013-MESSAGE-TEXT (1)                        04361600
043617             MOVE SU006-AUDIT-CNTL-NBR-X                          04361700
043618                 TO DP013-MESSAGE-TEXT (2)                        04361800
043619             MOVE SQLCA            TO DP013-SQLCA                 04361900
043620             MOVE 'SUT00015'       TO DP013-DB2-TABLE-NAME (1)    04362000
043621             SET DP013-DB2-ABEND   TO TRUE                        04362100
043622             SET DP013-NO-ROLLBACK TO TRUE                        04362200
043623             PERFORM 9999-WRITE-CICS-LOG-MSG                      04362300
043624             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               04362400
043625             PERFORM 8100-SEND-DATA-ONLY                          04362500
043626             PERFORM 8200-RETURN-TRANID                           04362600
043627     END-EVALUATE.                                                04362700
043630/                                                                 04363005
043640**************************************************************    04364005
043650* 3250-LINK-COMMON-CARTON-CLOSE                              *    04365005
043660*     WHEN APPLICABLE FILL IN COPYBOOK SUWS091               *    04366005
043670*                     LINK TO SUKCS769                       *    04367005
043680*                     CHECK RETURN FOR ERRORS UPON RETURN    *    04368005
043681**************************************************************    04368105
043682 3250-LINK-COMMON-CARTON-CLOSE.                                   04368205
043683                                                                  04368305
043684     INITIALIZE CCC-REQUEST-COMMUNICATION-AREA.                   04368411
043685                                                                  04368511
043686     MOVE '00'                    TO SU091-RET-CODE.              04368605
043691     MOVE PC-CURRENT-PROGRAM-NAME TO SU091-CALLING-PGM.           04369105
043692     MOVE SU006-OPER-UNT-ID       TO SU091-OPER-UNT-ID.           04369205
043693                                                                  04369306
043694     IF ( SU006-SHIP-UNIT-NBR NUMERIC )                           04369406
043695         MOVE SU006-SHIP-UNIT-NBR TO SU091-SHIPT-UNT-ID           04369506
043696     ELSE                                                         04369606
043697         MOVE ZEROS               TO SU091-SHIPT-UNT-ID           04369706
043698     END-IF.                                                      04369806
043699                                                                  04369906
043700     MOVE SU006-AUDIT-CNTL-NBR    TO SU091-AUD-CNTL-NBR.          04370005
043701     MOVE SUT00015-AUD-STAT-CDE   TO SU091-AUD-STAT-CDE.          04370105
043702                                                                  04370205
043703     IF ( SU006-SYSTEM-GENERATED-AUDIT )                          04370305
043704         SET SU091-PROMPTED-AUDIT TO TRUE                         04370405
043705     ELSE                                                         04370505
043706         IF ( SU006-MANUAL-GENERATED-AUDIT )                      04370605
043707             SET SU091-MANUAL-AUDIT TO TRUE                       04370705
043708         END-IF                                                   04370805
043709     END-IF.                                                      04370905
043710                                                                  04371005
043711     MOVE SU006-USERID            TO SU091-ASSOC-ID.              04371105
043712                                                                  04371205
043713     EXEC CICS LINK                                               04371305
043714               PROGRAM  (PC-COMMON-CARTON-CLOSE-PGM)              04371405
043715               COMMAREA (CCC-REQUEST-COMMUNICATION-AREA)          04371505
043716               LENGTH   (LENGTH OF CCC-REQUEST-COMMUNICATION-AREA)04371605
043717               RESP     (PV-CICS-RESPONSE)                        04371705
043718     END-EXEC.                                                    04371805
043719                                                                  04371905
043720     EVALUATE TRUE                                                04372005
043721         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 04372105
043722             CONTINUE                                             04372205
043723         WHEN OTHER                                               04372305
043724             MOVE '3250-LINK-COMMON-CARTON-CLOSE'                 04372405
043725               TO DP013-PARAGRAPH                                 04372505
043726             MOVE 'BAD LINK TO PGM SUKCS769'                      04372605
043727               TO DP013-MESSAGE-TEXT (1)                          04372705
043728             SET DP013-CICS-ABEND     TO TRUE                     04372809
043729             SET DP013-NO-ROLLBACK    TO TRUE                     04372909
043730             PERFORM 9999-WRITE-CICS-LOG-MSG                      04373005
043731             MOVE PC-CCC-PGM-LINK-ERR TO AMSGLNO                  04373109
043732             PERFORM 8100-SEND-DATA-ONLY                          04373209
043733             PERFORM 8200-RETURN-TRANID                           04373309
043734     END-EVALUATE.                                                04373405
043735                                                                  04373505
043736/                                                                 04373605
043737                                                                  04373700
043738 3300-CHECK-ECOMMERCE-LOCATION.                                   04373800
043739     SET SU006-NON-ECOMMERCE-LOCATION TO TRUE.                    04373900
043740     MOVE SU006-OPER-UNT-ID  TO DK-OPER-UNT-ID.                   04374000
043741                                                                  04374100
043742     EXEC SQL                                                     04374200
043743          SELECT  LOC_TYP_CDE                                     04374304
043744                , E_BUS_IND                                       04374404
043745          INTO    :XLT00010-LOC-TYP-CDE                           04374504
043746                , :XLT00010-E-BUS-IND                             04374604
043747          FROM   XLT_LOC                                          04374704
043748          WHERE  LOC_NBR   = :DK-OPER-UNT-ID                      04374804
043749     END-EXEC.                                                    04374900
043750                                                                  04375000
043751                                                                  04375100
043752     EVALUATE TRUE                                                04375200
043753         WHEN SQLCODE = ZERO                                      04375300
043754           IF XLT00010-LOC-TYP-CDE = 'DC' AND                     04375404
043755              XLT00010-E-BUS-IND   = 'Y'                          04375504
043756                SET SU006-ECOMMERCE-LOCATION TO TRUE              04375600
043757           END-IF                                                 04375700
043758                                                                  04375800
043759         WHEN SQLCODE = +100                                      04375900
043760         WHEN SQLCODE = -305                                      04376017
043761              MOVE SPACES  TO  XLT00010-LOC-TYP-CDE               04376117
043762                               XLT00010-E-BUS-IND                 04376217
043764                                                                  04376417
043765         WHEN SQLWARN0 NOT = SPACES                               04376517
043766         WHEN SQLCODE < ZERO                                      04376617
043767         WHEN SQLCODE > ZERO                                      04376717
043768             MOVE '3300-CHECK-ECOMMERCE-LOCATION'                 04376817
043769                 TO DP013-PARAGRAPH                               04376917
043770             MOVE 'SELECT OF XLT_LOC '                            04377017
043771                 TO DP013-MESSAGE-TEXT (1)                        04377117
043772             STRING 'AUDIT NUMBER '        DELIMITED BY SIZE      04377217
043773                    'WAS: '                DELIMITED BY SIZE      04377317
043774                    SU006-AUDIT-CNTL-NBR-X DELIMITED BY SIZE      04377417
043775                                 INTO DP013-MESSAGE-TEXT (2)      04377517
043776             MOVE DK-OPER-UNT-ID TO PV-DISPLAY-LOC-NBR            04377617
043777             STRING 'LOCATION NUMBER '   DELIMITED BY SIZE        04377717
043778                    'WAS: '              DELIMITED BY SIZE        04377817
043779                    PV-DISPLAY-LOC-NBR   DELIMITED BY SIZE        04377917
043780                                 INTO DP013-MESSAGE-TEXT (3)      04378017
043781             MOVE SQLCA            TO DP013-SQLCA                 04378117
043782             MOVE 'XLT_LOC '       TO DP013-DB2-TABLE-NAME (1)    04378217
043783             SET DP013-DB2-ABEND   TO TRUE                        04378317
043784             SET DP013-NO-ROLLBACK TO TRUE                        04378417
043785             PERFORM 9999-WRITE-CICS-LOG-MSG                      04378517
043786             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               04378617
043787             PERFORM 8100-SEND-DATA-ONLY                          04378717
043788             PERFORM 8200-RETURN-TRANID                           04378817
043789     END-EVALUATE.                                                04378917
043790                                                                  04379017
043791                                                                  04379117
043792 3400-SELECT-FAILED.                                              04379217
043793                                                                  04379317
043794     EXEC SQL                                                     04379417
043795          SELECT AUD_CNTL_NBR                                     04379517
043796          INTO   :SUT00015-AUD-CNTL-NBR                           04379617
043797          FROM   SUT_PO_AUD_REQ                                   04379717
043798          WHERE  PO_NBR         = :SUT00015-PO-NBR                04379817
043799            AND  PO_LNE_NBR     = :SUT00015-PO-LNE-NBR            04379917
043800            AND  PO_PREPK_ID    = :SUT00015-PO-PREPK-ID           04380017
043801            AND  AUD_STAT_CDE   = :PC-F                           04380117
043802            AND  DAYS(CRE_TMST) > :PV-LIMIT-DAYS                  04380217
043803     END-EXEC.                                                    04380317
043804                                                                  04380417
043805     EVALUATE TRUE                                                04380517
043806         WHEN SQLCODE = ZERO                                      04380617
043807         WHEN SQLCODE = -811                                      04380717
043808             SET PS-FAILED-AUDITS     TO TRUE                     04380817
043809         WHEN SQLCODE = +100                                      04380917
043810             SET PS-NO-FAILED-AUDITS  TO TRUE                     04381017
043811         WHEN SQLWARN0 NOT = SPACES                               04381117
043812         WHEN SQLCODE < ZERO                                      04381217
043813         WHEN SQLCODE > ZERO                                      04381317
043814             MOVE '3400-SELECT-FAILED'                            04381417
043815                 TO DP013-PARAGRAPH                               04381517
043816             MOVE 'SELECT OF SUT_PO_AUD_REQ TBL'                  04381617
043817                 TO DP013-MESSAGE-TEXT (1)                        04381717
043818             MOVE SUT00015-PO-NBR  TO PV-DISPLAY-PO-NBR           04381817
043819             STRING 'PO NBR: '         DELIMITED BY SIZE          04381917
043820                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          04382017
043821                           INTO DP013-MESSAGE-TEXT(2)             04382117
043822             STRING 'PO LINE NBR: '    DELIMITED BY SIZE          04382217
043823                PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE          04382317
043824                           INTO DP013-MESSAGE-TEXT(3)             04382417
043825             MOVE SUT00015-PO-PREPK-ID TO PV-DISPLAY-PREPK-ID     04382517
043826             STRING 'PRE PACK ID: '    DELIMITED BY SIZE          04382617
043827                PV-DISPLAY-PREPK-ID    DELIMITED BY SIZE          04382717
043828                           INTO DP013-MESSAGE-TEXT(4)             04382817
043829             MOVE SQLCA            TO DP013-SQLCA                 04382917
043830             MOVE 'SUT00015'       TO DP013-DB2-TABLE-NAME (1)    04383017
043831             SET DP013-DB2-ABEND   TO TRUE                        04383117
043832             SET DP013-NO-ROLLBACK TO TRUE                        04383217
043833             PERFORM 9999-WRITE-CICS-LOG-MSG                      04383317
043834             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               04383417
043835             PERFORM 8100-SEND-DATA-ONLY                          04383517
043836             PERFORM 8200-RETURN-TRANID                           04383617
043837     END-EVALUATE.                                                04383717
043838                                                                  04383817
043839                                                                  04383917
043840****************************************************************  04384017
043841* 3500-CREATE-AUDIT-NBR                                        *  04384117
043850*   CREATE A NEW RANDOMLY GENERATED AUDIT NBR                  *  04385000
043900****************************************************************  04390000
044000 3500-CREATE-AUDIT-NBR.                                           04400000
044100                                                                  04410000
044200     SET PS-AUDIT-NBR-EXISTS  TO TRUE.                            04420000
044300                                                                  04430000
044400*    CONTINUE TO CREATE NEW NUMBERS UNTIL ONE IS FOUND THAT DOES  04440000
044500*    NOT EXIST                                                    04450000
044600     PERFORM UNTIL PS-AUDIT-NBR-NOT-EXISTS                        04460000
044700         PERFORM 4000-CREATE-RANDOM-NBR                           04470000
044800                                                                  04480000
044900         MOVE DP902-RANDOM-NUMBER TO SU006-AUDIT-CNTL-NBR         04490000
045000                                     CA-NEW-AUDIT-CNTL-NBR        04500000
045100         PERFORM 3000-VALIDATE-AUDIT-NBR                          04510000
045200     END-PERFORM.                                                 04520000
045300                                                                  04530000
045400     MOVE SU006-AUDIT-CNTL-NBR-X TO ACNTLI.                       04540000
045500     MOVE -1                  TO A100L.                           04550000
045600                                                                  04560000
045700****************************************************************  04570000
045800* 3510-INSERT-TSUNAUD.                                         *  04580000
045900*   INSERT A NEW SHIPPING UNID AUDIT RECORD                    *  04590000
046000****************************************************************  04600000
046100 3510-INSERT-TSUNAUD.                                             04610000
046200                                                                  04620000
046300     INITIALIZE DCLTSUNAUD.                                       04630000
046400                                                                  04640000
046500     MOVE SU006-AUDIT-CNTL-NBR    TO SUNAUD-AUD-CNTL-NBR.         04650000
046600     MOVE +0                      TO SUNAUD-AUD-PSPND-MNIT-QTY    04660000
046700                                     SUNAUD-AUD-CLO-MNIT-QTY.     04670000
046800     MOVE SU006-USERID            TO SUNAUD-AUD-USR-ID.           04680000
046900     MOVE SU006-OPER-UNT-ID       TO SUNAUD-OPER-UNT-ID.          04690000
047000     MOVE 1                       TO SUNAUD-FCLTY-ID.             04700000
047100     EVALUATE TRUE                                                04710000
047200         WHEN SU006-RECV-PRCS-AREA                                04720000
047300             MOVE 'RECV  '        TO SUNAUD-PRC-FCLTY-AREA-ID     04730000
047400         WHEN SU006-FLAT-PRCS-AREA                                04740000
047500             MOVE 'FLAT  '        TO SUNAUD-PRC-FCLTY-AREA-ID     04750000
047600         WHEN SU006-SHIP-PRCS-AREA                                04760000
047700             MOVE 'SHIP  '        TO SUNAUD-PRC-FCLTY-AREA-ID     04770000
047800     END-EVALUATE.                                                04780000
047900                                                                  04790000
048000     SET SU006-AUDIT-INPROCESS    TO TRUE.                        04800000
048100     MOVE SU006-AUDIT-STATUS      TO SUNAUD-AUD-STAT-CDE.         04810000
048200     MOVE SU006-AUDIT-TYPE        TO SUNAUD-AUD-TYP-CDE.          04820000
048300                                                                  04830000
048400     EXEC SQL                                                     04840000
048500         INSERT INTO TSUNAUD                                      04850000
048600             ( AUD_CNTL_NBR                                       04860000
048700              ,AUD_STRT_TMST                                      04870000
048800              ,AUD_STP_TMST                                       04880000
048900              ,AUD_PSPND_MNIT_QTY                                 04890000
049000              ,AUD_CLO_MNIT_QTY                                   04900000
049100              ,AUD_USR_ID                                         04910000
049200              ,OPER_UNT_ID                                        04920000
049300              ,FCLTY_ID                                           04930000
049400              ,PRC_FCLTY_AREA_ID                                  04940000
049500              ,AUD_STAT_CDE                                       04950000
049600              ,AUD_TYP_CDE                                        04960000
049700             )                                                    04970000
049800         VALUES                                                   04980000
049900             (                                                    04990000
050000               :SUNAUD-AUD-CNTL-NBR                               05000000
050100             , CURRENT TIMESTAMP                                  05010000
050200             , '9999-09-09-09.09.09.999999'                       05020000
050300             , :SUNAUD-AUD-PSPND-MNIT-QTY                         05030000
050400             , :SUNAUD-AUD-CLO-MNIT-QTY                           05040000
050500             , :SUNAUD-AUD-USR-ID                                 05050000
050600             , :SUNAUD-OPER-UNT-ID                                05060000
050700             , :SUNAUD-FCLTY-ID                                   05070000
050800             , :SUNAUD-PRC-FCLTY-AREA-ID                          05080000
050900             , :SUNAUD-AUD-STAT-CDE                               05090000
051000             , :SUNAUD-AUD-TYP-CDE                                05100000
051100             )                                                    05110000
051200     END-EXEC.                                                    05120000
051300                                                                  05130000
051400     EVALUATE TRUE                                                05140000
051500         WHEN SQLCODE = ZERO                                      05150000
051600              MOVE PC-OPEN-CARTON-SCREEN                          05160000
051700                                     TO  PV-TRANSFER-PROGRAM      05170000
051800              PERFORM 2100-XCTL-TO-SELECTED-PROGRAM               05180000
051900         WHEN SQLCODE = -803                                      05190000
052000             MOVE PM-CREATE-CNTL-NBR-MSG                          05200000
052100                                        TO  AMSGLNO               05210000
052200         WHEN SQLWARN0 NOT = SPACES                               05220000
052300         WHEN SQLCODE < ZERO                                      05230000
052400         WHEN SQLCODE > ZERO                                      05240000
052500             MOVE '3510-INSERT-TSUNAUD.' TO DP013-PARAGRAPH       05250000
052600             MOVE 'INSERT TSUNADU'       TO DP013-MESSAGE-TEXT (1)05260000
052700             MOVE SU006-AUDIT-CNTL-NBR-X TO DP013-MESSAGE-TEXT (2)05270000
052800             MOVE SQLCA                  TO DP013-SQLCA           05280000
052900             MOVE 'TSUNAUD'            TO DP013-DB2-TABLE-NAME (1)05290000
053000             SET DP013-DB2-ABEND         TO TRUE                  05300000
053100             SET DP013-NO-ROLLBACK       TO TRUE                  05310000
053200             PERFORM 9999-WRITE-CICS-LOG-MSG                      05320000
053300             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               05330000
053400             MOVE -1                     TO  ACNTLL               05340000
053500             PERFORM 8100-SEND-DATA-ONLY                          05350000
053600             PERFORM 8200-RETURN-TRANID                           05360000
053700     END-EVALUATE.                                                05370000
053800                                                                  05380000
053810 3550-UPDATE-TSUNAUD.                                             05381000
053820                                                                  05382000
053830     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              05383000
053840                                                                  05384000
053850     EXEC SQL                                                     05385000
053860         UPDATE TSUNAUD                                           05386000
053870                                                                  05387000
053880         SET    AUD_STRT_TMST  =  CURRENT TIMESTAMP               05388000
053890         WHERE  AUD_CNTL_NBR   = :DK-AUDIT-CNTL-NBR               05389000
053892     END-EXEC.                                                    05389200
053893                                                                  05389300
053894     EVALUATE TRUE                                                05389400
053895         WHEN SQLCODE = ZERO                                      05389500
053896             CONTINUE                                             05389600
053897         WHEN SQLWARN0 NOT = SPACES                               05389700
053898         WHEN SQLCODE < ZERO                                      05389800
053899         WHEN SQLCODE > ZERO                                      05389900
053900             MOVE '3550-UPDATE-TSUNAUD'                           05390000
053901                 TO DP013-PARAGRAPH                               05390100
053902             MOVE 'UPDATE OF TSUNAUD'                             05390200
053903                 TO DP013-MESSAGE-TEXT (1)                        05390300
053904             MOVE SU006-AUDIT-CNTL-NBR-X                          05390400
053905                 TO DP013-MESSAGE-TEXT (2)                        05390500
053906             MOVE SQLCA            TO DP013-SQLCA                 05390600
053907             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    05390700
053908             SET DP013-DB2-ABEND   TO TRUE                        05390800
053909             SET DP013-NO-ROLLBACK TO TRUE                        05390900
053910             PERFORM 9999-WRITE-CICS-LOG-MSG                      05391000
053911             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               05391100
053912             PERFORM 8100-SEND-DATA-ONLY                          05391200
053913             PERFORM 8200-RETURN-TRANID                           05391300
053914     END-EVALUATE.                                                05391400
053915                                                                  05391500
053920                                                                  05392000
054000******************************************************************05400000
054100*  4000-CREATE-RANDOM-NBR                                        *05410000
054200*  THIS PARAGRAPH WILL RANDOMLY CREATE A NEW AUDIT CNTL NUMBER   *05420000
054300******************************************************************05430000
054400 4000-CREATE-RANDOM-NBR.                                          05440000
054500                                                                  05450000
054600     INITIALIZE DP902-RANDNBR-ROUTINE-FIELDS.                     05460000
054700     CALL PC-RANDOM-NBR-GENERATOR USING                           05470000
054800                            DFHEIBLK                              05480000
054900                            DFHCOMMAREA                           05490000
055000                            DP902-RANDNBR-ROUTINE-FIELDS.         05500000
055100                                                                  05510000
055200     IF DP902-SUCCESSFUL                                          05520000
055300         CONTINUE                                                 05530000
055400     ELSE                                                         05540000
055500         MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO                   05550000
055600         PERFORM 8100-SEND-DATA-ONLY                              05560000
055700         PERFORM 8200-RETURN-TRANID                               05570000
055800     END-IF.                                                      05580000
055900*                                                                 05590001
056000 4200-XCTL-TO-HELP.                                               05600001
056010                                                                  05601001
056020     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH.      05602001
056030     SET  SU006-INITIALIZE-SCREEN     TO TRUE.                    05603001
056040     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA.    05604001
056050                                                                  05605001
056060     EXEC CICS                                                    05606001
056070         XCTL                                                     05607001
056071             PROGRAM   (PV-TRANSFER-PROGRAM)                      05607101
056072             COMMAREA  (PC192-COMMAREA)                           05607201
056073             LENGTH    (PV-COMMAREA-LENGTH)                       05607301
056074             RESP      (PV-CICS-RESPONSE)                         05607401
056075     END-EXEC.                                                    05607501
056076                                                                  05607601
056077     EVALUATE TRUE                                                05607701
056078         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05607801
056079              CONTINUE                                            05607901
056080         WHEN OTHER                                               05608001
056081             MOVE '4200-XCTL-TO-HELP '                            05608101
056082                 TO DP013-PARAGRAPH                               05608201
056083             MOVE 'SUKRF509 - UNABLE TO XCTL TO PROGRAM: '        05608301
056084                 TO DP013-MESSAGE-TEXT (1)                        05608401
056085             MOVE PV-TRANSFER-PROGRAM                             05608501
056086                 TO DP013-MESSAGE-TEXT (2)                        05608601
056087             SET DP013-CICS-ABEND  TO TRUE                        05608701
056088             SET DP013-ROLLBACK TO TRUE                           05608801
056089             PERFORM 9999-WRITE-CICS-LOG-MSG                      05608901
056090             MOVE PC-TRANS-UNAVAILABLE-MSG TO AMSGLNO             05609001
056091             SET SU006-PROCESS-SCREEN TO TRUE                     05609101
056092             PERFORM 8000-SEND-MAP                                05609201
056093             PERFORM 8200-RETURN-TRANID                           05609301
056094     END-EVALUATE.                                                05609401
056095******************************************************************05609500
056100*  8000-SEND-MAP                                                 *05610000
056200*  SEND THE REFRESHED MAP IMAGE TO THE SCREEN                    *05620000
056300******************************************************************05630000
056400 8000-SEND-MAP.                                                   05640000
056500     EXEC CICS                                                    05650000
056600         SEND                                                     05660000
056700             MAP     ('SU509A')                                   05670000
056800             MAPSET  ('SUKM509')                                  05680000
056900             ERASE                                                05690000
057000             RESP    (PV-CICS-RESPONSE)                           05700000
057100     END-EXEC.                                                    05710000
057200                                                                  05720000
057300     EVALUATE TRUE                                                05730000
057400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05740000
057500             CONTINUE                                             05750000
057600         WHEN OTHER                                               05760000
057700             MOVE '8000-SEND-MAP'   TO DP013-PARAGRAPH            05770000
057800             MOVE 'UNABLE TO SEND MAP'                            05780000
057900                                    TO DP013-MESSAGE-TEXT (1)     05790000
058000             SET DP013-CICS-ABEND   TO TRUE                       05800000
058100             SET DP013-NO-ROLLBACK  TO TRUE                       05810000
058200             PERFORM 9999-WRITE-CICS-LOG-MSG                      05820000
058300     END-EVALUATE.                                                05830000
058400*                                                                 05840000
058500 8100-SEND-DATA-ONLY.                                             05850000
058600                                                                  05860000
058700     EXEC CICS                                                    05870000
058800         SEND                                                     05880000
058900             MAP       ('SU509A')                                 05890000
059000             MAPSET    ('SUKM509')                                05900000
059100             CURSOR                                               05910000
059200             DATAONLY                                             05920000
059300             RESP      (PV-CICS-RESPONSE)                         05930000
059400     END-EXEC.                                                    05940000
059500                                                                  05950000
059600     EVALUATE TRUE                                                05960000
059700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05970000
059800             CONTINUE                                             05980000
059900         WHEN OTHER                                               05990000
060000             MOVE '8100-SEND-DATA-ONLY'                           06000000
060100                                    TO DP013-PARAGRAPH            06010000
060200             MOVE 'UNABLE TO SEND DATA'                           06020000
060300                                    TO DP013-MESSAGE-TEXT (1)     06030000
060400             SET DP013-CICS-ABEND   TO TRUE                       06040000
060500             SET DP013-NO-ROLLBACK  TO TRUE                       06050000
060600             PERFORM 9999-WRITE-CICS-LOG-MSG                      06060000
060700     END-EVALUATE.                                                06070000
060800*                                                                 06080000
060900 8200-RETURN-TRANID.                                              06090000
061000     MOVE LENGTH OF CA-COMMAREA  TO  PV-COMMAREA-LENGTH.          06100000
061100                                                                  06110000
061200     EXEC CICS                                                    06120000
061300         RETURN                                                   06130000
061400             TRANSID   (PC-CURRENT-TRANID)                        06140000
061500             COMMAREA  (CA-COMMAREA)                              06150000
061600             LENGTH    (PV-COMMAREA-LENGTH)                       06160000
061700             RESP      (PV-CICS-RESPONSE)                         06170000
061800     END-EXEC.                                                    06180000
061900                                                                  06190000
062000     EVALUATE TRUE                                                06200000
062100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06210000
062200             CONTINUE                                             06220000
062300         WHEN OTHER                                               06230000
062400             MOVE '8200-RETURN-TRANID'                            06240000
062500                                    TO DP013-PARAGRAPH            06250000
062600             MOVE 'UNABLE TO RETURN TO TRANID'                    06260000
062700                                    TO DP013-MESSAGE-TEXT (1)     06270000
062800             SET DP013-CICS-ABEND   TO TRUE                       06280000
062900             SET DP013-NO-ROLLBACK  TO TRUE                       06290000
063000             PERFORM 9999-WRITE-CICS-LOG-MSG                      06300000
063100     END-EVALUATE.                                                06310000
063200*                                                                 06320000
063300*                                                                 06330000
063400 9999-WRITE-CICS-LOG-MSG.                                         06340000
063500     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            06350000
063600     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           06360000
063700     INITIALIZE DP013-SRC-TASK-NUMBER                             06370000
063800                DP013-STACK.                                      06380000
063900     SET DP013-LINK-RETURN           TO TRUE.                     06390000
064000                                                                  06400000
064100     EXEC CICS                                                    06410000
064200         LINK                                                     06420000
064300             PROGRAM   (DP013-NAME)                               06430000
064400             COMMAREA  (DP013-PARAMETERS)                         06440000
064500             LENGTH    (DP013-LENGTH)                             06450000
064600     END-EXEC.                                                    06460000
