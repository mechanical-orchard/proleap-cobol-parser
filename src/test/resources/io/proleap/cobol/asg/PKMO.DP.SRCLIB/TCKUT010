000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.             TCKUT010.                                00050000
000600 AUTHOR.                 J MYERS.                                 00060000
000700 INSTALLATION.           KOHLS.                                   00070000
000800 DATE-WRITTEN            05/2002.                                 00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100***************************************************************** 00110000
001200*  PURPOSE:                                                       00120000
001300*  CREATE MULTIPLE FLAT FILES.                                    00130000
001400*     ONE WILL BE TO UPDATE THE TEPCRD TABLE FOR PROCESSED TRANS  00140000
001500*     ONE WILL BE TO SEND TO AJB FOR REAUTHORIZATION              00150000
001600*     ONE WILL BE A FILE OF LATES/ VOIDS/ SALES AFTER SETTLEMENT  00160000
001700*         FILE WAS SENT FIFTH THIRD                               00170000
001800*     ONE WILL HAVE THE REPORT DETAIL RECORDS FOR A LATER REPORT  00180000
001900*         PROGRAM                                                 00190000
002000***************************************************************** 00200000
P9696 *                                                                *00210000
P9696 * DATE:        2014-01-20                                        *00220000
P9696 * WR/IR#:      P9696 - AJB SETTLEMENT                            *00230000
P9696 * PROGRAMMER:  COGNIZANT                                         *00240000
P9696 * DESCRIPTION: INCLUDED TC007-ORG-STR-NBR AND TC007-AUTH-REF-NBR *00250000
P9696 *              FIELD IN TCRD007 COPYBOOK AND ADDED LOGIC TO      *00260000
P9696 *              POPULATE ORIGINAL STORE TO TC005-STR-NBR, AUTH    *00270000
P9696 *              REFERENCE NUMBER TO TC005-AUTH-REF-NBR.           *00280000
P9696 *              REMOVED 7210-SELECT-TEPCRR PARA AND REFERENCES TO *00290000
P9696 *              THE PARA, THIS IS COVERED IN TCKUT009 PROGRAM.    *00300000
P9696 *              INCREASED LRECL OF INP02 INPUT FILE TO 266.       *00310000
P9696 *              TC007-ORG-STR-NBR WILL HOLD ORIGINAL STORE        *00320000
P9696 *              NUMBER FOR ALL TRANSACTIONS AND WILL BE PASSED TO *00330000
P9696 *              TC005-STR-NBR. THIS ORIGINAL STORE NUMBER IS      *00340000
P9696 *              NEEDED FOR RECONCILIATION PURPOSE IN TCK459       *00350000
P9696 *              WHEN TRANSACTIONS COMES FROM AJB IN RECONCILATION *00360000
P9696 *              FILE. TC007-STR-NBR WILL HOLD SETTLE STORE NUMBER *00370000
P9696 *              AND WILL BE PASSED TO TC005-SETTLE-STR-NBR        *00380000
002000***************************************************************** 00390000
P9696 *                                                                *00400000
P9696 * DATE:        2014-03-28                                        *00410000
P9696 * WR/IR#:      8446E - BOPUS PROJECT                             *00420000
P9696 * PROGRAMMER:  BARB SCHULTZ                                      *00430000
P9696 * DESCRIPTION: MOVE THE ORIGINATING STORE NUMBER FROM TCRD007 TO *00440000
P9696 *              TCRD008.                                          *00450000
P9696 *----------------------------------------------------------------*00460000
VDAFIX***************************************************************** 00470000
VDAFIX*                                                                *00480000
VDAFIX* DATE:        2016-02-25                                        *00490000
VDAFIX* CHG#:        CHG0132848                                         00500000
VDAFIX* PROGRAMMER:  COGNIZANT                                         *00510000
VDAFIX* DESCRIPTION: THIS IS TO ELIMINATE THE DUPLICATE TRANSACTION    *00520000
VDAFIX* WHEN THE VOID OF NORMAL TRANSACTION COMES AS LATE.              00530000
VDAFIX* ORIGINAL TRANSACTION POSTED IN PRE SETTLEMENT AT 10 PM AND      00540000
VDAFIX* VOID AFTER COMES AFTER 10 PM.THIS PROGRAM WRITES ONE MORE       00550000
VDAFIX* RECORD FOR THE REVERSAL WHICH EVENTUALLY END UP IN DUPLICATE.   00560000
VDAFIX*----------------------------------------------------------------*00570000
SHIP  * DATE:        04/18/2019                                        *00580000
SHIP  * WR/IR#:      CHG0220426                                        *00590000
SHIP  * PROGRAMMER:  BARB SCHULTZ                                      *00600000
SHIP  * DESCRIPTION: MOVED 4 NEW FIELDS FROM TCRD007 TO TCRD005.       *00610000
SHIP  *              THIS WAS DONE FOR THE SETTLE BY SHIP PROJECT.     *00620000
SHIP  *----------------------------------------------------------------*00630000
SHIP2 * DATE:        01/21/2020                                        *00640000
SHIP2 * WR/IR#:      CHG0233046                                        *00650000
SHIP2 * PROGRAMMER:  BARB SCHULTZ                                      *00660000
SHIP2 * DESCRIPTION: DELETED THE MC FIELDS TO USE THE VISA FIELD.      *00670000
SHIP2 *              BOTH VISA AND MC ARE GOING TO BE USING THE SAME   *00680000
SHIP2 *              MULT CLEAR FIELDS FROM THE DATABASE. MOVE THE     *00690000
SHIP2 *              PARTIAL SHIPMENT INDICATOR FROM TCRD007 TO TCRD005*00700000
SHIP2 *----------------------------------------------------------------*00710000
052523*  CHANGE MADE: ADD CHANGES FOR NEW COBRAND TENDER TYPE           00711000
052523*               ADD CHANGES FOR NEW COBRAND PAYMENTS              00712000
052523*  DATE: 05/25/2023                                               00713000
052523*  MADE BY: DAN PAYNTER              WR/IR #: CHG0289014          00714000
052523*----------------------------------------------------------------*00714100
002100 ENVIRONMENT DIVISION.                                            00720000
002200***************************************************************** 00730000
002300                                                                  00740000
002400 CONFIGURATION SECTION.                                           00750000
002500                                                                  00760000
002600 SOURCE-COMPUTER.        IBM-3090.                                00770000
002700                                                                  00780000
002800 OBJECT-COMPUTER.        IBM-3090.                                00790000
002900                                                                  00800000
003000 INPUT-OUTPUT SECTION.                                            00810000
003100                                                                  00820000
003200 FILE-CONTROL.                                                    00830000
003300                                                                  00840000
003400     SELECT BANK-SETTLE-FILE                                      00850000
003500         ASSIGN TO INP01.                                         00860000
003600                                                                  00870000
003700     SELECT DAILY-COSA-FILE                                       00880000
003800         ASSIGN TO INP02.                                         00890000
003900                                                                  00900000
004000     SELECT UPDATE-EXTRACT-FILE                                   00910000
004100         ASSIGN TO OUT01.                                         00920000
004200                                                                  00930000
004300     SELECT AJB-EXTRACT-FILE                                      00940000
004400         ASSIGN TO OUT02.                                         00950000
004500                                                                  00960000
004600     SELECT UNP-BANK-SETTLE-FILE                                  00970000
004700         ASSIGN TO OUT03.                                         00980000
004800                                                                  00990000
004900     SELECT REPORT-EXTRACT-FILE                                   01000000
005000         ASSIGN TO OUT04.                                         01010000
005100                                                                  01020000
005200******************************************************************01030000
005300 DATA DIVISION.                                                   01040000
005400******************************************************************01050000
005500                                                                  01060000
005600 FILE SECTION.                                                    01070000
005700                                                                  01080000
005800 FD  BANK-SETTLE-FILE                                             01090000
005900     RECORDING MODE IS F                                          01100000
006000     BLOCK CONTAINS 0 RECORDS.                                    01110000
006100                                                                  01120000
006200 01  BANK-SETTLE-REC             PIC X(298).                      01130000
006300                                                                  01140000
006400 FD  DAILY-COSA-FILE                                              01150000
006500     RECORDING MODE IS F                                          01160000
006600     BLOCK CONTAINS 0 RECORDS.                                    01170000
006700                                                                  01180000
P9696  01  DAILY-COSA-REC              PIC X(288).                      01190000
006900                                                                  01200000
007000 FD  UPDATE-EXTRACT-FILE                                          01210000
007100     RECORDING MODE IS F                                          01220000
007200     LABEL RECORDS ARE STANDARD                                   01230000
007300     BLOCK CONTAINS 0 RECORDS                                     01240000
052523     RECORD CONTAINS 100 CHARACTERS.                              01250000
007500                                                                  01260000
052523 01  UPDATE-EXTRACT-RECORD         PIC X(100).                    01270000
007700                                                                  01280000
007800 FD  AJB-EXTRACT-FILE                                             01290000
007900     RECORDING MODE IS F                                          01300000
008000     LABEL RECORDS ARE STANDARD                                   01310000
008100     BLOCK CONTAINS 0 RECORDS                                     01320000
008200     RECORD CONTAINS 298 CHARACTERS.                              01330000
008300                                                                  01340000
008400 01  AJB-EXTRACT-REC               PIC X(298).                    01350000
008500                                                                  01360000
008600 FD  UNP-BANK-SETTLE-FILE                                         01370000
008700     RECORDING MODE IS F                                          01380000
008800     LABEL RECORDS ARE STANDARD                                   01390000
008900     BLOCK CONTAINS 0 RECORDS                                     01400000
009000     RECORD CONTAINS 298 CHARACTERS.                              01410000
009100                                                                  01420000
009200 01  UNP-BANK-SETTLE-REC           PIC X(298).                    01430000
009300                                                                  01440000
009400 FD  REPORT-EXTRACT-FILE                                          01450000
009500     RECORDING MODE IS F                                          01460000
009600     LABEL RECORDS ARE STANDARD                                   01470000
009700     BLOCK CONTAINS 0 RECORDS                                     01480000
052523     RECORD CONTAINS 100 CHARACTERS.                              01490000
009900                                                                  01500000
052523 01  REPORT-EXTRACT-REC            PIC X(100).                    01510000
010100                                                                  01520000
010200******************************************************************01530000
010300 WORKING-STORAGE SECTION.                                         01540000
010400******************************************************************01550000
010500 01  FILLER                            PIC X(50)  VALUE           01560000
010600     ' *** WORKING STORAGE STARTS HERE FOR TCKUT010 *** '.        01570000
010700                                                                  01580000
010800******************************************************************01590000
010900*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)            *01600000
011000******************************************************************01610000
011100     COPY DPWS500.                                                01620000
011200                                                                  01630000
011300 01  AC-ABEND-CODE                      PIC S9(04) VALUE ZERO     01640000
011400                                                  COMP SYNC.      01650000
011500     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    01660000
011600     88  AC-FILE-SEQUENCE-ERROR                   VALUE +4007.    01670000
011700     88  AC-DB2-ERROR                             VALUE +4013.    01680000
011800     88  AC-CALENDAR-ROUTINE-ERROR                VALUE +4019.    01690000
011900                                                                  01700000
012000  01  PS-PROGRAM-SWITCHES.                                        01710000
012100     05  PS-END-OF-CONTROL-FILE-SW     PIC X(01)  VALUE 'N'.      01720000
012200         88  PS-END-OF-CONTROL-FILE               VALUE 'Y'.      01730000
012300     05  PS-END-OF-SETTLE-SW           PIC X(01)  VALUE 'N'.      01740000
012400         88  PS-NOT-END-OF-SETTLE-FILE            VALUE 'N'.      01750000
012500         88  PS-END-OF-SETTLE-FILE                VALUE 'Y'.      01760000
012600     05  PS-END-OF-COSA-SW             PIC X(01)  VALUE 'N'.      01770000
012700         88  PS-NOT-END-OF-COSA-FILE              VALUE 'N'.      01780000
012800         88  PS-END-OF-COSA-FILE                  VALUE 'Y'.      01790000
012900     05  PS-MOVE-FILE-SW               PIC X(01)  VALUE ' '.      01800000
013000         88  PS-TC007-MOVE                        VALUE '7'.      01810000
013100         88  PS-TC005-MOVE                        VALUE '5'.      01820000
013200     05  PS-TYPE-OF-STORE-SW           PIC X(01)  VALUE ' '.      01830000
013300         88  PS-ECOMM-STORE                       VALUE 'E'.      01840000
013400         88  PS-NOT-ECOMM-STORE                   VALUE 'N'.      01850000
013500     05  PS-VOID-TRANS-SW              PIC X(01)  VALUE ' '.      01860000
013600         88  PS-VOID-TRANS                        VALUE 'Y'.      01870000
013700         88  PS-NOT-VOID-TRANS                    VALUE 'N'.      01880000
013800     05  PS-RETURN-TRANS-SW            PIC X(01)  VALUE ' '.      01890000
013900         88  PS-RETURN-TRANS                      VALUE 'Y'.      01900000
014000         88  PS-NOT-RETURN-TRANS                  VALUE 'N'.      01910000
014100     05  PS-NEED-REAUTH-SW             PIC X(01)  VALUE ' '.      01920000
014200         88  PS-NEED-REAUTH                       VALUE 'Y'.      01930000
014300         88  PS-NO-NEED-REAUTH                    VALUE 'N'.      01940000
014400     05  PS-SETTLE-REC-SW              PIC X(01)  VALUE ' '.      01950000
014500         88  PS-SETTLE-REC                        VALUE 'Y'.      01960000
014600         88  PS-NOT-SETTLE-REC                    VALUE 'N'.      01970000
014400     05  PS-VOID-AFTER-LATE-SW         PIC X(01)  VALUE ' '.      01980000
014500         88  PS-VOID-AFTER-LATE-NO                VALUE 'N'.      01990000
014600         88  PS-VOID-AFTER-LATE-YES               VALUE 'Y'.      02000000
014700                                                                  02010000
014800******************************************************************02020000
014900*   PROGRAM CONSTANTS                                            *02030000
015000******************************************************************02040000
015100 01  PC-CONSTANTS.                                                02050000
015200     05  PC-PROGRAM-NAME               PIC  X(08) VALUE           02060000
015300                                                 'TCKUT010'.      02070000
015400                                                                  02080000
015500 01  WS-SETTLE-KEY.                                               02090000
015600     05  WS-SETTLE-SALES-DATE          PIC X(10).                 02100000
015700     05  WS-SETTLE-STORE-NBR           PIC X(04).                 02110000
015800     05  WS-SETTLE-REG-NBR             PIC X(04).                 02120000
015900     05  WS-SETTLE-TRAN-NBR            PIC X(04).                 02130000
016000     05  WS-SETTLE-STR-TIME            PIC X(08).                 02140000
016100     05  WS-SETTLE-CORR-SEQ            PIC X(04).                 02150000
016150     05  WS-SETTLE-TNDR-SEQ-NBR        PIC X(04).                 02160000
016200                                                                  02170000
016300 01  WS-COSA-KEY.                                                 02180000
016400     05  WS-COSA-SALES-DATE            PIC X(10).                 02190000
016500     05  WS-COSA-STORE-NBR             PIC X(04).                 02200000
016600     05  WS-COSA-REG-NBR               PIC X(04).                 02210000
016700     05  WS-COSA-TRAN-NBR              PIC X(04).                 02220000
016800     05  WS-COSA-STR-TIME              PIC X(08).                 02230000
016900     05  WS-COSA-CORR-SEQ              PIC X(04).                 02240000
016950     05  WS-COSA-TNDR-SEQ-NBR          PIC X(04).                 02250000
017000                                                                  02260000
017100 01  PV-PROGRAM-VARIABLES.                                        02270000
017200     05  PV-PARAGRAPH-NAME             PIC  X(30) VALUE SPACE.    02280000
017300     05  PV-OPERATION-MSG-1            PIC  X(40) VALUE SPACE.    02290000
017400     05  PV-OPERATION-MSG-2            PIC  X(40) VALUE SPACE.    02300000
017500     05  PV-DB2-OPERATION              PIC  X(30) VALUE SPACE.    02310000
017600     05  PV-DB2-ERROR-MSG              PIC  X(40) VALUE SPACE.    02320000
017700     05  PV-RETURN-ORD-NBR             PIC  X(40) VALUE SPACE.    02330000
017800     05  PV-ECOMM-REAUTH-IND           PIC  X(01) VALUE SPACE.    02340000
017900     05  PV-COSA-STORE-NBR             PIC  S9(04) COMP VALUE 0.  02350000
034400     05  PV-STR-NBR                    PIC  S9(04) COMP VALUE 0.  02360000
034400     05  PV-HOLD-STORE-NBR             PIC  S9(04) COMP VALUE 0.  02370000
034400     05  PV-HOLD-STR-NBR               PIC  S9(04) COMP VALUE 0.  02380000
           05  PV-NUM-MERCHANT-NBR           PIC  9(15) VALUE ZEROES.   02390000
018000                                                                  02400000
018100******************************************************************02410000
018200*  WORK AREA LAYOUT TO SETTLED / UNSETTLED CREDIT TRANSACTION    *02420000
018300*  THIS IS A COPY OF TCRD005 BECAUSE THAT COPYBOOK IS USED FOR   *02430000
018400*  CREATION OF NEW SETTLE/UNSETTLED TRANSACTIONS                 *02440000
018500******************************************************************02450000
018600     COPY TCRD005 REPLACING 'TC005-' BY 'WK005-'.                 02460000
018700***************************************************************** 02470000
018800*  PREV SETTLEMENT FILE                                           02480000
018900******************************************************************02490000
019000     COPY TCRD005.                                                02500000
019100                                                                  02510000
019200***************************************************************** 02520000
019300*  DAILY COSA INPUT FILE                                          02530000
019400******************************************************************02540000
019500     COPY TCRD007.                                                02550000
019600                                                                  02560000
019700***************************************************************** 02570000
019800*  UPDATE EXTRACT FILE LAYOUT                                     02580000
019900******************************************************************02590000
020000     COPY TCRD009.                                                02600000
020100                                                                  02610000
020200***************************************************************** 02620000
020300*  REPORT EXTRACT FILE LAYOUT                                     02630000
020400******************************************************************02640000
020500     COPY TCRD008.                                                02650000
020600                                                                  02660000
020700***************************************************************** 02670000
020800*  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            02680000
020900******************************************************************02690000
021000     COPY DPWS004.                                                02700000
021100                                                                  02710000
021200******************************************************************02720000
021300*  DB2 COMMUNICATION AREA.                                        02730000
021400******************************************************************02740000
021500     EXEC SQL                                                     02750000
021600          INCLUDE SQLCA                                           02760000
021700     END-EXEC.                                                    02770000
021800                                                                  02780000
022600******************************************************************02790000
022700*  DB2 TABLE DB2PDBA.TEPIRT  - ITEM RETURN INFORMATION TABLE      02800000
022800******************************************************************02810000
022900     EXEC SQL                                                     02820000
023000          INCLUDE TEPIRT                                          02830000
023100     END-EXEC.                                                    02840000
023200                                                                  02850000
023300******************************************************************02860000
023400*  DB2 TABLE DB2PDBA.TEPPART - PARTN TABLE                        02870000
023500******************************************************************02880000
023600     EXEC SQL                                                     02890000
023700          INCLUDE TEPPART                                         02900000
023800     END-EXEC.                                                    02910000
023900                                                                  02920000
024000******************************************************************02930000
024100*  DB2 TABLE DB2PDBA.TEPORD  - ORDER TABLE                        02940000
024200******************************************************************02950000
024300     EXEC SQL                                                     02960000
024400          INCLUDE TEPORD                                          02970000
024500     END-EXEC.                                                    02980000
024600                                                                  02990000
024700******************************************************************03000000
024800*  LOCATION DOMAIN TABLE                                          03010000
024900******************************************************************03020000
025000     EXEC SQL                                                     03030000
025100          INCLUDE XST00001                                        03040000
025200     END-EXEC.                                                    03050000
024700******************************************************************03060000
024800*  LOCATION ATTRIBUTE TABLE                                       03070000
024900******************************************************************03080000
025000     EXEC SQL                                                     03090000
025100          INCLUDE XST00025                                        03100000
025200     END-EXEC.                                                    03110000
025300                                                                  03120000
015000******************************************************************03130000
015100*  DB2 TABLE DB2PDBA.TEPTRN - TRANSACTION TABLE                   03140000
015200******************************************************************03150000
015300     EXEC SQL                                                     03160000
015400          INCLUDE TEPTRN                                          03170000
015500     END-EXEC.                                                    03180000
015600                                                                  03190000
016310******************************************************************03200000
016320*  DB2 TABLE DB2PDBA.TEPVDA - VOID TABLE                          03210000
016330******************************************************************03220000
016340     EXEC SQL                                                     03230000
016350          INCLUDE TEPVDA                                          03240000
016360     END-EXEC.                                                    03250000
016370                                                                  03260000
025400******************************************************************03270000
025500*  ORIG-INFO-CSR RETURN ORIGINAL INFO FOR A RETURN TRANSACTION    03280000
025600******************************************************************03290000
025700     EXEC SQL                                                     03300000
025800         DECLARE ORIG-INFO-CSR   CURSOR                           03310000
025900         FOR SELECT ORIG_SLS_DTE                                  03320000
026000                   ,ORIG_STR_NBR                                  03330000
026100                   ,ORIG_RGST_ID                                  03340000
026200                   ,ORIG_TRN_NBR                                  03350000
026300                   ,ORIG_STRT_TM                                  03360000
026400          FROM  TEPIRT   A                                        03370000
026500               ,XST_LOC  B                                        03380000
026600          WHERE A.PARTN_NBR         = :TC007-PARTN-NBR            03390000
026700            AND A.STR_NBR           = :TC007-STR-NBR              03400000
026800            AND A.RGST_ID           = :TC007-RGST-ID              03410000
026900            AND A.TRN_NBR           = :TC007-TRN-NBR              03420000
027000            AND A.STRT_TM           = :TC007-STRT-TM              03430000
027100            AND A.SLS_CORR_SEQ_NBR  = :TC007-SLS-CORR-SEQ-NBR     03440000
027200            AND A.STR_NBR           = B.LOC_NBR                   03450000
027300            AND B.E_BUS_IND         = 'Y'                         03460000
027400     END-EXEC.                                                    03470000
027500                                                                  03480000
027600 PROCEDURE DIVISION.                                              03490000
027700                                                                  03500000
027800******************************************************************03510000
027900* 0000-MAINLINE-PARAGRAPH                                         03520000
028000******************************************************************03530000
028100 0000-MAINLINE-PARAGRAPH.                                         03540000
028200                                                                  03550000
028300     PERFORM 1000-INITIALIZE-PROGRAM.                             03560000
028400     PERFORM 8000-READ-BANK-SETTLE-FILE.                          03570000
028500     PERFORM 8100-READ-DAILY-COSA-FILE.                           03580000
028600                                                                  03590000
028700     PERFORM 2000-PROCESS                                         03600000
028800           UNTIL PS-END-OF-SETTLE-FILE AND PS-END-OF-COSA-FILE.   03610000
028900                                                                  03620000
029000     CLOSE BANK-SETTLE-FILE                                       03630000
029100           DAILY-COSA-FILE                                        03640000
029200           AJB-EXTRACT-FILE                                       03650000
029300           UNP-BANK-SETTLE-FILE                                   03660000
029400           REPORT-EXTRACT-FILE                                    03670000
029500           UPDATE-EXTRACT-FILE.                                   03680000
029600                                                                  03690000
029700     GOBACK.                                                      03700000
029800                                                                  03710000
029900******************************************************************03720000
030000* 1000-INITIALIZE-PROGRAM                                         03730000
030100*     OPEN FILES                                                  03740000
030200******************************************************************03750000
030300 1000-INITIALIZE-PROGRAM.                                         03760000
030400                                                                  03770000
030500     OPEN INPUT  BANK-SETTLE-FILE                                 03780000
030600                 DAILY-COSA-FILE                                  03790000
030700          OUTPUT AJB-EXTRACT-FILE                                 03800000
030800                 UPDATE-EXTRACT-FILE                              03810000
030900                 UNP-BANK-SETTLE-FILE                             03820000
031000                 REPORT-EXTRACT-FILE.                             03830000
031100                                                                  03840000
031200***************************************************************** 03850000
031300* 2000-PROCESS                                                    03860000
031400*      PROCESS TRAN CDE = P (PREV PROCESSED RECORDS)              03870000
031500*      MATCH PROCESS OF THE PREV SETTLE AND DAILY COSA EXTRACT    03880000
031600*      KEYS ARE                                                   03890000
031700*      WS-SETTLE-SALES-DATE        WS-COSA-SALES-DATE             03900000
031800*      WS-SETTLE-STORE-NBR         WS-COSA-STORE-NBR              03910000
031900*      WS-SETTLE-REG-NBR           WS-COSA-REG-NBR                03920000
032000*      WS-SETTLE-TRAN-NBR          WS-COSA-TRAN-NBR               03930000
032100*      WS-SETTLE-STR-TIME          WS-COSA-STR-TIME               03940000
032200*      WS-SETTLE-CORR-SEQ          WS-COSA-CORR-SEQ               03950000
032200*      WS-SETTLE-TNDR-SEQ-NBR      WS-COSA-TNDR-SEQ-NBR           03960000
032300***************************************************************** 03970000
032400  2000-PROCESS.                                                   03980000
032500                                                                  03990000
032600     MOVE SPACES                 TO PS-MOVE-FILE-SW               04000000
032700                                    PV-ECOMM-REAUTH-IND.          04010000
032800     SET PS-SETTLE-REC           TO TRUE.                         04020000
032900     SET PS-NOT-VOID-TRANS       TO TRUE.                         04030000
033000     SET PS-NOT-RETURN-TRANS     TO TRUE.                         04040000
033100     SET PS-NO-NEED-REAUTH       TO TRUE.                         04050000
033200                                                                  04060000
033300     IF WK005-TRAN-CDE  = 'P'                                     04070000
033400         SET PS-TC005-MOVE       TO TRUE                          04080000
033500         SET PS-NOT-VOID-TRANS   TO TRUE                          04090000
033600         PERFORM 3000-PREV-PROCESS-FILE                           04100000
033700             UNTIL WK005-TRAN-CDE NOT = 'P'                       04110000
                      OR PS-END-OF-SETTLE-FILE                          04120000
033800     END-IF.                                                      04130000
033900                                                                  04140000
034000***************************************************************** 04150000
034100*      ONLY GET STORE INFO FOR CHANGES IN STORE NUMBER            04160000
034200***************************************************************** 04170000
XXXXXX     IF TC005-SETTLE-STORE-NBR  NOT = PV-COSA-STORE-NBR           04180000
XXXXXX         MOVE TC005-SETTLE-STORE-NBR TO PV-COSA-STORE-NBR         04190000
XXXXXX         MOVE TC005-SETTLE-STORE-NBR TO PV-STR-NBR                04200000
034500         PERFORM 7000-GET-STORE-INFO                              04210000
034600     END-IF.                                                      04220000
034700                                                                  04230000
034800     IF WS-COSA-KEY = WS-SETTLE-KEY                               04231000
034900         PERFORM 4000-MATCH-PROCESS                               04250000
035000         PERFORM 8000-READ-BANK-SETTLE-FILE                       04260000
035100         PERFORM 8100-READ-DAILY-COSA-FILE                        04270000
035200     ELSE                                                         04280000
035300         IF WS-COSA-KEY < WS-SETTLE-KEY                           04290000
035400***************************************************************** 04300000
035500*      NO VOIDS WILL WRAP TO SETTLE FILE                          04310000
035600***************************************************************** 04320000
035700             IF TC007-VOID-ABRT-CDE = 'N'                         04330000
035800                 SET PS-NOT-SETTLE-REC TO TRUE                    04340000
035900                 PERFORM 5000-NEW-SETTLE-REC                      04350000
036000             END-IF                                               04360000
036100             PERFORM 8100-READ-DAILY-COSA-FILE                    04370000
036200         ELSE                                                     04380000
035300*            DISPLAY 'VOID AFTER OF A SALE THAT IS A LATE SALE '  04390000
035300*            DISPLAY 'OR A CORRECTION OF A SALE '                 04400000
035300             DISPLAY 'WS-COSA-KEY ' WS-COSA-KEY                   04410000
035300             DISPLAY 'WS-SETTLE-KEY ' WS-SETTLE-KEY               04420000
037500                PERFORM 6000-CREATE-REPORT-LINES                  04430000
037600                PERFORM 6100-WRITE-REPORT-LINES                   04440000
035000                PERFORM 8000-READ-BANK-SETTLE-FILE                04450000
036400         END-IF                                                   04460000
036500     END-IF.                                                      04470000
036600                                                                  04480000
036700***************************************************************** 04490000
036800*  3000-PREV-PROCESS-FILE                                         04500000
036900*       PROCESS ALL 'P' ALREADY SETTLED RECORDS                   04510000
037000*       RECORDS THAT HAVE BEEN SETTLED AT BANK CREATE UPDATES TO  04520000
037100*       COSA TABLES                                               04530000
037200***************************************************************** 04540000
037300 3000-PREV-PROCESS-FILE.                                          04550000
037400                                                                  04560000
037500     PERFORM 6000-CREATE-REPORT-LINES.                            04570000
037600     PERFORM 6100-WRITE-REPORT-LINES.                             04580000
037700     PERFORM 6200-CREATE-UPDATE-RECORD.                           04590000
037800     PERFORM 6300-WRITE-UPDATE-EXTRACT-REC.                       04600000
037900                                                                  04610000
038000     PERFORM 8000-READ-BANK-SETTLE-FILE.                          04620000
038100                                                                  04630000
038200***************************************************************** 04640000
038300* 4000-MATCH-PROCESS                                              04650000
038400*      PROCESS WHEN MATCHED ON KEYS.                              04660000
038500***************************************************************** 04670000
038600 4000-MATCH-PROCESS.                                              04680000
038700                                                                  04690000
038800     SET PS-TC007-MOVE           TO TRUE.                         04700000
038900                                                                  04710000
           SET PS-VOID-AFTER-LATE-NO   TO TRUE.                         04720000
                                                                        04730000
039000***************************************************************** 04740000
039100*     VOID ABRT CODE OF 'N' MEANS NORMAL "NO VOID"                04750000
039200*                                                                 04760000
039300*     VOID-AFTER CANNOT BE DONE ON AN E-COMMERCE TRANSACTION SO   04770000
039400*     LOGIC TO HANDLE THAT SITUATION, AS IN 5000-NEW-SETTLE-REC,  04780000
039500*     DOES NOT HAVE TO BE IN THE MATCH-PROCESS.                   04790000
039600***************************************************************** 04800000
VDAFIX     IF TC007-VOID-ABRT-CDE = 'V'                                 04810000
VDAFIX       PERFORM 4500-CHECK-TRAN                                    04820000
VDAFIX     END-IF.                                                      04830000
039700     IF TC007-VOID-ABRT-CDE = 'N' OR PS-VOID-AFTER-LATE-YES       04840000
039800         SET PS-NOT-VOID-TRANS   TO TRUE                          04850000
039900         PERFORM 6200-CREATE-UPDATE-RECORD                        04860000
040000         PERFORM 6300-WRITE-UPDATE-EXTRACT-REC                    04870000
040100         PERFORM 6000-CREATE-REPORT-LINES                         04880000
040200         PERFORM 6100-WRITE-REPORT-LINES                          04890000
040300     ELSE                                                         04900000
040400         SET PS-VOID-TRANS       TO TRUE                          04910000
040500         SET PS-NOT-SETTLE-REC   TO TRUE                          04920000
040600         PERFORM 6400-CREATE-NEXT-SETTLE                          04930000
040700         PERFORM 6500-WRITE-NEXT-SETTLE                           04940000
040800         PERFORM 6000-CREATE-REPORT-LINES                         04950000
040900         PERFORM 6100-WRITE-REPORT-LINES                          04960000
M41000     END-IF.                                                      04970000
041100                                                                  04980000
VDAFIX***************************************************************** 04990000
VDAFIX* 4500-CHECK-TRAN                                                 05000000
VDAFIX* CHECK IF VOID AFTER IS LATE OR NOT. IF VOID AFTER IS LATE       05010000
VDAFIX* THEN REVERSAL RECORD WILL NOT BE WRITTEN. TCKKUT011 WILL TAKE   05020000
VDAFIX* OF REVERSAL SETTLEMENT FOR LATE VOID AFTER                      05030000
VDAFIX***************************************************************** 05040000
VDAFIX  4500-CHECK-TRAN.                                                05050000
VDAFIX     EXEC SQL                                                     05060000
VDAFIX             SELECT T.STR_NBR                                     05070000
VDAFIX             INTO :EPTRN-STR-NBR                                  05080000
VDAFIX             FROM                                                 05090000
VDAFIX                     TEPVDA  V                                    05100000
VDAFIX                   , TEPTRN  T                                    05110000
VDAFIX             WHERE                                                05120000
VDAFIX                      T.PARTN_NBR       = :WK005-PARTN-NBR        05130000
VDAFIX                  AND T.STR_NBR         = :WK005-STR-NBR          05140000
VDAFIX                  AND T.RGST_ID         = :WK005-RGST-ID          05150000
VDAFIX                  AND T.TRN_NBR         = :WK005-TRN-NBR          05160000
VDAFIX                  AND T.STRT_TM         = :WK005-STRT-TM          05170000
VDAFIX                  AND T.SLS_CORR_SEQ_NBR =:WK005-SLS-CORR-SEQ-NBR 05180000
VDAFIX                  AND T.PARTN_NBR       = V.PARTN_NBR             05190000
VDAFIX                  AND T.STR_NBR         = V.STR_NBR               05200000
VDAFIX                  AND T.RGST_ID         = V.RGST_ID               05210000
VDAFIX                  AND T.TRN_NBR         = V.VOID_TRN_NBR          05220000
VDAFIX                  AND V.SLS_CORR_SEQ_NBR < 0                      05230000
VDAFIX     END-EXEC.                                                    05240000
VDAFIX     EVALUATE TRUE                                                05250000
VDAFIX         WHEN SQLCODE = ZERO                                      05260000
VDAFIX         WHEN SQLCODE = -811                                      05270000
VDAFIX              SET PS-VOID-AFTER-LATE-YES TO TRUE                  05280000
VDAFIX         WHEN SQLCODE = +100                                      05290000
VDAFIX              SET PS-VOID-AFTER-LATE-NO  TO TRUE                  05300000
VDAFIX         WHEN SQLWARN0 NOT EQUAL SPACE                            05310000
VDAFIX         WHEN SQLCODE NOT EQUAL ZERO                              05320000
VDAFIX             MOVE '4500-CHECK-TRAN'                               05330000
VDAFIX                                            TO PV-PARAGRAPH-NAME  05340000
VDAFIX             MOVE 'SELECT ERROR ON 4500 PARA'                     05350000
VDAFIX                                            TO PV-DB2-OPERATION   05360000
VDAFIX             PERFORM 9800-SQL-ABEND                               05370000
VDAFIX     END-EVALUATE.                                                05380000
041200***************************************************************** 05390000
041300* 5000-NEW-SETTLE-REC                                             05400000
041400*     PROCESS OF NEW SALES/VOIDS/LATES RECORDS THAT NEED TO GO    05410000
041500*     INTO A FILE TO SETTLE WITH THE BANK TOMORROW.               05420000
041600*     REPORTING/SETTLEMENT RECORDS CREATED                        05430000
041700***************************************************************** 05440000
041800  5000-NEW-SETTLE-REC.                                            05450000
041900                                                                  05460000
042000     SET PS-TC007-MOVE           TO TRUE.                         05470000
042100                                                                  05480000
042400***************************************************************** 05490000
042500*     XST00001-E-BUS-IND   = 'Y'  IS AN ECOMM TRANSACTION         05500000
042600***************************************************************** 05510000
042700     IF TC007-E-BUS-IND   = 'Y'                                   05520000
043100         PERFORM 7100-GET-ECOM-INFO                               05530000
043200         PERFORM 7200-CHECK-ECOMM-REAUTH                          05540000
043300         IF PS-NEED-REAUTH                                        05550000
043400             PERFORM 6600-CREATE-AJB-RECORDS                      05560000
043500             PERFORM 6700-WRITE-AJB-RECORDS                       05570000
043600             PERFORM 6000-CREATE-REPORT-LINES                     05580000
043700             PERFORM 6100-WRITE-REPORT-LINES                      05590000
043800         ELSE                                                     05600000
043900             PERFORM 6400-CREATE-NEXT-SETTLE                      05610000
044000             PERFORM 6500-WRITE-NEXT-SETTLE                       05620000
044100             PERFORM 6000-CREATE-REPORT-LINES                     05630000
044200             PERFORM 6100-WRITE-REPORT-LINES                      05640000
044300         END-IF                                                   05650000
044500     ELSE                                                         05660000
044600***************************************************************** 05670000
044700*      CHECK IF ORIGINAL SALE STORE IS ECOMM STORE                05680000
044800*      IF RETURN IS FROM AN ECOM STORE GET ECOMM ORD NBR          05690000
044900***************************************************************** 05700000
045000         IF TC007-TRN-TYP-CDE = '11'                              05710000
045100             SET PS-RETURN-TRANS TO TRUE                          05720000
045200             PERFORM 7300-CHECK-FOR-RETURN                        05730000
045300             IF PS-ECOMM-STORE                                    05740000
045400                 PERFORM 7400-GET-ORIG-ORD-NBR                    05750000
045500                 PERFORM 6400-CREATE-NEXT-SETTLE                  05760000
045600                 PERFORM 6500-WRITE-NEXT-SETTLE                   05770000
045700                 PERFORM 6000-CREATE-REPORT-LINES                 05780000
045800                 PERFORM 6100-WRITE-REPORT-LINES                  05790000
045900             ELSE                                                 05800000
046000                 PERFORM 6400-CREATE-NEXT-SETTLE                  05810000
046100                 PERFORM 6500-WRITE-NEXT-SETTLE                   05820000
046200                 PERFORM 6000-CREATE-REPORT-LINES                 05830000
046300                 PERFORM 6100-WRITE-REPORT-LINES                  05840000
046400             END-IF                                               05850000
046500         ELSE                                                     05860000
046600             PERFORM 6400-CREATE-NEXT-SETTLE                      05870000
046700             PERFORM 6500-WRITE-NEXT-SETTLE                       05880000
046800             PERFORM 6000-CREATE-REPORT-LINES                     05890000
046900             PERFORM 6100-WRITE-REPORT-LINES                      05900000
047000         END-IF                                                   05910000
047100     END-IF.                                                      05920000
047200                                                                  05930000
047300***************************************************************** 05940000
047400*  6000-CREATE-REPORT-LINES                                       05950000
047500*     CREATE REPORT LINES                                         05960000
047600***************************************************************** 05970000
047700 6000-CREATE-REPORT-LINES.                                        05980000
047800                                                                  05990000
047900     INITIALIZE TC008-EXTRACT-RECORD.                             06000000
048000                                                                  06010000
034300     IF TC007-STR-NBR NOT = PV-HOLD-STORE-NBR                     06020000
034400         MOVE TC007-STR-NBR      TO PV-HOLD-STORE-NBR             06030000
034300         MOVE TC007-STR-NBR TO PV-STR-NBR                         06040000
034500         PERFORM 7000-GET-STORE-INFO                              06050000
034600     END-IF.                                                      06060000
048000                                                                  06070000
048100     IF PS-TC007-MOVE                                             06080000
048200         MOVE TC007-PARTN-NBR    TO  TC008-PARTN-NBR              06090000
048300         MOVE TC007-STR-NBR      TO  TC008-STR-NBR                06100000
048400         MOVE TC007-RGST-ID      TO  TC008-RGST-ID                06110000
048500         MOVE TC007-TRN-NBR      TO  TC008-TRN-NBR                06120000
048600         MOVE TC007-STRT-TM      TO  TC008-STRT-TM                06130000
048700         MOVE TC007-SLS-CORR-SEQ-NBR                              06140000
048800                                 TO  TC008-SLS-CORR-SEQ-NBR       06150000
048900         MOVE TC007-TNDR-SEQ-NBR TO  TC008-TNDR-SEQ-NBR           06160000
049000         MOVE TC007-TRN-TYP-CDE  TO  TC008-TRN-TYP-CDE            06170000
049100         MOVE TC007-SLS-DTE      TO  TC008-SLS-DTE                06180000
049200         MOVE TC007-TRN-DTE      TO  TC008-TRN-DTE                06190000
049300         MOVE TC007-VOID-ABRT-CDE                                 06200000
049400                                 TO  TC008-VOID-ABRT-CDE          06210000
049500         MOVE TC007-TNDR-TYP-CDE TO  TC008-TNDR-TYP-CDE           06220000
049600         MOVE TC007-TNDR-ID      TO  TC008-ACCT-NBR               06230000
049700         MOVE TC007-TNDR-AMT     TO  TC008-TNDR-AMT               06240000
049800         IF PS-NOT-SETTLE-REC                                     06250000
049900             SET TC008-UNSETTLED TO  TRUE                         06260000
050000         ELSE                                                     06270000
050100             SET TC008-SETTLED   TO  TRUE                         06280000
050200         END-IF                                                   06290000
               MOVE XST00025-BNKCRD-MERCH-NBR                           06300000
                                       TO PV-NUM-MERCHANT-NBR           06310000
               MOVE PV-NUM-MERCHANT-NBR   TO TC008-MERCHANT-NBR         06320000
               MOVE XST00025-BNKCRD-MERCH-NBR                           06330000
                                       TO PV-NUM-MERCHANT-NBR           06340000
               MOVE PV-NUM-MERCHANT-NBR                                 06350000
                                       TO TC008-MERCHANT-NBR            06360000
048300         MOVE TC007-ORG-STR-NBR  TO  TC008-ORG-STR-NBR            06370000
052523         MOVE TC007-TRLING-TRN-IND                                06380000
052523                                 TO TC008-TRLING-TRN-IND          06390000
052523         MOVE TC007-TRN-TYP-CDE  TO TC008-TRN-TYP-CDE             06391000
052523         MOVE TC007-COBRAND-PYMT-IND                              06392000
052523                                 TO TC008-COBRAND-PYMT-IND        06393000
052300     ELSE                                                         06400000
052400         MOVE WK005-PARTN-NBR    TO  TC008-PARTN-NBR              06410000
P9696          MOVE WK005-SETTLE-STORE-NBR TO  TC008-STR-NBR            06420000
052600         MOVE WK005-RGST-ID      TO  TC008-RGST-ID                06430000
052700         MOVE WK005-TRN-NBR      TO  TC008-TRN-NBR                06440000
052800         MOVE WK005-STRT-TM      TO  TC008-STRT-TM                06450000
052900         MOVE WK005-SLS-CORR-SEQ-NBR                              06460000
053000                                 TO  TC008-SLS-CORR-SEQ-NBR       06470000
053100         MOVE WK005-TNDR-SEQ-NBR TO  TC008-TNDR-SEQ-NBR           06480000
053200         MOVE WK005-TRN-TYP-CDE  TO  TC008-TRN-TYP-CDE            06490000
053300         MOVE WK005-SLS-DTE      TO  TC008-SLS-DTE                06500000
053400         MOVE WK005-TRN-DTE      TO  TC008-TRN-DTE                06510000
053500         MOVE WK005-VOID-ABRT-CDE                                 06520000
053600                                 TO  TC008-VOID-ABRT-CDE          06530000
053700         MOVE WK005-TNDR-TYP-CDE TO  TC008-TNDR-TYP-CDE           06540000
P9696          IF WK005-SETTLE-STORE-NBR NOT = PV-HOLD-STR-NBR          06550000
P9696              MOVE WK005-SETTLE-STORE-NBR TO PV-HOLD-STR-NBR       06560000
P9696              MOVE WK005-SETTLE-STORE-NBR TO PV-STR-NBR            06570000
034500             PERFORM 7000-GET-STORE-INFO                          06580000
034600         END-IF                                                   06590000
051100         MOVE XST00025-BNKCRD-MERCH-NBR                           06600000
051100                                    TO PV-NUM-MERCHANT-NBR        06610000
051200         MOVE PV-NUM-MERCHANT-NBR   TO TC008-MERCHANT-NBR         06620000
053900         MOVE WK005-TNDR-ID      TO  TC008-ACCT-NBR               06630000
054000         MOVE WK005-TNDR-AMT     TO  TC008-TNDR-AMT               06640000
054100         IF PS-NOT-SETTLE-REC                                     06650000
054200             SET TC008-UNSETTLED TO  TRUE                         06660000
054300         ELSE                                                     06670000
054400             SET TC008-SETTLED   TO  TRUE                         06680000
054500         END-IF                                                   06690000
054000         MOVE WK005-STR-NBR      TO  TC008-ORG-STR-NBR            06700000
052523         MOVE WK005-TRLING-TRN-IND                                06710000
052523                                 TO TC008-TRLING-TRN-IND          06720000
052523         MOVE WK005-TRN-TYP-CDE  TO TC008-TRN-TYP-CDE             06721000
052523         MOVE WK005-COBRAND-PYMT-IND                              06722000
052523                                 TO TC008-COBRAND-PYMT-IND        06723000
054600     END-IF.                                                      06730000
054700                                                                  06740000
054800***************************************************************** 06750000
054900*  6100-WRITE-REPORT-LINES                                        06760000
055000*      WRITE REPORT LINES FROM REPORT FILE                        06770000
055100***************************************************************** 06780000
055200 6100-WRITE-REPORT-LINES.                                         06790000
055300                                                                  06800000
055400     WRITE REPORT-EXTRACT-REC    FROM TC008-EXTRACT-RECORD.       06810000
055500                                                                  06820000
055600***************************************************************** 06830000
055700*  6200-CREATE-UPDATE-RECORD                                      06840000
055800*      CREATE UPDATE EXTRACT RECORD                               06850000
055900***************************************************************** 06860000
056000 6200-CREATE-UPDATE-RECORD.                                       06870000
056100                                                                  06880000
056200     INITIALIZE TC009-DATA.                                       06890000
056300                                                                  06900000
056400     IF PS-TC007-MOVE                                             06910000
056500         MOVE TC007-STR-NBR          TO TC009-STR-NBR             06920000
052523         MOVE TC007-ORG-STR-NBR      TO TC009-ORIG-STR-NBR        06930000
056600         MOVE TC007-RGST-ID          TO TC009-RGST-ID             06940000
056700         MOVE TC007-TRN-NBR          TO TC009-TRN-NBR             06950000
056800         MOVE TC007-STRT-TM          TO TC009-STRT-TIME           06960000
056900         MOVE TC007-TNDR-SEQ-NBR     TO TC009-TNDR-SEQ-NBR        06970000
056950         MOVE TC007-SLS-CORR-SEQ-NBR TO TC009-SLS-CORR-SEQ-NBR    06980000
057000         MOVE TC007-SLS-DTE          TO TC009-SLS-DTE             06990000
057100         MOVE TC007-TNDR-ID          TO TC009-CARD-NBR            07000000
052523         MOVE TC007-TRN-TYP-CDE      TO TC009-TRN-TYP-CDE         07001000
052523         MOVE TC007-TRLING-TRN-IND   TO TC009-TRLING-TRN-IND      07010000
052523         MOVE TC007-COBRAND-PYMT-IND TO TC009-COBRAND-PYMT-IND    07020000
057200     ELSE                                                         07030000
057300         MOVE WK005-STR-NBR          TO TC009-STR-NBR             07040000
052523         MOVE WK005-STR-NBR          TO TC009-ORIG-STR-NBR        07050000
057400         MOVE WK005-RGST-ID          TO TC009-RGST-ID             07060000
057500         MOVE WK005-TRN-NBR          TO TC009-TRN-NBR             07070000
057600         MOVE WK005-STRT-TM          TO TC009-STRT-TIME           07080000
057700         MOVE WK005-SLS-CORR-SEQ-NBR TO TC009-SLS-CORR-SEQ-NBR    07090000
057750         MOVE WK005-TNDR-SEQ-NBR     TO TC009-TNDR-SEQ-NBR        07100000
057800         MOVE WK005-SLS-DTE          TO TC009-SLS-DTE             07110000
057900         MOVE WK005-TNDR-ID          TO TC009-CARD-NBR            07120000
052523         MOVE WK005-TRN-TYP-CDE      TO TC009-TRN-TYP-CDE         07121000
052523         MOVE WK005-TRLING-TRN-IND   TO TC009-TRLING-TRN-IND      07130000
052523         MOVE WK005-COBRAND-PYMT-IND TO TC009-COBRAND-PYMT-IND    07140000
058000     END-IF.                                                      07150000
058100                                                                  07160000
058200***************************************************************** 07170000
058300*  6300-WRITE-UPDATE-EXTRACT-REC                                  07180000
058400*      WRITE  COSA TABLE UPDATE RECORDS                           07190000
058500***************************************************************** 07200000
058600 6300-WRITE-UPDATE-EXTRACT-REC.                                   07210000
058700                                                                  07220000
058800     WRITE UPDATE-EXTRACT-RECORD FROM TC009-DATA.                 07230000
058900                                                                  07240000
059000***************************************************************** 07250000
059100*  6400-CREATE-NEXT-SETTLE                                        07260000
059200*      CREATE WRAP AROUND SETTLEMENT RECORDS                      07270000
059300***************************************************************** 07280000
059400 6400-CREATE-NEXT-SETTLE.                                         07290000
059500                                                                  07300000
059600     INITIALIZE  TC005-EXTRACT-RECORD.                            07310000
059700                                                                  07320000
059800     MOVE TC007-PARTN-NBR        TO  TC005-PARTN-NBR.             07330000
P9696      MOVE TC007-ORG-STR-NBR      TO  TC005-STR-NBR.               07340000
060000     MOVE TC007-RGST-ID          TO  TC005-RGST-ID.               07350000
060100     MOVE TC007-TRN-NBR          TO  TC005-TRN-NBR.               07360000
060200     MOVE TC007-STRT-TM          TO  TC005-STRT-TM.               07370000
060300     MOVE TC007-SLS-CORR-SEQ-NBR TO  TC005-SLS-CORR-SEQ-NBR.      07380000
060400     MOVE TC007-TRN-TYP-CDE      TO  TC005-TRN-TYP-CDE.           07390000
060500     MOVE TC007-SLS-DTE          TO  TC005-SLS-DTE.               07400000
060600     MOVE TC007-TRN-DTE          TO  TC005-TRN-DTE.               07410000
060700     MOVE TC007-VOID-ABRT-CDE    TO  TC005-VOID-ABRT-CDE.         07420000
060800     MOVE TC007-TNDR-SEQ-NBR     TO  TC005-TNDR-SEQ-NBR.          07430000
060900     MOVE TC007-TNDR-TYP-CDE     TO  TC005-TNDR-TYP-CDE.          07440000
ZXX                                                                     07441000
061000     MOVE TC007-TNDR-ID          TO  TC005-TNDR-ID.               07450000
061100     MOVE TC007-TNDR-ID-SRC-CDE  TO  TC005-TNDR-ID-SRC-CDE.       07460000
061200     MOVE TC007-AUTH-NBR         TO  TC005-AUTH-NBR.              07470000
061300     MOVE TC007-AUTH-SRC-CDE     TO  TC005-AUTH-SRC-CDE.          07480000
061400     MOVE TC007-CPS-TRN-ID       TO  TC005-CPS-TRN-ID.            07490000
061500     MOVE TC007-MC-CMPLIN-CDE    TO  TC005-MC-CMPLIN-CDE.         07500000
061600     MOVE TC007-VIP-SRC-CDE      TO  TC005-VIP-SRC-CDE.           07510000
061700     MOVE TC007-VIP-RSPN-CDE     TO  TC005-VIP-RSPN-CDE.          07520000
061800     MOVE TC007-BNKNET-NBR       TO  TC005-BNKNET-NBR.            07530000
061800     MOVE TC007-AVS-RSPN-CDE     TO  TC005-AVS-RSPN-CDE.          07540000
061800     MOVE TC007-CVV-RSPN-CDE     TO  TC005-CVV-RSPN-CDE           07550000
061800     MOVE TC007-CRD-LVL-RSLT-CDE TO  TC005-CRD-LVL-RSLT-CDE.      07560000
      * ****************************************************************07570000
      *    AT THIS TIME WE ARE TAKING ENTIRE SLS TAX AMOUNT.  THIS MAY  07580000
      *    HAVE TO BE CHANGED FOR SPLIT TENDERS                         07590000
      * ****************************************************************07600000
061800     MOVE TC007-SLS-TX-AMT       TO  TC005-SLS-TX-AMT.            07610000
P9696      MOVE TC007-AUTH-REF-NBR     TO  TC005-AUTH-REF-NBR.          07620000
062000     MOVE SPACES                 TO  TC005-ECOMM-REAUTH-IND.      07630000
062100     MOVE 'P'                    TO  TC005-TRAN-CDE.              07640000
062200                                                                  07650000
      *    THE SIGN IS CHANGED HERE TO MOVE TO THE SETTLEMENT PROGRAM   07660000
      *    WITH CORRECT SIGN  (TCKUT008)  PROGRAM TO SEND TO BANK       07670000
      *    REPORT PROGRAM TCKRP006 CHANGES SIGN BACK FOR REPORTING      07680000
062300     IF PS-VOID-TRANS                                             07690000
062400         COMPUTE TC005-TNDR-AMT = (TC007-TNDR-AMT * -1)           07700000
062500     ELSE                                                         07710000
062600         MOVE TC007-TNDR-AMT         TO  TC005-TNDR-AMT           07720000
062700     END-IF.                                                      07730000
062800                                                                  07740000
063400     IF TC007-E-BUS-IND = 'Y'                                     07750000
063600         MOVE 'Y'                TO  TC005-E-BUS-IND              07760000
063700     ELSE                                                         07770000
063600         MOVE 'N'                TO  TC005-E-BUS-IND              07780000
063900     END-IF.                                                      07790000
062800                                                                  07800000
C53632     MOVE TC007-STR-NBR          TO  TC005-SETTLE-STORE-NBR       07810000
C53632     MOVE TC007-ECOMM-ORD-NBR    TO  TC005-ECOMM-ORD-NBR          07820000
064100                                                                  07830000
P9696      MOVE TC007-OMNI-CHNL-FFLMT-TYP-CDE                           07840000
P9696                                  TO  TC005-OMNI-CHNL-FFLMT-TYP-CDE07850000
SHIP       MOVE TC007-VISA-MULT-CLR-SEQ-NBR                             07860000
SHIP                                   TO  TC005-VISA-MULT-CLR-SEQ-NBR. 07870000
SHIP       MOVE TC007-VISA-TOT-SHP-NBR TO  TC005-VISA-TOT-SHP-NBR.      07880000
SHIP       MOVE TC007-FULFILLMENT-TYPE TO  TC005-FULFILLMENT-TYPE.      07890000
SHIP2      MOVE TC007-PAR-SHIP-IND     TO  TC005-PAR-SHIP-IND.          07900000
052523     MOVE TC007-TRN-TYP-CDE      TO  TC005-TRN-TYP-CDE.           07901000
052523     MOVE TC007-TRLING-TRN-IND   TO  TC005-TRLING-TRN-IND.        07902000
052523     MOVE TC007-COBRAND-PYMT-IND TO  TC005-COBRAND-PYMT-IND.      07903000
                                                                        07910000
           PERFORM 7500-FILL-MERCHANT-NBR.                              07920000
                                                                        07930000
066200***************************************************************** 07940000
066300*  6500-WRITE-NEXT-SETTLE                                         07950000
066400*      WRITE  WRAP AROUND SETTLEMENT RECORDS                      07960000
066500*      NOT SETTLE REC SWITCH SET FOR REPORT OF SETTLE/UNSETTLED   07970000
066600***************************************************************** 07980000
066700 6500-WRITE-NEXT-SETTLE.                                          07990000
066800                                                                  08000000
066900     WRITE UNP-BANK-SETTLE-REC   FROM TC005-EXTRACT-RECORD.       08010000
067000                                                                  08020000
067100***************************************************************** 08030000
067200*  6600-CREATE-AJB-RECORDS                                        08040000
067300*      CREATE REAUTH RECORDS TO SEND TO AJB                       08050000
067400***************************************************************** 08060000
067500 6600-CREATE-AJB-RECORDS.                                         08070000
067600                                                                  08080000
067700     INITIALIZE  TC005-EXTRACT-RECORD.                            08090000
067800                                                                  08100000
067900     MOVE TC007-PARTN-NBR        TO  TC005-PARTN-NBR.             08110000
P9696      MOVE TC007-ORG-STR-NBR      TO  TC005-STR-NBR.               08120000
068100     MOVE TC007-RGST-ID          TO  TC005-RGST-ID.               08130000
068200     MOVE TC007-TRN-NBR          TO  TC005-TRN-NBR.               08140000
068300     MOVE TC007-STRT-TM          TO  TC005-STRT-TM.               08150000
068400     MOVE TC007-SLS-CORR-SEQ-NBR TO  TC005-SLS-CORR-SEQ-NBR.      08160000
068500     MOVE TC007-TRN-TYP-CDE      TO  TC005-TRN-TYP-CDE.           08170000
068600     MOVE TC007-SLS-DTE          TO  TC005-SLS-DTE.               08180000
068700     MOVE TC007-TRN-DTE          TO  TC005-TRN-DTE.               08190000
068800     MOVE TC007-VOID-ABRT-CDE    TO  TC005-VOID-ABRT-CDE.         08200000
068900     MOVE TC007-TNDR-SEQ-NBR     TO  TC005-TNDR-SEQ-NBR.          08210000
069000     MOVE TC007-TNDR-TYP-CDE     TO  TC005-TNDR-TYP-CDE.          08220000
069100     MOVE TC007-TNDR-ID          TO  TC005-TNDR-ID.               08230000
069200     MOVE TC007-TNDR-AMT         TO  TC005-TNDR-AMT.              08240000
069300     MOVE TC007-TNDR-ID-SRC-CDE  TO  TC005-TNDR-ID-SRC-CDE.       08250000
069400     MOVE TC007-AUTH-NBR         TO  TC005-AUTH-NBR.              08260000
069500     MOVE TC007-AUTH-SRC-CDE     TO  TC005-AUTH-SRC-CDE.          08270000
069600     MOVE TC007-CPS-TRN-ID       TO  TC005-CPS-TRN-ID.            08280000
069700     MOVE TC007-MC-CMPLIN-CDE    TO  TC005-MC-CMPLIN-CDE.         08290000
069800     MOVE TC007-VIP-SRC-CDE      TO  TC005-VIP-SRC-CDE.           08300000
069900     MOVE TC007-VIP-RSPN-CDE     TO  TC005-VIP-RSPN-CDE.          08310000
070000     MOVE TC007-BNKNET-NBR       TO  TC005-BNKNET-NBR.            08320000
070000     MOVE TC007-AVS-RSPN-CDE     TO  TC005-AVS-RSPN-CDE.          08330000
061800     MOVE TC007-CVV-RSPN-CDE     TO  TC005-CVV-RSPN-CDE           08340000
061800     MOVE TC007-CRD-LVL-RSLT-CDE TO  TC005-CRD-LVL-RSLT-CDE.      08350000
      * ****************************************************************08360000
      *    AT THIS TIME WE ARE TAKING ENTIRE SLS TAX AMOUNT.  THIS MAY  08370000
      *    HAVE TO BE CHANGED FOR SPLIT TENDERS                         08380000
      * ****************************************************************08390000
070000     MOVE TC007-SLS-TX-AMT       TO  TC005-SLS-TX-AMT.            08400000
070100     MOVE TC007-STR-NBR          TO  TC005-SETTLE-STORE-NBR.      08410000
070200     MOVE PV-ECOMM-REAUTH-IND    TO  TC005-ECOMM-REAUTH-IND.      08420000
070300     MOVE EPORD-ORD-NBR-TEXT (1:EPORD-ORD-NBR-LEN)                08430000
070400                                 TO  TC005-ECOMM-ORD-NBR.         08440000
070500     MOVE 'P'                    TO  TC005-TRAN-CDE.              08450000
P9696      MOVE TC007-AUTH-REF-NBR     TO  TC005-AUTH-REF-NBR.          08460000
P9696      MOVE TC007-OMNI-CHNL-FFLMT-TYP-CDE                           08470000
P9696                                  TO  TC005-OMNI-CHNL-FFLMT-TYP-CDE08480000
SHIP2      MOVE TC007-VISA-MULT-CLR-SEQ-NBR                             08490000
SHIP2                                  TO  TC005-VISA-MULT-CLR-SEQ-NBR. 08500000
SHIP2      MOVE TC007-VISA-TOT-SHP-NBR TO  TC005-VISA-TOT-SHP-NBR.      08510000
SHIP2      MOVE TC007-FULFILLMENT-TYPE TO  TC005-FULFILLMENT-TYPE.      08520000
SHIP2      MOVE TC007-PAR-SHIP-IND     TO  TC005-PAR-SHIP-IND.          08530000
070800                                                                  08540000
           PERFORM 7500-FILL-MERCHANT-NBR.                              08550000
                                                                        08560000
073000***************************************************************** 08570000
073100*  6700-WRITE-AJB-RECORDS                                         08580000
073200*       WRITE REAUTH RECORDS TO SEND TO AJB                       08590000
073300*      NOT SETTLE REC SWITCH SET FOR REPORT OF SETTLE/UNSETTLED   08600000
073400***************************************************************** 08610000
073500 6700-WRITE-AJB-RECORDS.                                          08620000
073600                                                                  08630000
073700     WRITE AJB-EXTRACT-REC       FROM TC005-EXTRACT-RECORD.       08640000
073800                                                                  08650000
073900***************************************************************** 08660000
074000*  7000-GET-STORE-INFO.                                           08670000
074100*       GET STORE INFO FROM XST00001                              08680000
074200***************************************************************** 08690000
074300 7000-GET-STORE-INFO.                                             08700000
074400                                                                  08710000
074500     EXEC SQL                                                     08720000
074700         SELECT COALESCE(BNKCRD_MERCH_NBR, 0)                     08730000
074900              , COALESCE(E_BUS_IND, 'N')                          08740000
075100             INTO :XST00025-BNKCRD-MERCH-NBR                      08750000
075300                , :XST00001-E-BUS-IND                             08760000
075400             FROM XST_LOC      A                                  08770000
075400                , XST_LOC_ATTR B                                  08780000
075500             WHERE A.LOC_NBR        = :PV-STR-NBR                 08790000
075500               AND A.LOC_NBR        = B.LOC_NBR                   08800000
075600     END-EXEC.                                                    08810000
075700                                                                  08820000
075800     EVALUATE TRUE                                                08830000
075900         WHEN SQLCODE = ZERO                                      08840000
076000             CONTINUE                                             08850000
076100         WHEN SQLCODE = +100                                      08860000
076400             INITIALIZE XST00025-BNKCRD-MERCH-NBR                 08870000
076500                        XST00001-E-BUS-IND                        08880000
076600         WHEN OTHER                                               08890000
076700             PERFORM 9800-SQL-ABEND                               08900000
076800     END-EVALUATE.                                                08910000
076900                                                                  08920000
077000***************************************************************** 08930000
077100*  7100-GET-ECOM-INFO.                                            08940000
077200*       GET ECOMM INFO FROM TEPORD                                08950000
077300***************************************************************** 08960000
077400 7100-GET-ECOM-INFO.                                              08970000
077500                                                                  08980000
077600     EXEC SQL                                                     08990000
077700         SELECT ORD_MOD_IND                                       09000000
077800              , ORD_NBR                                           09010000
077900             INTO :EPORD-ORD-MOD-IND                              09020000
078000                , :EPORD-ORD-NBR                                  09030000
078100             FROM TEPORD    A                                     09040000
078200             WHERE A.PARTN_NBR        = :TC007-PARTN-NBR          09050000
078300               AND A.STR_NBR          = :TC007-STR-NBR            09060000
078400               AND A.RGST_ID          = :TC007-RGST-ID            09070000
078500               AND A.TRN_NBR          = :TC007-TRN-NBR            09080000
078600               AND A.STRT_TM          = :TC007-STRT-TM            09090000
078700               AND A.SLS_CORR_SEQ_NBR = :TC007-SLS-CORR-SEQ-NBR   09100000
078800     END-EXEC.                                                    09110000
078900                                                                  09120000
079000     EVALUATE TRUE                                                09130000
079100         WHEN SQLCODE = ZERO                                      09140000
079200             CONTINUE                                             09150000
079300         WHEN SQLCODE = +100                                      09160000
079400             INITIALIZE EPORD-ORD-MOD-IND                         09170000
079500                        EPORD-ORD-NBR                             09180000
079600         WHEN OTHER                                               09190000
079700             PERFORM 9800-SQL-ABEND                               09200000
079800     END-EVALUATE.                                                09210000
079900                                                                  09220000
080000***************************************************************** 09230000
080100*  7200-CHECK-ECOMM-REAUTH                                        09240000
080200*       DETERMINE IF ECOMM TRANSACTION NEEDS TO HAVE REAUTH       09250000
080300***************************************************************** 09260000
080400 7200-CHECK-ECOMM-REAUTH.                                         09270000
080500                                                                  09280000
080600     INITIALIZE DPG51                                             09290000
080700                DPG52                                             09300000
080800                DPG53                                             09310000
080900                DPG54                                             09320000
081000                DPG55                                             09330000
081100                DPG56.                                            09340000
081200                                                                  09350000
081300     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      09360000
081400                                                                  09370000
081500     MOVE TC007-TRN-DTE              TO DPG52-LK-DATE-INPUT.      09380000
081600     SET DPG52-LK-DTE-ISO-FMT        TO TRUE.                     09390000
081700                                                                  09400000
081800     MOVE TC007-SLS-DTE              TO DPG53-LK-CMPR-DATE-INPUT. 09410000
081900     SET DPG53-LK-CMPR-DTE-ISO-FMT   TO TRUE.                     09420000
082000                                                                  09430000
082100     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                09440000
082200                                             DPG52                09450000
082300                                             DPG53                09460000
082400                                             DPG54                09470000
082500                                             DPG55                09480000
082600                                             DPG56.               09490000
082700                                                                  09500000
082800     EVALUATE TRUE                                                09510000
082900         WHEN DPG54-NO-ERROR                                      09520000
083000             IF DPG55-DAYS-DIFFERENCE > 7                         09530000
083100                 MOVE 'E'        TO PV-ECOMM-REAUTH-IND           09540000
083300                 SET PS-NEED-REAUTH   TO TRUE                     09550000
083400             ELSE                                                 09560000
083500                 IF EPORD-ORD-MOD-IND = 'Y'                       09570000
083600                   MOVE 'M'      TO PV-ECOMM-REAUTH-IND           09580000
083800                   SET PS-NEED-REAUTH TO TRUE                     09590000
083900                 END-IF                                           09600000
084000             END-IF                                               09610000
084100                                                                  09620000
084200         WHEN DPG54-DATE-INVALID                                  09630000
084300             DISPLAY '** ABEND **'                                09640000
084400             DISPLAY '** PROGRAM = TCKUT010 -- CALLED MODULE '    09650000
084500                     'DPKUT500 **'                                09660000
084600             DISPLAY '** PARAGRAPH = 7200-CHECK-ECOMM-REAUTH**'   09670000
084700             DISPLAY '** INVALID TRANS DATE: '                    09680000
084800                                         TC007-TRN-DTE            09690000
084900             DISPLAY '** ERROR MESSAGE FROM CALLED MODULE:   '    09700000
085000             DISPLAY DPG54-ERROR-MESSAGE                          09710000
085100             MOVE +4003 TO AC-ABEND-CODE                          09720000
085200             CALL 'ILBOABN0' USING AC-ABEND-CODE                  09730000
085300                                                                  09740000
085400         WHEN DPG54-CMPR-DATE-INVALID                             09750000
085500             DISPLAY '** ABEND **'                                09760000
085600             DISPLAY '** PROGRAM = TCKUT010 -- CALLED MODULE '    09770000
085700                     'DPKUT500 **'                                09780000
085800             DISPLAY '** PARAGRAPH = 7200-CHECK-ECOMM-REAUTH**'   09790000
085900             DISPLAY '** INVALID SALES DATE: '                    09800000
086000                                         TC007-SLS-DTE            09810000
086100             DISPLAY '** ERROR MESSAGE FROM CALLED MODULE:   '    09820000
086200             DISPLAY DPG54-ERROR-MESSAGE                          09830000
086300             MOVE +4003 TO AC-ABEND-CODE                          09840000
086400             CALL 'ILBOABN0' USING AC-ABEND-CODE                  09850000
086500                                                                  09860000
086600         WHEN OTHER                                               09870000
086700             DISPLAY '** ABEND **'                                09880000
086800             DISPLAY '** PROGRAM = TCKUT010 -- CALLED MODULE '    09890000
086900                     'DPKUT500 **'                                09900000
087000             DISPLAY '** PARAGRAPH = 7200-CHECK-ECOMM-REAUTH**'   09910000
087100             DISPLAY DPG54-ERROR-MESSAGE                          09920000
087200             MOVE +4003 TO AC-ABEND-CODE                          09930000
087300             CALL 'ILBOABN0' USING AC-ABEND-CODE                  09940000
087400                                                                  09950000
087500     END-EVALUATE.                                                09960000
087600                                                                  09970000
090600******************************************************************09980000
090700*   7300-CHECK-FOR-RETURN.                                       *09990000
090800*    DETERMINE IF ORIGINAL STORE WAS AN ECOMM STORE FOR RETURN   *10000000
090900******************************************************************10010000
091000 7300-CHECK-FOR-RETURN.                                           10020000
091100                                                                  10030000
091200     PERFORM 7310-OPEN-ORIG-INFO-CSR.                             10040000
091300     PERFORM 7320-FETCH-ORIG-INFO-CSR.                            10050000
091400     PERFORM 7330-CLOSE-ORIG-INFO-CSR.                            10060000
091500                                                                  10070000
091600******************************************************************10080000
091700* 7310-OPEN-ORIG-INFO-CSR.                                        10090000
091800*     OPEN ORIG INFO CSR                                          10100000
091900******************************************************************10110000
092000 7310-OPEN-ORIG-INFO-CSR.                                         10120000
092100                                                                  10130000
092200     EXEC SQL                                                     10140000
092300          OPEN ORIG-INFO-CSR                                      10150000
092400     END-EXEC.                                                    10160000
092500                                                                  10170000
092600     EVALUATE TRUE                                                10180000
092700         WHEN SQLCODE = ZERO                                      10190000
092800              CONTINUE                                            10200000
092900         WHEN SQLWARN0 NOT EQUAL SPACE                            10210000
093000         WHEN SQLCODE NOT EQUAL ZERO                              10220000
093100             MOVE '7310-OPEN-ORIG-INFO-CSR'                       10230000
093200                                            TO PV-PARAGRAPH-NAME  10240000
093300             MOVE 'ERROR ON OPEN OF ORIG-INFO-CSR'                10250000
093400                                            TO PV-DB2-OPERATION   10260000
093500             PERFORM 9800-SQL-ABEND                               10270000
093600     END-EVALUATE.                                                10280000
093700                                                                  10290000
093800******************************************************************10300000
093900* 7320-FETCH-ORIG-INFO-CSR                                        10310000
094000******************************************************************10320000
094100 7320-FETCH-ORIG-INFO-CSR.                                        10330000
094200                                                                  10340000
094300     EXEC SQL                                                     10350000
094400          FETCH ORIG-INFO-CSR                                     10360000
094500          INTO  :EPIRT-ORIG-SLS-DTE                               10370000
094600               ,:EPIRT-ORIG-STR-NBR                               10380000
094700               ,:EPIRT-ORIG-RGST-ID                               10390000
094800               ,:EPIRT-ORIG-TRN-NBR                               10400000
094900               ,:EPIRT-ORIG-STRT-TM                               10410000
095000     END-EXEC.                                                    10420000
095100                                                                  10430000
095200     EVALUATE TRUE                                                10440000
095300         WHEN SQLCODE EQUAL ZERO                                  10450000
095400             SET PS-ECOMM-STORE  TO TRUE                          10460000
095500         WHEN SQLCODE EQUAL +100                                  10470000
095600             SET PS-NOT-ECOMM-STORE TO TRUE                       10480000
095700             MOVE TC007-STR-NBR  TO EPIRT-ORIG-STR-NBR            10490000
095800             MOVE SPACES         TO PV-RETURN-ORD-NBR             10500000
095900         WHEN OTHER                                               10510000
096000             MOVE '7320-FETCH-ORIG-INFO-CSR'                      10520000
096100                                            TO PV-PARAGRAPH-NAME  10530000
096200             MOVE 'TO FETCH OF ORIG INFO CSR'                     10540000
096300                                            TO PV-DB2-ERROR-MSG   10550000
096400             PERFORM 9800-SQL-ABEND                               10560000
096500     END-EVALUATE.                                                10570000
096600                                                                  10580000
096700***************************************************************** 10590000
096800* 7330-CLOSE-ORIG-INFO-CSR                                        10600000
096900*      CLOSE CURSOR                                               10610000
097000***************************************************************** 10620000
097100 7330-CLOSE-ORIG-INFO-CSR.                                        10630000
097200                                                                  10640000
097300     EXEC SQL                                                     10650000
097400          CLOSE ORIG-INFO-CSR                                     10660000
097500     END-EXEC.                                                    10670000
097600                                                                  10680000
097700     EVALUATE TRUE                                                10690000
097800         WHEN SQLCODE = ZERO                                      10700000
097900              CONTINUE                                            10710000
098000         WHEN SQLWARN0 NOT EQUAL SPACE                            10720000
098100         WHEN SQLCODE NOT EQUAL ZERO                              10730000
098200             MOVE '7330-CLOSE-ORIG-INFO-CSR'                      10740000
098300                                            TO PV-PARAGRAPH-NAME  10750000
098400             MOVE 'ERROR ON CLOSE OF ORIG-INFO-CSR'               10760000
098500                                            TO PV-DB2-OPERATION   10770000
098600             PERFORM 9800-SQL-ABEND                               10780000
098700     END-EVALUATE.                                                10790000
098800                                                                  10800000
098900******************************************************************10810000
099000*   7400-GET-ORIG-ORD-NBR.                                       *10820000
099100*    GET THE ORIGIANL ORD NBR FROM TEPORD FOR RETURN TRANSACTION *10830000
099200******************************************************************10840000
099300 7400-GET-ORIG-ORD-NBR.                                           10850000
099400                                                                  10860000
099500     EXEC SQL                                                     10870000
099600          SELECT B.ORD_NBR                                        10880000
099700          INTO  :EPORD-ORD-NBR                                    10890000
099800          FROM  TEPPART  A                                        10900000
099900               ,TEPORD   B                                        10910000
100000          WHERE A.SLS_DTE           = :EPIRT-ORIG-SLS-DTE         10920000
100100            AND A.PARTN_NBR         = B.PARTN_NBR                 10930000
100200            AND B.STR_NBR           = :EPIRT-ORIG-STR-NBR         10940000
100300            AND B.RGST_ID           = :EPIRT-ORIG-RGST-ID         10950000
100400            AND B.TRN_NBR           = :EPIRT-ORIG-TRN-NBR         10960000
100500            AND B.STRT_TM           = :EPIRT-ORIG-STRT-TM         10970000
100600     END-EXEC.                                                    10980000
100700                                                                  10990000
100800     EVALUATE TRUE                                                11000000
100900         WHEN SQLCODE EQUAL ZERO                                  11010000
101000             MOVE EPORD-ORD-NBR-TEXT (1:EPORD-ORD-NBR-LEN)        11020000
101100                                 TO PV-RETURN-ORD-NBR             11030000
101200         WHEN SQLCODE EQUAL +100                                  11040000
101300             MOVE SPACES         TO PV-RETURN-ORD-NBR             11050000
101400         WHEN OTHER                                               11060000
101500             MOVE '7400-GET-ORIG-ORD-NBR'                         11070000
101600                                            TO PV-PARAGRAPH-NAME  11080000
101700             MOVE 'TO SELECT FROM TEPORD  '                       11090000
101800                                            TO PV-DB2-ERROR-MSG   11100000
101900             PERFORM 9800-SQL-ABEND                               11110000
102000     END-EVALUATE.                                                11120000
102100                                                                  11130000
102200******************************************************************11140000
102300* 7500-FILL-MERCHANT-NBR                                          11150000
102400*     POPULATE THE MERCHANT NBR ON TC005 RECORD                   11160000
102500******************************************************************11170000
       7500-FILL-MERCHANT-NBR.                                          11180000
                                                                        11190000
051100     MOVE XST00025-BNKCRD-MERCH-NBR TO PV-NUM-MERCHANT-NBR.       11200000
051200     MOVE PV-NUM-MERCHANT-NBR       TO TC005-MERCHANT-NBR.        11210000
                                                                        11220000
102200******************************************************************11230000
102300* 8000-READ-BANK-SETTLE-FILE                                      11240000
102400*     READ THE PREV BANK SETTLE FILE INPUT                        11250000
102500******************************************************************11260000
102600 8000-READ-BANK-SETTLE-FILE.                                      11270000
102700                                                                  11280000
102800     READ BANK-SETTLE-FILE  INTO WK005-EXTRACT-RECORD             11290000
102900         AT END                                                   11300000
103000             SET PS-END-OF-SETTLE-FILE TO TRUE                    11310000
103100     END-READ.                                                    11320000
103200                                                                  11330000
103300     IF  PS-END-OF-SETTLE-FILE                                    11340000
103400         MOVE HIGH-VALUES        TO WS-SETTLE-KEY                 11350000
103500     ELSE                                                         11360000
103600         MOVE WK005-SLS-DTE      TO WS-SETTLE-SALES-DATE          11370000
XXXXXX         MOVE WK005-SETTLE-STORE-NBR                              11380000
XXXXXX                                 TO WS-SETTLE-STORE-NBR           11390000
103800         MOVE WK005-RGST-ID      TO WS-SETTLE-REG-NBR             11400000
103900         MOVE WK005-TRN-NBR      TO WS-SETTLE-TRAN-NBR            11410000
104000         MOVE WK005-STRT-TM      TO WS-SETTLE-STR-TIME            11420000
104100         MOVE WK005-SLS-CORR-SEQ-NBR                              11430000
104200                                 TO WS-SETTLE-CORR-SEQ            11440000
104100         MOVE WK005-TNDR-SEQ-NBR TO WS-SETTLE-TNDR-SEQ-NBR        11450000
104300     END-IF.                                                      11460000
104400                                                                  11470000
104500******************************************************************11480000
104600* 8100-READ-DAILY-COSA-FILE                                       11490000
104700*     READ THE DAILY COSA EXTRACT FILE                            11500000
104800******************************************************************11510000
104900 8100-READ-DAILY-COSA-FILE.                                       11520000
105000                                                                  11530000
105100     READ  DAILY-COSA-FILE INTO TC007-EXTRACT-RECORD              11540000
105200         AT END                                                   11550000
105300             SET PS-END-OF-COSA-FILE TO TRUE                      11560000
105400     END-READ.                                                    11570000
105500                                                                  11580000
105600     IF  PS-END-OF-COSA-FILE                                      11590000
105700         MOVE HIGH-VALUES        TO WS-COSA-KEY                   11600000
105800     ELSE                                                         11610000
105900         MOVE TC007-SLS-DTE      TO WS-COSA-SALES-DATE            11620000
106000         MOVE TC007-STR-NBR      TO WS-COSA-STORE-NBR             11630000
106100         MOVE TC007-RGST-ID      TO WS-COSA-REG-NBR               11640000
106200         MOVE TC007-TRN-NBR      TO WS-COSA-TRAN-NBR              11650000
106300         MOVE TC007-STRT-TM      TO WS-COSA-STR-TIME              11660000
106400         MOVE TC007-SLS-CORR-SEQ-NBR                              11670000
106500                                 TO WS-COSA-CORR-SEQ              11680000
106400         MOVE TC007-TNDR-SEQ-NBR TO WS-COSA-TNDR-SEQ-NBR          11690000
106600     END-IF.                                                      11700000
106700                                                                  11710000
106800******************************************************************11720000
106900* 9800-SQL-ABEND                                                  11730000
107000*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.11740000
107100******************************************************************11750000
107200 9800-SQL-ABEND.                                                  11760000
107300     DISPLAY '** ABEND     **'.                                   11770000
107400     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                11780000
107500     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              11790000
107600     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               11800000
107700                                                                  11810000
107800******************************************************************11820000
107900* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     11830000
108000* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      11840000
108100******************************************************************11850000
108200     COPY DPPD004.                                                11860000
108300                                                                  11870000
108400     SET AC-DB2-ERROR TO TRUE.                                    11880000
108500     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         11890000
108600                                                                  11900000
108700***************************************************************** 11910000
108800*   9900-ABEND-FILE-PROBLEM                                       11920000
108900*      ABEND THIS RUN SOMETHING IS WRONG WITH FILES.              11930000
109000***************************************************************** 11940000
109100 9900-ABEND-FILE-PROBLEM.                                         11950000
109200                                                                  11960000
109300     DISPLAY 'INPUT FILES HAVE A SEQUENCE PROBLEM'.               11970000
109400     MOVE '9900-ABEND-FILE-PROBLEM '                              11980000
109500                                 TO PV-PARAGRAPH-NAME.            11990000
109600     SET AC-FILE-SEQUENCE-ERROR  TO TRUE.                         12000000
109700     PERFORM 9999-ABEND.                                          12010000
109800                                                                  12020000
109900******************************************************************12030000
110000* 9999-ABEND                                                      12040000
110100*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  12050000
110200******************************************************************12060000
110300 9999-ABEND.                                                      12070000
110400     DISPLAY '** ABEND           **'.                             12080000
110500     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          12090000
110600     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        12100000
110700     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       12110000
110800     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       12120000
110900     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         12130000
