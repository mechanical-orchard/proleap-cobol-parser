      ****************************************************************  00010006
       IDENTIFICATION DIVISION.                                         00020006
      ****************************************************************  00030006
       PROGRAM-ID.    EPKUT225.                                         00040006
       AUTHOR.        DAVID WELLER.                                     00050006
       DATE-WRITTEN.  JANUARY 7, 2009.                                  00060006
                                                                        00070006
      *-------------------------------------------------------------    00080006
      *  STORE EXPANSION OF OFFERS FILE FOR NEXT/FUTURE DAY             00090006
      *         OFFER PROCESSING                                        00100006
      *-------------------------------------------------------------    00110006
      * THIS PROGRAM WILL READ DATA FROM THE OFFERS DATA FILE, THE      00120006
      * OFFERS STORE GROUP FILE, AND THE XST_STR_GP_MBSHP TABLE.        00130006
      * THIS DATA WILL BE WRITTEN TO ONE, TWO, THREE, OR FOUR OF        00140006
      * THE FOLLOWING OUTPUT FILES DEPENDING ON THE LISTED RULES.       00150006
      * THE OUTPUT FILES WHICH WILL BE USED TO FACILITATE THE LOAD OF   00160006
      * THE XST_OFR TABLE, THE XST_OFR_SECT TABLE, THE XST_OFR_BWP      00170006
      * TABLE, AND THE XST_OFR_MDSE TABLE ARE THE OFFER FILE, THE       00180006
      * OFFER SECTION FILE, THE OFFER BWP FILE AND THE OFFER MDSE FILES 00190006
      * REPECTIVELY.  THE STORE LIST FILE WILL BE CREATED AS REQUIRED.  00200006
      *-------------------------------------------------------------    00210006
      * HISTORY LOG:                                                    00220006
      *-------------------------------------------------------------    00230006
      * DATE:        7 JAN 2009                                         00240006
      * WR/IR#:      WR34297                                            00250008
      * PROGRAMMER:  DAVID WELLER                                       00260006
      * DESCRIPTION: INITIAL PROGRAM CREATION.                          00270006
      *-------------------------------------------------------------    00280006
      ****************************************************************  00290006
       ENVIRONMENT DIVISION.                                            00300006
      ****************************************************************  00310006
       CONFIGURATION SECTION.                                           00320006
       SOURCE-COMPUTER. IBM-3090.                                       00330006
       OBJECT-COMPUTER. IBM-3090.                                       00340006
                                                                        00350006
       INPUT-OUTPUT SECTION.                                            00360006
                                                                        00370006
       FILE-CONTROL.                                                    00380006
           SELECT OFFERS-DATA-FILE                                      00390006
             ASSIGN TO INP01.                                           00400006
                                                                        00440006
           SELECT OFFER-FILE                                            00450006
             ASSIGN TO OUT01.                                           00460006
                                                                        00470006
           SELECT OFFER-SECTION-FILE                                    00480006
             ASSIGN TO OUT02.                                           00490006
                                                                        00500006
           SELECT OFFER-BWP-FILE                                        00510006
             ASSIGN TO OUT03.                                           00520006
                                                                        00530006
           SELECT OFFER-MDSE-FILE                                       00540006
             ASSIGN TO OUT04.                                           00550006
                                                                        00590006
      ****************************************************************  00600006
       DATA DIVISION.                                                   00610006
      ****************************************************************  00620006
       FILE SECTION.                                                    00630006
                                                                        00640006
       FD  OFFERS-DATA-FILE                                             00650006
           RECORDING MODE IS F                                          00660006
           LABEL RECORDS ARE STANDARD                                   00670006
           DATA RECORD IS OFFERS-DATA-RECORD.                           00680006
                                                                        00690006
       01  OFFERS-DATA-RECORD                            PIC X(187).    00700006
      *  COPYBOOK IS EPRD261                                            00710006
                                                                        00800006
       FD  OFFER-FILE                                                   00810006
           RECORDING MODE IS F                                          00820006
           LABEL RECORDS ARE STANDARD                                   00830006
           DATA RECORD IS OFFER-RECORD.                                 00840006
                                                                        00850006
       01  OFFER-RECORD                                  PIC X(160).    00860006
      *  COPYBOOK IS EPRD271                                            00870006
                                                                        00880006
       FD  OFFER-SECTION-FILE                                           00890006
           RECORDING MODE IS F                                          00900006
           LABEL RECORDS ARE STANDARD                                   00910006
           DATA RECORD IS OFFER-SECTION-RECORD.                         00920006
                                                                        00930006
       01  OFFER-SECTION-RECORD                          PIC X(120).    00940006
      *  COPYBOOK IS EPRD272                                            00950006
                                                                        00960006
       FD  OFFER-BWP-FILE                                               00970006
           RECORDING MODE IS F                                          00980006
           LABEL RECORDS ARE STANDARD                                   00990006
           DATA RECORD IS OFFER-BWP-RECORD.                             01000006
                                                                        01010006
       01  OFFER-BWP-RECORD                              PIC X(110).    01020006
      *  COPYBOOK IS EPRD273                                            01030006
                                                                        01040006
       FD  OFFER-MDSE-FILE                                              01050006
           RECORDING MODE IS F                                          01060006
           LABEL RECORDS ARE STANDARD                                   01070006
           DATA RECORD IS OFFER-MDSE-RECORD.                            01080006
                                                                        01090006
       01  OFFER-MDSE-RECORD                             PIC X(96).     01100006
      *  COPYBOOK IS EPRD274                                            01110006
                                                                        01120006
      *-------------------------------------------------------------    01210006
       WORKING-STORAGE SECTION.                                         01220006
      *-------------------------------------------------------------    01230006
       01  AC-ABEND-CODE                  PIC S9(04) VALUE ZERO         01240006
                                                     COMP SYNC.         01250006
           88  AC-4013-DB2-ERROR                     VALUE +4013.       01300006
                                                                        01310006
      *-------------------------------------------------------------    01320006
      * PC- PROGRAM CONSTANTS                                           01330006
      *-------------------------------------------------------------    01340006
       01  PC-PROGRAM-CONSTANTS.                                        01350006
           05  PC-PROGRAM-NAME            PIC  X(08) VALUE 'EPKUT225'.  01360006
           05  PC-NULL-VALUE              PIC X(01) VALUE '~'.          01410006
                                                                        01440006
      *-------------------------------------------------------------    01450006
      * PS- PROGRAM SWITCHES                                            01460006
      *-------------------------------------------------------------    01470006
       01  PS-PROGRAM-SWITCHES.                                         01471006
           05  PS-OFFER-DATA-FILE-EMPTY-SW  PIC X(01) VALUE 'N'.        01475006
               88  PS-OFFERS-DATA-FILE-EMPTY          VALUE 'Y'.        01476006
               88  PS-OFFERS-DATA-FILE-NOT-EMPTY      VALUE 'N'.        01477006
                                                                        01550007
      *-------------------------------------------------------------    01560006
      * PV- PROGRAM VARIABLES                                           01570006
      *-------------------------------------------------------------    01580006
       01  PV-PROGRAM-VARIABLES.                                        01590006
           05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACES.    01600006
           05  PV-OPERATION-MSG-1           PIC  X(40) VALUE SPACES.    01610006
           05  PV-OPERATION-MSG-2           PIC  X(40) VALUE SPACES.    01620006
           05  PV-DB2-OPERATION             PIC  X(10) VALUE SPACES.    01630006
           05  PV-SQL-SUB                   PIC S9(04) VALUE +0 COMP.   01640006
           05  PV-OFFERS-DATA-EOF-IND       PIC  X(01) VALUE 'N'.       01650006
               88  OFFERS-DATA-FILE-EOF                VALUE 'Y'.       01660006
               88  OFFERS-DATA-FILE-NOT-EOF            VALUE 'N'.       01670006
           05  PV-OFFERS-DATA-RECORD-IND    PIC  X(01) VALUE 'N'.       01680006
               88  UNPROCESSED-OFFERS-RECORD           VALUE 'Y'.       01690006
               88  PROCESSED-OFFERS-RECORD             VALUE 'N'.       01700006
           05  INPUT-DATA-FILE-IND          PIC  X(01) VALUE 'N'.       01770006
               88  INPUT-DATA-FILES-EOF                VALUE 'Y'.       01780006
               88  INPUT-DATA-FILE-NOT-EOF             VALUE 'N'.       01790006
           05  PV-PROCESS-FILE-TYPE         PIC  X(03) VALUE SPACES.    01800006
               88  PV-PROCESS-FILE-FUL                 VALUE 'FUL'.     01810006
               88  PV-PROCESS-FILE-NEW                 VALUE 'NEW'.     01820006
               88  PV-PROCESS-FILE-CHG                 VALUE 'CHG'.     01830006
                                                                        02000006
      * ------------------------------------------------------------    02010006
      *  DATE - TIMESTAMP VARIABLES                                     02020006
      * ------------------------------------------------------------    02030006
                                                                        02031009
       01  PV-RUN-TIME.                                                 02032009
           05  R-HR                    PIC 99.                          02033009
           05  R-MIN                   PIC 99.                          02034009
           05  R-SEC                   PIC 99.                          02035009
           05  R-TH                    PIC 99.                          02036009
                                                                        02037009
       01  PV-DATE-IN.                                                  02038009
           05 DATE-IN-YY               PIC XX.                          02039009
           05 DATE-IN-MM               PIC XX.                          02039109
           05 DATE-IN-DD               PIC XX.                          02039209
                                                                        02069706
      * ------------------------------------------------------------    02069806
      *  COUNTERS                                                       02069906
      * ------------------------------------------------------------    02070006
       01  PV-COUNTERS.                                                 02070106
           05  PV-OFFERS-DATA-RECS          PIC  9(05) VALUE ZERO.      02070206
           05  PV-OFFER-OUT-COUNT           PIC  9(05) VALUE ZERO.      02070406
           05  PV-SECTION-OUT-COUNT         PIC  9(05) VALUE ZERO.      02070506
           05  PV-BWP-OUT-COUNT             PIC  9(05) VALUE ZERO.      02070606
           05  PV-MDSE-OUT-COUNT            PIC  9(05) VALUE ZERO.      02070706
                                                                        02395006
      *-------------------------------------------------------------    02396006
      *  COPY BOOK FOR OFFERS DATA FILE                                 02397006
      *-------------------------------------------------------------    02398006
           COPY EPRD261.                                                02399006
                                                                        02400006
      *-------------------------------------------------------------    02460006
      *  COPY BOOK FOR OFFERS STORE LIST FILE                           02470006
      *-------------------------------------------------------------    02480006
           COPY EPRD206.                                                02490006
                                                                        02500006
      *-------------------------------------------------------------    02510006
      *  COPY BOOK FOR OFFER FILE                                       02520006
      *-------------------------------------------------------------    02530006
           COPY EPRD271.                                                02540006
                                                                        02550006
      *-------------------------------------------------------------    02560006
      *  COPY BOOK FOR OFFER SECTION FILE                               02570006
      *-------------------------------------------------------------    02580006
           COPY EPRD272.                                                02590006
                                                                        02600006
      *-------------------------------------------------------------    02610006
      *  COPY BOOK FOR OFFER BWP FILE                                   02620006
      *-------------------------------------------------------------    02630006
           COPY EPRD273.                                                02640006
                                                                        02650006
      *-------------------------------------------------------------    02660006
      *  COPY BOOK FOR OFFER MDSE FILE                                  02670006
      *-------------------------------------------------------------    02680006
           COPY EPRD274.                                                02690006
                                                                        02700006
      *-------------------------------------------------------------    02710006
      *  VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004        02720006
      *-------------------------------------------------------------    02730006
           COPY DPWS004.                                                02740006
                                                                        02750006
      ****************************************************************  03070006
       PROCEDURE DIVISION.                                              03080006
      ****************************************************************  03090006
       0000-MAINLINE.                                                   03100006
                                                                        03110006
           PERFORM 1000-INITIALIZATION.                                 03120006
                                                                        03130006
           PERFORM 1100-PROCESS-OFFERS-FILE                             03140006
             UNTIL OFFERS-DATA-FILE-EOF.                                03150006
                                                                        03190006
           PERFORM 9999-WRAPUP.                                         03200006
                                                                        03210006
           GOBACK.                                                      03220006
      ****************************************************************  03230006
      * 1000-INITIALIZATION.                                            03240006
      *  - INTIALIZES VARIABLES                                         03250006
      *  - OPEN OFFERS-DATA-FILE AND THE STORE-GROUP-FILE IN INPUT MODE 03260006
      *  - OPENS OFFER-FILE, OFFER-SECT-FILE, OFFER-BWP-FILE,           03270006
      *    OFFER-MDSE-FILE, STORE-LIST-FILE IN OUTPUT MODE              03280006
      *  - READ OFFERS DATA FILE AND CHECK IF IT IS EMPTY               03290006
      *  - READ THE STORE GROUP FILE AND CHECK IF IT IS EMPTY           03300006
      *  - PERFORM A CHECK AND ABEND IF ONE OF THE INPUT FILE HAS DATA  03310006
      *    AND THE OTHER IS EMPTY.                                      03320006
      ****************************************************************  03330006
       1000-INITIALIZATION.                                             03340006
                                                                        03341009
           ACCEPT PV-RUN-TIME FROM TIME.                                03342009
           ACCEPT PV-DATE-IN  FROM DATE.                                03343009
                                                                        03350006
                                                                        03370006
           DISPLAY '****************************************'.          03380006
           DISPLAY '**          EPKUT225 STARTED          **'.          03390006
           DISPLAY '**                                    **'.          03400006
           DISPLAY '** RUN-DATE = ' PV-DATE-IN '          **'.          03412009
           DISPLAY '** RUN-TIME = ' PV-RUN-TIME '         **'.          03413009
           DISPLAY '****************************************'.          03420006
                                                                        03430006
           INITIALIZE EP261-OFFER-EXTRACT,                              03440006
                      EP271-OFFER-XST-OFR-RECORD,                       03470006
                      EP272-OFFER-XST-OFR-SECT-RCD,                     03480006
                      EP273-OFFER-XST-BWP-RECORD,                       03490006
                      EP274-OFFER-XST-OFR-MDSE-SET.                     03500006
                                                                        03510006
           SET  PS-OFFERS-DATA-FILE-NOT-EMPTY     TO TRUE.              03520006
                                                                        03560006
           OPEN INPUT OFFERS-DATA-FILE.                                 03570006
                                                                        03600006
           OPEN OUTPUT OFFER-FILE,                                      03610006
                       OFFER-SECTION-FILE,                              03620006
                       OFFER-BWP-FILE,                                  03630006
                       OFFER-MDSE-FILE.                                 03640006
                                                                        03670006
           PERFORM 8400-READ-OFFERS-DATA-FILE.                          03680006
                                                                        03690006
           IF OFFERS-DATA-FILE-EOF                                      03700006
              DISPLAY '  NO OFFERS DATA TO PROCESS '                    03710006
           END-IF.                                                      03720006
                                                                        03730006
           IF OFFERS-DATA-FILE-NOT-EOF                                  03950006
              MOVE EP261-FILE-TYPE TO PV-PROCESS-FILE-TYPE              03960006
              ADD 1 TO PV-OFFERS-DATA-RECS                              03961006
           END-IF.                                                      03962006
      ****************************************************************  03963006
      * 1100-PROCESS-OFFERS-FILE.                                       03964006
      *  DEPENDING ON THE EP261-TABLE-TYPE , THE RECORD READ IS WRITEN  03965006
      *  TO THE FOLLOWING FOUR DIFFERENT FILES                          03966006
      *    - TABLE-TYPE = O ====> WRITE TO OFFER-FILE                   03967006
      *    - TABLE-TYPE = S ====> WRITE TO OFFER-SECTION-FILE           03968006
      *    - TABLE-TYPE = B ====> WRITE TO OFFER-BWP-FILE               03969006
      *    - TABLE-TYPE = M ====> WRITE TO OFFER-MDSE-FILE              03970006
      ****************************************************************  03980006
       1100-PROCESS-OFFERS-FILE.                                        03990006
                                                                        04000006
           EVALUATE EP261-TABLE-TYPE                                    04010006
               WHEN 'O'                                                 04020006
                   PERFORM 2000-PROCESS-OFFERS-RECORD                   04030006
               WHEN 'S'                                                 04040006
                   PERFORM 2010-PROCESS-SECTION-RECORD                  04050006
               WHEN 'B'                                                 04060006
                   PERFORM 2020-PROCESS-BWP-RECORD                      04070006
               WHEN 'M'                                                 04080006
                   PERFORM 2030-PROCESS-MDSE-RECORD                     04090006
               WHEN OTHER                                               04100006
                   CONTINUE                                             04110006
           END-EVALUATE.                                                04120006
                                                                        04130006
           PERFORM 8400-READ-OFFERS-DATA-FILE.                          04140006
      ****************************************************************  04420006
      * 2000-PROCESS-OFFERS-RECORD.                                     04430006
      *   THIS ROUTINE UPDATES THE OFFERS OUT FILE.                     04440006
      ****************************************************************  04450006
       2000-PROCESS-OFFERS-RECORD.                                      04460006
                                                                        04470006
           PERFORM 3000-BLD-OFFER-RECORD.                               04480006
           PERFORM 3010-WRT-OFFER-RECORD.                               04490006
                                                                        04500006
           ADD +1  TO PV-OFFER-OUT-COUNT.                               04510006
      ****************************************************************  04520006
      * 2010-PROCESS-SECTION-RECORD.                                    04530006
      *   THIS ROUTINE UPDATES THE OFFERS SECTION FILE.                 04540006
      ****************************************************************  04550006
       2010-PROCESS-SECTION-RECORD.                                     04560006
                                                                        04570006
           PERFORM 3030-BLD-OFFER-SECTION-RECORD.                       04580006
           PERFORM 3040-WRT-OFFER-SECTION-RECORD.                       04590006
                                                                        04600006
           ADD +1 TO PV-SECTION-OUT-COUNT.                              04610006
      ****************************************************************  04620006
      * 2020-PROCESS-BWP-RECORD                                         04630006
      *   THIS ROUTINE UPDATES THE OFFER BWP FILE.                      04640006
      ****************************************************************  04650006
       2020-PROCESS-BWP-RECORD.                                         04660006
                                                                        04670006
           PERFORM 3060-BLD-OFFER-BWP-RECORD.                           04680006
           PERFORM 3070-WRT-OFFER-BWP-RECORD.                           04690006
                                                                        04700006
           ADD +1  TO PV-BWP-OUT-COUNT.                                 04710006
      ****************************************************************  04720006
      * 2030-PROCESS-MDSE-RECORD.                                       04730006
      *   THIS ROUTINE UPDATES THE OFFERS MDSE RECORD.                  04740006
      ****************************************************************  04750006
       2030-PROCESS-MDSE-RECORD.                                        04760006
                                                                        04770006
           PERFORM 3090-BLD-OFFER-MDSE-RECORD.                          04780006
           PERFORM 3100-WRT-OFFER-MDSE-RECORD.                          04790006
                                                                        04800006
           ADD +1  TO PV-MDSE-OUT-COUNT.                                04810006
      ***************************************************************** 06150006
      * 3000-BLD-OFFER-RECORD.                                          06160006
      *   THIS ROUTINE CONSTRUCTS THE OUPUT OFFER RECORD FROM           06170006
      *   INPUT DATA.                                                   06180006
      ***************************************************************** 06190006
       3000-BLD-OFFER-RECORD.                                           06200006
                                                                        06210006
           INITIALIZE EP271-OFFER-XST-OFR-RECORD.                       06220006
                                                                        06230006
           MOVE EP261-TRIGGER-TYPE  TO EP271-TRIGGER-TYPE.              06240006
                                                                        06241006
           MOVE EP261-FILE-TYPE     TO EP271-FILE-TYPE.                 06242006
                                                                        06243006
           MOVE EP261-STR-NBR       TO EP271-STR-NBR.                   06244006
                                                                        06245006
           MOVE EP261-EVENT-ID      TO EP271-EVENT-ID.                  06246006
                                                                        06247006
           MOVE EP261-OFFER-ID      TO EP271-OFFER-ID.                  06248006
                                                                        06249006
           MOVE EP261-PROMO-SCHM-CDE TO EP271-PROMO-SCHM-CDE.           06250006
                                                                        06260006
           MOVE EP261-EVENT-TYP-CODE TO EP271-EVENT-TYP-CODE.           06270006
                                                                        06280006
           MOVE EP261-EVENT-NAME     TO EP271-EVENT-NAME.               06290006
                                                                        06300006
           MOVE EP261-OFFER-NAME     TO EP271-OFFER-NAME.               06310006
                                                                        06320006
           MOVE EP261-DISC-LEVEL-CODE TO EP271-DISC-LEVEL-CODE.         06330006
                                                                        06340006
           MOVE EP261-OFFER-USAGE-TYPE-CODE TO                          06350006
                                            EP271-OFFER-USAGE-TYPE-CODE.06360006
                                                                        06370006
           MOVE EP261-BARCODE-TYPE-CODE  TO EP271-BARCODE-TYPE-CODE.    06380006
                                                                        06390006
           MOVE EP261-UNEARN-IND     TO EP271-UNEARN-IND.               06400006
                                                                        06410006
           MOVE EP261-OFR-TRGR-TYP-CDE TO EP271-OFR-TRGR-TYP-CDE.       06420006
                                                                        06430006
           MOVE EP261-BWP-ITM-APPL-CDE TO EP271-BWP-ITM-APPL-CDE.       06440006
                                                                        06450006
           MOVE EP261-STR-GRP-TYP-CDE  TO EP271-STR-GRP-TYP-CDE.        06460006
                                                                        06470006
           MOVE EP261-STR-GRP-ID       TO EP271-STR-GRP-ID.             06480006
                                                                        06490006
           MOVE EP261-SG-IE-IND        TO EP271-SG-IE-IND.              06500006
      ***************************************************************** 06510006
      * 3010-WRT-OFFER-RECORD.                                          06520006
      *   THIS PARAGRAPH WRITES THE UPDATED OFFER RECORD TO THE         06530006
      *     OUTPUT FILE.                                                06540006
      ***************************************************************** 06550006
       3010-WRT-OFFER-RECORD.                                           06560006
                                                                        06570006
           WRITE OFFER-RECORD                                           06580006
             FROM EP271-OFFER-XST-OFR-RECORD.                           06590006
      ***************************************************************** 06600006
      * 3030-BLD-OFFER-SECTION-RECORD.                                  06610006
      *   THIS ROUTINE CONSTRUCTS THE OFFER SECTION RECORD FROM         06620006
      *     THE INPUT EPK205 RECORD.                                    06630006
      ***************************************************************** 06640006
       3030-BLD-OFFER-SECTION-RECORD.                                   06650006
                                                                        06660006
           INITIALIZE EP272-OFFER-XST-OFR-SECT-RCD.                     06670006
                                                                        06680006
           MOVE EP261-TRIGGER-TYPE  TO EP272-TRIGGER-TYPE.              06690006
                                                                        06700006
           MOVE EP261-FILE-TYPE     TO EP272-FILE-TYPE.                 06710006
                                                                        06720006
           MOVE EP261-STR-NBR       TO EP272-STR-NBR.                   06730006
                                                                        06740006
           MOVE EP261-EVENT-ID      TO EP272-EVENT-ID.                  06750006
                                                                        06760006
           MOVE EP261-OFFER-ID      TO EP272-OFFER-ID.                  06770006
                                                                        06780006
           MOVE EP261-OFR-SECT-TYP-CDE TO EP272-OFR-SECT-TYP-CDE.       06790006
                                                                        06800006
           MOVE EP261-EFF-BEG-DTE    TO EP272-EFF-BEG-DTE.              06810006
                                                                        06820006
           MOVE EP261-EFF-END-DTE    TO EP272-EFF-END-DTE.              06830006
                                                                        06840006
           MOVE EP261-REDMN-SUPVR-OVRRID-DTE     TO                     06850006
                                    EP272-REDMN-SUPVR-OVRRID-DTE.       06860006
                                                                        06870006
           MOVE EP261-BWP-GET-CNCTR-CDE TO EP272-BWP-GET-CNCTR-CDE.     06880006
                                                                        06890006
           MOVE EP261-BWP-BUY-CNCTR-CDE TO EP272-BWP-BUY-CNCTR-CDE.     06900006
                                                                        06910006
           MOVE EP261-CUSTFACG-SHRT-DESC TO EP272-CUSTFACG-SHRT-DESC.   06920006
                                                                        06930006
           MOVE EP261-POS-BTN-TXT   TO EP272-POS-BTN-TXT.               06940006
                                                                        06950006
           MOVE EP261-VLD-POS-TNDR-CMP-TYP-CDE   TO                     06960006
                                        EP272-VLD-POS-TNDR-CMP-TYP-CDE. 06970006
                                                                        06980006
           IF EP261-POS-BTN-RLTV-SEQ-NBR-X(1:1) = '~'                   06990006
               MOVE SPACES TO EP272-POS-BTN-RLTV-SEQ-NBR-X              07000006
               MOVE PC-NULL-VALUE  TO EP272-POS-BTN-RLTV-SEQ-NBR-X      07010006
           ELSE                                                         07020006
               MOVE EP261-POS-BTN-RLTV-SEQ-NBR TO                       07030006
                                           EP272-POS-BTN-RLTV-SEQ-NBR   07040006
           END-IF.                                                      07050006
                                                                        07060006
           IF EP261-LMT-PER-TRN-QTY-X(1:1) = '~'                        07070006
               MOVE SPACES   TO EP272-LMT-PER-TRN-QTY-X                 07080006
               MOVE PC-NULL-VALUE  TO EP272-LMT-PER-TRN-QTY-X           07090006
           ELSE                                                         07100006
               MOVE EP261-LMT-PER-TRN-QTY  TO EP272-LMT-PER-TRN-QTY     07110006
           END-IF.                                                      07120006
                                                                        07130006
           MOVE EP261-STR-GRP-TYP-CDE  TO EP272-STR-GRP-TYP-CDE.        07140006
                                                                        07150006
           MOVE EP261-STR-GRP-ID       TO EP272-STR-GRP-ID.             07160006
                                                                        07170006
           MOVE EP261-SG-IE-IND        TO EP272-SG-IE-IND.              07180006
      ****************************************************************  07190006
      * 3040-WRT-OFFER-SECTION-RECORD.                                  07200006
      *   THIS ROUTINE WRITES THE UPDATED OFFER SECTION RECORD TO       07210006
      *     THE OUTPUT FILE.                                            07220006
      ****************************************************************  07230006
       3040-WRT-OFFER-SECTION-RECORD.                                   07240006
                                                                        07250006
           WRITE OFFER-SECTION-RECORD                                   07260006
             FROM EP272-OFFER-XST-OFR-SECT-RCD.                         07270006
      ****************************************************************  07280006
      * 3060-BLD-OFFER-BWP-RECORD.                                      07290006
      *   THIS ROUTINE CONSTRUCTS THE OFFER BWP RECORD FROM             07300006
      *     THE INPUT EPK205 RECORD.                                    07310006
      ****************************************************************  07320006
       3060-BLD-OFFER-BWP-RECORD.                                       07330006
                                                                        07340006
           INITIALIZE EP273-OFFER-XST-BWP-RECORD.                       07350006
                                                                        07360006
           MOVE EP261-TRIGGER-TYPE   TO EP273-TRIGGER-TYPE.             07370006
                                                                        07380006
           MOVE EP261-FILE-TYPE      TO EP273-FILE-TYPE.                07390006
                                                                        07400006
           MOVE EP261-STR-NBR        TO EP273-STR-NBR.                  07410006
                                                                        07420006
           MOVE EP261-EVENT-ID       TO EP273-EVENT-ID.                 07430006
                                                                        07440006
           MOVE EP261-OFFER-ID       TO EP273-OFFER-ID.                 07450006
                                                                        07460006
           MOVE EP261-OFR-SECT-TYP-CDE   TO EP273-OFR-SECT-TYP-CDE.     07470006
                                                                        07480006
           MOVE EP261-OFR-SECT-BWP-ID    TO EP273-OFR-SECT-BWP-ID.      07490006
                                                                        07500006
           IF EP261-TIER-LVL-NBR-X = '~'                                07510006
               MOVE SPACES    TO EP273-TIER-LVL-NBR-X                   07520006
               MOVE PC-NULL-VALUE   TO EP273-TIER-LVL-NBR-X             07530006
           ELSE                                                         07540006
               MOVE EP261-TIER-LVL-NBR   TO EP273-TIER-LVL-NBR          07550006
           END-IF.                                                      07560006
                                                                        07570006
           MOVE EP261-BWP-SELN-TYP-CDE   TO EP273-BWP-SELN-TYP-CDE.     07580006
                                                                        07590006
           IF EP261-BWP-BUY-QTY-X = '~'                                 07600006
               MOVE SPACES     TO EP273-BWP-BUY-QTY-X                   07610006
               MOVE PC-NULL-VALUE  TO EP273-BWP-BUY-QTY-X               07620006
           ELSE                                                         07630006
               MOVE EP261-BWP-BUY-QTY   TO EP273-BWP-BUY-QTY            07640006
           END-IF.                                                      07650006
                                                                        07660006
           IF EP261-BWP-BUY-AMT-X = '~'                                 07670006
               MOVE SPACES     TO EP273-BWP-BUY-AMT-X                   07680006
               MOVE PC-NULL-VALUE TO EP273-BWP-BUY-AMT-X                07690006
           ELSE                                                         07700006
               MOVE EP261-BWP-BUY-AMT  TO EP273-BWP-BUY-AMT             07710006
           END-IF.                                                      07720006
                                                                        07730006
           IF EP261-BWP-BUY-TOL-AMT-X = '~'                             07740006
               MOVE SPACES     TO EP273-BWP-BUY-TOL-AMT-X               07750006
               MOVE PC-NULL-VALUE   TO EP273-BWP-BUY-TOL-AMT-X          07760006
           ELSE                                                         07770006
               MOVE EP261-BWP-BUY-TOL-AMT   TO EP273-BWP-BUY-TOL-AMT    07780006
           END-IF.                                                      07790006
                                                                        07800006
           IF EP261-BWP-GET-QTY-X = '~'                                 07810006
               MOVE SPACES       TO EP273-BWP-GET-QTY-X                 07820006
               MOVE PC-NULL-VALUE  TO EP273-BWP-GET-QTY-X               07830006
           ELSE                                                         07840006
               MOVE EP261-BWP-GET-QTY  TO EP273-BWP-GET-QTY             07850006
           END-IF.                                                      07860006
                                                                        07870006
           IF EP261-BWP-GET-PCT-OFF-PCT-X = '~'                         07880006
               MOVE SPACES    TO EP273-BWP-GET-PCT-OFF-PCT-X            07890006
               MOVE PC-NULL-VALUE TO EP273-BWP-GET-PCT-OFF-PCT-X        07900006
           ELSE                                                         07910006
               MOVE EP261-BWP-GET-PCT-OFF-PCT  TO                       07920006
                                           EP273-BWP-GET-PCT-OFF-PCT    07930006
           END-IF.                                                      07940006
                                                                        07950006
           IF EP261-BWP-GET-DOL-OFF-AMT-X = '~'                         07960006
               MOVE SPACES   TO EP273-BWP-GET-DOL-OFF-AMT-X             07970006
                                                                        07980006
               MOVE PC-NULL-VALUE  TO EP273-BWP-GET-DOL-OFF-AMT-X       07990006
           ELSE                                                         08000006
               MOVE EP261-BWP-GET-DOL-OFF-AMT TO                        08010006
                                            EP273-BWP-GET-DOL-OFF-AMT   08020006
           END-IF.                                                      08030006
                                                                        08040006
           MOVE EP261-BWP-GET-PRPT-AMT  TO EP273-BWP-GET-PRPT-AMT.      08050006
                                                                        08060006
           IF EP261-BWP-GET-PRPT-AMT-X = '~'                            08070006
               MOVE SPACES        TO EP273-BWP-GET-PRPT-AMT-X           08080006
               MOVE PC-NULL-VALUE TO EP273-BWP-GET-PRPT-AMT-X           08090006
           ELSE                                                         08100006
               MOVE EP261-BWP-GET-PRPT-AMT   TO EP273-BWP-GET-PRPT-AMT  08110006
           END-IF.                                                      08120006
                                                                        08130006
           MOVE EP261-STR-GRP-TYP-CDE  TO EP273-STR-GRP-TYP-CDE.        08140006
                                                                        08150006
           MOVE EP261-STR-GRP-ID       TO EP273-STR-GRP-ID.             08160006
                                                                        08170006
           MOVE EP261-SG-IE-IND        TO EP273-SG-IE-IND.              08180006
                                                                        08190006
      ****************************************************************  08200006
      * 3070-WRT-OFFER-BWP-RECORD.                                      08210006
      *   THIS ROUTINE WRITES THE UPDATED OFFER BWP RECORD TO           08220006
      *     THE OUTPUT FILE.                                            08230006
      ****************************************************************  08240006
       3070-WRT-OFFER-BWP-RECORD.                                       08250006
                                                                        08260006
           WRITE OFFER-BWP-RECORD                                       08270006
             FROM EP273-OFFER-XST-BWP-RECORD.                           08280006
                                                                        08290006
      ****************************************************************  08300006
      * 3090-BLD-OFFER-MDSE-RECORD.                                     08310006
      *   THIS ROUTINE CONSTRUCTS THE OFFER MDSE RECORD FROM            08320006
      *     THE INPUT EPRD261 RECORD.                                   08330006
      ****************************************************************  08340006
       3090-BLD-OFFER-MDSE-RECORD.                                      08350006
                                                                        08360006
           INITIALIZE EP274-OFFER-XST-OFR-MDSE-SET.                     08370006
                                                                        08380006
           MOVE EP261-TRIGGER-TYPE   TO EP274-TRIGGER-TYPE.             08390006
                                                                        08400006
           MOVE EP261-FILE-TYPE      TO EP274-FILE-TYPE.                08410006
                                                                        08420006
           MOVE EP261-STR-NBR        TO EP274-STR-NBR.                  08430006
                                                                        08440006
           MOVE EP261-EVENT-ID       TO EP274-EVENT-ID.                 08450006
                                                                        08460006
           MOVE EP261-OFFER-ID       TO EP274-OFFER-ID.                 08470006
                                                                        08480006
           MOVE EP261-OFR-SECT-TYP-CDE  TO EP274-OFR-SECT-TYP-CDE.      08490006
                                                                        08500006
           MOVE EP261-OFR-SECT-BWP-ID-M TO EP274-OFR-SECT-BWP-ID.       08510006
                                                                        08520006
           MOVE EP261-MDSE-SET-ID    TO EP274-MDSE-SET-ID.              08530006
                                                                        08540006
           MOVE EP261-MDSE-HIER-CDE  TO EP274-MDSE-HIER-CDE.            08550006
                                                                        08560006
           IF EP261-DEPT-NBR-X = '~'                                    08570006
               MOVE SPACES     TO EP274-DEPT-NBR-X                      08580006
               MOVE PC-NULL-VALUE   TO EP274-DEPT-NBR-X                 08590006
           ELSE                                                         08600006
               MOVE EP261-DEPT-NBR  TO EP274-DEPT-NBR                   08610006
           END-IF.                                                      08620006
                                                                        08630006
           IF EP261-MAJ-CL-NBR-X = '~'                                  08640006
               MOVE SPACES      TO EP274-MAJ-CL-NBR-X                   08650006
               MOVE PC-NULL-VALUE  TO EP274-MAJ-CL-NBR-X                08660006
           ELSE                                                         08670006
               MOVE EP261-MAJ-CL-NBR  TO EP274-MAJ-CL-NBR               08680006
           END-IF.                                                      08690006
                                                                        08700006
           IF EP261-SUB-CL-NBR-X = '~'                                  08710006
               MOVE SPACES        TO EP274-SUB-CL-NBR-X                 08720006
               MOVE PC-NULL-VALUE  TO EP274-SUB-CL-NBR-X                08730006
           ELSE                                                         08740006
               MOVE EP261-SUB-CL-NBR   TO EP274-SUB-CL-NBR              08750006
           END-IF.                                                      08760006
                                                                        08770006
           IF EP261-STYL-ID-X = '~'                                     08780006
               MOVE SPACES     TO EP274-STYL-ID-X                       08790006
               MOVE PC-NULL-VALUE   TO EP274-STYL-ID-X                  08800006
           ELSE                                                         08810006
               MOVE EP261-STYL-ID   TO EP274-STYL-ID                    08820006
           END-IF.                                                      08830006
                                                                        08840006
           MOVE EP261-SKU-NBR    TO EP274-SKU-NBR.                      08850006
                                                                        08860006
           IF EP261-SKU-NBR-X = '~'                                     08870006
               MOVE SPACES   TO EP274-SKU-NBR-X                         08880006
               MOVE PC-NULL-VALUE    TO EP274-SKU-NBR-X                 08890006
           ELSE                                                         08900006
               MOVE EP261-SKU-NBR    TO EP274-SKU-NBR                   08910006
           END-IF.                                                      08920006
                                                                        08930006
           MOVE EP261-IE-IND          TO EP274-IE-IND.                  08940006
                                                                        08950006
           MOVE EP261-EMP-DISC-CDE    TO EP274-EMP-DISC-CDE.            08960006
                                                                        08970006
           MOVE EP261-DISC-ELIG-IND   TO EP274-DISC-ELIG-IND.           08980006
                                                                        08990006
           MOVE EP261-TKT-CLOR-CDE    TO EP274-TKT-CLOR-CDE.            09000006
                                                                        09010006
           MOVE EP261-STR-GRP-TYP-CDE  TO EP274-STR-GRP-TYP-CDE.        09020006
                                                                        09030006
           MOVE EP261-STR-GRP-ID       TO EP274-STR-GRP-ID.             09040006
                                                                        09050006
           MOVE EP261-SG-IE-IND        TO EP274-SG-IE-IND.              09060006
                                                                        09070006
      ****************************************************************  09080006
      * 3100-WRT-OFFER-MDSE-RECORD.                                     09090006
      *   THIS ROUTINE WRITES THE UPDATED OFFER MDSE RECORD TO          09100006
      *     THE OUTPUT FILE.                                            09110006
      ****************************************************************  09120006
       3100-WRT-OFFER-MDSE-RECORD.                                      09130006
                                                                        09140006
           WRITE OFFER-MDSE-RECORD                                      09150006
             FROM EP274-OFFER-XST-OFR-MDSE-SET.                         09160006
                                                                        09170006
      ***************************************************************** 13460006
      * 8400-READ-OFFERS-DATA-FILE.                                     13470006
      ***************************************************************** 13480006
       8400-READ-OFFERS-DATA-FILE.                                      13490006
                                                                        13500006
           READ OFFERS-DATA-FILE                                        13510006
             INTO EP261-OFFER-EXTRACT                                   13520006
               AT END                                                   13530006
                   SET OFFERS-DATA-FILE-EOF                             13540006
                     TO TRUE                                            13550006
               NOT AT END                                               13560006
                   ADD 1                                                13570006
                     TO PV-OFFERS-DATA-RECS                             13580006
           END-READ.                                                    13590006
                                                                        13600010
      ***************************************************************** 14000006
      * 9999-WRAPUP.                                                    14010006
      ***************************************************************** 14020006
       9999-WRAPUP.                                                     14030006
                                                                        14040006
           CLOSE OFFERS-DATA-FILE                                       14080006
                 OFFER-FILE                                             14090006
                 OFFER-SECTION-FILE                                     14100006
                 OFFER-BWP-FILE                                         14110006
                 OFFER-MDSE-FILE.                                       14120006
                                                                        14130006
           DISPLAY ' '.                                                 14140006
           DISPLAY '*********************************************'.     14150006
           DISPLAY 'PROGRAM NAME: ' PC-PROGRAM-NAME.                    14160006
           DISPLAY '*********************************************'.     14170006
           DISPLAY ' '.                                                 14171006
           DISPLAY 'NUMBER OF OFFERS RECORDS READ: '                    14172006
                    PV-OFFERS-DATA-RECS.                                14173006
           DISPLAY ' '.                                                 14174006
           DISPLAY 'NUMBER OF OFFER RCDS WRITTEN: ' PV-OFFER-OUT-COUNT. 14178006
           DISPLAY ' '.                                                 14179006
           DISPLAY 'NUMBER OF SECTION RCDS WRITTEN: '                   14180006
                    PV-SECTION-OUT-COUNT.                               14190006
           DISPLAY ' '.                                                 14200006
           DISPLAY 'NUMBER OF BWP RECORDS WRITTEN: '                    14210006
                    PV-BWP-OUT-COUNT.                                   14220006
           DISPLAY ' '.                                                 14230006
           DISPLAY 'NUMBER OF MERCHANDISE RCDS WRITTEN: '               14240006
                    PV-MDSE-OUT-COUNT.                                  14250006
           DISPLAY ' '.                                                 14260006
           DISPLAY '*********************************************'.     14290006
      *********************  END OF PROGRAM  ***************************14300006
