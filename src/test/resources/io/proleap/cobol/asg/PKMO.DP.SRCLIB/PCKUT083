000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             PCKUT083.                                00050000
000600 AUTHOR.                 RANDY DELAURA.                           00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            JUNE 2009.                               00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110006
001200*  CHANGE LOG                                                     00120006
001300*  DATE       CHANGED BY    DESC                                  00130006
001400*  ---------- ------------- --------------------------------------00140006
001500******************************************************************00150002
002610*  09-22-2011 C. TWIEHAUS - CODEWORKS                             00160006
002620*                           WR 38972 MLOF REMOVE STORE TRANSLATION00170005
002700******************************************************************00180000
002800                                                                  00190000
002900******************************************************************00200000
003000 ENVIRONMENT DIVISION.                                            00210000
003100******************************************************************00220000
003200                                                                  00230000
003300 CONFIGURATION SECTION.                                           00240000
003400 SOURCE-COMPUTER.        IBM-3090.                                00250000
003500 OBJECT-COMPUTER.        IBM-3090.                                00260000
003600 INPUT-OUTPUT SECTION.                                            00270000
003700                                                                  00280000
003800 FILE-CONTROL.                                                    00290000
003900                                                                  00300000
004000     SELECT INPUT01-FILE    ASSIGN TO INP01.                      00310000
004100     SELECT OUTPUT01-FILE   ASSIGN TO OUT01.                      00320000
004200     SELECT OUTPUT02-FILE   ASSIGN TO OUT02.                      00330000
004300                                                                  00340000
004400******************************************************************00350000
004500 DATA DIVISION.                                                   00360000
004600******************************************************************00370000
004700                                                                  00380000
004800 FILE SECTION.                                                    00390000
004900                                                                  00400000
005000 FD  INPUT01-FILE                                                 00410000
005100     RECORDING MODE IS F                                          00420000
005200     LABEL RECORDS ARE STANDARD                                   00430000
005300     BLOCK CONTAINS 0 RECORDS.                                    00440000
005400                                                                  00450000
005500 01  INPUT01-RECORD                   PIC X(1055).                00460000
005600                                                                  00470000
005700 FD  OUTPUT01-FILE                                                00480000
005800     RECORDING MODE IS F                                          00490000
005900     LABEL RECORDS ARE STANDARD                                   00500000
006000     BLOCK CONTAINS 0 RECORDS.                                    00510000
006100                                                                  00520000
006200 01  OUTPUT01-RECORD                  PIC X(100).                 00530000
006300                                                                  00540000
006400 FD  OUTPUT02-FILE                                                00550000
006500     RECORDING MODE IS F                                          00560000
006600     LABEL RECORDS ARE STANDARD                                   00570000
006700     BLOCK CONTAINS 0 RECORDS.                                    00580000
006800                                                                  00590000
006900 01  OUTPUT02-RECORD                  PIC X(200).                 00600000
007000/                                                                 00610000
007100******************************************************************00620000
007200 WORKING-STORAGE SECTION.                                         00630000
007300******************************************************************00640000
007400                                                                  00650000
007500 01  FILLER.                                                      00660000
007600     05  FILLER                       PIC  X(36)   VALUE          00670000
007700         ' ***** WORKING STORAGE PGM=PCKUT083 '.                  00680000
007800                                                                  00690000
007900 01  ABEND-CODE                       PIC S9(04)   VALUE +0       00700000
008000                                                   COMP SYNC.     00710000
008100     88  ABEND-4013-DB2-ERROR                      VALUE +4013.   00720000
008200                                                                  00730000
008300 01  DK-VARIABLES.                                                00740000
008400     05 DK-SKU-NBR                    PIC S9(9)  COMP-3 VALUE +0. 00750000
008500     05 DK-PO-NBR                     PIC S9(9)  COMP   VALUE +0. 00760000
008600     05 DK-STORE-NBR                  PIC S9(4)  COMP   VALUE +0. 00770000
008700     05 DK-ITEM-NBR                   PIC S9(15) COMP-3 VALUE +0. 00780000
008800                                                                  00790000
008900 01  PS-SWITCHES.                                                 00800000
009000     05  PS-EOF-SW                    PIC X(01)    VALUE 'N'.     00810000
009100         88  PS-EOF                                VALUE 'Y'.     00820000
009200     05  PS-CURSOR-EOF-SW             PIC X(01)    VALUE 'N'.     00830000
009300         88  PS-CURSOR-EOF                         VALUE 'Y'.     00840000
009400     05  PS-FOUND-SW                  PIC X(01)    VALUE 'N'.     00850000
009500         88  PS-FOUND-YES                          VALUE 'Y'.     00860000
009600         88  PS-FOUND-NO                           VALUE 'N'.     00870000
009700     05  PS-TRANSACTION-WRITTEN-SW    PIC X(01)    VALUE 'N'.     00880000
009800         88  PS-TRANSACTION-WRITTEN                VALUE 'Y'.     00890000
009900                                                                  00900000
010000 01  PV-VARIABLES.                                                00910000
010100     05  PV-DISPLAY                  PIC ZZ,ZZ9-.                 00920000
010200     05  PV-SQL-CODE                 PIC 9(04)      VALUE ZERO.   00930000
010300     05  PV-ABEND-PARAGRAPH          PIC X(30)      VALUE SPACES. 00940000
010400     05  PV-ABEND-OPERATION          PIC X(20)      VALUE SPACES. 00950000
010500     05  PV-ABEND-STRUCTURE-1        PIC X(20)      VALUE SPACES. 00960000
010600     05  PV-SE-QTY                   PIC S9(9)    COMP VALUE +0.  00970000
010700     05  PV-FETCH-COUNT              PIC S9(9)    COMP VALUE +0.  00980000
010800     05  PV-INPUT01-COUNT            PIC S9(5)    COMP-3 VALUE +0.00990000
010900     05  PV-OUTPUT01-COUNT           PIC S9(5)    COMP-3 VALUE +0.01000000
011000     05  PV-OUTPUT02-COUNT           PIC S9(5)    COMP-3 VALUE +0.01010000
011200                                                                  01020000
011300 01  PC-CONSTANTS.                                                01030000
011400     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          01040000
011500                                                   'PCKUT083'.    01050000
011600     05  PC-ILBOABN0                 PIC  X(08)    VALUE          01060000
011700                                                   'ILBOABN0'.    01070000
011800/                                                                 01080000
011900***************************************************************** 01090000
012000* INPUT COPYBOOK(S)                                             * 01100000
012100***************************************************************** 01110000
012200     COPY WSRD014.                                                01120000
012300     COPY WSRD027.                                                01130000
012400/                                                                 01140000
012500***************************************************************** 01150000
012600* OUTPUT COPYBOOK(S)                                            * 01160000
012700***************************************************************** 01170000
012800     COPY PCRD010.                                                01180000
012900     COPY PCRD066.                                                01190000
013000/                                                                 01200000
013100***************************************************************** 01210000
013200*    DCLGEN FOR TRECEIV                                         * 01220000
013300***************************************************************** 01230000
013400     EXEC SQL                                                     01240000
013500         INCLUDE TRECEIV                                          01250000
013600     END-EXEC.                                                    01260000
013700/                                                                 01270000
013800***************************************************************** 01280000
013900*    DCLGEN FOR TRECITM                                         * 01290000
014000***************************************************************** 01300000
014100     EXEC SQL                                                     01310000
014200         INCLUDE TRECITM                                          01320000
014300     END-EXEC.                                                    01330000
014400/                                                                 01340000
014500***************************************************************** 01350000
014600*    DCLGEN FOR TRECDIS                                         * 01360000
014700***************************************************************** 01370000
014800     EXEC SQL                                                     01380000
014900         INCLUDE TRECDIS                                          01390000
015000     END-EXEC.                                                    01400000
015100/                                                                 01410000
015200***************************************************************** 01420000
015300*    DCLGEN FOR XLT_SKU                                         * 01430000
015400***************************************************************** 01440000
015500     EXEC SQL                                                     01450000
015600         INCLUDE XLT00003                                         01460000
015700     END-EXEC.                                                    01470000
015800/                                                                 01480000
015900***************************************************************** 01490000
016000*    DCLGEN FOR PCT_TRN_CLSN_DTL                                * 01500000
016100***************************************************************** 01510000
016200     EXEC SQL                                                     01520000
016300         INCLUDE PCT00015                                         01530000
016400     END-EXEC.                                                    01540000
016500/                                                                 01550000
016600***************************************************************** 01560000
016700*    DCLGEN TABLE(TUPCPLS)                                      * 01570000
016800***************************************************************** 01580000
016900     EXEC SQL                                                     01590000
017000         INCLUDE TUPCPLS                                          01600000
017100     END-EXEC.                                                    01610000
017200/                                                                 01620000
018000***************************************************************** 01630000
018100*    STORE EXPECTED CURSOR                                      * 01640000
018200***************************************************************** 01650000
018300     EXEC SQL                                                     01660000
018400         DECLARE STORE_EXPECTED_CURSOR CURSOR                     01670000
018500             FOR SELECT B.RCVR_SEQ_NBR                            01680000
018600                      , A.INTR_UPC_ID                             01690000
018700                      , SUM(B.TRN_CLSN_PRCG_QTY) AS SE_QTY        01700000
018800                      , A.ITM_NBR                                 01710000
018900                   FROM XLT_SKU A                                 01720000
019000                      , PCT_TRN_CLSN_DTL B                        01730000
019100                  WHERE A.SKU_NBR       = :DK-SKU-NBR             01740000
019200                    AND B.INTR_UPC_ID   = A.INTR_UPC_ID           01750000
019300                    AND B.PO_NBR        = :DK-PO-NBR              01760000
019400                    AND B.LOC_NBR       = :DK-STORE-NBR           01770006
019500                    AND B.TRN_CLSN_CDE  = 'SE'                    01780000
164325                    AND B.TRN_TYP_CDE NOT IN ('NS', 'MM', 'UM',   01790020
164325                                              'AM', 'SM')         01800020
019600                 GROUP BY B.RCVR_SEQ_NBR                          01810000
019700                        , A.ITM_NBR                               01820000
019800                        , A.INTR_UPC_ID                           01830000
019900                 ORDER BY B.RCVR_SEQ_NBR                          01840000
020000                        , SE_QTY                                  01850000
020100     END-EXEC.                                                    01860000
020200/                                                                 01870000
020300***************************************************************** 01880000
020400*  COMMUNICATIONS AREA FOR DB2                                  * 01890000
020500***************************************************************** 01900000
020600     EXEC SQL                                                     01910000
020700         INCLUDE SQLCA                                            01920000
020800     END-EXEC.                                                    01930000
020900                                                                  01940000
021000     COPY SQLCA2.                                                 01950000
021100/                                                                 01960000
021200***************************************************************** 01970000
021300*  DB2 FORMATTED MESSAGE AREA                                   * 01980000
021400***************************************************************** 01990000
021500     COPY DPWS004.                                                02000000
021600/                                                                 02010000
021700***************************************************************** 02020000
021800 PROCEDURE DIVISION.                                              02030000
021900***************************************************************** 02040000
022000                                                                  02050000
022100     OPEN INPUT  INPUT01-FILE                                     02060000
022200          OUTPUT OUTPUT01-FILE                                    02070000
022300                 OUTPUT02-FILE.                                   02080000
022400                                                                  02090000
022500     PERFORM 1000-PROCESS-INPUT                                   02100000
022600        THRU 1000-PROCESS-INPUT-EXIT                              02110000
022700            UNTIL ( PS-EOF ).                                     02120000
022800                                                                  02130000
022900     MOVE PV-INPUT01-COUNT  TO PV-DISPLAY.                        02140000
023000     DISPLAY '   INPUT 01 READ: ' PV-DISPLAY.                     02150000
023100     MOVE PV-OUTPUT01-COUNT TO PV-DISPLAY.                        02160000
023200     DISPLAY 'OUTPUT 01 WRITTEN: ' PV-DISPLAY.                    02170000
023300     MOVE PV-OUTPUT02-COUNT TO PV-DISPLAY.                        02180000
023400     DISPLAY 'OUTPUT 02 WRITTEN: ' PV-DISPLAY.                    02190000
023500                                                                  02200000
023600     CLOSE INPUT01-FILE                                           02210000
023700           OUTPUT01-FILE                                          02220000
023800           OUTPUT02-FILE.                                         02230000
023900                                                                  02240000
024000     GOBACK.                                                      02250000
024100/                                                                 02260000
024200***************************************************************** 02270000
024300* 1000-PROCESS-INPUT.                                             02280000
024400***************************************************************** 02290000
024500 1000-PROCESS-INPUT.                                              02300000
024700                                                                  02310000
024800     READ INPUT01-FILE INTO WS027-RECEIPT-PIX-ERROR-REC           02320000
024900         AT END SET PS-EOF TO TRUE                                02330000
025000                GO TO 1000-PROCESS-INPUT-EXIT.                    02340000
025100                                                                  02350000
025200     MOVE WS027-FORMAT-RECORD(40:203)                             02360000
025300       TO WS014-RECEIPT-PIX-RECORD.                               02370000
025400                                                                  02380000
025500     ADD  +1                 TO PV-INPUT01-COUNT.                 02390000
025600     MOVE WS014-SKU-NUMBER   TO DK-SKU-NBR.                       02400000
025700     MOVE WS014-PO-NUMBER    TO DK-PO-NBR.                        02410000
025800     MOVE WS014-STORE-NUMBER TO DK-STORE-NBR.                     02420000
026200     MOVE 'N' TO PS-TRANSACTION-WRITTEN-SW                        02430000
026300                 PS-CURSOR-EOF-SW                                 02440000
026400                 PS-FOUND-SW.                                     02450000
026500     MOVE +0  TO PV-FETCH-COUNT                                   02460000
026600                 PV-SE-QTY.                                       02470000
026700                                                                  02480000
026800     PERFORM 1040-OPEN-CURSOR.                                    02490000
026900     PERFORM 1050-FETCH-EXPECTED                                  02500000
027000            UNTIL ( PS-CURSOR-EOF ) OR ( PS-FOUND-YES ).          02510000
027100     PERFORM 1060-CLOSE-CURSOR.                                   02520000
027200                                                                  02530000
027300     IF ( PS-FOUND-YES )                                          02540000
027400         PERFORM 3015-SELECT-RECEIVER-NBR                         02550000
027500         PERFORM 7000-WRITE-STORE-EXPECTED                        02560000
027600         PERFORM 7010-WRITE-REPORT                                02570000
027700         GO TO 1000-PROCESS-INPUT-EXIT                            02580000
027800     END-IF.                                                      02590000
027900                                                                  02600000
028000     PERFORM 3030-SELECT-ITM-NBR                                  02610000
028100     PERFORM 3000-SELECT-RECEIVER-NBR.                            02620000
028200                                                                  02630000
028300     IF ( PS-FOUND-YES )                                          02640000
028400         PERFORM 7000-WRITE-STORE-EXPECTED                        02650000
028500         PERFORM 7010-WRITE-REPORT                                02660000
028600         GO TO 1000-PROCESS-INPUT-EXIT                            02670000
028700     END-IF.                                                      02680000
028800                                                                  02690000
028900     PERFORM 3010-SELECT-RECEIVER-NBR.                            02700000
029000                                                                  02710000
029100     IF ( PS-FOUND-YES )                                          02720000
029200         PERFORM 7000-WRITE-STORE-EXPECTED                        02730000
029300         PERFORM 7010-WRITE-REPORT                                02740000
029400     ELSE                                                         02750000
029500         PERFORM 7010-WRITE-REPORT                                02760000
029600     END-IF.                                                      02770000
029700                                                                  02780000
029800 1000-PROCESS-INPUT-EXIT.                                         02790000
029900     EXIT.                                                        02800000
030000/                                                                 02810000
030100***************************************************************** 02820000
030200* 1040-OPEN-CURSOR.                                               02830000
030300***************************************************************** 02840000
030400 1040-OPEN-CURSOR.                                                02850000
030500                                                                  02860000
030600     EXEC SQL                                                     02870000
030700         OPEN STORE_EXPECTED_CURSOR                               02880000
030800     END-EXEC.                                                    02890000
030900                                                                  02900000
031000     EVALUATE TRUE                                                02910000
031100         WHEN SQLCODE = +0                                        02920000
031200             CONTINUE                                             02930000
031300         WHEN OTHER                                               02940000
031400            MOVE '1040-OPEN-CURSOR'      TO PV-ABEND-PARAGRAPH    02950000
031500            MOVE SQLCODE                 TO PV-SQL-CODE           02960000
031600            MOVE 'OPEN'                  TO PV-ABEND-OPERATION    02970000
031700            MOVE 'STORE_EXPECTED_CURSOR' TO PV-ABEND-STRUCTURE-1  02980000
031800            PERFORM 9900-SQL-ERROR                                02990000
031900     END-EVALUATE.                                                03000000
032000/                                                                 03010000
032100***************************************************************** 03020000
032200* 1050-FETCH-EXPECTED.                                            03030000
032300***************************************************************** 03040000
032400 1050-FETCH-EXPECTED.                                             03050000
032500                                                                  03060000
032600     EXEC SQL                                                     03070000
032700         FETCH STORE_EXPECTED_CURSOR                              03080000
032800          INTO   :PCT00015-RCVR-SEQ-NBR                           03090000
032900               , :XLT00003-INTR-UPC-ID                            03100000
033000               , :PV-SE-QTY                                       03110000
033100               , :XLT00003-ITM-NBR                                03120000
033200     END-EXEC.                                                    03130000
033300                                                                  03140000
033400     EVALUATE TRUE                                                03150000
033500         WHEN SQLCODE = +0                                        03160000
033600             ADD +1 TO PV-FETCH-COUNT                             03170000
033700             IF ( PV-SE-QTY > +0 )                                03180000
033800                 SET PS-FOUND-YES   TO TRUE                       03190000
033900             END-IF                                               03200000
034000         WHEN SQLCODE = +100                                      03210000
034100             SET PS-CURSOR-EOF  TO TRUE                           03220000
034200             INITIALIZE DCLPCT00015                               03230000
034300                        DCLXLT00003                               03240000
034400         WHEN OTHER                                               03250000
034500            DISPLAY 'SKU NUMBER   : '   DK-SKU-NBR                03260000
034600            DISPLAY 'PO  NUMBER   : '   DK-PO-NBR                 03270000
034700            DISPLAY 'STORE NUMBER : '   DK-STORE-NBR              03280000
034800            MOVE '1050-FETCH-EXPECTED'   TO PV-ABEND-PARAGRAPH    03290000
034900            MOVE SQLCODE                 TO PV-SQL-CODE           03300000
035000            MOVE 'FETCH'                 TO PV-ABEND-OPERATION    03310000
035100            MOVE 'STORE_EXPECTED_CURSOR' TO PV-ABEND-STRUCTURE-1  03320000
035200            PERFORM 9900-SQL-ERROR                                03330000
035300     END-EVALUATE.                                                03340000
035400/                                                                 03350000
035500***************************************************************** 03360000
035600* 1060-CLOSE-CURSOR.                                              03370000
035700***************************************************************** 03380000
035800 1060-CLOSE-CURSOR.                                               03390000
035900                                                                  03400000
036000     EXEC SQL                                                     03410000
036100         CLOSE STORE_EXPECTED_CURSOR                              03420000
036200     END-EXEC.                                                    03430000
036300                                                                  03440000
036400     EVALUATE TRUE                                                03450000
036500         WHEN SQLCODE = +0                                        03460000
036600             CONTINUE                                             03470000
036700         WHEN OTHER                                               03480000
036800            MOVE '1050-CLOSE-CURSOR'     TO PV-ABEND-PARAGRAPH    03490000
036900            MOVE SQLCODE                 TO PV-SQL-CODE           03500000
037000            MOVE 'CLOSE'                 TO PV-ABEND-OPERATION    03510000
037100            MOVE 'STORE_EXPECTED_CURSOR' TO PV-ABEND-STRUCTURE-1  03520000
037200            PERFORM 9900-SQL-ERROR                                03530000
037300     END-EVALUATE.                                                03540000
037400                                                                  03550005
040600***************************************************************** 03560000
040700* 3000-SELECT-RECEIVER-NBR.                                       03570000
040800***************************************************************** 03580000
040900 3000-SELECT-RECEIVER-NBR.                                        03590000
041000                                                                  03600000
041100     INITIALIZE DCLTRECITM                                        03610000
041200                DCLTRECEIV                                        03620000
041300                DCLTRECDIS.                                       03630000
041400                                                                  03640000
041500     EXEC SQL                                                     03650000
041600         SELECT  A.REC_SEQ_NBR                                    03660000
041700               , A.STATUS_CDE                                     03670000
041800               , B.ORD_LNE_NBR                                    03680000
041900               , A.PKGNG_CDE                                      03690000
042000           INTO  :PCT00015-RCVR-SEQ-NBR                           03700000
042100               , :RECEIV-STATUS-CDE                               03710000
042200               , :RECITM-ORD-LNE-NBR                              03720000
042300               , :RECEIV-PKGNG-CDE                                03730000
042400            FROM TRECEIV A                                        03740000
042500               , TRECITM B                                        03750000
042600               , TRECDIS C                                        03760000
042700          WHERE  A.ORD_NBR      = B.ORD_NBR                       03770000
042800            AND  A.REC_SEQ_NBR  = B.REC_SEQ_NBR                   03780000
042900            AND  B.ORD_NBR      = C.ORD_NBR                       03790000
043000            AND  B.REC_SEQ_NBR  = C.REC_SEQ_NBR                   03800000
043100            AND  B.ORD_LNE_NBR  = C.ORD_LNE_NBR                   03810000
043200            AND  A.ORD_NBR      = :DK-PO-NBR                      03820000
043300            AND  C.STR_NBR      = :DK-STORE-NBR                   03830000
043400            AND  B.ITM_NBR      = :DK-ITEM-NBR                    03840000
043500            AND  A.STATUS_CDE  <> 'VE'                            03850000
043600            AND  A.CRE_TMST  IN                                   03860000
043700                 (SELECT  MIN(D.CRE_TMST)                         03870000
043800                    FROM  TRECEIV D                               03880000
043900                        , TRECITM E                               03890000
044000                        , TRECDIS F                               03900000
044100                   WHERE  D.ORD_NBR      = E.ORD_NBR              03910000
044200                     AND  D.REC_SEQ_NBR  = E.REC_SEQ_NBR          03920000
044300                     AND  E.ORD_NBR      = F.ORD_NBR              03930000
044400                     AND  E.REC_SEQ_NBR  = F.REC_SEQ_NBR          03940000
044500                     AND  E.ORD_LNE_NBR  = F.ORD_LNE_NBR          03950000
044600                     AND  D.ORD_NBR      = :DK-PO-NBR             03960000
044700                     AND  F.STR_NBR      = :DK-STORE-NBR          03970000
044800                     AND  E.ITM_NBR      = :DK-ITEM-NBR           03980000
044900                     AND  D.STATUS_CDE  <> 'VE' )                 03990000
045000     END-EXEC.                                                    04000000
045100                                                                  04010000
045200     EVALUATE TRUE                                                04020000
045300         WHEN SQLCODE = +0                                        04030000
045400         WHEN SQLCODE = -811                                      04040004
045500             PERFORM 3020-SELECT-UPC-ID                           04050000
045600             SET PS-FOUND-YES   TO TRUE                           04060000
045700         WHEN SQLCODE = +100                                      04070000
045800             SET PS-FOUND-NO    TO TRUE                           04080000
045900         WHEN OTHER                                               04090000
046000            DISPLAY 'PO NUMBER    : '  DK-PO-NBR                  04100000
046100            DISPLAY 'STORE NUMBER : '  DK-STORE-NBR               04110000
046200            DISPLAY 'ITEM  NUMBER : '  DK-ITEM-NBR                04120000
046300            MOVE '3000-SELECT-RECEIVER-NBR'                       04130000
046400                               TO PV-ABEND-PARAGRAPH              04140000
046500            MOVE SQLCODE       TO PV-SQL-CODE                     04150000
046600            MOVE 'SELECT'      TO PV-ABEND-OPERATION              04160000
046700            MOVE 'TRECEIV'     TO PV-ABEND-STRUCTURE-1            04170000
046800            PERFORM 9900-SQL-ERROR                                04180000
046900     END-EVALUATE.                                                04190000
047000/                                                                 04200000
047100***************************************************************** 04210000
047200* 3010-SELECT-RECEIVER-NBR.                                       04220000
047300***************************************************************** 04230000
047400 3010-SELECT-RECEIVER-NBR.                                        04240000
047500                                                                  04250000
047600     INITIALIZE DCLTRECITM                                        04260000
047700                DCLTRECEIV                                        04270000
047800                DCLTRECDIS.                                       04280000
047900                                                                  04290000
048000     EXEC SQL                                                     04300000
048100         SELECT  A.REC_SEQ_NBR                                    04310000
048200               , A.STATUS_CDE                                     04320000
048300               , B.ORD_LNE_NBR                                    04330000
048400               , A.PKGNG_CDE                                      04340000
048500           INTO  :PCT00015-RCVR-SEQ-NBR                           04350000
048600               , :RECEIV-STATUS-CDE                               04360000
048700               , :RECITM-ORD-LNE-NBR                              04370000
048800               , :RECEIV-PKGNG-CDE                                04380000
048900            FROM TRECEIV A                                        04390000
049000               , TRECITM B                                        04400000
049100               , TRECDIS C                                        04410000
049200          WHERE  A.ORD_NBR      = B.ORD_NBR                       04420000
049300            AND  A.REC_SEQ_NBR  = B.REC_SEQ_NBR                   04430000
049400            AND  B.ORD_NBR      = C.ORD_NBR                       04440000
049500            AND  B.REC_SEQ_NBR  = C.REC_SEQ_NBR                   04450000
049600            AND  B.ORD_LNE_NBR  = C.ORD_LNE_NBR                   04460000
049700            AND  A.ORD_NBR      = :DK-PO-NBR                      04470000
049800            AND  C.STR_NBR      = :DK-STORE-NBR                   04480000
049900            AND  B.ITM_NBR      = :DK-ITEM-NBR                    04490000
050000            AND  A.STATUS_CDE   = 'VE'                            04500000
050100            AND  A.VERFYD_TMST  IN                                04510000
050200                 (SELECT  MIN(D.VERFYD_TMST)                      04520000
050300                    FROM  TRECEIV D                               04530000
050400                        , TRECITM E                               04540000
050500                        , TRECDIS F                               04550000
050600                   WHERE  D.ORD_NBR      = E.ORD_NBR              04560000
050700                     AND  D.REC_SEQ_NBR  = E.REC_SEQ_NBR          04570000
050800                     AND  E.ORD_NBR      = F.ORD_NBR              04580000
050900                     AND  E.REC_SEQ_NBR  = F.REC_SEQ_NBR          04590000
051000                     AND  E.ORD_LNE_NBR  = F.ORD_LNE_NBR          04600000
051100                     AND  D.ORD_NBR      = :DK-PO-NBR             04610000
051200                     AND  F.STR_NBR      = :DK-STORE-NBR          04620000
051300                     AND  E.ITM_NBR      = :DK-ITEM-NBR           04630000
051400                     AND  D.STATUS_CDE   = 'VE' )                 04640000
051500     END-EXEC.                                                    04650000
051600                                                                  04660000
051700     EVALUATE TRUE                                                04670000
051800         WHEN SQLCODE = +0                                        04680000
051900         WHEN SQLCODE = -811                                      04690000
052000             PERFORM 3020-SELECT-UPC-ID                           04700000
052100             SET PS-FOUND-YES   TO TRUE                           04710000
052200         WHEN SQLCODE = +100                                      04720000
052300             SET PS-FOUND-NO    TO TRUE                           04730000
052400         WHEN OTHER                                               04740000
052500            DISPLAY 'PO NUMBER    : '  DK-PO-NBR                  04750000
052600            DISPLAY 'STORE NUMBER : '  DK-STORE-NBR               04760000
052700            DISPLAY 'ITEM  NUMBER : '  DK-ITEM-NBR                04770000
052800            MOVE '3010-SELECT-RECEIVER-NBR'                       04780000
052900                               TO PV-ABEND-PARAGRAPH              04790000
053000            MOVE SQLCODE       TO PV-SQL-CODE                     04800000
053100            MOVE 'SELECT'      TO PV-ABEND-OPERATION              04810000
053200            MOVE 'TRECEIV'     TO PV-ABEND-STRUCTURE-1            04820000
053300            PERFORM 9900-SQL-ERROR                                04830000
053400     END-EVALUATE.                                                04840000
053500/                                                                 04850000
053600***************************************************************** 04860000
053700* 3015-SELECT-RECEIVER-NBR.  (FOR PO LINE NUMBER)                 04870000
053800***************************************************************** 04880000
053900 3015-SELECT-RECEIVER-NBR.                                        04890000
054000                                                                  04900000
054100     MOVE XLT00003-ITM-NBR TO DK-ITEM-NBR.                        04910015
054200                                                                  04920000
054300     INITIALIZE DCLTRECITM                                        04930000
054400                DCLTRECEIV                                        04940000
054500                DCLTRECDIS.                                       04950000
054600                                                                  04960000
054700     EXEC SQL                                                     04970000
054800         SELECT  A.STATUS_CDE                                     04980000
054900               , B.ORD_LNE_NBR                                    04990000
055000               , A.PKGNG_CDE                                      05000000
055100           INTO  :RECEIV-STATUS-CDE                               05010000
055200               , :RECITM-ORD-LNE-NBR                              05020000
055300               , :RECEIV-PKGNG-CDE                                05030000
055400            FROM TRECEIV A                                        05040000
055500               , TRECITM B                                        05050000
055600               , TRECDIS C                                        05060000
055700          WHERE  A.ORD_NBR      = B.ORD_NBR                       05070000
055800            AND  A.REC_SEQ_NBR  = B.REC_SEQ_NBR                   05080000
055900            AND  B.ORD_NBR      = C.ORD_NBR                       05090000
056000            AND  B.REC_SEQ_NBR  = C.REC_SEQ_NBR                   05100000
056100            AND  B.ORD_LNE_NBR  = C.ORD_LNE_NBR                   05110000
056200            AND  A.ORD_NBR      = :DK-PO-NBR                      05120000
056300            AND  C.STR_NBR      = :DK-STORE-NBR                   05130000
056400            AND  B.ITM_NBR      = :DK-ITEM-NBR                    05140000
056500            AND  A.REC_SEQ_NBR  = :PCT00015-RCVR-SEQ-NBR          05150000
056600     END-EXEC.                                                    05160000
056700                                                                  05170000
056800     EVALUATE TRUE                                                05180000
056900         WHEN SQLCODE = +0                                        05190000
057000         WHEN SQLCODE = +100                                      05200000
057100         WHEN SQLCODE = -811                                      05210000
057200             CONTINUE                                             05220000
057300         WHEN OTHER                                               05230000
057400            DISPLAY 'PO NUMBER       : ' DK-PO-NBR                05240000
057500            DISPLAY 'STORE NUMBER    : ' DK-STORE-NBR             05250000
057600            DISPLAY 'ITEM NUMBER     : ' DK-ITEM-NBR              05260000
057700            DISPLAY 'RECEIVER NUMBER : ' PCT00015-RCVR-SEQ-NBR    05270000
057800            MOVE '3015-SELECT-RECEIVER-NBR'                       05280000
057900                               TO PV-ABEND-PARAGRAPH              05290000
058000            MOVE SQLCODE       TO PV-SQL-CODE                     05300000
058100            MOVE 'SELECT'      TO PV-ABEND-OPERATION              05310000
058200            MOVE 'TRECITM'     TO PV-ABEND-STRUCTURE-1            05320000
058300            PERFORM 9900-SQL-ERROR                                05330000
058400     END-EVALUATE.                                                05340000
058500/                                                                 05350000
058600***************************************************************** 05360000
058700* 3020-SELECT-UPC-ID.                                             05370000
058800***************************************************************** 05380000
058900 3020-SELECT-UPC-ID.                                              05390000
059000                                                                  05400000
059100     INITIALIZE DCLXLT00003.                                      05410000
059200                                                                  05420000
059300     EXEC SQL                                                     05430000
059400         SELECT A.INTR_UPC_ID                                     05440000
059500           INTO :XLT00003-INTR-UPC-ID                             05450000
059600           FROM XLT_SKU A                                         05460000
059700          WHERE A.SKU_NBR = :DK-SKU-NBR                           05470000
059800     END-EXEC.                                                    05480000
059900                                                                  05490000
060000     EVALUATE TRUE                                                05500000
060100         WHEN SQLCODE = +0                                        05510000
060200             CONTINUE                                             05520000
060300         WHEN SQLCODE = +100                                      05530000
060400             CONTINUE                                             05540000
060500         WHEN OTHER                                               05550000
060600            DISPLAY 'SKU NUMBER : ' DK-SKU-NBR                    05560000
060700            MOVE '3020-SELECT-UPC-ID'                             05570000
060800                               TO PV-ABEND-PARAGRAPH              05580000
060900            MOVE SQLCODE       TO PV-SQL-CODE                     05590000
061000            MOVE 'SELECT'      TO PV-ABEND-OPERATION              05600000
061100            MOVE 'XLT_SKU'     TO PV-ABEND-STRUCTURE-1            05610000
061200            PERFORM 9900-SQL-ERROR                                05620000
061300     END-EVALUATE.                                                05630000
061400/                                                                 05640000
061500***************************************************************** 05650000
061600* 3030-SELECT-ITM-NBR.                                            05660000
061700***************************************************************** 05670000
061800 3030-SELECT-ITM-NBR.                                             05680000
061900                                                                  05690000
062000     INITIALIZE DCLXLT00003.                                      05700000
062100                                                                  05710000
062200     EXEC SQL                                                     05720000
062300         SELECT A.ITM_NBR                                         05730000
062400           INTO :XLT00003-ITM-NBR                                 05740000
062500           FROM XLT_SKU A                                         05750000
062600          WHERE A.SKU_NBR = :DK-SKU-NBR                           05760000
062700     END-EXEC.                                                    05770000
062800                                                                  05780000
062900     EVALUATE TRUE                                                05790000
063000         WHEN SQLCODE = +0                                        05800000
063100             MOVE XLT00003-ITM-NBR TO DK-ITEM-NBR                 05810000
063200         WHEN SQLCODE = +100                                      05820000
063300             CONTINUE                                             05830000
063400         WHEN OTHER                                               05840000
063500            DISPLAY 'SKU NUMBER : ' DK-SKU-NBR                    05850000
063600            MOVE '3030-SELECT-ITM-NBR'                            05860000
063700                               TO PV-ABEND-PARAGRAPH              05870000
063800            MOVE SQLCODE       TO PV-SQL-CODE                     05880000
063900            MOVE 'SELECT'      TO PV-ABEND-OPERATION              05890000
064000            MOVE 'XLT_SKU'     TO PV-ABEND-STRUCTURE-1            05900000
064100            PERFORM 9900-SQL-ERROR                                05910000
064200     END-EVALUATE.                                                05920000
064300/                                                                 05930000
064400******************************************************************05940000
064500* 7000-WRITE-STORE-EXPECTED.                                     *05950000
064600******************************************************************05960000
064700 7000-WRITE-STORE-EXPECTED.                                       05970000
064800                                                                  05980000
064900     IF ( RECEIV-STATUS-CDE > SPACES )                            05990000
065000         PERFORM 7050-CHECK-TRANS-TYPE                            06000000
065100         IF ( PCT00015-TRN-TYP-CDE = 'CL' )                       06010000
065200             CONTINUE                                             06020000
065300         ELSE                                                     06030000
065400             INITIALIZE PC010-PCT-INTRANSIT-REC                   06040000
065500             MOVE XLT00003-INTR-UPC-ID TO PC010-INTR-UPC-ID       06050000
065700             MOVE WS014-STORE-NUMBER   TO PC010-STR-NBR           06060006
065900             MOVE 'UN'                 TO PC010-TRN-TYP-CDE       06070000
066000             COMPUTE PC010-IN-TRNST-QTY = WS014-SKU-QTY * -1      06080000
066100             MOVE PC-CURRENT-PROGRAM-NAME TO PC010-UPD-USR-ID     06090000
066200             MOVE WS014-PO-NUMBER         TO PC010-PO-NBR         06100000
066300             MOVE PCT00015-RCVR-SEQ-NBR   TO PC010-RCVR-SEQ-NBR   06110000
066400             MOVE 'SE'                    TO PC010-TRN-CLSN-CDE   06120000
066500             MOVE WS014-CRE-TMST          TO PC010-EVENT-TMST     06130000
066600             WRITE OUTPUT01-RECORD FROM PC010-PCT-INTRANSIT-REC   06140000
066700             ADD  +1                    TO PV-OUTPUT01-COUNT      06150000
066800             SET PS-TRANSACTION-WRITTEN TO TRUE                   06160000
066900         END-IF                                                   06170000
067000     END-IF.                                                      06180000
067100/                                                                 06190000
067200******************************************************************06200000
067300* 7010-WRITE-REPORT.                                             *06210000
067400******************************************************************06220000
067500 7010-WRITE-REPORT.                                               06230000
067600                                                                  06240000
067700     INITIALIZE PC066-SE-ADJ-TRAN-RECORD.                         06250000
067800                                                                  06260000
067900     MOVE PS-TRANSACTION-WRITTEN-SW TO PC066-TRANS-ADJ-CODE.      06270000
068000     MOVE WS014-CASE-NUMBER         TO PC066-CASE-NUMBER.         06280000
068100     MOVE WS014-PO-NUMBER           TO PC066-PO-NUMBER.           06290000
068200     MOVE PCT00015-RCVR-SEQ-NBR     TO PC066-REC-SEQ-NUMBER.      06300000
068300     MOVE RECITM-ORD-LNE-NBR        TO PC066-PO-LINE-NUMBER.      06310000
068400     MOVE WS014-SKU-NUMBER          TO PC066-SKU-NUMBER.          06320000
068500     MOVE WS014-SKU-QTY             TO PC066-CASE-SKU-QTY.        06330000
068600     MOVE PV-SE-QTY                 TO PC066-CURR-SE-QTY.         06340000
068700     MOVE WS014-ORIG-SHIPMT-NBR     TO PC066-ORIG-SHIPMT-NBR.     06350000
068800     MOVE RECEIV-STATUS-CDE         TO PC066-STATUS-CDE.          06360000
068900     MOVE PCT00015-TRN-TYP-CDE      TO PC066-TRAN-TYPE-CDE.       06370000
069000     MOVE RECEIV-PKGNG-CDE          TO PC066-PKGNG-CDE.           06380000
069100     MOVE WS014-CRE-USER-ID         TO PC066-CRE-USER-ID.         06390000
069200                                                                  06400000
069300     INSPECT WS014-DC-LOCATION                                    06410000
069400            REPLACING LEADING SPACES BY ZEROS.                    06420000
069500     MOVE WS014-DC-LOCATION         TO PC066-DC-LOCATION.         06430000
069600                                                                  06440000
069800     MOVE WS014-STORE-NUMBER        TO PC066-ORIG-STORE-NUMBER    06450007
069800                                       PC066-STORE-NUMBER.        06460007
070100     MOVE WS014-CRE-TMST            TO PC066-CRE-TMST.            06470000
070200     MOVE PC-CURRENT-PROGRAM-NAME   TO PC066-CRE-PROGRAM.         06480000
070300                                                                  06490000
070400     PERFORM 7060-SELECT-RETAIL-AMT.                              06500000
070500                                                                  06510000
070600     MOVE UPCPLS-UNT-RTL-AMT        TO PC066-UNIT-RETAIL.         06520000
070700                                                                  06530000
070800     IF PCT00015-TRN-TYP-CDE = 'CL'                               06540000
070900        MOVE ZEROES TO PC066-ADJ-RETAIL                           06550000
071000     ELSE                                                         06560000
071100        COMPUTE PC066-ADJ-RETAIL = PC066-CASE-SKU-QTY             06570000
071200                                 * PC066-UNIT-RETAIL              06580000
071300     END-IF                                                       06590000
071400                                                                  06600000
071500     WRITE OUTPUT02-RECORD FROM PC066-SE-ADJ-TRAN-RECORD.         06610000
071600     ADD  +1 TO PV-OUTPUT02-COUNT.                                06620000
071700/                                                                 06630000
071800******************************************************************06640000
071900* 7050-CHECK-TRANS-TYPE.                                         *06650000
072000******************************************************************06660000
072100 7050-CHECK-TRANS-TYPE.                                           06670000
072300                                                                  06680000
072400     MOVE SPACES TO PCT00015-TRN-TYP-CDE.                         06690000
072500                                                                  06700000
072600     EXEC SQL                                                     06710000
072700        SELECT B.TRN_TYP_CDE                                      06720000
072800          INTO :PCT00015-TRN-TYP-CDE                              06730000
072900          FROM XLT_SKU A                                          06740000
073000             , PCT_TRN_CLSN_DTL B                                 06750000
073100          WHERE A.SKU_NBR       = :DK-SKU-NBR                     06760000
073200            AND B.INTR_UPC_ID   = A.INTR_UPC_ID                   06770000
073300            AND B.PO_NBR        = :DK-PO-NBR                      06780000
073400            AND B.LOC_NBR       = :DK-STORE-NBR                   06790006
073500            AND B.TRN_CLSN_CDE  = 'SE'                            06800000
164325            AND B.TRN_TYP_CDE NOT IN ('NS', 'MM', 'UM',           06810020
164325                                      'AM', 'SM')                 06820020
073600            AND  B.IN_TRNST_TRN_TMST IN                           06830000
073700               (SELECT  MAX(C.IN_TRNST_TRN_TMST)                  06840000
073800                 FROM  PCT_TRN_CLSN_DTL C                         06850000
073900                 WHERE A.SKU_NBR       = :DK-SKU-NBR              06860000
074000                   AND C.INTR_UPC_ID   = A.INTR_UPC_ID            06870000
074100                   AND C.PO_NBR        = :DK-PO-NBR               06880000
074200                   AND C.LOC_NBR       = :DK-STORE-NBR            06890006
164325                   AND C.TRN_TYP_CDE NOT IN ('NS', 'MM', 'UM',    06900021
164325                                             'AM', 'SM')          06910020
074300                   AND C.TRN_CLSN_CDE  = 'SE' )                   06920000
074400     END-EXEC.                                                    06930000
074500                                                                  06940000
074600     EVALUATE TRUE                                                06950000
074700         WHEN SQLCODE = +0                                        06960000
074800             CONTINUE                                             06970000
074900         WHEN SQLCODE = +100                                      06980000
075000             CONTINUE                                             06990000
075100         WHEN OTHER                                               07000000
075200            DISPLAY 'PO NUMBER       : ' DK-PO-NBR                07010000
075300            DISPLAY 'STORE NUMBER    : ' DK-STORE-NBR             07020000
075400            DISPLAY 'SKU NUMBER      : ' DK-SKU-NBR               07030000
075500            MOVE '7050-CHECK-TRANS-TYPE'                          07040000
075600                                    TO PV-ABEND-PARAGRAPH         07050000
075700            MOVE SQLCODE            TO PV-SQL-CODE                07060000
075800            MOVE 'SELECT'           TO PV-ABEND-OPERATION         07070000
075900            MOVE 'PCT_TRN_CLSN_DTL' TO  PV-ABEND-STRUCTURE-1      07080000
076000            PERFORM 9900-SQL-ERROR                                07090000
076100     END-EVALUATE.                                                07100000
076200/                                                                 07110000
076300******************************************************************07120000
076400* 7060-SELECT-RETAIL-AMT.                                        *07130000
076500******************************************************************07140000
076600 7060-SELECT-RETAIL-AMT.                                          07150000
076800                                                                  07160000
076900     EXEC SQL                                                     07170000
077000         SELECT UNT_RTL_AMT                                       07180000
077100          INTO :UPCPLS-UNT-RTL-AMT                                07190000
077200          FROM TUPCPLS                                            07200000
077300         WHERE UPC_ID         = :XLT00003-INTR-UPC-ID             07210000
077400           AND STR_NBR        = :DK-STORE-NBR                     07220006
077500           AND OPERCO_NBR     = '03'                              07230000
077600           AND EFF_BEG_TMST  <= CURRENT TIMESTAMP                 07240000
077700           AND (EFF_END_TMST IS NULL                              07250000
077800            OR  EFF_END_TMST >= CURRENT TIMESTAMP)                07260000
077900         WITH UR                                                  07270000
078000     END-EXEC.                                                    07280000
078100                                                                  07290000
078200     EVALUATE TRUE                                                07300000
078300         WHEN SQLCODE = +0                                        07310000
078400             CONTINUE                                             07320000
078500         WHEN SQLCODE = +100                                      07330000
078600             PERFORM 7065-SELECT-RETAIL-AMT                       07340000
078700         WHEN OTHER                                               07350000
078800            DISPLAY 'UPC CODE        : ' XLT00003-INTR-UPC-ID     07360000
078900            DISPLAY 'STORE NUMBER    : ' DK-STORE-NBR             07370000
079000            MOVE '7060-SELECT-RETAIL-AMT'                         07380000
079100                               TO PV-ABEND-PARAGRAPH              07390000
079200            MOVE SQLCODE       TO PV-SQL-CODE                     07400000
079300            MOVE 'SELECT'      TO PV-ABEND-OPERATION              07410000
079400            MOVE 'TUPCPLS'     TO PV-ABEND-STRUCTURE-1            07420000
079500            PERFORM 9900-SQL-ERROR                                07430000
079600     END-EVALUATE.                                                07440000
079700/                                                                 07450000
079800******************************************************************07460000
079900* 7065-SELECT-RETAIL-AMT.                                        *07470000
080000******************************************************************07480000
080100 7065-SELECT-RETAIL-AMT.                                          07490000
080200                                                                  07500000
080300     EXEC SQL                                                     07510000
080400         SELECT UNT_RTL_AMT                                       07520000
080500          INTO :UPCPLS-UNT-RTL-AMT                                07530000
080600          FROM TUPCPLS                                            07540000
080700         WHERE UPC_ID         = :XLT00003-INTR-UPC-ID             07550000
080800           AND STR_NBR        = 0                                 07560000
080900           AND OPERCO_NBR     = '03'                              07570000
081000           AND EFF_BEG_TMST  <= CURRENT TIMESTAMP                 07580000
081100           AND (EFF_END_TMST IS NULL                              07590000
081200            OR  EFF_END_TMST >= CURRENT TIMESTAMP)                07600000
081300         WITH UR                                                  07610000
081400     END-EXEC.                                                    07620000
081500                                                                  07630000
081600     EVALUATE TRUE                                                07640000
081700         WHEN SQLCODE = +0                                        07650000
081800             CONTINUE                                             07660000
081900         WHEN SQLCODE = +100                                      07670000
082000             MOVE +0 TO UPCPLS-UNT-RTL-AMT                        07680000
082100         WHEN OTHER                                               07690000
082200            DISPLAY 'UPC CODE        : ' XLT00003-INTR-UPC-ID     07700000
082300            MOVE '7065-SELECT-RETAIL-AMT'                         07710000
082400                               TO PV-ABEND-PARAGRAPH              07720000
082500            MOVE SQLCODE       TO PV-SQL-CODE                     07730000
082600            MOVE 'SELECT'      TO PV-ABEND-OPERATION              07740000
082700            MOVE 'TUPCPLS'     TO PV-ABEND-STRUCTURE-1            07750000
082800            PERFORM 9900-SQL-ERROR                                07760000
082900     END-EVALUATE.                                                07770000
083000/                                                                 07780000
083100******************************************************************07790000
083200* 9900-SQL-ERROR.                                                *07800000
083300******************************************************************07810000
083400 9900-SQL-ERROR.                                                  07820000
083500                                                                  07830000
083600     MOVE SQLCODE               TO SQLCODE2.                      07840000
083700     DISPLAY '** ABEND **       ** = SQLERROR'.                   07850000
083800     DISPLAY '** PROGRAM        ** = PCKUT083'.                   07860000
083900     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        07870000
084000     DISPLAY '** OPERATION      ** = ' PV-ABEND-OPERATION.        07880000
084100     DISPLAY '** TABLE          ** = ' PV-ABEND-STRUCTURE-1.      07890000
084200     DISPLAY SPACES                                               07900000
084300                                                                  07910000
084400     COPY DPPD004.                                                07920000
084500     SET ABEND-4013-DB2-ERROR   TO TRUE                           07930000
084600     CALL 'ILBOABN0' USING ABEND-CODE.                            07940000
