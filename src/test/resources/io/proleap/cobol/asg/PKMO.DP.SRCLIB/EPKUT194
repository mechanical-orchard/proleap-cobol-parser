000100*------------------------------------------------------------     00001000
000200 IDENTIFICATION DIVISION.                                         00002000
000300*------------------------------------------------------------     00003000
000400 PROGRAM-ID.    EPKUT194.                                         00004000
000500 AUTHOR.        CHERI PARMLEY.                                    00005000
000510 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00006000
000600 DATE-WRITTEN.  MARCH 9, 2010.                                    00007000
000700                                                                  00008000
000800*-------------------------------------------------------------*   00009000
000900*              REBATE DATA FORMATTER                          *   00010000
001000*-------------------------------------------------------------*   00020000
001100*    THIS PROGRAM WILL READ IN THE NEW REBATE FORMS DATA FILES*   00030000
001200*    AND WILL FORMAT THE RECORDS BY ADDING HEADERS AND        *   00040000
001300*    SEPARATING EACH COLUMN WITH A PIPE.                      *   00050000
001300*    THE INPUT FILE IS FIRST SORTED TO GET THE FORMS IN THE   *   00051000
001300*    PROPER HIERARCH SEQUENCE.                                *   00052000
001060*------------------------------------------------------------ *   00053000
003800*  INPUT:                                                     *   00053100
003900*        REBATE-FORM-FILE                 EPRD231             *   00053200
002600*                                                             *   00053300
002610*        CC-DATE                          EPRD111             *   00053400
002600*                                                             *   00053500
002800*        LAST-HEADER-TIME                 EPRD232             *   00053600
002620*                                                             *   00053700
004400*                                                             *   00053800
004500*  OUTPUT:                                                    *   00053900
004600*        FORMATTED-XREF-FILE              EPRD217             *   00054000
004700*                                (FOR HEADER FORMAT)          *   00054100
004800*-------------------------------------------------------------*   00054200
004900* HISTORY LOG:                                                *   00054300
005000*                                                             *   00054400
005100*-------------------------------------------------------------*   00054500
005200* DATE: MARCH 9, 2010                                         *   00054600
005300* WR/IR#: WR #38172                                           *   00054700
005400* PROGRAMMER: CHERI PARMLEY                                   *   00054800
005500* DESCRIPTION: INITIAL PROGRAM CREATION                       *   00054900
005600*-------------------------------------------------------------*   00055000
005610* DATE:  JULY 27, 2010                                        *   00056000
005620* WR/IR#: WR#38172                                            *   00057000
005630* PROGRAMMER: CHERI PARMLEY                                   *   00058000
005640* DESCRIPTION: INCREMENTING OF SECOND BY +1 WAS NOT WORKING   *   00059000
005640* MOVE 1200-PARA TO EXECUTE ONCE AND ELIMINATE IT FROM 2100-  *   00060000
005600*-------------------------------------------------------------*   00070000
005610* DATE:  JULY 30, 2010                                        *   00080000
005620* WR/IR#: WR#38172                                            *   00090000
005630* PROGRAMMER: CHERI PARMLEY                                   *   00100000
005640* DESCRIPTION: ADD FILE INPUT TO GET LAST TIME FROM THE       *   00110000
005640* INCENTIVE FILE - SO FORMATTER WILL BEGIN AFTER              *   00120000
005650*                                                             *   00130000
005600*-------------------------------------------------------------*   00140000
092910* DATE:  SEPT 29, 2010                                        *   00141000
092910* WR/IR#: PKE-5229                                            *   00142000
092910* PROGRAMMER: CHERI PARMLEY                                   *   00143000
092910* DESCRIPTION: IF FULL FILE USE CURRENT DATE FROM EP111 ON    *   00144000
092910* THE HEADER.                                                 *   00145000
005650*                                                             *   00146000
005700*-------------------------------------------------------------*   00147000
005800 ENVIRONMENT DIVISION.                                            00148000
005900*-------------------------------------------------------------*   00149000
006000 CONFIGURATION SECTION.                                           00150000
006100 SOURCE-COMPUTER. IBM-3090.                                       00160000
006200 OBJECT-COMPUTER. IBM-3090.                                       00170000
006300                                                                  00180000
006400 INPUT-OUTPUT SECTION.                                            00190000
006500                                                                  00200000
006600 FILE-CONTROL.                                                    00210000
006700                                                                  00220000
006800*  INPUT:                                                     *   00230000
006900           SELECT REBATE-FORM-FILE                                00240000
007000             ASSIGN TO INP01.                                     00250000
                                                                        00260000
006710           SELECT CC-DATE                                         00270000
006720             ASSIGN TO INP02.                                     00280000
                                                                        00290000
006800           SELECT LAST-HEADER-TIME                                00300000
006900             ASSIGN TO INP03.                                     00310000
008300                                                                  00320000
008400*  OUTPUT:                                                    *   00330000
008500           SELECT FORMATTED-XREF-FILE                             00340000
008600             ASSIGN TO OUT01.                                     00350000
008700                                                                  00360000
008800*-------------------------------------------------------------*   00370000
008900 DATA DIVISION.                                                   00380000
009000*----------------------------------------------------------       00390000
009100 FILE SECTION.                                                    00400000
009200                                                                  00410000
009300 FD  REBATE-FORM-FILE                                             00420000
009400     RECORDING MODE IS F                                          00430000
009500     LABEL RECORDS ARE STANDARD                                   00440000
009600     RECORD CONTAINS 300 CHARACTERS                               00450000
009700     BLOCK CONTAINS 0 RECORDS                                     00460000
009800     DATA RECORD IS REBATE-FORM-RECORD.                           00470000
009900                                                                  00480000
010000 01  REBATE-FORM-RECORD           PIC X(300).                     00490000
010100                                                                  00500000
009300 FD  LAST-HEADER-TIME                                             00501000
009400     RECORDING MODE IS F                                          00502000
009500     LABEL RECORDS ARE STANDARD                                   00503000
009800     DATA RECORD IS REBATE-FORM-RECORD.                           00504000
009900                                                                  00505000
010000 01  CC-TIME-RECORD               PIC X(80).                      00506000
                                                                        00507000
013800 FD  FORMATTED-XREF-FILE                                          00508000
013900     RECORDING MODE IS V                                          00509000
014000     RECORD IS VARYING IN SIZE                                    00510000
014100     FROM 1 TO 100 CHARACTERS                                     00520000
014200     DEPENDING ON PV-BYTE-COUNT                                   00530000
014300     LABEL RECORDS ARE STANDARD                                   00540000
014400     DATA RECORD IS FORMATTED-XREF-RECORD.                        00550000
014500                                                                  00560000
014600 01  FORMATTED-XREF-RECORD.                                       00570000
014700     05  FORM-XRF-FLD             PIC X(01)                       00580000
014800         OCCURS 100 TIMES                                         00590000
014900              INDEXED BY                                          00600000
015000              FORM-XRF-LEN.                                       00610000
015100                                                                  00620000
010620 FD  CC-DATE                                                      00630000
010630     RECORDING MODE IS F                                          00640000
010640     BLOCK CONTAINS 0 RECORDS                                     00650000
010650     LABEL RECORDS ARE STANDARD.                                  00660000
010660                                                                  00670000
010670 01  CC-DATE-RECORD   PIC X(80).                                  00680000
010700                                                                  00690000
015200*----------------------------------------------------------       00700000
015300 WORKING-STORAGE SECTION.                                         00710000
015400                                                                  00720000
015500 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      00730000
015600                                                  COMP SYNC.      00740000
015700     88  AC-INPUT-CONTROL-CARD-ERROR              VALUE +4003.    00750000
016100                                                                  00760000
016200*----------------------------------------------------------       00770000
016300* PC- PROGRAM CONSTANTS                                           00780000
016400*----------------------------------------------------------       00790000
016500 01  PC-PROGRAM-CONSTANTS.                                        00800000
016600     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'EPKUT194'. 00810000
016900     05  PC-CSV-DELIMITER             PIC X(01) VALUE '|'.        00820000
017100     05  PC-UNDER-SCORE               PIC X(01) VALUE '_'.        00830000
017400     05  PC-ONE-ZERO                  PIC X(01) VALUE '0'.        00840000
017400     05  PC-ONE-SPACE                 PIC X(01) VALUE ' '.        00850000
017700     05  PC-STORE-SPECIFIC-GRP        PIC X(05) VALUE '05000'.    00860000
017800     05  PC-FIVE-ZERO                 PIC X(05) VALUE '00000'.    00870000
017900     05  PC-HDR-IND                   PIC X(03) VALUE 'HDR'.      00880000
017900     05  PC-SRC-SYS-ID                PIC X(02) VALUE 'PM'.       00890000
092910     05  PC-FILE-ACT-TYP-FUL          PIC X(03) VALUE 'FUL'.      00900000
018100                                                                  00910000
018110*----------------------------------------------------------       00920000
018120* TIME                                                            00930000
018130*----------------------------------------------------------       00940000
018140 01  PC-TIME.                                                     00950000
018150     05  PC-TIME-HHMM                 PIC X(04).                  00960000
018160     05  PC-TIME-SS                   PIC X(02).                  00970000
018200*----------------------------------------------------------       00980000
018300* PV- PROGRAM VARIABLES                                           00990000
018400*----------------------------------------------------------       01000000
018500 01  PV-PROGRAM-STATUS.                                           01010000
018600     05  PV-PARAGRAPH-NAME            PIC X(30) VALUE SPACES.     01020000
018700     05  PV-OPERATION-MSG-1           PIC X(40) VALUE SPACES.     01030000
018800     05  PV-OPERATION-MSG-2           PIC X(40) VALUE SPACES.     01040000
019100*                                                                 01050000
019200 01  PV-PROGRAM-VARIABLES.                                        01060000
019300     05  PV-TALLY                     PIC S9(03) COMP-3 VALUE +0. 01070000
019400     05  PV-BYTE-COUNT                PIC  9(04) VALUE ZERO.      01080000
019700     05  PV-SPACE                     PIC  X(01).                 01090000
019900                                                                  01100000
048900     05  PV-EP111-CC-ISO-DATE         PIC  X(010)                 01110000
049000                                           VALUE SPACES.          01111000
020000     05  PV-VARIABLE-OUTPUT-FIELD.                                01112000
020100         10  PV-BIT-VARIABLE          PIC X(01)                   01113000
020200                                          VALUE SPACES            01114000
020300                                          OCCURS 50 TIMES         01115000
020400                                          INDEXED BY              01116000
020500                                          PV-BIT-IDX              01117000
020600                                          PV-STR-IDX              01118000
020700                                          PV-EOF-IDX.             01119000
                                                                        01120000
020900     05  PV-VARIABLE-CHAR-FIELD.                                  01130000
021000         10  PV-BIT-CHR-VARIABLE      PIC X(01)                   01140000
021100                                          VALUE SPACES            01150000
021200                                          OCCURS 42 TIMES         01160000
021300                                          INDEXED BY              01170000
021400                                          PV-CHR-BIT-IDX          01180000
021500                                          PV-CHR-EOF-IDX.         01190000
025040                                                                  01200000
025100     05  PV-FORMAT-HDR-DIST-DTE.                                  01210000
025200         10  PV-FORMAT-YYYY           PIC X(04).                  01220000
025300         10  PV-FORMAT-MM             PIC X(02).                  01230000
025400         10  PV-FORMAT-DD             PIC X(02).                  01240000
025500                                                                  01250000
026000     05  PV-EFF-WORK-DTE.                                         01260000
026100         10  PV-EFF-WORK-YYYY         PIC X(04).                  01270000
026200         10  PV-EFF-WORK-MM           PIC X(02).                  01280000
026300         10  PV-EFF-WORK-DD           PIC X(02).                  01290000
026400                                                                  01300000
027300                                                                  01310000
027310     05  PV-STR-GRP-TYP-CDE           PIC 9(05) VALUE ZERO.       01320000
027320     05  PV-STR-GRP-ID-GRP.                                       01330000
027321         10  PV-FIRST-BYTES           PIC 9(05) VALUE ZERO.       01340000
027330         10  PV-STR-GRP-ID            PIC 9(05) VALUE ZERO.       01350000
027340     05  PV-STR-GRP-PROMO-STRT-TMST   PIC X(26) VALUE SPACES.     01360000
027341     05  PV-PRICG-EFFECT-DTE          PIC  X(10) VALUE SPACES.    01370000
027700                                                                  01380000
027700     05  PV-CURR-DATE.                                            01390000
               10  PV-CURR-YY               PIC 9(02) VALUE ZERO.       01400000
               10  PV-CURR-MM               PIC 9(02) VALUE ZERO.       01410000
               10  PV-CURR-DD               PIC 9(02) VALUE ZERO.       01420000
                                                                        01430000
027710 01  PV-TIME-CALC                     PIC 9(06) VALUE ZERO.       01440000
027710 01  PV-DATE-CALC                     PIC 9(08) VALUE ZERO.       01450000
015095                                                                  01460000
015096 01  PV-CURR-TIME.                                                01470000
015097     05  PV-CURR-TIME-HH         PIC  9(02)    VALUE ZERO.        01480000
015098     05  PV-CURR-TIME-MM         PIC  9(02)    VALUE ZERO.        01490000
015099     05  PV-CURR-TIME-SS         PIC  9(02)    VALUE ZERO.        01500000
015100     05  PV-CURR-TIME-SSHH       PIC  9(02)    VALUE ZERO.        01510000
                                                                        01520000
015102 01  PV-HEADER-TIMESTAMP.                                         01530000
015103     05 PV-HDR-TMST-DATE.                                         01540000
015104        10  PV-HDR-YYYY           PIC X(04).                      01550000
015105        10  PV-HDR-MM             PIC X(02).                      01560000
015106        10  PV-HDR-DD             PIC X(02).                      01570000
                                                                        01580000
015107     05 PV-HDR-TMST-TIME          PIC X(06).                      01590000
                                                                        01600000
027730 01  PV-TIME.                                                     01610000
027740     05  PV-TIME-HH                   PIC 9(02).                  01620000
027750     05  PV-TIME-MM                   PIC 9(02).                  01630000
027760     05  PV-TIME-SS                   PIC 9(02).                  01640000
027770                                                                  01650000
       01  PV-EFF-END-TMST.                                             01660000
           05  PV-EFF-DATE    PIC X(10) VALUE SPACE.                    01670000
           05  FILLER         PIC X(01) VALUE ' '.                      01680000
           05  PV-EFF-HH      PIC X(02) VALUE SPACE.                    01690000
           05  FILLER         PIC X(01) VALUE ':'.                      01700000
           05  PV-EFF-MM      PIC X(02) VALUE SPACE.                    01710000
           05  FILLER         PIC X(01) VALUE ':'.                      01720000
           05  PV-EFF-SS      PIC X(02) VALUE SPACE.                    01730000
                                                                        01740000
028000*----------------------------------------------------------       01750000
028100* PV- PROGRAM COUNT VARIABLES                                     01760000
028200*----------------------------------------------------------       01770000
028300 01  PV-PROGRAM-COUNTERS.                                         01780000
028400     05  PV-DATA-REC-WRITEN           PIC 9(09) VALUE 0.          01781000
028410     05  PV-HDR-REC-WRITEN            PIC 9(09) VALUE 0.          01782000
028500     05  PV-RECORDS-READ              PIC 9(09) VALUE 0.          01783000
029100                                                                  01784000
031300*----------------------------------------------------------------*01785000
031400* PS- PROGRAM SWITCHES                                           *01786000
031500*----------------------------------------------------------------*01787000
031600 01  PS-PROGRAM-SWITCHES.                                         01788000
031700     05  PS-END-OF-RBT-SW             PIC  X(01) VALUE 'N'.       01789000
031800         88  PS-END-OF-RBT-FILE                  VALUE 'Y'.       01790000
031900         88  PS-NOT-END-RBT-FILE                 VALUE 'N'.       01800000
033200     05  PS-END-OF-PROCES-SW          PIC  X(01) VALUE 'N'.       01810000
033300         88  PS-END-OF-PROCESSING                VALUE 'Y'.       01820000
033400         88  PS-NOT-END-OF-PROCESSING            VALUE 'N'.       01830000
033500     05  PS-READY-TRACE-SW            PIC  X(01) VALUE 'N'.       01840000
033600         88 PS-READY-TRACE                       VALUE 'Y'.       01850000
033700         88 PS-RESET-TRACE                       VALUE 'N'.       01860000
033710     05  PS-END-OF-TODAYS-DATE-SW     PIC X(01)  VALUE 'N'.       01870000
033720         88  PS-END-OF-TODAYS-DATE-FILE          VALUE 'Y'.       01880000
033730     05  PS-END-OF-TOMORR-DATE-SW     PIC X(01)  VALUE 'N'.       01890000
033740         88  PS-END-OF-TOMORR-DATE-FILE          VALUE 'Y'.       01900000
033750     05  PS-END-OF-TIME-SW            PIC X(01)  VALUE 'N'.       01910000
033760         88  PS-END-OF-TIME-FILE                 VALUE 'Y'.       01920000
026600     05  PS-END-OF-DATE-SW            PIC X(01)  VALUE 'N'.       01930000
026610         88  PS-END-OF-DATE-FILE                 VALUE 'Y'.       01940000
033800                                                                  01950000
037900*----------------------------------------------------------       01960000
038000* COPYBOOK  EPRD231 LAYOUT (USED TO READ THE INPUT FILE)          01970000
038100*----------------------------------------------------------       01980000
038200     COPY EPRD231.                                                01990000
038300                                                                  02000000
037900*----------------------------------------------------------       02010000
038000* COPYBOOK  EPRD232 LAYOUT                                        02020000
038100*----------------------------------------------------------       02021000
038200     COPY EPRD232.                                                02022000
038300                                                                  02023000
030410*----------------------------------------------------------       02024000
030420* DATE - PROMOTION SYSTEM DATE                                    02025000
030430*----------------------------------------------------------       02026000
030440     COPY EPRD111.                                                02027000
030450                                                                  02028000
037400*----------------------------------------------------------       02029000
037500* COPYBOOK  EPRD217 LAYOUT (USED TO WRITE THE HEADER RECORD)      02030000
037600*----------------------------------------------------------       02040000
037700     COPY EPRD217.                                                02050000
037800                                                                  02060000
050600*----------------------------------------------------------       02061000
050700* DATE ROUTINE COPY MEMBERS                                       02062000
050800*----------------------------------------------------------       02063000
050900     COPY DPWS500.                                                02064000
051000                                                                  02065000
042200*----------------------------------------------------------       02066000
042300 PROCEDURE DIVISION.                                              02067000
042400*----------------------------------------------------------       02068000
042500 0000-MAINLINE.                                                   02069000
042600                                                                  02070000
042700     PERFORM 1000-INITIALIZATION.                                 02080000
042800                                                                  02090000
042900     PERFORM 2000-PROCESS-XREF                                    02100000
043000             UNTIL PS-END-OF-PROCESSING.                          02110000
043100                                                                  02120000
043200     PERFORM 9200-WRAPUP.                                         02130000
043300                                                                  02140000
043400     GOBACK.                                                      02150000
043500                                                                  02160000
043600*0000-EXIT.                                                       02170000
043800                                                                  02180000
043900*----------------------------------------------------------       02190000
044000* 1000-INITIALIZATION.                                            02200000
044100*     INITIALIZES VARIABLES, OPENS ANY FILES, AND READS           02210000
044200*     THE INPUT FILES, SAVES VARIABLES                            02220000
044400*----------------------------------------------------------       02230000
044500 1000-INITIALIZATION.                                             02240000
044600                                                                  02250000
044700     DISPLAY '****************************************'.          02260000
044800     DISPLAY '**          EPKUT194 STARTED          **'.          02270000
044900     DISPLAY '****************************************'.          02280000
045000                                                                  02290000
045100     INITIALIZE PV-PROGRAM-VARIABLES.                             02300000
045200                                                                  02310000
045700     SET PS-NOT-END-RBT-FILE      TO TRUE.                        02320000
046200                                                                  02330000
046300     PERFORM 1100-OPEN-FILES.                                     02340000
096620     PERFORM 1200-GET-TIME.                                       02350000
                                                                        02360000
           PERFORM 1300-GET-TIME.                                       02370000
           PERFORM 1400-READ-DATE-CC.                                   02380000
071300     PERFORM 8000-DATE-ROUTINE.                                   02390000
                                                                        02400000
042000     MOVE DPG55-DB2-ISO-DATE TO PV-DATE-CALC.                     02410000
046400                                                                  02420000
046700     PERFORM 6000-READ-REBATE-FILE.                               02430000
046800                                                                  02440000
047800     IF PS-END-OF-RBT-FILE                                        02450000
047900        DISPLAY '***  REBATE EXTRACT FILE IS EMPTY    ****'       02460000
047910        SET PS-END-OF-PROCESSING TO TRUE                          02470000
048200     END-IF.                                                      02480000
048300                                                                  02490000
050900                                                                  02500000
051000*1000-EXIT.                                                       02510000
051200                                                                  02520000
051300*----------------------------------------------------------       02530000
051400* 1100-OPEN-FILES.                                                02540000
051500*     THIS PARAGRAPH OPENS ALL THE FILES IN MODE REQUIRED         02550000
051600*----------------------------------------------------------       02560000
051700 1100-OPEN-FILES.                                                 02570000
051800                                                                  02580000
051900     OPEN INPUT REBATE-FORM-FILE                                  02590000
                      CC-DATE                                           02600000
                      LAST-HEADER-TIME.                                 02610000
052500                                                                  02620000
052600     OPEN OUTPUT FORMATTED-XREF-FILE.                             02630000
052700                                                                  02640000
052800*1100-EXIT.                                                       02650000
053000                                                                  02660000
040700*----------------------------------------------------------       02670000
040800* 1200-GET-TIME.                                                  02680000
040900*     THIS PARAGRAPH GETS THE TIME FROM SYSTEM                    02690000
041000*     USED TO UPDATE THE CRT-TIMESTAMP ON THE HEADER RECORD       02700000
041100*----------------------------------------------------------       02710000
041200 1200-GET-TIME.                                                   02720000
041300                                                                  02730000
041400     ACCEPT PV-CURR-TIME FROM TIME.                               02740000
041500                                                                  02750000
041600     MOVE PV-CURR-TIME-HH TO PV-TIME-HH.                          02760000
041700     MOVE PV-CURR-TIME-MM TO PV-TIME-MM.                          02770000
041800     MOVE PV-CURR-TIME-SS TO PV-TIME-SS.                          02780000
041900                                                                  02790000
042000*****MOVE PV-TIME TO PV-TIME-CALC.                                02800000
042100                                                                  02810000
044000                                                                  02820000
044100*1200-EXIT.                                                       02830000
                                                                        02840000
047101******************************************************************02850000
047102* 1300-GET-TIME                                                   02860000
047103******************************************************************02870000
047104 1300-GET-TIME.                                                   02880000
047105                                                                  02881000
047106     READ LAST-HEADER-TIME INTO EP232-TIME-RECORD                 02882000
047107         AT END                                                   02883000
047108             SET PS-END-OF-TIME-FILE TO TRUE.                     02884000
047109                                                                  02885000
047110     IF PS-END-OF-TIME-FILE                                       02886000
047111         MOVE '1300-GET-TIME        '     TO PV-PARAGRAPH-NAME    02887000
047112         MOVE 'EMPTY TIME CC        '   TO PV-OPERATION-MSG-1     02888000
047113         SET AC-INPUT-CONTROL-CARD-ERROR TO TRUE                  02889000
047114         PERFORM 9910-ABEND                                       02890000
047115     ELSE                                                         02890100
047116         DISPLAY '-----------------------------------------'      02890200
047117         DISPLAY EP232-HEADER-TIME ' EP232-HEADER-TIME '          02890300
047118         DISPLAY '------------------------------------------'     02890400
047119         DISPLAY ' '                                              02890500
047120     END-IF.                                                      02890600
047121                                                                  02890700
           MOVE EP232-HEADER-TIME TO PV-TIME-CALC.                      02890800
                                                                        02890900
047130*1300-EXIT.                                                       02891000
063100*                                                                 02891100
047101******************************************************************02891200
047102* 1400-READ-DATE-CC                                               02891300
047103******************************************************************02891400
047104 1400-READ-DATE-CC.                                               02891500
047105                                                                  02891600
047106     READ CC-DATE INTO EP111-CC-CONTROL-CARD                      02891700
047107         AT END                                                   02891800
047108             SET PS-END-OF-DATE-FILE TO TRUE.                     02891900
047109                                                                  02892000
047110     IF PS-END-OF-DATE-FILE                                       02892100
047111         MOVE '1100-PROCESS-DATE-CC    '  TO PV-PARAGRAPH-NAME    02892200
047112         MOVE 'EMPTY DATE CC        '   TO PV-OPERATION-MSG-1     02892300
047113         SET AC-INPUT-CONTROL-CARD-ERROR TO TRUE                  02892400
047114         PERFORM 9910-ABEND                                       02892500
047115     ELSE                                                         02892600
047116         DISPLAY '-----------------------------------------'      02892700
047117         DISPLAY EP111-CC-CONTROL-CARD-DISPLY                     02892800
047118         DISPLAY '------------------------------------------'     02892900
047119         DISPLAY ' '                                              02893000
047120     END-IF.                                                      02894000
047121                                                                  02895000
047130*1400-EXIT.                                                       02896000
063200*----------------------------------------------------------       02897000
063300* 2000-PROCESS-XREF.                                              02898000
063400* ----------------------------                                    02899000
063500* THE PARAGRAPH WILL PERFORM THE FOLLOWING                        02900000
063800*                                                                 02910000
063900* (1) CREATE HEADER RECORD IF THE PREVIOUS STORE INFORMATION IS   02920000
064000*     DIFFERENT FROM THE CURRENT.                                 02930000
064200*                                                                 02940000
064300* (2) FORMAT THE DATA RECORD                                      02950000
065800*                                                                 02960000
065900*----------------------------------------------------------       02970000
066000 2000-PROCESS-XREF.                                               02980000
066100                                                                  02990000
066110**-- FORMAT HEADER RECORD                                         03000000
066111                                                                  03010000
066120     PERFORM 2050-CHECK-IF-HEADERS-NEEDED.                        03020000
066130                                                                  03030000
066700**-- INITIALIZE VARIABLES FOR DETAIL RECORD                       03040000
066710                                                                  03050000
066711     SET FORM-XRF-LEN TO +1.                                      03060000
066712     MOVE 0 TO PV-BYTE-COUNT.                                     03070000
066713     INITIALIZE FORMATTED-XREF-RECORD.                            03080000
066714                                                                  03090000
066720**-- FORMAT DETAIL RECORD                                         03100000
067000                                                                  03110000
067010     PERFORM 2500-MOVE-DELIMITER.                                 03120000
067100     PERFORM 2300-MOVE-TRIGGER-TYPE.                              03130000
067110                                                                  03140000
067200     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         03150000
067300     INITIALIZE PV-TALLY.                                         03160000
070100                                                                  03170000
070101**-- FORMAT PROMO-INTFC-ID (IS SYS-OF-REC-ID)                     03180000
070102     EVALUATE TRUE                                                03190000
070103        WHEN EP231-PROMO-INTFC-ID = 0                             03200000
070104            PERFORM 2700-MOVE-ZERO                                03210000
070105        WHEN OTHER                                                03220000
070110            INSPECT EP231-PROMO-INTFC-ID      TALLYING PV-TALLY   03230000
070120                FOR LEADING ZEROES                                03240000
070130            SET PV-BIT-IDX TO PV-TALLY                            03250000
070140            SET PV-BIT-IDX UP BY +1                               03260000
070150                                                                  03270000
070160            MOVE EP231-PROMO-INTFC-ID TO PV-VARIABLE-OUTPUT-FIELD 03280000
070170                                                                  03290000
070180            PERFORM 2400-FIELD-MOVER  VARYING PV-EOF-IDX          03300000
070190               FROM PV-BIT-IDX  BY 1                              03310000
070191               UNTIL PV-EOF-IDX > 10                              03320000
070192     END-EVALUATE.                                                03330000
070193                                                                  03340000
070194     PERFORM 2500-MOVE-DELIMITER.                                 03350000
070195                                                                  03360000
070196     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         03370000
070197     INITIALIZE PV-TALLY.                                         03380000
070198                                                                  03390000
070199**-- FORMAT SRC-SYS-ID                                            03400000
070200     EVALUATE TRUE                                                03410000
070201        WHEN PC-SRC-SYS-ID = SPACES                               03420000
070202            PERFORM 3100-MOVE-SPACE                               03430000
070203        WHEN OTHER                                                03440000
070209            MOVE PC-SRC-SYS-ID TO PV-VARIABLE-CHAR-FIELD          03450000
                                                                        03460000
098975            PERFORM 2800-FIND-DATA-END                            03470000
098976               VARYING PV-CHR-EOF-IDX                             03480000
098977                  FROM 3 BY -1                                    03490000
098978                  UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)       03500000
098979                                                  NOT = SPACE     03510000
                                                                        03520000
070210                                                                  03530000
                    PERFORM 2550-CHR-FIELD-MOVER VARYING PV-CHR-BIT-IDX 03540000
098982                  FROM 1  BY 1                                    03550000
098983                  UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX           03560000
070214     END-EVALUATE.                                                03570000
070215                                                                  03580000
070216     PERFORM 2500-MOVE-DELIMITER.                                 03590000
070217                                                                  03600000
070196     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         03610000
070197     INITIALIZE PV-TALLY.                                         03620000
070198                                                                  03630000
070199**-- FORMAT FM-LINE-NBR                                           03640000
070200     EVALUATE TRUE                                                03650000
070201        WHEN EP231-FM-LNE-NBR = 0                                 03660000
070202            PERFORM 2700-MOVE-ZERO                                03670000
070203        WHEN OTHER                                                03680000
070204            INSPECT EP231-FM-LNE-NBR          TALLYING PV-TALLY   03690000
070205                FOR LEADING ZEROES                                03700000
070206            SET PV-BIT-IDX TO PV-TALLY                            03710000
070207            SET PV-BIT-IDX UP BY +1                               03720000
070208                                                                  03730000
070209            MOVE EP231-FM-LNE-NBR   TO PV-VARIABLE-OUTPUT-FIELD   03740000
070210                                                                  03750000
070211            PERFORM 2400-FIELD-MOVER  VARYING PV-EOF-IDX          03760000
070212               FROM PV-BIT-IDX  BY 1                              03770000
070213               UNTIL PV-EOF-IDX > 3                               03780000
070214     END-EVALUATE.                                                03790000
070215                                                                  03800000
070216     PERFORM 2500-MOVE-DELIMITER.                                 03810000
070217                                                                  03820000
070196     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         03830000
070197     INITIALIZE PV-TALLY.                                         03840000
070198                                                                  03850000
070199**-- FORMAT FM-SECT-TYP-CDE                                       03860000
070200     EVALUATE TRUE                                                03870000
070201        WHEN EP231-FM-SECT-TYP-CDE = SPACES                       03880000
070202            PERFORM 3100-MOVE-SPACE                               03890000
070203        WHEN OTHER                                                03900000
070208                                                                  03910000
070209            MOVE EP231-FM-SECT-TYP-CDE TO PV-VARIABLE-CHAR-FIELD  03920000
                                                                        03930000
098975            PERFORM 2800-FIND-DATA-END                            03940000
098976               VARYING PV-CHR-EOF-IDX                             03950000
098977                  FROM 3 BY -1                                    03960000
098978                  UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)       03970000
098979                                                  NOT = SPACE     03980000
                                                                        03990000
070210                                                                  04000000
                    PERFORM 2550-CHR-FIELD-MOVER VARYING PV-CHR-BIT-IDX 04010000
098982                  FROM 1  BY 1                                    04020000
098983                  UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX           04030000
070214     END-EVALUATE.                                                04040000
070215                                                                  04050000
070216     PERFORM 2500-MOVE-DELIMITER.                                 04060000
                                                                        04070000
070196     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         04080000
070197     INITIALIZE PV-TALLY.                                         04090000
070198                                                                  04100000
070199**-- FORMAT FM-LNE-TYP-CDE                                        04110000
070200     EVALUATE TRUE                                                04120000
070201        WHEN EP231-FM-LNE-TYP-CDE = SPACES                        04130000
070202            PERFORM 3100-MOVE-SPACE                               04140000
070203        WHEN OTHER                                                04150000
070209            MOVE EP231-FM-LNE-TYP-CDE TO PV-VARIABLE-CHAR-FIELD   04160000
                                                                        04170000
098975            PERFORM 2800-FIND-DATA-END                            04180000
098976               VARYING PV-CHR-EOF-IDX                             04190000
098977                  FROM 3 BY -1                                    04200000
098978                  UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)       04210000
098979                                                  NOT = SPACE     04220000
                                                                        04230000
070210                                                                  04240000
                    PERFORM 2550-CHR-FIELD-MOVER VARYING PV-CHR-BIT-IDX 04250000
098982                  FROM 1  BY 1                                    04251000
098983                  UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX           04252000
070214     END-EVALUATE.                                                04253000
070215                                                                  04254000
070216     PERFORM 2500-MOVE-DELIMITER.                                 04255000
                                                                        04255100
070196     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         04255200
070197     INITIALIZE PV-TALLY.                                         04255300
070198                                                                  04255400
           INITIALIZE PV-EFF-END-TMST.                                  04255500
           MOVE EP231-EFF-END-DTE(1:10)            TO PV-EFF-DATE.      04255600
           MOVE EP231-EFF-END-DTE(12:2)            TO PV-EFF-HH.        04255700
           MOVE EP231-EFF-END-DTE(15:2)            TO PV-EFF-MM.        04255800
           MOVE EP231-EFF-END-DTE(18:2)            TO PV-EFF-SS.        04255900
070199**-- FORMAT EFF-END-DTE                                           04256000
070200     EVALUATE TRUE                                                04257000
070201        WHEN PV-EFF-END-TMST = SPACES                             04257100
070202            PERFORM 3100-MOVE-SPACE                               04257200
070203        WHEN OTHER                                                04257300
070209            MOVE PV-EFF-END-TMST TO PV-VARIABLE-CHAR-FIELD        04257400
                                                                        04257500
098975            PERFORM 2800-FIND-DATA-END                            04257600
098976               VARYING PV-CHR-EOF-IDX                             04257700
098977                  FROM 19 BY -1                                   04257800
098978                  UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)       04257900
098979                                                  NOT = SPACE     04258000
070210                                                                  04259000
                    PERFORM 2550-CHR-FIELD-MOVER VARYING PV-CHR-BIT-IDX 04259100
098982                  FROM 1  BY 1                                    04259200
098983                  UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX           04259300
070215                                                                  04259400
070216     PERFORM 2500-MOVE-DELIMITER.                                 04259500
                                                                        04259600
070196     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         04259700
070197     INITIALIZE PV-TALLY.                                         04259800
070198                                                                  04259900
070199**-- FORMAT FM-TXT                                                04260000
070200     EVALUATE TRUE                                                04260100
070201        WHEN EP231-FM-TXT      = SPACES                           04260200
070202            PERFORM 3100-MOVE-SPACE                               04260300
070203        WHEN OTHER                                                04260400
070209            MOVE EP231-FM-TXT TO PV-VARIABLE-CHAR-FIELD           04260500
                                                                        04260600
098975            PERFORM 2800-FIND-DATA-END                            04260700
098976               VARYING PV-CHR-EOF-IDX                             04260800
098977                  FROM 42 BY -1                                   04260900
098978                  UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)       04261000
098979                                                  NOT = SPACE     04261100
070210                                                                  04261200
                    PERFORM 2550-CHR-FIELD-MOVER VARYING PV-CHR-BIT-IDX 04261300
098982                  FROM 1  BY 1                                    04261400
098983                  UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX           04261500
070214     END-EVALUATE.                                                04261600
070215                                                                  04261700
070216     PERFORM 2500-MOVE-DELIMITER.                                 04261800
                                                                        04261900
070218     PERFORM 2600-WRITE-DATA-RECORD.                              04262000
070219                                                                  04262100
070220     PERFORM 6000-READ-REBATE-FILE.                               04262200
070221                                                                  04262300
070222     IF PS-END-OF-RBT-FILE                                        04262400
070223        SET PS-END-OF-PROCESSING TO TRUE                          04262500
070224     END-IF.                                                      04262600
070225                                                                  04262700
070230*2000-EXIT.                                                       04262800
094500                                                                  04262900
094501******************************************************************04263000
094502* 2050-CHECK-IF-HEADERS-NEEDED.                                   04264000
094503*     DETERMINE IF A HEADER RECORD NEED TO BE WRITTEN TO OUTPUT   04265000
094504*     FILE                                                        04266000
094505******************************************************************04267000
094507 2050-CHECK-IF-HEADERS-NEEDED.                                    04268000
094508                                                                  04269000
094509     IF EP231-DIST-STR-GRP-TYP-CDE NOT = PV-STR-GRP-TYP-CDE       04270000
094510      OR EP231-DIST-STR-GRP-ID NOT = PV-STR-GRP-ID-GRP            04280000
094511      OR EP231-STR-GRP-PROMO-STRT-TMST NOT =                      04290000
094511                              PV-STR-GRP-PROMO-STRT-TMST          04300000
094513        PERFORM 2100-FORMAT-AND-WRITE-HDR                         04310000
094514     END-IF.                                                      04320000
094515                                                                  04330000
094516*2050-EXIT.                                                       04340000
094530                                                                  04350000
094600*-----------------------------------------------------------------04360000
094700* 2100-FORMAT-AND-WRITE-HDR                                       04370000
094800*  THIS PARAGRAPH MOVES APPROPRIATE VALUES TO THE EPRD217 COPYBOOK04380000
094900*  LAYOUT (BEFORE WRITING OUT THE HEADER RECORD)                  04390000
095000*----------------------------------------------------------------*04400000
095100 2100-FORMAT-AND-WRITE-HDR.                                       04410000
095210     MOVE EP231-DIST-STR-GRP-TYP-CDE TO PV-STR-GRP-TYP-CDE.       04411000
095220     MOVE EP231-DIST-STR-GRP-ID   TO PV-STR-GRP-ID-GRP.           04412000
095221     MOVE EP231-STR-GRP-PROMO-STRT-TMST TO                        04413000
095221                              PV-STR-GRP-PROMO-STRT-TMST.         04414000
095222     MOVE EP231-SOR-LAST-UPD-TMST TO PV-PRICG-EFFECT-DTE.         04415000
095230                                                                  04416000
095300     MOVE PC-HDR-IND             TO EP217-HDR-INDICATOR.          04417000
095400     MOVE EP231-DIST-STR-GRP-TYP-CDE TO EP217-STR-GRP-TYP.        04418000
095410     MOVE EP231-DIST-STR-GRP-ID      TO EP217-STR-GRP-ID.         04419000
095700     MOVE PC-FIVE-ZERO           TO EP217-EXCO-STR-NBR.           04420000
           MOVE EP231-STR-GRP-PROMO-STRT-TMST(1:4) TO PV-FORMAT-YYYY.   04430000
           MOVE EP231-STR-GRP-PROMO-STRT-TMST(6:2) TO PV-FORMAT-MM.     04440000
           MOVE EP231-STR-GRP-PROMO-STRT-TMST(9:2) TO PV-FORMAT-DD.     04450000
092910     IF EP231-FILE-ACT-TYP = PC-FILE-ACT-TYP-FUL                  04460000
092910          MOVE PV-EP111-CC-ISO-DATE   TO EP217-FILE-DIST-DATE     04470000
092910     ELSE                                                         04480000
092910          MOVE PV-FORMAT-HDR-DIST-DTE TO EP217-FILE-DIST-DATE     04490000
092910     END-IF.                                                      04500000
095900     SET EP217-FILE-PROMO        TO TRUE.                         04510000
096000     MOVE PC-UNDER-SCORE         TO EP217-UNDERSCORE-1.           04520000
096010     SET EP217-XST-RBT-FORM      TO TRUE.                         04530000
096100     MOVE PC-UNDER-SCORE         TO EP217-UNDERSCORE-2.           04540000
096200     MOVE PC-UNDER-SCORE         TO EP217-UNDERSCORE-3.           04550000
096300     MOVE PC-UNDER-SCORE         TO EP217-UNDERSCORE-4.           04560000
096400     MOVE PC-UNDER-SCORE         TO EP217-UNDERSCORE-5.           04570000
096500     MOVE EP231-FILE-ACT-TYP     TO EP217-FILE-NAME-TYPE.         04580000
096501                                                                  04590000
096510     IF EP231-DIST-STR-GRP-TYP-CDE = PC-STORE-SPECIFIC-GRP        04600000
096520         MOVE PV-STR-GRP-ID          TO EP217-STORE-NBR           04610000
096530     ELSE                                                         04620000
096600         MOVE PC-FIVE-ZERO           TO EP217-STORE-NBR           04630000
096610     END-IF.                                                      04640000
                                                                        04650000
114802*--  FORMAT THE TIMESTAMP PART OF THE HEADER RECORD               04660000
                                                                        04670000
114812     MOVE PV-DATE-CALC           TO PV-HDR-TMST-DATE.             04680000
027720     MOVE PV-TIME-CALC           TO PV-HDR-TMST-TIME.             04690000
096650                                                                  04700000
096700     MOVE PV-HEADER-TIMESTAMP    TO EP217-CRT-TIMESTAMP.          04710000
                                                                        04720000
096800     MOVE EP231-APPLY-IND        TO EP217-FILE-TYPE-APPLY.        04730000
096900                                                                  04740000
097000     PERFORM 2200-WRITE-HDR-RECORD.                               04750000
097100                                                                  04760000
097200*2100-EXIT.                                                       04770000
097400                                                                  04780000
097500*-----------------------------------------------------------------04790000
097600* 2200-WRITE-HDR-RECORD                                           04800000
097700*  THIS PARAGRAPH WILL WRITE THE HEADER RECORD TO THE O/P FILE    04810000
097800*-----------------------------------------------------------------04820000
097900 2200-WRITE-HDR-RECORD.                                           04830000
098000                                                                  04840000
098110     PERFORM 5100-CALC-TIME.                                      04850000
098200                                                                  04860000
098300     MOVE 64                                                      04870000
098400       TO PV-BYTE-COUNT.                                          04880000
098500     WRITE FORMATTED-XREF-RECORD                                  04890000
098600       FROM EP217-HEADER-RECORD.                                  04900000
098700                                                                  04910000
098710     ADD 1 TO PV-HDR-REC-WRITEN.                                  04920000
098720                                                                  04930000
098800*2200-EXIT.                                                       04940000
099000                                                                  04950000
099010*-----------------------------------------------------------------04960000
099020* 2300-MOVE-TRIGGER-TYPE                                          04970000
099030*  THIS PARAGRAPH WILL MOVE TRIGGER TYPE TO OUTPUT FILE VARIABLE  04980000
099040*----------------------------------------------------------------*04990000
099050 2300-MOVE-TRIGGER-TYPE.                                          05000000
099060                                                                  05010000
099070     MOVE EP231-RECORD-ACTION                                     05020000
099080       TO FORM-XRF-FLD(FORM-XRF-LEN).                             05030000
099090     SET FORM-XRF-LEN                                             05040000
099091       UP BY +1.                                                  05050000
099092     ADD 1                                                        05060000
099093       TO PV-BYTE-COUNT.                                          05070000
099094     PERFORM 2500-MOVE-DELIMITER.                                 05080000
099095                                                                  05090000
099096*2300-EXIT.                                                       05100000
099099                                                                  05110000
099100*----------------------------------------------------------       05120000
099101* 2400-FIELD-MOVER                                                05130000
099102*     THIS PARAGRAPH MOVES A BIT OF DATA TO THE OUTPUT FILE RECORD05140000
099103*----------------------------------------------------------       05150000
099104 2400-FIELD-MOVER.                                                05160000
099105                                                                  05170000
099106     MOVE PV-BIT-VARIABLE(PV-EOF-IDX)                             05180000
099107       TO FORM-XRF-FLD(FORM-XRF-LEN).                             05190000
099108     SET FORM-XRF-LEN                                             05200000
099109       UP BY +1.                                                  05210000
099110     ADD 1                                                        05220000
099111       TO PV-BYTE-COUNT.                                          05230000
099112                                                                  05240000
099113*2400-EXIT.                                                       05250000
099115                                                                  05260000
099133*-----------------------------------------------------------------05270000
099134* 2500-MOVE-DELIMITER.                                            05280000
099135*  THIS PARAGRAPH WILL MOVE '|' TO THE OUTPUT FILE VARIABLE       05290000
099136*----------------------------------------------------------------*05300000
099137 2500-MOVE-DELIMITER.                                             05310000
099138                                                                  05320000
099139     MOVE PC-CSV-DELIMITER                                        05330000
099140       TO FORM-XRF-FLD(FORM-XRF-LEN).                             05340000
099141     SET FORM-XRF-LEN                                             05350000
099142       UP BY +1.                                                  05360000
099143     ADD 1                                                        05370000
099144       TO PV-BYTE-COUNT.                                          05380000
099145                                                                  05390000
099146*2500-EXIT.                                                       05400000
099148                                                                  05410000
099252*----------------------------------------------------------       05420000
099253* 2550-CHR-FIELD-MOVER                                            05430000
099254*     THIS PARAGRAPH MOVES A BIT OF DATA TO THE OUTPUT FILE RECORD05440000
099255*----------------------------------------------------------       05450000
099256 2550-CHR-FIELD-MOVER.                                            05460000
099257                                                                  05470000
099258     MOVE PV-BIT-CHR-VARIABLE(PV-CHR-BIT-IDX)                     05480000
099259       TO FORM-XRF-FLD(FORM-XRF-LEN).                             05490000
099260     SET FORM-XRF-LEN                                             05500000
099261       UP BY +1.                                                  05510000
099262     ADD 1                                                        05520000
099263       TO PV-BYTE-COUNT.                                          05530000
099264                                                                  05540000
099265*2550-EXIT.                                                       05541000
099150*-----------------------------------------------------------------05542000
099200* 2600-WRITE-DATA-RECORD                                          05543000
099300*  THIS PARAGRAPH WILL WRITE THE DATA RECORD TO THE O/P FILE      05544000
099400*-----------------------------------------------------------------05545000
099500 2600-WRITE-DATA-RECORD.                                          05546000
099600                                                                  05547000
099700     WRITE FORMATTED-XREF-RECORD.                                 05548000
099800                                                                  05549000
099810     ADD 1 TO PV-DATA-REC-WRITEN.                                 05549100
099820                                                                  05549200
099900*2600-EXIT.                                                       05549300
100200                                                                  05549400
100300*-----------------------------------------------------------------05549500
100400* 2700-MOVE-ZERO                                                  05549600
100500*  THIS PARAGRAPH WILL MOVE '0' TO THE OUTPUT FILE VARIABLE       05549700
100600*----------------------------------------------------------------*05549800
100700 2700-MOVE-ZERO.                                                  05549900
100800                                                                  05550000
100900     MOVE PC-ONE-ZERO                                             05560000
101000       TO FORM-XRF-FLD(FORM-XRF-LEN).                             05570000
101100     SET FORM-XRF-LEN                                             05580000
101200       UP BY +1.                                                  05590000
101300     ADD 1                                                        05600000
101400       TO PV-BYTE-COUNT.                                          05610000
101500                                                                  05620000
101600*2700-EXIT.                                                       05630000
212600                                                                  05640000
100200*-------------------------------------------------------------    05650000
100300* 2800-FIND-DATA-END.                                             05660000
100400*  THIS PARAGRAPH IS USED IN A LOOP TO DETERMINE THE LENGTH OF    05670000
100500*  THE STRING.                                                    05680000
100600*-------------------------------------------------------------    05690000
100700 2800-FIND-DATA-END.                                              05700000
100800                                                                  05710000
100900     MOVE ' '                                                     05720000
101000       TO PV-SPACE.                                               05730000
101100                                                                  05740000
101200*2800-EXIT.                                                       05750000
104900*-----------------------------------------------------------------05760000
105000* 3100-MOVE-SPACE                                                 05770000
105100*  THIS PARAGRAPH WILL MOVE ' ' TO THE OUTPUT FILE VARIABLE       05780000
105200*----------------------------------------------------------------*05790000
105300 3100-MOVE-SPACE.                                                 05800000
105400                                                                  05810000
105500     MOVE PC-ONE-SPACE                                            05810100
105600       TO FORM-XRF-FLD(FORM-XRF-LEN).                             05810200
105700     SET FORM-XRF-LEN                                             05810300
105800       UP BY +1.                                                  05810400
105900     ADD 1                                                        05810500
106000       TO PV-BYTE-COUNT.                                          05810600
106100                                                                  05810700
106200*3100-EXIT.                                                       05810800
212610******************************************************************05810900
212620* 5100-CALC-TIME.                                                 05811000
212630*     ADD 1 SECOND TO TIME FOR EACH HEADER RECORD WRITTEN         05812000
212640******************************************************************05813000
212650 5100-CALC-TIME.                                                  05814000
212660                                                                  05815000
212670     MOVE PV-TIME-CALC TO PV-TIME.                                05816000
212680                                                                  05817000
212690     IF PV-TIME-SS = 59                                           05818000
212691        IF PV-TIME-MM = 59                                        05819000
212692           IF PV-TIME-HH = 24                                     05819100
212693              MOVE ZEROES TO PV-TIME-HH                           05819200
212694           ELSE                                                   05819300
212695              ADD +1 TO PV-TIME-HH                                05819400
212696           END-IF                                                 05819500
212697           MOVE ZEROES TO PV-TIME-MM                              05819600
212698        ELSE                                                      05819700
212699           ADD +1 TO PV-TIME-MM                                   05819800
212700        END-IF                                                    05819900
212701        MOVE ZEROES TO PV-TIME-SS                                 05820000
212702     ELSE                                                         05830000
212703        ADD +1 TO PV-TIME-SS                                      05840000
212704     END-IF.                                                      05850000
212705                                                                  05860000
212706     MOVE PV-TIME TO PV-TIME-CALC.                                05870000
212707                                                                  05880000
212720*----------------------------------------------------------       05890000
212800* 6000-READ-REBATE-FILE                                           05900000
212900*     THIS PARAGRAPH READS DATA FROM REBATE-FORM-FILE INTO        05910000
213000*     COPYBOOK EPRD231                                            05920000
213100*----------------------------------------------------------       05930000
213200 6000-READ-REBATE-FILE.                                           05940000
213300                                                                  05950000
213400     READ REBATE-FORM-FILE                                        05960000
213500         INTO EP231-REBATE-INTFC-RECORD                           05970000
213600     AT END                                                       05980000
213700         SET PS-END-OF-RBT-FILE TO TRUE                           05990000
213800     END-READ.                                                    06000000
213810                                                                  06010000
213820     IF PS-NOT-END-RBT-FILE                                       06020000
213900        ADD +1 TO PV-RECORDS-READ                                 06030000
213901     END-IF.                                                      06040000
213910                                                                  06050000
214000*6000-EXIT.                                                       06060000
214200                                                                  06070000
268140*----------------------------------------------------------       06080000
268200* DATE ROUTINE TO SET UP THE PROCESS DATE IN                      06090000
268300* CCYYMMDD FORMAT.                                                06100000
268400*----------------------------------------------------------       06110000
268500 8000-DATE-ROUTINE.                                               06120000
268600                                                                  06130000
268700     INITIALIZE DPG51 DPG52 DPG53                                 06140000
268800                DPG54 DPG55 DPG56.                                06150000
268900                                                                  06160000
269000     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      06170000
269100     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      06180000
269200     MOVE EP111-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    06190000
269300                                                                  06200000
269400     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    06210000
269500                                             DPG54 DPG55 DPG56.   06220000
269600                                                                  06230000
269700     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  06240000
269800       DISPLAY '** ABEND **'                                      06250000
269900       DISPLAY '** PROGRAM = EPKUT194'                            06260000
270000       DISPLAY 'DATE = ' EP111-CC-CRNT-DTE                        06261000
270100       DISPLAY DPG54-ERROR-MESSAGE                                06262000
270200       MOVE 4019 TO AC-ABEND-CODE                                 06263000
270300       CALL 'ILBOABN0' USING AC-ABEND-CODE                        06264000
270400     END-IF.                                                      06265000
270500                                                                  06266000
092910     MOVE DPG55-DB2-ISO-DATE         TO PV-EP111-CC-ISO-DATE.     06267000
270800*8000-EXIT.                                                       06268000
270900 EJECT.                                                           06269000
253400******************************************************************06269100
253500*     CLOSES ALL FILES AND DISPLAYS ANY NEEDED INFORMATION.      *06269200
253600******************************************************************06269300
253700 9200-WRAPUP.                                                     06269400
253800     MOVE '9200-WRAPUP                     ' TO PV-PARAGRAPH-NAME.06269500
253900                                                                  06269600
254000     PERFORM 9920-DISPLAY-TOTALS.                                 06269700
254100                                                                  06269800
254200     DISPLAY '****************************************'.          06269900
254300     DISPLAY '**          EPKUT194 END              **'.          06270000
254400     DISPLAY '****************************************'.          06271000
254500                                                                  06272000
254600     CLOSE REBATE-FORM-FILE                                       06273000
254600           CC-DATE                                                06274000
254600           LAST-HEADER-TIME.                                      06275000
255100                                                                  06276000
255200     CLOSE FORMATTED-XREF-FILE.                                   06277000
255300                                                                  06278000
255400*9200-EXIT.  EXIT.                                                06279000
257400******************************************************************06280000
257500*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.              *   06290000
257600******************************************************************06300000
257700 9910-ABEND.                                                      06310000
257800                                                                  06320000
258100     DISPLAY '** ABEND           **'.                             06330000
258200     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          06340000
258300     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        06350000
258400     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       06360000
258500     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       06370000
258600                                                                  06380000
258610     PERFORM 9920-DISPLAY-TOTALS.                                 06390000
258620                                                                  06400000
258700     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         06410000
258800                                                                  06420000
258900*9910-EXIT.  EXIT.                                                06430000
259000******************************************************************06440000
259100*     DISPLAY END OF JOB TOTALS                                  *06450000
259200******************************************************************06460000
259300 9920-DISPLAY-TOTALS.                                             06470000
259400                                                                  06480000
259500     DISPLAY '****************************************'.          06490000
259600     DISPLAY '**     STATISTICS FOR REBATE FILE     **'.          06500000
259800     DISPLAY '****************************************'.          06510000
259900                                                                  06520000
260000     DISPLAY '** REBATE EXTRACT RECORDS READ  ====> '             06530000
260100             PV-RECORDS-READ                                      06540000
260200             ' **'.                                               06550000
260210     DISPLAY '** REBATE HEADER RECORDS WRITEN ====> '             06560000
260220             PV-HDR-REC-WRITEN                                    06570000
260230             ' **'.                                               06580000
260300     DISPLAY '** REBATE DETAIL RECORDS WRITEN ====> '             06590000
260400             PV-DATA-REC-WRITEN                                   06600000
260500             ' **'.                                               06610000
261200     DISPLAY '****************************************'.          06620000
261300                                                                  06630000
261400*9920-EXIT.  EXIT.                                                06640000
261500                                                                  06650000
