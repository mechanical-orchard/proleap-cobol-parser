000100*-----------------------*                                         00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300*-----------------------*                                         00030001
000400 PROGRAM-ID.    RDKCS022.                                         00040001
000500 AUTHOR.        AMY REILAND.                                      00050001
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060001
000700 DATE-WRITTEN.  03-14-96.                                         00070001
000800 DATE-COMPILED.                                                   00080001
000900*----------------------------------------------------------------*00090001
001000*    U022 - KOHL'S MERCHANDISE CARD CRITERIA SPEC                *00100001
001100*                                                                *00110001
001200*    THIS PROGRAM ALLOWS THE USER ENTER DATA TO BE USED BY       *00120001
001300*    SUBSEQUENT PROGRAMS TO INQUIRE, VOID, AUDIT OR MANUALLY     *00130001
001400*    REFER KOHL'S MERCHANDISE CARD TRANSACTIONS.                 *00140001
001500*----------------------------------------------------------------*00150001
001600* 9/19/15        JIM ARENDT   CHG0124679                          00160040
001700*  AS PART OF THE LP REFUND REMEDIATION PROJECT USERS CAN NOW     00170041
001800*  ENTER EITHER THE FULL ENCRYPTED OR UN-ENCRYPTED DRIVERS LICENSE00180041
001900*  NUMBER.                                                        00190041
002000*  THE ENCRYPTED DRIVERS LICENSE NUMBER CONTAINS BOTH UPPER AND   00200041
002100*  LOWER CASE CHARACTERS.  HOWEVER, CICS AUTOMATICALLY CONVERTS   00210041
002200*  ALPHA CHARACTERS TO UPPER CASE WHEN THE RECEIVE SCREEN COMMAND 00220041
002300*  IS EXECUTED.  ADDED THE FOLLOWING CODE TO HANDLE THIS:         00230041
002400*    EXEC CICS                                                    00240041
002500*         SET TERMINAL(EIBTRMID) NOUCTRAN                         00250041
002600*    END-EXEC.                                                    00260041
002601*----------------------------------------------------------------*00260136
002610* 5/17/16        ACCENTURE    CHG0141575                          00261037
002620*  RECOMPILE FOR SVWS004 AND SVRD022                              00262036
002700*----------------------------------------------------------------*00270033
002710* 03/14/2017     COGNIZANT    CHG0164275                          00271040
002720*  MODIFIED PROGRAM TO PERFORM VALIDATIONS FOR GIFT CARD          00272040
002721*  LENGTHS 12/19/30.                                              00272140
002722*  CHANGES ARE TAGGED WITH P35966.                                00272240
002730*----------------------------------------------------------------*00273040
002740* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00274042
002750*            - CHANGE CALL OF DPKUT100 TO                       * 00275042
002760*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00276042
002770*              MAKING THE CALL DYNAMIC VS STATIC                * 00277042
002780*                                                               * 00278042
002790*---------------------------------------------------------------* 00279042
CICS  * CHANGED 10/27/2022    BY JIM HUNTER      WR: CHG0277293         00279143
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00279243
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00279343
CICS  *---------------------------------------------------------------  00279443
002740* 02/14/2023 JEAN KURK                     WR/IR #: CHG0281369  * 00279544
005000*            - CHANGE CALL TO UPC CHECK DIGIT ROUTINE TO USE    * 00279750
005000*              VARIABLE FROM DPWS040I.                          * 00279850
002790*---------------------------------------------------------------* 00280344
002800                                                                  00281001
002900 ENVIRONMENT DIVISION.                                            00290001
003000                                                                  00300001
003100 DATA DIVISION.                                                   00310001
003200                                                                  00320001
003300 WORKING-STORAGE SECTION.                                         00330001
003400                                                                  00340001
003500 01  DK-DB2-KEYS.                                                 00350001
003600     05  DK-STORE-NUMBER           PIC S9(04)  VALUE ZEROS        00360001
003700                                               COMP.              00370001
003800 01  PC-PROGRAM-CONSTANTS.                                        00380001
003900     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'RD022A  '. 00390001
004000     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'RDKM022 '. 00400001
004100     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'RDKCS022'. 00410001
004200     05  PC-LP-FORMAT              PIC  X(01)  VALUE  '1'.        00420001
004300     05  PC-AUDIT-FORMAT           PIC  X(01)  VALUE  '2'.        00430001
004400     05  PC-LP-AUTH                PIC  X(08)  VALUE              00440001
004500                                                    'RDAUTH  '.   00450001
004600     05  PC-AUDIT-AUTH             PIC  X(08)  VALUE              00460001
004700                                                    'RDBDATE '.   00470001
004800     05  PC-ISSUE-AUTH             PIC  X(08)  VALUE              00480001
004900                                                    'RDISSUE'.    00490001
005000     05  PC-TSYMSG-NUMBERS.                                       00500001
005100         10  PC-TSYMSG-00005       PIC  9(05)  VALUE  00005.      00510001
005200         10  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.      00520001
005300         10  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.      00530001
005400         10  PC-TSYMSG-00009       PIC  9(05)  VALUE  00009.      00540001
005500         10  PC-TSYMSG-00010       PIC  9(05)  VALUE  00010.      00550001
005600         10  PC-TSYMSG-00017       PIC  9(05)  VALUE  00017.      00560001
005700         10  PC-TSYMSG-00095       PIC  9(05)  VALUE  00095.      00570001
005800         10  PC-TSYMSG-00224       PIC  9(05)  VALUE  00224.      00580001
005900         10  PC-TSYMSG-00233       PIC  9(05)  VALUE  00233.      00590001
006000         10  PC-TSYMSG-00482       PIC  9(05)  VALUE  00482.      00600001
006100         10  PC-TSYMSG-01210       PIC  9(05)  VALUE  01210.      00610001
006200         10  PC-TSYMSG-01366       PIC  9(05)  VALUE  01366.      00620001
006300         10  PC-TSYMSG-99910       PIC  9(05)  VALUE  99910.      00630001
006400     05  PC-TWO                    PIC  9(01)  VALUE  2.          00640001
006500     05  PC-ROW-NOT-FOUND          PIC S9(04)  VALUE +100         00650001
006600                                               COMP SYNC.         00660001
006700     05  PC-MAX-RETRIES            PIC S9(04)  VALUE +3           00670001
006800                                               COMP.              00680001
006900                                                                  00690001
007000 01  PV-PROGRAM-VARIABLES.                                        00700001
007100     05  PV-CONTROL-NUMBER         PIC 9(14)   VALUE ZEROES.      00710001
007200     05  PV-CONTROL-NUMBER-R  REDEFINES PV-CONTROL-NUMBER.        00720001
007300         10  PV-CN-R-CRD-CCYY.                                    00730001
007400             15 PV-CN-R-CC     PIC 9(02).                         00740001
007500             15 PV-CN-R-YY     PIC 9(02).                         00750001
007600         10  PV-CN-SHP-REQ-NBR PIC 9(04).                         00760001
007700         10  PV-CN-CNTL-NBR    PIC 9(06).                         00770001
007800     05  PV-CARD-NBR               PIC  S9(12)V COMP-3.           00780001
007900     05  PV-UPC-NBR                PIC  S9(15)V COMP-3.           00790001
008000     05  PV-TEMP-CRD-CCYY          PIC  9(04)  VALUE 0.           00800002
008100     05  PV-RESP                   PIC S9(04)  COMP.              00810002
008200     05  PV-RETRY-COUNTER          PIC S9(04)  VALUE +0           00820002
008300                                               COMP SYNC.         00830002
008400     05  PV-COUNT-CARD-CHAR        PIC  9(02).                    00840002
008500     05  PV-COUNT-CARD-SPACES      PIC  9(02).                    00850002
008600     05  PV-STORE-NUMBER-N         PIC  9(05)  VALUE  0.          00860001
008700     05  PV-ACTIVITY-TYPE-N        PIC  9(01)  VALUE  0.          00870001
008800     05  PV-CURRENT-DATE-GREG.                                    00880001
008900         10  PV-CURRENT-DATE-MM    PIC  X(02)  VALUE SPACES.      00890001
009000         10  PV-CURRENT-DATE-DD    PIC  X(02)  VALUE SPACES.      00900001
009100         10  PV-CURRENT-DATE-YY    PIC  X(02)  VALUE SPACES.      00910001
009200                                                                  00920001
009300     05  PV-SPCTY-TYP-CDE               PIC 9(04).                00930001
009400                                                                  00940003
009500     05  PV-CRD-STK-TYP-ID                 PIC  X(08).            00950003
009600     05  PV-CRD-STK-TYP-SPLIT REDEFINES PV-CRD-STK-TYP-ID.        00960003
009700         10  PV-CRD-STK-ID-3CHAR           PIC  X(03).            00970003
009800             88 PV-CARD-STOCK-SAFEWAY      VALUE 'SAF', 'SWH'.    00980003
009900         10  FILLER                        PIC  X(05).            00990003
010000                                                                  01000025
010100 01  PS-PROGRAM-SWITCHES.                                         01010001
010200     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        01020001
010300         88  PS-ERROR                          VALUE  'Y'.        01030001
010400         88  PS-NO-ERROR                       VALUE  'N'.        01040001
010500     05  PS-COMMAREA-SW            PIC  X(01)  VALUE  'N'.        01050001
010600         88  PS-COMMAREA-VALID                 VALUE  'Y'.        01060001
010700         88  PS-COMMAREA-NOT-VALID             VALUE  'N'.        01070001
010800     05  PS-DATE-ERROR-SW          PIC  X(01)  VALUE  'N'.        01080001
010900         88  PS-DATE-ERROR                     VALUE  'Y'.        01090001
011000         88  PS-NO-DATE-ERROR                  VALUE  'N'.        01100001
011100     05 PS-VALID-ACCT-NBR-SW       PIC  X(01)  VALUE  'N'.        01110001
011200         88  PS-VALID-ACCT-NBR                 VALUE  'Y'.        01120001
011300         88  PS-INVALID-ACCT-NBR               VALUE  'N'.        01130001
011400     05 PS-VALID-CARD-NBR-SW       PIC  X(01)  VALUE  'N'.        01140001
011500         88  PS-VALID-CARD-NBR                 VALUE  'Y'.        01150001
011600         88  PS-INVALID-CARD-NBR               VALUE  'N'.        01160001
011700     05 PS-UPC-PRDR-CDE-FOUND-SW   PIC  X(01)  VALUE  'N'.        01170001
011800         88  PS-UPC-PRDR-CDE-FOUND             VALUE  'Y'.        01180001
011900         88  PS-UPC-PRDR-CDE-NOT-FOUND         VALUE  'N'.        01190001
012000     05 PS-VALID-UPC-NBR-SW        PIC  X(01)  VALUE  'N'.        01200001
012100         88  PS-VALID-UPC-NBR                  VALUE  'Y'.        01210001
012200         88  PS-INVALID-UPC-NBR                VALUE  'N'.        01220001
012300     05 PS-VALID-PRDR-CDE-SW       PIC  X(01)  VALUE  'N'.        01230001
012400         88  PS-VALID-PRDR-CDE                 VALUE  'Y'.        01240001
012500         88  PS-INVALID-PRDR-CDE               VALUE  'N'.        01250001
012600     05 PS-CARD-SPACE-FOUND-SW     PIC  X(01)  VALUE  'N'.        01260001
012700         88  PS-CARD-SPACE-FOUND               VALUE  'Y'.        01270001
012800         88  PS-CARD-SPACE-NOT-FOUND           VALUE  'N'.        01280001
012900                                                                  01290001
013000 01  WS-WORK-AREA.                                                01300001
013100     05  WS-CARD1                  PIC X(30).                     01310001
013200     05  WS-CARD1-REDEF REDEFINES WS-CARD1.                       01320001
013300         10  WS-CARD1-AREA         OCCURS 30 TIMES                01330001
013400                                   INDEXED BY CARD-INDX1.         01340001
013500             15  WS-CARD1-ONE      PIC X(01).                     01350001
013600                                                                  01360001
013700     05  WS-CARD2                  PIC X(30).                     01370001
013800     05  WS-CARD2-REDEF REDEFINES WS-CARD2.                       01380001
013900         10  WS-CARD2-AREA          OCCURS 30 TIMES               01390001
014000                                    INDEXED BY CARD-INDX2.        01400001
014100             15  WS-CARD2-ONE       PIC X(01).                    01410001
014200     05  WS-CARD-ID                 PIC X(30).                    01420001
014300     05  WS-CARD-ID-N   REDEFINES  WS-CARD-ID.                    01430001
014400         10 WS-CARD-ID-N-1ST15      PIC 9(15).                    01440001
014500         10 WS-CARD-ID-N-2ND15      PIC 9(15).                    01450001
014600*----------------------------------------------------------------*01460001
014700*    WORKING STORAGE FOR CONVERSION TO CARD NUMBER.              *01470001
014800*----------------------------------------------------------------*01480001
014900                                                                  01490001
015000     COPY SVWS007.                                                01500001
015100     COPY DPWS040I.                                               01510001
015200                                                                  01520001
015300*----------------------------------------------------------------*01530001
015400*    STORED VALUE CONSTANTS                                      *01540001
015500*----------------------------------------------------------------*01550001
015600                                                                  01560001
015700     COPY SVWS004.                                                01570001
015800                                                                  01580001
015900*----------------------------------------------------------------*01590001
016000*    WORK AREA FOR THE CICSAUTH SUBROUTINE                       *01600001
016100*----------------------------------------------------------------*01610001
016200                                                                  01620001
016300     COPY DPWS008.                                                01630001
016400                                                                  01640001
016500*----------------------------------------------------------------*01650001
016600*    MAP LAYOUT                                                  *01660001
016700*----------------------------------------------------------------*01670001
016800                                                                  01680001
016900     COPY RDKM022.                                                01690001
017000                                                                  01700001
017100*----------------------------------------------------------------*01710001
017200*    ATTRIBUTE SETTINGS COPYBOOK.                                *01720001
017300*----------------------------------------------------------------*01730001
017400                                                                  01740001
017500     COPY DPWS015.                                                01750001
017600                                                                  01760001
017700*----------------------------------------------------------------*01770001
017800*    FUNCTION KEYS COPYBOOK                                      *01780001
017900*----------------------------------------------------------------*01790001
018000                                                                  01800001
018100     COPY DPWS016.                                                01810001
018200                                                                  01820001
018300******************************************************************01830001
018400** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01840001
018500** SUB-ROUTINE (DPKUT100).                                      **01850001
018600******************************************************************01860001
018700                                                                  01870001
018800     COPY DPWS010I.                                               01880001
018900                                                                  01890001
019000******************************************************************01900001
019100** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS            **01910001
019200** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **01920001
019300******************************************************************01930001
019400                                                                  01940001
019500     COPY DPWS030.                                                01950001
CICS       COPY DPWS930.                                                01951043
019600                                                                  01960001
019700***************************************************************** 01970001
019800*    STANDARD COMMAREA.                                           01980001
019900***************************************************************** 01990001
020000                                                                  02000001
020100     COPY DPWS020.                                                02010001
020200     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02020001
020300                                                                  02030001
020400***************************************************************** 02040001
020500*    INTER-APPLICATION COMMAREA.                                  02050001
020600*   RDWS020 - THIS WAS USED TO POPULATE THE INTER-APPL-COMM-AREA* 02060001
020700*             WHEN GOING TO THE COMMENT SCREEN IN THIS PROGRAM, * 02070001
020800*             INSTEAD OF RDWS023.  IF THE POSITION OF THE CARD  * 02080001
020900*             ID CHANGES IN RDWS020, THEN RDWS023 SHOULD        * 02090001
021000*             PROBABLY BE ADDED.                                * 02100001
021100*   RDWS030 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 02110001
021200*             THIS LIST PROGRAMMING TO GO TO THE MAINTENANCE    * 02120001
021300*             SCREEN.                                           * 02130001
021400*---------------------------------------------------------------* 02140001
021500                                                                  02150001
021600         10  INTER-APPL-COMM-AREA PIC X(200).                     02160001
021700     COPY RDWS020.                                                02170001
021800     COPY RDWS030.                                                02180001
021900***************************************************************** 02190001
022000*    SPECIFIC COMMMAREA FOR RDKCS022.                             02200001
022100***************************************************************** 02210001
022200         10  ASC-SPECIFIC-COMMAREA.                               02220001
022300             15  ASC-CARD-ID                 PIC X(30).           02230001
022400             15  ASC-ACTIVITY-TYPE           PIC  X(01).          02240001
022500             15  ASC-ACTIVITY-TYPE-N REDEFINES ASC-ACTIVITY-TYPE  02250001
022600                                             PIC  9(01).          02260001
022700             15  ASC-ACTIVITY-DESC           PIC  X(30).          02270001
022800             15  ASC-POS-DATE.                                    02280001
022900                 20  ASC-POS-MM              PIC  X(02).          02290001
023000                 20  ASC-POS-DD              PIC  X(02).          02300001
023100                 20  ASC-POS-YY              PIC  X(02).          02310001
023200             15  FILLER  REDEFINES  ASC-POS-DATE.                 02320001
023300                 20  ASC-POS-MM-N            PIC  9(02).          02330001
023400                 20  ASC-POS-DD-N            PIC  9(02).          02340001
023500                 20  ASC-POS-YY-N            PIC  9(02).          02350001
023600             15  ASC-POS-DATE-ISO            PIC  X(10).          02360001
023700             15  FILLER  REDEFINES  ASC-POS-DATE-ISO.             02370001
023800                 20  FILLER                  PIC  X(2).           02380001
023900                 20  ASC-POS-ISO-YY          PIC  X(2).           02390001
024000                 20  FILLER                  PIC  X(1).           02400001
024100                 20  ASC-POS-ISO-MM          PIC  X(2).           02410001
024200                 20  FILLER                  PIC  X(1).           02420001
024300                 20  ASC-POS-ISO-DD          PIC  X(2).           02430001
024400             15  ASC-STORE-NBR               PIC  X(05).          02440001
024500             15  ASC-STORE-NBR-N  REDEFINES  ASC-STORE-NBR        02450001
024600                                             PIC  9(05).          02460001
024700             15  ASC-STORE-NAME              PIC  X(25).          02470001
024800             15  ASC-TERMINAL                PIC  X(04).          02480001
024900             15  ASC-TERMINAL-N  REDEFINES  ASC-TERMINAL          02490001
025000                                             PIC  9(04).          02500001
025100             15  ASC-TRANSACTION             PIC  X(04).          02510001
025200             15  ASC-TRANSACTION-N  REDEFINES  ASC-TRANSACTION    02520001
025300                                             PIC  9(04).          02530001
025400             15  ASC-AMOUNT                  PIC  X(10).          02540001
025500             15  ASC-AMOUNT-N                PIC  9(07)V99.       02550001
025600             15  ASC-DRIVERS-LICENSE         PIC  X(21).          02560001
025700             15  ASC-DRIVERS-LICENSE-LONG    PIC  X(50).          02570032
025800             15  ASC-CONTROL-NUMBER          PIC  X(14).          02580001
025900             15  ASC-CONTROL-NUMBER-N                             02590001
026000                                 REDEFINES  ASC-CONTROL-NUMBER    02600001
026100                                             PIC  9(14).          02610001
026200**       10  FILLER                         PIC  X(2696).         02620032
026300         10  FILLER                         PIC  X(2646).         02630032
026400                                                                  02640001
026500*----------------------------------------------------------------*02650001
026600*    DATE/TIME COPYBOOK.                                         *02660001
026700*----------------------------------------------------------------*02670001
026800                                                                  02680001
026900     COPY DPWS017.                                                02690001
027000                                                                  02700001
027100*----------------------------------------------------------------*02710001
027200*    ABEND PROCESSING COPYBOOK.                                  *02720001
027300*----------------------------------------------------------------*02730001
027400                                                                  02740001
027500     COPY DPWS013.                                                02750001
027600                                                                  02760001
027700*----------------------------------------------------------------*02770001
027800*    DATE ROUTINE COPYBOOK.                                      *02780001
027900*----------------------------------------------------------------*02790001
028000                                                                  02800001
028100     COPY DPWS500.                                                02810001
028200                                                                  02820001
028300*----------------------------------------------------------------*02830001
028400*    DB2 DOMAIN LOCATION TABLE.                                  *02840001
028500*----------------------------------------------------------------*02850001
028600                                                                  02860001
028700     EXEC SQL                                                     02870001
028800         INCLUDE XST00001                                         02880001
028900     END-EXEC.                                                    02890001
029000                                                                  02900001
029100*----------------------------------------------------------------*02910001
029200*    DB2 SVT_CRD_PROD                                            *02920001
029300*----------------------------------------------------------------*02930001
029400                                                                  02940001
029500     EXEC SQL                                                     02950001
029600         INCLUDE SVT00000                                         02960001
029700     END-EXEC.                                                    02970001
029800                                                                  02980001
029900*----------------------------------------------------------------*02990001
030000*    DB2 STORE VALUE CARD ACCT TABLE                             *03000001
030100*----------------------------------------------------------------*03010001
030200                                                                  03020001
030300     EXEC SQL                                                     03030001
030400         INCLUDE SVT00001                                         03040001
030500     END-EXEC.                                                    03050001
030600*----------------------------------------------------------------*03060001
030700*    DB2 STORE VALUE CARD ACCT TABLE                             *03070001
030800*----------------------------------------------------------------*03080001
030900                                                                  03090001
031000     EXEC SQL                                                     03100001
031100         INCLUDE SVT00005                                         03110001
031200     END-EXEC.                                                    03120001
031300                                                                  03130001
031400*----------------------------------------------------------------*03140001
031500*    DB2 SVT_CRD_STK_DNMNTN                                       03150001
031600*----------------------------------------------------------------*03160001
031700                                                                  03170001
031800     EXEC SQL                                                     03180001
031900         INCLUDE SVT00008                                         03190001
032000     END-EXEC.                                                    03200001
032100                                                                  03210001
032200*----------------------------------------------------------------*03220001
032300*    DB2 COMMUNICATONS AREA                                      *03230001
032400*----------------------------------------------------------------*03240001
032500                                                                  03250001
032600     EXEC SQL                                                     03260001
032700         INCLUDE SQLCA                                            03270001
032800     END-EXEC.                                                    03280001
032900                                                                  03290001
033000 LINKAGE SECTION.                                                 03300001
033100                                                                  03310001
033200 01  DFHCOMMAREA.                                                 03320001
033300     05  FILLER                         OCCURS  1 TO 4072 TIMES   03330001
033400                                        DEPENDING ON EIBCALEN.    03340001
033500         10  FILLER                     PIC X.                    03350001
033600                                                                  03360001
033700 PROCEDURE DIVISION.                                              03370001
033800***************************************************************** 03380001
033900** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 03390001
034000** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 03400001
034100** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 03410001
034200**                                                             ** 03420001
034300** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 03430001
034400** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 03440001
034500***************************************************************** 03450001
034600 0000-MAIN-MODULE.                                                03460001
034700     INITIALIZE DP030-CICS-API-FIELDS.                            03470001
034800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03480001
034900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03490001
035000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03500001
035100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03510001
035200     MOVE LENGTH OF RD022AI        TO DP030-MAP-LENGTH (1).       03520001
035300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03530001
035400*  THIS TURNS ON THE MIXED CASE CONVERSION                        03540034
035500     EXEC CICS                                                    03550032
035600          SET TERMINAL(EIBTRMID) NOUCTRAN                         03560032
035700     END-EXEC.                                                    03570032
035800                                                                  03580032
035900     PERFORM 0001-CALL-CICS-ARCH-API.                             03590001
036000                                                                  03600026
036100     PERFORM 1000-CONTROL-PROCESSING                              03610001
036200                                                                  03620032
036300     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03630001
036400     PERFORM 0001-CALL-CICS-ARCH-API.                             03640001
036500                                                                  03650001
036600 0001-CALL-CICS-ARCH-API.                                         03660001
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03670043
036800                                    DFHCOMMAREA                   03680043
036900                                    DP030-CICS-API-FIELDS         03690043
037000                                    DP020-STANDARD-COMMAREA       03700043
037100                                    RD022AI.                      03710043
037200                                                                  03720001
037300     IF  DP030-RC-CALL-SUCCESSFUL                                 03730001
037400         CONTINUE                                                 03740001
037500     ELSE                                                         03750001
037600         SET DP013-NO-ROLLBACK                                    03760001
037700             DP013-XCTL-DISPLAY-RESTART                           03770001
037800             DP013-CICS-ABEND      TO TRUE                        03780001
037900         MOVE 'BEFORE 0000-MAIN-MODULE'                           03790001
038000                                   TO DP013-PARAGRAPH             03800001
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03801043
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03802043
038300         MOVE DP030-RETURN-CODE                                   03830001
038400                                   TO DP013-MESSAGE-TEXT (3)      03840001
038500         PERFORM DP013-0000-PROCESS-ABEND                         03850001
038600     END-IF.                                                      03860001
038700                                                                  03870001
038800*----------------------------------------------------------------*03880001
038900*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03890001
039000*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *03900001
039100*----------------------------------------------------------------*03910001
039200                                                                  03920001
039300 1000-CONTROL-PROCESSING.                                         03930001
039400                                                                  03940001
039500     PERFORM DP017-0000-GET-CURR-DATE-TIME.                       03950001
039600     IF DP017-CURRENT-TIME-HOUR < 3                               03960001
039700         PERFORM 1200-GET-YESTERDAYS-DATE                         03970001
039800     ELSE                                                         03980001
039900         MOVE DP017-CURRENT-YMD-YEAR TO PV-CURRENT-DATE-YY        03990001
040000         MOVE DP017-CURRENT-YMD-MONTH                             04000001
040100                                     TO PV-CURRENT-DATE-MM        04010001
040200         MOVE DP017-CURRENT-YMD-DAY  TO PV-CURRENT-DATE-DD        04020001
040300         MOVE DP017-EDITED-DATE-YYYYMMDD                          04030001
040400                                     TO ASC-POS-DATE-ISO          04040001
040500     END-IF.                                                      04050001
040600                                                                  04060001
040700     EVALUATE TRUE                                                04070001
040800         WHEN DP020-NEXT-ACT-INITIAL                              04080001
040900             INITIALIZE ASC-SPECIFIC-COMMAREA                     04090001
041000             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04100001
041100             IF PS-COMMAREA-NOT-VALID                             04110001
041200                 SET DP020-MSG-FATAL                              04120001
041300                     DP020-NEXT-ACT-APPL-ERROR TO TRUE            04130001
041400             ELSE                                                 04140001
041500                 PERFORM 4000-BUILD-INITIAL-PANEL                 04150001
041600             END-IF                                               04160001
041700                                                                  04170001
041800         WHEN DP020-NEXT-ACT-READ-MAP                             04180001
041900             PERFORM 2000-FKEY-PROCESSING                         04190001
042000                                                                  04200001
042100         WHEN DP020-NEXT-ACT-RETURN                               04210001
042200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04220001
042300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04230001
042400                                                                  04240001
042500         WHEN OTHER                                               04250001
042600             SET DP013-LOGIC-ABEND                                04260001
042700                 DP013-NO-ROLLBACK TO TRUE                        04270001
042800             MOVE '1000-CONTROL-PROCESSING'                       04280001
042900                                   TO  DP013-PARAGRAPH            04290001
043000             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   04300001
043100                                   TO  DP013-MESSAGE-TEXT(1)      04310001
043200             MOVE DP020-NEXT-APPL-ACTIVITY                        04320001
043300                                   TO DP013-MESSAGE-TEXT(2)       04330001
043400             PERFORM DP013-0000-PROCESS-ABEND                     04340001
043500     END-EVALUATE.                                                04350001
043600                                                                  04360001
043700*----------------------------------------------------------------*04370001
043800*    CHECK THE INTERAPPL COMMAREA PASSED FROM THE MENU TO        *04380001
043900*    DETERMINE IF THE CORRECT USER IS ACCESSING THE CRITERIA     *04390001
044000*    SPEC VIA THE CORRECT FUNCTION.                              *04400001
044100*----------------------------------------------------------------*04410001
044200                                                                  04420001
044300 1100-PROCESS-INTER-APPL-COMM.                                    04430001
044400     SET PS-COMMAREA-VALID          TO TRUE.                      04440001
044500     EVALUATE TRUE                                                04450001
044600         WHEN DP020-INT-APPL-FORMAT-IND = PC-AUDIT-FORMAT         04460001
044700             MOVE PC-AUDIT-AUTH        TO DP008-RESOURCE-NAME     04470001
044800             SET DP008-RSRC-TYPE-FUNC                             04480001
044900                 DP008-ACCESS-TYPE-USE TO TRUE                    04490001
045000             PERFORM 1110-CHECK-AUDIT-AUTH                        04500001
045100         WHEN DP020-INT-APPL-FORMAT-IND = PC-LP-FORMAT            04510001
045200             PERFORM 1120-CHECK-LP-AUTH                           04520001
045300     END-EVALUATE.                                                04530001
045400                                                                  04540001
045500*----------------------------------------------------------------*04550001
045600* CALL CICSAUTH MODULE TO VERIFY USERS' AUTHORITY FOR AUDIT      *04560001
045700*----------------------------------------------------------------*04570001
045800 1110-CHECK-AUDIT-AUTH.                                           04580001
045900     EXEC CICS                                                    04590001
046000         LINK                                                     04600001
046100           PROGRAM   (DP008-SECURITY-SUBROUTINE)                  04610001
046200           COMMAREA  (DP008-SECURITY-COMMAREA)                    04620001
046300           LENGTH    (DP008-SECURITY-COMMAREA-LENGTH)             04630001
046400           RESP      (PV-RESP)                                    04640001
046500     END-EXEC.                                                    04650001
046600     IF PV-RESP NOT = DFHRESP(NORMAL)                             04660001
046700         SET PS-COMMAREA-NOT-VALID TO TRUE                        04670001
046800*        --- BAD LINK TO SECURITY MODULE ---                      04680001
046900         MOVE PC-TSYMSG-00233      TO DP020-MSG-NUMBER            04690001
047000     ELSE                                                         04700001
047100         IF DP008-ACCESS-ALLOWED                                  04710001
047200             CONTINUE                                             04720001
047300         ELSE                                                     04730001
047400             SET PS-COMMAREA-NOT-VALID TO TRUE                    04740001
047500             SET PS-ERROR                                         04750001
047600                 DP020-MSG-FATAL       TO TRUE                    04760001
047700             SET PS-COMMAREA-NOT-VALID TO TRUE                    04770001
047800*            --- USER DOES NOT HAVE THE NECESSARY SECURITY ---    04780001
047900             MOVE PC-TSYMSG-99910      TO DP020-MSG-NUMBER        04790001
048000         END-IF                                                   04800001
048100     END-IF.                                                      04810001
048200                                                                  04820001
048300*----------------------------------------------------------------*04830001
048400* CALL CICSAUTH MODULE TO VERIFY USERS' AUTHORITY FOR LP AUTHS   *04840001
048500*----------------------------------------------------------------*04850001
048600 1120-CHECK-LP-AUTH.                                              04860001
048700     MOVE PC-LP-AUTH                TO DP008-RESOURCE-NAME.       04870001
048800     SET DP008-RSRC-TYPE-FUNC                                     04880001
048900         DP008-ACCESS-TYPE-USE      TO TRUE.                      04890001
049000     EXEC CICS                                                    04900001
049100         LINK                                                     04910001
049200           PROGRAM   (DP008-SECURITY-SUBROUTINE)                  04920001
049300           COMMAREA  (DP008-SECURITY-COMMAREA)                    04930001
049400           LENGTH    (DP008-SECURITY-COMMAREA-LENGTH)             04940001
049500           RESP      (PV-RESP)                                    04950001
049600     END-EXEC.                                                    04960001
049700     IF PV-RESP NOT = DFHRESP(NORMAL)                             04970001
049800         SET PS-COMMAREA-NOT-VALID TO TRUE                        04980001
049900*        --- BAD LINK TO SECURITY MODULE ---                      04990001
050000         MOVE PC-TSYMSG-00233      TO DP020-MSG-NUMBER            05000001
050100     ELSE                                                         05010001
050200         IF DP008-ACCESS-ALLOWED                                  05020001
050300             CONTINUE                                             05030001
050400         ELSE                                                     05040001
050500             SET PS-COMMAREA-NOT-VALID TO TRUE                    05050001
050600*            --- USER DOES NOT HAVE THE NECESSARY SECURITY ---    05060001
050700             MOVE PC-TSYMSG-99910      TO DP020-MSG-NUMBER        05070001
050800         END-IF                                                   05080001
050900     END-IF.                                                      05090001
051000                                                                  05100001
051100*----------------------------------------------------------------*05110001
051200* IF THE CURRENT TIME IS BETWEEN MIDNIGHT AND 3 AM, THE PREVIOUS *05120001
051300* DAY'S DATE WILL BE USED AS THE DEFAULT DATE.  THIS PARAGRAPH   *05130001
051400* GETS THE PREVIOUS DAY'S DATE.                                  *05140001
051500*----------------------------------------------------------------*05150001
051600                                                                  05160001
051700 1200-GET-YESTERDAYS-DATE.                                        05170001
051800                                                                  05180001
051900     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         05190001
052000                                                                  05200001
052100     SET DPG52-LK-DTE-ISO                                         05210001
052200         DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      05220001
052300                                                                  05230001
052400     SET DPG51-DECREMENT-DATE  TO TRUE.                           05240001
052500     MOVE 1                    TO DPG51-INCR-DECR-DAYS-9.         05250001
052600     MOVE ZEROES               TO DPG51-INCR-DECR-BUS-DAYS-9.     05260001
052700                                                                  05270001
052800     MOVE DP017-CURRENT-DATE-YYYYMMDD                             05280001
052900                               TO DPG52-LK-DATE-INPUT.            05290001
053000                                                                  05300001
053100     CALL DP500-KOHLS-CALENDAR-ROUTINE                            05310001
053200       USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                 05320001
053300                                                                  05330001
053400     EVALUATE TRUE                                                05340001
053500       WHEN DPG54-SEVERE-ERROR                                    05350001
053600       WHEN DPG54-DATE-INVALID                                    05360001
053700           SET DP013-NO-ROLLBACK                                  05370001
053800               DP013-XCTL-DISPLAY-RESTART                         05380001
053900               DP013-CICS-ABEND  TO TRUE                          05390001
054000           MOVE '1200-GET-YESTERDAYS-DATE'                        05400001
054100                                 TO DP013-PARAGRAPH               05410001
054200           MOVE 'DATE MODULE ERROR, GETTING YESTERDAYS DATE'      05420001
054300                                 TO DP013-MESSAGE-TEXT (1)        05430001
054400           PERFORM DP013-0000-PROCESS-ABEND                       05440001
054500       WHEN OTHER                                                 05450001
054600         MOVE DPG55-DB2-ISO-DATE-FMT                              05460001
054700                                     TO ASC-POS-DATE-ISO          05470001
054800         MOVE DPG55-GREG-DATE-YR     TO PV-CURRENT-DATE-YY        05480001
054900         MOVE DPG55-GREG-DATE-MO     TO PV-CURRENT-DATE-MM        05490001
055000         MOVE DPG55-GREG-DATE-DY     TO PV-CURRENT-DATE-DD        05500001
055100     END-EVALUATE.                                                05510001
055200                                                                  05520001
055300*----------------------------------------------------------------*05530001
055400* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*05540001
055500* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*05550001
055600* EDITS.                                                         *05560001
055700*----------------------------------------------------------------*05570001
055800                                                                  05580001
055900 2000-FKEY-PROCESSING.                                            05590001
056000                                                                  05600001
056100     EVALUATE TRUE                                                05610001
056200                                                                  05620001
056300         WHEN DP020-SRC-AID = DP016-CLEAR                         05630001
056400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05640001
056500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05650001
056600                                                                  05660001
056700         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     05670001
056800             INITIALIZE ASC-SPECIFIC-COMMAREA                     05680001
056900             PERFORM 4000-BUILD-INITIAL-PANEL                     05690001
057000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05700001
057100             PERFORM 3200-RESET-ATTRIBUTES                        05710001
057200                                                                  05720001
057300         WHEN OTHER                                               05730001
057400             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05740001
057500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05750001
057600             IF  PS-NO-ERROR                                      05760001
057700                 SET DP030-CONTINUE-GO TO TRUE                    05770001
057800                 PERFORM 2100-CHECK-FUNCTION-KEY                  05780001
057900             ELSE                                                 05790001
058000                 SET DP030-OVERRIDE-GO TO TRUE                    05800001
058100             END-IF                                               05810001
058200     END-EVALUATE.                                                05820001
058300******************************************************************05830001
058400** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **05840001
058500** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **05850001
058600** FROM THE CICS ARCHITECTURE API.                              **05860001
058700******************************************************************05870001
058800 2100-CHECK-FUNCTION-KEY.                                         05880001
058900     EVALUATE TRUE                                                05890001
059000         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 05900001
059100             PERFORM 2110-PREPARE-INTER-APPL-COMM                 05910001
059200                                                                  05920001
059300         WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)              05930001
059400             PERFORM 2110-PREPARE-INTER-APPL-COMM                 05940001
059500                                                                  05950001
059600         WHEN DP020-SRC-AID = DP016-ENTER                         05960001
059700             CONTINUE                                             05970001
059800                                                                  05980001
059900         WHEN OTHER                                               05990001
060000             SET DP013-NO-ROLLBACK                                06000001
060100                 DP013-XCTL-DISPLAY-RESTART                       06010001
060200                 DP013-CICS-ABEND  TO TRUE                        06020001
060300             MOVE '2100-CHECK-FUNCTION-KEY'                       06030001
060400                                   TO DP013-PARAGRAPH             06040001
060500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06050001
060600                                   TO DP013-MESSAGE-TEXT (1)      06060001
060700             PERFORM DP013-0000-PROCESS-ABEND                     06070001
060800     END-EVALUATE.                                                06080001
060900******************************************************************06090001
061000** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **06100001
061100** INTER-APPLICATION COMMAREA.                                  **06110001
061200******************************************************************06120001
061300 2110-PREPARE-INTER-APPL-COMM.                                    06130001
061400     INITIALIZE RD020-INTER-APPL-COMMAREA                         06140001
061500                RD030-INTER-APPL-COMMAREA.                        06150001
061600                                                                  06160001
061700     IF ASC-CARD-ID IS NUMERIC                                    06170001
061800         SET SV007-FORMAT-DISPLAY      TO TRUE                    06180001
061900         PERFORM SV007-FORMAT-CARD                                06190001
062000         IF  SV007-CARD-12-OUT2 = "00"                            06200001
062100         AND SV007-CARD-ID NOT = ZERO                             06210001
062200            MOVE SV007-CARD-ID        TO SV007-CRD-NBR            06220001
062300            MOVE ZEROES               TO SV007-CARD-NUMBER9       06230001
062400            MOVE SV007-CRD-NBR        TO SV007-CARD-13-OUT-10-9   06240001
062500            PERFORM 6400-GET-CHECK-DIGIT                          06250001
062600         END-IF                                                   06260001
062700         MOVE SV007-CARD-ID           TO RD020-CARD-ID            06270001
062800         MOVE SV007-CARD-NUMBER9      TO RD020-30-DIGIT-CARD-NBR  06280001
062900     ELSE                                                         06290001
063000         MOVE ZERO                    TO RD020-CARD-ID            06300001
063100                                         RD020-30-DIGIT-CARD-NBR  06310001
063200     END-IF.                                                      06320001
063300                                                                  06330001
063400     IF ASC-ACTIVITY-TYPE IS NUMERIC                              06340001
063500         MOVE ASC-ACTIVITY-TYPE-N  TO RD020-ACTIVITY-TYPE         06350001
063600     ELSE                                                         06360001
063700         MOVE ZERO                 TO RD020-ACTIVITY-TYPE         06370001
063800     END-IF.                                                      06380001
063900                                                                  06390001
064000     MOVE ASC-POS-DATE-ISO         TO RD020-POS-DATE-ISO.         06400001
064100                                                                  06410001
064200     IF ASC-STORE-NBR IS NUMERIC                                  06420001
064300         MOVE ASC-STORE-NBR-N      TO RD020-STORE-NBR             06430001
064400     ELSE                                                         06440001
064500         MOVE ZERO                 TO RD020-STORE-NBR             06450001
064600     END-IF.                                                      06460001
064700                                                                  06470001
064800     IF ASC-TERMINAL IS NUMERIC                                   06480001
064900         MOVE ASC-TERMINAL-N       TO RD020-TERMINAL              06490001
065000     ELSE                                                         06500001
065100         MOVE ZERO                 TO RD020-TERMINAL              06510001
065200     END-IF.                                                      06520001
065300                                                                  06530001
065400     IF ASC-TRANSACTION IS NUMERIC                                06540001
065500         MOVE ASC-TRANSACTION-N    TO RD020-TRANSACTION           06550001
065600     ELSE                                                         06560001
065700         MOVE ZERO                 TO RD020-TRANSACTION           06570001
065800     END-IF.                                                      06580001
065900                                                                  06590001
066000     MOVE ASC-AMOUNT-N             TO RD020-AMOUNT                06600001
066100     MOVE ASC-DRIVERS-LICENSE      TO RD020-DRIVERS-LICENSE.      06610001
066200     MOVE ASC-DRIVERS-LICENSE-LONG TO RD020-DRIVERS-LICENSE-LONG. 06620032
066300                                                                  06630001
066400*----------------------------------------------------------------*06640001
066500* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*06650001
066600* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *06660001
066700* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *06670001
066800*----------------------------------------------------------------*06680001
066900                                                                  06690001
067000 2200-MOVE-SCREEN-TO-COMMAREA.                                    06700001
067100     IF  ACARDIDL > ZERO                                          06710001
067200         MOVE ACARDIDI             TO ASC-CARD-ID                 06720001
067300     ELSE                                                         06730001
067400         IF  ACARDIDF = DP015-ERASE-EOF                           06740001
067500             MOVE SPACE            TO ASC-CARD-ID                 06750001
067600         END-IF                                                   06760001
067700     END-IF.                                                      06770001
067800                                                                  06780001
067900     IF  ACNTRIDL > ZERO                                          06790001
068000         MOVE ACNTRIDI             TO ASC-CONTROL-NUMBER          06800001
068100     ELSE                                                         06810001
068200         IF  ACNTRIDF = DP015-ERASE-EOF                           06820001
068300             MOVE SPACE            TO ASC-CONTROL-NUMBER          06830001
068400         END-IF                                                   06840001
068500     END-IF.                                                      06850001
068600                                                                  06860001
068700     IF  AACTTYPL > ZERO                                          06870001
068800         MOVE AACTTYPI             TO ASC-ACTIVITY-TYPE           06880001
068900     ELSE                                                         06890001
069000         IF  AACTTYPF = DP015-ERASE-EOF                           06900001
069100             MOVE SPACE            TO ASC-ACTIVITY-TYPE           06910001
069200         END-IF                                                   06920001
069300     END-IF.                                                      06930001
069400                                                                  06940001
069500     IF  APOSMML  > ZERO                                          06950001
069600         MOVE APOSMMI              TO ASC-POS-MM                  06960001
069700     ELSE                                                         06970001
069800         IF  APOSMMF  = DP015-ERASE-EOF                           06980001
069900             MOVE ZERO             TO ASC-POS-MM                  06990001
070000         END-IF                                                   07000001
070100     END-IF.                                                      07010001
070200                                                                  07020001
070300     IF  APOSDDL  > ZERO                                          07030001
070400         MOVE APOSDDI              TO ASC-POS-DD                  07040001
070500     ELSE                                                         07050001
070600         IF  APOSDDF  = DP015-ERASE-EOF                           07060001
070700             MOVE ZERO             TO ASC-POS-DD                  07070001
070800         END-IF                                                   07080001
070900     END-IF.                                                      07090001
071000                                                                  07100001
071100     IF  APOSYYL  > ZERO                                          07110001
071200         MOVE APOSYYI              TO ASC-POS-YY                  07120001
071300     ELSE                                                         07130001
071400         IF  APOSYYF  = DP015-ERASE-EOF                           07140001
071500             MOVE ZERO             TO ASC-POS-YY                  07150001
071600         END-IF                                                   07160001
071700     END-IF.                                                      07170001
071800                                                                  07180001
071900     IF  ASTRL > ZERO                                             07190001
072000         MOVE ASTRI                TO ASC-STORE-NBR               07200001
072100     ELSE                                                         07210001
072200         IF  ASTRF = DP015-ERASE-EOF                              07220001
072300             MOVE SPACE            TO ASC-STORE-NBR               07230001
072400         END-IF                                                   07240001
072500     END-IF.                                                      07250001
072600                                                                  07260001
072700     IF  ATERML > ZERO                                            07270001
072800         MOVE ATERMI               TO ASC-TERMINAL                07280001
072900     ELSE                                                         07290001
073000         IF  ATERMF = DP015-ERASE-EOF                             07300001
073100             MOVE SPACE            TO ASC-TERMINAL                07310001
073200         END-IF                                                   07320001
073300     END-IF.                                                      07330001
073400                                                                  07340001
073500     IF  ATRANL > ZERO                                            07350001
073600         MOVE ATRANI               TO ASC-TRANSACTION             07360001
073700     ELSE                                                         07370001
073800         IF  ATRANF = DP015-ERASE-EOF                             07380001
073900             MOVE SPACE            TO ASC-TRANSACTION             07390001
074000         END-IF                                                   07400001
074100     END-IF.                                                      07410001
074200                                                                  07420001
074300     IF  AAMTL > ZERO                                             07430001
074400         MOVE AAMTI                TO ASC-AMOUNT                  07440001
074500     ELSE                                                         07450001
074600         IF  AAMTF = DP015-ERASE-EOF                              07460001
074700             MOVE SPACE            TO ASC-AMOUNT                  07470001
074800             MOVE ZEROS            TO ASC-AMOUNT-N                07480001
074900         END-IF                                                   07490001
075000     END-IF.                                                      07500001
075100                                                                  07510001
075200     IF  ADLNBRL > ZERO                                           07520001
075300         IF  ADLNBRL > 30                                         07530032
075400             MOVE ADLNBRI          TO ASC-DRIVERS-LICENSE-LONG    07540032
075500             MOVE SPACES           TO ASC-DRIVERS-LICENSE         07550032
075600         ELSE                                                     07560032
075700             MOVE ADLNBRI          TO ASC-DRIVERS-LICENSE         07570015
075800             MOVE SPACES           TO ASC-DRIVERS-LICENSE-LONG    07580032
075900         END-IF                                                   07590032
076000     ELSE                                                         07600001
076100         IF  ADLNBRF = DP015-ERASE-EOF                            07610001
076200             MOVE SPACE            TO ASC-DRIVERS-LICENSE         07620001
076300         END-IF                                                   07630001
076400     END-IF.                                                      07640001
076500*----------------------------------------------------------------*07650001
076600* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *07660001
076700* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *07670001
076800* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*07680001
076900* IN THE DESTINATION PROGRAM, NOT HERE.                          *07690001
077000*----------------------------------------------------------------*07700001
077100                                                                  07710001
077200 3000-EDIT-DATA-IN-COMMAREA.                                      07720001
077300     PERFORM 3200-RESET-ATTRIBUTES.                               07730001
077400     IF  ASC-AMOUNT > SPACE                                       07740001
077500         MOVE ASC-AMOUNT           TO DP010I-UNEDITED-FIELD       07750001
077600         MOVE LENGTH OF ASC-AMOUNT TO DP010I-MAXIMUM-DIGITS       07760001
077700         MOVE PC-TWO               TO DP010I-MAXIMUM-DECIMALS     07770001
077800         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  07780001
077910         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07791041
077920                         USING DP010I-NUMERIC-EDIT-AREA           07792041
078000         IF  DP010I-ERROR-DETECTED                                07800001
078100             SET PS-ERROR                                         07810001
078200                 DP020-MSG-FATAL   TO TRUE                        07820001
078300             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07830001
078400             MOVE DP015-UNP-ALP-BRT-OFF                           07840001
078500                                   TO AAMTA                       07850001
078600             MOVE DP015-RED        TO AAMTC                       07860001
078700             MOVE DP015-REVERSE    TO AAMTH                       07870001
078800             MOVE -1               TO AAMTL                       07880001
078900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07890001
079000         ELSE                                                     07900001
079100             MOVE DP010I-NUMERIC-FIELD                            07910001
079200                                   TO ASC-AMOUNT-N                07920001
079300             MOVE ASC-AMOUNT-N     TO AAMTO                       07930001
079400             IF DP010I-NUMERIC-FIELD = ZEROS                      07940001
079500                 SET PS-ERROR                                     07950001
079600                     DP020-MSG-FATAL                              07960001
079700                                   TO TRUE                        07970001
079800                 MOVE PC-TSYMSG-00010                             07980001
079900                                   TO DP020-MSG-NUMBER            07990001
080000                 MOVE DP015-UNP-ALP-BRT-OFF                       08000001
080100                                   TO AAMTA                       08010001
080200                 MOVE DP015-RED    TO AAMTC                       08020001
080300                 MOVE DP015-REVERSE                               08030001
080400                                   TO AAMTH                       08040001
080500                 MOVE -1           TO AAMTL                       08050001
080600                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              08060001
080700             END-IF                                               08070001
080800         END-IF                                                   08080001
080900     ELSE                                                         08090001
081000         MOVE ZEROS                TO ASC-AMOUNT-N                08100001
081100                                      AAMTO                       08110001
081200     END-IF.                                                      08120001
081300                                                                  08130001
081400     IF  ASC-TRANSACTION > SPACE                                  08140001
081500         MOVE ASC-TRANSACTION      TO DP010I-UNEDITED-FIELD       08150001
081600         MOVE LENGTH OF ASC-TRANSACTION                           08160001
081700                                   TO DP010I-MAXIMUM-DIGITS       08170001
081800         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     08180001
081900         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  08190001
082010         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08201041
082020                         USING DP010I-NUMERIC-EDIT-AREA           08202041
082100         IF  DP010I-ERROR-DETECTED                                08210001
082200             SET PS-ERROR                                         08220001
082300                 DP020-MSG-FATAL   TO TRUE                        08230001
082400             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08240001
082500             MOVE DP015-UNP-ALP-BRT-OFF                           08250001
082600                                   TO ATRANA                      08260001
082700             MOVE DP015-RED        TO ATRANC                      08270001
082800             MOVE DP015-REVERSE    TO ATRANH                      08280001
082900             MOVE -1               TO ATRANL                      08290001
083000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08300001
083100         ELSE                                                     08310001
083200             MOVE DP010I-NUMERIC-FIELD                            08320001
083300                                   TO ASC-TRANSACTION-N           08330001
083400                                      ATRANO                      08340001
083500             IF DP010I-NUMERIC-FIELD = ZEROS                      08350001
083600                 SET PS-ERROR                                     08360001
083700                     DP020-MSG-FATAL                              08370001
083800                                   TO TRUE                        08380001
083900                 MOVE PC-TSYMSG-00010                             08390001
084000                                   TO DP020-MSG-NUMBER            08400001
084100                 MOVE DP015-UNP-ALP-BRT-OFF                       08410001
084200                                   TO ATRANA                      08420001
084300                 MOVE DP015-RED    TO ATRANC                      08430001
084400                 MOVE DP015-REVERSE                               08440001
084500                                   TO ATRANH                      08450001
084600                 MOVE -1           TO ATRANL                      08460001
084700                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              08470001
084800             END-IF                                               08480001
084900         END-IF                                                   08490001
085000     END-IF.                                                      08500001
085100                                                                  08510001
085200     IF  ASC-TERMINAL > SPACE                                     08520001
085300         MOVE ASC-TERMINAL         TO DP010I-UNEDITED-FIELD       08530001
085400         MOVE LENGTH OF ASC-TERMINAL                              08540001
085500                                   TO DP010I-MAXIMUM-DIGITS       08550001
085600         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     08560001
085700         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  08570001
085810         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08581041
085820                         USING DP010I-NUMERIC-EDIT-AREA           08582041
085900         IF  DP010I-ERROR-DETECTED                                08590001
086000             SET PS-ERROR                                         08600001
086100                 DP020-MSG-FATAL   TO TRUE                        08610001
086200             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08620001
086300             MOVE DP015-UNP-ALP-BRT-OFF                           08630001
086400                                   TO ATERMA                      08640001
086500             MOVE DP015-RED        TO ATERMC                      08650001
086600             MOVE DP015-REVERSE    TO ATERMH                      08660001
086700             MOVE -1               TO ATERML                      08670001
086800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08680001
086900         ELSE                                                     08690001
087000             MOVE DP010I-NUMERIC-FIELD                            08700001
087100                                   TO ASC-TERMINAL-N              08710001
087200                                      ATERMO                      08720001
087300             IF DP010I-NUMERIC-FIELD = ZEROS                      08730001
087400                 SET PS-ERROR                                     08740001
087500                     DP020-MSG-FATAL                              08750001
087600                                   TO TRUE                        08760001
087700                 MOVE PC-TSYMSG-00010                             08770001
087800                                   TO DP020-MSG-NUMBER            08780001
087900                 MOVE DP015-UNP-ALP-BRT-OFF                       08790001
088000                                   TO ATERMA                      08800001
088100                 MOVE DP015-RED    TO ATERMC                      08810001
088200                 MOVE DP015-REVERSE                               08820001
088300                                   TO ATERMH                      08830001
088400                 MOVE -1           TO ATERML                      08840001
088500                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              08850001
088600             END-IF                                               08860001
088700         END-IF                                                   08870001
088800     END-IF.                                                      08880001
088900                                                                  08890001
089000     IF  ASC-STORE-NBR > SPACE                                    08900001
089100         MOVE ASC-STORE-NBR        TO DP010I-UNEDITED-FIELD       08910001
089200         MOVE LENGTH OF ASC-STORE-NBR                             08920001
089300                                   TO DP010I-MAXIMUM-DIGITS       08930001
089400         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     08940001
089500         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  08950001
089610         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08961041
089620                         USING DP010I-NUMERIC-EDIT-AREA           08962041
089700         IF  DP010I-ERROR-DETECTED                                08970001
089800             SET PS-ERROR                                         08980001
089900                 DP020-MSG-FATAL   TO TRUE                        08990001
090000             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09000001
090100             MOVE DP015-UNP-ALP-BRT-OFF                           09010001
090200                                   TO ASTRA                       09020001
090300             MOVE DP015-RED        TO ASTRC                       09030001
090400             MOVE DP015-REVERSE    TO ASTRH                       09040001
090500             MOVE -1               TO ASTRL                       09050001
090600             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09060001
090700         ELSE                                                     09070001
090800             MOVE DP010I-NUMERIC-FIELD                            09080001
090900                                    TO PV-STORE-NUMBER-N          09090001
091000             MOVE PV-STORE-NUMBER-N TO DK-STORE-NUMBER            09100001
091100                                       ASC-STORE-NBR-N            09110001
091200             MOVE ASC-STORE-NBR     TO ASTRO                      09120001
091300             PERFORM 5000-GET-STORE-NAME                          09130001
091400             IF SQLCODE = 0                                       09140001
091500                 MOVE XST00001-LOC-NM    TO ASC-STORE-NAME        09150001
091600                                            ASTRDESO              09160001
091700             END-IF                                               09170001
091800         END-IF                                                   09180001
091900     ELSE                                                         09190001
092000         MOVE SPACES                     TO ASC-STORE-NAME        09200001
092100                                            ASTRDESO              09210001
092200     END-IF.                                                      09220001
092300                                                                  09230001
092400     IF  ASC-POS-MM > SPACE                                       09240001
092500         MOVE ASC-POS-MM           TO DP010I-UNEDITED-FIELD       09250001
092600         MOVE LENGTH OF ASC-POS-MM TO DP010I-MAXIMUM-DIGITS       09260001
092700         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     09270001
092800         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  09280001
092910         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09291041
092920                         USING DP010I-NUMERIC-EDIT-AREA           09292041
093000         IF  DP010I-ERROR-DETECTED                                09300001
093100             SET PS-ERROR                                         09310001
093200                 PS-DATE-ERROR                                    09320001
093300                 DP020-MSG-FATAL   TO TRUE                        09330001
093400             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09340001
093500             MOVE DP015-UNP-ALP-BRT-OFF                           09350001
093600                                   TO APOSMMA                     09360001
093700             MOVE DP015-RED        TO APOSMMC                     09370001
093800             MOVE DP015-REVERSE    TO APOSMMH                     09380001
093900             MOVE -1               TO APOSMML                     09390001
094000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09400001
094100         ELSE                                                     09410001
094200             MOVE DP010I-NUMERIC-FIELD                            09420001
094300                                   TO ASC-POS-MM-N                09430001
094400             MOVE ASC-POS-MM-N     TO APOSMMO                     09440001
094500         END-IF                                                   09450001
094600     END-IF.                                                      09460001
094700                                                                  09470001
094800     IF  ASC-POS-DD > SPACE                                       09480001
094900         MOVE ASC-POS-DD           TO DP010I-UNEDITED-FIELD       09490001
095000         MOVE LENGTH OF ASC-POS-DD TO DP010I-MAXIMUM-DIGITS       09500001
095100         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     09510001
095200         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  09520001
095310         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09531041
095320                         USING DP010I-NUMERIC-EDIT-AREA           09532041
095400         IF  DP010I-ERROR-DETECTED                                09540001
095500             SET PS-ERROR                                         09550001
095600                 PS-DATE-ERROR                                    09560001
095700                 DP020-MSG-FATAL   TO TRUE                        09570001
095800             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09580001
095900             MOVE DP015-UNP-ALP-BRT-OFF                           09590001
096000                                   TO APOSDDA                     09600001
096100             MOVE DP015-RED        TO APOSDDC                     09610001
096200             MOVE DP015-REVERSE    TO APOSDDH                     09620001
096300             MOVE -1               TO APOSDDL                     09630001
096400             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09640001
096500         ELSE                                                     09650001
096600             MOVE DP010I-NUMERIC-FIELD                            09660001
096700                                   TO ASC-POS-DD-N                09670001
096800             MOVE ASC-POS-DD-N     TO APOSDDO                     09680001
096900         END-IF                                                   09690001
097000     END-IF.                                                      09700001
097100                                                                  09710001
097200     IF  ASC-POS-YY > SPACE                                       09720001
097300         MOVE ASC-POS-YY           TO DP010I-UNEDITED-FIELD       09730001
097400         MOVE LENGTH OF ASC-POS-YY TO DP010I-MAXIMUM-DIGITS       09740001
097500         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     09750001
097600         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  09760001
097710         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09771041
097720                         USING DP010I-NUMERIC-EDIT-AREA           09772041
097800         IF  DP010I-ERROR-DETECTED                                09780001
097900             SET PS-ERROR                                         09790001
098000                 PS-DATE-ERROR                                    09800001
098100                 DP020-MSG-FATAL   TO TRUE                        09810001
098200             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09820001
098300             MOVE DP015-UNP-ALP-BRT-OFF                           09830001
098400                                   TO APOSYYA                     09840001
098500             MOVE DP015-RED        TO APOSYYC                     09850001
098600             MOVE DP015-REVERSE    TO APOSYYH                     09860001
098700             MOVE -1               TO APOSYYL                     09870001
098800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09880001
098900         ELSE                                                     09890001
099000             MOVE DP010I-NUMERIC-FIELD                            09900001
099100                                   TO ASC-POS-YY-N                09910001
099200             MOVE ASC-POS-YY-N     TO APOSYYO                     09920001
099300         END-IF                                                   09930001
099400     END-IF.                                                      09940001
099500                                                                  09950001
099600     IF PS-NO-DATE-ERROR                                          09960001
099700       IF (ASC-POS-DATE = SPACES                                  09970001
099800        OR ASC-POS-DATE = ZEROS)                                  09980001
099900           MOVE DP017-EDITED-DATE-YYYYMMDD TO ASC-POS-DATE-ISO    09990001
100000           MOVE ASC-POS-ISO-MM     TO ASC-POS-MM                  10000001
100100                                      APOSMMO                     10010001
100200           MOVE ASC-POS-ISO-DD     TO ASC-POS-DD                  10020001
100300                                      APOSDDO                     10030001
100400           MOVE ASC-POS-ISO-YY     TO ASC-POS-YY                  10040001
100500                                      APOSYYO                     10050001
100600       ELSE                                                       10060001
100700         INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56      10070001
100800                                                                  10080001
100900         SET DPG52-LK-DTE-GREG                                    10090001
101000             DPG51-ACTUAL-CALENDAR-ONLY TO TRUE                   10100001
101100                                                                  10110001
101200         MOVE ASC-POS-DATE         TO DPG52-LK-DATE-INPUT         10120001
101300                                                                  10130001
101400         CALL DP500-KOHLS-CALENDAR-ROUTINE                        10140001
101500           USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56              10150001
101600                                                                  10160001
101700         EVALUATE TRUE                                            10170001
101800           WHEN DPG54-SEVERE-ERROR                                10180001
101900           WHEN DPG54-DATE-INVALID                                10190001
102000             SET PS-ERROR                                         10200001
102100                 DP020-MSG-FATAL TO TRUE                          10210001
102200             MOVE PC-TSYMSG-00009 TO DP020-MSG-NUMBER             10220001
102300             MOVE DP015-UNP-ALP-BRT-OFF TO APOSMMA                10230001
102400                                           APOSDDA                10240001
102500                                           APOSYYA                10250001
102600             MOVE DP015-RED             TO APOSMMC                10260001
102700                                           APOSDDC                10270001
102800                                           APOSYYC                10280001
102900             MOVE DP015-REVERSE         TO APOSMMH                10290001
103000                                           APOSDDH                10300001
103100                                           APOSYYH                10310001
103200             MOVE -1                    TO APOSMML                10320001
103300                                           APOSDDL                10330001
103400                                           APOSYYL                10340001
103500             SET DP030-SET-CURSOR-APPL-1                          10350001
103600                                        TO TRUE                   10360001
103700           WHEN OTHER                                             10370001
103800             MOVE DPG55-DB2-ISO-DATE-FMT                          10380001
103900                                        TO ASC-POS-DATE-ISO       10390001
104000         END-EVALUATE                                             10400001
104100       END-IF                                                     10410001
104200     END-IF.                                                      10420001
104300                                                                  10430001
104400     IF  ASC-ACTIVITY-TYPE > SPACE                                10440001
104500         MOVE ASC-ACTIVITY-TYPE    TO DP010I-UNEDITED-FIELD       10450001
104600         MOVE LENGTH OF ASC-ACTIVITY-TYPE                         10460001
104700                                   TO DP010I-MAXIMUM-DIGITS       10470001
104800         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     10480001
104900         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  10490001
105010         CALL DP010I-NUMERIC-EDIT-ROUTINE                         10501041
105020                         USING DP010I-NUMERIC-EDIT-AREA           10502041
105100         IF  DP010I-ERROR-DETECTED                                10510001
105200             SET PS-ERROR                                         10520001
105300                 DP020-MSG-FATAL   TO TRUE                        10530001
105400             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            10540001
105500             MOVE DP015-UNP-ALP-BRT-OFF                           10550001
105600                                   TO AACTTYPA                    10560001
105700             MOVE DP015-RED        TO AACTTYPC                    10570001
105800             MOVE DP015-REVERSE    TO AACTTYPH                    10580001
105900             MOVE -1               TO AACTTYPL                    10590001
106000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  10600001
106100         ELSE                                                     10610001
106200             MOVE DP010I-NUMERIC-FIELD                            10620001
106300                                   TO PV-ACTIVITY-TYPE-N          10630001
106400             MOVE PV-ACTIVITY-TYPE-N                              10640001
106500                                   TO ASC-ACTIVITY-TYPE-N         10650001
106600                                      AACTTYPO                    10660001
106700             EVALUATE TRUE                                        10670001
106800                 WHEN ASC-ACTIVITY-TYPE-N =                       10680001
106900                          SV004-ISSUE-KMRC-ACT-TYP                10690001
107000                     MOVE SV004-ISSUE-KMRC-LONG-DESC              10700001
107100                                    TO ASC-ACTIVITY-DESC          10710001
107200                 WHEN ASC-ACTIVITY-TYPE-N =                       10720001
107300                          SV004-ISSUE-GIFT-CRD-ACT-TYP            10730001
107400                     MOVE SV004-ISSUE-GIFT-CRD-LONG-DESC          10740001
107500                                    TO ASC-ACTIVITY-DESC          10750001
107600                 WHEN ASC-ACTIVITY-TYPE-N =                       10760001
107700                          SV004-TENDER-ACT-TYP                    10770001
107800                     MOVE SV004-TENDER-LONG-DESC                  10780001
107900                                    TO ASC-ACTIVITY-DESC          10790001
108000                 WHEN OTHER                                       10800001
108100                     SET PS-ERROR                                 10810001
108200                         DP020-MSG-FATAL                          10820001
108300                         DP030-SET-CURSOR-APPL-1 TO TRUE          10830001
108400                     MOVE SPACES          TO ASC-ACTIVITY-DESC    10840001
108500                     MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER     10850001
108600                     MOVE DP015-UNP-ALP-BRT-OFF TO AACTTYPA       10860001
108700                     MOVE DP015-RED             TO AACTTYPC       10870001
108800                     MOVE DP015-REVERSE         TO AACTTYPH       10880001
108900                     MOVE -1                    TO AACTTYPL       10890001
109000             END-EVALUATE                                         10900001
109100             MOVE ASC-ACTIVITY-DESC             TO AACTDESO       10910001
109200         END-IF                                                   10920001
109300     ELSE                                                         10930001
109400         MOVE SV004-TENDER-ACT-TYP TO ASC-ACTIVITY-TYPE-N         10940001
109500                                      AACTTYPO                    10950001
109600         MOVE SV004-TENDER-LONG-DESC                              10960001
109700                                   TO ASC-ACTIVITY-DESC           10970001
109800                                      AACTDESO                    10980001
109900     END-IF.                                                      10990001
110000                                                                  11000001
110100     IF  ASC-ACTIVITY-TYPE-N = 1 OR 2                             11010001
110200         MOVE PC-ISSUE-AUTH TO DP008-RESOURCE-NAME                11020001
110300         SET DP008-RSRC-TYPE-FUNC      TO  TRUE                   11030001
110400         SET DP008-ACCESS-TYPE-USE     TO  TRUE                   11040001
110500         PERFORM 1110-CHECK-AUDIT-AUTH                            11050001
110600     END-IF.                                                      11060001
110700                                                                  11070001
110800     IF  ASC-CARD-ID > SPACE                                      11080001
110900       SET SV007-FORMAT-IN        TO TRUE                         11090001
111000       MOVE 0                     TO SV007-CARD-NUMBER-LENGTH     11100001
111100       MOVE ASC-CARD-ID           TO SV007-CARD-NUMBER-IN         11110001
111200       SET SV007-FORMAT-IN        TO TRUE                         11120001
111300       PERFORM SV007-FORMAT-CARD                                  11130001
111400       MOVE SV007-CARD-NUMBER     TO ASC-CARD-ID                  11140001
111500       IF SV007-FORMAT-ERROR                                      11150001
111600            SET PS-ERROR                                          11160001
111700                DP020-MSG-FATAL   TO TRUE                         11170001
111800            MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER             11180001
111900            MOVE DP015-UNP-ALP-BRT-OFF                            11190001
112000                                  TO ACARDIDA                     11200001
112100            MOVE DP015-RED        TO ACARDIDC                     11210001
112200            MOVE DP015-REVERSE    TO ACARDIDH                     11220001
112300            MOVE -1               TO ACARDIDL                     11230001
112400            SET DP030-SET-CURSOR-APPL-1 TO TRUE                   11240001
112500       ELSE                                                       11250001
112600         MOVE SV007-CARD-NBR      TO PV-CARD-NBR                  11260001
112700         PERFORM 6200-VALIDATE-ACCT-NBR                           11270001
112800         IF PS-VALID-ACCT-NBR                                     11280001
112900            PERFORM 3120-VALIDATE-CARD-NUMBER                     11290001
113000            MOVE SPACES           TO ASC-CONTROL-NUMBER           11300001
113100            MOVE SPACES           TO ASC-CONTROL-NUMBER           11310001
113200            MOVE SPACES           TO ASC-CONTROL-NUMBER           11320001
113300            MOVE ZEROES           TO ACNTRIDO                     11330001
113400         END-IF                                                   11340001
113500       END-IF                                                     11350001
113600     ELSE                                                         11360001
113700       IF ASC-CONTROL-NUMBER > SPACE                              11370001
113800           MOVE ASC-CONTROL-NUMBER                                11380001
113900                               TO DP010I-UNEDITED-FIELD           11390001
114000           MOVE LENGTH OF ASC-CONTROL-NUMBER                      11400001
114100                               TO DP010I-MAXIMUM-DIGITS           11410001
114200           MOVE ZERO           TO DP010I-MAXIMUM-DECIMALS         11420001
114300           SET DP010I-NEGATIVE-NOT-ALLOWED                        11430001
114400               DP010I-15-DIG-2-DEC-FORMAT                         11440001
114500                               TO TRUE                            11450001
114600           CALL DP010I-NUMERIC-EDIT-ROUTINE                       11460001
114700                               USING DP010I-NUMERIC-EDIT-AREA     11470001
114800           IF DP010I-ERROR-DETECTED                               11480001
114900               SET PS-ERROR    TO TRUE                            11490001
115000               SET DP020-MSG-FATAL                                11500001
115100                               TO TRUE                            11510001
115200*----PC-TSYMSG-00008 - MUST BE NUMERIC                            11520001
115300               MOVE PC-TSYMSG-00008                               11530001
115400                               TO DP020-MSG-NUMBER                11540001
115500               MOVE DP015-UNP-ALP-BRT-OFF                         11550001
115600                               TO ACNTRIDA                        11560001
115700               MOVE DP015-RED  TO ACNTRIDC                        11570001
115800               MOVE DP015-REVERSE                                 11580001
115900                               TO ACNTRIDH                        11590001
116000               MOVE -1         TO ACNTRIDL                        11600001
116100               SET DP030-SET-CURSOR-APPL-1                        11610001
116200                               TO TRUE                            11620001
116300           ELSE                                                   11630001
116400               MOVE DP010I-NUM-FIELD-15-DIG-2-DEC                 11640001
116500                               TO PV-CONTROL-NUMBER               11650001
116600               PERFORM 6000-GET-CARD-ID                           11660001
116700               IF PS-NO-ERROR                                     11670001
116800                SET SV007-FORMAT-IN        TO TRUE                11680001
116900                MOVE 0                TO SV007-CARD-NUMBER-LENGTH 11690001
117000                MOVE PV-CARD-NBR      TO SV007-CARD-NUMBER-IN9    11700001
117100                SET SV007-FORMAT-IN        TO TRUE                11710001
117200                PERFORM SV007-FORMAT-CARD                         11720001
117300                MOVE SV007-CARD-NUMBER     TO ASC-CARD-ID         11730001
117400               ELSE                                               11740001
117500                SET PS-ERROR                                      11750001
117600                    DP020-MSG-FATAL                               11760001
117700                    DP030-SET-CURSOR-APPL-1 TO TRUE               11770001
117800                MOVE PC-TSYMSG-01366 TO DP020-MSG-NUMBER          11780001
117900                MOVE DP015-UNP-ALP-BRT-OFF TO ACNTRIDA            11790001
118000                MOVE DP015-RED             TO ACNTRIDC            11800001
118100                MOVE DP015-REVERSE         TO ACNTRIDH            11810001
118200                MOVE -1                    TO ACNTRIDL            11820001
118300               END-IF                                             11830001
118400           END-IF                                                 11840001
118500       ELSE                                                       11850001
118600           SET PS-ERROR                                           11860001
118700               DP020-MSG-FATAL   TO TRUE                          11870001
118800           MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER              11880001
118900           MOVE DP015-UNP-ALP-BRT-OFF                             11890001
119000                                     TO ACARDIDA                  11900001
119100           MOVE DP015-RED        TO ACARDIDC                      11910001
119200           MOVE DP015-REVERSE    TO ACARDIDH                      11920001
119300           MOVE -1               TO ACARDIDL                      11930001
119400           SET DP030-SET-CURSOR-APPL-1 TO TRUE                    11940001
119500       END-IF                                                     11950001
119600     END-IF.                                                      11960001
119700                                                                  11970008
119800     IF ASC-DRIVERS-LICENSE-LONG > SPACES                         11980032
119900        MOVE ASC-DRIVERS-LICENSE-LONG                             11990032
120000                                   TO ADLNBRO                     12000032
120100     ELSE                                                         12010032
120200        MOVE ASC-DRIVERS-LICENSE   TO ADLNBRO                     12020032
120300     END-IF.                                                      12030032
120400                                                                  12040008
120500     IF  PS-NO-ERROR                                              12050001
120600         MOVE -1                   TO ACARDIDL                    12060001
120700         SET DP030-SET-CURSOR-APPL-1                              12070001
120800                                   TO TRUE                        12080001
120900     END-IF.                                                      12090001
121000                                                                  12100001
121100                                                                  12110001
121200*----------------------------------------------------------------*12120001
121300*    THIS PARAGRAPH DETERMINES THE SIZE OF THE CARD#, WHICH CAN  *12130001
121400*    BE 10, 12, 13, 19 OR 30.  ALL OTHER LENGTHS ARE INVALID.    *12140001
121500*    IF THE CARD LENGTH IS 19 THEN THE BIN # AND CARD TYPE NEED  *12150001
121600*    TO BE VALIDATED.  IF THE CARD LENGTH IS 30 THEN THE UPC,    *12160001
121700*    BIN AND CARD TYPE NEED TO BE VALIDATED.                     *12170001
121800*----------------------------------------------------------------*12180001
121900 3120-VALIDATE-CARD-NUMBER.                                       12190001
122000                                                                  12200001
122100     MOVE 'N' TO PS-VALID-CARD-NBR-SW.                            12210001
122200                                                                  12220001
122300                                                                  12230001
122400     EVALUATE SV007-CARD-NUMBER-LENGTH                            12240001
122500       WHEN 30                                                    12250001
122600         IF PV-SPCTY-TYP-CDE = SV007-CARD-TYPE                    12260001
122700            PERFORM 3180-VALIDATE-30-DIGIT-NBR                    12270001
122800         ELSE                                                     12280001
122900            SET PS-ERROR                                          12290001
123000                DP020-MSG-FATAL   TO TRUE                         12300001
123100            MOVE PC-TSYMSG-01210  TO DP020-MSG-NUMBER             12310001
123200            MOVE DP015-UNP-ALP-BRT-OFF                            12320001
123300                                  TO ACARDIDA                     12330001
123400            MOVE DP015-RED        TO ACARDIDC                     12340001
123500            MOVE DP015-REVERSE    TO ACARDIDH                     12350001
123600            MOVE -1               TO ACARDIDL                     12360001
123700            SET DP030-SET-CURSOR-APPL-1 TO TRUE                   12370001
123800         END-IF                                                   12380001
123900       WHEN 19                                                    12390001
124000         IF PV-SPCTY-TYP-CDE = SV007-CARD-TYPE                    12400001
124100            PERFORM 3160-VALIDATE-19-DIGIT-NBR                    12410001
124200         ELSE                                                     12420001
124300            SET PS-ERROR                                          12430001
124400                DP020-MSG-FATAL   TO TRUE                         12440001
124500            MOVE PC-TSYMSG-01210  TO DP020-MSG-NUMBER             12450001
124600            MOVE DP015-UNP-ALP-BRT-OFF                            12460001
124700                                  TO ACARDIDA                     12470001
124800            MOVE DP015-RED        TO ACARDIDC                     12480001
124900            MOVE DP015-REVERSE    TO ACARDIDH                     12490001
125000            MOVE -1               TO ACARDIDL                     12500001
125100            SET DP030-SET-CURSOR-APPL-1 TO TRUE                   12510001
125200         END-IF                                                   12520001
125300       WHEN 13                                                    12530001
125400         MOVE 'Y' TO  PS-VALID-CARD-NBR-SW                        12540001
125500       WHEN 12                                                    12550001
125600         PERFORM 3140-VALIDATE-12-DIGIT-NBR                       12560001
125700       WHEN 10                                                    12570001
125800         MOVE 'Y' TO PS-VALID-CARD-NBR-SW                         12580001
125900       WHEN OTHER                                                 12590001
126000         SET PS-ERROR                                             12600001
126100             DP020-MSG-FATAL   TO TRUE                            12610001
126200         MOVE PC-TSYMSG-01210  TO DP020-MSG-NUMBER                12620001
126300         MOVE DP015-UNP-ALP-BRT-OFF                               12630001
126400                               TO ACARDIDA                        12640001
126500         MOVE DP015-RED        TO ACARDIDC                        12650001
126600         MOVE DP015-REVERSE    TO ACARDIDH                        12660001
126700         MOVE -1               TO ACARDIDL                        12670001
126800         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      12680001
126900     END-EVALUATE.                                                12690001
127000                                                                  12700001
127100******************************************************************12710001
127200** VALIDATE 12 DIGIT CARD NUMBER                                **12720001
127300******************************************************************12730001
127400 3140-VALIDATE-12-DIGIT-NBR.                                      12740001
127500                                                                  12750001
127600     MOVE 'N' TO PS-UPC-PRDR-CDE-FOUND-SW.                        12760001
127700                                                                  12770001
127800     PERFORM 6300-EXTRACT-UPC-PRDR-CODE.                          12780001
127900                                                                  12790001
128000     IF PS-UPC-PRDR-CDE-FOUND                                     12800001
128100         MOVE SVT00000-CRD-STK-TYP-ID TO PV-CRD-STK-TYP-ID        12810003
128200                                                                  12820003
128300         IF  PV-CARD-STOCK-SAFEWAY                                12830003
128400             MOVE SV004-SAFEWAY-BIN                               12840003
128500                        TO SV007-BIN-NBR                          12850001
128600         ELSE                                                     12860003
128700             MOVE SV004-KOHLS-IIN                                 12870003
128800                        TO SV007-BIN-NBR                          12880001
128900         END-IF                                                   12890003
129000     ELSE                                                         12900003
129100         MOVE SV004-KOHLS-IIN                                     12910003
129200                        TO SV007-BIN-NBR                          12920003
129300     END-IF.                                                      12930001
129400                                                                  12940001
129500     IF PS-UPC-PRDR-CDE-FOUND                                     12950001
129600        MOVE SVT00008-UPC-NBR TO SV007-UPC-NBR                    12960001
129700        MOVE PV-SPCTY-TYP-CDE TO SV007-CARD-TYPE                  12970001
129800        MOVE SV007-CARD-NUMBER                                    12980001
129900                              TO ASC-CARD-ID                      12990001
130000        MOVE 'Y' TO PS-VALID-CARD-NBR-SW                          13000001
130100     END-IF.                                                      13010001
130200                                                                  13020001
130300******************************************************************13030001
130400** VALIDATE 19 DIGIT CARD NUMBER                                **13040001
130500******************************************************************13050001
130600 3160-VALIDATE-19-DIGIT-NBR.                                      13060001
130700                                                                  13070001
130800     MOVE 'N' TO PS-UPC-PRDR-CDE-FOUND-SW                         13080001
130900                 PS-VALID-PRDR-CDE-SW.                            13090001
131000                                                                  13100001
131100     PERFORM 6300-EXTRACT-UPC-PRDR-CODE.                          13110001
131200                                                                  13120001
131300     IF PS-UPC-PRDR-CDE-FOUND                                     13130001
131400         MOVE SVT00000-CRD-STK-TYP-ID TO PV-CRD-STK-TYP-ID        13140003
131500                                                                  13150003
131600         IF  PV-CARD-STOCK-SAFEWAY                                13160003
131700         AND SV007-BIN-NBR              = SV004-SAFEWAY-BIN       13170001
131800            MOVE 'Y' TO PS-VALID-PRDR-CDE-SW                      13180001
131900        ELSE                                                      13190001
132000           IF SV007-BIN-NBR              = SV004-KOHLS-IIN        13200001
132100              MOVE 'Y' TO PS-VALID-PRDR-CDE-SW                    13210001
132200           ELSE                                                   13220001
132300             SET PS-ERROR                                         13230001
132400                 DP020-MSG-FATAL   TO TRUE                        13240001
132500             MOVE PC-TSYMSG-01210  TO DP020-MSG-NUMBER            13250001
132600             MOVE DP015-UNP-ALP-BRT-OFF                           13260001
132700                                   TO ACARDIDA                    13270001
132800             MOVE DP015-RED        TO ACARDIDC                    13280001
132900             MOVE DP015-REVERSE    TO ACARDIDH                    13290001
133000             MOVE -1               TO ACARDIDL                    13300001
133100             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  13310001
133200           END-IF                                                 13320001
133300        END-IF                                                    13330001
133400     END-IF.                                                      13340001
133500                                                                  13350001
133600     IF PS-UPC-PRDR-CDE-FOUND                                     13360001
133700      AND  PS-VALID-PRDR-CDE                                      13370001
133800        MOVE 'Y' TO PS-VALID-CARD-NBR-SW                          13380001
133900        MOVE SVT00008-UPC-NBR TO SV007-UPC-NBR                    13390001
134000        MOVE SV007-CARD-NUMBER                                    13400001
134100                              TO ASC-CARD-ID                      13410001
134200     END-IF.                                                      13420001
134300                                                                  13430001
134400******************************************************************13440001
134500** VALIDATE 30 DIGIT CARD NUMBER                                **13450001
134600******************************************************************13460001
134700 3180-VALIDATE-30-DIGIT-NBR.                                      13470001
134800                                                                  13480001
134900     MOVE 'N' TO PS-UPC-PRDR-CDE-FOUND-SW                         13490001
135000                 PS-VALID-PRDR-CDE-SW                             13500001
135100                 PS-VALID-UPC-NBR-SW.                             13510001
135200                                                                  13520001
135300     PERFORM 6300-EXTRACT-UPC-PRDR-CODE.                          13530001
135400                                                                  13540001
135500     IF PS-UPC-PRDR-CDE-FOUND                                     13550001
135600       IF (SVT00000-CRD-PRDR-CDE = SV004-CARD-PRDR-MTL)           13560001
135700          MOVE 'Y' TO PS-VALID-UPC-NBR-SW                         13570001
135800       ELSE                                                       13580001
135900         IF SVT00008-UPC-NBR = SV007-UPC-NBR                      13590001
136000           MOVE 'Y' TO PS-VALID-UPC-NBR-SW                        13600001
136100         ELSE                                                     13610001
136200           SET PS-ERROR                                           13620001
136300           DP020-MSG-FATAL   TO TRUE                              13630001
136400           MOVE PC-TSYMSG-01210  TO DP020-MSG-NUMBER              13640001
136500           MOVE DP015-UNP-ALP-BRT-OFF                             13650001
136600                                 TO ACARDIDA                      13660001
136700           MOVE DP015-RED        TO ACARDIDC                      13670001
136800           MOVE DP015-REVERSE    TO ACARDIDH                      13680001
136900           MOVE -1               TO ACARDIDL                      13690001
137000           SET DP030-SET-CURSOR-APPL-1 TO TRUE                    13700001
137100         END-IF                                                   13710001
137200       END-IF                                                     13720001
137300     END-IF.                                                      13730001
137400                                                                  13740001
137500     IF PS-UPC-PRDR-CDE-FOUND                                     13750001
137600      AND PS-VALID-UPC-NBR                                        13760001
137700       MOVE SVT00000-CRD-STK-TYP-ID TO PV-CRD-STK-TYP-ID          13770003
137800                                                                  13780003
137900       IF  PV-CARD-STOCK-SAFEWAY                                  13790003
138000         AND SV007-BIN-NBR              = SV004-SAFEWAY-BIN       13800001
138100          MOVE 'Y' TO PS-VALID-PRDR-CDE-SW                        13810001
138200       ELSE                                                       13820001
138300         IF  SV007-BIN-NBR              = SV004-KOHLS-IIN         13830001
138400           MOVE 'Y' TO PS-VALID-PRDR-CDE-SW                       13840001
138500         ELSE                                                     13850001
138600           SET PS-ERROR                                           13860001
138700           DP020-MSG-FATAL   TO TRUE                              13870001
138800           MOVE PC-TSYMSG-01210  TO DP020-MSG-NUMBER              13880001
138900           MOVE DP015-UNP-ALP-BRT-OFF                             13890001
139000                                 TO ACARDIDA                      13900001
139100           MOVE DP015-RED        TO ACARDIDC                      13910001
139200           MOVE DP015-REVERSE    TO ACARDIDH                      13920001
139300           MOVE -1               TO ACARDIDL                      13930001
139400           SET DP030-SET-CURSOR-APPL-1 TO TRUE                    13940001
139500         END-IF                                                   13950001
139600       END-IF                                                     13960001
139700     END-IF.                                                      13970001
139800                                                                  13980001
139900     IF PS-UPC-PRDR-CDE-FOUND                                     13990001
140000      AND PS-VALID-UPC-NBR                                        14000001
140100      AND PS-VALID-PRDR-CDE                                       14010001
140200        MOVE 'Y'    TO PS-VALID-CARD-NBR-SW                       14020001
140300        MOVE SV007-CARD-NUMBER  TO ASC-CARD-ID                    14030001
140400     END-IF.                                                      14040001
140500                                                                  14050001
140600******************************************************************14060001
140700** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **14070001
140800** MAP.                                                         **14080001
140900******************************************************************14090001
141000 3200-RESET-ATTRIBUTES.                                           14100001
141100     MOVE DP015-UNP-ALP-NOR-OFF    TO ACARDIDA                    14110001
141200                                      AACTTYPA                    14120001
141300                                      APOSMMA                     14130001
141400                                      APOSDDA                     14140001
141500                                      APOSYYA                     14150001
141600                                      ASTRA                       14160001
141700                                      ATERMA                      14170001
141800                                      ATRANA                      14180001
141900                                      AAMTA                       14190001
142000                                      ADLNBRA                     14200001
142100                                      ACNTRIDA.                   14210001
142200     MOVE DP015-GREEN              TO ACARDIDC                    14220001
142300                                      AACTTYPC                    14230001
142400                                      APOSMMC                     14240001
142500                                      APOSDDC                     14250001
142600                                      APOSYYC                     14260001
142700                                      ASTRC                       14270001
142800                                      ATERMC                      14280001
142900                                      ATRANC                      14290001
143000                                      AAMTC                       14300001
143100                                      ADLNBRC                     14310001
143200                                      ACNTRIDC.                   14320001
143300     MOVE DP015-UNDERLINE          TO ACARDIDH                    14330001
143400                                      AACTTYPH                    14340001
143500                                      APOSMMH                     14350001
143600                                      APOSDDH                     14360001
143700                                      APOSYYH                     14370001
143800                                      ASTRH                       14380001
143900                                      ATERMH                      14390001
144000                                      ATRANH                      14400001
144100                                      AAMTH                       14410001
144200                                      ADLNBRH                     14420001
144300                                      ACNTRIDH.                   14430001
144400                                                                  14440001
144500*----------------------------------------------------------------*14450001
144600*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *14460001
144700*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *14470001
144800*  IT HERE.                                                      *14480001
144900*----------------------------------------------------------------*14490001
145000 4000-BUILD-INITIAL-PANEL.                                        14500001
145100     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        14510001
145200     MOVE -1                       TO ACARDIDL.                   14520001
145300     MOVE PV-CURRENT-DATE-MM       TO ASC-POS-MM                  14530001
145400                                      APOSMMO.                    14540001
145500     MOVE PV-CURRENT-DATE-DD       TO ASC-POS-DD                  14550001
145600                                      APOSDDO.                    14560001
145700     MOVE PV-CURRENT-DATE-YY       TO ASC-POS-YY                  14570001
145800                                      APOSYYO.                    14580001
145900     MOVE SV004-TENDER-ACT-TYP     TO ASC-ACTIVITY-TYPE-N         14590001
146000                                      AACTTYPO.                   14600001
146100     MOVE SV004-TENDER-LONG-DESC   TO ASC-ACTIVITY-DESC           14610001
146200                                      AACTDESO.                   14620001
146300                                                                  14630001
146400*----------------------------------------------------------------*14640001
146500*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *14650001
146600*----------------------------------------------------------------*14660001
146700 4400-MOVE-COMMAREA-TO-SCREEN.                                    14670001
146800     MOVE ASC-CARD-ID              TO SV007-CARD-NUMBER.          14680001
146900     SET SV007-FORMAT-DISPLAY      TO TRUE                        14690001
147000     PERFORM SV007-FORMAT-CARD.                                   14700001
147100     IF  SV007-CARD-12-OUT2 = "00"                                14710001
147200     AND SV007-CARD-ID NOT = ZERO                                 14720001
147300         MOVE SV007-CARD-ID        TO SV007-CRD-NBR               14730001
147400         MOVE ZEROES               TO SV007-CARD-NUMBER9          14740001
147500         MOVE SV007-CRD-NBR        TO SV007-CARD-13-OUT-10-9      14750001
147600         PERFORM 6400-GET-CHECK-DIGIT                             14760001
147700         MOVE SV007-CARD-13-OUT    TO SV007-CARD-NUMBER-DISPLAY   14770001
147800     END-IF                                                       14780001
147900     MOVE SV007-CARD-NUMBER-DISPLAY TO ACARDIDO.                  14790001
148000     MOVE ASC-ACTIVITY-TYPE-N      TO AACTTYPO.                   14800001
148100     MOVE ASC-ACTIVITY-DESC        TO AACTDESO.                   14810001
148200     MOVE ASC-POS-MM-N             TO APOSMMO.                    14820001
148300     MOVE ASC-POS-DD-N             TO APOSDDO.                    14830001
148400     MOVE ASC-POS-YY-N             TO APOSYYO.                    14840001
148500     MOVE ASC-STORE-NBR            TO ASTRO.                      14850001
148600     MOVE ASC-STORE-NAME           TO ASTRDESO.                   14860001
148700     MOVE ASC-TERMINAL-N           TO ATERMO.                     14870001
148800     MOVE ASC-TRANSACTION-N        TO ATRANO.                     14880001
148900     MOVE ASC-AMOUNT-N             TO AAMTO.                      14890001
149000***  MOVE ASC-DRIVERS-LICENSE      TO ADLNBRO.                    14900032
149100     IF ASC-DRIVERS-LICENSE-LONG > SPACES                         14910032
149200        MOVE ASC-DRIVERS-LICENSE-LONG                             14920032
149300                                   TO ADLNBRO                     14930032
149400     ELSE                                                         14940032
149500        MOVE ASC-DRIVERS-LICENSE   TO ADLNBRO                     14950032
149600     END-IF.                                                      14960032
149700                                                                  14970032
149800     MOVE ASC-CONTROL-NUMBER-N     TO ACNTRIDO.                   14980001
149900                                                                  14990001
150000*----------------------------------------------------------------*15000001
150100*    GET THE STORE NAME TO DISPLAY ON THE SCREEN.                *15010001
150200*----------------------------------------------------------------*15020001
150300 5000-GET-STORE-NAME.                                             15030001
150400                                                                  15040001
150500     EXEC SQL                                                     15050001
150600         SELECT LOC_NM                                            15060001
150700           INTO :XST00001-LOC-NM                                  15070001
150800           FROM XST_LOC                                           15080001
150900          WHERE  LOC_NBR    = :DK-STORE-NUMBER                    15090001
151000            AND  CURRENT DATE >= OPN_DTE                          15100001
151100            AND  LOC_TYP_CDE IN ('DS','SV','HQ')                  15110001
151200          WITH UR                                                 15120001
151300     END-EXEC.                                                    15130001
151400                                                                  15140001
151500     EVALUATE TRUE                                                15150001
151600         WHEN SQLCODE = 0                                         15160001
151700             CONTINUE                                             15170001
151800         WHEN SQLCODE = PC-ROW-NOT-FOUND                          15180001
151900             SET PS-ERROR                                         15190001
152000                 DP020-MSG-FATAL                                  15200001
152100                 DP030-SET-CURSOR-APPL-1 TO TRUE                  15210001
152200             MOVE SPACES                TO ASC-STORE-NAME         15220001
152300                                           ASTRDESO               15230001
152400             MOVE PC-TSYMSG-00017 TO DP020-MSG-NUMBER             15240001
152500             MOVE DP015-UNP-ALP-BRT-OFF TO ASTRA                  15250001
152600             MOVE DP015-RED             TO ASTRC                  15260001
152700             MOVE DP015-REVERSE         TO ASTRH                  15270001
152800             MOVE -1                    TO ASTRL                  15280001
152900         WHEN SQLCODE = -911                                      15290001
153000         WHEN SQLCODE = -913                                      15300001
153100             MOVE '5000-GET-STORE-NAME'                           15310001
153200                                        TO DP013-PARAGRAPH        15320001
153300             MOVE 'UNABLE TO SELECT STORE NUMBER'                 15330001
153400                                        TO DP013-MESSAGE-TEXT(1)  15340001
153500             MOVE SQLCA                 TO DP013-SQLCA            15350001
153600             MOVE 'XST_LOC'             TO DP013-DB2-TABLE-NAME(1)15360001
153700                                           DP020-MSG-TEXT         15370001
153800             SET DP013-DB2-ABEND                                  15380001
153900                 DP013-NO-ROLLBACK                                15390001
154000                 DP013-LINK-RETURN          TO TRUE               15400001
154100             PERFORM DP013-0000-PROCESS-ABEND                     15410001
154200             MOVE PC-TSYMSG-00482           TO DP020-MSG-NUMBER   15420001
154300             SET DP020-MSG-WARNING          TO TRUE               15430001
154400         WHEN SQLCODE < ZERO                                      15440001
154500         WHEN SQLCODE > ZERO                                      15450001
154600             MOVE '5000-GET-STORE-NAME'                           15460001
154700                                        TO DP013-PARAGRAPH        15470001
154800             MOVE 'UNABLE TO SELECT STORE NUMBER'                 15480001
154900                                        TO DP013-MESSAGE-TEXT(1)  15490001
155000             MOVE SQLCA                 TO DP013-SQLCA            15500001
155100             MOVE 'XST_LOC'             TO DP013-DB2-TABLE-NAME(1)15510001
155200             SET DP013-DB2-ABEND                                  15520001
155300                 DP013-NO-ROLLBACK                                15530001
155400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15540001
155500             PERFORM DP013-0000-PROCESS-ABEND                     15550001
155600     END-EVALUATE.                                                15560001
155700                                                                  15570001
155800*----------------------------------------------------------------*15580001
155900*    GET THE CARD NUMBER FROM SVT00001                           *15590001
156000*----------------------------------------------------------------*15600001
156100 6000-GET-CARD-ID.                                                15610001
156200                                                                  15620001
156300     IF PV-CN-R-CC = 0                                            15630001
156400         IF PV-CN-R-YY  > 95                                      15640001
156500             MOVE 19             TO  PV-CN-R-CC                   15650001
156600         ELSE                                                     15660001
156700             MOVE 20             TO  PV-CN-R-CC                   15670001
156800         END-IF                                                   15680001
156900     END-IF.                                                      15690001
157000                                                                  15700001
157100     MOVE  PV-CONTROL-NUMBER-R   TO  ACNTRIDO.                    15710001
157200     MOVE  PV-CN-R-CRD-CCYY      TO  PV-TEMP-CRD-CCYY.            15720001
157300     MOVE  PV-TEMP-CRD-CCYY      TO  SVT00001-CRD-PROD-YR.        15730001
157400     MOVE  PV-CN-SHP-REQ-NBR     TO  SVT00001-SHIPT-REQ-NBR.      15740001
157500     MOVE  PV-CN-CNTL-NBR        TO  SVT00001-CNTL-NBR.           15750001
157600                                                                  15760001
157700     EXEC SQL                                                     15770001
157800         SELECT CRD_NBR                                           15780001
157900               ,CRD_SPCTY_TYP_CDE                                 15790001
158000           INTO :SVT00001-CRD-NBR                                 15800001
158100               ,:SVT00001-CRD-SPCTY-TYP-CDE                       15810001
158200           FROM SVT_KOHLS_CRD_ACCT                                15820001
158300          WHERE CRD_PROD_YR       = :SVT00001-CRD-PROD-YR         15830001
158400            AND SHIPT_REQ_NBR     = :SVT00001-SHIPT-REQ-NBR       15840001
158500            AND CNTL_NBR          = :SVT00001-CNTL-NBR            15850001
158600          WITH UR                                                 15860001
158700     END-EXEC.                                                    15870001
158800                                                                  15880001
158900     EVALUATE TRUE                                                15890001
159000         WHEN SQLCODE = 0                                         15900001
159100             MOVE SVT00001-CRD-NBR     TO PV-CARD-NBR             15910001
159200             MOVE SVT00001-CRD-SPCTY-TYP-CDE                      15920001
159300                                       TO PV-SPCTY-TYP-CDE        15930001
159400         WHEN SQLCODE = PC-ROW-NOT-FOUND                          15940001
159500             PERFORM 6100-SELECT-ACCT-HIST-TBL                    15950001
159600             IF SQLCODE = 0                                       15960001
159700                CONTINUE                                          15970001
159800             ELSE                                                 15980001
159900                SET PS-ERROR                                      15990001
160000                    DP020-MSG-FATAL                               16000001
160100                    DP030-SET-CURSOR-APPL-1 TO TRUE               16010001
160200                MOVE PC-TSYMSG-01366 TO DP020-MSG-NUMBER          16020001
160300                MOVE DP015-UNP-ALP-BRT-OFF TO ACNTRIDA            16030001
160400                MOVE DP015-RED             TO ACNTRIDC            16040001
160500                MOVE DP015-REVERSE         TO ACNTRIDH            16050001
160600                MOVE -1                    TO ACNTRIDL            16060001
160700             END-IF                                               16070001
160800         WHEN SQLCODE = -911                                      16080001
160900         WHEN SQLCODE = -913                                      16090001
161000             MOVE '6000-GET-CARD-ID'                              16100001
161100                                        TO DP013-PARAGRAPH        16110001
161200             MOVE 'UNABLE TO SELECT CARD ID NUMBER'               16120001
161300                                        TO DP013-MESSAGE-TEXT(1)  16130001
161400             MOVE SQLCA                 TO DP013-SQLCA            16140001
161500             MOVE 'SVT_KOHLS_CRD_ACCT'  TO DP013-DB2-TABLE-NAME(1)16150001
161600                                           DP020-MSG-TEXT         16160001
161700             SET DP013-DB2-ABEND                                  16170001
161800                 DP013-NO-ROLLBACK                                16180001
161900                 DP013-LINK-RETURN          TO TRUE               16190001
162000             PERFORM DP013-0000-PROCESS-ABEND                     16200001
162100             MOVE PC-TSYMSG-00482           TO DP020-MSG-NUMBER   16210001
162200             SET DP020-MSG-WARNING          TO TRUE               16220001
162300         WHEN SQLCODE < ZERO                                      16230001
162400         WHEN SQLCODE > ZERO                                      16240001
162500             MOVE '6000-GET-CARD-ID'                              16250001
162600                                        TO DP013-PARAGRAPH        16260001
162700             MOVE 'UNABLE TO SELECT CAARD ID NUMBER'              16270001
162800                                        TO DP013-MESSAGE-TEXT(1)  16280001
162900             MOVE SQLCA                 TO DP013-SQLCA            16290001
163000             MOVE 'SVT_KOHLS_CRD_ACCT'  TO DP013-DB2-TABLE-NAME(1)16300001
163100             SET DP013-DB2-ABEND                                  16310001
163200                 DP013-NO-ROLLBACK                                16320001
163300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16330001
163400             PERFORM DP013-0000-PROCESS-ABEND                     16340001
163500     END-EVALUATE.                                                16350001
163600                                                                  16360001
163700*----------------------------------------------------------------*16370001
163800*    GET THE CARD NUMBER FROM SVT00005 HISTORY TABLE             *16380001
163900*----------------------------------------------------------------*16390001
164000 6100-SELECT-ACCT-HIST-TBL.                                       16400001
164100                                                                  16410001
164200     MOVE  PV-CONTROL-NUMBER-R   TO  ACNTRIDO.                    16420001
164300     MOVE  PV-CN-R-CRD-CCYY      TO  PV-TEMP-CRD-CCYY.            16430001
164400     MOVE  PV-TEMP-CRD-CCYY      TO  SVT00005-CRD-PROD-YR.        16440001
164500     MOVE  PV-CN-SHP-REQ-NBR     TO  SVT00005-SHIPT-REQ-NBR.      16450001
164600     MOVE  PV-CN-CNTL-NBR        TO  SVT00005-CNTL-NBR.           16460001
164700                                                                  16470001
164800     EXEC SQL                                                     16480001
164900         SELECT CRD_NBR                                           16490001
165000               ,CRD_SPCTY_TYP_CDE                                 16500001
165100           INTO :SVT00005-CRD-NBR                                 16510001
165200               ,:SVT00005-CRD-SPCTY-TYP-CDE                       16520001
165300           FROM SVT_CRD_ACCT_HIST                                 16530001
165400          WHERE CRD_PROD_YR       = :SVT00005-CRD-PROD-YR         16540001
165500            AND SHIPT_REQ_NBR     = :SVT00005-SHIPT-REQ-NBR       16550001
165600            AND CNTL_NBR          = :SVT00005-CNTL-NBR            16560001
165700          WITH UR                                                 16570001
165800     END-EXEC.                                                    16580001
165900                                                                  16590001
166000     EVALUATE TRUE                                                16600001
166100         WHEN SQLCODE = 0                                         16610001
166200             MOVE SVT00005-CRD-NBR     TO PV-CARD-NBR             16620001
166300             MOVE SVT00005-CRD-SPCTY-TYP-CDE                      16630001
166400                                       TO PV-SPCTY-TYP-CDE        16640001
166500         WHEN SQLCODE = PC-ROW-NOT-FOUND                          16650001
166600             CONTINUE                                             16660001
166700         WHEN SQLCODE = -911                                      16670001
166800         WHEN SQLCODE = -913                                      16680001
166900             MOVE '6100-SELECT-ACCT-HIST-TBL'                     16690001
167000                                        TO DP013-PARAGRAPH        16700001
167100             MOVE 'UNABLE TO SELECT CARD ID NUMBER FROM HIST'     16710001
167200                                        TO DP013-MESSAGE-TEXT(1)  16720001
167300             MOVE SQLCA                 TO DP013-SQLCA            16730001
167400             MOVE 'SVT_CRD_ACCT_HIST'  TO DP013-DB2-TABLE-NAME(1) 16740001
167500                                           DP020-MSG-TEXT         16750001
167600             SET DP013-DB2-ABEND                                  16760001
167700                 DP013-NO-ROLLBACK                                16770001
167800                 DP013-LINK-RETURN          TO TRUE               16780001
167900             PERFORM DP013-0000-PROCESS-ABEND                     16790001
168000             MOVE PC-TSYMSG-00482           TO DP020-MSG-NUMBER   16800001
168100             SET DP020-MSG-WARNING          TO TRUE               16810001
168200         WHEN SQLCODE < ZERO                                      16820001
168300         WHEN SQLCODE > ZERO                                      16830001
168400             MOVE '6100-SELECT-ACCT-HIST-TBL'                     16840001
168500                                        TO DP013-PARAGRAPH        16850001
168600             MOVE 'UNABLE TO SELECT CARD ID NUMBER FROM HIST'     16860001
168700                                        TO DP013-MESSAGE-TEXT(1)  16870001
168800             MOVE SQLCA                 TO DP013-SQLCA            16880001
168900             MOVE 'SVT_KOHLS_CRD_ACCT'  TO DP013-DB2-TABLE-NAME(1)16890001
169000             SET DP013-DB2-ABEND                                  16900001
169100                 DP013-NO-ROLLBACK                                16910001
169200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16920001
169300             PERFORM DP013-0000-PROCESS-ABEND                     16930001
169400     END-EVALUATE.                                                16940001
169500                                                                  16950001
169600*----------------------------------------------------------------*16960001
169700*  VALIDATE ACCOUNT NUMBER ENTERED                                16970001
169800*----------------------------------------------------------------*16980001
169900 6200-VALIDATE-ACCT-NBR.                                          16990001
170000                                                                  17000001
170100     EXEC SQL                                                     17010001
170200         SELECT CRD_SPCTY_TYP_CDE                                 17020001
170300               ,CRD_PROD_YR                                       17030001
170400               ,SHIPT_REQ_NBR                                     17040001
170500           INTO :SVT00001-CRD-SPCTY-TYP-CDE                       17050001
170600               ,:SVT00001-CRD-PROD-YR                             17060001
170700               ,:SVT00001-SHIPT-REQ-NBR                           17070001
170800           FROM SVT_KOHLS_CRD_ACCT                                17080001
170900          WHERE CRD_NBR = :PV-CARD-NBR                            17090001
171000          WITH UR                                                 17100001
171100     END-EXEC.                                                    17110001
171200                                                                  17120001
171300     EVALUATE TRUE                                                17130001
171400       WHEN SQLCODE = ZERO                                        17140001
171500           MOVE 'Y' TO PS-VALID-ACCT-NBR-SW                       17150001
171600           MOVE SVT00001-CRD-SPCTY-TYP-CDE                        17160001
171700                                        TO PV-SPCTY-TYP-CDE       17170001
171800       WHEN SQLCODE = PC-ROW-NOT-FOUND                            17180001
171900           PERFORM 6210-SELECT-ACCT-NBR-HIST-TBL                  17190001
172000           IF SQLCODE = 0                                         17200001
172100             CONTINUE                                             17210001
172200           ELSE                                                   17220001
172300             SET PS-ERROR                                         17230001
172400                 DP020-MSG-FATAL                                  17240001
172500                 DP030-SET-CURSOR-APPL-1 TO TRUE                  17250001
172600             MOVE PC-TSYMSG-01210 TO DP020-MSG-NUMBER             17260001
172700             MOVE DP015-UNP-ALP-BRT-OFF TO ACARDIDA               17270001
172800             MOVE DP015-RED             TO ACARDIDC               17280001
172900             MOVE DP015-REVERSE         TO ACARDIDH               17290001
173000             MOVE -1                    TO ACARDIDL               17300001
173100           END-IF                                                 17310001
173200       WHEN OTHER                                                 17320001
173300          MOVE '6200-VALIDATE-ACCT-NBR'                           17330001
173400                                   TO DP013-PARAGRAPH             17340001
173500          MOVE 'INVALID ACCT NUMBER'                              17350001
173600                                   TO DP013-MESSAGE-TEXT (1)      17360001
173700          MOVE SQLCA               TO DP013-SQLCA                 17370001
173800          MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)   17380001
173900          SET DP013-DB2-ABEND      TO TRUE                        17390001
174000          PERFORM DP013-0000-PROCESS-ABEND                        17400001
174100     END-EVALUATE.                                                17410001
174200                                                                  17420001
174300*----------------------------------------------------------------*17430001
174400*    GET THE CARD NUMBER FROM SVT00005 HISTORY TABLE             *17440001
174500*----------------------------------------------------------------*17450001
174600 6210-SELECT-ACCT-NBR-HIST-TBL.                                   17460001
174700                                                                  17470001
174800     EXEC SQL                                                     17480001
174900         SELECT CRD_SPCTY_TYP_CDE                                 17490001
175000               ,CRD_PROD_YR                                       17500001
175100               ,SHIPT_REQ_NBR                                     17510001
175200           INTO :SVT00005-CRD-SPCTY-TYP-CDE                       17520001
175300               ,:SVT00005-CRD-PROD-YR                             17530001
175400               ,:SVT00005-SHIPT-REQ-NBR                           17540001
175500           FROM SVT_CRD_ACCT_HIST                                 17550001
175600          WHERE CRD_NBR = :PV-CARD-NBR                            17560001
175700          WITH UR                                                 17570001
175800     END-EXEC.                                                    17580001
175900                                                                  17590001
176000     EVALUATE TRUE                                                17600001
176100         WHEN SQLCODE = 0                                         17610001
176200             MOVE 'Y' TO PS-VALID-ACCT-NBR-SW                     17620001
176300             MOVE SVT00005-CRD-SPCTY-TYP-CDE                      17630001
176400                                       TO PV-SPCTY-TYP-CDE        17640001
176500         WHEN SQLCODE = PC-ROW-NOT-FOUND                          17650001
176600             CONTINUE                                             17660001
176700         WHEN SQLCODE = -911                                      17670001
176800         WHEN SQLCODE = -913                                      17680001
176900             MOVE '6210-SELECT-ACCT-NBR-HIST-TBL'                 17690001
177000                                        TO DP013-PARAGRAPH        17700001
177100             MOVE 'UNABLE TO SELECT CARD ID NUMBER FROM HIST'     17710001
177200                                        TO DP013-MESSAGE-TEXT(1)  17720001
177300             MOVE SQLCA                 TO DP013-SQLCA            17730001
177400             MOVE 'SVT_CRD_ACCT_HIST'  TO DP013-DB2-TABLE-NAME(1) 17740001
177500                                           DP020-MSG-TEXT         17750001
177600             SET DP013-DB2-ABEND                                  17760001
177700                 DP013-NO-ROLLBACK                                17770001
177800                 DP013-LINK-RETURN          TO TRUE               17780001
177900             PERFORM DP013-0000-PROCESS-ABEND                     17790001
178000             MOVE PC-TSYMSG-00482           TO DP020-MSG-NUMBER   17800001
178100             SET DP020-MSG-WARNING          TO TRUE               17810001
178200         WHEN SQLCODE < ZERO                                      17820001
178300         WHEN SQLCODE > ZERO                                      17830001
178400             MOVE '6210-SELECT-ACCT-NBR-HIST-TBL'                 17840001
178500                                        TO DP013-PARAGRAPH        17850001
178600             MOVE 'UNABLE TO SELECT CARD ID NUMBER FROM HIST'     17860001
178700                                        TO DP013-MESSAGE-TEXT(1)  17870001
178800             MOVE SQLCA                 TO DP013-SQLCA            17880001
178900             MOVE 'SVT_KOHLS_CRD_ACCT'  TO DP013-DB2-TABLE-NAME(1)17890001
179000             SET DP013-DB2-ABEND                                  17900001
179100                 DP013-NO-ROLLBACK                                17910001
179200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               17920001
179300             PERFORM DP013-0000-PROCESS-ABEND                     17930001
179400     END-EVALUATE.                                                17940001
179500                                                                  17950001
179600*----------------------------------------------------------------*17960001
179700*  EXTRACT UPC AND PRODUCER CODE                                  17970001
179800*----------------------------------------------------------------*17980001
179900 6300-EXTRACT-UPC-PRDR-CODE.                                      17990001
180000                                                                  18000001
180100     EXEC SQL                                                     18010001
180200         SELECT C.UPC_NBR                                         18020001
180300               ,A.CRD_PRDR_CDE                                    18030001
180400               ,A.CRD_STK_TYP_ID                                  18040003
180500           INTO :SVT00008-UPC-NBR                                 18050001
180600               ,:SVT00000-CRD-PRDR-CDE                            18060001
180700               ,:SVT00000-CRD-STK-TYP-ID                          18070003
180800           FROM SVT_CRD_PROD A,                                   18080001
180900                SVT_KOHLS_CRD_ACCT B,                             18090001
181000                SVT_CRD_STK_DNMNTN C                              18100001
181100          WHERE B.CRD_NBR = :PV-CARD-NBR                          18110001
181200            AND A.CRD_PROD_YR   = B.CRD_PROD_YR                   18120001
181300            AND A.SHIPT_REQ_NBR = B.SHIPT_REQ_NBR                 18130001
181400            AND B.CRD_TYP_CDE   = C.CRD_TYP_CDE                   18140001
181500            AND A.CRD_STK_TYP_ID = C.CRD_STK_TYP_ID               18150001
181600            AND A.PRE_DNNTD_CRD_AMT = C.PRE_DNNTD_CRD_AMT         18160001
181700          WITH UR                                                 18170001
181800     END-EXEC.                                                    18180001
181900                                                                  18190001
182000     EVALUATE TRUE                                                18200001
182100       WHEN SQLCODE = ZERO                                        18210001
182200           MOVE 'Y' TO PS-UPC-PRDR-CDE-FOUND-SW                   18220001
182300       WHEN SQLCODE = +100                                        18230001
182310           PERFORM 6350-EXTRACT-UPC-PRDR-HIST                     18231039
182400*          SET PS-ERROR                                           18240038
182500*              DP020-MSG-FATAL                                    18250038
182600*              DP030-SET-CURSOR-APPL-1 TO TRUE                    18260038
182700*          MOVE PC-TSYMSG-01210 TO DP020-MSG-NUMBER               18270038
182800*          MOVE DP015-UNP-ALP-BRT-OFF TO ACARDIDA                 18280038
182900*          MOVE DP015-RED             TO ACARDIDC                 18290038
183000*          MOVE DP015-REVERSE         TO ACARDIDH                 18300038
183100*          MOVE -1                    TO ACARDIDL                 18310038
183200       WHEN OTHER                                                 18320001
183300          MOVE '6300-EXTRACT-UPC-PRDR-CODE'                       18330001
183400                                   TO DP013-PARAGRAPH             18340001
183500          MOVE 'INVALID ACCT NUMBER'                              18350001
183600                                   TO DP013-MESSAGE-TEXT (1)      18360001
183700          MOVE SQLCA               TO DP013-SQLCA                 18370001
183800          MOVE 'SVT_CRD_PROD'       TO DP013-DB2-TABLE-NAME (1)   18380001
183900          MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (2)   18390001
184000          MOVE 'SVT_CRD_STC_DNMNTN' TO DP013-DB2-TABLE-NAME (3)   18400001
184100          SET DP013-DB2-ABEND      TO TRUE                        18410001
184200          PERFORM DP013-0000-PROCESS-ABEND                        18420001
184300     END-EVALUATE.                                                18430001
184400                                                                  18440001
184410*----------------------------------------------------------------*18441038
184420*  EXTRACT UPC AND PRODUCER CODE FROM HIST TABLE                  18442038
184430*----------------------------------------------------------------*18443038
184440 6350-EXTRACT-UPC-PRDR-HIST.                                      18444039
184450                                                                  18445038
184460     EXEC SQL                                                     18446038
184470         SELECT C.UPC_NBR                                         18447038
184480               ,A.CRD_PRDR_CDE                                    18448038
184490               ,A.CRD_STK_TYP_ID                                  18449038
184491           INTO :SVT00008-UPC-NBR                                 18449138
184492               ,:SVT00000-CRD-PRDR-CDE                            18449238
184493               ,:SVT00000-CRD-STK-TYP-ID                          18449338
184494           FROM SVT_CRD_PROD A,                                   18449438
184495                SVT_CRD_ACCT_HIST B,                              18449538
184496                SVT_CRD_STK_DNMNTN C                              18449638
184497          WHERE B.CRD_NBR = :PV-CARD-NBR                          18449738
184498            AND A.CRD_PROD_YR   = B.CRD_PROD_YR                   18449838
184499            AND A.SHIPT_REQ_NBR = B.SHIPT_REQ_NBR                 18449938
184500            AND B.CRD_TYP_CDE   = C.CRD_TYP_CDE                   18450038
184501            AND A.CRD_STK_TYP_ID = C.CRD_STK_TYP_ID               18450138
184502            AND A.PRE_DNNTD_CRD_AMT = C.PRE_DNNTD_CRD_AMT         18450238
184503          WITH UR                                                 18450338
184504     END-EXEC.                                                    18450438
184505                                                                  18450538
184506     EVALUATE TRUE                                                18450638
184507       WHEN SQLCODE = ZERO                                        18450738
184508           MOVE 'Y' TO PS-UPC-PRDR-CDE-FOUND-SW                   18450838
184509       WHEN SQLCODE = +100                                        18450938
184510           SET PS-ERROR                                           18451038
184511               DP020-MSG-FATAL                                    18451138
184512               DP030-SET-CURSOR-APPL-1 TO TRUE                    18451238
184513           MOVE PC-TSYMSG-01210 TO DP020-MSG-NUMBER               18451338
184514           MOVE DP015-UNP-ALP-BRT-OFF TO ACARDIDA                 18451438
184515           MOVE DP015-RED             TO ACARDIDC                 18451538
184516           MOVE DP015-REVERSE         TO ACARDIDH                 18451638
184517           MOVE -1                    TO ACARDIDL                 18451738
184518       WHEN OTHER                                                 18451838
184519          MOVE '6350-EXTRACT-UPC-PRDR-HIST'                       18451939
184520                                   TO DP013-PARAGRAPH             18452038
184521          MOVE 'INVALID ACCT NUMBER'                              18452138
184522                                   TO DP013-MESSAGE-TEXT (1)      18452238
184523          MOVE SQLCA               TO DP013-SQLCA                 18452338
184524          MOVE 'SVT_CRD_PROD'       TO DP013-DB2-TABLE-NAME (1)   18452438
184525          MOVE 'SVT_CRD_ACCT_HIST'  TO DP013-DB2-TABLE-NAME (2)   18452538
184526          MOVE 'SVT_CRD_STC_DNMNTN' TO DP013-DB2-TABLE-NAME (3)   18452638
184527          SET DP013-DB2-ABEND      TO TRUE                        18452738
184528          PERFORM DP013-0000-PROCESS-ABEND                        18452838
184529     END-EVALUATE.                                                18452938
184530                                                                  18453038
184540*----------------------------------------------------------------*18454001
184600*    DATE/TIME MODULE                                            *18460001
184700*----------------------------------------------------------------*18470001
184800                                                                  18480001
184900     COPY DPPD017.                                                18490001
185000                                                                  18500001
185100*----------------------------------------------------------------*18510001
185200*    CONVERSION OF CARD NUMBER                                   *18520001
185300*----------------------------------------------------------------*18530001
185400     COPY SVPD007.                                                18540001
185500                                                                  18550001
185600                                                                  18560001
185700*----------------------------------------------------------------*18570001
185800* EXPAND CARD NUMBER                                             *18580001
185900* IF THE CARD NUMBER IS A GIFT CARD ADD THE PREFIX AND CHECK     *18590001
186000* DIGIT.                                                         *18600001
186100*----------------------------------------------------------------*18610001
186200 6400-GET-CHECK-DIGIT.                                            18620001
186300                                                                  18630001
186400     PERFORM 6500-SELECT-CRD-AMT.                                 18640001
186500                                                                  18650001
186600     IF PS-NO-ERROR                                               18660001
186700       IF SV007-PRE-DNNTD-CRD-AMT = ZERO                          18670001
186800         MOVE SV007-NON-DNNTD-PREFIX TO SV007-CARD-PREFIX-OUT     18680001
186900       ELSE                                                       18690001
187000         MOVE SV007-PRE-DNNTD-PREFIX TO SV007-CARD-PREFIX-OUT     18700001
187100       END-IF                                                     18710001
187200                                                                  18720001
187300       INITIALIZE DP040I-UPC-CHECK-DIGIT-PARMS                    18730001
187400       SET DP040I-COMP-CHECK-DIGIT-OPTION                         18740001
187500                                    TO TRUE                       18750001
187600       MOVE SV007-CARD-ID           TO DP040I-UPC-CODE            18760001
187700       CALL DP040I-UPC-CHECK-DIGIT-WO-IUPC                        18770044
187800            USING DP040I-UPC-CHECK-DIGIT-PARMS                    18780001
187900       IF DP040I-NO-ERROR-DETECTED                                18790001
188000           MOVE DP040I-COMPUTED-UPC-CHK-DIGIT                     18800001
188100                                    TO SV007-CHECK-DIGIT-OUT      18810001
                 DP040I-COMPUTED-UPC-CHK-DIGIT                          18812045
188200       END-IF                                                     18820001
188300     END-IF.                                                      18830001
188400                                                                  18840001
188500*----------------------------------------------------------------*18850001
188600* SELECT THE CRD AMT TO DETERMINE CARD PREFIX                    *18860001
188700*----------------------------------------------------------------*18870001
188800 6500-SELECT-CRD-AMT.                                             18880001
188900                                                                  18890001
189000     EXEC SQL                                                     18900001
189100         SELECT  PRE_DNNTD_CRD_AMT                                18910001
189200           INTO :SV007-PRE-DNNTD-CRD-AMT                          18920001
189300           FROM  SVT_KOHLS_CRD_ACCT T                             18930001
189400                ,SVT_CRD_PROD C                                   18940001
189500          WHERE CRD_NBR = :SV007-CRD-NBR                          18950001
189600            AND T.CRD_PROD_YR = C.CRD_PROD_YR                     18960001
189700            AND T.SHIPT_REQ_NBR = C.SHIPT_REQ_NBR                 18970001
189800     END-EXEC.                                                    18980001
189900                                                                  18990001
190000     EVALUATE TRUE                                                19000001
190100         WHEN SQLCODE = 0                                         19010001
190200             CONTINUE                                             19020001
190300         WHEN SQLCODE = PC-ROW-NOT-FOUND                          19030001
190400             PERFORM 6510-SELECT-CRD-HIST-AMT                     19040001
190500             IF SQLCODE = 0                                       19050001
190600               CONTINUE                                           19060001
190700             ELSE                                                 19070001
190800               SET PS-ERROR                                       19080001
190900                   DP020-MSG-FATAL                                19090001
191000                   DP030-SET-CURSOR-APPL-1 TO TRUE                19100001
191100               MOVE PC-TSYMSG-01210 TO DP020-MSG-NUMBER           19110001
191200               MOVE DP015-UNP-ALP-BRT-OFF TO ACARDIDA             19120001
191300               MOVE DP015-RED             TO ACARDIDC             19130001
191400               MOVE DP015-REVERSE         TO ACARDIDH             19140001
191500               MOVE -1                    TO ACARDIDL             19150001
191600             END-IF                                               19160001
191700         WHEN SQLCODE = -913                                      19170001
191800             MOVE '6500-SELECT-CRD-AMT'                           19180001
191900                                 TO DP013-PARAGRAPH               19190001
192000             MOVE 'SELECT PRE_DNNTD_CRD_AMT FOR CRD NBR       '   19200001
192100                                 TO DP013-MESSAGE-TEXT (1)        19210001
192200             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)19220001
192300             MOVE 'SVT_CRD_PROD      ' TO DP013-DB2-TABLE-NAME (1)19230001
192400             MOVE SQLCA          TO DP013-SQLCA                   19240001
192500             SET DP013-LINK-RETURN                                19250001
192600                 DP013-DB2-ABEND                                  19260001
192700                 DP013-ROLLBACK  TO TRUE                          19270001
192800             PERFORM DP013-0000-PROCESS-ABEND                     19280001
192900             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP020-MSG-TEXT          19290001
193000*----PC-TSYMSG-00482 - THERE IS A CONFLICT WITH ANOTHER           19300001
193100*----                  TRANSACTION FOR DATABASE &VAR              19310001
193200             MOVE PC-TSYMSG-00482                                 19320001
193300                                 TO DP020-MSG-NUMBER              19330001
193400             SET SV007-DB2-ERROR    TO TRUE                       19340001
193500             SET DP020-MSG-FATAL TO TRUE                          19350001
193600             SET DP020-NEXT-ACT-APPL-ERROR                        19360001
193700                                 TO TRUE                          19370001
193800         WHEN OTHER                                               19380001
193900             MOVE '6500-SELECT-CRD-AMT'                           19390001
194000                                 TO DP013-PARAGRAPH               19400001
194100             MOVE 'SELECT CARD TYPE OF THE FIRST CONTROL NBR  '   19410001
194200                                 TO DP013-MESSAGE-TEXT (1)        19420001
194300             MOVE SQLCA          TO DP013-SQLCA                   19430001
194400             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)19440001
194500             SET DP013-DB2-ABEND                                  19450001
194600                 DP013-XCTL-DISPLAY-RESTART                       19460001
194700                                   TO TRUE                        19470001
194800             PERFORM DP013-0000-PROCESS-ABEND                     19480001
194900     END-EVALUATE.                                                19490001
195000                                                                  19500001
195100*----------------------------------------------------------------*19510001
195200* SELECT THE CRD AMT TO DETERMINE CARD PREFIX                    *19520001
195300*----------------------------------------------------------------*19530001
195400 6510-SELECT-CRD-HIST-AMT.                                        19540001
195500                                                                  19550001
195600     EXEC SQL                                                     19560001
195700         SELECT  PRE_DNNTD_CRD_AMT                                19570001
195800           INTO :SV007-PRE-DNNTD-CRD-AMT                          19580001
195900           FROM  SVT_CRD_ACCT_HIST T                              19590001
196000                ,SVT_CRD_PROD C                                   19600001
196100          WHERE CRD_NBR = :SV007-CRD-NBR                          19610001
196200            AND T.CRD_PROD_YR = C.CRD_PROD_YR                     19620001
196300            AND T.SHIPT_REQ_NBR = C.SHIPT_REQ_NBR                 19630001
196400     END-EXEC.                                                    19640001
196500                                                                  19650001
196600     EVALUATE TRUE                                                19660001
196700         WHEN SQLCODE = 0                                         19670001
196800             CONTINUE                                             19680001
196900         WHEN SQLCODE = PC-ROW-NOT-FOUND                          19690001
197000             CONTINUE                                             19700001
197100         WHEN SQLCODE = -913                                      19710001
197200             MOVE '6510-SELECT-CRD-AMT'                           19720001
197300                                 TO DP013-PARAGRAPH               19730001
197400             MOVE 'SELECT PRE_DNNTD_CRD_AMT FOR CRD NBR       '   19740001
197500                                 TO DP013-MESSAGE-TEXT (1)        19750001
197600             MOVE 'SVT_CRD_ACCT_HIST ' TO DP013-DB2-TABLE-NAME (1)19760001
197700             MOVE 'SVT_CRD_PROD      ' TO DP013-DB2-TABLE-NAME (1)19770001
197800             MOVE SQLCA          TO DP013-SQLCA                   19780001
197900             SET DP013-LINK-RETURN                                19790001
198000                 DP013-DB2-ABEND                                  19800001
198100                 DP013-ROLLBACK  TO TRUE                          19810001
198200             PERFORM DP013-0000-PROCESS-ABEND                     19820001
198300             MOVE 'SVT_CRD_ACCT_HIST' TO DP020-MSG-TEXT           19830001
198400*----PC-TSYMSG-00482 - THERE IS A CONFLICT WITH ANOTHER           19840001
198500*----                  TRANSACTION FOR DATABASE &VAR              19850001
198600             MOVE PC-TSYMSG-00482                                 19860001
198700                                 TO DP020-MSG-NUMBER              19870001
198800             SET SV007-DB2-ERROR    TO TRUE                       19880001
198900             SET DP020-MSG-FATAL TO TRUE                          19890001
199000             SET DP020-NEXT-ACT-APPL-ERROR                        19900001
199100                                 TO TRUE                          19910001
199200         WHEN OTHER                                               19920001
199300             MOVE '6500-SELECT-CRD-HIST-AMT'                      19930001
199400                                 TO DP013-PARAGRAPH               19940001
199500             MOVE 'SELECT CARD TYPE OF THE FIRST CONTROL NBR  '   19950001
199600                                 TO DP013-MESSAGE-TEXT (1)        19960001
199700             MOVE SQLCA          TO DP013-SQLCA                   19970001
199800             MOVE 'SVT_CRD_ACCT_HIST' TO DP013-DB2-TABLE-NAME (1) 19980001
199900             SET DP013-DB2-ABEND                                  19990001
200000                 DP013-XCTL-DISPLAY-RESTART                       20000001
200100                                   TO TRUE                        20010001
200200             PERFORM DP013-0000-PROCESS-ABEND                     20020001
200300     END-EVALUATE.                                                20030001
200400                                                                  20040001
200500*----------------------------------------------------------------*20050001
200600*    ABEND PROCESSOR MODULE                                      *20060001
200700*----------------------------------------------------------------*20070001
200800                                                                  20080001
200900     COPY DPPD013.                                                20090001
